goog.provide("nsVitisComponent");nsVitisComponent={};goog.provide("nsVitisComponent.Map");goog.require("nsVitisComponent");goog.require("MapJSON");goog.require("ol");goog.require("ol.Map");goog.require("ol.View");goog.require("ol.proj");goog.require("ol.proj.Projection");goog.require("ol.Collection");goog.require("ol.layer.Tile");goog.require("ol.layer.Vector");goog.require("ol.layer.Image");goog.require("ol.layer.Group");goog.require("ol.source.OSM");goog.require("ol.source.BingMaps");goog.require("ol.source.Vector");goog.require("ol.format.WKT");
goog.require("ol.control");goog.require("ol.control.MousePosition");goog.require("ol.control.Control");goog.require("ol.control.ScaleLine");goog.require("ol.style.Style");goog.require("ol.style.Fill");goog.require("ol.style.Stroke");goog.require("ol.style.Circle");goog.require("ol.animation");goog.require("ol.easing");goog.require("ol.interaction.Interaction");goog.require("ol.interaction.Select");goog.require("ol.interaction.Modify");goog.require("ol.interaction.Draw");goog.require("ol.events.condition");
goog.require("ol.Extent");goog.require("ol.Sphere");var featureID=0;
nsVitisComponent.Map=function(opt_option){var target=opt_option["target"];var options=opt_option["options"];var hiddenFieldId=opt_option["hiddenFieldId"];var oFormValues=opt_option["oFormValues"];var sFormName=opt_option["sFormName"];var oProj=opt_option["oProj"];if(!goog.isDefAndNotNull(target)){console.error("nsVitisComponent.Map: target not defined");return null}if(!goog.isDefAndNotNull(options)){console.error("nsVitisComponent.Map: options not defined");return null}if(!goog.isDefAndNotNull(hiddenFieldId)){console.error("nsVitisComponent.Map: hiddenFieldId not defined");
return null}if(!goog.isDefAndNotNull(oFormValues)){console.error("nsVitisComponent.Map: oFormValues not defined");return null}if(!goog.isDefAndNotNull(sFormName)){console.error("nsVitisComponent.Map: sFormName not defined");return null}if(!goog.isDefAndNotNull(oProj)){console.error("nsVitisComponent.Map: oProj not defined");return null}this.$propertiesSrvc_=angular.element(vitisApp.appHtmlFormDrtv).injector().get(["propertiesSrvc"]);this.$translate_=angular.element(vitisApp.appHtmlFormDrtv).injector().get(["$translate"]);
this.$log_=angular.element(vitisApp.appHtmlFormDrtv).injector().get(["$log"]);var this_=this;this.$log_.log("nsVitisComponent.Map");this.appColor=$(".banner_line").css("background-color");if(goog.isDef(this.appColor))if(this.appColor.charAt(3)!=="a"){this.appColor=this.appColor.split("(");this.appColor=this.appColor[1].split(")");this.appColor="rgba("+this.appColor[0]+",0.58)"}var aTranslates=["COMPONENT_MAP_LAYERSTREE","COMPONENT_MAP_FULLSCREEN","COMPONENT_MAP_ZOOM_EXTENT","COMPONENT_MAP_DELETE_FEATURE",
"COMPONENT_MAP_DELETE_ALL","COMPONENT_MAP_MODIFY_FEATURE","COMPONENT_MAP_DRAW_POINT","COMPONENT_MAP_DRAW_LINE","COMPONENT_MAP_DRAW_POLYGON","COMPONENT_MAP_ZOOM_EXTENT","COMPONENT_MAP_OVERSIZED_EXTENT"];this.$translate_(aTranslates).then(function(translations){this_.oTranslates=translations});this.addCustomProjections();var center,extent;if(goog.isDef(options["center"]["coord"]))center=options["center"]["coord"];if(goog.isDef(options["center"]["extent"]))extent=options["center"]["extent"];this.proj_=
options["proj"];if(options["center"]["coord"])this.View=new ol.View({center:center,zoom:5,projection:ol.proj.get(options["proj"])});else this.View=new ol.View({center:[(extent[0]+extent[2])/2,(extent[1]+extent[3])/2],zoom:5,projection:ol.proj.get(options["proj"])});this.oTranslates={};this.Target=target;this.Accuracy=options["coord_accuracy"];this.Controls=[];this.Layers=[];this.Features=new ol.Collection;this.interaction="none";this.Config={};this.oProj_=oProj;this.multiGeom=options["interactions"]["multi_geometry"];
this["bLayersTreeOpen"]=false;if(options["type"]==="OSM")this.Layers.push(new ol.layer.Tile({source:new ol.source.OSM}));else if(options["type"]==="bing")this.Layers.push(new ol.layer.Tile({source:new ol.source.BingMaps({culture:options["source"]["culture"],key:options["source"]["key"],imagerySet:options["source"]["style"]})}));this.element=document.createElement("DIV");$(this.element).addClass("ol-current-projection-studio ol-unselectable");if(options["controls"]["MP"])this.Controls.push(new ol.control.MousePosition({coordinateFormat:function(coordinate){return[coordinate[0].toPrecision(this_.Accuracy),
coordinate[1].toPrecision(this_.Accuracy)]}}));if(options["controls"]["SL"])this.Controls.push(new ol.control.ScaleLine);if(options["controls"]["CP"])this.Controls.push(new ol.control.Control({element:this_.element,render:function(){var currentProj="";for(var i=0;i<this_.oProj_["projections"].length;i++)if(this_.proj_===this_.oProj_["projections"][i]["code"])currentProj=this_.oProj_["projections"][i]["name"];if(currentProj!=="")$(".ol-current-projection-studio").html(currentProj);else $(".ol-current-projection-studio").html(this_.proj_)}}));
if(options["controls"]["ZO"])setTimeout(function(){this_.ZoomGroup=this_.zoomControls(this_.Target)},500);setTimeout(function(){this_.IntractionsGroup=this_.addInteractions(this_.Target,options["interactions"])});if(Array.isArray(options["layers"]))if(options["layers"].length>0)this.Layers.push(options["layers"]);this.MapObject=new ol.Map({target:this_.Target,layers:this_.Layers,view:this_.View,controls:this_.Controls});if(goog.isDefAndNotNull(options["center"]["scale"]))this.setScale(options["center"]["scale"]);
if(goog.isDefAndNotNull(options["center"]["extent"]))this.setExtent(options["center"]["extent"]);if(options["type"]==="vmap"&&options["tree"])this["aTree"]=this.loadTree(options["tree"]);else this["aTree"]=[{"service":options["type"],"layers":this.Layers}];var projExtent=ol.proj.get(options["proj"]).getExtent();var viewExtent=this.View.calculateExtent(this.MapObject.getSize());if(this.isInsideProjExtent(viewExtent,projExtent))this.Extent=this.View.calculateExtent(this.MapObject.getSize());else{console.error("map extent oversized");
this.MapObject.getView().fit(projExtent,this.MapObject.getSize())}$(".ol-mouse-position").css("bottom","8px");$(".ol-mouse-position").css("top","auto");$(".ol-mouse-position").css("background",this.appColor);$(".ol-mouse-position").css("color","#ffffff");$(".ol-mouse-position").css("border-radius","4px");$(".ol-scale-line").css("background",this.appColor);$(".ol-current-projection-studio").css("background",this.appColor);options["draw_color"]=goog.isDef(options["draw_color"])?options["draw_color"]:
"rgba(54,184,255,0.6)";options["contour_color"]=goog.isDef(options["contour_color"])?options["contour_color"]:"rgba(0,0,0,0.4)";options["contour_size"]=goog.isDef(options["contour_size"])?options["contour_size"]:2;options["circle_radius"]=goog.isDef(options["circle_radius"])?options["circle_radius"]:7;var style=new ol.style.Style({fill:new ol.style.Fill({color:options["draw_color"]}),stroke:new ol.style.Stroke({color:options["contour_color"],width:options["contour_size"]}),image:new ol.style.Circle({radius:options["circle_radius"],
fill:new ol.style.Fill({color:options["draw_color"]}),stroke:new ol.style.Stroke({color:options["contour_color"],width:options["contour_size"]})})});this.FeatureOverlay=new ol.layer.Vector({style:style,updateWhileAnimating:true,updateWhileInteracting:true,source:new ol.source.Vector({features:this_.Features})});setTimeout(function(){this_.MapObject.addLayer(this_.FeatureOverlay)},500);this.selectHover_=new ol.interaction.Select({source:this.FeatureOverlay.getSource(),condition:ol.events.condition.pointerMove});
this.MapObject.addInteraction(this.selectHover_);var wktFormat=new ol.format.WKT;var hiddenFeatures=$("#"+hiddenFieldId).val();if(goog.isDef(hiddenFeatures))if(!goog.string.isEmpty(hiddenFeatures)&&hiddenFeatures!=="[object Object]"){var aFeatures=wktFormat.readFeatures(hiddenFeatures);for(var i=0;i<aFeatures.length;i++)this.FeatureOverlay.getSource().addFeature(aFeatures[i]);var featuresExtent=this.FeatureOverlay.getSource().getExtent();this.MapObject.getView().fit(featuresExtent,this.MapObject.getSize());
if(aFeatures.length===1)if(aFeatures[0].getGeometry().getType()==="Point")this.MapObject.getView().setZoom(12)}this.Features.on("change",function(){var this_=this;setTimeout(function(){var wktFeatures=wktFormat.writeFeatures(this_.getArray());if(goog.isDef(hiddenFieldId))document.getElementById(hiddenFieldId).setAttribute("value",wktFeatures);if(goog.isDef(sFormName)&&goog.isDef(oFormValues))oFormValues[sFormName]=wktFeatures;this_.MapObject.dispatchEvent("moveend")},1)});return this};
nsVitisComponent.Map.prototype.addCustomProjections=function(){var lambert93=new ol.proj.Projection({code:"EPSG:2154",extent:[-378305.81,6093283.21,1212610.74,7186901.68],units:"m"});ol.proj.addProjection(lambert93);var WGSToLambert=this.WGSToLambert;var lambertToWGS=this.lambertToWGS;ol.proj.addCoordinateTransforms("EPSG:4326","EPSG:2154",this.WGSToLambert,this.lambertToWGS);ol.proj.addCoordinateTransforms("EPSG:3857","EPSG:2154",function(coordinate3857){var coordinate4326=ol.proj.transform(coordinate3857,
"EPSG:3857","EPSG:4326");var coordinate2154=ol.proj.transform(coordinate4326,"EPSG:4326","EPSG:2154");return coordinate2154},function(coordinate2154){var coordinate4326=ol.proj.transform(coordinate2154,"EPSG:2154","EPSG:4326");var coordinate3857=ol.proj.transform(coordinate4326,"EPSG:4326","EPSG:3857");return coordinate3857})};
nsVitisComponent.Map.prototype.WGSToLambert=function(coordinates){var longitude=coordinates[0];var latitude=coordinates[1];var deg2rad=function deg2rad(angle){return angle/180*Math.PI};var a=6378137;var e=.08181919106;var lc=deg2rad(3);var phi0=deg2rad(46.5);var phi1=deg2rad(44);var phi2=deg2rad(49);var x0=7E5;var y0=66E5;var phi=deg2rad(latitude);var l=deg2rad(longitude);var gN1=a/Math.sqrt(1-e*e*Math.sin(phi1)*Math.sin(phi1));var gN2=a/Math.sqrt(1-e*e*Math.sin(phi2)*Math.sin(phi2));var gl1=Math.log(Math.tan(Math.PI/
4+phi1/2)*Math.pow((1-e*Math.sin(phi1))/(1+e*Math.sin(phi1)),e/2));var gl2=Math.log(Math.tan(Math.PI/4+phi2/2)*Math.pow((1-e*Math.sin(phi2))/(1+e*Math.sin(phi2)),e/2));var gl0=Math.log(Math.tan(Math.PI/4+phi0/2)*Math.pow((1-e*Math.sin(phi0))/(1+e*Math.sin(phi0)),e/2));var gl=Math.log(Math.tan(Math.PI/4+phi/2)*Math.pow((1-e*Math.sin(phi))/(1+e*Math.sin(phi)),e/2));var n=Math.log(gN2*Math.cos(phi2)/(gN1*Math.cos(phi1)))/(gl1-gl2);var c=gN1*Math.cos(phi1)/n*Math.exp(n*gl1);var ys=y0+c*Math.exp(-1*n*
gl0);var x93=x0+c*Math.exp(-1*n*gl)*Math.sin(n*(l-lc));var y93=ys-c*Math.exp(-1*n*gl)*Math.cos(n*(l-lc));return[x93,y93]};
nsVitisComponent.Map.prototype.lambertToWGS=function(coordinates){Math.atanh=Math.atanh||function(x){return Math.log((1+x)/(1-x))/2};Math.tanh=Math.tanh||function(x){if(x===Infinity)return 1;else if(x===-Infinity)return-1;else return(Math.exp(x)-Math.exp(-x))/(Math.exp(x)+Math.exp(-x))};var x=coordinates[0].toFixed(10);var y=coordinates[1].toFixed(10);var b6=6378137;var b7=298.257222101;var b8=1/b7;var b9=2*b8-b8*b8;var b10=Math.sqrt(b9);var b13=3;var b14=7E5;var b15=1.26556120499E7;var b16=.725607765053267;
var b17=1.1754255426096E7;var delx=x-b14;var dely=y-b15;var gamma=Math.atan(-delx/dely);var r=Math.sqrt(delx*delx+dely*dely);var latiso=Math.log(b17/r)/b16;var sinphiit0=Math.tanh(latiso+b10*Math.atanh(b10*Math.sin(1)));var sinphiit1=Math.tanh(latiso+b10*Math.atanh(b10*sinphiit0));var sinphiit2=Math.tanh(latiso+b10*Math.atanh(b10*sinphiit1));var sinphiit3=Math.tanh(latiso+b10*Math.atanh(b10*sinphiit2));var sinphiit4=Math.tanh(latiso+b10*Math.atanh(b10*sinphiit3));var sinphiit5=Math.tanh(latiso+b10*
Math.atanh(b10*sinphiit4));var sinphiit6=Math.tanh(latiso+b10*Math.atanh(b10*sinphiit5));var longrad=gamma/b16+b13/180*Math.PI;var latrad=Math.asin(sinphiit6);var lon=longrad/Math.PI*180;var lat=latrad/Math.PI*180;return[lon,lat]};
nsVitisComponent.Map.prototype.zoomControls=function(target){var this_=this;var buttonPlus=document.createElement("BUTTON");var buttonMinus=document.createElement("BUTTON");var buttonExtent=document.createElement("BUTTON");buttonPlus["innerHTML"]="<span class='fa fa-search-plus fa-x1' aria-hidden='true'></span>";buttonMinus["innerHTML"]="<span class='fa fa-search-minus fa-x1' aria-hidden='true'></span>";buttonExtent["innerHTML"]="<span class='glyphicon glyphicon-home' aria-hidden='true'></span>";
buttonPlus["className"]="btn btn-success Map-btn map-ZoomIn";buttonMinus["className"]="btn btn-success Map-btn map-ZoomOut";buttonExtent["className"]="btn btn-success Map-btn map-ZoomToExtent";$(buttonPlus).prop("type","button");$(buttonMinus).prop("type","button");$(buttonExtent).prop("type","button");$(buttonExtent).prop("title",this.oTranslates["COMPONENT_MAP_ZOOM_EXTENT"]);$(buttonPlus).on("click",function(){var currentResolution=this_.View.getResolution();this_.MapObject.beforeRender(ol.animation.zoom({"resolution":currentResolution,
"duration":250,"easing":ol.easing.easeOut}));var newResolution=this_.View.constrainResolution(currentResolution,1);this_.View.setResolution(newResolution);var zoom=this_.MapObject.getView().getZoom();this_.MapObject.getView().setZoom(zoom+1)});$(buttonMinus).on("click",function(){var currentResolution=this_.View.getResolution();this_.MapObject.beforeRender(ol.animation.zoom({"resolution":currentResolution,"duration":250,"easing":ol.easing.easeOut}));var newResolution=this_.View.constrainResolution(currentResolution,
-1);this_.View.setResolution(newResolution);var zoom=this_.MapObject.getView().getZoom();this_.MapObject.getView().setZoom(zoom-1)});$(buttonExtent).on("click",function(){this_.MapObject.getView().fit(this_.Extent,this_.MapObject.getSize())});var element=document.createElement("DIV");element["className"]="btn-group-vertical btn-group-md form-map-Group-btn-zoom";element.appendChild(buttonPlus);element.appendChild(buttonMinus);element.appendChild(buttonExtent);target.appendChild(element);return element};
nsVitisComponent.Map.prototype.addInteractions=function(target,objInter){var arrButton=[];var this_=this;if(objInter["full_screen"])if(document["fullscreenEnabled"]||document["webkitFullscreenEnabled"]||document["mozFullScreenEnabled"]||document["msFullscreenEnabled"]){var button_full_screen=document.createElement("BUTTON");button_full_screen["innerHTML"]="<span class='icon-enlarge' aria-hidden='true'></span>";button_full_screen["className"]="btn btn-success Map-btn map-FullScreen";button_full_screen["title"]=
this.oTranslates["COMPONENT_MAP_FULLSCREEN"];$(button_full_screen).prop("type","button");$(button_full_screen).on("click",function(){var elem=this_.Target;if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else{if(document.msExitFullscreen)document.msExitFullscreen()}else if(elem.requestFullscreen)elem.requestFullscreen();
else if(elem.mozRequestFullScreen)elem.mozRequestFullScreen();else if(elem.webkitRequestFullscreen)elem.webkitRequestFullscreen()});arrButton.push(button_full_screen)}if(objInter["layer_tree"]){var button_layer_tree=document.createElement("BUTTON");button_layer_tree["innerHTML"]="<span class='icon-layers2' aria-hidden='true'></span>";button_layer_tree["className"]="btn btn-success Map-btn map-LayerTree";button_layer_tree["title"]=this.oTranslates["COMPONENT_MAP_LAYERSTREE"];$(button_layer_tree).prop("type",
"button");$(button_layer_tree).on("click",function(){this_["bLayersTreeOpen"]=!this_["bLayersTreeOpen"];this_.MapObject.dispatchEvent("moveend")});arrButton.push(button_layer_tree)}if(objInter["RA"]){var button_ra=document.createElement("BUTTON");button_ra["innerHTML"]="<span class='icon-trash' aria-hidden='true'></span>";button_ra["className"]="btn btn-success Map-btn map-AllRemove";button_ra["title"]=this.oTranslates["COMPONENT_MAP_DELETE_ALL"];$(button_ra).prop("type","button");$(button_ra).on("click",
function(){if(this_.interaction!=="none")this_.MapObject.removeInteraction(this_.interaction);this_.FeatureOverlay.getSource().getFeaturesCollection().clear();this_.FeatureOverlay.getSource().changed();this_.Features.changed()});arrButton.push(button_ra)}if(objInter["RO"]){var button_ro=document.createElement("BUTTON");button_ro["innerHTML"]="<span class='icon-eraser' aria-hidden='true'></span>";button_ro["className"]="btn btn-success Map-btn map-Remove";button_ro["title"]=this.oTranslates["COMPONENT_MAP_DELETE_FEATURE"];
$(button_ro).prop("type","button");$(button_ro).on("click",function(){var isActive=$(button_ro).hasClass("active");if(this_.interaction!=="none"){this_.MapObject.removeInteraction(this_.interaction);if(isActive)return 0}this_.interaction=new ol.interaction.Select({condition:ol.events.condition.click,source:this_.FeatureOverlay.getSource()});this_.selectHover_.setActive(true);this_.interaction.set("binded-button",button_ro);this_.MapObject.addInteraction(this_.interaction);this_.interaction.getFeatures().on("add",
function(){this_.FeatureOverlay.getSource().removeFeature(this_.interaction.getFeatures().getArray()[0]);this_.interaction.getFeatures().clear();this_.selectHover_.getFeatures().clear();this_.FeatureOverlay.getSource().changed();this_.Features.changed()})});arrButton.push(button_ro)}if(objInter["ED"]){var button_ed=document.createElement("BUTTON");button_ed["innerHTML"]="<span class='icon-edit' aria-hidden='true'></span>";button_ed["className"]="btn btn-success Map-btn map-Modify";button_ed["title"]=
this.oTranslates["COMPONENT_MAP_MODIFY_FEATURE"];$(button_ed).prop("type","button");$(button_ed).on("click",function(){var isActive=$(button_ed).hasClass("active");if(this_.interaction!=="none"){this_.MapObject.removeInteraction(this_.interaction);if(isActive)return 0}this_.interaction=new ol.interaction.Modify({features:this_.FeatureOverlay.getSource().getFeaturesCollection()});this_.interaction.set("binded-button",button_ed);this_.MapObject.addInteraction(this_.interaction);this_.interaction.on("modifyend",
function(){this_.Features.changed()})});arrButton.push(button_ed)}if(objInter["DP"]){var button_dp=document.createElement("BUTTON");button_dp["innerHTML"]="<span class='icon-point' aria-hidden='true'></span>";button_dp["className"]="btn btn-success Map-btn map-Point";button_dp["title"]=this.oTranslates["COMPONENT_MAP_DRAW_POINT"];$(button_dp).prop("type","button");$(button_dp).on("click",function(){var isActive=$(button_dp).hasClass("active");if(this_.interaction!=="none"){this_.MapObject.removeInteraction(this_.interaction);
if(isActive)return 0}this_.interaction=new ol.interaction.Draw({source:this_.FeatureOverlay.getSource(),type:"Point"});this_.interaction.set("binded-button",button_dp);this_.MapObject.addInteraction(this_.interaction);this_.interaction.on("drawend",function(event){if(objInter["multi_geometry"]!==true)var features=this_.FeatureOverlay.getSource().getFeaturesCollection().clear();var featureID=featureID+1;event.feature.d_=featureID;this_.Features.dispatchEvent("change")})});arrButton.push(button_dp)}if(objInter["DL"]){var button_dl=
document.createElement("BUTTON");button_dl["innerHTML"]="<span class='icon-line' aria-hidden='true'></span>";button_dl["className"]="btn btn-success Map-btn map-Line";button_dl["title"]=this.oTranslates["COMPONENT_MAP_DRAW_LINE"];$(button_dl).prop("type","button");$(button_dl).on("click",function(){var isActive=$(button_dl).hasClass("active");if(this_.interaction!=="none"){this_.MapObject.removeInteraction(this_.interaction);if(isActive)return 0}this_.interaction=new ol.interaction.Draw({source:this_.FeatureOverlay.getSource(),
type:"LineString"});this_.interaction.set("binded-button",button_dl);this_.MapObject.addInteraction(this_.interaction);this_.interaction.on("drawend",function(event){if(objInter["multi_geometry"]!==true)var features=this_.FeatureOverlay.getSource().getFeaturesCollection().clear();var featureID=featureID+1;event.feature.d_=featureID;this_.Features.changed()})});arrButton.push(button_dl)}if(objInter["DPol"]){var button_dpol=document.createElement("BUTTON");button_dpol["innerHTML"]="<span class='icon-polygon' aria-hidden='true'></span>";
button_dpol["className"]="btn btn-success Map-btn map-Polygon";button_dpol["title"]=this.oTranslates["COMPONENT_MAP_DRAW_POLYGON"];$(button_dpol).prop("type","button");$(button_dpol).on("click",function(){var isActive=$(button_dpol).hasClass("active");if(this_.interaction!=="none"){this_.MapObject.removeInteraction(this_.interaction);if(isActive)return 0}this_.interaction=new ol.interaction.Draw({source:this_.FeatureOverlay.getSource(),type:"Polygon"});this_.interaction.set("binded-button",button_dpol);
this_.MapObject.addInteraction(this_.interaction);this_.interaction.on("drawend",function(event){if(objInter["multi_geometry"]!==true)var features=this_.FeatureOverlay.getSource().getFeaturesCollection().clear();var featureID=featureID+1;event.feature.d_=featureID;this_.Features.changed()})});arrButton.push(button_dpol)}var element=document.createElement("DIV");element["className"]="btn-group-vertical btn-group-md form-map-Group-btn-interact";for(var i=0;i<arrButton.length;i++)element.appendChild(arrButton[i]);
target.appendChild(element);setTimeout(function(){var interactions=this_.MapObject.getInteractions();interactions.on("change:length",function(){$(element).children().removeClass("active");$(element).children().blur();interactions.forEach(function(element,index,array){$(element.get("binded-button")).addClass("active")})});interactions.on("remove",function(){this_.selectHover_.setActive(false)});$(document).keydown(function(e){if(e.keyCode===27)interactions.forEach(function(element,index,array){if(goog.isDef(element.get("binded-button")))this_.MapObject.removeInteraction(element)})})},
1E3);return element};
nsVitisComponent.Map.prototype.loadTree=function(tree){if(this.MapObject.getLayers().getArray().length>0)this.MapObject.getLayers().clear();this.Layers.length=0;var oLayer;var aTree=[];var tileSize=[256,256];var oMapDefinition=angular.copy(tree);var oMapJSON=new MapJSON({"properties":this.$propertiesSrvc_});var olView=oMapJSON.getViewFromDef(oMapDefinition,{"size":this.MapObject.getSize(),"tileSize":tileSize});var olLayers=oMapJSON.getLayersFromDef(oMapDefinition,{"size":this.MapObject.getSize(),"tileSize":tileSize});
this.MapObject.setView(olView);for(var i=0;i<olLayers.length;i++){var oLayer={"index":i,"layer":olLayers[i]};this.Layers.push(oLayer);this.MapObject.addLayer(olLayers[i])}for(var i=0;i<oMapDefinition["children"].length;i++)if(goog.isDef(oMapDefinition["children"][i]["children"]))aTree.push({"service":oMapDefinition["children"][i]["name"],"layers":oMapDefinition["children"][i]["children"]});return aTree};
nsVitisComponent.Map.prototype.isInsideProjExtent=function(viewExtent,projExtent){var bIsInside=true;if(projExtent[0]>viewExtent[0])bIsInside=false;if(projExtent[1]>viewExtent[1])bIsInside=false;if(projExtent[2]<viewExtent[2])bIsInside=false;if(projExtent[3]<viewExtent[3])bIsInside=false;return bIsInside};
nsVitisComponent.Map.prototype.getScale=function(){var wgs84Sphere_=new ol.Sphere(6378137);var projection=this.MapObject.getView().getProjection();var map=this.MapObject;var line=map.getView().calculateExtent([37.795275591,0]);var c1=ol.proj.transform([line[0],line[1]],projection,"EPSG:4326");var c2=ol.proj.transform([line[2],line[3]],projection,"EPSG:4326");var length=wgs84Sphere_.haversineDistance(c1,c2);var scale=length*100;return scale};
nsVitisComponent.Map.prototype.setScale=function(scale){var currentScale=this["getScale"]();var currentResolution=this.MapObject.getView().getResolution();var scaleResolution=scale*currentResolution/currentScale;this.MapObject.getView().setResolution(scaleResolution);currentScale=this["getScale"]()};nsVitisComponent.Map.prototype.setExtent=function(extent){this.Extent=extent;this.MapObject.getView().fit(extent,this.MapObject.getSize(),{nearest:true})};nsVitisComponent.Map.prototype.getZoom=function(){return this.MapObject.getView().getZoom()};
nsVitisComponent.Map.prototype.setZoom=function(zoom){this.MapObject.getView().setZoom(zoom)};nsVitisComponent.Map.prototype.setCenter=function(coord){this.MapObject.getView().setCenter(coord)};
nsVitisComponent.Map.prototype.setControls=function(obj){var this_=this;this.MapObject.getControls().clear();if(this.ZoomGroup!=="undefined")$(this.ZoomGroup).remove();if(obj["ZO"])this.ZoomGroup=this.zoomControls(this.Target);if(obj["MP"]){this.MapObject.addControl(new ol.control.MousePosition({coordinateFormat:function(coordinate){return[coordinate[0].toPrecision(this_.Accuracy),coordinate[1].toPrecision(this_.Accuracy)]}}));$(".ol-mouse-position").css("bottom","8px");$(".ol-mouse-position").css("top",
"auto");$(".ol-mouse-position").css("background","rgba(218, 94, 209, 0.58)");$(".ol-mouse-position").css("color","#ffffff");$(".ol-mouse-position").css("border-radius","4px")}if(obj["SL"]){this.MapObject.addControl(new ol.control.ScaleLine);$(".ol-scale-line").css("background","rgba(218, 94, 209, 0.58)")}if(obj["CP"])this.MapObject.addControl(new ol.control.Control({"element":this_.element,"render":function(){$(this_.element).html(this_.proj_)}}))};
nsVitisComponent.Map.prototype.setInteractions=function(obj){this.MapObject.getInteractions().clear();if(this.IntractionsGroup!=="undefined")$(this.IntractionsGroup).remove();this.IntractionsGroup=this.addInteractions(this.Target,obj);ol.interaction.defaults().forEach(function(el,index,arr){this.MapObject.addInteraction(el)},this)};
nsVitisComponent.Map.prototype.setBingSource=function(objSource){this.MapObject.getLayers().getArray()[0].setSource(new ol.source.BingMaps({culture:objSource["culture"],key:objSource["key"],imagerySet:objSource["style"]}))};nsVitisComponent.Map.prototype.getConfig=function(){this.Config["extent"]=this.View.calculateExtent(this.MapObject.getSize());this.Config["coord"]=this.View.getCenter();this.Config["scale"]=Math.round(this["getScale"]());return this.Config};
nsVitisComponent.Map.prototype.getMap=function(){return this.MapObject};
nsVitisComponent.Map.prototype.setView=function(options){this.proj_=options["proj"];var center,extent;if(goog.isDef(options["center"]["coord"]))center=options["center"]["coord"];if(goog.isDef(options["center"]["extent"]))extent=options["center"]["extent"];if(options["center"]["coord"]&&options["center"]["zoom"]){this.View=new ol.View({"center":center,"zoom":options["center"]["zoom"],"projection":ol.proj.get(this.proj_)});this.MapObject.setView(this.View)}else{this.View=new ol.View({"center":[(extent[0]+
extent[2])/2,(extent[1]+extent[3])/2],"projection":ol.proj.get(this.proj_)});this.MapObject.setView(this.View);this.MapObject.getView().fit(extent,this.MapObject.getSize(),{nearest:true})}var currentProj="";for(var i=0;i<this.oProj_["projections"];i++)if(this.proj_===this.oProj["projections"][i]["code"])currentProj=this.oProj["projections"][i]["name"];if(currentProj!=="")$(".ol-current-projection-studio").html(currentProj);else $(".ol-current-projection-studio").html(this.proj_)};
nsVitisComponent.Map.prototype.setJsonTree=function(tree){this.loadTree(tree)};nsVitisComponent.Map.prototype.getFeatures=function(){return this.Features.getArray()};nsVitisComponent.Map.prototype.getProj=function(){return this.proj_};nsVitisComponent.Map.prototype.getExtent=function(){return this.View.calculateExtent(this.MapObject.getSize())};nsVitisComponent.Map.prototype.getCenter=function(){return this.View.getCenter()};
nsVitisComponent.Map.prototype.transformer=function(data,epsgFrom,epsgTo){return ol.proj.transform(data,epsgFrom,epsgTo)};nsVitisComponent.Map.prototype.transformExtent=function(extent,epsgFrom,epsgTo){return ol.proj.transformExtent(extent,epsgFrom,epsgTo)};nsVitisComponent.Map.prototype.on=function(event,handler,this_){this.MapObject.on(event,handler,this_)};
nsVitisComponent.Map.prototype.drawPoint=function(x,y){var Map=this.getMap();var this_=this;var Point=new ol.Feature({"geometry":new ol.geom.Point([x,y])});var array=Map.getLayers().getArray();array.forEach(function(item,index,array){if(goog.isDef(item.getSource().getFeatures)){var Features=item.getSource().getFeaturesCollection();if(this_.multiGeom!==true)item.getSource().getFeaturesCollection().clear();Features.push(Point)}});this.setCenter([x,y])};goog.provide("formReader");goog.require("nsVitisComponent.Map");var formReader=function(){};formReader.module=angular.module("formReader",["angular.bind.notifier"]);goog.provide("formReader.controller.formReaderController");goog.require("formReader");
formReader.formReaderController=function($scope,$http,$q,$log,formReaderService,$rootScope){$log.info("formReader.formReaderController");var this_=this;this.$http_=$http;this.$scope_=$scope;this.$q_=$q;this.$log_=$log;this.formReaderService_=formReaderService;this.aWatchedVariables_=[];$scope["oFormValues"]=goog.isDef($scope["oFormValues"])?$scope["oFormValues"]:{};$scope["oFormDefinition"]=goog.isDef($scope["oFormDefinition"])?$scope["oFormDefinition"]:{};$scope["sFormDefinitionName"]=goog.isDef($scope["sFormDefinitionName"])?
$scope["sFormDefinitionName"]:"";this.initFormTabs();$scope["sFormUniqueName"]=Date.now();$scope["iDisplayedTab"]=0;if(typeof $rootScope["oFormPromises"]=="undefined")$rootScope["oFormPromises"]={};$rootScope["oFormPromises"][$scope["sFormDefinitionName"]]=[];var clearListener=$rootScope.$on("formDefinitionLoaded",function(){this_.loadForm();clearListener()})};formReader.module.controller("AppFormReaderController",formReader.formReaderController);
formReader.formReaderController.prototype.initFormTabs=function(){if(goog.isDefAndNotNull(this.$scope_["oFormDefinition"]))if(goog.isDefAndNotNull(this.$scope_["sFormDefinitionName"]))if(goog.isDefAndNotNull(this.$scope_["oFormDefinition"][this.$scope_["sFormDefinitionName"]]))if(!goog.isDefAndNotNull(this.$scope_["oFormDefinition"][this.$scope_["sFormDefinitionName"]]["tabs"])){var oForm=this.$scope_["oFormDefinition"][this.$scope_["sFormDefinitionName"]];var aElems=[];if(goog.isDefAndNotNull(oForm["rows"])){for(var i=
0;i<oForm["rows"].length;i++)if(goog.isDefAndNotNull(oForm["rows"][i]["fields"]))for(var ii=0;ii<oForm["rows"][i]["fields"].length;ii++)if(goog.isDefAndNotNull(oForm["rows"][i]["fields"][ii]["name"]))aElems.push(oForm["rows"][i]["fields"][ii]["name"]);else if(goog.isDefAndNotNull(oForm["rows"][i]["fields"][ii]["buttons"]))for(var iii=0;iii<oForm["rows"][i]["fields"][ii]["buttons"].length;iii++)if(goog.isDefAndNotNull(oForm["rows"][i]["fields"][ii]["buttons"][iii]["name"]))aElems.push(oForm["rows"][i]["fields"][ii]["buttons"][iii]["name"]);
this.$scope_["oFormDefinition"][this.$scope_["sFormDefinitionName"]]["tabs"]={"position":"top","list":[{"label":"Tab 0","elements":aElems}]}}}};
formReader.formReaderController.prototype.loadForm=function(){var this_=this;this.initFormTabs();this.useDefaultValues(false);setTimeout(function(){var formDefinition=this_.$scope_["oFormDefinition"];var formDefinitionName=this_.$scope_["sFormDefinitionName"];if(!goog.isDefAndNotNull(formDefinition))return 0;if(!goog.isDefAndNotNull(formDefinitionName))return 0;if(!goog.isDefAndNotNull(formDefinition[formDefinitionName]))return 0;var initEvent=formDefinition[formDefinitionName]["initEvent"];setTimeout(function(){if(goog.isDefAndNotNull(formDefinition[formDefinitionName]["initEvent"]))if(this_.formReaderService_["isFunctionCall"](initEvent))this_.formReaderService_["callFunction"](initEvent);
setTimeout(function(){this_.extractFormDefinitionInfos()})})});this.$scope_.$broadcast("loadForm")};formReader.formReaderController.prototype.refreshForm=function(){this.initFormTabs();this.$scope_.$broadcast("$$rebind::refresh")};
formReader.formReaderController.prototype.setFormDefinition=function(oFormDefinition){this.$log_.log("formReader.formReaderController.prototype.setFormDefinition");this.$scope_["oFormDefinition"]=oFormDefinition;this.formReaderService_["oFormDefinition"]=oFormDefinition;this.refreshForm()};
formReader.formReaderController.prototype.setFormValues=function(oFormValues){this.$log_.log("formReader.formReaderController.prototype.setFormValues");this.$scope_["oFormValues"]=oFormValues;this.formReaderService_["oFormValues"]=oFormValues};
formReader.formReaderController.prototype.setDefinitionName=function(oFormDefinitionName){this.$log_.log("formReader.formReaderController.prototype.setDefinitionName");this.$scope_["sFormDefinitionName"]=oFormDefinitionName;this.formReaderService_["sFormDefinitionName"]=oFormDefinitionName};
formReader.formReaderController.prototype.valueIsPresent=function(oField,oValue){if(!goog.isDef(oField)||!goog.isDef(oValue))return false;if(!goog.isDef(oField["options"]))return false;if(!goog.object.isEmpty(oValue))if(goog.isDefAndNotNull(oValue["selectedOption"]))if(goog.isDefAndNotNull(oValue["selectedOption"]["value"]))oValue=oValue["selectedOption"]["value"];if(goog.isArray(oField["options"])&&oField["options"].length>0){var valueIsPresent=false;for(var i=0;i<oField["options"].length;i++)if(oField["options"][i]["value"]===
oValue)valueIsPresent=true;return valueIsPresent}else return false};formReader.formReaderController.prototype.toTest=function(object){console.log(object)};
formReader.formReaderController.prototype.useDefaultValues=function(bEraseFormValues,sElementName){this.$log_.log("formReader.formReaderController.prototype.useDefaultValues");var $scope=this.$scope_;var oFormValues=$scope["oFormValues"];var oFormDefinition=$scope["oFormDefinition"];var sFormDefinitionName=$scope["sFormDefinitionName"];if(!goog.isDefAndNotNull(oFormValues))return 0;if(!goog.isDefAndNotNull(oFormDefinition))return 0;if(!goog.isDefAndNotNull(sFormDefinitionName))return 0;if(!goog.isDefAndNotNull(oFormDefinition[sFormDefinitionName]))return 0;
var aRows=oFormDefinition[sFormDefinitionName]["rows"];if(!goog.isDefAndNotNull(aRows))return 0;for(var i=0;i<aRows.length;i++)if(goog.isDefAndNotNull(aRows[i]["fields"]))for(var ii=0;ii<aRows[i]["fields"].length;ii++){if(aRows[i]["fields"][ii]["type"]==="bo_grid"||aRows[i]["fields"][ii]["type"]==="ui_grid"||aRows[i]["fields"][ii]["type"]==="section_grid")continue;var field;try{field=angular.copy(aRows[i]["fields"][ii])}catch(e){console.error("try angular.copy failed");continue}if(goog.isDefAndNotNull(sElementName))if(field["name"]!==
sElementName)continue;if(goog.isDefAndNotNull(field["default_value"])&&field["default_value"]!=="")if(this.formReaderService_["isFunctionCall"](field["default_value"]))field["default_value"]=this.formReaderService_["callFunction"](field["default_value"]);if(field["type"]==="select"||field["type"]==="editable_select"){if(goog.isDefAndNotNull(field["default_value"])&&field["default_value"]!=="")field["default_value"]={"value":field["default_value"]}}else if(field["type"]==="list"||field["type"]==="double_select")if(goog.isDefAndNotNull(field["default_value"])&&
field["default_value"]!==""){var aDefaultKeys=field["default_value"].split("|");var aDefaults=[];for(var iii=0;iii<aDefaultKeys.length;iii++)aDefaults.push({"value":aDefaultKeys[iii]});field["default_value"]=aDefaults}if(this.useDefaultValue(field,bEraseFormValues))if(field["type"]==="select"||field["type"]==="editable_select"||field["type"]==="list"){if(!goog.isDefAndNotNull(oFormValues[sFormDefinitionName][field["name"]]))oFormValues[sFormDefinitionName][field["name"]]={};oFormValues[sFormDefinitionName][field["name"]]["selectedOption"]=
field["default_value"]}else if(field["type"]==="double_select"){if(!goog.isDefAndNotNull(oFormValues[sFormDefinitionName][field["name"]]))oFormValues[sFormDefinitionName][field["name_to"]]={};oFormValues[sFormDefinitionName][field["name_to"]]["selectedOption"]=field["default_value"]}else if(field["type"]==="editable_double_select"){if(!goog.isDefAndNotNull(oFormValues[sFormDefinitionName][field["name"]]))oFormValues[sFormDefinitionName][field["name_available_tags"]]={};oFormValues[sFormDefinitionName][field["name_available_tags"]]["selectedOption"]=
field["default_value"]}else oFormValues[sFormDefinitionName][field["name"]]=field["default_value"];delete field}};
formReader.formReaderController.prototype.useDefaultValue=function(oField,bEraseFormValues){this.$log_.log("formReader.formReaderController.prototype.useDefaultValue");var $scope=this.$scope_;var oFormValues=$scope["oFormValues"];var sFormDefinitionName=$scope["sFormDefinitionName"];if(goog.isDef(oField["default_value"])&&oField["default_value"]!=="")if(bEraseFormValues===true)return true;else if(oField["type"]==="select"){if(!goog.isDefAndNotNull(oFormValues[sFormDefinitionName][oField["name"]]))return true;
if(!goog.isDefAndNotNull(oFormValues[sFormDefinitionName][oField["name"]]["selectedOption"]))return true;if(!goog.isDefAndNotNull(oFormValues[sFormDefinitionName][oField["name"]]["selectedOption"]["value"]))return true;if(oFormValues[sFormDefinitionName][oField["name"]]["selectedOption"]["value"].length===0)return true}else if(oField["type"]==="editable_select"){if(!goog.isDefAndNotNull(oFormValues[sFormDefinitionName][oField["name"]]))return true;if(!goog.isDefAndNotNull(oFormValues[sFormDefinitionName][oField["name"]]["selectedOption"]))return true;
if(!goog.isDefAndNotNull(oFormValues[sFormDefinitionName][oField["name"]]["selectedOption"]["value"]))return true;if(oFormValues[sFormDefinitionName][oField["name"]]["selectedOption"]["value"].length===0)return true}else if(oField["type"]==="list"){if(!goog.isDefAndNotNull(oFormValues[sFormDefinitionName][oField["name"]]))return true;if(!goog.isArray(oFormValues[sFormDefinitionName][oField["name"]]["selectedOption"]))return true;if(oFormValues[sFormDefinitionName][oField["name"]]["selectedOption"].length===
0)return true;if(oFormValues[sFormDefinitionName][oField["name"]]["selectedOption"][0]["value"].length===0)return true}else if(oField["type"]==="double_select"){if(!goog.isDefAndNotNull(oFormValues[sFormDefinitionName][oField["name_to"]]))return true;if(!goog.isArray(oFormValues[sFormDefinitionName][oField["name_to"]]["selectedOption"]))return true;if(oFormValues[sFormDefinitionName][oField["name_to"]]["selectedOption"].length===0)return true;if(oFormValues[sFormDefinitionName][oField["name_to"]]["selectedOption"][0]["value"].length===
0)return true}else if(oField["type"]==="editable_double_select"){if(!goog.isDefAndNotNull(oFormValues[sFormDefinitionName][oField["name_available_tags"]]))return true;if(!goog.isArray(oFormValues[sFormDefinitionName][oField["name_available_tags"]]["selectedOption"]))return true;if(oFormValues[sFormDefinitionName][oField["name_available_tags"]]["selectedOption"].length===0)return true;if(oFormValues[sFormDefinitionName][oField["name_available_tags"]]["selectedOption"][0]["value"].length===0)return true}else{if(!goog.isDefAndNotNull(oFormValues[sFormDefinitionName][oField["name"]]))return true;
if(oFormValues[sFormDefinitionName][oField["name"]].length===0)return true}else return false};
formReader.formReaderController.prototype.extractFormDefinitionInfos=function(){this.$log_.log("formReader.formReaderController.prototype.extractFormDefinitionInfos");if(!goog.isDef(this.$scope_["oFormDefinition"])){console.error("$scope['oFormDefinition'] not defined");return 0}this.$scope_.$broadcast("extractFormDefinitionInfos");var oFormDefinition=this.$scope_["oFormDefinition"][this.$scope_["sFormDefinitionName"]];var oFormValues=this.$scope_["oFormValues"][this.$scope_["sFormDefinitionName"]];
var oDataSources=this.$scope_["oFormDefinition"]["datasources"];var formFieldValue;var selectValue;var this_=this;if(!goog.isDefAndNotNull(this.$scope_.$root["oFormPromises"][this.$scope_["sFormDefinitionName"]]))this.$scope_.$root["oFormPromises"][this.$scope_["sFormDefinitionName"]]=[];var deferred=this.$q_.defer();var promise=deferred.promise;this.$scope_.$root["oFormPromises"][this.$scope_["sFormDefinitionName"]].push(promise);for(var i=0;i<this_.aWatchedVariables_.length;i++)this_.aWatchedVariables_[i]();
this_.aWatchedVariables_.length=0;if(goog.isDef(oFormDefinition)&&goog.isDef(oFormDefinition["rows"]))for(var i=0;i<oFormDefinition["rows"].length;i++)for(var j=0;j<oFormDefinition["rows"][i]["fields"].length;j++){var elem=oFormDefinition["rows"][i]["fields"][j];formFieldValue=oFormValues[elem["name"]];if(typeof elem["id"]==="undefined"&&typeof elem["name"]!=="undefined")elem["id"]=this.$scope_["sFormDefinitionName"]+"_"+elem["name"];switch(elem["type"]){case "select":case "editable_select":case "list":case "double_select":elem["id_from"]=
elem["id"]+"_from";var oWebService=null;var aOptions=null;if(goog.isDef(elem["datasource"]))if(goog.isDef(elem["datasource"]["datasource_id"]))if(goog.isDef(oDataSources))if(goog.isDef(oDataSources[elem["datasource"]["datasource_id"]]))if(oDataSources[elem["datasource"]["datasource_id"]]["type"]==="web_service")oWebService=this_.extractElemWebService(elem,oDataSources);else if(oDataSources[elem["datasource"]["datasource_id"]]["type"]==="object")aOptions=this_.extractElemOptions(elem,oDataSources);
if(goog.isDef(elem["web_service"]))oWebService=angular.copy(elem["web_service"]);if(goog.isDefAndNotNull(elem["options"]))var aUsedOptions=elem["options"];if(goog.isDefAndNotNull(aOptions))var aUsedOptions=aOptions;if(goog.isDefAndNotNull(oWebService)){oWebService=angular.copy(oWebService);if(oWebService["load_first_time"]!==false){if(goog.isDef(oWebService["parents"]))this.listenParentsChanges(elem,oWebService,oFormValues);var parents_ready=this.areParentsReady(oFormValues,oWebService["parents"],
true);if(parents_ready)this.formReaderService_["setWebServiceSelectOptions"](elem,this.$scope_["sFormDefinitionName"],this.$scope_["oFormValues"],oWebService);delete oWebService}else if(typeof oWebService["callback"]!=="undefined")if(this_.formReaderService_["isFunctionCall"](oWebService["callback"]))this_.formReaderService_["callFunction"](oWebService["callback"])}else if(goog.isDef(aUsedOptions))this.formReaderService_["setSelectOptions"](elem,this.$scope_["sFormDefinitionName"],this.$scope_["oFormValues"],
aUsedOptions);else if(typeof formFieldValue!=="object"){selectValue=formFieldValue;if(elem["type"]==="select"||elem["type"]==="editable_select")oFormValues[elem["name"]]={"selectedOption":{"value":selectValue},"options":[]};else oFormValues[elem["name"]]={"selectedOption":[{"value":selectValue}],"options":[]}}break;case "editable_double_select":elem["name_available_tags"]=elem["name"]+"_available";elem["id_available_tags"]=elem["id"]+"_available";if(typeof elem["web_service"]!=="undefined")this.formReaderService_["setWebServiceTags"](elem,
this.$scope_["sFormDefinitionName"],this.$scope_["oFormValues"]);break;case "title":case "subtitle":case "label":case "button":break;default:break}delete elem}this.$q_.all(this.$scope_.$root["oFormPromises"][this.$scope_["sFormDefinitionName"]]).then(function(values){setTimeout(function(){this_.$scope_.$root.$emit("formExtracted",this_.$scope_["sFormDefinitionName"])});if(goog.isDefAndNotNull(oFormDefinition)){var sFormName=oFormDefinition["name"];var oFormElement=angular.element("form[name='"+sFormName+
"']");if(oFormElement.length>0){var oFormElementScope=oFormElement.scope();if(goog.isDefAndNotNull(oFormElementScope[sFormName]))oFormElementScope[sFormName].$setPristine()}}});deferred.resolve()};
formReader.formReaderController.prototype.listenParentsChanges=function(elem,oWebService,oFormValues){var this_=this;oWebService["parameters"]["original_filter"]=goog.isDefAndNotNull(oWebService["parameters"]["filter"])?oWebService["parameters"]["filter"]:"";for(var i=0;i<oWebService["parents"].length;i++){var filter_attr=oWebService["parents"][i]["filter_attr"];var filter_equality=oWebService["parents"][i]["filter_equality"];if(goog.isDef(oWebService["parents"][i]["name_to"]))var watchedVariableName=
oWebService["parents"][i]["name_to"];else var watchedVariableName=oWebService["parents"][i]["name"];var sWatchedVariable=angular.copy("oFormValues."+this_.$scope_["sFormDefinitionName"]+"."+watchedVariableName+".selectedOption");setTimeout(function(opt_options){var sParentsChanged=angular.bind({elem:opt_options.elem,oWebService:opt_options.oWebService,filter_attr:opt_options.filter_attr,filter_equality:opt_options.filter_equality,watchedVariableName:opt_options.watchedVariableName},function(){var elem=
this.elem;var oWebService=this.oWebService;var filter_attr=this.filter_attr;var filter_equality=this.filter_equality;var watchedVariableName=this.watchedVariableName;var watchedVariableValue=oFormValues[watchedVariableName];var oSelectedOption;if(!goog.isDefAndNotNull(watchedVariableValue))return 0;if(!goog.isDefAndNotNull(watchedVariableValue["selectedOption"]))return 0;else if(goog.isArray(watchedVariableValue["selectedOption"])){if(watchedVariableValue["selectedOption"].length===0)return 0}else if(!goog.isDefAndNotNull(watchedVariableValue["selectedOption"]["value"]))return 0;
var parents_ready=this_.areParentsReady(oFormValues,oWebService["parents"]);if(goog.isDefAndNotNull(this_.$scope_["oFormValues"]))if(goog.isDefAndNotNull(this_.$scope_["oFormValues"][this_.$scope_["sFormDefinitionName"]]))if(goog.isDefAndNotNull(this_.$scope_["oFormValues"][this_.$scope_["sFormDefinitionName"]][elem["name"]]))if(goog.isDefAndNotNull(this_.$scope_["oFormValues"][this_.$scope_["sFormDefinitionName"]][elem["name"]]["selectedOption"]))oSelectedOption=angular.copy(this_.$scope_["oFormValues"][this_.$scope_["sFormDefinitionName"]][elem["name"]]["selectedOption"]);
this_.formReaderService_["emptySelectOptions"](elem,this_.$scope_["sFormDefinitionName"],this_.$scope_["oFormValues"]);if(parents_ready){oWebService["parameters"]["filter"]=this_.getNewFilter(oFormValues,oWebService["parents"],oWebService["parameters"]["original_filter"]);this_.$log_.log({"filter: ":angular.copy(oWebService["parameters"]["filter"])});this_.formReaderService_["setWebServiceSelectOptions"](elem,this_.$scope_["sFormDefinitionName"],this_.$scope_["oFormValues"],oWebService,oSelectedOption)}},
true);sParentsChanged();this_.aWatchedVariables_.push(this_.$scope_.$watch(opt_options.sWatchedVariable,sParentsChanged))},1E3,{sWatchedVariable:sWatchedVariable,elem:elem,oWebService:oWebService,filter_attr:filter_attr,filter_equality:filter_equality,watchedVariableName:watchedVariableName});delete filter_attr;delete filter_equality;delete sWatchedVariable}};
formReader.formReaderController.prototype.extractElemWebService=function(elem,oDataSources){if(!goog.isDef(elem["datasource"]["id_key"]))return null;if(!goog.isDef(elem["datasource"]["label_key"]))return null;var oWebService=angular.copy(oDataSources[elem["datasource"]["datasource_id"]]);oWebService["id_key"]=elem["datasource"]["id_key"];oWebService["label_key"]=elem["datasource"]["label_key"];oWebService["parameters"]=goog.isDef(oWebService["parameters"])?oWebService["parameters"]:{};if(goog.isDef(elem["datasource"]["parents"]))oWebService["parents"]=
elem["datasource"]["parents"];if(goog.isDef(elem["datasource"]["filter"]))oWebService["parameters"]["filter"]=elem["datasource"]["filter"];if(goog.isDef(elem["datasource"]["distinct"]))oWebService["parameters"]["distinct"]=elem["datasource"]["distinct"];if(goog.isDef(elem["datasource"]["attributs"]))oWebService["parameters"]["attributs"]=elem["datasource"]["attributs"];if(goog.isDef(elem["datasource"]["order_by"]))oWebService["parameters"]["order_by"]=elem["datasource"]["order_by"];if(goog.isDef(elem["datasource"]["sort_order"]))oWebService["parameters"]["sort_order"]=
elem["datasource"]["sort_order"];return oWebService};
formReader.formReaderController.prototype.extractElemOptions=function(elem,oDataSources){var aOptions=[];if(goog.isDef(oDataSources[elem["datasource"]["datasource_id"]]["data"])&&goog.isDef(elem["datasource"]["id_key"])&&goog.isDef(elem["datasource"]["label_key"])){var id_key=elem["datasource"]["id_key"];var label_key=elem["datasource"]["label_key"];var aData=oDataSources[elem["datasource"]["datasource_id"]]["data"];if(!goog.isDef(id_key))console.error("id_key not defined (required in for data json source)");if(!goog.isDef(label_key))console.error("label_key not defined (required in for data json source)");
if(goog.isDef(id_key)&&goog.isDef(label_key))for(var i=0;i<aData.length;i++)aOptions.push(aData[i][label_key]+"|"+aData[i][id_key]);delete id_key;delete label_key;delete aData}if(goog.isDef(oDataSources[elem["datasource"]["datasource_id"]]["options"]))aOptions=oDataSources[elem["datasource"]["datasource_id"]]["options"];return aOptions};
formReader.formReaderController.prototype.areParentsReady=function(oFormValues,aParents,bLookOnlyWaited){var parents_ready=true;if(!goog.isDefAndNotNull(oFormValues)){console.error("formReader.formReaderController.prototype.areParentsReady: oFormValues not defined");return false}if(!goog.isDefAndNotNull(aParents)||goog.isArray(aParents)&&aParents.length===0)return true;for(var i=0;i<aParents.length;i++){if(aParents[i]["wait_for_parent"]==="false"||aParents[i]["wait_for_parent"]===false)continue;else if(bLookOnlyWaited===
true)return false;if(!goog.isDefAndNotNull(oFormValues[aParents[i]["name"]])){parents_ready=false;continue}if(!goog.isDefAndNotNull(oFormValues[aParents[i]["name"]]["selectedOption"])){parents_ready=false;continue}if(goog.isArray(oFormValues[aParents[i]["name"]]["selectedOption"])){if(oFormValues[aParents[i]["name"]]["selectedOption"].length===0){parents_ready=false;continue}if(oFormValues[aParents[i]["name"]]["selectedOption"][0]["value"].length===0){parents_ready=false;continue}}if(!goog.isArray(oFormValues[aParents[i]["name"]]["selectedOption"])){if(!goog.isDefAndNotNull(oFormValues[aParents[i]["name"]]["selectedOption"]["value"])){parents_ready=
false;continue}if(oFormValues[aParents[i]["name"]]["selectedOption"]["value"].length===0){parents_ready=false;continue}}}return parents_ready};
formReader.formReaderController.prototype.getNewFilter=function(oFormValues,aParents,originalFilter){var additionalFilter="";aParents=goog.isDefAndNotNull(aParents)?aParents:[];originalFilter=goog.isDefAndNotNull(originalFilter)?originalFilter:"";for(var i=0;i<aParents.length;i++){if(!goog.isDef(oFormValues[aParents[i]["name"]]))continue;if(!goog.isDef(oFormValues[aParents[i]["name"]]["selectedOption"]))continue;if(!goog.isDef(oFormValues[aParents[i]["name"]]["selectedOption"]["value"])){if(!goog.isArray(oFormValues[aParents[i]["name"]]["selectedOption"]))continue;
if(oFormValues[aParents[i]["name"]]["selectedOption"].length<1)continue}var aParentValues=[];if(!goog.isArray(oFormValues[aParents[i]["name"]]["selectedOption"])&&goog.isDef(oFormValues[aParents[i]["name"]]["selectedOption"]["value"]))aParentValues.push(oFormValues[aParents[i]["name"]]["selectedOption"]);else aParentValues=oFormValues[aParents[i]["name"]]["selectedOption"];var key=aParents[i]["filter_attr"];var equality=aParents[i]["filter_equality"];var parentFilter="";for(var ii=0;ii<aParentValues.length;ii++){var value=
aParentValues[ii]["value"];if(!goog.isDefAndNotNull(value))continue;else if(goog.isString(value)&&!value.length>0)continue;var tmpFilter='"'+key+'"'+equality+"'"+value+"'";if(parentFilter.length>1)parentFilter+=" OR "+tmpFilter;else parentFilter=tmpFilter;delete value;delete tmpFilter}if(parentFilter.length===0)continue;if(additionalFilter.length>1)additionalFilter+=" AND ("+parentFilter+")";else additionalFilter="("+parentFilter+")";delete aParentValues;delete key;delete equality;delete parentFilter}delete i;
if(additionalFilter.length>1)if(originalFilter.length>1)originalFilter+=" AND "+additionalFilter;else originalFilter=additionalFilter;return originalFilter};
formReader.formReaderController.prototype.numberParser=function(str,bInt){str=goog.isDef(str)?str:"";bInt=goog.isDef(bInt)?bInt:false;if(bInt)return this.integerParser(str);else{str=str.replace(",",".");var parts=str.split(".");if(parts.length===0)return NaN;else if(parts.length===1)if(str.charAt(str.length-1)===".")return this.integerParser(str)+".";else return this.integerParser(str);else if(parts.length>=2){var left=this.integerParser(parts[0]);var right=0;if(parts.length===2)if(parts[1]==="")return this.integerParser(str)+
".";else right=this.integerParser(parts[1]);else{var tmp="";for(var i=1;i<parts.length;i++)tmp+=parts[i];right=this.integerParser(tmp)}return parseFloat(left+"."+right)}else return NaN}};formReader.formReaderController.prototype.integerParser=function(str){var ret="";for(var i=0;i<str.length;i++){var currentChar=str.charAt(i);if(!isNaN(parseInt(currentChar)))ret+=currentChar}return parseInt(ret)};goog.provide("formReader.directive.formReaderDirective");goog.require("formReader");
formReader.formReaderDirective=function($q,formReaderService,propertiesSrvc,$log,$http,$compile){return{restrict:"A",scope:{"oProperties":"=?appProperties","sToken":"=?appToken","oFormValues":"=?appFormValues","oFormDefinition":"=?appFormDefinition","sFormDefinitionName":"=?appFormDefinitionName","oFormEventsContainer":"=?appFormEventsContainer","wabState":"=?appWabState","wabGroup":"=?appWabGroup","showTabs":"=?appTabs"},controller:"AppFormReaderController",controllerAs:"ctrl",templateUrl:window.location.protocol+
"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/"+sessionStorage["appEnv"]+"/javascript/externs/formReader/formReader.html",link:function(scope,element,attrs){$log.log("formReader.formReaderDirective.link");scope["showTabs"]=scope["showTabs"]==="false"||scope["showTabs"]===false?scope["showTabs"]=false:scope["showTabs"]=true;scope["wabState"]=goog.isDefAndNotNull(scope["wabState"])&&scope["wabState"]!==""?scope["wabState"]:null;scope["wabGroup"]=goog.isDefAndNotNull(scope["wabGroup"])&&
scope["wabGroup"]!==""?scope["wabGroup"]:null;scope["submitButton"]=false;scope["oFormEventsContainer"]=goog.isDef(scope["oFormEventsContainer"])?scope["oFormEventsContainer"]:scope;formReaderService["oProperties"]=scope["oProperties"];formReaderService["sToken"]=scope["sToken"];formReaderService["oFormValues"]=scope["oFormValues"];formReaderService["oFormDefinition"]=scope["oFormDefinition"];formReaderService["sFormDefinitionName"]=scope["sFormDefinitionName"];formReaderService["oFormEventsContainer"]=
scope["oFormEventsContainer"];scope["isFormTextElement"]=function(sFormElementType){var aFormText=new Array("text","password","datetime","datetime-local","date","month","time","week","integer","float","number","email","url","search","tel","color");if(aFormText.indexOf(sFormElementType)!==-1)return true;else return false};scope["sendForm"]=function(){$log.log("scope.sendForm");var sFormName=scope["oFormDefinition"][scope["sFormDefinitionName"]]["name"];if(scope[sFormName]["$valid"]===true){var deferred=
$q.defer();var promise=deferred.promise;var beforeEvent=scope["oFormDefinition"][scope["sFormDefinitionName"]]["beforeEvent"];if(typeof beforeEvent!=="undefined")if(goog.isString(beforeEvent))$q.when(formReaderService["callFunction"](beforeEvent)).then(function(){deferred.resolve()});else{if(goog.isFunction(beforeEvent))$q.when(beforeEvent(scope["oFormValues"])).then(function(){deferred.resolve()})}else deferred.resolve();promise.then(function(){deferred=$q.defer();promise=deferred.promise;var submitEvent=
scope["oFormDefinition"][scope["sFormDefinitionName"]]["event"];if(typeof submitEvent!=="undefined")if(goog.isString(submitEvent))$q.when(formReaderService["callFunction"](submitEvent)).then(function(){deferred.resolve()});else{if(goog.isFunction(submitEvent))$q.when(submitEvent(scope["oFormValues"])).then(function(){deferred.resolve()})}else deferred.resolve();promise.then(function(){var afterEvent=scope["oFormDefinition"][scope["sFormDefinitionName"]]["afterEvent"];if(typeof afterEvent!=="undefined")if(goog.isString(afterEvent))formReaderService["callFunction"](afterEvent);
else if(goog.isFunction(afterEvent))afterEvent(scope["oFormValues"])})})}};scope["testElementsValidityTab"]=function(callback){$log.log("scope.testElementsValidityTab");var sFormName=scope["oFormDefinition"][scope["sFormDefinitionName"]]["name"];if(!scope[sFormName]["$valid"]===true){var aElems=formReaderService["getAllFormElementDefinition"](scope["sFormDefinitionName"],scope["oFormDefinition"]);var aInvalidElems=[];for(var i=0;i<aElems.length;i++)if(goog.isDefAndNotNull(aElems[i]["name"]))if(goog.isDefAndNotNull(scope[sFormName][aElems[i]["name"]]))if(!scope[sFormName][aElems[i]["name"]]["$valid"])aInvalidElems.push(aElems[i]["name"]);
if(goog.isDefAndNotNull(aInvalidElems[0]))if(goog.isDefAndNotNull(scope["oFormDefinition"][scope["sFormDefinitionName"]]["tabs"]))if(goog.isDefAndNotNull(scope["oFormDefinition"][scope["sFormDefinitionName"]]["tabs"]["list"])){var aTabs=scope["oFormDefinition"][scope["sFormDefinitionName"]]["tabs"]["list"];for(var i=0;i<aTabs.length;i++)if(aTabs[i]["elements"].indexOf(aInvalidElems[0])!==-1){scope["iDisplayedTab"]=i;break}}}if(goog.isDefAndNotNull(callback))callback.call()};scope["executeButtonEvent"]=
function($event,buttonEvent){$log.log("scope.executeButtonEvent");if(goog.isString(buttonEvent))formReaderService["callFunction"](buttonEvent);else if(goog.isFunction(buttonEvent))buttonEvent(scope["oFormValues"])};scope["getValidationCssClass"]=function(sFieldName){if(typeof sFieldName!="undefined"){var sFormName=scope["oFormDefinition"][scope["sFormDefinitionName"]]["name"];if(typeof scope[sFormName]!="undefined")if(typeof scope[sFormName][sFieldName]!="undefined")if(scope[sFormName][sFieldName].$invalid&&
scope[sFormName][sFieldName].$dirty)return"has-error"}};scope["switchSelectedOptions"]=function(sFormDefinitionName,oFieldDefinition,sFromSelectName,sToSelectName){$log.log("scope.switchSelectedOptions");var oFromSelect=scope["oFormValues"][sFormDefinitionName][sFromSelectName];scope["oFromSelect"]=oFromSelect;if(typeof oFieldDefinition["switch_event"]!=="undefined")if(formReaderService["isFunctionCall"](oFieldDefinition["switch_event"]))if(goog.isString(oFieldDefinition["switch_event"]))formReaderService["callFunction"](oFieldDefinition["switch_event"]);
else if(goog.isFunction(oFieldDefinition["switch_event"]))oFieldDefinition["switch_event"](scope["oFormValues"]);if(oFromSelect["selectedOption"].length>0){var oToSelect=scope["oFormValues"][sFormDefinitionName][sToSelectName];var i=0;while(i<oFromSelect["selectedOption"].length){if(oFromSelect["selectedOption"][i]["disabled"]!=true)oToSelect["options"].unshift(oFromSelect["options"].splice(oFromSelect["options"].indexOf(oFromSelect["selectedOption"][i]),1)[0]);i++}oFromSelect["selectedOption"]=[]}};
scope["reloadSelectField"]=function(oParentSelect,sFormDefinitionName){formReaderService["reloadSelectField"](oParentSelect,sFormDefinitionName,scope["oFormValues"],scope["oFormDefinition"])};scope["isStringNotEmpty"]=function(element){if(!goog.isDefAndNotNull(element))return false;if(!goog.isString(element))return false;if(!element.length>0)return false;return true};scope["getLinkFileName"]=function(url){if(!goog.isString(url))return"";var sName=url;if(sName.lastIndexOf("/")!==-1)sName=sName.substr(sName.lastIndexOf("/")+
1);if(sName.lastIndexOf("?")!==-1)sName=sName.substr(0,sName.lastIndexOf("?"));return sName};scope["isFieldPresent"]=function(oField,oTab,bCheckButtons){bCheckButtons=goog.isDefAndNotNull(bCheckButtons)?bCheckButtons:false;var isVisible=true;if(oField["visible"]===false||oField["visible"]==="false")isVisible=false;var isOnTab=false;if(oTab["elements"].indexOf(oField["name"])!==-1)isOnTab=true;if(oField["visibleAllTabs"]===true)isOnTab=true;if(goog.isDefAndNotNull(oField["buttons"])&&bCheckButtons===
false)isOnTab=true;if(!scope["showTabs"])isOnTab=true;if(this["useWab"]()){var isOnWab=false;var wabValue=this["getWabField"](oField);if(wabValue==="r"||wabValue==="rw")isOnWab=true;if(goog.isDefAndNotNull(oField["buttons"]))isOnWab=true;if(wabValue==="r")oField["disabled"]=true}if(goog.isDefAndNotNull(isOnWab))if(isVisible&&isOnTab&&isOnWab)return true;else return false;else if(isVisible&&isOnTab)return true;else return false};scope["isButtonPresent"]=function(oButton,oField,oTab){var isVisible=
true;if(oButton["visible"]===false||oButton["visible"]==="false")isVisible=false;var isOnTab=false;if(oTab["elements"].indexOf(oButton["name"])!==-1)isOnTab=true;if(oButton["visibleAllTabs"]===true)isOnTab=true;if(this["isFieldPresent"](oField,oTab,true))isOnTab=true;if(this["useWab"]()){var isOnWab=false;var wabValue="";if(this["isFieldPresent"](oField,oTab,true))wabValue=this["getWabField"](oField);else wabValue=this["getWabField"](oButton);if(wabValue==="r"||wabValue==="rw")isOnWab=true;if(wabValue===
"r")oButton["disabled"]=true}if(goog.isDefAndNotNull(isOnWab))if(isVisible&&isOnTab&&isOnWab)return true;else return false;else if(isVisible&&isOnTab)return true;else return false};scope["getWabField"]=function(oField){if(goog.isDefAndNotNull(scope["wabState"])&&goog.isDefAndNotNull(scope["wabGroup"]))if(goog.isDefAndNotNull(scope["oFormDefinition"]))if(goog.isDefAndNotNull(scope["oFormDefinition"][scope["sFormDefinitionName"]]))if(goog.isDefAndNotNull(scope["oFormDefinition"][scope["sFormDefinitionName"]]["wab"]))if(goog.isDefAndNotNull(scope["oFormDefinition"][scope["sFormDefinitionName"]]["wab"][scope["wabState"]]))if(goog.isDefAndNotNull(scope["oFormDefinition"][scope["sFormDefinitionName"]]["wab"][scope["wabState"]][scope["wabGroup"]])){var oWab=
scope["oFormDefinition"][scope["sFormDefinitionName"]]["wab"][scope["wabState"]][scope["wabGroup"]];if(goog.isDefAndNotNull(oWab[oField["name"]]))return oWab[oField["name"]]}return null};scope["useWab"]=function(){var useWab=false;if(goog.isDefAndNotNull(scope["wabState"])&&goog.isDefAndNotNull(scope["wabGroup"]))if(goog.isDefAndNotNull(scope["oFormDefinition"]))if(goog.isDefAndNotNull(scope["oFormDefinition"][scope["sFormDefinitionName"]]))if(goog.isDefAndNotNull(scope["oFormDefinition"][scope["sFormDefinitionName"]]["wab"]))useWab=
true;return useWab};scope["compileTemplate"]=function(){$http({method:"GET",url:propertiesSrvc["web_server_name"]+"/"+sessionStorage["appEnv"]+"/javascript/externs/formReader/formReader.html"}).then(function successCallback(response){if(!goog.isDefAndNotNull(response["data"])){console.error("template not founded");return 0}var sTemplate=response["data"];var compiledTemplate=$compile(sTemplate)(scope);element.children().replaceWith(compiledTemplate)},function errorCallback(response){})};scope["resetFileInputs"]=
function(){$(element).find(".file").each(function(){$(this)["fileinput"]("clear")})};scope.$on("$destroy",function(){scope.$root["clearFormData"](scope["sFormDefinitionName"],scope)});scope.$on("loadForm",function(){scope["resetFileInputs"]()})}}};formReader.module.directive("appFormReader",formReader.formReaderDirective);
formReader.appFormFieldSpecificParamsDrtv=function($timeout,$translate,propertiesSrvc,formReaderService,$log){return{link:function(scope,element,attrs){$log.log("formReader.appFormFieldSpecificParamsDrtv.link");if(typeof scope["field"]["attributes"]!=="undefined"){var i=0;var aKeys=Object.keys(scope["field"]["attributes"]);while(i<aKeys.length){element[0]["setAttribute"](aKeys[i],scope["field"]["attributes"][aKeys[i]]);i++}}if(scope["field"]["autofocus"]===true)element[0].focus();switch(scope["field"]["type"]){case "date":case "datetime":var oOptions=
{"useCurrent":false};var oLocaleOptions={"date":{"fr":{"locale":"fr","format":"DD/MM/YYYY"},"en":{"format":"MM/DD/YYYY"}},"datetime":{"fr":{"locale":"fr","format":"DD/MM/YYYY HH:mm"},"en":{"format":"MM/DD/YYYY HH:mm"}}};goog.object.extend(oOptions,oLocaleOptions[scope["field"]["type"]][propertiesSrvc["language"]]);if(typeof scope["field"]["options"]!=="undefined")goog.object.extend(oOptions,scope["field"]["options"]);$(element)["datetimepicker"](oOptions);$(element).on("dp.change",function(e){scope["oFormValues"][scope["sFormDefinitionName"]][element[0].name]=
element[0].value});break;case "checkbox":if(typeof scope["oFormValues"][scope["sFormDefinitionName"]][scope["field"]["name"]]=="undefined")if(typeof scope["field"]["default_value"]!="undefined")scope["oFormValues"][scope["sFormDefinitionName"]][scope["field"]["name"]]=scope["field"]["default_value"];else scope["oFormValues"][scope["sFormDefinitionName"]][scope["field"]["name"]]=false;break;case "upload":element[0].addEventListener("change",function(){var oFileList={"aFiles":this.files};scope["oFormValues"][scope["sFormDefinitionName"]][element[0].name]=
oFileList},false);var oOptions={"showPreview":false,"showRemove":true,"showUpload":false};if(typeof scope["field"]["options"]!=="undefined")goog.object.extend(oOptions,scope["field"]["options"]);oOptions["mainClass"]="input-file-"+scope["oFormDefinition"][scope["sFormDefinitionName"]]["input_size"];if(propertiesSrvc["language"]!="en")oOptions["language"]=propertiesSrvc["language"];$(element)["fileinput"](oOptions);break;case "file_wsdata":element[0].addEventListener("change",function(){var oFileList=
{"aFiles":this.files};scope["oFormValues"][scope["sFormDefinitionName"]][element[0].name]=oFileList},false);var aAvaliableFormats=[];if(goog.isDefAndNotNull(scope["field"]["formats"]))aAvaliableFormats=scope["field"]["formats"].split("|");var oOptions={"showPreview":false,"showRemove":false,"showUpload":false,"allowedFileExtensions":aAvaliableFormats};if(typeof scope["field"]["options"]!=="undefined")goog.object.extend(oOptions,scope["field"]["options"]);oOptions["mainClass"]="input-file-"+scope["oFormDefinition"][scope["sFormDefinitionName"]]["input_size"];
if(propertiesSrvc["language"]!="en")oOptions["language"]=propertiesSrvc["language"];$(element)["fileinput"](oOptions);break;case "image_wsdata":element[0].addEventListener("change",function(){var oFileList={"aFiles":this.files};scope["oFormValues"][scope["sFormDefinitionName"]][element[0].name]=oFileList},false);var oOptions={"showPreview":false,"showRemove":false,"showUpload":false,"allowedFileTypes":["image"]};oOptions["mainClass"]="input-file-"+scope["oFormDefinition"][scope["sFormDefinitionName"]]["input_size"];
if(propertiesSrvc["language"]!="en")oOptions["language"]=propertiesSrvc["language"];$(element)["fileinput"](oOptions);break;case "email":scope["field"]["pattern"]="^(([a-zA-Z]|[0-9])|([-]|[_]|[.]))+[@](([a-zA-Z0-9])|([-])){2,63}[.](([a-zA-Z0-9]){2,63})+$";var pattern=angular.copy(scope["field"]["pattern"]);scope.$watch("oFormValues."+scope["sFormDefinitionName"]+'["'+scope["field"]["name"]+'"]',function(){scope["field"]["pattern"]=angular.copy(pattern);$timeout(function(){if(element[0]["className"].indexOf("ng-invalid-pattern")!==
-1){var advice;if(scope["oProperties"]["language"]==="fr")advice="ceci n'est pas une adresse mail";else advice="this is not a mail adress";$(element).notify(advice,{"position":"top","className":"error","autoHide":false,"clickToHide":false})}else{var tabChild=element[0]["parentNode"]["children"];var elToDelete=-1;for(var i=0;i<tabChild.length;i++)if(tabChild[i]["className"]==="notifyjs-wrapper")elToDelete=i;if(elToDelete>-1)$(tabChild[elToDelete]).remove()}},1)});break;case "url":scope["field"]["pattern"]=
"^https?:\\/\\/.{1,}";var pattern=angular.copy(scope["field"]["pattern"]);scope.$watch("oFormValues."+scope["sFormDefinitionName"]+'["'+scope["field"]["name"]+'"]',function(){scope["field"]["pattern"]=angular.copy(pattern);$timeout(function(){if(element[0]["className"].indexOf("ng-invalid-pattern")!==-1){var advice;if(scope["oProperties"]["language"]==="fr")advice="ce champ doit contenir une url commancent\n par http:// ou https://";else advice="this field must contain an url that begin\n by http:// or https://";
$(element).notify(advice,{"position":"top","className":"error","autoHide":false,"clickToHide":false})}else{var tabChild=element[0]["parentNode"]["children"];var elToDelete=-1;for(var i=0;i<tabChild.length;i++)if(tabChild[i]["className"]==="notifyjs-wrapper")elToDelete=i;if(elToDelete>-1)$(tabChild[elToDelete]).remove()}},1)});break;case "integer":if(typeof scope["field"]["min"]!=="undefined")element[0].setAttribute("min",scope["field"]["min"]);if(typeof scope["field"]["max"]!=="undefined")element[0].setAttribute("max",
scope["field"]["max"]);scope["$parent"]["valid"]=true;scope["numberUpdate"]=function(){var val=scope["oFormValues"][scope["sFormDefinitionName"]][element[0].name];if(goog.isDef(val)&&(typeof val==="string"||typeof val==="number"))if(typeof val==="string"){var tmp=scope["ctrl"]["numberParser"](val,true);if(!isNaN(tmp))scope["oFormValues"][scope["sFormDefinitionName"]][element[0].name]=tmp;else scope["oFormValues"][scope["sFormDefinitionName"]][element[0].name]=""}else scope["oFormValues"][scope["sFormDefinitionName"]][element[0].name]=
val;else console.error("bad type argument")};$timeout(function(){scope["oFormValues"][scope["sFormDefinitionName"]][element[0].name]+=" ";scope["numberUpdate"]()},500);break;case "float":case "number":if(typeof scope["field"]["min"]!=="undefined")element[0].setAttribute("min",scope["field"]["min"]);if(typeof scope["field"]["max"]!=="undefined")element[0].setAttribute("max",scope["field"]["max"]);scope["$parent"]["valid"]=true;scope["numberUpdate"]=function(){var val=scope["oFormValues"][scope["sFormDefinitionName"]][element[0].name];
if(goog.isDef(val)&&(typeof val==="string"||typeof val==="number"))if(typeof val==="string"){var tmp=scope["ctrl"]["numberParser"](val,false);if(!isNaN(tmp)||typeof tmp==="string")scope["oFormValues"][scope["sFormDefinitionName"]][element[0].name]=tmp;else scope["oFormValues"][scope["sFormDefinitionName"]][element[0].name]=""}else scope["oFormValues"][scope["sFormDefinitionName"]][element[0].name]=val;else console.error("bad type argument")};$timeout(function(){scope["oFormValues"][scope["sFormDefinitionName"]][element[0].name]+=
" ";scope["numberUpdate"]()},500);break;case "image":case "imageurl":case "image_wsdata":if(goog.isDefAndNotNull(scope["field"])){if(goog.isDefAndNotNull(scope["field"]["width"]))if(scope["field"]["width"]==0||scope["field"]["width"]=="0px")scope["field"]["width"]=null;if(goog.isDefAndNotNull(scope["field"]["style"]))if(goog.isDefAndNotNull(scope["field"]["style"]["height"]))if(scope["field"]["style"]["height"]==0||scope["field"]["style"]["height"]=="0px")scope["field"]["style"]["height"]=null}break;
case "image":var options={"inline":false,"button":true,"navbar":false,"title":2,"toolbar":2,"tooltip":true,"fullscreen":false,"url":function(){return scope["oProperties"]["web_server_name"]+"/"+scope["oProperties"][scope["field"]["alias"]]+"/"+scope["field"]["folder"]+"/"+scope["oFormValues"][scope["sFormDefinitionName"]][scope["field"]["name"]]}};scope["viewer"]=new Viewer(element[0],options);scope["openViewer"]=function(){$log.log("openViewer");scope["viewer"].show();angular.element(".viewer-prev").remove();
angular.element(".viewer-next").remove()};break;case "imageurl":var options={"inline":false,"button":true,"navbar":false,"title":2,"toolbar":2,"tooltip":true,"fullscreen":false,"url":function(){return scope["oFormValues"][scope["sFormDefinitionName"]][scope["field"]["name"]]}};scope["viewer"]=new Viewer(element[0],options);scope["openViewer"]=function(){$log.log("openViewer");scope["viewer"].show();angular.element(".viewer-prev").remove();angular.element(".viewer-next").remove()};break;case "select":case "editable_select":var oField=
scope["field"];var oValue=scope["oFormValues"][scope["sFormDefinitionName"]][scope["field"]["name"]];if(typeof oField["multiple"]!=="undefined"&&oField["multiple"]===true)element[0].setAttribute("multiple","");if(typeof oField["size"]!=="undefined"){element[0].setAttribute("size",oField["size"]);element[0].style.height="auto"}if(goog.isString(oField["options"])){var tmp=oField["options"].split(",");var tmp2;for(var i=0;i<tmp.length;i++){tmp2=tmp[i].split("|");tmp[i]={"label":tmp2[0],"value":tmp2[1]}}scope["oFormValues"][scope["sFormDefinitionName"]][oField["name"]]["options"]=
tmp}if(typeof scope["field"]["child_select"]!="undefined")element[0].addEventListener("change",function(){scope["reloadSelectField"](scope["field"],scope["sFormDefinitionName"])},false);if(goog.isDefAndNotNull(oField["onchange"]))element[0].addEventListener("change",function(){if(formReaderService["isFunctionCall"](oField["onchange"]))if(goog.isString(oField["onchange"]))formReaderService["callFunction"](oField["onchange"]);else if(goog.isFunction(oField["onchange"]))oField["onchange"](scope["oFormValues"])},
false);break;case "map_bing":case "map_osm":case "map_vmap":var initMap=function(){if(goog.isDef(scope["oMap"])){scope["oMap"].MapObject.setTarget(null);delete scope["oMap"]}scope["oMap"]=new nsVitisComponent.Map({"target":element[0],"options":scope["field"]["map_options"],"hiddenFieldId":scope["field"]["id"],"oFormValues":scope["oFormValues"][scope["sFormDefinitionName"]],"sFormName":scope["field"]["name"],"oProj":scope.$root["proj"]});if(typeof scope["field"]["style"]!="undefined")if(typeof scope["field"]["style"]["height"]!=
"undefined"&&scope["field"]["style"]["height"]=="ratio"){var ratio=window.innerWidth/window.innerHeight;scope["field"]["style"]["height"]=parseInt(element[0].clientWidth/ratio)+"px"}scope.$root.$emit("OpenLayersMapCreated",scope["oMap"]);scope["oMap"].on("moveend",function(){scope["field"]["map_options"]["center"]=scope["oMap"]["getConfig"]();scope.$apply()},scope["oMap"])};setTimeout(function(){initMap();scope.$watch("field.nb_cols",function(value,old){$timeout(function(){scope["oMap"].MapObject.updateSize()})});
scope.$watch("field.style",function(value,old){$timeout(function(){scope["oMap"].MapObject.updateSize()})},true);scope.$watch("oMap.bLayersTreeOpen",function(value,old){$timeout(function(){scope["oMap"].MapObject.updateSize()})},true);scope.$on("studio resized",function(){scope["oMap"].MapObject.updateSize()});scope.$on("updateMap",function(event,data){switch(data){case "center":scope["oMap"]["setCenter"]([scope["field"]["map_options"]["center"]["coord"][0],scope["field"]["map_options"]["center"]["coord"][1]]);
break;case "zoom":scope["oMap"]["setZoom"](scope["field"]["map_options"]["center"]["zoom"]);break;case "source":scope["oMap"]["setBingSource"](scope["field"]["map_options"]["source"]);break;case "extent":scope["oMap"]["setExtent"](scope["field"]["map_options"]["center"]["extent"]);break;case "controls":scope["oMap"]["setControls"](scope["field"]["map_options"]["controls"]);break;case "interact":scope["oMap"]["setInteractions"](scope["field"]["map_options"]["interactions"]);break;case "proj":var extent=
scope["oMap"]["getExtent"]();var center=scope["oMap"]["getCenter"]();var proj=scope["oMap"]["getProj"]();scope["field"]["map_options"]["center"]["extent"]=scope["oMap"]["transformExtent"](extent,proj,scope["field"]["map_options"]["proj"]);scope["field"]["map_options"]["center"]["coord"]=scope["oMap"]["transformer"](center,proj,scope["field"]["map_options"]["proj"]);initMap();break;default:initMap();break}})});break;case "slider":scope["field"]["options"]["id"]=scope["field"]["id"]+"_slider";var mySlider=
$(element)["slider"](scope["field"]["options"]);if(!goog.isDefAndNotNull(scope["oFormValues"][scope["sFormDefinitionName"]][scope["field"]["name"]]))scope["oFormValues"][scope["sFormDefinitionName"]][scope["field"]["name"]]=0;$(element).on("slide",function(){scope["oFormValues"][scope["sFormDefinitionName"]][scope["field"]["name"]]=$(element)["slider"]("getValue")});scope.$watch("oFormValues."+scope["sFormDefinitionName"]+'["'+scope["field"]["name"]+'"]',function(){setTimeout(function(){if(goog.isDefAndNotNull($(element)))if(goog.isDefAndNotNull(scope["oFormValues"]))if(goog.isDefAndNotNull(scope["oFormValues"][scope["sFormDefinitionName"]]))if(goog.isDefAndNotNull(scope["oFormValues"][scope["sFormDefinitionName"]][scope["field"]["name"]]))$(element)["slider"]("setValue",
parseFloat(scope["oFormValues"][scope["sFormDefinitionName"]][scope["field"]["name"]]))},10)});scope.$watch("field.options",function(){setTimeout(function(){mySlider=$(element)["slider"](scope["field"]["options"])},10)},true);break;case "color_picker":$(element)["colorpicker"]({format:"rgba"});$(element).on("changeColor",function(){scope["oFormValues"][scope["sFormDefinitionName"]][scope["field"]["name"]]=$(element)["colorpicker"]("getValue")});scope.$watch("oFormValues."+scope["sFormDefinitionName"]+
'["'+scope["field"]["name"]+'"]',function(){setTimeout(function(){if(goog.isDefAndNotNull($(element)))if(goog.isDefAndNotNull(scope["oFormValues"]))if(goog.isDefAndNotNull(scope["oFormValues"][scope["sFormDefinitionName"]]))if(goog.isDefAndNotNull(scope["oFormValues"][scope["sFormDefinitionName"]][scope["field"]["name"]]))$(element)["colorpicker"]("setValue",scope["oFormValues"][scope["sFormDefinitionName"]][scope["field"]["name"]])},10)});break;case "double_select":var ilineHeight=parseInt($(element).css("line-height"))-
1;if(typeof scope["field"]["size"]!=="undefined")element[0].style.minHeight=ilineHeight*scope["field"]["size"]+"px";break;case "password":if(typeof scope["field"]["autocomplete"]==="undefined"||scope["field"]["autocomplete"]===false){element[0].readOnly=true;var clearListener=scope.$root.$on("endFormNgRepeat",function(event){$timeout(function(){element[0].readOnly=false},300);clearListener()})}break}if(typeof scope["field"]["read_only"]!="undefined"&&scope["field"]["read_only"]==true)element[0].readOnly=
true}}};formReader.module.directive("appFormFieldSpecificParams",formReader.appFormFieldSpecificParamsDrtv);
formReader.appFormRowNgRepeatDrtv=function($timeout,$rootScope,envSrvc,$log){return{link:function(scope,element,attrs){$log.log("formReader.appFormRowNgRepeatDrtv.link");if(typeof scope["row"]["tab"]!="undefined"){var bFirstTab=false;var sTabContainerId=scope["sFormDefinitionName"]+"_"+scope["row"]["tab"]["parent"]+"_tab_container";if(document.getElementById(sTabContainerId)==null){var oDiv=document.createElement("div");oDiv.className="tab-content";oDiv.id=sTabContainerId;element[0].parentNode.insertBefore(oDiv,
element[0]);bFirstTab=true}document.getElementById(sTabContainerId).appendChild(element[0]);element[0].id=scope["sFormDefinitionName"]+"_"+scope["row"]["tab"]["name"]+"_tab";element[0].setAttribute("role","tabpanel");$timeout(function(){element[0].className+=" tab-pane fade";if(bFirstTab)element[0].className+=" in active"})}$timeout(function(){if(scope["$last"])$rootScope.$emit("endFormNgRepeat",envSrvc["oSelectedObject"]["name"])})}}};formReader.module.directive("appFormRowNgRepeat",formReader.appFormRowNgRepeatDrtv);
formReader.appFormFieldNgRepeatDrtv=function($translate,$timeout,formReaderService,propertiesSrvc,externFunctionSrvc,$log){return{link:function(scope,element,attrs){if(typeof scope["field"]["default_value"]=="string")if(/^[A-Z0-9_]+$/.test(scope["field"]["default_value"]))$translate([scope["field"]["default_value"]]).then(function(translations){if(scope["oFormValues"][scope["sFormDefinitionName"]][scope["field"]["name"]]==scope["field"]["default_value"])scope["oFormValues"][scope["sFormDefinitionName"]][scope["field"]["name"]]=
translations[scope["field"]["default_value"]]});if(typeof scope["field"]["name"]!="undefined"&&scope["field"]["name"].indexOf(".")!=-1)scope["oFormValues"][scope["sFormDefinitionName"]][scope["field"]["name"]]=formReaderService["getFormValueFromObject"](scope["oFormValues"][scope["sFormDefinitionName"]],scope["field"]["name"]);if(typeof scope["field"]["visible"]!=="undefined")if(formReaderService["isFunctionCall"](scope["field"]["visible"]))scope["field"]["visible"]=scope.$eval(scope["field"]["visible"]);
if(scope["field"]["type"]==="editable_double_select")var clearListener=scope.$root.$on("webServiceTagsloaded",function(event,oFormElementDefinition){$timeout(function(){var oOptions={};if(typeof oFormElementDefinition["options"]!=="undefined")oOptions=oFormElementDefinition["options"];$("#"+oFormElementDefinition["id"])["tagsinput"](oOptions);$("#"+oFormElementDefinition["id_available_tags"])["tagsinput"](oOptions);$("#"+oFormElementDefinition["id"]).on("itemRemoved itemAdded",function(event){if(event["type"]==
"itemRemoved"){$("#"+oFormElementDefinition["id_available_tags"])["tagsinput"]("add",event["item"]);scope.$root["setTagsInput"]([oFormElementDefinition["id_available_tags"]])}else scope.$root["setTagsInput"]([oFormElementDefinition["id"]])});$("#"+oFormElementDefinition["id_available_tags"]).on("itemRemoved itemAdded",function(event){if(event["type"]=="itemRemoved"){$("#"+oFormElementDefinition["id"])["tagsinput"]("add",event["item"]);scope.$root["setTagsInput"]([oFormElementDefinition["id"]])}else scope.$root["setTagsInput"]([oFormElementDefinition["id_available_tags"]])});
scope.$root["setTagsInput"]([oFormElementDefinition["id_available_tags"],oFormElementDefinition["id"]])});clearListener()});else if(scope["field"]["type"]=="ui_grid"||scope["field"]["type"]=="bo_grid"||scope["field"]["type"]=="section_grid"){if(!goog.isDefAndNotNull(scope["field"]["options"]))scope["field"]["options"]={"enableRowSelection":true,"enableSelectAll":true,"enablePagination":false,"enablePaginationControls":false,"enableColumnMenus":false,"enableColumnResizing":false,"appHeader":true,"appHeaderTitleBar":true,
"columnDefs":[],"data":[]};scope["gridOptions"]=angular.copy(scope["field"]["options"]);var aColumnTitleTranslation=[];var aColumnDefs=angular.copy(scope["gridOptions"]["columnDefs"]);aColumnDefs.forEach(function(oColumnDef){aColumnTitleTranslation.push(oColumnDef["name"])});$translate(aColumnTitleTranslation).then(function(oTranslations){aColumnTitleTranslation.forEach(function(sTranslation,i){aColumnDefs[i]["name"]=oTranslations[sTranslation];aColumnDefs[i]["displayName"]=oTranslations[sTranslation]});
scope["gridOptions"]["columnDefs"]=angular.copy(aColumnDefs)});if(scope["gridOptions"]["appEnableDragAndDrop"]===true)scope["gridOptions"]["rowTemplate"]='<div grid="grid" class="ui-grid-draggable-row" draggable="true"><div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader, \'custom\': true }" ui-grid-cell></div></div>';scope["gridOptions"]["onRegisterApi"]=function(gridApi){scope.$root.$emit("registeredUiGridApi",
gridApi);scope["gridApi"]=gridApi;$timeout(function(){externFunctionSrvc["resizeWin"]();gridApi["core"]["handleWindowResize"]()});scope["gridOptions"]["gridApi"]=gridApi;$timeout(function(){$(gridApi["grid"]["element"]).find(".ui-grid-render-container-body").on("click.selectRow",function(event){var oCell=event.target;if($(oCell).hasClass("ui-grid-cell")||$(oCell).hasClass("ui-grid-cell-contents")){var iRowIndex=$(element).find(".ui-grid-render-container-body .ui-grid-canvas").children().index($(oCell).parents(".ui-grid-row"));
$(element).find(".ui-grid-render-container-left .ui-grid-row").eq(iRowIndex).find(".ui-grid-selection-row-header-buttons").click()}})});if(typeof gridApi["dragndrop"]!=="undefined")if(scope["gridOptions"]["appEnableDragAndDrop"]===true){gridApi["dragndrop"]["setDragDisabled"]=false;gridApi["draggableRows"]["on"]["rowDragged"](scope,function(info,rowElement){});gridApi["draggableRows"]["on"]["rowFinishDrag"](scope,function(){if(typeof scope["gridOptions"]["appDragAndDropEvent"]!=="undefined"&&typeof scope["gridOptions"]["appDragAndDropEvent"]["rowFinishDrag"]!==
"undefined")if(goog.isFunction(scope.$root[scope["gridOptions"]["appDragAndDropEvent"]["rowFinishDrag"]]))scope.$root[scope["gridOptions"]["appDragAndDropEvent"]["rowFinishDrag"]]();else console.error(scope["gridOptions"]["appDragAndDropEvent"]["rowFinishDrag"]+" is not a function of scope.$root")});gridApi["draggableRows"]["on"]["rowEnterRow"](scope,function(info,rowElement){});gridApi["draggableRows"]["on"]["beforeRowMove"](scope,function(from,to,data){})}else gridApi["dragndrop"]["setDragDisabled"]=
true;element[0].querySelector(".ui-grid-render-container-body").style.height="100%";element[0].querySelector(".ui-grid-render-container-body .ui-grid-viewport").style.height="Calc(100% - 30px)"}}else if(scope["field"]["type"]=="codemirror"){if(typeof scope["field"]["codemirrorOptions"]!="undefined")scope["field"]["cm_options"]=scope["field"]["codemirrorOptions"];if(goog.isDefAndNotNull(scope["field"]["cm_options"]))scope["field"]["cm_options"]["onLoad"]=function(oEditor){if(typeof scope["oCodeMirrorEditor"]==
"undefined")scope["oCodeMirrorEditor"]={};scope["oCodeMirrorEditor"][oEditor["options"]["appName"]]=oEditor;if(typeof oEditor["options"]["appHeight"]!="undefined"){var iHeight=oEditor["options"]["appHeight"];if(typeof iHeight=="string")if(iHeight.indexOf("%")!=-1)iHeight=parseInt(window.innerHeight*parseInt(iHeight)/100);else if(!isNaN(iHeight))iHeight=parseInt(iHeight);if(typeof iHeight=="number")oEditor["setSize"](null,iHeight)}if(typeof scope["field"]["cm_options"]["appHints"]!="undefined")oEditor.on("keyup",
function(cm,event){if(event.key==scope["field"]["cm_options"]["appHints"]["key"]){var options={hint:function(){return{"from":oEditor["getDoc"]()["getCursor"](),"to":oEditor["getDoc"]()["getCursor"](),"list":scope["field"]["cm_options"]["appHints"]["hints"]}}};oEditor["showHint"](options)}})}}else if(scope["field"]["type"]=="codemirror"){if(typeof scope["field"]["codemirrorOptions"]!="undefined")scope["field"]["cm_options"]=scope["field"]["codemirrorOptions"];scope["field"]["cm_options"]["onLoad"]=
function(oEditor){if(typeof scope["oCodeMirrorEditor"]=="undefined")scope["oCodeMirrorEditor"]={};scope["oCodeMirrorEditor"][oEditor["options"]["appName"]]=oEditor;if(typeof oEditor["options"]["appHeight"]!="undefined"){var iHeight=oEditor["options"]["appHeight"];if(typeof iHeight=="string")if(iHeight.indexOf("%")!=-1)iHeight=parseInt(window.innerHeight*parseInt(iHeight)/100);else if(!isNaN(iHeight))iHeight=parseInt(iHeight);if(typeof iHeight=="number")oEditor["setSize"](null,iHeight)}if(typeof scope["field"]["cm_options"]["appHints"]!=
"undefined")oEditor.on("keyup",function(cm,event){if(event.key==scope["field"]["cm_options"]["appHints"]["key"]){var options={hint:function(){return{"from":oEditor["getDoc"]()["getCursor"](),"to":oEditor["getDoc"]()["getCursor"](),"list":scope["field"]["cm_options"]["appHints"]["hints"]}}};oEditor["showHint"](options)}})}}$timeout(function(){if(typeof scope["field"]["tooltip"]!=="undefined"&&scope["field"]["visible"]!==false){if(typeof scope["field"]["tooltip"]["trigger"]==="undefined")scope["field"]["tooltip"]["trigger"]=
"hover";var oTooltipElement=document.createElement("span");oTooltipElement.className="form-field-label-tooltip";var sTooltipElementId=scope["field"]["id"]+"_tooltip";oTooltipElement.id=sTooltipElementId;if(typeof scope["field"]["tooltip"]["thumbnail"]!="undefined"){var sFileName=scope["oFormValues"][scope["sFormDefinitionName"]][scope["field"]["tooltip"]["thumbnail"]];if(sFileName!=""&&sFileName!=null){var sImagePath=propertiesSrvc["web_server_name"]+"/"+propertiesSrvc["public_alias"]+"/"+propertiesSrvc["application"]+
"/"+sFileName;scope["field"]["tooltip"]["html"]=true;scope["field"]["tooltip"]["content"]='<img src="'+sImagePath+'" class="popover-thumbnail-img">';scope["field"]["tooltip"]["template"]='<div class="popover popover-thumbnail" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>';element[0].querySelector("label").appendChild(oTooltipElement);$(element).find("label .form-field-label-tooltip")["popover"](scope["field"]["tooltip"])}}else{element[0].querySelector("label").appendChild(oTooltipElement);
$translate([scope["field"]["tooltip"]["title"],scope["field"]["tooltip"]["content"]]).then(function(translations){scope["field"]["tooltip"]["title"]=translations[scope["field"]["tooltip"]["title"]];scope["field"]["tooltip"]["content"]=translations[scope["field"]["tooltip"]["content"]];$(element).find("label .form-field-label-tooltip")["popover"](scope["field"]["tooltip"]).on("inserted.bs.popover",function(){if(typeof scope["field"]["tooltip"]["width"]!=="undefined")element[0].querySelector(".popover").style.width=
scope["field"]["tooltip"]["width"]})})}}if(typeof scope["field"]["autocomplete"]!="undefined")if(scope["field"]["autocomplete"])element[0].querySelector("[name='"+scope["field"]["name"]+"']").setAttribute("autocomplete","on");else element[0].querySelector("[name='"+scope["field"]["name"]+"']").setAttribute("autocomplete","off")});if(scope["field"]["type"]=="tinymce")if(propertiesSrvc["language"]!="en")scope["field"]["tinymceOptions"]["language"]=propertiesSrvc["language"]+"_"+propertiesSrvc["language"].toUpperCase()}}};
formReader.module.directive("appFormFieldNgRepeat",formReader.appFormFieldNgRepeatDrtv);formReader.appButtonDrtv=function($translate,$log){return{link:function(scope,element,attrs){$log.log("formReader.appButtonDrtv.link");if(typeof scope["button"]["tooltip"]!=="undefined")$translate([scope["button"]["tooltip"]["title"]]).then(function(translations){scope["button"]["tooltip"]["title"]=translations[scope["button"]["tooltip"]["title"]];$(element).tooltip(scope["button"]["tooltip"])})}}};
formReader.module.directive("appButton",formReader.appButtonDrtv);
formReader.appSubformGridDrtv=function($timeout,$translate,propertiesSrvc,formReaderService,$log){return{link:function(scope,element,attrs){$log.log("formReader.appSubformGridDrtv.link");var oMainScope=angular.element("#formreader_"+scope["sFormUniqueName"]+"_grid_subform_modal").scope();var formContainer=element.closest("form").parent();scope["initBoSubformGrid"]=function(){$log.log("formReader.appSubformGridDrtv.initBoSubformGrid");var sBusinessObject=scope["field"]["bo_id"];var sModalId="formreader_"+
scope["sFormUniqueName"]+"_grid_subform_modal";var oSearchValues={};var oInsertValues={};var sFilterAttr=scope["field"]["bo_filter_attr"];var sFilterValue=scope["field"]["form_filter_value"];var envSrvc=angular.element(vitisApp.appMainDrtv).injector().get(["envSrvc"]);var formSrvc=angular.element(vitisApp.appMainDrtv).injector().get(["formSrvc"]);var sSubformId="formreader_"+scope["sFormUniqueName"]+"_grid_subform";var oSubformScope=angular.element("#"+sSubformId).scope();var bIsIntersected=false;
oMainScope["closeModal"]=function(identifier){$(identifier).modal("hide")};$("#"+sModalId).on("hidden.bs.modal",function(event){setTimeout(function(){envSrvc["oFormValues"]=oMainScope["oFormValues"];envSrvc["oFormDefinition"]=oMainScope["oFormDefinition"];envSrvc["sFormDefinitionName"]=oMainScope["sFormDefinitionName"]})});scope["haveInsertRights"]=false;scope["haveDeleteRights"]=false;scope["oListWebService"]={"dataType":"businessObject","ressource_id":"vmap/querys/"+sBusinessObject+"/list","parameters":{"filter":""}};
formReaderService["getBusinessObjectDef"](sBusinessObject).then(function(oBusinessObject){if(!goog.isDefAndNotNull(oBusinessObject["business_object_id"])){console.error("error while loading business object ("+sBusinessObject+")");return 0}if(goog.isDefAndNotNull(sFilterAttr)&&sFilterAttr!=="")if(goog.isDefAndNotNull(sFilterValue)&&sFilterValue!=="")if(goog.isDefAndNotNull(oMainScope["oFormValues"]))if(goog.isDefAndNotNull(oMainScope["oFormValues"][oMainScope["sFormDefinitionName"]]))if(goog.isDefAndNotNull(oMainScope["oFormValues"][oMainScope["sFormDefinitionName"]][sFilterValue])){bIsIntersected=
true;oSearchValues[sFilterAttr]=oMainScope["oFormValues"][oMainScope["sFormDefinitionName"]][sFilterValue];oInsertValues[sFilterAttr]=oMainScope["oFormValues"][oMainScope["sFormDefinitionName"]][sFilterValue]}var sFilter=formReaderService["parseFilter"](oSearchValues);scope["oListWebService"]["parameters"]["filter"]=sFilter;scope["oListWebService"]["parameters"]["limit"]=100;scope["addObject"]=function(){if(formContainer.attr("id")==="studio_form_reader"){$translate("NO_IN_STUDIO").then(function(translation){$.notify(translation,
"error")});return 0}var oSubformValues={"insert":angular.copy(oInsertValues)};var sModalId="formreader_"+scope["sFormUniqueName"]+"_grid_subform_modal";var oSubformDefinition=oBusinessObject["json_form"][0];var sSubformDefinitionName="insert";if(bIsIntersected)oSubformDefinition=formReaderService["disableFormElement"](oSubformDefinition,sFilterAttr,sSubformDefinitionName);oMainScope.$applyAsync(function(){oMainScope["grid_subform_title"]=oBusinessObject["title"];oMainScope["grid_subform_size"]=oBusinessObject["add_form_size"];
oMainScope["grid_subform_definition_name"]=sSubformDefinitionName});oSubformDefinition[sSubformDefinitionName]["name"]="formreader_"+scope["sFormUniqueName"]+"_grid_subform_form";oSubformDefinition["insert"]["event"]=function(oFormValuesResulted){formReaderService["insertBoElement"](sBusinessObject,oBusinessObject,oSubformDefinition,sSubformDefinitionName,oFormValuesResulted,function(){$("#"+sModalId).modal("hide");setTimeout(function(){formReaderService["getWebServiceData"](angular.copy(scope["oListWebService"])).then(function(oNewResult){setGridData(oNewResult)})});
$translate("LIST_ADD_OK").then(function(translation){$.notify(translation,"success")})})};formReaderService["showModalSubform"](sModalId,oSubformScope,oSubformDefinition,sSubformDefinitionName,oSubformValues)};scope["removeSelection"]=function(){if(formContainer.attr("id")==="studio_form_reader"){$translate("NO_IN_STUDIO").then(function(translation){$.notify(translation,"error")});return 0}var aIds=[];var rows=scope["gridApi"]["selection"]["getSelectedRows"]();if(rows.length>0)$translate("LIST_DELETE_CONFIRM").then(function(translation){bootbox.confirm(translation,
function(result){if(result===true){for(var i=0;i<rows.length;i++)aIds.push(rows[i]["bo_object_infos"]["bo_id_value"]);formReaderService["deleteBoElements"](sBusinessObject,aIds,function(){setTimeout(function(){formReaderService["getWebServiceData"](angular.copy(scope["oListWebService"])).then(function(oNewResult){setGridData(oNewResult)})});$translate("LIST_DELETE_OK").then(function(translation){$.notify(translation,"success")})})}})});else $translate("LIST_NO_ELEMENT_SELECTED").then(function(translation){$.notify(translation,
"warning")})};scope["showFilterFormModal"]=function(){if(formContainer.attr("id")==="studio_form_reader"){$translate("NO_IN_STUDIO").then(function(translation){$.notify(translation,"error")});return 0}var oFilterformScope=oSubformScope;var sFilterformDefinitionName="search";var oFilterformDefinition=oBusinessObject["json_form"][0];var oFilterformValues={"search":oSearchValues};if(bIsIntersected)oFilterformDefinition=formReaderService["disableFormElement"](oFilterformDefinition,sFilterAttr,sFilterformDefinitionName);
oFilterformDefinition[sFilterformDefinitionName]["name"]="formreader_"+scope["sFormUniqueName"]+"_grid_subform_form";oFilterformDefinition[sFilterformDefinitionName]["event"]=function(oFormValuesResulted){envSrvc["oFormValues"]=oFormValuesResulted;envSrvc["oFormDefinition"]=oFilterformDefinition;envSrvc["sFormDefinitionName"]=sFilterformDefinitionName;var oValues=formSrvc["getFormData"](sFilterformDefinitionName,true);var sFilter=formReaderService["parseFilter"](oValues);scope["oListWebService"]["parameters"]["filter"]=
sFilter;$("#"+sModalId).modal("hide");formReaderService["getWebServiceData"](angular.copy(scope["oListWebService"])).then(function(oNewResult){setGridData(oNewResult)});$translate("LIST_SEARCH_OK").then(function(translation){$.notify(translation,"success")})};oMainScope.$applyAsync(function(){oMainScope["grid_subform_title"]=oBusinessObject["title"];oMainScope["grid_subform_definition_name"]=sFilterformDefinitionName});oFilterformScope["loadSubForm"]({"sFormDefinitionName":sFilterformDefinitionName,
"oFormDefinition":oFilterformDefinition,"oFormValues":oFilterformValues,"oProperties":scope["oProperties"],"sToken":scope["sToken"]});$("#"+sModalId).modal("show")};var setGridData=function(aResult){var aList=[];for(var i=0;i<aResult.length;i++){aResult[i]["bo_list"]["bo_object_infos"]={"bo_id_value":aResult[i]["bo_id_value"],"bo_id_field":aResult[i]["bo_id_field"],"bo_type":aResult[i]["bo_type"]};aList.push(aResult[i]["bo_list"])}scope["gridOptions"]["data"]=aList};formReaderService["getWebServiceData"](angular.copy(scope["oListWebService"])).then(function(aResult){if(!goog.isDefAndNotNull(aResult))return null;
if(goog.isDefAndNotNull(aResult[0])){scope["gridOptions"]["columnDefs"]=[{"name":"","field":"actions","cellTemplate":"<app-ui-grid-action></app-ui-grid-action>","width":60,"enableSorting":false,"enableColumnMoving":false,"enableColumnResizing":false}];for(var i=0;i<aResult[0]["bo_list_attributs"].length;i++)scope["gridOptions"]["columnDefs"].push({"field":aResult[0]["bo_list_attributs"][i]});setGridData(aResult);if(aResult[0]["have_insert_rights"]==="true"||aResult[0]["have_update_rights"]===true)scope["haveInsertRights"]=
true;if(aResult[0]["have_delete_rights"]==="true"||aResult[0]["have_update_rights"]===true)scope["haveDeleteRights"]=true;if(aResult[0]["have_update_rights"]==="true"||aResult[0]["have_update_rights"]===true)scope["gridApi"]["grid"]["appScope"]["edit_column"]="edit";if(aResult[0]["have_card_rights"]==="true"||aResult[0]["have_card_rights"]===true)scope["gridApi"]["grid"]["appScope"]["show_column"]="show";scope["gridApi"]["grid"]["appScope"]["executeActionButtonEvent"]=function(oRow,sEvent){if(formContainer.attr("id")===
"studio_form_reader"){$translate("NO_IN_STUDIO").then(function(translation){$.notify(translation,"error")});return 0}var oElement=oRow["entity"];var oObject=oElement["bo_object_infos"];var sSubformDefinitionName=sEvent==="edit"?"update":sEvent==="show"?"display":"display";var oFormWebService={"dataType":"businessObject","ressource_id":"vmap/querys/"+sBusinessObject+"/form","parameters":{"filter":oObject["bo_id_field"]+"="+oObject["bo_id_value"]}};formReaderService["getWebServiceData"](oFormWebService).then(function(aResult){var oSubformDefinition=
aResult[0]["bo_json_form"];var oSubformValues={};var sModalId="formreader_"+scope["sFormUniqueName"]+"_grid_subform_modal";if(sSubformDefinitionName==="update")oSubformDefinition["update"]["event"]=function(oFormValuesResulted){formReaderService["updateBoElement"](sBusinessObject,oObject,oSubformDefinition,sSubformDefinitionName,oFormValuesResulted,function(){$("#"+sModalId).modal("hide");setTimeout(function(){formReaderService["getWebServiceData"](angular.copy(scope["oListWebService"])).then(function(oNewResult){setGridData(oNewResult)})});
$translate("LIST_EDIT_OK").then(function(translation){$.notify(translation,"success")})})};oSubformValues[sSubformDefinitionName]=aResult[0]["bo_form"];oSubformDefinition[sSubformDefinitionName]["name"]="formreader_"+scope["sFormUniqueName"]+"_grid_subform_form";if(bIsIntersected)oSubformDefinition=formReaderService["disableFormElement"](oSubformDefinition,sFilterAttr,sSubformDefinitionName);if(!goog.isDefAndNotNull(oObject)){console.error("oObject undefined");return 0}if(!goog.isDefAndNotNull(oSubformScope)){console.error("oSubformScope undefined");
return 0}if(!goog.isDefAndNotNull(oSubformDefinition)){console.error("oSubformDefinition undefined");return 0}if(!goog.isDefAndNotNull(sSubformDefinitionName)){console.error("sSubformDefinitionName undefined");return 0}if(!goog.isDefAndNotNull(oSubformValues)){console.error("oSubformValues undefined");return 0}oMainScope.$applyAsync(function(){oMainScope["grid_subform_title"]=aResult[0]["bo_title"];oMainScope["grid_subform_definition_name"]=sSubformDefinitionName;if(sSubformDefinitionName==="update")oMainScope["grid_subform_size"]=
oBusinessObject["edit_form_size"];if(sSubformDefinitionName==="display")oMainScope["grid_subform_size"]=oBusinessObject["display_form_size"]});formReaderService["showModalSubform"](sModalId,oSubformScope,oSubformDefinition,sSubformDefinitionName,oSubformValues)})};scope["gridApi"]["grid"]["refresh"]()}else setGridData([])})})};scope["initSectionSubformGrid"]=function(){$log.log("formReader.appSubformGridDrtv.initSectionSubformGrid");var sSection=scope["field"]["section_id"];var sSubformId="formreader_"+
scope["sFormUniqueName"]+"_grid_subform";var sModalId="formreader_"+scope["sFormUniqueName"]+"_grid_subform_modal";var envSrvc=angular.element(vitisApp.appMainDrtv).injector().get(["envSrvc"]);var formSrvc=angular.element(vitisApp.appMainDrtv).injector().get(["formSrvc"]);var oSubformScope=angular.element("#"+sSubformId).scope();var oSearchValues={};var oInsertValues={};var sFilterAttr=scope["field"]["section_filter_attr"];var sFilterValue=scope["field"]["form_filter_value"];var bIsIntersected=false;
scope["haveInsertRights"]=false;scope["haveDeleteRights"]=false;oMainScope["closeModal"]=function(identifier){$(identifier).modal("hide")};$("#"+sModalId).on("hidden.bs.modal",function(event){setTimeout(function(){envSrvc["oFormValues"]=oMainScope["oFormValues"];envSrvc["oFormDefinition"]=oMainScope["oFormDefinition"];envSrvc["sFormDefinitionName"]=oMainScope["sFormDefinitionName"]})});if(goog.isDefAndNotNull(sFilterAttr)&&sFilterAttr!=="")if(goog.isDefAndNotNull(sFilterValue)&&sFilterValue!=="")if(goog.isDefAndNotNull(oMainScope["oFormValues"]))if(goog.isDefAndNotNull(oMainScope["oFormValues"][oMainScope["sFormDefinitionName"]]))if(goog.isDefAndNotNull(oMainScope["oFormValues"][oMainScope["sFormDefinitionName"]][sFilterValue])){bIsIntersected=
true;oSearchValues[sFilterAttr]=oMainScope["oFormValues"][oMainScope["sFormDefinitionName"]][sFilterValue];oInsertValues[sFilterAttr]=oMainScope["oFormValues"][oMainScope["sFormDefinitionName"]][sFilterValue]}scope["addObject"]=function(){if(formContainer.attr("id")==="studio_form_reader"){$translate("NO_IN_STUDIO").then(function(translation){$.notify(translation,"error")});return 0}var oSubformValues={"insert":angular.copy(oInsertValues)};var oSubformDefinition=scope["oSubformDefinition"];var oSubformScope=
angular.element("#formreader_"+scope["sFormUniqueName"]+"_grid_subform").scope();var sSubformDefinitionName="insert";if(bIsIntersected)oSubformDefinition=formReaderService["disableFormElement"](oSubformDefinition,sFilterAttr,sSubformDefinitionName);oMainScope.$applyAsync(function(){oMainScope["grid_subform_title"]=scope["oRessourceTab"]["name"];oMainScope["grid_subform_definition_name"]=sSubformDefinitionName});oSubformDefinition[sSubformDefinitionName]["name"]="formreader_"+scope["sFormUniqueName"]+
"_grid_subform_form";if(goog.isDefAndNotNull(oSubformDefinition["insert"]["afterEvent"]))delete oSubformDefinition["insert"]["afterEvent"];oSubformDefinition["insert"]["event"]=function(oFormValuesResulted){formReaderService["insertSectionElement"](scope["oSection"]["ressource_id"],scope["sIdField"],scope["oSubformDefinition"],sSubformDefinitionName,oFormValuesResulted).then(function(){$("#"+sModalId).modal("hide");setTimeout(function(){formReaderService["getSectionRessourceData"](scope["oSection"]["ressource_id"]).then(function(oNewResult){scope["gridOptions"]["data"]=
oNewResult})});$translate("LIST_ADD_OK").then(function(translation){$.notify(translation,"success")})})};formReaderService["showModalSubform"](sModalId,oSubformScope,oSubformDefinition,sSubformDefinitionName,oSubformValues)};scope["removeSelection"]=function(){if(formContainer.attr("id")==="studio_form_reader"){$translate("NO_IN_STUDIO").then(function(translation){$.notify(translation,"error")});return 0}var aIds=[];var rows=scope["gridApi"]["selection"]["getSelectedRows"]();if(rows.length>0)$translate("LIST_DELETE_CONFIRM").then(function(translation){bootbox.confirm(translation,
function(result){if(result===true){for(var i=0;i<rows.length;i++)aIds.push(rows[i][scope["sIdField"]]);formReaderService["deleteSectionElements"](scope["oSection"]["ressource_id"],aIds).then(function(oResponse){setTimeout(function(){formReaderService["getSectionRessourceData"](scope["oSection"]["ressource_id"]).then(function(oNewResult){scope["gridOptions"]["data"]=oNewResult})});$translate("LIST_DELETE_OK").then(function(translation){$.notify(translation,"success")})})}})});else $translate("LIST_NO_ELEMENT_SELECTED").then(function(translation){$.notify(translation,
"warning")})};scope["showFilterFormModal"]=function(){if(formContainer.attr("id")==="studio_form_reader"){$translate("NO_IN_STUDIO").then(function(translation){$.notify(translation,"error")});return 0}var oFilterformScope=oSubformScope;var sFilterformDefinitionName="search";var oFilterformDefinition=scope["oSubformDefinition"];var oFilterformValues={"search":oSearchValues};if(bIsIntersected)oFilterformDefinition=formReaderService["disableFormElement"](oFilterformDefinition,sFilterAttr,sFilterformDefinitionName);
oFilterformDefinition[sFilterformDefinitionName]["name"]="formreader_"+scope["sFormUniqueName"]+"_grid_subform_form";oFilterformDefinition[sFilterformDefinitionName]["event"]=function(oFormValuesResulted){envSrvc["oFormValues"]=oFormValuesResulted;envSrvc["oFormDefinition"]=oFilterformDefinition;envSrvc["sFormDefinitionName"]=sFilterformDefinitionName;var oValues=formSrvc["getFormData"](sFilterformDefinitionName,true);var sFilter=formReaderService["parseFilter"](oValues);$("#"+sModalId).modal("hide");
formReaderService["getSectionRessourceData"](scope["oSection"]["ressource_id"],sFilter).then(function(oNewResult){scope["gridOptions"]["data"]=oNewResult});$translate("LIST_SEARCH_OK").then(function(translation){$.notify(translation,"success")})};oMainScope.$applyAsync(function(){oMainScope["grid_subform_title"]=scope["oRessourceTab"]["name"];oMainScope["grid_subform_definition_name"]=sFilterformDefinitionName});oFilterformScope["loadSubForm"]({"sFormDefinitionName":sFilterformDefinitionName,"oFormDefinition":oFilterformDefinition,
"oFormValues":oFilterformValues,"oProperties":scope["oProperties"],"sToken":scope["sToken"]});$("#"+sModalId).modal("show")};formReaderService["getSectionDef"](sSection).then(function(oSection){scope["oSection"]=oSection;formReaderService["getSectionRessourceTab"](scope["oSection"]["ressource_id"]).then(function(oRessourceTab){scope["oRessourceTab"]=oRessourceTab;formReaderService["getSectionRessourceData"](scope["oSection"]["ressource_id"]).then(function(aRessourceData){scope["aRessourceData"]=aRessourceData;
formReaderService["getSectionForm"](scope["oSection"],true).then(function(oSubformDefinition){scope["oSubformDefinition"]=oSubformDefinition;var aColumns,aActions,oTab;var sRessource=scope["oRessourceTab"]["ressource_id"].substr(scope["oRessourceTab"]["ressource_id"].lastIndexOf("/")+1);for(var i=0;i<scope["oRessourceTab"][sRessource].length;i++){if(goog.isDefAndNotNull(scope["oRessourceTab"][sRessource][i]["columns"]))aColumns=scope["oRessourceTab"][sRessource][i]["columns"];if(goog.isDefAndNotNull(scope["oRessourceTab"][sRessource][i]["actions"]))aActions=
scope["oRessourceTab"][sRessource][i]["actions"];if(goog.isDefAndNotNull(scope["oRessourceTab"][sRessource][i]["tabs"]))oTab=scope["oRessourceTab"][sRessource][i]["tabs"][0]}scope["sIdField"]=angular.copy(aColumns[0]["name"]);if(oTab["show_column"]==="showSectionForm")scope["gridApi"]["grid"]["appScope"]["show_column"]="show";if(oTab["edit_column"]==="editSectionForm")scope["gridApi"]["grid"]["appScope"]["edit_column"]="edit";scope["gridOptions"]["columnDefs"]=[{"name":"","field":"actions","cellTemplate":"<app-ui-grid-action></app-ui-grid-action>",
"width":60,"enableSorting":false,"enableColumnMoving":false,"enableColumnResizing":false}];if(goog.isDefAndNotNull(aColumns))goog.array.extend(scope["gridOptions"]["columnDefs"],aColumns);scope["gridOptions"]["data"]=angular.copy(scope["aRessourceData"]);for(var i=0;i<aActions.length;i++){if(aActions[i]["event"]==="AddSectionForm")scope["haveInsertRights"]=true;if(aActions[i]["event"]==="DeleteSelection")scope["haveDeleteRights"]=true}scope["gridApi"]["grid"]["appScope"]["executeActionButtonEvent"]=
function(oRow,sEvent){if(formContainer.attr("id")==="studio_form_reader"){$translate("NO_IN_STUDIO").then(function(translation){$.notify(translation,"error")});return 0}var sSubformDefinitionName=sEvent==="edit"?"update":sEvent==="show"?"display":"display";var oSubformValues={};oSubformValues[sSubformDefinitionName]=angular.copy(oRow["entity"]);scope["oSubformDefinition"][sSubformDefinitionName]["name"]="formreader_"+scope["sFormUniqueName"]+"_grid_subform_form";if(sSubformDefinitionName==="update")scope["oSubformDefinition"]["update"]["event"]=
function(oFormValuesResulted){formReaderService["updateSectionElement"](scope["oSection"]["ressource_id"],scope["sIdField"],scope["oSubformDefinition"],sSubformDefinitionName,oFormValuesResulted).then(function(){$("#"+sModalId).modal("hide");setTimeout(function(){formReaderService["getSectionRessourceData"](scope["oSection"]["ressource_id"]).then(function(oNewResult){scope["gridOptions"]["data"]=oNewResult})});$translate("LIST_EDIT_OK").then(function(translation){$.notify(translation,"success")})})};
if(bIsIntersected)scope["oSubformDefinition"]=formReaderService["disableFormElement"](scope["oSubformDefinition"],sFilterAttr,sSubformDefinitionName);if(!goog.isDefAndNotNull(oSubformScope)){console.error("oSubformScope undefined");return 0}if(!goog.isDefAndNotNull(scope["oSubformDefinition"])){console.error("scope.oSubformDefinition undefined");return 0}if(!goog.isDefAndNotNull(sSubformDefinitionName)){console.error("sSubformDefinitionName undefined");return 0}if(!goog.isDefAndNotNull(oSubformValues)){console.error("oSubformValues undefined");
return 0}oMainScope.$applyAsync(function(){oMainScope["grid_subform_title"]=scope["oRessourceTab"]["name"];oMainScope["grid_subform_definition_name"]=sSubformDefinitionName});formReaderService["showModalSubform"](sModalId,oSubformScope,scope["oSubformDefinition"],sSubformDefinitionName,oSubformValues)};scope["gridApi"]["grid"]["refresh"]()})})})})};scope["initSubformGrid"]=function(){$log.log("initSubformGrid");if(scope["field"]["type"]==="bo_grid")scope["initBoSubformGrid"]();else if(scope["field"]["type"]===
"section_grid")scope["initSectionSubformGrid"]()};if(!goog.isDefAndNotNull(oMainScope["initSubformGridEvent_counter"]))oMainScope["initSubformGridEvent_counter"]=0;if(goog.isDefAndNotNull(oMainScope["initSubformGridEvent"])){oMainScope["initSubformGridEvent_"+scope["field"]["name"]]();oMainScope["initSubformGridEvent_"+scope["field"]["name"]]=null}oMainScope["initSubformGridEvent_"+scope["field"]["name"]]=oMainScope.$on("extractFormDefinitionInfos",function(){oMainScope["initSubformGridEvent_counter"]++;
var tmp=angular.copy(oMainScope["initSubformGridEvent_counter"]);setTimeout(function(){if(tmp===oMainScope["initSubformGridEvent_counter"])scope["initSubformGrid"]()},500)})}}};formReader.module.directive("appSubformGrid",formReader.appSubformGridDrtv);
formReader.appSubformDrtv=function($compile,$log){return{link:function(scope,element,attrs){$log.log("formReader.appSubformDrtv.link");var content;var template="<div app-form-reader ";template+='app-properties="oProperties"';template+='app-token="sToken"></div>';scope["loadSubForm"]=function(opt_options){$log.log("formReader.loadSubForm");if(!goog.isDefAndNotNull(opt_options["sFormDefinitionName"])){console.error("opt_options['sFormDefinitionName'] undefined");return 0}if(!goog.isDefAndNotNull(opt_options["oFormDefinition"])){console.error("opt_options['oFormDefinition'] undefined");
return 0}if(!goog.isDefAndNotNull(opt_options["oFormValues"])){console.error("opt_options['oFormValues'] undefined");return 0}if(!goog.isDefAndNotNull(opt_options["oProperties"])){console.error("opt_options['oProperties'] undefined");return 0}if(!goog.isDefAndNotNull(opt_options["sToken"])){console.error("opt_options['sToken'] undefined");return 0}scope.$applyAsync(function(){scope["oProperties"]=opt_options["oProperties"];scope["sToken"]=opt_options["sToken"];content=$compile(template)(scope);element.html("");
element.append(content);setTimeout(function(){var formReaderScope=angular.element($(element).find("[app-form-reader]").children()).scope();formReaderScope["ctrl"]["setDefinitionName"](opt_options["sFormDefinitionName"]);formReaderScope["ctrl"]["setFormValues"](opt_options["oFormValues"]);formReaderScope["ctrl"]["setFormDefinition"](opt_options["oFormDefinition"]);formReaderScope["ctrl"]["loadForm"]()})})}}}};formReader.module.directive("appSubform",formReader.appSubformDrtv);goog.provide("formReader.service.formReaderService");goog.require("formReader");
formReader.formReaderService=function($translate,$rootScope,$http,$q,$log,envSrvc){return{"reloadSelectField":function(oParentSelect,sFormDefinitionName,oFormValues,oFormDefinition){var oChildSelect=this["getFormElementDefinition"](oParentSelect["child_select"],sFormDefinitionName,oFormDefinition);if(goog.isDef(oChildSelect)){var oParams=oChildSelect["web_service"]["parameters"];if(!goog.isDef(oParams))oParams={"filter":{}};if(goog.isString(oParams["filter"]))oParams["filter"]={"stringFilter":oParams["filter"]};
if(!goog.isDef(oParams["filter"]))oParams["filter"]={};oParams["filter"][oParentSelect["name"]]=oFormValues[sFormDefinitionName][oParentSelect["name"]]["selectedOption"]["value"];oChildSelect["web_service"]["parameters"]=oParams;this["setWebServiceSelectOptions"](oChildSelect,sFormDefinitionName,oFormValues,oChildSelect["web_service"])}},"getFormElementDefinition":function(sFormElementName,sFormDefinitionName,oFormDefinition){var oFormDefinition=oFormDefinition[sFormDefinitionName];var i=0,j,k;while(i<
oFormDefinition["rows"].length){j=0;while(j<oFormDefinition["rows"][i]["fields"].length){if(oFormDefinition["rows"][i]["fields"][j]["name"]===sFormElementName)return oFormDefinition["rows"][i]["fields"][j];else if(typeof oFormDefinition["rows"][i]["fields"][j]["buttons"]!="undefined"){k=0;while(k<oFormDefinition["rows"][i]["fields"][j]["buttons"].length){if(oFormDefinition["rows"][i]["fields"][j]["buttons"][k]["name"]===sFormElementName)return oFormDefinition["rows"][i]["fields"][j]["buttons"][k];
k++}}j++}i++}},"getAllFormElementDefinition":function(sFormDefinitionName,oFormDefinition){var oFormDefinition=oFormDefinition[sFormDefinitionName];var oFormElementDefinition=[];var i=0,j;while(i<oFormDefinition["rows"].length){j=0;while(j<oFormDefinition["rows"][i]["fields"].length){oFormElementDefinition.push(oFormDefinition["rows"][i]["fields"][j]);j++}i++}return oFormElementDefinition},"setWebServiceSelectOptions":function(oFormElementDefinition,sFormDefinitionName,oFormValues,oWebService,oSelectedOption){var this_=
this;var sToken=this["sToken"];var oProperties=this["oProperties"];var oFormValues=oFormValues[sFormDefinitionName];var oParams={};var deferred=$q.defer();var promise=deferred.promise;$rootScope["oFormPromises"][sFormDefinitionName].push(promise);if(!goog.isDefAndNotNull(oFormElementDefinition)){console.error("oFormElementDefinition not defined");return 0}if(!goog.isDefAndNotNull(sFormDefinitionName)){console.error("sFormDefinitionName not defined");return 0}if(!goog.isDefAndNotNull(oFormValues)){console.error("oFormValues not defined");
return 0}if(!goog.isDefAndNotNull(oWebService)){console.error("oWebService not defined");return 0}if(!goog.isDef(oFormValues)){console.error("oFormValues["+sFormDefinitionName+"] not defined");oFormValues={}}this["getWebServiceData"](oWebService).then(function(aData){if(!goog.isDefAndNotNull(aData))return null;var j,oNotSelectedOptions,oSelectedOptions,sFromSelectName="",sToSelectName;var sLabelKey=oWebService["label_key"];var sValueKey=oWebService["id_key"];var aSelectedOptions=[];var selectedData=
oFormValues[oFormElementDefinition["name"]];if(goog.isNumber(selectedData))aSelectedOptions[0]=String(selectedData);else if(goog.isString(selectedData)&&selectedData!=="")aSelectedOptions=selectedData.split("|");j=0;oNotSelectedOptions={"selectedOption":[],"options":[]};oSelectedOptions={"selectedOption":[],"options":[]};if(oFormElementDefinition["type"]==="double_select"){sFromSelectName=oFormElementDefinition["name_from"];sToSelectName=oFormElementDefinition["name_to"]}else sToSelectName=oFormElementDefinition["name"];
while(j<aData.length){if(!goog.isDef(aData[j][sLabelKey])){console.error("result."+sLabelKey+" does not exist, check the label_key param on the JSON file");aData[j][sLabelKey]=null;j++;continue}if(!goog.isDef(aData[j][sValueKey])){console.error("result."+sValueKey+" does not exist, check the id_key param on the JSON file");aData[j][sValueKey]=null;j++;continue}if(aSelectedOptions.indexOf(String(aData[j][sValueKey]))!==-1||sFromSelectName==="")oSelectedOptions["options"].push({"label":aData[j][sLabelKey],
"value":aData[j][sValueKey]});else oNotSelectedOptions["options"].push({"label":aData[j][sLabelKey],"value":aData[j][sValueKey]});j++}if(sFromSelectName!=="")oFormValues[sFromSelectName]=oNotSelectedOptions;else{if(goog.isDefAndNotNull(oSelectedOption))oSelectedOptions["selectedOption"]=oSelectedOption;else{if(oFormElementDefinition["type"]==="select"||oFormElementDefinition["type"]==="editable_select"){var selectedOptionValue=angular.copy(oFormValues[oFormElementDefinition["name"]]);var selectedOptionLabel;
if(selectedOptionValue!==null&&goog.isObject(selectedOptionValue)){selectedOptionValue=selectedOptionValue["selectedOption"]["value"];selectedOptionLabel=oFormValues[oFormElementDefinition["name"]]["selectedOption"]["label"]}if(typeof selectedOptionValue==="undefined"&&typeof oFormElementDefinition["default_value"]!=="undefined"){selectedOptionValue=oFormElementDefinition["default_value"];if(goog.isString(selectedOptionValue))if(this_["isFunctionCall"](selectedOptionValue))selectedOptionValue=this_["callFunction"](selectedOptionValue)}selectedOptionValue=
goog.isDef(selectedOptionValue)?selectedOptionValue:null;selectedOptionLabel=goog.isDef(selectedOptionLabel)?selectedOptionLabel:"";oSelectedOptions["selectedOption"]={"value":selectedOptionValue,"label":selectedOptionLabel}}if(oFormElementDefinition["type"]==="list"){var selectedOptionValue=angular.copy(oFormValues[oFormElementDefinition["name"]]);if(goog.isDefAndNotNull(selectedOptionValue))if(goog.isArray(selectedOptionValue["selectedOption"]))selectedOptionValue=selectedOptionValue["selectedOption"];
if(goog.isDefAndNotNull(selectedOptionValue)&&typeof oFormElementDefinition["default_value"]!=="undefined"){selectedOptionValue=oFormElementDefinition["default_value"];if(goog.isString(selectedOptionValue))if(this_["isFunctionCall"](selectedOptionValue))selectedOptionValue=this_["callFunction"](selectedOptionValue)}if(goog.isArray(selectedOptionValue)&&selectedOptionValue.length>0)oSelectedOptions["selectedOption"]=selectedOptionValue;else{var aSelectedOptionValues=[];if(goog.isString(selectedOptionValue))aSelectedOptionValues=
selectedOptionValue.split("|");if(goog.isNumber(selectedOptionValue))aSelectedOptionValues=[selectedOptionValue];oSelectedOptions["selectedOption"]=[];for(var i=0;i<aSelectedOptionValues.length;i++)for(var ii=0;ii<oSelectedOptions["options"].length;ii++)if(oSelectedOptions["options"][ii]["value"]==aSelectedOptionValues[i]){if(goog.isNumber(oSelectedOptions["options"][ii]["value"])&&goog.isString(aSelectedOptionValues[i]))aSelectedOptionValues[i]=parseFloat(aSelectedOptionValues[i]);oSelectedOptions["selectedOption"].push({"value":aSelectedOptionValues[i],
"label":oSelectedOptions["options"][ii]["label"]})}}}}if(goog.isDefAndNotNull(oFormElementDefinition["options"])){var i=0,aOptions,aOptionsKeys=[],aOptionsValues=[];while(i<oFormElementDefinition["options"].length){aOptions=oFormElementDefinition["options"][i].split("|");aOptionsKeys.push(aOptions[0]);aOptionsValues.push(aOptions[1]);i++}$translate(aOptionsKeys).then(function(translations){var aTranslationsKeys=Object.keys(translations);i=0;while(i<aTranslationsKeys.length){oSelectedOptions["options"].unshift({"label":translations[aTranslationsKeys[i]],
"value":aOptionsValues[i]});i++}})}if(oFormElementDefinition["required"]!==true&&oFormElementDefinition["required"]!=="true"){var isEmptyValuePresent=false;for(var i=0;i<oSelectedOptions["options"].length;i++)if(oSelectedOptions["options"][i]["value"]==="")isEmptyValuePresent=true;if(!isEmptyValuePresent)oSelectedOptions["options"].unshift({"label":"","value":""})}}oFormValues[sToSelectName]=oSelectedOptions;if(oFormElementDefinition["type"]!=="editable_select"){var selectedIsInOption=false;for(var i=
0;i<oFormValues[sToSelectName]["options"].length;i++)if(oSelectedOptions["selectedOption"]["value"]===oFormValues[sToSelectName]["options"][i]["value"]){oSelectedOptions["selectedOption"]["label"]=oFormValues[sToSelectName]["options"][i]["label"];selectedIsInOption=true}if(!selectedIsInOption){delete oFormValues[sToSelectName]["selectedOption"]["value"];delete oFormValues[sToSelectName]["selectedOption"]["label"]}}if(!goog.isDefAndNotNull(oFormValues[sToSelectName]))oFormValues[sToSelectName]={};
if(!goog.isDefAndNotNull(oFormValues[sToSelectName]["selectedOption"]))oFormValues[sToSelectName]["selectedOption"]={};if(!goog.isDefAndNotNull(oFormValues[sToSelectName]["selectedOption"]["value"])){oFormValues[sToSelectName]["selectedOption"]["value"]="";oFormValues[sToSelectName]["selectedOption"]["label"]=""}if(oFormElementDefinition["type"]==="list")if(goog.isObject(oFormValues[sToSelectName]["selectedOption"])&&!goog.isArray(oFormValues[sToSelectName]["selectedOption"]))oFormValues[sToSelectName]["selectedOption"]=
[oFormValues[sToSelectName]["selectedOption"]];this["oFormValues"]=oFormValues;this["sFormDefinitionName"]=sFormDefinitionName;envSrvc["oFormDefaultValues"][sFormDefinitionName]=this_["copyFormValues"](oFormValues);if(typeof oWebService["callback"]!=="undefined")if(this_["isFunctionCall"](oWebService["callback"]))this_["callFunction"](oWebService["callback"]);$rootScope.$emit("webServiceSelectOptionsloaded");deferred.resolve()})},"getWebServiceData":function(oWebService){var sToken=this["sToken"];
var oProperties=this["oProperties"];var oWebService=oWebService;var oParams={};var deferred=$q.defer();if(!goog.isDefAndNotNull(oWebService)){console.error("oWebService not defined");return 0}if(goog.isDef(oWebService["parameters"])){oParams=oWebService["parameters"];if(oWebService["dataType"]==="businessObject")if(goog.isDefAndNotNull(oParams["attributs"]))delete oParams["attributs"];if(goog.isDef(oWebService["parameters"]["filter"])||goog.isDef(oWebService["parameters"]["filter_extension"])){if(goog.isObject(oWebService["parameters"]["filter"]))oWebService["parameters"]["filter"]=
this["parseFilter"](oWebService["parameters"]["filter"]);if(oWebService["parameters"]["filter"]==="")delete oWebService["parameters"]["filter"]}}oParams["token"]=sToken;$http({method:"POST",url:oProperties["web_server_name"]+"/"+oProperties["services_alias"]+"/"+oWebService["ressource_id"],headers:{"X-HTTP-Method-Override":"GET","Accept":"application/x-vm-json"},data:oParams}).then(function(response){if(goog.isDefAndNotNull(oWebService["parameters"]))oWebService["parameters"]["filter"]=oWebService["parameters"]["original_filter"];
var data=response["data"];data["data"]=goog.isDef(data["data"])?data["data"]:[];if(data["status"]===1){var aData;if(goog.isDefAndNotNull(oWebService["subObject"])){aData=[];for(var i=0;i<data["data"].length;i++)if(goog.isDefAndNotNull(data["data"][i][oWebService["subObject"]]))aData.push(data["data"][i][oWebService["subObject"]])}else aData=goog.isDef(data["data"])?data["data"]:[]}deferred.resolve(aData)});return deferred.promise},"emptySelectOptions":function(oFormElementDefinition,sFormDefinitionName,
oFormValues){var sFromSelectName,sToSelectName;if(oFormElementDefinition["type"]==="double_select"){sFromSelectName=oFormElementDefinition["name_from"];sToSelectName=oFormElementDefinition["name_to"]}else sToSelectName=oFormElementDefinition["name"];if(goog.isDefAndNotNull(oFormValues[sFormDefinitionName]))if(goog.isDefAndNotNull(oFormValues[sFormDefinitionName][sToSelectName]))if(goog.isDefAndNotNull(oFormValues[sFormDefinitionName][sToSelectName]["options"]))oFormValues[sFormDefinitionName][sToSelectName]=
"";this["oFormValues"]=oFormValues;if(goog.isDefAndNotNull(envSrvc["oFormDefaultValues"]))if(goog.isDefAndNotNull(envSrvc["oFormDefaultValues"][sFormDefinitionName]))envSrvc["oFormDefaultValues"][sFormDefinitionName]=this["copyFormValues"](oFormValues)},"callFunction":function(sFunction){if(!goog.isDefAndNotNull(sFunction)){console.error("callFunction: no function defined");return 0}if(!sFunction.length>0){console.error('callFunction: function === ""');return 0}var sParams="";var aParams=[];if(sFunction.indexOf("(")!==
-1){sParams=sFunction.substr(sFunction.indexOf("("));sParams=sParams.substr(1,sParams.length-2);if(sParams.length>0)aParams=sParams.split(",");for(var i=0;i<aParams.length;i++)if(goog.isString(aParams[i]))aParams[i]=aParams[i].trim()}for(var i=0;i<aParams.length;i++)if(this["isFunctionCall"](aParams[i]))aParams[i]="'"+this["callFunction"](aParams[i])+"'";if(aParams.length>0)sFunction=sFunction.replace(sParams,aParams.join(","));var sFunctionName=sFunction.substr(0,sFunction.indexOf("("));var returnMessage;
this["eventsContainer"]=this["oFormEventsContainer"];this["rootScope_"]=$rootScope;if(typeof eval("window."+sFunctionName)=="function")try{$log.log(sFunction);returnMessage=eval(sFunction)}catch(e){}else if(typeof this["eventsContainer"]!="undefined"&&typeof this["eventsContainer"][sFunctionName]=="function")try{$log.log("eventsContainer."+sFunction);returnMessage=eval("this.eventsContainer."+sFunction)}catch(e){}else if(typeof this[sFunctionName]=="function")try{$log.log("this."+sFunction);returnMessage=
eval("this."+sFunction)}catch(e){}else if(typeof this["rootScope_"]!="undefined"&&typeof this["rootScope_"][sFunctionName]=="function")try{$log.log("$rootScope."+sFunction);returnMessage=eval("this.rootScope_."+sFunction)}catch(e){}return returnMessage},"isFunctionCall":function(sString,bCheckFunction){if(typeof bCheckFunction=="undefined")bCheckFunction=true;var bReturn=false;if(typeof sString==="string"){aMatchResult=sString.match(/(.+)\((.*)\)/);if(aMatchResult!==null)if(bCheckFunction){var sFunctionName=
sString.substr(0,sString.indexOf("("));var returnMessage;if(typeof sFunctionName=="function")bReturn=true;else if(typeof this["oFormEventsContainer"]!="undefined"&&typeof this["oFormEventsContainer"][sFunctionName]=="function")bReturn=true;else if(typeof this[sFunctionName]=="function")bReturn=true;else if(typeof $rootScope[sFunctionName]=="function")bReturn=true;if(!bReturn)$log.warn("Function not found : "+sString)}else bReturn=true}return bReturn},"selectFirstOption":function(sFormElementName,
oFormValues,sFormDefinitionName){oFormValues=goog.isDef(oFormValues)?oFormValues:this["oFormValues"];sFormDefinitionName=goog.isDef(sFormDefinitionName)?sFormDefinitionName:this["sFormDefinitionName"];oFormValues=oFormValues[sFormDefinitionName];if(oFormValues[sFormElementName]["options"].length>0)oFormValues[sFormElementName]["selectedOption"]["value"]=oFormValues[sFormElementName]["options"][0]["value"]},"setSelectOptions":function(oFormElementDefinition,sFormDefinitionName,oFormValues,aOptions){$log.log("setSelectOptions");
var getFormatedOptions=function(aKeys,aValues){var aOptions=[];if(!goog.isArray(aKeys)){console.error("getFormatedOptions: aKeys is not an array",aKeys);return aOptions}if(!goog.isArray(aValues)){console.error("getFormatedOptions: aKeys is not an array",aValues);return aOptions}if(aKeys.length!==aValues.length){console.error("getFormatedOptions: aKeys.length !== aValues.length",aKeys,aValues);return aOptions}for(var i=0;i<aKeys.length;i++)aOptions.push({"label":aKeys[i],"value":aValues[i]});return aOptions};
var i=0,sLabel,sValue,aOption;var oSelectOptions={"selectedOption":{"value":""},"options":[]};var sSelectName,sFromSelectName,sToSelectName;aOptions=goog.isDef(aOptions)?aOptions:oFormElementDefinition["options"];var aOptionsKeys=[];var aOptionsValues=[];if(goog.isString(aOptions))aOptions=aOptions.split(",");while(i<aOptions.length){aOption=aOptions[i].split("|");sLabel=aOption[0];aOptionsKeys.push(sLabel);if(aOption.length>1)sValue=aOption[1];else sValue=sLabel;aOptionsValues.push(sValue);i++}var selectValue=
oFormValues[sFormDefinitionName][oFormElementDefinition["name"]];if(oFormElementDefinition["type"]==="list"&&goog.isString(selectValue)){var aSelectedValues=selectValue.split("|");if(aSelectedValues.length>0){var aSelectedOptions=[];for(var i=0;i<aSelectedValues.length;i++)aSelectedOptions.push({"label":"","value":aSelectedValues[i]});selectValue={"selectedOption":aSelectedOptions}}}if(typeof selectValue==="undefined"&&typeof oFormElementDefinition["default_value"]!=="undefined"){selectValue=oFormElementDefinition["default_value"];
if(typeof selectValue==="string")if(this["isFunctionCall"](selectValue))selectValue=this["callFunction"](selectValue)}if(goog.isDefAndNotNull(selectValue))if(goog.isDefAndNotNull(selectValue["selectedOption"])){if(goog.isDefAndNotNull(selectValue["selectedOption"]["value"]))oSelectOptions=selectValue;if(goog.isArray(selectValue["selectedOption"]))oSelectOptions=selectValue}else oSelectOptions["selectedOption"]["value"]=String(selectValue);$translate(aOptionsKeys).then(function(translations){for(var i=
0;i<aOptionsKeys.length;i++)aOptionsKeys[i]=translations[aOptionsKeys[i]];oSelectOptions["options"]=getFormatedOptions(aOptionsKeys,aOptionsValues);if(oFormElementDefinition["type"]==="double_select"){sFromSelectName=oFormElementDefinition["name_from"];sToSelectName=oFormElementDefinition["name_to"];var aFromOptionsKeys=angular.copy(aOptionsKeys);var aFromOptionsValues=angular.copy(aOptionsValues);var aToOptionsKeys=[];var aToOptionsValues=[];for(var i=aFromOptionsValues.length-1;i>=0;i--){aToOptionsValues.unshift(aFromOptionsValues[i]);
aToOptionsKeys.unshift(aFromOptionsKeys[i]);aFromOptionsValues.splice(i,1);aFromOptionsKeys.splice(i,1)}var oFromSelectOptions={"options":getFormatedOptions(aFromOptionsKeys,aFromOptionsValues)};var oToSelectOptions={"options":getFormatedOptions(aToOptionsKeys,aToOptionsValues)};oFormValues[sFormDefinitionName][sFromSelectName]=oFromSelectOptions;oFormValues[sFormDefinitionName][sToSelectName]=oToSelectOptions}else{sSelectName=oFormElementDefinition["name"];oFormValues[sFormDefinitionName][sSelectName]=
oSelectOptions}if(typeof envSrvc["oFormDefaultValues"][sFormDefinitionName]==="undefined")envSrvc["oFormDefaultValues"][sFormDefinitionName]={};if(typeof envSrvc["oFormDefaultValues"][sFormDefinitionName][sSelectName]=="undefined")envSrvc["oFormDefaultValues"][sFormDefinitionName][sSelectName]=angular.copy(oSelectOptions)})},"selectOptionAfterLoad":function(oFormValues,oFormElementDefinition,sFormDefinitionName,sFieldName,value){if(oFormElementDefinition["type"]==="double_select");else if(oFormElementDefinition["type"]===
"select"){var opt=oFormValues[sFormDefinitionName][sFieldName].options;for(var i=0;i<opt.length;i++)if(opt[i].value===value){oFormValues[sFormDefinitionName][sFieldName].selectedOption=opt[i];break}}else if(oFormElementDefinition["type"]==="list");else console.error("this element is not a select")},"extractWebServiceData":function(sController,oWebServiceData){var sKey=sController;var aData=[];if(typeof oWebServiceData[sKey]!=="undefined")if(Array.isArray(oWebServiceData[sKey])){if(oWebServiceData[sKey].length>
0)aData=oWebServiceData[sKey]}else aData=oWebServiceData[sKey];return aData},"parseFilter":function(filter){if(goog.isObject(filter)){var aFilters=[];var aFiltersKeys=Object.keys(filter),sFilterValue;var i=0;for(var i=0;i<aFiltersKeys.length;i++)if(aFiltersKeys[i]==="stringFilter")aFilters.push(filter[aFiltersKeys[i]]);else{sFilterValue=filter[aFiltersKeys[i]];if(sFilterValue!==""){if(this["isFunctionCall"](sFilterValue))sFilterValue=this["callFunction"](sFilterValue);if(typeof sFilterValue!="undefined")if(goog.isString(sFilterValue))if(sFilterValue.toLowerCase().indexOf("null")!=
-1)aFilters.push(aFiltersKeys[i]+" "+sFilterValue);else aFilters.push(aFiltersKeys[i]+"='"+sFilterValue+"'");else aFilters.push(aFiltersKeys[i]+"="+sFilterValue)}}if(aFilters.length>0)filter=aFilters.join(" AND ");else filter=""}return filter},"setWebServiceTags":function(oFormElementDefinition,sFormDefinitionName,oFormValues){var oWebService=angular.copy(oFormElementDefinition["web_service"]);var aRessourceId=oWebService["ressource_id"].split("/");var oFormValues=oFormValues[sFormDefinitionName],
selectedOptionValue;var oFormSrvc=this;var oParams={};if(typeof oWebService["parameters"]!=="undefined"){oParams=oWebService["parameters"];if(typeof oWebService["parameters"]["filter"]!=="undefined"){oWebService["parameters"]["filter"]=this["parseFilter"](oWebService["parameters"]["filter"]);if(oWebService["parameters"]["filter"]==="")delete oWebService["parameters"]["filter"]}}oParams["token"]=this["sToken"];$http({method:"POST",url:this["oProperties"]["web_server_name"]+"/"+this["oProperties"]["services_alias"]+
"/"+oWebService["ressource_id"],headers:{"X-HTTP-Method-Override":"GET"},data:oParams}).then(function(response){var data=response["data"];var j,oNotSelectedOptions,oSelectedOptions,sFromSelectName="",sToSelectName;if(data["status"]===1){var aData=oFormSrvc["extractWebServiceData"](aRessourceId[1],data);var aTags=[];if(typeof oFormValues[oFormElementDefinition["name"]]==="string")aTags=oFormValues[oFormElementDefinition["name"]].split(",");var sLabelKey=oWebService["label_key"];var sValueKey=oWebService["id_key"];
var i=0;var aAvailableTags=[];while(i<aData.length){if(aTags.indexOf(aData[i][sValueKey])===-1)aAvailableTags.push(aData[i][sValueKey]);i++}oFormValues[oFormElementDefinition[["name_available_tags"]]]=aAvailableTags.join(",");if(typeof envSrvc["oFormDefaultValues"][sFormDefinitionName][oFormElementDefinition[["name_available_tags"]]]=="undefined")envSrvc["oFormDefaultValues"][sFormDefinitionName][oFormElementDefinition[["name_available_tags"]]]=angular.copy(oFormValues[oFormElementDefinition[["name_available_tags"]]]);
$rootScope.$emit("webServiceTagsloaded",oFormElementDefinition)}})},"checkFormModifications":function(sFormDefinitionName){var deferred=$q.defer();var promise=deferred.promise;if((envSrvc["sMode"]=="insert"||envSrvc["sMode"]=="update")&&typeof sFormDefinitionName!="undefined"){var oFormDefinition=envSrvc["oFormDefinition"][sFormDefinitionName];if(typeof oFormDefinition!="undefined"&&typeof oFormDefinition["event"]!="undefined"){var sFormName=oFormDefinition["name"];var oFormElement=angular.element("form[name='"+
sFormName+"']");if(oFormElement.length>0){var formScope=oFormElement.scope();if(formScope[sFormName]["$dirty"]&&!formScope[sFormName]["$submitted"]){var oOptions={"className":"modal-warning","message":"FORM_MODIFIED_WARNING","callback":function(bResponse){if(bResponse)deferred.resolve()}};formScope.$root["modalWindow"]("confirm","FORM_MODIFIED_WARNING_TITLE",oOptions)}else deferred.resolve()}else deferred.resolve()}else deferred.resolve()}else deferred.resolve();return promise},"getFormValueFromObject":function(oFormValues,
sFormFieldName){$log.info("getFormValueFromObject");var sReturn=this["copyFormValues"](oFormValues);var aFormFieldName=sFormFieldName.split(".");aFormFieldName.forEach(function(sParameter){sReturn=sReturn[sParameter]});return sReturn},"copyFormValues":function(oFormValues){$log.info("copyFormValues");var oReturn={};try{oReturn=angular.copy(oFormValues)}catch(e){for(var key in oFormValues)try{oReturn[key]=angular.copy(oFormValues[key])}catch(e){if(goog.isObject(oFormValues[key])){oReturn[key]={};for(var key2 in oFormValues[key])try{oReturn[key][key2]=
angular.copy(oFormValues[key][key2])}catch(e){}}}}return oReturn},"getFormValue":function(sName){$log.info("getFormValue");if(!goog.isString(sName))return null;sName=sName.trim();var oFormValues=this["oFormValues"][this["sFormDefinitionName"]];var sValue=oFormValues[sName.trim()];if(goog.isDefAndNotNull(sValue["selectedOption"]))if(goog.isDefAndNotNull(sValue["selectedOption"]["value"]))sValue=sValue["selectedOption"]["value"];return sValue},"concat":function(){$log.info("concat");var sResult="";
for(var i=0;i<arguments.length;i++)if(goog.isString(arguments[i]))sResult+=arguments[i];return sResult},"getBusinessObjectDef":function(sBusinessObject){var sToken=this["sToken"];var oProperties=this["oProperties"];var deferred=$q.defer();$http({method:"GET",url:this["oProperties"]["web_server_name"]+"/"+this["oProperties"]["services_alias"]+"/vmap/businessobjects/"+sBusinessObject,params:{"token":sToken}}).then(function(response){if(!goog.isDef(response["data"])){$translate("NO_VALUES_RETURNED").then(function(sTranslation){bootbox.alert(sTranslation)});
return 0}if(!goog.isDef(response["data"]["data"])){$translate("NO_BUSINESS_OBJECT_FOUNDED").then(function(sTranslation){bootbox.alert(sTranslation)});return 0}if(!goog.isDef(response["data"]["data"][0])){$translate("NO_BUSINESS_OBJECT_FOUNDED").then(function(sTranslation){bootbox.alert(sTranslation)});return 0}if(!goog.isDef(response["data"]["data"][0]["business_object_id"])){$translate("NO_BUSINESS_OBJECT_FOUNDED").then(function(sTranslation){bootbox.alert(sTranslation)});return 0}if(goog.isDef(response["data"]["errorMessage"])){bootbox.alert(response["data"]["errorMessage"]);
return 0}deferred.resolve(response["data"]["data"][0])},function(response){console.error(response);bootbox.alert(response)});return deferred.promise},"showModalSubform":function(sModalId,oSubformScope,oSubformDefinition,oSubformDefinitionName,oSubformValues){var sToken=this["sToken"];var oProperties=this["oProperties"];if(goog.isDefAndNotNull(oSubformScope["loadSubForm"])){oSubformScope["loadSubForm"]({"sFormDefinitionName":oSubformDefinitionName,"oFormDefinition":oSubformDefinition,"oFormValues":oSubformValues,
"oProperties":oProperties,"sToken":sToken});$("#"+sModalId).modal("show")}},"updateBoElement":function(sBusinessObject,oObject,oSubformDefinition,sSubformDefinitionName,oFormValuesResulted,successCallback){var sToken=this["sToken"];var oProperties=this["oProperties"];var envSrvc=angular.element(vitisApp.appMainDrtv).injector().get(["envSrvc"]);var formSrvc=angular.element(vitisApp.appMainDrtv).injector().get(["formSrvc"]);var aParamsToSave=[oObject["bo_id_field"]];envSrvc["oFormValues"]=oFormValuesResulted;
envSrvc["oFormDefinition"]=oSubformDefinition;envSrvc["sFormDefinitionName"]=sSubformDefinitionName;var oValues=formSrvc["getFormData"](sSubformDefinitionName,true);for(var i=0;i<aParamsToSave.length;i++)if(goog.isDefAndNotNull(oFormValuesResulted[sSubformDefinitionName][aParamsToSave[i]]))oValues[aParamsToSave[i]]=oFormValuesResulted[sSubformDefinitionName][aParamsToSave[i]];var oFormData=new FormData;for(var key in oValues)if(goog.isDefAndNotNull(oValues[key]["aFiles"])){oFormData.append(key+"_attached_content",
oValues[key]["aFiles"][0]);oFormData.append(key,oValues[key]["aFiles"][0]["name"])}else oFormData.append(key,oValues[key]);$http({method:"PUT",url:this["oProperties"]["web_server_name"]+"/"+this["oProperties"]["services_alias"]+"/vmap/querys/"+sBusinessObject,data:oFormData,params:{"token":sToken}}).then(function(response){if(!goog.isDef(response["data"])){$translate("NO_VALUES_RETURNED").then(function(sTranslation){bootbox.alert(sTranslation)});return 0}if(goog.isDef(response["data"]["errorMessage"])){bootbox.alert(response["data"]["errorMessage"]);
return 0}if(goog.isDef(response["status"]))if(response["status"]===500){bootbox.alert(response["statusText"]);return 0}successCallback.call()},function(response){bootbox.alert(response);console.error(response)})},"insertBoElement":function(sBusinessObject,oBusinessObject,oSubformDefinition,sSubformDefinitionName,oFormValuesResulted,successCallback){var sToken=this["sToken"];var oProperties=this["oProperties"];var envSrvc=angular.element(vitisApp.appMainDrtv).injector().get(["envSrvc"]);var formSrvc=
angular.element(vitisApp.appMainDrtv).injector().get(["formSrvc"]);var aParamsToSave=[oBusinessObject["id_field"]];envSrvc["oFormValues"]=oFormValuesResulted;envSrvc["oFormDefinition"]=oSubformDefinition;envSrvc["sFormDefinitionName"]=sSubformDefinitionName;var oValues=formSrvc["getFormData"](sSubformDefinitionName,true);for(var i=0;i<aParamsToSave.length;i++)if(goog.isDefAndNotNull(oFormValuesResulted[sSubformDefinitionName][aParamsToSave[i]]))oValues[aParamsToSave[i]]=oFormValuesResulted[sSubformDefinitionName][aParamsToSave[i]];
var oFormData=new FormData;for(var key in oValues)if(goog.isDefAndNotNull(oValues[key]["aFiles"])){oFormData.append(key+"_attached_content",oValues[key]["aFiles"][0]);oFormData.append(key,oValues[key]["aFiles"][0]["name"])}else oFormData.append(key,oValues[key]);$http({method:"POST",url:this["oProperties"]["web_server_name"]+"/"+this["oProperties"]["services_alias"]+"/vmap/querys/"+sBusinessObject,data:oFormData,params:{"token":sToken}}).then(function(response){if(!goog.isDef(response["data"])){$translate("NO_VALUES_RETURNED").then(function(sTranslation){bootbox.alert(sTranslation)});
return 0}if(goog.isDef(response["data"]["errorMessage"])){bootbox.alert(response["data"]["errorMessage"]);return 0}if(goog.isDef(response["status"]))if(response["status"]===500){bootbox.alert(response["statusText"]);return 0}successCallback.call()},function(response){bootbox.alert(response);console.error(response)})},"deleteBoElements":function(sBusinessObject,aIds,successCallback){var sToken=this["sToken"];var oProperties=this["oProperties"];$http({method:"DELETE",url:this["oProperties"]["web_server_name"]+
"/"+this["oProperties"]["services_alias"]+"/vmap/querys/"+sBusinessObject,params:{"token":sToken,"idList":aIds.join("|")}}).then(function(response){if(!goog.isDef(response["data"])){$translate("NO_VALUES_RETURNED").then(function(sTranslation){bootbox.alert(sTranslation)});return 0}if(goog.isDef(response["data"]["errorMessage"])){bootbox.alert(response["data"]["errorMessage"]);return 0}if(goog.isDef(response["status"]))if(response["status"]===500){bootbox.alert(response["statusText"]);return 0}successCallback.call()},
function(response){bootbox.alert(response);console.error(response)})},"getSectionDef":function(sSection){var sToken=this["sToken"];var oProperties=this["oProperties"];var deferred=$q.defer();$http({method:"GET",url:this["oProperties"]["web_server_name"]+"/"+this["oProperties"]["services_alias"]+"/vitis/vitissections/"+sSection,params:{"token":sToken}}).then(function(response){if(!goog.isDef(response["data"])){$translate("NO_VALUES_RETURNED").then(function(sTranslation){bootbox.alert(sTranslation)});
return 0}if(!goog.isDef(response["data"]["data"])){$translate("NO_SECTION_FOUNDED").then(function(sTranslation){bootbox.alert(sTranslation)});return 0}if(!goog.isDef(response["data"]["data"][0])){$translate("NO_SECTION_FOUNDED").then(function(sTranslation){bootbox.alert(sTranslation)});return 0}if(!goog.isDef(response["data"]["data"][0]["ressource_id"])){$translate("NO_SECTION_FOUNDED").then(function(sTranslation){bootbox.alert(sTranslation)});return 0}if(goog.isDef(response["data"]["errorMessage"])){bootbox.alert(response["data"]["errorMessage"]);
return 0}deferred.resolve(response["data"]["data"][0])},function(response){bootbox.alert(response);console.error(response)});return deferred.promise},"getSectionRessourceTab":function(sRessourceId){var sToken=this["sToken"];var oProperties=this["oProperties"];var deferred=$q.defer();$http({method:"GET",url:this["oProperties"]["web_server_name"]+"/"+this["oProperties"]["services_alias"]+"/vitis/ressources/"+sRessourceId,headers:{"Accept":"application/json"},params:{"token":sToken}}).then(function(response){if(!goog.isDef(response["data"])){$translate("NO_VALUES_RETURNED").then(function(sTranslation){bootbox.alert(sTranslation)});
return 0}if(!goog.isDef(response["data"]["ressources"])){$translate("NO_VALUES_RETURNED").then(function(sTranslation){bootbox.alert(sTranslation)});return 0}if(!goog.isDef(response["data"]["ressources"][0])){$translate("NO_VALUES_RETURNED").then(function(sTranslation){bootbox.alert(sTranslation)});return 0}if(goog.isDef(response["data"]["errorMessage"])){bootbox.alert(response["data"]["errorMessage"]);return 0}deferred.resolve(response["data"]["ressources"][0])},function(response){bootbox.alert(response);
console.error(response)});return deferred.promise},"getSectionRessourceData":function(sRessourceId,sFilter){var sToken=this["sToken"];var oProperties=this["oProperties"];var deferred=$q.defer();var oParmams={"token":sToken,"limit":100};if(goog.isDefAndNotNull(sFilter)&&sFilter!=="")oParmams["filter"]=sFilter;$http({method:"GET",url:this["oProperties"]["web_server_name"]+"/"+this["oProperties"]["services_alias"]+"/"+sRessourceId,params:oParmams}).then(function(response){if(!goog.isDef(response["data"])){$translate("NO_VALUES_RETURNED").then(function(sTranslation){bootbox.alert(sTranslation)});
return 0}if(!goog.isDef(response["data"]["data"])){$translate("NO_VALUES_RETURNED").then(function(sTranslation){bootbox.alert(sTranslation)});return 0}if(!goog.isDef(response["data"]["data"][0])){$translate("NO_VALUES_RETURNED").then(function(sTranslation){bootbox.alert(sTranslation)});return 0}if(goog.isDef(response["data"]["errorMessage"])){bootbox.alert(response["data"]["errorMessage"]);return 0}deferred.resolve(response["data"]["data"])},function(response){bootbox.alert(response);console.error(response)});
return deferred.promise},"getSectionForm":function(oSection,bHideButtons){bHideButtons=goog.isDefAndNotNull(bHideButtons)?bHideButtons:false;var deferred=$q.defer();var sFileName;if(oSection["index"]>1)sFileName=oSection["mode_id"]+"_"+oSection["tab_name"]+"_"+oSection["name"]+".json";else sFileName=oSection["mode_id"]+"_"+oSection["tab_name"]+".json";$http({method:"GET",url:"modules/"+oSection["module_name"]+"/forms/"+oSection["mode_id"]+"/"+sFileName}).then(function(response){if(!goog.isDef(response["data"])){$translate("NO_FORM_FOUNDED").then(function(sTranslation){bootbox.alert(sTranslation)});
return 0}var oForm=response["data"];if(bHideButtons)for(var key in oForm)if(goog.isDefAndNotNull(oForm[key]))if(goog.isDefAndNotNull(oForm[key]["rows"]))for(var i=oForm[key]["rows"].length-1;i>=0;i--)if(goog.isDefAndNotNull(oForm[key]["rows"][i]["fields"]))for(var ii=oForm[key]["rows"][i]["fields"].length-1;ii>=0;ii--)if(oForm[key]["rows"][i]["fields"][ii]["type"]==="button")oForm[key]["rows"][i]["fields"].splice(ii,1);deferred.resolve(oForm)},function(response){bootbox.alert(response);console.error(response)});
return deferred.promise},"updateSectionElement":function(sRessourceId,sIdField,oSubformDefinition,sSubformDefinitionName,oFormValuesResulted){var deferred=$q.defer();var sToken=this["sToken"];var oProperties=this["oProperties"];var sId=oFormValuesResulted[sSubformDefinitionName][sIdField];var sUrl;var envSrvc=angular.element(vitisApp.appMainDrtv).injector().get(["envSrvc"]);var formSrvc=angular.element(vitisApp.appMainDrtv).injector().get(["formSrvc"]);envSrvc["oFormValues"]=oFormValuesResulted;envSrvc["oFormDefinition"]=
oSubformDefinition;envSrvc["sFormDefinitionName"]=sSubformDefinitionName;var oFormData=formSrvc["getFormData"](envSrvc["sFormDefinitionName"]);if(goog.isDefAndNotNull(sId))sUrl=this["oProperties"]["web_server_name"]+"/"+this["oProperties"]["services_alias"]+"/"+sRessourceId+"/"+sId;else sUrl=this["oProperties"]["web_server_name"]+"/"+this["oProperties"]["services_alias"]+"/"+sRessourceId;$http({method:"PUT",url:sUrl,data:oFormData,params:{"token":sToken}}).then(function(response){if(!goog.isDef(response["data"])){$translate("NO_VALUES_RETURNED").then(function(sTranslation){bootbox.alert(sTranslation)});
return 0}if(goog.isDef(response["data"]["errorMessage"])){bootbox.alert(response["data"]["errorMessage"]);return 0}if(goog.isDef(response["status"]))if(response["status"]===500){bootbox.alert(response["statusText"]);return 0}deferred.resolve(response["data"])},function(response){console.error(response);bootbox.alert(response)});return deferred.promise},"insertSectionElement":function(sRessourceId,sIdField,oSubformDefinition,sSubformDefinitionName,oFormValuesResulted){var deferred=$q.defer();var sToken=
this["sToken"];var oProperties=this["oProperties"];var sId=oFormValuesResulted[sSubformDefinitionName][sIdField];var sUrl;var envSrvc=angular.element(vitisApp.appMainDrtv).injector().get(["envSrvc"]);var formSrvc=angular.element(vitisApp.appMainDrtv).injector().get(["formSrvc"]);envSrvc["oFormValues"]=oFormValuesResulted;envSrvc["oFormDefinition"]=oSubformDefinition;envSrvc["sFormDefinitionName"]=sSubformDefinitionName;var oFormData=formSrvc["getFormData"](envSrvc["sFormDefinitionName"]);$http({method:"POST",
url:this["oProperties"]["web_server_name"]+"/"+this["oProperties"]["services_alias"]+"/"+sRessourceId,data:oFormData,params:{"token":sToken}}).then(function(response){if(!goog.isDef(response["data"])){$translate("NO_VALUES_RETURNED").then(function(sTranslation){bootbox.alert(sTranslation)});return 0}if(goog.isDef(response["data"]["errorMessage"])){bootbox.alert(response["data"]["errorMessage"]);return 0}if(goog.isDef(response["status"]))if(response["status"]===500){bootbox.alert(response["statusText"]);
return 0}deferred.resolve(response["data"])},function(response){console.error(response);bootbox.alert(response)});return deferred.promise},"deleteSectionElements":function(sRessourceId,aIds){var deferred=$q.defer();var sToken=this["sToken"];var oProperties=this["oProperties"];$http({method:"DELETE",url:this["oProperties"]["web_server_name"]+"/"+this["oProperties"]["services_alias"]+"/"+sRessourceId,params:{"token":sToken,"idList":aIds.join("|")}}).then(function(response){if(!goog.isDef(response["data"])){$translate("NO_VALUES_RETURNED").then(function(sTranslation){bootbox.alert(sTranslation)});
return 0}if(goog.isDef(response["data"]["errorMessage"])){bootbox.alert(response["data"]["errorMessage"]);return 0}if(goog.isDef(response["status"]))if(response["status"]===500){bootbox.alert(response["statusText"]);return 0}deferred.resolve(response["data"])},function(response){console.error(response);bootbox.alert(response)});return deferred.promise},"disableFormElement":function(oFormDefinition,sElement,sFormDefinitionName){if(!goog.isDefAndNotNull(oFormDefinition)){console.error("oFormDefinition not defined");
return null}if(!goog.isDefAndNotNull(sElement)){console.error("sElement not defined");return null}var aFormNames=[];if(goog.isDefAndNotNull(sFormDefinitionName))aFormNames=[sFormDefinitionName];else aFormNames=Object.keys(oFormDefinition);for(var i=0;i<aFormNames.length;i++)if(goog.isDefAndNotNull(oFormDefinition[aFormNames[i]]))if(goog.isArray(oFormDefinition[aFormNames[i]]["rows"]))for(var ii=0;ii<oFormDefinition[aFormNames[i]]["rows"].length;ii++)if(goog.isDefAndNotNull(oFormDefinition[aFormNames[i]]["rows"][ii]["fields"]))for(var iii=
0;iii<oFormDefinition[aFormNames[i]]["rows"][ii]["fields"].length;iii++)if(oFormDefinition[aFormNames[i]]["rows"][ii]["fields"][iii]["name"]===sElement)oFormDefinition[aFormNames[i]]["rows"][ii]["fields"][iii]["disabled"]=true;return oFormDefinition},"extractFormDefinitionInfos":function(sFormName){var scope=angular.element("form[name='"+sFormName+"']").scope();scope["ctrl"].extractFormDefinitionInfos()}}};formReader.module.service("formReaderService",formReader.formReaderService);
