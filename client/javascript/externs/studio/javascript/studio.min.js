goog.provide("nsVFB.properties");oProperties={"mode":"dev","timeNotify":2500};goog.provide("nsVFB.ElementForm");nsVFB.ElementForm=function(){oVFB.log("nsVFB.ElementForm");oVFB.module.directive("appElementForm",this.elementFormDirective);oVFB.module.directive("appParamElement",["$rootScope",this.elementParamDirective]);oVFB.module.directive("appParamMap",this.mapParamDirective);oVFB.module.directive("appHelperIcon",this.helperDirective);oVFB.module.controller("AppElementFormController",["$scope","$rootScope","$timeout","$http","$q",this.elementFormController])};
nsVFB.ElementForm.prototype.elementFormDirective=function(){oVFB.log("nsVFB.ElementForm.elementFormDirective");return{restrict:"A",replace:true,controller:"AppElementFormController",controllerAs:"ctrl",scope:true,bindToController:true,templateUrl:"javascript/externs/studio/templates/ElementForm.html"}};
nsVFB.ElementForm.prototype.elementParamDirective=function($rootScope){oVFB.log("nsVFB.ElementForm.elementParamDirective");return{link:function(scope,element){if(scope["model"]["type"]==="map_vmap"){$("#Vmap_Downloader_input")["fileinput"]({"mainClass":"input-group-sm"});$("#Vmap_Downloader_input").on("change",function(event){var file=event.target.files[0];if(file){var reader=new FileReader;reader.onload=function(evt){scope["ctrl"].updateVmapData(JSON.parse(evt.target.result))};reader.readAsText(file)}});
if(scope["locker"]===true)$("#Vmap_Downloader_input")["fileinput"]("disable")}switch(scope["model"]["type"]){case "upload":case "text":case "label":case "email":case "double_select":case "select":case "list":case "date":case "datetime":case "password":case "url":case "color_picker":case "label_display":case "map":case "map_osm":case "map_bing":case "map_vmap":case "textarea":case "button":case "image":case "imageurl":case "image_wsdata":case "link":case "linkurl":case "file_wsdata":case "bo_grid":case "section_grid":case "codemirror":case "checkbox":case "radio":case "float":case "slider":if($(element).attr("id")===
"slider_Element_size"){$(element)["slider"]({"formatter":function(value){return Math.round(value*100/12)+"%"},"value":scope["model"]["nb_cols"]});$(element)["slider"]("on","change",function(){scope["model"]["nb_cols"]=$(element)["slider"]("getValue");scope.$apply()});scope.$watch("model.nb_cols",function(value,old){$(element)["slider"]("setValue",value)})}else if($(element).attr("id")==="slider_Element_height"){if(!goog.isDefAndNotNull(scope["model"]["style"]))scope["model"]["style"]={};if(!goog.isDefAndNotNull(scope["model"]["style"]["height"]))scope["model"]["style"]["height"]=
0;$(element)["slider"]({"formatter":function(value){return value+"px"},"value":parseFloat(scope["model"]["style"]["height"])});$(element)["slider"]("on","change",function(){scope["model"]["style"]["height"]=$(element)["slider"]("getValue")+"px";scope.$apply()});scope.$watch("model.style.height",function(value,old){$(element)["slider"]("setValue",parseFloat(value))})}else if($(element).attr("id")==="slider_Element_width"){if(!goog.isDefAndNotNull(scope["model"]["style"]))scope["model"]["style"]={};
if(!goog.isDefAndNotNull(scope["model"]["style"]["width"]))scope["model"]["style"]["width"]=0;$(element)["slider"]({"formatter":function(value){return value+"px"},"value":parseFloat(scope["model"]["width"])});$(element)["slider"]("on","change",function(){scope["model"]["width"]=$(element)["slider"]("getValue")+"px";scope.$apply()});scope.$watch("model.width",function(value,old){$(element)["slider"]("setValue",parseFloat(value))})}else if($(element).attr("id")==="slider_Tab_size"){if(!goog.isDefAndNotNull(scope["model"]["cm_options"]))scope["model"]["cm_options"]=
{};if(!goog.isDefAndNotNull(scope["model"]["cm_options"]["tabSize"]))scope["model"]["cm_options"]["tabSize"]=2;$(element)["slider"]({"formatter":function(value){return value},"value":parseFloat(scope["model"]["cm_options"]["tabSize"])});$(element)["slider"]("on","change",function(){scope["model"]["cm_options"]["tabSize"]=$(element)["slider"]("getValue");scope.$apply()});scope.$watch("model.cm_options.tabSize",function(value,old){$(element)["slider"]("setValue",parseFloat(value))})}if(scope["locker"]===
true)$(element)["slider"]("disable");else $(element)["slider"]("enable");break}if(scope["model"]["type"]==="list"||scope["model"]["type"]==="double_select"||scope["model"]["type"]==="textarea"){$("#slider_Element_Row")["slider"]({"formatter":function(value){return value},"min":3,"max":20,"step":1,"value":5});$("#slider_Element_Row")["slider"]("on","change",function(){scope["model"]["size"]=$("#slider_Element_Row")["slider"]("getValue");scope.$apply()});scope.$watch("model.size",function(value,old){$("#slider_Element_Row")["slider"]("setValue",
value)});if(scope["locker"]===true)$("#slider_Element_Row")["slider"]("disable");if(scope["model"]["type"]==="double_select")scope.$watch("model.name",function(value){scope["model"]["name_to"]=value;scope["model"]["name_from"]=value+"_from"})}}}};
nsVFB.ElementForm.prototype.helperDirective=function(){return{link:function(scope,element,attrs){var clearObserver=attrs.$observe("appHelperIcon",function(){if(goog.isDef(attrs.text)&&attrs.text!==""){$(element)["popover"]({"trigger":"hover","container":"body","title":"HelperBox","content":function(){return attrs.text}});scope.$on("$destroy",function(){$(element)["popover"]("destroy");clearObserver()})}})}}};nsVFB.ElementForm.prototype.mapParamDirective=function($rootScope){oVFB.log("nsVFB.ElementForm.mapParamDirective")};
nsVFB.ElementForm.prototype.elementFormController=function($scope,$rootScope,$timeout,$http,$q){oVFB.log("nsVFB.ElementForm.elementFormController");var elementFormController=this;this["applicationName"]=oVFB.getApplication();$rootScope["Utils"]={"keys":Object.keys};$scope["model"]={};$scope["collapsed"]=oVFB.Collapse_[4];$scope["aWebServiceAttributs"]=[];$scope["aBusinessObjects"]=[];$scope["aBoAttributs"]=[];$scope["aFormAttributs"]=[];$scope["datasourcesArray"]=[];$scope.tmp={};var selectedElement=
{};var selectedElementInTreeview={};$scope.$watch("text",function(){oVFB.log("text updated");if(typeof $scope["text"]["Element"]!=="undefined"){elementFormController["text"]=$scope["text"]["Element"];$scope["Component_list"]=[];var aAcceptedTypes=oVFB["config"]["avaliable_elems"];for(var i=0;i<aAcceptedTypes.length;i++)$scope["Component_list"].push({"alias":elementFormController["text"]["Select_Type"][aAcceptedTypes[i]],"value":aAcceptedTypes[i]})}});$scope.$watch("model.id",function(){oVFB.log("model.id changed");
$scope["jsonOutput"]=oVFB.getJsonOutput();if(!goog.isDef($scope["jsonOutput"]["datasources"])||!goog.isObject($scope["jsonOutput"]["datasources"])||goog.isArray($scope["jsonOutput"]["datasources"]))$scope["jsonOutput"]["datasources"]={};$scope["datasources"]=$scope["jsonOutput"]["datasources"];$scope["datasourcesArray"]=[];for(var key in $scope["datasources"]){$scope["datasources"][key]["id"]=key;$scope["datasourcesArray"].push($scope["datasources"][key])}elementFormController["updateDatasourceInfos"]();
if($scope["model"]["type"]==="select"||$scope["model"]["type"]==="list"||$scope["model"]["type"]==="double_select")if(goog.isDefAndNotNull($scope["model"]["datasource"]["parents"])){$scope["cascade"]=true;$scope["aParents"]=[];for(var i=0;i<$scope["model"]["datasource"]["parents"].length;i++)$scope["aParents"].push($scope["model"]["datasource"]["parents"][i]["name"])}else{$scope["cascade"]=false;$scope["aParents"]=[]}oVFB.setJsonOutput($scope["jsonOutput"])});$scope.$watch("model.datasource.datasource_id",
function(){oVFB.log("model.datasource.datasource_id changed");if(!goog.isDefAndNotNull($scope["model"]["datasource"]))return 0;if(!goog.isDefAndNotNull($scope["model"]["datasource"]["datasource_id"]))return 0;if(!goog.isDefAndNotNull($scope["datasources"][$scope["model"]["datasource"]["datasource_id"]]))return 0;var datasource=$scope["datasources"][$scope["model"]["datasource"]["datasource_id"]];if(datasource["type"]==="web_service")goog.array.clear($scope["aWebServiceAttributs"]);elementFormController["updateDatasourceInfos"]()});
$scope.$watch("model.default_value",function(){$rootScope.$broadcast("updateDefautValue",$scope["model"])});$scope.$watch("model.name",function(current,old){$scope["jsonOutput"]=oVFB.getJsonOutput();var aElems=oVFB.utils_.getElementsByName($scope["jsonOutput"],$rootScope["selected_form_type"],current);if(aElems.length>1){$scope["model"]["name"]=$scope["model"]["name"]+"_2";$.notify($scope["text"]["Element"]["SameNameWarning"],"warning")}});$scope.$watch("model",function(current,old){$rootScope.$broadcast("update model",
null);if(old["type"]!=="undefined")if(current["type"]!==old["type"]&&current["id"]===old["id"]){if(selectedElement.length>0){if(goog.isDefAndNotNull(selectedElement[0]))selectedElement[0]["icon"]=elementFormController.convert($scope["model"],current["type"]);if(goog.isDefAndNotNull(selectedElementInTreeview[0]))selectedElementInTreeview[0]["icon"]=elementFormController.convert($scope["model"],current["type"])}if(current["type"]==="select")if(elementFormController["optionsSelect"]==="Text"){if(goog.isDef(current["web_service"]))goog.object.remove(current,
"web_service");$scope["selectedRessource"]="";$scope["selectedValue"]="";$scope["selectedLabel"]=""}else if(elementFormController["optionsSelect"]==="TableValues"){if(goog.isDef(current["options"]))goog.object.remove(current,"options");$scope["selectedRessource"]="";$scope["selectedValue"]="";$scope["selectedLabel"]=""}else if(elementFormController["optionsSelect"]==="WebService"){if(goog.isDef(current["options"]))goog.object.remove(current,"options");if(goog.isDef(current["web_service"]["parameters"]))goog.object.remove(current["web_service"],
"parameters")}}else if(current["id"]===old["id"]&&current["name"]!==old["name"]){if(goog.isDef(selectedElement[0])&&goog.isDef(selectedElementInTreeview[0])){selectedElement[0]["text"]=current["name"];selectedElementInTreeview[0]["text"]=current["name"];if(current["name"].match(/\s/g)!==null)angular.element($("#Element_Form_name_input")).addClass("invalid_input");else angular.element($("#Element_Form_name_input")).removeClass("invalid_input")}oVFB.updateElemNameInTabs(current,old);oVFB.updateElemNameInWab(current,
old)}else if(current["id"]===old["id"]);$scope["model"]["selected"]=true;$timeout(function(){if(goog.isDef(selectedElement[0])&&goog.isDef(selectedElementInTreeview[0])){if(goog.isDefAndNotNull(selectedElement[0]))$("#treeWithLines")["treeview"]("selectNode",[selectedElement[0]["nodeId"],{silent:false}]);if(goog.isDefAndNotNull(selectedElementInTreeview[0]))$("#treeView")["treeview"]("selectNode",[selectedElementInTreeview[0]["nodeId"],{silent:false}])}},10);$rootScope.$broadcast("updateJsonModel",
oVFB.getJsonOutput());$rootScope.$broadcast("updateForm",oVFB.getJsonOutput())},true);$scope.$on("update element",function(event,data){oVFB.log("update element");$scope["model"]=data;selectedElement=$("#treeWithLines")["treeview"]("getSelected");selectedElementInTreeview=$("#treeView")["treeview"]("getSelected");if(goog.isDef($scope.model))$("#select_element_to_add").val($scope.model.type);$scope["AllSelects"]=[];if(typeof oVFB.getJsonOutput()[$rootScope["selected_form_type"]]!=="undefined"){var obj=
oVFB.getJsonOutput()[$rootScope["selected_form_type"]]["rows"];for(var i=0;i<obj.length;i++)for(var j=0;j<obj[i]["fields"].length;j++)if((obj[i]["fields"][j]["type"]==="select"||obj[i]["fields"][j]["type"]==="list")&&obj[i]["fields"][j]["name"]!==$scope["model"]["name"])$scope["AllSelects"].push(obj[i]["fields"][j]["name"])}if($("#load_Perso_button").hasClass("active")&&oVFB.valid&&data["type"]!=="undefined")$scope["locker"]=false;else if(oVFB.valid){$scope["locker"]=true;if($scope["model"]["type"]===
"map_vmap")$("#Vmap_Downloader_input").fileinput("disable")}if(!$scope.$$phase)$scope.$digest()});elementFormController.updateWSInfos=function(value){oVFB.log("elementFormController.updateWSInfos");if(typeof value["selectedValue"]!=="undefined")$scope["model"]["web_service"]["id_key"]=value["selectedValue"].replace(/\s/g,"");if(typeof value["selectedLabel"]!=="undefined")$scope["model"]["web_service"]["label_key"]=value["selectedLabel"].replace(/\s/g,"");$scope["model"]["web_service"]["optionsSelect"]=
elementFormController["optionsSelect"]};elementFormController["updateDatasourceInfos"]=function(){oVFB.log("elementFormController.updateDatasourceInfos");if(!goog.isDefAndNotNull($scope["model"]["datasource"]))return 0;$scope["model"]["datasource"]["sort_order"]=goog.isDefAndNotNull($scope["model"]["datasource"]["sort_order"])?$scope["model"]["datasource"]["sort_order"]:"ASC";$scope["model"]["datasource"]["distinct"]=goog.isDefAndNotNull($scope["model"]["datasource"]["distinct"])?$scope["model"]["datasource"]["distinct"]:
"true";if(goog.isDefAndNotNull($scope["model"]["datasource"]["id_key"]))$scope["model"]["datasource"]["id_key"]=$scope["model"]["datasource"]["id_key"].replace(/\s/g,"");if(goog.isDefAndNotNull($scope["model"]["datasource"]["label_key"]))$scope["model"]["datasource"]["label_key"]=$scope["model"]["datasource"]["label_key"].replace(/\s/g,"");if(goog.isDefAndNotNull($scope["model"]["datasource"]["id_key"])&&goog.isDefAndNotNull($scope["model"]["datasource"]["label_key"]))$scope["model"]["datasource"]["attributs"]=
$scope["model"]["datasource"]["id_key"]+"|"+$scope["model"]["datasource"]["label_key"];if(goog.isDefAndNotNull($scope["model"]["datasource"]["label_key"]))$scope["model"]["datasource"]["order_by"]=$scope["model"]["datasource"]["label_key"]};elementFormController["updateWebServiceAttributs"]=function(datasource){oVFB.log("updateWebServiceAttributs");var params={"token":oVFB.getToken(),"limit":1};if(goog.isObject(datasource["parameters"]))goog.object.extend(params,datasource["parameters"]);var bRequestOk=
false;var canceler=$q.defer();$http({method:"GET",url:oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/"+datasource["ressource_id"],params:params,timeout:canceler.promise,headers:{"Accept":"application/x-vm-json"}}).then(function successCallback(response){bRequestOk=true;if(!goog.isDefAndNotNull(response))return 0;if(!goog.isDefAndNotNull(response["data"]))return 0;if(!goog.isDefAndNotNull(response["data"]["data"]))return 0;if(!goog.isDefAndNotNull(response["data"]["data"][0]))return 0;
var data;if(datasource["dataType"]==="businessObject"&&goog.isDefAndNotNull(datasource["businessObjectRequest"])){data=[];for(var i=0;i<response["data"]["data"].length;i++)data.push(response["data"]["data"][i]["bo_"+datasource["businessObjectRequest"]])}else data=response["data"]["data"];$scope["aWebServiceAttributs"]=Object.keys(data[0])},function errorCallback(response){bRequestOk=true;console.error(response)});var showCancelRequestMessageAfterTimeout=function(){setTimeout(function(){if(bRequestOk===
false)bootbox.confirm(elementFormController["text"]["Component"]["Select"]["Cancel"],function(result){if(result===true)canceler.resolve();else showCancelRequestMessageAfterTimeout()})},5E3)};showCancelRequestMessageAfterTimeout()};elementFormController["updateCascadeField"]=function(){oVFB.log("elementFormController.updateCascadeField");if(!goog.isDefAndNotNull($scope["aParents"])){console.error("aParents not defined");return 0}if(!goog.isDefAndNotNull($scope["model"]["datasource"])){console.error("datasource not defined");
return 0}if($scope["cascade"]===false)$scope["aParents"]=[];if(goog.isArray($scope["aParents"])){if($scope["aParents"].length===0){if(goog.isDef($scope["model"]["datasource"]["parents"]))delete $scope["model"]["datasource"]["parents"];return 0}if(!goog.isDefAndNotNull($scope["model"]["datasource"]["parents"]))$scope["model"]["datasource"]["parents"]=[];if(goog.isArray($scope["model"]["datasource"]["parents"]))goog.array.clear($scope["model"]["datasource"]["parents"]);for(var i=0;i<$scope["aParents"].length;i++)$scope["model"]["datasource"]["parents"].push({"name":$scope["aParents"][i],
"filter_attr":$scope["aParents"][i],"filter_equality":"=","wait_for_parent":true})}};elementFormController.updateVmapData=function(tree){oVFB.log("elementFormController.updateVmapData");if(tree["children"]){for(var i=0;i<tree["children"].length;i++)if(tree["children"][i]["view"]){$scope["model"]["map_options"]["center"]["coord"]=tree["children"][i]["view"]["center"]?tree["children"][i]["view"]["center"]:[0,0];$scope["model"]["map_options"]["center"]["zoom"]=tree["children"][i]["view"]["zoom"]?tree["children"][i]["view"]["zoom"]:
5;$scope["model"]["map_options"]["center"]["extent"]=tree["children"][i]["view"]["extent"]?tree["children"][i]["view"]["extent"]:[-2.002637639E7,-2.00489661E7,2.002637639E7,2.00489661E7];$scope["model"]["map_options"]["proj"]=tree["children"][i]["view"]["projection"]?tree["children"][i]["view"]["projection"]:"EPSG:3857";$rootScope.$broadcast("updateMap","view")}$scope["model"]["map_options"]["tree"]=tree;$rootScope.$broadcast("updateMap","tree")}};elementFormController.updateWS=function(){oVFB.log("elementFormController.updateWS");
$rootScope.$broadcast("updateOptions",{})};elementFormController["updateMap"]=function(carte,option){oVFB.log("elementFormController.updateMap");switch(option){case "center":var coord=ol.proj.transform($scope["model"]["map_options"]["center"]["coord"],$scope["model"]["map_options"]["proj"],"EPSG:3857");var boundary=[-2.002637639E7,-2.00489661E7,2.002637639E7,2.00489661E7];if(!ol.extent.containsCoordinate(boundary,coord))$["notify"](elementFormController["text"]["Component"]["Map"]["Notify"]["OutRange"],
{"className":"error","autoHideDelay":oVFB.TimeNotify_});else $rootScope.$broadcast("updateMap",option);break;case "zoom":if($scope["model"]["map_options"]["center"]["scale"]>0&&$scope["model"]["map_options"]["center"]["scale"]<=2E8)$rootScope.$broadcast("updateMap",option);else $["notify"](elementFormController["text"]["Component"]["Map"]["Notify"]["OutRange"],{"className":"error","autoHideDelay":oVFB.TimeNotify_});break;case "extent":var extent=$scope.model.map_options.center.extent;if(extent[0]<=
extent[2]&&extent[0]>=-2.002637639E7&&extent[0]<=2.002637639E7)if(extent[0]<=extent[2]&&extent[2]>=-2.002637639E7&&extent[2]<=2.002637639E7)if(extent[1]<=extent[3]&&extent[1]>=-2.00489661E7&&extent[1]<=2.00489661E7)if(extent[1]<=extent[3]&&extent[3]>=-2.00489661E7&&extent[3]<=2.00489661E7){$rootScope.$broadcast("updateMap",option);break}$["notify"](elementFormController["text"]["Component"]["Map"]["Notify"]["OutRange"],{"className":"error","autoHideDelay":oVFB.TimeNotify_});break;case "multi_geom":break;
default:$rootScope.$broadcast("updateMap",option);break}};elementFormController.convert=function(src,dst){oVFB.log("elementFormController.convert");var fields;var icon="icon-point";if(src["type"]!=="undefined"){switch(dst){case "button":fields=["type","id","class","name","nb_cols","buttons","default_value"];break;case "title":case "label":fields=["type","id","label","name","default_value","nb_cols"];dst==="label"?icon="icon-eye":icon;break;case "hr":fields=["type","id","name","default_value"];dst===
"hr"?icon="icon-minus":icon;break;case "hidden":fields=["type","id","name","default_value","nb_cols"];dst==="hidden"?icon="icon-user-secret":icon;break;case "subtitle":fields=["type","id","label","name","class","default_value","nb_cols"];break;case "checkbox":fields=["type","id","label","name","checked","default_value","nb_cols"];icon="icon-check-square";break;case "radio":fields=["type","id","label","name","checked","options","nb_cols","default_value"];icon="icon-dot-circle-o";break;case "textarea":fields=
["type","id","label","name","required","nb_cols","default_value"];icon="icon-paragraph";break;case "select":fields=["type","id","label","name","required","nb_cols","multiple","options","web_service","child_select","default_value"];icon="icon-format_list_bulleted";break;case "list":fields=["type","id","label","name","required","nb_cols","multiple","options","web_service","child_select","default_value","size"];icon="icon-format_list_bulleted";break;case "double_select":fields=["type","id","label","name",
"required","nb_cols","options","web_service","size","label_from","label_to","name_from","name_to","default_value"];icon="icon-format_list_bulleted";break;case "date":case "datetime":case "label_display":case "color_picker":fields=["type","id","label","name","nb_cols","default_value"];dst==="date"||dst==="datetime"?icon="icon-calendar-check-o":icon;dst==="label_display"?icon="icon-eye":icon;dst==="color_picker"?icon="icon-paint":icon;break;case "upload":fields=["type","id","label","name","nb_cols",
"default_value","ext"];icon="icon-file";break;case "tinymce":fields=["type","id","label","name","nb_rows","options","default_value","nb_cols"];icon="icon-font";break;case "slider":fields=["type","id","label","name","options","default_value","nb_cols"];icon="icon-sliders";break;case "text":case "password":case "url":case "email":fields=["type","id","label","name","pattern","required","nb_cols","default_value"];dst==="text"?icon="icon-font":icon;dst==="password"?icon="icon-key":icon;dst==="url"?icon=
"icon-chrome":icon;dst==="email"?icon="icon-at":icon;break;case "integer":case "float":case "number":fields=["type","id","label","name","min","max","nb_cols","default_value"];icon="icon-calculator";break;case "link":fields=["type","id","label","name","alias","folder","nb_cols","target"];icon="glyphicon glyphicon-link";break;case "image":fields=["type","id","label","name","alias","folder","nb_cols","width"];icon="glyphicon glyphicon-picture";break;case "map_osm":case "map_bing":case "map_vmap":fields=
["type","id","label","name","required","map_options","nb_cols","style","default_value"];icon="icon-map";break;case "codemirror":fields=["type","id","label","ui","name","cm_options","nb_cols"];icon="icon-code";break}for(var srckey in src)if(goog.isDefAndNotNull(fields))if(fields.indexOf(srckey)===-1)delete src[srckey];switch(dst){case "list":case "double_select":var typic={"size":5};break;case "button":goog.isDef(src["class"])?src["class"]:src["class"]="btn-ungroup btn-group-sm";goog.isDef(src["buttons"])?
src["buttons"]:src["buttons"]=[];var typic={"type":"submit","name":"form_submit","label":"FORM_UPDATE","class":"btn-primary"};goog.isDef(src["buttons"][0])?src["buttons"][0]:src["buttons"][0]=typic;break;case "radio":var typic={"choices":[{label:"Oui",value:true},{label:"Non",value:false}]};goog.isDef(src["options"])?src["options"]:src["options"]=typic;goog.isDef(src["nb_cols"])?src["nb_cols"]:src["nb_cols"]=12;break;case "slider":var typic={"min":0,"max":100,"precision":1,"step":1};goog.isDef(src["options"])?
src["options"]:src["options"]=typic;goog.isDef(src["nb_cols"])?src["nb_cols"]:src["nb_cols"]=12;break;case "map_osm":goog.isDef(src["style"])?src["style"]:src["style"]={"height":"250px"};var typic={"proj":"EPSG:3857","type":"OSM","center":{"coord":[3E5,6E6],"zoom":5,"scale":25E6,"extent":[-2.002637639E7,-2.00489661E7,2.002637639E7,2.00489661E7]},"controls":{"MP":true,"ZO":true,"SL":true,"CP":true},"layers":[],"interactions":{"multi_geometry":false,"full_screen":true,"RA":false,"RO":true,"ED":true,
"DP":true,"DL":true,"DPol":true,"SE":true},"draw_color":"rgba(54,184,255,0.6)","contour_color":"rgba(0,0,0,0.4)","contour_size":2,"circle_radius":6,"features":[],"coord_accuracy":8};goog.isDef(src["map_options"])&&src["map_options"]["type"]==="OSM"?src["map_options"]:src["map_options"]=typic;break;case "map_bing":goog.isDef(src["style"])?src["style"]:src["style"]={"height":"250px"};var typic={"proj":"EPSG:3857","type":"bing","center":{"coord":[3E5,6E6],"zoom":5,"scale":25E6,"extent":[-2.002637639E7,
-2.00489661E7,2.002637639E7,2.00489661E7]},"controls":{"MP":true,"ZO":true,"SL":true,"CP":true},"layers":[],"interactions":{"multi_geometry":false,"full_screen":true,"RA":false,"RO":true,"ED":true,"DP":true,"DL":true,"DPol":true,"SE":true},"draw_color":"rgba(54,184,255,0.6)","contour_color":"rgba(0,0,0,0.4)","contour_size":2,"circle_radius":6,"features":[],"coord_accuracy":8,"source":{"culture":"fr-FR","key":"","style":"Aerial"}};goog.isDef(src["map_options"])&&src["map_options"]["type"]==="bing"?
src["map_options"]:src["map_options"]=typic;break;case "map_vmap":goog.isDef(src["style"])?src["style"]:src["style"]={"height":"250px"};var typic={"proj":"EPSG:3857","type":"vmap","center":{"coord":[3E5,6E6],"zoom":5,"scale":25E6,"extent":[-2.002637639E7,-2.00489661E7,2.002637639E7,2.00489661E7]},"controls":{"MP":true,"ZO":true,"SL":true,"CP":true},"layers":[],"interactions":{"multi_geometry":false,"full_screen":true,"RA":false,"RO":true,"ED":true,"DP":true,"DL":true,"DPol":true,"SE":true},"draw_color":"rgba(54,184,255,0.6)",
"contour_color":"rgba(0,0,0,0.4)","contour_size":2,"circle_radius":6,"features":[],"coord_accuracy":8};goog.isDef(src["map_options"])&&src["map_options"]["type"]==="vmap"?src["map_options"]:src["map_options"]=typic;break;case "codemirror":var typic={"mode":"javascript","readOnly":false,"styleActiveLine":true,"lineNumbers":true,"lineSeparator":"\r\n","indentWithTabs":true,"tabSize":2,"viewportMargin":50,"theme":"Veremes"};goog.isDef(src["cm_options"])?src["cm_options"]:src["cm_options"]=typic;goog.isDef(src["nb_cols"])?
src["nb_cols"]:src["nb_cols"]=12;goog.isDef(src["ui"])?src["ui"]:src["ui"]=true;break;case "bo_grid":var typic={"enableRowSelection":true,"enableSelectAll":true,"enablePagination":false,"enablePaginationControls":false,"enableColumnMenus":false,"enableColumnResizing":false,"appHeader":true,"appHeaderTitleBar":true,"columnDefs":[],"data":[]};goog.isDef(src["options"])?src["options"]:src["options"]=typic;goog.isDef(src["nb_cols"])?src["nb_cols"]:src["nb_cols"]=12;setTimeout(function(){oVFB.reloadForm()});
break;case "section_grid":var typic={"enableRowSelection":true,"enableSelectAll":true,"enablePagination":false,"enablePaginationControls":false,"enableColumnMenus":false,"enableColumnResizing":false,"appHeader":true,"appHeaderTitleBar":true,"columnDefs":[],"data":[]};goog.isDef(src["options"])?src["options"]:src["options"]=typic;goog.isDef(src["nb_cols"])?src["nb_cols"]:src["nb_cols"]=12;setTimeout(function(){oVFB.reloadForm()});break;default:if(!src["nb_cols"])src["nb_cols"]=12;break}return icon}};
elementFormController["resize"]=function(){$scope["collapsed"]=!$scope["collapsed"];oVFB.Collapse_[4]=$scope["collapsed"];oVFB.resize()};elementFormController["updateBoList"]=function(){$scope["aBusinessObjects"]=[];var params={"token":oVFB.getToken()};var bRequestOk=false;var canceler=$q.defer();$http({method:"GET",url:oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/vmap/businessobjects",params:params,timeout:canceler.promise,headers:{"Accept":"application/x-vm-json"}}).then(function successCallback(response){bRequestOk=
true;if(!goog.isDefAndNotNull(response))return 0;if(!goog.isDefAndNotNull(response["data"]))return 0;if(!goog.isDefAndNotNull(response["data"]["data"]))return 0;if(!goog.isDefAndNotNull(response["data"]["data"][0]))return 0;$scope["aBusinessObjects"]=response["data"]["data"]},function errorCallback(response){bRequestOk=true;console.error(response)});var showCancelRequestMessageAfterTimeout=function(){setTimeout(function(){if(bRequestOk===false)bootbox.confirm(elementFormController["text"]["Component"]["Select"]["Cancel"],
function(result){if(result===true)canceler.resolve();else showCancelRequestMessageAfterTimeout()})},5E3)};showCancelRequestMessageAfterTimeout()};elementFormController["updateBoLinkLists"]=function(sBoId){if(!goog.isDefAndNotNull(sBoId))return 0;var aBoFields=[];var aFormFields=[];var params={"token":oVFB.getToken()};var bRequestOk=false;var canceler=$q.defer();$http({method:"GET",url:oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/vmap/querys/"+sBoId,params:params,
timeout:canceler.promise,headers:{"Accept":"application/x-vm-json"}}).then(function successCallback(response){bRequestOk=true;if(!goog.isDefAndNotNull(response))return 0;if(!goog.isDefAndNotNull(response["data"]))return 0;if(!goog.isDefAndNotNull(response["data"]["data"]))return 0;if(!goog.isDefAndNotNull(response["data"]["data"][0]))return 0;if(!goog.isDefAndNotNull(response["data"]["data"][0]))return 0;var aBoFields=Object.keys(response["data"]["data"][0]);$scope["aBoAttributs"]=aBoFields},function errorCallback(response){bRequestOk=
true;console.error(response)});var showCancelRequestMessageAfterTimeout=function(){setTimeout(function(){if(bRequestOk===false)bootbox.confirm(elementFormController["text"]["Component"]["Select"]["Cancel"],function(result){if(result===true)canceler.resolve();else showCancelRequestMessageAfterTimeout()})},5E3)};showCancelRequestMessageAfterTimeout();if(typeof oVFB.getJsonOutput()[$rootScope["selected_form_type"]]!=="undefined"){var obj=oVFB.getJsonOutput()[$rootScope["selected_form_type"]]["rows"];
for(var i=0;i<obj.length;i++)for(var j=0;j<obj[i]["fields"].length;j++)aFormFields.push(obj[i]["fields"][j]["name"])}$scope["aFormAttributs"]=aFormFields};elementFormController["updateSectionList"]=function(){$scope["aBusinessObjects"]=[];var params={"token":oVFB.getToken(),"filter":'"template"=\'workspaceListTpl.html\' AND "lang"=\''+oVFB.AppProperties.language+"'"};var bRequestOk=false;var canceler=$q.defer();$http({method:"GET",url:oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+
"/vitis/vitissections",params:params,timeout:canceler.promise,headers:{"Accept":"application/x-vm-json"}}).then(function successCallback(response){bRequestOk=true;if(!goog.isDefAndNotNull(response))return 0;if(!goog.isDefAndNotNull(response["data"]))return 0;if(!goog.isDefAndNotNull(response["data"]["data"]))return 0;if(!goog.isDefAndNotNull(response["data"]["data"][0]))return 0;$scope["aSections"]=response["data"]["data"]},function errorCallback(response){bRequestOk=true;console.error(response)});
var showCancelRequestMessageAfterTimeout=function(){setTimeout(function(){if(bRequestOk===false)bootbox.confirm(elementFormController["text"]["Component"]["Select"]["Cancel"],function(result){if(result===true)canceler.resolve();else showCancelRequestMessageAfterTimeout()})},5E3)};showCancelRequestMessageAfterTimeout()};elementFormController["updateSectionLinkLists"]=function(sSectionId){$scope["aBusinessObjects"]=[];var params={"token":oVFB.getToken()};var bRequestOk=false;var canceler=$q.defer();
$http({method:"GET",url:oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/vitis/vitissections/"+sSectionId,params:params,timeout:canceler.promise,headers:{"Accept":"application/x-vm-json"}}).then(function successCallback(response){bRequestOk=true;if(!goog.isDefAndNotNull(response))return 0;if(!goog.isDefAndNotNull(response["data"]))return 0;if(!goog.isDefAndNotNull(response["data"]["data"]))return 0;if(!goog.isDefAndNotNull(response["data"]["data"][0]))return 0;var oSection=
response["data"]["data"][0];if(goog.isDefAndNotNull(oSection["ressource_id"])){$http({method:"GET",url:oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/"+oSection["ressource_id"],params:params,timeout:canceler.promise,headers:{"Accept":"application/x-vm-json"}}).then(function successCallback(response){bRequestOk=true;if(!goog.isDefAndNotNull(response))return 0;if(!goog.isDefAndNotNull(response["data"]))return 0;if(!goog.isDefAndNotNull(response["data"]["data"]))return 0;
if(!goog.isDefAndNotNull(response["data"]["data"][0]))return 0;var aSectionAttributes=Object.keys(response["data"]["data"][0]);$scope["aSectionAttributs"]=aSectionAttributes},function errorCallback(response){bRequestOk=true;console.error(response)});showCancelRequestMessageAfterTimeout()}},function errorCallback(response){bRequestOk=true;console.error(response)});var showCancelRequestMessageAfterTimeout=function(){setTimeout(function(){if(bRequestOk===false)bootbox.confirm(elementFormController["text"]["Component"]["Select"]["Cancel"],
function(result){if(result===true)canceler.resolve();else showCancelRequestMessageAfterTimeout()})},5E3)};showCancelRequestMessageAfterTimeout();var aFormFields=[];if(typeof oVFB.getJsonOutput()[$rootScope["selected_form_type"]]!=="undefined"){var obj=oVFB.getJsonOutput()[$rootScope["selected_form_type"]]["rows"];for(var i=0;i<obj.length;i++)for(var j=0;j<obj[i]["fields"].length;j++)aFormFields.push(obj[i]["fields"][j]["name"])}$scope["aFormAttributs"]=aFormFields}};goog.provide("oVFB");goog.require("nsUtils");goog.require("nsVFB.properties");goog.require("nsVFB.JsonLoader");goog.require("nsVFB.FormTools");goog.require("nsVFB.Visualizer");goog.require("nsVFB.ElementForm");goog.require("nsVitisComponent.Map");var oVFB={};oVFB["config"]={};oVFB.init=function(config){console.log("oVFB.init: ",config);oVFB["config"]=config};oVFB.resize=function(bFullScreen){};oVFB.getDevTools=function(){return oVFB.oDevTools_};oVFB.getTreeView=function(){return oVFB.oTreeView_};
oVFB.getFormTools=function(){return oVFB.oFormTools_};oVFB.getJsonLoader=function(){return oVFB.oJsonLoader_};oVFB.getElementForm=function(){return oVFB.oElementForm_};oVFB.getVisualizer=function(){return oVFB.oVisualizer_};oVFB.getJson=function(){return oVFB.oJson_};oVFB.setJson=function(oJson){oVFB.oJson_=oJson};oVFB.getJs=function(){return oVFB.sJs_};oVFB.setJs=function(sJs){oVFB.sJs_=sJs};oVFB.getCss=function(){return oVFB.sCSS_};oVFB.setCss=function(sCss){oVFB.sCSS_=sCss};
oVFB.getJsonOutput=function(){if(!goog.isDef(oVFB.oJsonOutput_))console.error("oVFB.oJsonOutput_ undefined");if(goog.object.isEmpty(oVFB.oJsonOutput_))console.error("oVFB.oJsonOutput_ is empty");return oVFB.oJsonOutput_};oVFB.setJsonOutput=function(oJson){oVFB.oJsonOutput_=oJson};
oVFB.getUnselectedForm=function(oJson){var oForm;for(var sFormName in oJson){oForm=oJson[sFormName];if(goog.isDefAndNotNull(oForm["rows"]))for(var i=0;i<oForm["rows"].length;i++)if(goog.isDefAndNotNull(oForm["rows"][i]["fields"]))for(var ii=0;ii<oForm["rows"][i]["fields"].length;ii++)if(oForm["rows"][i]["fields"][ii]["selected"]===true)delete oForm["rows"][i]["fields"][ii]["selected"]}return oJson};
oVFB.getFormElems=function(oForm){var aElems=[];var aButtons=[];for(var i=0;i<oForm["rows"].length;i++)if(goog.isDefAndNotNull(oForm["rows"][i]["fields"]))for(var ii=0;ii<oForm["rows"][i]["fields"].length;ii++){if(goog.isDefAndNotNull(oForm["rows"][i]["fields"][ii]["name"]))aElems.push(oForm["rows"][i]["fields"][ii]["name"]);if(goog.isDefAndNotNull(oForm["rows"][i]["fields"][ii]["buttons"]))aButtons.push(oForm["rows"][i]["fields"][ii]["name"])}return{"elems":aElems,"buttons":aButtons}};
oVFB.updateElemNameInTabs=function(current,old){var sOldName=old["name"];var sCurrentName=current["name"];var oJson=oVFB.getJsonOutput();var oForm,oTab;for(var sFormName in oJson){oForm=oJson[sFormName];if(goog.isDefAndNotNull(oForm["tabs"]))if(goog.isDefAndNotNull(oForm["tabs"]["list"]))for(var i=0;i<oForm["tabs"]["list"].length;i++){oTab=oForm["tabs"]["list"][i];if(goog.isDefAndNotNull(oTab["elements"]))if(oTab["elements"].indexOf(sOldName)!==-1)oTab["elements"].splice(oTab["elements"].indexOf(sOldName),
1,sCurrentName)}}oVFB.setJsonOutput(oJson)};oVFB.updateElemNameInWab=function(current,old){var sOldName=old["name"];var sCurrentName=current["name"];var oJson=oVFB.getJsonOutput();var oForm,oGroup;for(var sFormName in oJson){oForm=oJson[sFormName];if(goog.isDefAndNotNull(oForm["wab"]))for(var sState in oForm["wab"])for(var sGroup in oForm["wab"][sState]){oGroup=oForm["wab"][sState][sGroup];if(goog.isDefAndNotNull(oGroup[sOldName])){oGroup[sCurrentName]=oGroup[sOldName];delete oGroup[sOldName]}}}oVFB.setJsonOutput(oJson)};
oVFB.checkElemsOnTabs=function(oTabs,aElems){var oTab;if(goog.isDefAndNotNull(oTabs["list"]))for(var i=0;i<oTabs["list"].length;i++){oTab=oTabs["list"][i];if(goog.isDefAndNotNull(oTab["elements"]))for(var ii=oTab["elements"].length-1;ii>=0;ii--)if(aElems.indexOf(oTab["elements"][ii])===-1){console.error("Element "+oTab["elements"][ii]+" is not in elements list");oTab["elements"].splice(ii,1)}}return oTabs};
oVFB.checkElemsOnWab=function(oWab,aElems){for(var state in oWab)for(var group in oWab[state]){for(var sWabElem in oWab[state][group])if(aElems.indexOf(sWabElem)===-1){console.error("Element "+sWabElem+" is not in elements list");delete oWab[state][group][sWabElem]}for(var i=0;i<aElems.length;i++)if(!goog.isDefAndNotNull(oWab[state][group][aElems[i]]))oWab[state][group][aElems[i]]=""}return oWab};
oVFB.cleanTabs=function(oTabs){var oTab;if(goog.isDefAndNotNull(oTabs["list"]))for(var i=0;i<oTabs["list"].length;i++){oTab=oTabs["list"][i];if(goog.isDefAndNotNull(oTab["$$hashKey"]))delete oTab["$$hashKey"];if(goog.isDefAndNotNull(oTab["studio_mode"]))delete oTab["studio_mode"]}return oTabs};oVFB.getTreeDnD=function(){return oVFB.tree_};oVFB.setTreeDnD=function(str){oVFB.tree_=str};oVFB.getToken=function(){return oVFB.token};oVFB["setToken"]=function(token){oVFB.token=token};oVFB.getId=function(){return oVFB.id};
oVFB.getApplication=function(){return oVFB.AppName};oVFB["setId"]=function(id){oVFB.id=id};oVFB["setContainer"]=function(str){oVFB.el=str};oVFB["setAppProperties"]=function(obj){oVFB.AppProperties=obj};oVFB["setApplication"]=function(sApp){oVFB.AppName=sApp};oVFB["reset"]=function(){};oVFB.module=angular.module("vfb",["ui.codemirror","ui.grid","ui.grid.autoResize","formReader"]);
oVFB.studioMainDirective=function(){oVFB.log("nsVFB.MainDirective");if(!goog.isDefAndNotNull(oVFB["config"]))console.error("oVFB['config'] not defined, please use oVFB.init(config)");return{restrict:"A",replace:true,controller:"AppStudioMainController",controllerAs:"ctrl",scope:true,bindToController:true,templateUrl:"javascript/externs/studio/templates/MainTemplate.html"}};oVFB.module.directive("appStudioMainDirective",oVFB.studioMainDirective);
oVFB.studioMainController=function($scope,$http,$q,$timeout,$rootScope){oVFB.log("nsVFB.MainController");var this_=this;this.$scope_=$scope;this.$rootScope_=$rootScope;this.$http_=$http;this.$q_=$q;this.$timeout_=$timeout;this.iLocalDatabaseChangeCounter_=0;this["text"]={};$scope["aCollapsed"]=oVFB.Collapse_;$scope["text"]={};$scope["jsonOutput"]={};$scope["datasources"]={};$scope["selectedDatasource"]={};$scope["webservices"]=[];$scope["businessObjects"]=[];$scope["ressources"]=[];$scope["aExternalDatabaseTables"]=
[];$scope["schemas"]=[];$scope["tables"]=[];$scope["selectedDatasource"]={};$scope["editedDatasource"]={};$scope["newSource"]={"options":["Value one|1","Value two|2","Value three|3"],"result_options":[{"label":"Value one","value":"1"},{"label":"Value two","value":"2"},{"label":"Value three","value":"3"}]};$scope["editorOptions"]={"mode":"schema","lineNumbers":false,"lineSeparator":"\n","theme":"Veremes","onLoad":function(cm_){}};$scope["studioAddModalTestGridOptions"]={"data":[],"enableColumnMenus":false,
"enableColumnResizing":true,"onRegisterApi":function(studioAddModalTestGridApi){$scope.studioAddModalTestGridApi=studioAddModalTestGridApi}};$scope["studioEditModalTestGridOptions"]={"data":[],"enableColumnMenus":false,"enableColumnResizing":true,"onRegisterApi":function(studioEditModalTestGridApi){$scope.studioEditModalTestGridApi=studioEditModalTestGridApi}};$scope["studioDatasourcesGridOptions"]={"data":[],"columnDefs":[{"field":"name","displayName":"Nom"}],"enableColumnMenus":false,"enableColumnResizing":true,
"enableRowSelection":true,"multiSelect":false,"enableFullRowSelection":true,"onRegisterApi":function(datasourcesGridApi){$scope["datasourcesGridApi"]=datasourcesGridApi;datasourcesGridApi["selection"]["on"]["rowSelectionChanged"]($scope,function(row){$scope["selectedDatasource"]=angular.copy($scope["datasources"][row["entity"]["id"]]);$scope["selectedDatasource"]["id"]=row["entity"]["id"];this_.setDatasourceContent($scope["selectedDatasource"])})}};$scope["tabs"]={};$scope["elems"]=[];$scope["sTestTabFormDefinitionName"]=
"";$scope["oTestTabFormValues"]={};$scope["oTestTabFormDefinition"]={};$scope["oTestTabFormScope"]={};$scope["sTestWabFormDefinitionName"]="";$scope["oTestWabFormValues"]={};$scope["oTestWabFormDefinition"]={};$scope["oTestWabFormScope"]={};$scope["oProperties"]=oVFB.AppProperties;$scope["sToken"]=sessionStorage["session_token"];$scope["wab"]={};$scope["wabGroups"]=[];$scope["wabSelectedGroup"]="";$scope["wabSelectedState"]="";$scope["applicationName"]=oVFB.getApplication();$http.get("javascript/externs/studio/lang/lang-"+
oVFB.AppProperties["language"]+".json").success(function(data){$scope["text"]=data;this_["text"]=data}).error(function(data,status){console["error"]("ERROR : (AJAX request : "+status+" ) On loading Language, contact Veremes please")});$http({method:"GET",url:oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/vitis/webservices",params:{"token":oVFB.getToken(),"attributs":"name"},headers:{"Accept":"application/x-vm-json"}}).then(function successCallback(response){if(!goog.isDefAndNotNull(response.data["data"])){console.error("response.data['data'] not defined");
return}$scope["webservices"]=response.data["data"]},function errorCallback(response){console.error("Problem with vitis/webservices contact support");console.error(response)});$http({method:"GET",url:oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/vmap/businessobjects",params:{"token":oVFB.getToken()},headers:{"Accept":"application/x-vm-json"}}).then(function successCallback(response){if(!goog.isDefAndNotNull(response.data["data"])){console.error("response.data['data'] not defined");
return}var aBusinessObjects=response.data["data"];for(var i=0;i<aBusinessObjects.length;i++)aBusinessObjects[i]["sql_form"]="SELECT * FROM "+aBusinessObjects[i]["schema"]+"."+aBusinessObjects[i]["table"];$scope["businessObjects"]=[];for(var i=0;i<aBusinessObjects.length;i++)$scope["businessObjects"].push({"title":aBusinessObjects[i]["title"],"business_object_id":aBusinessObjects[i]["business_object_id"],"sql_form":aBusinessObjects[i]["sql_form"],"sql_summary":aBusinessObjects[i]["sql_summary"],"sql_list":aBusinessObjects[i]["sql_list"]})},
function errorCallback(response){console.error("Problem with vitis/webservices contact support");console.error(response)});$("#studio-datasource-modal").on("hide.bs.modal",function(e){this_.clearDatasourcesGrid();oVFB.reloadForm()});$("#studio-datasource-add-modal").on("hide.bs.modal",function(e){$scope["aExternalDatabaseTables"].length=0;$scope["schemas"].length=0;$scope["tables"].length=0;this_.clearTestGrids()});$("#studio-datasource-edit-modal").on("hide.bs.modal",function(e){$scope["aExternalDatabaseTables"].length=
0;$scope["schemas"].length=0;$scope["tables"].length=0;this_.clearTestGrids()});$scope.$on("updateForm",function(event,data){$scope.$applyAsync(function(){$scope["jsonOutput"]=data})});$scope.$on("updateTestTabForm",function(event,data){if(data[$scope["selected_form_type"]]){var oJson=data[$scope["selected_form_type"]];for(var i=0;i<oJson["rows"].length;i++)for(var j=0;j<oJson["rows"][i]["fields"].length;j++)if(!oJson["rows"][i]["fields"][j]["id"])oJson["rows"][i]["fields"][j]["id"]=oJson["rows"][i]["fields"][j]["name"]+
"_"+(i+1)+"_"+(j+1);$scope["oTestTabFormDefinition"]=data;$scope["sTestTabFormDefinitionName"]=$scope["selected_form_type"];$scope["title"]=oJson["title"];if(!goog.isDef($scope["oTestTabFormValues"]))$scope["oTestTabFormValues"]={};if(!goog.isDef($scope["oTestTabFormValues"][$scope["sTestTabFormDefinitionName"]]))$scope["oTestTabFormValues"][$scope["sTestTabFormDefinitionName"]]={};angular.element($("#studio_test_tabs_form_reader").children()).scope()["ctrl"].refreshForm()}else oVFB.log("visualizerFormModeController. Load JSON form fail: "+
$scope["selected_form_type"]+" undefined in ",data)});$scope.$on("updateTestWabForm",function(event,data){if(data[$scope["selected_form_type"]]){var oJson=data[$scope["selected_form_type"]];for(var i=0;i<oJson["rows"].length;i++)for(var j=0;j<oJson["rows"][i]["fields"].length;j++)if(!oJson["rows"][i]["fields"][j]["id"])oJson["rows"][i]["fields"][j]["id"]=oJson["rows"][i]["fields"][j]["name"]+"_"+(i+1)+"_"+(j+1);$scope["oTestWabFormDefinition"]=data;$scope["sTestWabFormDefinitionName"]=$scope["selected_form_type"];
$scope["title"]=oJson["title"];if(!goog.isDef($scope["oTestWabFormValues"]))$scope["oTestWabFormValues"]={};if(!goog.isDef($scope["oTestWabFormValues"][$scope["sTestWabFormDefinitionName"]]))$scope["oTestWabFormValues"][$scope["sTestWabFormDefinitionName"]]={};var oFormReaderScope=angular.element($("#studio_test_wab_form_reader").children()).scope();if(goog.isDefAndNotNull(oFormReaderScope))oFormReaderScope.$applyAsync(function(){oFormReaderScope["wabState"]=$scope["wabSelectedState"];oFormReaderScope["wabGroup"]=
$scope["wabSelectedGroup"];oFormReaderScope["ctrl"].refreshForm()})}else oVFB.log("visualizerFormModeController. Load JSON form fail: "+$scope["selected_form_type"]+" undefined in ",data)});$scope.$watch("tabs",function(){this_.updateTestTabForm()},true);$scope.$watch("wabSelectedGroup",function(){if(goog.isString($scope["wabSelectedState"])&&goog.isString($scope["wabSelectedGroup"])&&$scope["wabSelectedGroup"]!==""&&$scope["wabSelectedState"]!=="")this_.updateTestWabForm()});$scope.$watch("wabSelectedState",
function(){if(goog.isString($scope["wabSelectedState"])&&goog.isString($scope["wabSelectedGroup"])&&$scope["wabSelectedGroup"]!==""&&$scope["wabSelectedState"]!=="")this_.updateTestWabForm()})};oVFB.module.controller("AppStudioMainController",["$scope","$http","$q",oVFB.studioMainController]);
oVFB.studioMainController.prototype.showTabsManagerModal=function(){oVFB.log("studioMainController.showTabsManagerModal");var $scope=this.$scope_;var sFormDefinitionName=$scope["selected_form_type"];var oElems=oVFB.getFormElems($scope["jsonOutput"][sFormDefinitionName]);oVFB.unselectAll();$scope["jsonOutput"]=oVFB.getJsonOutput();$scope["tabs"]=angular.copy($scope["jsonOutput"][sFormDefinitionName]["tabs"]);$scope["elems"]=oElems["elems"];$scope["buttons"]=oElems["buttons"];$scope["tabs"]=oVFB.checkElemsOnTabs($scope["tabs"],
$scope["elems"]);this.updateTestTabForm();$("#studio-tabsmanager-modal").modal("show")};oVFB.studioMainController.prototype.toggleElemOnTab=function(sElem,oTab){if(oTab.elements.indexOf(sElem)!==-1)oTab.elements.splice(oTab.elements.indexOf(sElem),1);else oTab.elements.push(sElem)};oVFB.studioMainController.prototype.addTab=function(oTab){var $scope=this.$scope_;if(!goog.isDefAndNotNull(oTab))oTab={"label":$scope["text"]["Loader"]["Tab"],"elements":[]};$scope.$applyAsync(function(){$scope["tabs"]["list"].push(oTab)})};
oVFB.studioMainController.prototype.askAndRemoveTab=function(oTab){var this_=this;var $scope=this.$scope_;bootbox.confirm("<h4>"+$scope["text"]["Loader"]["AskRemoveTab"]+"</h4><br>"+oTab["label"],function(result){if(result)this_.removeTab(oTab)})};oVFB.studioMainController.prototype.removeTab=function(oTab){var $scope=this.$scope_;if($scope["tabs"]["list"].indexOf(oTab)!==-1)$scope.$applyAsync(function(){$scope["tabs"]["list"].splice($scope["tabs"]["list"].indexOf(oTab),1)});else console.error("Tab not founted in scope.tabs.list")};
oVFB.studioMainController.prototype.moveTab=function(oTab,sDirection){var $scope=this.$scope_;var moveIndex=0;if($scope["tabs"]["list"].indexOf(oTab)!==-1)$scope.$applyAsync(function(){var tabIndex=$scope["tabs"]["list"].indexOf(oTab);if(sDirection==="left")moveIndex=-1;if(sDirection==="right")moveIndex=1;if(tabIndex+moveIndex>=0&&tabIndex+moveIndex<$scope["tabs"]["list"].length){$scope["tabs"]["list"].splice(tabIndex,1);$scope["tabs"]["list"].splice(tabIndex+moveIndex,0,oTab)}});else console.error("Tab not founted in scope.tabs.list")};
oVFB.studioMainController.prototype.selectAllElems=function(oTab){var $scope=this.$scope_;oTab.elements=[];for(var i=0;i<$scope["elems"].length;i++)oTab.elements.push($scope["elems"][i])};
oVFB.studioMainController.prototype.saveTabs=function(oTabs){var $scope=this.$scope_;var sFormDefinitionName=$scope["selected_form_type"];$("#studio-tabsmanager-modal").modal("hide");oTabs=oVFB.cleanTabs(oTabs);$scope["jsonOutput"][sFormDefinitionName]["tabs"]=oTabs;oVFB.getJsonOutput($scope["jsonOutput"]);$scope.$broadcast("updateForm",$scope["jsonOutput"])};
oVFB.studioMainController.prototype.updateTestTabForm=function(){var $scope=this.$scope_;var oForm=oVFB.getUnselectedForm($scope["jsonOutput"]);var sFormDefinitionName=$scope["selected_form_type"];if(goog.isDefAndNotNull(oForm))if(goog.isDefAndNotNull(oForm[sFormDefinitionName]))if(goog.isDefAndNotNull(oForm[sFormDefinitionName]["tabs"])){oForm[sFormDefinitionName]["tabs"]=angular.copy($scope["tabs"]);$scope.$broadcast("updateTestTabForm",oForm)}};
oVFB.studioMainController.prototype.showWabManagerModal=function(){oVFB.log("studioMainController.showWabManagerModal");var $scope=this.$scope_;var sFormDefinitionName=$scope["selected_form_type"];var oElems=oVFB.getFormElems($scope["jsonOutput"][sFormDefinitionName]);oVFB.unselectAll();$scope["jsonOutput"]=oVFB.getJsonOutput();$scope["wab"]=angular.copy($scope["jsonOutput"][sFormDefinitionName]["wab"]);$scope["wabGroups"]=[];$scope["elems"]=oElems["elems"];$scope["buttons"]=oElems["buttons"];for(var state in $scope["wab"])for(var group in $scope["wab"][state])if($scope["wabGroups"].indexOf(group)===
-1)$scope["wabGroups"].push(group);$scope["wab"]=oVFB.checkElemsOnWab($scope["wab"],$scope["elems"]);$("#studio-wabmanager-modal").modal("show")};
oVFB.studioMainController.prototype.toggleElemOnWab=function(sElem,oState,sWabSelectedGroup,sAction){if(goog.isDefAndNotNull(oState))if(goog.isDefAndNotNull(oState[sWabSelectedGroup])){var sNextValue="";if(goog.isDefAndNotNull(oState[sWabSelectedGroup][sElem])){sNextValue=sCurrentValue;var sCurrentValue=oState[sWabSelectedGroup][sElem];if(sAction==="r")if(sCurrentValue==="")sNextValue="r";else sNextValue="";if(sAction==="rw")if(sCurrentValue==="")sNextValue="rw";else if(sCurrentValue==="r")sNextValue=
"rw";else sNextValue="r";oState[sWabSelectedGroup][sElem]=sNextValue}else oState[sWabSelectedGroup][sElem]=sAction;this.updateTestWabForm()}};oVFB.studioMainController.prototype.saveWab=function(wab){var $scope=this.$scope_;var sFormDefinitionName=$scope["selected_form_type"];$("#studio-wabmanager-modal").modal("hide");$scope["jsonOutput"][sFormDefinitionName]["wab"]=wab;oVFB.getJsonOutput($scope["jsonOutput"]);$scope.$broadcast("updateForm",$scope["jsonOutput"])};
oVFB.studioMainController.prototype.updateTestWabForm=function(){var $scope=this.$scope_;var oForm=oVFB.getUnselectedForm($scope["jsonOutput"]);var sFormDefinitionName=$scope["selected_form_type"];if(goog.isDefAndNotNull(oForm))if(goog.isDefAndNotNull(oForm[sFormDefinitionName]))if(goog.isDefAndNotNull(oForm[sFormDefinitionName]["wab"])){oForm[sFormDefinitionName]["wab"]=angular.copy($scope["wab"]);$scope.$broadcast("updateTestWabForm",oForm)}};
oVFB.studioMainController.prototype.showDatasourcesModal=function(){oVFB.log("studioMainController.showDatasourcesModal");var $scope=this.$scope_;$scope["jsonOutput"]=oVFB.getJsonOutput();if(!goog.isDef($scope["jsonOutput"]["datasources"])||!goog.isObject($scope["jsonOutput"]["datasources"])||goog.isArray($scope["jsonOutput"]["datasources"]))$scope["jsonOutput"]["datasources"]={};$scope["datasources"]=$scope["jsonOutput"]["datasources"];$("#studio-datasource-modal").modal("show");$scope["selectedDatasource"]=
{};this.setStudioGridDatasources();var $timeout=angular.element(vitisApp.appMainDrtv).injector().get(["$timeout"]);$timeout(function(){if($scope["datasourcesGridApi"]["grid"]["rows"].length>0&&$scope["datasourcesGridApi"]["selection"]["getSelectedRows"]().length===0)$scope["datasourcesGridApi"]["selection"]["selectRow"]($scope["studioDatasourcesGridOptions"]["data"][0])},1)};
oVFB.studioMainController.prototype.preventLocalDatabaseChanged=function(database){var this_=this;this.iLocalDatabaseChangeCounter_++;var tmpCounter=angular.copy(this.iLocalDatabaseChangeCounter_);setTimeout(function(){if(tmpCounter===this_.iLocalDatabaseChangeCounter_)this_.setLocalDatabaseSchemas(database)},1500)};
oVFB.studioMainController.prototype.setLocalDatabaseSchemas=function(database){oVFB.log("studioMainController.setLocalDatabaseSchemas");var $http=this.$http_;var $scope=this.$scope_;var this_=this;$http({method:"GET",url:oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/vitis/genericquerys",params:{"token":oVFB.getToken(),"database":database,"schema":"pg_catalog","table":"pg_tables","sort_order":"ASC","attributs":"schemaname","distinct":true},headers:{"Accept":"application/x-vm-json"}}).then(function successCallback(response){if(goog.isDefAndNotNull(response.data["errorMessage"])){$.notify(response.data["errorMessage"],
"error");$scope["schemas"]=[];return}if(!goog.isDefAndNotNull(response.data["data"])){$.notify(this_["text"]["Element"]["Component"]["Select"]["Schema_List_error"],"error");$scope["schemas"]=[];return}$scope["schemas"]=response.data["data"]},function errorCallback(response){console.error("Problem with vitis/genericquerys contact support");console.error(response)})};
oVFB.studioMainController.prototype.reloadTablesList=function(sSchema,sDatabase){oVFB.log("studioMainController.reloadTablesList");var $scope=this.$scope_;var this_=this;this.$http_({method:"GET",url:oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/vitis/genericquerys",params:{"token":oVFB.getToken(),"database":sDatabase,"schema":sSchema},headers:{"Accept":"application/x-vm-json"}}).then(function successCallback(response){if(goog.isDefAndNotNull(response.data["errorMessage"])){$.notify(response.data["errorMessage"],
"error");$scope["tables"]=[];return}if(!goog.isDefAndNotNull(response.data["data"])){$.notify(this_["text"]["Element"]["Component"]["Select"]["Table_List_error"],"error");$scope["tables"]=[];return}$scope["tables"]=response.data["data"]},function errorCallback(response){console.error("Problem with vitis/genericquerys contact support");console.error(response)})};
oVFB.studioMainController.prototype.showNewSourceModal=function(){oVFB.log("studioMainController.showNewSourceModal");var $scope=this.$scope_;var new_id="datasource_1",i=1;while(goog.isDef($scope["datasources"][new_id])){new_id="datasource_"+i;i++}$scope["newSource"]={"id":new_id,"name":new_id,"description":"","parameters":{},"options":["Value one|1","Value two|2","Value three|3"],"options_model":"Value one|1\nValue two|2\nValue three|3","result_options":[{"label":"Value one","value":"1"},{"label":"Value two",
"value":"2"},{"label":"Value three","value":"3"}]};this.clearTestGrids();$scope["aExternalDatabaseTables"].length=0;$scope["schemas"].length=0;$scope["tables"].length=0;$("#studio-datasource-add-modal").modal("show");$scope["schemaSelected"]={};$scope["tableSelected"]={}};
oVFB.studioMainController.prototype.showEditSourceModal=function(){oVFB.log("studioMainController.showEditSourceModal");var $scope=this.$scope_;if($scope["datasourcesGridApi"]["selection"]["getSelectedRows"]().length>0){if(Object.keys($scope["selectedDatasource"]).length===0)return 0;$scope["editedDatasource"]=angular.copy($scope["selectedDatasource"]);this.clearTestGrids();$scope["aExternalDatabaseTables"].length=0;$scope["schemas"].length=0;$scope["tables"].length=0;if($scope["editedDatasource"]["type"]===
"web_service")if(goog.isDefAndNotNull($scope["editedDatasource"]["webservice"]))if(goog.isDefAndNotNull($scope["editedDatasource"]["webservice"]["name"]))this.updateRessources($scope["editedDatasource"]["webservice"]);$("#studio-datasource-edit-modal").modal("show");var $timeout=angular.element(vitisApp.appMainDrtv).injector().get(["$timeout"]);$timeout(function(){$scope.refresh=true;$timeout(function(){$scope.refresh=false},100)},500);for(var i=0;i<$scope["schemas"].length;i++)if($scope["schemas"][i]["schemaname"]===
$scope["editedDatasource"]["parameters"]["schema"]){$scope["schemaSelected"]=$scope["schemas"][i];this.reloadTablesList($scope["editedDatasource"]["parameters"]["schema"])}$timeout(function(){for(var i=0;i<$scope["tables"].length;i++)if($scope["tables"][i]["table_name"]===$scope["editedDatasource"]["parameters"]["table"])$scope["tableSelected"]=$scope["tables"][i]},500)}else bootbox.alert(this["text"]["Element"]["Component"]["Select"]["Datasource_NothingSelected"])};
oVFB.studioMainController.prototype.addSource=function(newSource){oVFB.log("studioMainController.addSource");var $scope=this.$scope_;if(newSource["dataType"]==="text"){$scope.refresh=false;if(!goog.isDef(newSource["id"])){console.error("newSource.id not defined");return 0}if(!goog.isDef(newSource["name"])){console.error("newSource.name not defined");return 0}if(!goog.isDef(newSource["options"])){console.error("newSource.options not defined");newSource["options"]=[]}if(goog.isDef($scope["datasources"][newSource["id"]])){bootbox.alert(this["text"]["Element"]["Component"]["Select"]["Datasource_Exists"]);
return 0}var source={"id":newSource["id"],"type":"object","dataType":newSource["dataType"],"name":newSource["name"],"description":newSource["description"],"options":newSource["options"]};$("#studio-datasource-add-modal").modal("hide");this.saveDatasource(source);this.setStudioGridDatasources()}else if(newSource["dataType"]==="externalDatabase"){if(!goog.isDef(newSource["id"])){console.error("newSource.id not defined");return 0}if(!goog.isDef(newSource["name"])){console.error("newSource.name not defined");
return 0}if(!goog.isDef(newSource["parameters"]["server"])){console.error("newSource.parameters.server not defined");return 0}if(!goog.isDef(newSource["parameters"]["port"])){console.error("newSource.parameters.port not defined");return 0}if(!goog.isDef(newSource["parameters"]["sgbd"])){console.error("newSource.parameters.sgbd not defined");return 0}if(!goog.isDef(newSource["parameters"]["login"])){console.error("newSource.parameters.login not defined");return 0}if(!goog.isDef(newSource["parameters"]["password"])){console.error("newSource.parameters.password not defined");
return 0}if(!goog.isDef(newSource["parameters"]["database"])){console.error("newSource.parameters.database not defined");return 0}if(!goog.isDef(newSource["parameters"]["schema"])){console.error("newSource.parameters.schema not defined");return 0}if(!goog.isDef(newSource["parameters"]["table"])){console.error("newSource.parameters.table not defined");return 0}if(goog.isDef($scope["datasources"][newSource["id"]])){bootbox.alert(this["text"]["Element"]["Component"]["Select"]["Datasource_Exists"]);return 0}var source=
{"id":newSource["id"],"type":"web_service","dataType":newSource["dataType"],"name":newSource["name"],"description":newSource["description"],"parameters":newSource["parameters"],"ressource_id":"vitis/genericquerys/"+newSource["parameters"]["table"]};$("#studio-datasource-add-modal").modal("hide");this.saveDatasource(source);this.setStudioGridDatasources()}else if(newSource["dataType"]==="tableValue"){if(!goog.isDef(newSource["id"])){console.error("newSource.id not defined");return 0}if(!goog.isDef(newSource["name"])){console.error("newSource.name not defined");
return 0}if(!goog.isDef(newSource["parameters"]["schema"])){console.error("newSource.parameters.schema not defined");return 0}if(!goog.isDef(newSource["parameters"]["table"])){console.error("newSource.parameters.table not defined");return 0}if(goog.isDef($scope["datasources"][newSource["id"]])){bootbox.alert(this["text"]["Element"]["Component"]["Select"]["Datasource_Exists"]);return 0}var source={"id":newSource["id"],"type":"web_service","dataType":newSource["dataType"],"name":newSource["name"],"description":newSource["description"],
"parameters":newSource["parameters"],"ressource_id":"vitis/genericquerys"};$("#studio-datasource-add-modal").modal("hide");this.saveDatasource(source);this.setStudioGridDatasources()}else if(newSource["dataType"]==="webService"){if(!goog.isDef(newSource["id"])){console.error("newSource.id not defined");return 0}if(!goog.isDef(newSource["name"])){console.error("newSource.name not defined");return 0}if(!goog.isDef(newSource["webservice"])){bootbox.alert(this["text"]["Element"]["Component"]["Select"]["WebService_undefined"]);
console.error("newSource.webservice not defined");return 0}if(!goog.isDef(newSource["ressource"])){bootbox.alert(this["text"]["Element"]["Component"]["Select"]["Ressource_undefined"]);console.error("newSource.ressource not defined");return 0}if(goog.isDef($scope["datasources"][newSource["id"]])){bootbox.alert(this["text"]["Element"]["Component"]["Select"]["Datasource_Exists"]);return 0}var source={"id":newSource["id"],"type":"web_service","dataType":newSource["dataType"],"name":newSource["name"],
"description":newSource["description"],"webservice":newSource["webservice"],"ressource":newSource["ressource"],"ressource_id":newSource["webservice"]["name"]+"/"+newSource["ressource"]["name"]};$("#studio-datasource-add-modal").modal("hide");this.saveDatasource(source);this.setStudioGridDatasources()}else if(newSource["dataType"]==="businessObject"){if(!goog.isDef(newSource["id"])){console.error("newSource.id not defined");return 0}if(!goog.isDef(newSource["name"])){console.error("newSource.name not defined");
return 0}if(!goog.isDef(newSource["businessObject"]["business_object_id"])){bootbox.alert(this["text"]["Element"]["Component"]["Select"]["BusinessObject_undefined"]);console.error("newSource.businessObject not defined");return 0}if(goog.isDef($scope["datasources"][newSource["id"]])){bootbox.alert(this["text"]["Element"]["Component"]["Select"]["Datasource_Exists"]);return 0}var source={"id":newSource["id"],"type":"web_service","dataType":newSource["dataType"],"name":newSource["name"],"description":newSource["description"],
"businessObject":newSource["businessObject"],"businessObjectRequest":newSource["businessObjectRequest"],"subObject":"bo_"+newSource["businessObjectRequest"],"ressource_id":"vmap/querys/"+newSource["businessObject"]["business_object_id"]+"/"+newSource["businessObjectRequest"]};$("#studio-datasource-add-modal").modal("hide");this.saveDatasource(source);this.setStudioGridDatasources()}};
oVFB.studioMainController.prototype.removeSelectedSource=function(){oVFB.log("studioMainController.removeSelectedSource");var this_=this;var $scope=this.$scope_;var sourceId=$scope["selectedDatasource"]["id"];var usedDatasources=[];if(!goog.isDefAndNotNull(sourceId))return 0;for(var formName in $scope["jsonOutput"])if(formName!=="datasources"){var form=$scope["jsonOutput"][formName];if(goog.isDefAndNotNull(form["rows"]))if(goog.isArray(form["rows"]))for(var i=0;i<form["rows"].length;i++)if(goog.isDefAndNotNull(form["rows"][i]["fields"]))for(var ii=
0;ii<form["rows"][i]["fields"].length;ii++)if(goog.isDefAndNotNull(form["rows"][i]["fields"][ii]["datasource"]))if(form["rows"][i]["fields"][ii]["datasource"]["datasource_id"]===sourceId)usedDatasources.push({label:form["rows"][i]["fields"][ii]["label"],name:form["rows"][i]["fields"][ii]["name"],formName:formName})}var message=this["text"]["Element"]["Component"]["Select"]["Datasource_Delete"];if(usedDatasources.length>0){message=this["text"]["Element"]["Component"]["Select"]["Datasource_Delete_Used"];
message+="<br>";message+="<br>";message+="<ul>";for(var i=0;i<usedDatasources.length;i++)message+="<li>"+usedDatasources[i]["formName"]+": "+usedDatasources[i]["label"]+" ("+usedDatasources[i]["name"]+")</li>";message+="</ul>";message+="<br>";message+=this["text"]["Element"]["Component"]["Select"]["Datasource_Delete"]}bootbox.confirm(message,function(result){if(result===true){delete $scope["datasources"][$scope["selectedDatasource"]["id"]];$scope["selectedDatasource"]={};setTimeout(function(){this_.setStudioGridDatasources()},
500);oVFB.setJsonOutput($scope["jsonOutput"])}})};
oVFB.studioMainController.prototype.saveDatasource=function(datasource){oVFB.log("studioMainController.saveDatasource");var $scope=this.$scope_;if(datasource["type"]==="object")$scope["datasources"][datasource["id"]]={"type":datasource["type"],"dataType":datasource["dataType"],"name":datasource["name"],"description":datasource["description"],"options":datasource["options"]};else if(datasource["type"]==="web_service"){$scope["datasources"][datasource["id"]]={"type":datasource["type"],"dataType":datasource["dataType"],
"name":datasource["name"],"description":datasource["description"],"parameters":datasource["parameters"],"ressource_id":datasource["ressource_id"]};if(goog.isDefAndNotNull(datasource["webservice"]))$scope["datasources"][datasource["id"]]["webservice"]=datasource["webservice"];if(goog.isDefAndNotNull(datasource["ressource"]))$scope["datasources"][datasource["id"]]["ressource"]=datasource["ressource"];if(goog.isDefAndNotNull(datasource["businessObject"]))$scope["datasources"][datasource["id"]]["businessObject"]=
datasource["businessObject"];if(goog.isDefAndNotNull(datasource["subObject"]))$scope["datasources"][datasource["id"]]["subObject"]=datasource["subObject"];if(goog.isDefAndNotNull(datasource["businessObjectRequest"])){$scope["datasources"][datasource["id"]]["businessObjectRequest"]=datasource["businessObjectRequest"];$scope["datasources"][datasource["id"]]["subObject"]="bo_"+datasource["businessObjectRequest"];$scope["datasources"][datasource["id"]]["ressource_id"]="vmap/querys/"+datasource["businessObject"]["business_object_id"]+
"/"+datasource["businessObjectRequest"]}}if(datasource["dataType"]==="externalDatabase")$scope["datasources"][datasource["id"]]["ressource_id"]="vitis/genericquerys/"+datasource["parameters"]["table"];oVFB.setJsonOutput($scope["jsonOutput"]);this.setStudioGridDatasources();$["notify"](this["text"]["Element"]["Component"]["Select"]["Saved"],{"className":"success","autoHideDelay":oVFB.TimeNotify_});$("#studio-datasource-edit-modal").modal("hide");$scope.refresh=false};
oVFB.studioMainController.prototype.setStudioGridDatasources=function(){oVFB.log("studioMainController.setStudioGridDatasources");var $scope=this.$scope_;goog.array.clear($scope["studioDatasourcesGridOptions"]["data"]);var datasourcesCopy=angular.copy($scope["datasources"]);for(var key in $scope["datasources"]){datasourcesCopy[key]["id"]=key;$scope["studioDatasourcesGridOptions"]["data"].push(datasourcesCopy[key])}$scope["datasourcesGridApi"]["grid"]["refresh"]();goog.object.clear($scope["selectedDatasource"])};
oVFB.studioMainController.prototype.setDatasourceContent=function(datasource){oVFB.log("studioMainController.setDatasourceContent");if(datasource["type"]==="object"){datasource["options_model"]="";datasource["result_options"]=[];if(goog.isArray(datasource["options"]))for(var i=0;i<datasource["options"].length;i++){if(i>0)datasource["options_model"]+="\n";datasource["options_model"]+=datasource["options"][i]}this.updateDatasourceTextContent(datasource)}};
oVFB.studioMainController.prototype.updateDatasourceTextContent=function(datasource){oVFB.log("studioMainController.updateDatasourceTextContent");datasource["options"]=datasource["options_model"].split("\n");goog.array.clear(datasource["result_options"]);var aOptions,aOptionsKeys=[],aOptionsValues=[];for(var i=0;i<datasource["options"].length;i++){aOptions=datasource["options"][i].split("|");aOptionsKeys.push(aOptions[0]);aOptionsValues.push(aOptions[1])}var aTranslationsKeys=Object.keys(aOptionsKeys);
for(var i=0;i<aTranslationsKeys.length;i++)datasource["result_options"].push({"label":aOptionsKeys[aTranslationsKeys[i]],"value":aOptionsValues[i]})};
oVFB.studioMainController.prototype.updateRessources=function(webService){oVFB.log("studioMainController.updateRessources");var $scope=this.$scope_;var $http=this.$http_;$http({method:"GET",url:oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/vitis/webservices/"+webService["name"]+"/ressources",params:{"token":oVFB.getToken(),"attributs":"name"},headers:{"Accept":"application/x-vm-json"}}).then(function successCallback(response){if(!goog.isDefAndNotNull(response.data["data"])){console.error("response.data['data'] not defined");
return}$scope["ressources"]=response.data["data"]},function errorCallback(response){console.error("Problem with vitis/webservices contact support");console.error(response)})};
oVFB.studioMainController.prototype.testTableValues=function(datasource,modalName){oVFB.log("studioMainController.testTableValues");var $scope=this.$scope_;var url=oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/vitis/genericquerys";var params={"token":oVFB.getToken(),"limit":10};if(goog.isDefAndNotNull(datasource["parameters"]))goog.object.extend(params,datasource["parameters"]);if(modalName==="studio-datasource-add-modal")this.testRequestAPI(url,params,$scope["studioAddModalTestGridOptions"],
$scope.studioAddModalTestGridApi);else if(modalName==="studio-datasource-edit-modal")this.testRequestAPI(url,params,$scope["studioEditModalTestGridOptions"],$scope.studioEditModalTestGridApi)};
oVFB.studioMainController.prototype.testExternalDatabaseValues=function(datasource,modalName){oVFB.log("studioMainController.testExternalDatabaseValues");var $scope=this.$scope_;if(!goog.isDefAndNotNull(datasource["parameters"]["server"])){bootbox.alert("server "+this["text"]["Element"]["Component"]["Select"]["Undefined"]);return 0}if(!goog.isDefAndNotNull(datasource["parameters"]["port"])){bootbox.alert("Port "+this["text"]["Element"]["Component"]["Select"]["Undefined"]);return 0}if(!goog.isDefAndNotNull(datasource["parameters"]["sgbd"])){bootbox.alert("SGBD "+
this["text"]["Element"]["Component"]["Select"]["Undefined"]);return 0}if(!goog.isDefAndNotNull(datasource["parameters"]["login"])){bootbox.alert("Login "+this["text"]["Element"]["Component"]["Select"]["Undefined"]);return 0}if(!goog.isDefAndNotNull(datasource["parameters"]["password"])){bootbox.alert("Password "+this["text"]["Element"]["Component"]["Select"]["Undefined"]);return 0}if(!goog.isDefAndNotNull(datasource["parameters"]["database"])){bootbox.alert("Database "+this["text"]["Element"]["Component"]["Select"]["Undefined"]);
return 0}if(!goog.isDefAndNotNull(datasource["parameters"]["schema"])){bootbox.alert("Schema "+this["text"]["Element"]["Component"]["Select"]["Undefined"]);return 0}if(!goog.isDefAndNotNull(datasource["parameters"]["table"])){bootbox.alert("Table "+this["text"]["Element"]["Component"]["Select"]["Undefined"]);return 0}var url=oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/vitis/genericquerys/"+datasource["parameters"]["table"];var params={"token":oVFB.getToken(),"limit":10,
"login":datasource["parameters"]["login"],"password":datasource["parameters"]["password"],"server":datasource["parameters"]["server"],"port":datasource["parameters"]["port"],"sgbd":datasource["parameters"]["sgbd"],"database":datasource["parameters"]["database"],"schema":datasource["parameters"]["schema"],"filter":datasource["parameters"]["filter"]==""?undefined:datasource["parameters"]["filter"]};if(modalName==="studio-datasource-add-modal")this.testRequestAPI(url,params,$scope["studioAddModalTestGridOptions"],
$scope.studioAddModalTestGridApi);else if(modalName==="studio-datasource-edit-modal")this.testRequestAPI(url,params,$scope["studioEditModalTestGridOptions"],$scope.studioEditModalTestGridApi)};
oVFB.studioMainController.prototype.testDatasource=function(datasource,modalName){var $scope=this.$scope_;if(datasource["dataType"]==="externalDatabase")this.testExternalDatabaseValues(datasource,modalName);else if(datasource["dataType"]==="tableValue")this.testTableValues(datasource,modalName);else if(datasource["dataType"]==="webService")this.testWebService(datasource,modalName);else if(datasource["dataType"]==="businessObject")this.testBusinessObject(datasource,modalName)};
oVFB.studioMainController.prototype.testWebService=function(datasource,modalName){oVFB.log("studioMainController.testWebService");var $scope=this.$scope_;if(!goog.isDef(datasource["webservice"]))bootbox.alert(this["text"]["Element"]["Component"]["Select"]["WebServiceUndefined"]);if(!goog.isDef(datasource["ressource"]))bootbox.alert(this["text"]["Element"]["Component"]["Select"]["RessourceUndefined"]);var url=oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/"+datasource["webservice"]["name"]+
"/"+datasource["ressource"]["name"];var params={"token":oVFB.getToken(),"limit":10};if(modalName==="studio-datasource-add-modal")this.testRequestAPI(url,params,$scope["studioAddModalTestGridOptions"],$scope.studioAddModalTestGridApi);else if(modalName==="studio-datasource-edit-modal")this.testRequestAPI(url,params,$scope["studioEditModalTestGridOptions"],$scope.studioEditModalTestGridApi)};
oVFB.studioMainController.prototype.testBusinessObject=function(datasource,modalName){oVFB.log("studioMainController.testBusinessObject");var $scope=this.$scope_;if(!goog.isDef(datasource["businessObject"]))bootbox.alert(this["text"]["Element"]["Component"]["Select"]["BusinessObject_undefined"]);if(!goog.isDef(datasource["businessObjectRequest"]))bootbox.alert(this["text"]["Element"]["Component"]["Select"]["BusinessObject_Request_undefined"]);var url=oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+
"/vmap/querys/"+datasource["businessObject"]["business_object_id"]+"/"+datasource["businessObjectRequest"];var params={"token":oVFB.getToken(),"limit":10};if(goog.isDefAndNotNull(datasource["parameters"]))goog.object.extend(params,datasource["parameters"]);if(modalName==="studio-datasource-add-modal")this.testRequestAPI(url,params,$scope["studioAddModalTestGridOptions"],$scope.studioAddModalTestGridApi,"bo_"+datasource["businessObjectRequest"]);else if(modalName==="studio-datasource-edit-modal")this.testRequestAPI(url,
params,$scope["studioEditModalTestGridOptions"],$scope.studioEditModalTestGridApi,"bo_"+datasource["businessObjectRequest"])};
oVFB.studioMainController.prototype.testRequestAPI=function(url,params,gridOptions,gridApi,subObject){oVFB.log("studioMainController.testRequestAPI");var this_=this;var $http=this.$http_;var $q=this.$q_;if(!goog.isDef(url)){console.error("url not defined");return 0}if(!goog.isDef(params)){console.error("params not defined");return 0}var bRequestOk=false;var canceler=$q.defer();$http({method:"GET",url:url,params:params,timeout:canceler.promise,headers:{"Accept":"application/x-vm-json"}}).then(function successCallback(response){bRequestOk=
true;if(!goog.isDef(response["data"])){bootbox.alert("response['data'] undefined");return 0}if(goog.isDef(response["data"]["errorMessage"])){bootbox.alert(response["data"]["errorType"]+": "+response["data"]["errorMessage"]);return 0}if(!goog.isDef(response["data"]["data"])){bootbox.alert(this_["text"]["Element"]["Component"]["Select"]["NoDataReturned"]);return 0}var data;if(goog.isDefAndNotNull(subObject)){data=[];for(var i=0;i<response["data"]["data"].length;i++)data.push(response["data"]["data"][i][subObject])}else data=
response["data"]["data"];var keys=Object.keys(data[0]);var columnDefs=[];for(var i=0;i<keys.length;i++)columnDefs.push({"name":keys[i],"displayName":keys[i],"width":100});gridOptions["data"]=data;gridOptions["columnDefs"]=columnDefs;gridApi["grid"]["refresh"]()},function errorCallback(response){bRequestOk=true;bootbox.alert(response)});var showCancelRequestMessageAfterTimeout=function(){setTimeout(function(){if(bRequestOk===false)bootbox.confirm(this_["text"]["Element"]["Component"]["Select"]["Cancel"],
function(result){if(result===true)canceler.resolve();else showCancelRequestMessageAfterTimeout()})},5E3)};showCancelRequestMessageAfterTimeout()};oVFB.studioMainController.prototype.clearDatasourcesGrid=function(){oVFB.log("studioMainController.clearDatasourcesGrid");var $scope=this.$scope_;$scope["studioDatasourcesGridOptions"]["data"]=[];$scope["datasourcesGridApi"]["grid"]["refresh"]()};
oVFB.studioMainController.prototype.clearTestGrids=function(){oVFB.log("studioMainController.clearTestGrids");var $scope=this.$scope_;$scope["studioAddModalTestGridOptions"]["data"]=[];$scope["studioAddModalTestGridOptions"]["columnDefs"]=[];$scope.studioAddModalTestGridApi["grid"]["refresh"]();$scope["studioEditModalTestGridOptions"]["data"]=[];$scope["studioEditModalTestGridOptions"]["columnDefs"]=[];$scope.studioEditModalTestGridApi["grid"]["refresh"]()};
oVFB.studioMainController.prototype.getExternalDatabaseTables=function(datasource){oVFB.log("studioMainController.getExternalDatabaseTables");var this_=this;var $http=this.$http_;var $scope=this.$scope_;var $q=this.$q_;if(!goog.isDefAndNotNull(datasource["parameters"]["server"])){bootbox.alert("Server "+this["text"]["Element"]["Component"]["Select"]["Undefined"]);return 0}if(!goog.isDefAndNotNull(datasource["parameters"]["port"])){bootbox.alert("Port "+this["text"]["Element"]["Component"]["Select"]["Undefined"]);
return 0}if(!goog.isDefAndNotNull(datasource["parameters"]["sgbd"])){bootbox.alert("SGBD "+this["text"]["Element"]["Component"]["Select"]["Undefined"]);return 0}if(!goog.isDefAndNotNull(datasource["parameters"]["login"])){bootbox.alert("Login "+this["text"]["Element"]["Component"]["Select"]["Undefined"]);return 0}if(!goog.isDefAndNotNull(datasource["parameters"]["password"])){bootbox.alert("Password "+this["text"]["Element"]["Component"]["Select"]["Undefined"]);return 0}if(!goog.isDefAndNotNull(datasource["parameters"]["database"])){bootbox.alert("Database "+
this["text"]["Element"]["Component"]["Select"]["Undefined"]);return 0}if(!goog.isDefAndNotNull(datasource["parameters"]["schema"])){bootbox.alert("Schema "+this["text"]["Element"]["Component"]["Select"]["Undefined"]);return 0}var url=oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/vitis/genericquerys";var params={"token":oVFB.getToken(),"limit":50,"login":datasource["parameters"]["login"],"password":datasource["parameters"]["password"],"server":datasource["parameters"]["server"],
"port":datasource["parameters"]["port"],"sgbd":datasource["parameters"]["sgbd"],"database":datasource["parameters"]["database"],"schema":datasource["parameters"]["schema"]};if(!goog.isDefAndNotNull(url)){console.error("url undefined");return 0}if(!goog.isDefAndNotNull(params)){console.error("params undefined");return 0}var bRequestOk=false;var canceler=$q.defer();$http({method:"GET",url:url,params:params,timeout:canceler.promise,headers:{"Accept":"application/x-vm-json"}}).then(function successCallback(response){bRequestOk=
true;if(!goog.isDef(response["data"])){bootbox.alert("response['data'] undefined");return 0}if(goog.isDef(response["data"]["errorMessage"])){bootbox.alert(response["data"]["errorType"]+": "+response["data"]["errorMessage"]);return 0}if(!goog.isDef(response["data"]["data"])){bootbox.alert(this_["text"]["Element"]["Component"]["Select"]["NoDataReturned"]);return 0}if(!goog.isArray($scope["aExternalDatabaseTables"]))$scope["aExternalDatabaseTables"]=[];else $scope["aExternalDatabaseTables"].length=0;
for(var i=0;i<response["data"]["data"].length;i++)$scope["aExternalDatabaseTables"].push(response["data"]["data"][i]["table_name"])},function errorCallback(response){bootbox.alert(response)});var showCancelRequestMessageAfterTimeout=function(){setTimeout(function(){if(bRequestOk===false)bootbox.confirm(this_["text"]["Element"]["Component"]["Select"]["Cancel"],function(result){if(result===true)canceler.resolve();else showCancelRequestMessageAfterTimeout()})},5E3)};showCancelRequestMessageAfterTimeout()};
oVFB.utils_=nsUtils;if(oProperties["mode"]==="dev")oVFB.utils_.bDebugMode=true;oVFB.log=oVFB.utils_.log;oVFB.unselectAll=oVFB.utils_.unselectAll;oVFB.reloadForm=oVFB.utils_.reloadForm;oVFB.removeWebServiceFromFields=oVFB.utils_.removeWebServiceFromFields;oVFB.JsonStringifier=oVFB.utils_.JsonStringifier;oVFB.JsonOptimizer=oVFB.utils_.JsonOptimizer;oVFB.clone=oVFB.utils_.clone;oVFB.oDevTools_={};oVFB.oJsonLoader_={};oVFB.oTreeView_={};oVFB.oFormTools_={};oVFB.oElementForm_={};oVFB.oCompoList_={};
oVFB.oVisualizer_={};oVFB.oJson_={"empty":true};oVFB.oJsonOutput_={};oVFB.sJs_="";oVFB.sCSS_="";oVFB.TimeNotify_=oProperties["timeNotify"];oVFB.Collapse_=[false,false,false,false,false];oVFB.valid=true;oVFB.aNotValid=[];oVFB.token="";oVFB.AppName="";oVFB.id=0;oVFB.el=null;oVFB.AppProperties=null;oVFB.tree_="no tree";oVFB.oJsonLoader_=new nsVFB.JsonLoader;oVFB.oFormTools_=new nsVFB.FormTools;oVFB.oElementForm_=new nsVFB.ElementForm;oVFB.oVisualizer_=new nsVFB.Visualizer;goog.provide("nsVFB.FormTools");nsVFB.FormTools=function(){oVFB.log("nsVFB.FormTools");oVFB.module.directive("appFormTools",this.formToolsDirective);oVFB.module.controller("AppFormToolsController",["$scope","$rootScope","$timeout",this.formToolsController])};nsVFB.FormTools.prototype.formToolsDirective=function(){oVFB.log("nsVFB.FormTools.FormToolsDirective");return{restrict:"A",replace:true,controller:"AppFormToolsController",controllerAs:"ctrl",scope:true,bindToController:true,templateUrl:"javascript/externs/studio/templates/FormTools.html"}};
nsVFB.FormTools.prototype.formToolsController=function($scope,$rootScope,$timeout){oVFB.log("nsVFB.FormTools.FormToolsController");var FormToolsController=this;this.$rootScope_=$rootScope;this.$scope_=$scope;this.elemAdded_=0;this["applicationName"]=oVFB.getApplication();this.bTreeWithLines_=false;$scope.$watch("text",function(){oVFB.log("formtools text");if(goog.isDef($scope["text"]["FormTools"]))FormToolsController["text"]=$scope["text"]["FormTools"]});$scope["colapse_tools"]=oVFB.Collapse_[2];
FormToolsController.convertJson=function(displayLines){oVFB.log("nsVFB.FormTools.convertJson");var oJson=oVFB.getJsonOutput();var aTree=[];if(!goog.isDef(oJson)){console.error("No JSON founded");return aTree}displayLines=goog.isDef(displayLines)?displayLines:true;if(oJson[$rootScope["selected_form_type"]]){for(var i=0;i<oJson[$rootScope["selected_form_type"]]["rows"].length;i++){if(displayLines===true)if(goog.isDefAndNotNull(this["text"]))aTree.push({"text":this["text"]["Row"]+" "+i,"state":{"expanded":true},
"tags":[0],"nodes":[],"row":i,"draggable":true});for(var j=0;j<oJson[$rootScope["selected_form_type"]]["rows"][i]["fields"].length;j++){var glyphicon;switch(oJson[$rootScope["selected_form_type"]]["rows"][i]["fields"][j]["type"]){case "codemirror":glyphicon="icon-code";break;case "select":case "list":case "double_select":glyphicon="icon-format_list_bulleted";break;case "text":case "tinymce":glyphicon="icon-font";break;case "upload":glyphicon="icon-file";break;case "checkbox":glyphicon="icon-check-square";
break;case "radio":glyphicon="icon-dot-circle-o";break;case "date":case "datetime":glyphicon="icon-calendar-check-o";break;case "password":glyphicon="icon-key";break;case "email":glyphicon="icon-at";break;case "url":glyphicon="icon-chrome";break;case "integer":case "float":case "number":glyphicon="icon-calculator";break;case "color_picker":glyphicon="icon-paint";break;case "slider":glyphicon="icon-sliders";break;case "textarea":glyphicon="icon-paragraph";break;case "hr":glyphicon="icon-minus";break;
case "label":glyphicon="icon-eye";break;case "email":glyphicon="icon-at";break;case "hidden":glyphicon="icon-user-secret";break;case "link":glyphicon="glyphicon glyphicon-link";break;case "image":glyphicon="glyphicon glyphicon-picture";break;case "map_bing":case "map_osm":case "map_vmap":glyphicon="icon-map";break;default:glyphicon="icon-point"}if(displayLines===true){if(goog.isDefAndNotNull(aTree[i])){aTree[i]["tags"][0]+=1;aTree[i]["nodes"].push({"text":"  "+oJson[$rootScope["selected_form_type"]]["rows"][i]["fields"][j]["name"],
"type":oJson[$rootScope["selected_form_type"]]["rows"][i]["fields"][j]["type"],"icon":glyphicon,"row":i,"field":j,"draggable":true})}}else aTree.push({"text":"  "+oJson[$rootScope["selected_form_type"]]["rows"][i]["fields"][j]["name"],"type":oJson[$rootScope["selected_form_type"]]["rows"][i]["fields"][j]["type"],"icon":glyphicon,"row":i,"field":j,"draggable":true})}}return aTree}};$scope.$on("updateEvent",function(){var dataWithLines=FormToolsController.convertJson(true);var collapsedNodes=$("#treeWithLines")["treeview"]("getCollapsed");
if(!goog.isDef(dataWithLines)){console.error("No JSON converted founded");return 0}if(!goog.isDef(collapsedNodes)){console.error("collapsedNodes undefined");return 0}for(var i=0;i<dataWithLines.length;i++)dataWithLines[i]["collapsed"]=false;for(var i=0;i<collapsedNodes.length;i++)if(goog.isDef(collapsedNodes[i]["nodes"]))for(var ii=0;ii<dataWithLines.length;ii++)if(collapsedNodes[i]["row"]===dataWithLines[ii]["row"])dataWithLines[ii]["collapsed"]=true;$("#treeWithLines")["treeview"]({"data":dataWithLines,
"showTags":true,"showBorder":false,"expandIcon":"glyphicon glyphicon-menu-right","collapseIcon":"glyphicon glyphicon-menu-down","onNodeSelected":function(event,data){if(goog.isDef(data["field"])){$timeout(function(){var node=$("#treeView")["treeview"]("search",[data["text"],{"ignoreCase":true,"exactMatch":true,"revealResults":false}]);$("#treeView")["treeview"]("selectNode",[node[0]["nodeId"],{silent:true}]);$("#treeView")["treeview"]("clearSearch")});FormToolsController.setSelectedElemInFormReader({"type":"element",
"element_name":data["text"].replace(/\s/g,"")});$rootScope.$broadcast("update element",oVFB.getJsonOutput()[$rootScope["selected_form_type"]]["rows"][data["row"]]["fields"][data["field"]])}else FormToolsController.setSelectedElemInFormReader({"type":"row","row_id":parseInt(data["row"])})},"onNodeUnselected":function(event,data){oVFB.unselectAll()},"onNodeHoverIn":function(event){var elem=event["currentTarget"];if($(elem)[0]["childNodes"][2]["data"]){var tmp=$(elem)[0]["childNodes"][2]["data"].split(" ");
var hoveredInTree_={"type":"row","row_id":parseInt(tmp[1])}}else var hoveredInTree_={"type":"element","element_name":$(elem)[0]["textContent"].replace(/\s/g,"")};FormToolsController.setHoveredElemInFormReader(hoveredInTree_)},"onNodeHoverOut":function(event){FormToolsController.setHoveredElemInFormReader({})},"highlightSelected":true,"multiSelect":false});$("#treeView")["treeview"]({"data":FormToolsController.convertJson(false),"showTags":false,"showBorder":false,"levels":1,"showIcon":true,"onNodeSelected":function(event,
data){if(typeof data["field"]!=="undefined"){var node=$("#treeWithLines")["treeview"]("search",[data["text"],{"ignoreCase":true,"exactMatch":true,"revealResults":false}]);var row=$("#treeWithLines")["treeview"]("search",[$scope.$parent["text"]["FormTools"]["Row"]+" "+node[0]["row"],{"ignoreCase":true,"exactMatch":true,"revealResults":false}]);$("#treeWithLines")["treeview"]("expandNode",[row[0]["nodeId"],{silent:true}]);$("#treeWithLines")["treeview"]("selectNode",[node[0]["nodeId"],{silent:false}]);
$("#treeWithLines")["treeview"]("clearSearch")}},"onNodeUnselected":function(event,data){oVFB.unselectAll()},"onNodeHoverIn":function(event){var elem=event["currentTarget"];FormToolsController.setHoveredElemInFormReader({"type":"element","element_name":$(elem)[0]["textContent"].replace(/\s/g,"")})},"onNodeHoverOut":function(event){FormToolsController.setHoveredElemInFormReader({})},"highlightSelected":true,"multiSelect":false});var elements=$("#treeWithLines")["treeview"]("getEnabled");for(var i=
0;i<elements.length;i++)if(elements[i]["collapsed"]===true)$("#treeWithLines")["treeview"]("collapseNode",elements[i])});var src={};var dst={};var ascend=true;document.getElementById("treeWithLines").addEventListener("dragstart",function(event){if($("#load_Perso_button").hasClass("active")){event["dataTransfer"]["setData"]("Text",event["target"]["id"]);event["target"]["style"]["opacity"]="0.5";event["dataTransfer"]["effectAllowed"]="move";src=event["target"];oVFB.setTreeDnD("FormTools")}});document.getElementById("treeWithLines").addEventListener("dragover",
function(event){event["preventDefault"]()});document.getElementById("treeWithLines").addEventListener("dragenter",function(event){if($("#load_Perso_button").hasClass("active")){var tmp=event["target"];if(oVFB.getTreeDnD()==="FormTools"){$(tmp).trigger("mouseover");if(tmp!==src&&$(tmp)[0].tagName==="LI"){$(src).remove();if(parseInt($(dst).attr("data-nodeid"))<parseInt($(tmp).attr("data-nodeid")))$(src).insertAfter(tmp);else $(src).insertBefore(tmp);$(dst).trigger("mouseout");dst=tmp}}}});document.getElementById("treeWithLines").addEventListener("drop",
function(event){if($("#load_Perso_button").hasClass("active")){var dst_index=0;var src_index=0;var oJson=oVFB.getJsonOutput();var tmp=0;if(oVFB.getTreeDnD()==="FormTools"){src["style"]["opacity"]="1";if(src["childNodes"][0]["className"]==="indent"){var src_id=0;var src_row=0;if(dst["childNodes"][0]["className"]==="indent"){src_id=parseInt($(src).attr("data-nodeid"));src_row=$("#treeWithLines")["treeview"]("getNode",src_id)["row"];src_index=$("#treeWithLines")["treeview"]("getNode",src_id)["field"];
var dst_id=parseInt($(dst).attr("data-nodeid"));var dst_row=$("#treeWithLines")["treeview"]("getNode",dst_id)["row"];dst_index=$("#treeWithLines")["treeview"]("getNode",dst_id)["field"];tmp=oJson[$rootScope["selected_form_type"]]["rows"][src_row]["fields"][src_index];oJson[$rootScope["selected_form_type"]]["rows"][src_row]["fields"].splice(src_index,1);oJson[$rootScope["selected_form_type"]]["rows"][dst_row]["fields"].splice(dst_index,0,tmp);if(src_row!==dst_row){FormToolsController.resizeElementsOnRow(oJson[$rootScope["selected_form_type"]]["rows"][src_row]);
FormToolsController.resizeElementsOnRow(oJson[$rootScope["selected_form_type"]]["rows"][dst_row])}if(oJson[$rootScope["selected_form_type"]]["rows"][src_row]["fields"].length===0)oJson[$rootScope["selected_form_type"]]["rows"].splice(src_row,1)}else{src_id=parseInt($(src).attr("data-nodeid"));src_row=$("#treeWithLines")["treeview"]("getNode",src_id)["row"];src_index=$("#treeWithLines")["treeview"]("getNode",src_id)["field"];dst_index=parseInt(dst["childNodes"][2]["data"].split(" ")[1]);tmp=oJson[$rootScope["selected_form_type"]]["rows"][src_row]["fields"][src_index];
oJson[$rootScope["selected_form_type"]]["rows"][src_row]["fields"].splice(src_index,1);oJson[$rootScope["selected_form_type"]]["rows"][dst_index]["fields"].unshift(tmp);FormToolsController.resizeElementsOnRow(oJson[$rootScope["selected_form_type"]]["rows"][src_row]);FormToolsController.resizeElementsOnRow(oJson[$rootScope["selected_form_type"]]["rows"][dst_index]);if(oJson[$rootScope["selected_form_type"]]["rows"][src_row]["fields"].length===0)oJson[$rootScope["selected_form_type"]]["rows"].splice(src_row,
1)}}else if(dst["childNodes"][0]["className"]==="indent")$["notify"](FormToolsController["text"]["Notify"]["Error_ElOnRow"],{"className":"error","autoHideDelay":oVFB.TimeNotify_});else{src_index=parseInt(src["childNodes"][2]["data"].split(" ")[1]);dst_index=parseInt(dst["childNodes"][2]["data"].split(" ")[1]);tmp=oJson[$rootScope["selected_form_type"]]["rows"][src_index];oJson[$rootScope["selected_form_type"]]["rows"].splice(src_index,1);oJson[$rootScope["selected_form_type"]]["rows"].splice(dst_index,
0,tmp)}}oVFB.setJsonOutput(oJson);$(".hover-in-tree").each(function(index,element){$(element).removeClass("hover-in-tree")});$(".selected-in-tree").removeClass("selected-in-tree");$rootScope.$broadcast("updateEvent",oVFB.getJsonOutput());oVFB.setTreeDnD("no tree");$scope.$apply()}});document.getElementById("treeView").addEventListener("dragstart",function(event){if($("#load_Perso_button").hasClass("active")){event["dataTransfer"]["setData"]("Text",event["target"]["id"]);event["target"]["style"]["opacity"]=
"0.5";event["dataTransfer"]["effectAllowed"]="move";src=event["target"];oVFB.setTreeDnD("treeView")}});document.getElementById("treeView").addEventListener("dragover",function(event){event["preventDefault"]()});document.getElementById("treeView").addEventListener("dragenter",function(event){if($("#load_Perso_button").hasClass("active")){var tmp=event["target"];if(oVFB.getTreeDnD()==="treeView"){$(tmp).trigger("mouseover");if(tmp!==src&&$(tmp)[0].tagName==="LI")if(parseInt($(dst).attr("data-nodeid"))<
parseInt($(tmp).attr("data-nodeid"))){$(src).remove();$(src).insertAfter(tmp);$(dst).trigger("mouseout");dst=tmp;ascend=false}else{$(src).remove();$(src).insertBefore(tmp);$(dst).trigger("mouseout");dst=tmp;ascend=true}}}});document.getElementById("treeView").addEventListener("drop",function(event){if($("#load_Perso_button").hasClass("active")){var dst_index=0;var src_index=0;var oJson=oVFB.getJsonOutput();var tmp=0;if(oVFB.getTreeDnD()==="treeView"){src["style"]["opacity"]="1";var src_id=parseInt($(src).attr("data-nodeid"));
var src_row=$("#treeView")["treeview"]("getNode",src_id)["row"];var src_index=$("#treeView")["treeview"]("getNode",src_id)["field"];var dst_id=parseInt($(dst).attr("data-nodeid"));var dst_row=$("#treeView")["treeview"]("getNode",dst_id)["row"];dst_index=$("#treeView")["treeview"]("getNode",dst_id)["field"];tmp=oJson[$rootScope["selected_form_type"]]["rows"][src_row]["fields"][src_index];oJson[$rootScope["selected_form_type"]]["rows"][src_row]["fields"].splice(src_index,1);if(!ascend)dst_index+=1;
oJson[$rootScope["selected_form_type"]]["rows"][dst_row]["fields"].splice(dst_index,0,tmp);if(oJson[$rootScope["selected_form_type"]]["rows"][src_row]["fields"].length===0)oJson[$rootScope["selected_form_type"]]["rows"].splice(src_row,1)}oVFB.setJsonOutput(oJson);$(".hover-in-tree").each(function(index,element){$(element).removeClass("hover-in-tree")});$(".selected-in-tree").removeClass("selected-in-tree");$rootScope.$broadcast("updateEvent",oVFB.getJsonOutput());$scope.$apply();oVFB.setTreeDnD("no tree")}});
FormToolsController["resize"]=function(){$scope["colapse_tools"]=!$scope["colapse_tools"];oVFB.Collapse_[2]=$scope["colapse_tools"];oVFB.resize()}};
nsVFB.FormTools.prototype.formToolsController.prototype.addLine=function(){oVFB.log("nsVFB.FormTools.prototype.formToolsController.prototype.addLine");var this_=this;var aSelectedNode=$("#treeWithLines")["treeview"]("getSelected");var data=oVFB.getJsonOutput();if(aSelectedNode.length!==1)aSelectedNode=[this.getLastLine()];if(goog.isDef(aSelectedNode[0]["field"]))aSelectedNode=[$("#treeWithLines")["treeview"]("getNode",aSelectedNode[0]["parentId"])];if(aSelectedNode.length===1){if(!goog.isDef(aSelectedNode[0]["field"]))data[this.$rootScope_["selected_form_type"]]["rows"].splice(aSelectedNode[0]["row"]+
1,0,{"fields":[]})}else $["notify"](this["text"]["Notify"]["Forgotten"],{"className":"error","autoHideDelay":oVFB.TimeNotify_});$(".selected-in-tree").each(function(index,element){$(element).removeClass("selected-in-tree")});oVFB.setJsonOutput(data);this.$rootScope_.$broadcast("updateEvent",oVFB.getJsonOutput())};
nsVFB.FormTools.prototype.formToolsController.prototype.addElement=function(){oVFB.log("nsVFB.FormTools.prototype.formToolsController.prototype.addElement");var this_=this;var aSelectedNode=$("#treeWithLines")["treeview"]("getSelected");var data=oVFB.getJsonOutput();var lineAdded=false;if(aSelectedNode.length!==1){var lastLine=this.getLastLine();if(this.bTreeWithLines_||!goog.isDef(lastLine["nodes"])){this.addLine();lastLine=this.getLastLine();lineAdded=true}aSelectedNode=[lastLine]}if(aSelectedNode.length===
1){var checkElementAdded=function(rows){for(var i=0;i<rows.length;i++){if(!goog.isDef(rows[i]["fields"]))continue;for(var ii=0;ii<rows[i]["fields"].length;ii++)if(rows[i]["fields"][ii]["name"]==="Element_"+this_.elemAdded_){this_.elemAdded_++;checkElementAdded(rows);return 0}}};var rows=oVFB.getJsonOutput()[this.$rootScope_["selected_form_type"]]["rows"];checkElementAdded(rows);var elemName="Element_"+this.elemAdded_;var newElem={"type":"text","name":elemName,"label":"","required":false,"pattern":"",
"nb_cols":12};var selectedNodeId=aSelectedNode[0]["nodeId"];if(this.bTreeWithLines_){data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"].splice(aSelectedNode[0]["field"]+1,0,newElem);selectedNodeId=selectedNodeId+1}else if(!lineAdded){this.addLine();data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]+1]["fields"].push(newElem);var lastLine=this.getLastLine()["nodeId"]+1;if(aSelectedNode[0]["row"]+1===data[this.$rootScope_["selected_form_type"]]["rows"].length-
1)selectedNodeId=selectedNodeId+2+data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"].length;else selectedNodeId=selectedNodeId+1+data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"].length}else{data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"].push(newElem);selectedNodeId=selectedNodeId+2}var row=data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]];this.resizeElementsOnRow(row);
if(goog.isDefAndNotNull(data[this.$rootScope_["selected_form_type"]]["tabs"]))if(goog.isDefAndNotNull(data[this.$rootScope_["selected_form_type"]]["tabs"]["list"]))if(goog.isDefAndNotNull(data[this.$rootScope_["selected_form_type"]]["tabs"]["list"][0]))if(goog.isArray(data[this.$rootScope_["selected_form_type"]]["tabs"]["list"][0]["elements"]))data[this.$rootScope_["selected_form_type"]]["tabs"]["list"][0]["elements"].push(elemName);oVFB.setJsonOutput(data);this.$rootScope_.$broadcast("updateEvent",
oVFB.getJsonOutput());$("#TreeView_Button_Group")["confirmation"]("destroy");$("#treeWithLines")["treeview"]("selectNode",[selectedNodeId,{silent:false}])}else $["notify"](this["text"]["Notify"]["Forgotten"],{"className":"error","autoHideDelay":oVFB.TimeNotify_})};
nsVFB.FormTools.prototype.formToolsController.prototype.removeElement=function(){oVFB.log("nsVFB.FormTools.prototype.formToolsController.prototype.removeElement");var aSelectedNode=$("#treeWithLines")["treeview"]("getSelected");var data=oVFB.getJsonOutput();var this_=this;if(aSelectedNode.length===0){$["notify"](this["text"]["Notify"]["Forgotten"],{"className":"error","autoHideDelay":oVFB.TimeNotify_});return 0}if(goog.isDef(aSelectedNode[0]["nodes"]))if(aSelectedNode[0]["nodes"].length>1){$["notify"](this["text"]["Notify"]["Multiple_elements"],
{"className":"error","autoHideDelay":oVFB.TimeNotify_});return 0}if(aSelectedNode.length===1)bootbox.confirm("<h4>"+this["text"]["Confirmation"]["Remove"]+"</h4>",function(result){if(result===true){var row=data[this_.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]];var oElem=row["fields"][aSelectedNode[0]["field"]];var sElemName=oElem["name"];if(goog.isDefAndNotNull(sElemName))if(goog.isDefAndNotNull(data[this_.$rootScope_["selected_form_type"]]["tabs"])){var aList=data[this_.$rootScope_["selected_form_type"]]["tabs"]["list"];
if(goog.isArray(aList))for(var i=0;i<aList.length;i++)if(goog.isArray(aList[i]["elements"]))if(aList[i]["elements"].indexOf(sElemName)!==-1)aList[i]["elements"].splice(aList[i]["elements"].indexOf(sElemName),1)}if(goog.isDefAndNotNull(sElemName)){var oWab=data[this_.$rootScope_["selected_form_type"]]["wab"];if(goog.isDefAndNotNull(oWab))for(var sState in oWab)for(var sGroup in oWab[sState])if(goog.isDefAndNotNull(oWab[sState][sGroup][sElemName]))delete oWab[sState][sGroup][sElemName]}row["fields"].splice(aSelectedNode[0]["field"],
1);if(data[this_.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"].length===0)data[this_.$rootScope_["selected_form_type"]]["rows"].splice(aSelectedNode[0]["row"],1);this_.resizeElementsOnRow(row);$(".selected-in-tree").each(function(index,element){$(element).removeClass("selected-in-tree")});oVFB.unselectAll();oVFB.setJsonOutput(data);this_.$rootScope_.$broadcast("updateEvent",oVFB.getJsonOutput());this_.$scope_.$apply();$("#Formtools_buttons")["confirmation"]("destroy");
$["notify"](this_["text"]["Notify"]["Remove"],{"className":"success","autoHideDelay":oVFB.TimeNotify_})}});else $["notify"](this["text"]["Notify"]["Forgotten"],{"className":"error","autoHideDelay":oVFB.TimeNotify_})};
nsVFB.FormTools.prototype.formToolsController.prototype.up=function(){oVFB.log("nsVFB.FormTools.prototype.formToolsController.prototype.up");var this_=this;var aSelectedNode=$("#treeWithLines")["treeview"]("getSelected");var selectedNodeId=aSelectedNode[0]["nodeId"];var data=oVFB.getJsonOutput();if(aSelectedNode.length===1)if(!goog.isDef(aSelectedNode[0]["field"])){if(aSelectedNode[0]["row"]-1>=0){var row=aSelectedNode[0]["row"];var treeLine=aSelectedNode[0];var treePreviousLine=this.getPreviousLineBeforeIndex(selectedNodeId);
var aCollapsedElements=$("#treeWithLines")["treeview"]("getCollapsed");treeLine["collapsed"]=goog.object.contains(aCollapsedElements,treeLine);treePreviousLine["collapsed"]=goog.object.contains(aCollapsedElements,treePreviousLine);if(treePreviousLine["collapsed"]===true)$("#treeWithLines")["treeview"]("collapseNode",treeLine["nodeId"]);else $("#treeWithLines")["treeview"]("expandNode",treeLine["nodeId"]);if(treeLine["collapsed"]===true)$("#treeWithLines")["treeview"]("collapseNode",treePreviousLine["nodeId"]);
else $("#treeWithLines")["treeview"]("expandNode",treePreviousLine["nodeId"]);var tmp=treeLine["collapsed"];treeLine["collapsed"]=treePreviousLine["collapsed"];treePreviousLine["collapsed"]=treeLine["collapsed"];var tmp=data[this.$rootScope_["selected_form_type"]]["rows"][row-1];data[this.$rootScope_["selected_form_type"]]["rows"][row-1]=data[this.$rootScope_["selected_form_type"]]["rows"][row];data[this.$rootScope_["selected_form_type"]]["rows"][row]=tmp}var previousLine=this.getPreviousLineBeforeIndex(selectedNodeId);
selectedNodeId=previousLine["nodeId"];if(!this.bTreeWithLines_)selectedNodeId=previousLine["nodes"][0]["nodeId"]}else if(aSelectedNode[0]["field"]-1>=0){var tmp=data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"][aSelectedNode[0]["field"]-1];data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"][aSelectedNode[0]["field"]-1]=data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"][aSelectedNode[0]["field"]];
data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"][aSelectedNode[0]["field"]]=tmp;selectedNodeId--}else{var courant=data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"][aSelectedNode[0]["field"]];if(aSelectedNode[0]["row"]===0){this.addLine();data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]+1]["fields"].push(courant);data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"].splice(aSelectedNode[0]["field"],
1);var tmpLine=data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]];data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]=data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]+1];data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]+1]=tmpLine;this.resizeElementsOnRow(data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]);this.resizeElementsOnRow(data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]+
1]);selectedNodeId=1;$("#treeWithLines")["treeview"]("expandNode",this.getNextLineAfterIndex(selectedNodeId))}else if(!this.bTreeWithLines_){var currentLine=this.getPreviousLineBeforeIndex(selectedNodeId);if(currentLine["nodes"].length===1){$("#treeWithLines")["treeview"]("selectNode",[currentLine["nodeId"],{silent:true}]);this.up();return 0}else{this.addLine();data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]+1]["fields"].push(courant);data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"].splice(aSelectedNode[0]["field"],
1);var tmpLine=data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]];data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]=data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]+1];data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]+1]=tmpLine;this.resizeElementsOnRow(data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]);this.resizeElementsOnRow(data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]+
1])}}else{data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]-1]["fields"].push(courant);data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"].splice(aSelectedNode[0]["field"],1);this.resizeElementsOnRow(data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]-1]);this.resizeElementsOnRow(data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]);if(data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"].length===
0)data[this.$rootScope_["selected_form_type"]]["rows"].splice(aSelectedNode[0]["row"],1);selectedNodeId--;var newLineId=this.getPreviousLineBeforeIndex(selectedNodeId);$("#treeWithLines")["treeview"]("expandNode",newLineId)}}else $["notify"](this["text"]["Notify"]["Forgotten"],{"className":"error","autoHideDelay":oVFB.TimeNotify_});for(var i=0;i<data[this.$rootScope_["selected_form_type"]]["rows"].length;i++)if(data[this.$rootScope_["selected_form_type"]]["rows"][i]["fields"].length===0)data[this.$rootScope_["selected_form_type"]]["rows"].splice(i,
1);oVFB.setJsonOutput(data);this.$rootScope_.$broadcast("updateEvent",oVFB.getJsonOutput());$("#treeWithLines")["treeview"]("selectNode",[selectedNodeId,{silent:false}])};
nsVFB.FormTools.prototype.formToolsController.prototype.down=function(){oVFB.log("nsVFB.FormTools.prototype.formToolsController.prototype.down");var this_=this;var aSelectedNode=$("#treeWithLines")["treeview"]("getSelected");var selectedNodeId=aSelectedNode[0]["nodeId"];var data=oVFB.getJsonOutput();if(aSelectedNode.length===1)if(!goog.isDef(aSelectedNode[0]["field"])){if(aSelectedNode[0]["row"]+1<data[this.$rootScope_["selected_form_type"]]["rows"].length){var treeLine=aSelectedNode[0];var treeNextLine=
this.getNextLineAfterIndex(selectedNodeId);var aCollapsedElements=$("#treeWithLines")["treeview"]("getCollapsed");treeLine["collapsed"]=goog.object.contains(aCollapsedElements,treeLine);treeNextLine["collapsed"]=goog.object.contains(aCollapsedElements,treeNextLine);if(treeNextLine["collapsed"]===true)$("#treeWithLines")["treeview"]("collapseNode",treeLine["nodeId"]);else $("#treeWithLines")["treeview"]("expandNode",treeLine["nodeId"]);if(treeLine["collapsed"]===true)$("#treeWithLines")["treeview"]("collapseNode",
treeNextLine["nodeId"]);else $("#treeWithLines")["treeview"]("expandNode",treeNextLine["nodeId"]);var tmp=treeLine["collapsed"];treeLine["collapsed"]=treeNextLine["collapsed"];treeNextLine["collapsed"]=treeLine["collapsed"];var tmp=data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]+1];data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]+1]=data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]];data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]=
tmp}else{if(!this.bTreeWithLines_)$("#treeWithLines")["treeview"]("selectNode",[selectedNodeId+1,{silent:false}]);return 0}oVFB.setJsonOutput(data);this.$rootScope_.$broadcast("updateEvent",oVFB.getJsonOutput());var nextLine=this.getNextLineAfterIndex(selectedNodeId);selectedNodeId=nextLine["nodeId"];if(!this.bTreeWithLines_)selectedNodeId++}else if(aSelectedNode[0]["field"]+1<data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"].length){var tmp=data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"][aSelectedNode[0]["field"]+
1];data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"][aSelectedNode[0]["field"]+1]=data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"][aSelectedNode[0]["field"]];data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"][aSelectedNode[0]["field"]]=tmp;selectedNodeId++}else{var courant=data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"][aSelectedNode[0]["field"]];
if(!this.bTreeWithLines_)if($("#treeWithLines")["treeview"]("getNode",aSelectedNode[0]["parentId"])["nodes"].length===1){$("#treeWithLines")["treeview"]("selectNode",[aSelectedNode[0]["parentId"],{silent:false}]);this.down();return 0}else if(goog.isDef($("#treeWithLines")["treeview"]("getNode",aSelectedNode[0]["nodeId"]+1)["nodes"]))this.addLine();if(!goog.isDef(data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]+1]))this.addLine();data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]+
1]["fields"].unshift(courant);data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"].splice(aSelectedNode[0]["field"],1);this.resizeElementsOnRow(data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]+1]);this.resizeElementsOnRow(data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]);$("#treeWithLines")["treeview"]("expandNode",this.getNextLineAfterIndex(selectedNodeId));if(data[this.$rootScope_["selected_form_type"]]["rows"][aSelectedNode[0]["row"]]["fields"].length===
0)data[this.$rootScope_["selected_form_type"]]["rows"].splice(aSelectedNode[0]["row"],1);else selectedNodeId++}else $["notify"](this["text"]["Notify"]["Forgotten"],{"className":"error","autoHideDelay":oVFB.TimeNotify_});oVFB.setJsonOutput(data);this.$rootScope_.$broadcast("updateEvent",oVFB.getJsonOutput());$("#treeWithLines")["treeview"]("selectNode",[selectedNodeId,{silent:false}])};
nsVFB.FormTools.prototype.formToolsController.prototype.getLastLine=function(){oVFB.log("nsVFB.FormTools.prototype.formToolsController.prototype.getLastLine");var lastNodeIndex=this.getLastNodeIndex();var tmpNode;for(var i=lastNodeIndex;i>=0;i--){tmpNode=$("#treeWithLines")["treeview"]("getNode",i);if(!goog.isDef(tmpNode["field"]))return tmpNode}return $("#treeWithLines")["treeview"]("getNode",0)};
nsVFB.FormTools.prototype.formToolsController.prototype.getLastElement=function(){oVFB.log("nsVFB.FormTools.prototype.formToolsController.prototype.getLastElement");var lastNodeIndex=this.getLastNodeIndex();var tmpNode;for(var i=lastNodeIndex;i>=0;i--){tmpNode=$("#treeWithLines")["treeview"]("getNode",i);if(goog.isDef(tmpNode["field"]))return tmpNode}return $("#treeWithLines")["treeview"]("getNode",0)};
nsVFB.FormTools.prototype.formToolsController.prototype.getNextLineAfterIndex=function(index){oVFB.log("nsVFB.FormTools.prototype.formToolsController.prototype.getNextLineAfterIndex");var lastNodeIndex=this.getLastNodeIndex();var tmpNode;if(!goog.isDef($("#treeWithLines")["treeview"]("getNode",index)["field"]))index++;for(var i=index;i<lastNodeIndex;i++){tmpNode=$("#treeWithLines")["treeview"]("getNode",i);if(!goog.isDef(tmpNode["field"]))return tmpNode}return $("#treeWithLines")["treeview"]("getNode",
0)};nsVFB.FormTools.prototype.formToolsController.prototype.getPreviousLineBeforeIndex=function(index){oVFB.log("nsVFB.FormTools.prototype.formToolsController.prototype.getPreviousLineBeforeIndex");var tmpNode;if(!goog.isDef($("#treeWithLines")["treeview"]("getNode",index)["field"]))index--;for(var i=index-1;i>=0;i--){tmpNode=$("#treeWithLines")["treeview"]("getNode",i);if(!goog.isDef(tmpNode["field"]))return tmpNode}return $("#treeWithLines")["treeview"]("getNode",0)};
nsVFB.FormTools.prototype.formToolsController.prototype.getLastNodeIndex=function(){oVFB.log("nsVFB.FormTools.prototype.formToolsController.prototype.getLastNodeIndex");var data=oVFB.getJsonOutput();var counter=0;for(var i=0;i<data[this.$rootScope_["selected_form_type"]]["rows"].length;i++){counter++;for(var ii=0;ii<data[this.$rootScope_["selected_form_type"]]["rows"][i]["fields"].length;ii++)counter++}return counter-1};
nsVFB.FormTools.prototype.formToolsController.prototype.resizeElementsOnRow=function(row){oVFB.log("nsVFB.FormTools.prototype.formToolsController.prototype.resizeElementsOnRow");var numberOfElements=row["fields"].length;var newLength=parseInt(12/numberOfElements);for(var i=0;i<row["fields"].length;i++)row["fields"][i]["nb_cols"]=newLength};
nsVFB.FormTools.prototype.formToolsController.prototype.setSelectedElemInFormReader=function(selectedInTree){angular.element($("#FormModal")).scope()["ctrl"].setSelectedElem(selectedInTree,this.$scope_["selected_form_type"])};nsVFB.FormTools.prototype.formToolsController.prototype.setHoveredElemInFormReader=function(hoverInTree){angular.element($("#FormModal")).scope()["ctrl"].setHoveredElem(hoverInTree,this.$scope_["selected_form_type"])};goog.provide("nsVFB.JsonLoader");nsVFB.JsonLoader=function(){oVFB.log("nsVFB.JsonLoader");this.slider=null;oVFB.module.directive("appJsonLoader",this.jsonLoaderDirective);oVFB.module.controller("AppJsonLoaderController",["$http","$scope","$rootScope","$timeout",this.jsonLoaderController])};
nsVFB.JsonLoader.prototype.jsonLoaderDirective=function(){oVFB.log("nsVFB.JsonLoader.jsonLoaderDirective");return{restrict:"A",replace:true,controller:"AppJsonLoaderController",controllerAs:"ctrl",scope:true,bindToController:true,templateUrl:"javascript/externs/studio/templates/JsonLoader.html"}};
nsVFB.JsonLoader.prototype.jsonLoaderController=function($http,$scope,$rootScope,$timeout){oVFB.log("nsVFB.JsonLoader.jsonLoaderController");var this_=this;this.$http_=$http;this.$scope_=$scope;this.$rootScope_=$rootScope;this.tmpForm_={};this["buttonHide"]=false;this["applicationName"]=oVFB.getApplication();$scope["collapsed"]=oVFB.Collapse_[0];$scope["iWorkspaceId"]=oVFB.getId();$scope["iWorkSpace"]=oVFB.getId();$scope["default"]="Default";$scope["FormSelected"]="Perso";$scope["token"]=oVFB.getToken();
$rootScope["selected_form_type"]=oVFB["config"]["default_form_type"];$rootScope.$watch("selected_form_type",function(value){oVFB.log("jsonLoaderController selected_form_type");var oJSONform=oVFB.getJsonOutput();if(!goog.isDefAndNotNull(oJSONform[value])){oJSONform[value]={"name":"custom-form","title":"","input_size":"xxs","nb_cols":12,"javascript":false,"rows":[]};oVFB.setJsonOutput(oJSONform)}$rootScope.$broadcast("updateEvent",oVFB.getJsonOutput());$rootScope.$broadcast("update element",{type:"undefined"})});
oVFB.getJsonLoader().slider=new Slider("#slider_Form",{"formatter":function(value){return Math.round(value*100/12)+"%"}});oVFB.getJsonLoader().slider.on("change",function(){var tmp=oVFB.getJsonOutput();tmp[$rootScope["selected_form_type"]]["nb_cols"]=oVFB.getJsonLoader().slider["getValue"]();oVFB.setJsonOutput(tmp);$timeout(function(){$rootScope.$broadcast("updateJsonModel",oVFB.getJsonOutput());$rootScope.$broadcast("updateForm",oVFB.getJsonOutput());$scope.$apply()},1)});$scope.$watch("title",function(value){oVFB.log("jsonLoaderController title");
var tmp=oVFB.getJsonOutput();if(tmp[$rootScope["selected_form_type"]])tmp[$rootScope["selected_form_type"]]["title"]=value;oVFB.setJsonOutput(tmp);$rootScope.$broadcast("updateJsonModel",oVFB.getJsonOutput());$rootScope.$broadcast("updateForm",oVFB.getJsonOutput())});$scope.$watch("event",function(value){oVFB.log("jsonLoaderController event");var tmp=oVFB.getJsonOutput();if(tmp[$rootScope["selected_form_type"]])tmp[$rootScope["selected_form_type"]]["event"]=value;oVFB.setJsonOutput(tmp);$rootScope.$broadcast("updateJsonModel",
oVFB.getJsonOutput());$rootScope.$broadcast("updateForm",oVFB.getJsonOutput())});$scope.$watch("token",function(value){oVFB.log("jsonLoaderController token");oVFB["setToken"](value)});$scope.$watch("iWorkspaceId",function(value){oVFB.log("jsonLoaderController id");oVFB["setId"](value)});$scope.$watch("text",function(){oVFB.log("jsonLoaderController text");if(typeof $scope["text"]["Loader"]!=="undefined"){this_["text"]=$scope["text"]["Loader"];$timeout(function(){angular.element($("#load_Perso_button")).click();
if(oVFB.getApplication()=="wab")this_["buttonHide"]=true},500)}});$scope.state=false};
nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.requestToJson=function(successCallback,errorCallback){oVFB.log("nsVFB.JsonLoader.prototype.jsonLoaderController.requestToJson");var this_=this;var $http=this.$http_;var config={};angular.element($("#FormModal")).scope()["ctrl"].emptyFormValues();this.$scope_["iWorkSpace"]=this.$scope_["iWorkspaceId"];this.$scope_["default"]=this.$scope_["FormSelected"];this.$scope_["collapsed"]=oVFB.Collapse_[0];if(this["applicationName"]==="gtf"){var url=
oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/gtf/workspaces/"+oVFB.getId()+"?token="+oVFB.getToken()+"&form="+this.$scope_["FormSelected"];config={headers:{"Accept":"application/json"}}}else if(this["applicationName"]==="vmap"){var form=this.$scope_["FormSelected"]==="Perso"?"custom":angular.lowercase(this.$scope_["FormSelected"]);var url=oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/"+oVFB["config"]["get"]["api"]+"/"+oVFB["config"]["get"]["ressource"]+
"/"+oVFB.getId()+"/forms/"+form+"/?token="+oVFB.getToken()}else if(this["applicationName"]==="wab")url=oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/"+oVFB["config"]["get"]["api"]+"/"+oVFB["config"]["get"]["ressource"]+"/"+oVFB.getId()+"/form?token="+oVFB.getToken();showAjaxLoader();$http({method:"GET",url:url,headers:config.headers}).success(function(data){hideAjaxLoader();if(!goog.isDefAndNotNull(data[0]))if(goog.isDefAndNotNull(data["data"]))data=data["data"];
if(this_["applicationName"]==="gtf"){if(!goog.isDefAndNotNull(data["workspaces"])&&!goog.isDefAndNotNull(data["data"])){var cmd;switch(this_.$scope_["FormSelected"]){case "Default":cmd="Default_Reset";break;case "Published":cmd="Default_Published";break;case "Perso":cmd="Perso_Reset";break}this_.putRequest(cmd,undefined,function(data){if(goog.isDefAndNotNull(data["errorMessage"])){bootbox.alert("<h4>"+data["errorMessage"]+"</h4>",function(){});return 0}this_.requestToJson()},function(data,status){$["notify"](this_.$scope_["text"]["Loader"]["Notify"]["GetJson_Error"]+
status,{"className":"error","autoHideDelay":oVFB.TimeNotify_})})}}else if(!goog.isDefAndNotNull(data[0])){if(goog.isDefAndNotNull(oVFB["config"]["get"]["no_result_function"]))this_[oVFB["config"]["get"]["no_result_function"]](data,successCallback);return 0}this_.useJson(data,successCallback)}).error(function(data,status){hideAjaxLoader();if(goog.isFunction(errorCallback))this_.$scope_.$eval(errorCallback);$["notify"](this_.$scope_["text"]["Loader"]["Notify"]["GetJson_Error"]+status,{"className":"error",
"autoHideDelay":oVFB.TimeNotify_})})};
nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.useJson=function(data,successCallback){oVFB.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.useJson");var $http=this.$http_;if(this["applicationName"]==="gtf")if(goog.isDefAndNotNull(data["workspaces"]))data=data["workspaces"][0]["json_form"];else data=data["data"][0]["json_form"];if(!goog.isDefAndNotNull(data[0])){console.error("data[0] not defined, data: ",data);return 0}oVFB.setJson(angular.copy(data[0]));oVFB.setJsonOutput(angular.copy(data[0]));
this.tmpForm_=angular.copy(data[0]);if(goog.isDefAndNotNull(oVFB["config"]["avaliable_form_types"]))this.$scope_["json_forms"]=oVFB["config"]["avaliable_form_types"];else this.$scope_["json_forms"]=Object.keys(data[0]);if(this.$scope_["json_forms"].indexOf("datasources")!==-1)this.$scope_["json_forms"].splice(this.$scope_["json_forms"].indexOf("datasources"),1);if(goog.isDef(data[1])&&data[1]!==false){if(this["applicationName"]==="gtf")$http({method:"GET",url:data[1]}).then(function successCallback(response){if(goog.isDefAndNotNull(response.data))oVFB.setJs(response.data.replace(/(?:\r\n|\r|\n)/g,
"\r\n"))},function errorCallback(response){console.error("Problem on Loading javascript");console.error(response)});else oVFB.setJs(oVFB.clone(data[1]));this.$rootScope_.$broadcast("updateJS",oVFB.getJs())}else{oVFB.setJs("");this.$rootScope_.$broadcast("updateJS",oVFB.getJs())}if(goog.isDef(data[2])&&data[2]!==false){oVFB.setCss(oVFB.clone(data[2]));this.$rootScope_.$broadcast("updateCSS",data[2])}if(!goog.isDefAndNotNull(data[0][this.$rootScope_["selected_form_type"]])){console.error("Result[0]["+
this.$rootScope_["selected_form_type"]+"] does not exist");return 0}var nbCols=data[0][this.$rootScope_["selected_form_type"]]["nb_cols"];var title=oVFB.getJsonOutput()[this.$rootScope_["selected_form_type"]]["title"];var event=oVFB.getJsonOutput()[this.$rootScope_["selected_form_type"]]["event"];var inputSize=oVFB.getJsonOutput()[this.$rootScope_["selected_form_type"]]["input_size"];oVFB.getJsonLoader().slider["setValue"](nbCols);this.$scope_["title"]=title;this.$scope_["event"]=event;this.$scope_["input_size"]=
inputSize;this.$rootScope_.$broadcast("updateEvent",oVFB.getJsonOutput());this.$rootScope_.$broadcast("updateInfos",oVFB.getJsonOutput());this.$rootScope_.$broadcast("update element",{type:"undefined"});if(goog.isFunction(successCallback))this.$scope_.$eval(successCallback);setTimeout(function(){oVFB.reloadForm()})};nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.load=function(mode,el){oVFB.log("load");if(mode==="Perso")this.loadWithEdit(true,mode,el);else this.loadWithoutEdit(mode,el)};
nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.updateSlider=function(){var nbCols=oVFB.getJsonOutput()[this.$rootScope_["selected_form_type"]]["nb_cols"];oVFB.getJsonLoader().slider["setValue"](nbCols)};
nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.loadWithEdit=function(target,mode,element){oVFB.log("nsVFB.JsonLoader.jsonLoaderController.loadWithEdit");var this_=this;var el="";if(target)el="#json_loader_Mode_groupButton";else el="#json_loader_Actions_groupButton";var unlock=function(){$("#up_element_button").prop("disabled",false);$("#down_element_button").prop("disabled",false);$("#add_line_button").prop("disabled",false);$("#add_row_button").prop("disabled",false);$("#rem_element_button").prop("disabled",
false);$("#formTools_datasoure_button").prop("disabled",false);$("#Title_Form_input").prop("disabled",false);$("#select_size_input").prop("disabled",false);oVFB.getJsonLoader().slider["enable"]();$("#boolean-JS-include").prop("disabled",false);$("#boolean-CSS-include").prop("disabled",false);$("#Lock_Icon").removeClass("fa-lock");$(".selected-in-tree").removeClass("selected-in-tree")};if(!oVFB.getJson()["empty"]&&this_.$scope_["default"]==="Perso")bootbox.confirm("<h4>"+this["text"]["Confirmation"]["Lose"]+
"</h4>",function(result){if(result===true){angular.element($("#FormModal")).scope()["ctrl"].emptyFormValues();this_.$scope_["FormSelected"]=mode;this_.requestToJson();unlock()}});else if(this_.$scope_["default"]!=="Perso"){this_.$scope_["FormSelected"]=mode;this_.requestToJson();unlock()}else{this_.requestToJson();this_.$scope_["FormSelected"]=mode}};
nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.loadWithoutEdit=function(mode,el){oVFB.log("nsVFB.JsonLoader.jsonLoaderController.loadWithoutEdit");var this_=this;var lock=function(){$("#up_element_button").prop("disabled",true);$("#down_element_button").prop("disabled",true);$("#add_line_button").prop("disabled",true);$("#add_row_button").prop("disabled",true);$("#rem_element_button").prop("disabled",true);$("#formTools_datasoure_button").prop("disabled",true);$("#Title_Form_input").prop("disabled",
true);$("#select_size_input").prop("disabled",true);oVFB.getJsonLoader().slider["disable"]();$("#boolean-JS-include").prop("disabled",true);$("#boolean-CSS-include").prop("disabled",true);this_.$rootScope_.$broadcast("update element",{});$("#Lock_Icon").addClass("fa-lock");$(".selected-in-tree").removeClass("selected-in-tree")};if(!oVFB.getJson()["empty"]&&this_.$scope_["default"]==="Perso")if(angular.equals(oVFB.getJson(),this_.tmpForm_)){angular.element($("#FormModal")).scope()["ctrl"].emptyFormValues();
this_.$scope_["FormSelected"]=mode;this_.requestToJson();lock()}else bootbox.dialog({message:"<h4>"+this_["text"]["Confirmation"]["Lose"]+"<br><br>"+this_["text"]["Confirmation"]["SaveAndChange"]+" ?</h4>",buttons:{success:{label:this_["text"]["Confirmation"]["Yes"],className:"btn-primary",callback:function(){this_.save(function(){this_.$scope_["FormSelected"]=mode;this_.requestToJson();lock()})}},danger:{label:this_["text"]["Confirmation"]["No"],className:"btn-danger",callback:function(){this_.$scope_["FormSelected"]=
mode;this_.requestToJson();lock()}},main:{label:this_["text"]["Confirmation"]["Cancel"],className:"btn-default",callback:function(){}}}});else if(this_.$scope_["default"]!=="Perso"){this_.$scope_["FormSelected"]=mode;this_.requestToJson();lock()}};nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.resize=function(){this.$scope_["collapsed"]=!this.$scope_["collapsed"];oVFB.Collapse_[0]=this.$scope_["collapsed"];oVFB.resize()};
nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.save=function(successCallback,errorCallback){oVFB.log("nsVFB.JsonLoader.jsonLoaderController.save");var this_=this;var data=new FormData;var tmp=oVFB.getJsonOutput();oVFB.unselectAll();if(this["applicationName"]==="gtf"){tmp[this_.$rootScope_["selected_form_type"]]["name"]="WSubform";tmp["display"]=tmp[this_.$rootScope_["selected_form_type"]];tmp["update"]=tmp[this_.$rootScope_["selected_form_type"]]}if(!goog.isDef(tmp["search"]))tmp["search"]=
{};data.append("Json",JSON.stringify(tmp));data.append("Js",oVFB.getJs());data.append("Css",oVFB.getCss());var success=function(){this_.requestToJson(successCallback);$["notify"](this_.$scope_["text"]["Loader"]["Notify"]["SaveData"],{"className":"success","autoHideDelay":oVFB.TimeNotify_})};var error=function(data,status){if(goog.isFunction(errorCallback))this_.$scope_.$eval(errorCallback);$["notify"](this_.$scope_["text"]["Loader"]["Notify"]["SaveData_Error"]+status,{"className":"error","autoHideDelay":oVFB.TimeNotify_})};
oVFB.valid=this.isValid(tmp);if(oVFB.valid&&tmp!==null)this_.putRequest("Perso_Save",data,success,error);else $["notify"](this_.$scope_["text"]["Loader"]["Notify"]["Validation_Error"]+": "+oVFB.aNotValid,{"className":"error","autoHideDelay":oVFB.TimeNotify_})};
nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.publish=function(){oVFB.log("nsVFB.JsonLoader.prototype.jsonLoaderController.publish");var this_=this;var data=new FormData;var tmp=oVFB.getJsonOutput();oVFB.unselectAll();if(this["applicationName"]==="gtf"){tmp[this_.$rootScope_["selected_form_type"]]["name"]="WSubform";tmp["display"]=tmp[this_.$rootScope_["selected_form_type"]];tmp["update"]=tmp[this_.$rootScope_["selected_form_type"]]}data.append("Json",JSON.stringify(tmp));data.append("Js",
oVFB.getJs());data.append("Css",oVFB.getCss());var success=function(){var data="";var success=function(){this_.requestToJson();$["notify"](this_.$scope_["FormSelected"]+this_.$scope_["text"]["Loader"]["Notify"]["PublishAndSave"],{"className":"success","autoHideDelay":oVFB.TimeNotify_})};var error=function(data,status){$["notify"](this_.$scope_["text"]["Loader"]["Notify"]["Publish_Error"]+status,{"className":"error","autoHideDelay":oVFB.TimeNotify_})};this_.putRequest(this_.$scope_["FormSelected"]+
"_Published",data,success,error)};var error=function(data,status){$["notify"](this_.$scope_["text"]["Loader"]["Notify"]["SaveData_Error"]+status,{"className":"error","autoHideDelay":oVFB.TimeNotify_})};if(oVFB.valid)if(this_.$scope_["FormSelected"]!="Default")this_.putRequest("Perso_Save",data,success,error);else this_.putRequest("Default_Published",data,success,error);else $["notify"](this_.$scope_["text"]["Loader"]["Notify"]["Validation_Error"],{"className":"error","autoHideDelay":oVFB.TimeNotify_})};
nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.isValid=function(oForm){oVFB.log("nsVFB.JsonLoader.jsonLoaderController.save");goog.array.clear(oVFB.aNotValid);for(var formName in oForm)if(formName!=="datasources")if(goog.isDefAndNotNull(oForm[formName]["rows"]))for(var i=0;i<oForm[formName]["rows"].length;i++)for(var ii=0;ii<oForm[formName]["rows"][i]["fields"].length;ii++)if(oForm[formName]["rows"][i]["fields"][ii]["name"].match(/\s/g)!==null)if(this["applicationName"]==="gtf")oVFB.aNotValid.push(oForm[formName]["rows"][i]["fields"][ii]["name"]);
else if(oVFB["config"]["avaliable_form_types"].length<1)oVFB.aNotValid.push(oForm[formName]["rows"][i]["fields"][ii]["name"]);else oVFB.aNotValid.push(formName+"."+oForm[formName]["rows"][i]["fields"][ii]["name"]);if(oVFB.aNotValid.length>0)return false;else return true};
nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.reset=function(){oVFB.log("nsVFB.JsonLoader.jsonLoaderController.reset");var this_=this;bootbox.confirm("<h4>"+this["text"]["Confirmation"]["Lose"]+"</h4>",function(result){if(result===true)if(this_.$scope_["FormSelected"]==="Default"&&this_["applicationName"]!=="gtf"){if(goog.isDefAndNotNull(oVFB["config"]["reset_default_function"]))this_[oVFB["config"]["reset_default_function"]]()}else{var data="";var success=function(){$["notify"](this_.$scope_["FormSelected"]+
this_.$scope_["text"]["Loader"]["Notify"]["Reset"],{"className":"success","autoHideDelay":oVFB.TimeNotify_});if(this_.$scope_["FormSelected"]==="Perso")this_.requestToJson()};var error=function(data,status){$["notify"](this_.$scope_["text"]["Loader"]["Notify"]["Reset_Error"]+status,{"className":"error","autoHideDelay":oVFB.TimeNotify_})};this_.putRequest(this_.$scope_["FormSelected"]+"_Reset",data,success,error)}})};
nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.putRequest=function(cmd,data,functSuccess,functError){oVFB.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.putRequest");var url="";if(this["applicationName"]==="gtf")url=oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/gtf/workspaces/"+oVFB.getId()+"?token="+oVFB.getToken()+"&cmd="+cmd;else if(this["applicationName"]==="vmap"){var form=this.$scope_["FormSelected"]==="Perso"?"custom":angular.lowercase(this.$scope_["FormSelected"]);
url=oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/"+oVFB["config"]["get"]["api"]+"/"+oVFB["config"]["get"]["ressource"]+"/"+oVFB.getId()+"/forms/"+form+"/?token="+oVFB.getToken()+"&cmd="+cmd}else if(this["applicationName"]==="wab")url=oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/"+oVFB["config"]["get"]["api"]+"/"+oVFB["config"]["get"]["ressource"]+"/"+oVFB.getId()+"/form?token="+oVFB.getToken();this.$http_({url:url,method:"PUT",
data:data,headers:{"Content-Type":"undefined"}}).success(functSuccess).error(functError)};nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.suggestGenerateForm=function(){oVFB.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.suggestGenerateForm");var this_=this;bootbox.confirm("<h4>"+this.$scope_["text"]["Loader"]["Notify"]["generate_form"]+"</h4>",function(result){if(result===true)this_.suggestColumnsToGenerateForm();else{this_["aSuggestedTableFields"]=[];this_.generateFormByBusinessObject()}})};
nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.useEmptyForm=function(data,successCallback){oVFB.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.useEmptyForm");$.notify(this.$scope_["text"]["Loader"]["Notify"]["no_form"],"warning");var aTypes=goog.isDef(oVFB["config"]["avaliable_form_types"])?oVFB["config"]["avaliable_form_types"]:["search","insert","update","display"];var emptyForm={"input_size":"xxs","javascript":false,"name":"custom-form","nb_cols":12,"rows":[],"title":""};
data[0]={"datasources":{}};for(var i=0;i<aTypes.length;i++)data[0][aTypes[i]]=emptyForm;this.useJson(data,successCallback)};
nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.suggestColumnsToGenerateForm=function(){oVFB.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.suggestColumnsToGenerateForm");var url=oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/vmap/businessobjects/"+oVFB.getId()+"/fields/?token="+oVFB.getToken();if(oVFB.getApplication()==="wab")url=oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/wab/sections/"+oVFB.getId()+
"/fields?token="+oVFB.getToken();var this_=this;if(goog.isDef(this_["aSuggestedTableFields"]))goog.array.clear(this_["aSuggestedTableFields"]);this.$http_({url:url,method:"GET"}).success(function(data){if(!goog.isArray(data)||data.length===0){var $oMainScope=angular.element(vitisApp.appMainDrtv).scope();$oMainScope.$root["modalWindow"]("confirm",this_.$scope_["text"]["Loader"]["Notify"]["generate_form_error"],{"className":"modal-danger","message":this_.$scope_["text"]["Loader"]["Notify"]["generate_form_error_description"],
"buttons":{"cancel":{"label":'<i class="glyphicon glyphicon-remove"></i> Annuler',"className":"btn-default"},"confirm":{"label":'<i class="glyphicon glyphicon-ok"></i> Poursuivre quand m\u00eame',"className":"btn-danger"}},"callback":function(result){if(result===true){this_["aSuggestedTableFields"]=[];this_.generateFormByBusinessObject()}else $oMainScope["setMode"]("search")}})}else{this_["aSuggestedTableFields"]=data;$("#select-fields-modal").modal("show")}}).error(function(){$["notify"](this_.$scope_["text"]["Loader"]["Notify"]["CreateJson_Error"]+
status,{"className":"error","autoHideDelay":oVFB.TimeNotify_})})};
nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.generateFormByBusinessObject=function(){oVFB.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.generateFormByBusinessObject");var this_=this;var form="";if(this_.$scope_["FormSelected"]==="Perso")form="custom";else if(this_.$scope_["FormSelected"]==="Default")form="default";else form="published";var url=oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/vmap/businessobjects/"+oVFB.getId()+"/forms/"+
form+"/?token="+oVFB.getToken();if(oVFB.getApplication()==="wab")url=oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["services_alias"]+"/wab/sections/"+oVFB.getId()+"/form?token="+oVFB.getToken();var aFieldsToUse=[];var afieldsLabel={};for(var i=0;i<this_["aSuggestedTableFields"].length;i++){if(this_["aSuggestedTableFields"][i]["fields"][0]["bUseForGenerate"]===true)aFieldsToUse.push(this_["aSuggestedTableFields"][i]["fields"][0]["name"]);afieldsLabel[this_["aSuggestedTableFields"][i]["fields"][0]["name"]]=
this_["aSuggestedTableFields"][i]["fields"][0]["label"]}var sFieldsToUse=aFieldsToUse.toString().replace(/,/gi,"|");$("#select-fields-modal").modal("hide");if(this_.$scope_["FormSelected"]==="Default"){var success=function(){$["notify"](this_.$scope_["FormSelected"]+this_.$scope_["text"]["Loader"]["Notify"]["Reset"],{"className":"success","autoHideDelay":oVFB.TimeNotify_});if(this_.$scope_["FormSelected"]==="Default")this_.requestToJson()};var error=function(data,status){$["notify"](this_.$scope_["text"]["Loader"]["Notify"]["Reset_Error"]+
status,{"className":"error","autoHideDelay":oVFB.TimeNotify_})};this_.putRequest(this_.$scope_["FormSelected"]+"_Reset",{"field":sFieldsToUse,"label":afieldsLabel},success,error)}else this.$http_({url:url,method:"POST",data:{"fields":sFieldsToUse,"label":afieldsLabel}}).success(function(){this_.requestToJson()}).error(function(){$["notify"](this_.$scope_["text"]["Loader"]["Notify"]["CreateJson_Error"]+status,{"className":"error","autoHideDelay":oVFB.TimeNotify_})})};goog.provide("nsUtils");nsUtils={};nsUtils.bDebugMode_=false;nsUtils.log=function(message){if(goog.isDefAndNotNull(oVFB.AppProperties))if(oVFB.AppProperties["debug_mode"])if(nsUtils.bDebugMode_)console.log(message)};
nsUtils.unselectAll=function(){nsUtils.log("util.unselectAll");$("#treeView")["treeview"]("unselectNode",[$("#treeView")["treeview"]("getSelected"),{silent:true}]);$("#treeWithLines")["treeview"]("unselectNode",[$("#treeWithLines")["treeview"]("getSelected"),{silent:true}]);angular.element($("#studio_container")).scope().$broadcast("update element",{});angular.element($("#FormModal")).scope()["ctrl"].removeSelectedAndHoveredElem()};
nsUtils.reloadForm=function(target){nsUtils.log("util.reloadForm");if(!goog.isDefAndNotNull(target))target="#studio_form_reader";var oFormReaderScope=angular.element($(target).children()).scope();oFormReaderScope["oFormValues"][oFormReaderScope["sFormDefinitionName"]]={};setTimeout(function(){oFormReaderScope["compileTemplate"]();setTimeout(function(){oFormReaderScope["ctrl"].useDefaultValues(true);setTimeout(function(){oFormReaderScope["ctrl"].extractFormDefinitionInfos()},100)},100)},100)};
nsUtils.clone=function(obj){nsUtils.log("util.clone");return obj};nsUtils.JsonStringifier=function(oJson){nsUtils.log("util.JsonStringifier");var strJson=JSON.stringify(oJson,null,2);return strJson};
nsUtils.JsonOptimizer=function(oJson){var tmp=oJson["insert"];if(tmp["javascript"]==false)delete tmp["javascript"];if(tmp["style"]==false)delete tmp["style"];var i=0;while(i<tmp["rows"].length)if(typeof tmp["rows"]!=="object"){console.error("error on rows integrity, this row who have been deleted :",tmp["rows"]);delete tmp["rows"]}else{if(!Array.isArray(tmp["rows"][i]["fields"])){console.error("error on fields integrity, this fields who have been deleted in row "+i+" :",tmp["rows"][i]["fields"]);
delete tmp["rows"][i]["fields"]}else{var j=0;while(j<tmp["rows"][i]["fields"].length)if(typeof tmp["rows"][i]["fields"][j]!=="object"){console.error("error on fields integrity, this field who have been deleted in row "+i+", field "+j+" :",tmp["rows"][i]["fields"][j]);delete tmp["rows"][i]["fields"][j]}else{var field=tmp["rows"][i]["fields"][j];var arrFields=[];if(typeof field["type"]=="undefined"||field["name"]=="undefined"||field["id"]=="undefined"){console.error("error on minimal containt of a field :",
field);return null}switch(field["type"]){case "title":case "label":if(typeof field["label"]=="undefined"){console.error(field.type+" without a label isn't a "+field.type+" :",field);return null}arrFields=["type","id","label","name"];break;case "hr":arrFields=["type","id","name"];break;case "subtitle":if(typeof field["label"]=="undefined"){console.error("subtitle without a text isn't a subtitle :",field);return null}if(typeof field["class"]=="undefined")delete field["class"];arrFields=["type","id",
"label","name","class"];break;case "checkbox":if(typeof field["label"]=="undefined")console.warn(field.type+" without a label :",field);if(typeof field["checked"]=="undefined"||field["checked"]==false)delete field["checked"];arrFields=["type","id","label","name","checked"];break;case "radio":if(typeof field["label"]=="undefined")console.warn(field.type+" without a label :",field);if(typeof field["checked"]=="undefined"||field["checked"]==false)delete field["checked"];arrFields=["type","id","label",
"name","checked","options"];break;case "textarea":if(typeof field["label"]=="undefined")console.warn(field.type+" without a label :",field);if(typeof field["required"]=="undefined"||field["required"]==false)delete field["required"];if(typeof field["nb_cols"]=="undefined")field["nb_cols"]=12;arrFields=["type","id","label","name","required","nb_cols"];break;case "select":if(typeof field["label"]=="undefined")console.warn(field.type+" without a label :",field);if(typeof field["required"]=="undefined"||
field["required"]==false)delete field["required"];if(typeof field["multiple"]=="undefined"||field["multiple"]==false)delete field["multiple"];if(!goog.isArray(field["options"])&&!goog.isString(field["options"])){console.error(field.type+"'s options are always an array :",field);return null}if(typeof field["web_service"]!="object")delete field["web_service"];else{if(typeof field["web_service"]["parameter"]!="undefined")delete field["web_service"]["parameter"];if(typeof field["web_service"]["ressource_id"]!=
"string"||typeof field["web_service"]["id_key"]!="string"||typeof field["web_service"]["label_key"]!="string"){return null;console.error(field.type+"'s WS parameter are always strings :",field)}}if(typeof field["child_select"]!="string")delete field["child_select"];if(typeof field["nb_cols"]=="undefined")field["nb_cols"]=12;arrFields=["type","id","label","name","required","nb_cols","multiple","options","web_service","child_select"];break;case "double_select":if(typeof field["label"]=="undefined")console.warn(field.type+
" without a label :",field);if(typeof field["required"]=="undefined"||field["required"]==false)delete field["required"];if(!Array.isArray[field["options"]]){console.error(field.type+"'s options are always an array :",field);return null}if(typeof field["web_service"]!="object"){delete field["web_service"];console.error(field.type+"'s WS are always an object :",field)}else{if(typeof field["web_service"]["parameter"]!="undefined")delete field["web_service"]["parameter"];if(typeof field["web_service"]["ressource_id"]!=
"string"||typeof field["web_service"]["id_key"]!="string"||typeof field["web_service"]["label_key"]!="string"){console.error(field.type+"'s WS parameter are always strings :",field);return null}}if(typeof field["size"]=="undefined")field["size"]=5;if(typeof field["label_from"]!="string")delete field["label_from"];if(typeof field["label_to"]!="string")delete field["label_to"];if(typeof field["nb_cols"]=="undefined")field["nb_cols"]=12;arrFields=["type","id","label","name","required","nb_cols","options",
"web_service","size","label_from","label_to","name_from","name_to"];break;case "date":case "datetime":case "upload":case "display_label":case "color_picker":if(typeof field["label"]=="undefined")console.warn(field.type+" without a label :",field);if(typeof field["nb_cols"]=="undefined")field["nb_cols"]=12;arrFields=["type","id","label","name","nb_cols"];break;case "tinymce":if(typeof field["label"]=="undefined")console.warn(field.type+" without a label :",field);if(typeof field["nb_rows"]=="undefined")delete field["nb_rows"];
if(typeof field["options"]!="object")delete field["options"];arrFields=["type","id","label","name","nb_rows","options"];break;case "CodeMirror":case "slider":if(typeof field["label"]=="undefined")console.warn(field.type+" without a label :",field);if(typeof field["options"]!="object")delete field["options"];arrFields=["type","id","label","name","options"];break;case "text":case "password":case "url":if(typeof field["label"]=="undefined")console.warn(field.type+" without a label :",field);if(typeof field["required"]==
"undefined"||field["required"]==false)delete field["required"];if(typeof field["pattern"]=="undefined"||field["pattern"]=="")delete field["pattern"];if(typeof field["nb_cols"]=="undefined")field["nb_cols"]=12;arrFields=["type","id","label","name","pattern","required","nb_cols"];break;case "number":if(typeof field["label"]=="undefined")console.warn(field.type+" without a label :",field);if(typeof field["min"]=="undefined")delete field["min"];if(typeof field["max"]=="undefined")delete field["max"];
if(typeof field["nb_cols"]=="undefined")field["nb_cols"]=12;arrFields=["type","id","label","name","min","max","nb_cols"];break;case "map_osm":case "map_bing":case "map_vmap":if(typeof field["label"]=="undefined")console.warn(field.type+" without a label :",field);if(typeof field["required"]=="undefined"||field["required"]==false)delete field["required"];if(typeof field["map_options"]!="object")delete field["map_options"];else{var options=field["map_options"];if(field["type"]=="map_osm"){if(options["type"]!=
"OSM")console.warn(field.name+" problem with data type :",options);if(typeof options["center"]!="object"){console.error(field["name"]+"have no center's parameter :",options);return null}else{var center=options["center"];if(!Array.isArray(center["coord"])&&!Array.isArray(center["extent"])){console.error(field["name"]+" have no correct coordinate :",options);return null}else if(center["coord"].length!=2&&Array.isArray(center["coord"])){console.error(field["name"]+" bad parameters for center :",options);
return null}else if(center["extent"].length!=4&&Array.isArray(center["extent"])){console.error(field["name"]+" bad parameters for extent :",options);return null}if(Array.isArray(center["coord"])&&(typeof center["zoom"]=="undefined"&&typeof center["scale"]=="undefined")){console.error(field["name"]+" center parameter need a scale value :",options);return null}if(typeof center["zoom"]=="undefined"&&typeof center["scale"]!="undefined")delete center["zoom"];else if(typeof center["zoom"]!="undefined"&&
typeof center["scale"]=="undefined")delete center["scale"]}if(typeof options["controls"]!="object"){console.error(field["name"]+" have no control's parameter :",options);return null}else if(Object.keys(options["controls"]).length!=4){console.error(field["name"]+" bad control's parameter :",options);return null}if(!Array.isArray(options["layers"]))console.warn(field["name"]+" layers problem :",options);else if(options["layers"].length==0)delete options["layers"];if(typeof options["interactions"]!=
"object"){console.error(field["name"]+" have no interactions's parameter :",options);return null}else if(Object.keys(options["interactions"]).length!=7){console.error(field["name"]+" bad interactions's parameter :",options);return null}if(typeof options["draw_color"]=="undefined")delete options["draw_color"];if(!Array.isArray(options["features"]))console.warn(field["name"]+" bad type for features :",options);else if(options["features"].length==0)delete options["features"];if(typeof options["coord_accuracy"]==
"undefined")options["coord_accuracy"]=8}else if(field["type"]=="map_bing"){if(options["type"]!="bing")console.warn(field.name+" preoblem with data type :",options);if(typeof options["center"]!="object"){console.error(field["name"]+"have no center's parameter :",options);return null}else{var center=options["center"];if(!Array.isArray(center["coord"])&&!Array.isArray(center["extent"])){console.error(field["name"]+" have no correct coordinate :",options);return null}else if(center["coord"].length!=2&&
Array.isArray(center["coord"])){console.error(field["name"]+" bad parameters for center :",options);return null}else if(center["extent"].length!=4&&Array.isArray(center["extent"])){console.error(field["name"]+" bad parameters for extent :",options);return null}if(Array.isArray(center["coord"])&&(typeof center["zoom"]=="undefined"&&typeof center["scale"]=="undefined")){console.error(field["name"]+" center parameter need a scale value :",options);return null}if(typeof center["zoom"]=="undefined"&&typeof center["scale"]!=
"undefined")delete center["zoom"];else if(typeof center["zoom"]!="undefined"&&typeof center["scale"]=="undefined")delete center["scale"]}if(typeof options["controls"]!="object"){console.error(field["name"]+" have no control's parameter :",options);return null}else if(Object.keys(options["controls"]).length!=4){console.error(field["name"]+" bad control's parameter :",options);return null}if(!Array.isArray(options["layers"]))console.warn(field["name"]+" layers undefined :",options);else if(options["layers"].length==
0)delete options["layers"];if(typeof options["interactions"]!="object"){console.error(field["name"]+" have no interactions's parameter :",options);return null}else if(Object.keys(options["interactions"]).length!=7){console.error(field["name"]+" bad interactions's parameter :",options);return null}if(typeof options["draw_color"]=="undefined")delete options["draw_color"];if(!Array.isArray(options["features"]))console.warn(field["name"]+" bad type for features :",options);else if(options["features"].length==
0)delete options["features"];if(typeof options["coord_accuracy"]=="undefined")options["coord_accuracy"]=8;if(typeof options["source"]!="object"){console.error(field["name"]+" have no source's parameter :",options);return null}else if(Object.keys(options["source"]).length!=3){console.error(field["name"]+" bad source's parameter :",options);return null}}else if(field["type"]=="map_vmap"){if(options["type"]!="vmap")console.warn(field.name+" preoblem with data type :",options);if(typeof options["center"]!=
"object"){console.error(field["name"]+"have no center's parameter :",options);return null}else{var center=options["center"];if(!Array.isArray(center["coord"])&&!Array.isArray(center["extent"])){console.error(field["name"]+" have no correct coordinate :",options);return null}else if(center["coord"].length!=2&&Array.isArray(center["coord"])){console.error(field["name"]+" bad parameters for center :",options);return null}else if(center["extent"].length!=4&&Array.isArray(center["extent"])){console.error(field["name"]+
" bad parameters for extent :",options);return null}if(Array.isArray(center["coord"])&&(typeof center["zoom"]=="undefined"&&typeof center["scale"]=="undefined")){console.error(field["name"]+" center parameter need a scale value :",options);return null}if(typeof center["zoom"]=="undefined"&&typeof center["scale"]!="undefined")delete center["zoom"];else if(typeof center["zoom"]!="undefined"&&typeof center["scale"]=="undefined")delete center["scale"]}if(typeof options["controls"]!="object"){console.error(field["name"]+
" have no control's parameter :",options);return null}else if(Object.keys(options["controls"]).length!=4){console.error(field["name"]+" bad control's parameter :",options);return null}if(!Array.isArray(options["layers"]))console.warn(field["name"]+" bad type for layers :",options);else if(options["layers"].length==0)delete options["layers"];if(typeof options["interactions"]!="object"){console.error(field["name"]+" have no interactions's parameter :",options);return null}else if(Object.keys(options["interactions"]).length!=
7){console.error(field["name"]+" bad interactions's parameter :",options);return null}if(typeof options["draw_color"]=="undefined")delete options["draw_color"];if(!Array.isArray(options["features"]))console.warn(field["name"]+" bad type for features :",options);else if(options["features"].length==0)delete options["features"];if(typeof options["coord_accuracy"]=="undefined")options["coord_accuracy"]=8;if(typeof options["tree"]!="object"){console.error(field["name"]+" have no tree object :",options);
return null}else if(Object.keys(options["tree"]).length==0){console.error(field["name"]+" empty tree :",options);return null}}}if(typeof field["nb_cols"]=="undefined")field["nb_cols"]=12;arrFields=["type","id","label","name","required","map_options","nb_cols"];break}for(var srckey in field)if(arrFields.indexOf(srckey)===-1)delete field[srckey];j++}}i++}return oJson};
nsUtils.numberParser=function(str,bInt){str=goog.isDef(str)?str:"";bInt=goog.isDef(bInt)?bInt:false;if(bInt)return this.numberParser(str);else{str=str.replace(",",".");var parts=str.split(".");if(parts.length===0)return NaN;else if(parts.length===1)return this.numberParser(str);else if(parts.length>=2){var left=this.numberParser(parts[0]);var right=0;if(parts.length===2)right=this.numberParser(parts[1]);else{var tmp="";for(var i=1;i<parts.length;i++)tmp+=parts[i];right=this.numberParser(tmp)}return parseFloat(left+
"."+right)}else return NaN}};nsUtils.numberParser=function(str){var ret="";for(var i=0;i<str.length;i++){var currentChar=str.charAt(i);if(!isNan(parseInt(currentChar)))ret+=currentChar}return parseInt(ret)};
nsUtils.getElementsByName=function(oJson,formName,elementName){var aElems=[];if(!goog.isDefAndNotNull(elementName))return aElems;if(!goog.isDefAndNotNull(oJson[formName]))return aElems;if(!goog.isDefAndNotNull(oJson[formName]["rows"]))return aElems;for(var i=0;i<oJson[formName]["rows"].length;i++)if(goog.isDefAndNotNull(oJson[formName]["rows"][i]["fields"]))for(var ii=0;ii<oJson[formName]["rows"][i]["fields"].length;ii++)if(oJson[formName]["rows"][i]["fields"][ii]["name"]===elementName)aElems.push(oJson[formName]["rows"][i]["fields"][ii]);
return aElems};goog.provide("nsVFB.Visualizer");goog.require("nsVFB.nsVisualizerMode.FormMode");goog.require("nsVFB.nsVisualizerMode.JsonMode");goog.require("nsVFB.nsVisualizerMode.JsMode");goog.require("nsVFB.nsVisualizerMode.CssMode");
nsVFB.Visualizer=function(){oVFB.log("nsVFB.Visualizer");this.oFormMode_=new nsVFB.nsVisualizerMode.FormMode;this.oJsonMode_=new nsVFB.nsVisualizerMode.JsonMode;this.oJsMode_=new nsVFB.nsVisualizerMode.JsMode;this.oCssMode_=new nsVFB.nsVisualizerMode.CssMode;oVFB.module.directive("appVisualizer",this.visualizerDirective);oVFB.module.controller("AppVisualizerController",["$scope","$timeout",this.visualizerController])};
nsVFB.Visualizer.prototype.visualizerDirective=function(){oVFB.log("nsVFB.Visualizer.visualizerDirective");return{restrict:"A",replace:true,controller:"AppVisualizerController",controllerAs:"ctrl",scope:true,bindToController:true,templateUrl:"javascript/externs/studio/templates/Visualizer.html"}};
nsVFB.Visualizer.prototype.visualizerController=function($scope,$timeout,$http){oVFB.log("nsVFB.Visualizer.visualizerController");var visualizerController=this;this.$scope_=$scope;visualizerController["form_"]=true;visualizerController["css_"]=visualizerController["js_"]=visualizerController["json_"]=false;visualizerController["JSPresent"]=true;visualizerController["CSSPresent"]=true;$scope.$watch("text",function(){oVFB.log("visualizer text");if(typeof $scope["text"]["Visualizer"]!=="undefined"){visualizerController["text"]=
$scope["text"]["Visualizer"];visualizerController["ModeSelected"]=visualizerController["text"]["FormMode"]}});visualizerController["verifyMode"]=function(){if(goog.isDef(angular.element($("#boolean-JS-include"))[0]))visualizerController["JSPresent"]=!angular.element($("#boolean-JS-include"))[0]["checked"];if(goog.isDef(angular.element($("#boolean-CSS-include"))[0]))visualizerController["CSSPresent"]=!angular.element($("#boolean-CSS-include"))[0]["checked"]};visualizerController["form"]=function(){visualizerController["ModeSelected"]=
visualizerController["text"]["FormMode"];$scope.$broadcast("updateEvent",{});visualizerController["form_"]=true;visualizerController["css_"]=visualizerController["js_"]=visualizerController["json_"]=false};visualizerController["json"]=function(){visualizerController["ModeSelected"]=visualizerController["text"]["JsonMode"];$scope.$broadcast("updateEvent",{});visualizerController["json_"]=true;visualizerController["css_"]=visualizerController["js_"]=visualizerController["form_"]=false};visualizerController["js"]=
function(){visualizerController["ModeSelected"]=visualizerController["text"]["JsMode"];visualizerController["js_"]=true;visualizerController["css_"]=visualizerController["json_"]=visualizerController["form_"]=false;$scope.$broadcast("updateJS",oVFB.getJs())};visualizerController["css"]=function(){visualizerController["ModeSelected"]=visualizerController["text"]["CssMode"];$scope.$broadcast("updateCSS",oVFB.getCss());visualizerController["css_"]=true;visualizerController["json_"]=visualizerController["js_"]=
visualizerController["form_"]=false}};
nsVFB.Visualizer.prototype.visualizerController.prototype.toggleFullScreen=function(){oVFB.log("nsVFB.Visualizer.visualizerController.toggleFullScreen");if(document["fullscreenEnabled"]||document["webkitFullscreenEnabled"]||document["mozFullScreenEnabled"]||document["msFullscreenEnabled"]){var button_full_screen=$("#studio-full-screen-btn").get(0);var elem=$("#studio_container").get(0);if(document["fullscreenElement"]||document["webkitFullscreenElement"]||document["mozFullScreenElement"]||document["msFullscreenElement"]){$(button_full_screen).removeClass("icon-shrink");
if(document["exitFullscreen"])document["exitFullscreen"]();else if(document["webkitExitFullscreen"])document["webkitExitFullscreen"]();else if(document["mozCancelFullScreen"])document["mozCancelFullScreen"]();else if(document["msExitFullscreen"])document["msExitFullscreen"]();setTimeout(function(){oVFB.resize()},100)}else{$(button_full_screen).addClass("icon-shrink");if(elem["requestFullscreen"])elem["requestFullscreen"]();else if(elem["mozRequestFullScreen"])elem["mozRequestFullScreen"]();else if(elem["webkitRequestFullscreen"])elem["webkitRequestFullscreen"]();
else if(elem["msRequestFullscreen"])elem["msRequestFullscreen"]();setTimeout(function(){oVFB.resize(true)},500)}}else $.notify("Fonction non disponible pour votre navigateur","error")};
nsVFB.Visualizer.prototype.visualizerController.prototype.loadDefaultJavascript=function(){oVFB.log("nsVFB.visualizerController.loadDefaultJavascript");var $scope=this.$scope_;var sJs=oVFB.getJs();if(goog.isDef(sJs))if(sJs!=="")bootbox.confirm("<h4>"+this["text"]["Confirmation"]["LoseJs"]+"</h4>",function(result){if(result===true){var $http=angular.element(vitisApp.appMainDrtv).injector().get(["$http"]);$http({method:"GET",url:oVFB.AppProperties["web_server_name"]+"/"+oVFB.AppProperties["public_alias"]+
"/studio/default.js"}).then(function successCallback(response){console.log(response);if(goog.isDefAndNotNull(response.data)){oVFB.setJs(response.data.replace(/(?:\r\n|\r|\n)/g,"\r\n"));$scope.$broadcast("updateJS",oVFB.getJs())}},function errorCallback(response){console.error("Problem on Loading default javascript");console.error(response)})}else return})};nsVFB.Visualizer.prototype.getFormMode=function(){return nsVFB.Visualizer.oFormMode_};nsVFB.Visualizer.prototype.getJsonMode=function(){return nsVFB.Visualizer.oJsonMode_};
nsVFB.Visualizer.prototype.getJsMode=function(){return nsVFB.Visualizer.oJsMode_};nsVFB.Visualizer.prototype.getCssMode=function(){return nsVFB.Visualizer.oCssMode_};goog.provide("nsVFB.nsVisualizerMode.CssMode");nsVFB.nsVisualizerMode.CssMode=function(){oVFB.log("nsVFB.nsVisualizerMode.CssMode");oVFB.module.directive("appEditorCss",this.editorCssModeDirective);oVFB.module.controller("AppEditorCssController",["$scope",this.editorCssModeController])};
nsVFB.nsVisualizerMode.CssMode.prototype.editorCssModeDirective=function(){oVFB.log("nsVFB.VisualizerMode.CssMode.editorCssModeDirective");return{restrict:"A",replace:true,controller:"AppEditorCssController",controllerAs:"ctrl",scope:true,bindToController:true,templateUrl:"javascript/externs/studio/templates/VisualizerMode/CssMode.html"}};
nsVFB.nsVisualizerMode.CssMode.prototype.editorCssModeController=function($scope){oVFB.log("nsVFB.VisualizerMode.CssMode.editorCssModeController");$scope["CssModel"]=oVFB.getCss();$scope["editorOptions"]={"mode":"css","readOnly":false,"styleActiveLine":true,"lineNumbers":true,"lineSeparator":"\r\n","indentWithTabs":true,"tabSize":2,"viewportMargin":50,"theme":"Veremes"};oVFB.resize();$scope.$watch("CssModel",function(value,old){oVFB.log("cssmode model");oVFB.setCss(value)});$scope.$on("updateCSS",
function(event,data){oVFB.log(oVFB.getCss());$scope["CssModel"]=oVFB.getCss()})};goog.provide("nsVFB.nsVisualizerMode.FormMode");nsVFB.nsVisualizerMode.FormMode=function(){oVFB.log("nsVFB.nsVisualizerMode.FormMode");oVFB.module.directive("appVisualizermodeForm",this.visualizerFormModeDirective);oVFB.module.directive("appSpecificParam",["$timeout","$rootScope","$http","$q",this.specificParameterDirective]);oVFB.module.controller("AppVisualizermodeFormController",["$scope",this.visualizerFormModeController])};
nsVFB.nsVisualizerMode.FormMode.prototype.visualizerFormModeDirective=function(){oVFB.log("nsVFB.VisualizerMode.FormMode.visualizerFormModeDirective");return{restrict:"A",replace:true,controller:"AppVisualizermodeFormController",controllerAs:"ctrl",scope:true,bindToController:true,templateUrl:"javascript/externs/studio/templates/VisualizerMode/FormMode.html"}};
nsVFB.nsVisualizerMode.FormMode.prototype.visualizerFormModeController=function($scope){oVFB.log("nsVFB.VisualizerMode.FormMode.visualizerFormModeController");var this_=this;this.$scope_=$scope;$scope["sFormDefinitionName"]="";$scope["oFormValues"]={};$scope["oFormDefinition"]={};$scope["oFormScope"]={};$scope["oProperties"]=oVFB.AppProperties;$scope["sToken"]=sessionStorage["session_token"];$scope.$on("updateEvent",function(event,data){oVFB.log("visualizerFormModeController updateEvent");$scope.$broadcast("updateForm",
data)});$scope.$on("updateForm",function(event,data){oVFB.log("visualizerFormModeController updateForm");if(data[$scope["selected_form_type"]]){var oJson=data[$scope["selected_form_type"]];for(var i=0;i<oJson["rows"].length;i++)for(var j=0;j<oJson["rows"][i]["fields"].length;j++)if(!oJson["rows"][i]["fields"][j]["id"])oJson["rows"][i]["fields"][j]["id"]=oJson["rows"][i]["fields"][j]["name"]+"_"+(i+1)+"_"+(j+1);$scope["oFormDefinition"]=data;$scope["sFormDefinitionName"]=$scope["selected_form_type"];
$scope["title"]=oJson["title"];if(!goog.isDef($scope["oFormValues"]))$scope["oFormValues"]={};if(!goog.isDef($scope["oFormValues"][$scope["sFormDefinitionName"]]))$scope["oFormValues"][$scope["sFormDefinitionName"]]={};angular.element($("#studio_form_reader").children()).scope()["ctrl"].refreshForm()}else oVFB.log("visualizerFormModeController. Load JSON form fail: "+$scope["selected_form_type"]+" undefined in ",data)});$scope.$on("updateDefautValue",function(event,data){angular.element($("#studio_form_reader").children()).scope()["ctrl"].useDefaultValues(true,
data["name"])})};
nsVFB.nsVisualizerMode.FormMode.prototype.visualizerFormModeController.prototype.setSelectedElem=function(element,sFormDefinitionName){oVFB.log("nsVFB.nsVisualizerMode.FormMode.visualizerFormModeController.setSelectedElem");var this_=this;var $scope=this.$scope_;setTimeout(function(){$scope.$evalAsync(function(){var aRows=$scope["oFormDefinition"][sFormDefinitionName]["rows"];this_.removeSelectedElem(sFormDefinitionName);if(element["type"]==="row")aRows[element["row_id"]]["selected"]=true;if(element["type"]===
"element")for(var i=0;i<aRows.length;i++)for(var ii=0;ii<aRows[i]["fields"].length;ii++)if(aRows[i]["fields"][ii]["name"]===element["element_name"])aRows[i]["fields"][ii]["selected"]=true;angular.element($("#studio_form_reader").children()).scope()["ctrl"].refreshForm()})})};
nsVFB.nsVisualizerMode.FormMode.prototype.visualizerFormModeController.prototype.setHoveredElem=function(element,sFormDefinitionName){var this_=this;var $scope=this.$scope_;$scope.$evalAsync(function(){var aRows=$scope["oFormDefinition"][sFormDefinitionName]["rows"];this_.removeHoveredElem(sFormDefinitionName);if(element["type"]==="row")aRows[element["row_id"]]["hovered"]=true;if(element["type"]==="element")for(var i=0;i<aRows.length;i++)for(var ii=0;ii<aRows[i]["fields"].length;ii++)if(aRows[i]["fields"][ii]["name"]===
element["element_name"])aRows[i]["fields"][ii]["hovered"]=true;angular.element($("#studio_form_reader").children()).scope()["ctrl"].refreshForm()})};
nsVFB.nsVisualizerMode.FormMode.prototype.visualizerFormModeController.prototype.removeSelectedElem=function(sFormDefinitionName){oVFB.log("nsVFB.nsVisualizerMode.FormMode.visualizerFormModeController.removeSelectedElem");var $scope=this.$scope_;if(!goog.isDefAndNotNull(sFormDefinitionName)){for(var sName in $scope["oFormDefinition"])this.removeSelectedElem(sName);return 0}var aRows=$scope["oFormDefinition"][sFormDefinitionName]["rows"];if(!goog.isDefAndNotNull(aRows))return 0;for(var i=0;i<aRows.length;i++){if(aRows[i]["selected"]===
true)delete aRows[i]["selected"];for(var ii=0;ii<aRows[i]["fields"].length;ii++)if(aRows[i]["fields"][ii]["selected"]===true)delete aRows[i]["fields"][ii]["selected"]}};
nsVFB.nsVisualizerMode.FormMode.prototype.visualizerFormModeController.prototype.removeHoveredElem=function(sFormDefinitionName){var $scope=this.$scope_;if(!goog.isDef(sFormDefinitionName)){for(var sName in $scope["oFormDefinition"])this.removeHoveredElem(sName);return 0}var aRows=$scope["oFormDefinition"][sFormDefinitionName]["rows"];for(var i=0;i<aRows.length;i++){if(aRows[i]["hovered"]===true)delete aRows[i]["hovered"];for(var ii=0;ii<aRows[i]["fields"].length;ii++)if(aRows[i]["fields"][ii]["hovered"]===
true)delete aRows[i]["fields"][ii]["hovered"]}};
nsVFB.nsVisualizerMode.FormMode.prototype.visualizerFormModeController.prototype.removeSelectedAndHoveredElem=function(sFormDefinitionName){var $scope=this.$scope_;if(!goog.isDefAndNotNull(sFormDefinitionName)){for(var sName in $scope["oFormDefinition"])this.removeSelectedAndHoveredElem(sName);return 0}var aRows=$scope["oFormDefinition"][sFormDefinitionName]["rows"];if(!goog.isDefAndNotNull(aRows))return 0;for(var i=0;i<aRows.length;i++){if(aRows[i]["selected"]===true)delete aRows[i]["selected"];
if(aRows[i]["hovered"]===true)delete aRows[i]["hovered"];for(var ii=0;ii<aRows[i]["fields"].length;ii++){if(aRows[i]["fields"][ii]["selected"]===true)delete aRows[i]["fields"][ii]["selected"];if(aRows[i]["fields"][ii]["hovered"]===true)delete aRows[i]["fields"][ii]["hovered"]}}};
nsVFB.nsVisualizerMode.FormMode.prototype.visualizerFormModeController.prototype.emptyFormValues=function(){oVFB.log("nsVFB.nsVisualizerMode.FormMode.visualizerFormModeController.emptyFormValues");var $scope=this.$scope_;if(goog.isDef($scope["oFormValues"]))$scope["oFormValues"]={}};goog.provide("nsVFB.nsVisualizerMode.JsMode");nsVFB.nsVisualizerMode.JsMode=function(){oVFB.log("nsVFB.nsVisualizerMode.JsMode");oVFB.module.directive("appEditorJs",this.editorJsModeDirective);oVFB.module.controller("AppEditorJsController",["$scope",this.editorJsModeController])};
nsVFB.nsVisualizerMode.JsMode.prototype.editorJsModeDirective=function(){oVFB.log("nsVFB.VisualizerMode.JsMode.editorJsModeDirective");return{restrict:"A",replace:true,controller:"AppEditorJsController",controllerAs:"ctrl",scope:true,bindToController:true,templateUrl:"javascript/externs/studio/templates/VisualizerMode/JsMode.html"}};
nsVFB.nsVisualizerMode.JsMode.prototype.editorJsModeController=function($scope){oVFB.log("nsVFB.VisualizerMode.JsMode.editorJsModeController");$scope["JsModel"]=oVFB.getJs();$scope["editorOptions"]={"mode":{"name":"javascript","json":false},"readOnly":false,"styleActiveLine":true,"lineNumbers":true,"lineSeparator":"\r\n","indentWithTabs":true,"tabSize":2,"viewportMargin":50,"theme":"Veremes","onLoad":function(cm_){$scope.$watch("JsModel",function(value,old){oVFB.log("jsmode model");oVFB.setJs(value)});
$scope.$on("updateJS",function(){oVFB.log("Js");$scope["JsModel"]=oVFB.getJs()})}}};goog.provide("nsVFB.nsVisualizerMode.JsonMode");nsVFB.nsVisualizerMode.JsonMode=function(){oVFB.log("nsVFB.nsVisualizerMode.JsonMode");oVFB.module.directive("appVisualizermodeJson",this.visualizerJsonModeDirective);oVFB.module.controller("AppVisualizermodeJsonController",["$scope","$timeout","$rootScope",this.visualizerJsonModeController])};
nsVFB.nsVisualizerMode.JsonMode.prototype.visualizerJsonModeDirective=function(){oVFB.log("nsVFB.VisualizerMode.JsonMode.visualizerJsonModeDirective");return{restrict:"A",replace:true,controller:"AppVisualizermodeJsonController",controllerAs:"ctrl",scope:true,bindToController:true,templateUrl:"javascript/externs/studio/templates/VisualizerMode/JsonMode.html"}};
nsVFB.nsVisualizerMode.JsonMode.prototype.visualizerJsonModeController=function($scope,$timeout,$rootScope){oVFB.log("nsVFB.VisualizerMode.JsonMode.visualizerJsonModeController");this.scope_=$scope;this.rootScope_=$rootScope;this.timeout_=$timeout;$scope.moment_=Date.now();$scope.labs_=1E3;$scope["JsonModel"]=oVFB.JsonStringifier(oVFB.getJsonOutput());$scope["error_Json"]=false;$scope["editorOptions"]={"mode":{name:"javascript",json:true},"readOnly":true,"styleActiveLine":true,"lineNumbers":true,
"lineSeparator":"\n","indentWithTabs":true,"tabSize":2,"viewportMargin":50,"theme":"Veremes",foldGutter:true,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],"onLoad":function(cm_){$scope.$on("updateEvent",function(event,data){cm_["setOption"]("readOnly",$("#Lock_Icon").hasClass("fa-lock"));$scope["JsonModel"]=oVFB.JsonStringifier(oVFB.getJsonOutput())});$scope.$watch("JsonModel",function(value,old){oVFB.log("jsonmode model");var error=false;try{JSON.parse(value)}catch(e){error=true}finally{$scope.$parent["error_Json"]=
error}});$scope.$on("updateJsonModel",function(event,data){if($scope["$parent"]["ctrl"]["json_"]){$scope.moment_=Date.now();$timeout(function(){if(Date.now()-$scope.moment_>=$scope.labs_)$scope["JsonModel"]=oVFB.JsonStringifier(oVFB.getJsonOutput())},$scope.labs_)}})}}};
nsVFB.nsVisualizerMode.JsonMode.prototype.visualizerJsonModeController.prototype.saveData=function(){oVFB.setJsonOutput(JSON.parse(this.scope_["JsonModel"]));var selectedElement=$("#treeWithLines")["treeview"]("getSelected");var selectedElementInTreeview=$("#treeView")["treeview"]("getSelected");this.rootScope_.$broadcast("updateEvent",oVFB.getJsonOutput());if(selectedElement.length!==0&&selectedElementInTreeview.length!==0)this.timeout_(function(){$("#treeWithLines")["treeview"]("selectNode",[selectedElement[0]["nodeId"],
{silent:false}]);$("#treeView")["treeview"]("selectNode",[selectedElementInTreeview[0]["nodeId"],{silent:false}])},1)};
