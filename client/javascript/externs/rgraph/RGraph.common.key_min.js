typeof RGraph=="undefined"&&(RGraph={}),RGraph.DrawKey=function(n,t,i){var h=n.canvas,o=n.context,r,s,f,e,u;for(o.lineWidth=1,o.beginPath(),r=n.Get("chart.key.position"),s=n.Get("chart.text.size"),typeof n.Get("chart.key.vpos")=="number"&&n.Set("chart.key.position.y",n.Get("chart.key.vpos")*this.Get("chart.gutter.top")),f=[],e=[],u=0;u<t.length;++u)t[u]!=null&&(e.push(i[u]),f.push(t[u]));t=f,i=e,r&&r=="gutter"?RGraph.DrawKey_gutter(n,t,i):r&&r=="graph"?RGraph.DrawKey_graph(n,t,i):alert("[COMMON] ("+n.id+") Unknown key position: "+r)},RGraph.DrawKey_graph=function(n,t,i){var a=n.canvas,r=n.context,u=typeof n.Get("chart.key.text.size")=="number"?n.Get("chart.key.text.size"):n.Get("chart.text.size"),p=n.Get("chart.text.font"),v=n.Get("chart.gutter.left"),y=n.Get("chart.gutter.right"),w=n.Get("chart.gutter.top"),nt=n.Get("chart.gutter.bottom"),o=n.Get("chart.yaxispos")=="right"?v+10:RGraph.GetWidth(n)-y-10,h=w+10,tt=n.Get("chart.title"),e=u,it=n.Get("chart.key.background"),c=0,s,f,l;for(n.coords||(n.coords={}),n.coords.key=[],r.font=u+"pt "+n.Get("chart.text.font"),s=0;s<t.length;++s)c=Math.max(c,r.measureText(t[s]).width);for(c+=5,c+=e,c+=5,c+=5,c+=5,n.Get("chart.yaxispos")!="left"&&(n.type!="pie"||n.Get("chart.yaxispos"))&&(n.type!="hbar"||n.Get("chart.yaxispos"))&&(n.type!="hbar"||n.Get("chart.yaxispos")!="center")&&(n.type!="rscatter"||n.Get("chart.yaxispos"))&&(n.type!="radar"||n.Get("chart.yaxispos"))&&(n.type!="rose"||n.Get("chart.yaxispos"))&&(n.type!="funnel"||n.Get("chart.yaxispos"))&&(n.type!="vprogress"||n.Get("chart.yaxispos"))&&(n.type!="hprogress"||n.Get("chart.yaxispos"))||(o-=c),typeof n.Get("chart.key.halign")=="string"&&(n.Get("chart.key.halign")=="left"?o=v+10:n.Get("chart.key.halign")=="right"&&(o=n.canvas.width-y-c)),typeof n.Get("chart.key.position.x")=="number"&&(o=n.Get("chart.key.position.x")),typeof n.Get("chart.key.position.y")=="number"&&(h=n.Get("chart.key.position.y")),n.Get("chart.key.shadow")&&(r.shadowColor=n.Get("chart.key.shadow.color"),r.shadowBlur=n.Get("chart.key.shadow.blur"),r.shadowOffsetX=n.Get("chart.key.shadow.offsetx"),r.shadowOffsetY=n.Get("chart.key.shadow.offsety")),r.beginPath(),r.fillStyle=n.Get("chart.key.background"),r.strokeStyle="black",(typeof n.Get("chart.key.position.graph.boxed")=="undefined"||typeof n.Get("chart.key.position.graph.boxed")=="boolean"&&n.Get("chart.key.position.graph.boxed"))&&arguments[3]!=!1&&(r.lineWidth=typeof n.Get("chart.key.linewidth")=="number"?n.Get("chart.key.linewidth"):1,n.Get("chart.key.rounded")==!0?(r.beginPath(),r.strokeStyle="#333",RGraph.strokedCurvyRect(r,Math.round(o),Math.round(h),c-5,5+(u+5)*RGraph.getKeyLength(t),4),r.stroke(),r.fill(),RGraph.NoShadow(n)):(r.strokeRect(Math.round(o),Math.round(h),c-5,5+(u+5)*RGraph.getKeyLength(t)),r.fillRect(Math.round(o),Math.round(h),c-5,5+(u+5)*RGraph.getKeyLength(t)))),RGraph.NoShadow(n),r.beginPath(),n.Get("chart.key.colors")&&(i=n.Get("chart.key.colors")),s=t.length-1;s>=0;s--)if(f=Number(s)+1,l=typeof n.properties["chart.key.color.shape"]=="object"&&typeof n.properties["chart.key.color.shape"][s]=="string"?n.properties["chart.key.color.shape"][s]:typeof n.properties["chart.key.color.shape"]=="string"?n.properties["chart.key.color.shape"]:"square",l=="circle"?(r.beginPath(),r.fillStyle=i[s],r.arc(o+5+e/2,h+5*f+u*f-u+e/2,e/2,0,6.26,0),r.fill()):l=="line"?(r.beginPath(),r.strokeStyle=i[s],r.moveTo(o+5,h+5*f+u*f-u+e/2),r.lineTo(o+e+5,h+5*f+u*f-u+e/2),r.stroke()):l=="triangle"?(r.beginPath(),r.strokeStyle=i[s],r.moveTo(o+5,h+5*f+u*f-u+e),r.lineTo(o+e/2+5,h+5*f+u*f-u),r.lineTo(o+e+5,h+5*f+u*f-u+e),r.closePath(),r.fillStyle=i[s],r.fill()):(r.fillStyle=i[s],r.fillRect(o+5,h+5*f+u*f-u,u,u+1)),r.beginPath(),r.fillStyle="black",RGraph.Text2(n,{font:p,size:u,x:o+e+5+5,y:h+5*f+u*f+3,text:t[s]}),n.Get("chart.key.interactive")){var b=o+5,k=h+5*f+u*f-u,d=c-15,g=u;n.coords.key.push([b,k,d,g])}r.fill(),n.Get("chart.key.interactive")&&(InteractiveKey_line_mousemove=function(n){for(var r=RGraph.ObjectRegistry.getObjectsByCanvasID(n.target.id),t=0;t<r.length;++t){var i=r[t],u=RGraph.getMouseXY(n),f=u[0],e=u[1];if(i.coords.key&&i.coords.key.length)for(t=0;t<i.coords.key.length;++t){var h=i.coords.key.length-t-1,o=i.coords.key[t][0],s=i.coords.key[t][1],c=i.coords.key[t][2],l=i.coords.key[t][3];if(f>o-2&&f<o+c+2&&e>s-2&&e<s+l+2&&(i.type=="pie"?i.data[h]>0:1)){mouse_over_key=!0;return}mouse_over_key=!1,typeof i.Get("chart.tooltips")=="object"&&typeof canvas_onmousemove_func=="function"&&canvas_onmousemove_func(n)}}},InteractiveKey_line_mouseup=function(n){for(var v=RGraph.ObjectRegistry.getObjectsByCanvasID(n.target.id),t,u,f,i=0;i<v.length;++i)if(t=v[i],!RGraph.is_null(t)&&t.type=="line"){var y=RGraph.getMouseXY(n),p=y[0],w=y[1];for(RGraph.DrawKey(t,t.Get("chart.key"),t.Get("chart.colors")),i=0;i<t.coords.key.length;++i){var o=t.coords.key[i][0],s=t.coords.key[i][1],c=t.coords.key[i][2],h=t.coords.key[i][3];if(p>o-2&&p<o+c+2&&w>s-2&&w<s+h+2){if(RGraph.RedrawCanvas(t.canvas),u=t.coords.key.length-i-1,t.context.beginPath(),t.context.fillStyle="rgba(255,255,255,0.9)",t.context.rect(Math.round(t.Get("chart.gutter.left"))-1,Math.round(t.Get("chart.gutter.top"))-1,a.width-t.properties["chart.gutter.left"]-t.properties["chart.gutter.right"]+2,a.height-t.Get("chart.gutter.bottom")-t.Get("chart.gutter.top")+2),t.context.fill(),r.beginPath(),t.DrawAxes(),r.stroke(),t.context.beginPath(),t.Get("chart.shadow")&&(typeof t.Get("chart.shadow.color")=="string"?RGraph.SetShadow(t,t.Get("chart.shadow.color"),t.Get("chart.shadow.offsetx"),t.Get("chart.shadow.offsety"),t.Get("chart.shadow.blur")):RGraph.SetShadow(t,t.Get("chart.shadow.color")[t.Get("chart.shadow.color").length-1-i],t.Get("chart.shadow.offsetx"),t.Get("chart.shadow.offsety"),t.Get("chart.shadow.blur"))),t.context.strokeStyle=t.Get("chart.colors")[u],t.context.lineWidth=t.Get("chart.linewidth"),t.coords2&&t.coords2[u]&&t.coords2[u].length)for(f=0;f<t.coords2[u].length;++f){var b=t.coords2[u][f][0],l=t.coords2[u][f][1],k=t.coords2[u][f-1]&&t.coords2[u][f-1][1];f==0||l==null||k==null?t.context.moveTo(b,l):t.context.lineTo(b,l)}t.context.stroke(),t.context.lineWidth=1,t.context.beginPath(),t.context.strokeStyle="black",t.context.fillStyle="white",RGraph.SetShadow(t,"rgba(0,0,0,0.5)",0,0,10),t.context.strokeRect(o-2,s-2,c+4,h+4),t.context.fillRect(o-2,s-2,c+4,h+4),t.context.stroke(),t.context.fill(),RGraph.NoShadow(t),t.context.beginPath(),t.context.fillStyle=t.Get("chart.colors")[u],t.context.fillRect(o,s,e,e),t.context.fill(),t.context.beginPath(),t.context.fillStyle=t.Get("chart.text.color"),RGraph.Text2(t,{font:t.Get("chart.text.font"),size:t.Get("chart.text.size"),x:o+5+e,y:s+h+3,text:t.Get("chart.key")[t.Get("chart.key").length-i-1]}),r.fill(),t.canvas.style.cursor="pointer",n.cancelBubble=!0,n.stopPropagation()}a.style.cursor="default"}}},InteractiveKey_pie_mousemove=function(n){InteractiveKey_line_mousemove(n)},InteractiveKey_pie_mouseup=function(n){for(var s=RGraph.ObjectRegistry.objects.byCanvasID,l,i=0;i<s.length;++i)if(s[i][0]==n.target.id&&s[i][1].type=="pie"){var t=s[i][1],a=RGraph.getMouseXY(n),v=a[0],y=a[1];if(t.coords.key&&t.coords.key.length)for(RGraph.RedrawCanvas(t.canvas),i=0;i<t.coords.key.length;++i){var u=t.coords.key.length-i-1,f=t.coords.key[i][0],o=t.coords.key[i][1],c=t.coords.key[i][2],h=t.coords.key[i][3];if(v>=f-2&&v<=f+c+2&&y>=o-2&&y<=o+h+2&&t.data[u]>0){t.context.beginPath(),t.context.fillStyle="rgba(255,255,255,0.9)",t.context.rect(0,0,t.canvas.width,t.canvas.height),t.context.fill(),l=t.angles[u],t.context.beginPath(),RGraph.SetShadow(t,"gray",0,0,15),t.context.fillStyle=t.Get("chart.colors")[u],t.context.moveTo(t.angles[u][2],t.angles[u][3]),t.context.arc(t.angles[u][2],t.angles[u][3],t.radius,l[0],l[1],!1),t.context.closePath(),t.context.fill(),t.context.lineWidth=1,t.context.beginPath(),t.context.strokeStyle="black",t.context.fillStyle="white",RGraph.SetShadow(t,"rgba(0,0,0,0.5)",0,0,10),t.context.strokeRect(f-2,o-2,c+4,h+4),t.context.fillRect(f-2,o-2,c+4,h+4),t.context.stroke(),t.context.fill(),RGraph.NoShadow(t),t.context.beginPath(),t.context.fillStyle=t.Get("chart.colors")[u],t.context.fillRect(f,o,e,e),t.context.fill(),t.context.beginPath(),t.context.fillStyle=t.Get("chart.text.color"),RGraph.Text2(t,{font:t.Get("chart.text.font"),size:t.Get("chart.text.size"),x:f+5+e,y:o+h+3,text:t.Get("chart.key")[t.Get("chart.key").length-i-1]}),r.fill(),n.stopPropagation();return}}}})},RGraph.DrawKey_gutter=function(n,t,i){var p=n.canvas,r=n.context,l=typeof n.Get("chart.key.text.size")=="number"?n.Get("chart.key.text.size"):n.Get("chart.text.size"),y=n.Get("chart.text.font"),w=n.gutterLeft,b=n.gutterRight,k=n.gutterTop,g=n.gutterBottom,s=(n.canvas.width-n.gutterLeft-n.gutterRight)/2+n.gutterLeft,o=k-l-5,nt=n.Get("chart.title"),f=l,v=8,h=4,d=n.Get("chart.key.background"),c=0,u,e,a;for(r.font=l+"pt "+y,u=0;u<t.length;++u)c+=v,c+=f,c+=v,c+=r.measureText(t[u]).width;for(c+=v,n.type=="pie"&&(s=n.Get("chart.align")=="left"?n.radius+w:n.Get("chart.align")=="right"?n.canvas.width-n.radius-b:p.width/2),s-=c/2,typeof n.Get("chart.key.position.x")=="number"&&(s=n.Get("chart.key.position.x")),typeof n.Get("chart.key.position.y")=="number"&&(o=n.Get("chart.key.position.y")),n.Get("chart.key.position.gutter.boxed")&&(n.Get("chart.key.shadow")&&(r.shadowColor=n.Get("chart.key.shadow.color"),r.shadowBlur=n.Get("chart.key.shadow.blur"),r.shadowOffsetX=n.Get("chart.key.shadow.offsetx"),r.shadowOffsetY=n.Get("chart.key.shadow.offsety")),r.beginPath(),r.fillStyle=d,r.strokeStyle="#999",n.Get("chart.key.rounded")?RGraph.strokedCurvyRect(r,s,o-h,c,l+h+h):(r.strokeRect(s,o-h,c,l+h+h),r.fillRect(s,o-h,c,l+h+h)),r.stroke(),r.fill(),RGraph.NoShadow(n)),n.Get("chart.key.colors")&&(i=n.Get("chart.key.colors")),u=0,e=s;u<t.length;++u)e+=v,a=typeof n.properties["chart.key.color.shape"]=="object"&&typeof n.properties["chart.key.color.shape"][u]=="string"?n.properties["chart.key.color.shape"][u]:typeof n.properties["chart.key.color.shape"]=="string"?n.properties["chart.key.color.shape"]:"square",a=="line"?(r.beginPath(),r.strokeStyle=i[u],r.moveTo(e,o+f/2),r.lineTo(e+f,o+f/2),r.stroke()):a=="circle"?(r.beginPath(),r.fillStyle=i[u],r.moveTo(e,o+f/2),r.arc(e+f/2,o+f/2,f/2,0,6.28,0),r.fill()):a=="triangle"?(r.fillStyle=i[u],r.beginPath(),r.strokeStyle=i[u],r.moveTo(e,o+f),r.lineTo(e+f/2,o),r.lineTo(e+f,o+f),r.closePath(),r.fill()):(r.beginPath(),r.fillStyle=i[u],r.rect(e,o,f,f),r.fill()),e+=f,e+=v,r.beginPath(),r.fillStyle="black",RGraph.Text2(n,{font:y,size:l,x:e,y:o+l+3,text:t[u]}),r.fill(),e+=r.measureText(t[u]).width},RGraph.getKeyLength=function(n){for(var i=0,t=0;t<n.length;++t)n[t]!=null&&++i;return i}