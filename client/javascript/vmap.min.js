(function(){
var l,aa=this;function n(a){return void 0!==a}
function ca(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function q(a){return"array"==ca(a)}function da(a){var b=ca(a);return"array"==b||"object"==b&&"number"==typeof a.length}function r(a){return"string"==typeof a}function ea(a){return"number"==typeof a}function fa(a){return"function"==ca(a)}function ha(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var ia="closure_uid_"+(1E9*Math.random()>>>0),ja=0;function ka(a,b,c){return a.call.apply(a.bind,arguments)}
function la(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function ma(a,b,c){ma=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ka:la;return ma.apply(null,arguments)}
function na(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}}var oa=Date.now||function(){return+new Date};function pa(a,b){a=a.split(".");var c=aa;a[0]in c||!c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)!a.length&&n(b)?c[d]=b:c=c[d]?c[d]:c[d]={}}
function qa(a,b){function c(){}c.prototype=b.prototype;a.ou=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.JL=function(a,c,f){for(var d=Array(arguments.length-2),e=2;e<arguments.length;e++)d[e-2]=arguments[e];return b.prototype[c].apply(a,d)}};function ra(){0!=sa&&(ta[this[ia]||(this[ia]=++ja)]=this);this.mi=this.mi;this.Gp=this.Gp}var sa=0,ta={};ra.prototype.mi=!1;ra.prototype.Yd=function(){if(!this.mi&&(this.mi=!0,this.ab(),0!=sa)){var a=this[ia]||(this[ia]=++ja);delete ta[a]}};ra.prototype.ab=function(){if(this.Gp)for(;this.Gp.length;)this.Gp.shift()()};var ua=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};function va(a){if(!xa.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(ya,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(za,"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(Aa,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(Ba,"&quot;"));-1!=a.indexOf("'")&&(a=a.replace(Ca,"&#39;"));-1!=a.indexOf("\x00")&&(a=a.replace(Da,"&#0;"));return a}var ya=/&/g,za=/</g,Aa=/>/g,Ba=/"/g,Ca=/'/g,Da=/\x00/g,xa=/[\x00&<>"']/;
function Ea(a,b){return a<b?-1:a>b?1:0}var Fa=2147483648*Math.random()|0;function Ga(a,b){b=r(b)?String(b).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"):"\\s";return a.replace(new RegExp("(^"+(b?"|["+b+"]+":"")+")([a-z])","g"),function(a,b,e){return b+e.toUpperCase()})};function Ha(a){var b;b=b||0;return function(){return a.apply(this,Array.prototype.slice.call(arguments,0,b))}};var Ia=Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(r(a))return r(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},Ja=Array.prototype.forEach?function(a,b,c){Array.prototype.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=r(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)},Ka=Array.prototype.filter?function(a,b,c){return Array.prototype.filter.call(a,
b,c)}:function(a,b,c){for(var d=a.length,e=[],f=0,g=r(a)?a.split(""):a,h=0;h<d;h++)if(h in g){var k=g[h];b.call(c,k,h,a)&&(e[f++]=k)}return e},La=Array.prototype.map?function(a,b,c){return Array.prototype.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=r(a)?a.split(""):a,g=0;g<d;g++)g in f&&(e[g]=b.call(c,f[g],g,a));return e};function Ma(a,b){return 0<=Ia(a,b)}function Na(a){if(!q(a))for(var b=a.length-1;0<=b;b--)delete a[b];a.length=0}function Oa(a,b){Ma(a,b)||a.push(b)}
function Pa(a,b){na(Qa,a,-1,0).apply(null,b)}function Ra(a,b){Array.prototype.splice.call(a,b,1)}function Ua(a){return Array.prototype.concat.apply(Array.prototype,arguments)}function Va(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]}function Wa(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(da(d)){var e=a.length||0,f=d.length||0;a.length=e+f;for(var g=0;g<f;g++)a[e+g]=d[g]}else a.push(d)}}
function Qa(a,b,c,d){return Array.prototype.splice.apply(a,Xa(arguments,1))}function Xa(a,b,c){return 2>=arguments.length?Array.prototype.slice.call(a,b):Array.prototype.slice.call(a,b,c)}function Ya(a,b){var c;c=0;for(var d=a.length,e;c<d;){var f=c+d>>1,g;g=a[f];g=b>g?1:b<g?-1:0;0<g?c=f+1:(d=f,e=!g)}c=e?c:~c;0>c&&Qa(a,-(c+1),0,b)}function Za(a){for(var b=[],c=0;c<a;c++)b[c]=0;return b};var $a;a:{var ab=aa.navigator;if(ab){var bb=ab.userAgent;if(bb){$a=bb;break a}}$a=""};function cb(a,b){for(var c in a)b.call(void 0,a[c],c,a)}function db(a,b){for(var c in a)if(b.call(void 0,a[c],c,a))return!0;return!1}function eb(a,b){for(var c in a)if(a[c]==b)return!0;return!1}function fb(a){for(var b in a)return!1;return!0}function gb(a){for(var b in a)delete a[b]}function hb(a,b){b in a&&delete a[b]}function ib(a){var b={},c;for(c in a)b[c]=a[c];return b}var jb="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
function kb(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<jb.length;f++)c=jb[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};function lb(a){lb[" "](a);return a}lb[" "]=function(){};function mb(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:a[b]=c(b)};var nb=-1!=$a.indexOf("Opera"),ob=-1!=$a.indexOf("Trident")||-1!=$a.indexOf("MSIE"),pb=-1!=$a.indexOf("Edge"),qb=-1!=$a.indexOf("Gecko")&&!(-1!=$a.toLowerCase().indexOf("webkit")&&-1==$a.indexOf("Edge"))&&!(-1!=$a.indexOf("Trident")||-1!=$a.indexOf("MSIE"))&&-1==$a.indexOf("Edge"),rb=-1!=$a.toLowerCase().indexOf("webkit")&&-1==$a.indexOf("Edge");function sb(){var a=aa.document;return a?a.documentMode:void 0}var tb;
a:{var ub="",vb=function(){var a=$a;if(qb)return/rv\:([^\);]+)(\)|;)/.exec(a);if(pb)return/Edge\/([\d\.]+)/.exec(a);if(ob)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(rb)return/WebKit\/(\S+)/.exec(a);if(nb)return/(?:Version)[ \/]?(\S+)/.exec(a)}();vb&&(ub=vb?vb[1]:"");if(ob){var wb=sb();if(null!=wb&&wb>parseFloat(ub)){tb=String(wb);break a}}tb=ub}var yb={};
function zb(a){return mb(yb,a,function(){for(var b=0,c=ua(String(tb)).split("."),d=ua(String(a)).split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",h=d[f]||"";do{g=/(\d*)(\D*)(.*)/.exec(g)||["","","",""];h=/(\d*)(\D*)(.*)/.exec(h)||["","","",""];if(0==g[0].length&&0==h[0].length)break;b=Ea(0==g[1].length?0:parseInt(g[1],10),0==h[1].length?0:parseInt(h[1],10))||Ea(0==g[2].length,0==h[2].length)||Ea(g[2],h[2]);g=g[3];h=h[3]}while(0==b)}return 0<=b})}var Ab;var Bb=aa.document;
Ab=Bb&&ob?sb()||("CSS1Compat"==Bb.compatMode?parseInt(tb,10):5):void 0;var Cb=!ob||9<=Number(Ab),Db=ob&&!zb("9");!rb||zb("528");qb&&zb("1.9b")||ob&&zb("8")||nb&&zb("9.5")||rb&&zb("528");qb&&!zb("8")||ob&&zb("9");function Eb(a,b){this.type=a;this.currentTarget=this.target=b;this.defaultPrevented=this.It=!1}Eb.prototype.stopPropagation=function(){this.It=!0};Eb.prototype.preventDefault=function(){this.defaultPrevented=!0};function Fb(a,b){Eb.call(this,a?a.type:"");this.relatedTarget=this.currentTarget=this.target=null;this.charCode=this.keyCode=this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0;this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.Dl=this.state=null;a&&this.lh(a,b)}qa(Fb,Eb);
Fb.prototype.lh=function(a,b){var c=this.type=a.type,d=a.changedTouches?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.currentTarget=b;if(b=a.relatedTarget){if(qb){var e;a:{try{lb(b.nodeName);e=!0;break a}catch(f){}e=!1}e||(b=null)}}else"mouseover"==c?b=a.fromElement:"mouseout"==c&&(b=a.toElement);this.relatedTarget=b;null===d?(this.offsetX=rb||void 0!==a.offsetX?a.offsetX:a.layerX,this.offsetY=rb||void 0!==a.offsetY?a.offsetY:a.layerY,this.clientX=void 0!==a.clientX?a.clientX:a.pageX,
this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0):(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0);this.button=a.button;this.keyCode=a.keyCode||0;this.charCode=a.charCode||("keypress"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.state=a.state;this.Dl=a;a.defaultPrevented&&this.preventDefault()};
Fb.prototype.stopPropagation=function(){Fb.ou.stopPropagation.call(this);this.Dl.stopPropagation?this.Dl.stopPropagation():this.Dl.cancelBubble=!0};Fb.prototype.preventDefault=function(){Fb.ou.preventDefault.call(this);var a=this.Dl;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,Db)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var Gb="closure_listenable_"+(1E6*Math.random()|0),Hb=0;function Jb(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.Mn=!!d;this.Ds=e;this.key=++Hb;this.Am=this.Aj=!1}function Kb(a){a.Am=!0;a.listener=null;a.proxy=null;a.src=null;a.Ds=null};function Lb(a){this.src=a;this.Jd={};this.an=0}Lb.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.Jd[f];a||(a=this.Jd[f]=[],this.an++);var g=Mb(a,b,d,e);-1<g?(b=a[g],c||(b.Aj=!1)):(b=new Jb(b,this.src,f,!!d,e),b.Aj=c,a.push(b));return b};Lb.prototype.remove=function(a,b,c,d){a=a.toString();if(!(a in this.Jd))return!1;var e=this.Jd[a];b=Mb(e,b,c,d);return-1<b?(Kb(e[b]),Ra(e,b),0==e.length&&(delete this.Jd[a],this.an--),!0):!1};
Lb.prototype.removeAll=function(a){a=a&&a.toString();var b=0,c;for(c in this.Jd)if(!a||c==a){for(var d=this.Jd[c],e=0;e<d.length;e++)++b,Kb(d[e]);delete this.Jd[c];this.an--}return b};Lb.prototype.hasListener=function(a,b){var c=n(a),d=c?a.toString():"",e=n(b);return db(this.Jd,function(a){for(var f=0;f<a.length;++f)if(!(c&&a[f].type!=d||e&&a[f].Mn!=b))return!0;return!1})};function Mb(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.Am&&f.listener==b&&f.Mn==!!c&&f.Ds==d)return e}return-1};var Nb="closure_lm_"+(1E6*Math.random()|0),Ob={},Pb=0;function Qb(a,b,c,d,e){if(q(b)){for(var f=0;f<b.length;f++)Qb(a,b[f],c,d,e);return null}c=Rb(c);return a&&a[Gb]?a.cM(b,c,d,e):Sb(a,b,c,!1,d,e)}
function Sb(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=!!e,h=Tb(a);h||(a[Nb]=h=new Lb(a));c=h.add(b,c,d,e,f);if(c.proxy)return c;d=Ub();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)a.addEventListener(b.toString(),d,g);else if(a.attachEvent)a.attachEvent(Vb(b.toString()),d);else throw Error("addEventListener and attachEvent are unavailable.");Pb++;return c}
function Ub(){var a=Wb,b=Cb?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b}function Xb(a,b,c,d,e){if(q(b))for(var f=0;f<b.length;f++)Xb(a,b[f],c,d,e);else c=Rb(c),a&&a[Gb]?a.dM(b,c,d,e):Sb(a,b,c,!0,d,e)}
function Yb(a){if(!ea(a)&&a&&!a.Am){var b=a.src;if(b&&b[Gb])b.yM(a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.Mn):b.detachEvent&&b.detachEvent(Vb(c),d);Pb--;if(c=Tb(b)){var d=a.type,e;if(e=d in c.Jd){e=c.Jd[d];var f=Ia(e,a),g;(g=0<=f)&&Ra(e,f);e=g}e&&(Kb(a),0==c.Jd[d].length&&(delete c.Jd[d],c.an--));0==c.an&&(c.src=null,b[Nb]=null)}else Kb(a)}}}function Vb(a){return a in Ob?Ob[a]:Ob[a]="on"+a}
function Zb(a,b,c,d){var e=!0;if(a=Tb(a))if(b=a.Jd[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.Mn==c&&!f.Am&&(f=$b(f,d),e=e&&!1!==f)}return e}function $b(a,b){var c=a.listener,d=a.Ds||a.src;a.Aj&&Yb(a);return c.call(d,b)}
function Wb(a,b){if(a.Am)return!0;if(!Cb){if(!b)a:{b=["window","event"];for(var c=aa,d;d=b.shift();)if(null!=c[d])c=c[d];else{b=null;break a}b=c}d=b;b=new Fb(d,this);c=!0;if(!(0>d.keyCode||void 0!=d.returnValue)){a:{var e=!1;if(0==d.keyCode)try{d.keyCode=-1;break a}catch(g){e=!0}if(e||void 0==d.returnValue)d.returnValue=!0}d=[];for(e=b.currentTarget;e;e=e.parentNode)d.push(e);a=a.type;for(e=d.length-1;!b.It&&0<=e;e--){b.currentTarget=d[e];var f=Zb(d[e],a,!0,b),c=c&&f}for(e=0;!b.It&&e<d.length;e++)b.currentTarget=
d[e],f=Zb(d[e],a,!1,b),c=c&&f}return c}return $b(a,new Fb(b,this))}function Tb(a){a=a[Nb];return a instanceof Lb?a:null}var ac="__closure_events_fn_"+(1E9*Math.random()>>>0);function Rb(a){if(fa(a))return a;a[ac]||(a[ac]=function(b){return a.handleEvent(b)});return a[ac]};var bc=!ob||9<=Number(Ab);!qb&&!ob||ob&&9<=Number(Ab)||qb&&zb("1.9.1");ob&&zb("9");function dc(a,b){cb(b,function(b,d){"style"==d?a.style.cssText=b:"class"==d?a.className=b:"for"==d?a.htmlFor=b:ec.hasOwnProperty(d)?a.setAttribute(ec[d],b):0==d.lastIndexOf("aria-",0)||0==d.lastIndexOf("data-",0)?a.setAttribute(d,b):a[d]=b})}var ec={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};
function fc(a,b,c){var d=arguments,e=document,f=String(d[0]),g=d[1];if(!bc&&g&&(g.name||g.type)){f=["<",f];g.name&&f.push(' name="',va(g.name),'"');if(g.type){f.push(' type="',va(g.type),'"');var h={};kb(h,g);delete h.type;g=h}f.push(">");f=f.join("")}f=e.createElement(f);g&&(r(g)?f.className=g:q(g)?f.className=g.join(" "):dc(f,g));2<d.length&&gc(e,f,d);return f}
function gc(a,b,c){function d(c){c&&b.appendChild(r(c)?a.createTextNode(c):c)}for(var e=2;e<c.length;e++){var f=c[e];!da(f)||ha(f)&&0<f.nodeType?d(f):Ja(hc(f)?Va(f):f,d)}}function hc(a){if(a&&"number"==typeof a.length){if(ha(a))return"function"==typeof a.item||"string"==typeof a.item;if(fa(a))return"function"==typeof a.item}return!1};function ic(a,b,c){ra.call(this);this.Wc=null;this.Ku=!1;this.nG=a;this.UF=c;this.ag=b||window;this.wr=ma(this.Jw,this)}qa(ic,ra);l=ic.prototype;l.start=function(){this.stop();this.Ku=!1;var a=jc(this),b=kc(this);a&&!b&&this.ag.mozRequestAnimationFrame?(this.Wc=Qb(this.ag,"MozBeforePaint",this.wr),this.ag.mozRequestAnimationFrame(null),this.Ku=!0):this.Wc=a&&b?a.call(this.ag,this.wr):this.ag.setTimeout(Ha(this.wr),20)};
l.stop=function(){if(null!=this.Wc){var a=jc(this),b=kc(this);a&&!b&&this.ag.mozRequestAnimationFrame?Yb(this.Wc):a&&b?b.call(this.ag,this.Wc):this.ag.clearTimeout(this.Wc)}this.Wc=null};l.fire=function(){this.stop();this.Jw()};l.Jw=function(){this.Ku&&this.Wc&&Yb(this.Wc);this.Wc=null;this.nG.call(this.UF,oa())};l.ab=function(){this.stop();ic.ou.ab.call(this)};
function jc(a){a=a.ag;return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||null}function kc(a){a=a.ag;return a.cancelAnimationFrame||a.cancelRequestAnimationFrame||a.webkitCancelRequestAnimationFrame||a.mozCancelRequestAnimationFrame||a.oCancelRequestAnimationFrame||a.msCancelRequestAnimationFrame||null};function mc(a){return La(a,function(a){a=a.toString(16);return 1<a.length?a:"0"+a}).join("")};function nc(){this.zj=-1};function oc(a,b){this.zj=pc;this.Nn=aa.Uint8Array?new Uint8Array(this.zj):Array(this.zj);this.Bq=this.Yj=0;this.Hb=[];this.lH=a;this.Qx=b;this.XK=aa.Int32Array?new Int32Array(64):Array(64);n(qc)||(qc=aa.Int32Array?new Int32Array(rc):rc);this.reset()}var qc;qa(oc,nc);var pc=64,sc=Ua(128,Za(pc-1));oc.prototype.reset=function(){this.Bq=this.Yj=0;this.Hb=aa.Int32Array?new Int32Array(this.Qx):Va(this.Qx)};
function tc(a){for(var b=a.Nn,c=a.XK,d=0,e=0;e<b.length;)c[d++]=b[e]<<24|b[e+1]<<16|b[e+2]<<8|b[e+3],e=4*d;for(b=16;64>b;b++){var e=c[b-15]|0,d=c[b-2]|0,f=(c[b-16]|0)+((e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3)|0,g=(c[b-7]|0)+((d>>>17|d<<15)^(d>>>19|d<<13)^d>>>10)|0;c[b]=f+g|0}for(var d=a.Hb[0]|0,e=a.Hb[1]|0,h=a.Hb[2]|0,k=a.Hb[3]|0,m=a.Hb[4]|0,p=a.Hb[5]|0,t=a.Hb[6]|0,f=a.Hb[7]|0,b=0;64>b;b++)var v=((d>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10))+(d&e^d&h^e&h)|0,g=m&p^~m&t,f=f+((m>>>6|m<<26)^(m>>>11|m<<21)^
(m>>>25|m<<7))|0,g=g+(qc[b]|0)|0,g=f+(g+(c[b]|0)|0)|0,f=t,t=p,p=m,m=k+g|0,k=h,h=e,e=d,d=g+v|0;a.Hb[0]=a.Hb[0]+d|0;a.Hb[1]=a.Hb[1]+e|0;a.Hb[2]=a.Hb[2]+h|0;a.Hb[3]=a.Hb[3]+k|0;a.Hb[4]=a.Hb[4]+m|0;a.Hb[5]=a.Hb[5]+p|0;a.Hb[6]=a.Hb[6]+t|0;a.Hb[7]=a.Hb[7]+f|0}
oc.prototype.update=function(a,b){n(b)||(b=a.length);var c=0,d=this.Yj;if(r(a))for(;c<b;)this.Nn[d++]=a.charCodeAt(c++),d==this.zj&&(tc(this),d=0);else if(da(a))for(;c<b;){var e=a[c++];if(!("number"==typeof e&&0<=e&&255>=e&&e==(e|0)))throw Error("message must be a byte array");this.Nn[d++]=e;d==this.zj&&(tc(this),d=0)}else throw Error("message must be string or array");this.Yj=d;this.Bq+=b};
oc.prototype.digest=function(){var a=[],b=8*this.Bq;56>this.Yj?this.update(sc,56-this.Yj):this.update(sc,this.zj-(this.Yj-56));for(var c=63;56<=c;c--)this.Nn[c]=b&255,b/=256;tc(this);for(c=b=0;c<this.lH;c++)for(var d=24;0<=d;d-=8)a[b++]=this.Hb[c]>>d&255;return a};
var rc=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,
4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function uc(){oc.call(this,8,vc)}qa(uc,oc);var vc=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function wc(a,b){this.jc=a|0;this.pb=b|0}var xc={},yc={};function zc(a){return-128<=a&&128>a?mb(xc,a,function(a){return new wc(a|0,0>a?-1:0)}):new wc(a|0,0>a?-1:0)}function Ac(a){return isNaN(a)?Bc():a<=-Cc?Dc():a+1>=Cc?Ec():0>a?Fc(Ac(-a)):new wc(a%Gc|0,a/Gc|0)}var Gc=4294967296,Cc=Gc*Gc/2;function Bc(){return mb(yc,Hc,function(){return zc(0)})}function Ic(){return mb(yc,Jc,function(){return zc(1)})}function Kc(){return mb(yc,Lc,function(){return zc(-1)})}
function Ec(){return mb(yc,Mc,function(){return new wc(-1,2147483647)})}function Dc(){return mb(yc,Nc,function(){return new wc(0,-2147483648)})}function Pc(){return mb(yc,Qc,function(){return zc(16777216)})}l=wc.prototype;
l.toString=function(a){a=a||10;if(2>a||36<a)throw Error("radix out of range: "+a);if(Rc(this))return"0";if(0>this.pb){if(this.equals(Dc())){var b=Ac(a),c=Sc(this,b),b=Tc(c.multiply(b),this);return c.toString(a)+b.jc.toString(a)}return"-"+Fc(this).toString(a)}for(var c=Ac(Math.pow(a,6)),b=this,d="";;){var e=Sc(b,c),f=(Tc(b,e.multiply(c)).jc>>>0).toString(a),b=e;if(Rc(b))return f+d;for(;6>f.length;)f="0"+f;d=""+f+d}};function Uc(a){return 0<=a.jc?a.jc:Gc+a.jc}
function Rc(a){return 0==a.pb&&0==a.jc}l.equals=function(a){return this.pb==a.pb&&this.jc==a.jc};l.compare=function(a){if(this.equals(a))return 0;var b=0>this.pb,c=0>a.pb;return b&&!c?-1:!b&&c?1:0>Tc(this,a).pb?-1:1};function Fc(a){return a.equals(Dc())?Dc():a.not().add(Ic())}
l.add=function(a){var b=this.pb>>>16,c=this.pb&65535,d=this.jc>>>16,e=a.pb>>>16,f=a.pb&65535,g=a.jc>>>16;a=0+((this.jc&65535)+(a.jc&65535));g=0+(a>>>16)+(d+g);d=0+(g>>>16);d+=c+f;b=0+(d>>>16)+(b+e)&65535;return new wc((g&65535)<<16|a&65535,b<<16|d&65535)};function Tc(a,b){return a.add(Fc(b))}
l.multiply=function(a){if(Rc(this)||Rc(a))return Bc();if(this.equals(Dc()))return 1==(a.jc&1)?Dc():Bc();if(a.equals(Dc()))return 1==(this.jc&1)?Dc():Bc();if(0>this.pb)return 0>a.pb?Fc(this).multiply(Fc(a)):Fc(Fc(this).multiply(a));if(0>a.pb)return Fc(this.multiply(Fc(a)));if(0>this.compare(Pc())&&0>a.compare(Pc()))return Ac((this.pb*Gc+Uc(this))*(a.pb*Gc+Uc(a)));var b=this.pb>>>16,c=this.pb&65535,d=this.jc>>>16,e=this.jc&65535,f=a.pb>>>16,g=a.pb&65535,h=a.jc>>>16;a=a.jc&65535;var k,m,p,t;t=0+e*a;
p=0+(t>>>16)+d*a;m=0+(p>>>16);p=(p&65535)+e*h;m+=p>>>16;m+=c*a;k=0+(m>>>16);m=(m&65535)+d*h;k+=m>>>16;m=(m&65535)+e*g;k=k+(m>>>16)+(b*a+c*h+d*g+e*f)&65535;return new wc((p&65535)<<16|t&65535,k<<16|m&65535)};
function Sc(a,b){if(Rc(b))throw Error("division by zero");if(Rc(a))return Bc();if(a.equals(Dc())){if(b.equals(Ic())||b.equals(Kc()))return Dc();if(b.equals(Dc()))return Ic();var c;c=1;if(0==c)c=a;else{var d=a.pb;c=32>c?new wc(a.jc>>>c|d<<32-c,d>>c):new wc(d>>c-32,0<=d?0:-1)}c=Sc(c,b).shiftLeft(1);if(c.equals(Bc()))return 0>b.pb?Ic():Kc();a=Tc(a,b.multiply(c));return c.add(Sc(a,b))}if(b.equals(Dc()))return Bc();if(0>a.pb)return 0>b.pb?Sc(Fc(a),Fc(b)):Fc(Sc(Fc(a),b));if(0>b.pb)return Fc(Sc(a,Fc(b)));
for(d=Bc();0<=a.compare(b);){c=Math.max(1,Math.floor((a.pb*Gc+Uc(a))/(b.pb*Gc+Uc(b))));for(var e=Math.ceil(Math.log(c)/Math.LN2),e=48>=e?1:Math.pow(2,e-48),f=Ac(c),g=f.multiply(b);0>g.pb||0<g.compare(a);)c-=e,f=Ac(c),g=f.multiply(b);Rc(f)&&(f=Ic());d=d.add(f);a=Tc(a,g)}return d}l.not=function(){return new wc(~this.jc,~this.pb)};l.shiftLeft=function(a){a&=63;if(0==a)return this;var b=this.jc;return 32>a?new wc(b<<a,this.pb<<a|b>>>32-a):new wc(0,b<<a-32)};var Mc=1,Nc=2,Hc=3,Jc=4,Lc=5,Qc=6;Ua([128],Za(127));
for(var Vc=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,
1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,
1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,
289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],Wc=[],Xc=0;Xc<Vc.length;Xc+=2)Wc.push(new wc(Vc[Xc+1],Vc[Xc]));function u(){}pa("vitisApp",u);u.hk={};u.on=function(a,b){null!=u.hk[a]?u.hk[a].push(b):u.hk[a]=[b]};u.gl=function(a){if(null!=u.hk[a])for(var b=0;b<u.hk[a].length;b++)u.hk[a][b].call()};u.htmlentities=function(a){var b="\u00e0\u00e2\u00e7\u00e8\u00e9\u00ea\u00ee\u00ef\u00f4\u00f9\u00fb".split("");return a.replace(/./gm,function(a){return-1!=b.indexOf(a)?"&#"+a.charCodeAt(0)+";":a})};
$(document).ready(function(){$(document).on("show.bs.modal",".modal",function(){$(this).parent().append('<div class="submodal-backdrop modal-backdrop fade in"></div>')});$(document).on("hide.bs.modal",".modal",function(){$(this).parent().find(".submodal-backdrop").remove()})});
function Yc(a){for(var b=[/[\300-\306]/g,/[\340-\346]/g,/[\310-\313]/g,/[\350-\353]/g,/[\314-\317]/g,/[\354-\357]/g,/[\322-\330]/g,/[\362-\370]/g,/[\331-\334]/g,/[\371-\374]/g,/[\321]/g,/[\361]/g,/[\307]/g,/[\347]/g],c="AaEeIiOoUuNnCc".split(""),d=0;d<b.length;d++)a=a.replace(b[d],c[d]);return a}
function Zc(a){for(var b=["request","service","version"],c,d,e=0;e<b.length;e++)c=a.toLowerCase().indexOf("&"+b[e]+"="),-1!==c?(d=a.toLowerCase().indexOf("&",c+1),a=0<d?a.replace(a.slice(c,d),""):a.replace(a.slice(c),"")):(c=a.toLowerCase().indexOf("?"+b[e]+"="),-1!==c&&(d=a.toLowerCase().indexOf("&",c+1),a=0<d?a.replace(a.slice(c,d+1),"?"):a.replace(a.slice(c),"")));return a}
function $c(a){for(var b=new uc,c=[],d=0,e=0;e<a.length;e++){for(var f=a.charCodeAt(e);255<f;)c[d++]=f&255,f>>=8;c[d++]=f}b.update(c);a=b.digest();return a=mc(a)};function ad(a,b){var c=Date.now();"undefined"!=typeof oClientProperties&&(c=oClientProperties.build);if("object"==typeof a&&null!=a){var d,e=!0,f=!1;"object"===typeof b&&(d=b.callback,"boolean"===typeof b.async&&(e=b.async),"boolean"===typeof b.scriptInBody&&(f=b.scriptInBody));b=document.getElementsByTagName("script");for(var g=[],h=0;h<b.length;)""!==b[h].src&&g.push(b[h].src),h++;for(var h=0,k=[];h<a.length;)a[h]=a[h]+"?version="+c,b=document.createElement("script"),b.setAttribute("src",a[h]),
-1===bd(b.src,g)?k.push(a[h]):console.log(a[h]+" -> d\u00e9ja charg\u00e9"),h++;for(h=0;h<k.length;){b=document.createElement("script");b.setAttribute("src",k[h]);b.async=e;b.setAttribute("type","text/javascript");if("function"===typeof d){var m=function(){"undefined"===typeof d.Ls&&(d.Ls=0);d.Ls++;d.Ls===k.length&&(d(),this.onload=null)};void 0!==b.onload?b.onload=m:void 0!==b.onreadystatechange&&(b.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||m()})}f?document.getElementsByTagName("body")[0].appendChild(b):
document.getElementsByTagName("head")[0].appendChild(b);h++}0===k.length&&"function"===typeof d&&d()}}function bd(a,b){var c=-1;if("undefined"!=typeof b.indexOf)c=b.indexOf(a);else for(var d=0;d<b;){if(-1!=b[d].indexOf(a)){c=d;break}d++}return c}
function cd(){if(null===document.getElementById("ajax-modal")){var a=document.createElement("div");a.id="ajax-modal";a.className="modal-backdrop fade in";a.style.opacity="0.2";a.style["z-index"]="9999";document.getElementsByTagName("body")[0].appendChild(a)}if(null===document.getElementById("ajax-container")){var a=document.createElement("div"),b=document.createElement("span");a.id="ajax-container";a.className="ajax_loader_container";b.className="icon-refresh glyphicon-refresh-animate";a.appendChild(b);
document.getElementsByTagName("body")[0].appendChild(a)}}function dd(){sessionStorage.loading_counter=0;var a=document.getElementById("ajax-modal");null!=a&&a.parentNode.removeChild(a);a=document.getElementById("ajax-container");null!=a&&a.parentNode.removeChild(a)}
function z(a){var b=new XMLHttpRequest,c=angular.copy(oClientProperties.web_server_name);-1!==c.indexOf(":",6)&&(c=c.substr(0,c.indexOf(":",6)));var d=!1;a.url.substr(0,c.length)===c&&(d=!0);"string"==typeof oClientProperties.proxy_url&&a.url.substr(0,oClientProperties.proxy_url.length)===oClientProperties.proxy_url&&(d=!1);c={Accept:"application/json"};d&&(c.Token=sessionStorage.session_token);"undefined"==typeof a.async&&(a.async=!0);"undefined"!=typeof a.headers&&ed(c,a.headers);null!=a.timeout||
null!=oClientProperties.max_request_time&&(a.timeout=1E3*oClientProperties.max_request_time);switch(a.responseType){case "":break;case "text":break;case "json":break;case "blob":break;case "arraybuffer":break;case "document":break;default:a.responseType="json"}"undefined"==typeof a.disconnect&&(a.disconnect=!0);if("undefined"!=typeof a.method&&"undefined"!=typeof a.url){b.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE){switch(a.responseType){case "":case "text":var c={data:this.responseText,
status:this.status,statusText:this.statusText};break;default:c={data:this.response,status:this.status,statusText:this.statusText}}null!=c.data&&"json"==a.responseType&&"string"==typeof c.data&&(c.data=JSON.parse(c.data));if(200===this.status){if("json"==a.responseType&&null!=c.data&&"object"==typeof c.data){var d=angular.element(u.Pb).injector().get(["sessionSrvc"]),e=angular.element(u.Pb).injector().get(["externFunctionSrvc"]),f={className:"modal-danger",buttons:{ok:{label:"OK",className:"btn-default"}},
callback:function(){!0===a.disconnect&&d.disconnect()}},p="";if(null!=c.data)switch(c.data.errorCode){case 15:p="EXPIRED_TOKEN_ERROR_TITLE";f.message=!0===a.disconnect?"EXPIRED_TOKEN_ERROR":"EXPIRED_TOKEN_NO_DISCONNECT_ERROR";break;case 16:p="INVALID_TOKEN_ERROR_TITLE",f.message=!0===a.disconnect?"INVALID_TOKEN_ERROR":"INVALID_TOKEN_NO_DISCONNECT_ERROR"}n(f.message)&&e.modalWindow("alert",p,f)}"function"==typeof a.success&&("undefined"!=typeof a.scope?a.scope.$applyAsync(a.success(c)):a.success(c))}else!0===
b.aborded?"function"==typeof a.aborded&&("undefined"!=typeof a.scope?a.scope.$applyAsync(a.aborded(c)):a.aborded(c)):(console.error(a.url,this),"function"==typeof a.error&&("undefined"!=typeof a.scope?a.scope.$applyAsync(a.error(c)):a.error(c)));setTimeout(function(){var a=parseInt(sessionStorage.loading_counter);0<a?a--:a=0;sessionStorage.loading_counter=a;0===a&&dd()})}};a.url=-1===a.url.indexOf("?")?a.url+("?vitis_version="+sessionStorage.build):a.url+("&vitis_version="+sessionStorage.build);if("undefined"!=
typeof a.params){a.params=fd(a.params,a.url);for(var e in a.params)ha(a.params[e])&&(a.params[e]=JSON.stringify(a.params[e])),a.url+="&"+e+"="+encodeURIComponent(a.params[e])}-1==navigator.userAgent.indexOf("Trident")&&(b.responseType=a.responseType);b.open(a.method,a.url,a.async);-1!=navigator.userAgent.indexOf("Trident")&&(b.responseType=a.responseType);for(var f in c)b.setRequestHeader(f,c[f]);d=null;"undefined"!=typeof a.data&&ha(a.data)&&(d=a.data instanceof FormData?a.data:JSON.stringify(fd(a.data,
a.url)));b.send(d);"true"==sessionStorage.ajaxLoader&&cd();d=parseInt(sessionStorage.loading_counter);d++;sessionStorage.loading_counter=d;ea(a.timeout)&&setTimeout(function(){if(4!==b.readyState&&!0!==b.aborded){var c=a.timeout/1E3,d,e,f=function(){e=bootbox.confirm({message:"Requ\u00eate sans r\u00e9ponse",buttons:{confirm:{label:"Annuler",className:"btn-success"},cancel:{label:"Attendre",className:"btn-default"}},mb:function(c){c?(b.abort(),console.info("request aborded"),clearInterval(d)):setTimeout(function(){4!==
b.readyState&&f()},a.timeout)}})};f();e.lh(function(){function a(){var a="<h4>Requ\u00eate sans r\u00e9ponse depuis "+c+"s...</h4>";e.find(".bootbox-body").html(a)}d=window.setInterval(function(){4===b.readyState&&(e.modal("hide"),clearInterval(d));100<c&&(b.abort(),console.info("request aborded"),clearInterval(d));a();c++},1E3);a()})}},a.timeout);ha(a.abord)&&fa(a.abord.then)&&a.abord.then(function(){b.aborded=!0;b.abort()},function(){b.aborded=!0;b.abort()})}}pa("ajaxRequest",z);
function ed(a,b){for(var c in b)a[c]=b[c]}function fd(a,b){for(var c in a)if(n(a[c])||hb(a,c),"token"===c||a[c]===sessionStorage.session_token)console.error("Token in params:",a,b),alert("Attention: token pass\u00e9 en param\u00e8tre"),hb(a,c);return a};var A={};pa("oVmap",A);A.module=angular.module("vmap",["formReader"]);A.config=function(a){a.defaults.headers.get={Accept:"application/x-vm-json"};a.defaults.headers.post={Accept:"application/x-vm-json"}};A.config.$inject=["$httpProvider"];A.module.config(A.config);A.BH=function(){return function(a,b,c){var d=[];angular.forEach(a,function(a){d.push(a)});d.sort(function(a,c){return a[b]>c[b]?1:-1});c&&d.reverse();return d}};A.module.filter("orderObjectBy",A.BH);A.K=function(){return function(a){return typeof a}};
A.module.filter("getType",A.K);A.$o=function(){return function(a){return null!=a}};A.module.filter("isDef",A.$o);A.properties={};A.Ty={};A.qa={};A.F={};A.log=function(a,b){null!=A.properties&&A.properties.debug_mode&&(n(b)?console.log(a,b):console.log(a))};A.log=A.log;
A.lh=function(){A.log("oVmap.init");u.gl("vmapLoaded");if(null!=angular.element($("#app-vmap-loader")).scope())angular.element($("#app-vmap-loader")).scope().compileVmapTemplates();else u.on("vmapLoaderOk",function(){angular.element($("#app-vmap-loader")).scope().compileVmapTemplates()});var a=window.location.href;a.slice(0,a.lastIndexOf("/"));null!=sessionStorage.application||(sessionStorage.application=document.location.pathname.replace(/\//g,""));A.properties=window.oClientProperties;A.properties.api_url=
A.properties.web_server_name+"/"+A.properties.services_alias;A.properties.token=n(sessionStorage.session_token)?sessionStorage.session_token:A.ax("token",window.location.href);null!=A.properties.token&&(z({method:"GET",url:A.properties.api_url+"/vitis/properties",async:!1,responseType:"",success:function(a){a=JSON.parse(a.data);kb(A.properties,a);A.log("properties: ",A.properties)}}),z({method:"GET",url:A.properties.api_url+"/vmap/crss",success:function(a){a=a.data.crss;A.oProjections={};for(var b=
0;b<a.length;b++)A.oProjections[a[b].crs_id]=a[b].name}}));A.Ty=new C;A.qa=new gd;A.F=new hd;A.Kz();$(window).resize(A.Kz);$('[data-toggle="tooltip"]').tooltip({animation:!1});A.hM=0;null!=u.oWebsocket&&u.oWebsocket.AA("VmapEvents")};A.init=A.lh;function id(){A.log("oVmap.vmapDirective");u.gl("vmapDirectiveLoaded");return{restrict:"A",controller:"AppVmapController",controllerAs:"vmapCtrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/vmap.html"}}A.vmapDirective=id;
function jd(){A.log("oVmap.vmapController");this.lang=this.lang="fr";this.bottom_open=this.right_open=this.left_open=!1;this.map=this.map=A.g().H;this.Gr=this.currentAction="";this.cI=this.proj=D(this.map).D().V;this.bM=this.infos=[];A.scope=angular.element("#app-vmap").scope();A.ctrl=A.scope.vmapCtrl;A.scope.sizeOf=function(a){return Object.keys(a).length};A.scope.isDef=function(a){return null!=a};A.scope.$on("mapChanged",function(){A.scope.$applyAsync(function(){A.scope.ctrl.bottom_open=!1;A.Jy()});
A.pA("tool-btn-active")})}A.vmapController=jd;A.g=function(){return this.Ty};A.getMap=A.g;A.EE=function(){return this.qa};A.getMapManager=A.EE;A.YE=function(){return this.F};A.getToolsManager=A.YE;A.ax=function(a,b){if(-1!==b.indexOf("?")&&(b=b.slice(b.indexOf("?")+1),-1!==b.indexOf(a+"=")))return b=b.slice(b.indexOf(a+"=")),-1!==b.indexOf("&")&&(a=b.indexOf("&"),b=b.slice(0,a)),a=b.indexOf("="),b=b.slice(a+1)};A.findInURL=A.ax;
A.Zx=function(){$("#current-projection").html(A.oProjections[D(A.g().H).D().V]);for(var a=A.qa.Nb,b=0;b<a.maps.length;b++)if(!0===a.maps[b].used)var c=a.maps[b].name;$("#map-name").html(c)};A.gM=function(a,b,c){if(c>=a.length)for(var d=c-a.length;d--+1;)a.push(void 0);a.splice(c,0,a.splice(b,1)[0]);return a};
A.bv=function(a){a="object"!==typeof a?JSON.parse(a):a;var b="",c="";if($("#quote").is(":checked"))for(var d in a[0])var e=d+"",c=c+('"'+e.replace(/"/g,'""')+'",');else for(d in a[0])c+=d+",";for(var c=c.slice(0,-1),b=b+(c+"\r\n"),f=0;f<a.length;f++){c="";for(d in a[f])e=a[f][d]+"",c+='"'+e.replace(/"/g,'""')+'",';c=c.slice(0,-1);b+=c+"\r\n"}return b};
A.jj=function(a){A.log("simuleClick : "+a);if(null!=document.getElementById(a)){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);document.getElementById(a).dispatchEvent(b);b=document.createEvent("MouseEvents");b.initMouseEvent("mouseout",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);document.getElementById(a).dispatchEvent(b)}else console.error("target undefined: ",a)};A.simuleClick=A.jj;
A.pA=function(a){A.log("simuleClickOnClass : "+a);var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);for(var c=document.getElementsByClassName(a),d=0;d<c.length;d++)c[d].dispatchEvent(b);b=document.createEvent("MouseEvents");b.initMouseEvent("mouseout",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);c=document.getElementsByClassName(a);for(d=0;d<c.length;d++)c[d].dispatchEvent(b)};A.simuleClickOnClass=A.pA;
A.zD=function(a,b){$("#"+b).show();var c=document.getElementById(b),d=c.getElementsByTagName("*").length,e=fc("div",{id:b+"_"+d,"class":"alert alert-warning",role:"alert"},null);c.appendChild(e);c=fc("button",{"class":"close"},"x");c.onclick=function(){$("#"+b+"_"+d).hide()};e.appendChild(c);a=fc("strong",null,a);e.appendChild(a)};A.displaySucces=A.zD;
A.qD=function(a,b){$("#"+b).show();var c=document.getElementById(b),d=c.getElementsByTagName("*").length,e=fc("div",{id:b+"_"+d,"class":"alert alert-warning",role:"alert"},null);c.appendChild(e);c=fc("button",{"class":"close"},"x");c.onclick=function(){$("#"+b+"_"+d).hide()};e.appendChild(c);a=fc("strong",null,a);e.appendChild(a)};A.displayInfo=A.qD;
A.BD=function(a,b){$("#"+b).show();var c=document.getElementById(b),d=c.getElementsByTagName("*").length,e=fc("div",{id:b+"_"+d,"class":"alert alert-warning",role:"alert"},null);c.appendChild(e);c=fc("button",{"class":"close"},"x");c.onclick=function(){$("#"+b+"_"+d).hide()};e.appendChild(c);a=fc("strong",null,a);e.appendChild(a)};A.displayWarning=A.BD;
A.mD=function(a,b){a="Erreur: "+a;$("#"+b).show();var c=document.getElementById(b),d=c.getElementsByTagName("*").length,e=fc("div",{id:b+"_"+d,"class":"alert alert-warning",role:"alert"},null);c.appendChild(e);c=fc("button",{"class":"close"},"x");c.onclick=function(){$("#"+b+"_"+d).hide()};e.appendChild(c);a=fc("strong",null,a);e.appendChild(a)};A.displayError=A.mD;
A.Iw=function(a,b){var c=0,d=0;n(a.target)&&$(a.target).animate({opacity:0},300,"linear").animate({opacity:1},300,"linear").animate({opacity:0},300,"linear").animate({opacity:1},300,"linear").animate({opacity:0},300,"linear").animate({opacity:1},300,"linear");if(n(a.target)){var e=$(a.target).offset();a.coordinates=[e.left,e.top]}if(!n(a.coordinates))return 0;a.type=n(a.type)?a.type:"top-right";var f=fc("div",{"class":"tooltip-error tooltip-error-"+a.type,role:"alert"},null);b=fc("strong",null,b);
document.body.appendChild(f);f.appendChild(b);"top-left"===a.type?(c=n(a.target)?0-f.offsetWidth+33:0-f.offsetWidth+13,d=0-f.offsetHeight-12):"top-right"===a.type?(c=$(a.target).width()-35,d=0-f.offsetHeight-12):"bottom-left"===a.type?(c=0-f.offsetWidth+33,d=$(a.target).height()+12):"bottom-right"===a.type&&(c=$(a.target).width()-35,d=$(a.target).height()+12);f.style.left=a.coordinates[0]+c+"px";f.style.top=a.coordinates[1]+d+"px";Xb(document.body,"click",function(a){A.log("remove error tooltip");
a.target!==f&&document.body.removeChild(f)});return f};A.displayTooltipError=A.Iw;
A.xk=function(a){function b(a){return"out"===$("#"+a).attr("collapse")?!0:!1}A.log("oVmap.resizeLayerTools: "+a);n(angular.element($("#olMap")).scope())&&angular.element($("#olMap")).scope().ctrl.Sm();for(var c=["layertree","layersorder","maplegendcontainer"],d=0,e=c.length,f=0,f=$("#maplistlitle-container").height(),g=0;g<c.length;g++)f+=$("#"+c[g]+"-button").height(),!0===b(c[g])&&d++;for(var h=[],k=[],f=($("#left-sidebar").height()-f)/(e-d)-0,g=0;g<c.length;g++)h[g]=$("#"+c[g]).css("max-height"),
$("#"+c[g]).css({"max-height":""}),k[g]=$("#"+c[g]).height(),$("#"+c[g]).css({"max-height":h[g]}),!1===b(c[g])?h[g]=f:h[g]=0;(function(c,d,e){for(var f=[],g=[],h=[],k=0,p=0;p<c.length;p++)e[p]>=d[p]&&!1===b(c[p])?(f.push(c[p]),g.push(e[p]),h.push(d[p])):(d[p]>e[p]&&(k+=d[p]-e[p]),!0===a?$("#"+c[p]).animate({"max-height":d[p]}):$("#"+c[p]).css({"max-height":d[p]}));for(p=0;p<f.length;p++)c=k/f.length,!0===a?$("#"+f[p]).animate({"max-height":h[p]+c}):$("#"+f[p]).css({"max-height":h[p]+c})})(c,h,k)};
A.resizeLayerTools=A.xk;
A.aI=function(a){A.log("print: "+a);var b=this;a=$(a).html();this.Sf=window.open("","Impression","height=400,width=600");this.Sf.document.write("<html><head><title>Impression</title>");this.Sf.document.write($("HEAD").html());this.Sf.document.write("<style>.print-hidden{visibility: hidden !important;}</style>");this.Sf.document.write("</head><body>");this.Sf.document.write(a);this.Sf.document.write("</body></html>");setTimeout(function(){b.Sf.document.close();b.Sf.focus();b.Sf.print();b.Sf.close()},
500)};A.printElem=A.aI;A.QG=function(){angular.element($("#olMap")).scope().ctrl.Sm();$(".open-more-selection-info").toggleClass("reverse");$("#map-container").hasClass("open2")?($("#map-container").removeClass("open2"),$("#bottombar").removeClass("open2")):($("#map-container").addClass("open2"),$("#bottombar").addClass("open2"))};A.maxResizeBottomBar=A.QG;
A.Jy=function(){angular.element($("#olMap")).scope().ctrl.Sm();$("#map-container").hasClass("open2")?($("#map-container").removeClass("open2"),$("#bottombar").removeClass("open2"),$(".open-more-selection-info").removeClass("reverse")):$("#map-container").hasClass("open")&&$("#map-container").addClass("minus")};A.minResizeBottomBar=A.Jy;A.Kz=function(){A.xk(!1)};
A.hE=function(a,b){A.log("getEWKTFromWKT");return r(a)?r(b)?"SRID="+b.substr(5)+";"+a:(console.error("EPSGProj is not a string"),null):(console.error("WKTGeom is not a string"),null)};A.pg=function(a){var b;A.log("getEWKTFromWKT");if(null==a)return console.error("geom is not defined"),null;b=null!=b?b:D(A.g().H).D().V;if(!r(b))return console.error("proj is not a string"),null;a=(new kd).Tu(a,{Wd:b,Kc:b});return"SRID="+b.substr(5)+";"+a};
A.eG=function(a){A.log("isEWKTGeom");if("SRID="!==a.substr(0,5).toUpperCase())return!1;var b=new kd,c=a.substr(a.indexOf(";")+1);try{b.wm(c)}catch(d){return console.error("readGeometry failed: ",a),!1}return!0};
A.yi=function(a,b){A.log("getGeomFromEWKT");if(!r(a))return console.error("EWKTGeom is not a string: ",a),null;b=null!=b?b:D(A.g().H).D().V;if(this.eG(a)){var c=new kd,d=a.substr(a.indexOf(";")+1);a="EPSG:"+a.slice(5,a.indexOf(";"));return c.wm(d,{Wd:a,Kc:b})}console.error("Geom is not an EWKT Geometry: ",a);return null};
A.yx=function(){var a=[];$('link[rel="stylesheet"]').each(function(){z({method:"GET",url:$(this).attr("href"),async:!1,responseType:"",success:function(b){b=b.data;var c=document.createElement("style");c.type="text/css";c.styleSheet?c.styleSheet.cssText=b:c.appendChild(document.createTextNode(b));a.push(c)}})});$("style").each(function(){var b=this.innerHTML,c=document.createElement("style");c.type="text/css";c.styleSheet?c.styleSheet.cssText=b:c.appendChild(document.createTextNode(b));a.push(c)});
return a};A.getStyles=A.yx;
A.so=function(a){A.log("oVmap.generatePrintReport");if(null==a.printReportId)return console.error("generatePrintReport: opt_options.printReportId undefined"),0;if(null==a.ids)return console.error("generatePrintReport: opt_options.ids undefined"),0;var b=a.printReportId;a=a.ids;for(var c="",d=0;d<a.length;d++)0<d&&(c+="|"),c+=a[d];var e=window.open("","_blank","height=400,width=600");if(null==e)return $.notify("Fen\u00eatre d'impression bloqu\u00e9e par le navigateur","error"),0;e.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>');
z({method:"POST",url:A.properties.api_url+"/vmap/printreportservices",headers:{Accept:"application/x-vm-json"},data:{printreport_id:b,ids:c},timeout:12E4,success:function(a){var b=!1;null!=a.data?null!=a.data.printreportservices?null!=a.data.printreportservices.fileurl?1!==a.data.status&&(b=!0):b=!0:b=!0:b=!0;if(b)return $.notify("Une erreur est survenue lors de l'impression","error"),e.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">Une erreur est survenue lors de l\'impression</div>'),
console.error("response: ",a),0;$.notify("Impression r\u00e9ussie","success");for(var b=A.yx(),c=0;c<b.length;c++)try{e.document.head.appendChild(b[c])}catch(k){}e.document.body.style.textAlign="center";e.document.body.innerHTML='<a href="'+a.data.printreportservices.fileurl+'" style="margin-top: calc(50vh - 46px);" class="btn btn-lg btn-primary btn-bs btn-outline" download>T\u00e9l\u00e9charger le rapport</a>'},error:function(){$.notify("Une erreur est survenue lors de l'impression","error");e.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">Une erreur est survenue lors de l\'impression</div>')}})};
A.generatePrintReport=A.so;A.Ss=function(a,b){if(!r(a))return!1;b=null!=b?b:"link";return-1!==a.indexOf("["+b)&&-1!==a.indexOf("[/"+b+"]")?!0:!1};A.isLink=A.Ss;A.Bt=function(a,b){b=null!=b?b:"link";var c=a.substr(a.indexOf("["+b),a.indexOf("[/"+b+"]")-a.indexOf("["+b)+10),d=A.kE(c);b=A.wE(c,d,"[/"+b+"]");c=A.xE(d);d=null!=c.href?c.href:null;c=null!=c.target?c.target:"_blank";b=0<b.length?b:d;if(null!=d)return'<a href="'+d+'" target="'+c+'">'+b+"</a>";console.error("cannot parse href");return a};
A.parseLink=A.Bt;A.kE=function(a){for(var b=null,c=null,d,e="",f=0;f<a.length;f++)if(e+=a[f],'"'===a[f]&&null===b&&"\\"!==a[f-1])b=f;else if('"'===a[f]&&null===c&&null!==b&&"\\"!==a[f-1])c=f;else if(null!==b&&null===c?d=!0:(d=!1,null!==b&&null!==c&&(c=b=null)),!d&&"]"===a[f])break;return e};A.wE=function(a,b,c){a=a.substr(a.indexOf(b)+b.length);return a.substr(0,a.indexOf(c))};
A.xE=function(a){for(var b=null,c=null,d=null,e=null,f=null,g=null,h,k={},m=0;m<a.length;m++)'"'===a[m]&&null===b&&"\\"!==a[m-1]?b=m:'"'===a[m]&&null===c&&null!==b&&"\\"!==a[m-1]?c=m:(null!==b&&null===c?h=!0:(h=!1,null!==b&&null!==c&&(f=a.substr(b+1,c-b-1),c=b=null)),h||(" "===a[m]&&null===d&&(d=m),"="===a[m]&&null===e&&(e=m),null!==d&&null!==e&&(g=a.substr(d+1,e-d-1),e=d=null)),null!==f&&null!==g&&(k[g]=f,g=f=null));return k};
A.ao=function(a,b){if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(a,b);else{var c=document.createElement("a");a=window.URL.createObjectURL(a);document.body.appendChild(c);c.style="display: none";c.href=a;c.download=b;c.click();window.URL.revokeObjectURL(a)}};A.downloadBlob=A.ao;
A.bw=function(a,b){return{link:function(c,d){b.log("formReader.appSubformDrtv.link");var e;c.compileVmapTemplates=function(){b.log("compileVmapTemplates");c.$applyAsync(function(){e=a('<div app-vmap id="app-vmap"></div>')(c);d.html("");d.append(e)})};u.gl("vmapLoaderOk")}}};A.bw.$inject=["$compile","$log"];A.module.directive("appVmapLoader",A.bw);A.module.directive("appVmap",id);A.module.controller("AppVmapController",jd);var ol={},ld;function E(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a}function md(){}function I(a){return a.$y||(a.$y=++nd)}var nd=0;function od(a){this.message="Assertion failed. See https://openlayers.org/en/latest/doc/errors/#"+a+" for details.";this.code=a;this.name="AssertionError"}E(od,Error);var pd="function"===typeof Object.assign?Object.assign:function(a,b){if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var c=Object(a),d=1,e=arguments.length;d<e;++d){var f=arguments[d];if(void 0!==f&&null!==f)for(var g in f)f.hasOwnProperty(g)&&(c[g]=f[g])}return c};function qd(a){for(var b in a)delete a[b]}function rd(a){var b=[],c;for(c in a)b.push(a[c]);return b}function sd(a){for(var b in a)return!1;return!b};function td(a){function b(b){var c=a.listener,e=a.kw||a.target;a.Aj&&ud(a);return c.call(e,b)}return a.nw=b}function vd(a,b,c,d){for(var e,f=0,g=a.length;f<g;++f)if(e=a[f],e.listener===b&&e.kw===c)return d&&(e.deleteIndex=f),e}function wd(a,b){return(a=a.Fp)?a[b]:void 0}function xd(a){var b=a.Fp;b||(b=a.Fp={});return b}
function yd(a,b){var c=wd(a,b);if(c){for(var d=0,e=c.length;d<e;++d)a.removeEventListener(b,c[d].nw),qd(c[d]);c.length=0;if(c=a.Fp)delete c[b],0===Object.keys(c).length&&delete a.Fp}}function J(a,b,c,d,e){var f=xd(a),g=f[b];g||(g=f[b]=[]);(f=vd(g,c,d,!1))?e||(f.Aj=!1):(f={kw:d,Aj:!!e,listener:c,target:a,type:b},a.addEventListener(b,td(f)),g.push(f));return f}function zd(a,b,c,d){return J(a,b,c,d,!0)}function Ad(a,b,c,d){(a=wd(a,b))&&(c=vd(a,c,d,!0))&&ud(c)}
function ud(a){if(a&&a.target){a.target.removeEventListener(a.type,a.nw);var b=wd(a.target,a.type);if(b){var c="deleteIndex"in a?a.deleteIndex:b.indexOf(a);-1!==c&&b.splice(c,1);0===b.length&&yd(a.target,a.type)}qd(a)}}function Bd(a){var b=xd(a),c;for(c in b)yd(a,c)};function Cd(){}Cd.prototype.mi=!1;Cd.prototype.Yd=function(){this.mi||(this.mi=!0,this.ab())};Cd.prototype.ab=md;function Dd(a){this.type=a;this.target=null}Dd.prototype.preventDefault=Dd.prototype.stopPropagation=function(){this.eI=!0};function Ed(a){a.stopPropagation()};function Fd(){this.sm={};this.Fj={};this.Ri={}}E(Fd,Cd);l=Fd.prototype;l.addEventListener=function(a,b){var c=this.Ri[a];c||(c=this.Ri[a]=[]);-1===c.indexOf(b)&&c.push(b)};
l.dispatchEvent=function(a){var b="string"===typeof a?new Dd(a):a;a=b.type;b.target=this;var c=this.Ri[a],d;if(c){a in this.Fj||(this.Fj[a]=0,this.sm[a]=0);++this.Fj[a];for(var e=0,f=c.length;e<f;++e)if(!1===c[e].call(this,b)||b.eI){d=!1;break}--this.Fj[a];if(0===this.Fj[a]){b=this.sm[a];for(delete this.sm[a];b--;)this.removeEventListener(a,md);delete this.Fj[a]}return d}};l.ab=function(){Bd(this)};l.hasListener=function(a){return a?a in this.Ri:0<Object.keys(this.Ri).length};
l.removeEventListener=function(a,b){var c=this.Ri[a];c&&(b=c.indexOf(b),a in this.sm?(c[b]=md,++this.sm[a]):(c.splice(b,1),0===c.length&&delete this.Ri[a]))};function Gd(){Fd.call(this);this.Sa=0}E(Gd,Fd);function Hd(a){if(Array.isArray(a))for(var b=0,c=a.length;b<c;++b)ud(a[b]);else ud(a)}Gd.prototype.G=function(){++this.Sa;this.dispatchEvent("change")};Gd.prototype.on=function(a,b,c){if(Array.isArray(a)){for(var d=a.length,e=Array(d),f=0;f<d;++f)e[f]=J(this,a[f],b,c);return e}return J(this,a,b,c)};
function Id(a){var b=A.g().H;if(Array.isArray("postcompose"))for(var c=Array(11),d=0;11>d;++d)c[d]=zd(b,"postcompose"[d],a,void 0);else zd(b,"postcompose",a,void 0)};function Jd(a){Gd.call(this);I(this);this.Qh={};void 0!==a&&Kd(this,a)}E(Jd,Gd);var Ld={};function Md(a){return Ld.hasOwnProperty(a)?Ld[a]:Ld[a]="change:"+a}Jd.prototype.get=function(a){var b;this.Qh.hasOwnProperty(a)&&(b=this.Qh[a]);return b};Jd.prototype.Co=function(){return Object.keys(this.Qh)};function Nd(a){return pd({},a.Qh)}Jd.prototype.notify=function(a,b){var c;c=Md(a);this.dispatchEvent(new Od(c,a,b));this.dispatchEvent(new Od("propertychange",a,b))};
Jd.prototype.set=function(a,b,c){c?this.Qh[a]=b:(c=this.Qh[a],this.Qh[a]=b,c!==b&&this.notify(a,c))};function Kd(a,b){for(var c in b)a.set(c,b[c],void 0)}function Od(a,b,c){Dd.call(this,a);this.key=b;this.oldValue=c}E(Od,Dd);function Pd(a,b){Jd.call(this);this.Iu=!!(b||{}).unique;this.qe=a?a:[];if(this.Iu)for(a=0,b=this.qe.length;a<b;++a)Qd(this,this.qe[a],a);Rd(this)}E(Pd,Jd);l=Pd.prototype;l.clear=function(){for(;0<this.Xb();)this.pop()};l.extend=function(a){var b,c;b=0;for(c=a.length;b<c;++b)this.push(a[b]);return this};l.forEach=function(a,b){this.qe.forEach(a,b)};l.R=function(){return this.qe};l.item=function(a){return this.qe[a]};l.Xb=function(){return this.get(Sd)};l.pop=function(){return Td(this,this.Xb()-1)};
l.push=function(a){this.Iu&&Qd(this,a);var b=this.Xb();this.Iu&&Qd(this,a);this.qe.splice(b,0,a);Rd(this);this.dispatchEvent(new Ud("add",a));return this.Xb()};l.remove=function(a){var b=this.qe,c,d;c=0;for(d=b.length;c<d;++c)if(b[c]===a)return Td(this,c)};function Td(a,b){var c=a.qe[b];a.qe.splice(b,1);Rd(a);a.dispatchEvent(new Ud("remove",c));return c}function Rd(a){a.set(Sd,a.qe.length)}function Qd(a,b,c){for(var d=0,e=a.qe.length;d<e;++d)if(a.qe[d]===b&&d!==c)throw new od(58);}var Sd="length";
function Ud(a,b){Dd.call(this,a);this.element=b}E(Ud,Dd);function Vd(a,b,c){Dd.call(this,a);this.map=b;this.af=void 0!==c?c:null}E(Vd,Dd);function Wd(a,b,c,d,e){Vd.call(this,a,b,e);this.originalEvent=c;this.Yc=Xd(b,c);this.Qb=b.Gd(this.Yc)}E(Wd,Vd);Wd.prototype.preventDefault=function(){Vd.prototype.preventDefault.call(this);this.originalEvent.preventDefault()};Wd.prototype.stopPropagation=function(){Vd.prototype.stopPropagation.call(this);this.originalEvent.stopPropagation()};var Yd={CL:"singleclick",qL:"click",rL:"dblclick",vL:"pointerdrag",yL:"pointermove",uL:"pointerdown",BL:"pointerup",AL:"pointerover",zL:"pointerout",wL:"pointerenter",xL:"pointerleave",tL:"pointercancel"};function Zd(a,b,c,d,e){Wd.call(this,a,b,c.originalEvent,0,e);this.Kp=c}E(Zd,Wd);var $d=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function ae(a,b){var c,d,e=$d.length;for(d=0;d<e;++d)try{if(c=a.getContext($d[d],b))return c}catch(f){}return null};var ce,de="undefined"!==typeof navigator?navigator.userAgent.toLowerCase():"",ee=-1!==de.indexOf("firefox"),fe=-1!==de.indexOf("safari")&&-1==de.indexOf("chrom"),ge=-1!==de.indexOf("webkit")&&-1==de.indexOf("edge"),he=-1!==de.indexOf("macintosh"),ie=window.devicePixelRatio||1,je=!1,ke=function(){if(!("HTMLCanvasElement"in window))return!1;try{var a=document.createElement("CANVAS").getContext("2d");return a?(void 0!==a.setLineDash&&(je=!0),!0):!1}catch(b){return!1}}(),le="geolocation"in navigator,
me="ontouchstart"in window,ne="PointerEvent"in window,oe=!!navigator.msPointerEnabled,pe=!1,qe=[];if("WebGLRenderingContext"in window)try{var re=ae(document.createElement("CANVAS"),{failIfMajorPerformanceCaveat:!0});re&&(pe=!0,qe=re.getSupportedExtensions())}catch(a){}ce=pe;ld=qe;function se(a,b){this.eb=a;this.tp=b};function te(a){se.call(this,a,{mousedown:this.mousedown,mousemove:this.mousemove,mouseup:this.mouseup,mouseover:this.mouseover,mouseout:this.mouseout});this.ec=a.ec;this.Yx=[]}E(te,se);function ue(a,b){a=a.Yx;var c=b.clientX;b=b.clientY;for(var d=0,e=a.length,f;d<e&&(f=a[d]);d++){var g=Math.abs(b-f[1]);if(25>=Math.abs(c-f[0])&&25>=g)return!0}return!1}
function ve(a){var b=we(a,a),c=b.preventDefault;b.preventDefault=function(){a.preventDefault();c()};b.pointerId=1;b.isPrimary=!0;b.pointerType="mouse";return b}l=te.prototype;l.mousedown=function(a){if(!ue(this,a)){(1).toString()in this.ec&&this.cancel(a);var b=ve(a);this.ec[(1).toString()]=a;this.eb.Gj(b,a)}};l.mousemove=function(a){if(!ue(this,a)){var b=ve(a);this.eb.move(b,a)}};
l.mouseup=function(a){if(!ue(this,a)){var b=this.ec[(1).toString()];b&&b.button===a.button&&(b=ve(a),this.eb.Tk(b,a),delete this.ec[(1).toString()])}};l.mouseover=function(a){if(!ue(this,a)){var b=ve(a);xe(this.eb,b,a)}};l.mouseout=function(a){if(!ue(this,a)){var b=ve(a);ye(this.eb,b,a)}};l.cancel=function(a){var b=ve(a);this.eb.cancel(b,a);delete this.ec[(1).toString()]};function ze(a){se.call(this,a,{MSPointerDown:this.eH,MSPointerMove:this.fH,MSPointerUp:this.iH,MSPointerOut:this.gH,MSPointerOver:this.hH,MSPointerCancel:this.dH,MSGotPointerCapture:this.bH,MSLostPointerCapture:this.cH});this.ec=a.ec;this.JB=["","unavailable","touch","pen","mouse"]}E(ze,se);function Ae(a,b){var c=b;"number"===typeof b.pointerType&&(c=we(b,b),c.pointerType=a.JB[b.pointerType]);return c}l=ze.prototype;
l.eH=function(a){this.ec[a.pointerId.toString()]=a;var b=Ae(this,a);this.eb.Gj(b,a)};l.fH=function(a){var b=Ae(this,a);this.eb.move(b,a)};l.iH=function(a){var b=Ae(this,a);this.eb.Tk(b,a);delete this.ec[a.pointerId.toString()]};l.gH=function(a){var b=Ae(this,a);ye(this.eb,b,a)};l.hH=function(a){var b=Ae(this,a);xe(this.eb,b,a)};l.dH=function(a){var b=Ae(this,a);this.eb.cancel(b,a);delete this.ec[a.pointerId.toString()]};l.cH=function(a){this.eb.dispatchEvent(new Be("lostpointercapture",a,a))};
l.bH=function(a){this.eb.dispatchEvent(new Be("gotpointercapture",a,a))};function Ce(a){se.call(this,a,{pointerdown:this.RH,pointermove:this.SH,pointerup:this.VH,pointerout:this.TH,pointerover:this.UH,pointercancel:this.QH,gotpointercapture:this.eF,lostpointercapture:this.EG})}E(Ce,se);l=Ce.prototype;l.RH=function(a){De(this.eb,a)};l.SH=function(a){De(this.eb,a)};l.VH=function(a){De(this.eb,a)};l.TH=function(a){De(this.eb,a)};l.UH=function(a){De(this.eb,a)};l.QH=function(a){De(this.eb,a)};l.EG=function(a){De(this.eb,a)};l.eF=function(a){De(this.eb,a)};function Be(a,b,c){Dd.call(this,a);this.originalEvent=b;a=c?c:{};this.buttons=Ee(a);this.pressure=a.pressure?a.pressure:this.buttons?.5:0;this.bubbles="bubbles"in a?a.bubbles:!1;this.cancelable="cancelable"in a?a.cancelable:!1;this.view="view"in a?a.view:null;this.detail="detail"in a?a.detail:null;this.screenX="screenX"in a?a.screenX:0;this.screenY="screenY"in a?a.screenY:0;this.clientX="clientX"in a?a.clientX:0;this.clientY="clientY"in a?a.clientY:0;this.ctrlKey="ctrlKey"in a?a.ctrlKey:!1;this.altKey=
"altKey"in a?a.altKey:!1;this.shiftKey="shiftKey"in a?a.shiftKey:!1;this.metaKey="metaKey"in a?a.metaKey:!1;this.button="button"in a?a.button:0;this.relatedTarget="relatedTarget"in a?a.relatedTarget:null;this.pointerId="pointerId"in a?a.pointerId:0;this.width="width"in a?a.width:0;this.height="height"in a?a.height:0;this.tiltX="tiltX"in a?a.tiltX:0;this.tiltY="tiltY"in a?a.tiltY:0;this.pointerType="pointerType"in a?a.pointerType:"";this.hwTimestamp="hwTimestamp"in a?a.hwTimestamp:0;this.isPrimary=
"isPrimary"in a?a.isPrimary:!1;b.preventDefault&&(this.preventDefault=function(){b.preventDefault()})}E(Be,Dd);function Ee(a){if(a.buttons||Fe)a=a.buttons;else switch(a.which){case 1:a=1;break;case 2:a=4;break;case 3:a=2;break;default:a=0}return a}var Fe=!1;try{Fe=1===(new MouseEvent("click",{buttons:1})).buttons}catch(a){};function Ge(a,b){return a>b?1:a<b?-1:0}function He(a,b,c){var d=a.length;if(a[0]<=b)return 0;if(!(b<=a[d-1]))if(0<c)for(c=1;c<d;++c){if(a[c]<b)return c-1}else if(0>c)for(c=1;c<d;++c){if(a[c]<=b)return c}else for(c=1;c<d;++c){if(a[c]==b)return c;if(a[c]<b)return a[c-1]-b<b-a[c]?c-1:c}return d-1}function Ie(a,b){var c=Array.isArray(b)?b:[b],d=c.length;for(b=0;b<d;b++)a[a.length]=c[b]}function Je(a,b){for(var c=a.length>>>0,d,e=0;e<c;e++)if(d=a[e],b(d,e,a))return d;return null}
function Ke(a,b){var c=a.length;if(c!==b.length)return!1;for(var d=0;d<c;d++)if(a[d]!==b[d])return!1;return!0}function Le(a){var b=Me,c=a.length,d=Array(a.length),e;for(e=0;e<c;e++)d[e]={index:e,value:a[e]};d.sort(function(a,c){return b(a.value,c.value)||a.index-c.index});for(e=0;e<a.length;e++)a[e]=d[e].value}function Ne(a,b){var c;return a.every(function(d,e){c=e;return!b(d,e,a)})?-1:c}
function Oe(a,b){var c=b||Ge;return a.every(function(b,e){if(0===e)return!0;b=c(a[e-1],b);return!(0<b||0===b)})};function Pe(a,b){se.call(this,a,{touchstart:this.rK,touchmove:this.qK,touchend:this.pK,touchcancel:this.oK});this.ec=a.ec;this.YG=b;this.Hl=void 0;this.yr=0;this.Hm=void 0}E(Pe,se);l=Pe.prototype;l.Iz=function(){this.yr=0;this.Hm=void 0};
function Qe(a,b,c){b=we(b,c);b.pointerId=c.identifier+2;b.bubbles=!0;b.cancelable=!0;b.detail=a.yr;b.button=0;b.buttons=1;b.width=c.webkitRadiusX||c.radiusX||0;b.height=c.webkitRadiusY||c.radiusY||0;b.pressure=c.webkitForce||c.force||.5;b.isPrimary=a.Hl===c.identifier;b.pointerType="touch";b.clientX=c.clientX;b.clientY=c.clientY;b.screenX=c.screenX;b.screenY=c.screenY;return b}
function Re(a,b,c){function d(){b.preventDefault()}var e=Array.prototype.slice.call(b.changedTouches),f=e.length,g,h;for(g=0;g<f;++g)h=Qe(a,b,e[g]),h.preventDefault=d,c.call(a,b,h)}
l.rK=function(a){var b=a.touches,c=Object.keys(this.ec),d=c.length;if(d>=b.length){var e=[],f,g,h;for(f=0;f<d;++f){g=c[f];h=this.ec[g];var k;if(!(k=1==g))a:{k=b.length;for(var m,p=0;p<k;p++)if(m=b[p],m.identifier===g-2){k=!0;break a}k=!1}k||e.push(h.Eg)}for(f=0;f<e.length;++f)this.xr(a,e[f])}b=a.changedTouches[0];c=Object.keys(this.ec).length;if(0===c||1===c&&(1).toString()in this.ec)this.Hl=b.identifier,void 0!==this.Hm&&clearTimeout(this.Hm);Se(this,a);this.yr++;Re(this,a,this.DH)};
l.DH=function(a,b){this.ec[b.pointerId]={target:b.target,Eg:b,cz:b.target};var c=this.eb;b.bubbles=!0;c.fireEvent("pointerover",b,a);this.eb.enter(b,a);this.eb.Gj(b,a)};l.qK=function(a){a.preventDefault();Re(this,a,this.$G)};l.$G=function(a,b){var c=this.ec[b.pointerId];if(c){var d=c.Eg,e=c.cz;this.eb.move(b,a);d&&e!==b.target&&(d.relatedTarget=b.target,b.relatedTarget=e,d.target=e,b.target?(ye(this.eb,d,a),xe(this.eb,b,a)):(b.target=e,b.relatedTarget=null,this.xr(a,b)));c.Eg=b;c.cz=b.target}};
l.pK=function(a){Se(this,a);Re(this,a,this.HK)};l.HK=function(a,b){this.eb.Tk(b,a);this.eb.Eg(b,a);this.eb.leave(b,a);delete this.ec[b.pointerId];b.isPrimary&&(this.Hl=void 0,this.Hm=setTimeout(this.Iz.bind(this),200))};l.oK=function(a){Re(this,a,this.xr)};l.xr=function(a,b){this.eb.cancel(b,a);this.eb.Eg(b,a);this.eb.leave(b,a);delete this.ec[b.pointerId];b.isPrimary&&(this.Hl=void 0,this.Hm=setTimeout(this.Iz.bind(this),200))};
function Se(a,b){var c=a.YG.Yx;b=b.changedTouches[0];if(a.Hl===b.identifier){var d=[b.clientX,b.clientY];c.push(d);setTimeout(function(){var a=c.indexOf(d);-1<a&&c.splice(a,1)},2500)}};function Te(a){Fd.call(this);this.xb=a;this.ec={};this.Vw={};this.Cl=[];ne?Ue(this,new Ce(this)):oe?Ue(this,new ze(this)):(a=new te(this),Ue(this,a),me&&Ue(this,new Pe(this,a)));a=this.Cl.length;for(var b,c=0;c<a;c++)b=this.Cl[c],Ve(this,Object.keys(b.tp))}E(Te,Fd);function Ue(a,b){var c=Object.keys(b.tp);c&&(c.forEach(function(a){var c=b.tp[a];c&&(this.Vw[a]=c.bind(b))},a),a.Cl.push(b))}l=Te.prototype;l.Uw=function(a){var b=this.Vw[a.type];b&&b(a)};
function Ve(a,b){b.forEach(function(a){J(this.xb,a,this.Uw,this)},a)}function We(a,b){b.forEach(function(a){Ad(this.xb,a,this.Uw,this)},a)}function we(a,b){for(var c={},d,e=0,f=Xe.length;e<f;e++)d=Xe[e][0],c[d]=a[d]||b[d]||Xe[e][1];return c}l.Gj=function(a,b){this.fireEvent("pointerdown",a,b)};l.move=function(a,b){this.fireEvent("pointermove",a,b)};l.Tk=function(a,b){this.fireEvent("pointerup",a,b)};l.enter=function(a,b){a.bubbles=!1;this.fireEvent("pointerenter",a,b)};
l.leave=function(a,b){a.bubbles=!1;this.fireEvent("pointerleave",a,b)};l.Eg=function(a,b){a.bubbles=!0;this.fireEvent("pointerout",a,b)};l.cancel=function(a,b){this.fireEvent("pointercancel",a,b)};function ye(a,b,c){a.Eg(b,c);var d=b.target,e=b.relatedTarget;d&&e&&d.contains(e)||a.leave(b,c)}function xe(a,b,c){b.bubbles=!0;a.fireEvent("pointerover",b,c);var d=b.target,e=b.relatedTarget;d&&e&&d.contains(e)||a.enter(b,c)}l.fireEvent=function(a,b,c){this.dispatchEvent(new Be(a,c,b))};
function De(a,b){a.dispatchEvent(new Be(b.type,b,b))}l.ab=function(){for(var a=this.Cl.length,b,c=0;c<a;c++)b=this.Cl[c],We(this,Object.keys(b.tp));Fd.prototype.ab.call(this)};
var Xe=[["bubbles",!1],["cancelable",!1],["view",null],["detail",null],["screenX",0],["screenY",0],["clientX",0],["clientY",0],["ctrlKey",!1],["altKey",!1],["shiftKey",!1],["metaKey",!1],["button",0],["relatedTarget",null],["buttons",0],["pointerId",0],["width",0],["height",0],["pressure",0],["tiltX",0],["tiltY",0],["pointerType",""],["hwTimestamp",0],["isPrimary",!1],["type",""],["target",null],["currentTarget",null],["which",0]];function Ye(a){Fd.call(this);this.S=a;this.jl=0;this.ah=!1;this.Hj=[];this.yl=null;a=this.S.ac;this.lv=0;this.Cu={};this.mk=new Te(a);this.$g=null;this.Ft=J(this.mk,"pointerdown",this.HF,this);this.Lt=J(this.mk,"pointermove",this.oI,this)}E(Ye,Fd);
function Ze(a,b){var c=new Zd("click",a.S,b);a.dispatchEvent(c);0!==a.jl?(clearTimeout(a.jl),a.jl=0,c=new Zd("dblclick",a.S,b),a.dispatchEvent(c)):a.jl=setTimeout(function(){this.jl=0;var a=new Zd("singleclick",this.S,b);this.dispatchEvent(a)}.bind(a),250)}function $e(a,b){"pointerup"==b.type||"pointercancel"==b.type?delete a.Cu[b.pointerId]:"pointerdown"==b.type&&(a.Cu[b.pointerId]=!0);a.lv=Object.keys(a.Cu).length}l=Ye.prototype;
l.Hx=function(a){$e(this,a);var b=new Zd("pointerup",this.S,a);this.dispatchEvent(b);!this.ah&&0===a.button&&Ze(this,this.yl);0===this.lv&&(this.Hj.forEach(ud),this.Hj.length=0,this.ah=!1,this.yl=null,this.$g.Yd(),this.$g=null)};l.HF=function(a){$e(this,a);var b=new Zd("pointerdown",this.S,a);this.dispatchEvent(b);this.yl=a;0===this.Hj.length&&(this.$g=new Te(document),this.Hj.push(J(this.$g,"pointermove",this.Vj,this),J(this.$g,"pointerup",this.Hx,this),J(this.mk,"pointercancel",this.Hx,this)))};
l.Vj=function(a){if(a.clientX!=this.yl.clientX||a.clientY!=this.yl.clientY){this.ah=!0;var b=new Zd("pointerdrag",this.S,a);this.dispatchEvent(b)}a.preventDefault()};l.oI=function(a){this.dispatchEvent(new Zd(a.type,this.S,a))};l.ab=function(){this.Lt&&(ud(this.Lt),this.Lt=null);this.Ft&&(ud(this.Ft),this.Ft=null);this.Hj.forEach(ud);this.Hj.length=0;this.$g&&(this.$g.Yd(),this.$g=null);this.mk&&(this.mk.Yd(),this.mk=null);Fd.prototype.ab.call(this)};function af(a,b){if(!a)throw new od(b);};function bf(a,b){this.mz=a;this.bp=b;this.Cf=[];this.qk=[];this.$i={}}l=bf.prototype;l.clear=function(){this.Cf.length=0;this.qk.length=0;qd(this.$i)};l.dequeue=function(){var a=this.Cf,b=this.qk,c=a[0];1==a.length?(a.length=0,b.length=0):(a[0]=a.pop(),b[0]=b.pop(),cf(this,0));a=this.bp(c);delete this.$i[a];return c};l.enqueue=function(a){af(!(this.bp(a)in this.$i),31);var b=this.mz(a);return Infinity!=b?(this.Cf.push(a),this.qk.push(b),this.$i[this.bp(a)]=!0,df(this,0,this.Cf.length-1),!0):!1};
l.Jl=function(){return this.Cf.length};l.df=function(){return 0===this.Cf.length};function cf(a,b){for(var c=a.Cf,d=a.qk,e=c.length,f=c[b],g=d[b],h=b;b<e>>1;){var k=2*b+1,m=2*b+2,k=m<e&&d[m]<d[k]?m:k;c[b]=c[k];d[b]=d[k];b=k}c[b]=f;d[b]=g;df(a,h,b)}function df(a,b,c){var d=a.Cf;a=a.qk;for(var e=d[c],f=a[c];c>b;){var g=c-1>>1;if(a[g]>f)d[c]=d[g],a[c]=a[g],c=g;else break}d[c]=e;a[c]=f}
function ef(a){var b=a.mz,c=a.Cf,d=a.qk,e=0,f=c.length,g,h,k;for(h=0;h<f;++h)g=c[h],k=b(g),Infinity==k?delete a.$i[a.bp(g)]:(d[e]=k,c[e++]=g);c.length=e;d.length=e;for(b=(a.Cf.length>>1)-1;0<=b;b--)cf(a,b)};function ff(a,b){bf.call(this,function(b){return a.apply(null,b)},function(a){return a[0].getKey()});this.ZJ=b;this.yq=0;this.xq={}}E(ff,bf);ff.prototype.enqueue=function(a){var b=bf.prototype.enqueue.call(this,a);b&&J(a[0],"change",this.Mo,this);return b};ff.prototype.Mo=function(a){a=a.target;var b=a.gb();if(2===b||3===b||4===b||5===b)Ad(a,"change",this.Mo,this),a=a.getKey(),a in this.xq&&(delete this.xq[a],--this.yq),this.ZJ()};function gf(a,b,c){return Math.min(Math.max(a,b),c)}var hf="cosh"in Math?Math.cosh:function(a){a=Math.exp(a);return(a+1/a)/2};function jf(a){af(0<a,29);return Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function kf(a,b,c,d){a=c-a;b=d-b;return a*a+b*b}function lf(a){return a*Math.PI/180}function mf(a,b){a%=b;return 0>a*b?a+b:a};function nf(a){return function(b){if(b)return[gf(b[0],a[0],a[2]),gf(b[1],a[1],a[3])]}}function of(a){return a};function pf(a,b,c){this.Ka=a;this.ra=b;this.rotation=c};function qf(a){return function(b,c,d){if(void 0!==b)return b=He(a,b,d),b=gf(b+c,0,a.length-1),c=Math.floor(b),b!=c&&c<a.length-1?a[c]/Math.pow(a[c]/a[c+1],b-c):a[c]}}function rf(a,b,c){return function(d,e,f){if(void 0!==d)return d=Math.max(Math.floor(Math.log(b/d)/Math.log(a)+(-f/2+.5))+e,0),void 0!==c&&(d=Math.min(d,c)),b/Math.pow(a,d)}};function sf(a){if(void 0!==a)return 0}function tf(a,b){if(void 0!==a)return a+b}function uf(a){var b=2*Math.PI/a;return function(a,d){if(void 0!==a)return a=Math.floor((a+d)/b+.5)*b}}function vf(){var a=lf(5);return function(b,c){if(void 0!==b)return Math.abs(b+c)<=a?0:b+c}};function wf(a){a=""+a;var b=a.indexOf("."),b=-1===b?a.length:b;return 2<b?a:Array(3-b).join("0")+a}function xf(a){a=(""+a).split(".");for(var b=["1","3"],c=0;c<Math.max(a.length,b.length);c++){var d=parseInt(a[c]||"0",10),e=parseInt(b[c]||"0",10);if(d>e)return 1;if(e>d)return-1}return 0};function yf(a,b){a[0]+=b[0];a[1]+=b[1]}function zf(a,b){var c=a[0];a=a[1];var d=b[0],e=b[1];b=d[0];var d=d[1],f=e[0],e=e[1],g=f-b,h=e-d,c=0===g&&0===h?0:(g*(c-b)+h*(a-d))/(g*g+h*h||0);0>=c?(a=b,c=d):1<=c?(a=f,c=e):(a=b+c*g,c=d+c*h);return[a,c]}function Af(a,b){for(var c=!0,d=a.length-1;0<=d;--d)if(a[d]!=b[d]){c=!1;break}return c}function Bf(a,b){var c=Math.cos(b);b=Math.sin(b);var d=a[1]*c+a[0]*b;a[0]=a[0]*c-a[1]*b;a[1]=d}function Cf(a,b){var c=a[0]-b[0];a=a[1]-b[1];return c*c+a*a}
function Df(a,b){return Math.sqrt(Cf(a,b))};function Ef(a){return 1-Math.pow(1-a,3)}function Ff(a){return 3*a*a-2*a*a*a}function Gf(a){return a};function Hf(a){for(var b=If(),c=0,d=a.length;c<d;++c)Jf(b,a[c]);return b}function Kf(a,b,c){return c?(c[0]=a[0]-b,c[1]=a[1]-b,c[2]=a[2]+b,c[3]=a[3]+b,c):[a[0]-b,a[1]-b,a[2]+b,a[3]+b]}function Lf(a,b){return b?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b):a.slice()}function Mf(a,b,c){b=b<a[0]?a[0]-b:a[2]<b?b-a[2]:0;a=c<a[1]?a[1]-c:a[3]<c?c-a[3]:0;return b*b+a*a}function Nf(a,b){return a[0]<=b[0]&&b[2]<=a[2]&&a[1]<=b[1]&&b[3]<=a[3]}function Of(a,b,c){return a[0]<=b&&b<=a[2]&&a[1]<=c&&c<=a[3]}
function If(){return[Infinity,Infinity,-Infinity,-Infinity]}function Pf(a,b,c,d,e){return e?(e[0]=a,e[1]=b,e[2]=c,e[3]=d,e):[a,b,c,d]}function Qf(a){return Pf(Infinity,Infinity,-Infinity,-Infinity,a)}function Rf(a,b){var c=a[0];a=a[1];return Pf(c,a,c,a,b)}function Sf(a,b){return a[0]==b[0]&&a[2]==b[2]&&a[1]==b[1]&&a[3]==b[3]}function Tf(a,b){b[0]<a[0]&&(a[0]=b[0]);b[2]>a[2]&&(a[2]=b[2]);b[1]<a[1]&&(a[1]=b[1]);b[3]>a[3]&&(a[3]=b[3])}
function Jf(a,b){b[0]<a[0]&&(a[0]=b[0]);b[0]>a[2]&&(a[2]=b[0]);b[1]<a[1]&&(a[1]=b[1]);b[1]>a[3]&&(a[3]=b[1])}function Uf(a,b,c,d,e){for(;c<d;c+=e){var f=a,g=b[c],h=b[c+1];f[0]=Math.min(f[0],g);f[1]=Math.min(f[1],h);f[2]=Math.max(f[2],g);f[3]=Math.max(f[3],h)}return a}function Vf(a){var b=0;Wf(a)||(b=Xf(a)*Yf(a));return b}function Zf(a){return[(a[0]+a[2])/2,(a[1]+a[3])/2]}
function $f(a,b,c,d,e){var f=b*d[0]/2;d=b*d[1]/2;b=Math.cos(c);var g=Math.sin(c);c=f*b;f*=g;b*=d;var h=d*g,k=a[0],m=a[1];a=k-c+h;d=k-c-h;g=k+c-h;c=k+c+h;var h=m-f-b,k=m-f+b,p=m+f+b,f=m+f-b;return Pf(Math.min(a,d,g,c),Math.min(h,k,p,f),Math.max(a,d,g,c),Math.max(h,k,p,f),e)}function Yf(a){return a[3]-a[1]}function ag(a,b){var c=If();bg(a,b)&&(c[0]=a[0]>b[0]?a[0]:b[0],c[1]=a[1]>b[1]?a[1]:b[1],c[2]=a[2]<b[2]?a[2]:b[2],c[3]=a[3]<b[3]?a[3]:b[3]);return c}function cg(a){return[a[0],a[3]]}
function Xf(a){return a[2]-a[0]}function bg(a,b){return a[0]<=b[2]&&a[2]>=b[0]&&a[1]<=b[3]&&a[3]>=b[1]}function Wf(a){return a[2]<a[0]||a[3]<a[1]}function dg(a,b){var c=(a[2]-a[0])/2*(b-1);b=(a[3]-a[1])/2*(b-1);a[0]-=c;a[2]+=c;a[1]-=b;a[3]+=b}function eg(a,b){a=[a[0],a[1],a[0],a[3],a[2],a[1],a[2],a[3]];b(a,a,2);var c=[a[0],a[2],a[4],a[6]],d=[a[1],a[3],a[5],a[7]];b=Math.min.apply(null,c);a=Math.min.apply(null,d);c=Math.max.apply(null,c);d=Math.max.apply(null,d);return Pf(b,a,c,d,void 0)};function fg(){return!0}function gg(){return!1};/*

 Latitude/longitude spherical geodesy formulae taken from
 http://www.movable-type.co.uk/scripts/latlong.html
 Licensed under CC-BY-3.0.
*/
function hg(a){this.tb=a}function ig(a,b){for(var c=0,d=b.length,e=b[d-1][0],f=b[d-1][1],g=0;g<d;g++)var h=b[g][0],k=b[g][1],c=c+lf(h-e)*(2+Math.sin(lf(f))+Math.sin(lf(k))),e=h,f=k;return c*a.tb*a.tb/2}function jg(a,b,c){var d=lf(b[1]),e=lf(c[1]),f=(e-d)/2;b=lf(c[0]-b[0])/2;d=Math.sin(f)*Math.sin(f)+Math.sin(b)*Math.sin(b)*Math.cos(d)*Math.cos(e);return 2*a.tb*Math.atan2(Math.sqrt(d),Math.sqrt(1-d))}
hg.prototype.offset=function(a,b,c){var d=lf(a[1]);b/=this.tb;var e=Math.asin(Math.sin(d)*Math.cos(b)+Math.cos(d)*Math.sin(b)*Math.cos(c));return[180*(lf(a[0])+Math.atan2(Math.sin(c)*Math.sin(b)*Math.cos(d),Math.cos(b)-Math.sin(d)*Math.sin(e)))/Math.PI,180*e/Math.PI]};var kg=new hg(6370997);var lg={};lg.degrees=2*Math.PI*kg.tb/360;lg.ft=.3048;lg.m=1;lg["us-ft"]=1200/3937;function mg(a){this.V=a.code;this.Ju=a.units;this.te=void 0!==a.Z?a.Z:null;this.En=void 0!==a.sr?a.sr:"enu";this.Ul=void 0!==a.global?a.global:!1;this.ii=!(!this.Ul||!this.te);this.ME=a.LE;this.Fw=null;this.Gy=a.Fy;var b=a.code,c=window.proj4;"function"==typeof c&&(b=c.jg(b),void 0!==b&&(void 0!==b.axis&&void 0===a.sr&&(this.En=b.axis),void 0===a.Fy&&(this.Gy=b.xM),void 0===a.units&&(this.Ju=b.units)))}mg.prototype.W=function(){return this.te};mg.prototype.Tl=function(){return this.Ju};
function ng(a){return a.Gy||lg[a.Ju]}mg.prototype.fq=function(a){this.te=a;this.ii=!(!this.Ul||!a)};function og(a){mg.call(this,{code:a,units:"m",Z:pg,global:!0,YK:qg,LE:function(a,c){return a/hf(c[1]/6378137)}})}E(og,mg);var rg=6378137*Math.PI,pg=[-rg,-rg,rg,rg],qg=[-180,-85,180,85],sg="EPSG:3857 EPSG:102100 EPSG:102113 EPSG:900913 urn:ogc:def:crs:EPSG:6.18:3:3857 urn:ogc:def:crs:EPSG::3857 http://www.opengis.net/gml/srs/epsg.xml#3857".split(" ").map(function(a){return new og(a)});
function tg(a,b,c){var d=a.length;c=1<c?c:2;void 0===b&&(b=2<c?a.slice():Array(d));for(var e=0;e<d;e+=c){b[e]=rg*a[e]/180;var f=6378137*Math.log(Math.tan(Math.PI*(a[e+1]+90)/360));f>rg?f=rg:f<-rg&&(f=-rg);b[e+1]=f}return b}function ug(a,b,c){var d=a.length;c=1<c?c:2;void 0===b&&(b=2<c?a.slice():Array(d));for(var e=0;e<d;e+=c)b[e]=180*a[e]/rg,b[e+1]=360*Math.atan(Math.exp(a[e+1]/6378137))/Math.PI-90;return b};var vg=new hg(6378137);function wg(a,b){mg.call(this,{code:a,units:"degrees",Z:xg,sr:b,global:!0,Fy:yg,YK:xg})}E(wg,mg);var xg=[-180,-90,180,90],yg=Math.PI*vg.tb/180,zg=[new wg("CRS:84"),new wg("EPSG:4326","neu"),new wg("urn:ogc:def:crs:EPSG::4326","neu"),new wg("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new wg("urn:ogc:def:crs:OGC:1.3:CRS84"),new wg("urn:ogc:def:crs:OGC:2:84"),new wg("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new wg("urn:x-ogc:def:crs:EPSG:4326","neu")];var Ag={};var Bg={};function Cg(a,b,c){a=a.V;b=b.V;a in Bg||(Bg[a]={});Bg[a][b]=c}function Dg(a,b){var c;a in Bg&&b in Bg[a]&&(c=Bg[a][b]);return c};function Eg(a,b,c){var d=a.ME;d?b=d(b,c):"degrees"!=a.Tl()&&(d=Fg(a,Gg("EPSG:4326")),b=[c[0]-b/2,c[1],c[0]+b/2,c[1],c[0],c[1]-b/2,c[0],c[1]+b/2],b=d(b,b,2),c=jg(kg,b.slice(0,2),b.slice(2,4)),b=jg(kg,b.slice(4,6),b.slice(6,8)),b=(c+b)/2,a=ng(a),void 0!==a&&(b/=a));return b}function Hg(a){Ig(a);a.forEach(function(b){a.forEach(function(a){b!==a&&Cg(b,a,Jg)})})}function Kg(a){Ag[a.V]=a;Cg(a,a,Jg)}function Ig(a){var b=[];a.forEach(function(a){b.push(Kg(a))})}
function Lg(a){return a?"string"===typeof a?Gg(a):a:Gg("EPSG:3857")}function Mg(a,b,c,d){a=Gg(a);b=Gg(b);Cg(a,b,Ng(c));Cg(b,a,Ng(d))}function Ng(a){return function(b,c,d){var e=b.length;d=void 0!==d?d:2;c=void 0!==c?c:Array(e);var f,g;for(g=0;g<e;g+=d)for(f=a([b[g],b[g+1]]),c[g]=f[0],c[g+1]=f[1],f=d-1;2<=f;--f)c[g+f]=b[g+f];return c}}
function Gg(a){var b=null;if(a instanceof mg)b=a;else if("string"===typeof a){var b=Ag[a]||null,c=window.proj4;b||"function"!=typeof c||void 0===c.jg(a)||(b=new mg({code:a}),Kg(b))}return b}function Og(a,b){if(a===b)return!0;var c=a.Tl()===b.Tl();return a.V===b.V?c:Fg(a,b)===Jg&&c}function Pg(a,b){a=Gg(a);b=Gg(b);return Fg(a,b)}
function Fg(a,b){var c=a.V,d=b.V,e=Dg(c,d);if(!e){var f=window.proj4;if("function"==typeof f){var g=f.jg(c),h=f.jg(d);void 0!==g&&void 0!==h&&(g===h?Hg([b,a]):(e=f(d,c),Mg(b,a,e.forward,e.inverse)),e=Dg(c,d))}}e||(e=Qg);return e}function Qg(a,b){if(void 0!==b&&a!==b){for(var c=0,d=a.length;c<d;++c)b[c]=a[c];a=b}return a}function Jg(a,b){if(void 0!==b){for(var c=0,d=a.length;c<d;++c)b[c]=a[c];a=b}else a=a.slice();return a}function Rg(a,b,c){return Pg(b,c)(a,void 0,a.length)}
function Sg(a,b,c){b=Pg(b,c);return eg(a,b)}Hg(sg);Hg(zg);zg.forEach(function(a){sg.forEach(function(b){Cg(a,b,tg);Cg(b,a,ug)})});function Tg(){Jd.call(this);this.te=If();this.Ww=-1;this.Gh={};this.mq=this.Hh=0}E(Tg,Jd);Tg.prototype.zf=gg;Tg.prototype.W=function(a){this.Ww!=this.Sa&&(this.te=this.Rn(this.te),this.Ww=this.Sa);var b=this.te;a?(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3]):a=b;return a};Tg.prototype.transform=function(a,b){this.cl(Pg(a,b));return this};function Ug(a,b,c,d){var e=d?d:[],f=0,g;for(g=0;g<b;g+=2){var h=a[g],k=a[g+1];e[f++]=c[0]*h+c[2]*k+c[4];e[f++]=c[1]*h+c[3]*k+c[5]}d&&e.length!=f&&(e.length=f);return e}function Wg(a,b,c,d,e,f){var g=f?f:[],h=0,k,m;for(k=0;k<b;k+=c)for(g[h++]=a[k]+d,g[h++]=a[k+1]+e,m=k+2;m<k+c;++m)g[h++]=a[m];f&&g.length!=h&&(g.length=h);return g};function Xg(){Tg.call(this);this.Ua="XY";this.P=2;this.l=null}E(Xg,Tg);function Yg(a){var b;"XY"==a?b=2:"XYZ"==a||"XYM"==a?b=3:"XYZM"==a&&(b=4);return b}l=Xg.prototype;l.zf=gg;l.Rn=function(a){var b=this.l,c=this.l.length,d=this.P;a=Qf(a);return Uf(a,b,0,c,d)};function Zg(a){return a.l.slice(0,a.P)}function $g(a){return a.l.slice(a.l.length-a.P)}
l.rs=function(a){this.mq!=this.Sa&&(qd(this.Gh),this.Hh=0,this.mq=this.Sa);if(0>a||0!==this.Hh&&a<=this.Hh)return this;var b=a.toString();if(this.Gh.hasOwnProperty(b))return this.Gh[b];var c=this.Rj(a);if(c.l.length<this.l.length)return this.Gh[b]=c;this.Hh=a;return this};l.Rj=function(){return this};function ah(a,b,c){a.P=Yg(b);a.Ua=b;a.l=c}
function bh(a,b,c,d){if(b)c=Yg(b);else{for(b=0;b<d;++b){if(0===c.length){a.Ua="XY";a.P=2;return}c=c[0]}c=c.length;var e;2==c?e="XY":3==c?e="XYZ":4==c&&(e="XYZM");b=e}a.Ua=b;a.P=c}l.cl=function(a){this.l&&(a(this.l,this.l,this.P),this.G())};
l.rotate=function(a,b){var c=this.l;if(c){var d=c.length,e=this.P,f=c?c:[],g=Math.cos(a);a=Math.sin(a);var h=b[0];b=b[1];for(var k=0,m=0;m<d;m+=e){var p=c[m]-h,t=c[m+1]-b;f[k++]=h+p*g-t*a;f[k++]=b+p*a+t*g;for(p=m+2;p<m+e;++p)f[k++]=c[p]}c&&f.length!=k&&(f.length=k);this.G()}};
l.scale=function(a,b,c){var d=b;void 0===d&&(d=a);var e=c;e||(e=Zf(this.W()));if(c=this.l){b=c.length;for(var f=this.P,g=c?c:[],h=e[0],e=e[1],k=0,m=0;m<b;m+=f){var p=c[m]-h,t=c[m+1]-e;g[k++]=h+a*p;g[k++]=e+d*t;for(p=m+2;p<m+f;++p)g[k++]=c[p]}c&&g.length!=k&&(g.length=k);this.G()}};l.translate=function(a,b){var c=this.l;c&&(Wg(c,c.length,this.P,a,b,c),this.G())};function ch(a,b,c,d){for(var e=0,f=a[c-d],g=a[c-d+1];b<c;b+=d)var h=a[b],k=a[b+1],e=e+(g*h-f*k),f=h,g=k;return e/2}function dh(a,b,c,d){var e=0,f,g;f=0;for(g=c.length;f<g;++f){var h=c[f],e=e+ch(a,b,h,d);b=h}return e};function eh(a,b,c,d,e,f,g){var h=a[b],k=a[b+1],m=a[c]-h,p=a[c+1]-k;if(0!==m||0!==p)if(f=((e-h)*m+(f-k)*p)/(m*m+p*p),1<f)b=c;else if(0<f){for(e=0;e<d;++e)h=a[b+e],g[e]=h+f*(a[c+e]-h);g.length=d;return}for(e=0;e<d;++e)g[e]=a[b+e];g.length=d}function fh(a,b,c,d,e){var f=a[b],g=a[b+1];for(b+=d;b<c;b+=d){var h=a[b],k=a[b+1],f=kf(f,g,h,k);f>e&&(e=f);f=h;g=k}return e}function gh(a,b,c,d,e){var f,g;f=0;for(g=c.length;f<g;++f){var h=c[f];e=fh(a,b,h,d,e);b=h}return e}
function hh(a,b,c,d,e,f,g,h,k,m,p){if(b==c)return m;var t;if(0===e){t=kf(g,h,a[b],a[b+1]);if(t<m){for(p=0;p<d;++p)k[p]=a[b+p];k.length=d;return t}return m}for(var v=p?p:[NaN,NaN],w=b+d;w<c;)if(eh(a,w-d,w,d,g,h,v),t=kf(g,h,v[0],v[1]),t<m){m=t;for(p=0;p<d;++p)k[p]=v[p];k.length=d;w+=d}else w+=d*Math.max((Math.sqrt(t)-Math.sqrt(m))/e|0,1);if(f&&(eh(a,c-d,b,d,g,h,v),t=kf(g,h,v[0],v[1]),t<m)){m=t;for(p=0;p<d;++p)k[p]=v[p];k.length=d}return m}
function ih(a,b,c,d,e,f,g,h,k,m,p){p=p?p:[NaN,NaN];var t,v;t=0;for(v=c.length;t<v;++t){var w=c[t];m=hh(a,b,w,d,e,f,g,h,k,m,p);b=w}return m};function jh(a,b){var c=0,d,e;d=0;for(e=b.length;d<e;++d)a[c++]=b[d];return c}function kh(a,b,c,d){var e,f;e=0;for(f=c.length;e<f;++e){var g=c[e],h;for(h=0;h<d;++h)a[b++]=g[h]}return b}function lh(a,b,c,d,e){e=e?e:[];var f=0,g,h;g=0;for(h=c.length;g<h;++g)b=kh(a,b,c[g],d),e[f++]=b;e.length=f;return e};function mh(a,b,c,d,e){e=void 0!==e?e:[];for(var f=0;b<c;b+=d)e[f++]=a.slice(b,b+d);e.length=f;return e}function nh(a,b,c,d,e){e=void 0!==e?e:[];var f=0,g,h;g=0;for(h=c.length;g<h;++g){var k=c[g];e[f++]=mh(a,b,k,d,e[f]);b=k}e.length=f;return e};function oh(a,b,c,d,e,f,g){var h=(c-b)/d;if(3>h){for(;b<c;b+=d)f[g++]=a[b],f[g++]=a[b+1];return g}var k=Array(h);k[0]=1;k[h-1]=1;c=[b,c-d];for(var m=0,p;0<c.length;){var t=c.pop(),v=c.pop(),w=0,x=a[v],y=a[v+1],F=a[t],H=a[t+1];for(p=v+d;p<t;p+=d){var B;B=a[p];var R=a[p+1],N=x,P=y,K=F-N,G=H-P;if(0!==K||0!==G){var ba=((B-N)*K+(R-P)*G)/(K*K+G*G);1<ba?(N=F,P=H):0<ba&&(N+=K*ba,P+=G*ba)}B=kf(B,R,N,P);B>w&&(m=p,w=B)}w>e&&(k[(m-b)/d]=1,v+d<m&&c.push(v,m),m+d<t&&c.push(m,t))}for(p=0;p<h;++p)k[p]&&(f[g++]=a[b+
p*d],f[g++]=a[b+p*d+1]);return g}
function ph(a,b,c,d,e,f,g,h){var k,m;k=0;for(m=c.length;k<m;++k){var p=c[k];a:{var t=a,v=p,w=d,x=e,y=f;if(b!=v){var F=x*Math.round(t[b]/x),H=x*Math.round(t[b+1]/x);b+=w;y[g++]=F;y[g++]=H;var B,R;do if(B=x*Math.round(t[b]/x),R=x*Math.round(t[b+1]/x),b+=w,b==v){y[g++]=B;y[g++]=R;break a}while(B==F&&R==H);for(;b<v;){var N,P;N=x*Math.round(t[b]/x);P=x*Math.round(t[b+1]/x);b+=w;if(N!=B||P!=R){var K=B-F,G=R-H,ba=N-F,Sa=P-H;K*Sa==G*ba&&(0>K&&ba<K||K==ba||0<K&&ba>K)&&(0>G&&Sa<G||G==Sa||0<G&&Sa>G)||(y[g++]=
B,y[g++]=R,F=B,H=R);B=N;R=P}}y[g++]=B;y[g++]=R}}h.push(g);b=p}return g};function qh(a,b){Xg.call(this);this.Kd=this.Ld=-1;this.Bb(a,b)}E(qh,Xg);l=qh.prototype;l.clone=function(){var a=new qh(null);a.sa(this.Ua,this.l.slice());return a};l.yf=function(a,b,c,d){if(d<Mf(this.W(),a,b))return d;this.Kd!=this.Sa&&(this.Ld=Math.sqrt(fh(this.l,0,this.l.length,this.P,0)),this.Kd=this.Sa);return hh(this.l,0,this.l.length,this.P,this.Ld,!0,a,b,c,d)};l.Nj=function(){return ch(this.l,0,this.l.length,this.P)};l.ca=function(){return mh(this.l,0,this.l.length,this.P)};
l.Rj=function(a){var b=[];b.length=oh(this.l,0,this.l.length,this.P,a,b,0);a=new qh(null);a.sa("XY",b);return a};l.K=function(){return"LinearRing"};l.Bb=function(a,b){a?(bh(this,b,a,1),this.l||(this.l=[]),this.l.length=kh(this.l,0,a,this.P),this.G()):this.sa("XY",null)};l.sa=function(a,b){ah(this,a,b);this.G()};function rh(a,b){Xg.call(this);this.Bb(a,b)}E(rh,Xg);l=rh.prototype;l.clone=function(){var a=new rh(null);a.sa(this.Ua,this.l.slice());return a};l.yf=function(a,b,c,d){var e=this.l;a=kf(a,b,e[0],e[1]);if(a<d){d=this.P;for(b=0;b<d;++b)c[b]=e[b];c.length=d;return a}return d};l.ca=function(){return this.l?this.l.slice():[]};l.Rn=function(a){return Rf(this.l,a)};l.K=function(){return"Point"};l.Bb=function(a,b){a?(bh(this,b,a,0),this.l||(this.l=[]),this.l.length=jh(this.l,a),this.G()):this.sa("XY",null)};
l.sa=function(a,b){ah(this,a,b);this.G()};function sh(a,b,c,d,e,f){for(var g=0,h=a[c-d],k=a[c-d+1];b<c;b+=d){var m=a[b],p=a[b+1];k<=f?p>f&&0<(m-h)*(f-k)-(e-h)*(p-k)&&g++:p<=f&&0>(m-h)*(f-k)-(e-h)*(p-k)&&g--;h=m;k=p}return 0!==g}function th(a,b,c,d,e,f){if(0===c.length||!sh(a,b,c[0],d,e,f))return!1;var g;b=1;for(g=c.length;b<g;++b)if(sh(a,c[b-1],c[b],d,e,f))return!1;return!0};function uh(a,b,c,d,e,f,g){var h,k,m,p,t,v=e[f+1],w=[],x=c[0];m=a[x-d];t=a[x-d+1];for(h=b;h<x;h+=d){p=a[h];k=a[h+1];if(v<=t&&k<=v||t<=v&&v<=k)m=(v-t)/(k-t)*(p-m)+m,w.push(m);m=p;t=k}x=NaN;t=-Infinity;w.sort(Ge);m=w[0];h=1;for(k=w.length;h<k;++h){p=w[h];var y=Math.abs(p-m);y>t&&(m=(m+p)/2,th(a,b,c,d,m,v)&&(x=m,t=y));m=p}isNaN(x)&&(x=e[f]);return g?(g.push(x,v),g):[x,v]};function vh(a,b,c,d){for(var e=0,f=a[c-d],g=a[c-d+1];b<c;b+=d)var h=a[b],k=a[b+1],e=e+(h-f)*(k+g),f=h,g=k;return 0<e}function wh(a,b,c,d){var e=0;d=void 0!==d?d:!1;var f,g;f=0;for(g=b.length;f<g;++f){var h=b[f],e=vh(a,e,h,c);if(0===f){if(d&&e||!d&&!e)return!1}else if(d&&!e||!d&&e)return!1;e=h}return!0}
function xh(a,b,c,d,e){e=void 0!==e?e:!1;var f,g;f=0;for(g=c.length;f<g;++f){var h=c[f],k=vh(a,b,h,d);if(0===f?e&&k||!e&&!k:e&&!k||!e&&k)for(var k=a,m=h,p=d;b<m-p;){var t;for(t=0;t<p;++t){var v=k[b+t];k[b+t]=k[m-p+t];k[m-p+t]=v}b+=p;m-=p}b=h}return b}function yh(a,b,c,d){var e=0,f,g;f=0;for(g=b.length;f<g;++f)e=xh(a,e,b[f],c,d);return e};function zh(a,b){Xg.call(this);this.Xa=[];this.bx=-1;this.cx=null;this.pm=this.Kd=this.Ld=-1;this.lf=null;this.Bb(a,b)}E(zh,Xg);function Ah(a,b){a.l?Ie(a.l,b.l):a.l=b.l.slice();a.Xa.push(a.l.length);a.G()}l=zh.prototype;l.clone=function(){var a=new zh(null);a.sa(this.Ua,this.l.slice(),this.Xa.slice());return a};
l.yf=function(a,b,c,d){if(d<Mf(this.W(),a,b))return d;this.Kd!=this.Sa&&(this.Ld=Math.sqrt(gh(this.l,0,this.Xa,this.P,0)),this.Kd=this.Sa);return ih(this.l,0,this.Xa,this.P,this.Ld,!0,a,b,c,d)};l.zf=function(a,b){return th(this.xe(),0,this.Xa,this.P,a,b)};l.Nj=function(){return dh(this.xe(),0,this.Xa,this.P)};l.ca=function(a){var b;void 0!==a?(b=this.xe().slice(),xh(b,0,this.Xa,this.P,a)):b=this.l;return nh(b,0,this.Xa,this.P)};
function Bh(a){if(a.bx!=a.Sa){var b=Zf(a.W());a.cx=uh(a.xe(),0,a.Xa,a.P,b,0);a.bx=a.Sa}return a.cx}function Ch(a){return new rh(Bh(a))}function Dh(a){if(0>=a.Xa.length)return null;var b=new qh(null);b.sa(a.Ua,a.l.slice(0,a.Xa[0]));return b}function Eh(a){var b=a.Ua,c=a.l;a=a.Xa;var d=[],e=0,f,g;f=0;for(g=a.length;f<g;++f){var h=a[f],k=new qh(null);k.sa(b,c.slice(e,h));d.push(k);e=h}return d}
l.xe=function(){if(this.pm!=this.Sa){var a=this.l;wh(a,this.Xa,this.P)?this.lf=a:(this.lf=a.slice(),this.lf.length=xh(this.lf,0,this.Xa,this.P));this.pm=this.Sa}return this.lf};l.Rj=function(a){var b=[],c=[];b.length=ph(this.l,0,this.Xa,this.P,Math.sqrt(a),b,0,c);a=new zh(null);a.sa("XY",b,c);return a};l.K=function(){return"Polygon"};l.Bb=function(a,b){a?(bh(this,b,a,2),this.l||(this.l=[]),a=lh(this.l,0,a,this.P,this.Xa),this.l.length=0===a.length?0:a[a.length-1],this.G()):this.sa("XY",null,this.Xa)};
l.sa=function(a,b,c){ah(this,a,b);this.Xa=c;this.G()};function Fh(a){var b=a[0],c=a[1],d=a[2];a=a[3];b=[b,c,b,a,d,a,d,c,b,c];c=new zh(null);c.sa("XY",b,[b.length]);return c}function Gh(a){for(var b=a.P,c=a.Ua,d=new zh(null,c),b=33*b,e=Array(b),f=0;f<b;f++)e[f]=0;d.sa(c,e,[e.length]);c=a.La();a=a.bf();for(var b=d.l,e=d.Ua,f=d.P,g=d.Xa,h=b.length/f-1,k,m,p=0;p<=h;++p)m=p*f,k=0+2*mf(p,h)*Math.PI/h,b[m]=c[0]+a*Math.cos(k),b[m+1]=c[1]+a*Math.sin(k);d.sa(e,b,g);return d};function Hh(a){Jd.call(this);a=pd({},a);this.Yl=[0,0];this.hg=[];this.Hq=this.Hq.bind(this);this.sk=Lg(a.la);var b={};b.center=void 0!==a.Ka?a.Ka:null;var c,d,e,f=void 0!==a.Ce?a.Ce:0;c=void 0!==a.kc?a.kc:28;var g=void 0!==a.GB?a.GB:2;if(void 0!==a.Ec)c=a.Ec,d=c[0],e=c[c.length-1],c=qf(c);else{d=Lg(a.la);e=d.W();var h=(e?Math.max(Xf(e),Yf(e)):360*lg.degrees/ng(d))/256/Math.pow(2,0),k=h/Math.pow(2,28);d=a.ef;void 0!==d?f=0:d=h/Math.pow(g,f);e=a.Be;void 0===e&&(e=void 0!==a.kc?void 0!==a.ef?d/Math.pow(g,
c):h/Math.pow(g,c):k);c=f+Math.floor(Math.log(d/e)/Math.log(g));e=d/Math.pow(g,c-f);c=rf(g,d,c-f)}this.Mf=d;this.jm=e;this.jL=g;this.uc=a.Ec;this.km=f;(void 0!==a.Sw?a.Sw:1)?(f=a.Sn,f=void 0===f||!0===f?vf():!1===f?tf:"number"===typeof f?uf(f):tf):f=sf;this.Zg=new pf(void 0!==a.Z?nf(a.Z):of,c,f);void 0!==a.ra?b.resolution=a.ra:void 0!==a.zoom&&(b.resolution=this.Ib(this.Mf,a.zoom-this.km));b.rotation=void 0!==a.rotation?a.rotation:0;Kd(this,b)}E(Hh,Jd);l=Hh.prototype;
l.animate=function(a){var b=Date.now(),c=this.La().slice(),d=this.xa(),e=this.Gb(),f=arguments.length,g;1<f&&"function"===typeof arguments[f-1]&&(g=arguments[f-1],--f);for(var h=[],k=0;k<f;++k){var m=arguments[k],p={start:b,complete:!1,anchor:m.anchor,duration:void 0!==m.duration?m.duration:1E3,Jc:m.Jc||Ff};m.Ka&&(p.lu=c,p.qu=m.Ka,c=p.qu);void 0!==m.zoom?(p.pq=d,p.Mk=this.Ib(this.Mf,m.zoom-this.km,0),d=p.Mk):m.ra&&(p.pq=d,p.Mk=m.ra,d=p.Mk);void 0!==m.rotation&&(p.mu=e,p.sq=m.rotation,e=p.sq);p.mb=
g;b+=p.duration;h.push(p)}this.hg.push(h);Ih(this,0,1);this.Hq()};function Jh(a){Ih(a,0,-Kh(a)[0]);for(var b=0,c=a.hg.length;b<c;++b){var d=a.hg[b];d[0].mb&&d[0].mb(!1)}a.hg.length=0}
l.Hq=function(){void 0!==this.Gq&&(cancelAnimationFrame(this.Gq),this.Gq=void 0);if(0<Kh(this)[0]){for(var a=Date.now(),b=!1,c=this.hg.length-1;0<=c;--c){for(var d=this.hg[c],e=!0,f=0,g=d.length;f<g;++f){var h=d[f];if(!h.complete){b=a-h.start;b=0<h.duration?b/h.duration:1;1<=b?(h.complete=!0,b=1):e=!1;b=h.Jc(b);if(h.lu){var k=h.lu[0],m=h.lu[1];this.set("center",[k+b*(h.qu[0]-k),m+b*(h.qu[1]-m)])}h.pq&&h.Mk&&(k=1===b?h.Mk:h.pq+b*(h.Mk-h.pq),h.anchor&&this.set("center",Lh(this,k,h.anchor)),this.set("resolution",
k));void 0!==h.mu&&void 0!==h.sq&&(b=1===b?h.sq:h.mu+b*(h.sq-h.mu),h.anchor&&this.set("center",Mh(this,b,h.anchor)),this.set("rotation",b));b=!0;if(!h.complete)break}}e&&(this.hg[c]=null,Ih(this,0,-1),(d=d[0].mb)&&d(!0))}this.hg=this.hg.filter(Boolean);b&&void 0===this.Gq&&(this.Gq=requestAnimationFrame(this.Hq))}};function Mh(a,b,c){var d,e=a.La();void 0!==e&&(d=[e[0]-c[0],e[1]-c[1]],Bf(d,b-a.Gb()),yf(d,c));return d}
function Lh(a,b,c){var d,e=a.La();a=a.xa();void 0!==e&&void 0!==a&&(d=[c[0]-b*(c[0]-e[0])/a,c[1]-b*(c[1]-e[1])/a]);return d}function Nh(a){var b=[100,100];a='.ol-viewport[data-view="'+I(a)+'"]';if(a=document.querySelector(a))a=getComputedStyle(a),b[0]=parseInt(a.width,10),b[1]=parseInt(a.height,10);return b}l.Ib=function(a,b,c){return this.Zg.ra(a,b||0,c||0)};l.Sn=function(a,b){return this.Zg.rotation(a,b||0)};l.La=function(){return this.get("center")};
function Kh(a,b){return void 0!==b?(b[0]=a.Yl[0],b[1]=a.Yl[1],b):a.Yl.slice()}function Oh(a,b){b=b||Nh(a);var c=a.La();af(c,1);var d=a.xa();af(void 0!==d,2);a=a.Gb();af(void 0!==a,3);return $f(c,d,a,b)}l.Ml=function(){return this.Mf};l.Nl=function(){return this.jm};l.ux=function(){return Ph(this,this.jm)};l.ms=function(){return Ph(this,this.Mf)};l.D=function(){return this.sk};l.xa=function(){return this.get("resolution")};l.Qj=function(){return this.uc};
function Qh(a,b){return Math.max(Xf(a)/b[0],Yf(a)/b[1])}function Rh(a){var b=a.Mf,c=Math.log(b/a.jm)/Math.log(2);return function(a){return b/Math.pow(2,a*c)}}l.Gb=function(){return this.get("rotation")};function Sh(a){var b=a.Mf,c=Math.log(b/a.jm)/Math.log(2);return function(a){return Math.log(b/a)/Math.log(2)/c}}l.gb=function(){var a=this.La(),b=this.D(),c=this.xa(),d=this.Gb();return{Ka:a.slice(),la:void 0!==b?b:null,ra:c,rotation:d}};
l.Gf=function(){var a,b=this.xa();void 0!==b&&(a=Ph(this,b));return a};function Ph(a,b){var c;if(b>=a.jm&&b<=a.Mf){c=a.km||0;var d;if(a.uc){var e=He(a.uc,b,1);c+=e;if(e==a.uc.length-1)return c;d=a.uc[e];a=d/a.uc[e+1]}else d=a.Mf,a=a.jL;c+=Math.log(d/b)/Math.log(a)}return c}
function Th(a,b,c){c=c||{};var d=c.size;d||(d=Nh(a));var e;b instanceof Xg?"Circle"===b.K()?(b=b.W(),e=Fh(b),e.rotate(a.Gb(),Zf(b))):e=b:(af(Array.isArray(b),24),af(!Wf(b),25),e=Fh(b));var f=void 0!==c.padding?c.padding:[0,0,0,0],g=void 0!==c.Ib?c.Ib:!0,h=void 0!==c.Ti?c.Ti:!1,k;k=void 0!==c.Be?c.Be:void 0!==c.kc?a.Ib(a.Mf,c.kc-a.km,0):0;var m=e.l,p=a.Gb();b=Math.cos(-p);var p=Math.sin(-p),t=Infinity,v=Infinity,w=-Infinity,x=-Infinity;e=e.P;for(var y=0,F=m.length;y<F;y+=e)var H=m[y]*b-m[y+1]*p,B=
m[y]*p+m[y+1]*b,t=Math.min(t,H),v=Math.min(v,B),w=Math.max(w,H),x=Math.max(x,B);d=Qh([t,v,w,x],[d[0]-f[1]-f[3],d[1]-f[0]-f[2]]);d=isNaN(d)?k:Math.max(d,k);g&&(g=a.Ib(d,0,0),!h&&g<d&&(g=a.Ib(g,-1,0)),d=g);p=-p;h=(t+w)/2+(f[1]-f[3])/2*d;f=(v+x)/2+(f[0]-f[2])/2*d;b=[h*b-f*p,f*b+h*p];void 0!==c.duration?a.animate({ra:d,Ka:b,duration:c.duration,Jc:c.Jc}):(Uh(a,d),a.ub(b))}l.$o=function(){return!!this.La()&&void 0!==this.xa()};l.rotate=function(a,b){void 0!==b&&(b=Mh(this,a,b),this.ub(b));this.Lm(a)};
l.ub=function(a){this.set("center",a);0<Kh(this)[0]&&Jh(this)};function Ih(a,b,c){a.Yl[b]+=c;a.G()}function Uh(a,b){a.set("resolution",b);0<Kh(a)[0]&&Jh(a)}l.Lm=function(a){this.set("rotation",a);0<Kh(this)[0]&&Jh(this)};l.Fh=function(a){a=this.Ib(this.Mf,a-this.km,0);Uh(this,a)};function Vh(a,b){var c=document.createElement("CANVAS");a&&(c.width=a);b&&(c.height=b);return c.getContext("2d")}function Wh(a,b){var c=b.parentNode;c&&c.replaceChild(a,b)}function Xh(a){a&&a.parentNode&&a.parentNode.removeChild(a)};function Yh(a){Jd.call(this);this.element=a.element?a.element:null;this.S=this.tu=null;this.Pi=[];this.Ca=a.Ca?a.Ca:md;a.target&&this.Dh(a.target)}E(Yh,Jd);Yh.prototype.ab=function(){Xh(this.element);Jd.prototype.ab.call(this)};Yh.prototype.g=function(){return this.S};
Yh.prototype.cb=function(a){this.S&&Xh(this.element);for(var b=0,c=this.Pi.length;b<c;++b)ud(this.Pi[b]);this.Pi.length=0;if(this.S=a)(this.tu?this.tu:a.qm).appendChild(this.element),this.Ca!==md&&this.Pi.push(J(a,"postrender",this.Ca,this)),a.Ca()};Yh.prototype.Dh=function(a){this.tu="string"===typeof a?document.getElementById(a):a};function Zh(a){a=a?a:{};this.Fq=document.createElement("UL");this.gm=document.createElement("LI");this.Fq.appendChild(this.gm);this.gm.style.display="none";this.Dd=void 0!==a.collapsed?a.collapsed:!0;this.ig=void 0!==a.Ar?a.Ar:!0;this.ig||(this.Dd=!1);var b=void 0!==a.className?a.className:"ol-attribution",c=void 0!==a.Og?a.Og:"Attributions",d=void 0!==a.zr?a.zr:"\u00bb";"string"===typeof d?(this.Xe=document.createElement("span"),this.Xe.textContent=d):this.Xe=d;d=void 0!==a.label?a.label:"i";"string"===
typeof d?(this.ic=document.createElement("span"),this.ic.textContent=d):this.ic=d;var e=this.ig&&!this.Dd?this.Xe:this.ic,d=document.createElement("button");d.setAttribute("type","button");d.title=c;d.appendChild(e);J(d,"click",this.ye,this);c=document.createElement("div");c.className=b+" ol-unselectable ol-control"+(this.Dd&&this.ig?" ol-collapsed":"")+(this.ig?"":" ol-uncollapsible");c.appendChild(this.Fq);c.appendChild(d);Yh.call(this,{element:c,Ca:a.Ca?a.Ca:$h,target:a.target});this.tc=!0;this.fi=
{};this.Wg={};this.CG={}}E(Zh,Yh);function $h(a){this.Jq(a.af)}
Zh.prototype.Jq=function(a){if(a){var b,c,d,e,f,g,h,k,m,p,t,v=a.$j,w=pd({},a.jb),x={},y={},F=a.hb.la;c=0;for(b=v.length;c<b;c++)if(g=v[c].layer.v())if(p=I(g).toString(),m=g.wf)for(d=0,e=m.length;d<e;d++)if(h=m[d],k=I(h).toString(),!(k in w)){if(f=a.Lq[p]){var H=g.tg(F);a:{t=h;var B=F;if(t.uq){var R,N,P,K=void 0;for(K in f)if(K in t.uq){P=f[K];var G;R=0;for(N=t.uq[K].length;R<N;++R){G=t.uq[K][R];if(ai(G,P)){t=!0;break a}var ba=bi(H,ci(B),parseInt(K,10)),Sa=ba.hc();if(P.Ga<ba.Ga||P.Ba>ba.Ba)if(ai(G,
new di(mf(P.Ga,Sa),mf(P.Ba,Sa),P.Ha,P.Oa))||P.hc()>Sa&&ai(G,ba)){t=!0;break a}}}t=!1}else t=!0}}else t=!1;t?(k in x&&delete x[k],t=h.Is,t in y||(y[t]=!0,w[k]=h)):x[k]=h}b=[w,x];c=b[0];b=b[1];for(var Z in this.fi)Z in c?(this.Wg[Z]||(this.fi[Z].style.display="",this.Wg[Z]=!0),delete c[Z]):Z in b?(this.Wg[Z]&&(this.fi[Z].style.display="none",delete this.Wg[Z]),delete b[Z]):(Xh(this.fi[Z]),delete this.fi[Z],delete this.Wg[Z]);for(Z in c)d=document.createElement("LI"),d.innerHTML=c[Z].Is,this.Fq.appendChild(d),
this.fi[Z]=d,this.Wg[Z]=!0;for(Z in b)d=document.createElement("LI"),d.innerHTML=b[Z].Is,d.style.display="none",this.Fq.appendChild(d),this.fi[Z]=d;Z=!sd(this.Wg)||!sd(a.dk);this.tc!=Z&&(this.element.style.display=Z?"":"none",this.tc=Z);Z&&sd(this.Wg)?this.element.classList.add("ol-logo-only"):this.element.classList.remove("ol-logo-only");var ga;a=a.dk;Z=this.CG;for(ga in Z)ga in a||(Xh(Z[ga]),delete Z[ga]);for(var wa in a)b=a[wa],b instanceof HTMLElement&&(this.gm.appendChild(b),Z[wa]=b),wa in Z||
(ga=new Image,ga.src=wa,""===b?c=ga:(c=document.createElement("a"),c.href=b,c.appendChild(ga)),this.gm.appendChild(c),Z[wa]=c);this.gm.style.display=sd(a)?"none":""}else this.tc&&(this.element.style.display="none",this.tc=!1)};Zh.prototype.ye=function(a){a.preventDefault();this.Bs()};Zh.prototype.Bs=function(){this.element.classList.toggle("ol-collapsed");this.Dd?Wh(this.Xe,this.ic):Wh(this.ic,this.Xe);this.Dd=!this.Dd};function ei(a){a=a?a:{};var b=void 0!==a.className?a.className:"ol-rotate",c=void 0!==a.label?a.label:"\u21e7";this.ic=null;"string"===typeof c?(this.ic=document.createElement("span"),this.ic.className="ol-compass",this.ic.textContent=c):(this.ic=c,this.ic.classList.add("ol-compass"));var d=a.Og?a.Og:"Reset rotation",c=document.createElement("button");c.className=b+"-reset";c.setAttribute("type","button");c.title=d;c.appendChild(this.ic);J(c,"click",ei.prototype.ye,this);d=document.createElement("div");
d.className=b+" ol-unselectable ol-control";d.appendChild(c);b=a.Ca?a.Ca:fi;this.pw=a.FI?a.FI:void 0;Yh.call(this,{element:d,Ca:b,target:a.target});this.Jb=void 0!==a.duration?a.duration:250;this.hw=void 0!==a.gw?a.gw:!0;this.Fc=void 0;this.hw&&this.element.classList.add("ol-hidden")}E(ei,Yh);ei.prototype.ye=function(a){a.preventDefault();void 0!==this.pw?this.pw():(a=D(this.g()))&&void 0!==a.Gb()&&(0<this.Jb?a.animate({rotation:0,duration:this.Jb,Jc:Ef}):a.Lm(0))};
function fi(a){if(a=a.af){a=a.hb.rotation;if(a!=this.Fc){var b="rotate("+a+"rad)";if(this.hw){var c=this.element.classList.contains("ol-hidden");c||0!==a?c&&0!==a&&this.element.classList.remove("ol-hidden"):this.element.classList.add("ol-hidden")}this.ic.style.msTransform=b;this.ic.style.webkitTransform=b;this.ic.style.transform=b}this.Fc=a}};function gi(a){a=a?a:{};var b=void 0!==a.className?a.className:"ol-zoom",c=void 0!==a.li?a.li:1,d=void 0!==a.kL?a.kL:"+",e=void 0!==a.mL?a.mL:"\u2212",f=void 0!==a.lL?a.lL:"Zoom in",g=void 0!==a.nL?a.nL:"Zoom out",h=document.createElement("button");h.className=b+"-in";h.setAttribute("type","button");h.title=f;h.appendChild("string"===typeof d?document.createTextNode(d):d);J(h,"click",gi.prototype.ye.bind(this,c));d=document.createElement("button");d.className=b+"-out";d.setAttribute("type","button");
d.title=g;d.appendChild("string"===typeof e?document.createTextNode(e):e);J(d,"click",gi.prototype.ye.bind(this,-c));c=document.createElement("div");c.className=b+" ol-unselectable ol-control";c.appendChild(h);c.appendChild(d);Yh.call(this,{element:c,target:a.target});this.Jb=void 0!==a.duration?a.duration:250}E(gi,Yh);gi.prototype.ye=function(a,b){b.preventDefault();if(b=D(this.g())){var c=b.xa();c&&(a=b.Ib(c,a),0<this.Jb?(0<Kh(b)[0]&&Jh(b),b.animate({ra:a,duration:this.Jb,Jc:Ef})):Uh(b,a))}};function hi(a,b,c){this.bD=a;this.Ky=b;this.iD=c;this.Ab=[];this.Yo=this.Ve=0}function ii(a){a.Ab.length=0;a.Ve=0;a.Yo=0}hi.prototype.update=function(a,b){this.Ab.push(a,b,Date.now())};
hi.prototype.end=function(){if(6>this.Ab.length)return!1;var a=Date.now()-this.iD,b=this.Ab.length-3;if(this.Ab[b+2]<a)return!1;for(var c=b-3;0<c&&this.Ab[c+2]>a;)c-=3;var a=this.Ab[b+2]-this.Ab[c+2],d=this.Ab[b]-this.Ab[c],b=this.Ab[b+1]-this.Ab[c+1];this.Ve=Math.atan2(b,d);this.Yo=Math.sqrt(d*d+b*b)/a;return this.Yo>this.Ky};function ji(a){Jd.call(this);this.S=null;this.setActive(!0);this.handleEvent=a.handleEvent}E(ji,Jd);ji.prototype.g=function(){return this.S};ji.prototype.setActive=function(a){this.set("active",a)};ji.prototype.cb=function(a){this.S=a};function ki(a,b,c,d){if(void 0!==b){var e=a.Gb(),f=a.La();void 0!==e&&f&&0<d?a.animate({rotation:b,anchor:c,duration:d,Jc:Ef}):a.rotate(b,c)}}
function li(a,b,c,d){var e=a.xa();b=a.Ib(e,b,0);if(c&&void 0!==b&&b!==e){var f=a.La();c=Lh(a,b,c);c=a.Zg.Ka(c);c=[(b*f[0]-e*c[0])/(b-e),(b*f[1]-e*c[1])/(b-e)]}mi(a,b,c,d)}function mi(a,b,c,d){if(b){var e=a.xa(),f=a.La();void 0!==e&&f&&b!==e&&d?a.animate({ra:b,anchor:c,duration:d,Jc:Ef}):(c&&(c=Lh(a,b,c),a.ub(c)),Uh(a,b))}};function ni(a){a=a?a:{};this.Bf=a.li?a.li:1;ji.call(this,{handleEvent:oi});this.Jb=void 0!==a.duration?a.duration:250}E(ni,ji);function oi(a){var b=!1,c=a.originalEvent;if("dblclick"==a.type){var b=a.Qb,c=c.shiftKey?-this.Bf:this.Bf,d=D(a.map);li(d,c,b,this.Jb);a.preventDefault();b=!0}return!b};function pi(a){a=a.originalEvent;return a.altKey&&!(a.metaKey||a.ctrlKey)&&a.shiftKey}function qi(a){return"click"==a.type}function ri(a){a=a.originalEvent;return 0==a.button&&!(ge&&he&&a.ctrlKey)}function si(a){return"pointermove"==a.type}function ti(a){return"singleclick"==a.type}function ui(a){a=a.originalEvent;return!a.altKey&&!(a.metaKey||a.ctrlKey)&&!a.shiftKey}function vi(a){a=a.originalEvent;return!a.altKey&&!(a.metaKey||a.ctrlKey)&&a.shiftKey}
function wi(a){a=a.originalEvent.target.tagName;return"INPUT"!==a&&"SELECT"!==a&&"TEXTAREA"!==a}function xi(a){af(a.Kp,56);return"mouse"==a.Kp.pointerType}function yi(a){a=a.Kp;return a.isPrimary&&0===a.button};function zi(a){a=a?a:{};ji.call(this,{handleEvent:a.handleEvent?a.handleEvent:Ai});this.jF=a.ug?a.ug:gg;this.kF=a.hh?a.hh:md;this.FF=a.Gx?a.Gx:md;this.RF=a.vg?a.vg:gg;this.Gi=!1;this.$m={};this.jd=[]}E(zi,ji);function Bi(a){for(var b=a.length,c=0,d=0,e=0;e<b;e++)c+=a[e].clientX,d+=a[e].clientY;return[c/b,d/b]}
function Ai(a){if(!(a instanceof Zd))return!0;var b=!1,c=a.type;if("pointerdown"===c||"pointerdrag"===c||"pointerup"===c)c=a.Kp,"pointerup"==a.type?delete this.$m[c.pointerId]:"pointerdown"==a.type?this.$m[c.pointerId]=c:c.pointerId in this.$m&&(this.$m[c.pointerId]=c),this.jd=rd(this.$m);this.Gi?"pointerdrag"==a.type?this.kF(a):"pointerup"==a.type&&(this.Gi=this.RF(a)&&0<this.jd.length):"pointerdown"==a.type?(this.Gi=a=this.jF(a),b=this.Fk(a)):"pointermove"==a.type&&this.FF(a);return!b}
zi.prototype.Fk=function(a){return a};function Ci(a){zi.call(this,{ug:Di,hh:Ei,vg:Fi});a=a?a:{};this.Ae=a.hG;this.Zj=null;this.ld=a.Vb?a.Vb:ui;this.Oy=!1}E(Ci,zi);function Ei(a){var b=this.jd,c=Bi(b);if(b.length==this.kG){if(this.Ae&&this.Ae.update(c[0],c[1]),this.Zj){var d=this.Zj[0]-c[0],e=c[1]-this.Zj[1];a=D(a.map);var f=a.gb(),e=d=[d,e],g=f.ra;e[0]*=g;e[1]*=g;Bf(d,f.rotation);yf(d,f.Ka);d=a.Zg.Ka(d);a.ub(d)}}else this.Ae&&ii(this.Ae);this.Zj=c;this.kG=b.length}
function Fi(a){var b=a.map;a=D(b);if(0===this.jd.length){if(!this.Oy&&this.Ae&&this.Ae.end()){var c;c=this.Ae;c=(c.Ky-c.Yo)/c.bD;var d=this.Ae.Ve,e=a.La(),e=Gi(b,e),b=b.Gd([e[0]-c*Math.cos(d),e[1]-c*Math.sin(d)]);a.animate({Ka:a.Zg.Ka(b),duration:500,Jc:Ef})}Ih(a,1,-1);return!1}this.Ae&&ii(this.Ae);this.Zj=null;return!0}
function Di(a){if(0<this.jd.length&&this.ld(a)){var b=D(a.map);this.Zj=null;this.Gi||Ih(b,1,1);Kh(b)[0]&&b.ub(a.af.hb.Ka);this.Ae&&ii(this.Ae);this.Oy=1<this.jd.length;return!0}return!1}Ci.prototype.Fk=gg;function Hi(a){a=a?a:{};zi.call(this,{ug:Ii,hh:Ji,vg:Ki});this.ld=a.Vb?a.Vb:pi;this.zg=void 0;this.Jb=void 0!==a.duration?a.duration:250}E(Hi,zi);function Ji(a){if(xi(a)){var b=a.map,c=b.Ta();a=a.Yc;c=Math.atan2(c[1]/2-a[1],a[0]-c[0]/2);if(void 0!==this.zg){a=c-this.zg;var b=D(b),d=b.Gb();ki(b,d-a)}this.zg=c}}function Ki(a){if(!xi(a))return!0;a=D(a.map);Ih(a,1,-1);var b=a.Gb(),c=this.Jb,b=a.Sn(b,0);ki(a,b,void 0,c);return!1}
function Ii(a){return xi(a)&&ri(a)&&this.ld(a)?(Ih(D(a.map),1,1),this.zg=void 0,!0):!1}Hi.prototype.Fk=gg;function Li(a){this.wi=null;this.xb=document.createElement("div");this.xb.style.position="absolute";this.xb.className="ol-box "+a;this.io=this.Wf=this.S=null}E(Li,Cd);Li.prototype.ab=function(){this.cb(null)};Li.prototype.Bm=function(){var a=this.Wf,b=this.io,c=this.xb.style;c.left=Math.min(a[0],b[0])+"px";c.top=Math.min(a[1],b[1])+"px";c.width=Math.abs(b[0]-a[0])+"px";c.height=Math.abs(b[1]-a[1])+"px"};
Li.prototype.cb=function(a){if(this.S){this.S.rm.removeChild(this.xb);var b=this.xb.style;b.left=b.top=b.width=b.height="inherit"}(this.S=a)&&this.S.rm.appendChild(this.xb)};function Mi(a){var b=a.Wf,c=a.io,b=[b,[b[0],c[1]],c,[c[0],b[1]]].map(a.S.Gd,a.S);b[4]=b[0].slice();a.wi?a.wi.Bb([b]):a.wi=new zh([b])}Li.prototype.j=function(){return this.wi};function Ni(a){zi.call(this,{ug:Oi,hh:Pi,vg:Qi});a=a?a:{};this.fl=new Li(a.className||"ol-dragbox");this.WG=void 0!==a.VG?a.VG:64;this.Wf=null;this.ld=a.Vb?a.Vb:fg;this.GC=a.FC?a.FC:Ri}E(Ni,zi);function Ri(a,b,c){a=c[0]-b[0];b=c[1]-b[1];return a*a+b*b>=this.WG}function Pi(a){if(xi(a)){var b=this.fl,c=a.Yc;b.Wf=this.Wf;b.io=c;Mi(b);b.Bm();this.dispatchEvent(new Si(Ti,a.Qb))}}Ni.prototype.j=function(){return this.fl.j()};Ni.prototype.az=md;
function Qi(a){if(!xi(a))return!0;this.fl.cb(null);this.GC(a,this.Wf,a.Yc)&&(this.az(a),this.dispatchEvent(new Si(Ui,a.Qb)));return!1}function Oi(a){if(xi(a)&&ri(a)&&this.ld(a)){this.Wf=a.Yc;this.fl.cb(a.map);var b=this.fl,c=this.Wf;b.Wf=this.Wf;b.io=c;Mi(b);b.Bm();this.dispatchEvent(new Si(Vi,a.Qb));return!0}return!1}var Vi="boxstart",Ti="boxdrag",Ui="boxend";function Si(a,b){Dd.call(this,a);this.Qb=b}E(Si,Dd);function Wi(a){a=a?a:{};var b=a.Vb?a.Vb:vi;this.Jb=void 0!==a.duration?a.duration:200;this.CH=void 0!==a.Eg?a.Eg:!1;Ni.call(this,{Vb:b,className:a.className||"ol-dragzoom"})}E(Wi,Ni);Wi.prototype.az=function(){var a=this.g(),b=D(a),c=a.Ta(),d=this.j().W();if(this.CH){var e=Oh(b,c),d=[Gi(a,[d[0],d[1]]),Gi(a,[d[2],d[3]])],a=Qf(void 0),f,g;f=0;for(g=d.length;f<g;++f)Jf(a,d[f]);dg(e,1/Qh(a,c));d=e}c=b.Ib(Qh(d,c));e=Zf(d);e=b.Zg.Ka(e);b.animate({ra:c,Ka:e,duration:this.Jb,Jc:Ef})};function Xi(a){ji.call(this,{handleEvent:Yi});a=a||{};this.eD=function(a){return ui(a)&&wi(a)};this.ld=void 0!==a.Vb?a.Vb:this.eD;this.Jb=void 0!==a.duration?a.duration:100;this.NH=void 0!==a.MH?a.MH:128}E(Xi,ji);
function Yi(a){var b=!1;if("keydown"==a.type){var c=a.originalEvent.keyCode;if(this.ld(a)&&(40==c||37==c||39==c||38==c)){var b=D(a.map),d=b.xa()*this.NH,e=0,f=0;40==c?f=-d:37==c?e=-d:39==c?e=d:f=d;d=[e,f];Bf(d,b.Gb());c=this.Jb;if(e=b.La())d=b.Zg.Ka([e[0]+d[0],e[1]+d[1]]),c?b.animate({duration:c,Jc:Gf,Ka:d}):b.ub(d);a.preventDefault();b=!0}}return!b};function Zi(a){ji.call(this,{handleEvent:$i});a=a?a:{};this.ld=a.Vb?a.Vb:wi;this.Bf=a.li?a.li:1;this.Jb=void 0!==a.duration?a.duration:100}E(Zi,ji);function $i(a){var b=!1;if("keydown"==a.type||"keypress"==a.type){var c=a.originalEvent.charCode;!this.ld(a)||43!=c&&45!=c||(b=43==c?this.Bf:-this.Bf,c=D(a.map),li(c,b,void 0,this.Jb),a.preventDefault(),b=!0)}return!b};function aj(a){ji.call(this,{handleEvent:bj});a=a||{};this.Bf=0;this.Jb=void 0!==a.duration?a.duration:250;this.Au=void 0!==a.timeout?a.timeout:80;this.QK=void 0!==a.PK?a.PK:!0;this.Er=a.Ib||!1;this.oh=null;this.dc=this.zu=this.Kk=void 0;this.UA=400;this.Cq=void 0;this.uK=300;this.VA=1.5}E(aj,ji);
function bj(a){var b=a.type;if("wheel"!==b&&"mousewheel"!==b)return!0;a.preventDefault();var b=a.map,c=a.originalEvent;this.QK&&(this.oh=a.Qb);var d;"wheel"==a.type?(d=c.deltaY,ee&&c.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(d/=ie),c.deltaMode===WheelEvent.DOM_DELTA_LINE&&(d*=40)):"mousewheel"==a.type&&(d=-c.wheelDeltaY,fe&&(d/=3));if(0===d)return!1;a=Date.now();void 0===this.Kk&&(this.Kk=a);if(!this.dc||a-this.Kk>this.UA)this.dc=4>Math.abs(d)?cj:dj;if(this.dc===cj){b=D(b);this.Cq?clearTimeout(this.Cq):
Ih(b,1,1);this.Cq=setTimeout(this.dD.bind(this),this.UA);var c=b.xa()*Math.pow(2,d/this.uK),e=b.Nl(),f=b.Ml(),g=0;c<e?(c=Math.max(c,e/this.VA),g=1):c>f&&(c=Math.min(c,f*this.VA),g=-1);if(this.oh){var h=Lh(b,c,this.oh);b.ub(b.Zg.Ka(h))}Uh(b,c);0===g&&this.Er&&b.animate({ra:b.Ib(c,0<d?-1:1),Jc:Ef,anchor:this.oh,duration:this.Jb});0<g?b.animate({ra:e,Jc:Ef,anchor:this.oh,duration:500}):0>g&&b.animate({ra:f,Jc:Ef,anchor:this.oh,duration:500});this.Kk=a;return!1}this.Bf+=d;d=Math.max(this.Au-(a-this.Kk),
0);clearTimeout(this.zu);this.zu=setTimeout(this.TF.bind(this,b),d);return!1}aj.prototype.dD=function(){this.Cq=void 0;Ih(D(this.g()),1,-1)};aj.prototype.TF=function(a){a=D(a);0<Kh(a)[0]&&Jh(a);li(a,-gf(this.Bf,-1,1),this.oh,this.Jb);this.dc=void 0;this.Bf=0;this.oh=null;this.zu=this.Kk=void 0};var cj="trackpad",dj="wheel";function ej(a){zi.call(this,{ug:fj,hh:gj,vg:hj});a=a||{};this.Hc=null;this.zg=void 0;this.Im=!1;this.aq=0;this.YJ=void 0!==a.threshold?a.threshold:.3;this.Jb=void 0!==a.duration?a.duration:250}E(ej,zi);
function gj(a){var b=0,c=this.jd[0],d=this.jd[1],c=Math.atan2(d.clientY-c.clientY,d.clientX-c.clientX);void 0!==this.zg&&(b=c-this.zg,this.aq+=b,!this.Im&&Math.abs(this.aq)>this.YJ&&(this.Im=!0));this.zg=c;a=a.map;c=a.ac.getBoundingClientRect();d=Bi(this.jd);d[0]-=c.left;d[1]-=c.top;this.Hc=a.Gd(d);this.Im&&(c=D(a),d=c.Gb(),a.Ca(),ki(c,d+b,this.Hc))}function hj(a){if(2>this.jd.length){a=D(a.map);Ih(a,1,-1);if(this.Im){var b=a.Gb(),c=this.Hc,d=this.Jb,b=a.Sn(b,0);ki(a,b,c,d)}return!1}return!0}
function fj(a){return 2<=this.jd.length?(a=a.map,this.Hc=null,this.zg=void 0,this.Im=!1,this.aq=0,this.Gi||Ih(D(a),1,1),!0):!1}ej.prototype.Fk=gg;function ij(a){zi.call(this,{ug:jj,hh:kj,vg:lj});a=a?a:{};this.Er=a.Ib||!1;this.Hc=null;this.Jb=void 0!==a.duration?a.duration:400;this.cp=void 0;this.Ws=1}E(ij,zi);
function kj(a){var b=1,c=this.jd[0],d=this.jd[1],e=c.clientX-d.clientX,c=c.clientY-d.clientY,e=Math.sqrt(e*e+c*c);void 0!==this.cp&&(b=this.cp/e);this.cp=e;a=a.map;var e=D(a),d=e.xa(),f=e.Ml(),g=e.Nl(),c=d*b;c>f?(b=f/d,c=f):c<g&&(b=g/d,c=g);1!=b&&(this.Ws=b);b=a.ac.getBoundingClientRect();d=Bi(this.jd);d[0]-=b.left;d[1]-=b.top;this.Hc=a.Gd(d);a.Ca();mi(e,c,this.Hc)}
function lj(a){if(2>this.jd.length){a=D(a.map);Ih(a,1,-1);var b=a.xa();if(this.Er||b<a.Nl()||b>a.Ml()){var c=this.Hc,d=this.Jb,b=a.Ib(b,0,this.Ws-1);mi(a,b,c,d)}return!1}return!0}function jj(a){return 2<=this.jd.length?(a=a.map,this.Hc=null,this.cp=void 0,this.Ws=1,this.Gi||Ih(D(a),1,1),!0):!1}ij.prototype.Fk=gg;function mj(){var a={},b=new Pd,c=new hi(-.005,.05,100);(void 0!==a.$B?a.$B:1)&&b.push(new Hi);(void 0!==a.CD?a.CD:1)&&b.push(new ni({li:a.iL,duration:a.Sq}));(void 0!==a.DD?a.DD:1)&&b.push(new Ci({hG:c}));(void 0!==a.KH?a.KH:1)&&b.push(new ej);(void 0!==a.LH?a.LH:1)&&b.push(new ij({Ib:a.Ib,duration:a.Sq}));if(void 0!==a.keyboard?a.keyboard:1)b.push(new Xi),b.push(new Zi({li:a.iL,duration:a.Sq}));(void 0!==a.ZG?a.ZG:1)&&b.push(new aj({Ib:a.Ib,duration:a.Sq}));(void 0!==a.sJ?a.sJ:1)&&b.push(new Wi({duration:a.Sq}));
return b};function nj(a){Jd.call(this);var b=pd({},a);b.opacity=void 0!==a.opacity?a.opacity:1;b.visible=void 0!==a.visible?a.visible:!0;b.zIndex=void 0!==a.zIndex?a.zIndex:0;b.maxResolution=void 0!==a.ef?a.ef:Infinity;b.minResolution=void 0!==a.Be?a.Be:0;Kd(this,b);this.T={layer:this,pp:!0}}E(nj,Jd);function oj(a){a.T.opacity=gf(a.rg(),0,1);a.T.tA=a.ss();a.T.visible=a.getVisible();a.T.Z=a.W();a.T.zIndex=a.Vc();a.T.ef=a.Ml();a.T.Be=Math.max(a.Nl(),0);return a.T}l=nj.prototype;l.W=function(){return this.get("extent")};
l.Ml=function(){return this.get("maxResolution")};l.Nl=function(){return this.get("minResolution")};l.rg=function(){return this.get("opacity")};l.getVisible=function(){return this.get("visible")};l.Vc=function(){return this.get("zIndex")};l.fq=function(a){this.set("extent",a)};l.Dk=function(a){this.set("opacity",a)};l.setVisible=function(a){this.set("visible",a)};l.nA=function(a){this.set("zIndex",a)};function pj(a){var b=a||{};a=pd({},b);delete a.rb;b=b.rb;nj.call(this,a);this.$s=[];this.Qi={};J(this,Md(qj),this.yF,this);b?Array.isArray(b)?b=new Pd(b.slice(),{unique:!0}):af(b instanceof Pd,43):b=new Pd(void 0,{unique:!0});this.set(qj,b)}E(pj,nj);l=pj.prototype;l.Wn=function(){};l.Ko=function(){this.getVisible()&&this.G()};
l.yF=function(){this.$s.forEach(ud);this.$s.length=0;var a=this.getLayers();this.$s.push(J(a,"add",this.xF,this),J(a,"remove",this.zF,this));for(var b in this.Qi)this.Qi[b].forEach(ud);qd(this.Qi);var a=a.R(),c,d;b=0;for(c=a.length;b<c;b++)d=a[b],this.Qi[I(d).toString()]=[J(d,"propertychange",this.Ko,this),J(d,"change",this.Ko,this)];this.G()};l.xF=function(a){a=a.element;var b=I(a).toString();this.Qi[b]=[J(a,"propertychange",this.Ko,this),J(a,"change",this.Ko,this)];this.G()};
l.zF=function(a){a=I(a.element).toString();this.Qi[a].forEach(ud);delete this.Qi[a];this.G()};l.getLayers=function(){return this.get(qj)};l.ks=function(a){var b=void 0!==a?a:[],c=b.length;this.getLayers().forEach(function(a){a.ks(b)});a=oj(this);var d,e;for(d=b.length;c<d;c++)e=b[c],e.opacity*=a.opacity,e.visible=e.visible&&a.visible,e.ef=Math.min(e.ef,a.ef),e.Be=Math.max(e.Be,a.Be),void 0!==a.Z&&(e.Z=void 0!==e.Z?ag(e.Z,a.Z):a.Z);return b};l.ss=function(){return"ready"};var qj="layers";function rj(a){var b=pd({},a);delete b.source;nj.call(this,b);this.oq=this.sp=this.rp=null;a.map&&this.cb(a.map);J(this,Md("source"),this.MF,this);this.set("source",a.source?a.source:null)}E(rj,nj);function sj(a,b){return a.visible&&b>=a.Be&&b<a.ef}l=rj.prototype;l.ks=function(a){a=a?a:[];a.push(oj(this));return a};l.v=function(){return this.get("source")||null};l.ss=function(){var a=this.v();return a?a.gb():"undefined"};l.As=function(){this.G()};
l.MF=function(){this.oq&&(ud(this.oq),this.oq=null);var a=this.v();a&&(this.oq=J(a,"change",this.As,this));this.G()};l.cb=function(a){this.rp&&(ud(this.rp),this.rp=null);a||this.G();this.sp&&(ud(this.sp),this.sp=null);a&&(this.rp=J(a,"precompose",function(a){var b=oj(this);b.pp=!1;b.zIndex=Infinity;a.af.$j.push(b);a.af.ip[I(this)]=b},this),this.sp=J(this,"change",a.Ca,a),this.G())};var tj=/^#(?:[0-9a-f]{3}){1,2}$/i,uj=/^([a-z]*)$/i;function vj(a){return Array.isArray(a)?a:wj(a)}function xj(a){if("string"!==typeof a){var b=a[0];b!=(b|0)&&(b=b+.5|0);var c=a[1];c!=(c|0)&&(c=c+.5|0);var d=a[2];d!=(d|0)&&(d=d+.5|0);a="rgba("+b+","+c+","+d+","+(void 0===a[3]?1:a[3])+")"}return a}
var wj=function(){var a={},b=0;return function(c){var d;if(a.hasOwnProperty(c))d=a[c];else{if(1024<=b){d=0;for(var e in a)0===(d++&3)&&(delete a[e],--b)}d=c;var f;uj.exec(d)&&(e=document.createElement("div"),e.style.color=d,document.body.appendChild(e),d=getComputedStyle(e).color,document.body.removeChild(e));if(tj.exec(d)){f=d.length-1;af(3==f||6==f,54);var g=3==f?1:2;f=parseInt(d.substr(1+0*g,g),16);e=parseInt(d.substr(1+1*g,g),16);d=parseInt(d.substr(1+2*g,g),16);1==g&&(f=(f<<4)+f,e=(e<<4)+e,d=
(d<<4)+d);f=[f,e,d,1]}else 0==d.indexOf("rgba(")?(d=d.slice(5,-1).split(",").map(Number),f=yj(d)):0==d.indexOf("rgb(")?(d=d.slice(4,-1).split(",").map(Number),d.push(1),f=yj(d)):af(!1,14);d=f;a[c]=d;++b}return d}}();function yj(a){var b=[];b[0]=gf(a[0]+.5|0,0,255);b[1]=gf(a[1]+.5|0,0,255);b[2]=gf(a[2]+.5|0,0,255);b[3]=gf(a[3],0,1);return b};function zj(){this.gi={};this.Jn=0;this.OG=32}zj.prototype.clear=function(){this.gi={};this.Jn=0};zj.prototype.get=function(a,b,c){a=b+":"+a+":"+(c?xj(c):"null");return a in this.gi?this.gi[a]:null};zj.prototype.set=function(a,b,c,d){this.gi[b+":"+a+":"+(c?xj(c):"null")]=d;++this.Jn};var Aj=new zj;var Bj=Array(6);function Cj(){return[1,0,0,1,0,0]}function Dj(a){return Ej(a,1,0,0,1,0,0)}function Fj(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],k=b[0],m=b[1],p=b[2],t=b[3],v=b[4];b=b[5];a[0]=c*k+e*m;a[1]=d*k+f*m;a[2]=c*p+e*t;a[3]=d*p+f*t;a[4]=c*v+e*b+g;a[5]=d*v+f*b+h}function Ej(a,b,c,d,e,f,g){a[0]=b;a[1]=c;a[2]=d;a[3]=e;a[4]=f;a[5]=g;return a}function Gj(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a}
function Hj(a,b){var c=b[0],d=b[1];b[0]=a[0]*c+a[2]*d+a[4];b[1]=a[1]*c+a[3]*d+a[5];return b}function Ij(a,b){var c=Math.cos(b);b=Math.sin(b);Fj(a,Ej(Bj,c,b,-b,c,0,0))}function Jj(a,b,c){Fj(a,Ej(Bj,b,0,0,c,0,0))}function Kj(a,b,c){Fj(a,Ej(Bj,1,0,0,1,b,c))}function Lj(a,b,c,d,e,f,g,h){var k=Math.sin(f);f=Math.cos(f);a[0]=d*f;a[1]=e*k;a[2]=-d*k;a[3]=e*f;a[4]=g*d*f-h*d*k+b;a[5]=g*e*k+h*e*f+c;return a};function Mj(a,b){this.S=b;this.Kf={};this.Ys={}}E(Mj,Cd);function Nj(a){var b=a.hb,c=a.Dj,d=a.fz;Lj(c,a.size[0]/2,a.size[1]/2,1/b.ra,-1/b.ra,-b.rotation,-b.Ka[0],-b.Ka[1]);a=Gj(d,c);b=a[0]*a[3]-a[1]*a[2];af(0!==b,32);var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5];a[0]=f/b;a[1]=-d/b;a[2]=-e/b;a[3]=c/b;a[4]=(e*h-f*g)/b;a[5]=-(c*h-d*g)/b}l=Mj.prototype;l.ab=function(){for(var a in this.Kf)this.Kf[a].Yd()};
function Oj(){if(Aj.Jn>Aj.OG){var a=0,b,c;for(b in Aj.gi)c=Aj.gi[b],0!==(a++&3)||c.hasListener()||(delete Aj.gi[b],--Aj.Jn)}}
l.Lc=function(a,b,c,d,e,f,g){function h(a,c){var f=I(a).toString(),g=b.ip[I(c)].pp;if(!(f in b.Qm)||g)return d.call(e,a,g?c:null)}var k,m=b.hb,p=m.ra,t=m.la,m=a;if(t.ii){var t=t.W(),v=Xf(t),w=a[0];if(w<t[0]||w>t[2])m=[w+v*Math.ceil((t[0]-w)/v),a[1]]}t=b.$j;for(v=t.length-1;0<=v;--v){var x=t[v],w=x.layer;if(sj(x,p)&&f.call(g,w)&&(x=Pj(this,w),w.v()&&(k=x.Lc(w.v().Pq?m:a,b,c,h,e)),k))return k}};
function Pj(a,b){var c=I(b).toString();if(c in a.Kf)return a.Kf[c];b=b.Wn(a);a.Kf[c]=b;a.Ys[c]=J(b,"change",a.wF,a);return b}l.g=function(){return this.S};l.wF=function(){this.S.Ca()};l.Ut=md;l.xI=function(a,b){for(var c in this.Kf)if(!(b&&c in b.ip)){a=c;var d=this.Kf[a];delete this.Kf[a];ud(this.Ys[a]);delete this.Ys[a];d.Yd()}};function Qj(a,b){for(var c in a.Kf)if(!(c in b.ip)){b.Rf.push(a.xI.bind(a));break}}function Me(a,b){return a.zIndex-b.zIndex};function Rj(a,b,c,d){Dd.call(this,a);this.af=c;this.context=d}E(Rj,Dd);var Sj=[0,0,0,1],Tj=[],Uj=[0,0,0,1];function Vj(a,b,c,d){0!==b&&(a.translate(c,d),a.rotate(b),a.translate(-c,-d))};function Wj(a){return"string"===typeof a||a instanceof CanvasPattern||a instanceof CanvasGradient?a:xj(a)};function Xj(){}l=Xj.prototype;l.xd=function(){};l.zl=function(){};l.Qr=function(){};l.Rr=function(){};l.Sr=function(){};l.Tr=function(){};l.bh=function(){};l.Al=function(){};l.lg=function(){};l.Je=function(){};l.hq=function(){};l.Lg=function(){};function Yj(a,b){Mj.call(this,0,b);this.Af=Vh();this.ja=this.Af.canvas;this.ja.style.width="100%";this.ja.style.height="100%";this.ja.style.display="block";this.ja.className="ol-unselectable";a.insertBefore(this.ja,a.childNodes[0]||null);this.tc=!0;this.kd=Cj()}E(Yj,Mj);Yj.prototype.Ed=function(a,b){var c=this.g(),d=this.Af;c.hasListener(a)&&(this.Ei(b),c.dispatchEvent(new Rj(a,0,b,d)))};
Yj.prototype.Ei=function(a){var b=a.hb;a=a.rc/b.ra;return Lj(this.kd,this.ja.width/2,this.ja.height/2,a,-a,-b.rotation,-b.Ka[0],-b.Ka[1])};Yj.prototype.K=function(){return"canvas"};
Yj.prototype.Ut=function(a){if(a){var b=this.Af,c=a.rc,d=Math.round(a.size[0]*c),e=Math.round(a.size[1]*c);this.ja.width!=d||this.ja.height!=e?(this.ja.width=d,this.ja.height=e):b.clearRect(0,0,d,e);c=a.hb.rotation;Nj(a);this.Ed("precompose",a);var f=a.$j;Le(f);c&&(b.save(),Vj(b,c,d/2,e/2));var d=a.hb.ra,g,h,k,e=0;for(g=f.length;e<g;++e)k=f[e],h=k.layer,h=Pj(this,h),sj(k,d)&&"ready"==k.tA&&h.Yi(a,k)&&h.kl(a,k,b);c&&b.restore();this.Ed("postcompose",a);this.tc||(this.ja.style.display="",this.tc=!0);
Qj(this,a);a.Rf.push(Oj)}else this.tc&&(this.ja.style.display="none",this.tc=!1)};var Zj=["Polygon","Circle","LineString","Image","Text"];function ak(){};function bk(a){this.ob=a}bk.prototype.v=function(){return this.ob};function ck(a){this.ob=a}E(ck,bk);ck.prototype.K=function(){return 35632};function dk(a){this.ob=a}E(dk,bk);dk.prototype.K=function(){return 35633};function ek(){this.ob="precision mediump float;\nvarying vec2 v_center;\nvarying vec2 v_offset;\nvarying float v_halfWidth;\nvarying float v_pixelRatio;\n\n\n\nuniform float u_opacity;\nuniform vec4 u_fillColor;\nuniform vec4 u_strokeColor;\nuniform vec2 u_size;\n\nvoid main(void) {\n  vec2 windowCenter = vec2((v_center.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\n      (v_center.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\n  vec2 windowOffset = vec2((v_offset.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\n      (v_offset.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\n  float radius = length(windowCenter - windowOffset);\n  float dist = length(windowCenter - gl_FragCoord.xy);\n  if (dist > radius + v_halfWidth) {\n    if (u_strokeColor.a == 0.0) {\n      gl_FragColor = u_fillColor;\n    } else {\n      gl_FragColor = u_strokeColor;\n    }\n    gl_FragColor.a = gl_FragColor.a - (dist - (radius + v_halfWidth));\n  } else if (u_fillColor.a == 0.0) {\n    // Hooray, no fill, just stroke. We can use real antialiasing.\n    gl_FragColor = u_strokeColor;\n    if (dist < radius - v_halfWidth) {\n      gl_FragColor.a = gl_FragColor.a - (radius - v_halfWidth - dist);\n    }\n  } else {\n    gl_FragColor = u_fillColor;\n    float strokeDist = radius - v_halfWidth;\n    float antialias = 2.0 * v_pixelRatio;\n    if (dist > strokeDist) {\n      gl_FragColor = u_strokeColor;\n    } else if (dist >= strokeDist - antialias) {\n      float step = smoothstep(strokeDist - antialias, strokeDist, dist);\n      gl_FragColor = mix(u_fillColor, u_strokeColor, step);\n    }\n  }\n  gl_FragColor.a = gl_FragColor.a * u_opacity;\n  if (gl_FragColor.a <= 0.0) {\n    discard;\n  }\n}\n"}
E(ek,ck);var fk=new ek;
function gk(){this.ob="varying vec2 v_center;\nvarying vec2 v_offset;\nvarying float v_halfWidth;\nvarying float v_pixelRatio;\n\n\nattribute vec2 a_position;\nattribute float a_instruction;\nattribute float a_radius;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_lineWidth;\nuniform float u_pixelRatio;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  v_center = vec4(u_projectionMatrix * vec4(a_position, 0.0, 1.0)).xy;\n  v_pixelRatio = u_pixelRatio;\n  float lineWidth = u_lineWidth * u_pixelRatio;\n  v_halfWidth = lineWidth / 2.0;\n  if (lineWidth == 0.0) {\n    lineWidth = 2.0 * u_pixelRatio;\n  }\n  vec2 offset;\n  // Radius with anitaliasing (roughly).\n  float radius = a_radius + 3.0 * u_pixelRatio;\n  // Until we get gl_VertexID in WebGL, we store an instruction.\n  if (a_instruction == 0.0) {\n    // Offsetting the edges of the triangle by lineWidth / 2 is necessary, however\n    // we should also leave some space for the antialiasing, thus we offset by lineWidth.\n    offset = vec2(-1.0, 1.0);\n  } else if (a_instruction == 1.0) {\n    offset = vec2(-1.0, -1.0);\n  } else if (a_instruction == 2.0) {\n    offset = vec2(1.0, -1.0);\n  } else {\n    offset = vec2(1.0, 1.0);\n  }\n\n  gl_Position = u_projectionMatrix * vec4(a_position + offset * radius, 0.0, 1.0) +\n      offsetMatrix * vec4(offset * lineWidth, 0.0, 0.0);\n  v_offset = vec4(u_projectionMatrix * vec4(a_position.x + a_radius, a_position.y,\n      0.0, 1.0)).xy;\n\n  if (distance(v_center, v_offset) > 20000.0) {\n    gl_Position = vec4(v_center, 0.0, 1.0);\n  }\n}\n\n\n"}
E(gk,dk);var hk=new gk;
function ik(a,b){this.AK=a.getUniformLocation(b,"u_fillColor");this.Eu=a.getUniformLocation(b,"u_lineWidth");this.Dq=a.getUniformLocation(b,"u_offsetRotateMatrix");this.Eq=a.getUniformLocation(b,"u_offsetScaleMatrix");this.Rk=a.getUniformLocation(b,"u_opacity");this.Fu=a.getUniformLocation(b,"u_pixelRatio");this.Sk=a.getUniformLocation(b,"u_projectionMatrix");this.Gu=a.getUniformLocation(b,"u_size");this.CK=a.getUniformLocation(b,"u_strokeColor");this.br=a.getAttribLocation(b,"a_instruction");this.gc=
a.getAttribLocation(b,"a_position");this.hr=a.getAttribLocation(b,"a_radius")};function jk(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function kk(a,b){a[0]=b[0];a[1]=b[1];a[4]=b[2];a[5]=b[3];a[12]=b[4];a[13]=b[5];return a};function lk(a,b){this.TA=a;this.fk=b;this.origin=Zf(b);this.dI=Cj();this.yH=Cj();this.zH=Cj();this.Ok=jk();this.L=[];this.xg=null;this.ua=[];this.hd=[];this.ba=[];this.Sg=null;this.Id=void 0}E(lk,Xj);
lk.prototype.je=function(a,b,c,d,e,f,g,h,k,m,p){var t=a.Kb,v,w,x,y,F,H,B,R;this.Id&&(v=t.isEnabled(t.STENCIL_TEST),w=t.getParameter(t.STENCIL_FUNC),x=t.getParameter(t.STENCIL_VALUE_MASK),y=t.getParameter(t.STENCIL_REF),F=t.getParameter(t.STENCIL_WRITEMASK),H=t.getParameter(t.STENCIL_FAIL),B=t.getParameter(t.STENCIL_PASS_DEPTH_PASS),R=t.getParameter(t.STENCIL_PASS_DEPTH_FAIL),t.enable(t.STENCIL_TEST),t.clear(t.STENCIL_BUFFER_BIT),t.stencilMask(255),t.stencilFunc(t.ALWAYS,1,255),t.stencilOp(t.KEEP,
t.KEEP,t.REPLACE),this.Id.je(a,b,c,d,e,f,g,h,k,m,p),t.stencilMask(0),t.stencilFunc(t.NOTEQUAL,1,255));a.bindBuffer(34962,this.Sg);a.bindBuffer(34963,this.xg);f=this.iq(t,a,e,f);var N=Dj(this.dI);Jj(N,2/(c*e[0]),2/(c*e[1]));Ij(N,-d);Kj(N,-(b[0]-this.origin[0]),-(b[1]-this.origin[1]));b=Dj(this.zH);Jj(b,2/e[0],2/e[1]);e=Dj(this.yH);0!==d&&Ij(e,-d);t.uniformMatrix4fv(f.Sk,!1,kk(this.Ok,N));t.uniformMatrix4fv(f.Eq,!1,kk(this.Ok,b));t.uniformMatrix4fv(f.Dq,!1,kk(this.Ok,e));t.uniform1f(f.Rk,g);var P;void 0===
k?this.Bl(t,a,h,!1):(m?a=this.co(t,a,h,k,p):(t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.Bl(t,a,h,!0),a=(a=k(null))?a:void 0),P=a);this.lq(t,f);this.Id&&(v||t.disable(t.STENCIL_TEST),t.clear(t.STENCIL_BUFFER_BIT),t.stencilFunc(w,y,x),t.stencilMask(F),t.stencilOp(H,R,B));return P};lk.prototype.drawElements=function(a,b,c,d){a.drawElements(4,d-c,b.Oo?5125:5123,c*(b.Oo?4:2))};var mk=[0,0,0,1],nk=[],ok=[0,0,0,1];function pk(a,b,c,d,e,f){a=(c-a)*(f-b)-(e-a)*(d-b);return a<=qk&&a>=-qk?void 0:0<a}var qk=Number.EPSILON||2.220446049250313E-16;function rk(a,b){this.vC=void 0!==a?a:[];this.NK=void 0!==b?b:sk}rk.prototype.R=function(){return this.vC};var sk=35044;function tk(a,b){lk.call(this,a,b);this.Fb=null;this.Tb=[];this.vb=[];this.Ia=0;this.T={fillColor:null,strokeColor:null,bb:null,lineDashOffset:void 0,lineWidth:void 0,G:!1}}E(tk,lk);l=tk.prototype;
l.od=function(a,b,c,d){for(var e=this.ba.length,f=this.L.length,g=e/4;b<c;b+=d)this.ba[e++]=a[b],this.ba[e++]=a[b+1],this.ba[e++]=0,this.ba[e++]=this.Ia,this.ba[e++]=a[b],this.ba[e++]=a[b+1],this.ba[e++]=1,this.ba[e++]=this.Ia,this.ba[e++]=a[b],this.ba[e++]=a[b+1],this.ba[e++]=2,this.ba[e++]=this.Ia,this.ba[e++]=a[b],this.ba[e++]=a[b+1],this.ba[e++]=3,this.ba[e++]=this.Ia,this.L[f++]=g,this.L[f++]=g+1,this.L[f++]=g+2,this.L[f++]=g+2,this.L[f++]=g+3,this.L[f++]=g,g+=4};
l.zl=function(a,b){var c=a.bf(),d=a.P;c?(this.ua.push(this.L.length),this.hd.push(b),this.T.G&&(this.vb.push(this.L.length),this.T.G=!1),this.Ia=c,a=a.l,a=Wg(a,2,d,-this.origin[0],-this.origin[1]),this.od(a,0,2,d)):this.T.G&&(this.Tb.pop(),this.Tb.length&&(d=this.Tb[this.Tb.length-1],this.T.fillColor=d[0],this.T.strokeColor=d[1],this.T.lineWidth=d[2],this.T.G=!1))};
l.finish=function(){this.Sg=new rk(this.ba);this.xg=new rk(this.L);this.ua.push(this.L.length);0===this.vb.length&&0<this.Tb.length&&(this.Tb=[]);this.L=this.ba=null};l.og=function(a){var b=this.Sg,c=this.xg;return function(){a.deleteBuffer(b);a.deleteBuffer(c)}};
l.iq=function(a,b,c,d){var e=uk(b,fk,hk),f;this.Fb?f=this.Fb:this.Fb=f=new ik(a,e);b.useProgram(e);a.enableVertexAttribArray(f.gc);a.vertexAttribPointer(f.gc,2,5126,!1,16,0);a.enableVertexAttribArray(f.br);a.vertexAttribPointer(f.br,1,5126,!1,16,8);a.enableVertexAttribArray(f.hr);a.vertexAttribPointer(f.hr,1,5126,!1,16,12);a.uniform2fv(f.Gu,c);a.uniform1f(f.Fu,d);return f};l.lq=function(a,b){a.disableVertexAttribArray(b.gc);a.disableVertexAttribArray(b.br);a.disableVertexAttribArray(b.hr)};
l.Bl=function(a,b,c){if(sd(c)){var d,e,f;e=this.ua[this.ua.length-1];for(c=this.vb.length-1;0<=c;--c)d=this.vb[c],f=this.Tb[c],this.gj(a,f[0]),this.Vf(a,f[1],f[2]),this.drawElements(a,b,d,e),e=d}else this.ni(a,b,c)};
l.co=function(a,b,c,d,e){var f,g,h,k,m,p,t;t=this.ua.length-2;h=this.ua[t+1];for(f=this.vb.length-1;0<=f;--f)for(g=this.Tb[f],this.gj(a,g[0]),this.Vf(a,g[1],g[2]),k=this.vb[f];0<=t&&this.ua[t]>=k;){g=this.ua[t];m=this.hd[t];p=I(m).toString();if(void 0===c[p]&&m.j()&&(void 0===e||bg(e,m.j().W()))&&(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),this.drawElements(a,b,g,h),h=d(m)))return h;t--;h=g}};
l.ni=function(a,b,c){var d,e,f,g,h,k,m;k=this.ua.length-2;f=e=this.ua[k+1];for(d=this.vb.length-1;0<=d;--d){g=this.Tb[d];this.gj(a,g[0]);this.Vf(a,g[1],g[2]);for(g=this.vb[d];0<=k&&this.ua[k]>=g;)m=this.ua[k],h=this.hd[k],h=I(h).toString(),c[h]&&(e!==f&&this.drawElements(a,b,e,f),f=m),k--,e=m;e!==f&&this.drawElements(a,b,e,f);e=f=g}};l.gj=function(a,b){a.uniform4fv(this.Fb.AK,b)};l.Vf=function(a,b,c){a.uniform4fv(this.Fb.CK,b);a.uniform1f(this.Fb.Eu,c)};
l.Je=function(a,b){var c;b?(c=b.getLineDash(),this.T.bb=c?c:nk,c=b.rh,this.T.lineDashOffset=c?c:0,c=b.ma,c=c instanceof CanvasGradient||c instanceof CanvasPattern?ok:vj(c).map(function(a,b){return 3!=b?a/255:a})||ok,b=b.hc(),b=void 0!==b?b:1):(c=[0,0,0,0],b=0);a=a?a.ma:[0,0,0,0];a=a instanceof CanvasGradient||a instanceof CanvasPattern?mk:vj(a).map(function(a,b){return 3!=b?a/255:a})||mk;this.T.strokeColor&&Ke(this.T.strokeColor,c)&&this.T.fillColor&&Ke(this.T.fillColor,a)&&this.T.lineWidth===b||
(this.T.G=!0,this.T.fillColor=a,this.T.strokeColor=c,this.T.lineWidth=b,this.Tb.push([a,c,b]))};function vk(){this.ob="precision mediump float;\nvarying vec2 v_texCoord;\nvarying float v_opacity;\n\nuniform float u_opacity;\nuniform sampler2D u_image;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_image, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  float alpha = texColor.a * v_opacity * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n"}E(vk,ck);var wk=new vk;
function xk(){this.ob="varying vec2 v_texCoord;\nvarying float v_opacity;\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nattribute vec2 a_offsets;\nattribute float a_opacity;\nattribute float a_rotateWithView;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix;\n  if (a_rotateWithView == 1.0) {\n    offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  }\n  vec4 offsets = offsetMatrix * vec4(a_offsets, 0.0, 0.0);\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n  v_texCoord = a_texCoord;\n  v_opacity = a_opacity;\n}\n\n\n"}
E(xk,dk);var yk=new xk;function zk(a,b){this.Dq=a.getUniformLocation(b,"u_offsetRotateMatrix");this.Eq=a.getUniformLocation(b,"u_offsetScaleMatrix");this.Rk=a.getUniformLocation(b,"u_opacity");this.Sk=a.getUniformLocation(b,"u_projectionMatrix");this.er=a.getAttribLocation(b,"a_offsets");this.gr=a.getAttribLocation(b,"a_opacity");this.gc=a.getAttribLocation(b,"a_position");this.ir=a.getAttribLocation(b,"a_rotateWithView");this.dg=a.getAttribLocation(b,"a_texCoord")};function Ak(a,b){this.ja=a;this.Kb=b;this.Yg={};this.Ek={};this.rk={};this.Gs=this.Hs=this.Zl=this.Hr=null;(this.Oo=0<=ld.indexOf("OES_element_index_uint"))&&b.getExtension("OES_element_index_uint");J(this.ja,"webglcontextlost",this.Fi,this);J(this.ja,"webglcontextrestored",this.Cs,this)}E(Ak,Cd);l=Ak.prototype;
l.bindBuffer=function(a,b){var c=this.Kb,d=b.R(),e=String(I(b));if(e in this.Yg)c.bindBuffer(a,this.Yg[e].buffer);else{var f=c.createBuffer();c.bindBuffer(a,f);var g;34962==a?g=new Float32Array(d):34963==a&&(g=this.Oo?new Uint32Array(d):new Uint16Array(d));c.bufferData(a,g,b.NK);this.Yg[e]={KL:b,buffer:f}}};l.deleteBuffer=function(a){var b=this.Kb;a=String(I(a));var c=this.Yg[a];b.isContextLost()||b.deleteBuffer(c.buffer);delete this.Yg[a]};
l.ab=function(){Bd(this.ja);var a=this.Kb;if(!a.isContextLost()){for(var b in this.Yg)a.deleteBuffer(this.Yg[b].buffer);for(b in this.rk)a.deleteProgram(this.rk[b]);for(b in this.Ek)a.deleteShader(this.Ek[b]);a.deleteFramebuffer(this.Zl);a.deleteRenderbuffer(this.Gs);a.deleteTexture(this.Hs)}};
function Bk(a){if(!a.Zl){var b=a.Kb,c=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,c);var d=Ck(b,1,1),e=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,e);b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,1,1);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,d,0);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,e);b.bindTexture(b.TEXTURE_2D,null);b.bindRenderbuffer(b.RENDERBUFFER,null);b.bindFramebuffer(b.FRAMEBUFFER,null);a.Zl=
c;a.Hs=d;a.Gs=e}return a.Zl}function Dk(a,b){var c=String(I(b));if(c in a.Ek)return a.Ek[c];var d=a.Kb,e=d.createShader(b.K());d.shaderSource(e,b.v());d.compileShader(e);return a.Ek[c]=e}function uk(a,b,c){var d=I(b)+"/"+I(c);if(d in a.rk)return a.rk[d];var e=a.Kb,f=e.createProgram();e.attachShader(f,Dk(a,b));e.attachShader(f,Dk(a,c));e.linkProgram(f);return a.rk[d]=f}l.Fi=function(){qd(this.Yg);qd(this.Ek);qd(this.rk);this.Gs=this.Hs=this.Zl=this.Hr=null};l.Cs=function(){};
l.useProgram=function(a){if(a==this.Hr)return!1;this.Kb.useProgram(a);this.Hr=a;return!0};function Ek(a,b,c){var d=a.createTexture();a.bindTexture(a.TEXTURE_2D,d);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);void 0!==b&&a.texParameteri(3553,10242,b);void 0!==c&&a.texParameteri(3553,10243,c);return d}function Ck(a,b,c){var d=Ek(a,void 0,void 0);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null);return d}
function Fk(a,b){var c=Ek(a,33071,33071);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b);return c};function Gk(a,b){lk.call(this,a,b);this.vf=this.uf=void 0;this.xs=[];this.$l=[];this.Hf=void 0;this.Li=[];this.Ki=[];this.Os=this.Ms=void 0;this.Fb=null;this.gd=this.Fc=this.Pc=this.Pf=this.Of=this.ge=void 0;this.wu=[];this.am=[];this.Ud=void 0}E(Gk,lk);l=Gk.prototype;
l.og=function(a){var b=this.Sg,c=this.xg,d=this.wu,e=this.am,f=a.Kb;return function(){if(!f.isContextLost()){var g,h;g=0;for(h=d.length;g<h;++g)f.deleteTexture(d[g]);g=0;for(h=e.length;g<h;++g)f.deleteTexture(e[g])}a.deleteBuffer(b);a.deleteBuffer(c)}};
l.od=function(a,b,c,d){for(var e=this.uf,f=this.vf,g=this.Hf,h=this.Ms,k=this.Os,m=this.ge,p=this.Of,t=this.Pf,v=this.Pc?1:0,w=-this.Fc,x=this.gd,y=this.Ud,F=Math.cos(w),w=Math.sin(w),H=this.L.length,B=this.ba.length,R,N,P,K,G;b<c;b+=d)K=a[b]-this.origin[0],G=a[b+1]-this.origin[1],R=B/8,N=-x*e,P=-x*(g-f),this.ba[B++]=K,this.ba[B++]=G,this.ba[B++]=N*F-P*w,this.ba[B++]=N*w+P*F,this.ba[B++]=p/k,this.ba[B++]=(t+g)/h,this.ba[B++]=m,this.ba[B++]=v,N=x*(y-e),P=-x*(g-f),this.ba[B++]=K,this.ba[B++]=G,this.ba[B++]=
N*F-P*w,this.ba[B++]=N*w+P*F,this.ba[B++]=(p+y)/k,this.ba[B++]=(t+g)/h,this.ba[B++]=m,this.ba[B++]=v,N=x*(y-e),P=x*f,this.ba[B++]=K,this.ba[B++]=G,this.ba[B++]=N*F-P*w,this.ba[B++]=N*w+P*F,this.ba[B++]=(p+y)/k,this.ba[B++]=t/h,this.ba[B++]=m,this.ba[B++]=v,N=-x*e,P=x*f,this.ba[B++]=K,this.ba[B++]=G,this.ba[B++]=N*F-P*w,this.ba[B++]=N*w+P*F,this.ba[B++]=p/k,this.ba[B++]=t/h,this.ba[B++]=m,this.ba[B++]=v,this.L[H++]=R,this.L[H++]=R+1,this.L[H++]=R+2,this.L[H++]=R,this.L[H++]=R+2,this.L[H++]=R+3;return B};
l.Sr=function(a,b){this.ua.push(this.L.length);this.hd.push(b);b=a.l;this.od(b,0,b.length,a.P)};l.bh=function(a,b){this.ua.push(this.L.length);this.hd.push(b);b=a.l;this.od(b,0,b.length,a.P)};
l.finish=function(a){a=a.Kb;this.xs.push(this.L.length);this.$l.push(this.L.length);this.Sg=new rk(this.ba);this.xg=new rk(this.L);var b={};Hk(this.wu,this.Li,b,a);Hk(this.am,this.Ki,b,a);this.Hf=this.vf=this.uf=void 0;this.Ki=this.Li=null;this.Os=this.Ms=void 0;this.L=null;this.gd=this.Fc=this.Pc=this.Pf=this.Of=this.ge=void 0;this.ba=null;this.Ud=void 0};function Hk(a,b,c,d){var e,f,g,h=b.length;for(g=0;g<h;++g)e=b[g],f=I(e).toString(),f in c?e=c[f]:(e=Fk(d,e),c[f]=e),a[g]=e}
l.iq=function(a,b){var c=uk(b,wk,yk),d;this.Fb?d=this.Fb:this.Fb=d=new zk(a,c);b.useProgram(c);a.enableVertexAttribArray(d.gc);a.vertexAttribPointer(d.gc,2,5126,!1,32,0);a.enableVertexAttribArray(d.er);a.vertexAttribPointer(d.er,2,5126,!1,32,8);a.enableVertexAttribArray(d.dg);a.vertexAttribPointer(d.dg,2,5126,!1,32,16);a.enableVertexAttribArray(d.gr);a.vertexAttribPointer(d.gr,1,5126,!1,32,24);a.enableVertexAttribArray(d.ir);a.vertexAttribPointer(d.ir,1,5126,!1,32,28);return d};
l.lq=function(a,b){a.disableVertexAttribArray(b.gc);a.disableVertexAttribArray(b.er);a.disableVertexAttribArray(b.dg);a.disableVertexAttribArray(b.gr);a.disableVertexAttribArray(b.ir)};l.Bl=function(a,b,c,d){var e=d?this.am:this.wu;d=d?this.$l:this.xs;if(sd(c)){var f,g;c=0;f=e.length;for(g=0;c<f;++c){a.bindTexture(3553,e[c]);var h=d[c];this.drawElements(a,b,g,h);g=h}}else this.ni(a,b,c,e,d)};
l.ni=function(a,b,c,d,e){var f=0,g,h;g=0;for(h=d.length;g<h;++g){a.bindTexture(3553,d[g]);for(var k=0<g?e[g-1]:0,m=e[g],p=k;f<this.ua.length&&this.ua[f]<=m;){var t=I(this.hd[f]).toString();void 0!==c[t]?(p!==k&&this.drawElements(a,b,p,k),k=p=f===this.ua.length-1?m:this.ua[f+1]):k=f===this.ua.length-1?m:this.ua[f+1];f++}p!==k&&this.drawElements(a,b,p,k)}};
l.co=function(a,b,c,d,e){var f,g,h,k,m,p,t=this.ua.length-1;for(f=this.am.length-1;0<=f;--f)for(a.bindTexture(3553,this.am[f]),g=0<f?this.$l[f-1]:0,k=this.$l[f];0<=t&&this.ua[t]>=g;){h=this.ua[t];m=this.hd[t];p=I(m).toString();if(void 0===c[p]&&m.j()&&(void 0===e||bg(e,m.j().W()))&&(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),this.drawElements(a,b,h,k),k=d(m)))return k;k=h;t--}};
l.hq=function(a){var b=a.Il(),c=a.na(1),d=a.yo(),e=a.Ll(1),f=a.rg(),g=a.Ff(),h=a.Pc,k=a.Gb(),m=a.Ta();a=a.fb();var p;0===this.Li.length?this.Li.push(c):(p=this.Li[this.Li.length-1],I(p)!=I(c)&&(this.xs.push(this.L.length),this.Li.push(c)));0===this.Ki.length?this.Ki.push(e):(p=this.Ki[this.Ki.length-1],I(p)!=I(e)&&(this.$l.push(this.L.length),this.Ki.push(e)));this.uf=b[0];this.vf=b[1];this.Hf=m[1];this.Ms=d[1];this.Os=d[0];this.ge=f;this.Of=g[0];this.Pf=g[1];this.Fc=k;this.Pc=h;this.gd=a;this.Ud=
m[0]};function Ik(a,b,c,d){var e=c-d;return a[b]===a[e]&&a[b+1]===a[e+1]&&3<(c-b)/d?!!ch(a,b,c,d):!1};function Jk(){this.ob="precision mediump float;\nvarying float v_round;\nvarying vec2 v_roundVertex;\nvarying float v_halfWidth;\n\n\n\nuniform float u_opacity;\nuniform vec4 u_color;\nuniform vec2 u_size;\nuniform float u_pixelRatio;\n\nvoid main(void) {\n  if (v_round > 0.0) {\n    vec2 windowCoords = vec2((v_roundVertex.x + 1.0) / 2.0 * u_size.x * u_pixelRatio,\n        (v_roundVertex.y + 1.0) / 2.0 * u_size.y * u_pixelRatio);\n    if (length(windowCoords - gl_FragCoord.xy) > v_halfWidth * u_pixelRatio) {\n      discard;\n    }\n  }\n  gl_FragColor = u_color;\n  float alpha = u_color.a * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n"}
E(Jk,ck);var Kk=new Jk;
function Lk(){this.ob="varying float v_round;\nvarying vec2 v_roundVertex;\nvarying float v_halfWidth;\n\n\nattribute vec2 a_lastPos;\nattribute vec2 a_position;\nattribute vec2 a_nextPos;\nattribute float a_direction;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_lineWidth;\nuniform float u_miterLimit;\n\nbool nearlyEquals(in float value, in float ref) {\n  float epsilon = 0.000000000001;\n  return value >= ref - epsilon && value <= ref + epsilon;\n}\n\nvoid alongNormal(out vec2 offset, in vec2 nextP, in float turnDir, in float direction) {\n  vec2 dirVect = nextP - a_position;\n  vec2 normal = normalize(vec2(-turnDir * dirVect.y, turnDir * dirVect.x));\n  offset = u_lineWidth / 2.0 * normal * direction;\n}\n\nvoid miterUp(out vec2 offset, out float round, in bool isRound, in float direction) {\n  float halfWidth = u_lineWidth / 2.0;\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 dirVect = a_nextPos - a_position;\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\n  float miterLength = abs(halfWidth / dot(normal, tmpNormal));\n  offset = normal * direction * miterLength;\n  round = 0.0;\n  if (isRound) {\n    round = 1.0;\n  } else if (miterLength > u_miterLimit + u_lineWidth) {\n    offset = halfWidth * tmpNormal * direction;\n  }\n}\n\nbool miterDown(out vec2 offset, in vec4 projPos, in mat4 offsetMatrix, in float direction) {\n  bool degenerate = false;\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 dirVect = a_lastPos - a_position;\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\n  vec2 longOffset, shortOffset, longVertex;\n  vec4 shortProjVertex;\n  float halfWidth = u_lineWidth / 2.0;\n  if (length(a_nextPos - a_position) > length(a_lastPos - a_position)) {\n    longOffset = tmpNormal * direction * halfWidth;\n    shortOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\n    longVertex = a_nextPos;\n    shortProjVertex = u_projectionMatrix * vec4(a_lastPos, 0.0, 1.0);\n  } else {\n    shortOffset = tmpNormal * direction * halfWidth;\n    longOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\n    longVertex = a_lastPos;\n    shortProjVertex = u_projectionMatrix * vec4(a_nextPos, 0.0, 1.0);\n  }\n  //Intersection algorithm based on theory by Paul Bourke (http://paulbourke.net/geometry/pointlineplane/).\n  vec4 p1 = u_projectionMatrix * vec4(longVertex, 0.0, 1.0) + offsetMatrix * vec4(longOffset, 0.0, 0.0);\n  vec4 p2 = projPos + offsetMatrix * vec4(longOffset, 0.0, 0.0);\n  vec4 p3 = shortProjVertex + offsetMatrix * vec4(-shortOffset, 0.0, 0.0);\n  vec4 p4 = shortProjVertex + offsetMatrix * vec4(shortOffset, 0.0, 0.0);\n  float denom = (p4.y - p3.y) * (p2.x - p1.x) - (p4.x - p3.x) * (p2.y - p1.y);\n  float firstU = ((p4.x - p3.x) * (p1.y - p3.y) - (p4.y - p3.y) * (p1.x - p3.x)) / denom;\n  float secondU = ((p2.x - p1.x) * (p1.y - p3.y) - (p2.y - p1.y) * (p1.x - p3.x)) / denom;\n  float epsilon = 0.000000000001;\n  if (firstU > epsilon && firstU < 1.0 - epsilon && secondU > epsilon && secondU < 1.0 - epsilon) {\n    shortProjVertex.x = p1.x + firstU * (p2.x - p1.x);\n    shortProjVertex.y = p1.y + firstU * (p2.y - p1.y);\n    offset = shortProjVertex.xy;\n    degenerate = true;\n  } else {\n    float miterLength = abs(halfWidth / dot(normal, tmpNormal));\n    offset = normal * direction * miterLength;\n  }\n  return degenerate;\n}\n\nvoid squareCap(out vec2 offset, out float round, in bool isRound, in vec2 nextP,\n    in float turnDir, in float direction) {\n  round = 0.0;\n  vec2 dirVect = a_position - nextP;\n  vec2 firstNormal = normalize(dirVect);\n  vec2 secondNormal = vec2(turnDir * firstNormal.y * direction, -turnDir * firstNormal.x * direction);\n  vec2 hypotenuse = normalize(firstNormal - secondNormal);\n  vec2 normal = vec2(turnDir * hypotenuse.y * direction, -turnDir * hypotenuse.x * direction);\n  float length = sqrt(v_halfWidth * v_halfWidth * 2.0);\n  offset = normal * length;\n  if (isRound) {\n    round = 1.0;\n  }\n}\n\nvoid main(void) {\n  bool degenerate = false;\n  float direction = float(sign(a_direction));\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  vec2 offset;\n  vec4 projPos = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n  bool round = nearlyEquals(mod(a_direction, 2.0), 0.0);\n\n  v_round = 0.0;\n  v_halfWidth = u_lineWidth / 2.0;\n  v_roundVertex = projPos.xy;\n\n  if (nearlyEquals(mod(a_direction, 3.0), 0.0) || nearlyEquals(mod(a_direction, 17.0), 0.0)) {\n    alongNormal(offset, a_nextPos, 1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 5.0), 0.0) || nearlyEquals(mod(a_direction, 13.0), 0.0)) {\n    alongNormal(offset, a_lastPos, -1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 23.0), 0.0)) {\n    miterUp(offset, v_round, round, direction);\n  } else if (nearlyEquals(mod(a_direction, 19.0), 0.0)) {\n    degenerate = miterDown(offset, projPos, offsetMatrix, direction);\n  } else if (nearlyEquals(mod(a_direction, 7.0), 0.0)) {\n    squareCap(offset, v_round, round, a_nextPos, 1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 11.0), 0.0)) {\n    squareCap(offset, v_round, round, a_lastPos, -1.0, direction);\n  }\n  if (!degenerate) {\n    vec4 offsets = offsetMatrix * vec4(offset, 0.0, 0.0);\n    gl_Position = projPos + offsets;\n  } else {\n    gl_Position = vec4(offset, 0.0, 1.0);\n  }\n}\n\n\n"}
E(Lk,dk);var Mk=new Lk;
function Nk(a,b){this.Du=a.getUniformLocation(b,"u_color");this.Eu=a.getUniformLocation(b,"u_lineWidth");this.BK=a.getUniformLocation(b,"u_miterLimit");this.Dq=a.getUniformLocation(b,"u_offsetRotateMatrix");this.Eq=a.getUniformLocation(b,"u_offsetScaleMatrix");this.Rk=a.getUniformLocation(b,"u_opacity");this.Fu=a.getUniformLocation(b,"u_pixelRatio");this.Sk=a.getUniformLocation(b,"u_projectionMatrix");this.Gu=a.getUniformLocation(b,"u_size");this.ar=a.getAttribLocation(b,"a_direction");this.cr=a.getAttribLocation(b,
"a_lastPos");this.dr=a.getAttribLocation(b,"a_nextPos");this.gc=a.getAttribLocation(b,"a_position")};function Ok(a,b){lk.call(this,a,b);this.Fb=null;this.Tb=[];this.vb=[];this.T={strokeColor:null,lineCap:void 0,bb:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:void 0,miterLimit:void 0,G:!1}}E(Ok,lk);l=Ok.prototype;
l.od=function(a,b,c,d){var e,f=this.ba.length,g=this.L.length,h="bevel"===this.T.lineJoin?0:"miter"===this.T.lineJoin?1:2,k="butt"===this.T.lineCap?0:"square"===this.T.lineCap?1:2,m=Ik(a,b,c,d),p,t,v,w=g,x=1,y,F,H;for(e=b;e<c;e+=d){v=f/7;y=F;F=H||[a[e],a[e+1]];if(e===b){H=[a[e+d],a[e+d+1]];if(c-b===2*d&&Ke(F,H))break;if(m)y=[a[c-2*d],a[c-2*d+1]],p=H;else{k&&(f=Pk(this,[0,0],F,H,x*Qk*k,f),f=Pk(this,[0,0],F,H,-x*Qk*k,f),this.L[g++]=v+2,this.L[g++]=v,this.L[g++]=v+1,this.L[g++]=v+1,this.L[g++]=v+3,this.L[g++]=
v+2);f=Pk(this,[0,0],F,H,x*Rk*(k||1),f);f=Pk(this,[0,0],F,H,-x*Rk*(k||1),f);w=f/7-1;continue}}else if(e===c-d){m?H=p:(y=y||[0,0],f=Pk(this,y,F,[0,0],x*Sk*(k||1),f),f=Pk(this,y,F,[0,0],-x*Sk*(k||1),f),this.L[g++]=v,this.L[g++]=w-1,this.L[g++]=w,this.L[g++]=w,this.L[g++]=v+1,this.L[g++]=v,k&&(f=Pk(this,y,F,[0,0],x*Tk*k,f),f=Pk(this,y,F,[0,0],-x*Tk*k,f),this.L[g++]=v+2,this.L[g++]=v,this.L[g++]=v+1,this.L[g++]=v+1,this.L[g++]=v+3,this.L[g++]=v+2));break}else H=[a[e+d],a[e+d+1]];t=pk(y[0],y[1],F[0],F[1],
H[0],H[1])?-1:1;f=Pk(this,y,F,H,t*Uk*(h||1),f);f=Pk(this,y,F,H,t*Vk*(h||1),f);f=Pk(this,y,F,H,-t*Wk*(h||1),f);e>b&&(this.L[g++]=v,this.L[g++]=w-1,this.L[g++]=w,this.L[g++]=v+2,this.L[g++]=v,this.L[g++]=0<x*t?w:w-1);this.L[g++]=v;this.L[g++]=v+2;this.L[g++]=v+1;w=v+2;x=t;h&&(f=Pk(this,y,F,H,t*Xk*h,f),this.L[g++]=v+1,this.L[g++]=v+3,this.L[g++]=v)}m&&(v=v||f/7,t=vh([y[0],y[1],F[0],F[1],H[0],H[1]],0,6,2)?1:-1,f=Pk(this,y,F,H,t*Uk*(h||1),f),Pk(this,y,F,H,-t*Wk*(h||1),f),this.L[g++]=v,this.L[g++]=w-1,
this.L[g++]=w,this.L[g++]=v+1,this.L[g++]=v,this.L[g++]=0<x*t?w:w-1)};function Pk(a,b,c,d,e,f){a.ba[f++]=b[0];a.ba[f++]=b[1];a.ba[f++]=c[0];a.ba[f++]=c[1];a.ba[f++]=d[0];a.ba[f++]=d[1];a.ba[f++]=e;return f}function Yk(a,b,c){b-=0;return b<2*c?!1:b===2*c?!Ke([a[0],a[1]],[a[0+c],a[0+c+1]]):!0}
l.Qr=function(a,b){var c=a.l;a=a.P;Yk(c,c.length,a)&&(c=Wg(c,c.length,a,-this.origin[0],-this.origin[1]),this.T.G&&(this.vb.push(this.L.length),this.T.G=!1),this.ua.push(this.L.length),this.hd.push(b),this.od(c,0,c.length,a))};
l.Rr=function(a,b){var c=this.L.length;a=Zk(a);var d,e;d=0;for(e=a.length;d<e;++d){var f=a[d].l,g=a[d].P;Yk(f,f.length,g)&&(f=Wg(f,f.length,g,-this.origin[0],-this.origin[1]),this.od(f,0,f.length,g))}this.L.length>c&&(this.ua.push(c),this.hd.push(b),this.T.G&&(this.vb.push(c),this.T.G=!1))};
function $k(a,b,c,d){Ik(b,0,b.length,d)||(b.push(b[0]),b.push(b[1]));a.od(b,0,b.length,d);if(c.length){var e;b=0;for(e=c.length;b<e;++b)Ik(c[b],0,c[b].length,d)||(c[b].push(c[b][0]),c[b].push(c[b][1])),a.od(c[b],0,c[b].length,d)}}function al(a,b,c){c=void 0===c?a.L.length:c;a.ua.push(c);a.hd.push(b);a.T.G&&(a.vb.push(c),a.T.G=!1)}l.finish=function(){this.Sg=new rk(this.ba);this.xg=new rk(this.L);this.ua.push(this.L.length);0===this.vb.length&&0<this.Tb.length&&(this.Tb=[]);this.L=this.ba=null};
l.og=function(a){var b=this.Sg,c=this.xg;return function(){a.deleteBuffer(b);a.deleteBuffer(c)}};
l.iq=function(a,b,c,d){var e=uk(b,Kk,Mk),f;this.Fb?f=this.Fb:this.Fb=f=new Nk(a,e);b.useProgram(e);a.enableVertexAttribArray(f.cr);a.vertexAttribPointer(f.cr,2,5126,!1,28,0);a.enableVertexAttribArray(f.gc);a.vertexAttribPointer(f.gc,2,5126,!1,28,8);a.enableVertexAttribArray(f.dr);a.vertexAttribPointer(f.dr,2,5126,!1,28,16);a.enableVertexAttribArray(f.ar);a.vertexAttribPointer(f.ar,1,5126,!1,28,24);a.uniform2fv(f.Gu,c);a.uniform1f(f.Fu,d);return f};
l.lq=function(a,b){a.disableVertexAttribArray(b.cr);a.disableVertexAttribArray(b.gc);a.disableVertexAttribArray(b.dr);a.disableVertexAttribArray(b.ar)};
l.Bl=function(a,b,c,d){var e=a.getParameter(a.DEPTH_FUNC),f=a.getParameter(a.DEPTH_WRITEMASK);d||(a.enable(a.DEPTH_TEST),a.depthMask(!0),a.depthFunc(a.NOTEQUAL));if(sd(c)){var g,h,k;h=this.ua[this.ua.length-1];for(c=this.vb.length-1;0<=c;--c)g=this.vb[c],k=this.Tb[c],this.Vf(a,k[0],k[1],k[2]),this.drawElements(a,b,g,h),a.clear(a.DEPTH_BUFFER_BIT),h=g}else this.ni(a,b,c);d||(a.disable(a.DEPTH_TEST),a.clear(a.DEPTH_BUFFER_BIT),a.depthMask(f),a.depthFunc(e))};
l.ni=function(a,b,c){var d,e,f,g,h,k,m;k=this.ua.length-2;f=e=this.ua[k+1];for(d=this.vb.length-1;0<=d;--d){g=this.Tb[d];this.Vf(a,g[0],g[1],g[2]);for(g=this.vb[d];0<=k&&this.ua[k]>=g;)m=this.ua[k],h=this.hd[k],h=I(h).toString(),c[h]&&(e!==f&&(this.drawElements(a,b,e,f),a.clear(a.DEPTH_BUFFER_BIT)),f=m),k--,e=m;e!==f&&(this.drawElements(a,b,e,f),a.clear(a.DEPTH_BUFFER_BIT));e=f=g}};
l.co=function(a,b,c,d,e){var f,g,h,k,m,p,t;t=this.ua.length-2;h=this.ua[t+1];for(f=this.vb.length-1;0<=f;--f)for(g=this.Tb[f],this.Vf(a,g[0],g[1],g[2]),k=this.vb[f];0<=t&&this.ua[t]>=k;){g=this.ua[t];m=this.hd[t];p=I(m).toString();if(void 0===c[p]&&m.j()&&(void 0===e||bg(e,m.j().W()))&&(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),this.drawElements(a,b,g,h),h=d(m)))return h;t--;h=g}};l.Vf=function(a,b,c,d){a.uniform4fv(this.Fb.Du,b);a.uniform1f(this.Fb.Eu,c);a.uniform1f(this.Fb.BK,d)};
l.Je=function(a,b){a=b.qh;this.T.lineCap=void 0!==a?a:"round";a=b.getLineDash();this.T.bb=a?a:nk;a=b.rh;this.T.lineDashOffset=a?a:0;a=b.sh;this.T.lineJoin=void 0!==a?a:"round";a=b.ma;a=a instanceof CanvasGradient||a instanceof CanvasPattern?ok:vj(a).map(function(a,b){return 3!=b?a/255:a})||ok;var c=b.hc(),c=void 0!==c?c:1;b=b.wh;b=void 0!==b?b:10;this.T.strokeColor&&Ke(this.T.strokeColor,a)&&this.T.lineWidth===c&&this.T.miterLimit===b||(this.T.G=!0,this.T.strokeColor=a,this.T.lineWidth=c,this.T.miterLimit=
b,this.Tb.push([a,c,b]))};var Rk=3,Sk=5,Qk=7,Tk=11,Uk=13,Vk=17,Wk=19,Xk=23;function bl(){this.ob="precision mediump float;\n\n\n\nuniform vec4 u_color;\nuniform float u_opacity;\n\nvoid main(void) {\n  gl_FragColor = u_color;\n  float alpha = u_color.a * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n"}E(bl,ck);var cl=new bl;
function dl(){this.ob="\n\nattribute vec2 a_position;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n}\n\n\n"}E(dl,dk);var el=new dl;
function fl(a,b){this.Du=a.getUniformLocation(b,"u_color");this.Dq=a.getUniformLocation(b,"u_offsetRotateMatrix");this.Eq=a.getUniformLocation(b,"u_offsetScaleMatrix");this.Rk=a.getUniformLocation(b,"u_opacity");this.Sk=a.getUniformLocation(b,"u_projectionMatrix");this.gc=a.getAttribLocation(b,"a_position")};function gl(a){a=a||{};this.ma=void 0!==a.color?a.color:null;this.qh=a.lineCap;this.lp=void 0!==a.bb?a.bb:null;this.rh=a.lineDashOffset;this.sh=a.lineJoin;this.wh=a.miterLimit;this.Ud=a.width;this.Cd=void 0}l=gl.prototype;l.clone=function(){var a=this.ma;return new gl({color:a&&a.slice?a.slice():a||void 0,lineCap:this.qh,bb:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.rh,lineJoin:this.sh,miterLimit:this.wh,width:this.hc()})};l.getLineDash=function(){return this.lp};
l.hc=function(){return this.Ud};l.setLineDash=function(a){this.lp=a;this.Cd=void 0};l.fh=function(){void 0===this.Cd&&(this.Cd="s",this.Cd=this.ma?"string"===typeof this.ma?this.Cd+this.ma:this.Cd+I(this.ma).toString():this.Cd+"-",this.Cd+=","+(void 0!==this.qh?this.qh.toString():"-")+","+(this.lp?this.lp.toString():"-")+","+(void 0!==this.rh?this.rh:"-")+","+(void 0!==this.sh?this.sh:"-")+","+(void 0!==this.wh?this.wh.toString():"-")+","+(void 0!==this.Ud?this.Ud.toString():"-"));return this.Cd};function hl(a){this.Na=this.be=this.ve=void 0;this.rw=void 0===a?!0:a;this.Bg=0}hl.prototype.removeItem=function(){var a=this.Na;if(a){var b=a.next,c=a.prev;b&&(b.prev=c);c&&(c.next=b);this.Na=b||c;this.ve===this.be?this.be=this.ve=this.Na=void 0:this.ve===a?this.ve=this.Na:this.be===a&&(this.be=c?this.Na.prev:this.Na);this.Bg--}};function il(a){a.Na=a.ve;if(a.Na)return a.Na.data}function kl(a){if(a.Na&&a.Na.next)return a.Na=a.Na.next,a.Na.data}
function ll(a){if(a.Na&&a.Na.next)return a.Na.next.data}function ml(a){if(a.Na&&a.Na.prev)return a.Na=a.Na.prev,a.Na.data}function nl(a){if(a.Na&&a.Na.prev)return a.Na.prev.data}function pl(a){if(a.Na)return a.Na.data}hl.prototype.concat=function(a){if(a.Na){if(this.Na){var b=this.Na.next;this.Na.next=a.ve;a.ve.prev=this.Na;b.prev=a.be;a.be.next=b;this.Bg+=a.Bg}else this.Na=a.Na,this.ve=a.ve,this.be=a.be,this.Bg=a.Bg;a.Na=void 0;a.ve=void 0;a.be=void 0;a.Bg=0}};hl.prototype.Xb=function(){return this.Bg};var ql;
(function(){var a={},b={dh:a};(function(c){"object"===typeof a&&"undefined"!==typeof b?b.dh=c():("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).lM=c()})(function(){return function d(a,b,g){function e(h,k){if(!b[h]){if(!a[h]){var p="function"==typeof require&&require;if(!k&&p)return p(h,!0);if(f)return f(h,!0);k=Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k;}k=b[h]={dh:{}};a[h][0].call(k.dh,function(b){var d=a[h][1][b];
return e(d?d:b)},k,k.dh,d,a,b,g)}return b[h].dh}for(var f="function"==typeof require&&require,m=0;m<g.length;m++)e(g[m]);return e}({1:[function(a,b){function d(a,b,f,g,v){f=f||0;g=g||a.length-1;for(v=v||h;g>f;){if(600<g-f){var k=g-f+1,p=b-f+1,m=Math.log(k),t=.5*Math.exp(2*m/3),m=.5*Math.sqrt(m*t*(k-t)/k)*(0>p-k/2?-1:1);d(a,b,Math.max(f,Math.floor(b-p*t/k+m)),Math.min(g,Math.floor(b+(k-p)*t/k+m)),v)}k=a[b];p=f;t=g;e(a,f,b);for(0<v(a[g],k)&&e(a,f,g);p<t;){e(a,p,t);p++;for(t--;0>v(a[p],k);)p++;for(;0<
v(a[t],k);)t--}0===v(a[f],k)?e(a,f,t):(t++,e(a,t,g));t<=b&&(f=t+1);b<=t&&(g=t-1)}}function e(a,b,d){var e=a[b];a[b]=a[d];a[d]=e}function h(a,b){return a<b?-1:a>b?1:0}b.dh=d},{}],2:[function(a,b){function d(a,b){if(!(this instanceof d))return new d(a,b);this.Zq=Math.max(4,a||9);this.hv=Math.max(2,Math.ceil(.4*this.Zq));b&&this.PB(b);this.clear()}function e(a,b){h(a,0,a.children.length,b,a)}function h(a,b,d,e,f){f||(f=y(null));f.Ga=Infinity;f.Ha=Infinity;f.Ba=-Infinity;f.Oa=-Infinity;for(var g;b<d;b++)g=
a.children[b],k(f,a.td?e(g):g);return f}function k(a,b){a.Ga=Math.min(a.Ga,b.Ga);a.Ha=Math.min(a.Ha,b.Ha);a.Ba=Math.max(a.Ba,b.Ba);a.Oa=Math.max(a.Oa,b.Oa)}function m(a,b){return a.Ga-b.Ga}function p(a,b){return a.Ha-b.Ha}function t(a){return(a.Ba-a.Ga)*(a.Oa-a.Ha)}function v(a){return a.Ba-a.Ga+(a.Oa-a.Ha)}function w(a,b){return a.Ga<=b.Ga&&a.Ha<=b.Ha&&b.Ba<=a.Ba&&b.Oa<=a.Oa}function x(a,b){return b.Ga<=a.Ba&&b.Ha<=a.Oa&&b.Ba>=a.Ga&&b.Oa>=a.Ha}function y(a){return{children:a,height:1,td:!0,Ga:Infinity,
Ha:Infinity,Ba:-Infinity,Oa:-Infinity}}function F(a,b,d,e,f){for(var g=[b,d],h;g.length;)d=g.pop(),b=g.pop(),d-b<=e||(h=b+Math.ceil((d-b)/e/2)*e,H(a,h,b,d,f),g.push(b,h,h,d))}b.dh=d;var H=a("quickselect");d.prototype={all:function(){return this.dv(this.data,[])},search:function(a){var b=this.data,d=[],e=this.oe;if(!x(a,b))return d;for(var f=[],g,h,k,p;b;){g=0;for(h=b.children.length;g<h;g++)k=b.children[g],p=b.td?e(k):k,x(a,p)&&(b.td?d.push(k):w(a,p)?this.dv(k,d):f.push(k));b=f.pop()}return d},load:function(a){if(!a||
!a.length)return this;if(a.length<this.hv){for(var b=0,d=a.length;b<d;b++)this.Bc(a[b]);return this}a=this.fv(a.slice(),0,a.length-1,0);this.data.children.length?this.data.height===a.height?this.iv(this.data,a):(this.data.height<a.height&&(b=this.data,this.data=a,a=b),this.gv(a,this.data.height-a.height-1,!0)):this.data=a;return this},Bc:function(a){a&&this.gv(a,this.data.height-1);return this},clear:function(){this.data=y([]);return this},remove:function(a,b){if(!a)return this;for(var d=this.data,
e=this.oe(a),f=[],g=[],h,k,p,m;d||f.length;){d||(d=f.pop(),k=f[f.length-1],h=g.pop(),m=!0);if(d.td){a:{p=a;var t=d.children,v=b;if(v){for(var x=0;x<t.length;x++)if(v(p,t[x])){p=x;break a}p=-1}else p=t.indexOf(p)}if(-1!==p){d.children.splice(p,1);f.push(d);this.OB(f);break}}m||d.td||!w(d,e)?k?(h++,d=k.children[h],m=!1):d=null:(f.push(d),g.push(h),h=0,k=d,d=d.children[0])}return this},oe:function(a){return a},Br:m,Cr:p,toJSON:function(){return this.data},dv:function(a,b){for(var d=[];a;)a.td?b.push.apply(b,
a.children):d.push.apply(d,a.children),a=d.pop();return b},fv:function(a,b,d,f){var g=d-b+1,h=this.Zq,k;if(g<=h)return k=y(a.slice(b,d+1)),e(k,this.oe),k;f||(f=Math.ceil(Math.log(g)/Math.log(h)),h=Math.ceil(g/Math.pow(h,f-1)));k=y([]);k.td=!1;k.height=f;var g=Math.ceil(g/h),h=g*Math.ceil(Math.sqrt(h)),p,m,t;for(F(a,b,d,h,this.Br);b<=d;b+=h)for(m=Math.min(b+h-1,d),F(a,b,m,g,this.Cr),p=b;p<=m;p+=g)t=Math.min(p+g-1,m),k.children.push(this.fv(a,p,t,f-1));e(k,this.oe);return k},NB:function(a,b,d,e){for(var f,
g,h,k,p,m,w,v;;){e.push(b);if(b.td||e.length-1===d)break;w=v=Infinity;f=0;for(g=b.children.length;f<g;f++)h=b.children[f],p=t(h),m=(Math.max(h.Ba,a.Ba)-Math.min(h.Ga,a.Ga))*(Math.max(h.Oa,a.Oa)-Math.min(h.Ha,a.Ha))-p,m<v?(v=m,w=p<w?p:w,k=h):m===v&&p<w&&(w=p,k=h);b=k||b.children[0]}return b},gv:function(a,b,d){var e=this.oe;d=d?a:e(a);var e=[],f=this.NB(d,this.data,b,e);f.children.push(a);for(k(f,d);0<=b;)if(e[b].children.length>this.Zq)this.QB(e,b),b--;else break;this.KB(d,e,b)},QB:function(a,b){var d=
a[b],f=d.children.length,g=this.hv;this.LB(d,g,f);f=this.MB(d,g,f);f=y(d.children.splice(f,d.children.length-f));f.height=d.height;f.td=d.td;e(d,this.oe);e(f,this.oe);b?a[b-1].children.push(f):this.iv(d,f)},iv:function(a,b){this.data=y([a,b]);this.data.height=a.height+1;this.data.td=!1;e(this.data,this.oe)},MB:function(a,b,d){var e,f,g,k,p,m,w;p=m=Infinity;for(e=b;e<=d-b;e++)f=h(a,0,e,this.oe),g=h(a,e,d,this.oe),k=Math.max(0,Math.min(f.Ba,g.Ba)-Math.max(f.Ga,g.Ga))*Math.max(0,Math.min(f.Oa,g.Oa)-
Math.max(f.Ha,g.Ha)),f=t(f)+t(g),k<p?(p=k,w=e,m=f<m?f:m):k===p&&f<m&&(m=f,w=e);return w},LB:function(a,b,d){var e=a.td?this.Br:m,f=a.td?this.Cr:p,g=this.ev(a,b,d,e);b=this.ev(a,b,d,f);g<b&&a.children.sort(e)},ev:function(a,b,d,e){a.children.sort(e);e=this.oe;var f=h(a,0,b,e),g=h(a,d-b,d,e),p=v(f)+v(g),m,t;for(m=b;m<d-b;m++)t=a.children[m],k(f,a.td?e(t):t),p+=v(f);for(m=d-b-1;m>=b;m--)t=a.children[m],k(g,a.td?e(t):t),p+=v(g);return p},KB:function(a,b,d){for(;0<=d;d--)k(b[d],a)},OB:function(a){for(var b=
a.length-1,d;0<=b;b--)0===a[b].children.length?0<b?(d=a[b-1].children,d.splice(d.indexOf(a[b]),1)):this.clear():e(a[b],this.oe)},PB:function(a){var b=["return a"," - b",";"];this.Br=new Function("a","b",b.join(a[0]));this.Cr=new Function("a","b",b.join(a[1]));this.oe=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")}}},{quickselect:1}]},{},[2])(2)});ql=b.dh})();function rl(a){this.aj=ql(a);this.Ni={}}l=rl.prototype;l.Bc=function(a,b){a={Ga:a[0],Ha:a[1],Ba:a[2],Oa:a[3],value:b};this.aj.Bc(a);this.Ni[I(b)]=a};l.load=function(a,b){for(var c=Array(b.length),d=0,e=b.length;d<e;d++){var f=a[d],g=b[d],f={Ga:f[0],Ha:f[1],Ba:f[2],Oa:f[3],value:g};c[d]=f;this.Ni[I(g)]=f}this.aj.load(c)};l.remove=function(a){a=I(a);var b=this.Ni[a];delete this.Ni[a];return null!==this.aj.remove(b)};
l.update=function(a,b){var c=this.Ni[I(b)];Sf([c.Ga,c.Ha,c.Ba,c.Oa],a)||(this.remove(b),this.Bc(a,b))};l.getAll=function(){return this.aj.all().map(function(a){return a.value})};function sl(a,b){return a.aj.search({Ga:b[0],Ha:b[1],Ba:b[2],Oa:b[3]}).map(function(a){return a.value})}l.forEach=function(a,b){return tl(this.getAll(),a,b)};function ul(a,b,c,d){return tl(sl(a,b),c,d)}function tl(a,b,c){for(var d,e=0,f=a.length;e<f&&!(d=b.call(c,a[e]));e++);return d}l.df=function(){return sd(this.Ni)};
l.clear=function(){this.aj.clear();this.Ni={}};l.W=function(a){var b=this.aj.data;return Pf(b.Ga,b.Ha,b.Ba,b.Oa,a)};function vl(a,b){lk.call(this,a,b);this.Id=new Ok(a,b);this.Fb=null;this.Tb=[];this.vb=[];this.T={fillColor:null,G:!1}}E(vl,lk);l=vl.prototype;l.od=function(a,b,c){var d=new hl,e=new rl;a=wl(this,a,c,d,e,!0);if(b.length){var f,g,h=[];f=0;for(g=b.length;f<g;++f){var k={list:new hl,Ba:void 0};h.push(k);k.Ba=wl(this,b[f],c,k.list,e,!1)}h.sort(function(a,b){return b.Ba-a.Ba});for(f=0;f<h.length;++f)xl(h[f].list,h[f].Ba,d,a,e)}yl(d,e,!1);zl(this,d,e)};
function wl(a,b,c,d,e,f){var g,h,k=a.ba.length/2,m,p,t,v=[],w=[];if(f===vh(b,0,b.length,c))for(p=m=Al(a,b[0],b[1],k++),f=b[0],g=c,h=b.length;g<h;g+=c)t=Al(a,b[g],b[g+1],k++),w.push(Bl(p,t,d)),v.push([Math.min(p.x,t.x),Math.min(p.y,t.y),Math.max(p.x,t.x),Math.max(p.y,t.y)]),f=b[g]>f?b[g]:f,p=t;else for(g=b.length-c,p=m=Al(a,b[g],b[g+1],k++),f=b[g],g-=c,h=0;g>=h;g-=c)t=Al(a,b[g],b[g+1],k++),w.push(Bl(p,t,d)),v.push([Math.min(p.x,t.x),Math.min(p.y,t.y),Math.max(p.x,t.x),Math.max(p.y,t.y)]),f=b[g]>f?
b[g]:f,p=t;w.push(Bl(t,m,d));v.push([Math.min(p.x,t.x),Math.min(p.y,t.y),Math.max(p.x,t.x),Math.max(p.y,t.y)]);e.load(v,w);return f}function yl(a,b,c){var d=il(a),e=d,f=kl(a),g=!1;do{var h=c?pk(f.ia.x,f.ia.y,e.ia.x,e.ia.y,e.ta.x,e.ta.y):pk(e.ta.x,e.ta.y,e.ia.x,e.ia.y,f.ia.x,f.ia.y);void 0===h?(Cl(e,f,a,b),g=!0,f===d&&(d=ll(a)),f=e,ml(a)):e.ia.ie!==h&&(e.ia.ie=h,g=!0);e=f;f=kl(a)}while(e!==d);return g}
function xl(a,b,c,d,e){yl(a,e,!0);for(var f=il(a);f.ia.x!==b;)f=kl(a);b=f.ia;d={x:d,y:b.y,rd:-1};var g=Infinity,h,k,m,p;m=Dl({ta:b,ia:d},e,!0);h=0;for(k=m.length;h<k;++h){var t=m[h];if(void 0===t.ta.ie){var v=El(b,d,t.ta,t.ia,!0),w=Math.abs(b.x-v[0]);w<g&&(g=w,p={x:v[0],y:v[1],rd:-1},f=t)}}if(Infinity!==g){m=f.ia;if(0<g&&(f=Fl(b,p,f.ia,e),f.length))for(p=Infinity,h=0,k=f.length;h<k;++h)if(g=f[h],t=Math.atan2(b.y-g.y,d.x-g.x),t<p||t===p&&g.x<m.x)p=t,m=g;for(f=il(c);f.ia!==m;)f=kl(c);d={x:b.x,y:b.y,
rd:b.rd,ie:void 0};h={x:f.ia.x,y:f.ia.y,rd:f.ia.rd,ie:void 0};ll(a).ta=d;Bl(b,f.ia,a,e);Bl(h,d,a,e);f.ia=h;a.rw&&a.Na&&(a.ve=a.Na,a.be=a.Na.prev);c.concat(a)}}
function zl(a,b,c){for(var d=!1,e=Gl(b,c);3<b.Xb();)if(e){if(!Hl(a,b,c,e,d)&&!yl(b,c,d)&&!Il(a,b,c,!0))break}else if(!Hl(a,b,c,e,d)&&!yl(b,c,d)&&!Il(a,b,c))if(e=Gl(b,c)){var d=b,f=2*d.Xb(),g=Array(f),h=il(d),k=h,m=0;do g[m++]=k.ta.x,g[m++]=k.ta.y,k=kl(d);while(k!==h);d=!vh(g,0,f,2);yl(b,c,d)}else{e=a;d=b;f=g=il(d);do{h=Dl(f,c);if(h.length){g=h[0];h=El(f.ta,f.ia,g.ta,g.ia);h=Al(e,h[0],h[1],e.ba.length/2);k=new hl;m=new rl;Bl(h,f.ia,k,m);f.ia=h;c.update([Math.min(f.ta.x,h.x),Math.min(f.ta.y,h.y),Math.max(f.ta.x,
h.x),Math.max(f.ta.y,h.y)],f);for(f=kl(d);f!==g;)Bl(f.ta,f.ia,k,m),c.remove(f),d.removeItem(),f=pl(d);Bl(g.ta,h,k,m);g.ta=h;c.update([Math.min(g.ia.x,h.x),Math.min(g.ia.y,h.y),Math.max(g.ia.x,h.x),Math.max(g.ia.y,h.y)],g);yl(d,c,!1);zl(e,d,c);yl(k,m,!1);zl(e,k,m);break}f=kl(d)}while(f!==g);break}3===b.Xb()&&(e=a.L.length,a.L[e++]=nl(b).ta.rd,a.L[e++]=pl(b).ta.rd,a.L[e++]=ll(b).ta.rd)}
function Hl(a,b,c,d,e){var f=a.L.length,g=il(b),h=nl(b),k=g,m=kl(b),p=ll(b),t,v,w,x=!1;do{t=k.ta;v=k.ia;w=m.ia;if(!1===v.ie){var y=e?Jl(p.ia,w,v,t,h.ta):Jl(h.ta,t,v,w,p.ia);!d&&0!==Dl({ta:t,ia:w},c).length||!y||0!==Fl(t,v,w,c,!0).length||!d&&!1!==t.ie&&!1!==w.ie&&vh([h.ta.x,h.ta.y,t.x,t.y,v.x,v.y,w.x,w.y,p.ia.x,p.ia.y],0,10,2)!==!e||(a.L[f++]=t.rd,a.L[f++]=v.rd,a.L[f++]=w.rd,Cl(k,m,b,c),m===g&&(g=p),x=!0)}h=nl(b);k=pl(b);m=kl(b);p=ll(b)}while(k!==g&&3<b.Xb());return x}
function Il(a,b,c,d){var e=il(b);kl(b);var f=e,g=kl(b),h=!1;do{var k=El(f.ta,f.ia,g.ta,g.ia,d);if(k){var m,h=a.L.length,p=a.ba.length/2,t=ml(b);b.removeItem();c.remove(t);m=t===e;d?(k[0]===f.ta.x&&k[1]===f.ta.y?(ml(b),k=f.ta,g.ta=k,c.remove(f),m=m||f===e):(k=g.ia,f.ia=k,c.remove(g),m=m||g===e),b.removeItem()):(k=Al(a,k[0],k[1],p),f.ia=k,g.ta=k,c.update([Math.min(f.ta.x,f.ia.x),Math.min(f.ta.y,f.ia.y),Math.max(f.ta.x,f.ia.x),Math.max(f.ta.y,f.ia.y)],f),c.update([Math.min(g.ta.x,g.ia.x),Math.min(g.ta.y,
g.ia.y),Math.max(g.ta.x,g.ia.x),Math.max(g.ta.y,g.ia.y)],g));a.L[h++]=t.ta.rd;a.L[h++]=t.ia.rd;a.L[h++]=k.rd;h=!0;if(m)break}f=nl(b);g=kl(b)}while(f!==e);return h}function Gl(a,b){var c=il(a),d=c;do{if(Dl(d,b).length)return!1;d=kl(a)}while(d!==c);return!0}function Al(a,b,c,d){var e=a.ba.length;a.ba[e++]=b;a.ba[e++]=c;return{x:b,y:c,rd:d,ie:void 0}}
function Bl(a,b,c,d){var e={ta:a,ia:b},f={prev:void 0,next:void 0,data:e},g=c.Na;if(g){var h=g.next;f.prev=g;f.next=h;g.next=f;h&&(h.prev=f);g===c.be&&(c.be=f)}else c.ve=f,c.be=f,c.rw&&(f.next=f,f.prev=f);c.Na=f;c.Bg++;d&&d.Bc([Math.min(a.x,b.x),Math.min(a.y,b.y),Math.max(a.x,b.x),Math.max(a.y,b.y)],e);return e}function Cl(a,b,c,d){pl(c)===b&&(c.removeItem(),a.ia=b.ia,d.remove(b),d.update([Math.min(a.ta.x,a.ia.x),Math.min(a.ta.y,a.ia.y),Math.max(a.ta.x,a.ia.x),Math.max(a.ta.y,a.ia.y)],a))}
function Fl(a,b,c,d,e){var f,g,h,k=[],m=sl(d,[Math.min(a.x,b.x,c.x),Math.min(a.y,b.y,c.y),Math.max(a.x,b.x,c.x),Math.max(a.y,b.y,c.y)]);d=0;for(f=m.length;d<f;++d)for(g in m[d])h=m[d][g],"object"!==typeof h||e&&!h.ie||h.x===a.x&&h.y===a.y||h.x===b.x&&h.y===b.y||h.x===c.x&&h.y===c.y||-1!==k.indexOf(h)||!sh([a.x,a.y,b.x,b.y,c.x,c.y],0,6,2,h.x,h.y)||k.push(h);return k}
function Dl(a,b,c){var d=a.ta,e=a.ia;b=sl(b,[Math.min(d.x,e.x),Math.min(d.y,e.y),Math.max(d.x,e.x),Math.max(d.y,e.y)]);var f=[],g,h;g=0;for(h=b.length;g<h;++g){var k=b[g];a!==k&&(c||k.ta!==e||k.ia!==d)&&El(d,e,k.ta,k.ia,c)&&f.push(k)}return f}
function El(a,b,c,d,e){var f=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y);if(0!==f&&(d=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))/f,c=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))/f,!e&&d>qk&&d<1-qk&&c>qk&&c<1-qk||e&&0<=d&&1>=d&&0<=c&&1>=c))return[a.x+d*(b.x-a.x),a.y+d*(b.y-a.y)]}
function Jl(a,b,c,d,e){if(void 0===b.ie||void 0===d.ie)return!1;var f=(c.x-d.x)*(b.y-d.y)>(c.y-d.y)*(b.x-d.x);e=(e.x-d.x)*(b.y-d.y)<(e.y-d.y)*(b.x-d.x);a=(a.x-b.x)*(d.y-b.y)>(a.y-b.y)*(d.x-b.x);c=(c.x-b.x)*(d.y-b.y)<(c.y-b.y)*(d.x-b.x);b=b.ie?c||a:c&&a;return(d.ie?e||f:e&&f)&&b}
l.Tr=function(a,b){var c=Kl(a);a=a.P;var d=this.L.length,e=this.Id.L.length,f,g,h,k;f=0;for(g=c.length;f<g;++f){var m=Eh(c[f]);if(0<m.length){var p=m[0].l,p=Wg(p,p.length,a,-this.origin[0],-this.origin[1]),t=[],v;h=1;for(k=m.length;h<k;++h)v=m[h].l,v=Wg(v,v.length,a,-this.origin[0],-this.origin[1]),t.push(v);$k(this.Id,p,t,a);this.od(p,t,a)}}this.L.length>d&&(this.ua.push(d),this.hd.push(b),this.T.G&&(this.vb.push(d),this.T.G=!1));this.Id.L.length>e&&al(this.Id,b,e)};
l.Al=function(a,b){var c=Eh(a);a=a.P;if(0<c.length){this.ua.push(this.L.length);this.hd.push(b);this.T.G&&(this.vb.push(this.L.length),this.T.G=!1);al(this.Id,b);b=c[0].l;b=Wg(b,b.length,a,-this.origin[0],-this.origin[1]);var d=[],e,f,g;e=1;for(f=c.length;e<f;++e)g=c[e].l,g=Wg(g,g.length,a,-this.origin[0],-this.origin[1]),d.push(g);$k(this.Id,b,d,a);this.od(b,d,a)}};
l.finish=function(a){this.Sg=new rk(this.ba);this.xg=new rk(this.L);this.ua.push(this.L.length);this.Id.finish(a);0===this.vb.length&&0<this.Tb.length&&(this.Tb=[]);this.L=this.ba=null};l.og=function(a){var b=this.Sg,c=this.xg,d=this.Id.og(a);return function(){a.deleteBuffer(b);a.deleteBuffer(c);d()}};l.iq=function(a,b){var c=uk(b,cl,el),d;this.Fb?d=this.Fb:this.Fb=d=new fl(a,c);b.useProgram(c);a.enableVertexAttribArray(d.gc);a.vertexAttribPointer(d.gc,2,5126,!1,8,0);return d};l.lq=function(a,b){a.disableVertexAttribArray(b.gc)};
l.Bl=function(a,b,c,d){var e=a.getParameter(a.DEPTH_FUNC),f=a.getParameter(a.DEPTH_WRITEMASK);d||(a.enable(a.DEPTH_TEST),a.depthMask(!0),a.depthFunc(a.NOTEQUAL));if(sd(c)){var g,h,k;h=this.ua[this.ua.length-1];for(c=this.vb.length-1;0<=c;--c)g=this.vb[c],k=this.Tb[c],this.gj(a,k),this.drawElements(a,b,g,h),h=g}else this.ni(a,b,c);d||(a.disable(a.DEPTH_TEST),a.clear(a.DEPTH_BUFFER_BIT),a.depthMask(f),a.depthFunc(e))};
l.co=function(a,b,c,d,e){var f,g,h,k,m,p,t;t=this.ua.length-2;h=this.ua[t+1];for(f=this.vb.length-1;0<=f;--f)for(g=this.Tb[f],this.gj(a,g),k=this.vb[f];0<=t&&this.ua[t]>=k;){g=this.ua[t];m=this.hd[t];p=I(m).toString();if(void 0===c[p]&&m.j()&&(void 0===e||bg(e,m.j().W()))&&(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),this.drawElements(a,b,g,h),h=d(m)))return h;t--;h=g}};
l.ni=function(a,b,c){var d,e,f,g,h,k,m;k=this.ua.length-2;f=e=this.ua[k+1];for(d=this.vb.length-1;0<=d;--d){g=this.Tb[d];this.gj(a,g);for(g=this.vb[d];0<=k&&this.ua[k]>=g;)m=this.ua[k],h=this.hd[k],h=I(h).toString(),c[h]&&(e!==f&&(this.drawElements(a,b,e,f),a.clear(a.DEPTH_BUFFER_BIT)),f=m),k--,e=m;e!==f&&(this.drawElements(a,b,e,f),a.clear(a.DEPTH_BUFFER_BIT));e=f=g}};l.gj=function(a,b){a.uniform4fv(this.Fb.Du,b)};
l.Je=function(a,b){a=a?a.ma:[0,0,0,0];a=a instanceof CanvasGradient||a instanceof CanvasPattern?mk:vj(a).map(function(a,b){return 3!=b?a/255:a})||mk;this.T.fillColor&&Ke(a,this.T.fillColor)||(this.T.fillColor=a,this.T.G=!0,this.Tb.push(a));b?this.Id.Je(null,b):this.Id.Je(null,new gl({color:[0,0,0,0],lineWidth:0}))};function Ll(){}Ll.prototype.Lg=function(){};Ll.prototype.je=function(){};Ll.prototype.lg=function(){};Ll.prototype.og=function(){return md};function Ml(a,b,c){this.wp=b;this.Bu=a;this.He=c;this.lc={}}E(Ml,ak);l=Ml.prototype;l.og=function(a){var b=[],c;for(c in this.lc){var d=this.lc[c],e;for(e in d)b.push(d[e].og(a))}return function(){for(var a=b.length,c,d=0;d<a;d++)c=b[d].apply(this,arguments);return c}};l.finish=function(a){for(var b in this.lc){var c=this.lc[b],d;for(d in c)c[d].finish(a)}};
l.qd=function(a,b){var c=void 0!==a?a.toString():"0";a=this.lc[c];void 0===a&&(a={},this.lc[c]=a);c=a[b];void 0===c&&(c=new Nl[b](this.Bu,this.wp),a[b]=c);return c};l.df=function(){return sd(this.lc)};l.je=function(a,b,c,d,e,f,g,h){var k=Object.keys(this.lc).map(Number);k.sort(Ge);var m,p,t,v,w,x;m=0;for(p=k.length;m<p;++m)for(w=this.lc[k[m].toString()],t=0,v=Zj.length;t<v;++t)x=w[Zj[t]],void 0!==x&&x.je(a,b,c,d,e,f,g,h,void 0,!1)};
l.Zt=function(a,b,c,d,e,f,g,h,k,m,p){var t=Object.keys(this.lc).map(Number);t.sort(function(a,b){return b-a});var v,w,x,y,F;v=0;for(w=t.length;v<w;++v)for(y=this.lc[t[v].toString()],x=Zj.length-1;0<=x;--x)if(F=y[Zj[x]],void 0!==F&&(F=F.je(a,b,c,d,e,f,g,h,k,m,p)))return F};
l.Lc=function(a,b,c,d,e,f,g,h,k,m){var p=b.Kb;p.bindFramebuffer(p.FRAMEBUFFER,Bk(b));var t;void 0!==this.He&&(t=Kf(Rf(a),d*this.He));return this.Zt(b,a,d,e,Ol,g,h,k,function(a){var b=new Uint8Array(4);p.readPixels(0,0,1,1,p.RGBA,p.UNSIGNED_BYTE,b);if(0<b[3]&&(a=m(a)))return a},!0,t)};var Ol=[1,1],Nl={Circle:tk,Image:Gk,LineString:Ok,Polygon:vl,Text:Ll};function Pl(){this.ll=0;this.pi={};this.gf=this.fe=null}l=Pl.prototype;l.clear=function(){this.ll=0;this.pi={};this.gf=this.fe=null};function Ql(a,b){return a.pi.hasOwnProperty(b)}l.forEach=function(a,b){for(var c=this.fe;c;)a.call(b,c.pj,c.nh,this),c=c.ff};l.get=function(a){a=this.pi[a];af(void 0!==a,15);if(a===this.gf)return a.pj;a===this.fe?(this.fe=this.fe.ff,this.fe.Xi=null):(a.ff.Xi=a.Xi,a.Xi.ff=a.ff);a.ff=null;a.Xi=this.gf;this.gf=this.gf.ff=a;return a.pj};l.Jl=function(){return this.ll};
l.Co=function(){var a=Array(this.ll),b=0,c;for(c=this.gf;c;c=c.Xi)a[b++]=c.nh;return a};l.pop=function(){var a=this.fe;delete this.pi[a.nh];a.ff&&(a.ff.Xi=null);this.fe=a.ff;this.fe||(this.gf=null);--this.ll;return a.pj};l.replace=function(a,b){this.get(a);this.pi[a].pj=b};l.set=function(a,b){af(!(a in this.pi),16);b={nh:a,ff:null,Xi:this.gf,pj:b};this.gf?this.gf.ff=b:this.fe=b;this.gf=b;this.pi[a]=b;++this.ll};function Rl(a,b){Mj.call(this,0,b);this.ja=document.createElement("CANVAS");this.ja.style.width="100%";this.ja.style.height="100%";this.ja.style.display="block";this.ja.className="ol-unselectable";a.insertBefore(this.ja,a.childNodes[0]||null);this.uw=this.vw=0;this.ww=Vh();this.tc=!0;this.Kb=ae(this.ja,{antialias:!0,depth:!0,failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!1,stencil:!0});this.Af=new Ak(this.ja,this.Kb);J(this.ja,"webglcontextlost",this.Fi,this);J(this.ja,"webglcontextrestored",
this.Cs,this);this.Sd=new Pl;this.si=null;this.Ym=new bf(function(a){var b=a[1];a=a[2];var c=b[0]-this.si[0],b=b[1]-this.si[1];return 65536*Math.log(a)+Math.sqrt(c*c+b*b)/a}.bind(this),function(a){return a[0].getKey()});this.sG=function(){if(!this.Ym.df()){ef(this.Ym);var a=this.Ym.dequeue();Sl(this,a[0],a[3],a[4])}return!1}.bind(this);this.Wm=0;Tl(this)}E(Rl,Mj);
function Sl(a,b,c,d){var e=a.Kb,f=b.getKey();if(Ql(a.Sd,f))a=a.Sd.get(f),e.bindTexture(3553,a.Ne),9729!=a.ry&&(e.texParameteri(3553,10240,9729),a.ry=9729),9729!=a.Hy&&(e.texParameteri(3553,10241,9729),a.Hy=9729);else{var g=e.createTexture();e.bindTexture(3553,g);if(0<d){var h=a.ww.canvas,k=a.ww;a.vw!==c[0]||a.uw!==c[1]?(h.width=c[0],h.height=c[1],a.vw=c[0],a.uw=c[1]):k.clearRect(0,0,c[0],c[1]);k.drawImage(b.na(),d,d,c[0],c[1],0,0,c[0],c[1]);e.texImage2D(3553,0,6408,6408,5121,h)}else e.texImage2D(3553,
0,6408,6408,5121,b.na());e.texParameteri(3553,10240,9729);e.texParameteri(3553,10241,9729);e.texParameteri(3553,10242,33071);e.texParameteri(3553,10243,33071);a.Sd.set(f,{Ne:g,ry:9729,Hy:9729})}}l=Rl.prototype;l.Ed=function(a,b){var c=this.g();c.hasListener(a)&&c.dispatchEvent(new Rj(a,0,b,null))};l.ab=function(){var a=this.Kb;a.isContextLost()||this.Sd.forEach(function(b){b&&a.deleteTexture(b.Ne)});this.Af.Yd();Mj.prototype.ab.call(this)};
l.ND=function(a,b){a=this.Kb;for(var c;1024<this.Sd.Jl()-this.Wm;){if(c=this.Sd.fe.pj)a.deleteTexture(c.Ne);else if(+this.Sd.fe.nh==b.index)break;else--this.Wm;this.Sd.pop()}};l.getContext=function(){return this.Af};l.K=function(){return"webgl"};l.Fi=function(a){a.preventDefault();this.Sd.clear();this.Wm=0;a=this.Kf;for(var b in a)a[b].Fi()};l.Cs=function(){Tl(this);this.g().Ca()};
function Tl(a){a=a.Kb;a.activeTexture(33984);a.blendFuncSeparate(770,771,1,771);a.disable(2884);a.disable(2929);a.disable(3089);a.disable(2960)}
l.Ut=function(a){var b=this.getContext(),c=this.Kb;if(c.isContextLost())return!1;if(!a)return this.tc&&(this.ja.style.display="none",this.tc=!1),!1;this.si=a.focus;this.Sd.set((-a.index).toString(),null);++this.Wm;this.Ed("precompose",a);var d=[],e=a.$j;Le(e);var f=a.hb.ra,g,h,k,m;g=0;for(h=e.length;g<h;++g)m=e[g],sj(m,f)&&"ready"==m.tA&&(k=Pj(this,m.layer),k.Yi(a,m,b)&&d.push(m));e=a.size[0]*a.rc;f=a.size[1]*a.rc;if(this.ja.width!=e||this.ja.height!=f)this.ja.width=e,this.ja.height=f;c.bindFramebuffer(36160,
null);c.clearColor(0,0,0,0);c.clear(16384);c.enable(3042);c.viewport(0,0,this.ja.width,this.ja.height);g=0;for(h=d.length;g<h;++g)m=d[g],k=Pj(this,m.layer),k.kl(a,m,b);this.tc||(this.ja.style.display="",this.tc=!0);Nj(a);1024<this.Sd.Jl()-this.Wm&&a.Rf.push(this.ND.bind(this));this.Ym.df()||(a.Rf.push(this.sG),a.animate=!0);this.Ed("postcompose",a);Qj(this,a);a.Rf.push(Oj)};
l.Lc=function(a,b,c,d,e,f,g){var h;if(this.Kb.isContextLost())return!1;var k=b.hb,m=b.$j,p;for(p=m.length-1;0<=p;--p){h=m[p];var t=h.layer;if(sj(h,k.ra)&&f.call(g,t)&&(h=Pj(this,t).Lc(a,b,c,d,e)))return h}};function Ul(a,b,c){void 0===c&&(c=[0,0]);c[0]=a[0]*b+.5|0;c[1]=a[1]*b+.5|0;return c}function Vl(a,b){if(Array.isArray(a))return a;void 0===b?b=[a,a]:b[0]=b[1]=a;return b};var Wl=["canvas","webgl"];
function Xl(a){Jd.call(this);var b=Yl(a);this.uG=void 0!==a.tG?a.tG:!1;this.wG=void 0!==a.vG?a.vG:!1;this.Fg=void 0!==a.rc?a.rc:ie;this.DG=b.dk;this.sv=function(){this.di=void 0;this.zI.call(this,Date.now())}.bind(this);this.ZC=Cj();this.OH=Cj();this.VD=0;this.zc=null;this.kz=If();this.hp=this.Mq=this.Nq=null;this.ac=document.createElement("DIV");this.ac.className="ol-viewport"+(me?" ol-touch":"");this.ac.style.position="relative";this.ac.style.overflow="hidden";this.ac.style.width="100%";this.ac.style.height=
"100%";this.ac.style.msTouchAction="none";this.ac.style.touchAction="none";this.rm=document.createElement("DIV");this.rm.className="ol-overlaycontainer";this.ac.appendChild(this.rm);this.qm=document.createElement("DIV");this.qm.className="ol-overlaycontainer-stopevent";a="click dblclick mousedown touchstart MSPointerDown pointerdown mousewheel wheel".split(" ");for(var c=0,d=a.length;c<d;++c)J(this.qm,a[c],Ed);this.ac.appendChild(this.qm);this.uy=new Ye(this);for(var e in Yd)J(this.uy,Yd[e],this.Fx,
this);this.Ux=b.cm;this.bm=null;J(this.ac,"wheel",this.Tj,this);J(this.ac,"mousewheel",this.Tj,this);this.Tn=b.controls;this.yg=b.Mi;this.Xc=b.lk;this.dz={};this.Xt=new b.CI(this.ac,this);this.si=null;this.hz=[];this.OA=new ff(this.XE.bind(this),this.OF.bind(this));this.ju={};J(this,Md("layergroup"),this.vF,this);J(this,Md("view"),this.SF,this);J(this,Md("size"),this.LF,this);J(this,Md("target"),this.NF,this);Kd(this,b.values);this.Tn.forEach(function(a){a.cb(this)},this);J(this.Tn,"add",function(a){a.element.cb(this)},
this);J(this.Tn,"remove",function(a){a.element.cb(null)},this);this.yg.forEach(function(a){a.cb(this)},this);J(this.yg,"add",function(a){a.element.cb(this)},this);J(this.yg,"remove",function(a){a.element.cb(null)},this);this.Xc.forEach(this.qv,this);J(this.Xc,"add",function(a){this.qv(a.element)},this);J(this.Xc,"remove",function(a){var b=a.element.Wb();void 0!==b&&delete this.dz[b.toString()];a.element.cb(null)},this)}E(Xl,Jd);l=Xl.prototype;l.Tc=function(a){this.Ef().push(a)};l.bc=function(a){this.yg.push(a)};
l.Eb=function(a){Zl(this).getLayers().push(a)};l.eg=function(a){this.Xc.push(a)};l.qv=function(a){var b=a.Wb();void 0!==b&&(this.dz[b.toString()]=a);a.cb(this)};l.ab=function(){this.uy.Yd();this.Xt.Yd();Ad(this.ac,"wheel",this.Tj,this);Ad(this.ac,"mousewheel",this.Tj,this);void 0!==this.ih&&(window.removeEventListener("resize",this.ih,!1),this.ih=void 0);this.di&&(cancelAnimationFrame(this.di),this.di=void 0);this.Dh(null);Jd.prototype.ab.call(this)};
function $l(a,b,c,d){if(a.zc)return b=a.Gd(b),d=void 0!==d?d:{},a.Xt.Lc(b,a.zc,void 0!==d.jh?d.jh*a.zc.rc:0,c,null,void 0!==d.fp?d.fp:fg,null)}function Xd(a,b){a=a.ac.getBoundingClientRect();b=b.changedTouches?b.changedTouches[0]:b;return[b.clientX-a.left,b.clientY-a.top]}function am(a){a=a.get("target");return void 0!==a?"string"===typeof a?document.getElementById(a):a:null}l.Gd=function(a){var b=this.zc;return b?Hj(b.fz,a.slice()):null};l.Ef=function(){return this.Tn};
function Zl(a){return a.get("layergroup")}l.getLayers=function(){return Zl(this).getLayers()};function Gi(a,b){return(a=a.zc)?Hj(a.Dj,b.slice(0,2)):null}l.Ta=function(){return this.get("size")};function D(a){return a.get("view")}l.XE=function(a,b,c,d){var e=this.zc;if(!(e&&b in e.mn&&e.mn[b][a.getKey()]))return Infinity;a=c[0]-e.focus[0];c=c[1]-e.focus[1];return 65536*Math.log(d)+Math.sqrt(a*a+c*c)/d};l.Tj=function(a,b){a=new Wd(b||a.type,this,a);this.Fx(a)};
l.Fx=function(a){if(this.zc){this.si=a.Qb;a.af=this.zc;var b=this.yg.R(),c;if(!1!==this.dispatchEvent(a))for(c=b.length-1;0<=c;c--){var d=b[c];if(d.get("active")&&!d.handleEvent(a))break}}};
l.KF=function(){var a=this.zc,b=this.OA;if(!b.df()){var c=16,d=c;if(a){var e=a.sf;e[0]&&(c=this.uG?8:0,d=2);e[1]&&(c=this.wG?8:0,d=2)}if(b.yq<c){ef(b);for(var e=0,f,g;b.yq<c&&e<d&&0<b.Jl();)f=b.dequeue()[0],g=f.getKey(),0!==f.gb()||g in b.xq||(b.xq[g]=!0,++b.yq,++e,f.load())}}b=this.hz;c=0;for(d=b.length;c<d;++c)b[c](this,a);b.length=0};l.LF=function(){this.Ca()};
l.NF=function(){var a;this.get("target")&&(a=am(this));if(this.bm){for(var b=0,c=this.bm.length;b<c;++b)ud(this.bm[b]);this.bm=null}a?(a.appendChild(this.ac),a=this.Ux?this.Ux:a,this.bm=[J(a,"keydown",this.Tj,this),J(a,"keypress",this.Tj,this)],this.ih||(this.ih=this.zd.bind(this),window.addEventListener("resize",this.ih,!1))):(Xh(this.ac),void 0!==this.ih&&(window.removeEventListener("resize",this.ih,!1),this.ih=void 0));this.zd()};l.OF=function(){this.Ca()};l.Ix=function(){this.Ca()};
l.SF=function(){this.Nq&&(ud(this.Nq),this.Nq=null);this.Mq&&(ud(this.Mq),this.Mq=null);var a=D(this);a&&(this.ac.setAttribute("data-view",I(a)),this.Nq=J(a,"propertychange",this.Ix,this),this.Mq=J(a,"change",this.Ix,this));this.Ca()};l.vF=function(){this.hp&&(this.hp.forEach(ud),this.hp=null);var a=Zl(this);a&&(this.hp=[J(a,"propertychange",this.Ca,this),J(a,"change",this.Ca,this)]);this.Ca()};l.Ca=function(){void 0===this.di&&(this.di=requestAnimationFrame(this.sv))};l.Ig=function(a){return this.yg.remove(a)};
l.uk=function(a){return Zl(this).getLayers().remove(a)};
l.zI=function(a){var b,c,d=this.Ta(),e=D(this),f=If(),g=null;if(void 0!==d&&0<d[0]&&0<d[1]&&e&&e.$o()){var g=Kh(e,this.zc?this.zc.sf:void 0),h=Zl(this).ks(),k={};b=0;for(c=h.length;b<c;++b)k[I(h[b].layer)]=h[b];b=e.gb();g={animate:!1,jb:{},Dj:this.ZC,Z:f,focus:this.si?this.si:b.Ka,index:this.VD++,ip:k,$j:h,dk:pd({},this.DG),rc:this.Fg,fz:this.OH,Rf:[],size:d,Qm:this.ju,bK:this.OA,time:a,Lq:{},hb:b,sf:g,mn:{}}}g&&(g.Z=$f(b.Ka,b.ra,b.rotation,g.size,f));this.zc=g;this.Xt.Ut(g);g&&(g.animate&&this.Ca(),
Array.prototype.push.apply(this.hz,g.Rf),g.sf[0]||g.sf[1]||Sf(g.Z,this.kz)||(this.dispatchEvent(new Vd("moveend",this,g)),Lf(g.Z,this.kz)));this.dispatchEvent(new Vd("postrender",this,g));setTimeout(this.KF.bind(this),0)};l.Mm=function(a){this.set("size",a)};l.Dh=function(a){this.set("target",a)};l.Eh=function(a){this.set("view",a)};l.qA=function(a){a=I(a).toString();this.ju[a]=!0;this.Ca()};
l.zd=function(){var a=am(this);if(a){var b=getComputedStyle(a);this.Mm([a.offsetWidth-parseFloat(b.borderLeftWidth)-parseFloat(b.paddingLeft)-parseFloat(b.paddingRight)-parseFloat(b.borderRightWidth),a.offsetHeight-parseFloat(b.borderTopWidth)-parseFloat(b.paddingTop)-parseFloat(b.paddingBottom)-parseFloat(b.borderBottomWidth)])}else this.Mm(void 0)};l.ZA=function(a){a=I(a).toString();delete this.ju[a];this.Ca()};
function Yl(a){var b=null;void 0!==a.cm&&(b="string"===typeof a.cm?document.getElementById(a.cm):a.cm);var c={},d={};if(void 0===a.zb||"boolean"===typeof a.zb&&a.zb)d["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAHGAAABxgEXwfpGAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAhNQTFRF////AP//AICAgP//AFVVQECA////K1VVSbbbYL/fJ05idsTYJFtbbcjbJllmZszWWMTOIFhoHlNiZszTa9DdUcHNHlNlV8XRIVdiasrUHlZjIVZjaMnVH1RlIFRkH1RkH1ZlasvYasvXVsPQH1VkacnVa8vWIVZjIFRjVMPQa8rXIVVkXsXRsNveIFVkIFZlIVVj3eDeh6GmbMvXH1ZkIFRka8rWbMvXIFVkIFVjIFVkbMvWH1VjbMvWIFVlbcvWIFVla8vVIFVkbMvWbMvVH1VkbMvWIFVlbcvWIFVkbcvVbMvWjNPbIFVkU8LPwMzNIFVkbczWIFVkbsvWbMvXIFVkRnB8bcvW2+TkW8XRIFVkIlZlJVloJlpoKlxrLl9tMmJwOWd0Omh1RXF8TneCT3iDUHiDU8LPVMLPVcLPVcPQVsPPVsPQV8PQWMTQWsTQW8TQXMXSXsXRX4SNX8bSYMfTYcfTYsfTY8jUZcfSZsnUaIqTacrVasrVa8jTa8rWbI2VbMvWbcvWdJObdcvUdszUd8vVeJaee87Yfc3WgJyjhqGnitDYjaarldPZnrK2oNbborW5o9bbo9fbpLa6q9ndrL3ArtndscDDutzfu8fJwN7gwt7gxc/QyuHhy+HizeHi0NfX0+Pj19zb1+Tj2uXk29/e3uLg3+Lh3+bl4uXj4ufl4+fl5Ofl5ufl5ujm5+jmySDnBAAAAFp0Uk5TAAECAgMEBAYHCA0NDg4UGRogIiMmKSssLzU7PkJJT1JTVFliY2hrdHZ3foSFhYeJjY2QkpugqbG1tre5w8zQ09XY3uXn6+zx8vT09vf4+Pj5+fr6/P39/f3+gz7SsAAAAVVJREFUOMtjYKA7EBDnwCPLrObS1BRiLoJLnte6CQy8FLHLCzs2QUG4FjZ5GbcmBDDjxJBXDWxCBrb8aM4zbkIDzpLYnAcE9VXlJSWlZRU13koIeW57mGx5XjoMZEUqwxWYQaQbSzLSkYGfKFSe0QMsX5WbjgY0YS4MBplemI4BdGBW+DQ11eZiymfqQuXZIjqwyadPNoSZ4L+0FVM6e+oGI6g8a9iKNT3o8kVzNkzRg5lgl7p4wyRUL9Yt2jAxVh6mQCogae6GmflI8p0r13VFWTHBQ0rWPW7ahgWVcPm+9cuLoyy4kCJDzCm6d8PSFoh0zvQNC5OjDJhQopPPJqph1doJBUD5tnkbZiUEqaCnB3bTqLTFG1bPn71kw4b+GFdpLElKIzRxxgYgWNYc5SCENVHKeUaltHdXx0dZ8uBI1hJ2UUDgq82CM2MwKeibqAvSO7MCABq0wXEPiqWEAAAAAElFTkSuQmCC"]=
"https://openlayers.org/";else{var e=a.zb;"string"===typeof e?d[e]="":e instanceof HTMLElement?d[I(e).toString()]=e:e&&(af("string"==typeof e.href,44),af("string"==typeof e.src,45),d[e.src]=e.href)}e=a.rb instanceof pj?a.rb:new pj({rb:a.rb});c.layergroup=e;c.target=a.target;c.view=void 0!==a.view?a.view:new Hh;var e=Mj,f;void 0!==a.Zp?(Array.isArray(a.Zp)?f=a.Zp:"string"===typeof a.Zp?f=[a.Zp]:af(!1,46),0<=f.indexOf("dom")&&(f=f.concat(Wl))):f=Wl;var g,h;g=0;for(h=f.length;g<h;++g){var k=f[g];if("canvas"==
k){if(ke){e=Yj;break}}else if("webgl"==k&&ce){e=Rl;break}}void 0!==a.controls?Array.isArray(a.controls)?f=new Pd(a.controls.slice()):(af(a.controls instanceof Pd,47),f=a.controls):(f={},g=new Pd,(void 0!==f.zoom?f.zoom:1)&&g.push(new gi(f.BM)),(void 0!==f.rotate?f.rotate:1)&&g.push(new ei(f.qM)),(void 0!==f.attribution?f.attribution:1)&&g.push(new Zh(f.HL)),f=g);void 0!==a.Mi?Array.isArray(a.Mi)?g=new Pd(a.Mi.slice()):(af(a.Mi instanceof Pd,48),g=a.Mi):g=mj();void 0!==a.lk?Array.isArray(a.lk)?a=new Pd(a.lk.slice()):
(af(a.lk instanceof Pd,49),a=a.lk):a=new Pd;return{controls:f,Mi:g,cm:b,dk:d,lk:a,CI:e,values:c}};function di(a,b,c,d){this.Ga=a;this.Ba=b;this.Ha=c;this.Oa=d}l=di.prototype;l.contains=function(a){return this.zf(a[1],a[2])};l.zf=function(a,b){return this.Ga<=a&&a<=this.Ba&&this.Ha<=b&&b<=this.Oa};l.equals=function(a){return this.Ga==a.Ga&&this.Ha==a.Ha&&this.Ba==a.Ba&&this.Oa==a.Oa};l.extend=function(a){a.Ga<this.Ga&&(this.Ga=a.Ga);a.Ba>this.Ba&&(this.Ba=a.Ba);a.Ha<this.Ha&&(this.Ha=a.Ha);a.Oa>this.Oa&&(this.Oa=a.Oa)};l.Ta=function(){return[this.hc(),this.Oa-this.Ha+1]};
l.hc=function(){return this.Ba-this.Ga+1};function ai(a,b){return a.Ga<=b.Ba&&a.Ba>=b.Ga&&a.Ha<=b.Oa&&a.Oa>=b.Ha};function bm(a){Gd.call(this);this.jp=a}E(bm,Gd);bm.prototype.Lc=md;bm.prototype.Fr=function(a,b,c){return function(d,e){return cm(a,b,d,e,function(a){c[d]||(c[d]={});c[d][a.Rc.toString()]=a})}};bm.prototype.Ac=function(){return this.jp};bm.prototype.ys=function(a){2===a.target.gb()&&dm(this)};function em(a,b){var c=b.gb();2!=c&&3!=c&&J(b,"change",a.ys,a);0==c&&(b.load(),c=b.gb());return 2==c}function dm(a){var b=a.Ac();b.getVisible()&&"ready"==b.ss()&&a.G()}
function fm(a,b){b.hi()&&(b=function(a,b,e){b=I(a).toString();a.Ij(e.hb.la,e.Lq[b])}.bind(null,b),a.Rf.push(b))}function gm(a,b){if(b){var c,d,e;d=0;for(e=b.length;d<e;++d)c=b[d],a[I(c).toString()]=c}}function hm(a,b){b=b.py;void 0!==b&&("string"===typeof b?a.dk[b]="":b&&(af("string"==typeof b.href,44),af("string"==typeof b.src,45),a.dk[b.src]=b.href))}function im(a,b,c,d){b=I(b).toString();c=c.toString();b in a?c in a[b]?a[b][c].extend(d):a[b][c]=d:(a[b]={},a[b][c]=d)}
function jm(a,b,c,d,e,f,g,h,k,m){var p=I(b).toString();p in a.mn||(a.mn[p]={});var t=a.mn[p];a=a.bK;var v=c.ms(),w,x,y,F,H,B;for(B=g;B>=v;--B)for(x=bi(c,f,B,x),y=c.xa(B),F=x.Ga;F<=x.Ba;++F)for(H=x.Ha;H<=x.Oa;++H)g-B<=h?(w=km(b,B,F,H,d,e),0==w.gb()&&(t[w.getKey()]=!0,w.getKey()in a.$i||a.enqueue([w,p,lm(c,w.Rc),y])),void 0!==k&&k.call(m,w)):b.hB(B,F,H,e)};function mm(a){bm.call(this,a);this.kd=Cj()}E(mm,bm);mm.prototype.clip=function(a,b,c){var d=b.rc,e=b.size[0]*d,f=b.size[1]*d,g=b.hb.rotation,h=cg(c),k=[c[2],c[3]],m=[c[2],c[1]];c=[c[0],c[1]];Hj(b.Dj,h);Hj(b.Dj,k);Hj(b.Dj,m);Hj(b.Dj,c);a.save();Vj(a,-g,e/2,f/2);a.beginPath();a.moveTo(h[0]*d,h[1]*d);a.lineTo(k[0]*d,k[1]*d);a.lineTo(m[0]*d,m[1]*d);a.lineTo(c[0]*d,c[1]*d);a.clip();Vj(a,g,e/2,f/2)};
mm.prototype.Ed=function(a,b,c,d){var e=this.Ac();if(e.hasListener(a)){var f=c.size[0]*c.rc,g=c.size[1]*c.rc,h=c.hb.rotation;Vj(b,-h,f/2,g/2);void 0!==d||this.Ei(c,0);e.dispatchEvent(new Rj(a,0,c,b));Vj(b,h,f/2,g/2)}};mm.prototype.Ei=function(a,b){var c=a.hb,d=a.rc,e=d/c.ra;return Lj(this.kd,d*a.size[0]/2,d*a.size[1]/2,e,-e,-c.rotation,-c.Ka[0]+b,-c.Ka[1])};function nm(a){mm.call(this,a);this.Aw=Cj()}E(nm,mm);nm.prototype.kl=function(a,b,c){this.Ed("precompose",c,a,void 0);var d=this.na();if(d){var e=b.Z,f=void 0!==e&&!Nf(e,a.Z)&&bg(e,a.Z);f&&this.clip(c,a,e);var e=this.Wo,g=c.globalAlpha;c.globalAlpha=b.opacity;c.drawImage(d,0,0,+d.width,+d.height,Math.round(e[4]),Math.round(e[5]),Math.round(d.width*e[0]),Math.round(d.height*e[3]));c.globalAlpha=g;f&&c.restore()}this.Ed("postcompose",c,a,void 0)};
nm.prototype.Lc=function(a,b,c,d,e){var f=this.Ac();return f.v().Lc(a,b.hb.ra,b.hb.rotation,c,b.Qm,function(a){return d.call(e,a,f)})};function om(a){nm.call(this,a);this.context=null===this.context?null:Vh();this.mf=null;this.Yp=[];this.cK=If();this.fK=new di(0,0,0,0);this.Wo=Cj();this.hL=0}E(om,nm);function pm(a,b){b=b.gb();a=a.Ac().get("useInterimTilesOnError");return 2==b||4==b||3==b&&!a}
om.prototype.Yi=function(a,b){var c=a.rc,d=a.size,e=a.hb,f=e.la,g=e.ra,e=e.Ka,h=this.Ac(),k=h.v(),m=k.Sa,p=k.tg(f),t=qm(p,g,this.hL),v=p.xa(t),w=Math.round(g/v)||1,x=a.Z;void 0!==b.Z&&(x=ag(x,b.Z));if(Wf(x))return!1;b=rm(p,x,v);var y;y=p.Ff(t);var F=p.xa(t),H=Vl(sm(p,t),p.Pk);y=Pf(y[0]+b.Ga*H[0]*F,y[1]+b.Ha*H[1]*F,y[0]+(b.Ba+1)*H[0]*F,y[1]+(b.Oa+1)*H[1]*F,void 0);F=k.Sj(c);H={};H[t]={};var B=this.Fr(k,f,H),R=this.cK,N=this.fK,P=!1,K,G,ba;for(G=b.Ga;G<=b.Ba;++G)for(ba=b.Ha;ba<=b.Oa;++ba)K=km(k,t,G,
ba,c,f),pm(this,K)||(K=tm(K)),pm(this,K)?2==K.gb()&&(H[t][K.Rc.toString()]=K,P||-1!=this.Yp.indexOf(K)||(P=!0)):um(p,K.Rc,B,N,R)||(K=vm(p,K.Rc,N,R))&&B(t+1,K);K=a.sf;if(!(this.Dm&&16<Date.now()-a.time&&(K[0]||K[1])||!P&&this.mf&&Nf(this.mf,x)&&this.BI==m)||w!=this.ez){if(K=this.context)B=wm(k,t,c,f),P=Math.round(b.hc()*B[0]/w),B=Math.round((b.Oa-b.Ha+1)*B[1]/w),N=K.canvas,N.width!=P||N.height!=B?(this.ez=w,N.width=P,N.height=B):(K.clearRect(0,0,P,B),w=this.ez);this.Yp.length=0;P=Object.keys(H).map(Number);
P.sort(Ge);var Sa,Z,ga,wa,Ta,xb,N=0;for(Z=P.length;N<Z;++N){K=P[N];B=wm(k,K,c,f);Sa=p.xa(K);Sa/=v;ga=F*k.fs(f);wa=H[K];for(var Ib in wa){K=wa[Ib];ba=xm(p,K.Rc,R);G=(ba[0]-y[0])/v*F/w;ba=(y[3]-ba[3])/v*F/w;Ta=B[0]*Sa/w;xb=B[1]*Sa/w;var Oc=K,be=a,cc=ga;this.Ac().v().ns(be.hb.la)||this.context.clearRect(G,ba,Ta,xb);(Oc=Oc.na())&&this.context.drawImage(Oc,cc,cc,Oc.width-2*cc,Oc.height-2*cc,G,ba,Ta,xb);this.Yp.push(K)}}this.BI=m;this.Dm=v*c/F*w;this.mf=y}Ib=this.Dm/g;Ib=Lj(this.Wo,c*d[0]/2,c*d[1]/2,Ib,
Ib,0,(this.mf[0]-e[0])/this.Dm*c,(e[1]-this.mf[3])/this.Dm*c);Lj(this.Aw,c*d[0]/2-Ib[4],c*d[1]/2-Ib[5],c/g,-c/g,0,-e[0],-e[1]);im(a.Lq,k,t,b);jm(a,k,p,c,f,x,t,h.get("preload"));fm(a,k);hm(a,k);return 0<this.Yp.length};om.prototype.na=function(){var a=this.context;return a?a.canvas:null};function ym(){this.ob="precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform float u_opacity;\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_texture, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  gl_FragColor.a = texColor.a * u_opacity;\n}\n"}E(ym,ck);var zm=new ym;
function Am(){this.ob="varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform mat4 u_texCoordMatrix;\nuniform mat4 u_projectionMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0., 1.);\n  v_texCoord = (u_texCoordMatrix * vec4(a_texCoord, 0., 1.)).st;\n}\n\n\n"}E(Am,dk);var Bm=new Am;
function Cm(a,b){this.Rk=a.getUniformLocation(b,"u_opacity");this.Sk=a.getUniformLocation(b,"u_projectionMatrix");this.DK=a.getUniformLocation(b,"u_texCoordMatrix");this.Hu=a.getUniformLocation(b,"u_texture");this.gc=a.getAttribLocation(b,"a_position");this.dg=a.getAttribLocation(b,"a_texCoord")};function Dm(a,b){bm.call(this,b);this.Lf=a;this.wC=new rk([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);this.qo=this.Ne=null;this.ro=void 0;this.uu=Cj();this.nz=Cj();this.Ok=jk();this.Fb=null}E(Dm,bm);
Dm.prototype.bindFramebuffer=function(a,b){var c=this.Lf.Kb;if(void 0===this.ro||this.ro!=b){var d=function(a,b,c){a.isContextLost()||(a.deleteFramebuffer(b),a.deleteTexture(c))}.bind(null,c,this.qo,this.Ne);a.Rf.push(d);a=Ck(c,b,b);d=c.createFramebuffer();c.bindFramebuffer(36160,d);c.framebufferTexture2D(36160,36064,3553,a,0);this.Ne=a;this.qo=d;this.ro=b}else c.bindFramebuffer(36160,this.qo)};
Dm.prototype.kl=function(a,b,c){this.Ed("precompose",c,a);c.bindBuffer(34962,this.wC);var d=c.Kb,e=uk(c,zm,Bm),f;this.Fb?f=this.Fb:this.Fb=f=new Cm(d,e);c.useProgram(e)&&(d.enableVertexAttribArray(f.gc),d.vertexAttribPointer(f.gc,2,5126,!1,16,0),d.enableVertexAttribArray(f.dg),d.vertexAttribPointer(f.dg,2,5126,!1,16,8),d.uniform1i(f.Hu,0));d.uniformMatrix4fv(f.DK,!1,kk(this.Ok,this.uu));d.uniformMatrix4fv(f.Sk,!1,kk(this.Ok,this.nz));d.uniform1f(f.Rk,b.opacity);d.bindTexture(3553,this.Ne);d.drawArrays(5,
0,4);this.Ed("postcompose",c,a)};Dm.prototype.Ed=function(a,b,c){b=this.Ac();b.hasListener(a)&&b.dispatchEvent(new Rj(a,0,c,null))};Dm.prototype.Fi=function(){this.qo=this.Ne=null;this.ro=void 0};function Em(){this.ob="precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  gl_FragColor = texture2D(u_texture, v_texCoord);\n}\n"}E(Em,ck);var Fm=new Em;function Gm(){this.ob="varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nuniform vec4 u_tileOffset;\n\nvoid main(void) {\n  gl_Position = vec4(a_position * u_tileOffset.xy + u_tileOffset.zw, 0., 1.);\n  v_texCoord = a_texCoord;\n}\n\n\n"}E(Gm,dk);var Hm=new Gm;
function Im(a,b){this.Hu=a.getUniformLocation(b,"u_texture");this.EK=a.getUniformLocation(b,"u_tileOffset");this.gc=a.getAttribLocation(b,"a_position");this.dg=a.getAttribLocation(b,"a_texCoord")};function Jm(a,b){Dm.call(this,a,b);this.UD=Fm;this.VK=Hm;this.Cg=null;this.Cz=new rk([0,0,0,1,1,0,1,1,0,1,0,0,1,1,1,0]);this.Vt=this.Xp=null;this.wd=-1;this.Pk=[0,0]}E(Jm,Dm);Jm.prototype.ab=function(){this.Lf.getContext().deleteBuffer(this.Cz);Dm.prototype.ab.call(this)};Jm.prototype.Fr=function(a,b,c){var d=this.Lf;return function(e,f){return cm(a,b,e,f,function(a){var b=Ql(d.Sd,a.getKey());b&&(c[e]||(c[e]={}),c[e][a.Rc.toString()]=a);return b})}};
Jm.prototype.Fi=function(){Dm.prototype.Fi.call(this);this.Cg=null};
Jm.prototype.Yi=function(a,b,c){var d=this.Lf,e=c.Kb,f=a.hb,g=f.la,h=this.Ac(),k=h.v(),m=k.tg(g),p=qm(m,f.ra),t=m.xa(p),v=wm(k,p,a.rc,g),w=v[0]/Vl(sm(m,p),this.Pk)[0],x=t/w,y=k.Sj(w)*k.fs(g),F=f.Ka,H=a.Z,B=rm(m,H,t);if(this.Xp&&this.Xp.equals(B)&&this.wd==k.Sa)x=this.Vt;else{var R=B.Ta(),N=jf(Math.max(R[0]*v[0],R[1]*v[1])),R=x*N,P=m.Ff(p),K=P[0]+B.Ga*v[0]*x,x=P[1]+B.Ha*v[1]*x,x=[K,x,K+R,x+R];this.bindFramebuffer(a,N);e.viewport(0,0,N,N);e.clearColor(0,0,0,0);e.clear(16384);e.disable(3042);N=uk(c,
this.UD,this.VK);c.useProgram(N);this.Cg||(this.Cg=new Im(e,N));c.bindBuffer(34962,this.Cz);e.enableVertexAttribArray(this.Cg.gc);e.vertexAttribPointer(this.Cg.gc,2,5126,!1,16,0);e.enableVertexAttribArray(this.Cg.dg);e.vertexAttribPointer(this.Cg.dg,2,5126,!1,16,8);e.uniform1i(this.Cg.Hu,0);c={};c[p]={};var G=this.Fr(k,g,c),ba=h.get("useInterimTilesOnError"),N=!0,K=If(),Sa=new di(0,0,0,0),Z,ga,wa;for(ga=B.Ga;ga<=B.Ba;++ga)for(wa=B.Ha;wa<=B.Oa;++wa){P=km(k,p,ga,wa,w,g);if(void 0!==b.Z&&(Z=xm(m,P.Rc,
K),!bg(Z,b.Z)))continue;Z=P.gb();(Z=2==Z||4==Z||3==Z&&!ba)||(P=tm(P));Z=P.gb();if(2==Z){if(Ql(d.Sd,P.getKey())){c[p][P.Rc.toString()]=P;continue}}else if(4==Z||3==Z&&!ba)continue;N=!1;Z=um(m,P.Rc,G,Sa,K);Z||(P=vm(m,P.Rc,Sa,K))&&G(p+1,P)}b=Object.keys(c).map(Number);b.sort(Ge);for(var G=new Float32Array(4),Ta,ba=0,Sa=b.length;ba<Sa;++ba)for(Ta in ga=c[b[ba]],ga)P=ga[Ta],Z=xm(m,P.Rc,K),G[0]=2*(Z[2]-Z[0])/R,G[1]=2*(Z[3]-Z[1])/R,G[2]=2*(Z[0]-x[0])/R-1,G[3]=2*(Z[1]-x[1])/R-1,e.uniform4fv(this.Cg.EK,G),
Sl(d,P,v,y*w),e.drawArrays(5,0,4);N?(this.Xp=B,this.Vt=x,this.wd=k.Sa):(this.Vt=this.Xp=null,this.wd=-1,a.animate=!0)}im(a.Lq,k,p,B);var xb=d.Ym;jm(a,k,m,w,g,H,p,h.get("preload"),function(a){var b;(b=2!=a.gb()||Ql(d.Sd,a.getKey()))||(b=a.getKey()in xb.$i);b||xb.enqueue([a,lm(m,a.Rc),m.xa(a.Rc[0]),v,y*w])},this);fm(a,k);hm(a,k);e=this.uu;Dj(e);Kj(e,(Math.round(F[0]/t)*t-x[0])/(x[2]-x[0]),(Math.round(F[1]/t)*t-x[1])/(x[3]-x[1]));0!==f.rotation&&Ij(e,f.rotation);Jj(e,a.size[0]*f.ra/(x[2]-x[0]),a.size[1]*
f.ra/(x[3]-x[1]));Kj(e,-.5,-.5);return!0};function Km(a){a=a?a:{};var b=pd({},a);delete b.iz;delete b.gB;rj.call(this,b);this.set("preload",void 0!==a.iz?a.iz:0);this.set("useInterimTilesOnError",void 0!==a.gB?a.gB:!0)}E(Km,rj);Km.prototype.Wn=function(a){var b=null,c=a.K();"canvas"===c?b=new om(this):"webgl"===c&&(b=new Jm(a,this));return b};function Lm(a,b,c,d){return void 0!==d?(d[0]=a,d[1]=b,d[2]=c,d):[a,b,c]}function Mm(a){var b=a[0],c=Array(b),d=1<<b-1,e,f;for(e=0;e<b;++e)f=48,a[1]&d&&(f+=1),a[2]&d&&(f+=2),c[e]=String.fromCharCode(f),d>>=1;return c.join("")};function Nm(a){this.Ce=void 0!==a.Ce?a.Ce:0;this.uc=a.Ec;af(Oe(this.uc,function(a,b){return b-a}),17);this.kc=this.uc.length-1;this.Pd=void 0!==a.origin?a.origin:null;this.kk=null;void 0!==a.Hp&&(this.kk=a.Hp,af(this.kk.length==this.uc.length,20));var b=a.Z;void 0===b||this.Pd||this.kk||(this.Pd=cg(b));af(!this.Pd&&this.kk||this.Pd&&!this.kk,18);this.Nk=null;void 0!==a.wq&&(this.Nk=a.wq,af(this.Nk.length==this.uc.length,19));this.vq=void 0!==a.Ng?a.Ng:this.Nk?null:256;af(!this.vq&&this.Nk||this.vq&&
!this.Nk,22);this.te=void 0!==b?b:null;this.Mj=null;this.Pk=[0,0];void 0!==a.sizes?this.Mj=a.sizes.map(function(a){return new di(Math.min(0,a[0]),Math.max(a[0]-1,-1),Math.min(0,a[1]),Math.max(a[1]-1,-1))},this):b&&Om(this,b)}var Pm=[0,0,0];function um(a,b,c,d,e){e=xm(a,b,e);for(b=b[0]-1;b>=a.Ce;){if(c.call(null,b,bi(a,e,b,d)))return!0;--b}return!1}l=Nm.prototype;l.W=function(){return this.te};l.ux=function(){return this.kc};l.ms=function(){return this.Ce};l.Ff=function(a){return this.Pd?this.Pd:this.kk[a]};
l.xa=function(a){return this.uc[a]};l.Qj=function(){return this.uc};function vm(a,b,c,d){return b[0]<a.kc?(d=xm(a,b,d),bi(a,d,b[0]+1,c)):null}function rm(a,b,c,d){Qm(a,b[0],b[1],c,!1,Pm);var e=Pm[1],f=Pm[2];Qm(a,b[2],b[3],c,!0,Pm);a=Pm[1];b=Pm[2];void 0!==d?(d.Ga=e,d.Ba=a,d.Ha=f,d.Oa=b):d=new di(e,a,f,b);return d}function bi(a,b,c,d){c=a.xa(c);return rm(a,b,c,d)}function lm(a,b){var c=a.Ff(b[0]),d=a.xa(b[0]);a=Vl(sm(a,b[0]),a.Pk);return[c[0]+(b[1]+.5)*a[0]*d,c[1]+(b[2]+.5)*a[1]*d]}
function xm(a,b,c){var d=a.Ff(b[0]),e=a.xa(b[0]);a=Vl(sm(a,b[0]),a.Pk);var f=d[0]+b[1]*a[0]*e;b=d[1]+b[2]*a[1]*e;return Pf(f,b,f+a[0]*e,b+a[1]*e,c)}function Qm(a,b,c,d,e,f){var g=qm(a,d),h=d/a.xa(g),k=a.Ff(g);a=Vl(sm(a,g),a.Pk);b=h*Math.floor((b-k[0])/d+(e?.5:0))/a[0];c=h*Math.floor((c-k[1])/d+(e?0:.5))/a[1];e?(b=Math.ceil(b)-1,c=Math.ceil(c)-1):(b=Math.floor(b),c=Math.floor(c));return Lm(g,b,c,f)}function sm(a,b){return a.vq?a.vq:a.Nk[b]}function qm(a,b,c){return gf(He(a.uc,b,c||0),a.Ce,a.kc)}
function Om(a,b){for(var c=a.uc.length,d=Array(c),e=a.Ce;e<c;++e)d[e]=bi(a,b,e);a.Mj=d};function Rm(a){var b=a.Fw;if(!b){var b=ci(a),c=Sm(b,void 0,void 0),b=new Nm({Z:b,origin:cg(b),Ec:c,Ng:void 0});a.Fw=b}return b}function Tm(a){var b={};pd(b,void 0!==a?a:{});void 0===b.Z&&(b.Z=Gg("EPSG:3857").W());b.Ec=Sm(b.Z,b.kc,b.Ng);delete b.kc;return new Nm(b)}function Sm(a,b,c){b=void 0!==b?b:42;var d=Yf(a);a=Xf(a);c=Vl(void 0!==c?c:256);c=Math.max(a/c[0],d/c[1]);b+=1;d=Array(b);for(a=0;a<b;++a)d[a]=c/Math.pow(2,a);return d}
function ci(a){a=Gg(a);var b=a.W();b||(a=180*lg.degrees/ng(a),b=Pf(-a,-a,a,a));return b};function Um(a){this.Is=a.html;this.uq=a.PA?a.PA:null};function Vm(a,b){Fd.call(this);this.Rc=a;this.state=b;this.sd=null;this.key=""}E(Vm,Fd);Vm.prototype.G=function(){this.dispatchEvent("change")};Vm.prototype.getKey=function(){return this.key+"/"+this.Rc};function tm(a){if(!a.sd)return a;var b=a.sd;do{if(2==b.gb())return b;b=b.sd}while(b);return a}Vm.prototype.gb=function(){return this.state};function Wm(a,b,c,d,e){Vm.call(this,a,b);this.Me=c;this.ka=new Image;null!==d&&(this.ka.crossOrigin=d);this.cf=null;this.$J=e}E(Wm,Vm);l=Wm.prototype;l.ab=function(){1==this.state&&this.Qg();this.sd&&this.sd.Yd();this.state=5;this.G();Vm.prototype.ab.call(this)};l.na=function(){return this.ka};l.getKey=function(){return this.Me};l.Uj=function(){this.state=3;this.Qg();this.G()};l.Wl=function(){this.state=this.ka.naturalWidth&&this.ka.naturalHeight?2:4;this.Qg();this.G()};
l.load=function(){if(0==this.state||3==this.state)this.state=1,this.G(),this.cf=[zd(this.ka,"error",this.Uj,this),zd(this.ka,"load",this.Wl,this)],this.$J(this,this.Me)};l.Qg=function(){this.cf.forEach(ud);this.cf=null};function Xm(a){Pl.call(this);this.highWaterMark=void 0!==a?a:2048}E(Xm,Pl);Xm.prototype.hi=function(){return this.Jl()>this.highWaterMark};Xm.prototype.Ij=function(a){for(var b,c;this.hi()&&!(b=this.fe.pj,c=b.Rc[0].toString(),c in a&&a[c].contains(b.Rc));)this.pop().Yd()};function Ym(a,b,c,d){var e=Rg(c,b,a);c=Eg(b,d,c);b=ng(b);void 0!==b&&(c*=b);b=ng(a);void 0!==b&&(c/=b);a=Eg(a,c,e)/c;isFinite(a)&&0<a&&(c/=a);return c}function Zm(a,b,c,d){a=c-a;b=d-b;var e=Math.sqrt(a*a+b*b);return[Math.round(c+a/e),Math.round(d+b/e)]}
function $m(a,b,c,d,e,f,g,h,k,m,p){var t=Vh(Math.round(c*a),Math.round(c*b));if(0===k.length)return t.canvas;t.scale(c,c);var v=If();k.forEach(function(a){Tf(v,a.Z)});var w=Vh(Math.round(c*Xf(v)/d),Math.round(c*Yf(v)/d)),x=c/d;k.forEach(function(a){w.drawImage(a.Lb,m,m,a.Lb.width-2*m,a.Lb.height-2*m,(a.Z[0]-v[0])*x,-(a.Z[3]-v[3])*x,Xf(a.Z)*x,Yf(a.Z)*x)});var y=cg(g);h.Nh.forEach(function(a){var b=a.source,e=a.target,g=b[1][0],h=b[1][1],k=b[2][0],p=b[2][1];a=(e[0][0]-y[0])/f;var m=-(e[0][1]-y[1])/
f,x=(e[1][0]-y[0])/f,F=-(e[1][1]-y[1])/f,Z=(e[2][0]-y[0])/f,ga=-(e[2][1]-y[1])/f,e=b[0][0],b=b[0][1],g=g-e,h=h-b,k=k-e,p=p-b;a:{g=[[g,h,0,0,x-a],[k,p,0,0,Z-a],[0,0,g,h,F-m],[0,0,k,p,ga-m]];h=g.length;for(k=0;k<h;k++){for(var p=k,wa=Math.abs(g[k][k]),Ta=k+1;Ta<h;Ta++){var xb=Math.abs(g[Ta][k]);xb>wa&&(wa=xb,p=Ta)}if(0===wa){g=null;break a}wa=g[p];g[p]=g[k];g[k]=wa;for(p=k+1;p<h;p++)for(wa=-g[p][k]/g[k][k],Ta=k;Ta<h+1;Ta++)g[p][Ta]=k==Ta?0:g[p][Ta]+wa*g[k][Ta]}k=Array(h);for(p=h-1;0<=p;p--)for(k[p]=
g[p][h]/g[p][p],wa=p-1;0<=wa;wa--)g[wa][h]-=g[wa][p]*k[p];g=k}g&&(t.save(),t.beginPath(),k=(a+x+Z)/3,p=(m+F+ga)/3,h=Zm(k,p,a,m),x=Zm(k,p,x,F),Z=Zm(k,p,Z,ga),t.moveTo(x[0],x[1]),t.lineTo(h[0],h[1]),t.lineTo(Z[0],Z[1]),t.clip(),t.transform(g[0],g[2],g[1],g[3],a,m),t.translate(v[0]-e,v[3]-b),t.scale(d/c,-d/c),t.drawImage(w.canvas,0,0),t.restore())});p&&(t.save(),t.strokeStyle="black",t.lineWidth=1,h.Nh.forEach(function(a){var b=a.target;a=(b[0][0]-y[0])/f;var c=-(b[0][1]-y[1])/f,d=(b[1][0]-y[0])/f,e=
-(b[1][1]-y[1])/f,g=(b[2][0]-y[0])/f,b=-(b[2][1]-y[1])/f;t.beginPath();t.moveTo(d,e);t.lineTo(a,c);t.lineTo(g,b);t.closePath();t.stroke()}),t.restore());return t.canvas};function an(a,b,c,d,e){this.Kh=a;this.Lk=b;var f={},g=Pg(this.Lk,this.Kh);this.Pg=function(a){var b=a[0]+"/"+a[1];f[b]||(f[b]=g(a));return f[b]};this.xp=d;this.LD=e*e;this.Nh=[];this.zB=!1;this.JC=this.Kh.ii&&!!d&&!!this.Kh.W()&&Xf(d)==Xf(this.Kh.W());this.rf=this.Kh.W()?Xf(this.Kh.W()):null;this.CA=this.Lk.W()?Xf(this.Lk.W()):null;a=cg(c);b=[c[2],c[3]];d=[c[2],c[1]];c=[c[0],c[1]];e=this.Pg(a);var h=this.Pg(b),k=this.Pg(d),m=this.Pg(c);bn(this,a,b,d,c,e,h,k,m,10);if(this.zB){var p=Infinity;this.Nh.forEach(function(a){p=
Math.min(p,a.source[0][0],a.source[1][0],a.source[2][0])});this.Nh.forEach(function(a){if(Math.max(a.source[0][0],a.source[1][0],a.source[2][0])-p>this.rf/2){var b=[[a.source[0][0],a.source[0][1]],[a.source[1][0],a.source[1][1]],[a.source[2][0],a.source[2][1]]];b[0][0]-p>this.rf/2&&(b[0][0]-=this.rf);b[1][0]-p>this.rf/2&&(b[1][0]-=this.rf);b[2][0]-p>this.rf/2&&(b[2][0]-=this.rf);Math.max(b[0][0],b[1][0],b[2][0])-Math.min(b[0][0],b[1][0],b[2][0])<this.rf/2&&(a.source=b)}},this)}f={}}
function bn(a,b,c,d,e,f,g,h,k,m){var p=Hf([f,g,h,k]),t=a.rf?Xf(p)/a.rf:null,v=a.rf,w=a.Kh.ii&&.5<t&&1>t,x=!1;if(0<m){if(a.Lk.Ul&&a.CA)var y=Hf([b,c,d,e]),x=x|.25<Xf(y)/a.CA;!w&&a.Kh.Ul&&t&&(x|=.25<t)}if(x||!a.xp||bg(p,a.xp)){if(!(x||isFinite(f[0])&&isFinite(f[1])&&isFinite(g[0])&&isFinite(g[1])&&isFinite(h[0])&&isFinite(h[1])&&isFinite(k[0])&&isFinite(k[1])))if(0<m)x=!0;else return;if(0<m&&(x||(p=a.Pg([(b[0]+d[0])/2,(b[1]+d[1])/2]),v=w?(mf(f[0],v)+mf(h[0],v))/2-mf(p[0],v):(f[0]+h[0])/2-p[0],p=(f[1]+
h[1])/2-p[1],x=v*v+p*p>a.LD),x)){Math.abs(b[0]-d[0])<=Math.abs(b[1]-d[1])?(w=[(c[0]+d[0])/2,(c[1]+d[1])/2],v=a.Pg(w),p=[(e[0]+b[0])/2,(e[1]+b[1])/2],t=a.Pg(p),bn(a,b,c,w,p,f,g,v,t,m-1),bn(a,p,w,d,e,t,v,h,k,m-1)):(w=[(b[0]+c[0])/2,(b[1]+c[1])/2],v=a.Pg(w),p=[(d[0]+e[0])/2,(d[1]+e[1])/2],t=a.Pg(p),bn(a,b,w,p,e,f,v,t,k,m-1),bn(a,w,c,d,p,v,g,h,t,m-1));return}if(w){if(!a.JC)return;a.zB=!0}a.Nh.push({source:[f,h,k],target:[b,d,e]});a.Nh.push({source:[f,g,h],target:[b,c,d]})}}
function cn(a){var b=If();a.Nh.forEach(function(a){a=a.source;Jf(b,a[0]);Jf(b,a[1]);Jf(b,a[2])});return b};function dn(a,b,c,d,e,f,g,h,k,m,p){Vm.call(this,e,0);this.yI=void 0!==p?p:!1;this.Fg=g;this.Io=h;this.ja=null;this.qq=b;this.tq=d;this.Qq=f?f:e;this.Ik=[];this.Jk=null;this.rq=0;f=xm(d,this.Qq);h=this.tq.W();e=this.qq.W();f=h?ag(f,h):f;if(0===Vf(f))this.state=4;else if((h=a.W())&&(e=e?ag(e,h):h),d=d.xa(this.Qq[0]),d=Ym(a,c,Zf(f),d),!isFinite(d)||0>=d)this.state=4;else if(this.Qk=new an(a,c,f,e,d*(void 0!==m?m:.5)),0===this.Qk.Nh.length)this.state=4;else if(this.rq=qm(b,d),c=cn(this.Qk),e&&(a.ii?(c[1]=
gf(c[1],e[1],e[3]),c[3]=gf(c[3],e[1],e[3])):c=ag(c,e)),Vf(c)){a=bi(b,c,this.rq);for(b=a.Ga;b<=a.Ba;b++)for(c=a.Ha;c<=a.Oa;c++)(m=k(this.rq,b,c,g))&&this.Ik.push(m);0===this.Ik.length&&(this.state=4)}else this.state=4}E(dn,Vm);dn.prototype.ab=function(){1==this.state&&(this.Jk.forEach(ud),this.Jk=null);Vm.prototype.ab.call(this)};dn.prototype.na=function(){return this.ja};
dn.prototype.Fm=function(){var a=[];this.Ik.forEach(function(b){b&&2==b.gb()&&a.push({Z:xm(this.qq,b.Rc),Lb:b.na()})},this);this.Ik.length=0;if(0===a.length)this.state=3;else{var b=this.Qq[0],c=sm(this.tq,b),d="number"===typeof c?c:c[0],c="number"===typeof c?c:c[1],b=this.tq.xa(b),e=this.qq.xa(this.rq),f=xm(this.tq,this.Qq);this.ja=$m(d,c,this.Fg,e,this.qq.W(),b,f,this.Qk,a,this.Io,this.yI);this.state=2}this.G()};
dn.prototype.load=function(){if(0==this.state){this.state=1;this.G();var a=0;this.Jk=[];this.Ik.forEach(function(b){var c=b.gb();if(0==c||1==c){a++;var d;d=J(b,"change",function(){var c=b.gb();if(2==c||3==c||4==c)ud(d),a--,0===a&&(this.Jk.forEach(ud),this.Jk=null,this.Fm())},this);this.Jk.push(d)}},this);this.Ik.forEach(function(a){0==a.gb()&&a.load()});0===a&&setTimeout(this.Fm.bind(this),0)}};function en(a,b){var c=/\{z\}/g,d=/\{x\}/g,e=/\{y\}/g,f=/\{-y\}/g;return function(g){if(g)return a.replace(c,g[0].toString()).replace(d,g[1].toString()).replace(e,function(){return(-g[2]-1).toString()}).replace(f,function(){var a=b.Mj?b.Mj[g[0]]:null;af(a,55);return(a.Oa-a.Ha+1+g[2]).toString()})}}function fn(a,b){for(var c=a.length,d=Array(c),e=0;e<c;++e)d[e]=en(a[e],b);return gn(d)}function gn(a){return 1===a.length?a[0]:function(b,c,d){if(b)return a[mf((b[1]<<b[0])+b[2],a.length)](b,c,d)}}
function hn(){}function jn(a){var b=[],c=/\{([a-z])-([a-z])\}/.exec(a);if(c){var d=c[2].charCodeAt(0),e;for(e=c[1].charCodeAt(0);e<=d;++e)b.push(a.replace(c[0],String.fromCharCode(e)));return b}if(c=c=/\{(\d+)-(\d+)\}/.exec(a)){d=parseInt(c[2],10);for(e=parseInt(c[1],10);e<=d;e++)b.push(a.replace(c[0],e.toString()));return b}b.push(a);return b};function kn(a){Jd.call(this);this.sk=Gg(a.la);this.wf=ln(a.jb);this.py=a.zb;this.T=void 0!==a.state?a.state:"ready";this.Pq=void 0!==a.ib?a.ib:!1}E(kn,Jd);function ln(a){if("string"===typeof a)return[new Um({html:a})];if(a instanceof Um)return[a];if(Array.isArray(a)){for(var b=a.length,c=Array(b),d=0;d<b;d++){var e=a[d];c[d]="string"===typeof e?new Um({html:e}):e}return c}return null}kn.prototype.Lc=md;kn.prototype.D=function(){return this.sk};kn.prototype.gb=function(){return this.T};
kn.prototype.refresh=function(){this.G()};function mn(a){kn.call(this,{jb:a.jb,Z:a.Z,zb:a.zb,la:a.la,state:a.state,ib:a.ib});this.AH=void 0!==a.Ee?a.Ee:!1;this.aK=void 0!==a.Xf?a.Xf:1;this.Ub=void 0!==a.Ub?a.Ub:null;this.Td=new Xm(a.Bd);this.Zm=[0,0];this.nh=""}E(mn,kn);l=mn.prototype;l.hi=function(){return this.Td.hi()};l.Ij=function(a,b){(a=this.Rl(a))&&a.Ij(b)};
function cm(a,b,c,d,e){b=a.Rl(b);if(!b)return!1;for(var f=!0,g,h,k=d.Ga;k<=d.Ba;++k)for(var m=d.Ha;m<=d.Oa;++m)g=a.Pj(c,k,m),h=!1,Ql(b,g)&&(g=b.get(g),(h=2===g.gb())&&(h=!1!==e(g))),h||(f=!1);return f}l.fs=function(){return 0};l.getKey=function(){return this.nh};function nn(a,b){a.nh!==b&&(a.nh=b,a.G())}l.Pj=function(a,b,c){return a+"/"+b+"/"+c};l.ns=function(){return this.AH};l.Qj=function(){return this.Ub.Qj()};l.tg=function(a){return this.Ub?this.Ub:Rm(a)};
l.Rl=function(a){var b=this.D();return b&&!Og(b,a)?null:this.Td};l.Sj=function(){return this.aK};function wm(a,b,c,d){d=a.tg(d);c=a.Sj(c);b=Vl(sm(d,b),a.Zm);return 1==c?b:Ul(b,c,a.Zm)}
function on(a,b,c){var d=void 0!==c?c:a.D();c=a.tg(d);if(a.Pq&&d.Ul){var e=b;a=e[0];b=lm(c,e);d=ci(d);Of(d,b[0],b[1])?b=e:(e=Xf(d),b[0]+=e*Math.ceil((d[0]-b[0])/e),d=c.xa(a),b=Qm(c,b[0],b[1],d,!1,void 0))}e=b[0];d=b[1];a=b[2];if(c.ms()>e||e>c.ux())c=!1;else{var f=c.W();c=(c=f?bi(c,f,e):c.Mj?c.Mj[e]:null)?c.zf(d,a):!0}return c?b:null}l.refresh=function(){this.Td.clear();this.G()};l.hB=md;function pn(a,b){Dd.call(this,a);this.tile=b}E(pn,Dd);function qn(a){mn.call(this,{jb:a.jb,Bd:a.Bd,Z:a.Z,zb:a.zb,Ee:a.Ee,la:a.la,state:a.state,Ub:a.Ub,Xf:a.Xf,ib:a.ib});this.ad=a.ad;this.Yf=this.Kj?this.Kj.bind(this):hn;this.$b=null;a.$b?this.hu(a.$b):a.url&&this.mA(a.url);a.Yf&&rn(this,a.Yf)}E(qn,mn);qn.prototype.Mo=function(a){a=a.target;switch(a.gb()){case 1:this.dispatchEvent(new pn("tileloadstart",a));break;case 2:this.dispatchEvent(new pn("tileloadend",a));break;case 3:this.dispatchEvent(new pn("tileloaderror",a))}};
function rn(a,b,c){a.Yf=b;"undefined"!==typeof c?nn(a,c):a.G()}qn.prototype.mA=function(a){var b=this.$b=jn(a);rn(this,this.Kj?this.Kj.bind(this):fn(b,this.Ub),a)};qn.prototype.hu=function(a){this.$b=a;var b=a.join("\n");rn(this,this.Kj?this.Kj.bind(this):fn(a,this.Ub),b)};qn.prototype.hB=function(a,b,c){a=this.Pj(a,b,c);Ql(this.Td,a)&&this.Td.get(a)};function sn(a){qn.call(this,{jb:a.jb,Bd:a.Bd,Z:a.Z,zb:a.zb,Ee:a.Ee,la:a.la,state:a.state,Ub:a.Ub,ad:a.ad?a.ad:tn,Xf:a.Xf,Yf:a.Yf,url:a.url,$b:a.$b,ib:a.ib});this.crossOrigin=void 0!==a.crossOrigin?a.crossOrigin:null;this.Xm=void 0!==a.Xm?a.Xm:Wm;this.lj={};this.yu={};this.DI=a.Uf;this.AI=!1}E(sn,qn);l=sn.prototype;l.hi=function(){if(this.Td.hi())return!0;for(var a in this.lj)if(this.lj[a].hi())return!0;return!1};
l.Ij=function(a,b){a=this.Rl(a);this.Td.Ij(this.Td==a?b:{});for(var c in this.lj){var d=this.lj[c];d.Ij(d==a?b:{})}};l.fs=function(a){return this.D()&&a&&!Og(this.D(),a)?0:this.gs()};l.gs=function(){return 0};l.ns=function(a){return this.D()&&a&&!Og(this.D(),a)?!1:qn.prototype.ns.call(this,a)};l.tg=function(a){var b=this.D();return!this.Ub||b&&!Og(b,a)?(b=I(a).toString(),b in this.yu||(this.yu[b]=Rm(a)),this.yu[b]):this.Ub};
l.Rl=function(a){var b=this.D();if(!b||Og(b,a))return this.Td;a=I(a).toString();a in this.lj||(this.lj[a]=new Xm(this.Td.highWaterMark));return this.lj[a]};function un(a,b,c,d,e,f,g){b=[b,c,d];e=(c=on(a,b,f))?a.Yf(c,e,f):void 0;e=new a.Xm(b,void 0!==e?0:4,void 0!==e?e:"",a.crossOrigin,a.ad);e.key=g;J(e,"change",a.Mo,a);return e}
function km(a,b,c,d,e,f){if(a.D()&&f&&!Og(a.D(),f)){var g=a.Rl(f);d=[b,c,d];var h;b=a.Pj.apply(a,d);Ql(g,b)&&(h=g.get(b));c=a.getKey();if(h&&h.key==c)return h;var k=a.D(),m=a.tg(k),p=a.tg(f),t=on(a,d,f);a=new dn(k,m,f,p,d,t,a.Sj(e),a.gs(),function(a,b,c,d){return vn(this,a,b,c,d,k)}.bind(a),a.DI,a.AI);a.key=c;h?(a.sd=h,g.replace(b,a)):g.set(b,a);return a}return vn(a,b,c,d,e,f)}
function vn(a,b,c,d,e,f){var g,h=a.Pj(b,c,d),k=a.getKey();if(Ql(a.Td,h)){if(g=a.Td.get(h),g.key!=k){var m=g;g=un(a,b,c,d,e,f,k);0==m.gb()?g.sd=m.sd:g.sd=m;if(g.sd){b=g.sd;c=g;do{if(2==b.gb()){b.sd=null;break}else 1==b.gb()?c=b:0==b.gb()?c.sd=b.sd:c=b;b=c.sd}while(b)}a.Td.replace(h,g)}}else g=un(a,b,c,d,e,f,k),a.Td.set(h,g);return g}function tn(a,b){a.na().src=b};function wn(a){a=a||{};var b=void 0!==a.la?a.la:"EPSG:3857",c=void 0!==a.Ub?a.Ub:Tm({Z:ci(b),kc:a.kc,Ce:a.Ce,Ng:a.Ng});sn.call(this,{jb:a.jb,Bd:a.Bd,crossOrigin:a.crossOrigin,zb:a.zb,Ee:a.Ee,la:b,Uf:a.Uf,Ub:c,ad:a.ad,Xf:a.Xf,Yf:a.Yf,url:a.url,$b:a.$b,ib:void 0!==a.ib?a.ib:!0})}E(wn,sn);function xn(a){a=a||{};wn.call(this,{jb:void 0!==a.jb?a.jb:[yn],Bd:a.Bd,crossOrigin:void 0!==a.crossOrigin?a.crossOrigin:"anonymous",Ee:void 0!==a.Ee?a.Ee:!0,kc:void 0!==a.kc?a.kc:19,Uf:a.Uf,ad:a.ad,url:void 0!==a.url?a.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",ib:a.ib})}E(xn,wn);var yn=new Um({html:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.'});function zn(a){this.ge=a.opacity;this.Pc=a.ke;this.Fc=a.rotation;this.gd=a.scale;this.qf=a.pf}l=zn.prototype;l.rg=function(){return this.ge};l.Gb=function(){return this.Fc};l.fb=function(){return this.gd};l.Dk=function(a){this.ge=a};l.Lm=function(a){this.Fc=a};l.le=function(a){this.gd=a};function An(a){this.So=this.ja=this.cd=null;this.pa=void 0!==a.fill?a.fill:null;this.Pd=[0,0];this.Ab=a.gz;this.Ia=void 0!==a.tb?a.tb:a.kM;this.Fe=void 0!==a.oz?a.oz:this.Ia;this.Ve=void 0!==a.angle?a.angle:0;this.ha=void 0!==a.stroke?a.stroke:null;this.Wj=this.yd=this.Hc=null;this.Cn=a.Bn;this.Bm(this.Cn);zn.call(this,{opacity:1,ke:void 0!==a.ke?a.ke:!1,rotation:void 0!==a.rotation?a.rotation:0,scale:1,pf:void 0!==a.pf?a.pf:!0})}E(An,zn);l=An.prototype;
l.clone=function(){var a=new An({fill:this.pa?this.pa.clone():void 0,gz:this.Fe!==this.bf()?this.Bi()/2:this.Bi(),tb:this.bf(),oz:this.Fe,angle:this.Ve,pf:this.qf,stroke:this.ha?this.ha.clone():void 0,rotation:this.Gb(),ke:this.Pc,Bn:this.Cn});a.Dk(this.rg());a.le(this.fb());return a};l.Il=function(){return this.Hc};l.vo=function(){return this.pa};l.Ll=function(){return this.So};l.na=function(){return this.ja};l.yo=function(){return this.Wj};l.zi=function(){return 2};l.Ff=function(){return this.Pd};
l.Bi=function(){return this.Ab};l.bf=function(){return this.Ia};l.Ta=function(){return this.yd};l.Fo=function(){return this.ha};l.dy=function(){};l.load=function(){};l.XA=function(){};
l.Bm=function(a){var b="",c="",d=0,e=null,f,g=0;this.ha&&(f=this.ha.ma,null===f&&(f=Uj),f=Wj(f),g=this.ha.hc(),void 0===g&&(g=1),e=this.ha.getLineDash(),je||(e=null),c=this.ha.sh,void 0===c&&(c="round"),b=this.ha.qh,void 0===b&&(b="round"),d=this.ha.wh,void 0===d&&(d=10));var h=2*(this.Ia+g)+1,b={strokeStyle:f,xA:g,size:h,lineCap:b,bb:e,lineJoin:c,miterLimit:d};if(void 0===a){var k=Vh(h,h);this.ja=k.canvas;a=h=this.ja.width;this.nc(b,k,0,0);this.pa?this.So=this.ja:(k=Vh(b.size,b.size),this.So=k.canvas,
this.Lw(b,k,0,0))}else h=Math.round(h),(c=!this.pa)&&(k=this.Lw.bind(this,b)),d=this.fh(),k=a.add(d,h,h,this.nc.bind(this,b),k),this.ja=k.Lb,this.Pd=[k.offsetX,k.offsetY],a=k.Lb.width,this.So=c?k.aM:this.ja;this.Hc=[h/2,h/2];this.yd=[h,h];this.Wj=[a,a]};
l.nc=function(a,b,c,d){var e;b.setTransform(1,0,0,1,0,0);b.translate(c,d);b.beginPath();if(Infinity===this.Ab)b.arc(a.size/2,a.size/2,this.Ia,0,2*Math.PI,!0);else for(this.Fe!==this.Ia&&(this.Ab*=2),c=0;c<=this.Ab;c++)d=2*c*Math.PI/this.Ab-Math.PI/2+this.Ve,e=0===c%2?this.Ia:this.Fe,b.lineTo(a.size/2+e*Math.cos(d),a.size/2+e*Math.sin(d));this.pa&&(c=this.pa.ma,null===c&&(c=Sj),b.fillStyle=Wj(c),b.fill());this.ha&&(b.strokeStyle=a.strokeStyle,b.lineWidth=a.xA,a.bb&&b.setLineDash(a.bb),b.lineCap=a.lineCap,
b.lineJoin=a.lineJoin,b.miterLimit=a.miterLimit,b.stroke());b.closePath()};
l.Lw=function(a,b,c,d){b.setTransform(1,0,0,1,0,0);b.translate(c,d);b.beginPath();if(Infinity===this.Ab)b.arc(a.size/2,a.size/2,this.Ia,0,2*Math.PI,!0);else{this.Fe!==this.Ia&&(this.Ab*=2);var e;for(c=0;c<=this.Ab;c++)e=2*c*Math.PI/this.Ab-Math.PI/2+this.Ve,d=0===c%2?this.Ia:this.Fe,b.lineTo(a.size/2+d*Math.cos(e),a.size/2+d*Math.sin(e))}b.fillStyle=Sj;b.fill();this.ha&&(b.strokeStyle=a.strokeStyle,b.lineWidth=a.xA,a.bb&&b.setLineDash(a.bb),b.stroke());b.closePath()};
l.fh=function(){var a=this.ha?this.ha.fh():"-",b=this.pa?this.pa.fh():"-";this.cd&&a==this.cd[1]&&b==this.cd[2]&&this.Ia==this.cd[3]&&this.Fe==this.cd[4]&&this.Ve==this.cd[5]&&this.Ab==this.cd[6]||(this.cd=["r"+a+b+(void 0!==this.Ia?this.Ia.toString():"-")+(void 0!==this.Fe?this.Fe.toString():"-")+(void 0!==this.Ve?this.Ve.toString():"-")+(void 0!==this.Ab?this.Ab.toString():"-"),a,b,this.Ia,this.Fe,this.Ve,this.Ab]);return this.cd[0]};function Bn(a){a=a||{};An.call(this,{gz:Infinity,fill:a.fill,tb:a.tb,pf:a.pf,stroke:a.stroke,Bn:a.Bn})}E(Bn,An);Bn.prototype.clone=function(){var a=new Bn({fill:this.pa?this.pa.clone():void 0,stroke:this.ha?this.ha.clone():void 0,tb:this.bf(),pf:this.qf,Bn:this.Cn});a.Dk(this.rg());a.le(this.fb());return a};Bn.prototype.hA=function(a){this.Ia=a;this.Bm(this.Cn)};function Cn(a){a=a||{};this.ma=void 0!==a.color?a.color:null;this.Cd=void 0}Cn.prototype.clone=function(){var a=this.ma;return new Cn({color:a&&a.slice?a.slice():a||void 0})};Cn.prototype.fh=function(){void 0===this.Cd&&(this.Cd=this.ma instanceof CanvasPattern||this.ma instanceof CanvasGradient?I(this.ma).toString():"f"+(this.ma?xj(this.ma):"-"));return this.Cd};function Dn(a){a=a||{};this.wi=null;this.we=En;void 0!==a.geometry&&this.$c(a.geometry);this.pa=void 0!==a.fill?a.fill:null;this.ka=void 0!==a.Lb?a.Lb:null;this.ha=void 0!==a.stroke?a.stroke:null;this.Da=void 0!==a.text?a.text:null;this.FB=a.zIndex}l=Dn.prototype;l.clone=function(){var a=this.j();a&&a.clone&&(a=a.clone());return new Dn({geometry:a,fill:this.pa?this.pa.clone():void 0,Lb:this.na()?this.na().clone():void 0,stroke:this.ha?this.ha.clone():void 0,text:this.Da?this.Da.clone():void 0,zIndex:this.Vc()})};
l.j=function(){return this.wi};l.vo=function(){return this.pa};l.cA=function(a){this.pa=a};l.na=function(){return this.ka};l.gq=function(a){this.ka=a};l.Fo=function(){return this.ha};l.kA=function(a){this.ha=a};l.Nm=function(a){this.Da=a};l.Vc=function(){return this.FB};l.$c=function(a){"function"===typeof a?this.we=a:"string"===typeof a?this.we=function(b){return b.get(a)}:a?void 0!==a&&(this.we=function(){return a}):this.we=En;this.wi=a};l.nA=function(a){this.FB=a};
function Fn(a){if("function"!==typeof a){var b;Array.isArray(a)?b=a:(af(a instanceof Dn,41),b=[a]);a=function(){return b}}return a}var Gn=null;function Hn(){if(!Gn){var a=new Cn({color:"rgba(255,255,255,0.4)"}),b=new gl({color:"#3399CC",width:1.25});Gn=[new Dn({Lb:new Bn({fill:a,stroke:b,tb:5}),fill:a,stroke:b})]}return Gn}
function In(){var a={},b=[255,255,255,1],c=[0,153,255,1];a.Polygon=[new Dn({fill:new Cn({color:[255,255,255,.5]})})];a.MultiPolygon=a.Polygon;a.LineString=[new Dn({stroke:new gl({color:b,width:5})}),new Dn({stroke:new gl({color:c,width:3})})];a.MultiLineString=a.LineString;a.Circle=a.Polygon.concat(a.LineString);a.Point=[new Dn({Lb:new Bn({tb:6,fill:new Cn({color:c}),stroke:new gl({color:b,width:1.5})}),zIndex:Infinity})];a.MultiPoint=a.Point;a.GeometryCollection=a.Polygon.concat(a.LineString,a.Point);
return a}function En(a){return a.j()};var Jn=document.implementation.createDocument("","",null);function Kn(a){return Ln(a,!1,[]).join("")}function Ln(a,b,c){if(a.nodeType==Node.CDATA_SECTION_NODE||a.nodeType==Node.TEXT_NODE)b?c.push(String(a.nodeValue).replace(/(\r\n|\r|\n)/g,"")):c.push(a.nodeValue);else for(a=a.firstChild;a;a=a.nextSibling)Ln(a,b,c);return c}function Mn(a){return(new DOMParser).parseFromString(a,"application/xml")}function Nn(a,b){return function(c,d){c=a.call(b,c,d);void 0!==c&&Ie(d[d.length-1],c)}}
function On(a,b){return function(c,d){c=a.call(void 0!==b?b:this,c,d);void 0!==c&&d[d.length-1].push(c)}}function Pn(a){return function(b,c){b=a.call(this,b,c);void 0!==b&&(c[c.length-1]=b)}}function Qn(a){return function(b,c){var d=a.call(this,b,c);void 0!==d&&(c=c[c.length-1],b=b.localName,(b in c?c[b]:c[b]=[]).push(d))}}function L(a,b){return function(c,d){var e=a.call(this,c,d);void 0!==e&&(d[d.length-1][void 0!==b?b:c.localName]=e)}}
function M(a){return function(b,c,d){a.call(this,b,c,d);d[d.length-1].node.appendChild(b)}}function Rn(a){var b,c;return function(d,e,f){if(void 0===b){b={};var g={};g[d.localName]=a;b[d.namespaceURI]=g;c=Sn(d.localName)}Tn(b,c,e,f)}}function Sn(a){return function(b,c,d){b=c[c.length-1].node;c=a;void 0===c&&(c=d);return Jn.createElementNS(b.namespaceURI,c)}}var Un=Sn();function Vn(a,b){for(var c=b.length,d=Array(c),e=0;e<c;++e)d[e]=a[b[e]];return d}
function O(a,b,c){c=void 0!==c?c:{};var d,e;d=0;for(e=a.length;d<e;++d)c[a[d]]=b;return c}function Wn(a,b,c,d){for(b=b.firstElementChild;b;b=b.nextElementSibling){var e=a[b.namespaceURI];void 0!==e&&(e=e[b.localName],void 0!==e&&e.call(d,b,c))}}function Q(a,b,c,d,e){d.push(a);Wn(b,c,d,e);return d.pop()}function Tn(a,b,c,d,e,f){for(var g=(void 0!==e?e:c).length,h,k,m=0;m<g;++m)h=c[m],void 0!==h&&(k=b.call(f,h,d,void 0!==e?e[m]:void 0),void 0!==k&&a[k.namespaceURI][k.localName].call(f,k,h,d))}
function Xn(a,b,c,d,e,f,g){e.push(a);Tn(b,c,d,e,f,g);e.pop()};function Yn(a,b,c){return function(d,e,f){var g=new XMLHttpRequest;g.open("GET","function"===typeof a?a(d,e,f):a,!0);"arraybuffer"==b.K()&&(g.responseType="arraybuffer");g.onload=function(){if(!g.status||200<=g.status&&300>g.status){var a=b.K(),d;"json"==a||"text"==a?d=g.responseText:"xml"==a?(d=g.responseXML)||(d=Mn(g.responseText)):"arraybuffer"==a&&(d=g.response);d&&c.call(this,b.bj(d,{Kc:f}),b.Qp(d))}}.bind(this);g.onerror=function(){}.bind(this);g.send()}}
function Zn(a,b){return Yn(a,b,function(a){this.ai(a)})};function $n(){return[[-Infinity,-Infinity,Infinity,Infinity]]};function ao(a){a=a||{};kn.call(this,{jb:a.jb,zb:a.zb,la:void 0,state:"ready",ib:void 0!==a.ib?a.ib:!0});this.em=md;this.po=a.format;this.Jp=void 0==a.yt?!0:a.yt;this.Pe=a.url;void 0!==a.xG?this.em=a.xG:void 0!==this.Pe&&(af(this.po,7),this.em=Zn(this.Pe,this.po));this.KJ=void 0!==a.JJ?a.JJ:$n;var b=void 0!==a.Ph?a.Ph:!0;this.cc=b?new rl:null;this.jy=new rl;this.Nd={};this.If={};this.Oh={};this.Jj={};this.Cb=null;var c,d;a.features instanceof Pd?(c=a.features,d=c.R()):Array.isArray(a.features)&&(d=
a.features);b||void 0!==c||(c=new Pd(d));void 0!==d&&bo(this,d);void 0!==c&&co(this,c)}E(ao,kn);l=ao.prototype;l.Gc=function(a){var b=I(a).toString();if(eo(this,b,a)){fo(this,b,a);var c=a.j();c?(b=c.W(),this.cc&&this.cc.Bc(b,a)):this.Nd[b]=a;this.dispatchEvent(new go("addfeature",a))}this.G()};function fo(a,b,c){a.Jj[b]=[J(c,"change",a.Vl,a),J(c,"propertychange",a.Vl,a)]}
function eo(a,b,c){var d=!0,e=c.Wb();void 0!==e?e.toString()in a.If?d=!1:a.If[e.toString()]=c:(af(!(b in a.Oh),30),a.Oh[b]=c);return d}l.ai=function(a){bo(this,a);this.G()};function bo(a,b){var c,d,e,f,g=[],h=[],k=[];d=0;for(e=b.length;d<e;d++)f=b[d],c=I(f).toString(),eo(a,c,f)&&h.push(f);d=0;for(e=h.length;d<e;d++)f=h[d],c=I(f).toString(),fo(a,c,f),(b=f.j())?(c=b.W(),g.push(c),k.push(f)):a.Nd[c]=f;a.cc&&a.cc.load(g,k);d=0;for(e=h.length;d<e;d++)a.dispatchEvent(new go("addfeature",h[d]))}
function co(a,b){var c=!1;J(a,"addfeature",function(a){c||(c=!0,b.push(a.za),c=!1)});J(a,"removefeature",function(a){c||(c=!0,b.remove(a.za),c=!1)});J(b,"add",function(a){c||(c=!0,this.Gc(a.element),c=!1)},a);J(b,"remove",function(a){c||(c=!0,this.fc(a.element),c=!1)},a);a.Cb=b}
l.clear=function(a){if(a){for(var b in this.Jj)this.Jj[b].forEach(ud);this.Cb||(this.Jj={},this.If={},this.Oh={})}else if(this.cc){this.cc.forEach(this.Mt,this);for(var c in this.Nd)this.Mt(this.Nd[c])}this.Cb&&this.Cb.clear();this.cc&&this.cc.clear();this.jy.clear();this.Nd={};this.dispatchEvent(new go("clear"));this.G()};function ho(a,b,c,d){a.cc?ul(a.cc,b,c,d):a.Cb&&a.Cb.forEach(c,d)}l.wa=function(){var a;this.Cb?a=this.Cb.R():this.cc&&(a=this.cc.getAll(),sd(this.Nd)||Ie(a,rd(this.Nd)));return a};
l.W=function(a){return this.cc.W(a)};l.Qj=function(){};l.Vl=function(a){a=a.target;var b=I(a).toString(),c=a.j();c?(c=c.W(),b in this.Nd?(delete this.Nd[b],this.cc&&this.cc.Bc(c,a)):this.cc&&this.cc.update(c,a)):b in this.Nd||(this.cc&&this.cc.remove(a),this.Nd[b]=a);c=a.Wb();void 0!==c?(c=c.toString(),b in this.Oh?(delete this.Oh[b],this.If[c]=a):this.If[c]!==a&&(io(this,a),this.If[c]=a)):b in this.Oh||(io(this,a),this.Oh[b]=a);this.G();this.dispatchEvent(new go("changefeature",a))};
l.df=function(){return this.cc.df()&&sd(this.Nd)};function jo(a,b,c,d){var e=a.jy;b=a.KJ(b,c);var f,g;f=0;for(g=b.length;f<g;++f){var h=b[f];ul(e,h,function(a){return Nf(a.Z,h)})||(a.em.call(a,h,c,d),e.Bc(h,{Z:h.slice()}))}}l.fc=function(a){var b=I(a).toString();b in this.Nd?delete this.Nd[b]:this.cc&&this.cc.remove(a);this.Mt(a);this.G()};
l.Mt=function(a){var b=I(a).toString();this.Jj[b].forEach(ud);delete this.Jj[b];var c=a.Wb();void 0!==c?delete this.If[c.toString()]:delete this.Oh[b];this.dispatchEvent(new go("removefeature",a))};function io(a,b){for(var c in a.If)if(a.If[c]===b){delete a.If[c];break}}function go(a,b){Dd.call(this,a);this.za=b}E(go,Dd);function ko(a,b,c,d){this.TA=a;this.fk=b;this.yt=d;this.uh=0;this.ra=c;this.Gn=this.Fn=null;this.Mb=[];this.coordinates=[];this.Wt=Cj();this.nb=[];this.tm=null;this.eK=Cj();this.Jz=Cj()}E(ko,Xj);
function lo(a,b,c,d,e,f,g){var h=a.coordinates.length,k=a.cs();g&&(c+=e);g=[b[c],b[c+1]];var m=[NaN,NaN],p=!0,t,v,w;for(t=c+e;t<d;t+=e){m[0]=b[t];m[1]=b[t+1];w=k[1];var x=k[2],y=k[3],F=m[0],H=m[1],B=0;F<k[0]?B|=16:F>x&&(B|=4);H<w?B|=8:H>y&&(B|=2);0===B&&(B=1);w=B;w!==v?(p&&(a.coordinates[h++]=g[0],a.coordinates[h++]=g[1]),a.coordinates[h++]=m[0],a.coordinates[h++]=m[1],p=!1):1===w?(a.coordinates[h++]=m[0],a.coordinates[h++]=m[1],p=!1):p=!0;g[0]=m[0];g[1]=m[1];v=w}if(f&&p||t===c+e)a.coordinates[h++]=
g[0],a.coordinates[h++]=g[1];return h}function mo(a,b){a.Fn=[0,b,0];a.Mb.push(a.Fn);a.Gn=[0,b,0];a.nb.push(a.Gn)}ko.prototype.pa=function(a,b){if(this.Zr){var c=Hj(this.Wt,this.Zr.slice());a.translate(c[0],c[1]);a.rotate(b)}a.fill();this.Zr&&a.setTransform.apply(a,this.Jz)};
function no(a,b,c,d,e,f,g,h,k){var m;a.tm&&Ke(d,a.Wt)?m=a.tm:(a.tm||(a.tm=[]),m=Ug(a.coordinates,a.coordinates.length,d,a.tm),Gj(a.Wt,d));d=!sd(f);for(var p=0,t=g.length,v=0,w,x=a.eK,y=a.Jz,F,H,B,R,N=0,P=0,K=a.Mb!=g||a.yt?0:200;p<t;){var G=g[p],ba,Sa,Z,ga;switch(G[0]){case 0:v=G[1];d&&f[I(v).toString()]||!v.j()?p=G[2]:void 0===k||bg(k,v.j().W())?++p:p=G[2]+1;break;case 1:N>K&&(a.pa(b,e),N=0);P>K&&(b.stroke(),P=0);N||P||(b.beginPath(),F=H=NaN);++p;break;case 2:v=G[1];w=m[v];G=m[v+1];B=m[v+2]-w;v=m[v+
3]-G;v=Math.sqrt(B*B+v*v);b.moveTo(w+v,G);b.arc(w,G,v,0,2*Math.PI,!0);++p;break;case 3:b.closePath();++p;break;case 4:v=G[1];w=G[2];ba=G[3];Sa=G[4]*c;Z=G[5]*c;var wa=G[6],Ta=G[7],xb=G[8],Ib=G[9];ga=G[10];B=G[11];R=G[12];var Oc=G[13],be=G[14];for(ga&&(B+=e);v<w;v+=2){G=m[v]-Sa;ga=m[v+1]-Z;Oc&&(G=Math.round(G),ga=Math.round(ga));if(1!=R||0!==B){var cc=G+Sa,Vg=ga+Z;Lj(x,cc,Vg,R,R,B,-cc,-Vg);b.setTransform.apply(b,x)}cc=b.globalAlpha;1!=Ta&&(b.globalAlpha=cc*Ta);var Vg=be+xb>ba.width?ba.width-xb:be,rq=
wa+Ib>ba.height?ba.height-Ib:wa;b.drawImage(ba,xb,Ib,Vg,rq,G,ga,Vg*c,rq*c);1!=Ta&&(b.globalAlpha=cc);1==R&&0===B||b.setTransform.apply(b,y)}++p;break;case 5:v=G[1];w=G[2];Z=G[3];wa=G[4]*c;Ta=G[5]*c;B=G[6];R=G[7]*c;ba=G[8];Sa=G[9];for((ga=G[10])&&(B+=e);v<w;v+=2){G=m[v]+wa;ga=m[v+1]+Ta;if(1!=R||0!==B)Lj(x,G,ga,R,R,B,-G,-ga),b.setTransform.apply(b,x);xb=Z.split("\n");Ib=xb.length;1<Ib?(Oc=Math.round(1.5*b.measureText("M").width),ga-=(Ib-1)/2*Oc):Oc=0;for(be=0;be<Ib;be++)cc=xb[be],Sa&&b.strokeText(cc,
G,ga),ba&&b.fillText(cc,G,ga),ga+=Oc;1==R&&0===B||b.setTransform.apply(b,y)}++p;break;case 6:if(void 0!==h&&(v=G[1],v=h(v)))return v;++p;break;case 7:K?N++:a.pa(b,e);++p;break;case 8:v=G[1];w=G[2];G=m[v];ga=m[v+1];B=G+.5|0;R=ga+.5|0;if(B!==F||R!==H)b.moveTo(G,ga),F=B,H=R;for(v+=2;v<w;v+=2)if(G=m[v],ga=m[v+1],B=G+.5|0,R=ga+.5|0,v==w-2||B!==F||R!==H)b.lineTo(G,ga),F=B,H=R;++p;break;case 9:a.Zr=G[2];N&&(a.pa(b,e),N=0,P&&(b.stroke(),P=0));b.fillStyle=G[1];++p;break;case 10:var v=void 0!==G[8]?G[8]:!0,
jl=G[9];w=G[2];P&&(b.stroke(),P=0);b.strokeStyle=G[1];b.lineWidth=v?w*c:w;b.lineCap=G[3];b.lineJoin=G[4];b.miterLimit=G[5];je&&(w=G[6],B=G[7],v&&c!==jl&&(w=w.map(function(a){return a*c/jl}),B*=c/jl,G[6]=w,G[7]=B,G[9]=c),b.lineDashOffset=B,b.setLineDash(w));++p;break;case 11:b.font=G[1];b.textAlign=G[2];b.textBaseline=G[3];++p;break;case 12:K?P++:b.stroke();++p;break;default:++p}}N&&a.pa(b,e);P&&b.stroke()}ko.prototype.je=function(a,b,c,d,e){no(this,a,b,c,d,e,this.Mb,void 0,void 0)};
function oo(a){var b=a.nb;b.reverse();var c,d=b.length,e,f,g=-1;for(c=0;c<d;++c)if(e=b[c],f=e[0],6==f)g=c;else if(0==f){e[2]=c;e=a.nb;for(f=c;g<f;){var h=e[g];e[g]=e[f];e[f]=h;++g;--f}g=-1}}function po(a,b){a.Fn[2]=a.Mb.length;a.Fn=null;a.Gn[2]=a.nb.length;a.Gn=null;b=[6,b];a.Mb.push(b);a.nb.push(b)}ko.prototype.finish=md;ko.prototype.cs=function(){return this.fk};function qo(a,b,c,d){ko.call(this,a,b,c,d);this.ka=this.wg=null;this.Ud=this.qf=this.gd=this.Fc=this.Pc=this.Pf=this.Of=this.ge=this.Hf=this.vf=this.uf=void 0}E(qo,ko);l=qo.prototype;l.od=function(a,b,c,d){return lo(this,a,b,c,d,!1,!1)};
l.bh=function(a,b){if(this.ka){mo(this,b);var c=a.l,d=this.coordinates.length;a=this.od(c,0,c.length,a.P);this.Mb.push([4,d,a,this.ka,this.uf,this.vf,this.Hf,this.ge,this.Of,this.Pf,this.Pc,this.Fc,this.gd,this.qf,this.Ud]);this.nb.push([4,d,a,this.wg,this.uf,this.vf,this.Hf,this.ge,this.Of,this.Pf,this.Pc,this.Fc,this.gd,this.qf,this.Ud]);po(this,b)}};
l.Sr=function(a,b){if(this.ka){mo(this,b);var c=a.l,d=this.coordinates.length;a=this.od(c,0,c.length,a.P);this.Mb.push([4,d,a,this.ka,this.uf,this.vf,this.Hf,this.ge,this.Of,this.Pf,this.Pc,this.Fc,this.gd,this.qf,this.Ud]);this.nb.push([4,d,a,this.wg,this.uf,this.vf,this.Hf,this.ge,this.Of,this.Pf,this.Pc,this.Fc,this.gd,this.qf,this.Ud]);po(this,b)}};l.finish=function(){oo(this);this.vf=this.uf=void 0;this.ka=this.wg=null;this.Ud=this.qf=this.Fc=this.Pc=this.Pf=this.Of=this.ge=this.gd=this.Hf=void 0};
l.hq=function(a){var b=a.Il(),c=a.Ta(),d=a.Ll(1),e=a.na(1),f=a.Ff();this.uf=b[0];this.vf=b[1];this.wg=d;this.ka=e;this.Hf=c[1];this.ge=a.rg();this.Of=f[0];this.Pf=f[1];this.Pc=a.Pc;this.Fc=a.Gb();this.gd=a.fb();this.qf=a.qf;this.Ud=c[0]};function ro(a,b,c,d){ko.call(this,a,b,c,d);this.Vd=null;this.T={tl:void 0,nl:void 0,ol:null,pl:void 0,ql:void 0,rl:void 0,sl:void 0,Xs:0,strokeStyle:void 0,lineCap:void 0,bb:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:void 0,miterLimit:void 0}}E(ro,ko);function so(a,b,c,d,e){var f=a.coordinates.length;b=lo(a,b,c,d,e,!1,!1);f=[8,f,b];a.Mb.push(f);a.nb.push(f);return d}l=ro.prototype;l.cs=function(){this.Vd||(this.Vd=Lf(this.fk),0<this.uh&&Kf(this.Vd,this.ra*(this.uh+1)/2,this.Vd));return this.Vd};
l.Vf=function(){var a=this.T,b=a.strokeStyle,c=a.lineCap,d=a.bb,e=a.lineDashOffset,f=a.lineJoin,g=a.lineWidth,h=a.miterLimit;a.tl==b&&a.nl==c&&Ke(a.ol,d)&&a.pl==e&&a.ql==f&&a.rl==g&&a.sl==h||(a.Xs!=this.coordinates.length&&(this.Mb.push([12]),a.Xs=this.coordinates.length),this.Mb.push([10,b,g,c,f,h,d,e,!0,1],[1]),a.tl=b,a.nl=c,a.ol=d,a.pl=e,a.ql=f,a.rl=g,a.sl=h)};
l.Qr=function(a,b){var c=this.T,d=c.lineWidth;void 0!==c.strokeStyle&&void 0!==d&&(this.Vf(),mo(this,b),this.nb.push([10,c.strokeStyle,c.lineWidth,c.lineCap,c.lineJoin,c.miterLimit,c.bb,c.lineDashOffset,!0,1],[1]),c=a.l,so(this,c,0,c.length,a.P),this.nb.push([12]),po(this,b))};
l.Rr=function(a,b){var c=this.T,d=c.lineWidth;if(void 0!==c.strokeStyle&&void 0!==d){this.Vf();mo(this,b);this.nb.push([10,c.strokeStyle,c.lineWidth,c.lineCap,c.lineJoin,c.miterLimit,c.bb,c.lineDashOffset,!0,1],[1]);c=a.Xa;d=a.l;a=a.P;var e=0,f,g;f=0;for(g=c.length;f<g;++f)e=so(this,d,e,c[f],a);this.nb.push([12]);po(this,b)}};l.finish=function(){this.T.Xs!=this.coordinates.length&&this.Mb.push([12]);oo(this);this.T=null};
l.Je=function(a,b){a=b.ma;this.T.strokeStyle=Wj(a?a:Uj);a=b.qh;this.T.lineCap=void 0!==a?a:"round";a=b.getLineDash();this.T.bb=a?a:Tj;a=b.rh;this.T.lineDashOffset=a?a:0;a=b.sh;this.T.lineJoin=void 0!==a?a:"round";a=b.hc();this.T.lineWidth=void 0!==a?a:1;b=b.wh;this.T.miterLimit=void 0!==b?b:10;this.T.lineWidth>this.uh&&(this.uh=this.T.lineWidth,this.Vd=null)};function to(a,b,c,d){ko.call(this,a,b,c,d);this.Vd=null;this.T={Cw:void 0,tl:void 0,nl:void 0,ol:null,pl:void 0,ql:void 0,rl:void 0,sl:void 0,fillStyle:void 0,strokeStyle:void 0,lineCap:void 0,bb:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:void 0,miterLimit:void 0}}E(to,ko);
function uo(a,b,c,d,e){var f=a.T,g=void 0!==f.fillStyle,f=void 0!=f.strokeStyle,h=d.length,k=[1];a.Mb.push(k);a.nb.push(k);for(k=0;k<h;++k){var m=d[k],p=a.coordinates.length;c=lo(a,b,c,m,e,!0,!f);c=[8,p,c];a.Mb.push(c);a.nb.push(c);f&&(c=[3],a.Mb.push(c),a.nb.push(c));c=m}b=[7];a.nb.push(b);g&&a.Mb.push(b);f&&(g=[12],a.Mb.push(g),a.nb.push(g));return c}l=to.prototype;
l.zl=function(a,b){var c=this.T,d=c.strokeStyle;if(void 0!==c.fillStyle||void 0!==d){vo(this,a);mo(this,b);this.nb.push([9,xj(Sj)]);void 0!==c.strokeStyle&&this.nb.push([10,c.strokeStyle,c.lineWidth,c.lineCap,c.lineJoin,c.miterLimit,c.bb,c.lineDashOffset,!0,1]);var e=a.l,d=this.coordinates.length;lo(this,e,0,e.length,a.P,!1,!1);a=[1];d=[2,d];this.Mb.push(a,d);this.nb.push(a,d);a=[7];this.nb.push(a);void 0!==c.fillStyle&&this.Mb.push(a);void 0!==c.strokeStyle&&(c=[12],this.Mb.push(c),this.nb.push(c));
po(this,b)}};l.Al=function(a,b){var c=this.T;vo(this,a);mo(this,b);this.nb.push([9,xj(Sj)]);void 0!==c.strokeStyle&&this.nb.push([10,c.strokeStyle,c.lineWidth,c.lineCap,c.lineJoin,c.miterLimit,c.bb,c.lineDashOffset,!0,1]);var c=a.Xa,d=a.xe();uo(this,d,0,c,a.P);po(this,b)};
l.Tr=function(a,b){var c=this.T,d=c.strokeStyle;if(void 0!==c.fillStyle||void 0!==d){vo(this,a);mo(this,b);this.nb.push([9,xj(Sj)]);void 0!==c.strokeStyle&&this.nb.push([10,c.strokeStyle,c.lineWidth,c.lineCap,c.lineJoin,c.miterLimit,c.bb,c.lineDashOffset,!0,1]);c=a.oc;d=a.xe();a=a.P;var e=0,f,g;f=0;for(g=c.length;f<g;++f)e=uo(this,d,e,c[f],a);po(this,b)}};l.finish=function(){oo(this);this.T=null;var a=this.TA;if(0!==a){var b=this.coordinates,c,d;c=0;for(d=b.length;c<d;++c)b[c]=a*Math.round(b[c]/a)}};
l.cs=function(){this.Vd||(this.Vd=Lf(this.fk),0<this.uh&&Kf(this.Vd,this.ra*(this.uh+1)/2,this.Vd));return this.Vd};
l.Je=function(a,b){var c=this.T;a?(a=a.ma,c.fillStyle=Wj(a?a:Sj)):c.fillStyle=void 0;b?(a=b.ma,c.strokeStyle=Wj(a?a:Uj),a=b.qh,c.lineCap=void 0!==a?a:"round",a=b.getLineDash(),c.bb=a?a.slice():Tj,a=b.rh,c.lineDashOffset=a?a:0,a=b.sh,c.lineJoin=void 0!==a?a:"round",a=b.hc(),c.lineWidth=void 0!==a?a:1,b=b.wh,c.miterLimit=void 0!==b?b:10,c.lineWidth>this.uh&&(this.uh=c.lineWidth,this.Vd=null)):(c.strokeStyle=void 0,c.lineCap=void 0,c.bb=null,c.lineDashOffset=void 0,c.lineJoin=void 0,c.lineWidth=void 0,
c.miterLimit=void 0)};function vo(a,b){var c=a.T,d=c.fillStyle,e=c.strokeStyle,f=c.lineCap,g=c.bb,h=c.lineDashOffset,k=c.lineJoin,m=c.lineWidth,p=c.miterLimit;if(void 0!==d&&("string"!==typeof d||c.Cw!=d)){var t=[9,d];"string"!==typeof d&&(b=b.W(),t.push([b[0],b[3]]));a.Mb.push(t);c.Cw=c.fillStyle}void 0===e||c.tl==e&&c.nl==f&&Ke(c.ol,g)&&c.pl==h&&c.ql==k&&c.rl==m&&c.sl==p||(a.Mb.push([10,e,m,f,k,p,g,h,!0,1]),c.tl=e,c.nl=f,c.ol=g,c.pl=h,c.ql=k,c.rl=m,c.sl=p)};function wo(a,b,c,d){ko.call(this,a,b,c,d);this.Gz=this.Fz=this.Ez=null;this.Da="";this.KA=this.JA=0;this.LA=void 0;this.NA=this.MA=0;this.Vm=this.Mh=this.Lh=null}E(wo,ko);
wo.prototype.lg=function(a,b,c,d,e,f){if(""!==this.Da&&this.Vm&&(this.Lh||this.Mh)){if(this.Lh){e=this.Lh;var g=this.Ez;if(!g||g.fillStyle!=e.fillStyle){var h=[9,e.fillStyle];this.Mb.push(h);this.nb.push(h);g?g.fillStyle=e.fillStyle:this.Ez={fillStyle:e.fillStyle}}}this.Mh&&(e=this.Mh,g=this.Fz,g&&g.lineCap==e.lineCap&&g.bb==e.bb&&g.lineDashOffset==e.lineDashOffset&&g.lineJoin==e.lineJoin&&g.lineWidth==e.lineWidth&&g.miterLimit==e.miterLimit&&g.strokeStyle==e.strokeStyle||(h=[10,e.strokeStyle,e.lineWidth,
e.lineCap,e.lineJoin,e.miterLimit,e.bb,e.lineDashOffset,!1,1],this.Mb.push(h),this.nb.push(h),g?(g.lineCap=e.lineCap,g.bb=e.bb,g.lineDashOffset=e.lineDashOffset,g.lineJoin=e.lineJoin,g.lineWidth=e.lineWidth,g.miterLimit=e.miterLimit,g.strokeStyle=e.strokeStyle):this.Fz={lineCap:e.lineCap,bb:e.bb,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle}));e=this.Vm;g=this.Gz;g&&g.font==e.font&&g.textAlign==e.textAlign&&g.textBaseline==
e.textBaseline||(h=[11,e.font,e.textAlign,e.textBaseline],this.Mb.push(h),this.nb.push(h),g?(g.font=e.font,g.textAlign=e.textAlign,g.textBaseline=e.textBaseline):this.Gz={font:e.font,textAlign:e.textAlign,textBaseline:e.textBaseline});mo(this,f);e=this.coordinates.length;a=lo(this,a,b,c,d,!1,!1);a=[5,e,a,this.Da,this.JA,this.KA,this.MA,this.NA,!!this.Lh,!!this.Mh,this.LA];this.Mb.push(a);this.nb.push(a);po(this,f)}};
wo.prototype.Lg=function(a){if(a){var b=a.pa;b?(b=b.ma,b=Wj(b?b:Sj),this.Lh?this.Lh.fillStyle=b:this.Lh={fillStyle:b}):this.Lh=null;var c=a.ha;if(c){var b=c.ma,d=c.qh,e=c.getLineDash(),f=c.rh,g=c.sh,h=c.hc(),c=c.wh,d=void 0!==d?d:"round",e=e?e.slice():Tj,f=void 0!==f?f:0,g=void 0!==g?g:"round",h=void 0!==h?h:1,c=void 0!==c?c:10,b=Wj(b?b:Uj);if(this.Mh){var k=this.Mh;k.lineCap=d;k.bb=e;k.lineDashOffset=f;k.lineJoin=g;k.lineWidth=h;k.miterLimit=c;k.strokeStyle=b}else this.Mh={lineCap:d,bb:e,lineDashOffset:f,
lineJoin:g,lineWidth:h,miterLimit:c,strokeStyle:b}}else this.Mh=null;var m=a.ti,b=a.mm,d=a.nm,e=a.Pc,h=a.Gb(),c=a.fb(),f=a.Da,g=a.vu,k=a.IA;a=void 0!==m?m:"10px sans-serif";g=void 0!==g?g:"center";k=void 0!==k?k:"middle";this.Vm?(m=this.Vm,m.font=a,m.textAlign=g,m.textBaseline=k):this.Vm={font:a,textAlign:g,textBaseline:k};this.Da=void 0!==f?f:"";this.JA=void 0!==b?b:0;this.KA=void 0!==d?d:0;this.LA=void 0!==e?e:!1;this.MA=void 0!==h?h:0;this.NA=void 0!==c?c:1}else this.Da=""};function xo(a,b,c,d,e){this.Bu=a;this.wp=b;this.Jp=d;this.GI=c;this.He=e;this.lc={};this.WF=Vh(1,1);this.XF=Cj()}E(xo,ak);var yo={0:[[!0]]};function zo(a,b,c){var d,e=Math.floor(a.length/2);if(b>=e)for(d=e;d<b;d++)a[d][c]=!0;else if(b<e)for(d=b+1;d<e;d++)a[d][c]=!0}
function Ao(a){if(void 0!==yo[a])return yo[a];for(var b=2*a+1,c=Array(b),d=0;d<b;d++)c[d]=Array(b);for(var b=a,e=d=0;b>=d;)zo(c,a+b,a+d),zo(c,a+d,a+b),zo(c,a-d,a+b),zo(c,a-b,a+d),zo(c,a-b,a-d),zo(c,a-d,a-b),zo(c,a+d,a-b),zo(c,a+b,a-d),d++,e+=1+2*d,0<2*(e-b)+1&&(--b,e+=1-2*b);return yo[a]=c}l=xo.prototype;l.finish=function(){for(var a in this.lc){var b=this.lc[a],c;for(c in b)b[c].finish()}};
l.Lc=function(a,b,c,d,e,f){d=Math.round(d);var g=2*d+1,h=Lj(this.XF,d+.5,d+.5,1/b,-1/b,-c,-a[0],-a[1]),k=this.WF;k.canvas.width!==g||k.canvas.height!==g?(k.canvas.width=g,k.canvas.height=g):k.clearRect(0,0,g,g);var m;void 0!==this.He&&(m=If(),Jf(m,a),Kf(m,b*(this.He+d),m));var p=Ao(d);return this.Zt(k,h,c,e,function(a){for(var b=k.getImageData(0,0,g,g).data,c=0;c<g;c++)for(var d=0;d<g;d++)if(p[c][d]&&0<b[4*(d*g+c)+3]){if(a=f(a))return a;k.clearRect(0,0,g,g);return}},m)};
l.qd=function(a,b){var c=void 0!==a?a.toString():"0";a=this.lc[c];void 0===a&&(a={},this.lc[c]=a);c=a[b];void 0===c&&(c=new Bo[b](this.Bu,this.wp,this.GI,this.Jp),a[b]=c);return c};l.df=function(){return sd(this.lc)};
l.je=function(a,b,c,d,e,f){var g=Object.keys(this.lc).map(Number);g.sort(Ge);var h=this.wp,k=h[0],m=h[1],p=h[2],h=h[3],k=[k,m,k,h,p,h,p,m];Ug(k,8,c,k);a.save();a.beginPath();a.moveTo(k[0],k[1]);a.lineTo(k[2],k[3]);a.lineTo(k[4],k[5]);a.lineTo(k[6],k[7]);a.clip();f=f?f:Zj;for(var t,v,k=0,m=g.length;k<m;++k)for(t=this.lc[g[k].toString()],p=0,h=f.length;p<h;++p)v=t[f[p]],void 0!==v&&v.je(a,b,c,d,e);a.restore()};
l.Zt=function(a,b,c,d,e,f){var g=Object.keys(this.lc).map(Number);g.sort(function(a,b){return b-a});var h,k,m,p,t;h=0;for(k=g.length;h<k;++h)for(p=this.lc[g[h].toString()],m=Zj.length-1;0<=m;--m)if(t=p[Zj[m]],void 0!==t&&(t=no(t,a,1,b,c,d,t.nb,e,f)))return t};var Bo={Circle:to,Image:qo,LineString:ro,Polygon:to,Text:wo};function Co(a,b){return I(a)-I(b)}function Do(a,b){a=.5*a/b;return a*a}function Eo(a,b,c,d,e,f){var g=!1,h,k;if(h=c.na())k=h.zi(),2==k||3==k?h.XA(e,f):(0==k&&h.load(),h.dy(e,f),g=!0);if(e=(0,c.we)(b))d=e.rs(d),(0,Fo[d.K()])(a,d,c,b);return g}
var Fo={Point:function(a,b,c,d){var e=c.na();if(e){if(2!=e.zi())return;var f=a.qd(c.Vc(),"Image");f.hq(e);f.bh(b,d)}if(e=c.Da)a=a.qd(c.Vc(),"Text"),a.Lg(e),a.lg(b.l,0,2,2,b,d)},LineString:function(a,b,c,d){var e=c.ha;if(e){var f=a.qd(c.Vc(),"LineString");f.Je(null,e);f.Qr(b,d)}if(e=c.Da)a=a.qd(c.Vc(),"Text"),a.Lg(e),a.lg(Go(b),0,2,2,b,d)},Polygon:function(a,b,c,d){var e=c.pa,f=c.ha;if(e||f){var g=a.qd(c.Vc(),"Polygon");g.Je(e,f);g.Al(b,d)}if(e=c.Da)a=a.qd(c.Vc(),"Text"),a.Lg(e),a.lg(Bh(b),0,2,2,b,
d)},MultiPoint:function(a,b,c,d){var e=c.na();if(e){if(2!=e.zi())return;var f=a.qd(c.Vc(),"Image");f.hq(e);f.Sr(b,d)}if(e=c.Da)a=a.qd(c.Vc(),"Text"),a.Lg(e),c=b.l,a.lg(c,0,c.length,b.P,b,d)},MultiLineString:function(a,b,c,d){var e=c.ha;if(e){var f=a.qd(c.Vc(),"LineString");f.Je(null,e);f.Rr(b,d)}if(e=c.Da){a=a.qd(c.Vc(),"Text");a.Lg(e);c=[];var e=b.l,g=0,f=b.Xa,h=b.P,k,m;k=0;for(m=f.length;k<m;++k){var p=f[k],g=Ho(e,g,p,h);Ie(c,g);g=p}a.lg(c,0,c.length,2,b,d)}},MultiPolygon:function(a,b,c,d){var e=
c.pa,f=c.ha;if(f||e){var g=a.qd(c.Vc(),"Polygon");g.Je(e,f);g.Tr(b,d)}if(e=c.Da)a=a.qd(c.Vc(),"Text"),a.Lg(e),c=Io(b),a.lg(c,0,c.length,2,b,d)},GeometryCollection:function(a,b,c,d){b=b.Rb;var e,f;e=0;for(f=b.length;e<f;++e)(0,Fo[b[e].K()])(a,b[e],c,d)},Circle:function(a,b,c,d){var e=c.pa,f=c.ha;if(e||f){var g=a.qd(c.Vc(),"Circle");g.Je(e,f);g.zl(b,d)}if(e=c.Da)a=a.qd(c.Vc(),"Text"),a.Lg(e),a.lg(b.La(),0,2,2,b,d)}};function Jo(a){mm.call(this,a);this.Ye=!1;this.wd=-1;this.Em=NaN;this.mf=If();this.Oc=this.Cm=null;this.Af=Vh()}E(Jo,mm);l=Jo.prototype;
l.kl=function(a,b,c){var d=a.Z,e=a.rc,f=b.pp?a.Qm:{},g=a.hb,h=g.la,g=g.rotation,k=h.W(),m=this.Ac().v(),p=this.Ei(a,0);this.Ed("precompose",c,a,p);var t=b.Z,v=void 0!==t;v&&this.clip(c,a,t);if((t=this.Oc)&&!t.df()){var w=0,x=0,y;if(this.Ac().hasListener("render")){y=c.canvas.width;var F=c.canvas.height;if(g){var H=Math.round(Math.sqrt(y*y+F*F)),w=(H-y)/2,x=(H-F)/2;y=F=H}this.Af.canvas.width=y;this.Af.canvas.height=F;y=this.Af}else y=c;F=y.globalAlpha;y.globalAlpha=b.opacity;y!=c&&y.translate(w,x);
b=a.size[0]*e;H=a.size[1]*e;Vj(y,-g,b/2,H/2);t.je(y,e,p,g,f);if(m.Pq&&h.ii&&!Nf(k,d)){for(var h=d[0],m=Xf(k),B=0;h<k[0];)--B,p=m*B,p=this.Ei(a,p),t.je(y,e,p,g,f),h+=m;B=0;for(h=d[2];h>k[2];)++B,p=m*B,p=this.Ei(a,p),t.je(y,e,p,g,f),h-=m;p=this.Ei(a,0)}Vj(y,g,b/2,H/2);y!=c&&(this.Ed("render",y,a,p),c.drawImage(y.canvas,-w,-x),y.translate(-w,-x));y.globalAlpha=F}v&&c.restore();this.Ed("postcompose",c,a,p)};
l.Lc=function(a,b,c,d,e){if(this.Oc){var f=b.hb.ra;b=b.hb.rotation;var g=this.Ac(),h={};return this.Oc.Lc(a,f,b,c,{},function(a){var b=I(a).toString();if(!(b in h))return h[b]=!0,d.call(e,a,g)})}};l.Xl=function(){dm(this)};
l.Yi=function(a){function b(a){var b,d=a.me;d?b=d.call(a,m):(d=c.me)&&(b=d(a,m));b&&(a=this.Tt(a,m,p,b,v),this.Ye=this.Ye||a)}var c=this.Ac(),d=c.v();gm(a.jb,d.wf);hm(a,d);var e=a.sf[0],f=a.sf[1],g=c.dB,h=c.eB;if(!this.Ye&&!g&&e||!h&&f)return!0;var k=a.Z,h=a.hb,e=h.la,m=h.ra,p=a.rc,f=c.Sa,t=c.He,g=c.get(Ko);void 0===g&&(g=Co);k=Kf(k,t*m);t=h.la.W();d.Pq&&h.la.ii&&!Nf(t,a.Z)&&(a=Math.max(Xf(k)/2,Xf(t)),k[0]=t[0]-a,k[2]=t[2]+a);if(!this.Ye&&this.Em==m&&this.wd==f&&this.Cm==g&&Nf(this.mf,k))return!0;
this.Oc=null;this.Ye=!1;var v=new xo(.5*m/p,k,m,d.Jp,c.He);jo(d,k,m,e);if(g){var w=[];ho(d,k,function(a){w.push(a)},this);w.sort(g);w.forEach(b,this)}else ho(d,k,b,this);v.finish();this.Em=m;this.wd=f;this.Cm=g;this.mf=k;this.Oc=v;return!0};l.Tt=function(a,b,c,d,e){if(!d)return!1;var f=!1;if(Array.isArray(d))for(var g=0,h=d.length;g<h;++g)f=Eo(e,a,d[g],Do(b,c),this.Xl,this)||f;else f=Eo(e,a,d,Do(b,c),this.Xl,this)||f;return f};function Lo(a,b){Dm.call(this,a,b);this.Ye=!1;this.wd=-1;this.Em=NaN;this.mf=If();this.Zs=this.Oc=this.Cm=null}E(Lo,Dm);l=Lo.prototype;l.kl=function(a,b,c){this.Zs=b;var d=a.hb,e=this.Oc,f=a.size,g=a.rc,h=this.Lf.Kb;e&&!e.df()&&(h.enable(h.SCISSOR_TEST),h.scissor(0,0,f[0]*g,f[1]*g),e.je(c,d.Ka,d.ra,d.rotation,f,g,b.opacity,b.pp?a.Qm:{}),h.disable(h.SCISSOR_TEST))};l.ab=function(){var a=this.Oc;if(a){var b=this.Lf.getContext();a.og(b)();this.Oc=null}Dm.prototype.ab.call(this)};
l.Lc=function(a,b,c,d,e){if(this.Oc&&this.Zs){c=this.Lf.getContext();var f=b.hb,g=this.Ac(),h={};return this.Oc.Lc(a,c,f.Ka,f.ra,f.rotation,b.size,b.rc,this.Zs.opacity,{},function(a){var b=I(a).toString();if(!(b in h))return h[b]=!0,d.call(e,a,g)})}};l.Xl=function(){dm(this)};
l.Yi=function(a,b,c){function d(a){var b,c=a.me;c?b=c.call(a,m):(c=e.me)&&(b=c(a,m));b&&(a=this.Tt(a,m,p,b,v),this.Ye=this.Ye||a)}var e=this.Ac();b=e.v();gm(a.jb,b.wf);hm(a,b);var f=a.sf[0],g=a.sf[1],h=e.dB,k=e.eB;if(!this.Ye&&!h&&f||!k&&g)return!0;var g=a.Z,h=a.hb,f=h.la,m=h.ra,p=a.rc,h=e.Sa,t=e.He,k=e.get(Ko);void 0===k&&(k=Co);g=Kf(g,t*m);if(!this.Ye&&this.Em==m&&this.wd==h&&this.Cm==k&&Nf(this.mf,g))return!0;this.Oc&&a.Rf.push(this.Oc.og(c));this.Ye=!1;var v=new Ml(.5*m/p,g,e.He);jo(b,g,m,f);
if(k){var w=[];ho(b,g,function(a){w.push(a)},this);w.sort(k);w.forEach(d,this)}else ho(b,g,d,this);v.finish(c);this.Em=m;this.wd=h;this.Cm=k;this.mf=g;this.Oc=v;return!0};l.Tt=function(a,b,c,d,e){if(!d)return!1;var f=!1;if(Array.isArray(d))for(var g=d.length-1;0<=g;--g)f=Eo(e,a,d[g],Do(b,c),this.Xl,this)||f;else f=Eo(e,a,d,Do(b,c),this.Xl,this)||f;return f};function Mo(a){a=a?a:{};var b=pd({},a);delete b.style;delete b.Wp;delete b.mj;delete b.nj;rj.call(this,b);this.He=void 0!==a.Wp?a.Wp:100;this.ne=null;this.me=void 0;this.xd(a.style);this.dB=void 0!==a.mj?a.mj:!1;this.eB=void 0!==a.nj?a.nj:!1}E(Mo,rj);Mo.prototype.Wn=function(a){var b=null,c=a.K();"canvas"===c?b=new Jo(this):"webgl"===c&&(b=new Lo(a,this));return b};Mo.prototype.xd=function(a){this.ne=void 0!==a?a:Hn;this.me=null===a?void 0:Fn(this.ne);this.G()};var Ko="renderOrder";function C(){A.log("nsVmap.Map");this.Yy=[];this.wt=new Hh({Ka:[0,0],zoom:2});this.H=new Xl({rb:this.Yy,view:this.wt});this.rt=new Dn({fill:new Cn({color:"rgba(255, 255, 255, 0.3)"}),stroke:new gl({color:"#d9534f",width:3}),Lb:new Bn({tb:7,fill:new Cn({color:"#d9534f"})})});this.Cp=new Pd;this.ee=new Mo({map:this.H,style:this.rt,source:new ao({features:this.Cp,Ph:!1}),mj:!0,nj:!0});this.Uy=new Dn({fill:new Cn({color:"rgba(255, 255, 255, 0.3)"}),stroke:new gl({color:"#337ab7",width:2}),Lb:new Bn({tb:10,
stroke:new gl({color:"#337ab7",width:2}),fill:new Cn({color:"rgba(255, 255, 255, 0.2)"})})});this.Vi=new Pd;this.Wi=new Mo({map:this.H,style:this.Uy,source:new ao({features:this.Vi,Ph:!1})});this.Vy=new Pd;this.qt=new Mo({map:this.H,style:this.Uy,source:new ao({features:this.Vy,Ph:!1})});this.Lu=[];this.jn=[];this.Mu=[];this.Ea={};this.kn=new Pd;this.Nu=new Mo({map:this.H,source:new ao({features:this.kn})});this.al();for(var a=this.H.yg.R(),b=0;b<a.length;b++)a[b]instanceof ni&&this.H.Ig(a[b]);this.H.ac.setAttribute("id",
"map1");$(document).keydown(function(a){27===a.keyCode&&A.g().tk()});this.ph=[];this.ph.push(this.ee);this.ph.push(this.Wi);this.ph.push(this.qt);this.ph.push(this.Nu)}pa("nsVmap.Map",C);C.prototype.fb=function(a){A.log("nsVmap.Map.prototype.getScale");a=n(a)?a:{};a.pretty=n(a.pretty)?a.pretty:!1;var b=new hg(6378137),c=D(this.H).D(),d=Oh(D(A.g().H),[37.795275591,0]),e=Rg([d[0],d[1]],c,"EPSG:4326"),c=Rg([d[2],d[3]],c,"EPSG:4326"),b=100*jg(b,e,c);!0===a.pretty&&(b=No(0,b));return b};
C.prototype.getScale=C.prototype.fb;function No(a,b){b=String(Math.round(b));a=1;for(var c=b.length-1;0<c;c--)0===a%3&&(b=b.slice(0,c)+","+b.slice(c+Math.abs(0))),a++;return"1:"+b}C.prototype.le=function(a){A.log("nsVmap.Map.prototype.setScale");var b=this.fb(),c=D(this.H).xa();a=a*c/b;Uh(D(this.H),a);b=this.fb();A.log(b)};C.prototype.setScale=C.prototype.le;
C.prototype.al=function(){var a=new mg({code:"EPSG:2154",Z:[-378305.81,6093283.21,1212610.74,7186901.68],units:"m"});Kg(a);Mg("EPSG:4326","EPSG:2154",this.Xq,this.Us);Mg("EPSG:3857","EPSG:2154",function(a){a=Rg(a,"EPSG:3857","EPSG:4326");return Rg(a,"EPSG:4326","EPSG:2154")},function(a){a=Rg(a,"EPSG:2154","EPSG:4326");return Rg(a,"EPSG:4326","EPSG:3857")})};
C.prototype.Xq=function(a){var b=a[0],c=a[1];lc=3/180*Math.PI;a=46.5/180*Math.PI;var d=44/180*Math.PI,e=49/180*Math.PI,f=c/180*Math.PI,b=b/180*Math.PI,c=6378137/Math.sqrt(1-.006694380025712785*Math.sin(d)*Math.sin(d)),g=Math.log(Math.tan(Math.PI/4+d/2)*Math.pow((1-.08181919106*Math.sin(d))/(1+.08181919106*Math.sin(d)),.04090959553)),f=Math.log(Math.tan(Math.PI/4+f/2)*Math.pow((1-.08181919106*Math.sin(f))/(1+.08181919106*Math.sin(f)),.04090959553)),e=Math.log(6378137/Math.sqrt(1-.006694380025712785*
Math.sin(e)*Math.sin(e))*Math.cos(e)/(c*Math.cos(d)))/(g-Math.log(Math.tan(Math.PI/4+e/2)*Math.pow((1-.08181919106*Math.sin(e))/(1+.08181919106*Math.sin(e)),.04090959553))),d=c*Math.cos(d)/e*Math.exp(e*g);return[7E5+d*Math.exp(-1*e*f)*Math.sin(e*(b-lc)),66E5+d*Math.exp(-1*e*Math.log(Math.tan(Math.PI/4+a/2)*Math.pow((1-.08181919106*Math.sin(a))/(1+.08181919106*Math.sin(a)),.04090959553)))-d*Math.exp(-1*e*f)*Math.cos(e*(b-lc))]};
C.prototype.Us=function(a){Math.atanh=Math.atanh||function(a){return Math.log((1+a)/(1-a))/2};Math.tanh=Math.tanh||function(a){return Infinity===a?1:-Infinity===a?-1:(Math.exp(a)-Math.exp(-a))/(Math.exp(a)+Math.exp(-a))};var b=1/298.257222101,b=Math.sqrt(2*b-b*b),c=parseFloat(a[0]).toFixed(10)-7E5;a=parseFloat(a[1]).toFixed(10)-1.26556120499E7;var d=Math.log(1.1754255426096E7/Math.sqrt(c*c+a*a))/.725607765053267;return[(Math.atan(-c/a)/.725607765053267+3/180*Math.PI)/Math.PI*180,Math.asin(Math.tanh(d+
b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.sin(1))))))))))))))))/Math.PI*180]};C.prototype.Bk=function(a,b,c,d){A.log("nsVmap.Map.prototype.setEventOnMap");if(!n(a))return console.error("setEventOnMap: type not defined"),0;if(!n(b))return console.error("setEventOnMap: listener not defined"),0;c=n(c)?c:"";this.Ge();a=this.nv(a,b,c);n(d)&&this.Bh(d);return a};
C.prototype.setEventOnMap=C.prototype.Bk;C.prototype.nv=function(a,b,c,d){if(!n(a))return console.error("setEventOnMap: type not defined"),0;if(!n(b))return console.error("setEventOnMap: listener not defined"),0;c=n(c)?c:"";a=this.H.on(a,b,c);this.Lu.push(a);n(d)&&this.Bh(d);return a};C.prototype.addEventOnMap=C.prototype.nv;
C.prototype.Jg=function(a,b){A.log("nsVmap.Map.prototype.setDrawInteraction");if(!n(a.type))return console.error("addDrawOnMap: opt_options.type not defined"),0;this.Ge();a=this.mv(a);n(b)&&this.Bh(b);return a};C.prototype.setDrawInteraction=C.prototype.Jg;
C.prototype.mv=function(a,b){if(!n(a.type))return console.error("addDrawOnMap: opt_options.type not defined"),0;a.style=n(a.style)?a.style:new Dn({fill:new Cn({color:"rgba(54,184,255,0.6)"}),stroke:new gl({color:"rgba(0, 0, 0, 0.5)",bb:[10,10],width:2}),Lb:new Bn({tb:5,stroke:new gl({color:"rgba(0, 0, 0, 0.7)"}),fill:new Cn({color:"rgba(54,184,255,0.6)"})})});a=new Oo(a);this.bc(a);n(b)&&this.Bh(b);return a};C.prototype.addDrawInteraction=C.prototype.mv;
function Po(a,b,c){A.log("nsVmap.Map.prototype.setInteraction");a.Ge();a.bc(b);n(c)&&a.Bh(c)}C.prototype.bc=function(a,b){A.log("nsVmap.Map.prototype.addInteraction");this.H.bc(a);this.jn.push(a);n(b)&&this.Bh(b);return a};C.prototype.Ge=function(){A.log("nsVmap.Map.prototype.removeActionsOnMap");for(var a=0;a<this.Lu.length;a++)Hd(this.Lu[a]);for(a=0;a<this.jn.length;a++)n(this.jn[a].wa)&&this.jn[a].wa().clear(),this.H.Ig(this.jn[a]);this.Bh("")};C.prototype.removeActionsOnMap=C.prototype.Ge;
C.prototype.eg=function(a){this.Mu.push(a);this.H.eg(a)};C.prototype.addOverlay=C.prototype.eg;C.prototype.tk=function(){this.Ge();this.Ea.hide();for(var a=0;a<this.Mu.length;a++)Qo(this.Mu[a]).style.display="none"};C.prototype.removeActionsAndTooltips=C.prototype.tk;C.prototype.oJ=function(a,b){this.kn.clear();this.wn(a,b)};C.prototype.setTextOverlayFeature=C.prototype.oJ;
C.prototype.wn=function(a,b){a=new Dn({Lb:new Bn({tb:3,stroke:new gl({color:"#fff"}),fill:new Cn({color:"blue"})}),text:new Ro({text:a,fill:new Cn({color:"blue"}),offsetY:-13})});b=new So({geometry:new rh(b)});b.xd(a);this.Nu.v().Gc(b)};C.prototype.addTextOverlayFeature=C.prototype.wn;
function To(a,b){A.log("nsVmap.Map.prototype.addVectorLayer");var c=new Mo({map:a.H,source:new ao({Ph:!1}),mj:!0,nj:!0});n(b)&&(n(b.style)&&c.xd(b.style),n(b.Z)&&c.fq(b.Z),n(b.Be)&&c.set("minResolution",b.Be),n(b.ef)&&c.set("maxResolution",b.ef),n(b.opacity)&&c.Dk(b.opacity),n(b.properties)&&Kd(c,b.properties),n(b.visible)&&c.setVisible(b.visible),n(b.zIndex)&&c.nA(b.zIndex));a.ph.push(c);return c}C.prototype.refresh=function(){A.log("nsVmap.Map.prototype.refresh");this.H.fd()};
C.prototype.refresh=C.prototype.refresh;C.prototype.gt=function(a,b,c){A.log("nsVmap.Map.prototype.locateFeatures");b=null!=b?b:!0;if(0===a.length)return 0;(null!=c?c:1)&&this.Xu(a);b&&A.g().Vi.clear();for(b=a.length-1;0<=b;b--)Ma(A.g().Wi.v().wa(),a[b])&&A.g().Wi.v().fc(a[b]),A.g().Wi.v().Gc(a[b])};C.prototype.locateFeatures=C.prototype.gt;
C.prototype.Vz=function(a,b,c){A.log("nsVmap.Map.prototype.selectFeatures");b=null!=b?b:!0;if(0===a.length)return 0;(null!=c?c:1)&&this.Xu(a);b&&A.g().Cp.clear();for(b=a.length-1;0<=b;b--)Ma(A.g().ee.v().wa(),a[b])&&A.g().ee.v().fc(a[b]),A.g().ee.v().Gc(a[b])};C.prototype.selectFeatures=C.prototype.Vz;
C.prototype.Xu=function(a){A.log("nsVmap.Map.prototype.zoomOnFeatures");if(0===a.length)return 0;for(var b=[],b=jQuery.extend(!0,[],a[0].j().W()),c=a.length-1;0<=c;c--){var d=a[c].j().W();d[0]<b[0]&&(b[0]=d[0]);d[1]<b[1]&&(b[1]=d[1]);d[2]>b[2]&&(b[2]=d[2]);d[3]>b[3]&&(b[3]=d[3]);delete d}b[0]===b[2]&&(b[0]-=1E-4*b[0],b[2]+=1E-4*b[2]);b[1]===b[3]&&(b[1]-=1E-4*b[1],b[3]+=1E-4*b[3]);setTimeout(function(){Th(D(A.g().H),b,{padding:[50,50,50,50]})})};C.prototype.zoomOnFeatures=C.prototype.Xu;
C.prototype.GG=function(){A.log("nsVmap.Map.prototype.mapDirective");return{restrict:"E",scope:{map:"=appMap",proj:"=appProj",currentAction:"=appAction"},controller:"AppMapController",controllerAs:"ctrl",bindToController:!0,template:'<div id="olMap"></div>'}};
C.prototype.hm=function(a,b,c){A.log("nsVmap.Map.prototype.mapController");var d=this;this.b=a;this.element=c;this.duration=1E3;this.map=this.map;this.cI=this.proj;this.mp=[];this.map.Dh("olMap");this.pr=new ic(function(){d.map.zd();var a=d.map;a.di&&cancelAnimationFrame(a.di);a.sv();oa()-start<d.duration&&d.pr.start()},b);a.$watchCollection(function(){return[d.element.children()[0].clientWidth,d.element.children()[0].clientHeight]},function(){d.Sm()});A.g().Ea=new Uo({id:"map-tooltip"});var e=0;
this.map.getLayers().on("change:length",function(){e++;var a=angular.copy(e);setTimeout(function(){e===a&&A.scope.$broadcast("layersChanged")},200)});var f=0;A.scope.$on("layersChanged",function(){function a(){f++;var a=angular.copy(f);setTimeout(function(){f===a&&A.scope.$broadcast("layersChanged")},200)}for(var b=d.map.getLayers().R(),c=0;c<b.length;c++)b[c].on("change:visible",a,d)});A.scope.$on("layersChanged",function(){A.log("oVmap event: layersChanged");A.log("nsVmap.Map.prototype.emptyLoadErrorsEvents");
for(var a=0;a<d.mp.length;a++)Hd(d.mp[a].event);Vo(d)});A.scope.$on("mapChanged",function(){A.g().ee.v().clear();A.g().Wi.v().clear()})};C.prototype.hm.$inject=["$scope","$window","$element"];
function Vo(a){A.log("nsVmap.Map.prototype.listenLoadErrors");a.map.getLayers().forEach(function(b){b.v()instanceof Wo?a.mp.push({event:b.v().on("tileloaderror",function(b){null!=b.tile?null!=b.tile.Me?Xo(a,b.tile.Me):console.error("tileloaderror: ",b.tile):console.error("tileloaderror: ",b)}),layer:b}):b.v()instanceof Yo&&a.mp.push({event:b.v().on("imageloaderror",function(b){null!=b.image?null!=b.image.Me?Xo(a,b.image.Me):console.error("imageloaderror: ",b.image):console.error("imageloaderror: ",
b)}),layer:b})})}function Xo(a,b){A.log("nsVmap.Map.prototype.mapController.prototype.displayLoadErrors");z({method:"GET",url:b,headers:{Accept:"application/x-vm-json"},scope:a.b,success:function(a){var b=jQuery.parseXML(a.data);null!=b?console.error("Layer server error: ",b):null!=a.data&&""!==a.data?console.error("Layer server error: ",a.data):console.error("Layer server error: ",a)}})}
C.prototype.hm.prototype.Sm=function(){A.log("nsVmap.Map.prototype.mapController.prototype.startAnimation");start=oa();this.pr.stop();this.pr.start()};C.prototype.hm.prototype.startAnimation=C.prototype.hm.prototype.Sm;C.prototype.IE=function(){return this.H.getLayers()};C.prototype.getOpenLayersLayers=C.prototype.IE;C.prototype.jJ=function(a){this.Yy=a;this.H.set("layergroup",a)};C.prototype.setOpenLayersLayers=C.prototype.jJ;C.prototype.JE=function(){return D(this.H)};
C.prototype.getOpenLayersView=C.prototype.JE;C.prototype.gA=function(a){this.wt=a;this.H.Eh(this.wt)};C.prototype.setOpenLayersView=C.prototype.gA;C.prototype.HE=function(){return this.H};C.prototype.getOLMap=C.prototype.HE;C.prototype.kJ=function(a){this.H=a};C.prototype.setOpenLayersMap=C.prototype.kJ;C.prototype.RE=function(){return this.ee};C.prototype.getSelectionOverlay=C.prototype.RE;C.prototype.TE=function(){return this.Cp};C.prototype.getSelectionOverlayFeatures=C.prototype.TE;
C.prototype.zE=function(){return this.Wi};C.prototype.getLocationOverlay=C.prototype.zE;C.prototype.BE=function(){return this.Wi.v()};C.prototype.getLocationOverlaySource=C.prototype.BE;C.prototype.AE=function(){return this.Vi};C.prototype.getLocationOverlayFeatures=C.prototype.AE;C.prototype.NE=function(){return this.qt};C.prototype.getPopupOverlay=C.prototype.NE;C.prototype.Ol=function(){return this.qt.v()};C.prototype.getPopupOverlaySource=C.prototype.Ol;C.prototype.OE=function(){return this.Vy};
C.prototype.getPopupOverlayFeatures=C.prototype.OE;C.prototype.UE=function(){return this.rt};C.prototype.getSelectionStyle=C.prototype.UE;C.prototype.mJ=function(a){this.rt=a};C.prototype.setSelectionStyle=C.prototype.mJ;C.prototype.px=function(){return angular.element($("#map1")).scope().ctrl.currentAction};C.prototype.getCurrentAction=C.prototype.px;C.prototype.Bh=function(a){angular.element($("#map1")).scope().$evalAsync(function(b){b.ctrl.currentAction=a})};C.prototype.setCurrentAction=C.prototype.Bh;
C.prototype.VE=function(){return this.Nu};C.prototype.getTextOverlay=C.prototype.VE;C.prototype.WE=function(){return this.kn};C.prototype.getTextOverlayFeatures=C.prototype.WE;C.prototype.uE=function(){return this.ph};C.prototype.getLayersToTransform=C.prototype.uE;C.prototype.sE=function(a){for(var b=this.H.getLayers().R(),c=0;c<b.length;c++)if(b[c].get("layer_id")===a)return b[c];return null};C.prototype.getLayerById=C.prototype.sE;A.module.directive("appMap",C.prototype.GG);
A.module.controller("AppMapController",C.prototype.hm);function Zo(a){Jd.call(this);this.Wc=a.id;this.bG=void 0!==a.aG?a.aG:!0;this.IJ=void 0!==a.HJ?a.HJ:!0;this.xb=document.createElement("DIV");this.xb.className="ol-overlay-container";this.xb.style.position="absolute";this.Dn=void 0!==a.Dn?a.Dn:!1;this.iw=a.yC||{};this.AC=void 0!==a.zC?a.zC:20;this.Nc={Hn:"",kp:"",$p:"",Aq:"",visible:!0};this.qp=null;J(this,Md($o),this.oF,this);J(this,Md(ap),this.BF,this);J(this,Md(bp),this.GF,this);J(this,Md(cp),this.IF,this);J(this,Md(dp),this.JF,this);void 0!==a.element&&
this.set($o,a.element);ep(this,void 0!==a.offset?a.offset:[0,0]);this.set(dp,void 0!==a.pk?a.pk:"top-left");void 0!==a.position&&this.setPosition(a.position)}E(Zo,Jd);function Qo(a){return a.get($o)}l=Zo.prototype;l.Wb=function(){return this.Wc};l.g=function(){return this.get(ap)};l.Eo=function(){return this.get(cp)};l.oF=function(){for(var a=this.xb;a.lastChild;)a.removeChild(a.lastChild);(a=Qo(this))&&this.xb.appendChild(a)};
l.BF=function(){this.qp&&(Xh(this.xb),ud(this.qp),this.qp=null);var a=this.g();a&&(this.qp=J(a,"postrender",this.Ca,this),fp(this),a=this.IJ?a.qm:a.rm,this.bG?a.insertBefore(this.xb,a.childNodes[0]||null):a.appendChild(this.xb))};l.Ca=function(){fp(this)};l.GF=function(){fp(this)};
l.IF=function(){fp(this);if(this.get(cp)&&this.Dn){var a=this.g();if(a&&am(a)){var b=gp(am(a),a.Ta()),c=Qo(this),d=c.offsetWidth,e=getComputedStyle(c),d=d+(parseInt(e.marginLeft,10)+parseInt(e.marginRight,10)),e=c.offsetHeight,f=getComputedStyle(c),e=e+(parseInt(f.marginTop,10)+parseInt(f.marginBottom,10)),g=gp(c,[d,e]),c=this.AC;Nf(b,g)||(d=g[0]-b[0],e=b[2]-g[2],f=g[1]-b[1],g=b[3]-g[3],b=[0,0],0>d?b[0]=d-c:0>e&&(b[0]=Math.abs(e)+c),0>f?b[1]=f-c:0>g&&(b[1]=Math.abs(g)+c),0===b[0]&&0===b[1])||(c=D(a).La(),
c=Gi(a,c),b=[c[0]+b[0],c[1]+b[1]],D(a).animate({Ka:a.Gd(b),duration:this.iw.duration,Jc:this.iw.Jc}))}}};l.JF=function(){fp(this)};l.cb=function(a){this.set(ap,a)};function ep(a,b){a.set(bp,b)}l.setPosition=function(a){this.set(cp,a)};function gp(a,b){var c=a.getBoundingClientRect();a=c.left+window.pageXOffset;c=c.top+window.pageYOffset;return[a,c,a+b[0],c+b[1]]}l.setVisible=function(a){this.Nc.visible!==a&&(this.xb.style.display=a?"":"none",this.Nc.visible=a)};
function fp(a){var b=a.g(),c=a.Eo();if(b&&b.zc&&c){var c=Gi(b,c),d=b.Ta(),b=a.xb.style,e=a.get(bp),f=a.get(dp);a.setVisible(!0);var g=e[0],e=e[1];if("bottom-right"==f||"center-right"==f||"top-right"==f)""!==a.Nc.kp&&(a.Nc.kp=b.left=""),g=Math.round(d[0]-c[0]-g)+"px",a.Nc.$p!=g&&(a.Nc.$p=b.right=g);else{""!==a.Nc.$p&&(a.Nc.$p=b.right="");if("bottom-center"==f||"center-center"==f||"top-center"==f)g-=a.xb.offsetWidth/2;g=Math.round(c[0]+g)+"px";a.Nc.kp!=g&&(a.Nc.kp=b.left=g)}if("bottom-left"==f||"bottom-center"==
f||"bottom-right"==f)""!==a.Nc.Aq&&(a.Nc.Aq=b.top=""),c=Math.round(d[1]-c[1]-e)+"px",a.Nc.Hn!=c&&(a.Nc.Hn=b.bottom=c);else{""!==a.Nc.Hn&&(a.Nc.Hn=b.bottom="");if("center-left"==f||"center-center"==f||"center-right"==f)e-=a.xb.offsetHeight/2;c=Math.round(c[1]+e)+"px";a.Nc.Aq!=c&&(a.Nc.Aq=b.top=c)}}else a.setVisible(!1)}var $o="element",ap="map",bp="offset",cp="position",dp="positioning";function Uo(a){A.log("nsVmap.Map.MapTooltip");if(!n(a.id))return 0;this.id=a.id;this.className=n(a.className)?a.className:"map-tooltip";this.map=A.g().H;this.Hi=document.createElement("div");this.Hi.id=this.id;this.Hi.className=this.className;this.Hi.style.display="none";this.Qo=new Zo({element:this.Hi,offset:[15,15],pk:"center-left"});this.map.eg(this.Qo);this.map.on("pointermove",function(a){this.Qo.setPosition(a.Qb)},this)}C.MapTooltip=Uo;
Uo.prototype.Ra=function(a){if(!n(a))return"message not defined";this.Hi.innerHTML=a;this.Hi.style.display="block";this.Qo.setPosition([0,0])};Uo.prototype.hide=function(){this.Hi.style.display="none"};function hp(a,b){A.log("nsVmap.Map.MapPopup");var c=this;this.vt=a;this.S=A.g().H;this.sk=D(this.S).D().V;this.Fa=[];this.Ep={};Ma(A.g().Ol().wa(),a)||A.g().Ol().Gc(a);this.Vg=document.createElement("div");this.Vg.className="ol-popup";this.tn=document.createElement("div");this.Vg.appendChild(this.tn);this.Th=document.createElement("div");this.Th.style="height: 7px;";this.tn.appendChild(this.Th);if(null!=A.properties.popup&&null!=A.properties.popup.style&&r(A.properties.popup.style)){for(var d=A.properties.popup.style.replace(/<return>/g,
"").split(";"),e=0;e<d.length;e++){var f=d[e].split(":");null!=f[0]&&null!=f[1]&&(this.Ep[f[0]]=f[1]);delete f}for(var g in this.Ep)this.Vg.style[g]=this.Ep[g]}this.Uh=document.createElement("a");this.Uh.href="#";this.Uh.className="ol-popup-closer";this.Th.appendChild(this.Uh);this.Vh=document.createElement("div");this.Vh.classList.add("popup-content");this.tn.appendChild(this.Vh);this.Lp=new Zo({element:this.Vg,Dn:!0,position:null!=b?ip(b):ip(a.j()),yC:{duration:250}});this.Uh.onclick=function(){c.remove();
return!1};this.Vg.onclick=function(){for(var a=A.g().H.Xc.R(),b=0;b<a.length;b++)$(Qo(a[b])).hasClass("ol-popup")&&$(Qo(a[b])).css("z-index",10);$(c.Vg).css("z-index",11)};this.S.eg(this.Lp);this.S.on("change:view",function(){var a=this.sk,b=this.Lp.Eo();if(!n(b)||!n(a))return 0;var c=D(this.S).D().V,a=Rg(b,a,c);this.Lp.setPosition(a);this.sk=c},this)}C.MapPopup=hp;
hp.prototype.Ra=function(a){A.log("nsVmap.Map.MapPopup.prototype.displayMessage");A.log("nsVmap.Map.MapPopup.prototype.removeMessages");this.Vh.innerHTML="";this.pv(a)};hp.prototype.displayMessage=hp.prototype.Ra;hp.prototype.pv=function(a){A.log("nsVmap.Map.MapPopup.prototype.displayMessage");if(!n(a))return console.error("MapPopup: message not defined"),0;this.Vh.innerHTML=a;return!0};hp.prototype.addMessage=hp.prototype.pv;
hp.prototype.rv=function(a){A.log("nsVmap.Map.MapPopup.prototype.addPhoto");if(!n(a))return console.error("MapPopup: addPhoto not defined"),0;var b=document.createElement("img");b.style.width="100px";b.src=a;null!=this.Ep["min-width"]&&"0px"!==$(this.Vg).css("min-width")||$(this.Vg).css("min-width","300px");n(this.sj)||(this.sj=document.createElement("div"),this.sj.classList.add("popup-image-content"),this.sj.style.position="relative",this.sj.style["float"]="right",this.Vh.style["float"]="left",this.Vh.style.width=
"calc(100% - 100px)",this.tn.appendChild(this.sj));this.sj.appendChild(b);return!0};hp.prototype.addPhoto=hp.prototype.rv;
function jp(a,b){A.log("nsVmap.Map.MapPopup.prototype.addMessageTable");if(n(b)){var c=document.createElement("table"),d=["getPropertie"],e;for(e in b)if("feature"!==e){var f=document.createElement("tr"),g=document.createElement("td");g.className="padding-sides-5 map-popup-cell";f.appendChild(g);var h=document.createElement("td");h.className="padding-sides-5 map-popup-cell";f.appendChild(h);if(r(b[e])){b[e]=b[e].replace(/</g,"&lt;").replace(/>/g,"&gt;");A.Ss(b[e],"bo_link")&&(b[e]=A.Bt(b[e],"bo_link"));
for(var k=0;k<d.length;k++)-1!==b[e].indexOf("{{"+d[k]+"(")&&-1!==b[e].indexOf(")}}")&&(b[e]=kp(b[e]))}g.innerHTML=e;h.innerHTML=b[e];c.appendChild(f);delete f;delete g;delete h}a.Vh.appendChild(c)}else console.error("MapPopup: data not defined")}
function kp(a){var b=a.substr(a.indexOf("{{")+2,a.indexOf("}}")-a.indexOf("{{")-2),c="";1<b.split(";").length&&console.error("Attention: plusieurs fonctions d\u00e9tect\u00e9es dans "+a);try{c=eval("angular.element(vitisApp.appMainDrtv).scope()."+b.split(";")[0])}catch(d){}return a=a.replace("{{"+b+"}}",c)}hp.prototype.$k=function(a){-1===this.Fa.indexOf(a)&&(this.Fa.push(a),this.Dr())};hp.prototype.addAction=hp.prototype.$k;
hp.prototype.qI=function(a){-1!==this.Fa.indexOf(a)&&(this.Fa.splice(this.Fa.indexOf(a),1),this.Dr())};hp.prototype.removeAction=hp.prototype.qI;
hp.prototype.Dr=function(){A.log("nsVmap.Map.MapPopup.prototype.compileActions");var a=this;n(this.Wh)&&this.Th.removeChild(this.Wh);this.Wh=document.createElement("div");this.Wh.className="dropup";this.Wh.style.position="inherit";this.Yk=document.createElement("a");this.Yk.href="#";this.Yk.className="ol-popup-list icon-format_list_bulleted";this.Yk.addEventListener("click",function(){$(a.Xh).toggleClass("block")});$("body").click(function(b){$(a.Yk)[0]!==$(b.target)[0]&&$(a.Xh).removeClass("block")});
this.Xh=document.createElement("ul");this.Xh.style="right: 0;left: inherit;";this.Xh.className="dropdown-menu";for(var b=0;b<this.Fa.length;b++)this.av=document.createElement("li"),this.Xk=document.createElement("a"),this.Xk.href="#",this.Xk.innerHTML=this.Fa[b].content,this.Xk.addEventListener("click",this.Fa[b].event),this.Xk.addEventListener("click",function(){$(a.Xh).removeClass("block")}),this.Xh.appendChild(this.av),this.av.appendChild(this.Xk);this.Wh.appendChild(this.Xh);this.Wh.appendChild(this.Yk);
this.Th.appendChild(this.Wh)};hp.prototype.compileActions=hp.prototype.Dr;hp.prototype.remove=function(a){A.log("nsVmap.Map.MapPopup.prototype.remove");a=n(a)?a:!0;this.Lp.setPosition(void 0);this.Uh.blur();n(this.vt)&&!1!==a&&Ma(A.g().Ol().wa(),this.vt)&&A.g().Ol().fc(this.vt);return!0};
function ip(a){A.log("nsVmap.Map.MapPopup.prototype.getGeometryCenter");if("Polygon"===a.K())a=$g(Ch(a));else if("MultiPolygon"===a.K()){a=Kl(a);for(var b=0,c=0,d=0;d<a.length;d++)b<a[d].Nj()&&(b=a[d].Nj(),c=d);a=$g(Ch(a[c]))}else if("LineString"===a.K())b=Math.round(a.ca().length/2),a=a.ca()[b];else if("Circle"===a.K())a=a.La();else if("Point"===a.K()||"MultiPoint"===a.K())a=$g(a);else return"GeometryCollection"===a.K()?0:$g(a);return a};function So(a){Jd.call(this);this.Wc=void 0;this.pd="geometry";this.ne=null;this.me=void 0;this.uo=null;J(this,Md(this.pd),this.Jo,this);void 0!==a&&(a instanceof Tg||!a?this.$c(a):Kd(this,a))}E(So,Jd);l=So.prototype;l.clone=function(){var a=new So(Nd(this));lp(a,this.pd);var b=this.j();b&&a.$c(b.clone());(b=this.ne)&&a.xd(b);return a};l.j=function(){return this.get(this.pd)};l.Wb=function(){return this.Wc};l.sF=function(){this.G()};
l.Jo=function(){this.uo&&(ud(this.uo),this.uo=null);var a=this.j();a&&(this.uo=J(a,"change",this.sF,this));this.G()};l.$c=function(a){this.set(this.pd,a)};l.xd=function(a){this.me=(this.ne=a)?mp(a):void 0;this.G()};function lp(a,b){Ad(a,Md(a.pd),a.Jo,a);a.pd=b;J(a,Md(a.pd),a.Jo,a);a.Jo()}function mp(a){var b;if("function"===typeof a)b=2==a.length?function(b){return a(this,b)}:a;else{var c;Array.isArray(a)?c=a:(af(a instanceof Dn,41),c=[a]);b=function(){return c}}return b};function np(){this.Ew=this.yc=null}function op(a,b,c){var d;c&&(d={Wd:c.Wd?c.Wd:a.Qp(b),Kc:c.Kc});return pp(a,d)}function pp(a,b){return pd({Wd:a.yc,Kc:a.Ew},b)}function qp(a,b,c){var d=c?Gg(c.Kc):null,e=c?Gg(c.Wd):null;a=d&&e&&!Og(d,e)?a instanceof Tg?(b?a.clone():a).transform(b?d:e,b?e:d):Sg(b?a.slice():a,b?d:e,b?e:d):a;if(b&&c&&c.cD){var f=Math.pow(10,c.cD);b=function(a){for(var b=0,c=a.length;b<c;++b)a[b]=Math.round(a[b]*f)/f;return a};Array.isArray(a)?b(a):a.cl(b)}return a};function rp(){np.call(this)}E(rp,np);function sp(a){return"string"===typeof a?(a=JSON.parse(a))?a:null:null!==a?a:null}l=rp.prototype;l.K=function(){return"json"};l.bj=function(a,b){return this.rz(sp(a),op(this,a,b))};l.wm=function(a,b){return this.uz(sp(a),op(this,a,b))};l.Qp=function(a){return this.wz(sp(a))};l.Pu=function(a,b){return JSON.stringify(this.Qu(a,b))};l.qn=function(a,b){return JSON.stringify(this.AB(a,b))};l.Tu=function(a,b){return JSON.stringify(this.CB(a,b))};function tp(a){Tg.call(this);this.Rb=a?a:null;up(this)}E(tp,Tg);function vp(a){var b=[],c,d;c=0;for(d=a.length;c<d;++c)b.push(a[c].clone());return b}function wp(a){var b,c;if(a.Rb)for(b=0,c=a.Rb.length;b<c;++b)Ad(a.Rb[b],"change",a.G,a)}function up(a){var b,c;if(a.Rb)for(b=0,c=a.Rb.length;b<c;++b)J(a.Rb[b],"change",a.G,a)}l=tp.prototype;l.clone=function(){var a=new tp(null),b=vp(this.Rb);wp(a);a.Rb=b;up(a);a.G();return a};
l.yf=function(a,b,c,d){if(d<Mf(this.W(),a,b))return d;var e=this.Rb,f,g;f=0;for(g=e.length;f<g;++f)d=e[f].yf(a,b,c,d);return d};l.zf=function(a,b){var c=this.Rb,d,e;d=0;for(e=c.length;d<e;++d)if(c[d].zf(a,b))return!0;return!1};l.Rn=function(a){Qf(a);for(var b=this.Rb,c=0,d=b.length;c<d;++c)Tf(a,b[c].W());return a};
l.rs=function(a){this.mq!=this.Sa&&(qd(this.Gh),this.Hh=0,this.mq=this.Sa);if(0>a||0!==this.Hh&&a<this.Hh)return this;var b=a.toString();if(this.Gh.hasOwnProperty(b))return this.Gh[b];var c=[],d=this.Rb,e=!1,f,g;f=0;for(g=d.length;f<g;++f){var h=d[f],k=h.rs(a);c.push(k);k!==h&&(e=!0)}if(e)return a=new tp(null),wp(a),a.Rb=c,up(a),a.G(),this.Gh[b]=a;this.Hh=a;return this};l.K=function(){return"GeometryCollection"};l.df=function(){return 0===this.Rb.length};
l.rotate=function(a,b){for(var c=this.Rb,d=0,e=c.length;d<e;++d)c[d].rotate(a,b);this.G()};l.scale=function(a,b,c){c||(c=Zf(this.W()));for(var d=this.Rb,e=0,f=d.length;e<f;++e)d[e].scale(a,b,c);this.G()};l.cl=function(a){var b=this.Rb,c,d;c=0;for(d=b.length;c<d;++c)b[c].cl(a);this.G()};l.translate=function(a,b){var c=this.Rb,d,e;d=0;for(e=c.length;d<e;++d)c[d].translate(a,b);this.G()};l.ab=function(){wp(this);Tg.prototype.ab.call(this)};function Ho(a,b,c,d,e){var f=NaN,g=NaN,h=(c-b)/d;if(1===h)f=a[b],g=a[b+1];else if(2==h)f=.5*a[b]+.5*a[b+d],g=.5*a[b+1]+.5*a[b+d+1];else if(0!==h){var g=a[b],h=a[b+1],k=0,f=[0],m;for(m=b+d;m<c;m+=d){var p=a[m],t=a[m+1],k=k+Math.sqrt((p-g)*(p-g)+(t-h)*(t-h));f.push(k);g=p;h=t}c=.5*k;k=0;m=f.length;for(p=!1;k<m;)g=k+(m-k>>1),h=+Ge(f[g],c),0>h?k=g+1:(m=g,p=!h);g=p?k:~k;0>g?(c=(c-f[-g-2])/(f[-g-1]-f[-g-2]),b+=(-g-2)*d,f=a[b],f+=c*(a[b+d]-f),g=a[b+1],g+=c*(a[b+d+1]-g)):(f=a[b+g*d],g=a[b+g*d+1])}return e?
(e[0]=f,e[1]=g,e):[f,g]};function xp(a,b){Xg.call(this);this.$r=null;this.Kd=this.Ld=this.gx=-1;this.Bb(a,b)}E(xp,Xg);l=xp.prototype;l.clone=function(){var a=new xp(null);a.sa(this.Ua,this.l.slice());return a};l.yf=function(a,b,c,d){if(d<Mf(this.W(),a,b))return d;this.Kd!=this.Sa&&(this.Ld=Math.sqrt(fh(this.l,0,this.l.length,this.P,0)),this.Kd=this.Sa);return hh(this.l,0,this.l.length,this.P,this.Ld,!1,a,b,c,d)};l.ca=function(){return mh(this.l,0,this.l.length,this.P)};
l.Xb=function(){var a=this.l,b=this.P,c=a[0],d=a[1],e=0,f;for(f=0+b;f<this.l.length;f+=b)var g=a[f],h=a[f+1],e=e+Math.sqrt((g-c)*(g-c)+(h-d)*(h-d)),c=g,d=h;return e};function Go(a){if(a.gx!=a.Sa){var b;b=Ho(a.l,0,a.l.length,a.P,a.$r);a.$r=b;a.gx=a.Sa}return a.$r}l.Rj=function(a){var b=[];b.length=oh(this.l,0,this.l.length,this.P,a,b,0);a=new xp(null);a.sa("XY",b);return a};l.K=function(){return"LineString"};
l.Bb=function(a,b){a?(bh(this,b,a,1),this.l||(this.l=[]),this.l.length=kh(this.l,0,a,this.P),this.G()):this.sa("XY",null)};l.sa=function(a,b){ah(this,a,b);this.G()};function yp(a,b){Xg.call(this);this.Xa=[];this.Kd=this.Ld=-1;this.Bb(a,b)}E(yp,Xg);function zp(a,b){a.l?Ie(a.l,b.l.slice()):a.l=b.l.slice();a.Xa.push(a.l.length);a.G()}l=yp.prototype;l.clone=function(){var a=new yp(null);a.sa(this.Ua,this.l.slice(),this.Xa.slice());return a};l.yf=function(a,b,c,d){if(d<Mf(this.W(),a,b))return d;this.Kd!=this.Sa&&(this.Ld=Math.sqrt(gh(this.l,0,this.Xa,this.P,0)),this.Kd=this.Sa);return ih(this.l,0,this.Xa,this.P,this.Ld,!1,a,b,c,d)};
l.ca=function(){return nh(this.l,0,this.Xa,this.P)};function Zk(a){var b=a.l,c=a.Xa;a=a.Ua;var d=[],e=0,f,g;f=0;for(g=c.length;f<g;++f){var h=c[f],k=new xp(null);k.sa(a,b.slice(e,h));d.push(k);e=h}return d}l.Rj=function(a){var b=[],c=[],d=this.l,e=this.Xa,f=this.P,g=0,h=0,k,m;k=0;for(m=e.length;k<m;++k){var p=e[k],h=oh(d,g,p,f,a,b,h);c.push(h);g=p}b.length=h;a=new yp(null);a.sa("XY",b,c);return a};l.K=function(){return"MultiLineString"};
l.Bb=function(a,b){a?(bh(this,b,a,2),this.l||(this.l=[]),a=lh(this.l,0,a,this.P,this.Xa),this.l.length=0===a.length?0:a[a.length-1],this.G()):this.sa("XY",null,this.Xa)};l.sa=function(a,b,c){ah(this,a,b);this.Xa=c;this.G()};function Ap(a,b){var c=a.Ua,d=[],e=[],f,g;f=0;for(g=b.length;f<g;++f){var h=b[f];0===f&&(c=h.Ua);Ie(d,h.l);e.push(d.length)}a.sa(c,d,e)};function Bp(a,b){Xg.call(this);this.Bb(a,b)}E(Bp,Xg);function Cp(a,b){a.l?Ie(a.l,b.l):a.l=b.l.slice();a.G()}l=Bp.prototype;l.clone=function(){var a=new Bp(null);a.sa(this.Ua,this.l.slice());return a};l.yf=function(a,b,c,d){if(d<Mf(this.W(),a,b))return d;var e=this.l,f=this.P,g,h,k;g=0;for(h=e.length;g<h;g+=f)if(k=kf(a,b,e[g],e[g+1]),k<d){d=k;for(k=0;k<f;++k)c[k]=e[g+k];c.length=f}return d};l.ca=function(){return mh(this.l,0,this.l.length,this.P)};
function Dp(a){if(0>=(a.l?a.l.length/a.P:0))return null;var b=new rh(null);b.sa(a.Ua,a.l.slice(0*a.P,1*a.P));return b}l.Bi=function(){var a=this.l,b=this.Ua,c=this.P,d=[],e,f;e=0;for(f=a.length;e<f;e+=c){var g=new rh(null);g.sa(b,a.slice(e,e+c));d.push(g)}return d};l.K=function(){return"MultiPoint"};l.Bb=function(a,b){a?(bh(this,b,a,1),this.l||(this.l=[]),this.l.length=kh(this.l,0,a,this.P),this.G()):this.sa("XY",null)};l.sa=function(a,b){ah(this,a,b);this.G()};function Ep(a,b){Xg.call(this);this.oc=[];this.dx=-1;this.ex=null;this.pm=this.Kd=this.Ld=-1;this.lf=null;this.Bb(a,b)}E(Ep,Xg);function Fp(a,b){if(a.l){var c=a.l.length;Ie(a.l,b.l);b=b.Xa.slice();var d,e;d=0;for(e=b.length;d<e;++d)b[d]+=c}else a.l=b.l.slice(),b=b.Xa.slice(),a.oc.push();a.oc.push(b);a.G()}l=Ep.prototype;l.clone=function(){for(var a=new Ep(null),b=this.oc.length,c=Array(b),d=0;d<b;++d)c[d]=this.oc[d].slice();a.sa(this.Ua,this.l.slice(),c);return a};
l.yf=function(a,b,c,d){if(d<Mf(this.W(),a,b))return d;if(this.Kd!=this.Sa){var e=this.oc,f=0,g=0,h,k;h=0;for(k=e.length;h<k;++h)var m=e[h],g=gh(this.l,f,m,this.P,g),f=m[m.length-1];this.Ld=Math.sqrt(g);this.Kd=this.Sa}e=this.xe();f=this.oc;g=this.P;h=this.Ld;k=0;var m=[NaN,NaN],p,t;p=0;for(t=f.length;p<t;++p){var v=f[p];d=ih(e,k,v,g,h,!0,a,b,c,d,m);k=v[v.length-1]}return d};
l.zf=function(a,b){a:{var c=this.xe(),d=this.oc,e=0;if(0!==d.length){var f,g;f=0;for(g=d.length;f<g;++f){var h=d[f];if(th(c,e,h,this.P,a,b)){a=!0;break a}e=h[h.length-1]}}a=!1}return a};l.Nj=function(){var a=this.xe(),b=this.oc,c=0,d=0,e,f;e=0;for(f=b.length;e<f;++e)var g=b[e],d=d+dh(a,c,g,this.P),c=g[g.length-1];return d};
l.ca=function(a){var b;void 0!==a?(b=this.xe().slice(),yh(b,this.oc,this.P,a)):b=this.l;a=b;b=this.oc;var c=this.P,d=0,e=[],f=0,g,h;g=0;for(h=b.length;g<h;++g){var k=b[g];e[f++]=nh(a,d,k,c,e[f]);d=k[k.length-1]}e.length=f;return e};
function Io(a){if(a.dx!=a.Sa){var b=a.l,c=a.oc,d=a.P,e=0,f=[],g,h,k;g=0;for(h=c.length;g<h;++g){var m=c[g];k=b;var p=m[0],t=d,v=Qf(void 0);k=Uf(v,k,e,p,t);f.push((k[0]+k[2])/2,(k[1]+k[3])/2);e=m[m.length-1]}b=a.xe();c=a.oc;d=a.P;g=0;h=[];m=0;for(k=c.length;m<k;++m)e=c[m],h=uh(b,g,e,d,f,2*m,h),g=e[e.length-1];a.ex=h;a.dx=a.Sa}return a.ex}
l.xe=function(){if(this.pm!=this.Sa){var a=this.l,b;a:{b=this.oc;var c,d;c=0;for(d=b.length;c<d;++c)if(!wh(a,b[c],this.P,void 0)){b=!1;break a}b=!0}b?this.lf=a:(this.lf=a.slice(),this.lf.length=yh(this.lf,this.oc,this.P));this.pm=this.Sa}return this.lf};l.Rj=function(a){var b=[],c=[],d=this.l,e=this.oc,f=this.P;a=Math.sqrt(a);var g=0,h=0,k,m;k=0;for(m=e.length;k<m;++k){var p=e[k],t=[],h=ph(d,g,p,f,a,b,h,t);c.push(t);g=p[p.length-1]}b.length=h;d=new Ep(null);d.sa("XY",b,c);return d};
function Kl(a){var b=a.Ua,c=a.l;a=a.oc;var d=[],e=0,f,g,h,k;f=0;for(g=a.length;f<g;++f){var m=a[f].slice(),p=m[m.length-1];if(0!==e)for(h=0,k=m.length;h<k;++h)m[h]-=e;h=new zh(null);h.sa(b,c.slice(e,p),m);d.push(h);e=p}return d}l.K=function(){return"MultiPolygon"};
l.Bb=function(a,b){if(a){bh(this,b,a,3);this.l||(this.l=[]);b=this.l;var c=this.P,d=this.oc,e=0,d=d?d:[],f=0,g,h;g=0;for(h=a.length;g<h;++g)e=lh(b,e,a[g],c,d[f]),d[f++]=e,e=e[e.length-1];d.length=f;0===d.length?this.l.length=0:(a=d[d.length-1],this.l.length=0===a.length?0:a[a.length-1]);this.G()}else this.sa("XY",null,this.oc)};l.sa=function(a,b,c){ah(this,a,b);this.oc=c;this.G()};function Gp(a){a=a?a:{};np.call(this);this.yc=Gg(a.yc?a.yc:"EPSG:4326");a.Kc&&(this.Ew=Gg(a.Kc));this.pd=a.ZD}E(Gp,rp);function Hp(a,b){return a?qp((0,Ip[a.type])(a),!1,b):null}function Jp(a,b){return(0,Kp[a.K()])(qp(a,!0,b),b)}
var Ip={Point:function(a){return new rh(a.coordinates)},LineString:function(a){return new xp(a.coordinates)},Polygon:function(a){return new zh(a.coordinates)},MultiPoint:function(a){return new Bp(a.coordinates)},MultiLineString:function(a){return new yp(a.coordinates)},MultiPolygon:function(a){return new Ep(a.coordinates)},GeometryCollection:function(a,b){a=a.geometries.map(function(a){return Hp(a,b)});return new tp(a)}},Kp={Point:function(a){return{type:"Point",coordinates:a.ca()}},LineString:function(a){return{type:"LineString",
coordinates:a.ca()}},Polygon:function(a,b){var c;b&&(c=b.HI);return{type:"Polygon",coordinates:a.ca(c)}},MultiPoint:function(a){return{type:"MultiPoint",coordinates:a.ca()}},MultiLineString:function(a){return{type:"MultiLineString",coordinates:a.ca()}},MultiPolygon:function(a,b){var c;b&&(c=b.HI);return{type:"MultiPolygon",coordinates:a.ca(c)}},GeometryCollection:function(a,b){return{type:"GeometryCollection",geometries:a.Rb.map(function(a){var c=pd({},b);delete c.Kc;return Jp(a,c)})}},Circle:function(){return{type:"GeometryCollection",
geometries:[]}}};l=Gp.prototype;l.Kt=function(a,b){a="Feature"===a.type?a:{type:"Feature",geometry:a};b=Hp(a.geometry,b);var c=new So;this.pd&&lp(c,this.pd);c.$c(b);void 0!==a.id&&(c.Wc=a.id,c.G());a.properties&&Kd(c,a.properties);return c};l.rz=function(a,b){var c;if("FeatureCollection"===a.type){c=[];a=a.features;var d,e;d=0;for(e=a.length;d<e;++d)c.push(this.Kt(a[d],b))}else c=[this.Kt(a,b)];return c};l.uz=function(a,b){return Hp(a,b)};
l.wz=function(a){a=a.crs;var b;a?"name"==a.type?b=Gg(a.properties.name):"EPSG"==a.type?b=Gg("EPSG:"+a.properties.code):af(!1,36):b=this.yc;return b};l.Qu=function(a,b){b=pp(this,b);var c={type:"Feature"},d=a.Wb();void 0!==d&&(c.id=d);d=a.j();c.geometry=d?Jp(d,b):null;b=Nd(a);delete b[a.pd];c.properties=sd(b)?null:b;return c};l.AB=function(a,b){b=pp(this,b);var c=[],d,e;d=0;for(e=a.length;d<e;++d)c.push(this.Qu(a[d],b));return{type:"FeatureCollection",features:c}};
l.CB=function(a,b){return Jp(a,pp(this,b))};function Lp(a){return a.getAttributeNS("http://www.w3.org/1999/xlink","href")};function Mp(){}Mp.prototype.read=function(a){return a instanceof Document?this.Op(a):a instanceof Node?this.cj(a):"string"===typeof a?(a=Mn(a),this.Op(a)):null};function Np(a){a=Kn(a);return Op(a)}function Op(a){if(a=/^\s*(true|1)|(false|0)\s*$/.exec(a))return void 0!==a[1]||!1}function Pp(a){a=Kn(a);a=Date.parse(a);return isNaN(a)?void 0:a/1E3}function Qp(a){a=Kn(a);return Rp(a)}function Rp(a){if(a=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(a))return parseFloat(a[1])}function Sp(a){a=Kn(a);return Tp(a)}function Tp(a){if(a=/^\s*(\d+)\s*$/.exec(a))return parseInt(a[1],10)}function S(a){return Kn(a).trim()}function Up(a,b){Vp(a,b?"1":"0")}
function Wp(a,b){a.appendChild(Jn.createTextNode(b.toPrecision()))}function Xp(a,b){a.appendChild(Jn.createTextNode(b.toString()))}function Vp(a,b){a.appendChild(Jn.createTextNode(b))};function Yp(){}E(Yp,Mp);Yp.prototype.Op=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType==Node.ELEMENT_NODE)return this.cj(a);return null};Yp.prototype.cj=function(a){return(a=Q({},Zp,a,[]))?a:null};
var $p=[null,"http://www.opengis.net/ows/1.1"],Zp=O($p,{ServiceIdentification:L(function(a,b){return Q({},aq,a,b)}),ServiceProvider:L(function(a,b){return Q({},bq,a,b)}),OperationsMetadata:L(function(a,b){return Q({},cq,a,b)})}),dq=O($p,{DeliveryPoint:L(S),City:L(S),AdministrativeArea:L(S),PostalCode:L(S),Country:L(S),ElectronicMailAddress:L(S)}),eq=O($p,{Value:Qn(function(a){return S(a)})}),fq=O($p,{AllowedValues:L(function(a,b){return Q({},eq,a,b)})}),hq=O($p,{Phone:L(function(a,b){return Q({},
gq,a,b)}),Address:L(function(a,b){return Q({},dq,a,b)})}),jq=O($p,{HTTP:L(function(a,b){return Q({},iq,a,b)})}),iq=O($p,{Get:Qn(function(a,b){var c=Lp(a);if(c)return Q({href:c},kq,a,b)}),Post:void 0}),lq=O($p,{DCP:L(function(a,b){return Q({},jq,a,b)})}),cq=O($p,{Operation:function(a,b){var c=a.getAttribute("name");(a=Q({},lq,a,b))&&(b[b.length-1][c]=a)}}),gq=O($p,{Voice:L(S),Facsimile:L(S)}),kq=O($p,{Constraint:Qn(function(a,b){var c=a.getAttribute("name");if(c)return Q({name:c},fq,a,b)})}),mq=O($p,
{IndividualName:L(S),PositionName:L(S),ContactInfo:L(function(a,b){return Q({},hq,a,b)})}),aq=O($p,{Title:L(S),ServiceTypeVersion:L(S),ServiceType:L(S)}),bq=O($p,{ProviderName:L(S),ProviderSite:L(Lp),ServiceContact:L(function(a,b){return Q({},mq,a,b)})});function nq(){this.FH=new Yp}E(nq,Mp);nq.prototype.Op=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType==Node.ELEMENT_NODE)return this.cj(a);return null};nq.prototype.cj=function(a){var b=a.getAttribute("version").trim(),c=this.FH.cj(a);if(!c)return null;c.version=b;return(c=Q(c,oq,a,[]))?c:null};function pq(a){var b=S(a).split(" ");if(b&&2==b.length&&(a=+b[0],b=+b[1],!isNaN(a)&&!isNaN(b)))return[a,b]}
var qq=[null,"http://www.opengis.net/wmts/1.0"],sq=[null,"http://www.opengis.net/ows/1.1"],oq=O(qq,{Contents:L(function(a,b){return Q({},tq,a,b)})}),tq=O(qq,{Layer:Qn(function(a,b){return Q({},uq,a,b)}),TileMatrixSet:Qn(function(a,b){return Q({},vq,a,b)})}),uq=O(qq,{Style:Qn(function(a,b){if(b=Q({},wq,a,b))return a="true"===a.getAttribute("isDefault"),b.isDefault=a,b}),Format:Qn(S),TileMatrixSetLink:Qn(function(a,b){return Q({},xq,a,b)}),Dimension:Qn(function(a,b){return Q({},yq,a,b)}),ResourceURL:Qn(function(a){var b=
a.getAttribute("format"),c=a.getAttribute("template");a=a.getAttribute("resourceType");var d={};b&&(d.format=b);c&&(d.template=c);a&&(d.resourceType=a);return d})},O(sq,{Title:L(S),Abstract:L(S),WGS84BoundingBox:L(function(a,b){a=Q([],zq,a,b);if(2==a.length)return Hf(a)}),Identifier:L(S)})),wq=O(qq,{LegendURL:Qn(function(a){var b={};b.format=a.getAttribute("format");b.href=Lp(a);return b})},O(sq,{Title:L(S),Identifier:L(S)})),xq=O(qq,{TileMatrixSet:L(S),TileMatrixSetLimits:L(function(a,b){return Q([],
Aq,a,b)})}),Aq=O(qq,{TileMatrixLimits:On(function(a,b){return Q({},Bq,a,b)})}),Bq=O(qq,{TileMatrix:L(S),MinTileRow:L(Sp),MaxTileRow:L(Sp),MinTileCol:L(Sp),MaxTileCol:L(Sp)}),yq=O(qq,{Default:L(S),Value:Qn(S)},O(sq,{Identifier:L(S)})),zq=O(sq,{LowerCorner:On(pq),UpperCorner:On(pq)}),vq=O(qq,{WellKnownScaleSet:L(S),TileMatrix:Qn(function(a,b){return Q({},Cq,a,b)})},O(sq,{SupportedCRS:L(S),Identifier:L(S)})),Cq=O(qq,{TopLeftCorner:L(pq),ScaleDenominator:L(Qp),TileWidth:L(Sp),TileHeight:L(Sp),MatrixWidth:L(Sp),
MatrixHeight:L(Sp)},O(sq,{Identifier:L(S)}));function Dq(a,b){function c(){delete window[e];d.parentNode.removeChild(d)}var d=document.createElement("script"),e="olc_"+I(b);d.async=!0;d.src=a+(-1==a.indexOf("?")?"?":"&")+"jsonp="+e;var f=setTimeout(function(){c()},1E4);window[e]=function(a){clearTimeout(f);c();b(a)};document.getElementsByTagName("head")[0].appendChild(d)};function Eq(a){this.Ji=void 0!==a.Ii?a.Ii:!1;sn.call(this,{Bd:a.Bd,crossOrigin:"anonymous",Ee:!0,la:Gg("EPSG:3857"),Uf:a.Uf,state:"loading",ad:a.ad,Xf:this.Ji?2:1,ib:void 0!==a.ib?a.ib:!0});this.aD=void 0!==a.ki?a.ki:"en-us";this.Cy=void 0!==a.kc?a.kc:-1;this.cC=a.key;this.YF=a.Ps;Dq("https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.YF+"?uriScheme=https&include=ImageryProviders&key="+this.cC,this.uF.bind(this))}E(Eq,sn);var Fq=new Um({html:'<a class="ol-attribution-bing-tos" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a>'});
Eq.prototype.uF=function(a){if(200!=a.statusCode||"OK"!=a.statusDescription||"ValidCredentials"!=a.authenticationResultCode||1!=a.resourceSets.length||1!=a.resourceSets[0].resources.length)this.T="error";else{var b=a.brandLogoUri;-1==b.indexOf("https")&&(b=b.replace("http","https"));var c=a.resourceSets[0].resources[0],d=-1==this.Cy?c.zoomMax:this.Cy;a=this.D();a=ci(a);var e=Tm({Z:a,Ce:c.zoomMin,kc:d,Ng:(c.imageWidth==c.imageHeight?c.imageWidth:[c.imageWidth,c.imageHeight])/this.Sj()});this.Ub=e;
var f=this.aD,g=this.Ji;this.Yf=gn(c.imageUrlSubdomains.map(function(a){var b=[0,0,0],d=c.imageUrl.replace("{subdomain}",a).replace("{culture}",f);return function(a){if(a)return Lm(a[0],a[1],-a[2]-1,b),a=d,g&&(a+="&dpi=d1&device=mobile"),a.replace("{quadkey}",Mm(b))}}));if(c.imageryProviders){var h=Fg(Gg("EPSG:4326"),this.D());a=c.imageryProviders.map(function(a){var b=a.attribution,c={};a.coverageAreas.forEach(function(a){var b=a.zoomMin,f=Math.min(a.zoomMax,d);a=a.bbox;a=eg([a[1],a[0],a[3],a[2]],
h);var g,k;for(g=b;g<=f;++g)k=g.toString(),b=bi(e,a,g),k in c?c[k].push(b):c[k]=[b]});return new Um({html:b,PA:c})});a.push(Fq);this.wf=ln(a);this.G()}this.py=b;this.T="ready"}this.G()};function Gq(a,b){var c=[];Object.keys(b).forEach(function(a){null!==b[a]&&void 0!==b[a]&&c.push(a+"="+encodeURIComponent(b[a]))});var d=c.join("&");a=a.replace(/[?&]$/,"");a=-1===a.indexOf("?")?a+"?":a+"&";return a+d};function Wo(a){a=a||{};var b=a.params||{};sn.call(this,{jb:a.jb,Bd:a.Bd,crossOrigin:a.crossOrigin,zb:a.zb,Ee:!("TRANSPARENT"in b?b.TRANSPARENT:1),la:a.la,Uf:a.Uf,Ub:a.Ub,ad:a.ad,url:a.url,$b:a.$b,ib:void 0!==a.ib?a.ib:!0});this.Io=void 0!==a.Ex?a.Ex:0;this.Cc=b;this.oj=!0;this.zk=a.cu;this.Ji=void 0!==a.Ii?a.Ii:!0;this.zw="";Hq(this);this.dK=If();this.dn();nn(this,Iq(this))}E(Wo,sn);l=Wo.prototype;l.gs=function(){return this.Io};l.Pj=function(a,b,c){return this.zw+sn.prototype.Pj.call(this,a,b,c)};
l.qs=function(a,b,c,d,e,f){var g=this.$b;if(g){f.WIDTH=b[0];f.HEIGHT=b[1];f[this.oj?"CRS":"SRS"]=e.V;"STYLES"in this.Cc||(f.STYLES="");if(1!=d)switch(this.zk){case "geoserver":b=90*d+.5|0;f.FORMAT_OPTIONS="FORMAT_OPTIONS"in f?f.FORMAT_OPTIONS+(";dpi:"+b):"dpi:"+b;break;case "mapserver":f.MAP_RESOLUTION=90*d;break;case "carmentaserver":case "qgis":f.DPI=90*d;break;default:af(!1,52)}e=e.En;this.oj&&"ne"==e.substr(0,2)&&(e=c[0],c[0]=c[1],c[1]=e,e=c[2],c[2]=c[3],c[3]=e);f.BBOX=c.join(",");return Gq(1==
g.length?g[0]:g[mf((a[1]<<a[0])+a[2],g.length)],f)}};l.Sj=function(a){return this.Ji&&void 0!==this.zk?a:1};function Hq(a){var b=0,c=[];if(a.$b){var d,e;d=0;for(e=a.$b.length;d<e;++d)c[b++]=a.$b[d]}a.zw=c.join("#")}function Iq(a){var b=0,c=[],d;for(d in a.Cc)c[b++]=d+"-"+a.Cc[d];return c.join("/")}
l.Kj=function(a,b,c){var d=this.Ub;d||(d=this.tg(c));if(!(d.Qj().length<=a[0])){1==b||this.Ji&&void 0!==this.zk||(b=1);var e=d.xa(a[0]),f=xm(d,a,this.dK),g=Vl(sm(d,a[0]),this.Zm),d=this.Io;if(0!==d){var h=this.Zm;void 0===h&&(h=[0,0]);h[0]=g[0]+2*d;h[1]=g[1]+2*d;g=h;f=Kf(f,e*d,f)}1!=b&&(g=Ul(g,b,this.Zm));e={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};pd(e,this.Cc);return this.qs(a,g,f,b,c,e)}};l.hu=function(a){sn.prototype.hu.call(this,a);Hq(this)};
l.updateParams=function(a){pd(this.Cc,a);Hq(this);this.dn();nn(this,Iq(this))};l.dn=function(){this.oj=0<=xf(this.Cc.VERSION||"1.3.0")};function Jq(a,b,c,d,e){Fd.call(this);this.wf=e;this.Z=a;this.Fg=c;this.ra=b;this.state=d}E(Jq,Fd);Jq.prototype.G=function(){this.dispatchEvent("change")};Jq.prototype.W=function(){return this.Z};Jq.prototype.xa=function(){return this.ra};Jq.prototype.gb=function(){return this.state};function Kq(a,b,c,d,e,f,g){Jq.call(this,a,b,c,0,d);this.Me=e;this.ka=new Image;null!==f&&(this.ka.crossOrigin=f);this.Vo={};this.cf=null;this.state=0;this.Ns=g}E(Kq,Jq);l=Kq.prototype;l.na=function(a){if(void 0!==a){var b=I(a);if(b in this.Vo)return this.Vo[b];a=sd(this.Vo)?this.ka:this.ka.cloneNode(!1);return this.Vo[b]=a}return this.ka};l.Uj=function(){this.state=3;this.Qg();this.G()};l.Wl=function(){void 0===this.ra&&(this.ra=Yf(this.Z)/this.ka.height);this.state=2;this.Qg();this.G()};
l.load=function(){if(0==this.state||3==this.state)this.state=1,this.G(),this.cf=[zd(this.ka,"error",this.Uj,this),zd(this.ka,"load",this.Wl,this)],this.Ns(this,this.Me)};l.gq=function(a){this.ka=a};l.Qg=function(){this.cf.forEach(ud);this.cf=null};function Lq(a,b,c,d,e,f){this.Lk=b;this.xp=a.W();var g=b.W(),h=g?ag(c,g):c,g=Ym(a,b,Zf(h),d);this.Qk=new an(a,b,h,this.xp,.5*g);this.su=d;this.ru=c;a=cn(this.Qk);this.sA=(this.Le=f(a,g,e))?this.Le.Fg:1;this.Rm=this.ja=null;e=2;f=[];this.Le&&(e=0,f=this.Le.wf);Jq.call(this,c,d,this.sA,e,f)}E(Lq,Jq);l=Lq.prototype;l.ab=function(){1==this.state&&(ud(this.Rm),this.Rm=null);Jq.prototype.ab.call(this)};l.na=function(){return this.ja};l.D=function(){return this.Lk};
l.Fm=function(){var a=this.Le.gb();2==a&&(this.ja=$m(Xf(this.ru)/this.su,Yf(this.ru)/this.su,this.sA,this.Le.xa(),0,this.su,this.ru,this.Qk,[{Z:this.Le.W(),Lb:this.Le.na()}],0));this.state=a;this.G()};l.load=function(){if(0==this.state){this.state=1;this.G();var a=this.Le.gb();2==a||3==a?this.Fm():(this.Rm=J(this.Le,"change",function(){var a=this.Le.gb();if(2==a||3==a)ud(this.Rm),this.Rm=null,this.Fm()},this),this.Le.load())}};function Mq(a){kn.call(this,{jb:a.jb,Z:a.Z,zb:a.zb,la:a.la,state:a.state});this.uc=void 0!==a.Ec?a.Ec:null;this.Tf=null;this.Hz=0}E(Mq,kn);Mq.prototype.Qj=function(){return this.uc};function Nq(a,b){a.uc&&(b=a.uc[He(a.uc,b,0)]);return b}
Mq.prototype.na=function(a,b,c,d){var e=this.D();if(e&&d&&!Og(e,d)){if(this.Tf){if(this.Hz==this.Sa&&Og(this.Tf.D(),d)&&this.Tf.xa()==b&&this.Tf.Fg==c&&Sf(this.Tf.W(),a))return this.Tf;this.Tf.Yd();this.Tf=null}this.Tf=new Lq(e,d,a,b,c,function(a,b,c){return this.hs(a,b,c,e)}.bind(this));this.Hz=this.Sa;return this.Tf}e&&(d=e);return this.hs(a,b,c,d)};
Mq.prototype.tF=function(a){a=a.target;switch(a.gb()){case 1:this.dispatchEvent(new Oq(Pq,a));break;case 2:this.dispatchEvent(new Oq(Qq,a));break;case 3:this.dispatchEvent(new Oq(Rq,a))}};function Sq(a,b){a.na().src=b}function Oq(a,b){Dd.call(this,a);this.Lb=b}E(Oq,Dd);var Pq="imageloadstart",Qq="imageloadend",Rq="imageloaderror";function Yo(a){a=a||{};Mq.call(this,{jb:a.jb,zb:a.zb,la:a.la,Ec:a.Ec});this.Xn=void 0!==a.crossOrigin?a.crossOrigin:null;this.Pe=a.url;this.Ns=void 0!==a.Lx?a.Lx:Sq;this.Cc=a.params||{};this.oj=!0;this.dn();this.zk=a.cu;this.Ji=void 0!==a.Ii?a.Ii:!0;this.ka=null;this.Wj=[0,0];this.wd=0;this.Mp=void 0!==a.ratio?a.ratio:1.5}E(Yo,Mq);l=Yo.prototype;
l.hs=function(a,b,c,d){if(void 0===this.Pe)return null;b=Nq(this,b);1==c||this.Ji&&void 0!==this.zk||(c=1);var e=b/c,f=Zf(a),g=$f(f,e,0,[Math.ceil(Xf(a)/e),Math.ceil(Yf(a)/e)]);a=$f(f,e,0,[Math.ceil(this.Mp*Xf(a)/e),Math.ceil(this.Mp*Yf(a)/e)]);if((f=this.ka)&&this.wd==this.Sa&&f.xa()==b&&f.Fg==c&&Nf(f.W(),g))return f;g={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};pd(g,this.Cc);this.Wj[0]=Math.round(Xf(a)/e);this.Wj[1]=Math.round(Yf(a)/e);d=this.qs(a,this.Wj,
c,d,g);this.ka=new Kq(a,b,c,this.wf,d,this.Xn,this.Ns);this.wd=this.Sa;J(this.ka,"change",this.tF,this);return this.ka};
l.qs=function(a,b,c,d,e){af(void 0!==this.Pe,9);e[this.oj?"CRS":"SRS"]=d.V;"STYLES"in this.Cc||(e.STYLES="");if(1!=c)switch(this.zk){case "geoserver":c=90*c+.5|0;e.FORMAT_OPTIONS="FORMAT_OPTIONS"in e?e.FORMAT_OPTIONS+(";dpi:"+c):"dpi:"+c;break;case "mapserver":e.MAP_RESOLUTION=90*c;break;case "carmentaserver":case "qgis":e.DPI=90*c;break;default:af(!1,8)}e.WIDTH=b[0];e.HEIGHT=b[1];b=d.En;e.BBOX=(this.oj&&"ne"==b.substr(0,2)?[a[1],a[0],a[3],a[2]]:a).join(",");return Gq(this.Pe,e)};
l.mA=function(a){a!=this.Pe&&(this.Pe=a,this.ka=null,this.G())};l.updateParams=function(a){pd(this.Cc,a);this.dn();this.ka=null;this.G()};l.dn=function(){this.oj=0<=xf(this.Cc.VERSION||"1.3.0")};function Tq(a,b,c,d,e,f){this.em=void 0!==f?f:null;Jq.call(this,a,b,c,void 0!==f?0:2,d);this.ja=e;this.Tw=null}E(Tq,Jq);Tq.prototype.getError=function(){return this.Tw};Tq.prototype.AF=function(a){a?(this.Tw=a,this.state=3):this.state=2;this.G()};Tq.prototype.load=function(){0==this.state&&(this.state=1,this.G(),this.em(this.AF.bind(this)))};Tq.prototype.na=function(){return this.ja};function Uq(a){Mq.call(this,{jb:a.jb,zb:a.zb,la:a.la,Ec:a.Ec,state:a.state});this.NC=a.LC;this.ja=null;this.wd=0;this.Mp=void 0!==a.ratio?a.ratio:1.5}E(Uq,Mq);Uq.prototype.hs=function(a,b,c,d){b=Nq(this,b);var e=this.ja;if(e&&this.wd==this.Sa&&e.xa()==b&&e.Fg==c&&Nf(e.W(),a))return e;a=a.slice();dg(a,this.Mp);(d=this.NC(a,b,c,[Xf(a)/b*c,Yf(a)/b*c],d))&&(e=new Tq(a,b,c,this.wf,d));this.ja=e;this.wd=this.Sa;return e};function Vq(a){this.ob=a.source;this.kd=Cj();this.il=Vh();this.Ln=[0,0];this.He=void 0==a.Wp?100:a.Wp;this.Oc=null;Uq.call(this,{jb:a.jb,LC:this.MC.bind(this),zb:a.zb,la:a.la,ratio:a.ratio,Ec:a.Ec,state:this.ob.gb()});this.ne=null;this.me=void 0;this.xd(a.style);J(this.ob,"change",this.As,this)}E(Vq,Uq);l=Vq.prototype;
l.MC=function(a,b,c,d,e){var f=new xo(.5*b/c,a,b,this.ob.Jp,this.He);jo(this.ob,a,b,e);var g=!1;ho(this.ob,a,function(a){var d;if(!(d=g)){var e;(d=a.me)?e=d.call(a,b):this.me&&(e=this.me(a,b));if(e){var h,t=!1;Array.isArray(e)||(e=[e]);d=0;for(h=e.length;d<h;++d)t=Eo(f,a,e[d],Do(b,c),this.ys,this)||t;d=t}else d=!1}g=d},this);f.finish();if(g)return null;this.Ln[0]!=d[0]||this.Ln[1]!=d[1]?(this.il.canvas.width=d[0],this.il.canvas.height=d[1],this.Ln[0]=d[0],this.Ln[1]=d[1]):this.il.clearRect(0,0,d[0],
d[1]);a=Wq(this,Zf(a),b,c,d);f.je(this.il,c,a,0,{});this.Oc=f;return this.il.canvas};l.Lc=function(a,b,c,d,e,f){if(this.Oc){var g={};return this.Oc.Lc(a,b,0,d,e,function(a){var b=I(a).toString();if(!(b in g))return g[b]=!0,f(a)})}};l.v=function(){return this.ob};function Wq(a,b,c,d,e){c=d/c;return Lj(a.kd,e[0]/2,e[1]/2,c,-c,0,-b[0],-b[1])}l.ys=function(){this.G()};l.As=function(){this.T=this.ob.gb();this.G()};l.xd=function(a){this.ne=void 0!==a?a:Hn;this.me=a?Fn(this.ne):void 0;this.G()};function Xq(a){this.MG=a.LG;Nm.call(this,{Z:a.Z,origin:a.origin,Hp:a.Hp,Ec:a.Ec,Ng:a.Ng,wq:a.wq,sizes:a.sizes})}E(Xq,Nm);
function Yq(a,b,c){var d=[],e=[],f=[],g=[],h=[],k=void 0!==c?c:[];c=Gg(a.SupportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"));var m=ng(c),p="ne"==c.En.substr(0,2);a.TileMatrix.sort(function(a,b){return b.ScaleDenominator-a.ScaleDenominator});a.TileMatrix.forEach(function(a){if(0<k.length?Je(k,function(b){return a.Identifier==b.TileMatrix}):1){e.push(a.Identifier);var b=2.8E-4*a.ScaleDenominator/m,c=a.TileWidth,t=a.TileHeight;p?f.push([a.TopLeftCorner[1],a.TopLeftCorner[0]]):f.push(a.TopLeftCorner);
d.push(b);g.push(c==t?c:[c,t]);h.push([a.MatrixWidth,-a.MatrixHeight])}});return new Xq({Z:b,Hp:f,Ec:d,LG:e,wq:g,sizes:h})};function Zq(a){function b(a){a="KVP"==d?Gq(a,f):a.replace(/\{(\w+?)\}/g,function(a,b){return b.toLowerCase()in f?f[b.toLowerCase()]:a});return function(b){if(b){var c={TileMatrix:e.MG[b[0]],TileCol:b[1],TileRow:-b[2]-1};pd(c,g);b=a;return b="KVP"==d?Gq(b,c):b.replace(/\{(\w+?)\}/g,function(a,b){return c[b]})}}}this.UK=void 0!==a.version?a.version:"1.0.0";this.po=void 0!==a.format?a.format:"image/jpeg";this.Lr=void 0!==a.Gw?a.Gw:{};this.jp=a.layer;this.NG=a.vp;this.ne=a.style;var c=a.$b;void 0===c&&
void 0!==a.url&&(c=jn(a.url));var d=this.EI=void 0!==a.Gm?a.Gm:"KVP",e=a.Ub,f={layer:this.jp,style:this.ne,tilematrixset:this.NG};"KVP"==d&&pd(f,{Service:"WMTS",Request:"GetTile",Version:this.UK,Format:this.po});var g=this.Lr,h=c&&0<c.length?gn(c.map(b)):hn;sn.call(this,{jb:a.jb,Bd:a.Bd,crossOrigin:a.crossOrigin,zb:a.zb,la:a.la,Uf:a.Uf,Xm:a.Xm,Ub:e,ad:a.ad,Xf:a.Xf,Yf:h,$b:c,ib:void 0!==a.ib?a.ib:!1});nn(this,$q(this))}E(Zq,sn);Zq.prototype.Ac=function(){return this.jp};
function $q(a){var b=0,c=[],d;for(d in a.Lr)c[b++]=d+"-"+a.Lr[d];return c.join("/")}
function ar(a,b){var c=Je(a.Contents.Layer,function(a){return a.Identifier==b.layer});if(null===c)return null;var d=a.Contents.TileMatrixSet,e,f,g;e=1<c.TileMatrixSetLink.length?"projection"in b?Ne(c.TileMatrixSetLink,function(a){var c=Je(d,function(b){return b.Identifier==a.TileMatrixSet}).SupportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),e=Gg(c),f=Gg(b.projection);return e&&f?Og(e,f):c==b.projection}):Ne(c.TileMatrixSetLink,function(a){return a.TileMatrixSet==b.matrixSet}):0;0>
e&&(e=0);f=c.TileMatrixSetLink[e].TileMatrixSet;g=c.TileMatrixSetLink[e].TileMatrixSetLimits;var h=c.Format[0];"format"in b&&(h=b.format);e=Ne(c.Style,function(a){return"style"in b?a.Title==b.style:a.isDefault});0>e&&(e=0);e=c.Style[e].Identifier;var k={};"Dimension"in c&&c.Dimension.forEach(function(a){var b=a.Identifier,c=a.Default;void 0===c&&(c=a.Value[0]);k[b]=c});var m=Je(a.Contents.TileMatrixSet,function(a){return a.Identifier==f}),p;p="projection"in b?Gg(b.projection):Gg(m.SupportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,
"$1:$3"));var t=c.WGS84BoundingBox,v,w;void 0!==t&&(w=Gg("EPSG:4326").W(),w=t[0]==w[0]&&t[2]==w[2],v=Sg(t,"EPSG:4326",p),(t=p.W())&&(Nf(t,v)||(v=void 0)));g=Yq(m,v,g);var x=[],m=b.requestEncoding,m=void 0!==m?m:"";if("OperationsMetadata"in a&&"GetTile"in a.OperationsMetadata)for(a=a.OperationsMetadata.GetTile.DCP.HTTP.Get,v=0,t=a.length;v<t;++v){var y=Je(a[v].Constraint,function(a){return"GetEncoding"==a.name}).AllowedValues.Value;""===m&&(m=y[0]);if("KVP"===m)0<=y.indexOf("KVP")&&x.push(a[v].href);
else break}0===x.length&&(m="REST",c.ResourceURL.forEach(function(a){"tile"===a.resourceType&&(h=a.format,x.push(a.template))}));return{$b:x,layer:b.layer,vp:f,format:h,la:p,Gm:m,Ub:g,style:e,Gw:k,ib:w,crossOrigin:b.crossOrigin}};function br(a){nm.call(this,a);this.ka=null;this.Wo=Cj()}E(br,nm);br.prototype.na=function(){return this.ka?this.ka.na():null};
br.prototype.Yi=function(a,b){var c=a.rc,d=a.size,e=a.hb,f=e.Ka,g=e.ra,h=this.Ac().v(),k=a.sf,m=a.Z;void 0!==b.Z&&(m=ag(m,b.Z));k[0]||k[1]||Wf(m)||(b=h.na(m,g,c,e.la))&&em(this,b)&&(this.ka=b);if(this.ka){b=this.ka;var k=b.W(),m=b.xa(),e=b.Fg,p=c*m/(g*e),k=Lj(this.Wo,c*d[0]/2,c*d[1]/2,p,p,0,e*(k[0]-f[0])/m,e*(f[1]-k[3])/m);Lj(this.Aw,c*d[0]/2-k[4],c*d[1]/2-k[5],c/g,-c/g,0,-f[0],-f[1]);gm(a.jb,b.wf);hm(a,h);this.Dm=g*c/e}return!!this.ka};function cr(a,b){Dm.call(this,a,b);this.ka=null}E(cr,Dm);function dr(a,b){b=b.na();return Fk(a.Lf.Kb,b)}cr.prototype.Lc=function(a,b,c,d,e){var f=this.Ac();return f.v().Lc(a,b.hb.ra,b.hb.rotation,c,b.Qm,function(a){return d.call(e,a,f)})};
cr.prototype.Yi=function(a,b){var c=this.Lf.Kb,d=a.rc,e=a.hb,f=e.Ka,g=e.ra,h=e.rotation,k=this.ka,m=this.Ne,p=this.Ac().v(),t=a.sf,v=a.Z;void 0!==b.Z&&(v=ag(v,b.Z));t[0]||t[1]||Wf(v)||(b=p.na(v,g,d,e.la))&&em(this,b)&&(k=b,m=dr(this,b),this.Ne&&(c=function(a,b){a.isContextLost()||a.deleteTexture(b)}.bind(null,c,this.Ne),a.Rf.push(c)));k&&(c=this.Lf.getContext().ja,er(this,c.width,c.height,d,f,g,h,k.W()),d=this.uu,Dj(d),Jj(d,1,-1),Kj(d,0,-1),this.ka=k,this.Ne=m,gm(a.jb,k.wf),hm(a,p));return!!k};
function er(a,b,c,d,e,f,g,h){b*=f;c*=f;a=a.nz;Dj(a);Jj(a,2*d/b,2*d/c);Ij(a,-g);Kj(a,h[0]-e[0],h[1]-e[1]);Jj(a,(h[2]-h[0])/2,(h[3]-h[1])/2);Kj(a,1,1)};function fr(a){rj.call(this,a?a:{})}E(fr,rj);fr.prototype.Wn=function(a){var b=null,c=a.K();"canvas"===c?b=new br(this):"webgl"===c&&(b=new cr(a,this));return b};function gr(a){options=a||{};a=0;options.stroke&&(a=options.stroke.hc());An.call(this,{tb:options.tb,fill:options.fill,rotation:options.rotation,ke:options.ke});this.ma=options.color;this.TD=options.fontSize||1;this.ha=options.stroke;this.pa=options.fill;this.Ia=options.tb-a;this.ng=options.form||"none";this.gF=options.fF;this.om=[options.offsetX?options.offsetX:0,options.offsetY?options.offsetY:0];this.Ho=this.Kl(options.bF)||"";var b,c=0;this.ha&&(b=xj(this.ha.ma),c=this.ha.hc());a=this.na();var d=
b,e=a.width;b=a.getContext("2d");b.clearRect(0,0,a.width,a.height);var f=this.pa?this.pa.ma:"#000",g=this.ha?this.ha.ma:"#000";"none"==this.ng&&this.ha&&this.pa&&(g=this.pa.ma,f=this.ha.ma);b.setTransform(1,0,0,1,0,0);b.translate(0,0);var h;h=2*this.Ia+c+1;var k=c/2,m=e/2,p={Zd:1,nk:e/2,he:e/2};b.lineJoin="round";b.beginPath();switch(this.ng){case "none":p.Zd=1;break;case "circle":case "ban":b.arc(m,m,h/2,0,2*Math.PI,!0);break;case "poi":b.arc(m,m-.4*this.Ia,.6*this.Ia,.15*Math.PI,.85*Math.PI,!0);
b.lineTo(m-.89*.05*h,(.95+.45*.05)*h+k);b.arc(m,.95*h+k,.05*h,.85*Math.PI,.15*Math.PI,!0);p={Zd:.45,nk:m,he:m-.35*this.Ia};break;case "bubble":b.arc(m,m-.2*this.Ia,.8*this.Ia,.4*Math.PI,.6*Math.PI,!0);b.lineTo(.5*h+k,h+k);p={Zd:.7,nk:m,he:m-.2*this.Ia};break;case "marker":b.arc(m,m-.2*this.Ia,.8*this.Ia,.25*Math.PI,.75*Math.PI,!0);b.lineTo(.5*h+k,h+k);p={Zd:.7,nk:m,he:m-.2*this.Ia};break;case "coma":b.moveTo(m+.8*this.Ia,m-.2*this.Ia);b.quadraticCurveTo(.95*h+k,.75*h+k,.5*h+k,h+k);b.arc(m,m-.2*this.Ia,
.8*this.Ia,.45*Math.PI,0,!1);p={Zd:.7,nk:m,he:m-.2*this.Ia};break;default:switch(this.ng){case "shield":m=[.05,0,.95,0,.95,.8,.5,1,.05,.8,.05,0];p.he=.45*h+k;break;case "blazon":m=[.1,0,.9,0,.9,.8,.6,.8,.5,1,.4,.8,.1,.8,.1,0];p.Zd=.8;p.he=.4*h+k;break;case "bookmark":m=[.05,0,.95,0,.95,1,.5,.8,.05,1,.05,0];p.Zd=.9;p.he=.4*h+k;break;case "hexagon":m=[.05,.2,.5,0,.95,.2,.95,.8,.5,1,.05,.8,.05,.2];p.Zd=.9;p.he=.5*h+k;break;case "diamond":m=[.25,0,.75,0,1,.2,1,.4,.5,1,0,.4,0,.2,.25,0];p.Zd=.75;p.he=.35*
h+k;break;case "triangle":m=[0,0,1,0,.5,1,0,0];p.Zd=.6;p.he=.3*h+k;break;case "sign":m=[.5,.05,1,.95,0,.95,.5,.05];p.Zd=.7;p.he=.65*h+k;break;case "lozenge":m=[.5,0,1,.5,.5,1,0,.5,.5,0];p.Zd=.7;break;default:m=[0,0,1,0,1,1,0,1,0,0]}for(var t=0;t<m.length;t+=2)b.lineTo(m[t]*h+k,m[t+1]*h+k)}b.closePath();h=p;this.pa&&(this.gF&&"none"!=this.ng?(e=b.createLinearGradient(0,0,e/2,e),e.addColorStop(1,xj(f)),e.addColorStop(0,xj(g)),b.fillStyle=e):b.fillStyle=xj(f),b.fill());this.ha&&c&&(b.strokeStyle=d,b.lineWidth=
c,b.stroke());this.Ho.char&&(b.font=2*h.Zd*this.Ia*this.TD+"px "+this.Ho.font,b.strokeStyle=b.fillStyle,b.lineWidth=c*("none"==this.ng?2:1),b.fillStyle=xj(this.ma||g),b.textAlign="center",b.textBaseline="middle",f=this.Ho.char,c&&"transparent"!=g&&b.strokeText(f,h.nk,h.he),b.fillText(f,h.nk,h.he));"ban"==this.ng&&this.ha&&c&&(b.strokeStyle=d,b.lineWidth=c,d=this.Ia+c,c=this.Ia*Math.cos(Math.PI/4),b.moveTo(d+c,d-c),b.lineTo(d-c,d+c),b.stroke());b=this.Il();b[0]=a.width/2-this.om[0];b[1]=a.width/2-
this.om[1]}E(gr,An);l=gr.prototype;l.jg={fonts:{},vs:{}};l.vo=function(){return this.pa};l.Fo=function(){return this.ha};l.Kl=function(a){return a?gr.prototype.jg.vs[a]||{font:"none","char":a.charAt(0),theme:"none",name:"none",search:""}:this.Ho};
l.fh=function(){var a=null!==this.ha?this.ha.fh():"-",b=null!==this.pa?this.pa.fh():"-";if(null===this.cd||a!=this.cd[1]||b!=this.cd[2]||this.Ia!=this.cd[3]||this.ng+"-"+this.Dx!=this.cd[4])this.cd=["c"+a+b+(void 0!==this.Ia?this.Ia.toString():"-")+this.ng+"-"+this.Dx,a,b,this.Ia,this.ng+"-"+this.Dx];return this.cd[0]};var hr={font:"FontAwesome",name:"FontAwesome",copyright:"SIL OFL 1.1",prefix:"fa"},ir={"fa-glass":"\uf000","fa-music":"\uf001","fa-search":"\uf002","fa-envelope-o":"\uf003","fa-heart":"\uf004","fa-star":"\uf005","fa-star-o":"\uf006","fa-user":"\uf007","fa-film":"\uf008","fa-th-large":"\uf009","fa-th":"\uf00a","fa-th-list":"\uf00b","fa-check":"\uf00c","fa-remove":"\uf00d","fa-close":"\uf00d","fa-times":"\uf00d","fa-search-plus":"\uf00e","fa-search-minus":"\uf010","fa-power-off":"\uf011","fa-signal":"\uf012",
"fa-gear":"\uf013","fa-cog":"\uf013","fa-trash-o":"\uf014","fa-home":"\uf015","fa-file-o":"\uf016","fa-clock-o":"\uf017","fa-road":"\uf018","fa-download":"\uf019","fa-arrow-circle-o-down":"\uf01a","fa-arrow-circle-o-up":"\uf01b","fa-inbox":"\uf01c","fa-play-circle-o":"\uf01d","fa-rotate-right":"\uf01e","fa-repeat":"\uf01e","fa-refresh":"\uf021","fa-list-alt":"\uf022","fa-lock":"\uf023","fa-flag":"\uf024","fa-headphones":"\uf025","fa-volume-off":"\uf026","fa-volume-down":"\uf027","fa-volume-up":"\uf028",
"fa-qrcode":"\uf029","fa-barcode":"\uf02a","fa-tag":"\uf02b","fa-tags":"\uf02c","fa-book":"\uf02d","fa-bookmark":"\uf02e","fa-print":"\uf02f","fa-camera":"\uf030","fa-font":"\uf031","fa-bold":"\uf032","fa-italic":"\uf033","fa-text-height":"\uf034","fa-text-width":"\uf035","fa-align-left":"\uf036","fa-align-center":"\uf037","fa-align-right":"\uf038","fa-align-justify":"\uf039","fa-list":"\uf03a","fa-dedent":"\uf03b","fa-outdent":"\uf03b","fa-indent":"\uf03c","fa-video-camera":"\uf03d","fa-photo":"\uf03e",
"fa-image":"\uf03e","fa-picture-o":"\uf03e","fa-pencil":"\uf040","fa-map-marker":"\uf041","fa-adjust":"\uf042","fa-tint":"\uf043","fa-edit":"\uf044","fa-pencil-square-o":"\uf044","fa-share-square-o":"\uf045","fa-check-square-o":"\uf046","fa-arrows":"\uf047","fa-step-backward":"\uf048","fa-fast-backward":"\uf049","fa-backward":"\uf04a","fa-play":"\uf04b","fa-pause":"\uf04c","fa-stop":"\uf04d","fa-forward":"\uf04e","fa-fast-forward":"\uf050","fa-step-forward":"\uf051","fa-eject":"\uf052","fa-chevron-left":"\uf053",
"fa-chevron-right":"\uf054","fa-plus-circle":"\uf055","fa-minus-circle":"\uf056","fa-times-circle":"\uf057","fa-check-circle":"\uf058","fa-question-circle":"\uf059","fa-info-circle":"\uf05a","fa-crosshairs":"\uf05b","fa-times-circle-o":"\uf05c","fa-check-circle-o":"\uf05d","fa-ban":"\uf05e","fa-arrow-left":"\uf060","fa-arrow-right":"\uf061","fa-arrow-up":"\uf062","fa-arrow-down":"\uf063","fa-mail-forward":"\uf064","fa-share":"\uf064","fa-expand":"\uf065","fa-compress":"\uf066","fa-plus":"\uf067",
"fa-minus":"\uf068","fa-asterisk":"\uf069","fa-exclamation-circle":"\uf06a","fa-gift":"\uf06b","fa-leaf":"\uf06c","fa-fire":"\uf06d","fa-eye":"\uf06e","fa-eye-slash":"\uf070","fa-warning":"\uf071","fa-exclamation-triangle":"\uf071","fa-plane":"\uf072","fa-calendar":"\uf073","fa-random":"\uf074","fa-comment":"\uf075","fa-magnet":"\uf076","fa-chevron-up":"\uf077","fa-chevron-down":"\uf078","fa-retweet":"\uf079","fa-shopping-cart":"\uf07a","fa-folder":"\uf07b","fa-folder-open":"\uf07c","fa-arrows-v":"\uf07d",
"fa-arrows-h":"\uf07e","fa-bar-t-o":"\uf080","fa-bar-t":"\uf080","fa-twitter-square":"\uf081","fa-facebook-square":"\uf082","fa-camera-retro":"\uf083","fa-key":"\uf084","fa-gears":"\uf085","fa-cogs":"\uf085","fa-comments":"\uf086","fa-thumbs-o-up":"\uf087","fa-thumbs-o-down":"\uf088","fa-star-half":"\uf089","fa-heart-o":"\uf08a","fa-sign-out":"\uf08b","fa-linkedin-square":"\uf08c","fa-thumb-tack":"\uf08d","fa-external-link":"\uf08e","fa-sign-in":"\uf090","fa-trophy":"\uf091","fa-github-square":"\uf092",
"fa-upload":"\uf093","fa-lemon-o":"\uf094","fa-phone":"\uf095","fa-square-o":"\uf096","fa-bookmark-o":"\uf097","fa-phone-square":"\uf098","fa-twitter":"\uf099","fa-facebook-f":"\uf09a","fa-facebook":"\uf09a","fa-github":"\uf09b","fa-unlock":"\uf09c","fa-credit-card":"\uf09d","fa-feed":"\uf09e","fa-rss":"\uf09e","fa-hdd-o":"\uf0a0","fa-bullhorn":"\uf0a1","fa-bell":"\uf0f3","fa-certificate":"\uf0a3","fa-hand-o-right":"\uf0a4","fa-hand-o-left":"\uf0a5","fa-hand-o-up":"\uf0a6","fa-hand-o-down":"\uf0a7",
"fa-arrow-circle-left":"\uf0a8","fa-arrow-circle-right":"\uf0a9","fa-arrow-circle-up":"\uf0aa","fa-arrow-circle-down":"\uf0ab","fa-globe":"\uf0ac","fa-wrench":"\uf0ad","fa-tasks":"\uf0ae","fa-filter":"\uf0b0","fa-briefcase":"\uf0b1","fa-arrows-alt":"\uf0b2","fa-group":"\uf0c0","fa-users":"\uf0c0","fa-chain":"\uf0c1","fa-link":"\uf0c1","fa-cloud":"\uf0c2","fa-flask":"\uf0c3","fa-cut":"\uf0c4","fa-scissors":"\uf0c4","fa-copy":"\uf0c5","fa-files-o":"\uf0c5","fa-paperclip":"\uf0c6","fa-save":"\uf0c7",
"fa-floppy-o":"\uf0c7","fa-square":"\uf0c8","fa-navicon":"\uf0c9","fa-reorder":"\uf0c9","fa-bars":"\uf0c9","fa-list-ul":"\uf0ca","fa-list-ol":"\uf0cb","fa-strikethrough":"\uf0cc","fa-underline":"\uf0cd","fa-table":"\uf0ce","fa-magic":"\uf0d0","fa-truck":"\uf0d1","fa-pinterest":"\uf0d2","fa-pinterest-square":"\uf0d3","fa-google-plus-square":"\uf0d4","fa-google-plus":"\uf0d5","fa-money":"\uf0d6","fa-caret-down":"\uf0d7","fa-caret-up":"\uf0d8","fa-caret-left":"\uf0d9","fa-caret-right":"\uf0da","fa-columns":"\uf0db",
"fa-unsorted":"\uf0dc","fa-sort":"\uf0dc","fa-sort-down":"\uf0dd","fa-sort-desc":"\uf0dd","fa-sort-up":"\uf0de","fa-sort-asc":"\uf0de","fa-envelope":"\uf0e0","fa-linkedin":"\uf0e1","fa-rotate-left":"\uf0e2","fa-undo":"\uf0e2","fa-legal":"\uf0e3","fa-gavel":"\uf0e3","fa-dashboard":"\uf0e4","fa-tachometer":"\uf0e4","fa-comment-o":"\uf0e5","fa-comments-o":"\uf0e6","fa-flash":"\uf0e7","fa-bolt":"\uf0e7","fa-sitemap":"\uf0e8","fa-umbrella":"\uf0e9","fa-paste":"\uf0ea","fa-clipboard":"\uf0ea","fa-lightbulb-o":"\uf0eb",
"fa-exchange":"\uf0ec","fa-cloud-download":"\uf0ed","fa-cloud-upload":"\uf0ee","fa-user-md":"\uf0f0","fa-stethoscope":"\uf0f1","fa-suitcase":"\uf0f2","fa-bell-o":"\uf0a2","fa-coffee":"\uf0f4","fa-cutlery":"\uf0f5","fa-file-text-o":"\uf0f6","fa-building-o":"\uf0f7","fa-hospital-o":"\uf0f8","fa-ambulance":"\uf0f9","fa-medkit":"\uf0fa","fa-fighter-jet":"\uf0fb","fa-beer":"\uf0fc","fa-h-square":"\uf0fd","fa-plus-square":"\uf0fe","fa-angle-double-left":"\uf100","fa-angle-double-right":"\uf101","fa-angle-double-up":"\uf102",
"fa-angle-double-down":"\uf103","fa-angle-left":"\uf104","fa-angle-right":"\uf105","fa-angle-up":"\uf106","fa-angle-down":"\uf107","fa-desktop":"\uf108","fa-laptop":"\uf109","fa-tablet":"\uf10a","fa-mobile-phone":"\uf10b","fa-mobile":"\uf10b","fa-circle-o":"\uf10c","fa-quote-left":"\uf10d","fa-quote-right":"\uf10e","fa-spinner":"\uf110","fa-circle":"\uf111","fa-mail-reply":"\uf112","fa-reply":"\uf112","fa-github-alt":"\uf113","fa-folder-o":"\uf114","fa-folder-open-o":"\uf115","fa-smile-o":"\uf118",
"fa-frown-o":"\uf119","fa-meh-o":"\uf11a","fa-gamepad":"\uf11b","fa-keyboard-o":"\uf11c","fa-flag-o":"\uf11d","fa-flag-checkered":"\uf11e","fa-terminal":"\uf120","fa-code":"\uf121","fa-mail-reply-all":"\uf122","fa-reply-all":"\uf122","fa-star-half-empty":"\uf123","fa-star-half-full":"\uf123","fa-star-half-o":"\uf123","fa-location-arrow":"\uf124","fa-crop":"\uf125","fa-code-fork":"\uf126","fa-unlink":"\uf127","fa-chain-broken":"\uf127","fa-question":"\uf128","fa-info":"\uf129","fa-exclamation":"\uf12a",
"fa-superscript":"\uf12b","fa-subscript":"\uf12c","fa-eraser":"\uf12d","fa-puzzle-piece":"\uf12e","fa-microphone":"\uf130","fa-microphone-slash":"\uf131","fa-shield":"\uf132","fa-calendar-o":"\uf133","fa-fire-extinguisher":"\uf134","fa-rocket":"\uf135","fa-maxcdn":"\uf136","fa-chevron-circle-left":"\uf137","fa-chevron-circle-right":"\uf138","fa-chevron-circle-up":"\uf139","fa-chevron-circle-down":"\uf13a","fa-html5":"\uf13b","fa-css3":"\uf13c","fa-anchor":"\uf13d","fa-unlock-alt":"\uf13e","fa-bullseye":"\uf140",
"fa-ellipsis-h":"\uf141","fa-ellipsis-v":"\uf142","fa-rss-square":"\uf143","fa-play-circle":"\uf144","fa-ticket":"\uf145","fa-minus-square":"\uf146","fa-minus-square-o":"\uf147","fa-level-up":"\uf148","fa-level-down":"\uf149","fa-check-square":"\uf14a","fa-pencil-square":"\uf14b","fa-external-link-square":"\uf14c","fa-share-square":"\uf14d","fa-compass":"\uf14e","fa-toggle-down":"\uf150","fa-caret-square-o-down":"\uf150","fa-toggle-up":"\uf151","fa-caret-square-o-up":"\uf151","fa-toggle-right":"\uf152",
"fa-caret-square-o-right":"\uf152","fa-euro":"\uf153","fa-eur":"\uf153","fa-gbp":"\uf154","fa-dollar":"\uf155","fa-usd":"\uf155","fa-rupee":"\uf156","fa-inr":"\uf156","fa-cny":"\uf157","fa-rmb":"\uf157","fa-yen":"\uf157","fa-jpy":"\uf157","fa-ruble":"\uf158","fa-rouble":"\uf158","fa-rub":"\uf158","fa-won":"\uf159","fa-krw":"\uf159","fa-bitcoin":"\uf15a","fa-btc":"\uf15a","fa-file":"\uf15b","fa-file-text":"\uf15c","fa-sort-alpha-asc":"\uf15d","fa-sort-alpha-desc":"\uf15e","fa-sort-amount-asc":"\uf160",
"fa-sort-amount-desc":"\uf161","fa-sort-numeric-asc":"\uf162","fa-sort-numeric-desc":"\uf163","fa-thumbs-up":"\uf164","fa-thumbs-down":"\uf165","fa-youtube-square":"\uf166","fa-youtube":"\uf167","fa-xing":"\uf168","fa-xing-square":"\uf169","fa-youtube-play":"\uf16a","fa-dropbox":"\uf16b","fa-stack-overflow":"\uf16c","fa-instagram":"\uf16d","fa-flickr":"\uf16e","fa-adn":"\uf170","fa-bitbucket":"\uf171","fa-bitbucket-square":"\uf172","fa-tumblr":"\uf173","fa-tumblr-square":"\uf174","fa-long-arrow-down":"\uf175",
"fa-long-arrow-up":"\uf176","fa-long-arrow-left":"\uf177","fa-long-arrow-right":"\uf178","fa-apple":"\uf179","fa-windows":"\uf17a","fa-android":"\uf17b","fa-linux":"\uf17c","fa-dribbble":"\uf17d","fa-skype":"\uf17e","fa-foursquare":"\uf180","fa-trello":"\uf181","fa-female":"\uf182","fa-male":"\uf183","fa-gittip":"\uf184","fa-gratipay":"\uf184","fa-sun-o":"\uf185","fa-moon-o":"\uf186","fa-archive":"\uf187","fa-bug":"\uf188","fa-vk":"\uf189","fa-weibo":"\uf18a","fa-renren":"\uf18b","fa-pagelines":"\uf18c",
"fa-stack-exchange":"\uf18d","fa-arrow-circle-o-right":"\uf18e","fa-arrow-circle-o-left":"\uf190","fa-toggle-left":"\uf191","fa-caret-square-o-left":"\uf191","fa-dot-circle-o":"\uf192","fa-wheelchair":"\uf193","fa-vimeo-square":"\uf194","fa-turkish-lira":"\uf195","fa-try":"\uf195","fa-plus-square-o":"\uf196","fa-space-shuttle":"\uf197","fa-slack":"\uf198","fa-envelope-square":"\uf199","fa-wordpress":"\uf19a","fa-openid":"\uf19b","fa-institution":"\uf19c","fa-bank":"\uf19c","fa-university":"\uf19c",
"fa-mortar-board":"\uf19d","fa-graduation-cap":"\uf19d","fa-yahoo":"\uf19e","fa-google":"\uf1a0","fa-reddit":"\uf1a1","fa-reddit-square":"\uf1a2","fa-stumbleupon-circle":"\uf1a3","fa-stumbleupon":"\uf1a4","fa-delicious":"\uf1a5","fa-digg":"\uf1a6","fa-pied-piper":"\uf1a7","fa-pied-piper-alt":"\uf1a8","fa-drupal":"\uf1a9","fa-joomla":"\uf1aa","fa-language":"\uf1ab","fa-fax":"\uf1ac","fa-building":"\uf1ad","fa-child":"\uf1ae","fa-paw":"\uf1b0","fa-spoon":"\uf1b1","fa-cube":"\uf1b2","fa-cubes":"\uf1b3",
"fa-behance":"\uf1b4","fa-behance-square":"\uf1b5","fa-steam":"\uf1b6","fa-steam-square":"\uf1b7","fa-recycle":"\uf1b8","fa-automobile":"\uf1b9","fa-car":"\uf1b9","fa-cab":"\uf1ba","fa-taxi":"\uf1ba","fa-tree":"\uf1bb","fa-spotify":"\uf1bc","fa-deviantart":"\uf1bd","fa-soundcloud":"\uf1be","fa-database":"\uf1c0","fa-file-pdf-o":"\uf1c1","fa-file-word-o":"\uf1c2","fa-file-excel-o":"\uf1c3","fa-file-powerpoint-o":"\uf1c4","fa-file-photo-o":"\uf1c5","fa-file-picture-o":"\uf1c5","fa-file-image-o":"\uf1c5",
"fa-file-zip-o":"\uf1c6","fa-file-archive-o":"\uf1c6","fa-file-sound-o":"\uf1c7","fa-file-audio-o":"\uf1c7","fa-file-movie-o":"\uf1c8","fa-file-video-o":"\uf1c8","fa-file-code-o":"\uf1c9","fa-vine":"\uf1ca","fa-codepen":"\uf1cb","fa-jsfiddle":"\uf1cc","fa-life-bouy":"\uf1cd","fa-life-buoy":"\uf1cd","fa-life-saver":"\uf1cd","fa-support":"\uf1cd","fa-life-ring":"\uf1cd","fa-circle-o-notch":"\uf1ce","fa-ra":"\uf1d0","fa-rebel":"\uf1d0","fa-ge":"\uf1d1","fa-empire":"\uf1d1","fa-git-square":"\uf1d2","fa-git":"\uf1d3",
"fa-y-combinator-square":"\uf1d4","fa-yc-square":"\uf1d4","fa-hacker-news":"\uf1d4","fa-tencent-weibo":"\uf1d5","fa-qq":"\uf1d6","fa-wechat":"\uf1d7","fa-weixin":"\uf1d7","fa-send":"\uf1d8","fa-paper-plane":"\uf1d8","fa-send-o":"\uf1d9","fa-paper-plane-o":"\uf1d9","fa-history":"\uf1da","fa-circle-thin":"\uf1db","fa-header":"\uf1dc","fa-paragraph":"\uf1dd","fa-sliders":"\uf1de","fa-share-alt":"\uf1e0","fa-share-alt-square":"\uf1e1","fa-bomb":"\uf1e2","fa-soccer-ball-o":"\uf1e3","fa-futbol-o":"\uf1e3",
"fa-tty":"\uf1e4","fa-binoculars":"\uf1e5","fa-plug":"\uf1e6","fa-slideshare":"\uf1e7","fa-twitch":"\uf1e8","fa-yelp":"\uf1e9","fa-newspaper-o":"\uf1ea","fa-wifi":"\uf1eb","fa-calculator":"\uf1ec","fa-paypal":"\uf1ed","fa-google-wallet":"\uf1ee","fa-cc-visa":"\uf1f0","fa-cc-mastercard":"\uf1f1","fa-cc-discover":"\uf1f2","fa-cc-amex":"\uf1f3","fa-cc-paypal":"\uf1f4","fa-cc-stripe":"\uf1f5","fa-bell-slash":"\uf1f6","fa-bell-slash-o":"\uf1f7","fa-trash":"\uf1f8","fa-copyright":"\uf1f9","fa-at":"\uf1fa",
"fa-eyedropper":"\uf1fb","fa-paint-brush":"\uf1fc","fa-birthday-cake":"\uf1fd","fa-area-t":"\uf1fe","fa-pie-t":"\uf200","fa-line-t":"\uf201","fa-lastfm":"\uf202","fa-lastfm-square":"\uf203","fa-toggle-off":"\uf204","fa-toggle-on":"\uf205","fa-bicycle":"\uf206","fa-bus":"\uf207","fa-ioxhost":"\uf208","fa-angellist":"\uf209","fa-cc":"\uf20a","fa-shekel":"\uf20b","fa-sheqel":"\uf20b","fa-ils":"\uf20b","fa-meanpath":"\uf20c","fa-buysellads":"\uf20d","fa-connectdevelop":"\uf20e","fa-dashcube":"\uf210",
"fa-forumbee":"\uf211","fa-leanpub":"\uf212","fa-sellsy":"\uf213","fa-shirtsinbulk":"\uf214","fa-simplybuilt":"\uf215","fa-skyatlas":"\uf216","fa-cart-plus":"\uf217","fa-cart-arrow-down":"\uf218","fa-diamond":"\uf219","fa-ship":"\uf21a","fa-user-secret":"\uf21b","fa-motorcycle":"\uf21c","fa-street-view":"\uf21d","fa-heartbeat":"\uf21e","fa-venus":"\uf221","fa-mars":"\uf222","fa-mercury":"\uf223","fa-intersex":"\uf224","fa-transgender":"\uf224","fa-transgender-alt":"\uf225","fa-venus-double":"\uf226",
"fa-mars-double":"\uf227","fa-venus-mars":"\uf228","fa-mars-stroke":"\uf229","fa-mars-stroke-v":"\uf22a","fa-mars-stroke-h":"\uf22b","fa-neuter":"\uf22c","fa-genderless":"\uf22d","fa-facebook-official":"\uf230","fa-pinterest-p":"\uf231","fa-whatsapp":"\uf232","fa-server":"\uf233","fa-user-plus":"\uf234","fa-user-times":"\uf235","fa-hotel":"\uf236","fa-bed":"\uf236","fa-viacoin":"\uf237","fa-train":"\uf238","fa-subway":"\uf239","fa-medium":"\uf23a","fa-yc":"\uf23b","fa-y-combinator":"\uf23b","fa-optin-monster":"\uf23c",
"fa-opencart":"\uf23d","fa-expeditedssl":"\uf23e","fa-battery-4":"\uf240","fa-battery-full":"\uf240","fa-battery-3":"\uf241","fa-battery-three-quarters":"\uf241","fa-battery-2":"\uf242","fa-battery-half":"\uf242","fa-battery-1":"\uf243","fa-battery-quarter":"\uf243","fa-battery-0":"\uf244","fa-battery-empty":"\uf244","fa-mouse-pointer":"\uf245","fa-i-cursor":"\uf246","fa-object-group":"\uf247","fa-object-ungroup":"\uf248","fa-sticky-note":"\uf249","fa-sticky-note-o":"\uf24a","fa-cc-jcb":"\uf24b",
"fa-cc-diners-club":"\uf24c","fa-clone":"\uf24d","fa-balance-scale":"\uf24e","fa-hourglass-o":"\uf250","fa-hourglass-1":"\uf251","fa-hourglass-start":"\uf251","fa-hourglass-2":"\uf252","fa-hourglass-half":"\uf252","fa-hourglass-3":"\uf253","fa-hourglass-end":"\uf253","fa-hourglass":"\uf254","fa-hand-grab-o":"\uf255","fa-hand-rock-o":"\uf255","fa-hand-stop-o":"\uf256","fa-hand-paper-o":"\uf256","fa-hand-scissors-o":"\uf257","fa-hand-lizard-o":"\uf258","fa-hand-spock-o":"\uf259","fa-hand-pointer-o":"\uf25a",
"fa-hand-peace-o":"\uf25b","fa-trademark":"\uf25c","fa-registered":"\uf25d","fa-creative-commons":"\uf25e","fa-gg":"\uf260","fa-gg-circle":"\uf261","fa-tripadvisor":"\uf262","fa-odnoklassniki":"\uf263","fa-odnoklassniki-square":"\uf264","fa-get-pocket":"\uf265","fa-wikipedia-w":"\uf266","fa-safari":"\uf267","fa-chrome":"\uf268","fa-firefox":"\uf269","fa-opera":"\uf26a","fa-internet-explorer":"\uf26b","fa-tv":"\uf26c","fa-television":"\uf26c","fa-contao":"\uf26d","fa-500px":"\uf26e","fa-amazon":"\uf270",
"fa-calendar-plus-o":"\uf271","fa-calendar-minus-o":"\uf272","fa-calendar-times-o":"\uf273","fa-calendar-check-o":"\uf274","fa-industry":"\uf275","fa-map-pin":"\uf276","fa-map-signs":"\uf277","fa-map-o":"\uf278","fa-map":"\uf279","fa-commenting":"\uf27a","fa-commenting-o":"\uf27b","fa-houzz":"\uf27c","fa-vimeo":"\uf27d","fa-black-tie":"\uf27e","fa-fonticons":"\uf280"},jr=hr;"string"==typeof hr&&(jr={font:hr,name:hr,copyright:""});
if(jr.font&&"string"==typeof jr.font){gr.prototype.jg.fonts[jr.font]=jr;for(var kr in ir){var lr=ir[kr];"string"==typeof lr&&1==lr.length&&(lr={char:lr});gr.prototype.jg.vs[kr]={font:jr.font,char:lr.char||""+String.fromCharCode(lr.code)||"",XJ:lr.XJ||jr.name,name:lr.name||kr,search:lr.search||""}}}else console.log("bad font def");var mr=null;function nr(a){if(null==mr)try{mr=angular.element(u.f).injector().get(["$log"])}catch(b){mr=null}null!=mr&&mr.info(a)}Xl.prototype.fd=function(a){nr("ol.Map.prototype.refreshWithTimestamp");this.getLayers().forEach(function(b){b.v().fd(a)})};Xl.prototype.refreshWithTimestamp=Xl.prototype.fd;rj.prototype.fd=function(a){nr("ol.layer.Layer.prototype.refreshWithTimestamp ");this.v().fd(a)};rj.prototype.refreshWithTimestamp=rj.prototype.fd;
kn.prototype.fd=function(a){nr("ol.source.Source.prototype.refreshWithTimestamp");if(this instanceof Yo||this instanceof Wo){var b=this.Cc;b.TIMESTAMP=Date.now();this.updateParams(b);!0!==a&&this.refresh()}};kn.prototype.refreshWithTimestamp=kn.prototype.fd;function or(a,b){nr("ol.geom.SimpleGeometry.prototype.containsPolygon");b=b.ca()[0];for(var c=0;c<b.length;c++)if(!a.zf(b[c][0],b[c][1]))return!1;return!0}
So.prototype.ts=function(){nr("ol.Feature.prototype.getStyleAsJSON");switch(this.j().K()){case "Point":case "MultiPoint":var a=this.ne,b={draw:{color:"rgba(54,184,255,0.6)",outline_color:"rgba(0,0,0,0.4)",size:7},text:null};null!=a&&(null!=a.na()&&(null!=a.na().Kl&&null!=a.na().Kl()&&null!=a.na().Kl().name&&(b.draw.symbol=a.na().Kl().name),null!=a.na().Fe&&(b.draw.size=a.na().Fe),null!=a.na().vo&&null!=a.na().pa&&(b.draw.color=a.na().pa.ma),null!=a.na().Fo&&null!=a.na().ha&&(b.draw.outline_color=
a.na().ha.ma),null!=a.na().Ci&&null!=a.na().Ci()&&(b.draw.image=a.na().Ci())),b.text=pr(a));return b;case "LineString":case "MultiLineString":return a=this.ne,b={draw:{color:"rgba(54,184,255,0.6)",outline_color:"rgba(0,0,0,0.4)",size:7},text:null},null!=a&&(null!=a.pa&&null!=a.pa.ma&&(b.draw.color=a.pa.ma),null!=a.ha&&(q(a.ha.getLineDash())&&(b.draw.dash=a.ha.getLineDash()[0]),null!=a.ha.hc()&&(b.draw.size=a.ha.hc())),b.text=pr(a)),b;case "Polygon":case "MultiPolygon":return a=this.ne,b={draw:{color:"rgba(54,184,255,0.6)",
outline_color:"rgba(0,0,0,0.4)",size:7},text:null},null!=a&&(null!=a.pa&&null!=a.pa.ma&&(b.draw.color=a.pa.ma),null!=a.ha&&(null!=a.ha.ma&&(b.draw.outline_color=a.ha.ma),null!=a.ha.hc()&&(b.draw.size=a.ha.hc())),b.text=pr(a)),b;default:console.error("undefined type: ",this.j().K())}};So.prototype.getStyleAsJSON=So.prototype.ts;
function pr(a){var b=null;if(null!=a.Da){b={};if(null!=a.Da.ti){var c=a.Da.ti.split(" "),d=14;r(c[0])&&-1!==c[0].indexOf("px")&&(d=parseInt(angular.copy(c[0])),c.shift());b.font=c.join(" ");b.size=d}null!=a.Da.pa&&null!=a.Da.pa.ma&&(b.color=a.Da.pa.ma);null!=a.Da.mm&&(b.offsetX=a.Da.mm);null!=a.Da.nm&&(b.offsetY=-1*parseFloat(a.Da.nm));null!=a.Da.ha&&(null!=a.Da.ha.ma&&(b.outline_color=a.Da.ha.ma),null!=a.Da.ha.hc()&&(b.outline_size=a.Da.ha.hc()));null!=a.Da.Gb()&&(b.rotation=180*parseFloat(a.Da.Gb())/
Math.PI);null!=a.Da.Da&&(b.text=a.Da.Da)}return b}
So.prototype.gu=function(a){nr("ol.Feature.prototype.setStyleByJSON");if(null==a)return console.error("oJSON not provided"),!1;r(a)&&(a=JSON.parse(a));if(!ha(a))return console.error("oJSON is neither JSON string nor object"),!1;switch(this.j().K()){case "Point":case "MultiPoint":this.xd(qr(a));break;case "LineString":case "MultiLineString":this.xd(rr(a));break;case "Polygon":case "MultiPolygon":this.xd(sr(a));break;default:console.error("undefined type: ",this.j().K())}};
So.prototype.setStyleByJSON=So.prototype.gu;
function qr(a){a.draw=null!=a.draw?a.draw:{};a.draw.color=null!=a.draw.color?a.draw.color:"rgba(54,184,255,0.6)";a.draw.outline_color=null!=a.draw.outline_color?a.draw.outline_color:"rgba(0,0,0,0.4)";a.draw.size=null!=a.draw.size?a.draw.size:7;var b=new Dn({stroke:new gl({width:a.draw.size,color:a.draw.color}),fill:new Cn({color:a.draw.outline_color})});null!=a.draw.symbol?b.gq(new gr({form:"none",fF:!1,bF:a.draw.symbol,fontSize:.6,tb:a.draw.size,rotation:0,ke:!1,offsetY:0,color:"",fill:new Cn({color:a.draw.color}),
stroke:new gl({color:a.draw.outline_color,width:2})})):null!=a.draw.image?b.gq(new tr({src:a.draw.image})):b.gq(new Bn({tb:a.draw.size,fill:new Cn({color:a.draw.color}),stroke:new gl({color:a.draw.outline_color,width:2})}));null!=a.text&&(a.text.size=null!=a.text.size?a.text.size:14,a.text.font=null!=a.text.font?a.text.font:"Arial",a.text.color=null!=a.text.color?a.text.color:"black",a.text.outline_color=null!=a.text.outline_color?a.text.outline_color:"white",a.text.outline_size=null!=a.text.outline_size?
a.text.outline_size:1,a.text.offsetX=null!=a.text.offsetX?a.text.offsetX:0,a.text.offsetY=null!=a.text.offsetY?a.text.offsetY:0,a.text.rotation=null!=a.text.rotation?a.text.rotation:0,b.Nm(new Ro({font:a.text.size+"px "+a.text.font,text:a.text.text,fill:new Cn({color:a.text.color}),stroke:new gl({color:a.text.outline_color,width:a.text.outline_size}),offsetX:a.text.offsetX,offsetY:-1*parseFloat(a.text.offsetY),rotation:parseFloat(a.text.rotation)*Math.PI/180})));return b}
function rr(a){a.draw=null!=a.draw?a.draw:{};a.draw.color=null!=a.draw.color?a.draw.color:"rgba(54,184,255,0.6)";a.draw.size=null!=a.draw.size?a.draw.size:2;a.draw.dash=null!=a.draw.dash?a.draw.dash:0;var b=new Dn({fill:new Cn({color:a.draw.color}),stroke:new gl({color:a.draw.color,width:a.draw.size,bb:[a.draw.dash]})});null!=a.text&&(a.text.size=null!=a.text.size?a.text.size:14,a.text.font=null!=a.text.font?a.text.font:"Arial",a.text.color=null!=a.text.color?a.text.color:"black",a.text.outline_color=
null!=a.text.outline_color?a.text.outline_color:"white",a.text.outline_size=null!=a.text.outline_size?a.text.outline_size:1,a.text.offsetX=null!=a.text.offsetX?a.text.offsetX:0,a.text.offsetY=null!=a.text.offsetY?a.text.offsetY:0,a.text.rotation=null!=a.text.rotation?a.text.rotation:0,b.Nm(new Ro({font:a.text.size+"px "+a.text.font,text:a.text.text,fill:new Cn({color:a.text.color}),stroke:new gl({color:a.text.outline_color,width:a.text.outline_size}),offsetX:a.text.offsetX,offsetY:-1*parseFloat(a.text.offsetY),
rotation:parseFloat(a.text.rotation)*Math.PI/180})));return b}
function sr(a){a.draw=null!=a.draw?a.draw:{};a.draw.color=null!=a.draw.color?a.draw.color:"rgba(54,184,255,0.6)";a.draw.outline_color=null!=a.draw.outline_color?a.draw.outline_color:"rgba(0,0,0,0.4)";a.draw.size=null!=a.draw.size?a.draw.size:2;var b=new Dn({fill:new Cn({color:a.draw.color}),stroke:new gl({color:a.draw.outline_color,width:a.draw.size})});null!=a.text&&(a.text.size=null!=a.text.size?a.text.size:14,a.text.font=null!=a.text.font?a.text.font:"Arial",a.text.color=null!=a.text.color?a.text.color:
"black",a.text.outline_color=null!=a.text.outline_color?a.text.outline_color:"white",a.text.outline_size=null!=a.text.outline_size?a.text.outline_size:1,a.text.offsetX=null!=a.text.offsetX?a.text.offsetX:0,a.text.offsetY=null!=a.text.offsetY?a.text.offsetY:0,a.text.rotation=null!=a.text.rotation?a.text.rotation:0,b.Nm(new Ro({font:a.text.size+"px "+a.text.font,text:a.text.text,fill:new Cn({color:a.text.color}),stroke:new gl({color:a.text.outline_color,width:a.text.outline_size}),offsetX:a.text.offsetX,
offsetY:-1*parseFloat(a.text.offsetY),rotation:parseFloat(a.text.rotation)*Math.PI/180})));return b};function ur(a){if(null==a)return console.error("opt_options undefied"),0;if(null==a.properties)return console.error("opt_options.properties undefied"),0;this.properties=a.properties}
ur.prototype.Go=function(a,b){b=null!=b?b:{};if(null==a)return console.error("oMapDefinition is not defined: "+a),null;if(null==a.children)return console.error("oMapDefinition.children is not defined: "+a),null;if(null==a.children[0])return console.error("oMapDefinition.children[0] is not defined: "+a),null;if(null==a.children[0].view)return console.error("oMapDefinition.children[0].view is not defined: "+a),null;a=a.children[0].view;var c={};c.Ka=null!=a.center?a.center:[0,0];c.zoom=null!=a.zoom?
a.zoom:0;c.Sn=a.constrainRotation;c.Sw=a.enableRotation;c.Z=a.maxExtent;c.ef=a.maxResolution;c.Be=a.minResolution;c.kc=a.maxZoom;c.Ce=a.minZoom;c.la=a.projection;c.ra=a.resolution;c.Ec=a.resolutions;c.rotation=a.rotation;c.GB=a.zoomFactor;c=new Hh(c);null!=a.extent&&(null!=b.size?Th(c,a.extent,{size:b.size,Ti:!0}):console.error("Cannot calc olView.extent if opt_options.size is not defined"));return c};ur.prototype.getViewFromDef=ur.prototype.Go;
ur.prototype.ls=function(a,b){b=null!=b?b:{};if(null==a)return console.error("oMapDefinition is not defined: "+a),null;if(null==a.children)return console.error("oMapDefinition.children is not defined: "+a),null;if(null==b.size)return console.error("opt_options.size not defined"),null;if(null==b.tileSize)return console.error("opt_options.tileSize not defined"),null;var c,d;d=a.children;for(var e=[],f=1;f<d.length;f++)for(c=0;c<d[f].children.length;c++)e.push(d[f].children[c]);d=e=vr(e);e=[];for(f=
0;f<d.length;f++)c=wr(this,a,d[f],b),null!=c&&(c=xr(d[f],c),null!=c&&e.push(c));return e};ur.prototype.getLayersFromDef=ur.prototype.ls;
ur.prototype.zx=function(a,b){b=null!=b?b:{};var c=this.Go(a,b);if(null==c)return null;if(null==b.tileSize)return console.error("opt_options.tileSize not defined"),null;if(null==b.size)return console.error("opt_options.size not defined"),null;a=Oh(c,b.size);for(var c=c.D().W(),d=Xf(c)/256,e=Array(22),f=0,g=e.length;f<g;++f)e[f]=d/Math.pow(2,f);return new Nm({origin:cg(a),Z:c,Ec:e,Ng:b.tileSize})};ur.prototype.getTileGridFromDef=ur.prototype.zx;
function vr(a){a.sort(function(a,c){return a.index<c.index?-1:a.index>c.index?1:0});return a}
function wr(a,b,c,d){d=null!=d?d:{};if(null==d.tileSize)return console.error("opt_options.tileSize not defined"),null;if(null==d.size)return console.error("opt_options.size not defined"),null;var e=c.layerType;null!=c.params&&!0===c.is_dynamic&&(c.params.TIMESTAMP=Date.now());var f={};if("string"===typeof c.service_options)try{f=JSON.parse(c.service_options)}catch(v){f={}}else"object"!==typeof c.service_options&&(f=c.service_options);var g={};if("string"===typeof c.layer_options)try{g=JSON.parse(c.layer_options)}catch(v){g=
{}}else"object"!==typeof c.layer_options&&(g=c.layer_options);if("tilewms"===e||"imagewms"===e){if(null!=g&&null!=g.layer_style){for(var h=c.params.LAYERS.split(","),k=[],m=0;m<h.length;m++)null!=g.layer_style[h[m]]?k.push(g.layer_style[h[m]].Name):k.push("");c.params.STYLES=k.join(",")}null!=c.params.STYLES||null!=c.params.styles||(c.params.STYLES="");null!=c.tileLoadFunction||(c.tileLoadFunction=function(a,b){b=b.replace("STYLES&","STYLES=&");a.na().src=b});null!=f&&null!=f.login&&null!=f.password&&
(g=function(a,b){var c=new XMLHttpRequest;c.responseType="blob";c.onreadystatechange=function(){c.readyState===XMLHttpRequest.DONE&&200===c.status&&(a.na().src=URL.createObjectURL(c.response))};c.open("GET",b,!0);c.setRequestHeader("Authorization","Basic "+btoa(f.login+":"+f.password));c.send()},c.tileLoadFunction=g,c.imageLoadFunction=g)}if("bing"===e)c=new Eq({key:c.key,ib:c.wrapX,ki:c.culture,kc:c.maxZoom,ad:c.tileLoadFunction,Ps:c.imagerySet});else if("tilewms"===e)c=new Wo({url:a.properties.use_proxy_for_tiles&&
null!=A?yr(c.url):c.url,$b:a.properties.use_proxy_for_tiles&&null!=A?yr(c.urls):c.urls,zb:c.logo,Ii:c.hidpi,ib:c.wrapX,Ex:c.gutter,kc:c.maxZoom,Ub:a.zx(b,d),la:c.projection,cu:c.serverType,crossOrigin:c.crossOrigin,ad:c.tileLoadFunction,params:c.params});else if("imagewms"===e)c=new Yo({url:a.properties.use_proxy_for_tiles&&null!=A?yr(c.url):c.url,zb:c.logo,Ii:c.hidpi,ratio:c.ratio,la:c.projection,cu:c.serverType,Ec:c.resolutions,crossOrigin:c.crossOrigin,jb:c.attributions,Lx:c.imageLoadFunction,
params:c.params});else if("imagevector"===e){if(c.features)a=new ao({features:c.features});else if(c.url)a=new ao({format:new Gp,url:a.properties.use_proxy_for_tiles&&null!=A?yr(c.url):c.url});else{console.error("Error: veuillez renseinger une url ou une feature");return}c=new Vq({style:null!=c.style?c.style:new Dn({fill:new Cn({color:"rgba(255, 255, 255, 0.6)"}),stroke:new gl({color:"#319FD3",width:1})}),source:a})}else if("wmts"===e){var p;if(null==c.service_options)return console.error("oLayerDef.service_options undefined"),
null;try{var t=JSON.parse(c.service_options);p=ar(t,{layer:c.layer,matrixSet:c.matrixSet,requestEncoding:c.requestEncoding,style:c.style,format:c.format});null!=c.style&&(p.style=c.style)}catch(v){console.error("error while parsing options")}c=new Zq(p)}else"xyz"===e?c=new wn({url:c.url}):"osm"===e?(null!=c.url&&""!==c.url||(c.url="https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png"),c=new xn({url:c.url})):(console.error("Error: layerType ("+e+") is not supported"),c=null);return c}
function xr(a,b){var c=a.layerType;b="imagewms"===c||"imagevector"===c?new fr({source:b}):new Km({source:b});b.set("type",c);b.set("name",a.name);b.set("legend",!0);b.set("queryable",!0);"imagewms"!==c&&"tilewms"!==c&&b.set("queryable",!1);a.select=!0;b.set("select",!0);!0===a.bo_queryable&&(b.set("bo_queryable",!0),null!=a.business_objects&&b.set("business_objects",a.business_objects));b.set("layer_id",a.layer_id);null!=a.events&&b.set("events",a.events);null!=a.is_dynamic&&b.set("is_dynamic",a.is_dynamic);
null!=a.is_filtered&&null!=a.filter_form&&r(a.filter_form)&&0!==a.filter_form.length&&(a.filter_form=JSON.parse(a.filter_form),a.filter_values=zr(a.filter_form),b.set("filter_form",a.filter_form),b.set("is_filtered",a.is_filtered),b.set("filter_values",a.filter_values),b.applyFilter=function(){if(null!=this.get("filter_values")&&null!=this.get("filter_values").search){var a;b:{var b=this.get("filter_values").search;try{a=ib(b)}catch(k){a={};break b}for(var c in a)if(ha(a[c])){if(null!=a[c].selectedOption)if(null!=
a[c].selectedOption.value)a[c]=a[c].selectedOption.value;else if(q(a[c].selectedOption)){for(var b=[],g=0;g<a[c].selectedOption.length;g++)null!=a[c].selectedOption[g].value&&b.push(a[c].selectedOption[g].value);a[c]=angular.copy(b)}else delete a[c]}else null!=a[c]||delete a[c]}if(this.v()instanceof Yo||this.v()instanceof Wo){c=this.v().Cc;for(var h in a)q(a[h])?c[h]=a[h].join("|"):c[h]=a[h],null!=c[h]&&(q(c[h])&&ha(c[h])?delete c[h]:r(c[h])&&""===c[h]&&delete c[h]);this.v().updateParams(c);this.v().refresh()}}},
b.applyFilter());a.visible="true"===a.visible||!0===a.visible?!0:!1;b.setVisible(a.visible);null!=a.opacity&&b.Dk(a.opacity);a.olLayer=b;b.values=b.Qh;return b}function zr(a){var b={},c;for(c in a)if("datasources"!==c){b[c]={};for(var d=0;d<a[c].rows.length;d++)for(var e=0;e<a[c].rows[d].fields.length;e++){var f=a[c].rows[d].fields[e].name,g=a[c].rows[d].fields[e].default_value;null!=b[c][f]?null!=g&&""===b[c][f]&&(b[c][f]=g):(b[c][f]="",null!=g&&(b[c][f]=g))}}return b};function Ar(){A.log("nsVmap.nsMapManager.LayersTree")}pa("nsVmap.nsMapManager.LayersTree",Ar);Ar.prototype.mG=function(){A.log("nsVmap.nsMapManager.LayersTree.prototype.layertreeDirective");return{restrict:"A",scope:{map:"=appMap",proj:"=appProj",lang:"=appLang"},controller:"AppLayertreeController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/layers/layertree.html"}};A.module.directive("appLayertree",Ar.prototype.mG);
Ar.prototype.lG=function(){A.log("nsVmap.nsMapManager.LayersTree.prototype.layerOpacitySliderDirective");return{restrict:"A",link:function(a,b){setTimeout(function(){var c=new Slider(b[0],{value:100*a.layer.olLayer.rg(),step:1,min:0,max:100,YL:function(a){return a+" %"}});c.on("change",function(){var b=c.getValue();a.layer.olLayer.Dk(b/100)})})}}};A.module.directive("appLayerOpacitySlider",Ar.prototype.lG);
Ar.prototype.$a=function(a){A.log("nsVmap.nsMapManager.LayersTree.prototype.LayertreeController");var b=this;this.nf=a;a.tree=A.qa.Ai();this.properties=A.properties;this.token=A.properties.token;this.olFilteredLayer={};this.refreshLayersEvents=[];null!=A.properties.vmap&&(this.layers_collapsed=A.properties.vmap.layers_collapsed,this.layerstree_collapsed=A.properties.vmap.layerstree_collapsed);this.ak();if(null!=u.oWebsocket)u.oWebsocket.on("event",function(a){for(var c=0;c<b.refreshLayersEvents.length;c++)b.refreshLayersEvents[c].event===
a&&A.bRefreshWebsockets&&null!=b.refreshLayersEvents[c].layer&&null!=b.refreshLayersEvents[c].layer.fd&&b.refreshLayersEvents[c].layer.fd(!0)});$("body").click(function(c){$(c.target).hasClass(".layer-menu")||$(c.target).closest(".layer-menu").length||$(c.target).hasClass(".layer-menu-button")||$(c.target).closest(".layer-menu-button").length||a.$applyAsync(function(){b.Pn()})})};Ar.prototype.LayertreeController=Ar.prototype.$a;Ar.prototype.$a.$inject=["$scope"];
A.module.controller("AppLayertreeController",Ar.prototype.$a);Ar.prototype.$a.prototype.setVisible=function(a,b){A.log("nsVmap.nsMapManager.LayersTree.prototype.LayertreeController.prototype.setVisible",b);a.setVisible(b);this.map.Ca()};Ar.prototype.$a.prototype.setVisible=Ar.prototype.$a.prototype.setVisible;Ar.prototype.$a.prototype.eJ=function(a){for(var b=0;b<a.children.length;b++)void 0!==a.children[b].olLayer.get("select")&&a.children[b].olLayer.set("select",a.selectable);this.Dy(a)};
Ar.prototype.$a.prototype.setGroupSelectable=Ar.prototype.$a.prototype.eJ;Ar.prototype.$a.prototype.fG=function(a){for(var b=0,c=0;c<a.children.length;c++)!0===a.children[c].olLayer.getVisible(a.visible)&&b++;return b===a.children.length?!0:0===b?!1:null};Ar.prototype.$a.prototype.isGroupVisible=Ar.prototype.$a.prototype.fG;Ar.prototype.$a.prototype.fJ=function(a){for(var b=0;b<a.children.length;b++)a.children[b].olLayer.setVisible(a.visible);this.Ey(a)};
Ar.prototype.$a.prototype.setGroupVisible=Ar.prototype.$a.prototype.fJ;Ar.prototype.$a.prototype.Dy=function(a){if(void 0!==a){var b=a.children;void 0===a.bq&&(a.bq=[]);for(var c=a.bq.length=0;c<b.length;c++)!0===b[c].olLayer.get("select")&&a.bq.push(b[c].olLayer);a.selectable=0===a.bq.length?!1:!0}};Ar.prototype.$a.prototype.memoriseGroupSelectable=Ar.prototype.$a.prototype.Dy;
Ar.prototype.$a.prototype.Ey=function(a){if(void 0!==a){var b=a.children;void 0===a.visibleLayers&&(a.visibleLayers=[]);for(var c=a.visibleLayers.length=0;c<b.length;c++)!0===b[c].olLayer.getVisible()&&a.visibleLayers.push(b[c].olLayer);a.visible=0===a.visibleLayers.length?!1:!0}};Ar.prototype.$a.prototype.memoriseGroupVisible=Ar.prototype.$a.prototype.Ey;
Ar.prototype.$a.prototype.ym=function(){A.log("nsVmap.nsMapManager.LayersTree.prototype.LayertreeController.prototype.reloadTree");var a=jQuery.extend(!0,{},A.qa.Ai());A.qa.ij(a);0<this.map.getLayers().R().length&&this.map.getLayers().clear();this.nf.tree=a;this.ak();A.xk(!1)};Ar.prototype.$a.prototype.reloadTree=Ar.prototype.$a.prototype.ym;
Ar.prototype.$a.prototype.ak=function(){A.log("nsVmap.nsMapManager.LayersTree.prototype.LayertreeController.prototype.loadTree");0<this.map.getLayers().R().length&&this.map.getLayers().clear();A.log(this.nf.tree);var a=[A.properties.vmap.wmsTilesWidth,A.properties.vmap.wmsTilesHeight],b=new ur({properties:A.properties}),c=b.Go(this.nf.tree,{size:this.map.Ta(),tileSize:a}),a=b.ls(this.nf.tree,{size:this.map.Ta(),tileSize:a});A.log("nsVmap.nsMapManager.LayersTree.prototype.LayertreeController.prototype.addView");
var d=Oh(D(this.map),this.map.Ta()),b=D(this.map).D().V,e=c.D().V;c.set("homePosition",{Ka:c.La(),ra:c.xa()});var f=D(this.map).get("homePosition");A.g().gA(c);this.map.Eh(c);this.proj=c.D().V;if(n(b)&&n(e)&&n(d)&&n(f))for(d=Sg(d,b,e),Th(D(this.map),d,{Ti:!0}),d=A.g(),A.log("nsVmap.Map.prototype.reprojectFeatures"),f=0;f<d.ph.length;f++){var g=d.ph[f].v(),h=b,k=e;nr("ol.source.Vector.prototype.transformFeatures");for(var g=g.wa(),m=0;m<g.length;m++)g[m].$c(g[m].j().transform(h,k))}b=A.F.Mc.Ef().vx();
void 0!==b&&b.ud.Eh(new Hh({ra:Nd(c).ra,rotation:Nd(c).rotation,Ka:Nd(c).Ka,la:c.D().V}));$("#current-projection").html(A.oProjections[D(this.map).D().V]);c=A.qa.Nb;for(b=0;b<c.maps.length;b++)if(!0===c.maps[b].used)var p=c.maps[b].name;$("map-name").html(p);Na(this.refreshLayersEvents);for(p=0;p<a.length;p++)if(c=a[p].get("events"),q(c)){b=c;e={};for(f=d=0;f<b.length;)k=h=b[f++],k=ha(k)?"o"+(k[ia]||(k[ia]=++ja)):(typeof k).charAt(0)+k,Object.prototype.hasOwnProperty.call(e,k)||(e[k]=!0,b[d++]=h);
b.length=d;for(b=0;b<c.length;b++)this.refreshLayersEvents.push({layer:a[p],event:c[b]})}for(p=0;p<a.length;p++)this.Eb(a[p])};Ar.prototype.$a.prototype.Eb=function(a){A.log("nsVmap.nsMapManager.LayersTree.prototype.LayertreeController.prototype.addLayer");this.map.Eb(a);A.Zx()};
Ar.prototype.$a.prototype.pD=function(a){A.log("nsVmap.nsMapManager.LayersTree.LayertreeController.displayFilterLayerModal");this.olFilteredLayer=a;null!=a.get("filter_form")||a.set("filter_form",{search:{}});null!=a.get("filter_values")||a.set("filter_values",{search:{}});var b=a.get("filter_form"),c=a.get("filter_values"),d={fields:[{type:"button","class":"btn-ungroup btn-group-sm hidden",nb_cols:12,buttons:[{visibleAllTabs:!0,id:"layerstree_filter_formreader_submit_btn",type:"submit",label:"FORM_UPDATE",
name:"form_submit","class":"btn-primary"}]}]};angular.equals(b.search.rows[b.search.rows.length-1],d)||b.search.rows.push(d);b.search.event=function(b){a.set("filter_values",b);a.applyFilter();$("#layerstree-filter-modal").modal("hide");$.notify("Op\u00e9ration r\u00e9alis\u00e9e avec succ\u00e8s, les couches de la carte se mettent \u00e0 jour","info")};var e=angular.element($("#layerstree_filter_formreader").children()).scope();e.$evalAsync(function(){e.ctrl.setDefinitionName("search");e.ctrl.setFormValues(c);
e.ctrl.setFormDefinition(b);e.ctrl.loadForm();$("#layerstree-filter-modal").modal("show")})};Ar.prototype.$a.prototype.displayFilterLayerModal=Ar.prototype.$a.prototype.pD;Ar.prototype.$a.prototype.mK=function(a){A.log("nsVmap.nsMapManager.LayersTree.LayertreeController.toggleLayerMenu");!0===a.displayedMenu?this.Pn():(this.Pn(),a.displayedMenu=!0)};Ar.prototype.$a.prototype.toggleLayerMenu=Ar.prototype.$a.prototype.mK;
Ar.prototype.$a.prototype.Pn=function(){A.log("nsVmap.nsMapManager.LayersTree.LayertreeController.closeLayersMenus");for(var a=0;a<this.nf.tree.children.length;a++)if(null!=this.nf.tree.children[a].children)for(var b=0;b<this.nf.tree.children[a].children.length;b++)null!=this.nf.tree.children[a].children[b].olLayer&&(this.nf.tree.children[a].children[b].displayedMenu=!1)};Ar.prototype.$a.prototype.closeLayersMenus=Ar.prototype.$a.prototype.Pn;function Br(){A.log("nsVmap.nsMapManager.LayersOrder")}pa("nsVmap.nsMapManager.LayersOrder",Br);Br.prototype.ay=function(){A.log("nsVmap.nsMapManager.LayersOrder.prototype.layersorderDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang"},controller:"AppLayersorderController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/layers/layersorder.html"}};Br.prototype.layersorderDirective=Br.prototype.ay;
Br.prototype.Ag=function(){A.log("nsVmap.nsMapManager.LayersOrder.prototype.layersorderController");var a=this;this.selectedLayers=this.map.getLayers().R().slice().reverse();null!=A.properties.vmap&&(this.layersorder_collapsed=A.properties.vmap.layersorder_collapsed);Zl(A.g().H).on("change",function(){this.selectedLayers=this.map.getLayers().R().slice().reverse()},this);var b=$(".sortable-list").sortable({handle:".sortable-handle",onDrop:function(c,d){c.removeClass(d.group.options.draggedClass).removeAttr("style");
$("body").removeClass(d.group.options.bodyClass);data=b.sortable("serialize").get();c=data[0];d=a.selectedLayers;A.g().H.getLayers().clear();for(var e=c.length-1;0<=e;e--)for(var f=0;f<d.length;f++)d[f].$$hashKey===c[e].hashkey&&A.g().H.getLayers().push(d[f])},onDragStart:function(a,b,e){var c=a.offset(),d=b.rootGroup.pointer;adjustment={left:d.left-c.left,top:d.top-c.top};e(a,b)},onDrag:function(a,b){a.css({left:b.left-adjustment.left,top:b.top-adjustment.top})}})};
Br.prototype.layersorderController=Br.prototype.Ag;Br.prototype.Ag.$inject=["$scope"];Br.prototype.Ag.prototype.setVisible=function(a,b){A.log("nsVmap.nsMapManager.LayersOrder.prototype.layersorderController.prototype.setVisible",b);a.setVisible(b);this.map.Ca()};Br.prototype.Ag.prototype.setVisible=Br.prototype.Ag.prototype.setVisible;
Br.prototype.Ag.prototype.lJ=function(a){var b=a.get("select"),c=A.qa.Ai();a.set("select",!b);for(var d=0;d<c.children.length;d++)if(c.children[d].children){oService=c.children[d].children;for(var e=0;e<oService.length;e++)oService[e].olLayer.$$hashKey===a.$$hashKey&&(oService[e].select=!b)}};Br.prototype.Ag.prototype.setSelectable=Br.prototype.Ag.prototype.lJ;A.module.directive("appLayersorder",Br.prototype.ay);A.module.controller("AppLayersorderController",Br.prototype.Ag);function Cr(){A.log("nsVmap.nsMapManager.MapLegend")}pa("nsVmap.nsMapManager.MapLegend",Cr);Cr.prototype.yy=function(){A.log("nsVmap.nsMapManager.MapLegend.prototype.maplegendDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang"},controller:"AppMaplegendController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/layers/maplegend.html"}};Cr.prototype.maplegendDirective=Cr.prototype.yy;
Cr.prototype.zy=function(){A.log("nsVmap.nsMapManager.MapLegend.prototype.maplegendImageDirective");return{link:function(a,b){var c=0;$(b).mouseenter(function(){c++;var d=angular.copy(c);setTimeout(function(){if(d===c){var e;$("[app-maplegend]").popover({html:!0,content:'<img src="'+a.node.legendURL+'" class="img-responsive">',placement:function(a){e=a;return"right"}});$("[app-maplegend]").popover("show");setTimeout(function(){var a=$(b).offset().top,c=$(b).find("img").height(),a=a-c/2;$(e).css("top",
a+"px")})}},500)}).mouseleave(function(){c++;$("[app-maplegend]").popover("destroy")})}}};Cr.prototype.maplegendImageDirective=Cr.prototype.zy;Cr.prototype.ek=function(){A.log("nsVmap.nsMapManager.MapLegend.prototype.maplegendController");var a=this;this.aUrls=[];null!=A.properties.vmap&&(this.legend_collapsed=A.properties.vmap.legend_collapsed);A.scope.$on("layersChanged",function(){a.dt()});setTimeout(function(){a.dt()})};Cr.prototype.maplegendController=Cr.prototype.ek;
Cr.prototype.ek.$inject=["$scope"];
Cr.prototype.ek.prototype.dt=function(){A.log("nsVmap.nsMapManager.MapLegend.maplegendController.loadLegend");for(var a=A.g().H.getLayers().R(),b={},c=0;c<a.length;c++)if(!0===a[c].get("legend"))if("tilewms"===a[c].get("type")){var d=a[c].get("name");b[d]=[];for(var e=0;e<a[c].v().$b.length;e++)for(var f=a[c].v().Cc.LAYERS.split(","),g=0;g<f.length;g++){var h=-1!==a[c].v().$b[e].indexOf("?")?"&":"?";b[d].push({layerId:c,collapsed:!1,url:a[c].v().$b[e],layer:f[g],olLayer:a[c],layerName:a[c].get("name"),
legendURL:a[c].v().$b[e]+h+"request=GetLegendGraphic&LAYER="+f[g]+"&FORMAT=image/png&VERSION=1.1.0&service=wms"})}}else if("imagewms"===a[c].get("type"))for(d=a[c].get("name"),f=a[c].v().Cc.LAYERS.split(","),b[d]=[],g=0;g<f.length;g++)h=-1!==a[c].v().Pe.indexOf("?")?"&":"?",b[d].push({layerId:c,collapsed:!1,url:a[c].v().Pe,layer:f[g],olLayer:a[c],layerName:a[c].get("name"),legendURL:a[c].v().Pe+h+"request=GetLegendGraphic&LAYER="+f[g]+"&FORMAT=image/png&VERSION=1.1.0&service=wms"});this.oUrls=b};
Cr.prototype.ek.prototype.loadLegend=Cr.prototype.ek.prototype.dt;A.module.directive("appMaplegend",Cr.prototype.yy);A.module.directive("legendImageNode",Cr.prototype.zy);A.module.controller("AppMaplegendController",Cr.prototype.ek);function Dr(){A.log("nsVmap.nsMapManager.nsMapModal.MapList")}pa("nsVmap.nsMapManager.nsMapModal.MapList",Dr);Dr.prototype.OC=function(a){A.log("nsVmap.nsMapManager.nsMapModal.MapList.prototype.changeFilePath");var b=$(a).val(),c=b.lastIndexOf("\\");-1!==c&&(b=b.slice(c+1));$("#upload-file-info").val(b);$("#upload-file-add-button").attr("url","");$("#upload-file-add-button").attr("file-container",a.id)};Dr.prototype.changeFilePath=Dr.prototype.OC;
Dr.prototype.HG=function(){A.log("nsVmap.nsMapManager.nsMapModal.MapList.prototype.maplistDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppMaplistController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/layers/mapmodal/maplist.html"}};
Dr.prototype.th=function(){A.log("nsVmap.nsMapManager.nsMapModal.MapList.prototype.maplistController");this.newMapUrl="";this.catalog=A.qa.hf.Nb;this.projections=A.oProjections;this.mapForm={view:{}};var a=document.getElementById("maplist-file-drop-zone");a.addEventListener("dragover",function(a){this.className="upload-drop-zone drop";a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy";return!1},!1);a.addEventListener("dragleave",function(){this.className="upload-drop-zone";return!1},
!1);a.addEventListener("drop",function(a){a.stopPropagation();a.preventDefault();this.files=a=a.dataTransfer.files;$("#upload-file-info").val(a[0].name);$("#upload-file-add-button").attr("file-container",this.id);this.className="upload-drop-zone";return!1},!1)};Dr.prototype.maplistController=Dr.prototype.th;
Dr.prototype.th.prototype.ZF=function(){A.log("nsVmap.nsMapManager.nsMapModal.MapList.prototype.initNewMapForm");this.mapForm.view={center:D(this.map).La(),zoom:D(this.map).Gf(),maxZoom:28,minZoom:0,projection:D(this.map).D().V}};Dr.prototype.th.prototype.initNewMapForm=Dr.prototype.th.prototype.ZF;
Dr.prototype.th.prototype.$C=function(){A.log("nsVmap.nsMapManager.nsMapModal.MapList.prototype.createNewMap");A.qa.ij({name:"Tree",children:[{view:this.mapForm.view}]});A.qa.ej();for(var a=A.qa.Nb,b=0;b<a.maps.length;b++)a.maps[b].used=!1;A.Zx()};Dr.prototype.th.prototype.createNewMap=Dr.prototype.th.prototype.$C;A.module.directive("appMaplist",Dr.prototype.HG);A.module.controller("AppMaplistController",Dr.prototype.th);function Er(){A.log("nsVmap.nsMapManager.nsMapModal.MapListLitle")}pa("nsVmap.nsMapManager.nsMapModal.MapListLitle",Er);Er.prototype.IG=function(){A.log("nsVmap.nsMapManager.nsMapModal.MapListLitle.prototype.maplistlitleDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppMaplistlitleController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/layers/mapmodal/maplistlitle.html"}};
Er.prototype.it=function(a){A.log("nsVmap.nsMapManager.nsMapModal.MapListLitle.prototype.maplistlitleController");var b=this;this.catalog=A.qa.hf.Nb;a.filter="";a.themes=Fr(this.catalog.maps);a.mapsByThemes=[];a.filterTheme="";a.$watchGroup(["filter","filterTheme"],function(){var c=Ka(b.catalog.maps,function(b){var c=Yc(String(a.filter).toLowerCase()),d=Yc(String(b.name).toLowerCase()),g=Yc(String(b.description).toLowerCase());b=Yc(String(b.theme_name).toLowerCase());b="null"===b?"autres":b;return-1!==
d.indexOf(c)||-1!==g.indexOf(c)||-1!==b.indexOf(c)?""===a.filterTheme||a.filterTheme.toLowerCase()===b?!0:!1:!1});a.mapsByThemes=Gr(c)});$("body").click(function(a){$.contains($("#maplistlitle-container")[0],$(a.target)[0])||$("#maplistlitle-container").removeClass("open")});$(".maplist-map").click(function(){$("#maplistlitle-container").removeClass("open")})};Er.prototype.maplistlitleController=Er.prototype.it;Er.prototype.it.$inject=["$scope"];
function Gr(a){for(var b={},c=0;c<a.length;c++)n(b[a[c].theme_name])?b[a[c].theme_name].push(a[c]):b[a[c].theme_name]=[a[c]];return b}function Fr(a){for(var b=[],c,d=0;d<a.length;d++)c=null===a[d].theme_name?"Autres":a[d].theme_name,-1===b.indexOf(c)&&b.push(c);return b}A.module.directive("appMaplistlitle",Er.prototype.IG);A.module.controller("AppMaplistlitleController",Er.prototype.it);function Hr(){A.log("nsVmap.nsMapManager.nsMapModal.MyMap")}pa("nsVmap.nsMapManager.nsMapModal.MyMap",Hr);Hr.prototype.kH=function(){A.log("nsVmap.nsMapManager.nsMapModal.MyMap.prototype.mymapDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppMymapController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/layers/mapmodal/mymap.html"}};
Hr.prototype.Md=function(){A.log("nsVmap.nsMapManager.nsMapModal.MyMap.prototype.mymapController");this.mapFileHref="";this.oLayersTree={};this.view=this.view={};this.displayedView={};var a=!!document.documentMode,b=!a&&!!window.StyleMedia;this.isIE=!0===a||!0===b};Hr.prototype.mymapController=Hr.prototype.Md;
Hr.prototype.Md.prototype.ym=function(){A.log("nsVmap.nsMapManager.nsMapModal.MyMap.prototype.mymapController.prototype.reloadTree");this.oLayersTree=A.qa.Ai();this.view={zoom:D(A.g().H).Gf(),center:D(A.g().H).La(),projection:D(A.g().H).D().V,extent:Oh(D(this.map),this.map.Ta())};this.displayedView={zoom:this.view.zoom,center:this.view.center[0]+", "+this.view.center[1],projection:A.oProjections[this.view.projection],extent:this.view.extent[0]+", "+this.view.extent[1]+", "+this.view.extent[3]+", "+
this.view.extent[3]};this.xz();$('[data-toggle="tooltip"]').tooltip()};Hr.prototype.Md.prototype.reloadTree=Hr.prototype.Md.prototype.ym;Hr.prototype.Md.prototype.uk=function(a){A.log("nsVmap.nsMapManager.nsMapModal.MyMap.prototype.mymapController.prototype.removeLayer");A.qa.uk(a);this.ym()};Hr.prototype.Md.prototype.removeLayer=Hr.prototype.Md.prototype.uk;
Hr.prototype.Md.prototype.xz=function(){A.log("nsVmap.nsMapManager.nsMapModal.MyMap.prototype.mymapController.prototype.reloadMapFile");var a=A.qa.Ao();this.mapFileHref=a="data:text/json;charset=utf-8,"+encodeURIComponent(a);$("#exportMapButton").attr("href",a)};Hr.prototype.Md.prototype.reloadMapFile=Hr.prototype.Md.prototype.xz;
Hr.prototype.Md.prototype.ao=function(){A.log("nsVmap.nsMapManager.nsMapModal.MyMap.prototype.mymapController.prototype.downloadBlob");var a=new Blob([A.qa.Ao()]);window.navigator.msSaveBlob(a,"map.json")};Hr.prototype.Md.prototype.downloadBlob=Hr.prototype.Md.prototype.ao;A.module.directive("appMymap",Hr.prototype.kH);A.module.controller("AppMymapController",Hr.prototype.Md);function Ir(){this.version=void 0}E(Ir,Mp);Ir.prototype.Op=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType==Node.ELEMENT_NODE)return this.cj(a);return null};Ir.prototype.cj=function(a){this.version=a.getAttribute("version").trim();return(a=Q({version:this.version},Jr,a,[]))?a:null};function Kr(a,b){return Q({},Lr,a,b)}function Mr(a,b){return Q({},Nr,a,b)}function Or(a,b){if(b=Kr(a,b))return a=[Tp(a.getAttribute("width")),Tp(a.getAttribute("height"))],b.size=a,b}
function Pr(a,b){return Q([],Qr,a,b)}
var Rr=[null,"http://www.opengis.net/wms"],Jr=O(Rr,{Service:L(function(a,b){return Q({},Sr,a,b)}),Capability:L(function(a,b){return Q({},Tr,a,b)})}),Tr=O(Rr,{Request:L(function(a,b){return Q({},Ur,a,b)}),Exception:L(function(a,b){return Q([],Vr,a,b)}),Layer:L(function(a,b){return Q({},Wr,a,b)})}),Sr=O(Rr,{Name:L(S),Title:L(S),Abstract:L(S),KeywordList:L(Pr),OnlineResource:L(Lp),ContactInformation:L(function(a,b){return Q({},Xr,a,b)}),Fees:L(S),AccessConstraints:L(S),LayerLimit:L(Sp),MaxWidth:L(Sp),
MaxHeight:L(Sp)}),Xr=O(Rr,{ContactPersonPrimary:L(function(a,b){return Q({},Yr,a,b)}),ContactPosition:L(S),ContactAddress:L(function(a,b){return Q({},Zr,a,b)}),ContactVoiceTelephone:L(S),ContactFacsimileTelephone:L(S),ContactElectronicMailAddress:L(S)}),Yr=O(Rr,{ContactPerson:L(S),ContactOrganization:L(S)}),Zr=O(Rr,{AddressType:L(S),Address:L(S),City:L(S),StateOrProvince:L(S),PostCode:L(S),Country:L(S)}),Vr=O(Rr,{Format:On(S)}),Wr=O(Rr,{Name:L(S),Title:L(S),Abstract:L(S),KeywordList:L(Pr),CRS:Qn(S),
EX_GeographicBoundingBox:L(function(a,b){var c=Q({},$r,a,b);if(c){a=c.westBoundLongitude;b=c.southBoundLatitude;var d=c.eastBoundLongitude,c=c.northBoundLatitude;if(void 0!==a&&void 0!==b&&void 0!==d&&void 0!==c)return[a,b,d,c]}}),BoundingBox:Qn(function(a){var b=[Rp(a.getAttribute("minx")),Rp(a.getAttribute("miny")),Rp(a.getAttribute("maxx")),Rp(a.getAttribute("maxy"))],c=[Rp(a.getAttribute("resx")),Rp(a.getAttribute("resy"))];return{crs:a.getAttribute("CRS"),extent:b,res:c}}),Dimension:Qn(function(a){return{name:a.getAttribute("name"),
units:a.getAttribute("units"),unitSymbol:a.getAttribute("unitSymbol"),"default":a.getAttribute("default"),multipleValues:Op(a.getAttribute("multipleValues")),nearestValue:Op(a.getAttribute("nearestValue")),current:Op(a.getAttribute("current")),values:S(a)}}),Attribution:L(function(a,b){return Q({},as,a,b)}),AuthorityURL:Qn(function(a,b){if(b=Kr(a,b))return b.name=a.getAttribute("name"),b}),Identifier:Qn(S),MetadataURL:Qn(function(a,b){if(b=Kr(a,b))return b.type=a.getAttribute("type"),b}),DataURL:Qn(Kr),
FeatureListURL:Qn(Kr),Style:Qn(function(a,b){return Q({},bs,a,b)}),MinScaleDenominator:L(Qp),MaxScaleDenominator:L(Qp),Layer:Qn(function(a,b){var c=b[b.length-1],d=Q({},Wr,a,b);if(d)return b=Op(a.getAttribute("queryable")),void 0===b&&(b=c.queryable),d.queryable=void 0!==b?b:!1,b=Tp(a.getAttribute("cascaded")),void 0===b&&(b=c.cascaded),d.cascaded=b,b=Op(a.getAttribute("opaque")),void 0===b&&(b=c.opaque),d.opaque=void 0!==b?b:!1,b=Op(a.getAttribute("noSubsets")),void 0===b&&(b=c.noSubsets),d.noSubsets=
void 0!==b?b:!1,(b=Rp(a.getAttribute("fixedWidth")))||(b=c.fixedWidth),d.fixedWidth=b,(a=Rp(a.getAttribute("fixedHeight")))||(a=c.fixedHeight),d.fixedHeight=a,["Style","CRS","AuthorityURL"].forEach(function(a){a in c&&(d[a]=(d[a]||[]).concat(c[a]))}),"EX_GeographicBoundingBox BoundingBox Dimension Attribution MinScaleDenominator MaxScaleDenominator".split(" ").forEach(function(a){a in d||(d[a]=c[a])}),d})}),as=O(Rr,{Title:L(S),OnlineResource:L(Lp),LogoURL:L(Or)}),$r=O(Rr,{westBoundLongitude:L(Qp),
eastBoundLongitude:L(Qp),southBoundLatitude:L(Qp),northBoundLatitude:L(Qp)}),Ur=O(Rr,{GetCapabilities:L(Mr),GetMap:L(Mr),GetFeatureInfo:L(Mr)}),Nr=O(Rr,{Format:Qn(S),DCPType:Qn(function(a,b){return Q({},cs,a,b)})}),cs=O(Rr,{HTTP:L(function(a,b){return Q({},ds,a,b)})}),ds=O(Rr,{Get:L(Kr),Post:L(Kr)}),bs=O(Rr,{Name:L(S),Title:L(S),Abstract:L(S),LegendURL:Qn(Or),StyleSheetURL:L(Kr),StyleURL:L(Kr)}),Lr=O(Rr,{Format:L(S),OnlineResource:L(Lp)}),Qr=O(Rr,{Keyword:On(S)});function es(){A.log("nsVmap.nsMapManager.nsMapModal.WMSSuggestions")}pa("nsVmap.nsMapManager.nsMapModal.WMSSuggestions",es);es.prototype.wB=function(){A.log("nsVmap.wmssuggestionsDirective");return{restrict:"E",scope:{map:"=appMap",proj:"=appProj",lang:"=appLang"},controller:"AppWmssuggestionsController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/layers/mapmodal/wmssuggestions.html"}};es.prototype.wmssuggestionsDirective=es.prototype.wB;
es.prototype.Qe=function(a){A.log("nsVmap.wmssuggestionsController");var b=this;this.b=a;this.aLayers=[];a.aServices=[];this.Qz=this.Pz=this.bu="";a.oSelectedService={url:"",login:"",password:""};a.oSelectedStyle={};a.filter="";a.$watch("filter",function(){var c=Ka(b.aLayers,function(b){var c=Yc(String(a.filter).toLowerCase()),d=Yc(String(b.Name).toLowerCase()),g=Yc(String(b.Title).toLowerCase());b=Yc(String(b.projections).toLowerCase());return-1!==d.indexOf(c)||-1!==g.indexOf(c)||-1!==b.indexOf(c)?
!0:!1});b.aLayersFiltered=c});this.yz()};es.prototype.wmssuggestionsController=es.prototype.Qe;es.prototype.Qe.$inject=["$scope"];
es.prototype.Qe.prototype.ds=function(){A.log("getCapabilities");var a=this,b=angular.copy(Zc(this.b.oSelectedService.url)),c=[];Na(this.aLayers);Na(this.aLayersFiltered);if(""===b)return $.notify("Veuillez renseigner une URL","error"),0;this.bu=angular.copy(Zc(this.b.oSelectedService.url));this.Pz=angular.copy(this.b.oSelectedService.login);this.Qz=angular.copy(this.b.oSelectedService.password);b=-1===b.indexOf("?")?b+"?":b+"&";b+="service=WMS&version=1.3.0&request=GetCapabilities";$("#log-message").empty();
$("#load-img-wms").show();var d={charset:"charset=utf-8"};null!=this.b.oSelectedService.login&&null!=this.b.oSelectedService.password&&(d.Authorization="Basic "+btoa(this.b.oSelectedService.login+":"+this.b.oSelectedService.password));z({method:"GET",url:A.properties.proxy_url+"?url="+encodeURIComponent(b),headers:d,scope:this.b,timeout:5E3,responseType:"text",success:function(b){function d(a){if(void 0===a.Layer)c.push(a);else for(var b=0;b<a.Layer.length;b++)d(a.Layer[b])}function e(a){"string"==
typeof a&&(a=a.replace(/&gt;/ig,">"),a=a.replace(/&lt;/ig,"<"),a=a.replace(/&#039;/g,"'"),a=a.replace(/&quot;/ig,'"'),a=a.replace(/&amp;/ig,"&"));return a}$("#load-img-wms").hide();if(""===b.data)return A.log("GetCapabilities sans r\u00e9sultat"),$.notify("Requ\u00eate GetCapabilities sans r\u00e9sultat, veuillez v\u00e9rifier l'URL du service","error"),0;A.log("GetCapabilities pass");var h=new Ir,k=e(b.data);try{k=h.read(k)}catch(p){return bootbox.alert(b.data),0}var m=[];D(A.g().H).D();h=k.Service.Title;
d(k.Capability.Layer);c.serviceTitle=h;c.version=k.version;$(e(b.data)).find("Layer").each(function(){var a={JI:$(this).children("Name").text(),Jm:""};if(0<$(this).children("CRS").length&&10>$(this).children("CRS").length)for(var b=0;b<$(this).children("CRS").length;b++)a.Jm+=$(this).children("CRS")[b].innerHTML+" ";if(0<$(this).children("SRS").length&&10>$(this).children("SRS").length)for(b=0;b<$(this).children("SRS").length;b++)a.Jm+=$(this).children("SRS")[b].innerHTML+" ";m.push(a)});for(b=0;b<
c.length;b++)for(k=0;k<m.length;k++)m[k].JI===c[b].Name&&(c[b].projections=m[k].Jm);$("#wms-suggestions-list").show();a.aLayers=c;a.aLayersFiltered=c},error:function(a){$("#load-img-wms").hide();console.error(a);$.notify("Erreur lors du chargement (plus d'infos en console)","error")}})};es.prototype.Qe.prototype.getCapabilities=es.prototype.Qe.prototype.ds;
es.prototype.Qe.prototype.Eb=function(a,b){A.log("nsVmap.nsMapManager.nsMapModal.WMSSuggestions.prototype.wmssuggestionsController.prototype.addLayer");var c=this.bu,d=a.Name,e=a.Title,f=a.queryable,g=this.aLayers.version,h;if(null!=b)h=b,$("#wms-select-style-modal").modal("hide");else if(q(a.Style)){if(1<a.Style.length)return this.oLayerToAdd=a,this.b.oSelectedStyle=this.oLayerToAdd.Style[0],$("#wms-select-style-modal").modal("show"),0;null!=a.Style[0]&&null!=a.Style[0].Name&&(h=a.Style[0].Name)}-1===
c.indexOf("?")&&(c+="?service=wms");A.log("nsVmap.nsMapManager.nsMapModal.WMSSuggestions.prototype.wmssuggestionsController.prototype.getServiceTitle");var k;a=this.b.aServices;for(b=0;b<a.length;b++)a[b].url===this.bu&&(k=a[b].name);null!=k||(k=this.aLayers.serviceTitle);a={};a.url=c;a.ht=this.Pz;a.password=this.Qz;a.de="imagewms";a.Qc=k;a.ce=d;a.Hd=e;a.iI=f;a.version=g;a.style=h;A.qa.Eb(a)};es.prototype.Qe.prototype.addLayer=es.prototype.Qe.prototype.Eb;
es.prototype.Qe.prototype.yz=function(){A.log("nsVmap.nsMapManager.nsMapModal.WMSSuggestions.prototype.wmssuggestionsController.prototype.reloadServicesList");var a=[],b;b=angular.copy(A.qa.Nb);for(var c=0;c<b.services.wms.length;c++)a.push(b.services.wms[c]);for(c=0;c<a.length;c++){b={};if(null!=a[c].service_options)if(r(a[c].service_options))try{b=JSON.parse(a[c].service_options)}catch(d){b={}}else ha(a[c].service_options)&&(b=a[c].service_options);null!=b.login&&null!=b.password?(a[c].login=b.login,
a[c].password=b.password):(a[c].login="",a[c].password="")}this.b.aServices=a};es.prototype.Qe.prototype.reloadServicesList=es.prototype.Qe.prototype.yz;A.module.directive("appWmssuggestions",es.prototype.wB);A.module.controller("AppWmssuggestionsController",es.prototype.Qe);function fs(){A.log("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions")}pa("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions",fs);fs.prototype.xB=function(){A.log("nsVmap.wmtssuggestionsDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppWmtssuggestionsController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/layers/mapmodal/wmtssuggestions.html"}};fs.prototype.wmtssuggestionsDirective=fs.prototype.xB;
fs.prototype.Ad=function(a){A.log("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions.prototype.wmtssuggestionsController");var b=this;this.b=a;this.Gv=angular.element(u.f).scope();this.catalog=A.qa.hf.Nb;this.aLayers=[];a.filter="";this.oService;this.sRequestUrl="";this.sRequestType="KVP";this.sRequestVersion="1.0.0";this.oLayerToAdd;this.sLayerToAdd_name;this.sLayerToAdd_style_name;this.sLayerToAdd_matrix_name;this.oLayerToAdd_matrix_def={};this.oCapabilities;a.iServiceIndex;a.iSelectedStyleIndex;a.$watch("ctrl.sLayerToAdd_matrix_name",
function(a){gb(b.oLayerToAdd_matrix_def);if(null!=a&&""!==a&&null!=b.oCapabilities&&null!=b.oCapabilities.Contents&&null!=b.oCapabilities.Contents&&q(b.oCapabilities.Contents.TileMatrixSet))for(var c=b.oCapabilities.Contents.TileMatrixSet,e=0;e<c.length;e++)c[e].Identifier===a&&(b.oLayerToAdd_matrix_def=angular.copy(c[e]))});a.$watch("filter",function(){var c=Ka(b.aLayers,function(b){var c=Yc(String(a.filter).toLowerCase()),d=Yc(String(b.Identifier).toLowerCase());b=Yc(String(b.Title).toLowerCase());
return-1!==d.indexOf(c)||-1!==b.indexOf(c)?!0:!1});b.aLayersFiltered=c})};fs.prototype.wmtssuggestionsController=fs.prototype.Ad;fs.prototype.Ad.$inject=["$scope"];
fs.prototype.Ad.prototype.VI=function(a){A.log("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions.prototype.wmtssuggestionsController.prototype.selectService");this.oService=this.catalog.services.wmts[a];null!=this.oService?(this.sRequestUrl=null!=this.oService.url?this.oService.url:"",this.sRequestType=null!=this.oService.service_type_type?this.oService.service_type_type:"KVP",this.sRequestVersion=null!=this.oService.service_type_version?this.oService.service_type_version:"1.0.0"):(this.sRequestUrl=
"",this.sRequestType="KVP",this.sRequestVersion="1.0.0")};fs.prototype.Ad.prototype.selectService=fs.prototype.Ad.prototype.VI;
fs.prototype.Ad.prototype.ds=function(){A.log("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions.prototype.wmtssuggestionsController.prototype.getCapabilities");if(null==this.sRequestUrl||""===this.sRequestUrl)return $.notify("Informations insuffisantes: URL","error"),null;if(null==this.sRequestType||""===this.sRequestType)return $.notify("Informations insuffisantes: Type","error"),null;if(null==this.sRequestVersion||""===this.sRequestVersion)return $.notify("Informations insuffisantes: Version","error"),
null;var a=this;$("#load-img-wmts").show();$("#wmts-suggestions-list").hide();Na(this.aLayers);Na(this.aLayersFiltered);gb(a.oCapabilities);var b=angular.copy(Zc(this.sRequestUrl));this.Gv.WMTSCapabilities({serviceUrl:b,serviceVersion:this.sRequestVersion,WMTSType:this.sRequestType},function(b){a.oCapabilities=b;$("#load-img-wmts").hide();$("#wmts-suggestions-list").show();b=!1;null!=a.oCapabilities&&null!=a.oCapabilities.Contents&&null!=a.oCapabilities.Contents.Layer&&(b=!0);if(b)a.aLayers=a.oCapabilities.Contents.Layer,
a.aLayersFiltered=a.oCapabilities.Contents.Layer;else return $.notify("Contenu du service incoh\u00e9rent","error"),null},function(b){$("#load-img-wmts").hide();a.Gv.$root.modalWindow("dialog","Service non valide",{className:"modal-danger",message:b})})};fs.prototype.Ad.prototype.getCapabilities=fs.prototype.Ad.prototype.ds;
fs.prototype.Ad.prototype.Eb=function(a){A.log("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions.prototype.wmtssuggestionsController.prototype.addLayer");this.sLayerToAdd_matrix_name=this.sLayerToAdd_format_name=this.sLayerToAdd_style_name=this.sLayerToAdd_name="";if(!q(a.Style))return $.notify("Informations insuffisantes: Style","error"),null;if(!q(a.TileMatrixSetLink))return $.notify("Informations insuffisantes: Matrice","error"),null;this.oLayerToAdd=a;this.sLayerToAdd_name=a.Identifier;this.sLayerToAdd_title=
a.Title;1===a.Style.length&&1===a.Format.length&&1===a.TileMatrixSetLink.length?(this.sLayerToAdd_style_name=this.oLayerToAdd.Style[0].Identifier,this.sLayerToAdd_format_name=this.oLayerToAdd.Format[0],this.sLayerToAdd_matrix_name=this.oLayerToAdd.TileMatrixSetLink[0].TileMatrixSet,this.ov()):(this.sLayerToAdd_matrix_name=this.sLayerToAdd_format_name=this.sLayerToAdd_style_name="?",$("#wmts-select-matrix-modal").modal("show"))};fs.prototype.Ad.prototype.addLayer=fs.prototype.Ad.prototype.Eb;
fs.prototype.Ad.prototype.ov=function(){A.log("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions.prototype.wmtssuggestionsController.prototype.addLayerToAdd");console.log("this['sLayerToAdd_style_name']: ",this.sLayerToAdd_style_name);if(null==this.sLayerToAdd_name||""===this.sLayerToAdd_name)return $.notify("Informations insuffisantes: Nom de la couche","error"),null;if(null==this.sLayerToAdd_title||""===this.sLayerToAdd_title)return $.notify("Informations insuffisantes: Titre de la couche","error"),
null;if(null==this.sLayerToAdd_style_name||"?"===this.sLayerToAdd_style_name)return $.notify("Informations insuffisantes: Style","error"),null;if(null==this.sLayerToAdd_matrix_name||"?"===this.sLayerToAdd_matrix_name)return $.notify("Informations insuffisantes: Matrice","error"),null;if(null==this.sLayerToAdd_format_name||"?"===this.sLayerToAdd_format_name)return $.notify("Informations insuffisantes Format","error"),null;var a=!1;null!=this.oCapabilities&&null!=this.oCapabilities.Contents&&null!=
this.oCapabilities.Contents.Layer&&(a=!0);if(!a)return $.notify("Contenu du service incoh\u00e9rent","error"),null;$("#wmts-select-matrix-modal").modal("hide");a={de:"wmts"};a.ce=this.sLayerToAdd_name;a.Hd=this.sLayerToAdd_title;a.style=this.sLayerToAdd_style_name;a.vp=this.sLayerToAdd_matrix_name;a.format=this.sLayerToAdd_format_name;a.Gm=this.sRequestType;a.version=this.sRequestVersion;a.url=this.sRequestUrl;a.Ak=JSON.stringify(this.oCapabilities);null!=this.b.iServiceIndex&&null!=this.catalog&&
null!=this.catalog.services&&null!=this.catalog.services.wmts&&null!=this.catalog.services.wmts[this.b.iServiceIndex]&&null!=this.catalog.services.wmts[this.b.iServiceIndex].name&&(a.Qc=this.catalog.services.wmts[this.b.iServiceIndex].name);null==a.Qc&&null!=this.oCapabilities.ServiceProvider&&null!=this.oCapabilities.ServiceProvider.ProviderName&&(a.Qc=this.oCapabilities.ServiceProvider.ProviderName);null==a.Qc&&null!=this.oCapabilities.ServiceIdentification&&null!=this.oCapabilities.ServiceIdentification.Title&&
(a.Qc=this.oCapabilities.ServiceIdentification.Title);null==a.Qc&&(a.Qc="Service WMTS");A.qa.Eb(a)};fs.prototype.Ad.prototype.addLayerToAdd=fs.prototype.Ad.prototype.ov;A.module.directive("appWmtssuggestions",fs.prototype.xB);A.module.controller("AppWmtssuggestionsController",fs.prototype.Ad);function gs(){A.log("nsVmap.nsMapManager.nsMapModal.XYZSuggestions")}pa("nsVmap.nsMapManager.nsMapModal.XYZSuggestions",gs);gs.prototype.EB=function(){A.log("nsVmap.xyzsuggestionsDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppXyzsuggestionsController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/layers/mapmodal/xyzsuggestions.html"}};gs.prototype.xyzsuggestionsDirective=gs.prototype.EB;
gs.prototype.Sh=function(){A.log("nsVmap.nsMapManager.nsMapModal.XYZSuggestions.xyzsuggestionsController");this.properties=A.properties;this.catalog=A.qa.hf.Nb;this.projection=D(A.g().H).D().V;this.oLayerToAdd={sService:"",sLayer:"",sUrl:""}};gs.prototype.xyzsuggestionsController=gs.prototype.Sh;
gs.prototype.Sh.prototype.Eb=function(a){A.log("nsVmap.nsMapManager.nsMapModal.XYZSuggestions.prototype.xyzsuggestionsController.prototype.addLayer");var b,c;null!=a?(c=b=a.name,a=a.url):(b=this.oLayerToAdd.sService,c=this.oLayerToAdd.sLayer,a=this.oLayerToAdd.sUrl);if(null==b)return $.notify("Informations insuffisantes: Service","error"),null;if(null==c)return $.notify("Informations insuffisantes: sLayer","error"),null;if(null==a)return $.notify("Informations insuffisantes: sUrl","error"),null;A.qa.Eb({url:a,
de:"xyz",Qc:b,Hd:c})};gs.prototype.Sh.prototype.addLayer=gs.prototype.Sh.prototype.Eb;gs.prototype.Sh.prototype.reload=function(){this.catalog=A.qa.hf.Nb;this.projection=D(A.g().H).D().V};gs.prototype.Sh.prototype.reload=gs.prototype.Sh.prototype.reload;A.module.directive("appXyzsuggestions",gs.prototype.EB);A.module.controller("AppXyzsuggestionsController",gs.prototype.Sh);function hs(){A.log("nsVmap.nsMapManager.nsMapModal.LoadGeometry")}pa("nsVmap.nsMapManager.nsMapModal.LoadGeometry",hs);hs.prototype.ky=function(){A.log("nsVmap.loadgeometryDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppLoadgeometryController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/layers/mapmodal/loadgeometry.html"}};hs.prototype.loadgeometryDirective=hs.prototype.ky;
hs.prototype.bk=function(a){A.log("nsVmap.loadgeometryController");var b=this;this.bg=a;a.oSelectedFile={};a.sFileName="";a.sServiceName="";a.sLayerTitle="";a.bIsUrl=!1;var c=document.getElementById("upload-geometry-file-drop-zone");document.getElementById("browse-geometry-button").addEventListener("change",function(){var c=this;b.Nz=c.id;a.$applyAsync(function(){a.oSelectedFile=c.files[0];a.bIsUrl=!1;a.sFileName=null!=a.oSelectedFile?angular.copy(a.oSelectedFile.name):""})},!1);c.addEventListener("dragover",
function(a){this.className="upload-drop-zone drop";a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy";return!1},!1);c.addEventListener("dragleave",function(){this.className="upload-drop-zone";return!1},!1);c.addEventListener("drop",function(c){c.stopPropagation();c.preventDefault();var d=c.dataTransfer.files;this.files=d;b.Nz=this.id;a.$applyAsync(function(){a.oSelectedFile=d[0];a.bIsUrl=!1;a.sFileName=null!=a.oSelectedFile?angular.copy(a.oSelectedFile.name):""});this.className=
"upload-drop-zone";return!1},!1)};hs.prototype.loadgeometryController=hs.prototype.bk;hs.prototype.bk.$inject=["$scope"];
hs.prototype.bk.prototype.Eb=function(){A.log("nsVmap.nsMapManager.nsMapModal.LoadGeometry.prototype.loadgeometryController.prototype.addLayer");var a=this.Nz,b=this.bg.sFileName,c=this.bg.sServiceName,d=this.bg.sLayerTitle,c=""!==c?c:"Local",d=""!==d?d:"Local";""===c||""===d?$.notify("Veuillez renseigner les noms du service et de la couche","error"):this.bg.bIsUrl&&""!==b?"http"!==b.substr(0,4)?$.notify("URL incorrecte"):(cd(),$.get(b).done(function(a){dd();A.qa.kr(a,c,d)&&A.jj("close-modal-button")}).error(function(){dd();
$.notify("impossible de charger le contenu de l'URL")})):r(a)&&""!==a?(a=document.getElementById(a).files,a.length?(a=a[0],b=new FileReader,d="Local"!==d?d:a.name,b.onloadend=function(a){a.target.readyState===FileReader.DONE&&A.qa.kr(a.target.result,c,d)&&A.jj("close-modal-button")},b.readAsText(a)):$.notify("Veuillez s\u00e9lectionner un fichier ou une url","error")):$.notify("Veuillez s\u00e9lectionner un fichier ou une URL","error")};hs.prototype.bk.prototype.addLayer=hs.prototype.bk.prototype.Eb;
A.module.directive("appLoadgeometry",hs.prototype.ky);A.module.controller("AppLoadgeometryController",hs.prototype.bk);function is(){A.log("nsVmap.nsMapManager.nsMapModal.OSMSuggestions")}pa("nsVmap.nsMapManager.nsMapModal.OSMSuggestions",is);is.prototype.bz=function(){A.log("nsVmap.osmsuggestionsDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppOsmsuggestionsController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/layers/mapmodal/osmsuggestions.html"}};is.prototype.osmsuggestionsDirective=is.prototype.bz;
is.prototype.yh=function(){A.log("nsVmap.nsMapManager.nsMapModal.OSMSuggestions.osmsuggestionsController");this.catalog=A.qa.hf.Nb;this.la=this.projection=D(A.g().H).D().V;this.properties=A.properties;this.sLayerUrl=this.sLayerName=""};is.prototype.osmsuggestionsController=is.prototype.yh;
is.prototype.yh.prototype.Eb=function(a){A.log("nsVmap.nsMapManager.nsMapModal.OSMSuggestions.prototype.osmsuggestionsController.prototype.addLayer");var b;null!=a?(b=a.name,a=a.url):(b=this.sLayerName,a=this.sLayerUrl);if(r(b)&&""!==b){var c={};c.url=a;c.de="osm";c.Qc="Open Street Map";c.Hd=b;A.qa.Eb(c)}else $.notify("Informations manquantes: Nom","error")};is.prototype.yh.prototype.addLayer=is.prototype.yh.prototype.Eb;
is.prototype.yh.prototype.reload=function(){this.catalog=A.qa.hf.Nb;this.la=this.projection=D(A.g().H).D().V};is.prototype.yh.prototype.reload=is.prototype.yh.prototype.reload;A.module.directive("appOsmsuggestions",is.prototype.bz);A.module.controller("AppOsmsuggestionsController",is.prototype.yh);function js(){A.log("nsVmap.nsMapManager.nsMapModal.BingSuggestions")}pa("nsVmap.nsMapManager.nsMapModal.BingSuggestions",js);js.prototype.EC=function(){A.log("nsVmap.bingsuggestionsDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppBingsuggestionsController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/layers/mapmodal/bingsuggestions.html"}};
js.prototype.Xg=function(){A.log("nsVmap.bingsuggestionsController");this.catalog=A.qa.hf.Nb;this.la=this.projection=D(A.g().H).D().V;this.properties=A.properties};js.prototype.bingsuggestionsController=js.prototype.Xg;
js.prototype.Xg.prototype.Eb=function(a){A.log("nsVmap.nsMapManager.nsMapModal.BingSuggestions.prototype.bingsuggestionsController.prototype.addLayer");var b,c;null!=a?(b=a.key,c=a.imagerySet,a=a.culture):(b=this.sKey,c=this.sImagerySet,a=this.sCulture);if(null==b||""===b)return $.notify("Veuillez renseigner la cl\u00e9 Bing Maps","error"),0;if(null==c||""===c)return $.notify("Veuillez renseigner une couche \u00e0 utiliser","error"),0;if(null==a||""===a)return $.notify("Veuillez renseigner une langue \u00e0 utiliser",
"error"),0;var d={de:"bing",Qc:"Bing Maps"};d.key=b;d.ce=c;d.ki=a;A.qa.Eb(d)};js.prototype.Xg.prototype.addLayer=js.prototype.Xg.prototype.Eb;js.prototype.Xg.prototype.reload=function(){this.catalog=A.qa.hf.Nb;this.la=this.projection=D(A.g().H).D().V};js.prototype.Xg.prototype.reload=js.prototype.Xg.prototype.reload;A.module.directive("appBingsuggestions",js.prototype.EC);A.module.controller("AppBingsuggestionsController",js.prototype.Xg);function ks(a){A.log("nsVmap.nsMapManager.nsMapModal.MapModalManager");this.Nb=a;new Er;this.uH=new Dr;new Hr;new es;new fs;new hs;new is;new gs;new js}pa("nsVmap.nsMapManager.nsMapModal.MapModalManager",ks);ks.prototype.KG=function(){A.log("nsVmap.mapmodalDirective");return{restrict:"E",scope:{map:"=appMap",proj:"=appProj",lang:"=appLang"},controller:"AppMapmodalController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/layers/mapmodal/mapmodal.html"}};
ks.prototype.JG=function(){A.log("nsVmap.mapmodalController")};ks.prototype.DE=function(){return this.uH};ks.prototype.getMapListTool=ks.prototype.DE;ks.prototype.tx=function(){return this.Nb};A.module.directive("appMapmodal",ks.prototype.KG);A.module.controller("AppMapmodalController",ks.prototype.JG);function ls(){this.Uu=new XMLSerializer;np.call(this)}E(ls,np);l=ls.prototype;l.K=function(){return"xml"};l.bj=function(a,b){return a instanceof Document?ms(this,a,b):a instanceof Node?this.Np(a,b):"string"===typeof a?(a=Mn(a),ms(this,a,b)):[]};function ms(a,b,c){var d=[];for(b=b.firstChild;b;b=b.nextSibling)b.nodeType==Node.ELEMENT_NODE&&Ie(d,a.Np(b,c));return d}l.wm=function(a){if(a instanceof Document||a instanceof Node)return null;"string"===typeof a&&Mn(a);return null};
l.Qp=function(a){return a instanceof Document||a instanceof Node?this.yc:"string"===typeof a?(Mn(a),this.yc):null};l.Pu=function(){return this.Uu.serializeToString(null)};l.qn=function(a,b){a=this.Su(a,b);return this.Uu.serializeToString(a)};l.Su=function(){return null};l.Tu=function(){return this.Uu.serializeToString(null)};function ns(a){a=a?a:{};ls.call(this);this.yc=Gg("EPSG:4326");this.pz=a.mM}E(ns,ls);var os=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"];function ps(a,b,c,d){a.push(parseFloat(c.getAttribute("lon")),parseFloat(c.getAttribute("lat")));"ele"in d?(a.push(d.ele),delete d.ele,b.Fs=!0):a.push(0);"time"in d?(a.push(d.time),delete d.time,b.Es=!0):a.push(0);return a}
function qs(a,b,c){var d="XY",e=2;a.Fs&&a.Es?(d="XYZM",e=4):a.Fs?(d="XYZ",e=3):a.Es&&(d="XYM",e=3);if(4!==e){var f,g;f=0;for(g=b.length/4;f<g;f++)b[f*e]=b[4*f],b[f*e+1]=b[4*f+1],a.Fs&&(b[f*e+2]=b[4*f+2]),a.Es&&(b[f*e+2]=b[4*f+3]);b.length=b.length/4*e;if(c)for(f=0,g=c.length;f<g;f++)c[f]=c[f]/4*e}return d}function rs(a,b){var c=b[b.length-1],d=a.getAttribute("href");null!==d&&(c.link=d);Wn(ss,a,b)}function ts(a,b){b[b.length-1].extensionsNode_=a}
var xs=O(os,{rte:On(function(a,b){var c=b[0];if(a=Q({flatCoordinates:[],layoutOptions:{}},us,a,b)){b=a.flatCoordinates;delete a.flatCoordinates;var d=a.layoutOptions;delete a.layoutOptions;var d=qs(d,b),e=new xp(null);e.sa(d,b);qp(e,!1,c);c=new So(e);Kd(c,a);return c}}),trk:On(function(a,b){var c=b[0];if(a=Q({flatCoordinates:[],ends:[],layoutOptions:{}},vs,a,b)){b=a.flatCoordinates;delete a.flatCoordinates;var d=a.ends;delete a.ends;var e=a.layoutOptions;delete a.layoutOptions;var e=qs(e,b,d),f=new yp(null);
f.sa(e,b,d);qp(f,!1,c);c=new So(f);Kd(c,a);return c}}),wpt:On(function(a,b){var c=b[0];if(b=Q({},ws,a,b)){var d={};a=ps([],d,a,b);d=qs(d,a);a=new rh(a,d);qp(a,!1,c);c=new So(a);Kd(c,b);return c}})}),ss=O(os,{text:L(S,"linkText"),type:L(S,"linkType")}),us=O(os,{name:L(S),cmt:L(S),desc:L(S),src:L(S),link:rs,number:L(Sp),extensions:ts,type:L(S),rtept:function(a,b){var c=Q({},ys,a,b);c&&(b=b[b.length-1],ps(b.flatCoordinates,b.layoutOptions,a,c))}}),ys=O(os,{ele:L(Qp),time:L(Pp)}),vs=O(os,{name:L(S),cmt:L(S),
desc:L(S),src:L(S),link:rs,number:L(Sp),type:L(S),extensions:ts,trkseg:function(a,b){var c=b[b.length-1];Wn(zs,a,b);c.ends.push(c.flatCoordinates.length)}}),zs=O(os,{trkpt:function(a,b){var c=Q({},As,a,b);c&&(b=b[b.length-1],ps(b.flatCoordinates,b.layoutOptions,a,c))}}),As=O(os,{ele:L(Qp),time:L(Pp)}),ws=O(os,{ele:L(Qp),time:L(Pp),magvar:L(Qp),geoidheight:L(Qp),name:L(S),cmt:L(S),desc:L(S),src:L(S),link:rs,sym:L(S),type:L(S),fix:L(S),sat:L(Sp),hdop:L(Qp),vdop:L(Qp),pdop:L(Qp),ageofdgpsdata:L(Qp),
dgpsid:L(Sp),extensions:ts});ns.prototype.Np=function(a,b){if(!(0<=os.indexOf(a.namespaceURI)))return[];if("gpx"==a.localName&&(a=Q([],xs,a,[op(this,a,b)]))){(b=a)||(b=[]);for(var c=0,d=b.length;c<d;++c){var e=b[c];if(this.pz){var f=e.get("extensionsNode_")||null;this.pz(e,f)}e.set("extensionsNode_",void 0)}return a}return[]};function Bs(a,b,c){a.setAttribute("href",b);b=c[c.length-1].properties;Xn({node:a},Cs,Un,[b.linkText,b.linkType],c,Ds)}
function Es(a,b,c){var d=c[c.length-1],e=d.node.namespaceURI,f=d.properties;a.setAttributeNS(null,"lat",b[1]);a.setAttributeNS(null,"lon",b[0]);switch(d.geometryLayout){case "XYZM":0!==b[3]&&(f.time=b[3]);case "XYZ":0!==b[2]&&(f.ele=b[2]);break;case "XYM":0!==b[2]&&(f.time=b[2])}b="rtept"==a.nodeName?Fs[e]:Gs[e];d=Vn(f,b);Xn({node:a,properties:f},Hs,Un,d,c,b)}
var Ds=["text","type"],Cs=O(os,{text:M(Vp),type:M(Vp)}),Is=O(os,"name cmt desc src link number type rtept".split(" ")),Js=O(os,{name:M(Vp),cmt:M(Vp),desc:M(Vp),src:M(Vp),link:M(Bs),number:M(Xp),type:M(Vp),rtept:Rn(M(Es))}),Fs=O(os,["ele","time"]),Ks=O(os,"name cmt desc src link number type trkseg".split(" ")),Ns=O(os,{name:M(Vp),cmt:M(Vp),desc:M(Vp),src:M(Vp),link:M(Bs),number:M(Xp),type:M(Vp),trkseg:Rn(M(function(a,b,c){Xn({node:a,geometryLayout:b.Ua,properties:{}},Ls,Ms,b.ca(),c)}))}),Ms=Sn("trkpt"),
Ls=O(os,{trkpt:M(Es)}),Gs=O(os,"ele time magvar geoidheight name cmt desc src link sym type fix sat hdop vdop pdop ageofdgpsdata dgpsid".split(" ")),Hs=O(os,{ele:M(Wp),time:M(function(a,b){b=new Date(1E3*b);a.appendChild(Jn.createTextNode(b.getUTCFullYear()+"-"+wf(b.getUTCMonth()+1)+"-"+wf(b.getUTCDate())+"T"+wf(b.getUTCHours())+":"+wf(b.getUTCMinutes())+":"+wf(b.getUTCSeconds())+"Z"))}),magvar:M(Wp),geoidheight:M(Wp),name:M(Vp),cmt:M(Vp),desc:M(Vp),src:M(Vp),link:M(Bs),sym:M(Vp),type:M(Vp),fix:M(Vp),
sat:M(Xp),hdop:M(Wp),vdop:M(Wp),pdop:M(Wp),ageofdgpsdata:M(Wp),dgpsid:M(Xp)}),Os={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function Ps(a,b){if(a=a.j())if(a=Os[a.K()])return Jn.createElementNS(b[b.length-1].node.namespaceURI,a)}
var Qs=O(os,{rte:M(function(a,b,c){var d=c[0],e=Nd(b);a={node:a,properties:e};if(b=b.j())b=qp(b,!0,d),a.geometryLayout=b.Ua,e.rtept=b.ca();d=Is[c[c.length-1].node.namespaceURI];e=Vn(e,d);Xn(a,Js,Un,e,c,d)}),trk:M(function(a,b,c){var d=c[0],e=Nd(b);a={node:a,properties:e};if(b=b.j())b=qp(b,!0,d),e.trkseg=Zk(b);d=Ks[c[c.length-1].node.namespaceURI];e=Vn(e,d);Xn(a,Ns,Un,e,c,d)}),wpt:M(function(a,b,c){var d=c[0],e=c[c.length-1];e.properties=Nd(b);if(b=b.j())b=qp(b,!0,d),e.geometryLayout=b.Ua,Es(a,b.ca(),
c)})});ns.prototype.Su=function(a,b){b=pp(this,b);var c=Jn.createElementNS("http://www.topografix.com/GPX/1/1","gpx");c.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance");c.setAttributeNS("http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation","http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd");c.setAttribute("version","1.1");c.setAttribute("creator","OpenLayers");Xn({node:c},Qs,Ps,a,[b]);return c};function Rs(){np.call(this)}E(Rs,np);l=Rs.prototype;l.K=function(){return"text"};l.bj=function(a,b){return this.sz("string"===typeof a?a:"",pp(this,b))};l.wm=function(a,b){return this.Pp("string"===typeof a?a:"",pp(this,b))};l.Qp=function(){return this.yc};l.Pu=function(a,b){return this.Ru(a,pp(this,b))};l.qn=function(a,b){return this.BB(a,pp(this,b))};l.Tu=function(a,b){return this.Rq(a,pp(this,b))};function Ss(a){a=a?a:{};np.call(this);this.yc=Gg("EPSG:4326");this.bC=a.aC?a.aC:"none"}E(Ss,Rs);var Ts=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,Us=/^H.([A-Z]{3}).*?:(.*)/,Vs=/^HFDTE(\d{2})(\d{2})(\d{2})/,Ws=/\r\n|\r|\n/;l=Ss.prototype;
l.qz=function(a,b){var c=this.bC,d=a.split(Ws);a={};var e=[],f=2E3,g=0,h=1,k=-1,m,p;m=0;for(p=d.length;m<p;++m){var t=d[m],v;if("B"==t.charAt(0)){if(v=Ts.exec(t)){var t=parseInt(v[1],10),w=parseInt(v[2],10),x=parseInt(v[3],10),y=parseInt(v[4],10)+parseInt(v[5],10)/6E4;"S"==v[6]&&(y=-y);var F=parseInt(v[7],10)+parseInt(v[8],10)/6E4;"W"==v[9]&&(F=-F);e.push(F,y);"none"!=c&&e.push("gps"==c?parseInt(v[11],10):"barometric"==c?parseInt(v[12],10):0);v=Date.UTC(f,g,h,t,w,x);v<k&&(v=Date.UTC(f,g,h+1,t,w,x));
e.push(v/1E3);k=v}}else"H"==t.charAt(0)&&((v=Vs.exec(t))?(h=parseInt(v[1],10),g=parseInt(v[2],10)-1,f=2E3+parseInt(v[3],10)):(v=Us.exec(t))&&(a[v[1]]=v[2].trim()))}if(0===e.length)return null;d=new xp(null);d.sa("none"==c?"XYM":"XYZM",e);b=new So(qp(d,!1,b));Kd(b,a);return b};l.sz=function(a,b){return(a=this.qz(a,b))?[a]:[]};l.Ru=function(){};l.BB=function(){};l.Rq=function(){};l.Pp=function(){};function Xs(a,b,c,d,e,f){Fd.call(this);this.wg=null;this.ka=a?a:new Image;null!==d&&(this.ka.crossOrigin=d);this.ja=f?document.createElement("CANVAS"):null;this.ma=f;this.cf=null;this.Xj=e;this.yd=c;this.Me=b;this.pu=!1;2==this.Xj&&Ys(this)}E(Xs,Fd);function Ys(a){var b=Vh(1,1);try{b.drawImage(a.ka,0,0),b.getImageData(0,0,1,1)}catch(c){a.pu=!0}}l=Xs.prototype;l.Uj=function(){this.Xj=3;this.Qg();this.dispatchEvent("change")};
l.Wl=function(){this.Xj=2;this.yd&&(this.ka.width=this.yd[0],this.ka.height=this.yd[1]);this.yd=[this.ka.width,this.ka.height];this.Qg();Ys(this);if(!this.pu&&null!==this.ma){this.ja.width=this.ka.width;this.ja.height=this.ka.height;var a=this.ja.getContext("2d");a.drawImage(this.ka,0,0);for(var b=a.getImageData(0,0,this.ka.width,this.ka.height),c=b.data,d=this.ma[0]/255,e=this.ma[1]/255,f=this.ma[2]/255,g=0,h=c.length;g<h;g+=4)c[g]*=d,c[g+1]*=e,c[g+2]*=f;a.putImageData(b,0,0)}this.dispatchEvent("change")};
l.na=function(){return this.ja?this.ja:this.ka};l.zi=function(){return this.Xj};l.Ll=function(){if(!this.wg)if(this.pu){var a=this.yd[0],b=this.yd[1],c=Vh(a,b);c.fillRect(0,0,a,b);this.wg=c.canvas}else this.wg=this.ka;return this.wg};l.Ta=function(){return this.yd};l.Ci=function(){return this.Me};l.load=function(){if(0==this.Xj){this.Xj=1;this.cf=[zd(this.ka,"error",this.Uj,this),zd(this.ka,"load",this.Wl,this)];try{this.ka.src=this.Me}catch(a){this.Uj()}}};
l.Qg=function(){this.cf.forEach(ud);this.cf=null};function tr(a){a=a||{};this.Hc=void 0!==a.anchor?a.anchor:[.5,.5];this.Ap=null;this.yj=void 0!==a.xn?a.xn:"top-left";this.nr=void 0!==a.yn?a.yn:"fraction";this.or=void 0!==a.zn?a.zn:"fraction";this.Xn=void 0!==a.crossOrigin?a.crossOrigin:null;var b=void 0!==a.Mx?a.Mx:null,c=void 0!==a.Nx?a.Nx:null,d=a.src;af(!(void 0!==d&&b),4);af(!b||b&&c,5);void 0!==d&&0!==d.length||!b||(d=b.src||I(b).toString());af(void 0!==d&&0<d.length,6);var e=void 0!==a.src?0:2;this.ma=void 0!==a.color?vj(a.color):null;var f=
this.Xn,g=this.ma,h=Aj.get(d,f,g);h||(h=new Xs(b,d,c,f,e,g),Aj.set(d,f,g,h));this.ze=h;this.om=void 0!==a.offset?a.offset:[0,0];this.jk=void 0!==a.ut?a.ut:"top-left";this.Pd=null;this.yd=void 0!==a.size?a.size:null;zn.call(this,{opacity:void 0!==a.opacity?a.opacity:1,rotation:void 0!==a.rotation?a.rotation:0,scale:void 0!==a.scale?a.scale:1,pf:void 0!==a.pf?a.pf:!0,ke:void 0!==a.ke?a.ke:!1})}E(tr,zn);l=tr.prototype;
l.clone=function(){var a=this.na(1),b;if(2===this.ze.zi())if("IMG"===a.tagName.toUpperCase())b=a.cloneNode(!0);else{b=document.createElement("canvas");var c=b.getContext("2d");b.width=a.width;b.height=a.height;c.drawImage(a,0,0)}return new tr({anchor:this.Hc.slice(),xn:this.yj,yn:this.nr,zn:this.or,crossOrigin:this.Xn,color:this.ma&&this.ma.slice?this.ma.slice():this.ma||void 0,Mx:b?b:void 0,Nx:b?this.ze.Ta().slice():void 0,src:b?void 0:this.Ci(),offset:this.om.slice(),ut:this.jk,size:null!==this.yd?
this.yd.slice():void 0,opacity:this.rg(),scale:this.fb(),pf:this.qf,rotation:this.Gb(),ke:this.Pc})};
l.Il=function(){if(this.Ap)return this.Ap;var a=this.Hc,b=this.Ta();if("fraction"==this.nr||"fraction"==this.or){if(!b)return null;a=this.Hc.slice();"fraction"==this.nr&&(a[0]*=b[0]);"fraction"==this.or&&(a[1]*=b[1])}if("top-left"!=this.yj){if(!b)return null;a===this.Hc&&(a=this.Hc.slice());if("top-right"==this.yj||"bottom-right"==this.yj)a[0]=-a[0]+b[0];if("bottom-left"==this.yj||"bottom-right"==this.yj)a[1]=-a[1]+b[1]}return this.Ap=a};l.na=function(a){return this.ze.na(a)};l.yo=function(){return this.ze.Ta()};
l.zi=function(){return this.ze.zi()};l.Ll=function(a){return this.ze.Ll(a)};l.Ff=function(){if(this.Pd)return this.Pd;var a=this.om;if("top-left"!=this.jk){var b=this.Ta(),c=this.ze.Ta();if(!b||!c)return null;a=a.slice();if("top-right"==this.jk||"bottom-right"==this.jk)a[0]=c[0]-b[0]-a[0];if("bottom-left"==this.jk||"bottom-right"==this.jk)a[1]=c[1]-b[1]-a[1]}return this.Pd=a};l.Ci=function(){return this.ze.Ci()};l.Ta=function(){return this.yd?this.yd:this.ze.Ta()};
l.dy=function(a,b){return J(this.ze,"change",a,b)};l.load=function(){this.ze.load()};l.XA=function(a,b){Ad(this.ze,"change",a,b)};function Ro(a){a=a||{};this.ti=a.font;this.Fc=a.rotation;this.Pc=a.ke;this.gd=a.scale;this.Da=a.text;this.vu=a.textAlign;this.IA=a.textBaseline;this.pa=void 0!==a.fill?a.fill:new Cn({color:"#333"});this.ha=void 0!==a.stroke?a.stroke:null;this.mm=void 0!==a.offsetX?a.offsetX:0;this.nm=void 0!==a.offsetY?a.offsetY:0}l=Ro.prototype;
l.clone=function(){return new Ro({font:this.ti,rotation:this.Gb(),ke:this.Pc,scale:this.fb(),text:this.Da,textAlign:this.vu,textBaseline:this.IA,fill:this.pa?this.pa.clone():void 0,stroke:this.ha?this.ha.clone():void 0,offsetX:this.mm,offsetY:this.nm})};l.vo=function(){return this.pa};l.Gb=function(){return this.Fc};l.fb=function(){return this.gd};l.Fo=function(){return this.ha};l.cA=function(a){this.pa=a};l.Lm=function(a){this.Fc=a};l.le=function(a){this.gd=a};l.kA=function(a){this.ha=a};
l.Nm=function(a){this.Da=a};function Zs(a){a=a?a:{};ls.call(this);$s||(at=[255,255,255,1],bt=new Cn({color:at}),ct=[20,2],dt=et="pixels",ft=[64,64],gt="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",ht=.5,it=new tr({anchor:ct,xn:"bottom-left",yn:et,zn:dt,crossOrigin:"anonymous",rotation:0,scale:ht,size:ft,src:gt}),jt="NO_IMAGE",kt=new gl({color:at,width:1}),lt=new gl({color:[51,51,51,1],width:2}),mt=new Ro({font:"bold 16px Helvetica",fill:bt,stroke:lt,scale:.8}),nt=new Dn({fill:bt,Lb:it,text:mt,stroke:kt,zIndex:0}),
$s=[nt]);this.yc=Gg("EPSG:4326");this.hD=a.gD?a.gD:$s;this.PD=void 0!==a.OD?a.OD:!0;this.gL=void 0!==a.fL?a.fL:!0;this.iu={};this.zJ=void 0!==a.yJ?a.yJ:!0}var $s,at,bt,ct,et,dt,ft,gt,ht,it,jt,kt,lt,mt,nt;E(Zs,ls);var ot=["http://www.google.com/kml/ext/2.2"],pt=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],qt={fraction:"fraction",pixels:"pixels"};
function rt(a,b){var c=[0,0],d="start";if(a.na()){var e=a.na().yo();null===e&&(e=ft);2==e.length&&(d=a.na().fb(),c[0]=d*e[0]/2,c[1]=-d*e[1]/2,d="left")}null!==a.Da?(e=a.Da,a=e.clone(),a.ti=e.ti||mt.ti,a.le(e.fb()||mt.fb()),a.cA(e.pa||mt.pa),a.kA(e.ha||lt)):a=mt.clone();a.Nm(b);a.mm=c[0];a.nm=c[1];a.vu=d;return new Dn({text:a})}
function st(a,b,c,d,e){return function(){var f=e,g="";f&&this.j()&&(f="Point"===this.j().K());f&&(g=this.get("name"),f=f&&g);if(a)return f?(f=rt(a[0],g),a.concat(f)):a;if(b){var h=tt(b,c,d);return f?(f=rt(h[0],g),h.concat(f)):h}return f?(f=rt(c[0],g),c.concat(f)):c}}function tt(a,b,c){return Array.isArray(a)?a:"string"===typeof a?(!(a in c)&&"#"+a in c&&(a="#"+a),tt(c[a],b,c)):b}
function ut(a){a=Kn(a);if(a=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(a))return a=a[1],[parseInt(a.substr(6,2),16),parseInt(a.substr(4,2),16),parseInt(a.substr(2,2),16),parseInt(a.substr(0,2),16)/255]}function vt(a){a=Kn(a);for(var b=[],c=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?))?\s*/i,d;d=c.exec(a);)b.push(parseFloat(d[1]),parseFloat(d[2]),d[3]?parseFloat(d[3]):0),a=a.substr(d[0].length);if(""===a)return b}
function wt(a){var b=Kn(a).trim();return a.baseURI?(new URL(b,a.baseURI)).href:b}function xt(a){return Qp(a)}function yt(a,b){return Q(null,zt,a,b)}function At(a,b){if(b=Q({l:[],tB:[]},Bt,a,b)){a=b.l;b=b.tB;var c,d;c=0;for(d=Math.min(a.length,b.length);c<d;++c)a[4*c+3]=b[c];b=new xp(null);b.sa("XYZM",a);return b}}function Ct(a,b){var c=Q({},Dt,a,b);if(a=Q(null,Et,a,b))return b=new xp(null),b.sa("XYZ",a),Kd(b,c),b}
function Ft(a,b){var c=Q({},Dt,a,b);if(a=Q(null,Et,a,b))return b=new zh(null),b.sa("XYZ",a,[a.length]),Kd(b,c),b}
function Gt(a,b){a=Q([],Ht,a,b);if(!a)return null;if(0===a.length)return new tp(a);var c,d=!0,e=a[0].K(),f,g;f=1;for(g=a.length;f<g;++f)if(b=a[f],b.K()!=e){d=!1;break}if(d)if("Point"==e){c=a[0];d=c.Ua;e=c.l;f=1;for(g=a.length;f<g;++f)b=a[f],Ie(e,b.l);c=new Bp(null);c.sa(d,e);It(c,a)}else if("LineString"==e)c=new yp(null),Ap(c,a),It(c,a);else if("Polygon"==e){b=c=new Ep(null);f=b.Ua;g=[];var d=[],h,k,e=0;for(h=a.length;e<h;++e){var m=a[e];0===e&&(f=m.Ua);var p=g.length;k=m.Xa;var t,v;t=0;for(v=k.length;t<
v;++t)k[t]+=p;Ie(g,m.l);d.push(k)}b.sa(f,g,d);It(c,a)}else"GeometryCollection"==e?c=new tp(a):af(!1,37);else c=new tp(a);return c}function Jt(a,b){var c=Q({},Dt,a,b);if(a=Q(null,Et,a,b))return b=new rh(null),b.sa("XYZ",a),Kd(b,c),b}function Kt(a,b){var c=Q({},Dt,a,b);if((a=Q([null],Lt,a,b))&&a[0]){b=new zh(null);var d=a[0],e=[d.length],f,g;f=1;for(g=a.length;f<g;++f)Ie(d,a[f]),e.push(d.length);b.sa("XYZ",d,e);Kd(b,c);return b}}
function Mt(a,b){b=Q({},Nt,a,b);if(!b)return null;a="fillStyle"in b?b.fillStyle:bt;var c=b.fill;void 0===c||c||(a=null);c="imageStyle"in b?b.imageStyle:it;c==jt&&(c=void 0);var d="textStyle"in b?b.textStyle:mt,e="strokeStyle"in b?b.strokeStyle:kt;b=b.outline;void 0===b||b||(e=null);return[new Dn({fill:a,Lb:c,stroke:e,text:d,zIndex:void 0})]}
function It(a,b){var c=b.length,d=Array(b.length),e=Array(b.length),f,g,h,k;h=k=!1;for(g=0;g<c;++g)f=b[g],d[g]=f.get("extrude"),e[g]=f.get("altitudeMode"),h=h||void 0!==d[g],k=k||e[g];h&&a.set("extrude",d);k&&a.set("altitudeMode",e)}function Ot(a,b){Wn(Pt,a,b)}function Qt(a,b){Wn(Rt,a,b)}
var St=O(pt,{displayName:L(S),value:L(S)}),Pt=O(pt,{Data:function(a,b){var c=a.getAttribute("name");Wn(St,a,b);a=b[b.length-1];null!==c?a[c]=a.value:null!==a.displayName&&(a[a.displayName]=a.value)},SchemaData:function(a,b){Wn(Tt,a,b)}}),Rt=O(pt,{LatLonAltBox:function(a,b){if(a=Q({},Ut,a,b))b=b[b.length-1],b.extent=[parseFloat(a.west),parseFloat(a.south),parseFloat(a.east),parseFloat(a.north)],b.altitudeMode=a.altitudeMode,b.minAltitude=parseFloat(a.minAltitude),b.maxAltitude=parseFloat(a.maxAltitude)},
Lod:function(a,b){if(a=Q({},Vt,a,b))b=b[b.length-1],b.minLodPixels=parseFloat(a.minLodPixels),b.maxLodPixels=parseFloat(a.maxLodPixels),b.minFadeExtent=parseFloat(a.minFadeExtent),b.maxFadeExtent=parseFloat(a.maxFadeExtent)}}),Ut=O(pt,{altitudeMode:L(S),minAltitude:L(Qp),maxAltitude:L(Qp),north:L(Qp),south:L(Qp),east:L(Qp),west:L(Qp)}),Vt=O(pt,{minLodPixels:L(Qp),maxLodPixels:L(Qp),minFadeExtent:L(Qp),maxFadeExtent:L(Qp)}),Dt=O(pt,{extrude:L(Np),altitudeMode:L(S)}),zt=O(pt,{coordinates:Pn(vt)}),Lt=
O(pt,{innerBoundaryIs:function(a,b){(a=Q(void 0,Wt,a,b))&&b[b.length-1].push(a)},outerBoundaryIs:function(a,b){(a=Q(void 0,Xt,a,b))&&(b[b.length-1][0]=a)}}),Bt=O(pt,{when:function(a,b){b=b[b.length-1].tB;a=Kn(a);a=Date.parse(a);b.push(isNaN(a)?0:a)}},O(ot,{coord:function(a,b){b=b[b.length-1].l;a=Kn(a);(a=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(a))?b.push(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]),0):
b.push(0,0,0,0)}})),Et=O(pt,{coordinates:Pn(vt)}),Yt=O(pt,{href:L(wt)},O(ot,{x:L(Qp),y:L(Qp),w:L(Qp),h:L(Qp)})),Zt=O(pt,{Icon:L(function(a,b){return(a=Q({},Yt,a,b))?a:null}),heading:L(Qp),hotSpot:L(function(a){var b=a.getAttribute("xunits"),c=a.getAttribute("yunits");return{x:parseFloat(a.getAttribute("x")),Vu:qt[b],y:parseFloat(a.getAttribute("y")),Wu:qt[c]}}),scale:L(xt)}),Wt=O(pt,{LinearRing:Pn(yt)}),$t=O(pt,{color:L(ut),scale:L(xt)}),au=O(pt,{color:L(ut),width:L(Qp)}),Ht=O(pt,{LineString:On(Ct),
LinearRing:On(Ft),MultiGeometry:On(Gt),Point:On(Jt),Polygon:On(Kt)}),bu=O(ot,{Track:On(At)});O(pt,{ExtendedData:Ot,Region:Qt,Link:function(a,b){Wn(cu,a,b)},address:L(S),description:L(S),name:L(S),open:L(Np),phoneNumber:L(S),visibility:L(Np)});
var cu=O(pt,{href:L(wt)}),Xt=O(pt,{LinearRing:Pn(yt)}),du=O(pt,{Style:L(Mt),key:L(S),styleUrl:L(wt)}),fu=O(pt,{ExtendedData:Ot,Region:Qt,MultiGeometry:L(Gt,"geometry"),LineString:L(Ct,"geometry"),LinearRing:L(Ft,"geometry"),Point:L(Jt,"geometry"),Polygon:L(Kt,"geometry"),Style:L(Mt),StyleMap:function(a,b){if(a=Q(void 0,eu,a,b))b=b[b.length-1],Array.isArray(a)?b.Style=a:"string"===typeof a?b.styleUrl=a:af(!1,38)},address:L(S),description:L(S),name:L(S),open:L(Np),phoneNumber:L(S),styleUrl:L(wt),visibility:L(Np)},
O(ot,{MultiTrack:L(function(a,b){if(a=Q([],bu,a,b))return b=new yp(null),Ap(b,a),b},"geometry"),Track:L(At,"geometry")})),gu=O(pt,{color:L(ut),fill:L(Np),outline:L(Np)}),Tt=O(pt,{SimpleData:function(a,b){var c=a.getAttribute("name");null!==c&&(a=S(a),b[b.length-1][c]=a)}}),Nt=O(pt,{IconStyle:function(a,b){if(a=Q({},Zt,a,b)){b=b[b.length-1];var c="Icon"in a?a.Icon:{},d=!("Icon"in a)||0<Object.keys(c).length,e,f=c.href;f?e=f:d&&(e=gt);var g,h,k;(f=a.hotSpot)?(g=[f.x,f.y],h=f.Vu,k=f.Wu):e===gt?(g=ct,
h=et,k=dt):/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(e)&&(g=[.5,0],k=h="fraction");var m,f=c.x,p=c.y;void 0!==f&&void 0!==p&&(m=[f,p]);var t,f=c.w,c=c.h;void 0!==f&&void 0!==c&&(t=[f,c]);var v,c=a.heading;void 0!==c&&(v=lf(c));a=a.scale;d?(e==gt&&(t=ft,void 0===a&&(a=ht)),e=new tr({anchor:g,xn:"bottom-left",yn:h,zn:k,crossOrigin:"anonymous",offset:m,ut:"bottom-left",rotation:v,scale:a,size:t,src:e}),b.imageStyle=e):b.imageStyle=jt}},LabelStyle:function(a,b){(a=Q({},$t,a,b))&&(b[b.length-1].textStyle=
new Ro({fill:new Cn({color:"color"in a?a.color:at}),scale:a.scale}))},LineStyle:function(a,b){(a=Q({},au,a,b))&&(b[b.length-1].strokeStyle=new gl({color:"color"in a?a.color:at,width:"width"in a?a.width:1}))},PolyStyle:function(a,b){if(a=Q({},gu,a,b)){b=b[b.length-1];b.fillStyle=new Cn({color:"color"in a?a.color:at});var c=a.fill;void 0!==c&&(b.fill=c);a=a.outline;void 0!==a&&(b.outline=a)}}}),eu=O(pt,{Pair:function(a,b){if(a=Q({},du,a,b)){var c=a.key;c&&"normal"==c&&((c=a.styleUrl)&&(b[b.length-1]=
c),(a=a.Style)&&(b[b.length-1]=a))}}});l=Zs.prototype;l.Jt=function(a,b){var c=O(pt,{Document:Nn(this.Jt,this),Folder:Nn(this.Jt,this),Placemark:On(this.vz,this),Style:this.kI.bind(this),StyleMap:this.jI.bind(this)});if(a=Q([],c,a,b,this))return a};
l.vz=function(a,b){var c=Q({geometry:null},fu,a,b);if(c){var d=new So;a=a.getAttribute("id");null!==a&&(d.Wc=a,d.G());b=b[0];(a=c.geometry)&&qp(a,!1,b);d.$c(a);delete c.geometry;this.PD&&d.xd(st(c.Style,c.styleUrl,this.hD,this.iu,this.zJ));delete c.Style;Kd(d,c);return d}};l.kI=function(a,b){var c=a.getAttribute("id");null!==c&&(b=Mt(a,b))&&(a=a.baseURI?(new URL("#"+c,a.baseURI)).href:"#"+c,this.iu[a]=b)};
l.jI=function(a,b){var c=a.getAttribute("id");null!==c&&(b=Q(void 0,eu,a,b))&&(a=a.baseURI?(new URL("#"+c,a.baseURI)).href:"#"+c,this.iu[a]=b)};l.Np=function(a,b){if(!(0<=pt.indexOf(a.namespaceURI)))return[];var c;c=a.localName;if("Document"==c||"Folder"==c)return(c=this.Jt(a,[op(this,a,b)]))?c:[];if("Placemark"==c)return(b=this.vz(a,[op(this,a,b)]))?[b]:[];if("kml"==c){c=[];for(a=a.firstElementChild;a;a=a.nextElementSibling){var d=this.Np(a,b);d&&Ie(c,d)}return c}return[]};
function hu(a,b){b=vj(b);b=[255*(4==b.length?b[3]:1),b[2],b[1],b[0]];var c;for(c=0;4>c;++c){var d=parseInt(b[c],10).toString(16);b[c]=1==d.length?"0"+d:d}Vp(a,b.join(""))}function iu(a,b,c){a={node:a};var d=b.K(),e,f;"GeometryCollection"==d?(e=vp(b.Rb),f=ju):"MultiPoint"==d?(e=b.Bi(),f=ku):"MultiLineString"==d?(e=Zk(b),f=lu):"MultiPolygon"==d?(e=Kl(b),f=mu):af(!1,39);Xn(a,nu,f,e,c)}function ou(a,b,c){Xn({node:a},pu,qu,[b],c)}
function ru(a,b,c){var d={node:a};b.Wb()&&a.setAttribute("id",b.Wb());a=Nd(b);var e={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};e[b.pd]=1;var f=Object.keys(a||{}).sort().filter(function(a){return!e[a]});if(0<f.length){var g=Vn(a,f);Xn(d,su,tu,[{names:f,values:g}],c)}if(f=b.me)if(f=f.call(b,0))f=Array.isArray(f)?f[0]:f,this.gL&&(a.Style=f),(f=f.Da)&&(a.name=f.Da);f=uu[c[c.length-1].node.namespaceURI];a=Vn(a,f);Xn(d,su,Un,a,c,f);a=c[0];(b=b.j())&&(b=qp(b,!0,a));Xn(d,
su,ju,[b],c)}function vu(a,b,c){var d=b.l;a={node:a};a.layout=b.Ua;a.stride=b.P;Xn(a,wu,xu,[d],c)}function yu(a,b,c){b=Eh(b);var d=b.shift();a={node:a};Xn(a,zu,Au,b,c);Xn(a,zu,Bu,[d],c)}function Cu(a,b){Wp(a,Math.round(1E6*b)/1E6)}
var Du=O(pt,["Document","Placemark"]),Gu=O(pt,{Document:M(function(a,b,c){Xn({node:a},Eu,Fu,b,c,void 0,this)}),Placemark:M(ru)}),Eu=O(pt,{Placemark:M(ru)}),Hu=O(pt,{Data:M(function(a,b,c){a.setAttribute("name",b.name);a={node:a};b=b.value;"object"==typeof b?(null!==b&&b.displayName&&Xn(a,Hu,Un,[b.displayName],c,["displayName"]),null!==b&&b.value&&Xn(a,Hu,Un,[b.value],c,["value"])):Xn(a,Hu,Un,[b],c,["value"])}),value:M(function(a,b){Vp(a,b)}),displayName:M(function(a,b){a.appendChild(Jn.createCDATASection(b))})}),
Iu={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},Ju=O(pt,["href"],O(ot,["x","y","w","h"])),Ku=O(pt,{href:M(Vp)},O(ot,{x:M(Wp),y:M(Wp),w:M(Wp),h:M(Wp)})),Lu=O(pt,["scale","heading","Icon","hotSpot"]),Nu=O(pt,{Icon:M(function(a,b,c){a={node:a};var d=Ju[c[c.length-1].node.namespaceURI],e=Vn(b,d);Xn(a,Ku,Un,e,c,d);d=Ju[ot[0]];e=Vn(b,d);Xn(a,Ku,
Mu,e,c,d)}),heading:M(Wp),hotSpot:M(function(a,b){a.setAttribute("x",b.x);a.setAttribute("y",b.y);a.setAttribute("xunits",b.Vu);a.setAttribute("yunits",b.Wu)}),scale:M(Cu)}),Ou=O(pt,["color","scale"]),Pu=O(pt,{color:M(hu),scale:M(Cu)}),Qu=O(pt,["color","width"]),Ru=O(pt,{color:M(hu),width:M(Wp)}),pu=O(pt,{LinearRing:M(vu)}),nu=O(pt,{LineString:M(vu),Point:M(vu),Polygon:M(yu),GeometryCollection:M(iu)}),uu=O(pt,"name open visibility address phoneNumber description styleUrl Style".split(" ")),su=O(pt,
{ExtendedData:M(function(a,b,c){a={node:a};var d=b.names;b=b.values;for(var e=d.length,f=0;f<e;f++)Xn(a,Hu,Su,[{name:d[f],value:b[f]}],c)}),MultiGeometry:M(iu),LineString:M(vu),LinearRing:M(vu),Point:M(vu),Polygon:M(yu),Style:M(function(a,b,c){a={node:a};var d={},e=b.pa,f=b.ha,g=b.na();b=b.Da;g instanceof tr&&(d.IconStyle=g);b&&(d.LabelStyle=b);f&&(d.LineStyle=f);e&&(d.PolyStyle=e);b=Tu[c[c.length-1].node.namespaceURI];d=Vn(d,b);Xn(a,Uu,Un,d,c,b)}),address:M(Vp),description:M(Vp),name:M(Vp),open:M(Up),
phoneNumber:M(Vp),styleUrl:M(Vp),visibility:M(Up)}),wu=O(pt,{coordinates:M(function(a,b,c){c=c[c.length-1];var d=c.layout;c=c.stride;var e;"XY"==d||"XYM"==d?e=2:"XYZ"==d||"XYZM"==d?e=3:af(!1,34);var f,g=b.length,h="";if(0<g){h+=b[0];for(d=1;d<e;++d)h+=","+b[d];for(f=c;f<g;f+=c)for(h+=" "+b[f],d=1;d<e;++d)h+=","+b[f+d]}Vp(a,h)})}),zu=O(pt,{outerBoundaryIs:M(ou),innerBoundaryIs:M(ou)}),Vu=O(pt,{color:M(hu)}),Tu=O(pt,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),Uu=O(pt,{IconStyle:M(function(a,
b,c){a={node:a};var d={},e=b.Ci(),f=b.Ta(),g=b.yo(),e={href:e};if(f){e.w=f[0];e.h=f[1];var h=b.Il(),k=b.Ff();k&&g&&0!==k[0]&&k[1]!==f[1]&&(e.x=k[0],e.y=g[1]-(k[1]+f[1]));h&&0!==h[0]&&h[1]!==f[1]&&(d.hotSpot={x:h[0],Vu:"pixels",y:f[1]-h[1],Wu:"pixels"})}d.Icon=e;f=b.fb();1!==f&&(d.scale=f);b=b.Gb();0!==b&&(d.heading=b);b=Lu[c[c.length-1].node.namespaceURI];d=Vn(d,b);Xn(a,Nu,Un,d,c,b)}),LabelStyle:M(function(a,b,c){a={node:a};var d={},e=b.pa;e&&(d.color=e.ma);(b=b.fb())&&1!==b&&(d.scale=b);b=Ou[c[c.length-
1].node.namespaceURI];d=Vn(d,b);Xn(a,Pu,Un,d,c,b)}),LineStyle:M(function(a,b,c){a={node:a};var d=Qu[c[c.length-1].node.namespaceURI];b=Vn({color:b.ma,width:b.hc()},d);Xn(a,Ru,Un,b,c,d)}),PolyStyle:M(function(a,b,c){Xn({node:a},Vu,Wu,[b.ma],c)})});function Mu(a,b,c){return Jn.createElementNS(ot[0],"gx:"+c)}function Fu(a,b){return Jn.createElementNS(b[b.length-1].node.namespaceURI,"Placemark")}function ju(a,b){if(a)return Jn.createElementNS(b[b.length-1].node.namespaceURI,Iu[a.K()])}
var Wu=Sn("color"),xu=Sn("coordinates"),Su=Sn("Data"),tu=Sn("ExtendedData"),Au=Sn("innerBoundaryIs"),ku=Sn("Point"),lu=Sn("LineString"),qu=Sn("LinearRing"),mu=Sn("Polygon"),Bu=Sn("outerBoundaryIs");
Zs.prototype.Su=function(a,b){b=pp(this,b);var c=Jn.createElementNS(pt[4],"kml");c.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:gx",ot[0]);c.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance");c.setAttributeNS("http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation","http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd");var d={node:c},e={};1<a.length?e.Document=a:1==a.length&&(e.Placemark=a[0]);a=
Du[c.namespaceURI];e=Vn(e,a);Xn(d,Gu,Un,e,[b],a,this);return c};function Xu(a){a=a?a:{};np.call(this);this.yc=Gg(a.yc?a.yc:"EPSG:4326")}E(Xu,rp);function Yu(a,b){var c=[],d,e,f;e=0;for(f=a.length;e<f;++e)d=a[e],0<e&&c.pop(),d=0<=d?b[d]:b[~d].slice().reverse(),c.push.apply(c,d);a=0;for(b=c.length;a<b;++a)c[a]=c[a].slice();return c}function Zu(a,b,c,d,e){a=a.geometries;var f=[],g,h;g=0;for(h=a.length;g<h;++g)f[g]=$u(a[g],b,c,d,e);return f}
function $u(a,b,c,d,e){var f=a.type,g=av[f];b="Point"===f||"MultiPoint"===f?g(a,c,d):g(a,b);c=new So;c.$c(qp(b,!1,e));void 0!==a.id&&(c.Wc=a.id,c.G());a.properties&&Kd(c,a.properties);return c}
Xu.prototype.rz=function(a,b){if("Topology"==a.type){var c,d=null,e=null;a.transform&&(c=a.transform,d=c.scale,e=c.translate);var f=a.ei;if(c){c=d;var g=e,h,k;h=0;for(k=f.length;h<k;++h){var m=f[h],p=c,t=g,v=0,w=0,x,y,F;y=0;for(F=m.length;y<F;++y)x=m[y],v+=x[0],w+=x[1],x[0]=v,x[1]=w,bv(x,p,t)}}c=[];a=rd(a.jM);g=0;for(h=a.length;g<h;++g)"GeometryCollection"===a[g].type?(k=a[g],c.push.apply(c,Zu(k,f,d,e,b))):(k=a[g],c.push($u(k,f,d,e,b)));return c}return[]};
function bv(a,b,c){a[0]=a[0]*b[0]+c[0];a[1]=a[1]*b[1]+c[1]}Xu.prototype.wz=function(){return this.yc};
var av={Point:function(a,b,c){a=a.coordinates;b&&c&&bv(a,b,c);return new rh(a)},LineString:function(a,b){a=Yu(a.ei,b);return new xp(a)},Polygon:function(a,b){var c=[],d,e;d=0;for(e=a.ei.length;d<e;++d)c[d]=Yu(a.ei[d],b);return new zh(c)},MultiPoint:function(a,b,c){a=a.coordinates;var d,e;if(b&&c)for(d=0,e=a.length;d<e;++d)bv(a[d],b,c);return new Bp(a)},MultiLineString:function(a,b){var c=[],d,e;d=0;for(e=a.ei.length;d<e;++d)c[d]=Yu(a.ei[d],b);return new yp(c)},MultiPolygon:function(a,b){var c=[],
d,e,f,g,h,k;h=0;for(k=a.ei.length;h<k;++h){d=a.ei[h];e=[];f=0;for(g=d.length;f<g;++f)e[f]=Yu(d[f],b);c[h]=e}return new Ep(c)}};l=Xu.prototype;l.Qu=function(){};l.AB=function(){};l.CB=function(){};l.uz=function(){};l.Kt=function(){};function gd(){A.log("nsVmap.nsMapManager.MapManager");this.Nb=[];this.Ui={};this.hf={};this.nt={};this.mt={};this.ot={};if(n(A.properties.token)){var a=this;z({method:"GET",url:A.properties.api_url+"/vmap/mapcatalog",async:!1,responseType:"",success:function(b){b=JSON.parse(b.data);n(b.mapcatalogs)&&(b=b.mapcatalogs[0]);a.np(b)},error:function(){a.np({maps:[],services:{wms:[],bing:[],osm:[]},usedMap:null})}})}else this.np({maps:[],services:{},status:0})}pa("nsVmap.nsMapManager.MapManager",gd);
gd.prototype.np=function(a){A.log("nsVmap.nsMapManager.MapManager.loadMapTools");A.log("oMapCatalog: ",a);0===a.maps.length&&(a.maps.push({name:"Carte vide",description:"",thumbnail:"",projection:"EPSG:3857",url:null}),1===a.status&&null!=angular.element(u.f).injector()&&setTimeout(function(){"vmap"===angular.element(u.f).injector().get(["envSrvc"]).oSelectedMode.mode_id&&bootbox.alert("<h4>Aucune carte n'est associ\u00e9e \u00e0 cet utilisateur, veuillez contacter l'administrateur de l'application</h4>")},
3E3));this.Nb=a;var b=a.usedMap;if(null!=oUrlParams.map_id)for(var c=0;c<a.maps.length;c++)a.maps[c].map_id===parseFloat(oUrlParams.map_id)&&(b=angular.copy(c),a.usedMap=b);null!=b&&null!=a.maps[b].url?(cv(this),this.fy(a.maps[b].url)):(this.Ui={name:"Tree",children:[{view:{center:[225989.8114356043,6761426.974988975],zoom:11,projection:"EPSG:2154"}}]},this.nt=new Ar,this.mt=new Br,this.ot=new Cr);this.hf=new ks(a)};gd.prototype.loadMapTools=gd.prototype.np;
gd.prototype.fy=function(a){A.log("nsVmap.nsMapManager.MapManager.loadLayersTools");var b=this;null!=a&&z({method:"GET",url:a,async:!1,responseType:"",success:function(a){a=JSON.parse(a.data);n(a.mapjsons)&&(a=a.mapjsons[0]);A.log(a);b.Ui=a;b.nt=new Ar;b.mt=new Br;b.ot=new Cr}})};gd.prototype.loadLayersTools=gd.prototype.fy;
gd.prototype.pG=function(a){A.log("nsVmap.nsMapManager.MapManager.loadMap");a=a.getAttribute("url");if(null==a||0===a.length)return 0;var b=dv(a);A.log("oTree: ",b);this.ij(b);this.ej();for(b=0;b<this.Nb.maps.length;b++)this.Nb.maps[b].url===a&&(this.Nb.usedMap=b);cv(this);A.log("oVmap.event: mapChanged");A.scope.$broadcast("mapChanged")};gd.prototype.loadMap=gd.prototype.pG;
function cv(a){A.log("nsVmap.nsMapManager.MapManager.prototype.setUsedMap");for(var b=0;b<a.Nb.maps.length;b++)a.Nb.maps[b].used=!1;a.Nb.maps[a.Nb.usedMap].used=!0;A.xk(!1)}
gd.prototype.Eb=function(a){A.log("nsVmap.nsMapManager.MapManager.prototype.addLayer");for(var b=!1,c=jQuery.extend(!0,{},A.qa.Ai()),d=A.g().H.getLayers().R(),e=D(A.g().H).La(),f=D(A.g().H).xa(),g=D(A.g().H).Gf(),h=0;h<c.children.length;h++)c.children[h].name===a.Qc&&(b=h);a.select=null;"true"===a.iI&&(a.select=!1);c.children[0].view.zoom=g;c.children[0].view.center=e;c.children[0].view.resolution=f;if("tilewms"===a.de||"imagewms"===a.de){e=[];for(h=0;h<d.length;h++){if("tilewms"===d[h].get("type"))for(f=
d[h].v().$b,g=0;g<f.length;g++)e.push({url:f[g],rb:d[h].v().Cc.LAYERS});"imagewms"===d[h].get("type")&&e.push({url:d[h].v().Pe,rb:d[h].v().Cc.LAYERS})}for(h=0;h<e.length;h++)if(e[h].url===A.properties.use_proxy_for_tiles?yr(a.url):a.url&&e[h].rb===a.ce)return $.notify("La couche est d\u00e9j\u00e0 pr\u00e9sente","wms-log-message"),null;a.Ak="";r(a.ht)&&r(a.password)&&0<a.ht.trim().length&&0<a.password.trim().length&&(a.Ak=JSON.stringify({login:a.ht,password:a.password}));!1===b?(a={name:a.Qc,children:[{name:a.Hd,
index:1E6,layerType:"tilewms",visible:"true",legend:"true",select:a.select,url:a.url,service_options:a.Ak,params:{LAYERS:a.ce,VERSION:a.version,STYLES:null!=a.style?a.style:""}}]},c.children.push(a)):(a={name:a.Hd,index:1E6,layerType:"tilewms",visible:"true",legend:"true",select:a.select,url:a.url,service_options:a.Ak,params:{LAYERS:a.ce,VERSION:a.version,STYLES:null!=a.style?a.style:""}},c.children[b].children.push(a))}else if("osm"===a.de){for(h=0;h<c.children.length;h++)if(c.children[h].children)for(g=
0;g<c.children[h].children.length;g++)if(c.children[h].children[g].url===a.url||""==a.url&&"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png"==c.children[h].children[g].url)return $.notify("La couche est d\u00e9j\u00e0 pr\u00e9sente","error"),0;!1===b?(a={name:a.Qc,children:[{index:1E6,name:a.Hd,visible:"true",layerType:"osm",url:a.url}]},c.children.push(a)):(a={name:a.Hd,index:1E6,visible:"true",layerType:"osm",url:a.url},c.children[b].children.push(a))}else if("xyz"===a.de){for(h=0;h<c.children.length;h++)if(c.children[h].children)for(g=
0;g<c.children[h].children.length;g++)if(c.children[h].children[g].url===a.url)return $.notify("La couche est d\u00e9j\u00e0 pr\u00e9sente","error"),0;!1===b?(a={name:a.Qc,children:[{index:1E6,name:a.Hd,visible:"true",layerType:"xyz",url:a.url}]},c.children.push(a)):(a={name:a.Hd,index:1E6,visible:"true",layerType:"xyz",url:a.url},c.children[b].children.push(a))}else if("bing"===a.de){for(h=0;h<c.children.length;h++)if(c.children[h].children)for(g=0;g<c.children[h].children.length;g++)if(c.children[h].children[g].imagerySet===
a.ce)return $.notify("La couche est d\u00e9j\u00e0 pr\u00e9sente","error"),0;!1===b?(a={name:a.Qc,children:[{name:a.ce,index:1E6,imagerySet:a.ce,visible:"true",layerType:"bing",key:a.key,culture:a.ki}]},c.children.push(a)):(a={name:a.ce,index:1E6,imagerySet:a.ce,visible:"true",layerType:"bing",key:a.key,culture:a.ki},c.children[b].children.push(a))}else if("wmts"===a.de){for(h=0;h<c.children.length;h++)if(c.children[h].children)for(g=0;g<c.children[h].children.length;g++)if(c.children[h].children[g].layer===
a.ce)return $.notify("La couche est d\u00e9j\u00e0 pr\u00e9sente","error"),0;!1===b?(a={name:a.Qc,children:[{name:a.Hd,index:1E6,layer:a.ce,visible:"true",layerType:"wmts",matrixSet:a.vp,style:a.style,format:a.format,requestEncoding:a.Gm,service_options:a.Ak,version:a.version,url:a.url}]},c.children.push(a)):(a={name:a.Hd,index:1E6,layer:a.ce,visible:"true",layerType:"wmts",matrixSet:a.vp,style:a.style,format:a.format,requestEncoding:a.Gm,service_options:a.Ak,version:a.version,url:a.url},c.children[b].children.push(a))}else if("imagevector"===
a.de){for(h=0;h<c.children.length;h++)if(c.children[h].children)for(g=0;g<c.children[h].children.length;g++)if("imagevector"===c.children[h].children[g].layerType&&void 0!==c.children[h].children[g].url&&(c.children[h].children[g].url===A.properties.use_proxy_for_tiles?yr(a.url):a.url))return $.notify("La couche est d\u00e9j\u00e0 pr\u00e9sente","error"),0;!1===b?(a={name:a.Qc,children:[{name:a.Hd,index:1E6,visible:"true",layerType:"imagevector",url:a.url,features:a.features,style:a.style}]},c.children.push(a)):
(a={name:a.Hd,index:1E6,visible:"true",layerType:"imagevector",url:a.url,features:a.features,style:a.style},c.children[b].children.push(a))}else console.error('type :"'+a.de+'" non pris en compte');A.qa.ij(c);A.qa.ej();A.xk(!1)};gd.prototype.addLayer=gd.prototype.Eb;
gd.prototype.uk=function(a){A.log("removeLayer");for(var b=this.Ui,c=D(A.g().H).xa(),d=D(A.g().H).La(),e=0;e<b.children.length;e++)if(b.children[e].children)for(var f=b.children[e].children,g=0;g<f.length;g++)f[g].olLayer.$$hashKey===a.$$hashKey&&f.splice(g,1);A.g().H.uk(a);for(e=0;e<b.children.length;e++)b.children[e].children&&0===b.children[e].children.length&&(A.g().H.getLayers().R().length=0,b.children.splice(e,1),this.ej());Uh(D(A.g().H),c);D(A.g().H).ub(d)};gd.prototype.removeLayer=gd.prototype.uk;
gd.prototype.kr=function(a,b,c){A.log("nsVmap.nsMapManager.MapManager.addLayerFromVectorContent");var d;try{d=$.parseJSON(a)}catch(m){d=a}for(var e=[ns,Gp,Ss,Zs,Xu],f=0;f<e.length;f++){var g=new e[f];try{var h=g.bj(d,{Kc:D(A.g().H).D()});if(0<h.length)var k=h,f=e.length}catch(m){}}if(null!=k)return a={de:"imagevector",Qc:b,Hd:c,features:k,style:new Dn({fill:new Cn({color:"rgba(255, 255, 255, 0.1)"}),stroke:new gl({color:"#319FD3",width:2})})},this.Eb(a),!0;$.notify("Impossible de lire les g\u00e9om\u00e9tries",
"error");console.error("Impossible de lire les g\u00e9om\u00e9tries: ",a);return!1};gd.prototype.addLayerFromVectorContent=gd.prototype.kr;
gd.prototype.qG=function(a){A.log("nsVmap.nsMapManager.MapManager.loadMapFromFile");var b=a.getAttribute("file-container");a=a.getAttribute("url");$("#maplist-log-message").empty();if(""!==a)if("htt"===a||"www"===a)oTree=dv(a),A.qa.ij(oTree),A.qa.ej();else{$.notify("Erreur lors du chargement du fichier: Pour de raisons de s\u00e9curit\u00e9, lors de l'utilisation d'un fichier local, vous devez utiliser le bouton \"Chercher\"","error");return}else if(""!==b){b=document.getElementById(b).files;if(!b.length){$.notify("Veuillez s\u00e9lectionner un fichier",
"error");return}b=b[0];a=new FileReader;a.onloadend=function(a){a.target.readyState===FileReader.DONE&&(a=$.parseJSON(a.target.result),A.qa.ij(a),A.qa.ej())};a.readAsText(b)}else{$.notify("Veuillez s\u00e9lectionner un fichier","error");return}A.jj("close-modal-button")};gd.prototype.loadMapFromFile=gd.prototype.qG;gd.prototype.ej=function(){A.log("nsVmap.nsMapManager.MapManager.reloadMap");angular.element($("#layertree")).scope().$evalAsync(function(a){a.ctrl.ym()})};gd.prototype.reloadMap=gd.prototype.ej;
function dv(a){var b;z({method:"GET",url:a,async:!1,responseType:"",success:function(a){a=JSON.parse(a.data);n(a.mapjsons)&&(b=a.mapjsons[0])}});A.log(b);return b}
gd.prototype.UC=function(a){var b=a.getAttribute("collapse"),c=$(a.getAttribute("data-target"))[0];"in"===b?(a.setAttribute("collapse","out"),$(a).find(".list-group-icon2").removeClass("icon-keyboard_arrow_down"),$(a).find(".list-group-icon2").addClass("icon-keyboard_arrow_right")):"out"===b?(a.setAttribute("collapse","in"),$(a).find(".list-group-icon2").removeClass("icon-keyboard_arrow_right"),$(a).find(".list-group-icon2").addClass("icon-keyboard_arrow_down")):console.error("value 'collapse' of element is not allowed: "+
a);c.setAttribute("collapse",a.getAttribute("collapse"));A.xk(!0)};gd.prototype.collapseElement=gd.prototype.UC;function yr(a){if(n(a)){var b=A.properties.proxy_url;a=a.replace(/\?/g,"&");return b+"?url="+a}}
gd.prototype.pI=function(a){var b=A.g().H.getLayers().R(),c=!0;null!=A.properties.controls&&null!=A.properties.controls.RefreshSocket&&null!=A.properties.controls.RefreshSocket.keep_loaded_tiles&&(c=A.properties.controls.RefreshSocket.keep_loaded_tiles);for(var d=0;d<b.length;d++){var e=b[d].get("events");null!=e&&-1!==e.indexOf(a)&&b[d].fd(c);delete e}};gd.prototype.reloadEventLayers=gd.prototype.pI;gd.prototype.vE=function(){return this.nt};gd.prototype.getLayersTreeTool=gd.prototype.vE;
gd.prototype.tE=function(){return this.mt};gd.prototype.getLayersOrderTool=gd.prototype.tE;gd.prototype.CE=function(){return this.ot};gd.prototype.getMapLegendTool=gd.prototype.CE;gd.prototype.FE=function(){return this.hf};gd.prototype.getMapModalTool=gd.prototype.FE;
gd.prototype.Ai=function(){function a(c){if(n(c.children))for(var d=0;d<c.children.length;d++)a(c.children[d]);n(c.olLayer)&&(c.visible=c.olLayer.getVisible(),c.index=b.indexOf(c.olLayer),c.opacity=c.olLayer.rg())}for(var b=A.g().H.getLayers().R(),c=0;c<this.Ui.children.length;c++)a(this.Ui.children[c]);return this.Ui};gd.prototype.getLayersTree=gd.prototype.Ai;
gd.prototype.Ao=function(){function a(b){if(n(b.children))for(var e=0;e<b.children.length;e++)a(b.children[e]);for(e=0;e<d.length;e++)n(b[d[e]])&&delete b[d[e]];n(b.view)&&(b.view.extent=Oh(D(c),c.Ta()),b.view.projection=D(c).D().V);"imagevector"===b.layerType&&null!=b.features&&(delete b.features,b.features=[])}for(var b=jQuery.extend(!0,{},A.qa.Ai()),c=A.g().H,d=["olLayer","$$hashKey","visibleLayers"],e=0;e<b.children.length;e++)a(b.children[e]);var f=[],b=JSON.stringify(b,function(a,b){if("object"===
typeof b&&null!==b){if(-1!==f.indexOf(b))return;f.push(b)}return b}),f=null;return b};gd.prototype.getJSONLayersTree=gd.prototype.Ao;gd.prototype.ij=function(a){this.Ui=a};gd.prototype.setLayersTree=gd.prototype.ij;gd.prototype.tx=function(){return this.Nb};gd.prototype.getMapCatalog=gd.prototype.tx;
gd.prototype.ps=function(a){A.log("nsVmap.nsMapManager.MapManager.prototype.getQueryableLayers");a=n(a)?a:!1;for(var b=A.g().H.getLayers().R(),c=[],d=0;d<b.length;d++)!0===b[d].get("bo_queryable")&&n(b[d].get("layer_id"))&&(!0===a&&!0!==b[d].getVisible()||c.push(b[d]));return c};gd.prototype.getQueryableLayers=gd.prototype.ps;
function ev(a){A.log("nsVmap.nsMapManager.MapManager.prototype.getBusinessObjectsFromLayers");for(var b={},c,d,e=0;e<a.length;e++){c=a[e].get("business_objects");for(var f=0;f<c.length;f++)d=c[f].business_object_id,null!=b[d]?b[d].layers.push(a[e]):b[d]={bo_id:d,layers:[a[e]],bo_title:c[f].title,bo_id_field:c[f].id_field,bo_user_rights:c[f].user_rights,bo_search_field:c[f].search_field,bo_result_field:c[f].result_field,bo_search_use_strict:c[f].search_use_strict,bo_selection_buffer:c[f].selection_buffer,
bo_geom_column:c[f].geom_column,bo_geom_type:c[f].geom_type,bo_index:null!=c[f].index?c[f].index:1E6}}return b}gd.prototype.sg=function(a){A.log("nsVmap.nsMapManager.MapManager.prototype.getQueryableBusinessObjects");a=this.ps(a);return ev(a)};gd.prototype.getQueryableBusinessObjects=gd.prototype.sg;gd.prototype.xx=function(a){A.log("nsVmap.nsMapManager.MapManager.prototype.getQueryableBusinessObjectsAsArray");var b=[];a=this.sg(a);for(var c in a)b.push(a[c]);return b};
gd.prototype.getQueryableBusinessObjectsAsArray=gd.prototype.xx;gd.prototype.zo=function(){A.log("nsVmap.nsMapManager.MapManager.prototype.getInsertableBusinessObjects");var a=ev(this.ps()),b=[],c;for(c in a)null!=a[c].bo_user_rights&&-1!==a[c].bo_user_rights.indexOf("INSERT")&&b.push(a[c]);return b};gd.prototype.getInsertableBusinessObjects=gd.prototype.zo;var fv={};function gv(){A.log("nsVmap.nsToolsManager.VmapUser")}pa("nsVmap.nsToolsManager.VmapUser",gv);fv.VmapUser=gv;gv.prototype.WK=function(){A.log("nsVmap.nsToolsManager.VmapUser.prototype.vmapuserDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang"},controller:"AppVmapUserController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/tools/user.html"}};
gv.prototype.ln=function(a){A.log("nsVmap.nsToolsManager.VmapUser.prototype.vmapuserController");a.sUserLoginText=sessionStorage.user_login};gv.prototype.ln.$inject=["$scope"];gv.prototype.ln.prototype.disconnect=function(){A.log("nsVmap.nsToolsManager.VmapUser.vmapuserController.disconnect");angular.element(u.f).scope().disconnect()};gv.prototype.ln.prototype.disconnect=gv.prototype.ln.prototype.disconnect;A.module.directive("appVmapUser",gv.prototype.WK);
A.module.controller("AppVmapUserController",gv.prototype.ln);function hv(a){a=a?a:{};this.Yn=void 0!==a.className?a.className:"ol-full-screen";var b=void 0!==a.label?a.label:"\u2922";this.Ts="string"===typeof b?document.createTextNode(b):b;b=void 0!==a.iG?a.iG:"\u00d7";this.Vx="string"===typeof b?document.createTextNode(b):b;var c=a.Og?a.Og:"Toggle full-screen",b=document.createElement("button");b.className=this.Yn+"-"+iv();b.setAttribute("type","button");b.title=c;b.appendChild(this.Ts);J(b,"click",this.ye,this);c=document.createElement("div");c.className=
this.Yn+" ol-unselectable ol-control "+(jv()?"":"ol-unsupported");c.appendChild(b);Yh.call(this,{element:c,target:a.target});this.gG=void 0!==a.keys?a.keys:!1;this.ob=a.source}E(hv,Yh);
hv.prototype.ye=function(a){a.preventDefault();jv()&&(a=this.g())&&(iv()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(a=this.ob?"string"===typeof this.ob?document.getElementById(this.ob):this.ob:am(a),this.gG?a.mozRequestFullScreenWithKeys?a.mozRequestFullScreenWithKeys():a.webkitRequestFullscreen?a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):
kv(a):kv(a)))};hv.prototype.rF=function(){var a=this.element.firstElementChild,b=this.g();iv()?(a.className=this.Yn+"-true",Wh(this.Vx,this.Ts)):(a.className=this.Yn+"-false",Wh(this.Ts,this.Vx));b&&b.zd()};hv.prototype.cb=function(a){Yh.prototype.cb.call(this,a);a&&this.Pi.push(J(document,lv(),this.rF,this))};
function jv(){var a=document.body;return!!(a.webkitRequestFullscreen||a.mozRequestFullScreen&&document.mozFullScreenEnabled||a.msRequestFullscreen&&document.msFullscreenEnabled||a.requestFullscreen&&document.fullscreenEnabled)}function iv(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)}
function kv(a){a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen()}var lv=function(){var a;return function(){if(!a){var b=document.body;b.webkitRequestFullscreen?a="webkitfullscreenchange":b.mozRequestFullScreen?a="mozfullscreenchange":b.msRequestFullscreen?a="MSFullscreenChange":b.requestFullscreen&&(a="fullscreenchange")}return a}}();function mv(a){a=a?a:{};var b=document.createElement("DIV");b.className=void 0!==a.className?a.className:"ol-mouse-position";Yh.call(this,{element:b,Ca:a.Ca?a.Ca:nv,target:a.target});J(this,Md(ov),this.zs,this);a.Vn&&this.set(pv,a.Vn);a.la&&this.eu(Gg(a.la));this.GK=void 0!==a.FK?a.FK:"";this.wk=b.innerHTML;this.ep=this.kd=this.im=null}E(mv,Yh);function nv(a){a=a.af;a?this.im!=a.hb.la&&(this.im=a.hb.la,this.kd=null):this.im=null;qv(this,this.ep)}l=mv.prototype;l.zs=function(){this.kd=null};l.D=function(){return this.get(ov)};
l.DF=function(a){this.ep=Xd(this.g(),a);qv(this,this.ep)};l.EF=function(){qv(this,null);this.ep=null};l.cb=function(a){Yh.prototype.cb.call(this,a);a&&(a=a.ac,this.Pi.push(J(a,"mousemove",this.DF,this),J(a,"mouseout",this.EF,this)))};l.eu=function(a){this.set(ov,a)};function qv(a,b){var c=a.GK;if(b&&a.im){if(!a.kd){var d=a.D();a.kd=d?Fg(a.im,d):Qg}if(b=a.g().Gd(b))a.kd(b,b),c=(c=a.get(pv))?c(b):b.toString()}a.wk&&c==a.wk||(a.element.innerHTML=c,a.wk=c)}var ov="projection",pv="coordinateFormat";function rv(a){function b(a){a=h.Gd(Xd(h,a));D(k.g()).ub(a);window.removeEventListener("mousemove",c);window.removeEventListener("mouseup",b)}function c(a){a=h.Gd(Xd(h,{clientX:a.clientX-p.offsetWidth/2,clientY:a.clientY+p.offsetHeight/2}));m.setPosition(a)}a=a?a:{};this.Dd=void 0!==a.collapsed?a.collapsed:!0;this.ig=void 0!==a.Ar?a.Ar:!0;this.ig||(this.Dd=!1);var d=void 0!==a.className?a.className:"ol-overviewmap",e=void 0!==a.Og?a.Og:"Overview map",f=void 0!==a.zr?a.zr:"\u00ab";"string"===typeof f?
(this.Xe=document.createElement("span"),this.Xe.textContent=f):this.Xe=f;f=void 0!==a.label?a.label:"\u00bb";"string"===typeof f?(this.ic=document.createElement("span"),this.ic.textContent=f):this.ic=f;var g=this.ig&&!this.Dd?this.Xe:this.ic,f=document.createElement("button");f.setAttribute("type","button");f.title=e;f.appendChild(g);J(f,"click",this.ye,this);this.zt=document.createElement("DIV");this.zt.className="ol-overviewmap-map";var h=this.ud=new Xl({controls:new Pd,Mi:new Pd,view:a.view});
a.rb&&a.rb.forEach(function(a){h.Eb(a)},this);e=document.createElement("DIV");e.className="ol-overviewmap-box";e.style.boxSizing="border-box";this.el=new Zo({position:[0,0],pk:"bottom-left",element:e});this.ud.eg(this.el);e=document.createElement("div");e.className=d+" ol-unselectable ol-control"+(this.Dd&&this.ig?" ol-collapsed":"")+(this.ig?"":" ol-uncollapsible");e.appendChild(this.zt);e.appendChild(f);Yh.call(this,{element:e,Ca:a.Ca?a.Ca:sv,target:a.target});var k=this,m=this.el,p=Qo(this.el);
p.addEventListener("mousedown",function(){window.addEventListener("mousemove",c);window.addEventListener("mouseup",b)})}E(rv,Yh);l=rv.prototype;l.cb=function(a){var b=this.g();a!==b&&(b&&((b=D(b))&&Ad(b,Md("rotation"),this.Lo,this),this.ud.Dh(null)),Yh.prototype.cb.call(this,a),a&&(this.ud.Dh(this.zt),this.Pi.push(J(a,"propertychange",this.CF,this)),0===this.ud.getLayers().Xb()&&(b=Zl(a),this.ud.set("layergroup",b)),a=D(a)))&&(J(a,Md("rotation"),this.Lo,this),a.$o()&&(this.ud.zd(),tv(this)))};
l.CF=function(a){"view"===a.key&&((a=a.oldValue)&&Ad(a,Md("rotation"),this.Lo,this),a=D(this.g()),J(a,Md("rotation"),this.Lo,this))};l.Lo=function(){D(this.ud).Lm(D(this.g()).Gb())};function sv(){var a=this.g(),b=this.ud;if(a.zc&&b.zc){var c=a.Ta(),a=Oh(D(a),c),d=b.Ta(),c=Oh(D(b),d),e=Gi(b,cg(a)),f=Gi(b,[a[2],a[1]]),b=Math.abs(e[0]-f[0]),e=Math.abs(e[1]-f[1]),f=d[0],d=d[1];b<.1*f||e<.1*d||b>.75*f||e>.75*d?tv(this):Nf(c,a)||(c=this.g(),a=this.ud,c=D(c),D(a).ub(c.La()))}uv(this)}
function tv(a){var b=a.g();a=a.ud;var c=b.Ta(),b=Oh(D(b),c);a=D(a);dg(b,1/(.1*Math.pow(2,Math.log(7.5)/Math.LN2/2)));Th(a,b)}function uv(a){var b=a.g(),c=a.ud;if(b.zc&&c.zc){var d=b.Ta(),e=D(b),f=D(c),c=e.Gb(),b=a.el,g=Qo(a.el),h=Oh(e,d),d=f.xa(),e=[h[0],h[1]],f=[h[2],h[3]],k;if(a=D(a.g()).La())k=[e[0]-a[0],e[1]-a[1]],Bf(k,c),yf(k,a);b.setPosition(k);g&&(g.style.width=Math.abs((e[0]-f[0])/d)+"px",g.style.height=Math.abs((f[1]-e[1])/d)+"px")}}l.ye=function(a){a.preventDefault();this.Bs()};
l.Bs=function(){this.element.classList.toggle("ol-collapsed");this.Dd?Wh(this.Xe,this.ic):Wh(this.ic,this.Xe);this.Dd=!this.Dd;var a=this.ud;this.Dd||a.zc||(a.zd(),tv(this),zd(a,"postrender",function(){uv(this)},this))};l.vx=function(){return this.ud};function vv(a){a=a?a:{};var b=void 0!==a.className?a.className:"ol-scale-line";this.Zo=document.createElement("DIV");this.Zo.className=b+"-inner";this.xb=document.createElement("DIV");this.xb.className=b+" ol-unselectable";this.xb.appendChild(this.Zo);this.lB=null;this.jt=void 0!==a.minWidth?a.minWidth:64;this.tc=!1;this.Dz=void 0;this.wk="";Yh.call(this,{element:this.xb,Ca:a.Ca?a.Ca:wv,target:a.target});J(this,Md(xv),this.QF,this);this.set(xv,a.units||"metric")}E(vv,Yh);var yv=[1,2,5];
vv.prototype.Tl=function(){return this.get(xv)};function wv(a){this.lB=(a=a.af)?a.hb:null;this.Jq()}vv.prototype.QF=function(){this.Jq()};
vv.prototype.Jq=function(){var a=this.lB;if(a){var b=a.la,c=ng(b),a=Eg(b,a.ra,a.Ka)*c,c=this.jt*a,b="",d=this.Tl();"degrees"==d?(b=lg.degrees,a/=b,c<b/60?(b="\u2033",a*=3600):c<b?(b="\u2032",a*=60):b="\u00b0"):"imperial"==d?.9144>c?(b="in",a/=.0254):1609.344>c?(b="ft",a/=.3048):(b="mi",a/=1609.344):"nautical"==d?(a/=1852,b="nm"):"metric"==d?.001>c?(b="\u03bcm",a*=1E6):1>c?(b="mm",a*=1E3):1E3>c?b="m":(b="km",a/=1E3):"us"==d?.9144>c?(b="in",a*=39.37):1609.344>c?(b="ft",a/=.30480061):(b="mi",a/=1609.3472):
af(!1,33);for(var d=3*Math.floor(Math.log(this.jt*a)/Math.log(10)),e;;){e=yv[(d%3+3)%3]*Math.pow(10,Math.floor(d/3));c=Math.round(e/a);if(isNaN(c)){this.xb.style.display="none";this.tc=!1;return}if(c>=this.jt)break;++d}a=e+" "+b;this.wk!=a&&(this.wk=this.Zo.innerHTML=a);this.Dz!=c&&(this.Zo.style.width=c+"px",this.Dz=c);this.tc||(this.xb.style.display="",this.tc=!0)}else this.tc&&(this.xb.style.display="none",this.tc=!1)};var xv="units";function zv(a){a=a?a:{};this.Ej=void 0;this.vl=Av;this.Oq=this.Po=0;this.xu=null;this.rA=!1;this.Jb=void 0!==a.duration?a.duration:200;var b=void 0!==a.className?a.className:"ol-zoomslider",c=document.createElement("button");c.setAttribute("type","button");c.className=b+"-thumb ol-unselectable";var d=document.createElement("div");d.className=b+" ol-unselectable ol-control";d.appendChild(c);this.bo=new Te(d);J(this.bo,"pointerdown",this.nF,this);J(this.bo,"pointermove",this.lF,this);J(this.bo,"pointerup",
this.mF,this);J(d,"click",this.iF,this);J(c,"click",Ed);Yh.call(this,{element:d,Ca:a.Ca?a.Ca:Bv})}E(zv,Yh);zv.prototype.ab=function(){this.bo.Yd();Yh.prototype.ab.call(this)};var Av=0;l=zv.prototype;l.cb=function(a){Yh.prototype.cb.call(this,a);a&&a.Ca()};
function Bv(a){if(a.af){if(!this.rA){var b=this.element,c=b.offsetWidth,d=b.offsetHeight,e=b.firstElementChild,f=getComputedStyle(e),b=e.offsetWidth+parseFloat(f.marginRight)+parseFloat(f.marginLeft),e=e.offsetHeight+parseFloat(f.marginTop)+parseFloat(f.marginBottom);this.xu=[b,e];c>d?(this.vl=1,this.Oq=c-b):(this.vl=Av,this.Po=d-e);this.rA=!0}a=a.af.hb.ra;a!==this.Ej&&(this.Ej=a,Cv(this,a))}}
l.iF=function(a){var b=D(this.g());a=Dv(this,gf(1===this.vl?(a.offsetX-this.xu[0]/2)/this.Oq:(a.offsetY-this.xu[1]/2)/this.Po,0,1));b.animate({ra:b.Ib(a),duration:this.Jb,Jc:Ef})};l.nF=function(a){this.ah||a.originalEvent.target!==this.element.firstElementChild||(Ih(D(this.g()),1,1),this.Gt=a.clientX,this.Ht=a.clientY,this.ah=!0)};
l.lF=function(a){if(this.ah){var b=this.element.firstElementChild;this.Ej=Dv(this,gf(1===this.vl?(a.clientX-this.Gt+parseInt(b.style.left,10))/this.Oq:(a.clientY-this.Ht+parseInt(b.style.top,10))/this.Po,0,1));Uh(D(this.g()),this.Ej);Cv(this,this.Ej);this.Gt=a.clientX;this.Ht=a.clientY}};l.mF=function(){if(this.ah){var a=D(this.g());Ih(a,1,-1);a.animate({ra:a.Ib(this.Ej),duration:this.Jb,Jc:Ef});this.ah=!1;this.Ht=this.Gt=void 0}};
function Cv(a,b){b=1-Sh(D(a.g()))(b);var c=a.element.firstElementChild;1==a.vl?c.style.left=a.Oq*b+"px":c.style.top=a.Po*b+"px"}function Dv(a,b){return Rh(D(a.g()))(1-b)};function Ev(a){a=a?a:{};this.te=a.Z?a.Z:null;var b=void 0!==a.className?a.className:"ol-zoom-extent",c=void 0!==a.label?a.label:"E",d=void 0!==a.Og?a.Og:"Fit to extent",e=document.createElement("button");e.setAttribute("type","button");e.title=d;e.appendChild("string"===typeof c?document.createTextNode(c):c);J(e,"click",this.ye,this);c=document.createElement("div");c.className=b+" ol-unselectable ol-control";c.appendChild(e);Yh.call(this,{element:c,target:a.target})}E(Ev,Yh);
Ev.prototype.ye=function(a){a.preventDefault();a=D(this.g());var b=this.te?this.te:a.D().W();Th(a,b)};function Fv(){A.log("nsVmap.nsToolsManager.Controls");this.jv=[{id:"Attribution",title:"Attributions",description:"Affiche les attributions de la couche"},{id:"MousePosition",title:"Position de la souris",description:"Affiche la position de la souris"},{id:"CurrentProjection",title:"Projection en cours",description:"Affiche la projection de la carte en cours"},{id:"MapName",title:"Nom de la carte en cours",description:"Affiche le nom de la carte en cours"},{id:"OverviewMap",title:"Carte de supervision",
description:"Affiche la carte de supervision"},{id:"Scale",title:"\u00c9chelle num\u00e9rique",description:"Outil de changement d'\u00e9chelle"},{id:"ScaleLine",title:"\u00c9chelle graphique",description:"Affiche la barre d'\u00e9chelle"},{id:"Zoom",title:"Zoom",description:"Affiche les boutons de zoom + et -"},{id:"ZoomSlider",title:"Slider de zoom",description:"Affiche le slider de zoom"},{id:"RefreshSocket",title:"Rafraichissement auto",description:"Rafraichit automatiquement les couches lorsque les donn\u00e9es sont modifi\u00e9es"}];
this.S=A.g().H}pa("nsVmap.nsToolsManager.Controls",Fv);fv.Controls=Fv;
Fv.prototype.Tc=function(a){A.log("nsVmap.nsToolsManager.Controls.prototype.addControl: "+a);switch(a){case "Attribution":var b=new Zh;b.set("type",a);this.S.Tc(b);break;case "FullScreen":b=new hv;b.set("type",a);this.S.Tc(b);break;case "MousePosition":b=new mv({Vn:function(a){return[a[0].toPrecision(8),a[1].toPrecision(8)]}});b.set("type",a);this.S.Tc(b);break;case "OverviewMap":this.EH=b=new rv({view:new Hh({la:D(this.S).D()})});b.set("type",a);this.S.Tc(b);break;case "Rotate":b=new ei({gw:!1});
b.set("type",a);this.S.Tc(b);break;case "ScaleLine":b=new vv({minWidth:80});b.set("type",a);this.S.Tc(b);break;case "Zoom":b=new gi;b.set("type",a);this.S.Tc(b);break;case "ZoomSlider":b=new zv;b.set("type",a);this.S.Tc(b);break;case "ZoomToExtent":b=new Ev;b.set("type",a);this.S.Tc(b);break;case "CurrentProjection":$("#olMap").children().children(".ol-overlaycontainer-stopevent").append('<div id="current-projection" class="ol-current-projection ol-unselectable ol-control"></div>');$("#current-projection").html(A.oProjections[D(A.g().H).D().V]);
break;case "MapName":$("#olMap").children().children(".ol-overlaycontainer-stopevent").append('<div id="map-name" class="ol-map-name ol-unselectable ol-control"></div>');a=A.qa.Nb;for(var c=0;c<a.maps.length;c++)!0===a.maps[c].used&&(b=a.maps[c].name);$("#map-name").html(b);break;case "Scale":a='<div class="dropup"> <button class="btn btn-sm btn-default dropdown-toggle padding-sides-10 set-scale-btn" style="width: auto" type="button" onclick="$(\'#scale-list\').toggle()"> <span id="current-scale">'+
A.g().fb({pretty:!0})+'</span> <span class="caret"></span> </button> <ul id="scale-list" style="font-size: 12px" class="dropdown-menu" aria-labelledby="dropdownMenu2"> <li><a class="pointer" onclick="$(\'#scale-modal\').modal(\'show\')">Ajouter \u00e0 la liste</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(1000000)">1:1,000,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(500000)">1:500,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(250000)">1:250,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(100000)">1:100,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(50000)">1:50,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(25000)">1:25,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(10000)">1:10,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(5000)">1:5,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(1000)">1:1,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(250)">1:250</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(100)">1:100</a></li> </ul> </div>';
$("#olMap").children().children(".ol-overlaycontainer-stopevent").append('<div id="current-scale-tool" class="ol-current-scale ol-unselectable ol-control"></div>');$("#current-scale-tool").html(a);this.S.on("click",function(){$("#scale-list").hide()},this);c=0;this.S.on("moveend",function(){c++;var a=angular.copy(c);setTimeout(function(){c===a&&$("#current-scale").html(A.g().fb({pretty:!0}))},100)},this);break;case "RefreshSocket":A.bRefreshWebsockets=!0;break;default:return console.error("Warning : control ("+
a+") is not available"),!1}};
Fv.prototype.lA=function(a,b){A.log("nsVmap.nsToolsManager.Controls.prototype.setToolActive: "+a,b);var c=A.g().H,d=c.Ef().R();b=n(b)?b:!0;if(!0===b)this.Tc(a);else for(var e=0;e<d.length;e++)if(d[e].get("type")===a)return c.Ef().remove(d[e]),0;"CurrentProjection"===a?!0===b?$("#current-projection").show():$("#current-projection").remove():"Scale"===a?!0===b?$("#current-scale-tool").show():$("#current-scale-tool").hide():"MapName"===a?!0===b?$("#map-name").show():$("#map-name").remove():"RefreshSocket"===
a&&(A.bRefreshWebsockets=b)};Fv.prototype.setToolActive=Fv.prototype.lA;Fv.prototype.YC=function(){A.log("nsVmap.nsToolsManager.Controls.prototype.controlsDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang"},controller:"AppControlsController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/tools/controls.html"}};
Fv.prototype.xw=function(){A.log("nsVmap.nsToolsManager.Controls.prototype.controlsController");this.Wk=this.Controls=A.F.Mc.Ef();this.aAvaliableControls=this.Controls.jv;this.RB=A.properties.controls.active_controls;for(var a=A.g().H,b=a.Ef().R(),c=0;c<b.length;c++)a.Ef().remove(b[c]);for(c=0;c<this.aAvaliableControls.length;c++)this.aAvaliableControls[c].active=-1!==this.RB.indexOf(this.aAvaliableControls[c].id)?!0:!1,this.Controls.Tc(this.aAvaliableControls[c].id),!1===this.aAvaliableControls[c].active&&
this.Controls.lA(this.aAvaliableControls[c].id,this.aAvaliableControls[c].active);setTimeout(function(){$('[data-toggle="tooltip"]').tooltip({animation:!1})},500)};Fv.prototype.$D=function(){return this.jv};Fv.prototype.getAvaliableControls=Fv.prototype.$D;Fv.prototype.vx=function(){return this.EH};A.module.directive("appControls",Fv.prototype.YC);A.module.controller("AppControlsController",Fv.prototype.xw);function Gv(a){Jd.call(this);a=a||{};this.zh=null;this.kd=Qg;this.nn=void 0;J(this,Md("projection"),this.zs,this);J(this,Md("tracking"),this.PF,this);void 0!==a.la&&this.eu(Gg(a.la));void 0!==a.tK&&this.set("trackingOptions",a.tK);Hv(this,void 0!==a.sK?a.sK:!1)}E(Gv,Jd);l=Gv.prototype;l.ab=function(){Hv(this,!1);Jd.prototype.ab.call(this)};l.zs=function(){var a=this.D();a&&(this.kd=Fg(Gg("EPSG:4326"),a),this.zh&&this.set("position",this.kd(this.zh)))};
l.PF=function(){if(le){var a=this.get("tracking");a&&void 0===this.nn?this.nn=navigator.geolocation.watchPosition(this.WH.bind(this),this.XH.bind(this),this.get("trackingOptions")):a||void 0===this.nn||(navigator.geolocation.clearWatch(this.nn),this.nn=void 0)}};
l.WH=function(a){var b=a.coords;this.set("accuracy",b.accuracy);this.set("altitude",null===b.altitude?void 0:b.altitude);this.set("altitudeAccuracy",null===b.altitudeAccuracy?void 0:b.altitudeAccuracy);this.set("heading",null===b.heading?void 0:lf(b.heading));this.zh?(this.zh[0]=b.longitude,this.zh[1]=b.latitude):this.zh=[b.longitude,b.latitude];a=this.kd(this.zh);this.set("position",a);this.set("speed",null===b.speed?void 0:b.speed);a=this.zh;var c=b.accuracy,b=[],d;for(d=0;32>d;++d)Ie(b,vg.offset(a,
c,2*Math.PI*d/32));b.push(b[0],b[1]);a=new zh(null);a.sa("XY",b,[b.length]);a.cl(this.kd);this.set("accuracyGeometry",a);this.G()};l.XH=function(a){a.type="error";Hv(this,!1);this.dispatchEvent(a)};l.Eo=function(){return this.get("position")};l.D=function(){return this.get("projection")};l.eu=function(a){this.set("projection",a)};function Hv(a,b){a.set("tracking",b)};function Iv(){A.log("nsVmap.nsToolsManager.Location")}pa("nsVmap.nsToolsManager.Location",Iv);Iv.prototype.BG=function(){A.log("nsVmap.nsToolsManager.Location.prototype.locationDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang"},controller:"ApplocationController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/tools/location.html"}};
Iv.prototype.Va=function(a,b,c){A.log("nsVmap.nsToolsManager.Location.prototype.locationController");var d=this;this.b=a;this.$timeout_=c;this.Ja=b;this.Uc=b.defer();this.S=this.map;D(this.S).La();D(this.S).Gf();this.projections=A.oProjections;this.locationResults=[];this.locationSearch="";this.searching=!1;this.noResults="";this.sSelectedLocationService=null;this.oBusinessObjects=[];this.scale=Math.round(A.g().fb());Jv(this);a.$watch("ctrl.locationSearch",function(){a.ctrl.Rz(this.last)},!0);a.sizeOf=
function(a){return Object.keys(a).length};A.scope.$on("layersChanged",function(){d.b.$applyAsync(function(){d.locationSearch="";Jv(d);setTimeout(function(){d.b.$applyAsync(function(){d.sSelectedLocationService=Kv(d);console.log("this_['sSelectedLocationService']: ",d.sSelectedLocationService)})})})});A.scope.$on("mapChanged",function(){n(d.fm)&&d.fm.remove()});a.locationServiceType="geocoder";this.locationServices=JSON.parse(A.properties.vmap_geocoders);setTimeout(function(){a.$applyAsync(function(){a.ctrl.sSelectedLocationService=
Kv(d)})})};Iv.prototype.locationController=Iv.prototype.Va;Iv.prototype.Va.$inject=["$scope","$q","$timeout"];
function Kv(a){A.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.getDefaultlocationService_");var b=[],c;for(c in a.oBusinessObjects)b.push(a.oBusinessObjects[c]);if("business_object"===A.properties.vmap_default_geocoders&&0<b.length){a=0;null!=b[a].bo_index||(b[a].bo_index=1E6);if(1<b.length)for(c=1;c<b.length;c++)null!=b[c].bo_index&&null!=b[c].bo_search_field&&null!=b[c].bo_result_field&&b[c].bo_index<b[a].bo_index&&(a=angular.copy(c));return null!=b[a].bo_search_field&&
null!=b[a].bo_result_field?b[a].bo_id:"osm"}return null!=a.locationServices[A.properties.vmap_default_geocoders]?A.properties.vmap_default_geocoders:"osm"}
Iv.prototype.Va.prototype.nI=function(){A.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.refreshMap");var a=this,b=new FormData;b.append("wmsservice_id",A.properties.private_wms_service);b.append("type","prod");z({method:"POST",url:A.properties.web_server_name+"/"+A.properties.services_alias+"/vm4ms/WmsServices/MapFile",data:b,success:function(){a.map.fd()},error:function(){a.map.fd()}})};Iv.prototype.Va.prototype.refreshMap=Iv.prototype.Va.prototype.nI;
Iv.prototype.Va.prototype.VB=function(){A.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.addScale");var a=$("#new-scale-input").val();$("#scale-list").append('<li><a class="pointer" onclick="oVmap.getMap().setScale('+a+')">'+function(a){for(var b=1,d=a.length-1;0<d;d--)0===b%3&&(a=a.slice(0,d)+","+a.slice(d+Math.abs(0))),b++;return"1:"+a}(a)+"</a></li>");$("#scale-modal").modal("hide")};Iv.prototype.Va.prototype.addScale=Iv.prototype.Va.prototype.VB;
function Jv(a){A.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.setBusinessObjectsList");a.oBusinessObjects=A.qa.sg()}Iv.prototype.Va.prototype.fk=function(){A.log("nsVmap.nsToolsManager.Location.prototype.locationController.maxExtent");var a=D(this.map),b=a.D().W();Th(a,b)};Iv.prototype.Va.prototype.maxExtent=Iv.prototype.Va.prototype.fk;
Iv.prototype.Va.prototype.cF=function(){A.log("nsVmap.nsToolsManager.Location.prototype.locationController.goHome");var a=D(A.g().H),b=a.get("homePosition");a.ub(b.Ka);Uh(a,b.ra)};Iv.prototype.Va.prototype.goHome=Iv.prototype.Va.prototype.cF;
Iv.prototype.Va.prototype.dF=function(a,b,c){A.log("nsVmap.nsToolsManager.Location.prototype.locationController.goTo");a=[parseFloat($("#"+a).val()),parseFloat($("#"+b).val())];c=$("#"+c).val();b=D(A.g().H).D();b=Rg(a,c,b);var d=new So(new rh(b));if(isNaN(b[0])||isNaN(b[1]))return bootbox.alert("<h4>Ces coordonn\u00e9es ne sont pas disponibles dans la projection saisie</h4>"),0;var e="X: "+a[0],e=e+("<br>Y: "+a[1]),e=e+("<br><i>"+A.oProjections[c]+"</i>");Lv(this,d,e);D(this.map).ub(b)};
Iv.prototype.Va.prototype.goTo=Iv.prototype.Va.prototype.dF;Iv.prototype.Va.prototype.YD=function(){A.log("nsVmap.nsToolsManager.Location.prototype.locationController.geolocateMe");var a=this,b=new Gv({la:"EPSG:4326"});Hv(b,!0);b.on("change:position",function(){var c=D(A.g().H).D(),c=Rg(b.Eo(),"EPSG:4326",c),c=new So(new rh(c));Lv(a,c,"Vous \u00eates ici");Hv(b,!1)});b.on("error",function(){console.error("error")})};Iv.prototype.Va.prototype.geolocateMe=Iv.prototype.Va.prototype.YD;
Iv.prototype.Va.prototype.Rz=function(a,b){function c(a,b){function c(a,b){return 1===a.length?null!=b[a[0]]?b[a[0]]:null:1<a.length&&null!=b[a[0]]?(b=b[a[0]],a.splice(0,1),c(a,b)):null}return c(a.split("."),b)}A.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.searchLocation");a=n(a)?a:this.locationSearch;b=n(b)?b:4;if(0===a.length)return 0;this.Uc.resolve();this.Uc=this.Ja.defer();A.F.Mc.Zf();""!==a&&A.F.Mc.kq("#location-search-form");this.searching=!0;this.noResults="";
var d=null,e={};if(null!=this.locationServices[this.sSelectedLocationService]){this.b.locationServiceType="geocoder";var f=this.locationServices[this.sSelectedLocationService];null!=f.url&&(d=f.url.replace("[limit]",b).replace("[search]",a))}else if(null!=this.oBusinessObjects[this.sSelectedLocationService]){this.b.locationServiceType="business_object";var f=this.sSelectedLocationService,d=this.oBusinessObjects[f].bo_id,e=this.oBusinessObjects[f].bo_search_field,g=this.oBusinessObjects[f].bo_search_use_strict,
f="",f="true"===g||!0===g?{column:e,compare_operator:"=",value:g}:"left"===g?{column:e,compare_operator:"LIKE",compare_operator_options:{case_insensitive:!0},value:a+"%"}:"right"===g?{column:e,compare_operator:"LIKE",compare_operator_options:{case_insensitive:!0},value:"%"+a}:{column:e,compare_operator:"LIKE",compare_operator_options:{case_insensitive:!0},value:"%"+a+"%"},d=A.properties.api_url+"/vmap/querys/"+d+"/summary",e={filter:f,limit:b}}if(null!=d){var h=this;z({method:"GET",url:d,headers:{Accept:"application/x-vm-json"},
params:e,scope:this.b,timeout:5E3,abord:this.Uc.promise,success:function(a){h.searching=!1;h.locationResults=[];h.noResults="";if(!n(a.data)||null===a.data)return h.noResults="Aucun r\u00e9sultat",console.error("Pas de donn\u00e9es \u00e0 afficher"),0;if(n(a.data.error)&&n(a.data.error.errorMessage))return console.error(a.data.error.errorMessage),h.noResults=a.data.error.QL,a.data.error;null!=h.oBusinessObjects[h.sSelectedLocationService]&&null!=a.data&&null!=a.data.data&&(h.locationResults=a.data.data);
if(null!=h.locationServices[h.sSelectedLocationService]){var b=h.locationServices[h.sSelectedLocationService];a=c(b.data_field,a);for(var d=0;d<a.length;d++){var e={};e.title=c(b.title_field,a[d]);null!=b.description_field&&(e.description=c(b.description_field,a[d]));null!=b.geojson_field&&(e.geojson=c(b.geojson_field,a[d]));if(q(b.summary_fields)){e.summary=[];for(var f=0;f<b.summary_fields.length;f++)e.summary.push({label:b.summary_fields[f].label,value:c(b.summary_fields[f].key,a[d])})}h.locationResults.push(e)}}if(!n(h.locationResults))return 0;
if(0===h.locationResults.length)return h.noResults="Aucun r\u00e9sultat",0},error:function(){h.searching=!1;h.locationResults=[];h.noResults="";h.noResults="Requ\u00eate en erreur"}})}};Iv.prototype.Va.prototype.searchLocation=Iv.prototype.Va.prototype.Rz;
Iv.prototype.Va.prototype.zG=function(a){A.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.locatePlace");if(!n(a))return"place not defined";var b=a.geojson,c=D(this.map).D();n(a.lon)&&n(a.lat)&&(c=Rg([parseFloat(a.lon),parseFloat(a.lat)],"EPSG:4326",c),D(this.map).ub(c));if(!n(b))return 0;this.ny(b,"EPSG:4326",a.title)};Iv.prototype.Va.prototype.locatePlace=Iv.prototype.Va.prototype.zG;
Iv.prototype.Va.prototype.ZB=function(a){A.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.addSelection");var b=this,c=A.properties.api_url+"/vmap/querys/"+a.bo_type+"/summary",d=D(this.map).D().V.substring(5);cd();z({method:"GET",url:c,headers:{Accept:"application/x-vm-json"},params:{filter:{column:a.bo_id_field.replace(/\./g,'"."'),compare_operator:"=",value:a.bo_id_value},get_geom:!0,result_proj:d,get_image:!0,limit:200},scope:this.b,success:function(a){n(a.data.error)&&
n(a.data.error.errorMessage)&&console.error(a.data.error.errorMessage);if(n(a.data.data))var c=a.data.data;else console.error("Pas de donn\u00e9es \u00e0 afficher");if(0===c.length)return 0;var d=c[0];if(null==d.bo_intersect_geom)return $.notify("G\u00e9om\u00e9trie non disponible"),0;Mv(b,d.bo_intersect_geom);var e=angular.element($("#vmap-basicselect-tool")).scope();e.$evalAsync(function(){var a=e.ctrl,b=Va(a.aSelections);Wa(a.uj,b);a.vk();a.Te({data:[d],dataType:"summary",mb:function(){Nv(a,a.uj);
a.Zn(a.aSelections)}})})}})};Iv.prototype.Va.prototype.addToSelection=Iv.prototype.Va.prototype.ZB;function Mv(a,b){A.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.centerGeom");b=A.yi(b);var c=D(a.map).xa();"Point"===b.K()?(D(a.map).ub(b.ca()),Uh(D(a.map),c)):"MultiPoint"===b.K()?(Th(D(a.map),b.W()),Uh(D(a.map),c)):Th(D(a.map),b.W())}
Iv.prototype.Va.prototype.ny=function(a,b,c){A.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.locateGeom");if(!n(a))return"geom not defined";"string"===typeof a&&(a=JSON.parse(a));var d=D(this.map).D();a=(new Gp({yc:d})).wm(a,{Wd:b,Kc:d});a=new So({geometry:a});Lv(this,a,c)};Iv.prototype.Va.prototype.locateGeom=Iv.prototype.Va.prototype.ny;
function Lv(a,b,c){A.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.locateFeature");var d=b.j().W(),e=D(a.map).xa();"Point"===b.j().K()?D(a.map).ub(b.j().ca()):"MultiPoint"===b.j().K()?(Th(D(a.map),d),D(a.map).Fh(e)):Th(D(a.map),d);n(a.fm)&&a.fm.remove();a.fm=new hp(b);a.fm.Ra(c)}Iv.prototype.Va.prototype.uI=function(){A.F.Mc.Jx("#location-search-form")};Iv.prototype.Va.prototype.removeLocation=Iv.prototype.Va.prototype.uI;A.module.directive("appLocation",Iv.prototype.BG);
A.module.controller("ApplocationController",Iv.prototype.Va);function Ov(a,b,c){Xg.call(this);Pv(this,a,b?b:0,c)}E(Ov,Xg);l=Ov.prototype;l.clone=function(){var a=new Ov(null);a.sa(this.Ua,this.l.slice());return a};l.yf=function(a,b,c,d){var e=this.l;a-=e[0];var f=b-e[1];b=a*a+f*f;if(b<d){0===b?d=0:(d=this.bf()/Math.sqrt(b),c[0]=e[0]+d*a,c[1]=e[1]+d*f,d=2);for(;d<this.P;++d)c[d]=e[d];c.length=this.P;return b}return d};l.zf=function(a,b){var c=this.l;a-=c[0];b-=c[1];return a*a+b*b<=Qv(this)};l.La=function(){return this.l.slice(0,this.P)};
l.Rn=function(a){var b=this.l,c=b[this.P]-b[0];return Pf(b[0]-c,b[1]-c,b[0]+c,b[1]+c,a)};l.bf=function(){return Math.sqrt(Qv(this))};function Qv(a){var b=a.l[a.P]-a.l[0];a=a.l[a.P+1]-a.l[1];return b*b+a*a}l.K=function(){return"Circle"};l.ub=function(a){var b=this.P,c=this.l[b]-this.l[0],d=a.slice();d[b]=d[0]+c;for(c=1;c<b;++c)d[b+c]=a[c];this.sa(this.Ua,d)};
function Pv(a,b,c,d){if(b){bh(a,d,b,0);a.l||(a.l=[]);d=a.l;b=jh(d,b);d[b++]=d[0]+c;var e;c=1;for(e=a.P;c<e;++c)d[b++]=d[c];d.length=b;a.G()}else a.sa("XY",null)}l.ca=function(){};l.Bb=function(){};l.sa=function(a,b){ah(this,a,b);this.G()};l.hA=function(a){this.l[this.P]=this.l[0]+a;this.G()};function Oo(a){zi.call(this,{ug:Rv,handleEvent:Sv,vg:Tv});this.Pm=!1;this.$n=null;this.$d=!1;this.ob=a.source?a.source:null;this.dd=a.features?a.features:null;this.DJ=a.CJ?a.CJ:12;this.bn=a.type;this.dc=Uv(this.bn);this.Iy=a.XG?a.XG:this.dc===Vv?3:2;this.By=a.PG?a.PG:Infinity;this.RD=a.QD?a.QD:fg;var b=a.$L;if(!b)if("Circle"===this.bn)b=function(a,b){b=b?b:new Ov([NaN,NaN]);Pv(b,a[0],Math.sqrt(Cf(a[0],a[1])));return b};else{var c,d=this.dc;d===Wv?c=rh:d===Xv?c=xp:d===Vv&&(c=zh);b=function(a,b){b?
d===Vv?b.Bb([a[0].concat([a[0][0]])]):b.Bb(a):b=new c(a);return b}}this.we=b;this.Hk=this.Ih=this.Zb=this.Jh=this.Rd=this.ue=null;this.vA=a.tw?a.tw*a.tw:36;this.Qf=new Mo({source:new ao({Ph:!1,ib:a.ib?a.ib:!1}),style:a.style?a.style:Yv()});this.pd=a.ZD;this.ld=a.Vb?a.Vb:ui;this.XD=a.ZL?fg:a.WD?a.WD:vi;J(this,Md("active"),this.cn,this)}E(Oo,zi);function Yv(){var a=In();return function(b){return a[b.j().K()]}}l=Oo.prototype;l.cb=function(a){zi.prototype.cb.call(this,a);this.cn()};
function Sv(a){this.$d=this.dc!==Wv&&this.XD(a);var b=!this.$d;this.$d&&"pointerdrag"===a.type&&null!==this.Rd?(Zv(this,a),b=!1):"pointermove"===a.type?b=this.Vj(a):"dblclick"===a.type&&(b=!1);return Ai.call(this,a)&&b}function Rv(a){this.Pm=!this.$d;return this.$d?(this.$n=a.Yc,this.ue||$v(this,a),!0):this.ld(a)?(this.$n=a.Yc,!0):!1}
function Tv(a){var b=!0;this.Vj(a);var c=this.dc===aw;this.Pm?(this.ue?this.$d||c?bw(this):cw(this,a)?this.RD(a)&&bw(this):Zv(this,a):($v(this,a),this.dc===Wv&&bw(this)),b=!1):this.$d&&(this.ue=null,dw(this));return b}
l.Vj=function(a){if(this.$n&&(!this.$d&&this.Pm||this.$d&&!this.Pm)){var b=this.$n,c=a.Yc,d=b[0]-c[0],b=b[1]-c[1],d=d*d+b*b;this.Pm=this.$d?d>this.vA:d<=this.vA}this.ue?(d=a.Qb,b=this.Rd.j(),this.dc===Wv?c=this.Zb:this.dc===Vv?(c=this.Zb[0],c=c[c.length-1],cw(this,a)&&(d=this.ue.slice())):(c=this.Zb,c=c[c.length-1]),c[0]=d[0],c[1]=d[1],this.we(this.Zb,b),this.Jh&&this.Jh.j().Bb(d),b instanceof zh&&this.dc!==Vv?(this.Ih||(this.Ih=new So(new xp(null))),d=Dh(b),a=this.Ih.j(),a.sa(d.Ua,d.l)):this.Hk&&
(a=this.Ih.j(),a.Bb(this.Hk)),ew(this)):(a=a.Qb.slice(),this.Jh?this.Jh.j().Bb(a):(this.Jh=new So(new rh(a)),ew(this)));return!0};function cw(a,b){var c=!1;if(a.Rd){var d=!1,e=[a.ue];a.dc===Xv?d=a.Zb.length>a.Iy:a.dc===Vv&&(d=a.Zb[0].length>a.Iy,e=[a.Zb[0][0],a.Zb[0][a.Zb[0].length-2]]);if(d)for(var d=b.map,f=0,g=e.length;f<g;f++){var h=e[f],k=Gi(d,h),m=b.Yc,c=m[0]-k[0],k=m[1]-k[1];if(c=Math.sqrt(c*c+k*k)<=(a.$d?1:a.DJ)){a.ue=h;break}}}return c}
function $v(a,b){b=b.Qb;a.ue=b;a.dc===Wv?a.Zb=b.slice():a.dc===Vv?(a.Zb=[[b.slice(),b.slice()]],a.Hk=a.Zb[0]):(a.Zb=[b.slice(),b.slice()],a.dc===aw&&(a.Hk=a.Zb));a.Hk&&(a.Ih=new So(new xp(a.Hk)));b=a.we(a.Zb);a.Rd=new So;a.pd&&lp(a.Rd,a.pd);a.Rd.$c(b);ew(a);a.dispatchEvent(new fw("drawstart",a.Rd))}
function Zv(a,b){b=b.Qb;var c=a.Rd.j(),d,e;a.dc===Xv?(a.ue=b.slice(),e=a.Zb,e.length>=a.By&&(a.$d?e.pop():d=!0),e.push(b.slice()),a.we(e,c)):a.dc===Vv&&(e=a.Zb[0],e.length>=a.By&&(a.$d?e.pop():d=!0),e.push(b.slice()),d&&(a.ue=e[0]),a.we(a.Zb,c));ew(a);d&&bw(a)}
function bw(a){var b=dw(a),c=a.Zb,d=b.j();a.dc===Xv?(c.pop(),a.we(c,d)):a.dc===Vv&&(c[0].pop(),a.we(c,d),c=d.ca());"MultiPoint"===a.bn?b.$c(new Bp([c])):"MultiLineString"===a.bn?b.$c(new yp([c])):"MultiPolygon"===a.bn&&b.$c(new Ep([c]));a.dispatchEvent(new fw("drawend",b));a.dd&&a.dd.push(b);a.ob&&a.ob.Gc(b)}function dw(a){a.ue=null;var b=a.Rd;b&&(a.Rd=null,a.Jh=null,a.Ih=null,a.Qf.v().clear(!0));return b}
l.extend=function(a){var b=a.j();this.Rd=a;this.Zb=b.ca();a=this.Zb[this.Zb.length-1];this.ue=a.slice();this.Zb.push(a.slice());ew(this);this.dispatchEvent(new fw("drawstart",this.Rd))};l.Fk=gg;function ew(a){var b=[];a.Rd&&b.push(a.Rd);a.Ih&&b.push(a.Ih);a.Jh&&b.push(a.Jh);a=a.Qf.v();a.clear(!0);a.ai(b)}l.cn=function(){var a=this.g(),b=this.get("active");a&&b||dw(this);this.Qf.cb(b?a:null)};
function Uv(a){var b;"Point"===a||"MultiPoint"===a?b=Wv:"LineString"===a||"MultiLineString"===a?b=Xv:"Polygon"===a||"MultiPolygon"===a?b=Vv:"Circle"===a&&(b=aw);return b}var Wv="Point",Xv="LineString",Vv="Polygon",aw="Circle";function fw(a,b){Dd.call(this,a);this.za=b}E(fw,Dd);function gw(a){zi.call(this,{ug:hw,hh:iw,handleEvent:jw,vg:kw});this.ld=a.Vb?a.Vb:yi;this.fD=function(a){return ui(a)&&ti(a)};this.kD=a.jD?a.jD:this.fD;this.kB=this.bd=null;this.Xx=[0,0];this.gk=this.Uo=!1;this.Dc=new rl;this.Et=void 0!==a.PH?a.PH:10;this.xf=this.ku=!1;this.$e=[];this.Qf=new Mo({source:new ao({Ph:!1,ib:!!a.ib}),style:a.style?a.style:lw(),mj:!0,nj:!0});this.Wq={Point:this.dL,LineString:this.DB,LinearRing:this.DB,Polygon:this.eL,MultiPoint:this.bL,MultiLineString:this.aL,MultiPolygon:this.cL,
Circle:this.ZK,GeometryCollection:this.$K};this.dd=a.features;this.dd.forEach(this.bl,this);J(this.dd,"add",this.pF,this);J(this.dd,"remove",this.qF,this);this.Vs=null}E(gw,zi);l=gw.prototype;l.bl=function(a){var b=a.j();b&&b.K()in this.Wq&&this.Wq[b.K()].call(this,a,b);(b=this.g())&&b.zc&&this.get("active")&&mw(this,this.Xx,b);J(a,"change",this.Vl,this)};function nw(a){a.gk||(a.gk=!0,a.dispatchEvent(new ow("modifystart",a.dd)))}
l.Rp=function(a){pw(this,a);this.bd&&0===this.dd.Xb()&&(this.Qf.v().fc(this.bd),this.bd=null);Ad(a,"change",this.Vl,this)};function pw(a,b){a=a.Dc;var c=[];a.forEach(function(a){b===a.za&&c.push(a)});for(var d=c.length-1;0<=d;--d)a.remove(c[d])}l.setActive=function(a){this.bd&&!a&&(this.Qf.v().fc(this.bd),this.bd=null);zi.prototype.setActive.call(this,a)};l.cb=function(a){this.Qf.cb(a);zi.prototype.cb.call(this,a)};l.pF=function(a){this.bl(a.element)};
l.Vl=function(a){this.xf||(a=a.target,this.Rp(a),this.bl(a))};l.qF=function(a){this.Rp(a.element)};l.dL=function(a,b){var c=b.ca();a={za:a,geometry:b,Db:[c,c]};this.Dc.Bc(b.W(),a)};l.bL=function(a,b){var c=b.ca(),d,e,f;e=0;for(f=c.length;e<f;++e)d=c[e],d={za:a,geometry:b,depth:[e],index:e,Db:[d,d]},this.Dc.Bc(b.W(),d)};l.DB=function(a,b){var c=b.ca(),d,e,f,g;d=0;for(e=c.length-1;d<e;++d)f=c.slice(d,d+2),g={za:a,geometry:b,index:d,Db:f},this.Dc.Bc(Hf(f),g)};
l.aL=function(a,b){var c=b.ca(),d,e,f,g,h,k,m;g=0;for(h=c.length;g<h;++g)for(d=c[g],e=0,f=d.length-1;e<f;++e)k=d.slice(e,e+2),m={za:a,geometry:b,depth:[g],index:e,Db:k},this.Dc.Bc(Hf(k),m)};l.eL=function(a,b){var c=b.ca(),d,e,f,g,h,k,m;g=0;for(h=c.length;g<h;++g)for(d=c[g],e=0,f=d.length-1;e<f;++e)k=d.slice(e,e+2),m={za:a,geometry:b,depth:[g],index:e,Db:k},this.Dc.Bc(Hf(k),m)};
l.cL=function(a,b){var c=b.ca(),d,e,f,g,h,k,m,p,t,v;k=0;for(m=c.length;k<m;++k)for(p=c[k],g=0,h=p.length;g<h;++g)for(d=p[g],e=0,f=d.length-1;e<f;++e)t=d.slice(e,e+2),v={za:a,geometry:b,depth:[g,k],index:e,Db:t},this.Dc.Bc(Hf(t),v)};l.ZK=function(a,b){var c=b.La(),d={za:a,geometry:b,index:0,Db:[c,c]};a={za:a,geometry:b,index:1,Db:[c,c]};d.Yr=a.Yr=[d,a];this.Dc.Bc(Rf(c),d);this.Dc.Bc(b.W(),a)};l.$K=function(a,b){var c=b.Rb;for(b=0;b<c.length;++b)this.Wq[c[b].K()].call(this,a,c[b])};
function qw(a,b){var c=a.bd;c?c.j().Bb(b):(c=new So(new rh(b)),a.bd=c,a.Qf.v().Gc(c))}function rw(a,b){return a.index-b.index}
function hw(a){if(!this.ld(a))return!1;mw(this,a.Yc,a.map);var b=a.map.Gd(a.Yc);this.$e.length=0;this.gk=!1;var c=this.bd;if(c){a=[];var c=c.j().ca(),d=Hf([c]),d=sl(this.Dc,d),e={};d.sort(rw);for(var f=0,g=d.length;f<g;++f){var h=d[f],k=h.Db,m=I(h.za),p=h.depth;p&&(m+="-"+p.join("-"));e[m]||(e[m]=Array(2));if("Circle"===h.geometry.K()&&1===h.index)k=sw(b,h),Af(k,c)&&!e[m][0]&&(this.$e.push([h,0]),e[m][0]=h);else if(Af(k[0],c)&&!e[m][0])this.$e.push([h,0]),e[m][0]=h;else if(Af(k[1],c)&&!e[m][1]){if("LineString"!==
h.geometry.K()&&"MultiLineString"!==h.geometry.K()||!e[m][0]||0!==e[m][0].index)this.$e.push([h,1]),e[m][1]=h}else I(k)in this.kB&&!e[m][0]&&!e[m][1]&&a.push([h,c])}a.length&&nw(this);for(b=a.length-1;0<=b;--b)this.cG.apply(this,a[b])}return!!this.bd}
function iw(a){this.Uo=!1;nw(this);a=a.Qb;for(var b=0,c=this.$e.length;b<c;++b){for(var d=this.$e[b],e=d[0],f=e.depth,g=e.geometry,h,k=e.Db,d=d[1];a.length<g.P;)a.push(k[d][a.length]);switch(g.K()){case "Point":h=a;k[0]=k[1]=a;break;case "MultiPoint":h=g.ca();h[e.index]=a;k[0]=k[1]=a;break;case "LineString":h=g.ca();h[e.index+d]=a;k[d]=a;break;case "MultiLineString":h=g.ca();h[f[0]][e.index+d]=a;k[d]=a;break;case "Polygon":h=g.ca();h[f[0]][e.index+d]=a;k[d]=a;break;case "MultiPolygon":h=g.ca();h[f[1]][f[0]][e.index+
d]=a;k[d]=a;break;case "Circle":k[0]=k[1]=a,0===e.index?(this.xf=!0,g.ub(a)):(this.xf=!0,g.hA(Df(g.La(),a))),this.xf=!1}h&&(e=g,f=h,this.xf=!0,e.Bb(f),this.xf=!1)}qw(this,a)}
function kw(){for(var a,b,c=this.$e.length-1;0<=c;--c)if(a=this.$e[c][0],b=a.geometry,"Circle"===b.K()){var d=b.La(),e=a.Yr[0];a=a.Yr[1];e.Db[0]=e.Db[1]=d;a.Db[0]=a.Db[1]=d;this.Dc.update(Rf(d),e);this.Dc.update(b.W(),a)}else this.Dc.update(Hf(a.Db),a);this.gk&&(this.dispatchEvent(new ow("modifyend",this.dd)),this.gk=!1);return!1}
function jw(a){if(!(a instanceof Zd))return!0;this.Vs=a;var b;Kh(D(a.map))[1]||"pointermove"!=a.type||this.Gi||this.Vj(a);if(this.bd&&this.kD(a)){var c;if("singleclick"==a.type&&this.Uo)c=!0;else if(this.Vs&&"pointerdrag"!=this.Vs.type){nw(this);b=this.$e;var d={},e,f,g,h,k,m,p,t,v;for(k=b.length-1;0<=k;--k)h=b[k],v=h[0],c=I(v.za),v.depth&&(c+="-"+v.depth.join("-")),c in d||(d[c]={}),0===h[1]?(d[c].right=v,d[c].index=v.index):1==h[1]&&(d[c].left=v,d[c].index=v.index+1);for(c in d){t=d[c].right;m=
d[c].left;k=d[c].index;p=k-1;v=void 0!==m?m:t;0>p&&(p=0);h=v.geometry;f=g=h.ca();e=!1;switch(h.K()){case "MultiLineString":2<g[v.depth[0]].length&&(g[v.depth[0]].splice(k,1),e=!0);break;case "LineString":2<g.length&&(g.splice(k,1),e=!0);break;case "MultiPolygon":f=f[v.depth[1]];case "Polygon":f=f[v.depth[0]],4<f.length&&(k==f.length-1&&(k=0),f.splice(k,1),e=!0,0===k&&(f.pop(),f.push(f[0]),p=f.length-1))}e&&(e=h,this.xf=!0,e.Bb(g),this.xf=!1,g=[],void 0!==m&&(this.Dc.remove(m),g.push(m.Db[0])),void 0!==
t&&(this.Dc.remove(t),g.push(t.Db[1])),void 0!==m&&void 0!==t&&(m={depth:v.depth,za:v.za,geometry:v.geometry,index:p,Db:g},this.Dc.Bc(Hf(m.Db),m)),tw(this,h,k,v.depth,-1),this.bd&&(this.Qf.v().fc(this.bd),this.bd=null),b.length=0)}this.dispatchEvent(new ow("modifyend",this.dd));this.gk=!1;c=!0}else c=!1;b=c}"singleclick"==a.type&&(this.Uo=!1);return Ai.call(this,a)&&!b}l.Vj=function(a){this.Xx=a.Yc;mw(this,a.Yc,a.map)};
function mw(a,b,c){function d(a,b){return uw(e,a)-uw(e,b)}var e=c.Gd(b),f=Kf(Rf(e),D(c).xa()*a.Et),f=sl(a.Dc,f);if(0<f.length){f.sort(d);var g=f[0],h=g.Db,k=sw(e,g),m=Gi(c,k),p=Df(b,m);if(p<=a.Et){b={};if("Circle"===g.geometry.K()&&1===g.index)a.ku=!0,qw(a,k);else for(p=Gi(c,h[0]),g=Gi(c,h[1]),c=Cf(m,p),m=Cf(m,g),p=Math.sqrt(Math.min(c,m)),a.ku=p<=a.Et,a.ku&&(k=c>m?h[1]:h[0]),qw(a,k),m=1,c=f.length;m<c;++m)if(k=f[m].Db,Af(h[0],k[0])&&Af(h[1],k[1])||Af(h[0],k[1])&&Af(h[1],k[0]))b[I(k)]=!0;else break;
b[I(h)]=!0;a.kB=b;return}}a.bd&&(a.Qf.v().fc(a.bd),a.bd=null)}function uw(a,b){var c=b.geometry;return"Circle"===c.K()&&1===b.index?(a=Cf(c.La(),a),c=Math.sqrt(a)-c.bf(),c*c):Cf(a,zf(a,b.Db))}function sw(a,b){var c=b.geometry;"Circle"===c.K()&&1===b.index?(b=[NaN,NaN],c.yf(a[0],a[1],b,Infinity),a=b):a=zf(a,b.Db);return a}
l.cG=function(a,b){for(var c=a.Db,d=a.za,e=a.geometry,f=a.depth,g=a.index,h;b.length<e.P;)b.push(0);switch(e.K()){case "MultiLineString":h=e.ca();h[f[0]].splice(g+1,0,b);break;case "Polygon":h=e.ca();h[f[0]].splice(g+1,0,b);break;case "MultiPolygon":h=e.ca();h[f[1]][f[0]].splice(g+1,0,b);break;case "LineString":h=e.ca();h.splice(g+1,0,b);break;default:return}this.xf=!0;e.Bb(h);this.xf=!1;h=this.Dc;h.remove(a);tw(this,e,g,f,1);a={Db:[c[0],b],za:d,geometry:e,depth:f,index:g};h.Bc(Hf(a.Db),a);this.$e.push([a,
1]);b={Db:[b,c[1]],za:d,geometry:e,depth:f,index:g+1};h.Bc(Hf(b.Db),b);this.$e.push([b,0]);this.Uo=!0};function tw(a,b,c,d,e){ul(a.Dc,b.W(),function(a){a.geometry===b&&(void 0===d||void 0===a.depth||Ke(a.depth,d))&&a.index>c&&(a.index+=e)})}function lw(){var a=In();return function(){return a.Point}}function ow(a,b){Dd.call(this,a);this.features=b}E(ow,Dd);function vw(a){ji.call(this,{handleEvent:ww});a=a?a:{};this.ld=a.Vb?a.Vb:ti;this.TB=a.SB?a.SB:gg;this.sI=a.rI?a.rI:gg;this.iK=a.hK?a.hK:vi;this.Ny=a.jH?a.jH:!1;this.Yw=a.filter?a.filter:fg;this.To=a.jh?a.jh:0;this.Gl=new Mo({source:new ao({Ph:!1,features:a.features,ib:a.ib}),style:a.style?a.style:xw(),mj:!0,nj:!0});if(a.rb)if("function"===typeof a.rb)a=a.rb;else{var b=a.rb;a=function(a){return 0<=b.indexOf(a)}}else a=fg;this.gp=a;this.Fl={};a=this.Gl.v().Cb;J(a,"add",this.bl,this);J(a,"remove",this.Rp,
this)}E(vw,ji);l=vw.prototype;l.wa=function(){return this.Gl.v().Cb};l.Ac=function(a){a=I(a);return this.Fl[a]};
function ww(a){if(!this.ld(a))return!0;var b=this.TB(a),c=this.sI(a),d=this.iK(a),e=!b&&!c&&!d,f=a.map,g=this.Gl.v().Cb,h=[],k=[];if(e){qd(this.Fl);$l(f,a.Yc,function(a,b){if(this.Yw(a,b))return k.push(a),a=I(a),this.Fl[a]=b,!this.Ny}.bind(this),{fp:this.gp,jh:this.To});for(e=g.Xb()-1;0<=e;--e){var f=g.item(e),m=k.indexOf(f);-1<m?k.splice(m,1):(g.remove(f),h.push(f))}0!==k.length&&g.extend(k)}else{$l(f,a.Yc,function(a,e){if(this.Yw(a,e))return!b&&!d||0<=g.R().indexOf(a)?(c||d)&&0<=g.R().indexOf(a)&&
(h.push(a),e=I(a),delete this.Fl[e]):(k.push(a),a=I(a),this.Fl[a]=e),!this.Ny}.bind(this),{fp:this.gp,jh:this.To});for(e=h.length-1;0<=e;--e)g.remove(h[e]);g.extend(k)}(0<k.length||0<h.length)&&this.dispatchEvent(new yw(zw,k));return si(a)}l.cb=function(a){var b=this.g(),c=this.Gl.v().Cb;b&&c.forEach(b.ZA,b);ji.prototype.cb.call(this,a);this.Gl.cb(a);a&&c.forEach(a.qA,a)};
function xw(){var a=In();Ie(a.Polygon,a.LineString);Ie(a.GeometryCollection,a.LineString);return function(b){return b.j()?a[b.j().K()]:null}}l.bl=function(a){var b=this.g();b&&b.qA(a.element)};l.Rp=function(a){var b=this.g();b&&b.ZA(a.element)};function yw(a,b){Dd.call(this,a);this.selected=b}E(yw,Dd);var zw="select";function Aw(){A.log("nsVmap.nsToolsManager.Measure")}pa("nsVmap.nsToolsManager.Measure",Aw);fv.Measure=Aw;Aw.prototype.SG=function(){A.log("nsVmap.nsToolsManager.Measure.prototype.measureDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppmeasureController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/tools/measure.html"}};
Aw.prototype.Ya=function(){A.log("nsVmap.nsToolsManager.Measure.prototype.measureController");var a=this;this.pn=new hg(6378137);this.S=A.g().H;var b=new Dn({fill:new Cn({color:"rgba(255, 255, 255, 0.2)"}),stroke:new gl({color:"#ffcc33",width:2}),Lb:new Bn({tb:7,fill:new Cn({color:"#ffcc33"}),stroke:new gl({color:"#FFFFFF"})})});this.pt=To(A.g(),{style:b});this.ik=this.pt.v().Cb;this.Qo=new Uo({id:"measure-tooltip"});this.xh=new gw({features:this.ik});this.Ie=new vw({rb:[this.pt],Vb:si});this.Ic=
new vw({rb:[this.pt]});this.projection=D(this.map).D().V;this.oProjections=A.oProjections;this.transform=Rg;this.map.on("change:view",function(){a.projection=D(a.map).D().V});this.Ic.on("select",function(){for(var a=this.Ic.wa().R(),b,e,f=a.length-1;0<=f;f--){b=A.g().H.Xc.R();e=[];for(var g=b.length-1;0<=g;g--)b[g].get("feature")!==a[f]&&"info"!==b[g].get("feature")||e.push(b[g]);for(g=e.length-1;0<=g;g--)A.g().H.Xc.remove(e[g]);this.ik.remove(a[f])}this.Ic.wa().clear();this.Ie.wa().clear()},this);
this.vi=document.getElementById("geodesic")};Aw.prototype.measureController=Aw.prototype.Ya;function Bw(a,b){a.ed&&a.ed.parentNode.removeChild(a.ed);a.ed=document.createElement("div");a.ed.className="measure-tooltip measure-tooltip-measure";a.Si=new Zo({element:a.ed,offset:[0,-15],pk:"bottom-center"});a.Si.set("type","measure");void 0!==b&&a.Si.set("feature",b);a.S.eg(a.Si)}
function Cw(a,b){a.vh&&a.vh.parentNode.removeChild(a.vh);a.vh=document.createElement("div");a.vh.className="measure-tooltip measure-tooltip-measure";a.yp=new Zo({element:a.vh,offset:[0,-15],pk:"bottom-center"});a.yp.set("type","measure");void 0!==b&&a.yp.set("feature",b);A.g().eg(a.yp)}l=Aw.prototype.Ya.prototype;
l.bc=function(a){A.log("addInteraction");var b=this;this.nc=A.g().Jg({type:a,features:this.ik},"basicTools-measure"+a);Bw(this,"info");this.nc.on("drawstart",function(a){Cw(this,a.za);this.nq=a.za;var c=a.Qb;b.listener=this.nq.j().on("change",function(a){a=a.target;var d;a instanceof zh?(d=b.oo(a),c=Ch(a).ca()):a instanceof xp?(d=b.Df(a),c=$g(a)):a instanceof Ov&&(d=b.Lj(a),c=$g(a));b.vh.innerHTML=d;b.yp.setPosition(c)})},this);this.nc.on("drawend",function(a){Bw(this,a.za);this.hj(a.za);this.ed.innerHTML=
b.vh.innerHTML;this.vh.style.display="none";this.ed.className="measure-tooltip measure-tooltip-static";ep(this.Si,[.8,-13]);this.Si.setPosition(this.Di(a.za.j()));this.ed=this.nq=null;this.Gk();Dw(this,a.za);this.ed&&(this.ed.className="measure-tooltip measure-tooltip-static",this.ed.remove(),ep(this.Si,[0,-7]),this.ed=this.nq=null);a.za.on("change",function(){Dw(this,a.za)},this);Hd(b.listener)},this)};
function Dw(a,b,c){A.log("nsVmap.nsToolsManager.Measure.prototype.measureController.prototype.updateTooltip");(n(c)?c:1)&&a.hj(b);c=A.g().H.Xc;for(var d=c.R().length-1;0<=d;d--)if(c.R()[d].get("feature")===b)if(c.R()[d].setPosition(a.Di(b.j())),"Ligne"===b.get("Type"))Qo(c.R()[d]).innerHTML=b.get("Longueur");else if("Polygone"===b.get("Type"))Qo(c.R()[d]).innerHTML=b.get("Superficie");else if("Cercle"===b.get("Type"))Qo(c.R()[d]).innerHTML=b.get("Perim\u00e8tre");else if("Point"===b.get("Type")){var e=
Rg(b.get("Coordonn\u00e9es"),a.projection,b.get("Projection")),f,g=document.createElement("select"),h;for(h in a.oProjections)f=document.createElement("option"),f.value=h,f.innerHTML=A.oProjections[h],g.appendChild(f);g.value=b.get("Projection");f=document.createElement("div");f.innerHTML="X = "+parseFloat(e[0]).toPrecision(9);f.innerHTML+="<br>";f.innerHTML+="Y = "+parseFloat(e[1]).toPrecision(9);var k=a;g.onchange=function(){b.set("Projection",this.value);Dw(k,b,!1)};$(Qo(c.R()[d])).empty();Qo(c.R()[d]).appendChild(g);
Qo(c.R()[d]).appendChild(f)}}
l.hj=function(a){if(a.j()instanceof rh)a.set("Type","Point"),a.set("Coordonn\u00e9es",this.ix(a.j())),a.set("Projection",D(this.map).D().V);else if(a.j()instanceof xp)a.set("Type","Ligne"),a.set("Longueur",this.Df(a.j())),a.set("Projection",D(this.map).D().V);else if(a.j()instanceof zh)a.set("Type","Polygone"),a.set("Perim\u00e8tre",this.as(a.j())),a.set("Superficie",this.oo(a.j())),a.set("Projection",D(this.map).D().V);else if(a.j()instanceof Ov){var b=parseFloat(this.Lj(a.j())),c=this.Lj(a.j()).replace(b,
""),d=2*b,e=Math.PI*b*2,f=Math.PI*Math.pow(b,2);a.set("Type","Cercle");a.set("Rayon",b+c);a.set("Diam\u00e8tre",d.toFixed(4)+c);a.set("Perim\u00e8tre",e.toFixed(4)+c);a.set("Superficie",f.toFixed(4)+c+"\u00b2");a.set("Centre",[a.j().La()[0].toFixed(4),a.j().La()[1].toFixed(4)]);a.set("Projection",D(this.map).D().V)}else a.set("Type","undefined");b=this.ik.Xb()-1;a.set("Id",b);a.set("Keys",a.Co())};
l.Di=function(a){if("Polygon"===a.K())a=$g(Ch(a));else if("LineString"===a.K())a=$g(a);else if("Circle"===a.K())a=a.La();else if("Point"===a.K())a=$g(a);else return $g(a);return a};l.Df=function(a){this.vi.checked&&"EPSG:3857"===D(this.S).D().V||"EPSG:4326"===D(this.S).D().V?(a=a.ca(),a=this.hl(a)):a=a.Xb();return 1E3<a?Math.round(a/1E3*100)/100+" km":Math.round(100*a)/100+" m"};
l.hl=function(a){length=0;for(var b=D(this.S).D(),c=0,d=a.length-1;c<d;++c){var e=Rg(a[c],b,"EPSG:4326"),f=Rg(a[c+1],b,"EPSG:4326");length+=jg(this.pn,e,f)}return length};l.ix=function(a){return[a.ca()[0].toPrecision(9),a.ca()[1].toPrecision(9)]};l.Lj=function(a){this.vi.checked&&"EPSG:3857"===D(this.S).D().V||"EPSG:4326"===D(this.S).D().V?(a=[Zg(a),$g(a)],a=this.hl(a)):a=Math.round(100*a.bf())/100;return 1E3<a?Math.round(a/1E3*100)/100+" km":Math.round(100*a)/100+" m"};
l.as=function(a){a=new xp(a.ca()[0],a.Ua);return this.Df(a)};l.oo=function(a){if(this.vi.checked&&"EPSG:3857"===D(this.S).D().V||"EPSG:4326"===D(this.S).D().V){var b=D(this.S).D();a=Dh(a.clone().transform(b,"EPSG:4326")).ca();a=Math.abs(ig(this.pn,a))}else a=a.Nj();return 1E6<a?Math.round(a/1E6*100)/100+" km\u00b2":Math.round(100*a)/100+" m\u00b2"};
l.rn=function(a){A.log("nsVmap.nsToolsManager.Measure.prototype.measureController.zoomToFeature");"Point"===a.get("Type")?D(this.S).ub(a.j().ca()):"Cercle"===a.get("Type")?(Th(D(this.S),a.j(),{padding:[0,0,0,0]}),D(this.S).ub(a.j().La())):Th(D(this.S),a.j(),{padding:[0,0,0,0]})};Aw.prototype.Ya.prototype.zoomToFeature=Aw.prototype.Ya.prototype.rn;
Aw.prototype.Ya.prototype.Gk=function(){A.log("nsVmap.nsToolsManager.Measure.prototype.measureController.showHideAnotations");document.getElementById("measure-anotations").checked?$(".measure-tooltip-static").show():$(".measure-tooltip-static").hide()};Aw.prototype.Ya.prototype.showHideAnotations=Aw.prototype.Ya.prototype.Gk;
Aw.prototype.Ya.prototype.bh=function(a){A.log("nsVmap.nsToolsManager.Measure.prototype.measureController.drawPoint");this.Ah();a||(A.g().Ea.Ra("Cliquer pour mesurer l'emplacement d'un point"),this.bc("Point"))};Aw.prototype.Ya.prototype.drawPoint=Aw.prototype.Ya.prototype.bh;Aw.prototype.Ya.prototype.TG=function(a){A.log("nsVmap.nsToolsManager.Measure.prototype.measureController.measureLine");this.Ah();a||(A.g().Ea.Ra("Cliquer pour commencer \u00e0 mesurer"),this.bc("LineString"))};
Aw.prototype.Ya.prototype.measureLine=Aw.prototype.Ya.prototype.TG;Aw.prototype.Ya.prototype.UG=function(a){A.log("nsVmap.nsToolsManager.Measure.prototype.measureController.measurePolygon");this.Ah();a||(A.g().Ea.Ra("Cliquer pour commencer \u00e0 mesurer"),this.bc("Polygon"))};Aw.prototype.Ya.prototype.measurePolygon=Aw.prototype.Ya.prototype.UG;
Aw.prototype.Ya.prototype.RG=function(a){A.log("nsVmap.nsToolsManager.Measure.prototype.measureController.measureCircle");this.Ah();a||(A.g().Ea.Ra("Cliquer pour commencer \u00e0 mesurer"),this.bc("Circle"))};Aw.prototype.Ya.prototype.measureCircle=Aw.prototype.Ya.prototype.RG;Aw.prototype.Ya.prototype.kt=function(a){A.log("nsVmap.nsToolsManager.Measure.prototype.measureController.modifyFeature");this.Ah();a||(A.g().Ea.Ra("Cliquer sur une mesure pour la modifier"),Po(A.g(),this.xh,"basicTools-modifyMeasure"))};
Aw.prototype.Ya.prototype.modifyFeature=Aw.prototype.Ya.prototype.kt;Aw.prototype.Ya.prototype.Jr=function(a){A.log("nsVmap.nsToolsManager.Measure.prototype.measureController.deleteFeature");this.Ah();a||(Po(A.g(),this.Ic,"basicTools-deleteMeasure"),A.g().Ea.Ra("Cliquer sur une mesure pour la supprimer"))};Aw.prototype.Ya.prototype.deleteFeature=Aw.prototype.Ya.prototype.Jr;
Aw.prototype.Ya.prototype.Ir=function(){A.log("nsVmap.nsToolsManager.Measure.prototype.measureController.deleteAllFeatures");this.Ah();this.ik.clear();for(var a=A.g().H.Xc.R(),b=[],c=a.length-1;0<=c;c--)"measure"===a[c].get("type")&&b.push(a[c]);for(c=b.length-1;0<=c;c--)A.g().H.Xc.remove(b[c])};Aw.prototype.Ya.prototype.deleteAllFeatures=Aw.prototype.Ya.prototype.Ir;
Aw.prototype.Ya.prototype.Ah=function(){A.log("nsVmap.nsToolsManager.Measure.prototype.measureController.removeMeasuresInteractions");this.ed&&(this.ed.className="measure-tooltip measure-tooltip-static",this.ed.remove(),ep(this.Si,[0,-7]),this.ed=this.nq=null);A.g().Ea.hide();A.g().Ge()};Aw.prototype.Ya.prototype.removeMeasuresInteractions=Aw.prototype.Ya.prototype.Ah;
Aw.prototype.Ya.prototype.nD=function(){A.log("nsVmap.nsToolsManager.Measure.prototype.measureController.displayFeatures");this.sketches=this.ik.R();for(var a="",b,c=0;c<this.sketches.length;c++){b=this.sketches[c];var d=this.sketches[c],e=[];if("Ligne"===d.get("Type")||"Polygone"===d.get("Type")){e=[];e.keys="Points Coordonn\u00e9es Longueur-segment Longueur-totale Delta-x Delta-y Angle/Nord".split(" ");for(var f="Polygone"===d.get("Type")?d.j().ca()[0]:d.j().ca(),g=0,h=0,k=0,m=0,p=0,t=[],v=0;v<
f.length;v++)e[v]={},e[v].Points=v+1,e[v]["Coordonn\u00e9es"]=f[v],t.push(f[v]),0!==v&&(m=new xp([f[v-1],f[v]],d.j().Ua),g=this.Df(m),m=new xp(t,d.j().Ua),h=this.Df(m),m=new xp([[f[v-1][0],0],[f[v][0],0]],d.j().Ua),k=this.Df(m),f[v][0]<f[v-1][0]&&(k="-"+k),m=new xp([[0,f[v-1][1]],[0,f[v][1]]],d.j().Ua),m=this.Df(m),f[v][1]<f[v-1][1]&&(m="-"+m),p=180/Math.PI*Math.atan2(f[v][1]-f[v-1][1],f[v][0]-f[v-1][0]),p=90-p,0>p&&(p=360- -1*p),p=p.toFixed(2)+"\u00b0"),e[v]["Longueur-segment"]=g,e[v]["Longueur-totale"]=
h,e[v]["Delta-x"]=k,e[v]["Delta-y"]=m,e[v]["Angle/Nord"]=p}b.Points=e;b=this.sketches[c].Co();d={};for(e=0;e<b.length;e++)"geometry"!==b[e]&&"Keys"!==b[e]&&(d[b[e]]=this.sketches[c].get(b[e]));d=[d];b=JSON.stringify(d);b=A.bv(b);a+=b+"\n";b=JSON.stringify(this.sketches[c].Points);b=A.bv(b);a+=b+"\n\n"}a="data:text/csv;charset=utf-8,"+encodeURIComponent(a);$("#export-csv-button").attr("href",a)};Aw.prototype.Ya.prototype.displayFeatures=Aw.prototype.Ya.prototype.nD;
A.module.directive("appMeasure",Aw.prototype.SG);A.module.controller("AppmeasureController",Aw.prototype.Ya);function Ew(){A.log("nsVmap.nsToolsManager.BasicSelect")}pa("nsVmap.nsToolsManager.BasicSelect",Ew);Ew.prototype.CC=function(){A.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppBasicselectController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/tools/basicselect.html"}};
Ew.prototype.sb=function(a,b,c){function d(){e.b.$applyAsync(function(){e.oQueryableBOs=A.qa.sg(!0);e.aQueryableBOs=A.qa.xx(!0);e.aBusinessObjectsList=Object.keys(e.oQueryableBOs);if(null==e.oQueryableBOs[e.sSelectedBo]){var a=1E6,b="",c;for(c in e.oQueryableBOs)e.oQueryableBOs[c].bo_index<a&&(a=e.oQueryableBOs[c].bo_index,b=e.oQueryableBOs[c].bo_id);e.sSelectedBo=b}})}A.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController");var e=this;a.vmapScope=A.scope;this.b=a;this.$timeout_=
b;this.Ja=c;this.Uc=c.defer();this.qc=A.F.Mc.st;this.properties=A.properties;this.token=A.properties.token;this.bt=A.properties.selection.limit_popup;this.limitList_=A.properties.selection.limit_list;this.allQueryables_=!1;this.aSelections=[];this.uj=[];this.tableSelection={};this.sSelectedBo="";this.oQueryableBOs={};this.aBusinessObjectsList=[];A.scope.$on("layersChanged",function(){d()});setTimeout(function(){d()});this.map.on("click",function(a){if(""===A.g().px()){a=new rh(a.Qb);var b=A.pg(a);
A.F.Mc.Zf();this.Hg(b,a)}},this);A.scope.$on("toggleOutTools",function(){e.Uc.resolve()});$(document).keydown(function(a){27===a.keyCode&&e.Uc.resolve()});A.scope.$on("mapChanged",function(){e.Up()})};Ew.prototype.basicSelectController=Ew.prototype.sb;Ew.prototype.sb.$inject=["$scope","$timeout","$q"];
Ew.prototype.sb.prototype.Hg=function(a,b,c){A.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.queryByEWKTGeom");var d=this;this.cg=a;this.Zy=b;$("body").css({cursor:"wait"});this.Uc.resolve();this.Uc=this.Ja.defer();c=null!=c?c:this.sSelectedBo;null!=this.oQueryableBOs[c]?this.qc.Hg({ur:c,cg:a,Kn:this.Uc,gn:!1,buffer:this.oQueryableBOs[c].bo_selection_buffer,mb:function(a){$("body").css({cursor:""});d.Yt(a,b)}}):$("body").css({cursor:""})};
Ew.prototype.sb.prototype.Te=function(a){A.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.addQueryResult");var b=this,c=n(a.mb)?a.mb:function(){return 0};this.qc.Te({data:n(a.data)?a.data:[],selection:this.aSelections,dataType:n(a.dataType)?a.dataType:null,mb:function(a){b.aSelections=a;c.call()}})};
Ew.prototype.sb.prototype.Yt=function(a,b){A.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.replaceSelectionPopup");for(var c=this,d=a.length-1;0<=d;d--){var e=!1;null!=a[d].bo_intersect_geom||null!=a[d].olFeature||(e=!0);null==a[d].olFeature||null==a[d].olFeature.j()&&(e=!0);e&&($.notify("L'objet s\u00e9lectionn\u00e9 ("+a[d].bo_id_field+" = "+a[d].bo_id_value+") n'a pas de g\u00e9om\u00e9trie"),a.splice(d,1))}0!==a.length&&(d=Va(this.aSelections),Wa(this.uj,d),
this.Up(),c.Te({data:a,dataType:"summary",mb:function(){Nv(c,c.uj);c.Zn(c.aSelections,b)}}))};Ew.prototype.sb.prototype.replaceSelectionPopup=Ew.prototype.sb.prototype.Yt;
Ew.prototype.sb.prototype.Zn=function(a,b){A.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.displaySelectionPopup");for(var c=this.b,d=0;d<a.length;d++){n(a[d].mapPopup)&&a[d].mapPopup.remove(!1);null!=a[d].olFeature.j().K&&"Point"===a[d].olFeature.j().K()&&(b=a[d].olFeature.j());a[d].mapPopup=new hp(a[d].olFeature,b);a[d].mapPopup.Uh.selection=a[d];a[d].mapPopup.Uh.addEventListener("click",function(){this.selection.locked=!1},!0);if("true"===a[d].have_update_rights||
!0===a[d].have_update_rights)a[d].mapPopup.rj=document.createElement("a"),a[d].mapPopup.rj.href="#",a[d].mapPopup.rj.className="ol-popup-edit icon-draw",a[d].mapPopup.Th.appendChild(a[d].mapPopup.rj),a[d].mapPopup.rj.scope=this.b,a[d].mapPopup.rj.selection=a[d],a[d].mapPopup.rj.addEventListener("click",function(){var a=this.selection;c.$apply(function(){c.ctrl.nd(a)})},!0);if("true"===a[d].have_card_rights||!0===a[d].have_card_rights)a[d].mapPopup.qj=document.createElement("a"),a[d].mapPopup.qj.href=
"#",a[d].mapPopup.qj.className="ol-popup-card glyphicon glyphicon-file",a[d].mapPopup.Th.appendChild(a[d].mapPopup.qj),a[d].mapPopup.qj.scope=this.b,a[d].mapPopup.qj.selection=a[d],a[d].mapPopup.qj.addEventListener("click",function(){var a=this.selection;c.$apply(function(){c.ctrl.se(a)})},!0);a[d].mapPopup.Ra("<b>"+a[d].bo_title+":</b>");jp(a[d].mapPopup,a[d].bo_summary);n(a[d].bo_image_path)&&a[d].mapPopup.rv(a[d].bo_image_path);"true"!==a[d].have_update_rights&&!0!==a[d].have_update_rights||a[d].mapPopup.$k({content:'<span class="icon-polygon"></span> Modifier la g\u00e9om\u00e9trie',
event:function(){c.$apply(function(){c.ctrl.mg(c.ctrl.aSelections[0])})}});"true"!==a[d].have_delete_rights&&!0!==a[d].have_delete_rights||a[d].mapPopup.$k({content:'<span class="icon-trash"></span> Supprimer l\'objet',event:function(){c.$apply(function(){c.ctrl.re(c.ctrl.aSelections[0])})}});a[d].mapPopup.$k({content:'<span class="icon-shopping_basket"></span> Ajouter au panier',event:function(){c.$apply(function(){c.ctrl.pe(c.ctrl.aSelections[0])})}});if(!1!==A.properties.selection.street_view){var e=
Zg(a[d].olFeature.j()),f=D(this.map).D().V,e=Rg(e,f,"EPSG:4326"),g="http://maps.google.com/maps?q=&layer=c&cbll="+e[1]+","+e[0]+"";a[d].mapPopup.$k({content:'<span class="icon-street-view"></span> Google Street View',event:function(){window.open(g,"_blank").focus()}})}}Pa(this.aSelections,a);this.aSelections=this.qc.zm(this.aSelections)};Ew.prototype.sb.prototype.se=function(a){A.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.displayObjectCard");this.qc.se(a)};
Ew.prototype.sb.prototype.displayObjectCard=Ew.prototype.sb.prototype.se;Ew.prototype.sb.prototype.nd=function(a){A.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.displayEditFrom");var b=this,c=angular.copy(a.bo_type);this.qc.nd(a,function(){b.Hg(b.cg,b.Zy,c)})};Ew.prototype.sb.prototype.displayEditFrom=Ew.prototype.sb.prototype.nd;
Ew.prototype.sb.prototype.mg=function(a){A.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.editFeature");Nv(this);this.qc.mg(a)};Ew.prototype.sb.prototype.editFeature=Ew.prototype.sb.prototype.mg;Ew.prototype.sb.prototype.re=function(a){A.log("nsVmap.nsToolsManager.BasicSelect.basicSelectController.deleteObject");var b=this;this.qc.re(a,function(){Nv(b);b.Tp(a)})};Ew.prototype.sb.prototype.deleteObject=Ew.prototype.sb.prototype.re;
Ew.prototype.sb.prototype.Up=function(){A.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.removePopups");Nv(this);this.vk()};Ew.prototype.sb.prototype.removePopups=Ew.prototype.sb.prototype.Up;Ew.prototype.sb.prototype.vk=function(a){A.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.removeSelections");for(var b=this.aSelections.length-1;0<=b;b--)null!=a?this.aSelections[b].bo_type===a&&Ra(this.aSelections,b):Ra(this.aSelections,b)};
Ew.prototype.sb.prototype.Tp=function(a){for(var b=this.aSelections.length-1;0<=b;b--)angular.equals(this.aSelections[b],a)&&this.aSelections.splice(b,1)};function Nv(a,b){A.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.closeSelectionPopup");b=null!=b?b:a.aSelections;for(a=0;a<b.length;a++)n(b[a].mapPopup)&&b[a].mapPopup.remove()}
Ew.prototype.sb.prototype.pe=function(a){A.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.tableAddToCard");this.qc.pe([a])};Ew.prototype.sb.prototype.addToCard=Ew.prototype.sb.prototype.pe;A.module.directive("appBasicselect",Ew.prototype.CC);A.module.controller("AppBasicselectController",Ew.prototype.sb);function kd(a){a=a?a:{};np.call(this);this.EJ=void 0!==a.uA?a.uA:!1}E(kd,Rs);function Fw(a){a=a.ca();return 0===a.length?"":a.join(" ")}function Gw(a){a=a.ca();for(var b=[],c=0,d=a.length;c<d;++c)b.push(a[c].join(" "));return b.join(",")}function Hw(a){var b=[];a=Eh(a);for(var c=0,d=a.length;c<d;++c)b.push("("+Gw(a[c])+")");return b.join(",")}
function Iw(a){var b=a.K(),c=(0,Jw[b])(a),b=b.toUpperCase();if(a instanceof Xg){a=a.Ua;var d="";if("XYZ"===a||"XYZM"===a)d+="Z";if("XYM"===a||"XYZM"===a)d+="M";a=d;0<a.length&&(b+=" "+a)}return 0===c.length?b+" EMPTY":b+"("+c+")"}
var Jw={Point:Fw,LineString:Gw,Polygon:Hw,MultiPoint:function(a){var b=[];a=a.Bi();for(var c=0,d=a.length;c<d;++c)b.push("("+Fw(a[c])+")");return b.join(",")},MultiLineString:function(a){var b=[];a=Zk(a);for(var c=0,d=a.length;c<d;++c)b.push("("+Gw(a[c])+")");return b.join(",")},MultiPolygon:function(a){var b=[];a=Kl(a);for(var c=0,d=a.length;c<d;++c)b.push("("+Hw(a[c])+")");return b.join(",")},GeometryCollection:function(a){var b=[];a=vp(a.Rb);for(var c=0,d=a.length;c<d;++c)b.push(Iw(a[c]));return b.join(",")}};
l=kd.prototype;l.qz=function(a,b){return(a=this.Pp(a,b))?(b=new So,b.$c(a),b):null};l.sz=function(a,b){a=this.Pp(a,b);a=this.EJ&&"GeometryCollection"==a.K()?a.Rb:[a];for(var c=[],d=0,e=a.length;d<e;++d)b=new So,b.$c(a[d]),c.push(b);return c};l.Pp=function(a,b){return(a=(new Kw(new Lw(a))).parse())?qp(a,!1,b):null};l.Ru=function(a,b){return(a=a.j())?this.Rq(a,b):""};
l.BB=function(a,b){if(1==a.length)return this.Ru(a[0],b);for(var c=[],d=0,e=a.length;d<e;++d)c.push(a[d].j());a=new tp(c);return this.Rq(a,b)};l.Rq=function(a,b){return Iw(qp(a,!0,b))};function Lw(a){this.Uk=a;this.kh=-1}
function Mw(a){var b=a.Uk.charAt(++a.kh),c={position:a.kh,value:b};if("("==b)c.type=2;else if(","==b)c.type=5;else if(")"==b)c.type=3;else if("0"<=b&&"9">=b||"."==b||"-"==b){c.type=4;var d,b=a.kh,e=!1,f=!1;do{if("."==d)e=!0;else if("e"==d||"E"==d)f=!0;d=a.Uk.charAt(++a.kh)}while("0"<=d&&"9">=d||"."==d&&(void 0===e||!e)||!f&&("e"==d||"E"==d)||f&&("-"==d||"+"==d));a=parseFloat(a.Uk.substring(b,a.kh--));c.value=a}else if("a"<=b&&"z">=b||"A"<=b&&"Z">=b){c.type=1;b=a.kh;do d=a.Uk.charAt(++a.kh);while("a"<=
d&&"z">=d||"A"<=d&&"Z">=d);a=a.Uk.substring(b,a.kh--).toUpperCase();c.value=a}else{if(" "==b||"\t"==b||"\r"==b||"\n"==b)return Mw(a);if(""===b)c.type=6;else throw Error("Unexpected character: "+b);}return c}function Kw(a){this.by=a;this.at="XY"}function Nw(a){a.$f=Mw(a.by)}l=Kw.prototype;l.match=function(a){(a=this.$f.type==a)&&Nw(this);return a};l.parse=function(){Nw(this);return Ow(this)};
function Ow(a){var b=a.$f;if(a.match(1)){var b=b.value,c="XY",d=a.$f;1==a.$f.type&&(d=d.value,"Z"===d?c="XYZ":"M"===d?c="XYM":"ZM"===d&&(c="XYZM"),"XY"!==c&&Nw(a));a.at=c;if("GEOMETRYCOLLECTION"==b){a:{if(a.match(2)){b=[];do b.push(Ow(a));while(a.match(5));if(a.match(3)){a=b;break a}}else if(Pw(a)){a=[];break a}throw Error(Qw(a));}return new tp(a)}d=Rw[b];c=Sw[b];if(!d||!c)throw Error("Invalid geometry type: "+b);b=d.call(a);return new c(b,a.at)}throw Error(Qw(a));}
l.Ct=function(){if(this.match(2)){var a=Tw(this);if(this.match(3))return a}else if(Pw(this))return null;throw Error(Qw(this));};l.At=function(){if(this.match(2)){var a=Uw(this);if(this.match(3))return a}else if(Pw(this))return[];throw Error(Qw(this));};l.Dt=function(){if(this.match(2)){var a=Vw(this);if(this.match(3))return a}else if(Pw(this))return[];throw Error(Qw(this));};
l.HH=function(){if(this.match(2)){var a;if(2==this.$f.type)for(a=[this.Ct()];this.match(5);)a.push(this.Ct());else a=Uw(this);if(this.match(3))return a}else if(Pw(this))return[];throw Error(Qw(this));};l.GH=function(){if(this.match(2)){var a=Vw(this);if(this.match(3))return a}else if(Pw(this))return[];throw Error(Qw(this));};l.IH=function(){if(this.match(2)){for(var a=[this.Dt()];this.match(5);)a.push(this.Dt());if(this.match(3))return a}else if(Pw(this))return[];throw Error(Qw(this));};
function Tw(a){for(var b=[],c=a.at.length,d=0;d<c;++d){var e=a.$f;if(a.match(4))b.push(e.value);else break}if(b.length==c)return b;throw Error(Qw(a));}function Uw(a){for(var b=[Tw(a)];a.match(5);)b.push(Tw(a));return b}function Vw(a){for(var b=[a.At()];a.match(5);)b.push(a.At());return b}function Pw(a){var b=1==a.$f.type&&"EMPTY"==a.$f.value;b&&Nw(a);return b}function Qw(a){return"Unexpected `"+a.$f.value+"` at position "+a.$f.position+" in `"+a.by.Uk+"`"}
var Sw={POINT:rh,LINESTRING:xp,POLYGON:zh,MULTIPOINT:Bp,MULTILINESTRING:yp,MULTIPOLYGON:Ep},Rw={POINT:Kw.prototype.Ct,LINESTRING:Kw.prototype.At,POLYGON:Kw.prototype.Dt,MULTIPOINT:Kw.prototype.HH,MULTILINESTRING:Kw.prototype.GH,MULTIPOLYGON:Kw.prototype.IH};function Ww(){A.log("nsVmap.nsToolsManager.AdvancedSelect")}pa("nsVmap.nsToolsManager.AdvancedSelect",Ww);Ww.prototype.IB=function(){A.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppAdvancedselectController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/tools/advancedselect.html"}};
Ww.prototype.Za=function(a,b,c){A.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController");var d=this;a.vmapScope=A.scope;this.b=a;this.$timeout_=b;this.Ja=c;this.Uc=c.defer();this.qc=A.F.Mc.st;this.properties=A.properties;this.token=A.properties.token;this.selectGeomType="Polygon";this.bt=A.properties.selection.limit_popup;this.limitList_=A.properties.selection.limit_list;this.In=A.properties.selection.buffer;this.Ay=A.properties.selection.max_buffer;this.allQueryables_=!1;
this.aSelections=[];this.uj=[];this.tableSelection={};this.oQueryableBOs=A.qa.sg();this.aBusinessObjectsList=[];this.oBusinessObjects={};this.zq={};A.scope.$on("layersChanged",function(){d.b.$applyAsync(function(){d.oQueryableBOs=A.qa.sg();Na(d.aBusinessObjectsList);for(var a in d.oQueryableBOs)d.aBusinessObjectsList.push(a)})});Na(d.aBusinessObjectsList);for(var e in d.oQueryableBOs)d.aBusinessObjectsList.push(e);$(document).keydown(function(a){27===a.keyCode&&d.Uc.resolve()});A.scope.$on("mapChanged",
function(){d.vk()})};Ww.prototype.AdvancedSelectController=Ww.prototype.Za;Ww.prototype.Za.$inject=["$scope","$timeout","$q"];
Ww.prototype.Za.prototype.GJ=function(a,b){A.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.startSelection");A.g().Ge();A.g().Ea.hide();if(!0===b)return 0;if("Point"===a)b="Cliquez sur un point pour effectuer la s\u00e9lection",A.g().Ea.Ra(b),Xw(this,a);else if("LineString"===a)b="Dessinez une ligne pour effectuer la s\u00e9lection",A.g().Ea.Ra(b),Xw(this,a);else if("Polygon"===a)b="Dessinez un polygone pour effectuer la s\u00e9lection",A.g().Ea.Ra(b),Xw(this,
a);else if("Circle"===a)b="Dessinez un cercle pour effectuer la s\u00e9lection",A.g().Ea.Ra(b),Xw(this,a);else return console.error("startSelection: type ("+a+") not allowed"),0};Ww.prototype.Za.prototype.startSelection=Ww.prototype.Za.prototype.GJ;Ww.prototype.Za.prototype.KC=function(){A.g().Ge();A.g().Ea.hide()};Ww.prototype.Za.prototype.cancelSelection=Ww.prototype.Za.prototype.KC;
function Xw(a,b){A.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.queryByDrawing");a.au=D(a.map).D().V;new Gp({yc:a.au});a.nc=A.g().Jg({type:b},"basicTools-selectBy"+b);a.nc.on("drawend",function(a){a=a.za;"Circle"===b&&(a=a.j(),a=new Gh(a),a=new So({geometry:a}));a=A.pg(a.j());this.Hg(a,!0,!0)},a)}
Ww.prototype.Za.prototype.Hg=function(a){A.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.queryByEWKTGeom");var b=this;this.cg=a;var c=A.qa.sg();this.Zc=Object.keys(c).length;0<this.Zc&&$("body").css({cursor:"wait"});var d=Va(this.aSelections);Wa(this.uj,d);this.vk();this.Uc.resolve();this.Uc=this.Ja.defer();for(var e in c)this.qc.Hg({ur:e,cg:a,Kn:this.Uc,gn:!0,buffer:c[e].bo_selection_buffer,mb:function(a){b.Zc--;0===b.Zc&&$("body").css({cursor:""});b.zq={};
b.Te({data:a,dataType:"list",mb:function(){0===b.Zc&&b.wl(b.aSelections)}},function(a){console.error(a);$("body").css({cursor:""});b.Zc--;b.Te({data:[],dataType:"list",mb:function(){0===b.Zc&&b.wl(b.aSelections)}})})}})};
Ww.prototype.Za.prototype.Te=function(a){A.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.addQueryResult");var b=n(a.data)?a.data:[];a=n(a.mb)?a.mb:function(){return 0};for(var c=[],d=0;d<b.length;d++)c.push(b[d]),n(b[d].bo_intersect_geom)&&(c[d].olFeature=this.qc.ko(b[d]));Pa(this.aSelections,c);this.aSelections=this.qc.zm(this.aSelections);a.call()};
Ww.prototype.Za.prototype.Zn=function(a){A.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.displaySelectionPopup");a=[a];var b=angular.element($("#vmap-basicselect-tool")).scope();this.qc.Pl(a,function(a){if(null==a[0].olFeature||null==a[0].olFeature.j())return $.notify("L'objet n'a pas de g\u00e9om\u00e9trie"),0;if(null!=a[0]&&null!=a[0].olFeature){var c=a[0].olFeature.j(),e=A.pg(c);b.ctrl.cg=e;b.ctrl.Zy=c}c=b.ctrl;e=a[0];A.log("nsVmap.nsToolsManager.BasicSelect.basicSelectController.centerMapOnPopup");
null!=e.olFeature?(e=e.olFeature.j(),null!=e?"Point"===e.K()?D(c.map).ub(e.ca()):"MultiPoint"===e.K()?1===e.Bi().length?D(c.map).ub(Dp(e).ca()):Th(D(c.map),e):Th(D(c.map),e):console.error("selection['olFeature'].getGeometry() not defined")):console.error("selection['olFeature'] undefined:",e.olFeature);b.ctrl.Yt(a);$("#select-list-modal").modal("hide")})};
Ww.prototype.Za.prototype.wl=function(a,b){A.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.displaySelectionTable");var c=this;Yw(c,this.aBusinessObjectsList,function(){A.log("nsVmap.nsToolsManager.AdvancedSelect.AdvancedSelectController.setBoInfos finished");$(".select_modal_table").bootstrapTable("destroy");setTimeout(function(){for(var a=0;a<c.aBusinessObjectsList.length;a++)Zw(c,c.aBusinessObjectsList[a]);for(a=0;a<c.aBusinessObjectsList.length;a++)$("#select_table_"+
c.aBusinessObjectsList[a]).bootstrapTable({data:[]}),$("#select_table_"+c.aBusinessObjectsList[a]).parent().height($("body").height()/2)},100);c.qc.Do(a,function(){gb(c.tableSelection);c.tableSelection=$w(a);A.log("tableSelection: ",c.tableSelection);setTimeout(function(){for(var a in c.tableSelection)$("#select_table_"+a).bootstrapTable("load",c.tableSelection[a])},100)});A.F.Mc.kq($("#basic-tools-dropdown-select-btn"));setTimeout(function(){$("#select-list-modal").modal("show");null!=b&&$("#select_modal_tab_"+
b).tab("show")},100)})};Ww.prototype.Za.prototype.displaySelectionTable=Ww.prototype.Za.prototype.wl;
function Yw(a,b,c){A.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.setBoInfos");var d,e=0;b=n(b)?b:[];c=n(c)?c:angular.noop;for(d in a.oBusinessObjects)-1===b.indexOf(d)&&delete a.oBusinessObjects[d];for(var f=0;f<b.length;f++)d=b[f],null!=a.oBusinessObjects[d]?(e++,e===b.length&&c.call()):(cd(),z({method:"GET",url:A.properties.api_url+"/vmap/businessobjects/"+d,headers:{Accept:"application/x-vm-json"},scope:a.b,success:function(d){e++;if(!n(d.data))return bootbox.alert("response['data'] undefined"),
0;if(n(d.data.errorMessage))return bootbox.alert(d.data.errorType+": "+d.data.errorMessage),0;if(null==d.data.data)return console.error("Aucune valeur retourn\u00e9e"),0;a.oBusinessObjects[d.data.data[0].business_object_id]=d.data.data[0];e===b.length&&c.call()},error:function(a){e++;e===b.length&&c.call();console.error(a)}}))}
function $w(a){A.log("nsVmap.nsToolsManager.AdvancedSelect.AdvancedSelectController.formatTableSelection");if(null==a)return{};for(var b={},c={},d=0;d<a.length;d++)null!==b&&a[d].bo_type in b||(b[a[d].bo_type]=[]),null!=a[d].bo_list&&(c=ib(a[d].bo_list)),c.selection=a[d],null!=c&&b[a[d].bo_type].push(c);for(var e in b)for(d=0;d<b[e].length;d++)for(var f in b[e][d])r(b[e][d][f])&&(b[e][d][f]=b[e][d][f].replace(/</g,"&lt;").replace(/>/g,"&gt;"));return b}
function Zw(a,b){A.log("nsVmap.nsToolsManager.AdvancedSelect.AdvancedSelectController.setSearchForm");null!=a.oBusinessObjects[b].json_form||(a.oBusinessObjects[b].json_form={});null!=a.oBusinessObjects[b].json_form[0]||(a.oBusinessObjects[b].json_form[0]={});null!=a.oBusinessObjects[b].json_form[0].search||(a.oBusinessObjects[b].json_form[0].search={name:"search-form",title:b,input_size:"xxs",nb_cols:12,javascript:!1,rows:[]});null!=a.oBusinessObjects[b].json_form[0].search.name||(a.oBusinessObjects[b].json_form[0].search.name=
"search-form");null!=a.oBusinessObjects[b].json_form[0].search.title||(a.oBusinessObjects[b].json_form[0].search.title=b);null!=a.oBusinessObjects[b].json_form[0].search.input_size||(a.oBusinessObjects[b].json_form[0].search.title="xxs");null!=a.oBusinessObjects[b].json_form[0].search.nb_cols||(a.oBusinessObjects[b].json_form[0].search.title=12);null!=a.oBusinessObjects[b].json_form[0].search.javascript||(a.oBusinessObjects[b].json_form[0].search.javascript=!1);null!=a.oBusinessObjects[b].json_form[0].search.rows||
(a.oBusinessObjects[b].json_form[0].search.rows=[]);var c=a.oBusinessObjects[b].json_form[0],d={search:{}},e=a.oBusinessObjects[b].geom_column,e=null!=e?e:"geom";null!=a.zq[b]?d.search=a.zq[b]:d.search[e]=a.cg;var f={fields:[{type:"button","class":"btn-ungroup btn-group-xs",nb_cols:12,buttons:[{visibleAllTabs:!0,id:"select_search_form_reader_"+b+"_submit_buton",type:"submit",label:"Rechercher",name:"form_submit","class":"btn-primary right"}]}]};angular.equals(c.search.rows[c.search.rows.length-1],
f)||c.search.rows.push(f);f={fields:[{visibleAllTabs:!0,type:"text",name:e,label:"G\u00e9om\u00e9trie",disabled:!1,required:!1,nb_cols:12}]};angular.equals(c.search.rows[0],f)||c.search.rows.unshift(f);c.search.event=function(d){d=a.qc.wo(d,c,"search");a.cB(angular.copy(b),d,angular.copy(e))};setTimeout(function(){var a=angular.element($("#select_search_form_reader_"+b).children()).scope();null!=a&&a.$apply(function(){a.ctrl.setDefinitionName("search");a.ctrl.setFormValues(angular.copy(d));a.ctrl.setFormDefinition(angular.copy(c));
a.ctrl.loadForm()})},500)}
Ww.prototype.Za.prototype.cB=function(a,b,c){A.log("nsVmap.nsToolsManager.AdvancedSelect.AdvancedSelectController.updateSelectionTable");if(null==a)return console.error("bo_id not defined or null"),0;var d=this,e=this.b,f=this.Ja;b=null!=b?b:{};var g="",g=0,h={relation:"AND",operators:[]},k;for(k in b)k!==c&&""!==b[k]&&(h.operators.push({column:k,compare_operator:"=",value:b[k]}),g++);g=JSON.stringify(h);this.zq[a]=b;h=.01;k=A.g().fb();h=this.In*k/1E3;h>this.Ay&&(h=this.Ay);k=A.properties.api_url+
"/vmap/querys/"+a+"/list";var m=D(this.map).D().V.substring(5);b={filter:g,intersect_geom:b[c],result_srid:m,get_geom:!1,get_image:!1,intersect_buffer:h,limit:this.limitList_};f=f.defer();cd();z({method:"POST",url:k,headers:{"X-HTTP-Method-Override":"GET",Accept:"application/x-vm-json"},data:b,scope:this.b,timeout:5E3,abord:f.promise,success:function(b){if(!n(b.data))return bootbox.alert("response['data'] undefined"),e.selectedLayerId="",0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorType+
": "+b.data.errorMessage),e.selectedLayerId="",0;null==b.data.data&&($.notify("Aucune valeur retourn\u00e9e","warn"),b.data.data=[]);d.tableSelection[a]=$w(b.data.data)[a];null!=d.tableSelection[a]||(d.tableSelection[a]=[]);for(var c in d.tableSelection)$("#select_table_"+c).bootstrapTable("load",d.tableSelection[c]);d.vk(a);d.Te({data:b.data.data,dataType:"list"});b.data.data.length===d.limitList_&&$.notify("Limite d'objets \u00e0 afficher atteinte","warn")}})};
Ww.prototype.Za.prototype.updateSelectionTable=Ww.prototype.Za.prototype.cB;Ww.prototype.Za.prototype.RJ=function(a,b){A.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.tableAddToCard");a=$(a).bootstrapTable("getSelections");for(var c=[],d=0;d<a.length;d++)c.push(a[d].selection);this.qc.pe(c,b)};Ww.prototype.Za.prototype.tableAddToCard=Ww.prototype.Za.prototype.RJ;
Ww.prototype.Za.prototype.TJ=function(a){A.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.tableDeleteSelection");var b=this;a=$(a).bootstrapTable("getSelections");for(var c=[],d=0;d<a.length;d++)c.push(a[d].selection);this.qc.ul(c,function(){for(var a=0;a<c.length;a++)b.Tp(c[a]),$("#select-list-modal").hasClass("in");b.wl(b.aSelections)})};Ww.prototype.Za.prototype.tableDeleteSelection=Ww.prototype.Za.prototype.TJ;
Ww.selectTableFormatter=function(a,b){a=b.selection.have_card_rights;var c=b.selection.have_update_rights;b=b.selection.have_delete_rights;var d=20;"true"===a&&(d+=20);"true"===c&&(d+=20);"true"===b&&(d+=20);d=['<div style="width: '+d+'px">','<a class="selection-table-popup" href="javascript:void(0)" title="Popup">','<i class="icon-comment padding-sides-5"></i>',"</a>"];"true"===a&&(d.push('<a class="selection-table-card" href="javascript:void(0)" title="Fiche descriptive">'),d.push('<i class="glyphicon glyphicon-file padding-sides-5"></i>'),
d.push("</a>"));"true"===c&&(d.push('<a class="selection-table-edit" href="javascript:void(0)" title="Editer">'),d.push('<i class="icon-draw padding-sides-5"></i>'),d.push("</a>"));"true"===b&&(d.push('<a class="selection-table-delete" href="javascript:void(0)" title="Supprimer">'),d.push('<i class="icon-trash padding-sides-5"></i>'),d.push("</a>"));d.push("</div>");return d.join("")};
window.selectTableEvents={"click .selection-table-popup":function(a,b,c){var d=angular.element($("#select-list-modal")).scope();d.$evalAsync(function(){d.ctrl.Zn(c.selection)})},"click .selection-table-card":function(a,b,c){var d=angular.element($("#select-list-modal")).scope();d.$evalAsync(function(){d.ctrl.se(c.selection)})},"click .selection-table-edit":function(a,b,c){var d=angular.element($("#select-list-modal")).scope();d.$evalAsync(function(){d.ctrl.nd(c.selection)})},"click .selection-table-delete":function(a,
b,c){var d=angular.element($("#select-list-modal")).scope();d.$evalAsync(function(){d.ctrl.re(c.selection)})}};Ww.prototype.Za.prototype.se=function(a){A.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.displayObjectCard");this.qc.se(a)};Ww.prototype.Za.prototype.displayObjectCard=Ww.prototype.Za.prototype.se;
Ww.prototype.Za.prototype.nd=function(a){A.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.displayEditFrom");this.qc.nd(a,function(){setTimeout(function(){$("#select-list-modal").modal("show");var b=a.bo_type;A.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.updateSelectionTable");A.jj("select_search_form_reader_"+b+"_submit_buton")})})};Ww.prototype.Za.prototype.displayEditFrom=Ww.prototype.Za.prototype.nd;
Ww.prototype.Za.prototype.re=function(a){A.log("nsVmap.nsToolsManager.AdvancedSelect.AdvancedSelectController.deleteObject");var b=this;this.qc.re(a,function(){b.Tp(a);$("#select-list-modal").hasClass("in")&&b.wl(b.aSelections)})};Ww.prototype.Za.prototype.deleteObject=Ww.prototype.Za.prototype.re;
Ww.prototype.Za.prototype.vk=function(a){A.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.removeSelections");for(var b=this.aSelections.length-1;0<=b;b--)null!=a?this.aSelections[b].bo_type===a&&Ra(this.aSelections,b):Ra(this.aSelections,b)};Ww.prototype.Za.prototype.Tp=function(a){for(var b=this.aSelections.length-1;0<=b;b--)angular.equals(this.aSelections[b],a)&&this.aSelections.splice(b,1)};A.module.directive("appAdvancedselect",Ww.prototype.IB);
A.module.controller("AppAdvancedselectController",Ww.prototype.Za);function T(){new Ww;new Ew}pa("nsVmap.nsToolsManager.Select",T);T.prototype.Hg=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.Hg(a)};T.prototype.ko=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.ko(a)};T.prototype.se=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.se(a)};T.prototype.displayObjectCard=T.prototype.se;T.prototype.nd=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.nd(a,b)};
T.prototype.displayEditFrom=T.prototype.nd;l=T.prototype;l.zm=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.zm(a)};l.Te=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.Te(a)};l.Pl=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.Pl(a,b)};l.Do=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.Do(a,b)};l.xo=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.xo(a,b)};
l.Iq=function(a,b,c,d){return angular.element($("#vmap-select-tool")).scope().ctrl.Iq(a,b,c,d)};l.wo=function(a,b,c,d){return angular.element($("#vmap-select-tool")).scope().ctrl.wo(a,b,c,d)};l.re=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.re(a,b)};T.prototype.deleteObject=T.prototype.re;T.prototype.ul=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.ul(a,b)};T.prototype.deleteMultipleObjects=T.prototype.ul;
T.prototype.pe=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.pe(a,b)};T.prototype.addToCard=T.prototype.pe;T.prototype.mg=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.mg(a)};T.prototype.editFeature=T.prototype.mg;
T.prototype.TI=function(){A.log("nsVmap.nsToolsManager.Select.prototype.selectDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppSelectController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/tools/select.html"}};
T.prototype.va=function(a,b,c){A.log("nsVmap.nsToolsManager.Select.prototype.selectController");var d=this;this.b=a;this.$timeout_=b;this.Ja=c;this.Uc=c.defer();this.properties=A.properties;this.token=A.properties.token;this.addPartGeomType="";this.bt=A.properties.selection.limit_popup;this.cy=A.properties.selection.limit_list;this.pc=To(A.g(),{style:new Dn({fill:new Cn({color:"rgba(255, 255, 255, 0.6)"}),stroke:new gl({color:"#319FD3",width:2}),Lb:new Bn({tb:7,fill:new Cn({color:"#319FD3"})})})});
this.Sb=this.pc.v().Cb;this.De=To(A.g(),{style:new Dn({fill:new Cn({color:"rgba(0, 0, 0, 0.2)"})})});this.xh=new gw({features:this.Sb});this.xh.on("modifyend",function(){setTimeout(function(){ax(d,d.Sb.R())})});this.Ic=new vw({rb:[this.pc]});this.Ic.on("select",function(){for(var a=this.Ic.wa().R(),b=0;b<a.length;b++)this.pc.v().fc(a[b]);this.Ic.wa().clear();setTimeout(function(){ax(d,d.Sb.R())})},this);this.kg=new vw({rb:[this.De]});this.kg.on("select",this.Kr,this);A.scope.$on("toggleOutTools",
function(){d.Cj();d.Uc.resolve()});r(oUrlParams.bo_id)&&r(oUrlParams.ids)&&0<oUrlParams.bo_id.length&&0<oUrlParams.ids.length&&setTimeout(function(){var a=A.qa.sg();if(null!=a[oUrlParams.bo_id]){for(var b=[],c=oUrlParams.ids.split("|"),h=0;h<c.length;h++)b.push({bo_type:oUrlParams.bo_id,bo_id_value:c[h],bo_id_field:a[oUrlParams.bo_id].bo_id_field,bo_title:a[oUrlParams.bo_id].bo_title});0<b.length&&d.pe(b,!0)}})};T.prototype.selectController=T.prototype.va;
T.prototype.va.$inject=["$scope","$timeout","$q"];
T.prototype.va.prototype.Hg=function(a){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.queryByEWKTGeom");var b=this;if(null!=a)if(null!=a.gn)if(null!=a.cg)if(null!=a.ur)if(null!=a.Kn)if(null!=a.mb){var c=!a.gn,d=!0===a.gn?"list":"summary",e=D(this.map).D().V.substring(5),f=.01;"Point"===A.yi(a.cg).K()&&null!=a.buffer&&(f=A.g().fb(),f=a.buffer*f/1E3);z({method:"POST",url:A.properties.api_url+"/vmap/querys/"+a.ur+"/"+d,headers:{"X-HTTP-Method-Override":"GET",Accept:"application/x-vm-json"},
data:{intersect_geom:a.cg,intersect_buffer:f,get_geom:c,get_image:c,result_srid:e,limit:!0===a.gn?this.cy:this.bt,d:Date.now()},scope:this.b,abord:a.Kn.promise,success:function(c){if(1===a.Kn.promise.$$state.status)return 0;var d=[];null!=c.data?null!=c.data.data?d=c.data.data:A.log("Pas de donn\u00e9es \u00e0 afficher"):A.log("Pas de donn\u00e9es \u00e0 afficher");d.length===b.cy&&$.notify("Limite d'objets \u00e0 afficher atteinte","warn");a.mb.call(this,d)}})}else console.error("opt_options.callback not defined");
else console.error("opt_options.canceler not defined");else console.error("opt_options.bo_id not defined");else console.error("opt_options.EWKTGeometry not defined");else console.error("opt_options.useTableFormat not defined")};T.prototype.va.prototype.ko=function(a){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.extractFeatureFromData");a=A.yi(a.bo_intersect_geom);return new So({geometry:a})};T.prototype.va.prototype.Oj=function(){return angular.element($("#select_edit_form_reader").children()).scope()};
T.prototype.va.prototype.se=function(a){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.displayObjectCard");if(0===a.bo_title.length)return 0;this.editSelection={bo_title:a.bo_title,display_form_size:a.display_form_size};this.xo([a],function(b){a=b[0];var c=a.bo_json_form,d={update:ib(a.bo_form),display:ib(a.bo_form)};A.log("oFormValues: ",d);A.log("oFormDefinition: ",c);var e=angular.element($("#select_display_form_reader").children()).scope();e.$evalAsync(function(){function b(){e.ctrl.setDefinitionName("display");
e.ctrl.setFormValues(d);e.ctrl.setFormDefinition(c);e.$applyAsync(function(){e.ctrl.loadForm();$("#select-card-modal").modal("show")})}try{n(destructor_form)&&destructor_form()}catch(h){A.log("destructor_form does not exist")}if(null!=a.bo_json_form_js){var g=a.bo_json_form_js;A.log("initHtmlForm : javascript assoc. to : "+g);ad([g],{callback:function(){b();try{n(constructor_form)&&constructor_form(e,g)}catch(h){A.log("constructor_form does not exist")}},async:!0,scriptInBody:!0})}else b()})})};
T.prototype.va.prototype.displayObjectCard=T.prototype.va.prototype.se;
T.prototype.va.prototype.nd=function(a,b){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.displayEditFrom");var c=this;if(0===a.bo_title.length)return 0;this.editSelection=a;c.Pl([a],function(d){c.xo(d,function(d){a=d[0];var e=a.bo_json_form,g={update:ib(a.bo_form),display:ib(a.bo_form)};d={fields:[{type:"button","class":"btn-ungroup btn-group-sm",nb_cols:12,buttons:[{visibleAllTabs:!0,type:"submit",label:"FORM_UPDATE",name:"form_submit","class":"btn-primary hidden",id:"basictools-select-form-reader-submit-btn"}]}]};
angular.equals(e.update.rows[e.update.rows.length-1],d)||e.update.rows.push(d);e.update.event=function(d){$("#select_edit_form_reader").find("button").attr("disabled",!0);cd();var f=[a.bo_id_field];null!=c.editableSelection&&null!=c.editableSelection.geom_column&&f.push(c.editableSelection.geom_column);var g=c.wo(d,e,"update",f);a.bo_form=g;c.Iq(a.bo_type,g,function(){$("#select-edit-modal").modal("hide");$("#select_edit_form_reader").find("button").attr("disabled",!1);c.Cj();null!=b&&b.call(this,
g)},function(){$("#select-edit-modal").modal("hide");$("#select_edit_form_reader").find("button").attr("disabled",!1);c.Cj();null!=b&&b.call(this,g)})};var h=c.Oj();h.$evalAsync(function(){function b(){h.ctrl.setDefinitionName("update");h.ctrl.setFormValues(g);h.ctrl.setFormDefinition(e);h.$applyAsync(function(){h.ctrl.loadForm();$("#select-edit-modal").modal("show")})}try{n(destructor_form)&&destructor_form()}catch(p){A.log("destructor_form does not exist")}if(null!=a.bo_json_form_js){var c=a.bo_json_form_js;
A.log("initHtmlForm : javascript assoc. to : "+c);ad([c],{callback:function(){b();try{n(constructor_form)&&constructor_form(h,c)}catch(p){A.log("constructor_form does not exist")}},async:!0,scriptInBody:!0})}else b()})})})};T.prototype.va.prototype.displayEditFrom=T.prototype.va.prototype.nd;l=T.prototype.va.prototype;l.Pl=function(a,b){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.getSummaryInfos");bx(this,{Zh:a,dataType:"summary",mb:b})};
l.Do=function(a,b){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.getListInfos");bx(this,{Zh:a,dataType:"list",mb:b})};l.xo=function(a,b){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.getFormInfos");bx(this,{Zh:a,dataType:"form",mb:b})};
function bx(a,b){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.complementDataOnSelection");var c=n(b.Zh)?b.Zh:[],d=n(b.dataType)?b.dataType:null,e=n(b.Qn)?b.Qn:{};b=n(b.mb)?b.mb:function(){return 0};for(var f=[],g=0;g<c.length;g++)Ya(f,c[g].bo_type);a.Zc=ea(a.Zc)?a.Zc:0;a.Zc+=f.length;0<f.length&&cd();for(var h=[],g=0;g<f.length;g++){Na(h);for(var k=0;k<c.length;k++)c[k].bo_type===f[g]&&h.push(c[k]);cx(a,{Zh:Va(h),lw:f[g],dataType:d,Qn:e,mb:b})}}
function cx(a,b){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.complementDataOnSelection2_");for(var c=n(b.Zh)?b.Zh:[],d=n(b.dataType)?b.dataType:null,e=n(b.Qn)?b.Qn:{},f=n(b.mb)?b.mb:function(){return 0},g={relation:"OR",operators:[]},h=0;h<c.length;h++)n(c[h]["bo_"+d])||g.operators.push({column:c[h].bo_id_field.replace(/\./g,'"."'),compare_operator:"=",value:c[h].bo_id_value});h=D(a.map).D().V.substring(5);n(b.lw)?(b=A.properties.api_url+"/vmap/querys/"+b.lw+"/"+d,h={result_srid:h,
limit:200},"summary"===d&&(h.get_geom=!0,h.get_image=!0),kb(h,e),0<g.operators.length?(h.filter=JSON.stringify(g),z({method:"POST",url:b,headers:{"X-HTTP-Method-Override":"GET",Accept:"application/x-vm-json"},data:h,scope:a.b,success:function(b){var e=[];a.Zc--;0===a.Zc&&($("body").css({cursor:""}),dd());n(b.data)&&n(b.data.errorMessage)&&bootbox.alert(b.data.errorMessage);n(b.data.data)?e=b.data.data:A.log("Pas de donn\u00e9es \u00e0 afficher");199<e.length&&bootbox.alert("<h4>Attention, vous avez atteint la limite d'objects affichables sur la carte</h4>");
a.Te({data:e,selection:c,dataType:d,mb:f})},error:function(){a.Zc--;0===a.Zc&&($("body").css({cursor:""}),dd(),f.call(this,c))}})):(a.Zc--,0===a.Zc&&($("body").css({cursor:""}),dd(),f.call(a,c)))):console.error("opt_options.bo_type not defined")}
l.Te=function(a){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.addQueryResult");var b=n(a.data)?a.data:[],c=n(a.selection)?a.selection:[];a=n(a.mb)?a.mb:function(){return 0};for(var d=[],e=0;e<b.length;e++)d.push(b[e]),n(b[e].bo_intersect_geom)&&(d[e].olFeature=this.ko(b[e]));Pa(c,d);c=this.zm(c);a.call(this,c)};
l.zm=function(a){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.removeDuplicateSelections");for(var b=[],c=0;c<a.length;c++){Na(b);for(var d=c+1;d<a.length;d++)if(a[c].bo_id_field==a[d].bo_id_field&&a[c].bo_type==a[d].bo_type&&a[c].bo_id_value==a[d].bo_id_value){b.push(d);!0===a[d].locked&&(a[c].locked=!0);for(var e="olFeature mapPopup bo_image_path bo_summary bo_summary_attributs bo_list bo_list_attributs bo_form bo_form_attributs bo_json_form bo_json_form_js bo_json_form_css".split(" "),
f=0;f<e.length;f++)n(a[d][e[f]])&&!n(a[c][e[f]])&&(a[c][e[f]]=a[d][e[f]]),n(a[c][e[f]])&&!n(a[d][e[f]])&&(a[d][e[f]]=a[c][e[f]])}for(d=0;d<b.length;d++)Ra(a,b[d])}return a};
l.Iq=function(a,b,c,d){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.updateBOValues");if(!n(a))return 0;b=n(b)?b:{};c=n(c)?c:angular.noop;d=n(d)?d:angular.noop;b=this.es(b);var e=this.map.getLayers().R();cd();z({method:"PUT",url:A.properties.api_url+"/vmap/querys/"+a,headers:{Accept:"application/x-vm-json"},data:b,scope:this.b,success:function(b){if(!n(b.data))return console.log("Aucune valeur retourn\u00e9e"),d.call(),0;if(n(b.data.errorMessage))return console.log(b.data.errorMessage),
d.call(),0;for(b=0;b<e.length;b++){var f=Nd(e[b]).business_objects;if(q(f))for(var h=0;h<f.length;h++)f[h].business_object_id===a&&e[b].fd()}$.notify("Op\u00e9ration r\u00e9alis\u00e9e avec succ\u00e8s, les couches de la carte se mettent \u00e0 jour","info");c.call()}})};
l.wo=function(a,b,c,d){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.getFormData");if(null==a)return console.error("oFormValues is undefined or null"),null;if(null==b)return console.error("oFormDefinition is undefined or null"),null;if(null==c)return console.error("sFormDefinitionName is undefined or null"),null;null!=d||(d=[]);var e=angular.element(u.f).injector().get(["envSrvc"]),f=angular.element(u.f).injector().get(["formSrvc"]);e.oFormValues=a;e.oFormDefinition=b;e.sFormDefinitionName=
c;b=f.getFormData(c,!0);for(e=0;e<d.length;e++)null!=a[c][d[e]]&&(b[d[e]]=a[c][d[e]]);return b};l.es=function(a){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.getFormDataFromValues");var b=new FormData,c;for(c in a)null!=a[c].aFiles?(b.append(c+"_attached_content",a[c].aFiles[0]),b.append(c,a[c].aFiles[0].name)):b.append(c,a[c]);return b};
l.re=function(a,b){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.deleteObject");var c=this;bootbox.confirm("<h4>Supprimer d\u00e9finitivement cet objet de la base de donn\u00e9es ?</h4>",function(d){!0===d&&dx(c,a,b)})};T.prototype.va.prototype.deleteObject=T.prototype.va.prototype.re;
T.prototype.va.prototype.ul=function(a,b){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.deleteMultipleObjects");var c=this;bootbox.confirm("<h4>Supprimer d\u00e9finitivement ces objets de la base de donn\u00e9es ?</h4>",function(d){if(!0===d)for(d=0;d<a.length;d++)dx(c,a[d],b)})};T.prototype.va.prototype.deleteMultipleObjects=T.prototype.va.prototype.ul;
function dx(a,b,c){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.submitDeleteObject");var d=b.bo_type;b=b.bo_id_value;var e=a.map.getLayers().R();z({method:"DELETE",url:A.properties.api_url+"/vmap/querys/"+d,headers:{Accept:"application/x-vm-json"},params:{idList:b},scope:a.b,success:function(){for(var a=0;a<e.length;a++){var b=Nd(e[a]).business_objects;if(q(b))for(var h=0;h<b.length;h++)b[h].business_object_id===d&&e[a].fd()}$.notify("Op\u00e9ration r\u00e9alis\u00e9e avec succ\u00e8s, les couches de la carte se mettent \u00e0 jour",
"info");c.call()},error:function(){}})}
T.prototype.va.prototype.pe=function(a,b){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.addToCard");b&&A.F.M.removeAll();var c=this;setTimeout(function(){c.Pl(a,function(a){c.Do(a,function(a){if(!n(a)||0>=a.length)return console.error("aSelection empty or inexistent"),0;for(var b=[],c=a[0].bo_type,d=a[0].bo_title,e={ae:["selection","state"]},m=0;m<a.length;m++)null!=a[m].bo_list?null!=a[m].olFeature?(b.push(a[m].bo_list),b[m].feature=a[m].olFeature,null==b[m][a[m].bo_id_field]&&
(b[m][a[m].bo_id_field]=a[m].bo_id_value,e.ae.push(a[m].bo_id_field))):console.error("Selection[i]['olFeature'] undefined"):console.error("Selection[i]['bo_list'] undefined");void 0===A.F.M.Qa(c)&&A.F.M.Wa({Ma:c,lb:d,Fa:["zoom","delete"]});a={Ma:c};e.data=b;A.F.M.lr(a,e);$("#select-list-modal").modal("hide");A.F.M.Ke();A.F.M.Ze(c);setTimeout(function(){A.F.M.Vk(c)},500)})})})};T.prototype.va.prototype.addToCard=T.prototype.va.prototype.pe;
T.prototype.va.prototype.HD=function(a){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.editFormFeature");$("#select-edit-modal").modal("hide");angular.element($("#vmap-basicselect-tool")).scope().ctrl.Up();$("#select-list-modal").modal("hide");this.mg(a,!0)};T.prototype.va.prototype.editFormFeature=T.prototype.va.prototype.HD;
T.prototype.va.prototype.mg=function(a,b){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.editFeature");var c=this,d=A.qa.sg();if(null==a.bo_type)return console.error("selection['bo_type'] not defined"),0;if(null==d[a.bo_type])return console.error("oBusinessObjects[selection['bo_type']] not defined"),0;if(null==d[a.bo_type].bo_geom_type)return console.error("oBusinessObjects[selection['bo_type']]['bo_geom_type'] not defined"),0;this.editableSelection=a;this.editableFeatureType=d[a.bo_type].bo_geom_type;
if("GEOMETRYCOLLECTION"===this.editableFeatureType)this.addPartGeomType="";else if("POLYGON"===this.editableFeatureType||"MULTIPOLYGON"===this.editableFeatureType)this.addPartGeomType="Polygon";else if("LINESTRING"===this.editableFeatureType||"MULTILINESTRING"===this.editableFeatureType)this.addPartGeomType="LineString";else if("POINT"===this.editableFeatureType||"MULTIPOINT"===this.editableFeatureType)this.addPartGeomType="Point";this.editGeometryFromForm=b?!0:!1;$("#basictools-select-modify-palette").show();
setTimeout(function(){null!=c.editableSelection.olFeature&&ex(c);setTimeout(function(){0<c.pc.v().Cb.Xb()&&c.wA("editFeature","basicTools-select-editFeature"===c.Gr)},100)},500)};T.prototype.va.prototype.editFeature=T.prototype.va.prototype.mg;
T.prototype.va.prototype.wA=function(a,b){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.startEdition");var c=this;this.qw();if(!0===b)return 0;if("insert"===a.substr(0,6))A.g().Ea.Ra("Cliquez pour commencer \u00e0 dessiner"),this.nu(a.substr(6));else if("editFeature"===a)A.g().Ea.Ra("Cliquez sur la g\u00e9om\u00e9trie pour la modifier"),Po(A.g(),this.xh,"basicTools-select-"+a);else if("deleteFeature"===a)A.g().Ea.Ra("Cliquez sur la g\u00e9om\u00e9trie pour la supprimer"),Po(A.g(),
this.Ic,"basicTools-select-"+a);else if("addHole"===a){A.g().Ea.Ra("Dessinez un polygone \u00e0 l'int\u00e9rieur d'un autre pour cr\u00e9er un trou");this.nc=A.g().Jg({type:"Polygon"},"basicTools-select-"+a);var d=Va(this.Sb.R());this.nc.on("drawend",function(a){a=a.za;for(var b=Dh(a.j()),e=!1,h=0;h<d.length;h++)or(d[h].j(),a.j())&&(Ah(d[h].j(),b),e=!0);e?setTimeout(function(){ax(c,c.Sb.R())}):bootbox.alert("<h4>Trou non valide: il doit \u00eatre contenu dans un polygone dessin\u00e9</h4>")},this)}else if("deleteHole"===
a)A.g().Ea.Ra("Cliquez dans un trou pour le supprimer"),this.jr(),Po(A.g(),this.kg,"basicTools-select-"+a);else return console.error("startEdition: type ("+a+") not allowed"),0};T.prototype.va.prototype.startEdition=T.prototype.va.prototype.wA;T.prototype.va.prototype.qw=function(){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.cancelEdition");A.g().Ge();A.g().Ea.hide();this.De.v().clear()};T.prototype.va.prototype.cancelEdition=T.prototype.va.prototype.qw;
T.prototype.va.prototype.jr=function(){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.addHolesIntoHolesLayer");var a=this.Sb.R();this.De.v().clear();for(var b=0;b<a.length;b++){var c=Eh(a[b].j());if(1<c.length)for(var d=1;d<c.length;d++){var e=new zh;e.Bb([c[d].ca()]);this.De.v().Gc(new So({geometry:e}))}}};
T.prototype.va.prototype.Kr=function(){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.deleteHole");var a=this,b=this.kg.wa().R();if(0<b.length){for(var c=0;c<b.length;c++){for(var d=b[c].j(),e=!1,f=this.Sb.R(),g=0;g<f.length;g++){for(var h=f[g].j().ca(),k=h.length-1;0<=k;k--)angular.equals(d.ca()[0],h[k])&&(h.splice(k,1),e=!0);f[g].j().Bb(h)}e&&this.De.v().fc(b[c])}this.kg.wa().clear();setTimeout(function(){ax(a,a.Sb.R())})}};
T.prototype.va.prototype.nu=function(a){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.startDrawing");var b=this;this.nc=A.g().Jg({type:a,features:this.Sb},"basicTools-select-insert"+a);this.nc.on("drawend",function(c){var d=c.za;setTimeout(function(){if("Circle"===a){var c=d.j(),c=new Gh(c);b.pc.v().fc(d);d=new So({geometry:c});b.pc.v().Gc(d)}ax(b,b.Sb.R())})},this)};
function ax(a,b){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.putFeaturesOnTheElement");if(null==b)console.error("aFeatures undefined");else if(q(b))if("MULTI"!==a.editableFeatureType.substr(0,5)&&"GEOMETRYCOLLECTION"!==a.editableFeatureType){a.editableSelection.olFeature=b[b.length-1];for(var c=0;c<b.length-1;c++)a.pc.v().fc(b[c])}else{if("MULTIPOLYGON"===a.editableFeatureType){for(var d=new Ep,c=0;c<b.length;c++)"Polygon"===b[c].j().K()&&Fp(d,b[c].j());a.editableSelection.olFeature=
new So({geometry:d})}if("MULTILINESTRING"===a.editableFeatureType){d=new yp;for(c=0;c<b.length;c++)"LineString"===b[c].j().K()&&zp(d,b[c].j());a.editableSelection.olFeature=new So({geometry:d})}if("MULTIPOINT"===a.editableFeatureType){d=new Bp;for(c=0;c<b.length;c++)"Point"===b[c].j().K()&&Cp(d,b[c].j());a.editableSelection.olFeature=new So({geometry:d})}}else console.error("aFeatures is not an array")}
function ex(a){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.putElementFeatureOnOverlay");if(null==a.editableSelection.olFeature)console.error("this['editableSelection']['olFeature'] not defined");else if(null==a.editableSelection.olFeature.j())console.error("this['editableSelection']['olFeature'].getGeometry() not defined");else if("MULTI"!==a.editableFeatureType.substr(0,5)&&"GEOMETRYCOLLECTION"!==a.editableFeatureType)a.pc.v().clear,a.pc.v().Gc(a.editableSelection.olFeature);else{var b=
[],c=[];"MULTIPOINT"===a.editableFeatureType&&(c=Va(a.editableSelection.olFeature.j().Bi()));"MULTILINESTRING"===a.editableFeatureType&&(c=Va(Zk(a.editableSelection.olFeature.j())));"MULTIPOLYGON"===a.editableFeatureType&&(c=Va(Kl(a.editableSelection.olFeature.j())));for(var d=0;d<c.length;d++)b.push(new So({geometry:c[d]}));a.pc.v().clear;a.pc.v().ai(b)}}
T.prototype.va.prototype.LJ=function(){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.submitGeomEdition");var a={};a[this.editableSelection.bo_id_field]=this.editableSelection.bo_id_value;a[this.editableSelection.geom_column]=null!=this.editableSelection.olFeature?A.pg(this.editableSelection.olFeature.j()):"";this.Iq(this.editableSelection.bo_type,a,function(){A.F.Mc.Zf()},function(){A.F.Mc.Zf()})};T.prototype.va.prototype.submitGeomEdition=T.prototype.va.prototype.LJ;
T.prototype.va.prototype.TK=function(){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.validateGeomAndDisplayEditForm");var a=this,b=this.Oj();b.$evalAsync(function(){null!=a.editableSelection.olFeature?null!=a.editableSelection.olFeature.j()?b.oFormValues.update[a.editableSelection.geom_column]=A.pg(a.editableSelection.olFeature.j()):b.oFormValues.update[a.editableSelection.geom_column]="":b.oFormValues.update[a.editableSelection.geom_column]="";$("#basictools-select-modify-palette").hide();
A.g().tk();$("#select-edit-modal").modal("show");a.Cj()})};T.prototype.va.prototype.validateGeomAndDisplayEditForm=T.prototype.va.prototype.TK;T.prototype.va.prototype.Cj=function(){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.clearOverlays");0<this.pc.v().Cb.Xb()&&this.pc.v().clear();0<this.De.v().Cb.Xb()&&this.De.v().clear()};T.prototype.va.prototype.clearOverlays=T.prototype.va.prototype.Cj;
T.prototype.va.prototype.SD=function(){A.log("nsVmap.nsToolsManager.Select.prototype.selectController.finishEdition");this.Cj();A.g().Ea.hide();A.F.Mc.Zf()};T.prototype.va.prototype.finishEdition=T.prototype.va.prototype.SD;A.module.directive("appSelect",T.prototype.TI);A.module.controller("AppSelectController",T.prototype.va);function fx(){A.log("nsVmap.nsToolsManager.Insert")}pa("nsVmap.nsToolsManager.Insert",fx);fx.prototype.dG=function(){A.log("nsVmap.nsToolsManager.Insert.prototype.inserttoolDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppInsertController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/tools/insert.html"}};
fx.prototype.qb=function(a,b,c){A.log("nsVmap.nsToolsManager.Insert.prototype.inserttoolController");a.vmapScope=A.scope;var d=this;this.b=a;this.J=b;this.Ja=c;this.Uc=c.defer();this.au=D(this.map).D().V;new Gp({yc:this.au});this.pc=To(A.g());this.Sb=this.pc.v().Cb;this.De=To(A.g(),{style:new Dn({fill:new Cn({color:"rgba(0, 0, 0, 0)"})})});this.xh=new gw({features:this.Sb});this.Ic=new vw({rb:[this.pc]});this.properties=A.properties;this.token=A.properties.token;this.addPartGeomType="";a.selectedBoId;
a.aInsertableBOs=A.qa.zo();a.oInsertObject={sFormDefinitionName:"insert",business_object_id:null,oResult:{},sGeomColumn:null,sGeomType:null,oFormDefinition:{},add_form_size:1,oFormValues:{insert:{}}};a.featuresLength=0;A.scope.$on("layersChanged",function(){d.b.$applyAsync(function(){a.aInsertableBOs=A.qa.zo()})});setTimeout(function(){d.b.$applyAsync(function(){a.aInsertableBOs=A.qa.zo()})});this.Ic.on("select",function(){for(var a=this.Ic.wa().R(),b=0;b<a.length;b++)this.pc.v().fc(a[b]);this.Ic.wa().clear()},
this);this.kg=new vw({rb:[this.De]});this.kg.on("select",this.Kr,this);var e=0;this.pc.v().on("change",function(){var b=a.oInsertObject.sGeomType;if(null!=b&&"MULTI"!==b.substr(0,5)&&"GEOMETRYCOLLECTION"!==b&&1<this.Sb.Xb())for(;1<this.Sb.Xb();)Td(this.Sb,0);e++;var c=angular.copy(e);setTimeout(function(){if(e===c){A.log("nsVmap.nsToolsManager.Insert.inserttoolController.updateInsertObjectFeature");for(var a=d.b,b=Va(d.Sb.R()),f=a.oInsertObject.sGeomType,g=0;g<b.length;g++)if(b[g].j()instanceof Ov){var t=
b[g].j(),t=new Gh(t);b[g]=new So({geometry:t})}t=new kd;g="";if(0<b.length){if("MULTIPOINT"===f){f=new Bp;for(g=0;g<b.length;g++)"Point"===b[g].j().K()&&Cp(f,b[g].j());b=new So({geometry:f})}else if("MULTILINESTRING"===f){f=new yp;for(g=0;g<b.length;g++)"LineString"===b[g].j().K()&&zp(f,b[g].j());b=new So({geometry:f})}else if("MULTIPOLYGON"===f){f=new Ep;for(g=0;g<b.length;g++)"Polygon"===b[g].j().K()&&Fp(f,b[g].j());b=new So({geometry:f})}else b=b[0];g=t.Pu(b,{Wd:D(d.map).D().V,Kc:D(d.map).D().V})}""===
g?console.error("WKTGeometry is empty"):(b=A.hE(g,D(d.map).D().V),a.oInsertObject.oFormValues.insert[a.oInsertObject.sGeomColumn]=b,a.oInsertObject.oResult[a.oInsertObject.sGeomColumn]=b)}},500)},this);$("#basictools-insert-form-reader-modal").on("shown.bs.modal",function(){$("#basictools-insert-form-reader").parent().scrollTop(0)});A.scope.$on("toggleOutTools",function(){a.oInsertObject.oResult={};a.oInsertObject.oFormValues.insert={};a.selectedBoId=null;d.Sb.clear()});this.Sb.on("change:length",
function(){a.$applyAsync(function(){a.featuresLength=d.Sb.Xb()})},this)};fx.prototype.inserttoolController=fx.prototype.qb;fx.prototype.qb.$inject=["$scope","$rootScope","$q"];fx.prototype.qb.prototype.sx=function(){A.log("nsVmap.nsToolsManager.Insert.inserttoolController.getInsertableLayers");return A.qa.sx()};fx.prototype.qb.prototype.getInsertableLayers=fx.prototype.qb.prototype.sx;
fx.prototype.qb.prototype.nd=function(){A.log("nsVmap.nsToolsManager.Insert.inserttoolController.displayEditFrom");var a=this.b;A.F.Mc.kq($("#basic-tools-dropdown-insert-btn"));$("#basictools-insert-form-reader-modal").modal("show");var b=this.Oj();b.$evalAsync(function(){try{n(destructor_form)&&destructor_form()}catch(d){A.log("destructor_form does not exist")}if(null!=a.oInsertObject.oFormDefinition_js){var c=a.oInsertObject.oFormDefinition_js;A.log("initHtmlForm : javascript assoc. to : "+c);ad([c],
{callback:function(){try{n(constructor_form)&&constructor_form(b,c)}catch(d){A.log("constructor_form does not exist")}},async:!0,scriptInBody:!0})}b.ctrl.loadForm()})};fx.prototype.qb.prototype.displayEditFrom=fx.prototype.qb.prototype.nd;
fx.prototype.qb.prototype.iB=function(){A.log("nsVmap.nsToolsManager.Insert.inserttoolController.validateForm");var a=this,b=this.b;b.ap=!1;setTimeout(function(){a.Oj().sendForm();setTimeout(function(){if(b.ap){var c=b.oInsertObject,d=b.oInsertObject.oFormValues;A.log("nsVmap.nsToolsManager.Insert.inserttoolController.getBOValuesFromFormValues");var e=a.b,f=angular.element(u.f).injector().get(["formSrvc"]),d=ib(d),d=f.getFormData("insert",!0,{oFormDefinition:e.oInsertObject.oFormDefinition,oFormValues:d,
aParamsToSave:["geom"]});c.oResult=d;$("#basictools-insert-form-reader-modal").modal("hide")}})})};fx.prototype.qb.prototype.validateForm=fx.prototype.qb.prototype.iB;fx.prototype.qb.prototype.zK=function(){A.log("nsVmap.nsToolsManager.Insert.inserttoolController.trySubmitInsertion");var a=this,b=this.b;b.ap=!1;this.iB();setTimeout(function(){b.ap&&a.zA()},500)};fx.prototype.qb.prototype.trySubmitInsertion=fx.prototype.qb.prototype.zK;
function gx(a,b){A.log("nsVmap.nsToolsManager.Insert.inserttoolController.isResultValid");if(null==a)return console.error("oResult not defined"),!1;if(null==b)return console.error("oFormDefinition not defined"),!1;var c=[];b=b.insert.rows;for(var d=0;d<b.length;d++)for(var e=0;e<b[d].fields.length;e++)!0===b[d].fields[e].required&&(null!=a[b[d].fields[e].name]&&""!==a[b[d].fields[e].name]||(r(b[d].fields[e].label)&&""!==b[d].fields[e].label?c.push(b[d].fields[e].label+"("+b[d].fields[e].name+")"):
c.push(b[d].fields[e].name)));return 0===c.length?!0:c}
fx.prototype.qb.prototype.aB=function(){function a(){setTimeout(function(){!1===g&&bootbox.confirm("Annuler la requ\u00eate ?",function(b){!0===b?(h.resolve(),dd(),c.selectedBoId=""):a()})},5E3)}A.log("nsVmap.nsToolsManager.Insert.inserttoolController.updateInsertForm");var b=this,c=this.b,d=this.Ja,e=this.Oj(),f=c.selectedBoId;c.oInsertObject.oResult={};c.oInsertObject.sGeomColumn=null;c.oInsertObject.sGeomType=null;c.oInsertObject.business_object_id=null;c.oInsertObject.oFormDefinition={};c.oInsertObject.oFormValues.insert=
{};this.Sb.clear();null!=e&&e.ctrl.refreshForm();var g=!1,h=d.defer();cd();z({method:"GET",url:A.properties.api_url+"/vmap/businessobjects/"+f,headers:{Accept:"application/x-vm-json"},scope:this.b,abord:h.promise,success:function(a){g=!0;if(!n(a.data))return bootbox.alert("response['data'] undefined"),c.selectedBoId="",0;if(n(a.data.errorMessage))return bootbox.alert(a.data.errorType+": "+a.data.errorMessage),c.selectedBoId="",0;if(null==a.data.data)return bootbox.alert("Aucune valeur retourn\u00e9e, impossible de charger le formulaire correspondant \u00e0 la couche"),
c.selectedBoId="",0;if(null==a.data.data[0].json_form[0])return bootbox.alert("Impossible de charger le formulaire correspondant \u00e0 la couche"),c.selectedBoId="",0;c.oInsertObject.oFormDefinition=a.data.data[0].json_form[0];c.oInsertObject.oFormDefinition_js=a.data.data[0].json_form_js;c.oInsertObject.add_form_size=a.data.data[0].add_form_size;c.oInsertObject.sBusinessObjectID=f;n(a.data.data[0].geom_column)&&(c.oInsertObject.sGeomColumn=a.data.data[0].geom_column);n(a.data.data[0].geom_type)&&
(c.oInsertObject.sGeomType=a.data.data[0].geom_type);if("GEOMETRYCOLLECTION"===c.oInsertObject.sGeomType)b.addPartGeomType="";else if("POLYGON"===c.oInsertObject.sGeomType||"MULTIPOLYGON"===c.oInsertObject.sGeomType)b.addPartGeomType="Polygon";else if("LINESTRING"===c.oInsertObject.sGeomType||"MULTILINESTRING"===c.oInsertObject.sGeomType)b.addPartGeomType="LineString";else if("POINT"===c.oInsertObject.sGeomType||"MULTIPOINT"===c.oInsertObject.sGeomType)b.addPartGeomType="Point";c.oInsertObject.oFormDefinition.insert.rows.push({fields:[{type:"button",
"class":"btn-ungroup btn-group-sm",nb_cols:12,buttons:[{visibleAllTabs:!0,type:"submit",label:"Sauvegarder",name:"form_submit","class":"btn-primary hidden",id:"basictools-insert-form-reader-submit-btn"}]}]});c.oInsertObject.oFormDefinition.insert.event=function(){c.ap=!0};e.ctrl.refreshForm()},error:function(a){c.selectedBoId="";bootbox.alert(a)}});a()};fx.prototype.qb.prototype.updateInsertForm=fx.prototype.qb.prototype.aB;fx.prototype.qb.prototype.Oj=function(){return angular.element($("#basictools-insert-form-reader").children()).scope()};
fx.prototype.qb.prototype.FJ=function(a,b){A.log("nsVmap.nsToolsManager.Insert.inserttoolControlle.startInsertion");A.g().Ge();A.g().Ea.hide();if(!0===b)return 0;if("insert"===a.substr(0,6))A.g().Ea.Ra("Cliquez pour commencer \u00e0 dessiner"),this.nu(a.substr(6));else if("editFeature"===a)A.g().Ea.Ra("Cliquez sur un dessin pour le modifier"),Po(A.g(),this.xh,"basicTools-insert-"+a);else if("deleteFeature"===a)A.g().Ea.Ra("Cliquez sur un dessin pour le supprimer"),Po(A.g(),this.Ic,"basicTools-insert-"+
a);else if("addHole"===a){A.g().Ea.Ra("Dessinez un polygone \u00e0 l'int\u00e9rieur d'un autre pour cr\u00e9er un trou");this.nc=A.g().Jg({type:"Polygon"},"basicTools-insert-"+a);a=Va(this.Sb.R());var c=[];for(b=0;b<a.length;b++)if("Polygon"===a[b].j().K())c.push(a[b]);else if("MultiPolygon"===a[b].j().K())for(var d=Va(Kl(a[b].j())),e=0;e<d.length;e++)c.push(new So({geometry:d[e]}));this.nc.on("drawend",function(a){a=a.za;for(var b=Dh(a.j()),d=!1,e=0;e<c.length;e++)or(c[e].j(),a.j())&&(Ah(c[e].j(),
b),d=!0);d?(this.pc.v().clear(),this.pc.v().ai(c)):bootbox.alert("Trou non valide: il doit \u00eatre contenu dans un polygone dessin\u00e9")},this)}else if("deleteHole"===a)A.g().Ea.Ra("Cliquez dans un trou pour le supprimer"),this.jr(),Po(A.g(),this.kg,"basicTools-insert-"+a);else return console.error("startSelection: type ("+a+") not allowed"),0};fx.prototype.qb.prototype.startInsertion=fx.prototype.qb.prototype.FJ;
fx.prototype.qb.prototype.jr=function(){A.log("nsVmap.nsToolsManager.Insert.inserttoolController.addHolesIntoHolesLayer");var a=this.Sb.R();this.De.v().clear();for(var b=0;b<a.length;b++){var c=Eh(a[b].j());if(1<c.length)for(var d=1;d<c.length;d++){var e=new zh;e.Bb([c[d].ca()]);this.De.v().Gc(new So({geometry:e}))}}};
fx.prototype.qb.prototype.Kr=function(){A.log("nsVmap.nsToolsManager.Insert.inserttoolController.deleteHole");var a=this.kg.wa().R();if(0<a.length){for(var b=0;b<a.length;b++){for(var c=a[b].j(),d=!1,e=this.Sb.R(),f=0;f<e.length;f++){for(var g=e[f].j().ca(),h=g.length-1;0<=h;h--)angular.equals(c.ca()[0],g[h])&&(g.splice(h,1),d=!0);e[f].j().Bb(g)}d&&this.De.v().fc(a[b])}this.kg.wa().clear()}};
fx.prototype.qb.prototype.nu=function(a){A.log("nsVmap.nsToolsManager.Insert.inserttoolController.startDrawing");this.nc=A.g().Jg({type:a,features:this.Sb},"basicTools-insert-insert"+a);this.nc.on("drawend",function(a){a=a.za;if(a.j()instanceof Ov){var b=a.j(),b=new Gh(b);a.$c(b)}},this)};
fx.prototype.qb.prototype.zA=function(){A.log("nsVmap.nsToolsManager.Insert.inserttoolController.submitInsertion");var a=this,b=this.b,c=b.oInsertObject.oResult,d=b.oInsertObject.sBusinessObjectID,b=gx(c,b.oInsertObject.oFormDefinition);if(!0===b)hx(this,c,d);else{if(q(b))for(c="Votre requ\u00eate n'a pas pu aboutir, les attributs suivants sont obligatoires: <br>",d=0;d<b.length;d++)c=0===d?c:c+", ",c+=b[d];else c="Votre requ\u00eate n'a pas pu aboutir, certains attributs obligatoires n'ont pas \u00e9t\u00e9s renseign\u00e9s";
bootbox.dialog({message:c,buttons:{cancel:{label:"Annuler",className:"btn-default"},editAttr:{label:"\u00c9diter les attributs",className:"btn-primary",callback:function(){a.nd()}}}})}};fx.prototype.qb.prototype.submitInsertion=fx.prototype.qb.prototype.zA;
function hx(a,b,c){A.log("nsVmap.nsToolsManager.Insert.inserttoolController.sendInsertRequest");null==b?console.error("oResult not defined"):null==c?console.error("sBusinessObjectID not defined"):(b=a.es(b),cd(),z({method:"POST",url:A.properties.api_url+"/vmap/querys/"+c,headers:{Accept:"application/x-vm-json"},data:b,scope:a.b,success:function(b){if(!n(b.data))return bootbox.alert("response['data'] undefined"),0;if(200!==b.status)return 500===b.status?$.notify("Erreur interne du serveur","error"):
null!=b.statusText?$.notify(b.statusText,"error"):$.notify("Erreur "+b.status,"error"),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorType+": "+b.data.errorMessage),0;if(1===b.data.status){$.notify("Op\u00e9ration r\u00e9alis\u00e9e avec succ\u00e8s, les couches de la carte se mettent \u00e0 jour","info");a.aB();A.log("nsVmap.nsToolsManager.Insert.inserttoolController.reloadImpactedLayer");b=a.map.getLayers().R();for(var d,f=0;f<b.length;f++)if(d=b[f].get("business_objects"),q(d))for(var g=
0;g<d.length;g++)d[g].business_object_id===c&&b[f].fd();A.F.Mc.Zf()}}}))}fx.prototype.qb.prototype.es=function(a){A.log("nsVmap.nsToolsManager.Insert.prototype.inserttoolController.prototype.getFormDataFromValues");var b=new FormData,c;for(c in a)null!=a[c].aFiles?(b.append(c+"_attached_content",a[c].aFiles[0]),b.append(c,a[c].aFiles[0].name)):b.append(c,a[c]);return b};A.module.directive("appInsert",fx.prototype.dG);A.module.controller("AppInsertController",fx.prototype.qb);function ix(a){zi.call(this,{ug:jx,hh:kx,Gx:lx,vg:mx});a=a?a:{};this.Gg=void 0;this.Jf=null;this.dd=void 0!==a.features?a.features:null;var b;if(a.rb)if("function"===typeof a.rb)b=a.rb;else{var c=a.rb;b=function(a){return 0<=c.indexOf(a)}}else b=fg;this.gp=b;this.To=a.jh?a.jh:0;this.dm=null;J(this,Md("active"),this.hF,this)}E(ix,zi);
function jx(a){this.dm=nx(this,a.Yc,a.map);if(!this.Jf&&this.dm){this.Jf=a.Qb;lx.call(this,a);var b=this.dd||new Pd([this.dm]);this.dispatchEvent(new ox("translatestart",b,a.Qb));return!0}return!1}function mx(a){if(this.Jf){this.Jf=null;lx.call(this,a);var b=this.dd||new Pd([this.dm]);this.dispatchEvent(new ox("translateend",b,a.Qb));return!0}return!1}
function kx(a){if(this.Jf){a=a.Qb;var b=a[0]-this.Jf[0],c=a[1]-this.Jf[1],d=this.dd||new Pd([this.dm]);d.forEach(function(a){var d=a.j();d.translate(b,c);a.$c(d)});this.Jf=a;this.dispatchEvent(new ox("translating",d,a))}}function lx(a){var b=am(a.map);nx(this,a.Yc,a.map)?(this.Gg=void 0!==this.Gg?this.Gg:b.style.cursor,b.style.cursor=this.Jf?"-webkit-grabbing":"-webkit-grab",b.style.cursor=this.Jf?"grabbing":"grab"):void 0!==this.Gg&&(b.style.cursor=this.Gg,this.Gg=void 0)}
function nx(a,b,c){return $l(c,b,function(a){if(!this.dd||0<=this.dd.R().indexOf(a))return a}.bind(a),{fp:a.gp,jh:a.To})}ix.prototype.cb=function(a){var b=this.g();zi.prototype.cb.call(this,a);this.cn(b)};ix.prototype.hF=function(){this.cn(null)};ix.prototype.cn=function(a){var b=this.g(),c=this.get("active");b&&c||void 0===this.Gg||(b||(b=a),am(b).style.cursor=this.Gg,this.Gg=void 0)};function ox(a,b,c){Dd.call(this,a);this.features=b;this.Qb=c}E(ox,Dd);function px(a){A.log("nsVmap.nsToolsManager.PrintBox");this.S=A.g().H;a=null!=a?a:{};this.vm=a.size;this.jf=To(A.g());this.Od=this.jf.v().Cb;this.xK=new ix({features:this.Od})}pa("nsVmap.nsToolsManager.PrintBox",px);fv.Print=qx;px.prototype.show=function(a){null!=a||(a=!0);this.Ur();a&&rx(this)};px.prototype.show=px.prototype.show;px.prototype.hide=function(){Hd(this.lz);this.Od.clear()};px.prototype.hide=px.prototype.hide;
px.prototype.ty=function(a){A.log("nsVmap.nsToolsManager.PrintBox.managePrintBox");a=null!=a?a:"modifyPrintZone";Hd(this.lz);Po(A.g(),this.xK,a)};px.prototype.managePrintBox=px.prototype.ty;px.prototype.YA=function(){A.log("nsVmap.nsToolsManager.PrintBox.unmanagePrintBox");A.g().tk();this.Ur();rx(this)};px.prototype.unmanagePrintBox=px.prototype.YA;
px.prototype.fb=function(){var a=this,b=D(this.S).xa(),c=D(this.S).La();this.W();Th(D(this.S),this.W(),{Ib:!1,Ti:!0});var d=A.g().fb();setTimeout(function(){Uh(D(a.S),b);D(a.S).ub(c)});return d};px.prototype.getScale=px.prototype.fb;px.prototype.le=function(a){var b=this.fb(),b=a/b,c=this.W();a=(c[2]-c[0])*b;b*=c[3]-c[1];c=Ch(this.um.j()).ca();a=Fh([c[0]-a/2,c[1]-b/2,c[0]+a/2,c[1]+b/2]);this.um=new So({geometry:a});this.Od.clear();this.jf.v().Gc(this.um)};px.prototype.setScale=px.prototype.le;
px.prototype.Ta=function(){return this.vm};px.prototype.getSize=px.prototype.Ta;px.prototype.Mm=function(a){this.vm=a};px.prototype.setSize=px.prototype.Mm;px.prototype.W=function(){return this.um.j().W()};px.prototype.getExtent=px.prototype.W;function rx(a){a.lz=A.g().Bk("precompose",a.Ur,a)}
px.prototype.Ur=function(){if(null==this.vm)return console.error("Print box size undefined"),0;if(null==this.vm)return console.error("Print box feature undefined"),0;this.Od.clear();var a=this.vm,b=a[0],c=a[1],a=$("#map1").width()/2-b/2,b=$("#map1").width()/2+b/2,d=$("#map1").height()/2-c/2,c=$("#map1").height()/2+c/2,e=[b,d],f=this.S.Gd([a,c]),e=this.S.Gd(e),f=Fh([f[0],e[1],e[0],f[1]]),f=new So({geometry:f});f.set("pixelExtent",[a,d,b,c]);this.um=f;this.jf.v().Gc(this.um)};function qx(){A.log("nsVmap.nsToolsManager.Print")}pa("nsVmap.nsToolsManager.Print",qx);fv.Print=qx;qx.prototype.print=function(a){A.log("nsVmap.nsToolsManager.Print.prototype.print");angular.element($("#select-print-format")).scope().$evalAsync(function(b){b.ctrl.print(a)})};qx.prototype.print=qx.prototype.print;
qx.prototype.$H=function(){A.log("nsVmap.nsToolsManager.Print.prototype.printDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppprintController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/tools/print.html"}};
qx.prototype.sc=function(a,b,c){A.log("nsVmap.nsToolsManager.Print.prototype.printController");var d=this;this.$timeout_=a;this.b=c;c.modelIndex=0;this.properties;this.model;this.resolution=2;this.dpi=1;this.scale="auto";this.currentScale=A.g().fb({pretty:!0});this.Zi=new px;sx(this);tx(this);$("#print-select-btn").click(function(){$("#print-select-btn").hasClass("active")&&d.gy(c.modelIndex)});A.scope.$on("toggleOutTools",function(){$("#print-select-btn").hasClass("active")||d.Zi.hide()})};
qx.prototype.printController=qx.prototype.sc;qx.prototype.sc.$inject=["$timeout","$compile","$scope"];function sx(a){A.log("nsVmap.nsToolsManager.Print.printController.loadPrintProperties");cd();z({method:"GET",url:A.properties.api_url+"/vmap/userprinttemplates",headers:{Accept:"application/x-vm-json"},params:{distinct:!0},scope:a.b,success:function(b){dd();null!=b.data&&q(b.data.userprinttemplates)&&0<b.data.userprinttemplates.length&&(a.properties={models:b.data.userprinttemplates})}})}
function tx(a){A.log("nsVmap.nsToolsManager.Print.printController.listenScaleChanges");var b=0;a.map.on("moveend",function(){b++;var c=angular.copy(b);setTimeout(function(){b===c&&"print-modifyPrintZone"!==a.currentAction&&(a.scale="auto",a.currentScale=No(A.g(),A.g().fb()/a.fj),a.b.$apply())},100)})}
qx.prototype.sc.prototype.gy=function(a){A.log("nsVmap.nsToolsManager.Print.printController.loadModelParmas");a=this.model=this.properties.models[a];var b=this.rG;A.log("nsVmap.nsToolsManager.Print.printController.setTemplate");null!=a.definition||null!=a.url||bootbox.alert("<h4>Aucune d\u00e9finition pr\u00e9sente dans le mod\u00e8le d'impression</h4>");if(null!=a.definition){var c=document.createElement("div");c.innerHTML=a.definition;this.VJ=c;b.call(this,[c])}};
qx.prototype.sc.prototype.loadModelParmas=qx.prototype.sc.prototype.gy;
qx.prototype.sc.prototype.rG=function(){A.log("nsVmap.nsToolsManager.Print.printController.loadModelParmas2");var a=this.VJ;A.log("nsVmap.nsToolsManager.Print.printController.setPrintedMapSize");var b=$(a).find("#map_image");if(n(b.get(0))){$(a).addClass("print_template");$("body").append(a);var c=b.height(),b=b.width();$(a).remove();this.fj=1;for(var a=angular.copy(b),d=angular.copy(c);b>$("#map1").width()||c>$("#map1").height();)this.fj++,b=a/this.fj,c=d/this.fj;this.bI=[b,c]}else console.error("Aucune balise #map_image trouv\u00e9e dans le template");
this.resolution=this.fj;this.currentScale=No(A.g(),A.g().fb()/this.fj);this.Zi.Mm(this.bI);this.Zi.show()};qx.prototype.sc.prototype.PC=function(a){A.log("nsVmap.nsToolsManager.Print.prototype.printController.prototype.changeScale");if("auto"===a)return 0;if("print-modifyPrintZone"===this.currentAction)return this.Zi.le(a),0;a*=this.fj;A.g().le(a)};qx.prototype.sc.prototype.changeScale=qx.prototype.sc.prototype.PC;
qx.prototype.sc.prototype.FG=function(){A.log("nsVmap.nsToolsManager.Print.prototype.printController.prototype.managePrintZone");"print-modifyPrintZone"===this.currentAction?this.Zi.YA():this.Zi.ty("print-modifyPrintZone")};qx.prototype.sc.prototype.managePrintZone=qx.prototype.sc.prototype.FG;
qx.prototype.sc.prototype.YH=function(){A.log("nsVmap.nsToolsManager.Print.prototype.printController.prototype.prepareAndLaunchPrint");A.g().fb({pretty:!0});for(var a={},b=0;b<this.model.variables.length;b++)a[this.model.variables[b].name]=this.model.variables[b].value;b=this.Zi.W();1===this.print({scope:a,Z:b,DA:this.model.printtemplate_id,Lz:this.dpi})&&A.F.Mc.Zf()};qx.prototype.sc.prototype.prepareAndLaunchPrint=qx.prototype.sc.prototype.YH;
qx.prototype.sc.prototype.print=function(a){A.log("nsVmap.nsToolsManager.Print.prototype.printController.prototype.print");var b=this;if(null==a)return console.error("opt_options.templateId not defined"),0;var c=null!=a.Lz?a.Lz:1,d=a.DA,e=JSON.stringify([{target:"#map_legend",html:ux()}]),f=JSON.stringify(null!=a.scope?a.scope:{}),g,h;null!=a.vy?g=a.vy:h=A.qa.Ao();for(var k=null!=a.features?a.features:[],m="",p=0;p<k.length;p++)0<p&&(m+="|"),m+=A.pg(k[p].j());for(var k=null!=a.Z?a.Z:[],t="",v=[k[0]-
(k[2]-k[0]),k[1]-(k[3]-k[1]),k[2]+(k[2]-k[0]),k[3]+(k[3]-k[1])],w="",p=0;p<k.length;p++)0<p&&(t+="|",w+="|"),t+=k[p],w+=v[p];var x=100;null!=a.Xw?x=a.Xw:null!=A.properties.print.features_zoom&&(x=A.properties.print.features_zoom);var y=window.open("","_blank","height=400,width=600");if(null==y)return $.notify("Fen\u00eatre d'impression bloqu\u00e9e par le navigateur","error"),0;y.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>');
z({method:"GET",url:A.properties.api_url+"/vmap/printtemplates/"+d,headers:{Accept:"application/x-vm-json"},scope:this.b,success:function(a){var k=!1;null!=a.data?null!=a.data.data?null!=a.data.data[0]?null!=a.data.data[0].definition?null!=a.data.data[0].rt_format_id?null!=a.data.data[0].rt_orientation_id||(k=!0):k=!0:k=!0:k=!0:k=!0:k=!0;if(k)return $.notify("Erreur lors du chargement des donn\u00e9es du template "+d,"error"),console.error("response: ",a),0;var k=a.data.data[0].rt_format_id,p=a.data.data[0].rt_orientation_id,
v=document.createElement("div");v.innerHTML=a.data.data[0].definition;a=vx(v,"#map_image");v=vx(v,"#map_overview");if(null!=a)var F={map_id:g,map_json:h,image_size:a[0]*c+"|"+a[1]*c,resolution_coeff:c,extent:t,features:m,features_zoom:x};if(null!=v)var P={map_id:g,map_json:h,image_size:v[0]*c+"|"+v[1]*c,resolution_coeff:c,extent:w,features:m,features_zoom:400};a=[];null!=F&&a.push({target:"#map_image",map_definition:F});null!=P&&a.push({target:"#map_overview",map_definition:P});F=JSON.stringify(a);
z({method:"POST",url:A.properties.api_url+"/vmap/printtemplateservices",headers:{Accept:"application/x-vm-json"},data:{printtemplate_id:d,format:k,orientation:p,includes_json:e,maps_json:F,scope_json:f},scope:b.b,timeout:12E4,success:function(a){var b=!1;null!=a.data?null!=a.data.printtemplateservices?null!=a.data.printtemplateservices.image?1!==a.data.status&&(b=!0):b=!0:b=!0:b=!0;if(b)return $.notify("Une erreur est survenue lors de l'impression","error"),y.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">Une erreur est survenue lors de l\'impression</div>'),
console.error("response: ",a),0;$.notify("Impression r\u00e9ussie","success");y.location.href=a.data.printtemplateservices.image},error:function(a){console.error(a);$.notify("Une erreur est survenue lors de l'impression","error");y.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">Une erreur est survenue lors de l\'impression</div>')}})},error:function(a){console.error(a);$.notify("Une erreur est survenue lors de l'impression","error");y.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">Une erreur est survenue lors de l\'impression</div>')}});
return 1};qx.prototype.sc.prototype.print=qx.prototype.sc.prototype.print;function vx(a,b){var c=$(a).find(b);if(n(c.get(0)))return $("body").append(a),b=c.height(),c=c.width(),$(a).remove(),[c,b];A.log("Aucune balise "+b+" trouv\u00e9e dans le template")}
function ux(){var a=$("#maplegend").clone();a.find("img").each(function(){try{var a=document.createElement("canvas"),c=a.getContext("2d");a.width=this.width;a.height=this.height;c.drawImage(this,0,0,this.width,this.height);var d=a.toDataURL("image/png");$(this).attr("src",d);$(this).removeAttr("ng-src")}catch(e){}});a=a.html();a=a.replace(/&amp;/g,"&");return a=a.replace(/"/g,'\\"')}A.module.directive("appPrint",qx.prototype.$H);A.module.controller("AppprintController",qx.prototype.sc);function wx(){A.log("nsVmap.nsToolsManager.BasicTools");this.tH=new Iv;this.vH=new Aw;this.st=new T;this.qH=new fx;this.Wy=new qx;this.mH=new Fv}pa("nsVmap.nsToolsManager.BasicTools",wx);wx.prototype.nK=function(a){var b=$(a).hasClass("active");this.Zf();!1===b&&($(a).addClass("active"),$(a).parent().children(".dropdown-menu").show())};wx.prototype.toggleTool=wx.prototype.nK;wx.prototype.kq=function(a){$(a).addClass("active");$(a).parent().children(".dropdown-menu").show()};
wx.prototype.showTool=wx.prototype.kq;wx.prototype.Jx=function(a){$(a).removeClass("active");$(a).parent().children(".dropdown-menu").hide()};wx.prototype.hideTool=wx.prototype.Jx;wx.prototype.Zf=function(){A.log("nsVmap.nsToolsManager.BasicTools.prototype.toggleOutTools");$(".basic-tools-element").removeClass("active");$(".basic-tools-dropdown-element").hide();A.g().tk();A.log("oVmap event: toggleOutTools");A.scope.$broadcast("toggleOutTools")};wx.prototype.toggleOutTools=wx.prototype.Zf;
wx.prototype.jw=function(){A.log("nsVmap.nsToolsManager.BasicTools.prototype.basictoolsDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppBasictoolsController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/tools/basictools.html"}};wx.prototype.basictoolsDirective=wx.prototype.jw;
wx.prototype.tr=function(a,b){A.log("nsVmap.nsToolsManager.BasicTools.prototype.basictoolsController");a.$oLocation;a.$oMeasure;a.$oSelect;a.$oInsert;a.$oPrint;a.$oControls;b(function(){for(var b=a.oL;b;b=b.pL)b.ml.constructor===Iv.prototype.Va&&(a.$oLocation=b),b.ml.constructor===Aw.prototype.Ya&&(a.$oMeasure=b),b.ml.constructor===T.prototype.tM&&(a.$oSelect=b),b.ml.constructor===fx.prototype.qb&&(a.$oInsert=b),b.ml.constructor===qx.prototype.sc&&(a.$oPrint=b),b.ml.constructor===Fv.prototype.xw&&
(a.$oControls=b)});A.scope.$on("mapChanged",function(){A.F.Mc.Zf()})};wx.prototype.basictoolsController=wx.prototype.tr;wx.prototype.tr.$inject=["$scope","$timeout"];wx.prototype.QE=function(){return this.st};wx.prototype.getSelect=wx.prototype.QE;wx.prototype.pE=function(){return this.qH};wx.prototype.getInsert=wx.prototype.pE;wx.prototype.yE=function(){return this.tH};wx.prototype.getLocation=wx.prototype.yE;wx.prototype.GE=function(){return this.vH};wx.prototype.getMeasure=wx.prototype.GE;
wx.prototype.PE=function(){return this.Wy};wx.prototype.getPrint=wx.prototype.PE;wx.prototype.Ef=function(){return this.mH};wx.prototype.getControls=wx.prototype.Ef;A.module.directive("appBasictools",wx.prototype.jw);A.module.controller("AppBasictoolsController",wx.prototype.tr);function U(){A.log("nsVmap.nsToolsManager.InfoContainer")}pa("nsVmap.nsToolsManager.InfoContainer",U);U.prototype.Ke=function(){A.log("nsVmap.nsToolsManager.InfoContainer.showBar");Id(function(){angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(a){a.ctrl.Ke()})})};U.prototype.showBar=U.prototype.Ke;
U.prototype.Wa=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.addTab");if(!n(a))return"opt_options not defined";if(!n(a.Ma))return"opt_options.tabCode not defined";if(!n(a.lb))return"opt_options.tabName not defined";angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){var c=new xx(a);b.ctrl.Wa(c)})};U.prototype.addTab=U.prototype.Wa;
U.prototype.nJ=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.setTab");if(!n(a))return"opt_options not defined";if(!n(a.Ma))return"opt_options.tabCode not defined";if(!n(a.lb))return"opt_options.tabName not defined";var b=angular.element($("#infocontainer-info-container")).scope();if(void 0!==b.ctrl.infos)for(var c=b.ctrl.infos.length-1;0<=c;c--)b.ctrl.infos.splice(c,1);b.$evalAsync(function(b){var c=new xx(a);b.ctrl.Wa(c)})};U.prototype.setTab=U.prototype.nJ;
U.prototype.vn=function(a,b){A.log("nsVmap.nsToolsManager.InfoContainer.addRow");if(void 0===a.Ma&&void 0===a.tabIndex)return"bad tab_options";if(void 0===b.data)return"row_options.data undefined";angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(c){c.ctrl.vn(a,b);c.ctrl.xm()});return!0};U.prototype.addRow=U.prototype.vn;
U.prototype.lr=function(a,b){A.log("nsVmap.nsToolsManager.InfoContainer.addMultipleRows");if(void 0===a.Ma&&void 0===a.tabIndex)return"bad tab_options";if(void 0===b.data)return"row_options.data undefined";angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(c){for(var d,e=0;e<b.data.length;e++)d={data:b.data[e],ji:b.ji,ae:b.ae},c.ctrl.vn(a,d);c.ctrl.xm()});return!0};U.prototype.addMultipleRows=U.prototype.lr;
U.prototype.xm=function(){A.log("nsVmap.nsToolsManager.InfoContainer.refreshTabs");angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(a){a.ctrl.xm()});return!0};U.prototype.refreshTabs=U.prototype.xm;U.prototype.Xd=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.displayTabByCode");angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){b.ctrl.Xd(a)})};U.prototype.displayTabByCode=U.prototype.Xd;
U.prototype.xl=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.displayTabByIndex");angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){b.ctrl.xl(a)})};U.prototype.displayTabByIndex=U.prototype.xl;U.prototype.rD=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.displayInfos");this.Ke();this.Ch(a)};U.prototype.displayInfos=U.prototype.rD;
U.prototype.Qa=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.getTabByCode");a=angular.element($("#infocontainer-info-container")).scope().ctrl.Qa(a);if(void 0!==a)return jQuery.extend(!0,{},a)};U.prototype.getTabByCode=U.prototype.Qa;U.prototype.Ql=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.getTabTable");return angular.element($("#infocontainer-info-container")).scope().ctrl.Ql(a)};U.prototype.getTabTable=U.prototype.Ql;
U.prototype.oE=function(){A.log("nsVmap.nsToolsManager.InfoContainer.getInfos");var a=angular.element($("#infocontainer-info-container")).scope().ctrl.infos;return jQuery.extend(!0,[],a)};U.prototype.getInfos=U.prototype.oE;U.prototype.Ch=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.setInfos");A.log(a);angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){b.ctrl.Ch(a)})};U.prototype.setInfos=U.prototype.Ch;
U.prototype.wj=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.addInfos");A.log(a);angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){b.ctrl.wj(a)})};U.prototype.addInfos=U.prototype.wj;U.prototype.St=function(a){var b=angular.element($("#infocontainer-info-container")).scope(),c=b.ctrl.infos;if(void 0===a||void 0===c)return 0;for(var d=c.length-1;0<=d;d--)c[d].tabCode===a&&c.splice(d,1);b.$evalAsync(function(a){yx(a.ctrl)})};U.prototype.removeTabByCode=U.prototype.St;
U.prototype.removeAll=function(){A.log("nsVmap.nsToolsManager.InfoContainer.removeAll");A.g().Cp.clear();var a=angular.element($("#infocontainer-info-container")).scope(),b=a.ctrl.infos;if(void 0===b)return 0;for(var c=b.length-1;0<=c;c--)b.splice(c,1);a.$evalAsync(function(a){yx(a.ctrl)})};U.prototype.removeAll=U.prototype.removeAll;
U.prototype.Vp=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.removeTabRows");if(void 0===a)return 0;angular.element($("#infocontainer-info-container")).scope();var b=this.Qa(a);this.Ql(b);for(b=b.tableParams.data.length-1;0<=b;b--)this.Pt(a,b)};U.prototype.removeTabRows=U.prototype.Vp;
U.prototype.Pt=function(a,b){A.log("nsVmap.nsToolsManager.InfoContainer.removeRow");var c=angular.element($("#infocontainer-info-container")).scope(),d=c.ctrl.infos;if(void 0===a||void 0===d||void 0===b)return 0;var e=this.Qa(a),e=this.Ql(e).bootstrapTable("getData")[b];n(e.feature)&&A.g().ee.v().fc(e.feature);for(e=d.length-1;0<=e;e--)d[e].tabCode===a&&d[e].tableParams.data.splice(b,1);c.$evalAsync(function(a){yx(a.ctrl)})};U.prototype.removeRow=U.prototype.Pt;
U.prototype.Vk=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.zoomOnTabFeatures");if(!n(a))return"tabCode not defined";angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){b.ctrl.Vk(a)})};U.prototype.zoomOnTabFeatures=U.prototype.Vk;U.prototype.Ze=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.displayTabFeatures");if(!n(a))return"tabCode not defined";angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){b.ctrl.Ze(a)})};
U.prototype.displayTabFeatures=U.prototype.Ze;
function xx(a){A.log("nsVmap.nsToolsManager.InfoContainer.Tab");if(!n(a)||!n(a.Ma)||!n(a.lb))return 0;var b=[],c=[],d={},e="";a.data=n(a.data)?a.data:[];a.Fa=n(a.Fa)?a.Fa:[];a.ae=n(a.ae)?function(){var b=a.ae;Ma(b,"feature")||b.push("feature");return b}():["feature"];for(var f=0;f<a.Fa.length;f++)"delete"===a.Fa[f]?(e="info-container-goog_"+Fa++ +"-remove-feature",c.push('<a class="'+e+'" href="javascript:void(0)" title="Enlever du panier">'),c.push('<i class="glyphicon glyphicon-remove padding-sides-5"></i>'),c.push("</a>"),
d["click ."+e]=function(b,c,d,e){A.F.M.Pt(a.Ma,e)}):"zoom"===a.Fa[f]&&(e="info-container-goog_"+Fa++ +"-zoom-feature",c.push('<a class="'+e+'" href="javascript:void(0)" title="Zoom sur la g\u00e9om\u00e9trie">'),c.push('<i class="glyphicon glyphicon-globe padding-sides-5"></i>'),c.push("</a>"),d["click ."+e]=function(a,b,c){if(!n(c.feature))return console.error('Aucune g\u00e9om\u00e9trie renseign\u00e9e dans la colone "feature"'),0;A.g().gt([c.feature],!0,!0)});b.push({checkbox:!0,clickToSelect:!0,
"class":"info-container-checkbox-column"});b.push({formatter:function(){return c.join("")},"class":"info-container-list-events-column",events:d});a.ji=n(a.ji)?a.ji:function(){for(var c in a.data[0])b.push({field:c,title:c,sortable:!0,visible:!Ma(a.ae,c)});return b}();d={search:!0,checkboxHeader:!0,data:a.data,columns:a.ji};this.tabCode=a.Ma;this.tabName=a.lb;this.tableParams=d}U.Tab=xx;
U.prototype.Ox=function(){A.log("nsVmap.nsToolsManager.InfoContainer.prototype.infocontainerDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",infos:"=appInfos"},controller:"AppInfocontainerController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/tools/infocontainer.html"}};U.prototype.infocontainerDirective=U.prototype.Ox;
U.prototype.yb=function(a,b){A.log("nsVmap.nsToolsManager.InfoContainer.prototype.infocontainerController");this.$timeout=a;this.b=b;this.infos=[];this.selectedTabIndex=0;this.avaliablePrintReports=[];A.scope.$on("mapChanged",function(){A.F.M.removeAll()})};U.prototype.infocontainerController=U.prototype.yb;U.prototype.yb.$inject=["$timeout","$scope"];
U.prototype.yb.prototype.Ke=function(){A.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.showBar");"hidden"===$("#opener-bottombar").css("visibility")&&$("#opener-bottombar").css("visibility","visible");$("#map-container").addClass("minus");this.$timeout(function(){!1===$("#map-container").hasClass("open")&&!1===$("#map-container").hasClass("open2")&&A.jj("opener-bottombar-1")})};
U.prototype.yb.prototype.xl=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.displayTabByIndex");this.selectedTabIndex=a};U.prototype.yb.prototype.displayTabByIndex=U.prototype.yb.prototype.xl;U.prototype.yb.prototype.Xd=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.displayTabByCode");for(var b=0;b<this.infos.length;b++)if(this.infos[b].tabCode===a)var c=b;this.xl(c)};U.prototype.yb.prototype.displayTabByCode=U.prototype.yb.prototype.Xd;
l=U.prototype.yb.prototype;l.Qa=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.getTabByCode");for(var b=0;b<this.infos.length;b++)if(this.infos[b].tabCode===a)return this.infos[b]};l.Ql=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.getTabTable");return void 0===a?0:$("#infocontainer-table-"+a.index)};
l.Wa=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.addTab");for(var b=0;b<this.infos.length;b++)if(this.infos[b].tabCode===a.tabCode){var c=!0;A.log('onglet "'+this.infos[b].tabCode+'"" d\u00e9j\u00e0 pr\u00e9sent');this.infos[b]=a}void 0===c&&this.infos.push(a);var d=this;this.$timeout(function(){yx(d)})};
l.vn=function(a,b){A.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.addRow");if(void 0===a.Ma&&void 0===a.tabIndex)return"bad tab_options";if(void 0===b.data)return"row_options.data undefined";b.ae=n(b.ae)?function(){var a=b.ae;Ma(a,"feature")||a.push("feature");return a}():["feature"];var c=n(a.Ma)?this.Qa(a.Ma):this.infos[a.tabIndex];if(null==c)return cosnole.error("impossible de trouver la tab, tab_options:",a),0;a=n(b.ji)?b.ji:function(){var a=[],c;for(c in b.data)a.push({field:c,
title:c,sortable:!0,visible:!Ma(b.ae,c)});return a}();for(var d=0;d<c.tableParams.data.length;d++){bRowExists=!0;for(var e=0;e<a.length;e++)"feature"!==a[e].field&&!1===eb(c.tableParams.data[d],b.data[a[e].field])&&(bRowExists=!1);if(!0===bRowExists)return A.log("ligne d\u00e9j\u00e0 existante"),"ligne d\u00e9j\u00e0 existante"}for(d=0;d<a.length;d++){for(var f=!1,e=0;e<c.tableParams.columns.length;e++)c.tableParams.columns[e].field===a[d].field&&(f=!0);!1===f&&Oa(c.tableParams.columns,a[d])}a={};
for(var g in b.data)a[g]=r(b.data[g])?b.data[g].replace(/</g,"&lt;").replace(/>/g,"&gt;"):b.data[g];Oa(c.tableParams.data,a);return!0};l.xm=function(){var a=this;this.$timeout(function(){yx(a)})};
l.wj=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.addInfos");if(void 0===a)return 0;if(0===this.infos.length)return this.Ch(a);for(var b=0;b<a.length;b++){for(var c=!1,d=0;d<this.infos.length;d++)if(this.infos[d].tabCode===a[b].tabCode)for(var c=!0,e=0;e<a[b].tableParams.data.length;e++)Oa(this.infos[d].tableParams.data,a[b].tableParams.data[e]);!1===c&&Oa(this.infos,a[b])}var f=this;this.$timeout(function(){yx(f)})};
l.Ch=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.setInfos");if(void 0===a)return 0;this.infos=a;var b=this;this.$timeout(function(){yx(b)})};
l.Vp=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.removeTabRows");if(void 0===a)return 0;$("body").css({cursor:"wait"});a=this.Qa(a);for(var b={},c=a.tableParams.data.length-1;0<=c;c--)b=a.tableParams.data[c],Ma(A.g().ee.v().wa(),b.feature)&&A.g().ee.v().fc(b.feature),a.tableParams.data.splice(c,1);$("body").css({cursor:""});var d=this;this.$timeout(function(){yx(d)})};U.prototype.yb.prototype.removeTabRows=U.prototype.yb.prototype.Vp;
U.prototype.yb.prototype.St=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.removeTabByNam");for(var b=this.infos,c=b.length-1;0<=c;c--)b[c].tabCode===a&&(this.Vp(a),b.splice(c,1))};U.prototype.yb.prototype.removeTabByCode=U.prototype.yb.prototype.St;
U.prototype.yb.prototype.Vk=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.zoomOnTabFeatures");if(!n(a))return"tabCode not defined";var b=[];a=this.Qa(a).tableParams.data;for(var c=a.length-1;0<=c;c--)n(a[c].feature)&&Oa(b,a[c].feature);A.g().Vz(b,!1,!0)};U.prototype.yb.prototype.zoomOnTabFeatures=U.prototype.yb.prototype.Vk;
U.prototype.yb.prototype.Ze=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.displayTabFeatures");if(!n(a))return"tabCode not defined";var b=[];a=this.Qa(a).tableParams.data;for(var c=a.length-1;0<=c;c--)n(a[c].feature)&&Oa(b,a[c].feature);if(0===b.length)return 0;for(c=b.length-1;0<=c;c--)Ma(A.g().ee.v().wa(),b[c])&&A.g().ee.v().fc(b[c]),A.g().ee.v().Gc(b[c])};U.prototype.yb.prototype.displayTabFeatures=U.prototype.yb.prototype.Ze;
function yx(a){A.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.loadTables");for(var b=a.infos.length-1;0<=b;b--)$("#infocontainer-table-"+b).bootstrapTable("destroy"),$("#infocontainer-table-"+b).bootstrapTable(a.infos[b].tableParams),$("#infocontainer-table-"+b).bootstrapTable("load",a.infos[b].tableParams),$("#infocontainer-table-"+b).bootstrapTable("resetView",a.infos[b].tableParams),$("#infocontainer-table-"+b).bootstrapTable("resetWidth")}
U.prototype.yb.prototype.XI=function(a){A.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.setReports");var b=this;q(this.avaliablePrintReports)?this.avaliablePrintReports.length=0:this.avaliablePrintReports=[];if(null==a)return $.notify("Aucun rapport disponible","warning"),0;cd();z({method:"GET",url:A.properties.api_url+"/vmap/printreports",headers:{Accept:"application/x-vm-json"},params:{attributs:"name|printreport_id|business_object_id|business_object_id_field|multiobject",filter:{column:"business_object_id",
compare_operator:"=",value:a}},scope:this.b,success:function(c){if(null==c.data)return console.error("response.data undefined: ",c),$("#infocontainer-dropdown-reports").dropdown("toggle"),0;if(null==c.data.data)return $.notify("Aucun rapport disponible pour "+a,"warning"),$("#infocontainer-dropdown-reports").dropdown("toggle"),0;b.avaliablePrintReports=c.data.data}})};U.prototype.yb.prototype.setAvaliablePrintReports=U.prototype.yb.prototype.XI;
U.prototype.yb.prototype.so=function(a,b){A.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.generatePrintReport");b=$("#infocontainer-table-"+b).bootstrapTable("getSelections");if(!q(b))return $.notify("Impossible de r\u00e9cup\u00e9rer la s\u00e9lection du tableau"),0;if(0>=b.length)return $.notify("Aucun \u00e9l\u00e9ment s\u00e9lectionn\u00e9"),0;for(var c=[],d=0;d<b.length;d++)null!=b[d][a.business_object_id_field]&&c.push(b[d][a.business_object_id_field]);if(0< !c.length)return $.notify("G\u00e9n\u00e9ration du document impossible"),
console.error("generated aIds is empty"),0;A.so({printReportId:a.printreport_id,ids:c})};U.prototype.yb.prototype.generatePrintReport=U.prototype.yb.prototype.so;A.module.directive("appInfocontainer",U.prototype.Ox);A.module.controller("AppInfocontainerController",U.prototype.yb);fv.lm={};
function V(a){A.log("nsVmap.nsToolsManager.nsModules.Draw");a=n(a)?a:{};this.fields_=[{name:"Nom",id:"Nom",type:"text",required:"true",value:""},{name:"Th\u00e8me / Projet",id:"theme",type:"text",required:"false",value:""},{name:"Commentaire",id:"commentaire",type:"text",required:"false",value:""},{name:"Afficher l'\u00e9tiquette",id:"ShowName",type:"boolean",required:"",value:""},{name:"Afficher la partie vectorielle",id:"ShowVector",type:"boolean",required:"",value:""},{name:"Couleur de fond",id:"Fill",
type:"color",required:"false",value:"rgba(54,184,255,0.6)"},{name:"Couleur du contour",id:"Stroke",type:"color",required:"false",value:"rgba(0,0,0,0.4)"},{name:"Taille du contour",id:"StrokeSize",type:"number",required:"false",value:"2"},{name:"Couleur du texte",id:"Text",type:"color",required:"false",value:"rgba(0,0,0,1)"},{name:"Fond du texte",id:"TextBackground",type:"color",required:"false",value:"rgba(48,183,255,1)"},{name:"Taille du texte",id:"TextSize",type:"number",required:"false",value:"12"}];
this.features_=a.features}pa("nsVmap.nsToolsManager.nsModules.Draw",V);fv.lm.Draw=V;V.prototype.FD=function(){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawDirective");return{restrict:"C",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppdrawController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/modules/draw.html"}};
V.prototype.fa=function(){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController");this.fields_=A.F.us("Draw").qx();this.features_=A.F.us("Draw").wa();this.exportFormats_=["GeoJSON"];this.exportFormatsConstructors_=[Gp];this.pn=new hg(6378137);this.S=A.g().H;this.jf=To(A.g());this.Od=this.jf.v().Cb;this.xh=new gw({features:this.Od});this.fo=new vw({rb:[this.jf]});this.fo.on("select",function(){var a=this.fo.wa().R();this.eo(a[0]);this.fo.wa().clear()},this);this.jq=new vw({rb:[this.jf]});
this.jq.on("select",function(){var a=this.jq.wa().R();this.Mr(a[0]);this.jq.wa().clear()},this);this.Ie=new vw({rb:[this.jf],Vb:si});this.Ic=new vw({rb:[this.jf]});this.Ic.on("select",function(){var a=this.Ic.wa().R();this.Sp(a)},this);this.vi=document.getElementById("geodesic");void 0!==this.features_&&this.ai(this.features_)};V.prototype.drawController=V.prototype.fa;
function zx(a,b){a.mc&&a.mc.parentNode.removeChild(a.mc);a.mc=document.createElement("div");a.mc.className="draw-tooltip draw-tooltip-draw";a.oi=new Zo({element:a.mc,offset:[0,-15],pk:"bottom-center"});a.oi.set("type","draw");void 0!==b&&a.oi.set("feature",b);a.S.eg(a.oi)}
function Ax(a,b){if(void 0!==b.get("infoValues")){var c=0;zx(a,b);for(key in b.get("infoValues"))0==c&&(a.mc.innerHTML=b.get("infoValues")[key]),c++;a.oi.setPosition(a.Di(b.j()));a.mc.className="draw-tooltip draw-tooltip-static";ep(a.oi,[0,-7]);a.mc.style.color=b.get("infoValues").Text;a.mc.style.backgroundColor=b.get("infoValues").TextBackground;a.mc.style.fontSize=b.get("infoValues").TextSize;"false"===b.get("infoValues").ShowName&&(a.mc.style.opacity=0);"false"===b.get("infoValues").ShowVector&&
(a.mc.style.opacity=0);a.mc=null;zx(a,b);a.Gk();Bx()}}V.prototype.fa.prototype.Di=function(a){if("Polygon"===a.K())a=$g(Ch(a));else if("MultiPolygon"===a.K()){var b=new Bp(null);b.sa("XY",Io(a).slice());a=$g(b)}else if("LineString"===a.K())b=Math.round(a.ca().length/2),a=a.ca()[b];else if("Circle"===a.K())a=a.La();else if("Point"===a.K()||"MultiPoint"===a.K())a=$g(a);else return"GeometryCollection"===a.K()?0:$g(a);return a};
V.prototype.fa.prototype.bc=function(a){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.prototype.addInteraction");A.g().Ea.Ra("Cliquer pour commencer \u00e0 dessiner");this.nc=A.g().Jg({type:a,features:this.Od},"draw-draw"+a);this.nc.on("drawstart",function(){"Point"===a||"Circle"===a?A.g().Ea.Ra("Cliquez pour terminer le dessin"):"LineString"!==a&&"Polygon"!==a||A.g().Ea.Ra("Double-cliquez pour terminer le dessin")},this);this.nc.on("drawend",function(a){$("#draw-edit-modal-header").addClass("hidden");
this.hj(a.za);this.eo(a.za);A.g().Ea.hide();a.za.on("change",function(){aOverlays=A.g().H.Xc;for(var b=aOverlays.R().length-1;0<=b;b--)aOverlays.R()[b].get("feature")===a.za&&aOverlays.R()[b].setPosition(this.Di(a.za.j()));this.hj(a.za)},this)},this)};
V.prototype.fa.prototype.ai=function(a){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.prototype.addFeatures");for(var b=[ns,Gp,Ss,Zs,Xu],c=[],d=0;d<b.length;d++){var e=new b[d];try{var f=e.bj(a);0<f.length&&(c=f,d=b.length)}catch(h){}}for(d=0;d<c.length;d++){"Cercle"===c[d].get("Type")&&(a=c[d].get("Coordinates")[0],b=c[d].get("Coordinates")[1],e=new Ov([NaN,NaN]),Pv(e,a,b,"XY"),c[d].$c(e));this.jf.v().Gc(c[d]);Ax(this,c[d]);Cx(c[d]);var g=this;c[d].on("change",function(){aOverlays=
A.g().H.Xc;for(var a=aOverlays.R().length-1;0<=a;a--)aOverlays.R()[a].get("feature")===this&&aOverlays.R()[a].setPosition(g.Di(this.j()));g.hj(this)},c[d])}};V.prototype.fa.prototype.addFeatures=V.prototype.fa.prototype.ai;
V.prototype.fa.prototype.Nt=function(a){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.prototype.removeFeatures");for(var b=a.length-1;0<=b;b--){aOverlays=A.g().H.Xc.R();aDrawsToDelete=[];for(var c=aOverlays.length-1;0<=c;c--)aOverlays[c].get("feature")!==a[b]&&"info"!==aOverlays[c].get("feature")||aDrawsToDelete.push(aOverlays[c]);for(c=aDrawsToDelete.length-1;0<=c;c--)A.g().H.Xc.remove(aDrawsToDelete[c]);this.jf.v().fc(a[b]);Bx()}a=this.Od.R();for(b=0;b<a.length;b++)a[b].set("Id",
b)};V.prototype.fa.prototype.removeFeatures=V.prototype.fa.prototype.Nt;
V.prototype.fa.prototype.Sp=function(a){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.prototype.removeFeaturesWithControl");var b=0,c=[],d=[],e=this,f="",g=D(this.S).La(),h=D(this.S).Gf();1===a.length&&this.rn(a[0]);for(var k=0;k<a.length;k++)for(key in b=0,d.push(a[k].get("Id")),a[k].get("infoValues"))0===b&&c.push(a[k].get("infoValues")[key]),b++;b="";if(1===c.length)b="<h4>Etes-vous certain de vouloir supprimer le dessin: <br><br> Id: "+d[0]+", Nom: "+c[0]+" ?</h4>";else if(1<
c.length){for(k=0;k<c.length;k++)f+="<br> Id: "+d[k]+", Nom: "+c[k]+"";b="<h4>Etes-vous certain de vouloir supprimer les dessins ci-dessous ? <br>"+f+" </h4>"}else return;bootbox.confirm(b,function(b){!0===b&&e.Nt(a);D(e.S).ub(g);D(e.S).Fh(h)})};V.prototype.fa.prototype.removeFeaturesWithControl=V.prototype.fa.prototype.Sp;
V.prototype.fa.prototype.vI=function(){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.removeSelectedFeatures");for(var a=$.map($("#draw-features-list-table").bootstrapTable("getSelections"),function(a){return a.column1}),b=[],c=this.Od.R(),d=0;d<a.length;d++)b.push(c[a[d]]);this.Sp(b)};V.prototype.fa.prototype.removeSelectedFeatures=V.prototype.fa.prototype.vI;
V.prototype.fa.prototype.IC=function(a){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.prototype.calcelEditFeature");void 0===a.get("infoValues")&&this.Nt([a]);Bx()};V.prototype.fa.prototype.calcelEditFeature=V.prototype.fa.prototype.IC;
function Cx(a){if(void 0!==a.get("infoValues")){var b=a.get("infoValues").Fill,c=a.get("infoValues").Stroke,d=a.get("infoValues").StrokeSize,e;"false"===a.get("infoValues").ShowVector&&(c=b="rgba(255, 255, 255, 0)");""===b||void 0===b?(b="rgba(54,184,255,0.6)",e="rgba(255,255,255,1)"):e=b;if(""===c||void 0===c)c="rgba(255,255,255,1)";if(""===d||void 0===d)d=2;a.xd(new Dn({fill:new Cn({color:b}),stroke:new gl({color:c,width:d}),Lb:new Bn({tb:7,fill:new Cn({color:e}),stroke:new gl({color:c,width:d})})}))}}
V.prototype.fa.prototype.hj=function(a){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.setInfosToFeature");if(void 0===a.get("Id")){var b=this.Od.Xb();a.set("Id",b)}a.set(this.fields_[0].name,"");if(a.j()instanceof rh)a.set("Type","Point"),a.set("P\u00e9rim\u00e8tre/longueur","-"),a.set("Superficie","-"),a.set("Coordinates",a.j().ca());else if(a.j()instanceof xp)a.set("Type","Ligne"),a.set("P\u00e9rim\u00e8tre/longueur",this.Df(a.j())),a.set("Superficie","-"),a.set("Coordinates",
a.j().ca());else if(a.j()instanceof zh)a.set("Type","Polygone"),a.set("P\u00e9rim\u00e8tre/longueur",this.as(a.j())),a.set("Superficie",this.oo(a.j())),a.set("Coordinates",a.j().ca());else if(a.j()instanceof Ov){var c=parseFloat(this.Lj(a.j())),b=this.Lj(a.j()).replace(c,""),d=Math.PI*c*2,c=Math.PI*Math.pow(c,2);a.set("Type","Cercle");a.set("P\u00e9rim\u00e8tre/longueur",d.toFixed(4)+b);a.set("Superficie",c.toFixed(4)+b+"\u00b2");a.set("Coordinates",[a.j().La(),a.j().bf()])}else a.set("Type","undefined"),
a.set("P\u00e9rim\u00e8tre/longueur","-"),a.set("Superficie","-")};V.prototype.fa.prototype.setInfosToFeature=V.prototype.fa.prototype.hj;
V.prototype.fa.prototype.KK=function(a,b){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.prototype.updateFeatureInfos");$(".modal").modal("hide");for(var c={},d=A.g().H.Xc,e,f,g,h,k,m,p,t,v=0;v<this.fields_.length;v++)"Fill"===this.fields_[v].id?e=$("#print-"+b[v].id+"-input").val():"Stroke"===this.fields_[v].id?f=$("#print-"+b[v].id+"-input").val():"Text"===this.fields_[v].id?g=$("#print-"+b[v].id+"-input").val():"TextBackground"===this.fields_[v].id?h=$("#print-"+b[v].id+"-input").val():
"TextSize"===this.fields_[v].id?k=$("#print-"+b[v].id+"-input").val():"StrokeSize"===this.fields_[v].id?m=$("#print-"+b[v].id+"-input").val():"ShowName"===this.fields_[v].id?(p=$("#print-"+b[v].id+"-input")[0].checked,$("#print-"+b[v].id+"-input").val(p)):"ShowVector"===this.fields_[v].id&&(t=$("#print-"+b[v].id+"-input")[0].checked,$("#print-"+b[v].id+"-input").val(t));!1===t&&(f=e="rgba(255, 255, 255, 0)",p=!1);""===e?(e="rgba(54,184,255,0.6)",t="rgba(255,255,255,1)"):t=e;""===f&&(f="rgba(255,255,255,1)");
""===m&&(m=2);a.xd(new Dn({fill:new Cn({color:e}),stroke:new gl({color:f,width:parseFloat(m)}),Lb:new Bn({tb:7,fill:new Cn({color:t}),stroke:new gl({color:f,width:parseFloat(m)})})}));for(v=d.R().length-1;0<=v;v--)d.R()[v].get("feature")===a&&d.remove(d.R()[v]);zx(this,a);for(v=0;v<b.length;v++)0===v&&(this.mc.innerHTML=$("#print-"+b[v].id+"-input").val(),a.set(b[v].name,$("#print-"+b[v].id+"-input").val())),c[b[v].id]=$("#print-"+b[v].id+"-input").val();a.set("infoValues",c);this.oi.setPosition(this.Di(a.j()));
this.mc.className="draw-tooltip draw-tooltip-static";ep(this.oi,[0,-7]);this.mc.style.color=g;this.mc.style.backgroundColor=h;this.mc.style.fontSize=k;!1===p&&(this.mc.style.opacity=0);this.mc=null;zx(this,a);this.Gk();Bx();A.log("updateFeatureInfos done")};V.prototype.fa.prototype.updateFeatureInfos=V.prototype.fa.prototype.KK;l=V.prototype.fa.prototype;
l.Df=function(a){this.vi.checked&&"EPSG:3857"==D(this.S).D().V||"EPSG:4326"==D(this.S).D().V?(a=a.ca(),a=this.hl(a)):a=a.Xb();return 1E3<a?Math.round(a/1E3*100)/100+" km":Math.round(100*a)/100+" m"};l.hl=function(a){length=0;for(var b=D(this.S).D(),c=0,d=a.length-1;c<d;++c){var e=Rg(a[c],b,"EPSG:4326"),f=Rg(a[c+1],b,"EPSG:4326");length+=jg(this.pn,e,f)}return length};l.ix=function(a){return output=[a.ca()[0].toFixed(4),a.ca()[1].toFixed(4)]};
l.Lj=function(a){this.vi.checked&&"EPSG:3857"==D(this.S).D().V||"EPSG:4326"==D(this.S).D().V?(a=[Zg(a),$g(a)],a=this.hl(a)):a=Math.round(100*a.bf())/100;return 1E3<a?Math.round(a/1E3*100)/100+" km":Math.round(100*a)/100+" m"};l.as=function(a){a=new xp(a.ca()[0],a.Ua);return output=this.Df(a)};
l.oo=function(a){if(this.vi.checked&&"EPSG:3857"==D(this.S).D().V||"EPSG:4326"==D(this.S).D().V){var b=D(this.S).D();a=Dh(a.clone().transform(b,"EPSG:4326")).ca();a=Math.abs(ig(this.pn,a))}else a=a.Nj();return 1E6<a?Math.round(a/1E6*100)/100+" km\u00b2":Math.round(100*a)/100+" m\u00b2"};
l.rn=function(a){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.zoomToFeature");"Point"===a.get("Type")?D(this.S).ub(a.j().ca()):"Cercle"===a.get("Type")?(Th(D(this.S),a.j(),{padding:[0,0,0,0]}),D(this.S).ub(a.j().La())):Th(D(this.S),a.j(),{padding:[0,0,0,0]})};V.prototype.fa.prototype.zoomToFeature=V.prototype.fa.prototype.rn;
function Dx(a){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.initExportFeatureButtons");var b=a.Od.R(),c=a.exportFormats_;a=a.exportFormatsConstructors_;for(var d=D(A.g().H).D().V,e="",f=0;f<c.length;f++)for(f=0;f<a.length;f++){var g=new a[f];try{e=g.qn(b,{Wd:d,Kc:d});e=e.replace(/{/g,"{\n");e=e.replace(/}/g,"\n}");if(0==$("#draw-export-"+c[f]+"-button").length){var h=document.createElement("li"),k=document.createElement("a");k.setAttribute("id","draw-export-"+c[f]+"-button");
k.setAttribute("download","Features.json");h.appendChild(k);k.appendChild(document.createTextNode(c[f]));$("#draw-features-list-table").parents(".bootstrap-table").find(".export").find("ul")[0].appendChild(h)}$("#draw-export-"+c[f]+"-button").attr("href","data:text/csv;charset=utf-8,"+encodeURIComponent(e))}catch(m){}}}
V.prototype.fa.prototype.Mr=function(a){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.displayFeatureInfos");this.selectedFeature=a;for(var b=[],c=0;c<this.fields_.length;c++)b.push({field:this.fields_[c].name,result:a.get("infoValues")[this.fields_[c].id]});$("#draw-feature-description-table").bootstrapTable({columns:[{field:"field",title:"",sortable:!0,cellStyle:function(){return{classes:"active bold"}}},{field:"result",title:"",sortable:!0}],data:b,search:!0,showHeader:!1,
showExport:"true",height:.6*$("#feature-description-modal").height(),rowStyle:function(){return{classes:["active","success"]}}});$("#draw-feature-description-table").bootstrapTable("load",b);$(".modal").modal("hide");$("#feature-description-modal").modal("show")};V.prototype.fa.prototype.displayFeatureInfos=V.prototype.fa.prototype.Mr;
V.prototype.fa.prototype.eo=function(a){function b(a){$("#print-"+c.fields_[a].id+"-input").colorpicker({format:"rgba",color:$("#print-"+c.fields_[a].id+"-input").val()}).on("changeColor",function(){$(this).parent().find(".color-span2").css("background-color",$(this).val())});$("#print-"+c.fields_[a].id+"-input").parent().find(".color-span2").css("background-color",$("#print-"+c.fields_[a].id+"-input").val())}A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.editFeatureInfos");
for(var c=this,d=0;d<this.fields_.length;d++)void 0!=a.get("infoValues")?($("#print-"+this.fields_[d].id+"-input").val(a.get("infoValues")[this.fields_[d].id]),"color"==this.fields_[d].type?b(d):"boolean"==this.fields_[d].type&&("false"==a.get("infoValues")[this.fields_[d].id]?$("#print-"+this.fields_[d].id+"-input").bootstrapToggle("off"):$("#print-"+this.fields_[d].id+"-input").bootstrapToggle("on"))):void 0!=this.fields_[d].value?($("#print-"+this.fields_[d].id+"-input").val(this.fields_[d].value),
"color"==this.fields_[d].type?b(d):"boolean"==this.fields_[d].type&&("false"==[this.fields_[d].value]?$("#print-"+this.fields_[d].id+"-input").bootstrapToggle("off"):$("#print-"+this.fields_[d].id+"-input").bootstrapToggle("on"))):($("#print-"+this.fields_[d].id+"-input").val(""),"boolean"==this.fields_[d].type&&$("#print-"+this.fields_[d].id+"-input").bootstrapToggle("on"),$(".colorpicker").colorpicker({format:"rgba"}).on("changeColor",function(){$(this).parent().find(".color-span2").css("background-color",
$(this).val())}));this.selectedFeature=a;$(".modal").modal("hide");$("#feature-edit-modal").modal("show");$(".bootstrap-toggle").bootstrapToggle()};V.prototype.fa.prototype.editFeatureInfos=V.prototype.fa.prototype.eo;
V.prototype.fa.prototype.oD=function(){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.displayFeaturesList");var a=this,b=this.Od.R(),c=[];this.sketchesLenght=b.length;if(0===b.length)$(".modal").modal("hide"),$("#draw-features-list-modal").modal("show"),$("#draw-features-list-table").bootstrapTable("load",[]);else{for(var d=b[0].Co(),e=[{field:"state",checkbox:!0},{field:"action",formatter:function(){return'<a class="show-feature margin-sides-5" href="javascript:void(0)" title="Voir"><i class="glyphicon glyphicon-search"></i></a><a class="edit-feature margin-sides-5" href="javascript:void(0)" title="Editer"><i class="glyphicon glyphicon-edit"></i></a><a class="zoom-to-feature margin-sides-5" href="javascript:void(0)" title="Voir sur la carte"><i class="glyphicon glyphicon-globe"></i></a><a class="remove-feature margin-sides-5" href="javascript:void(0)" title="Supprimer"><i class="glyphicon glyphicon-trash"></i></a>'},
events:{"click .show-feature":function(c,d,e){a.Mr(b[e.column1])},"click .edit-feature":function(c,d,e){a.eo(b[e.column1])},"click .zoom-to-feature":function(c,d,e){$(".modal").modal("hide");a.rn(b[e.column1])},"click .remove-feature":function(c,d,e){$(".modal").modal("hide");a.Sp([b[e.column1]])}},"class":"draw-features-list-button-column"}],c=[],f=0;f<b.length;f++){for(var g={},h=0;h<d.length;h++)"geometry"!==d[h]&&"infoValues"!==d[h]&&"tooltip"!==d[h]&&"infoKeys"!==d[h]&&(0===f&&("Coordinates"!==
d[h]?e.push({field:"column"+h,title:d[h],sortable:!0}):e.push({field:"column"+h,title:d[h],sortable:!0,visible:!1})),g["column"+h]=b[f].get(d[h]));c.push(g);delete g}$("#draw-features-list-table").bootstrapTable({columns:e,data:c,search:!0,showColumns:!0,showExport:"true",height:.6*$("#feature-description-modal").height(),rowStyle:function(){return{classes:["active","success"]}}});$("#draw-features-list-table").bootstrapTable("load",c);$(".modal").modal("hide");$("#draw-features-list-modal").modal("show");
Dx(this)}};V.prototype.fa.prototype.displayFeaturesList=V.prototype.fa.prototype.oD;V.prototype.fa.prototype.Gk=function(){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.showHideAnotations");document.getElementById("draw-anotations").checked?$(".draw-tooltip-static").show():$(".draw-tooltip-static").hide()};V.prototype.fa.prototype.showHideAnotations=V.prototype.fa.prototype.Gk;
V.prototype.fa.prototype.bh=function(a){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.drawPoint");Bx();a||this.bc("Point")};V.prototype.fa.prototype.drawPoint=V.prototype.fa.prototype.bh;V.prototype.fa.prototype.GD=function(a){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.drawLine");Bx();a||this.bc("LineString")};V.prototype.fa.prototype.drawLine=V.prototype.fa.prototype.GD;
V.prototype.fa.prototype.Al=function(a){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.drawPolygon");Bx();a||this.bc("Polygon")};V.prototype.fa.prototype.drawPolygon=V.prototype.fa.prototype.Al;V.prototype.fa.prototype.zl=function(a){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.drawCircle");Bx();a||this.bc("Circle")};V.prototype.fa.prototype.drawCircle=V.prototype.fa.prototype.zl;
V.prototype.fa.prototype.kt=function(a){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.modifyFeature");Bx();a||(A.g().Ea.Ra("Cliquez sur un dessin pour le modifier"),Po(A.g(),this.xh,"draw-modifyFeature"))};V.prototype.fa.prototype.modifyFeature=V.prototype.fa.prototype.kt;
V.prototype.fa.prototype.ID=function(a){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.modifyFeature");Bx();a||(A.g().Ea.Ra("Cliquez sur un dessin pour \u00e9diter les infos"),Po(A.g(),this.fo,"draw-editInfosFeature"))};V.prototype.fa.prototype.editInfosClick=V.prototype.fa.prototype.ID;
V.prototype.fa.prototype.wJ=function(a){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.showInfosClick");Bx();a||(A.g().Ea.Ra("Cliquez sur un dessin pour voir les infos"),Po(A.g(),this.jq,"showInfosFeature"))};V.prototype.fa.prototype.showInfosClick=V.prototype.fa.prototype.wJ;
V.prototype.fa.prototype.Jr=function(a){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.deleteFeature");Bx();a||(A.g().Ea.Ra("Cliquez sur un dessin pour le supprimer"),Po(A.g(),this.Ic,"draw-deleteFeature"))};V.prototype.fa.prototype.deleteFeature=V.prototype.fa.prototype.Jr;
V.prototype.fa.prototype.Ir=function(){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.deleteAllFeatures");Bx();this.Od.clear();for(var a=A.g().H.Xc.R(),b=[],c=a.length-1;0<=c;c--)"draw"===a[c].get("type")&&b.push(a[c]);for(c=b.length-1;0<=c;c--)A.g().H.Xc.remove(b[c]);aFeatures=this.Od.R();for(c=0;c<aFeatures.length;c++)aFeatures[c].set("Id",c)};V.prototype.fa.prototype.deleteAllFeatures=V.prototype.fa.prototype.Ir;
function Bx(){A.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.removeDrawsInteractions");A.g().Ea.hide();A.g().Ge()}A.module.directive("appDraw",V.prototype.FD);A.module.controller("AppdrawController",V.prototype.fa);V.prototype.qx=function(){return this.fields_};V.prototype.getFields=V.prototype.qx;V.prototype.bJ=function(a){this.fields_=a};V.prototype.setFields=V.prototype.bJ;V.prototype.wa=function(){return this.features_};V.prototype.getFeatures=V.prototype.wa;
V.prototype.aJ=function(a){this.features_=a};V.prototype.setFeatures=V.prototype.aJ;function W(){A.log("nsVmap.nsToolsManager.nsModules.Cadastre")}pa("nsVmap.nsToolsManager.nsModules.Cadastre",W);fv.lm.Cadastre=W;W.prototype.SJ=function(a){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.tableCheckAll");$(a).bootstrapTable("checkAll");$(a).bootstrapTable("toggleView");$(a).bootstrapTable("toggleView")};W.prototype.tableCheckAll=W.prototype.SJ;
W.prototype.UJ=function(a){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.tableCheckAll");$(a).bootstrapTable("uncheckAll");$(a).bootstrapTable("toggleView");$(a).bootstrapTable("toggleView")};W.prototype.tableUncheckAll=W.prototype.UJ;
W.prototype.HC=function(){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreDirective");return{restrict:"C",scope:{map:"=appMap",lang:"=appLang",selection:"=appInfos",currentAction:"=appAction"},controller:"AppcadastreController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/modules/cadastre.html"}};
W.prototype.s=function(a,b){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController");this.Oi=100;null!=A.properties.cadastre&&null!=A.properties.cadastre.selection_limit&&(this.Oi=A.properties.cadastre.selection_limit);this.In=A.properties.cadastre.selection_buffer;this.isCadastreLightUser=-1===sessionStorage.privileges.indexOf("vmap_cadastre_user")&&-1!==sessionStorage.privileges.indexOf("vmap_cadastre_light_user");this.tmpID_DNUPRO=this.tmpID_PAR=this.searchOnMapCurrentDrawMode=
this.searchOnMapCurrentMode=this.currentParcelleMode=this.currentMode="";this.b=a;this.oParcelleInfos={};this.aCommunes=[];this.aSections=[];this.aAdresses=[];this.locationMultiple=!1;this.tablesSelection={"#Cadastre-rapports-table-parcelle":[],"#Cadastre-rapports-table-comptes":[]};this.Aa=[];this.tf=0;this.ow=A.properties.cadastre.database_projection;this.cadastreAPI_=A.properties.cadastre.api;this.kx(A.properties.cadastre.api+"/communes","aCommunes","","nom");$("#Section-table-section").bootstrapTable({data:{}});
$("#Lieu-dit-table-lieu-dit").bootstrapTable({data:{}});$("#Parcelle-table-parcelle").bootstrapTable({data:{}});$("#Parcelle-par-proprietaire-table-comptes").bootstrapTable({data:{}});$("#Parcelle-par-proprietaire-table-parcelles").bootstrapTable({data:{}});$("#Bati-par-proprietaire-table-comptes").bootstrapTable({data:{}});$("#Bati-par-proprietaire-table-invariants").bootstrapTable({data:{}});$("#Bati-par-proprietaire-table-parcelles").bootstrapTable({data:{}});$(".dropdown-menu-auto li a").click(function(){var a=
$(this).text();$(this).parents(".btn-group").find(".dropdown-toggle").find("div").html(a);$(".inactive").removeClass("active")});a.parseFloat=function(a){return parseFloat(a)};a.trim=function(a){return a.trim()};a.isLink=function(a){return A.Ss(a,"link")};a.getRenderedParsedLink=function(a){a=A.Bt(a,"link");return b.trustAsHtml(a)}};W.prototype.cadastreController=W.prototype.s;W.prototype.s.$inject=["$scope","$sce"];
W.prototype.s.prototype.pe=function(a){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addToCard");A.log("addToCard: "+a);var b=this;setTimeout(function(){"commune"===a?b.Uz("#Commune-select-commune"):"section"===a?b.$z("#Section-select-commune","#Section-table-section"):"lieuDit"===a?b.Wz("#Lieu-dit-select-commune","#Lieu-dit-table-lieu-dit"):"parcelle"===a?(A.log("addToCard: "+b.currentParcelleMode),"section"===b.currentParcelleMode?b.Zz("#Parcelle-select-commune",
"#Parcelle-select-section","#Parcelle-table-parcelle"):"adresse"===b.currentParcelleMode?b.Xz("#Parcelle-par-adresse-DGFiP-select-commune","#Parcelle-par-adresse-DGFiP-table-voie","#Parcelle-par-adresse-DGFiP-select-adresse"):"proprietaire"===b.currentParcelleMode&&b.Yz("#Parcelle-par-proprietaire-select-commune","#Parcelle-par-proprietaire-table-proprietaire","#Parcelle-par-proprietaire-table-comptes","#Parcelle-par-proprietaire-table-parcelles")):"bati"===a&&b.Tz("#Bati-par-proprietaire-select-commune",
"#Bati-par-proprietaire-table-proprietaire","#Bati-par-proprietaire-table-comptes","#Bati-par-proprietaire-table-invariants","#Bati-par-proprietaire-table-parcelles")},100)};W.prototype.s.prototype.addToCard=W.prototype.s.prototype.pe;
W.prototype.s.prototype.AG=function(a){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.locateSelection");"commune"===a?this.et(A.properties.cadastre.api+"/communes","id_com","#Commune-select-commune"):"section"===a?this.ck(A.properties.cadastre.api+"/sections","id_sec","#Section-table-section"):"lieuDit"===a?this.ck(A.properties.cadastre.api+"/lieudits","oid","#Lieu-dit-table-lieu-dit"):"parcelle"===a?(A.log(this.currentParcelleMode),"section"===this.currentParcelleMode?
this.ck(A.properties.cadastre.api+"/parcelles","id_par","#Parcelle-table-parcelle"):"adresse"===this.currentParcelleMode?(A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.localiseParcelleByAdresse"),""!==$("#Parcelle-par-adresse-DGFiP-select-adresse").val()?this.et(A.properties.cadastre.api+"/parcelles","id_par","#Parcelle-par-adresse-DGFiP-select-adresse"):0<$("#Parcelle-par-adresse-DGFiP-table-voie").bootstrapTable("getAllSelections").length&&this.ly(A.properties.cadastre.api+
"/parcelles","id_par",this.aAdresses,"ID_PAR")):"proprietaire"===this.currentParcelleMode&&this.ck(A.properties.cadastre.api+"/parcelles","id_par","#Parcelle-par-proprietaire-table-parcelles","ID_PAR")):"bati"===a&&this.ck(A.properties.cadastre.api+"/parcelles","id_par","#Bati-par-proprietaire-table-parcelles")};W.prototype.s.prototype.locateSelection=W.prototype.s.prototype.AG;
W.prototype.s.prototype.UI=function(){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectLocation");for(var a=A.g().Vi.R(),b="",c={commune:[],section:[],lieuDit:[],parcelle:[],bati:[]},d=0;d<a.length;d++)b=a[d].get("type"),c[b].push(a[d]);for(var e in c)if(0<c[e].length){for(d=0;d<c[e].length;d++)c[e][d]=c[e][d].get("infos");"commune"===e?(void 0===A.F.M.Qa("veremes_cadastre_commune")&&A.F.M.Wa({Ma:"veremes_cadastre_commune",lb:"Commune",Fa:["zoom","delete"]}),
this.fg(A.properties.cadastre.api+"/communes","id_com",c[e],"id_com","veremes_cadastre_commune",function(){A.F.M.Ke();A.F.M.Ze("veremes_cadastre_commune")})):"section"===e?(void 0===A.F.M.Qa("veremes_cadastre_section")&&A.F.M.Wa({Ma:"veremes_cadastre_section",lb:"Section",Fa:["zoom","delete"]}),this.fg(A.properties.cadastre.api+"/sections","id_sec",c[e],"id_sec","veremes_cadastre_section",function(){A.F.M.Ke();A.F.M.Ze("veremes_cadastre_section")})):"lieuDit"===e?(void 0===A.F.M.Qa("veremes_cadastre_lieu_dit")&&
A.F.M.Wa({Ma:"veremes_cadastre_lieu_dit",lb:"Lieu-dit",Fa:["zoom","delete"]}),this.fg(A.properties.cadastre.api+"/lieudits","oid",c[e],"oid","veremes_cadastre_lieu_dit",function(){A.F.M.Ke();A.F.M.Ze("veremes_cadastre_lieu_dit")})):"parcelle"===e?(void 0===A.F.M.Qa("veremes_cadastre_parcelle")&&A.F.M.Wa({Ma:"veremes_cadastre_parcelle",lb:"Parcelle",Fa:["zoom","delete"]}),this.fg(A.properties.cadastre.api+"/parcelles","id_par",c[e],"id_par","veremes_cadastre_parcelle",function(){A.F.M.Ke();A.F.M.Ze("veremes_cadastre_parcelle")})):
"bati"===e&&(void 0===A.F.M.Qa("veremes_cadastre_parcelle")&&A.F.M.Wa({Ma:"veremes_cadastre_parcelle",lb:"Parcelle",Fa:["zoom","delete"]}),void 0===A.F.M.Qa("veremes_cadastre_invariant")&&A.F.M.Wa({Ma:"veremes_cadastre_invariant",lb:"Invariant",Fa:["delete"]}),this.fg(A.properties.cadastre.api+"/invariants","ID_PAR",c[e],"id_par","veremes_cadastre_invariant",function(){A.F.M.Ke();A.F.M.Ze("veremes_cadastre_invariant");A.F.M.Xd("veremes_cadastre_invariant")}),this.fg(A.properties.cadastre.api+"/parcelles",
"id_par",c[e],"id_par","veremes_cadastre_parcelle",function(){A.F.M.Ke();A.F.M.Ze("veremes_cadastre_parcelle");A.F.M.Xd("veremes_cadastre_invariant")}))}};W.prototype.s.prototype.selectLocation=W.prototype.s.prototype.UI;
W.prototype.s.prototype.my=function(a,b){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.locateCadastreOnMap");Ex();if(b||""===this.searchOnMapCurrentMode)return 0;"Point"===a?(A.g().Ea.Ra("Cliquer sur un point pour s\u00e9lectionner"),A.g().Bk("singleclick",this.yG,this,"cadastre-selectBy"+a)):"LineString"===a?(A.g().Ea.Ra("Dessiner une ligne pour s\u00e9lectionner"),Fx(this,"LineString")):"Polygon"===a?(A.g().Ea.Ra("Dessiner un polygone pour s\u00e9lectionner"),
Fx(this,"Polygon")):"Circle"===a&&(A.g().Ea.Ra("Dessiner un cercle pour s\u00e9lectionner"),Fx(this,"Circle"))};W.prototype.s.prototype.locateCadastreOnMap=W.prototype.s.prototype.my;
W.prototype.s.prototype.SI=function(a,b){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectCadastreOnMap");Ex();if(b)return 0;"FicheDescriptive"===a&&(this.searchOnMapCurrentMode="FicheDescriptive",A.g().Ea.Ra("Cliquer sur un point pour g\u00e9n\u00e9rer la fiche descriptive"),A.g().Bk("singleclick",function(a){Gx(this,a,"ficheDescriptive")},this,"cadastre-"+a));"ReleveDePropriete"===a&&(this.searchOnMapCurrentMode="ReleveDePropriete",A.g().Ea.Ra("Cliquer sur un point pour g\u00e9n\u00e9rer le relev\u00e9 de propri\u00e9t\u00e9"),
A.g().Bk("singleclick",function(a){Gx(this,a,"releveDePropriete")},this,"cadastre-"+a));"FicheUrbanisme"===a&&(this.searchOnMapCurrentMode="FicheUrbanisme",A.g().Ea.Ra("Cliquer sur un point pour g\u00e9n\u00e9rer la fiche d'urbanisme"),A.g().Bk("singleclick",function(a){Gx(this,a,"ficheUrbanisme")},this,"cadastre-"+a))};W.prototype.s.prototype.selectCadastreOnMap=W.prototype.s.prototype.SI;
function Gx(a,b,c){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectRapportOnMap");var d=new rh(b.Qb),d=A.pg(d);a.tmpID_PAR="";a.tmpID_DNUPRO="";var e=.01,e=A.g().fb(),e=a.In*e/1E3,d={column:"geom",compare_operator:"intersect",compare_operator_options:{source_proj:a.ow.substring(5),intersect_buffer:e,intersect_buffer_geom_type:"point"},value:d};cd();z({method:"GET",url:A.properties.api_url+"/"+A.properties.cadastre.api+"/parcelles",headers:{Accept:"application/x-vm-json"},
params:{filter:d,limit:1,result_srid:D(A.g().H).D().V.substring(5)},scope:a.b,success:function(d){A.g().kn.clear();if(!n(d.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;if(!n(d.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),A.g().wn("Pas de donn\u00e9es \u00e0 afficher",b.Qb),0;var e=d.data.data;e.length>=a.Oi&&bootbox.alert("<h4>Attention, vous avez atteint la limite d'objects affichables sur la carte</h4>");d=e[0].id_par;a.tmpID_PAR=d;!1===a.locationMultiple&&
A.g().Vi.clear();a.xj(e,"parcelle",!1);"ficheDescriptive"===c&&a.Nr(d);"releveDePropriete"===c&&$("#releve-propriete-modal-menu").modal("show");"ficheUrbanisme"===c&&a.Pr(d);e="cadastre"===a.cadastreAPI_?"ID_PAR":"id_par";cd();z({method:"GET",url:A.properties.api_url+"/"+A.properties.cadastre.api+"/descriptionparcelles",headers:{Accept:"application/x-vm-json"},params:{filter:{column:e,compare_operator:"=",value:d},limit:a.Oi,result_srid:D(A.g().H).D().V.substring(5)},scope:a.b,success:function(b){if(!n(b.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
0;b=b.data.data;b.length>=a.Oi&&$.notify("Attention, vous avez atteint la limite d'objects affichables sur la carte","warn");a.tmpID_DNUPRO=b[0].ID_DNUPRO}})}})}
function Hx(a,b,c,d){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.locateByWKTGeom");var e="",f=A.yi(b).K(),e=null;if("Point"===f||"LineString"===f)e=A.g().fb(),e=a.In*e/1E3;a.Aa.length=0;a.tf=0;b={column:"geom",compare_operator:"intersect",compare_operator_options:{source_proj:a.ow.substring(5)},value:b};null!=e&&(b.compare_operator_options.intersect_buffer=e,b.compare_operator_options.intersect_buffer_geom_type="point");if("commune"===c)e="communes";else if("section"===
c)e="sections";else if("lieuDit"===c)e="lieudits";else if("parcelle"===c)e="parcelles";else if("bati"===c)e="parcelles";else return;var g=a.Oi;"Point"===f&&(g=1);$("body").css({cursor:"wait"});z({method:"POST",url:A.properties.api_url+"/"+A.properties.cadastre.api+"/"+e,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{filter:b,limit:g,result_srid:D(A.g().H).D().V.substring(5)},scope:a.b,success:function(b){$("body").css({cursor:""});A.g().kn.clear();if(!n(b.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
A.g().wn("Pas de donn\u00e9es \u00e0 afficher",d),0;b=b.data.data;b.length>=a.Oi&&$.notify("Attention, vous avez atteint la limite d'objects affichables sur la carte","warn");!1===a.locationMultiple&&A.g().Vi.clear();a.xj(b,c,!1)},error:function(){$("body").css({cursor:""})}})}W.prototype.s.prototype.yG=function(a){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.locateByPoint");var b=new rh(a.Qb),b=A.pg(b);Hx(this,b,this.searchOnMapCurrentMode,a.Qb)};
function Fx(a,b){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.locateByDrawing");a.nc=A.g().Jg({type:b},"cadastre-selectBy"+b);a.nc.on("drawend",function(a){var b=A.pg(a.za.j());Hx(this,b,this.searchOnMapCurrentMode,$g(a.za.j()))},a)}
W.prototype.s.prototype.QI=function(a){if(this.searchOnMapCurrentMode===a)return this.searchOnMapCurrentMode="","cadastre-selectByPoint"!==this.currentAction&&"cadastre-selectByLineString"===this.currentAction&&"cadastre-selectByPolygon"===this.currentAction||A.g().tk(),0;this.searchOnMapCurrentMode=a;"cadastre-selectByLineString"!==this.currentAction&&"cadastre-selectByPolygon"!==this.currentAction&&"cadastre-selectByPoint"!==this.Gr&&this.my("Point","cadastre-selectByPoint"===this.Gr)};
W.prototype.s.prototype.searchOnMapInit=W.prototype.s.prototype.QI;
W.prototype.s.prototype.$F=function(a){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.initRapportsBootstrapTables");var b=this;if(void 0===$("#Cadastre-rapports-table-parcelle").bootstrapTable("getOptions").dataType){$(a).find('[data-toggle="table"]').bootstrapTable({});var c=Date.now(),d=function(a){c>Date.now()-100||(c=Date.now(),setTimeout(function(){var c=$(a).bootstrapTable("getAllSelections");b.tablesSelection[a]=c}))};$("#Cadastre-rapports-table-parcelle").on("all.bs.table",
function(){d("#Cadastre-rapports-table-parcelle")});$("#Cadastre-rapports-table-comptes").on("all.bs.table",function(){d("#Cadastre-rapports-table-comptes")})}$(a).find('[data-toggle="table"]').bootstrapTable("load",[]);if(0===this.selection.length)return Xb(document.body,"click",function(){A.Iw({target:"#cadastre-btn-container-actions-map-replace-card",type:"top-left"},"Ajoutez d'abord des donn\u00e9es au panier")}),0;this.show_veremes_cadastre_compte=this.show_veremes_cadastre_parcelle=!1;for(var e=
0;e<this.selection.length;e++)"veremes_cadastre_parcelle"===this.selection[e].tabCode&&(A.log(this.selection[e].tableParams.data),this.show_veremes_cadastre_parcelle=!0,$(a).find("#Cadastre-rapports-table-parcelle").bootstrapTable("load",this.selection[e].tableParams.data)),"veremes_cadastre_compte"===this.selection[e].tabCode&&(this.show_veremes_cadastre_compte=!0,$(a).find("#Cadastre-rapports-table-comptes").bootstrapTable("load",this.selection[e].tableParams.data));this.show_veremes_cadastre_parcelle||
this.show_veremes_cadastre_compte?$("#rapports-modal").modal("show"):$.notify("Aucun rapport disponible pour cette s\u00e9lection")};W.prototype.s.prototype.initRapportsBootstrapTables=W.prototype.s.prototype.$F;
W.prototype.s.prototype.tD=function(a){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayParcelleDescriptiveSheetByTable");a=$(a).bootstrapTable("getAllSelections");if(1!==a.length)return $.notify("Veuillez s\u00e9lectionner une unique parcelle","info"),0;this.Nr(a[0].id_par)};W.prototype.s.prototype.displayParcelleDescriptiveSheetByTable=W.prototype.s.prototype.tD;
W.prototype.s.prototype.Nr=function(a){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayParcelleDescriptiveSheet");var b=this;cd();z({method:"POST",url:A.properties.api_url+"/"+A.properties.cadastre.api+"/fichedescriptiveparcelle/"+a,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{result_srid:D(A.g().H).D().V.substring(5)},scope:this.b,success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
0;b.oParcelleInfos=a.data.data;b.Hw()}})};W.prototype.s.prototype.displayParcelleDescriptiveSheet=W.prototype.s.prototype.Nr;
W.prototype.s.prototype.Hw=function(){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayParcelleDescriptiveSheet2");var a=this.oParcelleInfos;a.sup_fiscale&&(a.sup_fiscale=parseFloat(a.sup_fiscale)+" m\u00b2");a.DCNTPA&&(a.DCNTPA=parseFloat(a.DCNTPA)+" m\u00b2");a.GPARBAT=""===a.GPARBAT||" "===a.GPARBAT||0===a.GPARBAT||null===a.GPARBAT?"N":"O";a.GURBPA="U"!==a.GURBPA?"N":"O";if(a.aProprietaires)for(var b=0;b<a.aProprietaires.length;b++)if(a.aProprietaires[b].accordSexe=
"(e)",a.aProprietaires[b].DQUALP=null!=a.aProprietaires[b].DQUALP?a.aProprietaires[b].DQUALP:"",a.aProprietaires[b].DQUALP&&(a.aProprietaires[b].DQUALP=a.aProprietaires[b].DQUALP.trim(),"M"===a.aProprietaires[b].DQUALP&&(a.aProprietaires[b].accordSexe=""),"MLE"===a.aProprietaires[b].DQUALP||"MME"===a.aProprietaires[b].DQUALP))a.aProprietaires[b].accordSexe="e";a.aSubdivisionFiscale&&(a.aSubdivisionFiscale.totalDcntsf=0);a.aSubdivisionFiscale.totalDrcsuba=0;for(b=a.aSubdivisionFiscale.totalDrcsub=
0;b<a.aSubdivisionFiscale.length;b++)null!=a.aSubdivisionFiscale[b].DCNTSF&&(a.aSubdivisionFiscale[b].DCNTSF=parseFloat(a.aSubdivisionFiscale[b].DCNTSF)+" m\u00b2"),null!=a.aSubdivisionFiscale[b].DRCSUBA&&(a.aSubdivisionFiscale[b].DRCSUBA=(Math.pow(10,-2)*parseFloat(a.aSubdivisionFiscale[b].DRCSUBA)).toFixed(2)+" \u20ac"),null!=a.aSubdivisionFiscale[b].DRCSUB&&(a.aSubdivisionFiscale[b].DRCSUB=(Math.pow(10,-2)*parseFloat(a.aSubdivisionFiscale[b].DRCSUB)).toFixed(2)+" \u20ac"),null!=a.aSubdivisionFiscale[b].DCNTSF&&
(a.aSubdivisionFiscale.totalDcntsf+=parseFloat(a.aSubdivisionFiscale[b].DCNTSF)),null!=a.aSubdivisionFiscale[b].DRCSUBA&&(a.aSubdivisionFiscale.totalDrcsuba+=parseFloat(a.aSubdivisionFiscale[b].DRCSUBA)),null!=a.aSubdivisionFiscale[b].DRCSUB&&(a.aSubdivisionFiscale.totalDrcsub+=parseFloat(a.aSubdivisionFiscale[b].DRCSUB));null!=a.aSubdivisionFiscale.totalDcntsf&&(a.aSubdivisionFiscale.totalDcntsf=parseFloat(a.aSubdivisionFiscale.totalDcntsf)+" m\u00b2");null!=a.aSubdivisionFiscale.totalDrcsuba&&(a.aSubdivisionFiscale.totalDrcsuba=
parseFloat(a.aSubdivisionFiscale.totalDrcsuba).toFixed(2)+" \u20ac");null!=a.aSubdivisionFiscale.totalDrcsub&&(a.aSubdivisionFiscale.totalDrcsub=parseFloat(a.aSubdivisionFiscale.totalDrcsub).toFixed(2)+" \u20ac");this.oParcelleInfos=a;$("#descriptive-parcelle-sheet-modal").modal("show")};W.prototype.s.prototype.displayParcelleDescriptiveSheet2=W.prototype.s.prototype.Hw;
W.prototype.s.prototype.AD=function(a){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayUrbanismeSheetByTable");a=$(a).bootstrapTable("getAllSelections");if(1!==a.length)return $.notify("Veuillez s\u00e9lectionner une unique parcelle","info"),0;this.Pr(a[0].id_par)};W.prototype.s.prototype.displayUrbanismeSheetByTable=W.prototype.s.prototype.AD;
W.prototype.s.prototype.Pr=function(a){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayUrbanismeSheet");if(!n(a))return 0;var b=this;cd();z({method:"POST",url:A.properties.api_url+"/"+A.properties.cadastre.api+"/ficheurbanisme/"+a,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{result_srid:D(A.g().H).D().V.substring(5)},timeout:12E4,scope:this.b,success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
0;a=a.data.data;A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayUrbanismeSheet2");for(var c=[],e=0;n(a[e]);)a[e].CCOSEC=null!=a[e].CCOSEC?a[e].CCOSEC:"",a[e].DCNTPA=null!=a[e].DCNTPA?a[e].DCNTPA:"",a[e].DDENOM=null!=a[e].DDENOM?a[e].DDENOM:"",a[e].DLIGN3=null!=a[e].DLIGN3?a[e].DLIGN3:"",a[e].DLIGN4=null!=a[e].DLIGN4?a[e].DLIGN4:"",a[e].DLIGN6=null!=a[e].DLIGN6?a[e].DLIGN6:"",a[e].DNUPLA=null!=a[e].DNUPLA?a[e].DNUPLA:"",a[e].ID_PAR=null!=a[e].ID_PAR?a[e].ID_PAR:
"",a[e].LIBCOM=null!=a[e].LIBCOM?a[e].LIBCOM:"",a[e].LIBDEP=null!=a[e].LIBDEP?a[e].LIBDEP:"",a[e].ADRESSE=null!=a[e].ADRESSE?a[e].ADRESSE:"",a[e].NATURE=null!=a[e].DSGRPF?a[e].DSGRPF:"",c.push({nom:a[e].DDENOM.trim(),adresse:a[e].DLIGN3.trim()+a[e].DLIGN4.trim(),ville:a[e].DLIGN6.trim()}),e++;delete e;0===c.length&&($.notify("Pas d'information sur les propri\u00e9taires","error"),console.error("Pas d'information sur les propri\u00e9taires"));var f=new Date,e=f.getDate(),g=f.getMonth()+1,f=f.getFullYear();
n(A.properties.cadastre.fiche_urb)||(A.properties.cadastre.fiche_urb={});c={logo:n(A.properties.cadastre.fiche_urb.logo)?A.properties.cadastre.fiche_urb.logo:"",company:n(A.properties.cadastre.fiche_urb.company)?A.properties.cadastre.fiche_urb.company:"",departement:n(a[0])?a[0].LIBDEP.trim():"",commune:n(a[0])?a[0].LIBCOM.trim():"",parcelle:n(a[0])?parseFloat(a[0].DNUPLA):"",section:n(a[0])?a[0].CCOSEC.trim():"",contenance:n(a[0])?parseFloat(a[0].DCNTPA):"",adresse:n(a[0])?a[0].ADRESSE.trim():"",
date:(9<e?"":"0")+e+"/"+((9<g?"":"0")+g)+"/"+f,nature:n(a[0])?a[0].NATURE.trim():"",proprietaires:c,aIntersections:a.aIntersections,aIntersectionsArray:a.aIntersectionsArray};e=D(b.map).D().V;a=A.yi(a.geometry.geom,e);a=new So({geometry:a});null!=A.properties.cadastre.fiche_urb.printtemplate_id?null!=A.properties.cadastre.fiche_urb.map_id?A.F.Mc.Wy.print({scope:c,DA:A.properties.cadastre.fiche_urb.printtemplate_id,vy:A.properties.cadastre.fiche_urb.map_id,features:[a],Xw:A.properties.cadastre.fiche_urb.features_zoom}):
$.notify("properties.cadastre.fiche_urb.map_id undefined","error"):$.notify("properties.cadastre.fiche_urb.printtemplate_id undefined","error")}})};W.prototype.s.prototype.displayUrbanismeSheet=W.prototype.s.prototype.Pr;
W.prototype.s.prototype.sD=function(a){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayInvariantDescriptiveSheet");if(!n(a))return"id_bat undefined";var b=this;cd();z({method:"POST",url:A.properties.api_url+"/"+A.properties.cadastre.api+"/fichedescriptiveinvariant/"+a,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{result_srid:D(A.g().H).D().V.substring(5)},scope:this.b,success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
0;b.oInvariant=a.data.data;n(b.oInvariant)||console.error("oInvariant non d\u00e9fini");n(b.oInvariant.PEV)||console.error("oInvariant.PEV non d\u00e9fini");n(b.oInvariant.habitations)||console.error("oInvariant.habitations non d\u00e9fini");n(b.oInvariant.locauxPros)||console.error("oInvariant.locauxPros non d\u00e9fini");n(b.oInvariant.dependances)||console.error("oInvariant.dependances non d\u00e9fini");n(b.oInvariant.proprietaires)||console.error("oInvariant.proprietaires non d\u00e9fini");n(b.oInvariant.lots)||
console.error("oInvariant.lots non d\u00e9fini");for(a=0;a<b.oInvariant.proprietaires.length;a++){b.oInvariant.proprietaires[a].DLIGN4=null!=b.oInvariant.proprietaires[a].DLIGN4?b.oInvariant.proprietaires[a].DLIGN4:"";for(var c=b.oInvariant.proprietaires[a].DLIGN4.trim(),e=0;e<c.length;e++)"0"!==c.charAt(e)&&(c=c.substring(e),e=c.length);b.oInvariant.proprietaires[a].DLIGN4=c}$("#descriptive-invariant-sheet-modal").modal("show")}})};W.prototype.s.prototype.displayInvariantDescriptiveSheet=W.prototype.s.prototype.sD;
function Ix(a,b,c,d){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayReleveDeProprieteSheet");b={type:b,result_srid:D(A.g().H).D().V.substring(5)};n(d)&&(b.ID_PAR=d);n(c)&&(b.IDDNUPRO=c);z({method:"POST",url:A.properties.api_url+"/"+A.properties.cadastre.api+"/relevedepropriete",headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:b,scope:a.b,timeout:12E4,success:function(b){if(!n(b.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
n(a.Pa)&&a.Pa.close(),a.Pa=window.open("","Relev\u00e9 de propri\u00e9t\u00e9 ","height=400,width=600"),a.Pa.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">Pas de donn\u00e9es \u00e0 afficher</div>'),0;z({method:"GET",url:b.data.data.releveDePropriete+"&",headers:{Accept:"application/x-vm-json"},scope:this.b,responseType:"blob",success:function(b){window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(b.data,"releve_de_propriete_"+d+".pdf"):A.ao(b.data,
"releve_de_propriete_"+d+".pdf");a.Pa.close()}})},error:function(b){if(n(b.data.error)&&n(b.data.error.errorMessage))return console.error(b.data.error.errorMessage),$.notify(b.data.error.errorMessage,"error"),n(a.Pa)&&a.Pa.close(),a.Pa=window.open("","Relev\u00e9 de propri\u00e9t\u00e9 ","height=400,width=600"),a.Pa.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">'+b.data.error.errorMessage+"</div>"),0;if(500===b.status)return $.notify("Une erreur est survenue au sein du serveur",
"error"),n(a.Pa)&&a.Pa.close(),0;n(a.Pa)&&a.Pa.close()}})}
W.prototype.s.prototype.wD=function(a){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayReleveDeProprieteSheetTiers");a=$(a).bootstrapTable("getAllSelections");if(1!==a.length)return $.notify("Veuillez s\u00e9lectionner une unique parcelle","info"),0;n(this.Pa)&&this.Pa.close();this.Pa=window.open("","Relev\u00e9 de propri\u00e9t\u00e9 ","height=400,width=600");this.Pa.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>');Ix(this,
"parcelle","",a[0].id_par)};W.prototype.s.prototype.displayReleveDeProprieteSheetParcelle=W.prototype.s.prototype.wD;
W.prototype.s.prototype.xD=function(a){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayReleveDeProprieteSheetStandard");a=$(a).bootstrapTable("getAllSelections");if(1!==a.length)return $.notify("Veuillez s\u00e9lectionner un unique compte","info"),0;n(this.Pa)&&this.Pa.close();this.Pa=window.open("","Relev\u00e9 de propri\u00e9t\u00e9 ","height=400,width=600");this.Pa.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>');
Ix(this,"standard",a[0].ID_COM+a[0].DNUPRO)};W.prototype.s.prototype.displayReleveDeProprieteSheetStandard=W.prototype.s.prototype.xD;
W.prototype.s.prototype.yD=function(a){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayReleveDeProprieteSheetTiers");a=$(a).bootstrapTable("getAllSelections");if(1!==a.length)return $.notify("Veuillez s\u00e9lectionner un unique compte","info"),0;n(this.Pa)&&this.Pa.close();this.Pa=window.open("","Relev\u00e9 de propri\u00e9t\u00e9 ","height=400,width=600");this.Pa.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>');
Ix(this,"tiers",a[0].ID_COM+a[0].DNUPRO)};W.prototype.s.prototype.displayReleveDeProprieteSheetTiers=W.prototype.s.prototype.yD;
W.prototype.s.prototype.vD=function(a,b,c){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayReleveDeProprieteSheetOnMap");n(this.Pa)&&this.Pa.close();this.Pa=window.open("","Relev\u00e9 de propri\u00e9t\u00e9 ","height=400,width=600");this.Pa.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>');Ix(this,
a,b,c)};W.prototype.s.prototype.displayReleveDeProprieteSheetOnMap=W.prototype.s.prototype.vD;
W.prototype.s.prototype.uD=function(a,b,c){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayRapportParcelle");a=$(a).bootstrapTable("getAllSelections");c=n(c)?c:!0;if(0===a.length)return $.notify("Veuillez s\u00e9lectionner une unique parcelle","info"),0;for(var d="",e=0;e<a.length;e++)0<e&&(d+="|"),d+=a[e].id_par;var f=this;n(this.Pa)&&this.Pa.close();c?(this.Pa=window.open("","Rapport parcellaire","height=400,width=600"),this.Pa.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>')):
bootbox.alert('<h4>Rapport en cours de cr\u00e9ation...</h4><br><div class="progress"><div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%"><span class="sr-only">45% Complete</span><span class="sr-only">45% Complete</span></div></div>');cd();z({method:"POST",url:A.properties.api_url+"/"+A.properties.cadastre.api+"/rapportscadastreparcelle",headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},
data:{rapport_type:b,parcelles:d,result_srid:D(A.g().H).D().V.substring(5)},timeout:12E4,scope:this.b,success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),$.notify("Pas de donn\u00e9es \u00e0 afficher","warn"),c?f.Pa.close():$(".bootbox-alert").modal("hide"),0;var d=a.data.data,e=d.rapport+"&";cd();z({method:"GET",url:e,headers:{Accept:"application/x-vm-json"},scope:this.b,responseType:"blob",success:function(a){c?(f.Pa.location.href=e,window.navigator.msSaveOrOpenBlob?
(window.navigator.msSaveOrOpenBlob(a.data,"vmap_cadastre_"+b+".pdf"),f.Pa.close()):(a=window.URL.createObjectURL(a.data),f.Pa.location.href=a)):(a=window.URL.createObjectURL(a.data),$("#cadastre-download-file").attr("href",a),$("#cadastre-download-file").attr("download",b+"."+d.format),A.jj("cadastre-download-file"),$(".bootbox-alert").modal("hide"))}})},error:function(a){if(n(a.data.error)&&n(a.data.error.errorMessage))return console.error(a.data.error.errorMessage),$.notify(a.data.error.errorMessage,
"error"),c?f.Pa.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">'+a.data.error.errorMessage+"</div>"):$(".bootbox-alert").modal("hide"),0;if(500===a.status)return $.notify("Une erreur est survenue au sein du serveur","error"),c?f.Pa.close():$(".bootbox-alert").modal("hide"),0;n(f.Pa)&&f.Pa.close()}})};W.prototype.s.prototype.displayRapportParcelle=W.prototype.s.prototype.uD;
W.prototype.s.prototype.xj=function(a,b,c){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addLocationGeometries");c=n(c)?c:!0;b=n(b)?b:"";for(var d=[],e=a.length-1;0<=e;e--){var f=new So({geometry:A.yi(a[e].geom)});f.set("type",b);d.push(f);var g={},h;for(h in a[e])"geom"!==h&&(g[h]=a[e][h]);f.set("infos",g)}a=!0;this.locationMultiple&&(a=!1);A.g().gt(d,a,c)};W.prototype.s.prototype.addLocationGeometries=W.prototype.s.prototype.xj;
W.prototype.s.prototype.jA=function(a){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.setSelectionGeometries");for(var b=a.length-1;0<=b;b--)if(void 0!==a[b].geom){var c=A.yi(a[b].geom),d=new So({geometry:c});a[b].feature=d;delete c;delete d}return a};W.prototype.s.prototype.setSelectionGeometries=W.prototype.s.prototype.jA;
W.prototype.s.prototype.wj=function(a,b){if(!n(a))return"data is not defined";if(!n(b))return"tabCode is not defined";void 0===A.F.M.Qa(b)?angular.element($("#cadastre-tools")).scope().$evalAsync(function(c){c.ctrl.Ch(a,b)}):A.F.M.lr({Ma:b},{data:a,ae:["geom"]})};W.prototype.s.prototype.addInfos=W.prototype.s.prototype.wj;
W.prototype.s.prototype.Ch=function(a,b){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.setInfos");if(!n(a))return"data is not defined";b=n(b)?b:"Cadastre";a={Ma:b,data:a,NL:!0,ae:["geom"],Fa:n(a[0].geom)?["zoom","delete"]:["delete"],layer:A.g().ee};A.F.M.Wa(a)};W.prototype.s.prototype.setInfos=W.prototype.s.prototype.Ch;
W.prototype.s.prototype.gg=function(a,b,c,d){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFromFilter");A.log("filter: "+b);var e=this;a=A.properties.api_url+"/"+a;c=n(c)?c:"Cadastre";d=n(d)?d:function(){return 0};cd();z({method:"POST",url:a,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{filter:b,result_srid:D(A.g().H).D().V.substring(5)},scope:this.b,success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
0;a=a.data.data;A.g().Vi.clear();a=e.jA(a);e.wj(a,c);A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.zoomOnLastTabFeatures");angular.element($("#cadastre-tools")).scope().ctrl.tf++;a=angular.element($("#cadastre-tools")).scope().ctrl.tf;var b=angular.element($("#cadastre-tools")).scope().ctrl.Aa,f=b[b.length-1];b.length===a&&(A.F.M.Vk(f),A.F.M.Ke());d(c)}})};W.prototype.s.prototype.addSelectionFromFilter=W.prototype.s.prototype.gg;
W.prototype.s.prototype.XB=function(a,b,c,d,e){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFromValue");this.gg(a,{column:"cadastre"==this.cadastreAPI_?b:b.toLowerCase(),compare_operator:"=",value:c},d,e)};W.prototype.s.prototype.addSelectionFromValue=W.prototype.s.prototype.XB;
W.prototype.s.prototype.mr=function(a,b,c,d,e,f,g){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFrom2Values");"cadastre"!==this.cadastreAPI_&&(b=b.toLowerCase(),d=d.toLowerCase());this.gg(a,{relation:"AND",operators:[{column:b,compare_operator:"=",value:c},{column:d,compare_operator:"=",value:e}]},f,g)};W.prototype.s.prototype.addSelectionFrom2Values=W.prototype.s.prototype.mr;
W.prototype.s.prototype.fg=function(a,b,c,d,e,f){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFromTable");b="cadastre"===this.cadastreAPI_?b:b.toLowerCase();for(var g={relation:"OR",operators:[]},h=0;h<c.length;h++)g.operators.push({column:b,compare_operator:"=",value:c[h][d]});this.gg(a,g,e,f)};W.prototype.s.prototype.addSelectionFromArray=W.prototype.s.prototype.fg;
W.prototype.s.prototype.Ue=function(a,b,c,d,e){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFromSelect");b={column:"cadastre"===this.cadastreAPI_?b:b.toLowerCase(),compare_operator:"=",value:$(c).val()};this.gg(a,b,d,e)};W.prototype.s.prototype.addSelectionFromSelect=W.prototype.s.prototype.Ue;
W.prototype.s.prototype.WB=function(a,b,c,d,e,f,g){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFromSelect");"cadastre"!==this.cadastreAPI_&&(b=b.toLowerCase(),d=d.toLowerCase());c=$(c).val();e=$(e).val();this.gg(a,{relation:"AND",operators:[{column:b,compare_operator:"=",value:c},{column:d,compare_operator:"=",value:e}]},f,g)};W.prototype.s.prototype.addSelectionFrom2Select=W.prototype.s.prototype.WB;
W.prototype.s.prototype.ci=function(a,b,c,d,e){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFromTable");c=$(c).bootstrapTable("getAllSelections");for(var f="cadastre"===this.cadastreAPI_?b:b.toLowerCase(),g={relation:"OR",operators:[]},h=0;h<c.length;h++)g.operators.push({column:f,compare_operator:"=",value:c[h][b]});this.gg(a,g,d,e)};W.prototype.s.prototype.addSelectionFromTable=W.prototype.s.prototype.ci;
W.prototype.s.prototype.KD=function(){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.emptySelection");A.F.M.removeAll()};W.prototype.s.prototype.emptySelection=W.prototype.s.prototype.KD;
W.prototype.s.prototype.et=function(a,b,c){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.localiseFromSelect");c=$(c).val();a=A.properties.api_url+"/"+a;var d=this;""!==c?(cd(),z({method:"POST",url:a,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{attributs:"geom|proj",filter:{column:b,compare_operator:"=",value:c},result_srid:D(A.g().H).D().V.substring(5)},scope:this.b,success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
0;d.xj(a.data.data)}})):$.notify("Veuillez s\u00e9lectionner au moins un objet spatial","info")};W.prototype.s.prototype.localiseFromSelect=W.prototype.s.prototype.et;
W.prototype.s.prototype.ly=function(a,b,c,d){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.localiseFromTable");var e=this;a=A.properties.api_url+"/"+a;for(var f={relation:"OR",operators:[]},g=0;g<c.length;g++)f.operators.push({column:b,compare_operator:"=",value:c[g][d]});cd();z({method:"POST",url:a,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{attributs:"geom|proj",filter:f,result_srid:D(A.g().H).D().V.substring(5)},scope:this.b,
success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;e.xj(a.data.data)}})};W.prototype.s.prototype.localiseFromArray=W.prototype.s.prototype.ly;
W.prototype.s.prototype.ck=function(a,b,c,d){function e(){for(var a={relation:"OR",operators:[]},c=0;c<g.length;c++)a.operators.push({column:b,compare_operator:"=",value:g[c][d]});cd();z({method:"POST",url:h,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{attributs:"geom|proj",filter:a,result_srid:D(A.g().H).D().V.substring(5)},scope:this.b,success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;f.xj(a.data.data)}})}A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.localiseFromTable");
d=n(d)?d:b;var f=this,g=$(c).bootstrapTable("getAllSelections"),h=A.properties.api_url+"/"+a;g.length>this.Oi?bootbox.confirm("<h4>Attention, vous allez afficher "+g.length+" objets, cela peut ralentir l'application<br>voulez-vous continuer ?</h4>",function(a){!0===a&&e()}):0!==g.length?e():$.notify("Veuillez s\u00e9lectionner au moins un objet de la liste","info")};W.prototype.s.prototype.localiseFromTable=W.prototype.s.prototype.ck;
W.prototype.s.prototype.kx=function(a,b,c,d){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBaseElem");c=n(c)?c:"";d=n(d)?d:"";var e=this;a=A.properties.api_url+"/"+a;var f={attributs:"-geom|proj",result_srid:D(A.g().H).D().V.substring(5)};""!==c&&(f.filter=c);""!==d&&(f.order_by=d);this[b].length=0;cd();z({method:"POST",url:a,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:f,scope:this.b,success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
0;e[b]=a.data.data}})};W.prototype.s.prototype.getBaseElem=W.prototype.s.prototype.kx;
W.prototype.s.prototype.aE=function(a,b,c,d,e){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBaseElemBySelect");e=n(e)?e:"";this[d].length=0;var f=this;a=A.properties.api_url+"/"+a;c=$(c).val();b={attributs:"-geom|proj",filter:{column:b,compare_operator:"=",value:c},jsonformat:"anonymous",result_srid:D(A.g().H).D().V.substring(5)};""!==e&&(b.order_by=e);cd();z({method:"POST",url:a,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:b,
scope:this.b,success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;f[d]=a.data.data}})};W.prototype.s.prototype.getBaseElemBySelect=W.prototype.s.prototype.aE;
function Jx(a,b,c,d,e){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.putBaseElemOnTable");$(d).bootstrapTable("showLoading");$(d).bootstrapTable("removeAll");e=n(e)?e:"";c={filter:c,jsonformat:"anonymous",result_srid:D(A.g().H).D().V.substring(5)};""!==e&&(c.order_by=e);cd();z({method:"POST",url:A.properties.api_url+"/"+b,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:c,scope:a.b,success:function(a){$(d).bootstrapTable("hideLoading");
if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(d).bootstrapTable("load",a);$(d+"-toolbar").show();1===a.length&&$(d).bootstrapTable("check",0)},error:function(){$(d).bootstrapTable("hideLoading")}})}W.prototype.s.prototype.hI=function(a,b,c,d,e){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.putBaseElemBySelectOnTable");e=n(e)?e:"";c=$(c).val();Jx(this,a,{column:b,compare_operator:"=",value:c},d,e)};
W.prototype.s.prototype.putBaseElemBySelectOnTable=W.prototype.s.prototype.hI;W.prototype.s.prototype.gI=function(a,b,c,d,e,f,g){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.putBaseElemBy2SelectOnTable");g=n(g)?g:"";c=$(c).val();e=$(e).val();Jx(this,a,{relation:"AND",operators:[{column:b,compare_operator:"=",value:c},{column:d,compare_operator:"=",value:e}]},f,g)};W.prototype.s.prototype.putBaseElemBy2SelectOnTable=W.prototype.s.prototype.gI;
W.prototype.s.prototype.bE=function(a,b,c,d){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBaseVoiesOnTable");c=$(c).val();a=A.properties.api_url+"/"+a;var e=this;$(d).bootstrapTable({data:{}});var f="cadastre"===e.cadastreAPI_?"DVOILIB":"dvoilib";$(d).bootstrapTable("showLoading");cd();z({method:"POST",url:a,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{order_by:f,filter:{column:b,compare_operator:"=",value:c},jsonformat:"anonymous",
result_srid:D(A.g().H).D().V.substring(5)},scope:this.b,success:function(a){$(d).bootstrapTable("hideLoading");if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(d).bootstrapTable("load",a);$(d).off("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table");$(d).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",function(a,b){$("#Parcelle-par-adresse-DGFiP-select-adresse").prop("disabled",!0);Kx(e,{path:A.properties.cadastre.api+
"/adresses",variableName:"aAdresses",param:"cadastre"===e.cadastreAPI_?"ID_RIVOLI":"id_voie",value:b.ID_RIVOLI,order_by:"DNVOIRI",callback:function(){$("#Parcelle-par-adresse-DGFiP-select-adresse").prop("disabled",!1)}})});1===a.length&&$(d).bootstrapTable("check",0)},error:function(){$(d).bootstrapTable("hideLoading")}})};W.prototype.s.prototype.getBaseVoiesOnTable=W.prototype.s.prototype.bE;
function Kx(a,b){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBaseElemByValue");var c=b.path,d=b.variableName,e=b.param,f=b.value,g=b.callback;b=b.order_by;g=n(g)?g:function(){return 0};c=A.properties.api_url+"/"+c;a[d].length=0;cd();z({method:"POST",url:c,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{attributs:"-geom|proj",filter:{column:e,compare_operator:"=",value:f},result_srid:D(A.g().H).D().V.substring(5),order_by:null!=
b?b:""},scope:a.b,success:function(b){if(!n(b.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a[d]=b.data.data;g()}})}
W.prototype.s.prototype.KE=function(a,b,c,d,e){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getParcelleBaseProprietairesOnTable");var f=this;a=$(a).val();b=$(b).val().toUpperCase();var g=A.properties.api_url+"/"+A.properties.cadastre.api+"/proprietaires";if(""!=a)if(3<=b.length){$(c).bootstrapTable({data:{}});$(c).bootstrapTable("showLoading");$(d).bootstrapTable("removeAll");$(e).bootstrapTable("removeAll");if("cadastre"===this.cadastreAPI_)var h="ID_COM",
k="DDENOM";else h="id_com",k="ddenom";b=b.replace(/'/g,"''");cd();z({method:"POST",url:g,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{filter:{relation:"AND",operators:[{column:h,compare_operator:"=",value:a},{column:k,compare_operator:"LIKE",compare_operator_options:{case_insensitive:!0},value:"%"+b+"%"}]},limit:500,attributs:k+"|"+h,distinct:!0,order_by:k,result_srid:D(A.g().H).D().V.substring(5)},scope:this.b,success:function(a){$(c).bootstrapTable("hideLoading");
if(!n(a.data.data))return $(c).bootstrapTable("removeAll"),console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;500<=a.length&&$.notify("Attention: limite d'occurrences atteinte, veuillez affiner votre recherche","info");$(c).bootstrapTable("load",a);$(c+"-toolbar").show();""!==d&&($(c).off("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table"),$(c).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",function(a,b){$(d).bootstrapTable("removeAll");
$(e).bootstrapTable("removeAll");f.wx(b,d,e)}));1===a.length&&$(c).bootstrapTable("check",0)},error:function(){$(c).bootstrapTable("hideLoading")}})}else $(c).bootstrapTable("removeAll"),$.notify("Veuillez entrer au moins 3 caract\u00e8res...","error");else $(c).bootstrapTable("removeAll"),$.notify("Veuillez s\u00e9lectionner une commune","error")};W.prototype.s.prototype.getParcelleBaseProprietairesOnTable=W.prototype.s.prototype.KE;
W.prototype.s.prototype.wx=function(a,b,c){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getParcelleBaseComptesOnTable");var d=this,e=A.properties.api_url+"/"+A.properties.cadastre.api+"/proprietaires";$(b).bootstrapTable("showLoading");if("cadastre"===this.cadastreAPI_)var f="ID_COM",g="DDENOM",h="DNUPRO";else f="id_com",g="ddenom",h="dnupro";cd();z({method:"POST",url:e,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{filter:{relation:"AND",
operators:[{column:f,compare_operator:"=",value:a.ID_COM},{column:g,compare_operator:"=",value:a.DDENOM.replace(/'/g,"''")}]},attributs:f+"|"+h,order_by:h,result_srid:D(A.g().H).D().V.substring(5)},scope:this.b,success:function(a){$(b).bootstrapTable("hideLoading");if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(b).bootstrapTable("load",a);$(b+"-toolbar").show();$(b).off("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table");$(b).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",
function(a,e){$(c).bootstrapTable("removeAll");d.lx(e.ID_COM,$(b).bootstrapTable("getAllSelections"),c)});1===a.length&&$(b).bootstrapTable("check",0)},error:function(){$(b).bootstrapTable("hideLoading")}})};W.prototype.s.prototype.getParcelleBaseComptesOnTable=W.prototype.s.prototype.wx;
W.prototype.s.prototype.lx=function(a,b,c){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBaseParcellesByProprietaireOnTable");if(0!==b.length){var d=A.properties.api_url+"/"+A.properties.cadastre.api+"/descriptionparcelles";$(c).bootstrapTable("showLoading");if("cadastre"===this.cadastreAPI_){a="ID_COM";var e="DNUPRO",f="ID_PAR"}else a="id_com",e="dnupro",f="id_par";for(var g={relation:"OR",operators:[]},h=0;h<b.length;h++)g.operators.push({relation:"AND",
operators:[{column:a,compare_operator:"=",value:b[h].ID_COM},{column:e,compare_operator:"=",value:b[h].DNUPRO}]});cd();z({method:"POST",url:d,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{attributs:f,filter:g,order_by:f,result_srid:D(A.g().H).D().V.substring(5)},scope:this.b,success:function(a){$(c).bootstrapTable("hideLoading");if(n(a.data.errorMessage))return console.error(a.data.errorMessage),0;if(500===a.status)return $.notify("Une erreur est survenue au sein du serveur",
"error"),0;if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(c).bootstrapTable("load",a);$(c+"-toolbar").show();1===a.length&&$(c).bootstrapTable("check",0)},error:function(){$(c).bootstrapTable("hideLoading")}})}};W.prototype.s.prototype.getBaseParcellesByProprietaireOnTable=W.prototype.s.prototype.lx;
W.prototype.s.prototype.dE=function(a,b,c,d,e,f){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBatiBaseProprietairesOnTable");var g=this;a=$(a).val();b=$(b).val().toUpperCase().replace(/'/g,"''");var h=A.properties.api_url+"/"+A.properties.cadastre.api+"/proprietaires";if(""!=a)if(3<=b.length){$(c).bootstrapTable({data:{}});$(c).bootstrapTable("showLoading");$(d).bootstrapTable("removeAll");$(e).bootstrapTable("removeAll");$(f).bootstrapTable("removeAll");
if("cadastre"===this.cadastreAPI_)var k="ID_COM",m="DDENOM";else k="id_com",m="ddenom";cd();z({method:"POST",url:h,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{filter:{relation:"AND",operators:[{column:k,compare_operator:"=",value:a},{column:m,compare_operator:"LIKE",compare_operator_options:{case_insensitive:!0},value:"%"+b+"%"}]},limit:"50",attributs:m+"|"+k,distinct:!0,order_by:m,result_srid:D(A.g().H).D().V.substring(5)},scope:this.b,success:function(a){$(c).bootstrapTable("hideLoading");
if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(c).bootstrapTable("load",a);$(c+"-toolbar").show();""!==d&&($(c).off("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table"),$(c).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",function(a,b){$(d).bootstrapTable("removeAll");$(e).bootstrapTable("removeAll");$(f).bootstrapTable("removeAll");g.mx(b,d,e,f)}));1===a.length&&$(c).bootstrapTable("check",0)},error:function(){$(c).bootstrapTable("hideLoading")}})}else $(c).bootstrapTable("removeAll"),
$.notify("Veuillez entrer au moins 3 caract\u00e8res...","error");else $(c).bootstrapTable("removeAll"),$.notify("Veuillez s\u00e9lectionner une commune","error")};W.prototype.s.prototype.getBatiBaseProprietairesOnTable=W.prototype.s.prototype.dE;
W.prototype.s.prototype.mx=function(a,b,c,d){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBatiBaseComptesOnTable");var e=this,f=A.properties.api_url+"/"+A.properties.cadastre.api+"/proprietaires";$(b).bootstrapTable("showLoading");if("cadastre"===this.cadastreAPI_)var g="ID_COM",h="DDENOM",k="DNUPRO";else g="id_com",h="ddenom",k="dnupro";cd();z({method:"POST",url:f,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{filter:{relation:"AND",
operators:[{column:g,compare_operator:"=",value:a.ID_COM},{column:h,compare_operator:"=",value:a.DDENOM.replace(/'/g,"''")}]},attributs:k+"|"+g,order_by:k,result_srid:D(A.g().H).D().V.substring(5)},scope:this.b,success:function(a){$(b).bootstrapTable("hideLoading");if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(b).bootstrapTable("load",a);$(b+"-toolbar").show();$(b).off("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table");$(b).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",
function(){$(c).bootstrapTable("removeAll");$(d).bootstrapTable("removeAll");e.nx($(b).bootstrapTable("getAllSelections"),c,d)});1===a.length&&$(b).bootstrapTable("check",0)},error:function(){$(b).bootstrapTable("hideLoading")}})};W.prototype.s.prototype.getBatiBaseComptesOnTable=W.prototype.s.prototype.mx;
W.prototype.s.prototype.nx=function(a,b,c){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBatiBaseInvariantsOnTable");if(0!==a.length){var d=this,e=A.properties.api_url+"/"+A.properties.cadastre.api+"/invariants";if("cadastre"===this.cadastreAPI_)var f="ID_COM",g="DNUPRO",h="INVAR|ID_PAR|oid";else f="id_com",g="dnupro",h="INVAR|ID_PAR|id_local";for(var k={relation:"OR",operators:[]},m=0;m<a.length;m++)k.operators.push({relation:"AND",operators:[{column:g,
compare_operator:"=",value:a[m].DNUPRO},{column:f,compare_operator:"=",value:a[m].ID_COM}]});$(b).bootstrapTable("showLoading");cd();z({method:"POST",url:e,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{filter:k,attributs:h,jsonformat:"anonymous",order_by:"INVAR",result_srid:D(A.g().H).D().V.substring(5)},scope:this.b,success:function(a){$(b).bootstrapTable("hideLoading");if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;
$(b).bootstrapTable("load",a);$(b+"-toolbar").show();$(b).off("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table");$(b).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",function(){$(c).bootstrapTable("removeAll");d.ox($(b).bootstrapTable("getAllSelections"),c)});1===a.length&&$(b).bootstrapTable("check",0)},error:function(){$(b).bootstrapTable("hideLoading")}})}};W.prototype.s.prototype.getBatiBaseInvariantsOnTable=W.prototype.s.prototype.nx;
W.prototype.s.prototype.ox=function(a,b){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBatiBaseParcellesOnTable");if(0!==a.length){$(b).bootstrapTable("showLoading");for(var c=A.properties.api_url+"/"+A.properties.cadastre.api+"/parcelles",d={relation:"OR",operators:[]},e=0;e<a.length;e++)d.operators.push({relation:"AND",operators:[{column:"id_par",compare_operator:"=",value:a[e].ID_PAR}]});cd();z({method:"POST",url:c,headers:{Accept:"application/x-vm-json",
"X-HTTP-Method-Override":"GET"},data:{filter:d,attributs:"id_par",order_by:"parcelle",result_srid:D(A.g().H).D().V.substring(5)},scope:this.b,success:function(a){$(b).bootstrapTable("hideLoading");if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(b).bootstrapTable("load",a);$(b+"-toolbar").show();1===a.length&&$(b).bootstrapTable("check",0)},error:function(){$(b).bootstrapTable("hideLoading")}})}};W.prototype.s.prototype.getBatiBaseParcellesOnTable=W.prototype.s.prototype.ox;
W.prototype.s.prototype.Uz=function(a){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectCommuneForm");if(!n(a))return"selectCommune non renseign\u00e9";this.tf=this.Aa.length=0;""!==$(a).val()&&(this.Aa.push("veremes_cadastre_commune"),void 0===A.F.M.Qa("veremes_cadastre_commune")&&A.F.M.Wa({Ma:"veremes_cadastre_commune",lb:"Commune",Fa:["zoom","delete"]}),this.Ue(A.properties.cadastre.api+"/communes","id_com",a,"veremes_cadastre_commune"));A.F.M.Xd(this.Aa[this.Aa.length-
1])};W.prototype.s.prototype.selectCommuneForm=W.prototype.s.prototype.Uz;
W.prototype.s.prototype.$z=function(a,b){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectSectionForm");if(!n(a))return"selectCommune non renseign\u00e9";if(!n(b))return"tableSection non renseign\u00e9";this.tf=this.Aa.length=0;""!==$(a).val()&&(this.Aa.push("veremes_cadastre_commune"),void 0===A.F.M.Qa("veremes_cadastre_commune")&&A.F.M.Wa({Ma:"veremes_cadastre_commune",lb:"Commune",Fa:["zoom","delete"]}),this.Ue(A.properties.cadastre.api+"/communes","id_com",
a,"veremes_cadastre_commune"));0<$(b).bootstrapTable("getAllSelections").length&&(this.Aa.push("veremes_cadastre_section"),void 0===A.F.M.Qa("veremes_cadastre_section")&&A.F.M.Wa({Ma:"veremes_cadastre_section",lb:"Section",Fa:["zoom","delete"]}),this.ci(A.properties.cadastre.api+"/sections","id_sec",b,"veremes_cadastre_section"));A.F.M.Xd(this.Aa[this.Aa.length-1])};W.prototype.s.prototype.selectSectionForm=W.prototype.s.prototype.$z;
W.prototype.s.prototype.Wz=function(a,b){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectSectionForm");if(!n(a))return"selectCommune non renseign\u00e9";if(!n(b))return"tableLieuDit non renseign\u00e9";this.tf=this.Aa.length=0;""!==$(a).val()&&(this.Aa.push("veremes_cadastre_commune"),void 0===A.F.M.Qa("veremes_cadastre_commune")&&A.F.M.Wa({Ma:"veremes_cadastre_commune",lb:"Commune",Fa:["zoom","delete"]}),this.Ue(A.properties.cadastre.api+"/communes","id_com",
a,"veremes_cadastre_commune"));0<$(b).bootstrapTable("getAllSelections").length&&(this.Aa.push("veremes_cadastre_lieu_dit"),void 0===A.F.M.Qa("veremes_cadastre_lieu_dit")&&A.F.M.Wa({Ma:"veremes_cadastre_lieu_dit",lb:"Lieu-dit",Fa:["zoom","delete"]}),this.ci(A.properties.cadastre.api+"/lieudits","oid",b,"veremes_cadastre_lieu_dit"));A.F.M.Xd(this.Aa[this.Aa.length-1])};W.prototype.s.prototype.selectLieuDitForm=W.prototype.s.prototype.Wz;
W.prototype.s.prototype.Zz=function(a,b,c){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectSectionForm");if(!n(a))return"selectCommune non renseign\u00e9";if(!n(b))return"selectSection non renseign\u00e9";if(!n(c))return"tableParcelle non renseign\u00e9";this.tf=this.Aa.length=0;""!==$(a).val()&&(this.Aa.push("veremes_cadastre_commune"),void 0===A.F.M.Qa("veremes_cadastre_commune")&&A.F.M.Wa({Ma:"veremes_cadastre_commune",lb:"Commune",Fa:["zoom","delete"]}),
this.Ue(A.properties.cadastre.api+"/communes","id_com",a,"veremes_cadastre_commune"));""!==$(b).val()&&(this.Aa.push("veremes_cadastre_section"),void 0===A.F.M.Qa("veremes_cadastre_section")&&A.F.M.Wa({Ma:"veremes_cadastre_section",lb:"Section",Fa:["zoom","delete"]}),this.Ue(A.properties.cadastre.api+"/sections","id_sec",b,"veremes_cadastre_section"));0<$(c).bootstrapTable("getAllSelections").length&&(this.Aa.push("veremes_cadastre_parcelle"),void 0===A.F.M.Qa("veremes_cadastre_parcelle")&&A.F.M.Wa({Ma:"veremes_cadastre_parcelle",
lb:"Parcelle",Fa:["zoom","delete"]}),this.ci(A.properties.cadastre.api+"/parcelles","id_par",c,"veremes_cadastre_parcelle"));A.F.M.Xd(this.Aa[this.Aa.length-1])};W.prototype.s.prototype.selectParcelleBySectionForm=W.prototype.s.prototype.Zz;
W.prototype.s.prototype.Xz=function(a,b,c){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectParcelleByAdresse");if(!n(a))return"selectCommune non renseign\u00e9";if(!n(b))return"selectSection non renseign\u00e9";if(!n(c))return"tableParcelle non renseign\u00e9";this.tf=this.Aa.length=0;""!==$(a).val()&&(this.Aa.push("veremes_cadastre_commune"),void 0===A.F.M.Qa("veremes_cadastre_commune")&&A.F.M.Wa({Ma:"veremes_cadastre_commune",lb:"Commune",Fa:["zoom",
"delete"]}),this.Ue(A.properties.cadastre.api+"/communes","id_com",a,"veremes_cadastre_commune"));0<$(b).bootstrapTable("getAllSelections").length&&(this.Aa.push("veremes_cadastre_voie"),void 0===A.F.M.Qa("veremes_cadastre_voie")&&A.F.M.Wa({Ma:"veremes_cadastre_voie",lb:"Voie",Fa:["delete"]}),this.ci(A.properties.cadastre.api+"/voies","ID_RIVOLI",b,"veremes_cadastre_voie"));""!==$(c).val()&&(this.Aa.push("veremes_cadastre_adresse"),void 0===A.F.M.Qa("veremes_cadastre_adresse")&&A.F.M.Wa({Ma:"veremes_cadastre_adresse",
lb:"Adresse",Fa:["delete"]}),this.Ue(A.properties.cadastre.api+"/adresses","ID_PAR",c,"veremes_cadastre_adresse"));""!==$(c).val()?(this.Aa.push("veremes_cadastre_parcelle"),void 0===A.F.M.Qa("veremes_cadastre_parcelle")&&A.F.M.Wa({Ma:"veremes_cadastre_parcelle",lb:"Parcelle",Fa:["zoom","delete"]}),this.Ue(A.properties.cadastre.api+"/parcelles","id_par",c,"veremes_cadastre_parcelle")):0<$(b).bootstrapTable("getAllSelections").length&&0<this.aAdresses.length&&(this.Aa.push("veremes_cadastre_parcelle"),
void 0===A.F.M.Qa("veremes_cadastre_parcelle")&&A.F.M.Wa({Ma:"veremes_cadastre_parcelle",lb:"Parcelle",Fa:["zoom","delete"]}),this.fg(A.properties.cadastre.api+"/parcelles","id_par",this.aAdresses,"ID_PAR","veremes_cadastre_parcelle"));A.F.M.Xd(this.Aa[this.Aa.length-1])};W.prototype.s.prototype.selectParcelleByAdresse=W.prototype.s.prototype.Xz;
W.prototype.s.prototype.Yz=function(a,b,c,d){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectParcelleByProprietaire");if(!n(a))return"selectCommune non renseign\u00e9";if(!n(b))return"tableProprietaires non renseign\u00e9";if(!n(c))return"tableComptes non renseign\u00e9";if(!n(d))return"tableParcelles non renseign\u00e9";this.tf=this.Aa.length=0;""!==$(a).val()&&(this.Aa.push("veremes_cadastre_commune"),void 0===A.F.M.Qa("veremes_cadastre_commune")&&A.F.M.Wa({Ma:"veremes_cadastre_commune",
lb:"Commune",Fa:["zoom","delete"]}),this.Ue(A.properties.cadastre.api+"/communes","id_com",a,"veremes_cadastre_commune"));0<$(b).bootstrapTable("getAllSelections").length&&(this.Aa.push("veremes_cadastre_proprietaire"),void 0===A.F.M.Qa("veremes_cadastre_proprietaire")&&A.F.M.Wa({Ma:"veremes_cadastre_proprietaire",lb:"Propri\u00e9taire",Fa:["delete"]}),a=$(b).bootstrapTable("getAllSelections")[0],this.mr(A.properties.cadastre.api+"/proprietaires","DDENOM",a.DDENOM.replace(/'/g,"''"),"ID_COM",a.ID_COM,
"veremes_cadastre_proprietaire"));if(0<$(c).bootstrapTable("getAllSelections").length){this.Aa.push("veremes_cadastre_compte");void 0===A.F.M.Qa("veremes_cadastre_compte")&&A.F.M.Wa({Ma:"veremes_cadastre_compte",lb:"Compte",Fa:["delete"]});c=$(c).bootstrapTable("getAllSelections");"cadastre"===this.cadastreAPI_?(a="ID_COM",b="DNUPRO"):(a="id_com",b="dnupro");for(var e={relation:"OR",operators:[]},f=0;f<c.length;f++)e.operators.push({relation:"AND",operators:[{column:a,compare_operator:"=",value:c[f].ID_COM},
{column:b,compare_operator:"=",value:c[f].DNUPRO}]});this.gg(A.properties.cadastre.api+"/proprietaires",e,"veremes_cadastre_compte")}0<$(d).bootstrapTable("getAllSelections").length&&(this.Aa.push("veremes_cadastre_parcelle"),void 0===A.F.M.Qa("veremes_cadastre_parcelle")&&A.F.M.Wa({Ma:"veremes_cadastre_parcelle",lb:"Parcelle",Fa:["zoom","delete"]}),d=$(d).bootstrapTable("getAllSelections"),this.fg(A.properties.cadastre.api+"/parcelles","id_par",d,"ID_PAR","veremes_cadastre_parcelle"));A.F.M.Xd(this.Aa[this.Aa.length-
1])};W.prototype.s.prototype.selectParcelleByProprietaire=W.prototype.s.prototype.Yz;
W.prototype.s.prototype.Tz=function(a,b,c,d,e){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectBatiByProprietaire");if(!n(a))return"selectCommune non renseign\u00e9";if(!n(b))return"tableProprietaires non renseign\u00e9";if(!n(c))return"tableComptes non renseign\u00e9";if(!n(d))return"tableInvariants non renseign\u00e9";if(!n(e))return"tableParcelles non renseign\u00e9";if("cadastre"===this.cadastreAPI_)var f="DDENOM",g="ID_COM";else f="ddenom",g="id_com";
this.tf=this.Aa.length=0;""!==$(a).val()&&(this.Aa.push("veremes_cadastre_commune"),void 0===A.F.M.Qa("veremes_cadastre_commune")&&A.F.M.Wa({Ma:"veremes_cadastre_commune",lb:"Commune",Fa:["zoom","delete"]}),this.Ue(A.properties.cadastre.api+"/communes","id_com",a,"veremes_cadastre_commune"));0<$(b).bootstrapTable("getAllSelections").length&&(this.Aa.push("veremes_cadastre_proprietaire"),void 0===A.F.M.Qa("veremes_cadastre_proprietaire")&&A.F.M.Wa({Ma:"veremes_cadastre_proprietaire",lb:"Propri\u00e9taire",
Fa:["delete"]}),a=$(b).bootstrapTable("getAllSelections")[0],this.mr(A.properties.cadastre.api+"/proprietaires",f,a.DDENOM.replace(/'/g,"''"),g,a.ID_COM,"veremes_cadastre_proprietaire"));if(0<$(c).bootstrapTable("getAllSelections").length){this.Aa.push("veremes_cadastre_compte");void 0===A.F.M.Qa("veremes_cadastre_compte")&&A.F.M.Wa({Ma:"veremes_cadastre_compte",lb:"Compte",Fa:["delete"]});c=$(c).bootstrapTable("getAllSelections");if("cadastre"===this.cadastreAPI_)var f="ID_COM",g="DNUPRO",h="oid";
else f="id_com",g="dnupro",h="id_local";a={relation:"OR",operators:[]};for(b=0;b<c.length;b++)a.operators.push({relation:"AND",operators:[{column:f,compare_operator:"=",value:c[b].ID_COM},{column:g,compare_operator:"=",value:c[b].DNUPRO}]});this.gg(A.properties.cadastre.api+"/proprietaires",a,"veremes_cadastre_compte")}0<$(d).bootstrapTable("getAllSelections").length&&(this.Aa.push("veremes_cadastre_invariant"),void 0===A.F.M.Qa("veremes_cadastre_invariant")&&A.F.M.Wa({Ma:"veremes_cadastre_invariant",
lb:"Invariant",Fa:["delete"]}),this.ci(A.properties.cadastre.api+"/invariants",h,d,"veremes_cadastre_invariant"));0<$(e).bootstrapTable("getAllSelections").length&&(this.Aa.push("veremes_cadastre_parcelle"),void 0===A.F.M.Qa("veremes_cadastre_parcelle")&&A.F.M.Wa({Ma:"veremes_cadastre_parcelle",lb:"Parcelle",Fa:["zoom","delete"]}),this.ci(A.properties.cadastre.api+"/parcelles","id_par",e,"veremes_cadastre_parcelle"));A.F.M.Xd(this.Aa[this.Aa.length-1])};
W.prototype.s.prototype.selectBatiByProprietaire=W.prototype.s.prototype.Tz;function Ex(){A.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.removeMapInteractions");A.g().Ge();A.g().Ea.hide()}A.module.directive("appCadastre",W.prototype.HC);A.module.controller("AppcadastreController",W.prototype.s);fv.pM={};function hd(){A.log("nsVmap.nsToolsManager.ToolsManager");this.$q=Lx();this.Mc=new wx;this.M=new U;this.Rx()}pa("nsVmap.nsToolsManager.ToolsManager",hd);hd.prototype.Rx=function(){A.log("nsVmap.nsToolsManager.ToolsManager.instanciateAvaliableModules");var a=Object.keys(fv.lm);A.log("avaliableModules: ",a);for(var b=0;b<a.length;b++)Mx(this,a[b])};hd.prototype.instanciateAvaliableModules=hd.prototype.Rx;
function Mx(a,b){A.log("nsVmap.nsToolsManager.ToolsManager.instanciateModule");b=b.toLowerCase().replace(/\b[a-z]/g,function(a){return a.toUpperCase()});null!=fv.lm[b]?a[b]=new fv.lm[b]:console.error("tool ("+b+") does not exist")}
hd.prototype.rB=function(){A.log("nsVmap.nsToolsManager.BasicTools.prototype.vmapToolsDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang",infos:"=appInfos",currentAction:"=appAction"},controller:"AppVmaptoolsController",controllerAs:"ctrl",bindToController:!0,templateUrl:A.properties.vmap_folder+"/template/tools/tools.html"}};hd.prototype.vmapToolsDirective=hd.prototype.rB;
hd.prototype.pB=function(a){return function(b){b.oToolsTree=A.F.$q;for(var c in b.oToolsTree){var d="",e='<div id="'+c+'-container" class="right-sidebar" ',e=e+("ng-class=\"ctrl.openedTool == '"+c+"' ? 'open' : ''\">"),f;for(f in b.oToolsTree[c])d+='<div id="'+f+'-tool" class="side-tool ng-isolate-scope app-'+f+'" ',d+='app-map="ctrl.map" app-lang="ctrl.lang" app-infos="ctrl.infos" app-action="ctrl.currentAction"></div>';angular.element($("tools-container")).append(a(e+d+"</div>")(b))}}};
hd.prototype.pB.$inject=["$compile"];hd.prototype.qB=function(){A.log("nsVmap.nsToolsManager.BasicTools.prototype.vmapToolsController");this.oToolsTree=A.F.$q;this.openedTool="_"};hd.prototype.vmapToolsController=hd.prototype.qB;function Lx(){var a={};z({method:"GET",url:A.properties.api_url+"/vmap/usermodules",async:!1,responseType:"",success:function(b){a=JSON.parse(b.data).usermodules}});return a}hd.prototype.ZE=function(){return this.$q};hd.prototype.getToolsTree=hd.prototype.ZE;
hd.prototype.cE=function(){return this.Mc};hd.prototype.getBasicTools=hd.prototype.cE;hd.prototype.nE=function(){return this.M};hd.prototype.getInfoContainer=hd.prototype.nE;hd.prototype.us=function(a){return this[a]};hd.prototype.getTool=hd.prototype.us;A.module.directive("appVmaptools",hd.prototype.rB);A.module.directive("toolsContainer",hd.prototype.pB);A.module.controller("AppVmaptoolsController",hd.prototype.qB);var Nx={};pa("nsUtils",Nx);Nx.BC=!1;Nx.log=function(a){null!=X.ea&&X.ea.debug_mode&&Nx.BC&&console.log(a)};Nx.log=Nx.log;Nx.Oe=function(){Nx.log("util.unselectAll");$("#treeView").treeview("unselectNode",[$("#treeView").treeview("getSelected"),{Qd:!0}]);$("#treeWithLines").treeview("unselectNode",[$("#treeWithLines").treeview("getSelected"),{Qd:!0}]);angular.element($("#studio_container")).scope().$broadcast("update element",{});angular.element($("#FormModal")).scope().ctrl.Qt()};Nx.unselectAll=Nx.Oe;
Nx.reloadForm=function(a){Nx.log("util.reloadForm");null!=a||(a="#studio_form_reader");var b=angular.element($(a).children()).scope();b.oFormValues[b.sFormDefinitionName]={};setTimeout(function(){b.compileTemplate();setTimeout(function(){b.ctrl.Kq(!0);setTimeout(function(){b.ctrl.lo()},100)},100)},100)};Nx.reloadForm=Nx.reloadForm;Nx.clone=function(a){Nx.log("util.clone");return a};Nx.clone=Nx.clone;Nx.tj=function(a){Nx.log("util.JsonStringifier");return JSON.stringify(a,null,2)};
Nx.JsonStringifier=Nx.tj;
Nx.Vq=function(a){var b=a.insert;0==b.javascript&&delete b.javascript;0==b.style&&delete b.style;for(var c=0;c<b.rows.length;)if("object"!==typeof b.rows)console.error("error on rows integrity, this row who have been deleted :",b.rows),delete b.rows;else{if(Array.isArray(b.rows[c].fields))for(var d=0;d<b.rows[c].fields.length;)if("object"!==typeof b.rows[c].fields[d])console.error("error on fields integrity, this field who have been deleted in row "+c+", field "+d+" :",b.rows[c].fields[d]),delete b.rows[c].fields[d];
else{var e=b.rows[c].fields[d],f=[];if("undefined"==typeof e.type||"undefined"==e.name||"undefined"==e.id)return console.error("error on minimal containt of a field :",e),null;switch(e.type){case "title":case "label":if("undefined"==typeof e.label)return console.error(e.type+" without a label isn't a "+e.type+" :",e),null;f=["type","id","label","name"];break;case "hr":f=["type","id","name"];break;case "subtitle":if("undefined"==typeof e.label)return console.error("subtitle without a text isn't a subtitle :",
e),null;"undefined"==typeof e["class"]&&delete e["class"];f=["type","id","label","name","class"];break;case "checkbox":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.checked&&0!=e.checked||delete e.checked;f=["type","id","label","name","checked"];break;case "radio":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.checked&&0!=e.checked||delete e.checked;f="type id label name checked options".split(" ");break;
case "textarea":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.required&&0!=e.required||delete e.required;"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f="type id label name required nb_cols".split(" ");break;case "select":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.required&&0!=e.required||delete e.required;"undefined"!=typeof e.multiple&&0!=e.multiple||delete e.multiple;if(!q(e.options)&&!r(e.options))return console.error(e.type+
"'s options are always an array :",e),null;if("object"!=typeof e.web_service)delete e.web_service;else if("undefined"!=typeof e.web_service.parameter&&delete e.web_service.parameter,"string"!=typeof e.web_service.ressource_id||"string"!=typeof e.web_service.id_key||"string"!=typeof e.web_service.label_key)return null;"string"!=typeof e.child_select&&delete e.child_select;"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f="type id label name required nb_cols multiple options web_service child_select".split(" ");
break;case "double_select":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.required&&0!=e.required||delete e.required;if(!Array.isArray[e.options])return console.error(e.type+"'s options are always an array :",e),null;if("object"!=typeof e.web_service)delete e.web_service,console.error(e.type+"'s WS are always an object :",e);else if("undefined"!=typeof e.web_service.parameter&&delete e.web_service.parameter,"string"!=typeof e.web_service.ressource_id||
"string"!=typeof e.web_service.id_key||"string"!=typeof e.web_service.label_key)return console.error(e.type+"'s WS parameter are always strings :",e),null;"undefined"==typeof e.size&&(e.size=5);"string"!=typeof e.label_from&&delete e.label_from;"string"!=typeof e.label_to&&delete e.label_to;"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f="type id label name required nb_cols options web_service size label_from label_to name_from name_to".split(" ");break;case "date":case "datetime":case "upload":case "display_label":case "color_picker":"undefined"==
typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f=["type","id","label","name","nb_cols"];break;case "tinymce":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"==typeof e.nb_rows&&delete e.nb_rows;"object"!=typeof e.options&&delete e.options;f="type id label name nb_rows options".split(" ");break;case "CodeMirror":case "slider":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"object"!=
typeof e.options&&delete e.options;f=["type","id","label","name","options"];break;case "text":case "password":case "url":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.required&&0!=e.required||delete e.required;"undefined"!=typeof e.pattern&&""!=e.pattern||delete e.pattern;"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f="type id label name pattern required nb_cols".split(" ");break;case "number":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",
e);"undefined"==typeof e.min&&delete e.min;"undefined"==typeof e.max&&delete e.max;"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f="type id label name min max nb_cols".split(" ");break;case "map_osm":case "map_bing":case "map_vmap":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.required&&0!=e.required||delete e.required;if("object"!=typeof e.map_options)delete e.map_options;else if(f=e.map_options,"map_osm"==e.type){"OSM"!=f.type&&console.warn(e.name+
" problem with data type :",f);if("object"!=typeof f.center)return console.error(e.name+"have no center's parameter :",f),null;var g=f.center;if(Array.isArray(g.coord)||Array.isArray(g.extent)){if(2!=g.coord.length&&Array.isArray(g.coord))return console.error(e.name+" bad parameters for center :",f),null;if(4!=g.extent.length&&Array.isArray(g.extent))return console.error(e.name+" bad parameters for extent :",f),null}else return console.error(e.name+" have no correct coordinate :",f),null;if(Array.isArray(g.coord)&&
"undefined"==typeof g.zoom&&"undefined"==typeof g.scale)return console.error(e.name+" center parameter need a scale value :",f),null;"undefined"==typeof g.zoom&&"undefined"!=typeof g.scale?delete g.zoom:"undefined"!=typeof g.zoom&&"undefined"==typeof g.scale&&delete g.scale;if("object"!=typeof f.controls)return console.error(e.name+" have no control's parameter :",f),null;if(4!=Object.keys(f.controls).length)return console.error(e.name+" bad control's parameter :",f),null;Array.isArray(f.layers)?
0==f.layers.length&&delete f.layers:console.warn(e.name+" layers problem :",f);if("object"!=typeof f.interactions)return console.error(e.name+" have no interactions's parameter :",f),null;if(7!=Object.keys(f.interactions).length)return console.error(e.name+" bad interactions's parameter :",f),null;"undefined"==typeof f.draw_color&&delete f.draw_color;Array.isArray(f.features)?0==f.features.length&&delete f.features:console.warn(e.name+" bad type for features :",f);"undefined"==typeof f.coord_accuracy&&
(f.coord_accuracy=8)}else if("map_bing"==e.type){"bing"!=f.type&&console.warn(e.name+" preoblem with data type :",f);if("object"!=typeof f.center)return console.error(e.name+"have no center's parameter :",f),null;g=f.center;if(Array.isArray(g.coord)||Array.isArray(g.extent)){if(2!=g.coord.length&&Array.isArray(g.coord))return console.error(e.name+" bad parameters for center :",f),null;if(4!=g.extent.length&&Array.isArray(g.extent))return console.error(e.name+" bad parameters for extent :",f),null}else return console.error(e.name+
" have no correct coordinate :",f),null;if(Array.isArray(g.coord)&&"undefined"==typeof g.zoom&&"undefined"==typeof g.scale)return console.error(e.name+" center parameter need a scale value :",f),null;"undefined"==typeof g.zoom&&"undefined"!=typeof g.scale?delete g.zoom:"undefined"!=typeof g.zoom&&"undefined"==typeof g.scale&&delete g.scale;if("object"!=typeof f.controls)return console.error(e.name+" have no control's parameter :",f),null;if(4!=Object.keys(f.controls).length)return console.error(e.name+
" bad control's parameter :",f),null;Array.isArray(f.layers)?0==f.layers.length&&delete f.layers:console.warn(e.name+" layers undefined :",f);if("object"!=typeof f.interactions)return console.error(e.name+" have no interactions's parameter :",f),null;if(7!=Object.keys(f.interactions).length)return console.error(e.name+" bad interactions's parameter :",f),null;"undefined"==typeof f.draw_color&&delete f.draw_color;Array.isArray(f.features)?0==f.features.length&&delete f.features:console.warn(e.name+
" bad type for features :",f);"undefined"==typeof f.coord_accuracy&&(f.coord_accuracy=8);if("object"!=typeof f.source)return console.error(e.name+" have no source's parameter :",f),null;if(3!=Object.keys(f.source).length)return console.error(e.name+" bad source's parameter :",f),null}else if("map_vmap"==e.type){"vmap"!=f.type&&console.warn(e.name+" preoblem with data type :",f);if("object"!=typeof f.center)return console.error(e.name+"have no center's parameter :",f),null;g=f.center;if(Array.isArray(g.coord)||
Array.isArray(g.extent)){if(2!=g.coord.length&&Array.isArray(g.coord))return console.error(e.name+" bad parameters for center :",f),null;if(4!=g.extent.length&&Array.isArray(g.extent))return console.error(e.name+" bad parameters for extent :",f),null}else return console.error(e.name+" have no correct coordinate :",f),null;if(Array.isArray(g.coord)&&"undefined"==typeof g.zoom&&"undefined"==typeof g.scale)return console.error(e.name+" center parameter need a scale value :",f),null;"undefined"==typeof g.zoom&&
"undefined"!=typeof g.scale?delete g.zoom:"undefined"!=typeof g.zoom&&"undefined"==typeof g.scale&&delete g.scale;if("object"!=typeof f.controls)return console.error(e.name+" have no control's parameter :",f),null;if(4!=Object.keys(f.controls).length)return console.error(e.name+" bad control's parameter :",f),null;Array.isArray(f.layers)?0==f.layers.length&&delete f.layers:console.warn(e.name+" bad type for layers :",f);if("object"!=typeof f.interactions)return console.error(e.name+" have no interactions's parameter :",
f),null;if(7!=Object.keys(f.interactions).length)return console.error(e.name+" bad interactions's parameter :",f),null;"undefined"==typeof f.draw_color&&delete f.draw_color;Array.isArray(f.features)?0==f.features.length&&delete f.features:console.warn(e.name+" bad type for features :",f);"undefined"==typeof f.coord_accuracy&&(f.coord_accuracy=8);if("object"!=typeof f.tree)return console.error(e.name+" have no tree object :",f),null;if(0==Object.keys(f.tree).length)return console.error(e.name+" empty tree :",
f),null}"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f="type id label name required map_options nb_cols".split(" ")}for(var h in e)-1===f.indexOf(h)&&delete e[h];d++}else console.error("error on fields integrity, this fields who have been deleted in row "+c+" :",b.rows[c].fields),delete b.rows[c].fields;c++}return a};Nx.JsonOptimizer=Nx.Vq;
Nx.Dg=function(a,b){a=n(a)?a:"";if(b=n(b)?b:!1)return this.Dg(a);a=a.replace(",",".");b=a.split(".");if(0===b.length)return NaN;if(1===b.length)return this.Dg(a);if(2<=b.length){a=this.Dg(b[0]);if(2===b.length)b=this.Dg(b[1]);else{for(var c="",d=1;d<b.length;d++)c+=b[d];b=this.Dg(c)}return parseFloat(a+"."+b)}return NaN};Nx.Dg=function(a){for(var b="",c=0;c<a.length;c++){var d=a.charAt(c);isNan(parseInt(d))||(b+=d)}return parseInt(b)};Nx.numberParser=Nx.Dg;
Nx.getElementsByName=function(a,b,c){var d=[];if(null==c||null==a[b]||null==a[b].rows)return d;for(var e=0;e<a[b].rows.length;e++)if(null!=a[b].rows[e].fields)for(var f=0;f<a[b].rows[e].fields.length;f++)a[b].rows[e].fields[f].name===c&&d.push(a[b].rows[e].fields[f]);return d};oProperties={mode:"dev",timeNotify:2500};function Ox(){X.log("nsVFB.JsonLoader");this.kj=null;X.module.directive("appJsonLoader",this.Tx);X.module.controller("AppJsonLoaderController",["$scope","$rootScope","$timeout",this.ya])}pa("nsVFB.JsonLoader",Ox);Ox.prototype.Tx=function(){X.log("nsVFB.JsonLoader.jsonLoaderDirective");return{restrict:"A",replace:!0,controller:"AppJsonLoaderController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/JsonLoader.html"}};
Ox.prototype.jsonLoaderDirective=Ox.prototype.Tx;
Ox.prototype.ya=function(a,b,c){X.log("nsVFB.JsonLoader.jsonLoaderController");var d=this;this.b=a;this.J=b;this.QA={};this.buttonHide=!1;this.aSuggestedTableFields=[];this.applicationName=X.eh();a.collapsed=X.Ug[0];a.iWorkspaceId=X.Wb();a.iWorkSpace=X.Wb();a["default"]="Default";a.FormSelected="Perso";a.token=X.Ax();b.selected_form_type=X.config.default_form_type;b.$watch("selected_form_type",function(a){X.log("jsonLoaderController selected_form_type");var c=X.ga();null==c[a]&&(c[a]={name:"custom-form",
title:"",input_size:"xxs",nb_cols:12,javascript:!1,rows:[]},X.Yb(c));b.$broadcast("updateEvent",X.ga());b.$broadcast("update element",{type:"undefined"})});X.gh().kj=new Slider("#slider_Form",{formatter:function(a){return Math.round(100*a/12)+"%"}});X.gh().kj.on("change",function(){var d=X.ga();d[b.selected_form_type].nb_cols=X.gh().kj.getValue();X.Yb(d);c(function(){b.$broadcast("updateJsonModel",X.ga());b.$broadcast("updateForm",X.ga());a.$apply()},1)});a.$watch("title",function(a){X.log("jsonLoaderController title");
var c=X.ga();c[b.selected_form_type]&&(c[b.selected_form_type].title=a);X.Yb(c);b.$broadcast("updateJsonModel",X.ga());b.$broadcast("updateForm",X.ga())});a.$watch("event",function(a){X.log("jsonLoaderController event");var c=X.ga();c[b.selected_form_type]&&(c[b.selected_form_type].event=a);X.Yb(c);b.$broadcast("updateJsonModel",X.ga());b.$broadcast("updateForm",X.ga())});a.$watch("token",function(a){X.log("jsonLoaderController token");X.setToken(a)});a.$watch("iWorkspaceId",function(a){X.log("jsonLoaderController id");
X.setId(a)});a.$watch("text",function(){X.log("jsonLoaderController text");"undefined"!==typeof a.text.Loader&&(d.text=a.text.Loader,c(function(){angular.element($("#load_Perso_button")).click();"wab"==X.eh()&&(d.buttonHide=!0)},500))});a.state=!1};Ox.prototype.jsonLoaderController=Ox.prototype.ya;
function Px(a,b){X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.requestToJson");var c={},d={};angular.element($("#FormModal")).scope().ctrl.ho();a.b.iWorkSpace=a.b.iWorkspaceId;a.b["default"]=a.b.FormSelected;a.b.collapsed=X.Ug[0];if("gtf"===a.applicationName)var e=X.ea.web_server_name+"/"+X.ea.services_alias+"/gtf/workspaces/"+X.Wb(),c={Accept:"application/json"},d={form:a.b.FormSelected};else"vmap"===a.applicationName?(e="Perso"===a.b.FormSelected?"custom":angular.lowercase(a.b.FormSelected),
e=X.ea.web_server_name+"/"+X.ea.services_alias+"/"+X.config.get.api+"/"+X.config.get.ressource+"/"+X.Wb()+"/forms/"+e+"/"):"wab"===a.applicationName&&(e=X.ea.web_server_name+"/"+X.ea.services_alias+"/"+X.config.get.api+"/"+X.config.get.ressource+"/"+X.Wb()+"/form");cd();z({method:"GET",url:e,headers:c,params:d,scope:a.b,success:function(c){dd();null!=c[0]||null!=c.data&&(c=c.data);if("gtf"===a.applicationName){if(null==c.workspaces&&null==c.data){var d;switch(a.b.FormSelected){case "Default":d="Default_Reset";
break;case "Published":d="Default_Published";break;case "Perso":d="Perso_Reset"}Qx(a,d,void 0,function(b){if(null!=b.errorMessage)return bootbox.alert("<h4>"+b.errorMessage+"</h4>",function(){}),0;Px(a)},function(b,c){$.notify(a.b.text.Loader.Notify.GetJson_Error+c,{className:"error",autoHideDelay:X.wb})})}}else if(null==c[0]){if(null!=X.config.get.no_result_function)a[X.config.get.no_result_function](c,b);return 0}Rx(a,c,b)},error:function(){dd();fa(void 0)&&a.b.$eval(void 0);$.notify(a.b.text.Loader.Notify.GetJson_Error+
status,{className:"error",autoHideDelay:X.wb})}})}
function Rx(a,b,c){X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.useJson");"gtf"===a.applicationName&&(b=null!=b.workspaces?b.workspaces[0].json_form:b.data[0].json_form);if(null==b[0])console.error("data[0] not defined, data: ",b);else if(X.eA(angular.copy(b[0])),X.Yb(angular.copy(b[0])),a.QA=angular.copy(b[0]),a.b.json_forms=null!=X.config.avaliable_form_types?X.config.avaliable_form_types:Object.keys(b[0]),-1!==a.b.json_forms.indexOf("datasources")&&a.b.json_forms.splice(a.b.json_forms.indexOf("datasources"),
1),n(b[1])&&!1!==b[1]?"gtf"===a.applicationName?z({method:"GET",url:b[1],scope:a.b,timeout:5E3,success:function(a){null!=a.data&&X.Ck(a.data.replace(/(?:\r\n|\r|\n)/g,"\r\n"))},error:function(){console.error("Problem on Loading javascript")}}):X.Ck(X.clone(b[1])):X.Ck(""),a.J.$broadcast("updateJS",X.qg()),n(b[2])&&!1!==b[2]&&(X.du(X.clone(b[2])),a.J.$broadcast("updateCSS",b[2])),null==b[0][a.J.selected_form_type])console.error("Result[0]["+a.J.selected_form_type+"] does not exist");else{b=b[0][a.J.selected_form_type].nb_cols;
var d=X.ga()[a.J.selected_form_type].title,e=X.ga()[a.J.selected_form_type].event,f=X.ga()[a.J.selected_form_type].input_size;X.gh().kj.setValue(b);a.b.title=d;a.b.event=e;a.b.input_size=f;a.J.$broadcast("updateEvent",X.ga());a.J.$broadcast("updateInfos",X.ga());a.J.$broadcast("update element",{type:"undefined"});fa(c)&&a.b.$eval(c);setTimeout(function(){X.reloadForm()})}}Ox.prototype.ya.prototype.load=function(a){X.log("load");"Perso"===a?this.hy(0,a):this.iy(a)};Ox.prototype.ya.prototype.load=Ox.prototype.ya.prototype.load;
Ox.prototype.ya.prototype.LK=function(){var a=X.ga()[this.J.selected_form_type].nb_cols;X.gh().kj.setValue(a)};Ox.prototype.ya.prototype.updateSlider=Ox.prototype.ya.prototype.LK;
Ox.prototype.ya.prototype.hy=function(a,b){function c(){$("#up_element_button").prop("disabled",!1);$("#down_element_button").prop("disabled",!1);$("#add_line_button").prop("disabled",!1);$("#add_row_button").prop("disabled",!1);$("#rem_element_button").prop("disabled",!1);$("#formTools_datasoure_button").prop("disabled",!1);$("#Title_Form_input").prop("disabled",!1);$("#select_size_input").prop("disabled",!1);X.gh().kj.enable();$("#boolean-JS-include").prop("disabled",!1);$("#boolean-CSS-include").prop("disabled",
!1);$("#Lock_Icon").removeClass("fa-lock");$(".selected-in-tree").removeClass("selected-in-tree")}X.log("nsVFB.JsonLoader.jsonLoaderController.loadWithEdit");var d=this;X.Bo().empty||"Perso"!==d.b["default"]?"Perso"!==d.b["default"]?(d.b.FormSelected=b,Px(d),c()):(Px(d),d.b.FormSelected=b):bootbox.confirm("<h4>"+this.text.Confirmation.Lose+"</h4>",function(a){!0===a&&(angular.element($("#FormModal")).scope().ctrl.ho(),d.b.FormSelected=b,Px(d),c())})};Ox.prototype.ya.prototype.loadWithEdit=Ox.prototype.ya.prototype.hy;
Ox.prototype.ya.prototype.iy=function(a){function b(){$("#up_element_button").prop("disabled",!0);$("#down_element_button").prop("disabled",!0);$("#add_line_button").prop("disabled",!0);$("#add_row_button").prop("disabled",!0);$("#rem_element_button").prop("disabled",!0);$("#formTools_datasoure_button").prop("disabled",!0);$("#Title_Form_input").prop("disabled",!0);$("#select_size_input").prop("disabled",!0);X.gh().kj.disable();$("#boolean-JS-include").prop("disabled",!0);$("#boolean-CSS-include").prop("disabled",
!0);c.J.$broadcast("update element",{});$("#Lock_Icon").addClass("fa-lock");$(".selected-in-tree").removeClass("selected-in-tree")}X.log("nsVFB.JsonLoader.jsonLoaderController.loadWithoutEdit");var c=this;X.Bo().empty||"Perso"!==c.b["default"]?"Perso"!==c.b["default"]&&(c.b.FormSelected=a,Px(c),b()):angular.equals(X.Bo(),c.QA)?(angular.element($("#FormModal")).scope().ctrl.ho(),c.b.FormSelected=a,Px(c),b()):bootbox.OL({message:"<h4>"+c.text.Confirmation.Lose+"<br><br>"+c.text.Confirmation.SaveAndChange+
" ?</h4>",buttons:{success:{label:c.text.Confirmation.Yes,className:"btn-primary",mb:function(){c.save(function(){c.b.FormSelected=a;Px(c);b()})}},ML:{label:c.text.Confirmation.No,className:"btn-danger",mb:function(){c.b.FormSelected=a;Px(c);b()}},eM:{label:c.text.Confirmation.Cancel,className:"btn-default",mb:function(){}}}})};Ox.prototype.ya.prototype.loadWithoutEdit=Ox.prototype.ya.prototype.iy;
Ox.prototype.ya.prototype.resize=function(){this.b.collapsed=!this.b.collapsed;X.Ug[0]=this.b.collapsed;X.resize()};Ox.prototype.ya.prototype.resize=Ox.prototype.ya.prototype.resize;
Ox.prototype.ya.prototype.save=function(a,b){function c(a,c){fa(b)&&e.b.$eval(b);$.notify(e.b.text.Loader.Notify.SaveData_Error+c,{className:"error",autoHideDelay:X.wb})}function d(){Px(e,a);$.notify(e.b.text.Loader.Notify.SaveData,{className:"success",autoHideDelay:X.wb})}X.log("nsVFB.JsonLoader.jsonLoaderController.save");var e=this,f=new FormData,g=X.ga();X.Oe();"gtf"===this.applicationName&&(g[e.J.selected_form_type].name="WSubform",g.display=g[e.J.selected_form_type],g.update=g[e.J.selected_form_type]);
n(g.search)||(g.search={});f.append("Json",JSON.stringify(g));f.append("Js",X.qg());f.append("Css",X.xi());X.valid=Sx(this,g);X.valid&&null!==g?Qx(e,"Perso_Save",f,d,c):$.notify(e.b.text.Loader.Notify.Validation_Error+": "+X.vj,{className:"error",autoHideDelay:X.wb});X.xc=!1};Ox.prototype.ya.prototype.save=Ox.prototype.ya.prototype.save;
Ox.prototype.ya.prototype.fI=function(){function a(a,b){$.notify(c.b.text.Loader.Notify.SaveData_Error+b,{className:"error",autoHideDelay:X.wb})}function b(){Qx(c,c.b.FormSelected+"_Published","",function(){Px(c);$.notify(c.b.FormSelected+c.b.text.Loader.Notify.PublishAndSave,{className:"success",autoHideDelay:X.wb})},function(a,b){$.notify(c.b.text.Loader.Notify.Publish_Error+b,{className:"error",autoHideDelay:X.wb})})}X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.publish");X.xc=!1;var c=
this,d=new FormData,e=X.ga();X.Oe();"gtf"===this.applicationName&&(e[c.J.selected_form_type].name="WSubform",e.display=e[c.J.selected_form_type],e.update=e[c.J.selected_form_type]);d.append("Json",JSON.stringify(e));d.append("Js",X.qg());d.append("Css",X.xi());X.valid?"Default"!=c.b.FormSelected?Qx(c,"Perso_Save",d,b,a):Qx(c,"Default_Published",d,b,a):$.notify(c.b.text.Loader.Notify.Validation_Error,{className:"error",autoHideDelay:X.wb})};Ox.prototype.ya.prototype.publish=Ox.prototype.ya.prototype.fI;
function Sx(a,b){X.log("nsVFB.JsonLoader.jsonLoaderController.save");Na(X.vj);for(var c in b)if("datasources"!==c&&null!=b[c].rows)for(var d=0;d<b[c].rows.length;d++)for(var e=0;e<b[c].rows[d].fields.length;e++)null!==b[c].rows[d].fields[e].name.match(/\s/g)&&("gtf"===a.applicationName?X.vj.push(b[c].rows[d].fields[e].name):1>X.config.avaliable_form_types.length?X.vj.push(b[c].rows[d].fields[e].name):X.vj.push(c+"."+b[c].rows[d].fields[e].name));return 0<X.vj.length?!1:!0}
Ox.prototype.ya.prototype.reset=function(){X.log("nsVFB.JsonLoader.jsonLoaderController.reset");var a=this;bootbox.confirm("<h4>"+this.text.Confirmation.Lose+"</h4>",function(b){if(!0===b)if("Default"===a.b.FormSelected&&"gtf"!==a.applicationName){if(null!=X.config.reset_default_function)a[X.config.reset_default_function]()}else Qx(a,a.b.FormSelected+"_Reset","",function(){$.notify(a.b.FormSelected+a.b.text.Loader.Notify.Reset,{className:"success",autoHideDelay:X.wb});"Perso"===a.b.FormSelected&&
Px(a)},function(b,d){$.notify(a.b.text.Loader.Notify.Reset_Error+d,{className:"error",autoHideDelay:X.wb})})})};Ox.prototype.ya.prototype.reset=Ox.prototype.ya.prototype.reset;
function Qx(a,b,c,d,e){X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.putRequest");var f="",g={};"gtf"===a.applicationName?(f=X.ea.web_server_name+"/"+X.ea.services_alias+"/gtf/workspaces/"+X.Wb(),g={cmd:b}):"vmap"===a.applicationName?(f="Perso"===a.b.FormSelected?"custom":angular.lowercase(a.b.FormSelected),f=X.ea.web_server_name+"/"+X.ea.services_alias+"/"+X.config.get.api+"/"+X.config.get.ressource+"/"+X.Wb()+"/forms/"+f,g={cmd:b}):"wab"===a.applicationName&&(f=X.ea.web_server_name+
"/"+X.ea.services_alias+"/"+X.config.get.api+"/"+X.config.get.ressource+"/"+X.Wb()+"/form");z({method:"PUT",url:f,headers:{"Content-Type":"undefined"},params:g,data:c,scope:a.b,success:d,error:e})}Ox.prototype.ya.prototype.QJ=function(){X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.suggestGenerateForm");var a=this;bootbox.confirm("<h4>"+this.b.text.Loader.Notify.generate_form+"</h4>",function(b){!0===b?a.BA():(a.aSuggestedTableFields=[],a.bs())})};
Ox.prototype.ya.prototype.suggestGenerateForm=Ox.prototype.ya.prototype.QJ;
Ox.prototype.ya.prototype.RK=function(a,b){X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.useEmptyForm");$.notify(this.b.text.Loader.Notify.no_form,"warning");var c=n(X.config.avaliable_form_types)?X.config.avaliable_form_types:["search","insert","update","display"],d={input_size:"xxs",javascript:!1,name:"custom-form",nb_cols:12,rows:[],title:""};a[0]={datasources:{}};for(var e=0;e<c.length;e++)a[0][c[e]]=d;Rx(this,a,b)};Ox.prototype.ya.prototype.useEmptyForm=Ox.prototype.ya.prototype.RK;
Ox.prototype.ya.prototype.BA=function(){X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.suggestColumnsToGenerateForm");var a=X.ea.web_server_name+"/"+X.ea.services_alias+"/vmap/businessobjects/"+X.Wb()+"/fields/";"wab"===X.eh()&&(a=X.ea.web_server_name+"/"+X.ea.services_alias+"/wab/sections/"+X.Wb()+"/fields");var b=this;n(b.aSuggestedTableFields)&&Na(b.aSuggestedTableFields);z({method:"GET",url:a,headers:{Accept:"application/x-vm-json"},scope:this.b,success:function(a){if(q(a.data)&&
0!==a.data.length)b.aSuggestedTableFields=a.data,$("#select-fields-modal").modal("show");else{var c=angular.element(u.f).scope();c.$root.modalWindow("confirm",b.b.text.Loader.Notify.generate_form_error,{className:"modal-danger",message:b.b.text.Loader.Notify.generate_form_error_description,buttons:{cancel:{label:'<i class="glyphicon glyphicon-remove"></i> Annuler',className:"btn-default"},confirm:{label:'<i class="glyphicon glyphicon-ok"></i> Poursuivre quand m\u00eame',className:"btn-danger"}},callback:function(a){!0===
a?(b.aSuggestedTableFields=[],b.bs()):c.setMode("search")}})}},error:function(){$.notify(b.b.text.Loader.Notify.CreateJson_Error+status,{className:"error",autoHideDelay:X.wb})}})};Ox.prototype.ya.prototype.suggestColumnsToGenerateForm=Ox.prototype.ya.prototype.BA;
Ox.prototype.ya.prototype.bs=function(){X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.generateFormByBusinessObject");var a=this,b="",b="Perso"===a.b.FormSelected?"custom":"Default"===a.b.FormSelected?"default":"published",b=X.ea.web_server_name+"/"+X.ea.services_alias+"/vmap/businessobjects/"+X.Wb()+"/forms/"+b+"/";"wab"===X.eh()&&(b=X.ea.web_server_name+"/"+X.ea.services_alias+"/wab/sections/"+X.Wb()+"/form");for(var c=[],d={},e=0;e<a.aSuggestedTableFields.length;e++)!0===a.aSuggestedTableFields[e].fields[0].bUseForGenerate&&
c.push(a.aSuggestedTableFields[e].fields[0].name),d[a.aSuggestedTableFields[e].fields[0].name]=a.aSuggestedTableFields[e].fields[0].label;c=c.toString().replace(/,/gi,"|");$("#select-fields-modal").modal("hide");"Default"===a.b.FormSelected?Qx(a,a.b.FormSelected+"_Reset",{field:c,label:d},function(){$.notify(a.b.FormSelected+a.b.text.Loader.Notify.Reset,{className:"success",autoHideDelay:X.wb});"Default"===a.b.FormSelected&&Px(a)},function(b,c){$.notify(a.b.text.Loader.Notify.Reset_Error+c,{className:"error",
autoHideDelay:X.wb})}):z({method:"POST",url:b,data:{fields:c,label:d},scope:this.b,success:function(){Px(a)},error:function(){$.notify(a.b.text.Loader.Notify.CreateJson_Error+status,{className:"error",autoHideDelay:X.wb})}})};Ox.prototype.ya.prototype.generateFormByBusinessObject=Ox.prototype.ya.prototype.bs;
Ox.prototype.ya.prototype.OJ=function(){X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.suggestColumnsSelectAllFields");for(var a=0;a<this.aSuggestedTableFields.length;a++)this.aSuggestedTableFields[a].fields[0].bUseForGenerate=!0};Ox.prototype.ya.prototype.suggestColumnsSelectAllFields=Ox.prototype.ya.prototype.OJ;
Ox.prototype.ya.prototype.PJ=function(){X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.suggestColumnsSelectAllFields");for(var a=0;a<this.aSuggestedTableFields.length;a++)this.aSuggestedTableFields[a].fields[0].bUseForGenerate=!1};Ox.prototype.ya.prototype.suggestColumnsUnselectAllFields=Ox.prototype.ya.prototype.PJ;
Ox.prototype.ya.prototype.NJ=function(){X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.suggestColumnsAreAllFieldsSelected");for(var a=!0,b=0;b<this.aSuggestedTableFields.length;b++)!0!==this.aSuggestedTableFields[b].fields[0].bUseForGenerate&&(a=!1);return a};Ox.prototype.ya.prototype.suggestColumnsAreAllFieldsSelected=Ox.prototype.ya.prototype.NJ;function Tx(){X.log("nsVFB.FormTools");X.module.directive("appFormTools",this.hx);X.module.controller("AppFormToolsController",["$scope","$rootScope","$timeout",this.kb])}pa("nsVFB.FormTools",Tx);Tx.prototype.hx=function(){X.log("nsVFB.FormTools.FormToolsDirective");return{restrict:"A",replace:!0,controller:"AppFormToolsController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/FormTools.html"}};Tx.prototype.formToolsDirective=Tx.prototype.hx;
Tx.prototype.kb=function(a,b,c){X.log("nsVFB.FormTools.FormToolsController");var d=this;this.J=b;this.b=a;this.Wr=0;this.applicationName=X.eh();this.bTreeWithLines_=!1;a.copyPasteContainer={};a.$watch("text",function(){X.log("formtools text");n(a.text.FormTools)&&(d.text=a.text.FormTools)});a.colapse_tools=X.Ug[2];d.yw=function(a){X.log("nsVFB.FormTools.convertJson");var c=X.ga(),d=[];if(null==c)return console.error("No JSON founded"),d;a=n(a)?a:!0;if(!fb(c[b.selected_form_type]))for(var e=0;e<c[b.selected_form_type].rows.length;e++){!0===
a&&null!=this.text&&d.push({text:this.text.Row+" "+e,state:{expanded:!0},tags:[0],nodes:[],row:e,draggable:!0});for(var f=0;f<c[b.selected_form_type].rows[e].fields.length;f++){var g;switch(c[b.selected_form_type].rows[e].fields[f].type){case "codemirror":g="icon-code";break;case "select":case "list":case "double_select":g="icon-format_list_bulleted";break;case "text":case "tinymce":g="icon-font";break;case "upload":g="icon-file";break;case "checkbox":g="icon-check-square";break;case "radio":g="icon-dot-circle-o";
break;case "date":case "datetime":g="icon-calendar-check-o";break;case "password":g="icon-key";break;case "email":g="icon-at";break;case "url":g="icon-chrome";break;case "integer":case "float":case "number":g="icon-calculator";break;case "color_picker":g="icon-paint";break;case "slider":g="icon-sliders";break;case "textarea":g="icon-paragraph";break;case "hr":g="icon-minus";break;case "label":g="icon-eye";break;case "email":g="icon-at";break;case "hidden":g="icon-user-secret";break;case "link":g=
"glyphicon glyphicon-link";break;case "image":g="glyphicon glyphicon-picture";break;case "map_bing":case "map_osm":case "map_vmap":g="icon-map";break;default:g="icon-point"}!0===a?null!=d[e]&&(d[e].tags[0]+=1,d[e].nodes.push({text:"  "+c[b.selected_form_type].rows[e].fields[f].name,type:c[b.selected_form_type].rows[e].fields[f].type,icon:g,row:e,field:f,draggable:!0})):d.push({text:"  "+c[b.selected_form_type].rows[e].fields[f].name,type:c[b.selected_form_type].rows[e].fields[f].type,icon:g,row:e,
field:f,draggable:!0})}}return d};a.$on("updateEvent",function(){var e=d.yw(!0),f=$("#treeWithLines").treeview("getCollapsed");if(!n(e))return console.error("No JSON converted founded"),0;if(!n(f))return console.error("collapsedNodes undefined"),0;for(var g=0;g<e.length;g++)e[g].collapsed=!1;for(g=0;g<f.length;g++)if(n(f[g].nodes))for(var p=0;p<e.length;p++)f[g].row===e[p].row&&(e[p].collapsed=!0);$("#treeWithLines").treeview({data:e,showTags:!0,showBorder:!1,expandIcon:"glyphicon glyphicon-menu-right",
collapseIcon:"glyphicon glyphicon-menu-down",onNodeSelected:function(a,e){n(e.field)?(c(function(){var a=$("#treeView").treeview("search",[e.text,{ignoreCase:!0,exactMatch:!0,revealResults:!1}]);$("#treeView").treeview("selectNode",[a[0].nodeId,{Qd:!0}]);$("#treeView").treeview("clearSearch")}),d.fu({type:"element",element_name:e.text.replace(/\s/g,"")}),b.$broadcast("update element",X.ga()[b.selected_form_type].rows[e.row].fields[e.field])):d.fu({type:"row",row_id:parseInt(e.row)})},onNodeUnselected:function(){X.Oe()},
onNodeHoverIn:function(a){a=a.currentTarget;$(a)[0].childNodes[2].data?(a=$(a)[0].childNodes[2].data.split(" "),a={type:"row",row_id:parseInt(a[1])}):a={type:"element",element_name:$(a)[0].textContent.replace(/\s/g,"")};d.Km(a)},onNodeHoverOut:function(){d.Km({})},highlightSelected:!0,multiSelect:!1});$("#treeView").treeview({data:d.yw(!1),showTags:!1,showBorder:!1,levels:1,showIcon:!0,onNodeSelected:function(b,c){"undefined"!==typeof c.field&&(b=$("#treeWithLines").treeview("search",[c.text,{ignoreCase:!0,
exactMatch:!0,revealResults:!1}]),c=$("#treeWithLines").treeview("search",[a.$parent.text.FormTools.Row+" "+b[0].row,{ignoreCase:!0,exactMatch:!0,revealResults:!1}]),$("#treeWithLines").treeview("expandNode",[c[0].nodeId,{Qd:!0}]),$("#treeWithLines").treeview("selectNode",[b[0].nodeId,{Qd:!1}]),$("#treeWithLines").treeview("clearSearch"))},onNodeUnselected:function(){X.Oe()},onNodeHoverIn:function(a){d.Km({type:"element",element_name:$(a.currentTarget)[0].textContent.replace(/\s/g,"")})},onNodeHoverOut:function(){d.Km({})},
highlightSelected:!0,multiSelect:!1});e=$("#treeWithLines").treeview("getEnabled");for(g=0;g<e.length;g++)!0===e[g].collapsed&&$("#treeWithLines").treeview("collapseNode",e[g])});var e={},f={},g=!0;document.getElementById("treeWithLines").addEventListener("dragstart",function(a){$("#load_Perso_button").hasClass("active")&&(a.dataTransfer.setData("Text",a.target.id),a.target.style.opacity="0.5",a.dataTransfer.effectAllowed="move",e=a.target,X.Om("FormTools"))});document.getElementById("treeWithLines").addEventListener("dragover",
function(a){a.preventDefault()});document.getElementById("treeWithLines").addEventListener("dragenter",function(a){$("#load_Perso_button").hasClass("active")&&(a=a.target,"FormTools"===X.Sl()&&($(a).trigger("mouseover"),a!==e&&"LI"===$(a)[0].tagName&&($(e).remove(),parseInt($(f).attr("data-nodeid"))<parseInt($(a).attr("data-nodeid"))?$(e).insertAfter(a):$(e).insertBefore(a),$(f).trigger("mouseout"),f=a)))});document.getElementById("treeWithLines").addEventListener("drop",function(){if($("#load_Perso_button").hasClass("active")){var c=
0,g=0,m=X.ga(),p=0;if("FormTools"===X.Sl())if(e.style.opacity="1","indent"===e.childNodes[0].className){var t=g=0;if("indent"===f.childNodes[0].className){var g=parseInt($(e).attr("data-nodeid")),t=$("#treeWithLines").treeview("getNode",g).row,g=$("#treeWithLines").treeview("getNode",g).field,c=parseInt($(f).attr("data-nodeid")),v=$("#treeWithLines").treeview("getNode",c).row,c=$("#treeWithLines").treeview("getNode",c).field,p=m[b.selected_form_type].rows[t].fields[g];m[b.selected_form_type].rows[t].fields.splice(g,
1);m[b.selected_form_type].rows[v].fields.splice(c,0,p);t!==v&&(Ux(m[b.selected_form_type].rows[t]),Ux(m[b.selected_form_type].rows[v]))}else g=parseInt($(e).attr("data-nodeid")),t=$("#treeWithLines").treeview("getNode",g).row,g=$("#treeWithLines").treeview("getNode",g).field,c=parseInt(f.childNodes[2].data.split(" ")[1]),p=m[b.selected_form_type].rows[t].fields[g],m[b.selected_form_type].rows[t].fields.splice(g,1),m[b.selected_form_type].rows[c].fields.unshift(p),Ux(m[b.selected_form_type].rows[t]),
Ux(m[b.selected_form_type].rows[c]);0===m[b.selected_form_type].rows[t].fields.length&&m[b.selected_form_type].rows.splice(t,1)}else"indent"===f.childNodes[0].className?$.notify(d.text.Notify.Error_ElOnRow,{className:"error",autoHideDelay:X.wb}):(g=parseInt(e.childNodes[2].data.split(" ")[1]),c=parseInt(f.childNodes[2].data.split(" ")[1]),p=m[b.selected_form_type].rows[g],m[b.selected_form_type].rows.splice(g,1),m[b.selected_form_type].rows.splice(c,0,p));X.Yb(m);$(".hover-in-tree").each(function(a,
b){$(b).removeClass("hover-in-tree")});$(".selected-in-tree").removeClass("selected-in-tree");b.$broadcast("updateEvent",X.ga());X.Om("no tree");a.$apply()}});document.getElementById("treeView").addEventListener("dragstart",function(a){$("#load_Perso_button").hasClass("active")&&(a.dataTransfer.setData("Text",a.target.id),a.target.style.opacity="0.5",a.dataTransfer.effectAllowed="move",e=a.target,X.Om("treeView"))});document.getElementById("treeView").addEventListener("dragover",function(a){a.preventDefault()});
document.getElementById("treeView").addEventListener("dragenter",function(a){$("#load_Perso_button").hasClass("active")&&(a=a.target,"treeView"===X.Sl()&&($(a).trigger("mouseover"),a!==e&&"LI"===$(a)[0].tagName&&(parseInt($(f).attr("data-nodeid"))<parseInt($(a).attr("data-nodeid"))?($(e).remove(),$(e).insertAfter(a),$(f).trigger("mouseout"),f=a,g=!1):($(e).remove(),$(e).insertBefore(a),$(f).trigger("mouseout"),f=a,g=!0))))});document.getElementById("treeView").addEventListener("drop",function(){if($("#load_Perso_button").hasClass("active")){var c=
0,d=0,m=X.ga(),p=0;if("treeView"===X.Sl()){e.style.opacity="1";var d=parseInt($(e).attr("data-nodeid")),t=$("#treeView").treeview("getNode",d).row,d=$("#treeView").treeview("getNode",d).field,c=parseInt($(f).attr("data-nodeid")),v=$("#treeView").treeview("getNode",c).row,c=$("#treeView").treeview("getNode",c).field,p=m[b.selected_form_type].rows[t].fields[d];m[b.selected_form_type].rows[t].fields.splice(d,1);g||(c+=1);m[b.selected_form_type].rows[v].fields.splice(c,0,p);0===m[b.selected_form_type].rows[t].fields.length&&
m[b.selected_form_type].rows.splice(t,1)}X.Yb(m);$(".hover-in-tree").each(function(a,b){$(b).removeClass("hover-in-tree")});$(".selected-in-tree").removeClass("selected-in-tree");b.$broadcast("updateEvent",X.ga());a.$apply();X.Om("no tree")}});d.resize=function(){a.colapse_tools=!a.colapse_tools;X.Ug[2]=a.colapse_tools;X.resize()}};Tx.prototype.formToolsController=Tx.prototype.kb;
Tx.prototype.kb.prototype.bi=function(){X.log("nsVFB.FormTools.prototype.formToolsController.prototype.addLine");var a=$("#treeWithLines").treeview("getSelected"),b=X.ga();1!==a.length&&(a=[Vx(this)]);n(a[0].field)&&(a=[$("#treeWithLines").treeview("getNode",a[0].parentId)]);1===a.length?n(a[0].field)||b[this.J.selected_form_type].rows.splice(a[0].row+1,0,{fields:[]}):$.notify(this.text.Notify.Forgotten,{className:"error",autoHideDelay:X.wb});$(".selected-in-tree").each(function(a,b){$(b).removeClass("selected-in-tree")});
X.Yb(b);this.J.$broadcast("updateEvent",X.ga())};Tx.prototype.kb.prototype.addLine=Tx.prototype.kb.prototype.bi;
Tx.prototype.kb.prototype.addElement=function(){X.xc=!0;X.log("nsVFB.FormTools.prototype.formToolsController.prototype.addElement");var a=this,b=$("#treeWithLines").treeview("getSelected"),c=X.ga(),d=!1;if(1!==b.length){var e=Vx(this);if(this.bTreeWithLines_||!n(e.nodes))this.bi(),e=Vx(this),d=!0;b=[e]}if(1===b.length){var f=function(b){for(var c=0;c<b.length;c++)if(n(b[c].fields))for(var d=0;d<b[c].fields.length;d++)if(b[c].fields[d].name==="Element_"+a.Wr){a.Wr++;f(b);return}},g=X.ga()[this.J.selected_form_type].rows;
f(g);var g="Element_"+this.Wr,e={type:"text",name:g,label:"",required:!1,pattern:"",nb_cols:12},h=b[0].nodeId;this.bTreeWithLines_?(c[this.J.selected_form_type].rows[b[0].row].fields.splice(b[0].field+1,0,e),h+=1):d?(c[this.J.selected_form_type].rows[b[0].row].fields.push(e),h+=2):(this.bi(),c[this.J.selected_form_type].rows[b[0].row+1].fields.push(e),e=Vx(this).nodeId+1,h=b[0].row+1===c[this.J.selected_form_type].rows.length-1?h+2+c[this.J.selected_form_type].rows[b[0].row].fields.length:h+1+c[this.J.selected_form_type].rows[b[0].row].fields.length);
Ux(c[this.J.selected_form_type].rows[b[0].row]);null!=c[this.J.selected_form_type].tabs&&null!=c[this.J.selected_form_type].tabs.list&&null!=c[this.J.selected_form_type].tabs.list[0]&&q(c[this.J.selected_form_type].tabs.list[0].elements)&&c[this.J.selected_form_type].tabs.list[0].elements.push(g);X.Yb(c);this.J.$broadcast("updateEvent",X.ga());$("#TreeView_Button_Group").confirmation("destroy");$("#treeWithLines").treeview("selectNode",[h,{Qd:!1}])}else $.notify(this.text.Notify.Forgotten,{className:"error",
autoHideDelay:X.wb})};Tx.prototype.kb.prototype.addElement=Tx.prototype.kb.prototype.addElement;
Tx.prototype.kb.prototype.tI=function(){X.xc=!0;X.log("nsVFB.FormTools.prototype.formToolsController.prototype.removeElement");var a=$("#treeWithLines").treeview("getSelected"),b=X.ga(),c=this;if(0===a.length)return $.notify(this.text.Notify.Forgotten,{className:"error",autoHideDelay:X.wb}),0;if(n(a[0].nodes)){if(1<a[0].nodes.length)return $.notify(this.text.Notify.Multiple_elements,{className:"error",autoHideDelay:X.wb}),0;a=a[0].nodes}1===a.length?bootbox.confirm("<h4>"+this.text.Confirmation.Remove+
"</h4>",function(d){if(!0===d){d=b[c.J.selected_form_type].rows[a[0].row];var e=d.fields[a[0].field].name;if(null!=e&&null!=b[c.J.selected_form_type].tabs){var f=b[c.J.selected_form_type].tabs.list;if(q(f))for(var g=0;g<f.length;g++)q(f[g].elements)&&-1!==f[g].elements.indexOf(e)&&f[g].elements.splice(f[g].elements.indexOf(e),1)}if(null!=e&&(f=b[c.J.selected_form_type].wab,null!=f))for(var h in f)for(var k in f[h])null!=f[h][k][e]&&delete f[h][k][e];d.fields.splice(a[0].field,1);0===b[c.J.selected_form_type].rows[a[0].row].fields.length&&
b[c.J.selected_form_type].rows.splice(a[0].row,1);Ux(d);$(".selected-in-tree").each(function(a,b){$(b).removeClass("selected-in-tree")});X.Oe();X.Yb(b);c.J.$broadcast("updateEvent",X.ga());c.b.$apply();$("#Formtools_buttons").confirmation("destroy");$.notify(c.text.Notify.Remove,{className:"success",autoHideDelay:X.wb})}}):$.notify(this.text.Notify.Forgotten,{className:"error",autoHideDelay:X.wb})};Tx.prototype.kb.prototype.removeElement=Tx.prototype.kb.prototype.tI;
Tx.prototype.kb.prototype.Tk=function(){X.xc=!0;X.log("nsVFB.FormTools.prototype.formToolsController.prototype.up");var a=$("#treeWithLines").treeview("getSelected"),b=a[0].nodeId,c=X.ga();if(1===a.length)if(n(a[0].field))if(0<=a[0].field-1)e=c[this.J.selected_form_type].rows[a[0].row].fields[a[0].field-1],c[this.J.selected_form_type].rows[a[0].row].fields[a[0].field-1]=c[this.J.selected_form_type].rows[a[0].row].fields[a[0].field],c[this.J.selected_form_type].rows[a[0].row].fields[a[0].field]=e,
b--;else{var d=c[this.J.selected_form_type].rows[a[0].row].fields[a[0].field];if(0===a[0].row)this.bi(),c[this.J.selected_form_type].rows[a[0].row+1].fields.push(d),c[this.J.selected_form_type].rows[a[0].row].fields.splice(a[0].field,1),d=c[this.J.selected_form_type].rows[a[0].row],c[this.J.selected_form_type].rows[a[0].row]=c[this.J.selected_form_type].rows[a[0].row+1],c[this.J.selected_form_type].rows[a[0].row+1]=d,Ux(c[this.J.selected_form_type].rows[a[0].row]),Ux(c[this.J.selected_form_type].rows[a[0].row+
1]),b=1,$("#treeWithLines").treeview("expandNode",Wx(this,b));else if(this.bTreeWithLines_)c[this.J.selected_form_type].rows[a[0].row-1].fields.push(d),c[this.J.selected_form_type].rows[a[0].row].fields.splice(a[0].field,1),Ux(c[this.J.selected_form_type].rows[a[0].row-1]),Ux(c[this.J.selected_form_type].rows[a[0].row]),0===c[this.J.selected_form_type].rows[a[0].row].fields.length&&c[this.J.selected_form_type].rows.splice(a[0].row,1),b--,a=Xx(b),$("#treeWithLines").treeview("expandNode",a);else{e=
Xx(b);if(1===e.nodes.length)return $("#treeWithLines").treeview("selectNode",[e.nodeId,{Qd:!0}]),this.Tk(),0;this.bi();c[this.J.selected_form_type].rows[a[0].row+1].fields.push(d);c[this.J.selected_form_type].rows[a[0].row].fields.splice(a[0].field,1);d=c[this.J.selected_form_type].rows[a[0].row];c[this.J.selected_form_type].rows[a[0].row]=c[this.J.selected_form_type].rows[a[0].row+1];c[this.J.selected_form_type].rows[a[0].row+1]=d;Ux(c[this.J.selected_form_type].rows[a[0].row]);Ux(c[this.J.selected_form_type].rows[a[0].row+
1])}}else{if(0<=a[0].row-1){var d=a[0].row,a=a[0],e=Xx(b),f=$("#treeWithLines").treeview("getCollapsed");a.collapsed=eb(f,a);e.collapsed=eb(f,e);!0===e.collapsed?$("#treeWithLines").treeview("collapseNode",a.nodeId):$("#treeWithLines").treeview("expandNode",a.nodeId);!0===a.collapsed?$("#treeWithLines").treeview("collapseNode",e.nodeId):$("#treeWithLines").treeview("expandNode",e.nodeId);var e;a.collapsed=e.collapsed;e.collapsed=a.collapsed;e=c[this.J.selected_form_type].rows[d-1];c[this.J.selected_form_type].rows[d-
1]=c[this.J.selected_form_type].rows[d];c[this.J.selected_form_type].rows[d]=e}a=Xx(b);b=a.nodeId;this.bTreeWithLines_||(b=a.nodes[0].nodeId)}else $.notify(this.text.Notify.Forgotten,{className:"error",autoHideDelay:X.wb});for(a=0;a<c[this.J.selected_form_type].rows.length;a++)0===c[this.J.selected_form_type].rows[a].fields.length&&c[this.J.selected_form_type].rows.splice(a,1);X.Yb(c);this.J.$broadcast("updateEvent",X.ga());$("#treeWithLines").treeview("selectNode",[b,{Qd:!1}])};
Tx.prototype.kb.prototype.up=Tx.prototype.kb.prototype.Tk;
Tx.prototype.kb.prototype.Gj=function(){X.xc=!0;X.log("nsVFB.FormTools.prototype.formToolsController.prototype.down");var a=$("#treeWithLines").treeview("getSelected"),b=a[0].nodeId,c=X.ga();if(1===a.length)if(n(a[0].field))if(a[0].field+1<c[this.J.selected_form_type].rows[a[0].row].fields.length)d=c[this.J.selected_form_type].rows[a[0].row].fields[a[0].field+1],c[this.J.selected_form_type].rows[a[0].row].fields[a[0].field+1]=c[this.J.selected_form_type].rows[a[0].row].fields[a[0].field],c[this.J.selected_form_type].rows[a[0].row].fields[a[0].field]=
d,b++;else{d=c[this.J.selected_form_type].rows[a[0].row].fields[a[0].field];if(!this.bTreeWithLines_){if(1===$("#treeWithLines").treeview("getNode",a[0].parentId).nodes.length)return $("#treeWithLines").treeview("selectNode",[a[0].parentId,{Qd:!1}]),this.Gj(),0;n($("#treeWithLines").treeview("getNode",a[0].nodeId+1).nodes)&&this.bi()}n(c[this.J.selected_form_type].rows[a[0].row+1])||this.bi();c[this.J.selected_form_type].rows[a[0].row+1].fields.unshift(d);c[this.J.selected_form_type].rows[a[0].row].fields.splice(a[0].field,
1);Ux(c[this.J.selected_form_type].rows[a[0].row+1]);Ux(c[this.J.selected_form_type].rows[a[0].row]);$("#treeWithLines").treeview("expandNode",Wx(this,b));0===c[this.J.selected_form_type].rows[a[0].row].fields.length?c[this.J.selected_form_type].rows.splice(a[0].row,1):b++}else{if(a[0].row+1<c[this.J.selected_form_type].rows.length){var d=a[0],e=Wx(this,b),f=$("#treeWithLines").treeview("getCollapsed");d.collapsed=eb(f,d);e.collapsed=eb(f,e);!0===e.collapsed?$("#treeWithLines").treeview("collapseNode",
d.nodeId):$("#treeWithLines").treeview("expandNode",d.nodeId);!0===d.collapsed?$("#treeWithLines").treeview("collapseNode",e.nodeId):$("#treeWithLines").treeview("expandNode",e.nodeId);var d;d.collapsed=e.collapsed;e.collapsed=d.collapsed;d=c[this.J.selected_form_type].rows[a[0].row+1];c[this.J.selected_form_type].rows[a[0].row+1]=c[this.J.selected_form_type].rows[a[0].row];c[this.J.selected_form_type].rows[a[0].row]=d}else return this.bTreeWithLines_||$("#treeWithLines").treeview("selectNode",[b+
1,{Qd:!1}]),0;X.Yb(c);this.J.$broadcast("updateEvent",X.ga());b=Wx(this,b).nodeId;this.bTreeWithLines_||b++}else $.notify(this.text.Notify.Forgotten,{className:"error",autoHideDelay:X.wb});X.Yb(c);this.J.$broadcast("updateEvent",X.ga());$("#treeWithLines").treeview("selectNode",[b,{Qd:!1}])};Tx.prototype.kb.prototype.down=Tx.prototype.kb.prototype.Gj;
function Vx(a){X.log("nsVFB.FormTools.prototype.formToolsController.prototype.getLastLine");for(var b=Yx(a);0<=b;b--)if(a=$("#treeWithLines").treeview("getNode",b),!n(a.field))return a;return $("#treeWithLines").treeview("getNode",0)}
function Wx(a,b){X.log("nsVFB.FormTools.prototype.formToolsController.prototype.getNextLineAfterIndex");a=Yx(a);n($("#treeWithLines").treeview("getNode",b).field)||b++;for(var c=b;c<a;c++)if(b=$("#treeWithLines").treeview("getNode",c),!n(b.field))return b;return $("#treeWithLines").treeview("getNode",0)}
function Xx(a){X.log("nsVFB.FormTools.prototype.formToolsController.prototype.getPreviousLineBeforeIndex");n($("#treeWithLines").treeview("getNode",a).field)||a--;for(var b=a-1;0<=b;b--)if(a=$("#treeWithLines").treeview("getNode",b),!n(a.field))return a;return $("#treeWithLines").treeview("getNode",0)}
function Yx(a){X.log("nsVFB.FormTools.prototype.formToolsController.prototype.getLastNodeIndex");for(var b=X.ga(),c=0,d=0;d<b[a.J.selected_form_type].rows.length;d++){c++;for(var e=0;e<b[a.J.selected_form_type].rows[d].fields.length;e++)c++}return c-1}function Ux(a){X.log("nsVFB.FormTools.prototype.formToolsController.prototype.resizeElementsOnRow");for(var b=parseInt(12/a.fields.length),c=0;c<a.fields.length;c++)a.fields[c].nb_cols=b}
Tx.prototype.kb.prototype.fu=function(a){angular.element($("#FormModal")).scope().ctrl.iA(a,this.b.selected_form_type)};Tx.prototype.kb.prototype.setSelectedElemInFormReader=Tx.prototype.kb.prototype.fu;Tx.prototype.kb.prototype.Km=function(a){angular.element($("#FormModal")).scope().ctrl.dA(a,this.b.selected_form_type)};Tx.prototype.kb.prototype.setHoveredElemInFormReader=Tx.prototype.kb.prototype.Km;Tx.prototype.kb.prototype.copy=function(){var a=X.ga();X.xc=!0;this.b.copyPasteContainer=angular.copy(a[this.J.selected_form_type])};
Tx.prototype.kb.prototype.copy=Tx.prototype.kb.prototype.copy;Tx.prototype.kb.prototype.JH=function(){var a=X.ga();X.xc=!0;a[this.J.selected_form_type]=angular.copy(this.b.copyPasteContainer);X.Yb(a);this.J.$broadcast("updateEvent",X.ga())};Tx.prototype.kb.prototype.paste=Tx.prototype.kb.prototype.JH;Tx.prototype.kb.prototype.jG=function(){X.xc=!0;this.J.$broadcast("labelizeForm",null)};Tx.prototype.kb.prototype.labelizeForm=Tx.prototype.kb.prototype.jG;function Zx(){X.log("nsVFB.nsVisualizerMode.FormMode");X.module.directive("appVisualizermodeForm",this.nB);X.module.directive("appSpecificParam",["$timeout","$rootScope","$q",this.uM]);X.module.controller("AppVisualizermodeFormController",["$scope",this.vc])}pa("nsVFB.nsVisualizerMode.FormMode",Zx);
Zx.prototype.nB=function(){X.log("nsVFB.VisualizerMode.FormMode.visualizerFormModeDirective");return{restrict:"A",replace:!0,controller:"AppVisualizermodeFormController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/VisualizerMode/FormMode.html"}};Zx.prototype.visualizerFormModeDirective=Zx.prototype.nB;
Zx.prototype.vc=function(a){X.log("nsVFB.VisualizerMode.FormMode.visualizerFormModeController");this.b=a;a.sFormDefinitionName="";a.oFormValues={};a.oFormDefinition={};a.oFormScope={};a.oProperties=X.ea;a.sToken=sessionStorage.session_token;a.$on("updateEvent",function(b,c){X.log("visualizerFormModeController updateEvent");a.$broadcast("updateForm",c)});a.$on("updateForm",function(b,c){X.log("visualizerFormModeController updateForm");if(fb(c[a.selected_form_type]))X.log("visualizerFormModeController. Load JSON form fail: "+
a.selected_form_type+" undefined in ",c);else{b=c[a.selected_form_type];if(!fb(b.rows))for(var d=0;d<b.rows.length;d++)for(var e=0;e<b.rows[d].fields.length;e++)b.rows[d].fields[e].id||(b.rows[d].fields[e].id=b.rows[d].fields[e].name+"_"+(d+1)+"_"+(e+1));a.oFormDefinition=c;a.sFormDefinitionName=a.selected_form_type;a.title=b.title;n(a.oFormValues)||(a.oFormValues={});n(a.oFormValues[a.sFormDefinitionName])||(a.oFormValues[a.sFormDefinitionName]={});angular.element($("#studio_form_reader").children()).scope().ctrl.dj()}});
a.$on("updateDefautValue",function(a,c){angular.element($("#studio_form_reader").children()).scope().ctrl.Kq(!0,c.name)})};Zx.prototype.visualizerFormModeController=Zx.prototype.vc;
Zx.prototype.vc.prototype.iA=function(a,b){X.log("nsVFB.nsVisualizerMode.FormMode.visualizerFormModeController.setSelectedElem");var c=this,d=this.b;setTimeout(function(){d.$evalAsync(function(){var e=d.oFormDefinition[b].rows;c.Rt(b);"row"===a.type&&(e[a.row_id].selected=!0);if("element"===a.type)for(var f=0;f<e.length;f++)for(var g=0;g<e[f].fields.length;g++)e[f].fields[g].name===a.element_name&&(e[f].fields[g].selected=!0);angular.element($("#studio_form_reader").children()).scope().ctrl.dj()})})};
Zx.prototype.vc.prototype.setSelectedElem=Zx.prototype.vc.prototype.iA;Zx.prototype.vc.prototype.dA=function(a,b){var c=this,d=this.b;d.$evalAsync(function(){var e=d.oFormDefinition[b].rows;c.Ot(b);"row"===a.type&&(e[a.row_id].hovered=!0);if("element"===a.type)for(var f=0;f<e.length;f++)for(var g=0;g<e[f].fields.length;g++)e[f].fields[g].name===a.element_name&&(e[f].fields[g].hovered=!0);angular.element($("#studio_form_reader").children()).scope().ctrl.dj()})};
Zx.prototype.vc.prototype.setHoveredElem=Zx.prototype.vc.prototype.dA;Zx.prototype.vc.prototype.Rt=function(a){X.log("nsVFB.nsVisualizerMode.FormMode.visualizerFormModeController.removeSelectedElem");var b=this.b;if(null==a){for(var c in b.oFormDefinition)this.Rt(c);return 0}a=b.oFormDefinition[a].rows;if(null==a)return 0;for(b=0;b<a.length;b++)for(!0===a[b].selected&&delete a[b].selected,c=0;c<a[b].fields.length;c++)!0===a[b].fields[c].selected&&delete a[b].fields[c].selected};
Zx.prototype.vc.prototype.removeSelectedElem=Zx.prototype.vc.prototype.Rt;Zx.prototype.vc.prototype.Ot=function(a){var b=this.b;if(!n(a)){for(var c in b.oFormDefinition)this.Ot(c);return 0}a=b.oFormDefinition[a].rows;if(!fb(a))for(b=0;b<a.length;b++)for(!0===a[b].hovered&&delete a[b].hovered,c=0;c<a[b].fields.length;c++)!0===a[b].fields[c].hovered&&delete a[b].fields[c].hovered};Zx.prototype.vc.prototype.removeHoveredElem=Zx.prototype.vc.prototype.Ot;
Zx.prototype.vc.prototype.Qt=function(a){var b=this.b;if(null==a){for(var c in b.oFormDefinition)this.Qt(c);return 0}a=b.oFormDefinition[a].rows;if(null==a)return 0;for(b=0;b<a.length;b++)for(!0===a[b].selected&&delete a[b].selected,!0===a[b].hovered&&delete a[b].hovered,c=0;c<a[b].fields.length;c++)!0===a[b].fields[c].selected&&delete a[b].fields[c].selected,!0===a[b].fields[c].hovered&&delete a[b].fields[c].hovered};Zx.prototype.vc.prototype.removeSelectedAndHoveredElem=Zx.prototype.vc.prototype.Qt;
Zx.prototype.vc.prototype.ho=function(){X.log("nsVFB.nsVisualizerMode.FormMode.visualizerFormModeController.emptyFormValues");var a=this.b;n(a.oFormValues)&&(a.oFormValues={})};Zx.prototype.vc.prototype.emptyFormValues=Zx.prototype.vc.prototype.ho;function $x(){X.log("nsVFB.nsVisualizerMode.JsonMode");X.module.directive("appVisualizermodeJson",this.oB);X.module.controller("AppVisualizermodeJsonController",["$scope","$timeout","$rootScope",this.hn])}pa("nsVFB.nsVisualizerMode.JsonMode",$x);$x.prototype.oB=function(){X.log("nsVFB.VisualizerMode.JsonMode.visualizerJsonModeDirective");return{restrict:"A",replace:!0,controller:"AppVisualizermodeJsonController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/VisualizerMode/JsonMode.html"}};
$x.prototype.visualizerJsonModeDirective=$x.prototype.oB;
$x.prototype.hn=function(a,b,c){X.log("nsVFB.VisualizerMode.JsonMode.visualizerJsonModeController");this.nf=a;this.II=c;this.Au=b;a.My=Date.now();a.Wx=1E3;a.JsonModel=X.tj(X.ga());a.error_Json=!1;a.editorOptions={mode:{name:"javascript",json:!0},readOnly:!0,styleActiveLine:!0,lineNumbers:!0,lineSeparator:null,indentWithTabs:!0,tabSize:2,viewportMargin:50,theme:"Veremes",foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],autoCloseBrackets:!0,onLoad:function(c){a.$on("updateEvent",
function(){c.setOption("readOnly",$("#Lock_Icon").hasClass("fa-lock"));a.JsonModel=X.tj(X.ga())});a.$watch("JsonModel",function(b){X.log("jsonmode model");var c=!1;try{JSON.parse(b)}catch(g){c=!0}finally{a.$parent.error_Json=c}});a.$on("updateJsonModel",function(){a.$parent.ctrl.json_&&(a.My=Date.now(),b(function(){Date.now()-a.My>=a.Wx&&(a.JsonModel=X.tj(X.ga()))},a.Wx))})}}};$x.prototype.visualizerJsonModeController=$x.prototype.hn;
$x.prototype.hn.prototype.LI=function(){X.Yb(JSON.parse(this.nf.JsonModel));var a=$("#treeWithLines").treeview("getSelected"),b=$("#treeView").treeview("getSelected");this.II.$broadcast("updateEvent",X.ga());0!==a.length&&0!==b.length&&this.Au(function(){$("#treeWithLines").treeview("selectNode",[a[0].nodeId,{Qd:!1}]);$("#treeView").treeview("selectNode",[b[0].nodeId,{Qd:!1}])},1)};$x.prototype.hn.prototype.saveData=$x.prototype.hn.prototype.LI;function ay(){X.log("nsVFB.nsVisualizerMode.JsMode");X.module.directive("appEditorJs",this.Pw);X.module.controller("AppEditorJsController",["$scope",this.Ow])}pa("nsVFB.nsVisualizerMode.JsMode",ay);ay.prototype.Pw=function(){X.log("nsVFB.VisualizerMode.JsMode.editorJsModeDirective");return{restrict:"A",replace:!0,controller:"AppEditorJsController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/VisualizerMode/JsMode.html"}};
ay.prototype.editorJsModeDirective=ay.prototype.Pw;
ay.prototype.Ow=function(a){X.log("nsVFB.VisualizerMode.JsMode.editorJsModeController");a.JsModel=X.qg();a.editorOptions={mode:{name:"javascript",json:!1},readOnly:!1,styleActiveLine:!0,lineNumbers:!0,lineSeparator:null,indentWithTabs:!0,tabSize:2,viewportMargin:50,theme:"Veremes",foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],autoCloseBrackets:!0,extraKeys:{"Ctrl-Space":"autocomplete","Cmd-Space":"autocomplete","Cmd-/":"toggleComment","Ctrl-/":"toggleComment"},onLoad:function(){a.$watch("JsModel",
function(a){X.log("jsmode model");X.Ck(a)});a.$on("updateJS",function(){X.log("Js");a.JsModel=X.qg()})}}};ay.prototype.editorJsModeController=ay.prototype.Ow;function by(){X.log("nsVFB.nsVisualizerMode.CssMode");X.module.directive("appEditorCss",this.Nw);X.module.controller("AppEditorCssController",["$scope",this.Mw])}pa("nsVFB.nsVisualizerMode.CssMode",by);by.prototype.Nw=function(){X.log("nsVFB.VisualizerMode.CssMode.editorCssModeDirective");return{restrict:"A",replace:!0,controller:"AppEditorCssController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/VisualizerMode/CssMode.html"}};
by.prototype.editorCssModeDirective=by.prototype.Nw;by.prototype.Mw=function(a){X.log("nsVFB.VisualizerMode.CssMode.editorCssModeController");a.CssModel=X.xi();a.editorOptions={mode:"css",readOnly:!1,styleActiveLine:!0,lineNumbers:!0,lineSeparator:"\r\n",indentWithTabs:!0,tabSize:2,viewportMargin:50,theme:"Veremes"};X.resize();a.$watch("CssModel",function(a){X.log("cssmode model");X.du(a)});a.$on("updateCSS",function(){X.log(X.xi());a.CssModel=X.xi()})};by.prototype.editorCssModeController=by.prototype.Mw;function cy(){X.log("nsVFB.Visualizer");this.pH=new Zx;this.sH=new $x;this.rH=new ay;this.nH=new by;X.module.directive("appVisualizer",this.mB);X.module.controller("AppVisualizerController",["$scope","$timeout",this.Tg])}pa("nsVFB.Visualizer",cy);cy.prototype.mB=function(){X.log("nsVFB.Visualizer.visualizerDirective");return{restrict:"A",replace:!0,controller:"AppVisualizerController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/Visualizer.html"}};
cy.prototype.visualizerDirective=cy.prototype.mB;
cy.prototype.Tg=function(a){X.log("nsVFB.Visualizer.visualizerController");var b=this;this.b=a;b.form_=!0;b.css_=b.js_=b.json_=!1;b.JSPresent=!0;b.CSSPresent=!0;a.$watch("text",function(){X.log("visualizer text");"undefined"!==typeof a.text.Visualizer&&(b.text=a.text.Visualizer,b.ModeSelected=b.text.FormMode)});b.verifyMode=function(){n(angular.element($("#boolean-JS-include"))[0])&&(b.JSPresent=!angular.element($("#boolean-JS-include"))[0].checked);n(angular.element($("#boolean-CSS-include"))[0])&&
(b.CSSPresent=!angular.element($("#boolean-CSS-include"))[0].checked)};b.form=function(){b.ModeSelected=b.text.FormMode;a.$broadcast("updateEvent",{});b.form_=!0;b.css_=b.js_=b.json_=!1};b.json=function(){b.ModeSelected=b.text.JsonMode;a.$broadcast("updateEvent",{});b.json_=!0;b.css_=b.js_=b.form_=!1};b.js=function(){b.ModeSelected=b.text.JsMode;b.js_=!0;b.css_=b.json_=b.form_=!1;a.$broadcast("updateJS",X.qg())};b.css=function(){b.ModeSelected=b.text.CssMode;a.$broadcast("updateCSS",X.xi());b.css_=
!0;b.json_=b.js_=b.form_=!1}};cy.prototype.visualizerController=cy.prototype.Tg;cy.prototype.Tg.$inject=["$scope","$timeout"];
cy.prototype.Tg.prototype.lK=function(){X.log("nsVFB.Visualizer.visualizerController.toggleFullScreen");if(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled){var a=$("#studio-full-screen-btn").get(0),b=$("#studio_container").get(0);document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?($(a).removeClass("icon-shrink"),document.exitFullscreen?document.exitFullscreen():
document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),setTimeout(function(){X.resize()},100)):($(a).addClass("icon-shrink"),b.requestFullscreen?b.requestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen?b.webkitRequestFullscreen():b.msRequestFullscreen&&b.msRequestFullscreen(),setTimeout(function(){X.resize(!0)},500))}else $.notify("Fonction non disponible pour votre navigateur",
"error")};cy.prototype.Tg.prototype.toggleFullScreen=cy.prototype.Tg.prototype.lK;
cy.prototype.Tg.prototype.oG=function(){X.log("nsVFB.visualizerController.loadDefaultJavascript");var a=this.b,b=X.qg();n(b)&&""!==b&&bootbox.confirm("<h4>"+this.text.Confirmation.LoseJs+"</h4>",function(b){!0===b&&z({method:"GET",url:X.ea.web_server_name+"/"+X.ea.public_alias+"/studio/default.js",scope:this.b,timeout:5E3,success:function(b){null!=b.data&&(X.Ck(b.data.replace(/(?:\r\n|\r|\n)/g,"\r\n")),a.$broadcast("updateJS",X.qg()))},error:function(){console.error("Problem on Loading default javascript")}})})};
cy.prototype.Tg.prototype.loadDefaultJavascript=cy.prototype.Tg.prototype.oG;cy.prototype.lE=function(){return cy.pH};cy.prototype.getFormMode=cy.prototype.lE;cy.prototype.rE=function(){return cy.sH};cy.prototype.getJsonMode=cy.prototype.rE;cy.prototype.qE=function(){return cy.rH};cy.prototype.getJsMode=cy.prototype.qE;cy.prototype.fE=function(){return cy.nH};cy.prototype.getCssMode=cy.prototype.fE;function dy(){X.log("nsVFB.ElementForm");X.module.directive("appElementForm",this.Qw);X.module.directive("appParamElement",["$rootScope",this.Rw]);X.module.directive("appParamMap",this.wy);X.module.directive("appHelperIcon",this.VF);X.module.controller("AppElementFormController",["$scope","$rootScope","$timeout","$q",this.Xr])}pa("nsVFB.ElementForm",dy);
dy.prototype.Qw=function(){X.log("nsVFB.ElementForm.elementFormDirective");return{restrict:"A",replace:!0,controller:"AppElementFormController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/ElementForm.html"}};dy.prototype.elementFormDirective=dy.prototype.Qw;
dy.prototype.Rw=function(){X.log("nsVFB.ElementForm.elementParamDirective");return{link:function(a,b){"map_vmap"===a.model.type&&($("#Vmap_Downloader_input").fileinput({mainClass:"input-group-sm"}),$("#Vmap_Downloader_input").on("change",function(b){if(b=b.target.files[0]){var c=new FileReader;c.onload=function(b){a.ctrl.MK(JSON.parse(b.target.result))};c.readAsText(b)}}),!0===a.locker&&$("#Vmap_Downloader_input").fileinput("disable"));switch(a.model.type){case "upload":case "text":case "label":case "email":case "double_select":case "select":case "list":case "date":case "datetime":case "password":case "url":case "color_picker":case "label_display":case "map":case "map_osm":case "map_bing":case "map_vmap":case "textarea":case "button":case "image":case "imageurl":case "image_wsdata":case "link":case "linkurl":case "file_wsdata":case "bo_grid":case "section_grid":case "codemirror":case "checkbox":case "radio":case "float":case "slider":"slider_Element_size"===
$(b).attr("id")?($(b).slider({formatter:function(a){return Math.round(100*a/12)+"%"},value:a.model.nb_cols}),$(b).slider("on","change",function(){a.model.nb_cols=$(b).slider("getValue");a.$apply()}),a.$watch("model.nb_cols",function(a){$(b).slider("setValue",a)})):"slider_Element_height"===$(b).attr("id")?(null!=a.model.style||(a.model.style={}),null!=a.model.style.height||(a.model.style.height=0),$(b).slider({formatter:function(a){return a+"px"},value:parseFloat(a.model.style.height)}),$(b).slider("on",
"change",function(){a.model.style.height=$(b).slider("getValue")+"px";a.$apply()}),a.$watch("model.style.height",function(a){$(b).slider("setValue",parseFloat(a))})):"slider_Element_width"===$(b).attr("id")?(null!=a.model.style||(a.model.style={}),null!=a.model.style.width||(a.model.style.width=0),$(b).slider({formatter:function(a){return a+"px"},value:parseFloat(a.model.width)}),$(b).slider("on","change",function(){a.model.width=$(b).slider("getValue")+"px";a.$apply()}),a.$watch("model.width",function(a){$(b).slider("setValue",
parseFloat(a))})):"slider_Tab_size"===$(b).attr("id")&&(null!=a.model.cm_options||(a.model.cm_options={}),null!=a.model.cm_options.tabSize||(a.model.cm_options.tabSize=2),$(b).slider({formatter:function(a){return a},value:parseFloat(a.model.cm_options.tabSize)}),$(b).slider("on","change",function(){a.model.cm_options.tabSize=$(b).slider("getValue");a.$apply()}),a.$watch("model.cm_options.tabSize",function(a){$(b).slider("setValue",parseFloat(a))})),!0===a.locker?$(b).slider("disable"):$(b).slider("enable")}if("list"===
a.model.type||"double_select"===a.model.type||"textarea"===a.model.type)$("#slider_Element_Row").slider({formatter:function(a){return a},min:3,max:20,step:1,value:5}),$("#slider_Element_Row").slider("on","change",function(){a.model.size=$("#slider_Element_Row").slider("getValue");a.$apply()}),a.$watch("model.size",function(a){$("#slider_Element_Row").slider("setValue",a)}),!0===a.locker&&$("#slider_Element_Row").slider("disable"),"double_select"===a.model.type&&a.$watch("model.name",function(b){a.model.name_to=
b;a.model.name_from=b+"_from"})}}};dy.prototype.elementParamDirective=dy.prototype.Rw;dy.prototype.VF=function(){return{link:function(a,b,c){var d=c.$observe("appHelperIcon",function(){n(c.text)&&""!==c.text&&($(b).popover({trigger:"hover",container:"body",title:"HelperBox",content:function(){return c.text}}),a.$on("$destroy",function(){$(b).popover("destroy");d()}))})}}};dy.prototype.wy=function(){X.log("nsVFB.ElementForm.mapParamDirective")};dy.prototype.mapParamDirective=dy.prototype.wy;
dy.prototype.Xr=function(a,b,c,d){X.log("nsVFB.ElementForm.elementFormController");var e=this;this.applicationName=X.eh();b.Utils={keys:Object.keys};a.model={};a.collapsed=X.Ug[4];a.aWebServiceAttributs=[];a.aBusinessObjects=[];a.aBoAttributs=[];a.aFormAttributs=[];a.datasourcesArray=[];a.wM={};var f={},g={};a.$on("labelizeForm",function(){console.log(e);for(var a=X.ga(),c=a[b.selected_form_type],d="select list double_select date datetime color_picker text password url email integer float number".split(" "),
f=["map_osm","map_bing","map_vmap"],g=["checkbox","radio","textarea","slider"],v=0;v<c.rows.length;v++)for(var w=c.rows[v],x=0;x<w.fields.length;x++){var y=w.fields[x];-1<d.indexOf(y.type)?(e.Un(y,"label"),y.type="label"):-1<f.indexOf(y.type)?(y.map_options.interactions={multi_geometry:!1,full_screen:!0,RA:!1,RO:!1,ED:!1,DP:!1,DL:!1,DPol:!1,SE:!1},b.$broadcast("updateMap","interact")):-1<g.indexOf(y.type)?y.disabled=!0:"upload"===y.type?(e.Un(y,"link"),y.type="link"):"codemirror"===y.type&&(y.cm_options.readOnly=
!0)}a[b.selected_form_type]=c;X.Yb(a);b.$broadcast("updateEvent",X.ga());b.$broadcast("updateJsonModel",X.ga());b.$broadcast("updateForm",X.ga())});a.$watch("text",function(){X.log("text updated");if("undefined"!==typeof a.text.Element){e.text=a.text.Element;a.Component_list=[];for(var b=X.config.avaliable_elems,c=0;c<b.length;c++)a.Component_list.push({alias:e.text.Select_Type[b[c]],value:b[c]})}});a.$watch("model.id",function(){X.log("model.id changed");a.jsonOutput=X.ga();n(a.jsonOutput.datasources)&&
ha(a.jsonOutput.datasources)&&!q(a.jsonOutput.datasources)||(a.jsonOutput.datasources={});a.datasources=a.jsonOutput.datasources;a.datasourcesArray=[];for(var b in a.datasources)a.datasources[b].id=b,a.datasourcesArray.push(a.datasources[b]);e.updateDatasourceInfos();if("select"===a.model.type||"list"===a.model.type||"double_select"===a.model.type)if(null!=a.model.datasource.parents)for(a.cascade=!0,a.aParents=[],b=0;b<a.model.datasource.parents.length;b++)a.aParents.push(a.model.datasource.parents[b].name);
else a.cascade=!1,a.aParents=[];X.Yb(a.jsonOutput)});a.$watch("model.datasource.datasource_id",function(){X.log("model.datasource.datasource_id changed");if(null==a.model.datasource||null==a.model.datasource.datasource_id||null==a.datasources[a.model.datasource.datasource_id])return 0;"web_service"===a.datasources[a.model.datasource.datasource_id].type&&Na(a.aWebServiceAttributs);e.updateDatasourceInfos()});a.$watch("model.default_value",function(){b.$broadcast("updateDefautValue",a.model)});a.$watch("model.name",
function(c){a.jsonOutput=X.ga();1<X.Rg.getElementsByName(a.jsonOutput,b.selected_form_type,c).length&&(a.model.name+="_2",$.notify(a.text.Element.SameNameWarning,"warning"))});a.$watch("model",function(d,k){b.$broadcast("update model",null);null!=d.type&&null!=d.id&&(d.type!==k.type&&d.id===k.id?(X.xc=!0,0<f.length&&(null!=f[0]&&(f[0].icon=e.Un(a.model,d.type)),null!=g[0]&&(g[0].icon=e.Un(a.model,d.type))),"select"===d.type&&("Text"===e.optionsSelect?(n(d.web_service)&&hb(d,"web_service"),a.selectedRessource=
"",a.selectedValue="",a.selectedLabel=""):"TableValues"===e.optionsSelect?(n(d.options)&&hb(d,"options"),a.selectedRessource="",a.selectedValue="",a.selectedLabel=""):"WebService"===e.optionsSelect&&(n(d.options)&&hb(d,"options"),n(d.web_service.parameters)&&hb(d.web_service,"parameters")))):d.id===k.id&&d.name!==k.name&&(X.xc=!0,n(f[0])&&n(g[0])&&(f[0].text=d.name,g[0].text=d.name,null!==d.name.match(/\s/g)?angular.element($("#Element_Form_name_input")).addClass("invalid_input"):angular.element($("#Element_Form_name_input")).removeClass("invalid_input")),
X.IK(d,k),X.JK(d,k)));a.model.selected=!0;c(function(){n(f[0])&&n(g[0])&&(null!=f[0]&&$("#treeWithLines").treeview("selectNode",[f[0].nodeId,{Qd:!1}]),null!=g[0]&&$("#treeView").treeview("selectNode",[g[0].nodeId,{Qd:!1}]))},10);b.$broadcast("updateJsonModel",X.ga());b.$broadcast("updateForm",X.ga())},!0);a.$on("update element",function(c,d){X.log("update element");a.model=d;f=$("#treeWithLines").treeview("getSelected");g=$("#treeView").treeview("getSelected");n(a.Ly)&&$("#select_element_to_add").val(a.Ly.type);
a.AllSelects=[];if(null!=X.ga()[b.selected_form_type]&&!fb(X.ga()[b.selected_form_type].rows)){c=X.ga()[b.selected_form_type].rows;for(var e=0;e<c.length;e++)for(var h=0;h<c[e].fields.length;h++)"select"!==c[e].fields[h].type&&"list"!==c[e].fields[h].type||c[e].fields[h].name===a.model.name||a.AllSelects.push(c[e].fields[h].name)}$("#load_Perso_button").hasClass("active")&&X.valid&&"undefined"!==d.type?a.locker=!1:X.valid&&(a.locker=!0,"map_vmap"===a.model.type&&$("#Vmap_Downloader_input").TL("disable"));
a.$$phase||a.$digest()});e.AM=function(b){X.log("elementFormController.updateWSInfos");"undefined"!==typeof b.selectedValue&&(a.model.web_service.id_key=b.selectedValue.replace(/\s/g,""));"undefined"!==typeof b.selectedLabel&&(a.model.web_service.label_key=b.selectedLabel.replace(/\s/g,""));a.model.web_service.optionsSelect=e.optionsSelect};e.updateDatasourceInfos=function(){X.log("elementFormController.updateDatasourceInfos");if(null==a.model.datasource)return 0;a.model.datasource.sort_order=null!=
a.model.datasource.sort_order?a.model.datasource.sort_order:"ASC";a.model.datasource.distinct=null!=a.model.datasource.distinct?a.model.datasource.distinct:"true";null!=a.model.datasource.id_key&&(a.model.datasource.id_key=a.model.datasource.id_key.replace(/\s/g,""));null!=a.model.datasource.label_key&&(a.model.datasource.label_key=a.model.datasource.label_key.replace(/\s/g,""));null!=a.model.datasource.id_key&&null!=a.model.datasource.label_key&&(a.model.datasource.attributs=a.model.datasource.id_key+
"|"+a.model.datasource.label_key);null!=a.model.datasource.label_key&&(a.model.datasource.order_by=a.model.datasource.label_key)};e.updateWebServiceAttributs=function(b){X.log("updateWebServiceAttributs");var c={limit:1};ha(b.parameters)&&kb(c,b.parameters);console.log(b.parameters);var e=d.defer();z({method:"GET",url:X.ea.web_server_name+"/"+X.ea.services_alias+"/"+b.ressource_id,headers:{Accept:"application/x-vm-json"},params:c,scope:a,timeout:5E3,abord:e.promise,success:function(c){if(null==c||
null==c.data||null==c.data.data||null==c.data.data[0])return 0;var d;if("businessObject"===b.dataType&&null!=b.businessObjectRequest){d=[];for(var e=0;e<c.data.data.length;e++)d.push(c.data.data[e]["bo_"+b.businessObjectRequest])}else d=c.data.data;a.aWebServiceAttributs=Object.keys(d[0])}})};e.updateCascadeField=function(){X.log("elementFormController.updateCascadeField");if(null==a.aParents)return console.error("aParents not defined"),0;if(null==a.model.datasource)return console.error("datasource not defined"),
0;!1===a.cascade&&(a.aParents=[]);if(q(a.aParents)){if(0===a.aParents.length)return n(a.model.datasource.parents)&&delete a.model.datasource.parents,0;null!=a.model.datasource.parents||(a.model.datasource.parents=[]);q(a.model.datasource.parents)&&Na(a.model.datasource.parents);for(var b=0;b<a.aParents.length;b++)a.model.datasource.parents.push({name:a.aParents[b],filter_attr:a.aParents[b],filter_equality:"=",wait_for_parent:!0})}};e.MK=function(c){X.log("elementFormController.updateVmapData");if(c.children){for(var d=
0;d<c.children.length;d++)c.children[d].view&&(a.model.map_options.center.coord=c.children[d].view.center?c.children[d].view.center:[0,0],a.model.map_options.center.zoom=c.children[d].view.zoom?c.children[d].view.zoom:5,a.model.map_options.center.extent=c.children[d].view.extent?c.children[d].view.extent:[-2.002637639E7,-2.00489661E7,2.002637639E7,2.00489661E7],a.model.map_options.proj=c.children[d].view.projection?c.children[d].view.projection:"EPSG:3857",b.$broadcast("updateMap","view"));a.model.map_options.tree=
c;b.$broadcast("updateMap","tree")}};e.zM=function(){X.log("elementFormController.updateWS");b.$broadcast("updateOptions",{})};e.updateMap=function(c,d){X.log("elementFormController.updateMap");switch(d){case "center":c=Rg(a.model.map_options.center.coord,a.model.map_options.proj,"EPSG:3857");Of([-2.002637639E7,-2.00489661E7,2.002637639E7,2.00489661E7],c[0],c[1])?b.$broadcast("updateMap",d):$.notify(e.text.Component.Map.Notify.OutRange,{className:"error",autoHideDelay:X.wb});break;case "zoom":0<a.model.map_options.center.scale&&
2E8>=a.model.map_options.center.scale?b.$broadcast("updateMap",d):$.notify(e.text.Component.Map.Notify.OutRange,{className:"error",autoHideDelay:X.wb});break;case "extent":c=a.Ly.fM.Ka.Z;if(c[0]<=c[2]&&-2.002637639E7<=c[0]&&2.002637639E7>=c[0]&&c[0]<=c[2]&&-2.002637639E7<=c[2]&&2.002637639E7>=c[2]&&c[1]<=c[3]&&-2.00489661E7<=c[1]&&2.00489661E7>=c[1]&&c[1]<=c[3]&&-2.00489661E7<=c[3]&&2.00489661E7>=c[3]){b.$broadcast("updateMap",d);break}$.notify(e.text.Component.Map.Notify.OutRange,{className:"error",
autoHideDelay:X.wb});break;case "multi_geom":break;default:b.$broadcast("updateMap",d)}};e.Un=function(a,b){X.log("elementFormController.convert");var c,d="icon-point";if("undefined"!==a.type){switch(b){case "button":c="type id class name nb_cols buttons default_value".split(" ");break;case "title":case "label":c="type id label name default_value nb_cols".split(" ");"label"===b?d="icon-eye":d;break;case "hr":c=["type","id","name","default_value"];"hr"===b?d="icon-minus":d;break;case "hidden":c=["type",
"id","name","default_value","nb_cols"];"hidden"===b?d="icon-user-secret":d;break;case "subtitle":c="type id label name class default_value nb_cols".split(" ");break;case "checkbox":c="type id label name checked default_value nb_cols".split(" ");d="icon-check-square";break;case "radio":c="type id label name checked options nb_cols default_value".split(" ");d="icon-dot-circle-o";break;case "textarea":c="type id label name required nb_cols default_value".split(" ");d="icon-paragraph";break;case "select":c=
"type id label name required nb_cols multiple options web_service child_select default_value".split(" ");d="icon-format_list_bulleted";break;case "list":c="type id label name required nb_cols multiple options web_service child_select default_value size".split(" ");d="icon-format_list_bulleted";break;case "double_select":c="type id label name required nb_cols options web_service size label_from label_to name_from name_to default_value".split(" ");d="icon-format_list_bulleted";break;case "date":case "datetime":case "label_display":case "color_picker":c=
"type id label name nb_cols default_value".split(" ");"date"===b||"datetime"===b?d="icon-calendar-check-o":d;"label_display"===b?d="icon-eye":d;"color_picker"===b?d="icon-paint":d;break;case "upload":c="type id label name nb_cols default_value ext".split(" ");d="icon-file";break;case "tinymce":c="type id label name nb_rows options default_value nb_cols".split(" ");d="icon-font";break;case "slider":c="type id label name options default_value nb_cols".split(" ");d="icon-sliders";break;case "text":case "password":case "url":case "email":c=
"type id label name pattern required nb_cols default_value".split(" ");"text"===b?d="icon-font":d;"password"===b?d="icon-key":d;"url"===b?d="icon-chrome":d;"email"===b?d="icon-at":d;break;case "integer":case "float":case "number":c="type id label name min max nb_cols default_value".split(" ");d="icon-calculator";break;case "link":c="type id label name alias folder nb_cols target".split(" ");d="glyphicon glyphicon-link";break;case "image":c="type id label name alias folder nb_cols width".split(" ");
d="glyphicon glyphicon-picture";break;case "map_osm":case "map_bing":case "map_vmap":c="type id label name required map_options nb_cols style default_value".split(" ");d="icon-map";break;case "codemirror":c="type id label ui name cm_options nb_cols".split(" "),d="icon-code"}for(var e in a)null!=c&&-1===c.indexOf(e)&&delete a[e];switch(b){case "list":case "double_select":b={size:5};break;case "button":n(a["class"])?a["class"]:a["class"]="btn-ungroup btn-group-sm";n(a.buttons)?a.buttons:a.buttons=[];
b={type:"submit",name:"form_submit",label:"FORM_UPDATE","class":"btn-primary"};n(a.buttons[0])?a.buttons[0]:a.buttons[0]=b;break;case "radio":b={choices:[{label:"Oui",value:!0},{label:"Non",value:!1}]};n(a.options)?a.options:a.options=b;n(a.nb_cols)?a.nb_cols:a.nb_cols=12;break;case "slider":b={min:0,max:100,precision:1,step:1};n(a.options)?a.options:a.options=b;n(a.nb_cols)?a.nb_cols:a.nb_cols=12;break;case "map_osm":n(a.style)?a.style:a.style={height:"250px"};b={proj:"EPSG:3857",type:"OSM",center:{coord:[3E5,
6E6],zoom:5,scale:25E6,extent:[-2.002637639E7,-2.00489661E7,2.002637639E7,2.00489661E7]},controls:{MP:!0,ZO:!0,SL:!0,CP:!0},layers:[],interactions:{multi_geometry:!1,full_screen:!0,RA:!1,RO:!0,ED:!0,DP:!0,DL:!0,DPol:!0,SE:!0},draw_color:"rgba(54,184,255,0.6)",contour_color:"rgba(0,0,0,0.4)",contour_size:2,circle_radius:6,features:[],coord_accuracy:8};n(a.map_options)&&"OSM"===a.map_options.type?a.map_options:a.map_options=b;break;case "map_bing":n(a.style)?a.style:a.style={height:"250px"};b={proj:"EPSG:3857",
type:"bing",center:{coord:[3E5,6E6],zoom:5,scale:25E6,extent:[-2.002637639E7,-2.00489661E7,2.002637639E7,2.00489661E7]},controls:{MP:!0,ZO:!0,SL:!0,CP:!0},layers:[],interactions:{multi_geometry:!1,full_screen:!0,RA:!1,RO:!0,ED:!0,DP:!0,DL:!0,DPol:!0,SE:!0},draw_color:"rgba(54,184,255,0.6)",contour_color:"rgba(0,0,0,0.4)",contour_size:2,circle_radius:6,features:[],coord_accuracy:8,source:{culture:"fr-FR",key:"",style:"Aerial"}};n(a.map_options)&&"bing"===a.map_options.type?a.map_options:a.map_options=
b;break;case "map_vmap":n(a.style)?a.style:a.style={height:"250px"};b={proj:"EPSG:3857",type:"vmap",center:{coord:[3E5,6E6],zoom:5,scale:25E6,extent:[-2.002637639E7,-2.00489661E7,2.002637639E7,2.00489661E7]},controls:{MP:!0,ZO:!0,SL:!0,CP:!0},layers:[],interactions:{multi_geometry:!1,full_screen:!0,RA:!1,RO:!0,ED:!0,DP:!0,DL:!0,DPol:!0,SE:!0},draw_color:"rgba(54,184,255,0.6)",contour_color:"rgba(0,0,0,0.4)",contour_size:2,circle_radius:6,features:[],coord_accuracy:8};n(a.map_options)&&"vmap"===a.map_options.type?
a.map_options:a.map_options=b;break;case "codemirror":b={mode:"javascript",readOnly:!1,styleActiveLine:!0,lineNumbers:!0,lineSeparator:"\r\n",indentWithTabs:!0,tabSize:2,viewportMargin:50,theme:"Veremes"};n(a.cm_options)?a.cm_options:a.cm_options=b;n(a.nb_cols)?a.nb_cols:a.nb_cols=12;n(a.ui)?a.ui:a.ui=!0;break;case "bo_grid":b={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!1,enablePaginationControls:!1,enableColumnMenus:!1,enableColumnResizing:!1,appHeader:!0,appHeaderTitleBar:!0,columnDefs:[],
data:[]};n(a.options)?a.options:a.options=b;n(a.nb_cols)?a.nb_cols:a.nb_cols=12;setTimeout(function(){X.reloadForm()});break;case "section_grid":b={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!1,enablePaginationControls:!1,enableColumnMenus:!1,enableColumnResizing:!1,appHeader:!0,appHeaderTitleBar:!0,columnDefs:[],data:[]};n(a.options)?a.options:a.options=b;n(a.nb_cols)?a.nb_cols:a.nb_cols=12;setTimeout(function(){X.reloadForm()});break;default:a.nb_cols||(a.nb_cols=12)}return d}};e.resize=
function(){a.collapsed=!a.collapsed;X.Ug[4]=a.collapsed;X.resize()};e.updateBoList=function(){a.aBusinessObjects=[];var b=d.defer();z({method:"GET",url:X.ea.web_server_name+"/"+X.ea.services_alias+"/vmap/businessobjects",headers:{Accept:"application/x-vm-json"},scope:a,timeout:5E3,abord:b.promise,success:function(b){if(null==b||null==b.data||null==b.data.data||null==b.data.data[0])return 0;a.aBusinessObjects=b.data.data}})};e.updateBoLinkLists=function(c){if(null==c)return 0;var e=[],f=d.defer();
z({method:"GET",url:X.ea.web_server_name+"/"+X.ea.services_alias+"/vmap/querys/"+c,headers:{Accept:"application/x-vm-json"},scope:a,timeout:5E3,abord:f.promise,success:function(b){if(null==b||null==b.data||null==b.data.data||null==b.data.data[0]||null==b.data.data[0])return 0;b=Object.keys(b.data.data[0]);a.aBoAttributs=b}});if("undefined"!==typeof X.ga()[b.selected_form_type])for(c=X.ga()[b.selected_form_type].rows,f=0;f<c.length;f++)for(var g=0;g<c[f].fields.length;g++)e.push(c[f].fields[g].name);
a.aFormAttributs=e};e.updateSectionList=function(){a.aBusinessObjects=[];var b=d.defer();z({method:"GET",url:X.ea.web_server_name+"/"+X.ea.services_alias+"/vitis/vitissections",headers:{Accept:"application/x-vm-json"},params:{filter:{relation:"AND",operators:[{column:"template",compare_operator:"=",value:"workspaceListTpl.html"},{column:"lang",compare_operator:"=",value:X.ea.language}]}},scope:a,timeout:5E3,abord:b.promise,success:function(b){if(null==b||null==b.data||null==b.data.data||null==b.data.data[0])return 0;
a.aSections=b.data.data}})};e.updateSectionLinkLists=function(c){a.aBusinessObjects=[];var e=d.defer();z({method:"GET",url:X.ea.web_server_name+"/"+X.ea.services_alias+"/vitis/vitissections/"+c,headers:{Accept:"application/x-vm-json"},scope:a,timeout:5E3,abord:e.promise,success:function(b){if(null==b||null==b.data||null==b.data.data||null==b.data.data[0])return 0;b=b.data.data[0];null!=b.ressource_id&&z({method:"GET",url:X.ea.web_server_name+"/"+X.ea.services_alias+"/"+b.ressource_id,headers:{Accept:"application/x-vm-json"},
scope:a,timeout:5E3,abord:e.promise,success:function(b){if(null==b||null==b.data||null==b.data.data||null==b.data.data[0])return 0;b=Object.keys(b.data.data[0]);a.aSectionAttributs=b}})}});c=[];if("undefined"!==typeof X.ga()[b.selected_form_type])for(var f=X.ga()[b.selected_form_type].rows,g=0;g<f.length;g++)for(var h=0;h<f[g].fields.length;h++)c.push(f[g].fields[h].name);a.aFormAttributs=c}};dy.prototype.elementFormController=dy.prototype.Xr;
dy.prototype.Xr.$inject=["$scope","$rootScope","$timeout","$q"];var ey={};pa("nsVitisComponent",ey);function Y(a){var b=a.target,c=a.options;this.Ro=a.hiddenFieldId;this.lt=a.oFormValues;this.$t=a.sFormName;a=a.oProj;if(null==b)return console.error("nsVitisComponent.Map: target not defined"),null;if(null==c)return console.error("nsVitisComponent.Map: options not defined"),null;if(null==this.Ro)return console.error("nsVitisComponent.Map: hiddenFieldId not defined"),null;if(null==this.lt)return console.error("nsVitisComponent.Map: oFormValues not defined"),null;if(null==this.$t)return console.error("nsVitisComponent.Map: sFormName not defined"),
null;if(null==a)return console.error("nsVitisComponent.Map: oProj not defined"),null;this.HB=angular.element(u.Pb).injector().get(["propertiesSrvc"]);this.Tq=angular.element(u.Pb).injector().get(["$translate"]);this.da=angular.element(u.Pb).injector().get(["$log"]);var d=this;this.da.info("nsVitisComponent.Map");this.We=$(".banner_line").css("background-color");n(this.We)&&"a"!==this.We.charAt(3)&&(this.We=this.We.split("("),this.We=this.We[1].split(")"),this.We="rgba("+this.We[0]+",0.58)");this.Tq("COMPONENT_MAP_LAYERSTREE COMPONENT_MAP_FULLSCREEN COMPONENT_MAP_ZOOM_EXTENT COMPONENT_MAP_DELETE_FEATURE COMPONENT_MAP_DELETE_ALL COMPONENT_MAP_MODIFY_FEATURE COMPONENT_MAP_DRAW_POINT COMPONENT_MAP_DRAW_LINE COMPONENT_MAP_DRAW_POLYGON COMPONENT_MAP_ZOOM_EXTENT COMPONENT_MAP_OVERSIZED_EXTENT".split(" ")).then(function(a){d.kf=
a});this.al();var e,f;n(c.center.coord)&&(e=c.center.coord);n(c.center.extent)&&(f=c.center.extent);this.vd=c.proj;this.dl=null!=c.base_proj?c.base_proj:this.vd;this.Ip=null!=c.output_format?c.output_format:"wkt";this.uB=new kd({uA:!0});this.jx=new Gp({yc:this.dl,Kc:this.vd});this.Sc=c.center.coord?new Hh({Ka:e,zoom:5,la:Gg(c.proj)}):new Hh({Ka:[(f[0]+f[2])/2,(f[1]+f[3])/2],zoom:5,la:Gg(c.proj)});this.kf={};this.Ob=b;this.sn=c.coord_accuracy;this.Wk=[];this.Yh=[];this.Re=new Pd;this.oa="none";this.Config=
{};this.Dp=a;this.zp=c.interactions.multi_geometry;this.cq=null;this.bLayersTreeOpen=!0===c.bLayersTreeOpen?c.bLayersTreeOpen:!1;this.ri=[];this.no=[];this.mo=[];this.El=[];"OSM"===c.type?this.Yh.push(new Km({source:new xn})):"bing"===c.type&&this.Yh.push(new Km({source:new Eq({ki:c.source.culture,key:c.source.key,Ps:c.source.style})}));this.element=document.createElement("DIV");$(this.element).addClass("ol-current-projection-studio ol-unselectable");c.controls.MP&&this.Wk.push(new mv({Vn:function(a){return[a[0].toPrecision(d.sn),
a[1].toPrecision(d.sn)]}}));c.controls.SL&&this.Wk.push(new vv);c.controls.CP&&this.Wk.push(new Yh({element:d.element,Ca:function(){for(var a="",b=0;b<d.Dp.projections.length;b++)d.vd===d.Dp.projections[b].code&&(a=d.Dp.projections[b].name);""!==a?$(".ol-current-projection-studio").html(a):$(".ol-current-projection-studio").html(d.vd)}}));c.controls.ZO&&setTimeout(function(){d.Yq=fy(d,d.Ob)},500);setTimeout(function(){d.Uq=gy(d,d.Ob,c.interactions)});Array.isArray(c.layers)&&0<c.layers.length&&this.Yh.push(c.layers);
this.aa=new Xl({target:d.Ob,rb:d.Yh,view:d.Sc,controls:d.Wk});null!=c.center.scale&&this.le(c.center.scale);null!=c.center.extent&&this.fq(c.center.extent);this.aTree="vmap"===c.type&&c.tree?this.ak(c.tree):[{service:c.type,layers:this.Yh}];b=Gg(c.proj).W();e=Oh(this.Sc,this.aa.Ta());hy(e,b)?this.$u=Oh(this.Sc,this.aa.Ta()):(console.error("map extent oversized"),Th(D(this.aa),b));$(".ol-mouse-position").css("bottom","8px");$(".ol-mouse-position").css("top","auto");$(".ol-mouse-position").css("background",
this.We);$(".ol-mouse-position").css("color","#ffffff");$(".ol-mouse-position").css("border-radius","4px");$(".ol-scale-line").css("background",this.We);$(".ol-current-projection-studio").css("background",this.We);c.draw_color=n(c.draw_color)?c.draw_color:"rgba(54,184,255,0.6)";c.contour_color=n(c.contour_color)?c.contour_color:"rgba(0,0,0,0.4)";c.contour_size=n(c.contour_size)?c.contour_size:2;c.circle_radius=n(c.circle_radius)?c.circle_radius:7;b=new Dn({fill:new Cn({color:c.draw_color}),stroke:new gl({color:c.contour_color,
width:c.contour_size}),Lb:new Bn({tb:c.circle_radius,fill:new Cn({color:c.draw_color}),stroke:new gl({color:c.contour_color,width:c.contour_size})})});this.wc=new Mo({style:b,mj:!0,nj:!0,source:new ao({features:d.Re})});setTimeout(function(){d.aa.Eb(d.wc)},500);b=$("#"+this.Ro).val();if(n(b)&&!/^[\s\xa0]*$/.test(b)&&"[object Object]"!==b){b=iy(d,b);for(e=0;e<b.length;e++)this.wc.v().Gc(b[e]);e=this.wc.v().W();Th(D(this.aa),e);1===b.length&&"Point"===b[0].j().K()&&D(this.aa).Fh(12)}this.Re.on("change",
function(){setTimeout(function(){jy(d);d.aa.dispatchEvent("moveend")})});return this}ey.Map=Y;
function jy(a){a.da.info("nsVitisComponent.Map.saveFeatures");var b;b=a.Re.R();a.da.info("nsVitisComponent.Map.getStringByFeatures");for(var c="",d=0;d<b.length;d++){var e=b[d].ts();Kd(b[d],{style:null!=e?e:null})}"wkt"===a.Ip?c=a.uB.qn(b,{Wd:a.dl,Kc:a.vd}):"geojson"===a.Ip&&(c=a.jx.qn(b,{Wd:a.dl,Kc:a.vd}));b=c;n(a.Ro)&&document.getElementById(a.Ro).setAttribute("value",b);n(a.$t)&&n(a.lt)&&(a.lt[a.$t]=b);for(b=0;b<a.no.length;b++)fa(a.no[b])&&a.no[b].call(a,a.Re.R())}
function iy(a,b){a.da.info("nsVitisComponent.Map.getFeaturesByString");var c=[];if("wkt"===a.Ip)try{c=a.uB.bj(b,{Wd:a.dl,Kc:a.vd})}catch(d){console.error("cannot read the geometry on format wkt")}else if("geojson"===a.Ip)try{for(c=a.jx.bj(b,{Wd:a.dl,Kc:a.vd}),a=0;a<c.length;a++)null!=c[a].get("style")&&c[a].gu(c[a].get("style"))}catch(d){console.error("cannot read the geometry on format geojson")}return c}
Y.prototype.al=function(){var a=new mg({code:"EPSG:2154",Z:[-378305.81,6093283.21,1212610.74,7186901.68],units:"m"});Kg(a);Mg("EPSG:4326","EPSG:2154",this.Xq,this.Us);Mg("EPSG:3857","EPSG:2154",function(a){a=Rg(a,"EPSG:3857","EPSG:4326");return Rg(a,"EPSG:4326","EPSG:2154")},function(a){a=Rg(a,"EPSG:2154","EPSG:4326");return Rg(a,"EPSG:4326","EPSG:3857")})};
Y.prototype.Xq=function(a){var b=3/180*Math.PI,c=46.5/180*Math.PI,d=44/180*Math.PI,e=49/180*Math.PI,f=a[1]/180*Math.PI;a=a[0]/180*Math.PI;var g=6378137/Math.sqrt(1-.006694380025712785*Math.sin(d)*Math.sin(d)),h=Math.log(Math.tan(Math.PI/4+d/2)*Math.pow((1-.08181919106*Math.sin(d))/(1+.08181919106*Math.sin(d)),.04090959553)),f=Math.log(Math.tan(Math.PI/4+f/2)*Math.pow((1-.08181919106*Math.sin(f))/(1+.08181919106*Math.sin(f)),.04090959553)),e=Math.log(6378137/Math.sqrt(1-.006694380025712785*Math.sin(e)*
Math.sin(e))*Math.cos(e)/(g*Math.cos(d)))/(h-Math.log(Math.tan(Math.PI/4+e/2)*Math.pow((1-.08181919106*Math.sin(e))/(1+.08181919106*Math.sin(e)),.04090959553))),d=g*Math.cos(d)/e*Math.exp(e*h);return[7E5+d*Math.exp(-1*e*f)*Math.sin(e*(a-b)),66E5+d*Math.exp(-1*e*Math.log(Math.tan(Math.PI/4+c/2)*Math.pow((1-.08181919106*Math.sin(c))/(1+.08181919106*Math.sin(c)),.04090959553)))-d*Math.exp(-1*e*f)*Math.cos(e*(a-b))]};
Y.prototype.Us=function(a){Math.atanh=Math.atanh||function(a){return Math.log((1+a)/(1-a))/2};Math.tanh=Math.tanh||function(a){return Infinity===a?1:-Infinity===a?-1:(Math.exp(a)-Math.exp(-a))/(Math.exp(a)+Math.exp(-a))};var b=1/298.257222101,b=Math.sqrt(2*b-b*b),c=a[0].toFixed(10)-7E5;a=a[1].toFixed(10)-1.26556120499E7;var d=Math.log(1.1754255426096E7/Math.sqrt(c*c+a*a))/.725607765053267;return[(Math.atan(-c/a)/.725607765053267+3/180*Math.PI)/Math.PI*180,Math.asin(Math.tanh(d+b*Math.atanh(b*Math.tanh(d+
b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.sin(1))))))))))))))))/Math.PI*180]};
function fy(a,b){var c=document.createElement("BUTTON"),d=document.createElement("BUTTON"),e=document.createElement("BUTTON");c.innerHTML="<span class='fa fa-search-plus fa-x1' aria-hidden='true'></span>";d.innerHTML="<span class='fa fa-search-minus fa-x1' aria-hidden='true'></span>";e.innerHTML="<span class='glyphicon glyphicon-home' aria-hidden='true'></span>";c.className="btn btn-success Map-btn map-ZoomIn";d.className="btn btn-success Map-btn map-ZoomOut";e.className="btn btn-success Map-btn map-ZoomToExtent";
$(c).prop("type","button");$(d).prop("type","button");$(e).prop("type","button");$(e).prop("title",a.kf.COMPONENT_MAP_ZOOM_EXTENT);$(c).on("click",function(){var b=a.Sc.xa();a.aa.DC(ol.animation.zoom({resolution:b,duration:250,easing:Ef}));b=a.Sc.Ib(b,1);Uh(a.Sc,b);b=D(a.aa).Gf();D(a.aa).Fh(b+1)});$(d).on("click",function(){var b=a.Sc.xa();a.aa.DC(ol.animation.zoom({resolution:b,duration:250,easing:Ef}));b=a.Sc.Ib(b,-1);Uh(a.Sc,b);b=D(a.aa).Gf();D(a.aa).Fh(b-1)});$(e).on("click",function(){Th(D(a.aa),
a.$u)});var f=document.createElement("DIV");f.className="btn-group-vertical btn-group-md form-map-Group-btn-zoom";f.appendChild(c);f.appendChild(d);f.appendChild(e);b.appendChild(f);return f}
function gy(a,b,c){var d=[];if(c.full_screen&&(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)){var e=document.createElement("BUTTON");e.innerHTML="<span class='icon-enlarge' aria-hidden='true'></span>";e.className="btn btn-success Map-btn map-FullScreen";e.title=a.kf.COMPONENT_MAP_FULLSCREEN;$(e).prop("type","button");$(e).on("click",function(){var b=a.Ob;document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||
document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():b.requestFullscreen?b.requestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen&&b.webkitRequestFullscreen()});d.push(e)}c.layer_tree&&(e=document.createElement("BUTTON"),e.innerHTML="<span class='icon-layers2' aria-hidden='true'></span>",
e.className="btn btn-success Map-btn map-LayerTree",e.title=a.kf.COMPONENT_MAP_LAYERSTREE,$(e).prop("type","button"),$(e).on("click",function(){a.bLayersTreeOpen=!a.bLayersTreeOpen;a.aa.dispatchEvent("moveend")}),d.push(e));c.select&&(e=document.createElement("BUTTON"),e.innerHTML="<span class='icon-hand-pointer' aria-hidden='true'></span>",e.className="btn btn-success Map-btn map-Select",e.title=a.kf.COMPONENT_MAP_SELECT,$(e).prop("type","button"),$(e).on("click",function(){a.$h("select")}),d.push(e));
if(c.RA||c.remove_all)e=document.createElement("BUTTON"),e.innerHTML="<span class='icon-trash' aria-hidden='true'></span>",e.className="btn btn-success Map-btn map-AllRemove",e.title=a.kf.COMPONENT_MAP_DELETE_ALL,$(e).prop("type","button"),$(e).on("click",function(){"none"!==a.oa&&a.aa.Ig(a.oa);a.wc.v().Cb.clear();a.wc.v().G();a.Re.G()}),d.push(e);if(c.RO||c.remove)e=document.createElement("BUTTON"),e.innerHTML="<span class='icon-eraser' aria-hidden='true'></span>",e.className="btn btn-success Map-btn map-Remove",
e.title=a.kf.COMPONENT_MAP_DELETE_FEATURE,$(e).prop("type","button"),$(e).on("click",function(){a.$h("remove")}),d.push(e);if(c.ED||c.modify)e=document.createElement("BUTTON"),e.innerHTML="<span class='icon-edit' aria-hidden='true'></span>",e.className="btn btn-success Map-btn map-Modify",e.title=a.kf.COMPONENT_MAP_MODIFY_FEATURE,$(e).prop("type","button"),$(e).on("click",function(){a.$h("modify")}),d.push(e);if(c.DP||c.point)e=document.createElement("BUTTON"),e.innerHTML="<span class='icon-point' aria-hidden='true'></span>",
e.className="btn btn-success Map-btn map-Point",e.title=a.kf.COMPONENT_MAP_DRAW_POINT,$(e).prop("type","button"),$(e).on("click",function(){a.$h("point")}),d.push(e);if(c.DL||c.line)e=document.createElement("BUTTON"),e.innerHTML="<span class='icon-line' aria-hidden='true'></span>",e.className="btn btn-success Map-btn map-Line",e.title=a.kf.COMPONENT_MAP_DRAW_LINE,$(e).prop("type","button"),$(e).on("click",function(){a.$h("line")}),d.push(e);if(c.DPol||c.polygon)c=document.createElement("BUTTON"),
c.innerHTML="<span class='icon-polygon' aria-hidden='true'></span>",c.className="btn btn-success Map-btn map-Polygon",c.title=a.kf.COMPONENT_MAP_DRAW_POLYGON,$(c).prop("type","button"),$(c).on("click",function(){a.$h("polygon")}),d.push(c);var f=document.createElement("DIV");f.className="btn-group-vertical btn-group-md form-map-Group-btn-interact";for(c=0;c<d.length;c++)f.appendChild(d[c]);b.appendChild(f);setTimeout(function(){var b=a.aa.yg;b.on("change:length",function(){$(f).children().removeClass("active");
$(f).children().blur();b.forEach(function(a){$(a.get("binded-button")).addClass("active")})});b.on("remove",function(){null!=a.Ie&&a.Ie.setActive(!1);a.cq=null;for(var b=0;b<a.ri.length;b++)fa(a.ri[b])&&a.ri[b].call(this,a.cq)});$(document).keydown(function(c){27===c.keyCode&&b.forEach(function(b){n(b.get("binded-button"))&&a.aa.Ig(b)})})},1E3);return f}
Y.prototype.Ig=function(a){var b=null;switch(a){case "full_screen":b=$(this.Ob).find(".map-FullScreen");break;case "layer_tree":b=$(this.Ob).find(".map-LayerTree");break;case "select":b=$(this.Ob).find(".map-Select");break;case "remove_all":case "RA":b=$(this.Ob).find(".map-AllRemove");break;case "remove":case "RO":b=$(this.Ob).find(".map-Remove");break;case "modify":case "ED":b=$(this.Ob).find(".map-Modify");break;case "point":case "DP":b=$(this.Ob).find(".map-Point");break;case "line":case "DL":b=
$(this.Ob).find(".map-Line");break;case "polygon":case "DPol":b=$(this.Ob).find(".map-Polygon")}null!=b&&$(b).remove()};Y.prototype.removeInteraction=Y.prototype.Ig;function ky(a){null!=a.Ie&&a.aa.Ig(a.Ie);a.Ie=new vw({source:a.wc.v(),Vb:si});a.Ie.on("select",function(b){a.Ob.style.cursor="";q(b.selected)&&0<b.selected.length&&(a.Ob.style.cursor="pointer")});a.aa.bc(a.Ie);a.Ie.setActive(!0)}
Y.prototype.$h=function(a,b){var c=this;switch(a){case "point":var d=$(this.Ob).find(".map-Point");break;case "line":d=$(this.Ob).find(".map-Line");break;case "polygon":d=$(this.Ob).find(".map-Polygon");break;case "select":d=$(this.Ob).find(".map-Select");break;case "remove":d=$(this.Ob).find(".map-Remove");break;case "modify":d=$(this.Ob).find(".map-Modify")}var e=$(d).hasClass("active");b&&(e=!1);if("none"!==this.oa&&(this.aa.Ig(this.oa),e))return 0;switch(a){case "point":this.oa=new Oo({source:this.wc.v(),
type:"Point"});this.oa.set("binded-button",d);this.oa.set("type","draw_point");this.aa.bc(this.oa);this.oa.on("drawend",function(a){!0!==c.zp&&c.wc.v().Cb.clear();a.za.Dw=NaN;c.Re.G();ly(c,a.za)});break;case "line":this.oa=new Oo({source:this.wc.v(),type:"LineString"});this.oa.set("binded-button",d);this.oa.set("type","draw_line");this.aa.bc(this.oa);this.oa.on("drawend",function(a){!0!==c.zp&&c.wc.v().Cb.clear();a.za.Dw=NaN;c.Re.G();ly(c,a.za)});break;case "polygon":this.oa=new Oo({source:this.wc.v(),
type:"Polygon"});this.oa.set("binded-button",d);this.oa.set("type","draw_polygon");this.aa.bc(this.oa);this.oa.on("drawend",function(a){!0!==c.zp&&c.wc.v().Cb.clear();a.za.Dw=NaN;c.Re.G();ly(c,a.za)});break;case "select":d=$(this.Ob).find(".map-Select");my(this,d);break;case "remove":this.oa=new vw({Vb:qi,source:this.wc.v()});ky(this);this.oa.set("binded-button",d);this.oa.set("type","remove");this.aa.bc(this.oa);this.oa.wa().on("add",function(){c.fc(c.oa.wa().R()[0])});break;case "modify":this.oa=
new gw({features:this.wc.v().Cb}),this.oa.set("binded-button",d),this.oa.set("type","modify"),this.aa.bc(this.oa),this.oa.on("modifyend",function(){c.Re.G()})}};Y.prototype.activeInteraction=Y.prototype.$h;
function my(a,b){a.oa=new vw({Vb:qi,source:a.wc.v()});null!=b&&(a.oa.set("binded-button",b),a.oa.set("type","select"));a.aa.bc(a.oa);a.oa.wa().on("change:length",function(){var b=a.wc.v().wa(),d=a.oa.wa().R()[0],b=b[b.indexOf(d)];a.cq=null!=b?b:null;for(b=0;b<a.ri.length;b++)fa(a.ri[b])&&a.ri[b].call(this,a.cq)});a.oa.Or=function(){var b=a.oa.wa().R()[0],d=new Cn({color:"rgba(255,255,255,0)"}),e=new gl({color:"rgba(0,0,0,0.4)",width:2,bb:[10]}),d=new Dn({Lb:new Bn({fill:d,stroke:e,tb:50}),fill:d,
stroke:e});if(null!=b){e=b.j().W();if("Point"===b.j().K())e=new So({geometry:b.j()});else var b=e[0],f=e[1],g=e[2],e=e[3],e=new zh([[[b,f],[b,e],[g,e],[g,f]]]),e=new So({geometry:e});e.xd(d);a.oa.wa().push(e)}};a.oa.on("select",function(){a.oa.Or()});ky(a)}Y.prototype.fc=function(a){this.wc.v().fc(a);this.oa.wa().clear();null!=this.Ie&&this.Ie.wa().clear();this.wc.v().G();this.Re.G()};
Y.prototype.ak=function(a){0<this.aa.getLayers().R().length&&this.aa.getLayers().clear();this.Yh.length=0;var b,c=[],d=[256,256];a=angular.copy(a);var e=new ur({properties:this.HB});b=e.Go(a,{size:this.aa.Ta(),tileSize:d});d=e.ls(a,{size:this.aa.Ta(),tileSize:d});this.aa.Eh(b);for(e=0;e<d.length;e++)b={index:e,layer:d[e]},this.Yh.push(b),this.aa.Eb(d[e]);for(e=0;e<a.children.length;e++)n(a.children[e].children)&&c.push({service:a.children[e].name,layers:a.children[e].children});return c};
Y.prototype.loadTree=Y.prototype.ak;function hy(a,b){var c=!0;b[0]>a[0]&&(c=!1);b[1]>a[1]&&(c=!1);b[2]<a[2]&&(c=!1);b[3]<a[3]&&(c=!1);return c}Y.prototype.fb=function(){var a=new hg(6378137),b=D(this.aa).D(),c=Oh(D(this.aa),[37.795275591,0]),d=Rg([c[0],c[1]],b,"EPSG:4326"),b=Rg([c[2],c[3]],b,"EPSG:4326");return 100*jg(a,d,b)};Y.prototype.getScale=Y.prototype.fb;Y.prototype.le=function(a){var b=this.getScale(),c=D(this.aa).xa();a=a*c/b;Uh(D(this.aa),a);this.getScale()};Y.prototype.setScale=Y.prototype.le;
Y.prototype.fq=function(a){this.$u=a;Th(D(this.aa),a,{Ti:!0})};Y.prototype.Gf=function(){return D(this.aa).Gf()};Y.prototype.getZoom=Y.prototype.Gf;Y.prototype.Fh=function(a){D(this.aa).Fh(a)};Y.prototype.setZoom=Y.prototype.Fh;Y.prototype.ub=function(a){D(this.aa).ub(a)};Y.prototype.setCenter=Y.prototype.ub;
Y.prototype.ZI=function(a){var b=this;this.aa.Ef().clear();"undefined"!==this.Yq&&$(this.Yq).remove();a.ZO&&(this.Yq=fy(this,this.Ob));a.MP&&(this.aa.Tc(new mv({Vn:function(a){return[a[0].toPrecision(b.sn),a[1].toPrecision(b.sn)]}})),$(".ol-mouse-position").css("bottom","8px"),$(".ol-mouse-position").css("top","auto"),$(".ol-mouse-position").css("background","rgba(218, 94, 209, 0.58)"),$(".ol-mouse-position").css("color","#ffffff"),$(".ol-mouse-position").css("border-radius","4px"));a.SL&&(this.aa.Tc(new vv),
$(".ol-scale-line").css("background","rgba(218, 94, 209, 0.58)"));a.CP&&this.aa.Tc(new Yh({element:b.element,render:function(){$(b.element).html(b.vd)}}))};Y.prototype.setControls=Y.prototype.ZI;Y.prototype.gJ=function(a){this.aa.yg.clear();"undefined"!==this.Uq&&$(this.Uq).remove();this.Uq=gy(this,this.Ob,a);mj().forEach(function(a){this.aa.bc(a)},this)};Y.prototype.setInteractions=Y.prototype.gJ;
Y.prototype.YI=function(a){var b=this.aa.getLayers().R()[0];a=new Eq({ki:a.culture,key:a.key,Ps:a.style});b.set("source",a)};Y.prototype.setBingSource=Y.prototype.YI;Y.prototype.eE=function(){this.Config.extent=Oh(this.Sc,this.aa.Ta());this.Config.coord=this.Sc.La();this.Config.scale=Math.round(this.getScale());return this.Config};Y.prototype.getConfig=Y.prototype.eE;Y.prototype.g=function(){return this.aa};Y.prototype.getMap=Y.prototype.g;
Y.prototype.Eh=function(a){this.vd=a.proj;var b,c;n(a.center.coord)&&(b=a.center.coord);n(a.center.extent)&&(c=a.center.extent);a.center.coord&&a.center.zoom?(this.Sc=new Hh({center:b,zoom:a.center.zoom,projection:Gg(this.vd)}),this.aa.Eh(this.Sc)):(this.Sc=new Hh({center:[(c[0]+c[2])/2,(c[1]+c[3])/2],projection:Gg(this.vd)}),this.aa.Eh(this.Sc),Th(D(this.aa),c,{Ti:!0}));a="";for(b=0;b<this.Dp.projections;b++)this.vd===this.wH.projections[b].code&&(a=this.wH.projections[b].name);""!==a?$(".ol-current-projection-studio").html(a):
$(".ol-current-projection-studio").html(this.vd)};Y.prototype.setView=Y.prototype.Eh;Y.prototype.hJ=function(a){this.ak(a)};Y.prototype.setJsonTree=Y.prototype.hJ;Y.prototype.wa=function(){return this.Re.R()};Y.prototype.getFeatures=Y.prototype.wa;Y.prototype.os=function(){return this.vd};Y.prototype.getProj=Y.prototype.os;Y.prototype.W=function(){return Oh(this.Sc,this.aa.Ta())};Y.prototype.getExtent=Y.prototype.W;Y.prototype.La=function(){return this.Sc.La()};Y.prototype.getCenter=Y.prototype.La;
Y.prototype.wK=function(a,b,c){return Rg(a,b,c)};Y.prototype.transformer=Y.prototype.wK;Y.prototype.vK=function(a,b,c){return Sg(a,b,c)};Y.prototype.transformExtent=Y.prototype.vK;Y.prototype.on=function(a,b,c){this.aa.on(a,b,c)};Y.prototype.on=Y.prototype.on;Y.prototype.bh=function(a,b){var c=this.g(),d=this,e=new So({geometry:new rh([a,b])});c.getLayers().R().forEach(function(a){if(n(a.v().wa)){var b=a.v().Cb;!0!==d.zp&&a.v().Cb.clear();b.push(e)}});this.ub([a,b])};
function ny(a,b){a.ri.push(b)}function oy(a,b){a.no.push(b)}function py(a,b){a.mo.push(b)}function qy(a,b){a.El.push(b)}function ly(a,b){for(var c=0;c<a.mo.length;c++)fa(a.mo[c])&&a.mo[c].call(a,b);for(c=0;c<a.El.length;c++)fa(a.El[c])&&a.El[c].call(a,b);Na(a.El)};var X={};pa("oVFB",X);X.config={};X.lh=function(a){console.log("oVFB.init: ",a);X.config=a};X.init=X.lh;X.resize=function(){};X.resize=X.resize;X.Cx=function(){return X.xc};X.getUpdate=X.Cx;X.pJ=function(a){X.xc=a};X.setUpdate=X.pJ;X.gE=function(){return X.oH};X.getDevTools=X.gE;X.$E=function(){return X.xH};X.getTreeView=X.$E;X.mE=function(){return X.Qy};X.getFormTools=X.mE;X.gh=function(){return X.Ry};X.getJsonLoader=X.gh;X.iE=function(){return X.Py};X.getElementForm=X.iE;X.aF=function(){return X.Xy};
X.getVisualizer=X.aF;X.Bo=function(){return X.Sy};X.getJson=X.Bo;X.eA=function(a){X.Sy=a};X.setJson=X.eA;X.qg=function(){return X.Oz};X.getJs=X.qg;X.Ck=function(a){X.Oz=a};X.setJs=X.Ck;X.xi=function(){return X.Mz};X.getCss=X.xi;X.du=function(a){X.Mz=a};X.setCss=X.du;X.ga=function(){n(X.Bp)||console.error("oVFB.oJsonOutput_ undefined");fb(X.Bp)&&console.error("oVFB.oJsonOutput_ is empty");return X.Bp};X.getJsonOutput=X.ga;X.Yb=function(a){X.Bp=a};X.setJsonOutput=X.Yb;
X.Bx=function(a){var b,c;for(c in a)if(b=a[c],null!=b.rows)for(var d=0;d<b.rows.length;d++)if(null!=b.rows[d].fields)for(var e=0;e<b.rows[d].fields.length;e++)!0===b.rows[d].fields[e].selected&&delete b.rows[d].fields[e].selected;return a};
X.rx=function(a){for(var b=[],c=[],d=0;d<a.rows.length;d++)if(null!=a.rows[d].fields)for(var e=0;e<a.rows[d].fields.length;e++)null!=a.rows[d].fields[e].name&&b.push(a.rows[d].fields[e].name),null!=a.rows[d].fields[e].buttons&&c.push(a.rows[d].fields[e].name);return{elems:b,buttons:c}};
X.IK=function(a,b){b=b.name;a=a.name;var c=X.ga(),d,e,f;for(f in c)if(d=c[f],null!=d.tabs&&null!=d.tabs.list)for(var g=0;g<d.tabs.list.length;g++)e=d.tabs.list[g],null!=e.elements&&-1!==e.elements.indexOf(b)&&e.elements.splice(e.elements.indexOf(b),1,a);X.Yb(c)};X.JK=function(a,b){b=b.name;a=a.name;var c=X.ga(),d,e,f;for(f in c)if(d=c[f],null!=d.wab)for(var g in d.wab)for(var h in d.wab[g])e=d.wab[g][h],null!=e[b]&&(e[a]=e[b],delete e[b]);X.Yb(c)};
X.QC=function(a,b){var c;if(null!=a.list)for(var d=0;d<a.list.length;d++)if(c=a.list[d],null!=c.elements)for(var e=c.elements.length-1;0<=e;e--)-1===b.indexOf(c.elements[e])&&(console.error("Element "+c.elements[e]+" is not in elements list"),c.elements.splice(e,1));return a};
X.RC=function(a,b,c,d){for(var e=0;e<c.length;e++)null!=a[c[e]]||(a[c[e]]={});for(var f in a)if(-1===c.indexOf(f))delete a[f];else{for(e=0;e<d.length;e++)null!=a[f][d[e]]||(a[f][d[e]]={});for(var g in a[f])if(-1===d.indexOf(g))delete a[f][g];else{for(var h in a[f][g])-1===b.indexOf(h)&&delete a[f][g][h];for(e=0;e<b.length;e++)null!=a[f][g][b[e]]||(a[f][g][b[e]]="")}}return a};
X.SC=function(a){var b;if(null!=a.list)for(var c=0;c<a.list.length;c++)b=a.list[c],null!=b.$$hashKey&&delete b.$$hashKey,null!=b.studio_mode&&delete b.studio_mode;return a};X.Sl=function(){return X.WA};X.getTreeDnD=X.Sl;X.Om=function(a){X.WA=a};X.setTreeDnD=X.Om;X.Ax=function(){return X.SA};X.getToken=X.Ax;X.setToken=function(a){X.SA=a};X.Wb=function(){return X.id};X.getId=X.Wb;X.eh=function(){return X.Zu};X.setId=function(a){X.id=a};X.setContainer=function(a){X.JD=a};
X.setAppProperties=function(a){X.ea=a};X.setApplication=function(a){X.Zu=a};X.reset=function(){};X.module=angular.module("vfb",["ui.codemirror","ui.grid","ui.grid.autoResize","formReader"]);X.yA=function(){X.log("nsVFB.MainDirective");null!=X.config||console.error("oVFB['config'] not defined, please use oVFB.init(config)");return{restrict:"A",replace:!0,controller:"AppStudioMainController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/MainTemplate.html"}};
X.studioMainDirective=X.yA;X.module.directive("appStudioMainDirective",X.yA);
X.B=function(a,b,c,d){X.log("nsVFB.MainController");var e=this;this.b=a;this.J=d;this.Ja=b;this.$timeout_=c;this.Ks=0;this.text={};a.aCollapsed=X.Ug;a.text={};a.jsonOutput={};a.datasources={};a.selectedDatasource={};a.webservices=[];a.businessObjects=[];a.ressources=[];a.aExternalDatabaseTables=[];a.schemas=[];a.databases=[];a.tables=[];a.selectedDatasource={};a.editedDatasource={};a.newSource={options:["Value one|1","Value two|2","Value three|3"],result_options:[{label:"Value one",value:"1"},{label:"Value two",
value:"2"},{label:"Value three",value:"3"}]};a.editorOptions={mode:"schema",lineNumbers:!1,lineSeparator:"\n",theme:"Veremes",onLoad:function(){}};a.studioAddModalTestGridOptions={data:[],enableColumnMenus:!1,enableColumnResizing:!0,onRegisterApi:function(b){a.Tm=b}};a.studioEditModalTestGridOptions={data:[],enableColumnMenus:!1,enableColumnResizing:!0,onRegisterApi:function(b){a.Um=b}};a.studioDatasourcesGridOptions={data:[],columnDefs:[{field:"name",displayName:"Nom"}],enableColumnMenus:!1,enableColumnResizing:!0,
enableRowSelection:!0,multiSelect:!1,enableFullRowSelection:!0,onRegisterApi:function(b){a.datasourcesGridApi=b;b.selection.on.rowSelectionChanged(a,function(b){a.selectedDatasource=angular.copy(a.datasources[b.entity.id]);a.selectedDatasource.id=b.entity.id;e.bA(a.selectedDatasource)})}};a.tabs={};a.elems=[];a.sTestTabFormDefinitionName="";a.oTestTabFormValues={};a.oTestTabFormDefinition={};a.oTestTabFormScope={};a.sTestWabFormDefinitionName="";a.oTestWabFormValues={};a.oTestWabFormDefinition={};
a.oTestWabFormScope={};a.oProperties=X.ea;a.sToken=sessionStorage.session_token;a.wab={};a.wabGroups=[];a.wabStates=[];a.module="";a.object="";a.wabSelectedGroup="";a.wabSelectedState="";a.applicationName=X.eh();z({method:"GET",url:"javascript/externs/studio/lang/lang-"+X.ea.language+".json",scope:this.b,success:function(b){a.text=b.data;e.text=b.data},error:function(){console.error("ERROR : (AJAX request : "+status+" ) On loading Language, contact Veremes please")}});z({method:"GET",url:X.ea.web_server_name+
"/"+X.ea.services_alias+"/vitis/webservices",headers:{Accept:"application/x-vm-json"},params:{attributs:"name"},scope:this.b,success:function(b){null!=b.data.data?a.webservices=b.data.data:console.error("response.data['data'] not defined")}});"vmap"===a.applicationName&&z({method:"GET",url:X.ea.web_server_name+"/"+X.ea.services_alias+"/vmap/businessobjects",headers:{Accept:"application/x-vm-json"},scope:this.b,params:{order_by:"title"},success:function(b){if(null!=b.data.data){b=b.data.data;for(var c=
0;c<b.length;c++)b[c].sql_form="SELECT * FROM "+b[c].schema+"."+b[c].table;a.businessObjects=[];for(c=0;c<b.length;c++)a.businessObjects.push({title:b[c].title,business_object_id:b[c].business_object_id,sql_form:b[c].sql_form,sql_summary:b[c].sql_summary,sql_list:b[c].sql_list})}else console.error("response.data['data'] not defined")}});$("#studio-datasource-modal").on("hide.bs.modal",function(){X.Oe();e.sw();X.reloadForm()});$("#studio-datasource-add-modal").on("hide.bs.modal",function(){a.aExternalDatabaseTables.length=
0;a.databases.length=0;a.schemas.length=0;a.tables.length=0;e.On()});$("#studio-datasource-edit-modal").on("hide.bs.modal",function(){a.aExternalDatabaseTables.length=0;a.databases.length=0;a.schemas.length=0;a.tables.length=0;e.On()});a.$on("updateForm",function(b,c){a.$applyAsync(function(){a.jsonOutput=c})});a.$on("updateTestTabForm",function(b,c){if(c[a.selected_form_type]){b=c[a.selected_form_type];for(var d=0;d<b.rows.length;d++)for(var e=0;e<b.rows[d].fields.length;e++)b.rows[d].fields[e].id||
(b.rows[d].fields[e].id=b.rows[d].fields[e].name+"_"+(d+1)+"_"+(e+1));a.oTestTabFormDefinition=c;a.sTestTabFormDefinitionName=a.selected_form_type;a.title=b.title;n(a.oTestTabFormValues)||(a.oTestTabFormValues={});n(a.oTestTabFormValues[a.sTestTabFormDefinitionName])||(a.oTestTabFormValues[a.sTestTabFormDefinitionName]={});angular.element($("#studio_test_tabs_form_reader").children()).scope().ctrl.dj()}else X.log("visualizerFormModeController. Load JSON form fail: "+a.selected_form_type+" undefined in ",
c)});a.$on("loadWABGroups",function(b,c){a.module=c.module;a.object=c.object;ry(e,a.module)});a.$on("updateTestWabForm",function(b,c){if(c[a.selected_form_type]){b=c[a.selected_form_type];for(var d=0;d<b.rows.length;d++)for(var e=0;e<b.rows[d].fields.length;e++)b.rows[d].fields[e].id||(b.rows[d].fields[e].id=b.rows[d].fields[e].name+"_"+(d+1)+"_"+(e+1));a.oTestWabFormDefinition=c;a.sTestWabFormDefinitionName=a.selected_form_type;a.title=b.title;n(a.oTestWabFormValues)||(a.oTestWabFormValues={});n(a.oTestWabFormValues[a.sTestWabFormDefinitionName])||
(a.oTestWabFormValues[a.sTestWabFormDefinitionName]={});var f=angular.element($("#studio_test_wab_form_reader").children()).scope();null!=f&&f.$applyAsync(function(){f.wabState=a.wabSelectedState;f.wabGroup=a.wabSelectedGroup;f.ctrl.dj()})}else X.log("visualizerFormModeController. Load JSON form fail: "+a.selected_form_type+" undefined in ",c)});a.$watch("tabs",function(){sy(e)},!0);a.$watch("wabSelectedGroup",function(){r(a.wabSelectedState)&&r(a.wabSelectedGroup)&&""!==a.wabSelectedGroup&&""!==
a.wabSelectedState&&ty(e)});a.$watch("wabSelectedState",function(){r(a.wabSelectedState)&&r(a.wabSelectedGroup)&&""!==a.wabSelectedGroup&&""!==a.wabSelectedState&&ty(e)})};X.studioMainController=X.B;X.module.controller("AppStudioMainController",["$scope","$q",X.B]);
X.B.prototype.AJ=function(){X.log("studioMainController.showTabsManagerModal");X.xc=!0;var a=this.b,b=a.selected_form_type,c=X.rx(a.jsonOutput[b]);X.Oe();a.jsonOutput=X.ga();a.tabs=angular.copy(a.jsonOutput[b].tabs);a.elems=c.elems;a.buttons=c.buttons;a.tabs=X.QC(a.tabs,a.elems);sy(this);$("#studio-tabsmanager-modal").modal("show")};X.B.prototype.showTabsManagerModal=X.B.prototype.AJ;X.B.prototype.jK=function(a,b){-1!==b.elements.indexOf(a)?b.elements.splice(b.elements.indexOf(a),1):b.elements.push(a)};
X.B.prototype.toggleElemOnTab=X.B.prototype.jK;
function ry(a,b){var c=a.b;z({method:"POST",url:X.ea.web_server_name+"/"+X.ea.services_alias+"/wab/groups",headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},scope:c,data:{order_by:"name",distinct:!0,filter:{column:"module_id",compare_operator:"=",value:b}},success:function(b){if(null!=b.data.data){c.wabGroups=[];for(var d=0;d<b.data.data.length;d++)c.wabGroups.push(b.data.data[d].name);uy(a,c.module,c.object)}else console.error("response.data['data'] not defined")}})}
function uy(a,b,c){var d=a.b;z({method:"POST",url:X.ea.web_server_name+"/"+X.ea.services_alias+"/wab/states",headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},scope:d,data:{order_by:"progress_lvl",distinct:!0,filter:{relation:"AND",operators:[{column:"module_id",compare_operator:"=",value:b},{column:"bo_name",compare_operator:"=",value:c}]}},success:function(b){if(null!=b.data.data){d.wabStates=[];for(var c=0;c<b.data.data.length;c++)d.wabStates.push(b.data.data[c].name);a.Bw()}else console.error("response.data['data'] not defined")}})}
X.B.prototype.Bw=function(){for(var a=this.b,b=0;b<a.wabStates.length;b++){a.wab[a.wabStates[b]]={};for(var c=0;c<a.wabGroups.length;c++)a.wab[a.wabStates[b]][a.wabGroups[c]]={}}};X.B.prototype.createEmptyWabObject=X.B.prototype.Bw;X.B.prototype.Wa=function(a){var b=this.b;null!=a||(a={label:b.text.Loader.Tab,elements:[]});b.$applyAsync(function(){b.tabs.list.push(a)})};X.B.prototype.addTab=X.B.prototype.Wa;
X.B.prototype.xC=function(a){var b=this;bootbox.confirm("<h4>"+this.b.text.Loader.AskRemoveTab+"</h4><br>"+a.label,function(c){c&&b.Bz(a)})};X.B.prototype.askAndRemoveTab=X.B.prototype.xC;X.B.prototype.Bz=function(a){var b=this.b;-1!==b.tabs.list.indexOf(a)?b.$applyAsync(function(){b.tabs.list.splice(b.tabs.list.indexOf(a),1)}):console.error("Tab not founted in scope.tabs.list")};X.B.prototype.removeTab=X.B.prototype.Bz;
X.B.prototype.aH=function(a,b){var c=this.b,d=0;-1!==c.tabs.list.indexOf(a)?c.$applyAsync(function(){var e=c.tabs.list.indexOf(a);"left"===b&&(d=-1);"right"===b&&(d=1);0<=e+d&&e+d<c.tabs.list.length&&(c.tabs.list.splice(e,1),c.tabs.list.splice(e+d,0,a))}):console.error("Tab not founted in scope.tabs.list")};X.B.prototype.moveTab=X.B.prototype.aH;X.B.prototype.RI=function(a){var b=this.b;a.elements=[];for(var c=0;c<b.elems.length;c++)a.elements.push(b.elems[c])};X.B.prototype.selectAllElems=X.B.prototype.RI;
X.B.prototype.MI=function(a){var b=this.b,c=b.selected_form_type;$("#studio-tabsmanager-modal").modal("hide");a=X.SC(a);b.jsonOutput[c].tabs=a;X.ga();b.$broadcast("updateForm",b.jsonOutput)};X.B.prototype.saveTabs=X.B.prototype.MI;function sy(a){a=a.b;var b=X.Bx(a.jsonOutput),c=a.selected_form_type;null!=b&&null!=b[c]&&null!=b[c].tabs&&(b[c].tabs=angular.copy(a.tabs),a.$broadcast("updateTestTabForm",b))}
X.B.prototype.BJ=function(){X.log("studioMainController.showWabManagerModal");var a=this.b,b=a.selected_form_type,c=X.rx(a.jsonOutput[b]);X.Oe();a.jsonOutput=X.ga();null!=a.jsonOutput[b].wab&&(a.wab=angular.copy(a.jsonOutput[b].wab));a.elems=c.elems;a.buttons=c.buttons;a.wab=X.RC(a.wab,a.elems,a.wabStates,a.wabGroups);$("#studio-wabmanager-modal").modal("show")};X.B.prototype.showWabManagerModal=X.B.prototype.BJ;
X.B.prototype.kK=function(a,b,c,d){if(null!=b&&null!=b[c]){var e;if(null!=b[c][a]){e=f;var f=b[c][a];"r"===d&&(e=""===f?"r":"");"rw"===d&&(e=""===f?"rw":"r"===f?"rw":"r");b[c][a]=e}else b[c][a]=d;ty(this)}};X.B.prototype.toggleElemOnWab=X.B.prototype.kK;X.B.prototype.NI=function(a){var b=this.b,c=b.selected_form_type;$("#studio-wabmanager-modal").modal("hide");b.jsonOutput[c].wab=a;X.Yb(b.jsonOutput);b.$broadcast("updateForm",b.jsonOutput)};X.B.prototype.saveWab=X.B.prototype.NI;
function ty(a){a=a.b;var b=X.Bx(a.jsonOutput),c=a.selected_form_type;null!=b&&null!=b[c]&&(b[c].wab=angular.copy(a.wab),a.$broadcast("updateTestWabForm",b))}
X.B.prototype.uJ=function(){X.xc=!0;X.log("studioMainController.showDatasourcesModal");var a=this.b;a.jsonOutput=X.ga();n(a.jsonOutput.datasources)&&ha(a.jsonOutput.datasources)&&!q(a.jsonOutput.datasources)||(a.jsonOutput.datasources={});a.datasources=a.jsonOutput.datasources;X.Oe();$("#studio-datasource-modal").modal("show");a.selectedDatasource={};this.Kg();angular.element(u.f).injector().get(["$timeout"])(function(){0<a.datasourcesGridApi.grid.rows.length&&0===a.datasourcesGridApi.selection.getSelectedRows().length&&
a.datasourcesGridApi.selection.selectRow(a.studioDatasourcesGridOptions.data[0])},1)};X.B.prototype.showDatasourcesModal=X.B.prototype.uJ;X.B.prototype.ZH=function(a){var b=this;this.Ks++;var c=angular.copy(this.Ks);setTimeout(function(){c===b.Ks&&b.fA(a)},1500)};X.B.prototype.preventLocalDatabaseChanged=X.B.prototype.ZH;
X.B.prototype.iJ=function(){X.log("studioMainController.setLocalDatabases");var a=this.b,b=this;z({method:"GET",url:X.ea.web_server_name+"/"+X.ea.services_alias+"/vitis/genericquerys/databases",headers:{Accept:"application/x-vm-json"},scope:this.b,success:function(c){null!=c.data.data?a.databases=c.data.data:($.notify(b.text.Element.Component.Select.Database_List_Error,"error"),a.databases=[])}})};X.B.prototype.setLocalDatabases=X.B.prototype.iJ;
X.B.prototype.fA=function(a){X.log("studioMainController.setLocalDatabaseSchemas");var b=this.b,c=this;z({method:"GET",url:X.ea.web_server_name+"/"+X.ea.services_alias+"/vitis/genericquerys/"+a+"/schemas",headers:{Accept:"application/x-vm-json"},scope:this.b,success:function(a){null!=a.data.data?b.schemas=a.data.data:($.notify(c.text.Element.Component.Select.Schema_List_error,"error"),b.schemas=[])}})};X.B.prototype.setLocalDatabaseSchemas=X.B.prototype.fA;
X.B.prototype.zz=function(a,b){X.log("studioMainController.reloadTablesList");var c=this.b,d=this;z({method:"GET",url:X.ea.web_server_name+"/"+X.ea.services_alias+"/vitis/genericquerys",headers:{Accept:"application/x-vm-json"},params:{database:b,schema:a},scope:this.b,success:function(a){null!=a.data.data?c.tables=a.data.data:($.notify(d.text.Element.Component.Select.Table_List_error,"error"),c.tables=[])}})};X.B.prototype.reloadTablesList=X.B.prototype.zz;
X.B.prototype.xJ=function(){X.log("studioMainController.showNewSourceModal");for(var a=this.b,b="datasource_1",c=1;n(a.datasources[b]);)b="datasource_"+c,c++;a.newSource={id:b,name:b,description:"",parameters:{},options:["Value one|1","Value two|2","Value three|3"],options_model:"Value one|1\nValue two|2\nValue three|3",result_options:[{label:"Value one",value:"1"},{label:"Value two",value:"2"},{label:"Value three",value:"3"}]};a.newSource=this.ct(a.newSource);a.aExternalDatabaseTables.length=0;a.databases.length=
0;a.schemas.length=0;a.tables.length=0;$("#studio-datasource-add-modal").modal("show");a.aExternalDatabaseTablesSelected={};a.databaseSelected={};a.schemaSelected={};a.tableSelected={};$("#typeSourceTooltip").popover({trigger:"hover",container:"body",content:function(){return a.text.Element.Component.Select.TypeSourceContent},placement:function(b,c){return a.$root.workspaceTooltipPlacement(c)}})};X.B.prototype.showNewSourceModal=X.B.prototype.xJ;
X.B.prototype.vJ=function(){X.log("studioMainController.showEditSourceModal");var a=this.b;if(0<a.datasourcesGridApi.selection.getSelectedRows().length){if(0===Object.keys(a.selectedDatasource).length)return 0;a.editedDatasource=angular.copy(a.selectedDatasource);a.editedDatasource=this.ct(a.editedDatasource);a.databases.length=0;a.schemas.length=0;a.tables.length=0;"web_service"===a.editedDatasource.type&&null!=a.editedDatasource.webservice&&null!=a.editedDatasource.webservice.name&&this.bB(a.editedDatasource.webservice);
$("#studio-datasource-edit-modal").modal("show");var b=angular.element(u.f).injector().get(["$timeout"]);b(function(){a.refresh=!0;b(function(){a.refresh=!1},100)},500);for(var c=0;c<a.databases.length;c++)a.databases[c].databasename===a.editedDatasource.parameters.database&&(a.databaseSelected=a.databases[c],this.oM(a.editedDatasource.parameters.database));for(c=0;c<a.schemas.length;c++)a.schemas[c].schema_name===a.editedDatasource.parameters.schema&&(a.schemaSelected=a.schemas[c],this.zz(a.editedDatasource.parameters.schema));
b(function(){for(var b=0;b<a.tables.length;b++)a.tables[b].table_name===a.editedDatasource.parameters.table&&(a.tableSelected=a.tables[b])},500)}else bootbox.alert(this.text.Element.Component.Select.Datasource_NothingSelected)};X.B.prototype.showEditSourceModal=X.B.prototype.vJ;
X.B.prototype.Rs=function(a){X.log("studioMainController.isEmptyFilter");if(null==a)return!0;if(r(a)){if(0===a.length)return!0}else if(ha(a)&&q(a.operators)){if(1<a.operators.length)return!1;if(0===a.operators.length||""===a.operators[0].column&&""===a.operators[0].value)return!0}return!1};X.B.prototype.isEmptyFilter=X.B.prototype.Rs;
X.B.prototype.ct=function(a){X.log("studioMainController.loadDatasourceDefaultValues");null!=a.parameters||(a.parameters={});if("externalDatabase"===a.dataType){if(this.Rs(a.parameters.filter)||!r(a.parameters.filter))a.parameters.filter=""}else if(this.Rs(a.parameters.filter)||!ha(a.parameters.filter))a.parameters.filter={relation:"AND",operators:[{column:"",compare_operator:"=",value:""}]};this.On();return a};X.B.prototype.loadDatasourceDefaultValues=X.B.prototype.ct;
X.B.prototype.YB=function(a){X.log("studioMainController.addSource");var b=this.b;if("text"===a.dataType){b.refresh=!1;if(!n(a.id))return console.error("newSource.id not defined"),0;if(!n(a.name))return console.error("newSource.name not defined"),0;n(a.options)||(console.error("newSource.options not defined"),a.options=[]);if(n(b.datasources[a.id]))return bootbox.alert(this.text.Element.Component.Select.Datasource_Exists),0;a={id:a.id,type:"object",dataType:a.dataType,name:a.name,description:a.description,
options:a.options};$("#studio-datasource-add-modal").modal("hide");this.yk(a);this.Kg()}else if("externalDatabase"===a.dataType){if(!n(a.id))return console.error("newSource.id not defined"),0;if(!n(a.name))return console.error("newSource.name not defined"),0;if(!n(a.parameters.server))return console.error("newSource.parameters.server not defined"),0;if(!n(a.parameters.port))return console.error("newSource.parameters.port not defined"),0;if(!n(a.parameters.sgbd))return console.error("newSource.parameters.sgbd not defined"),
0;if(!n(a.parameters.login))return console.error("newSource.parameters.login not defined"),0;if(!n(a.parameters.password))return console.error("newSource.parameters.password not defined"),0;if(!n(a.parameters.database))return console.error("newSource.parameters.database not defined"),0;if(!n(a.parameters.schema))return console.error("newSource.parameters.schema not defined"),0;if(!n(a.parameters.table))return console.error("newSource.parameters.table not defined"),0;if(n(b.datasources[a.id]))return bootbox.alert(this.text.Element.Component.Select.Datasource_Exists),
0;a={id:a.id,type:"web_service",dataType:a.dataType,name:a.name,description:a.description,parameters:a.parameters,ressource_id:"vitis/genericquerys/"+a.parameters.table};$("#studio-datasource-add-modal").modal("hide");this.yk(a);this.Kg()}else if("tableValue"===a.dataType){if(null!=a.parameters)var c=angular.copy(a.parameters);if(!n(a.id))return console.error("newSource.id not defined"),0;if(!n(a.name))return console.error("newSource.name not defined"),0;if(!n(a.parameters.schema))return console.error("newSource.parameters.schema not defined"),
0;if(!n(a.parameters.table))return console.error("newSource.parameters.table not defined"),0;if(n(b.datasources[a.id]))return bootbox.alert(this.text.Element.Component.Select.Datasource_Exists),0;if(n(c.filter.operators))for(b=0;b<c.filter.operators.length;b++)""!=c.filter.operators[b].WC&&""!=c.filter.operators[b].VC&&""!=c.filter.operators[b].value||c.filter.operators.splice(b,1);a={id:a.id,type:"web_service",dataType:a.dataType,name:a.name,description:a.description,parameters:c,ressource_id:"vitis/genericquerys"};
$("#studio-datasource-add-modal").modal("hide");this.yk(a);this.Kg()}else if("webService"===a.dataType){if(!n(a.id))return console.error("newSource.id not defined"),0;if(!n(a.name))return console.error("newSource.name not defined"),0;if(!n(a.webservice))return bootbox.alert(this.text.Element.Component.Select.WebService_undefined),console.error("newSource.webservice not defined"),0;if(!n(a.ressource))return bootbox.alert(this.text.Element.Component.Select.Ressource_undefined),console.error("newSource.ressource not defined"),
0;if(n(b.datasources[a.id]))return bootbox.alert(this.text.Element.Component.Select.Datasource_Exists),0;a={id:a.id,type:"web_service",dataType:a.dataType,name:a.name,description:a.description,webservice:a.webservice,ressource:a.ressource,ressource_id:a.webservice.name+"/"+a.ressource.name};$("#studio-datasource-add-modal").modal("hide");this.yk(a);this.Kg()}else if("businessObject"===a.dataType){if(!n(a.id))return console.error("newSource.id not defined"),0;if(!n(a.name))return console.error("newSource.name not defined"),
0;if(!n(a.businessObject.business_object_id))return bootbox.alert(this.text.Element.Component.Select.BusinessObject_undefined),console.error("newSource.businessObject not defined"),0;if(n(b.datasources[a.id]))return bootbox.alert(this.text.Element.Component.Select.Datasource_Exists),0;a={id:a.id,type:"web_service",dataType:a.dataType,name:a.name,description:a.description,businessObject:a.businessObject,businessObjectRequest:a.businessObjectRequest,subObject:"bo_"+a.businessObjectRequest,ressource_id:"vmap/querys/"+
a.businessObject.business_object_id+"/"+a.businessObjectRequest};$("#studio-datasource-add-modal").modal("hide");this.yk(a);this.Kg()}};X.B.prototype.addSource=X.B.prototype.YB;
X.B.prototype.wI=function(){X.log("studioMainController.removeSelectedSource");var a=this,b=this.b,c=b.selectedDatasource.id,d=[];if(null==c)return 0;for(var e in b.jsonOutput)if("datasources"!==e){var f=b.jsonOutput[e];if(null!=f.rows&&q(f.rows))for(var g=0;g<f.rows.length;g++)if(null!=f.rows[g].fields)for(var h=0;h<f.rows[g].fields.length;h++)null!=f.rows[g].fields[h].datasource&&f.rows[g].fields[h].datasource.datasource_id===c&&d.push({label:f.rows[g].fields[h].label,name:f.rows[g].fields[h].name,
UL:e})}c=this.text.Element.Component.Select.Datasource_Delete;if(0<d.length){c=this.text.Element.Component.Select.Datasource_Delete_Used;c+="<br><br><ul>";for(g=0;g<d.length;g++)c+="<li>"+d[g].formName+": "+d[g].label+" ("+d[g].name+")</li>";c=c+"</ul><br>"+this.text.Element.Component.Select.Datasource_Delete}bootbox.confirm(c,function(c){!0===c&&(delete b.datasources[b.selectedDatasource.id],b.selectedDatasource={},setTimeout(function(){a.Kg()},500),X.Yb(b.jsonOutput))})};
X.B.prototype.removeSelectedSource=X.B.prototype.wI;
X.B.prototype.yk=function(a){X.log("studioMainController.saveDatasource");var b=this.b;"object"===a.type?b.datasources[a.id]={type:a.type,dataType:a.dataType,name:a.name,description:a.description,options:a.options}:"web_service"===a.type&&(b.datasources[a.id]={type:a.type,dataType:a.dataType,name:a.name,description:a.description,parameters:a.parameters,ressource_id:a.ressource_id},null!=a.webservice&&(b.datasources[a.id].webservice=a.webservice),null!=a.ressource&&(b.datasources[a.id].ressource=a.ressource),
null!=a.businessObject&&(b.datasources[a.id].businessObject=a.businessObject),null!=a.subObject&&(b.datasources[a.id].subObject=a.subObject),null!=a.businessObjectRequest&&(b.datasources[a.id].businessObjectRequest=a.businessObjectRequest,b.datasources[a.id].subObject="bo_"+a.businessObjectRequest,b.datasources[a.id].ressource_id="vmap/querys/"+a.businessObject.business_object_id+"/"+a.businessObjectRequest));"externalDatabase"===a.dataType&&(b.datasources[a.id].ressource_id="vitis/genericquerys/"+
a.parameters.table);X.Yb(b.jsonOutput);this.Kg();$.notify(this.text.Element.Component.Select.Saved,{className:"success",autoHideDelay:X.wb});$("#studio-datasource-edit-modal").modal("hide");b.refresh=!1};X.B.prototype.saveDatasource=X.B.prototype.yk;
X.B.prototype.Kg=function(){X.log("studioMainController.setStudioGridDatasources");var a=this.b;Na(a.studioDatasourcesGridOptions.data);var b=angular.copy(a.datasources),c;for(c in a.datasources)b[c].id=c,a.studioDatasourcesGridOptions.data.push(b[c]);a.datasourcesGridApi.grid.refresh();gb(a.selectedDatasource)};X.B.prototype.setStudioGridDatasources=X.B.prototype.Kg;
X.B.prototype.bA=function(a){X.log("studioMainController.setDatasourceContent");if("object"===a.type){a.options_model="";a.result_options=[];if(q(a.options))for(var b=0;b<a.options.length;b++)0<b&&(a.options_model+="\n"),a.options_model+=a.options[b];this.$A(a)}};X.B.prototype.setDatasourceContent=X.B.prototype.bA;
X.B.prototype.$A=function(a){X.log("studioMainController.updateDatasourceTextContent");a.options=a.options_model.split("\n");Na(a.result_options);for(var b,c=[],d=[],e=0;e<a.options.length;e++)b=a.options[e].split("|"),c.push(b[0]),d.push(b[1]);b=Object.keys(c);for(e=0;e<b.length;e++)a.result_options.push({label:c[b[e]],value:d[e]})};X.B.prototype.updateDatasourceTextContent=X.B.prototype.$A;
X.B.prototype.bB=function(a){X.log("studioMainController.updateRessources");var b=this.b;z({method:"GET",url:X.ea.web_server_name+"/"+X.ea.services_alias+"/vitis/webservices/"+a.name+"/ressources",headers:{Accept:"application/x-vm-json"},params:{attributs:"name"},scope:this.b,success:function(a){null!=a.data.data?b.ressources=a.data.data:console.error("response.data['data'] not defined")}})};X.B.prototype.updateRessources=X.B.prototype.bB;
X.B.prototype.GA=function(a,b){X.log("studioMainController.testTableValues");var c=this.b;if(null!=a.parameters)var d=angular.copy(a.parameters);if(null!=d.filter.operators)for(a=0;a<d.filter.operators.length;a++)""!=d.filter.operators[a].WC&&""!=d.filter.operators[a].VC&&""!=d.filter.operators[a].value||d.filter.operators.splice(a,1);null!=d.filter.operators&&0===d.filter.operators.length&&(delete d.filter.xt,delete d.filter.nM,delete d.filter);a=X.ea.web_server_name+"/"+X.ea.services_alias+"/vitis/genericquerys";
var e={limit:10};null!=d&&kb(e,d);"studio-datasource-add-modal"===b?this.Mg(a,e,c.studioAddModalTestGridOptions,c.Tm):"studio-datasource-edit-modal"===b&&this.Mg(a,e,c.studioEditModalTestGridOptions,c.Um)};X.B.prototype.testTableValues=X.B.prototype.GA;
X.B.prototype.FA=function(a,b){X.log("studioMainController.testExternalDatabaseValues");var c=this.b;if(null==a.parameters.server)return bootbox.alert("server "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.port)return bootbox.alert("Port "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.sgbd)return bootbox.alert("SGBD "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.login)return bootbox.alert("Login "+this.text.Element.Component.Select.Undefined),
0;if(null==a.parameters.password)return bootbox.alert("Password "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.database)return bootbox.alert("Database "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.schema)return bootbox.alert("Schema "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.table)return bootbox.alert("Table "+this.text.Element.Component.Select.Undefined),0;var d=X.ea.web_server_name+"/"+X.ea.services_alias+"/vitis/genericquerys/"+
a.parameters.table;a={limit:10,login:a.parameters.login,password:a.parameters.password,server:a.parameters.server,port:a.parameters.port,sgbd:a.parameters.sgbd,database:a.parameters.database,schema:a.parameters.schema,filter:a.parameters.filter};"studio-datasource-add-modal"===b?this.Mg(d,a,c.studioAddModalTestGridOptions,c.Tm):"studio-datasource-edit-modal"===b&&this.Mg(d,a,c.studioEditModalTestGridOptions,c.Um)};X.B.prototype.testExternalDatabaseValues=X.B.prototype.FA;
X.B.prototype.WJ=function(a,b){"externalDatabase"===a.dataType?this.FA(a,b):"tableValue"===a.dataType?this.GA(a,b):"webService"===a.dataType?this.HA(a,b):"businessObject"===a.dataType&&this.EA(a,b)};X.B.prototype.testDatasource=X.B.prototype.WJ;
X.B.prototype.HA=function(a,b){X.log("studioMainController.testWebService");var c=this.b;n(a.webservice)||bootbox.alert(this.text.Element.Component.Select.WebServiceUndefined);n(a.ressource)||bootbox.alert(this.text.Element.Component.Select.RessourceUndefined);a=X.ea.web_server_name+"/"+X.ea.services_alias+"/"+a.webservice.name+"/"+a.ressource.name;var d={limit:10};"studio-datasource-add-modal"===b?this.Mg(a,d,c.studioAddModalTestGridOptions,c.Tm):"studio-datasource-edit-modal"===b&&this.Mg(a,d,c.studioEditModalTestGridOptions,
c.Um)};X.B.prototype.testWebService=X.B.prototype.HA;
X.B.prototype.EA=function(a,b){X.log("studioMainController.testBusinessObject");var c=this.b;n(a.businessObject)||bootbox.alert(this.text.Element.Component.Select.BusinessObject_undefined);n(a.businessObjectRequest)||bootbox.alert(this.text.Element.Component.Select.BusinessObject_Request_undefined);var d=X.ea.web_server_name+"/"+X.ea.services_alias+"/vmap/querys/"+a.businessObject.business_object_id+"/"+a.businessObjectRequest,e={limit:10};null!=a.parameters&&kb(e,a.parameters);"studio-datasource-add-modal"===
b?this.Mg(d,e,c.studioAddModalTestGridOptions,c.Tm,"bo_"+a.businessObjectRequest):"studio-datasource-edit-modal"===b&&this.Mg(d,e,c.studioEditModalTestGridOptions,c.Um,"bo_"+a.businessObjectRequest)};X.B.prototype.testBusinessObject=X.B.prototype.EA;
X.B.prototype.Mg=function(a,b,c,d,e){X.log("studioMainController.testRequestAPI");var f=this;if(!n(a))return console.error("url not defined"),0;if(!n(b))return console.error("params not defined"),0;z({method:"GET",url:a,headers:{Accept:"application/x-vm-json"},params:b,scope:this.b,success:function(a){if(!n(a.data.data))return bootbox.alert(f.text.Element.Component.Select.NoDataReturned),0;var b;if(null!=e){b=[];for(var g=0;g<a.data.data.length;g++)b.push(a.data.data[g][e])}else b=a.data.data;a=Object.keys(b[0]);
for(var m=[],g=0;g<a.length;g++)m.push({name:a[g],displayName:a[g],width:100});c.data=b;c.columnDefs=m;d.grid.refresh()}})};X.B.prototype.testRequestAPI=X.B.prototype.Mg;X.B.prototype.sw=function(){X.log("studioMainController.clearDatasourcesGrid");var a=this.b;a.studioDatasourcesGridOptions.data=[];a.datasourcesGridApi.grid.refresh()};X.B.prototype.clearDatasourcesGrid=X.B.prototype.sw;
X.B.prototype.On=function(){X.log("studioMainController.clearTestGrids");var a=this.b;a.studioAddModalTestGridOptions.data=[];a.studioAddModalTestGridOptions.columnDefs=[];a.Tm.grid.refresh();a.studioEditModalTestGridOptions.data=[];a.studioEditModalTestGridOptions.columnDefs=[];a.Um.grid.refresh()};X.B.prototype.clearTestGrids=X.B.prototype.On;
X.B.prototype.jE=function(a){X.log("studioMainController.getExternalDatabaseTables");var b=this,c=this.b;if(null==a.parameters.server)return bootbox.alert("Server "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.port)return bootbox.alert("Port "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.sgbd)return bootbox.alert("SGBD "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.login)return bootbox.alert("Login "+this.text.Element.Component.Select.Undefined),
0;if(null==a.parameters.password)return bootbox.alert("Password "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.database)return bootbox.alert("Database "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.schema)return bootbox.alert("Schema "+this.text.Element.Component.Select.Undefined),0;var d=X.ea.web_server_name+"/"+X.ea.services_alias+"/vitis/genericquerys";a={limit:50,login:a.parameters.login,password:a.parameters.password,server:a.parameters.server,
port:a.parameters.port,sgbd:a.parameters.sgbd,database:a.parameters.database,schema:a.parameters.schema};if(null==d)return console.error("url undefined"),0;if(null==a)return console.error("params undefined"),0;z({method:"GET",url:d,headers:{Accept:"application/x-vm-json"},params:a,scope:this.b,timeout:5E3,success:function(a){if(!n(a.data.data))return bootbox.alert(b.text.Element.Component.Select.NoDataReturned),0;q(c.aExternalDatabaseTables)?c.aExternalDatabaseTables.length=0:c.aExternalDatabaseTables=
[];for(var d=0;d<a.data.data.length;d++)c.aExternalDatabaseTables.push(a.data.data[d].table_name)}})};X.B.prototype.getExternalDatabaseTables=X.B.prototype.jE;
X.B.prototype.UB=function(a){X.log("studioMainController.addNewFilterOperator");n(a.parameters.filter)?n(a.parameters.filter.operators)?0<a.parameters.filter.operators.length?a.parameters.filter.operators.push({column:"",compare_operator:"=",value:""}):0===a.parameters.filter.operators.length&&(delete a.parameters.filter.xt,a.parameters.filter.xt=[{column:"",compare_operator:"=",value:""}]):a.parameters.filter.xt=[{column:"",compare_operator:"=",value:""}]:a.parameters.filter={relation:"AND",operators:[{column:"",
compare_operator:"=",value:""}]}};X.B.prototype.addNewFilterOperator=X.B.prototype.UB;X.Rg=Nx;"dev"===oProperties.mode&&(X.Rg.IL=!0);X.log=X.Rg.log;X.Oe=X.Rg.Oe;X.reloadForm=X.Rg.reloadForm;X.removeWebServiceFromFields=X.Rg.removeWebServiceFromFields;X.tj=X.Rg.tj;X.Vq=X.Rg.Vq;X.clone=X.Rg.clone;X.xc=!1;X.oH={};X.Ry={};X.xH={};X.Qy={};X.Py={};X.iM={};X.Xy={};X.Sy={empty:!0};X.Bp={};X.Oz="";X.Mz="";X.wb=oProperties.timeNotify;X.Ug=[!1,!1,!1,!1,!1];X.valid=!0;X.vj=[];X.SA="";X.Zu="";X.id=0;X.JD=null;
X.ea=null;X.WA="no tree";X.Ry=new Ox;X.Qy=new Tx;X.Py=new dy;X.Xy=new cy;var vy={css:"css/lib/bootstrap/css/bootstrap.min.css css/lib/jquery/plugins/bootstrap-datepicker/bootstrap-datepicker3.min.css css/lib/jquery/plugins/bootstrap-fileinput/css/fileinput.min.css css/lib/ui-grid/ui-grid.min.css css/lib/jquery/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css css/lib/bootstrap-checkbox/build.css css/lib/bootstrap-checkbox/font-awesome.css css/lib/jquery/plugins/bootstrap-slider/bootstrap-slider.min.css css/lib/jquery/plugins/malihu-custom-scrollbar/jquery.mCustomScrollbar.min.css css/lib/ui-grid/plugins/draggable-rows.less less/main.less modules/vitis/less/main.less javascript/externs/studio/less/studio.less modules/vmap/css/lib/bootstrap-toggle/bootstrap-toggle.css modules/vmap/css/lib/colorpicker/css/bootstrap-colorpicker.css modules/vmap/css/lib/bootstrap-table/bootstrap-table.min.css modules/vmap/css/lib/jquery-sortable/jquery-sortable.css modules/vmap/css/ol.css modules/vmap/css/vmap.less modules/vm4ms/less/main.less css/lib/codemirror/codemirror.css css/lib/codemirror/codemirror_foldgutter.css css/lib/codemirror/map.css css/lib/codemirror/show-hint.css javascript/externs/studio/less/CodeMirror.less css/lib/jquery/plugins/bootstrap-treeview/bootstrap-treeview.min.css css/lib/jquery/plugins/bootstrap-tagsinput/bootstrap-tagsinput.css css/lib/jquery/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css css/lib/viewer/viewer.min.css".split(" "),
js:{externs:"modules/vmap/javascript/externs/bootstrap-toggle/bootstrap-toggle.min.js modules/vmap/javascript/externs/bootstrap-table/bootstrap-table.js modules/vmap/javascript/externs/bootstrap-table/bootstrap-table-export.js modules/vmap/javascript/externs/bootstrap-table/tableExport.js modules/vmap/javascript/externs/jquery-sortable/jquery-sortable.js modules/vmap/javascript/externs/html2canvas/html2canvas.js modules/vmap/javascript/externs/jspdf/jspdf.debug.js javascript/externs/bootbox/bootbox.min.js javascript/externs/codemirror/codemirror.min.js javascript/externs/codemirror/htmlmixed.js javascript/externs/codemirror/css.js javascript/externs/codemirror/javascript.js javascript/externs/codemirror/clike.js javascript/externs/codemirror/php.js javascript/externs/codemirror/xml.js javascript/externs/codemirror/sql.js javascript/externs/codemirror/map.js javascript/externs/codemirror/show-hint.js javascript/externs/codemirror/addon/fold/foldcode.js javascript/externs/codemirror/addon/fold/foldgutter.js javascript/externs/codemirror/addon/fold/brace-fold.js javascript/externs/codemirror/addon/fold/xml-fold.js javascript/externs/angular/modules/ui-codemirror/ui-codemirror.min.js javascript/externs/tinymce/tinymce.min.js javascript/externs/angular/modules/ui-tinymce/tinymce.js javascript/externs/jquery/plugins/bootstrap-treeview/bootstrap-treeview.js javascript/externs/jquery/plugins/bootstrap-tagsinput/bootstrap-tagsinput.min.js javascript/externs/scripts_cryptage.js javascript/externs/moment/moment.min.js javascript/externs/moment/min/moment-with-locales.min.js javascript/externs/jquery/plugins/notify/notify.js javascript/externs/jquery/plugins/bootstrap-colorpicker/bootstrap-colorpicker.min.js javascript/externs/jquery/plugins/bootstrap-confirmation/bootstrap-confirmation.min.js javascript/externs/jquery/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js javascript/externs/viewer/viewer.min.js javascript/externs/alasql/alasql.min.js javascript/externs/alasql/xlsx.core.min.js".split(" ")},
vitisModuleDependencies:"vmap ui.codemirror ui.tinymce vfb ui.grid.draggable-rows ui.grid.exporter".split(" ")};sessionStorage.loading_counter=0;cd();var wy=vy.css;
if("object"==typeof wy&&null!=wy){var xy=Date.now();"undefined"!=typeof oClientProperties&&(xy=oClientProperties.build);for(var yy=document.getElementsByTagName("link"),zy=[],Ay=0;Ay<yy.length;)""!=yy[Ay].href&&zy.push(yy[Ay].href),Ay++;for(var Ay=0,By=!1;Ay<wy.length;)wy[Ay]=wy[Ay]+"?version="+xy,yy=document.createElement("link"),yy.setAttribute("href",wy[Ay]),-1==bd(yy.href,zy)?(yy.setAttribute("type","text/css"),-1==wy[Ay].indexOf(".less")?(yy.setAttribute("rel","stylesheet"),document.getElementsByTagName("head")[0].appendChild(yy)):
(yy.setAttribute("rel","stylesheet/less"),less.sheets.push(yy),By=!0)):console.log(wy[Ay]+" -> d\u00e9ja charg\u00e9"),Ay++;By&&less.refresh()}ad(vy.js.externs,{async:!1,scriptInBody:!0,callback:function(){if("true"==sessionStorage.debug)var a=setInterval(function(){"undefined"!=typeof u.An&&"undefined"!=typeof u.rr&&(clearInterval(a),angular.bootstrap(document,["vitisApp"]))},100);else angular.bootstrap(document,["vitisApp"])}});$(document).keydown(function(a){27===a.keyCode&&dd()});function Cy(a,b,c){return{token:"",validity_date:"",duration:600,web_service:"vitis",web_service_controller:"privatetoken",application_modules:[],connect:function(){a.defaults.headers.common.token=this.token;c.sMainTemplateUrl="templates/mainTpl.html"},disconnect:function(){document.cookie.split(";").forEach(function(a){a=a.split("=");a[1]==sessionStorage.getItem("session_token")&&(document.cookie=a[0]+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;")});this.clearSessionStorage();var a=Object.keys(oUrlParams);
if(-1!==a.indexOf("login")&&-1!==a.indexOf("password")){delete oUrlParams.login;delete oUrlParams.password;var a=Object.keys(oUrlParams),c=[],f;a.forEach(function(a){f=a;"undefined"!=typeof oUrlParams[a]&&(f+=oUrlParams[a]);c.push(f)});b.location.search="?"+c.join("&")}else b.location.reload()},clearSessionStorage:function(){for(var a=["session_token","user_login","user_id","stats_per_date"],b=0;b<a.length;)sessionStorage.removeItem(a[b]),this.removeAppLocalStorageItem(a[b]),b++},saveSessionToLocalStorage:function(){for(var a=
["session_token","user_login","user_id"],b=0;b<a.length;)this.setAppLocalStorageItem(a[b],sessionStorage[a[b]]),b++},restoreSessionFromAppLocalStorage:function(){for(var a=["session_token","user_login","user_id"],b=0;b<a.length;)sessionStorage[a[b]]=this.getAppLocalStorageItem(a[b]),b++},getAppLocalStorageItem:function(a){return localStorage.getItem(sessionStorage.appEnv+"_"+a)},setAppLocalStorageItem:function(a,b){localStorage.setItem(sessionStorage.appEnv+"_"+a,b)},removeAppLocalStorageItem:function(a){localStorage.removeItem(sessionStorage.appEnv+
"_"+a)}}}Cy.$inject=["$http","$window","envSrvc"];
function Dy(a,b,c,d,e,f,g){return{sMode:"search",oSelectedMode:"",oSelectedObject:"",oSectionForm:{},sSelectedTemplate:"",sMainTemplateUrl:"",sId:"",sIdField:"",sLastSelectedMode:"",oLastSelectedObjectMode:{},oFormDefinition:{},sFormDefinitionName:"",oFormValues:{},oFormDefaultValues:{},oGridOptions:{},oGridOptionsCopy:{},oDefaultGridOptions:{},sTemplateFolder:"templates/",oWorkspaceList:{},oWorkspaceListRefreshTimer:{},sSelectedSectionName:"",setMode:function(a,c){var d=this,e=b.get(["formSrvc"]).checkFormModifications(this.sFormDefinitionName);
e.then(function(){d.sMode=a;if("insert"==a)d.sId="";else if("search"==a&&"undefined"!=typeof d.oSectionForm){var b=d.oSectionForm[d.oSelectedObject.name];"undefined"!=typeof b&&(b.iSelectedSectionIndex=0)}d.loadObjectTemplate({bForceTemplateCompilation:!0,sUrlTemplate:c})});return e},loadObjectTemplate:function(b){var c=!0;this.oSelectedMode.reload||"undefined"==typeof this.oLastSelectedObjectMode[this.oSelectedMode.mode_id]||(c=!1);this.oLastSelectedObjectMode[this.oSelectedMode.mode_id]=this.oSelectedObject;
this.oLastSelectedObjectMode[this.oSelectedMode.mode_id].lastMode=this.sMode;this.setFormDefinitionName();var d=this;c||b.bForceTemplateCompilation?"undefined"!=typeof b.sUrlTemplate?a.compileObjectTemplate(b.sUrlTemplate):("undefined"!=typeof this.oSelectedObject.event&&(a.$eval(this.oSelectedObject.event),this.setFormDefinitionName(),!0===b.bFirstModeObject&&(this.oLastSelectedObjectMode[this.oSelectedMode.mode_id]=this.oSelectedObject,this.oLastSelectedObjectMode[this.oSelectedMode.mode_id].lastMode=
this.sMode)),"undefined"==typeof d.oSelectedObject.sections?z({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/vitis/VitisSections",params:{order_by:"index",filter:{relation:"AND",operators:[{column:"tab_id",compare_operator:"=",value:this.oSelectedObject.tab_id},{column:"lang",compare_operator:"=",value:f.language},{column:"module_name",compare_operator:"IN",value:sessionStorage.application_modules.split(",")}]}},scope:a,success:function(b){1==b.data.status&&(d.oSelectedObject.sections=
b.data.vitissections,d.sSelectedTemplate=b.data.vitissections[0].template,b="search"!=d.sMode&&1<b.data.vitissections.length?d.sTemplateFolder+"sectionFormTpl.html":-1!=d.sSelectedTemplate.indexOf("/")?d.sSelectedTemplate:d.sTemplateFolder+d.sSelectedTemplate,d.setFormDefinitionName(),a.compileObjectTemplate(b),a.$broadcast(a.sSelectedObjectName+"_form",{}))}}):(d.sSelectedTemplate=this.oSelectedObject.sections[0].template,a.compileObjectTemplate("search"!=d.sMode&&1<d.oSelectedObject.sections.length?
d.sTemplateFolder+"sectionFormTpl.html":-1!=d.sSelectedTemplate.indexOf("/")?d.sSelectedTemplate:d.sTemplateFolder+d.sSelectedTemplate))):($("#data_column .container-mode").hide(),$("#container_mode_"+this.oSelectedMode.mode_id).show())},extractWebServiceData:function(a,b){var c=[];"undefined"!=typeof b[a]&&(Array.isArray(b[a])?0<b[a].length&&(c=b[a]):c=b[a]);return c},addSectionForm:function(){this.setSectionForm("insert")},addDoubleForm:function(){this.sSelectedTemplate="doubleFormTpl.html";this.sId=
"";this.setMode("insert",this.sTemplateFolder+this.sSelectedTemplate)},setSectionForm:function(a,b){var c;this.sSelectedTemplate="simpleFormTpl.html";c=1<this.oSelectedObject.sections.length?"sectionFormTpl.html":"simpleFormTpl.html";"insert"!=a&&(this.sId=b);this.setMode(a,this.sTemplateFolder+c)},explodeWebServiceResourceId:function(a){var b=[];"string"==typeof a&&(b=a.split("/"));return b},getSectionWebServiceResourceId:function(){var a=this.oSelectedObject.ressource_id;if("undefined"!=typeof this.oSectionForm[this.oSelectedObject.name]){var b=
this.oSectionForm[this.oSelectedObject.name];"undefined"!=typeof b.sections&&null!=b.sections[b.iSelectedSectionIndex].ressource_id&&(a=b.sections[b.iSelectedSectionIndex].ressource_id)}return a},setFormDefinitionName:function(){if("undefined"==typeof this.oSelectedObject.sections)this.sFormDefinitionName=this.oSelectedObject.name+"_"+this.sMode+"_form";else{var a=0;"undefined"!=typeof this.oSectionForm[this.oSelectedObject.name]&&"undefined"!=typeof this.oSectionForm[this.oSelectedObject.name].iSelectedSectionIndex&&
(a=this.oSectionForm[this.oSelectedObject.name].iSelectedSectionIndex);this.sFormDefinitionName=1==this.oSelectedObject.sections.length||"search"==this.sMode?this.oSelectedObject.name+"_"+this.sMode+"_form":this.oSelectedObject.name+"_"+this.oSelectedObject.sections[a].name+"_"+this.sMode+"_form"}},toGarbageCollection:function(a){if(null!=a){var b=this;Array.isArray(a)?a.length=0:"object"==typeof a&&Object.keys(a).forEach(function(c){Array.isArray(a[c])||"object"==typeof a[c]?b.toGarbageCollection(a[c]):
delete a[c]})}},setModalSectionForm:function(f,k,m){var h=this,t=b.get(["modesSrvc"]),v="form_modal_"+h.oSelectedObject.name,w=a.$new();t.addScopeToObject(h.oSelectedObject.name,h.oSelectedMode.mode_id,w);var x={},x=null!=m?m:{sSelectedTemplate:h.sSelectedTemplate,sId:h.sId,sMode:h.sMode};w.sParentMode=h.sMode;g.modalWindow("dialog","&nbsp;",{className:"dialog-modal-window dialog-modal-window-section-form",message:'<div id="'+v+'"></div>'}).then(function(b){$(b).on("shown.bs.modal",function(){h.sSelectedTemplate=
"simpleFormTpl.html";h.sId="insert"==f?"":k;h.sMode=f;var g=document.querySelector("body").clientHeight-50;b[0].querySelector(".modal-dialog").style.width=document.querySelector("body").clientWidth-50+"px";b[0].querySelector(".modal-dialog").style.height=g+"px";b[0].querySelector(".modal-header").style.height="56px";b[0].querySelector(".modal-body").style.height=g-56-4+"px";c(h.sTemplateFolder+h.sSelectedTemplate).then(function(c){d($("#"+v).html(c).contents())(w);var f=a.$on("formDefinitionLoaded",
function(a,c){f();e(h.oFormDefinition[c].title,{sId:h.sId}).then(function(a){b[0].querySelector(".modal-title").textContent=a})}),g=a.$on("endFormNgRepeat",function(){g();b[0].querySelector(".simple-form-title").style.display="none"})})});$(b).on("hide.bs.modal",function(){var a=angular.element(u.f).scope();h.sSelectedTemplate=x.sSelectedTemplate;h.sId=x.sId;h.sMode=x.sMode;null!=x.sFormDefinitionName&&(a.sFormDefinitionName=x.sFormDefinitionName,h.sFormDefinitionName=x.sFormDefinitionName);null!=
x.ressource_id&&(h.oSelectedObject.ressource_id=x.ressource_id);null!=x.resetTemplateUrl&&1==x.resetTemplateUrl&&(a.oFormRequestParams=null)})})}}}Dy.$inject="$rootScope $injector $templateRequest $compile $translate propertiesSrvc externFunctionSrvc".split(" ");u.SK=function(){return{id:"",login:""}};
function Ey(a,b,c,d,e,f,g,h){return{modes:"",scope:"",getMode:function(a){for(var b=0;b<this.modes.length;){if(this.modes[b].mode_id==a)return this.modes[b];b++}return{}},getObject:function(a,b){for(var c=0;c<b.objects.length;){if(b.objects[c].name==a)return b.objects[c];c++}return{}},selectMode:function(a,b,g,t){t=null!=t?t:0;var k=this,p=c.defer(),m="undefined"!=typeof X&&1==X.xc?h.checkStudioFormModifications(f.sSelectedObjectName):h.checkFormModifications(f.sFormDefinitionName);m.then(function(){var c;
c=!0;"undefined"!=typeof f.oSelectedMode.mode_id&&(c=f.oSelectedMode.reload)&&(angular.element("#container_mode_"+f.oSelectedMode.mode_id).empty(),k.clearObjectData(f.oSelectedObject.name,f.oSelectedMode.mode_id),f.oLastSelectedObjectMode[f.oSelectedMode.mode_id]=null,"undefined"!=typeof f.oSectionForm[f.oSelectedObject.name]&&(f.oSectionForm[f.oSelectedObject.name]={}));var h=k.getMode(b);f.oSelectedMode=h;var m=f.oLastSelectedObjectMode[f.oSelectedMode.mode_id];c||fb(m)||"undefined"==m.lastMode?
(f.oSelectedObject=h.objects[t],k.scope=a,c=!0):(f.sMode=m.lastMode,f.oSelectedObject=m,c=!1);d.sSelectedObjectName=f.oSelectedObject.name;f.sSelectedSectionName="";a.objects=1<h.objects.length||null!==h.objects[t].label?h.objects:{};"undefined"!==typeof g?($("#mode_column > ul > li > a").removeClass("mode_selected"),$(g.target).addClass("mode_selected")):($("#mode_column > ul > li > a").removeClass("mode_selected"),$("#mode_"+b).addClass("mode_selected"));f.loadObjectTemplate({bForceTemplateCompilation:!1,
bFirstModeObject:c});e(function(){d.$broadcast(d.sSelectedObjectName,{})},300);p.resolve()});m=p.promise;"undefined"!=typeof X&&(X.xc=!1);return m},selectObject:function(a,b,c){var g=this;("undefined"!=typeof X&&1==X.xc?h.checkStudioFormModifications(f.sSelectedObjectName):h.checkFormModifications(f.sFormDefinitionName)).then(function(){"undefined"==typeof c&&(c="search");angular.element("#container_mode_"+f.oSelectedMode.mode_id).empty();g.clearObjectData(f.oSelectedObject.name,f.oSelectedMode.mode_id);
"undefined"!=typeof f.oSectionForm[b]&&(f.oSectionForm[b]={},f.oLastSelectedObjectMode[f.oSelectedMode.mode_id].sFormDefinitionName=null);f.sMode=c;f.oSelectedObject=g.getObject(b,f.oSelectedMode);d.sSelectedObjectName=f.oSelectedObject.name;f.sSelectedSectionName="";f.loadObjectTemplate({bForceTemplateCompilation:!0});e(function(){d.$broadcast(d.sSelectedObjectName,{})},1)});"undefined"!=typeof X&&(X.xc=!1)},loadModes:function(){var e={filter:{column:"application_name",compare_operator:"=",value:sessionStorage.application},
order_by:"index",distinct:"true"},f=this,h=c.defer();z({method:"GET",url:g.web_server_name+"/"+g.services_alias+"/vitis/modes",params:e,scope:d,headers:{Accept:"application/x-vm-json"},success:function(c){if(1==c.data.status){var d=c.data.data,e;c=0;for(var k;c<d.length;){e=d[c].data[0].data;n(e)||(console.error("Objets du mode "+d[c].mode_id+" non d\u00e9finis"),console.error(d[c]));for(k=0;k<e.length;)e[k].name=e[k].mode_id+"_"+e[k].name,e[k].event=e[k].event.replace("javascript:",""),e[k].aScope=
[],e[k].display_menu=!0,k++;d[c].objects=e;d[c].data=void 0;d[c].fullScreen=!1;d[c].ajaxLoader=!0;c++}f.modes=d;h.resolve("modes saved");e=[];for(c=0;c<d.length;)-1==e.indexOf(d[c].module_name)&&e.push(d[c].module_name),c++;sessionStorage.application_modules=e;for(c=0;c<e.length;)b.addPart("modules/"+e[c]+"/lang"),c++;a.refresh().then(function(){for(var b=0,c=0,e,f;b<d.length;)e="TITLE_MODE_"+d[b].mode_id.toUpperCase(),f="TEXT_MODE_"+d[b].mode_id.toUpperCase(),a([e,f],{app_name:g.app_name}).then(function(a){var b=
Object.keys(a);d[c].title=a[b[0]];d[c].text=a[b[1]];c++}),b++})}}});return h.promise},setModeReload:function(a,b){for(var c=0;c<this.modes.length;)this.modes[c].mode_id==a&&(this.modes[c].reload=b),c++},clearObjectData:function(a,b){a=this.getObject(a,this.getMode(b));null!=a.aScope&&(a.aScope.forEach(function(a){a.$destroy()}),a.aScope.length=0)},addScopeToObject:function(a,b,c){a=this.getObject(a,this.getMode(b));"undefined"==typeof a.aScope&&(a.aScope=[]);a.aScope.push(c)}}}Ey.$inject="$translate $translatePartialLoader $q $rootScope $timeout envSrvc propertiesSrvc formSrvc".split(" ");
u.jo=function(a,b,c,d){return{resizeWin:function(){var a=document.getElementById("container").offsetHeight;null===document.getElementById("header_line")||""!==document.getElementById("header_line").style["margin-top"]&&"0px"!==document.getElementById("header_line").style["margin-top"]||(a-=document.getElementById("header_line").offsetHeight);null===document.getElementById("footer_line")||""!==document.getElementById("footer_line").style["margin-top"]&&"0px"!==document.getElementById("footer_line").style["margin-top"]||
(a-=document.getElementById("footer_line").offsetHeight);document.getElementById("works_line").style.height=a+"px";var b=$(".workspacelist-grid"),c=0;setTimeout(function(){for(;c<b.length;){var a=b[c].offsetHeight,d=b[c].offsetWidth;null!=document.getElementById(b[c].id+"_header")&&(a-=document.getElementById(b[c].id+"_header").offsetHeight);null!=document.getElementById(b[c].id+"_footer")&&(a-=document.getElementById(b[c].id+"_footer").offsetHeight);document.getElementById(b[c].id+"_data").style.height=
a-2+"px";document.getElementById(b[c].id+"_data").style.width=d-2+"px";b.find(".ui-grid-render-container-left .ui-grid-viewport").height(b.find(".ui-grid-render-container-body .ui-grid-viewport").height()-17);c++}},300)},clearLessCache:function(){for(var a=0;a<window.localStorage.length;){var b=window.localStorage.key(a);-1!=b.indexOf(".less")?window.localStorage.removeItem(b):a++}},preg_replace:function(a,b,c){c=String(c);for(i=0;i<a.length;i++)c=c.replace(RegExp(a[i],"gi"),b[i]);return c},modalWindow:function(e,
f,g){d.info("modalWindow");var h=c.defer(),k=h.promise;"undefined"==typeof g&&(g={});var m=[];"undefined"!=typeof f&&""!=f&&m.push(f);"undefined"!=typeof g.message&&""!=g.message?m.push(g.message):g.message="&nbsp;";b(m).then(function(b){var c,d=!1;"&nbsp;"!=g.message&&(g.message=b[g.message]);if("undefined"!=typeof f&&""!=f){g.title=b[f];switch(g.className){case "modal-danger":c="exclamation-sign";d=!0;break;case "modal-success":c="ok-sign";d=!0;break;case "modal-warning":c="warning-sign"}"undefined"!=
typeof c&&(g.title='<span class="glyphicon glyphicon-'+c+'" aria-hidden="true"></span>&nbsp;'+b[f])}d&&"dialog"==e&&(g.buttons={close:{label:"OK",className:"btn-default"}});var k=bootbox[e](g);h.resolve(k);"undefined"!=typeof g.appDuration?setTimeout(function(){k.modal("hide");"undefined"!=typeof g.appCallback&&g.appCallback(a,k)},g.appDuration):"undefined"!=typeof g.appCallback&&g.appCallback(a,k)});return k}}};u.externFunctionSrvc=u.jo;u.jo.$inject=["$rootScope","$translate","$q","$log","$timeout"];
function Fy(a,b){return{getFromServer:function(){var c=this,d=a.defer();z({method:"GET",url:c.web_server_name+"/"+c.services_alias+"/vitis/properties",scope:b,success:function(a){delete a.data.status;for(var b=0,e=Object.keys(a.data);b<e.length;)c[e[b]]=a.data[e[b]],b++;c.session_token=sessionStorage.session_token;u.gl("properties_loaded");d.resolve()}});return d.promise}}}Fy.$inject=["$q","$rootScope"];function Gy(a,b,c,d){return{getFormData:function(b,c,d){null!=d||(d={});var e=null!=d.oFormValues?d.oFormValues:a.oFormValues,f=null!=d.aParamsToSave?d.aParamsToSave:[],g,p,t,v=(null!=d.oFormDefinition?d.oFormDefinition:a.oFormDefinition)[b].rows,w=e[b],x,y,F=0;for(d={};F<v.length;){g=v[F].fields;for(y=0;y<g.length;){if("undefined"!=typeof g[y])switch(g[y].type){case "upload":case "file_wsdata":case "image_wsdata":null!=document.getElementById(g[y].id)&&(x=!0,p=document.getElementById(g[y].id).files,
null!=p?0<p.length?(d[g[y].name]=p[0],null!=g[y].width&&null!=g[y].height&&(d[g[y].name+"_width"]=g[y].width,d[g[y].name+"_height"]=g[y].height)):x=!1:x=!1,x||(x=w[g[y].name],null!=x&&null!=x.aFiles&&null!=x.aFiles[0]&&(d[g[y].name]=x.aFiles[0],null!=g[y].width&&null!=g[y].height&&(d[g[y].name+"_width"]=g[y].width,d[g[y].name+"_height"]=g[y].height))));break;case "double_select":p=w[g[y].name];if("undefined"!=typeof p){x=0;for(t=[];x<p.options.length;)t.push(p.options[x].value),x++;d[g[y].name]=t.join("|")}break;
case "select":case "editable_select":null!=w[g[y].name]&&"undefined"!=typeof w[g[y].name].selectedOption&&(x=w[g[y].name].selectedOption.value,"undefined"!=typeof x&&"?"!=x&&(d[g[y].name]=x));break;case "list":if(null!=w[g[y].name]&&(p=w[g[y].name].selectedOption,q(p))){t=[];for(x=0;x<p.length;x++)null!=p[x].value&&"?"!=p[x].value&&t.push(p[x].value);d[g[y].name]=t.join("|")}break;case "title":case "subtitle":case "label":case "button":break;default:"undefined"!=typeof w&&null!=w[g[y].name]&&(d[g[y].name]=
w[g[y].name])}y++}F++}if(!0===c)for(c=d,x=0;x<f.length;x++)null!=c[f[x]]||null!=e[b][f[x]]&&(c[f[x]]=e[b][f[x]]);else for(c=new FormData,b=Object.keys(d),x=0;x<b.length;)c.append(b[x],d[b[x]]),x++;return c},setWebServiceSelectOptions:function(e,f){d.setWebServiceSelectOptions(e,f,a.oFormValues,b,c.token)},setSelectOptions:function(b,c){d.setSelectOptions(b,c,a.oFormValues)},extractFormDefinitionInfos:function(){d.extractFormDefinitionInfos(a.oFormDefinition[a.sFormDefinitionName].name)},clearFormData:function(){},
reloadSelectField:function(b,c){d.reloadSelectField(b,c,a.oFormValues,a.oFormDefinition)},getFormElementDefinition:function(b,c){return d.getFormElementDefinition(b,c,a.oFormDefinition)},getAllFormElementDefinition:function(b){return d.getAllFormElementDefinition(b,a.oFormDefinition)},setWebServiceTags:function(b,c){d.setWebServiceTags(b,c,a.oFormValues)},checkFormModifications:function(a){return d.checkFormModifications(a)},checkStudioFormModifications:function(a){return d.checkStudioFormModifications(a)}}}
Gy.$inject=["envSrvc","propertiesSrvc","sessionSrvc","formReaderService"];var Hy="ui.grid ui.grid.selection ui.grid.pagination ui.grid.moveColumns ui.grid.resizeColumns ui.grid.exporter pascalprecht.translate angular.bind.notifier formReader".split(" "),Hy=Hy.concat(vy.vitisModuleDependencies);u.module=angular.module("vitisApp",Hy);u.module.service("sessionSrvc",Cy);u.module.service("envSrvc",Dy);u.module.service("modesSrvc",Ey);u.module.value("userSrvc",u.SK);u.module.service("externFunctionSrvc",u.jo);u.module.service("propertiesSrvc",Fy);
u.module.service("formSrvc",Gy);
u.config=function(a,b,c,d,e,f,g){var h=!1;u.on("properties_loaded",function(){h=angular.element(u.Pb).injector().get(["propertiesSrvc"]).debug_mode});d.debugEnabled(!0);g.decorator("$log",["$delegate",function(a){return{error:function(b){a.error(b)},info:function(b){h&&a.info(b)},log:function(b){h&&a.log(b)},warn:function(b){a.warn(b)}}}]);b.useLoader("$translatePartialLoader",{urlTemplate:"{part}/lang-{lang}.json"});c.addPart("lang");b.preferredLanguage("fr");u.compileProvider=e;a.interceptors.push(function(){return{request:function(a){-1==
a.url.indexOf("ui-grid/")&&("undefined"==typeof a.params?a.params={vitis_version:oClientProperties.build}:a.params.vitis_version=oClientProperties.build);"true"==sessionStorage.ajaxLoader&&cd();var b=parseInt(sessionStorage.loading_counter);b++;sessionStorage.loading_counter=b;return a},response:function(a){if(typeof("object"==a.data)&&"undefined"!=typeof a.data.errorCode){dd();var b=angular.element(u.Pb).injector().get(["sessionSrvc"]),c=angular.element(u.Pb).injector().get(["externFunctionSrvc"]),
d={className:"modal-danger",buttons:{ok:{label:"OK",className:"btn-default"}},callback:function(){b.disconnect()}},e="";switch(a.data.errorCode){case 15:d.message="EXPIRED_TOKEN_ERROR";e="EXPIRED_TOKEN_ERROR_TITLE";break;case 16:d.message="INVALID_TOKEN_ERROR",e="INVALID_TOKEN_ERROR_TITLE"}n(d.message)&&c.modalWindow("alert",e,d)}else c=parseInt(sessionStorage.loading_counter),0<c?c--:c=0,sessionStorage.loading_counter=c,0==c&&dd();return a},requestError:function(a){console.error("requestError",a);
return a},responseError:function(a){console.error("responseError",a);dd();return a}}});"true"==sessionStorage.debug&&g.decorator("$exceptionHandler",["$delegate",function(a){return function(b,c){a(b,c);var d=angular.element(u.Pb).injector().get(["envSrvc"]);c=angular.element(u.Pb).injector().get(["externFunctionSrvc"]);d={className:"modal-danger modal-error-log",message:"<div>"+("<b>Mode: "+d.oSelectedMode.title+" / Onglet: "+d.oSelectedObject.label+"</b><br>")+b.stack.replace(/[\n\r]/g,"<br>").replace(/\t/g,
"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;")+"</div>",buttons:{ok:{label:"OK",className:"btn-default"}},callback:function(){}};c.modalWindow("alert",b.name+": "+b.message,d)}}])};u.config.$inject="$httpProvider $translateProvider $translatePartialLoaderProvider $logProvider $compileProvider $controllerProvider $provide $injector".split(" ");u.module.config(u.config);function Iy(){}pa("formReader",Iy);Iy.module=angular.module("formReader",["angular.bind.notifier"]);Iy.module=Iy.module;Iy.controller={};Iy.controller.VL={};
function Jy(a,b,c,d,e){c.info("formReader.formReaderController");var f=this;this.b=a;this.Ja=b;this.da=c;this.Fd=d;this.un=[];a.oFormValues=n(a.oFormValues)?a.oFormValues:{};a.oFormDefinition=n(a.oFormDefinition)?a.oFormDefinition:{};a.sFormDefinitionName=n(a.sFormDefinitionName)?a.sFormDefinitionName:"";this.Xo();a.sFormUniqueName=Date.now();a.iDisplayedTab=0;"undefined"==typeof e.oFormPromises&&(e.oFormPromises={});e.oFormPromises[a.sFormDefinitionName]=[];var g=e.$on("formDefinitionLoaded",function(){f.ey();
g()})}Iy.formReaderController=Jy;Jy.$inject=["$scope","$q","$log","formReaderService","$rootScope"];Iy.module.controller("AppFormReaderController",Jy);
Jy.prototype.Xo=function(){if(null!=this.b.oFormDefinition&&null!=this.b.sFormDefinitionName&&null!=this.b.oFormDefinition[this.b.sFormDefinitionName]&&null==this.b.oFormDefinition[this.b.sFormDefinitionName].tabs){var a=this.b.oFormDefinition[this.b.sFormDefinitionName],b=[];if(null!=a.rows){for(var c=0;c<a.rows.length;c++)if(null!=a.rows[c].fields)for(var d=0;d<a.rows[c].fields.length;d++)if(null!=a.rows[c].fields[d].name)b.push(a.rows[c].fields[d].name);else if(null!=a.rows[c].fields[d].buttons)for(var e=
0;e<a.rows[c].fields[d].buttons.length;e++)null!=a.rows[c].fields[d].buttons[e].name&&b.push(a.rows[c].fields[d].buttons[e].name);this.b.oFormDefinition[this.b.sFormDefinitionName].tabs={position:"top",list:[{label:"Tab 0",elements:b}]}}}};Jy.prototype.initFormTabs=Jy.prototype.Xo;
Jy.prototype.ey=function(){var a=this;this.Xo();this.Kq(!1);setTimeout(function(){var b=a.b.oFormDefinition,c=a.b.sFormDefinitionName;if(null==b||null==c||null==b[c])return 0;var d=b[c].initEvent;setTimeout(function(){null!=b[c].initEvent&&a.Fd.isFunctionCall(d)&&a.Fd.callFunction(d);setTimeout(function(){a.lo()})})});this.b.$broadcast("loadForm")};Jy.prototype.loadForm=Jy.prototype.ey;Jy.prototype.dj=function(){this.Xo();this.b.$broadcast("$$rebind::refresh")};Jy.prototype.refreshForm=Jy.prototype.dj;
Jy.prototype.cJ=function(a){this.da.log("formReader.formReaderController.prototype.setFormDefinition");this.b.oFormDefinition=a;this.Fd.oFormDefinition=a;this.dj()};Jy.prototype.setFormDefinition=Jy.prototype.cJ;Jy.prototype.dJ=function(a){this.da.log("formReader.formReaderController.prototype.setFormValues");this.b.oFormValues=a;this.Fd.oFormValues=a};Jy.prototype.setFormValues=Jy.prototype.dJ;
Jy.prototype.$I=function(a){this.da.log("formReader.formReaderController.prototype.setDefinitionName");this.b.sFormDefinitionName=a;this.Fd.sFormDefinitionName=a};Jy.prototype.setDefinitionName=Jy.prototype.$I;Jy.prototype.gK=function(a){console.log(a)};Jy.prototype.toTest=Jy.prototype.gK;
Jy.prototype.Kq=function(a,b){this.da.log("formReader.formReaderController.prototype.useDefaultValues");var c=this.b,d=c.oFormValues,e=c.oFormDefinition,c=c.sFormDefinitionName;if(null==d||null==e||null==c||null==e[c])return 0;e=e[c].rows;if(null==e)return 0;for(var f=0;f<e.length;f++)if(null!=e[f].fields)for(var g=0;g<e[f].fields.length;g++)if("bo_grid"!==e[f].fields[g].type&&"ui_grid"!==e[f].fields[g].type&&"section_grid"!==e[f].fields[g].type){var h;try{h=angular.copy(e[f].fields[g])}catch(t){console.error("try angular.copy failed");
continue}if(null==b||h.name===b){null!=h.default_value&&""!==h.default_value&&this.Fd.isFunctionCall(h.default_value)&&(h.default_value=this.Fd.callFunction(h.default_value));if("select"===h.type||"editable_select"===h.type)null!=h.default_value&&""!==h.default_value&&(h.default_value={value:h.default_value});else if(("list"===h.type||"double_select"===h.type)&&null!=h.default_value&&""!==h.default_value){for(var k=h.default_value.split("|"),m=[],p=0;p<k.length;p++)m.push({value:k[p]});h.default_value=
m}this.fB(h,a)&&("select"===h.type||"editable_select"===h.type||"list"===h.type?(null!=d[c][h.name]||(d[c][h.name]={}),d[c][h.name].selectedOption=h.default_value):"double_select"===h.type?(null!=d[c][h.name]||(d[c][h.name_to]={}),d[c][h.name_to].selectedOption=h.default_value):"editable_double_select"===h.type?(null!=d[c][h.name]||(d[c][h.name_available_tags]={}),d[c][h.name_available_tags].selectedOption=h.default_value):d[c][h.name]=h.default_value);delete h}}};Jy.prototype.useDefaultValues=Jy.prototype.Kq;
Jy.prototype.fB=function(a,b){this.da.log("formReader.formReaderController.prototype.useDefaultValue");var c=this.b,d=c.oFormValues,c=c.sFormDefinitionName;if(n(a.default_value)&&""!==a.default_value){if(!0===b)return!0;if("select"===a.type){if(null==d[c][a.name]||null==d[c][a.name].selectedOption||null==d[c][a.name].selectedOption.value||0===d[c][a.name].selectedOption.value.length)return!0}else if("editable_select"===a.type){if(null==d[c][a.name]||null==d[c][a.name].selectedOption||null==d[c][a.name].selectedOption.value||
0===d[c][a.name].selectedOption.value.length)return!0}else if("list"===a.type){if(null==d[c][a.name]||!q(d[c][a.name].selectedOption)||0===d[c][a.name].selectedOption.length||0===d[c][a.name].selectedOption[0].value.length)return!0}else if("double_select"===a.type){if(null==d[c][a.name_to]||!q(d[c][a.name_to].selectedOption)||0===d[c][a.name_to].selectedOption.length||0===d[c][a.name_to].selectedOption[0].value.length)return!0}else if("editable_double_select"===a.type){if(null==d[c][a.name_available_tags]||
!q(d[c][a.name_available_tags].selectedOption)||0===d[c][a.name_available_tags].selectedOption.length||0===d[c][a.name_available_tags].selectedOption[0].value.length)return!0}else if(null==d[c][a.name]||0===d[c][a.name].length)return!0}else return!1};Jy.prototype.useDefaultValue=Jy.prototype.fB;
Jy.prototype.lo=function(){this.da.log("formReader.formReaderController.prototype.extractFormDefinitionInfos");if(!n(this.b.oFormDefinition))return console.error("$scope['oFormDefinition'] not defined"),0;this.b.$broadcast("extractFormDefinitionInfos");var a=this.b.oFormDefinition[this.b.sFormDefinitionName],b=this.b.oFormValues[this.b.sFormDefinitionName],c=this.b.oFormDefinition.datasources,d,e=this;null!=this.b.$root.oFormPromises[this.b.sFormDefinitionName]||(this.b.$root.oFormPromises[this.b.sFormDefinitionName]=
[]);var f=this.Ja.defer();this.b.$root.oFormPromises[this.b.sFormDefinitionName].push(f.promise);for(var g=0;g<e.un.length;g++)e.un[g]();e.un.length=0;if(n(a)&&n(a.rows))for(g=0;g<a.rows.length;g++)for(var h=0;h<a.rows[g].fields.length;h++){var k=a.rows[g].fields[h];d=b[k.name];"undefined"===typeof k.id&&"undefined"!==typeof k.name&&(k.id=this.b.sFormDefinitionName+"_"+k.name);switch(k.type){case "select":case "editable_select":case "list":case "double_select":k.id_from=k.id+"_from";var m=null,p=
null;n(k.datasource)&&n(k.datasource.datasource_id)&&n(c)&&n(c[k.datasource.datasource_id])&&("web_service"===c[k.datasource.datasource_id].type?m=Ky(k,c):"object"===c[k.datasource.datasource_id].type&&(p=Ly(k,c)));n(k.web_service)&&(m=angular.copy(k.web_service));if(null!=k.options)var t=k.options;null!=p&&(t=p);null!=m?(m=angular.copy(m),!1!==m.load_first_time?(n(m.parents)&&My(this,k,m,b),Ny(b,m.parents,!0)&&this.Fd.setWebServiceSelectOptions(k,this.b.sFormDefinitionName,this.b.oFormValues,m),
delete m):"undefined"!==typeof m.callback&&e.Fd.isFunctionCall(m.callback)&&e.Fd.callFunction(m.callback)):n(t)?this.Fd.setSelectOptions(k,this.b.sFormDefinitionName,this.b.oFormValues,t):"object"!==typeof d&&(b[k.name]="select"===k.type||"editable_select"===k.type?{selectedOption:{value:d},options:[]}:{selectedOption:[{value:d}],options:[]});break;case "editable_double_select":k.name_available_tags=k.name+"_available",k.id_available_tags=k.id+"_available","undefined"!==typeof k.web_service&&this.Fd.setWebServiceTags(k,
this.b.sFormDefinitionName,this.b.oFormValues)}delete k}this.Ja.all(this.b.$root.oFormPromises[this.b.sFormDefinitionName]).then(function(){setTimeout(function(){e.b.$root.$emit("formExtracted",e.b.sFormDefinitionName)});if(null!=a){var b=a.name,c=angular.element("form[name='"+b+"']");0<c.length&&(c=c.scope(),null!=c[b]&&c[b].$setPristine())}});f.resolve()};Jy.prototype.extractFormDefinitionInfos=Jy.prototype.lo;
function My(a,b,c,d){c.parameters.original_filter=null!=c.parameters.filter?c.parameters.filter:"";for(var e=0;e<c.parents.length;e++){var f=c.parents[e].filter_attr,g=c.parents[e].filter_equality,h=n(c.parents[e].name_to)?c.parents[e].name_to:c.parents[e].name,k=angular.copy("oFormValues."+a.b.sFormDefinitionName+"."+h+".selectedOption");setTimeout(function(b){var c=angular.bind({Vr:b.Vr,tt:b.tt,Zw:b.Zw,$w:b.$w,Ou:b.Ou},function(){var b=this.Vr,c=this.tt,e=d[this.Ou],f;if(null==e||null==e.selectedOption)return 0;
if(q(e.selectedOption)){if(0===e.selectedOption.length)return 0}else if(null==e.selectedOption.value)return 0;e=Ny(d,c.parents);null!=a.b.oFormValues&&null!=a.b.oFormValues[a.b.sFormDefinitionName]&&null!=a.b.oFormValues[a.b.sFormDefinitionName][b.name]&&null!=a.b.oFormValues[a.b.sFormDefinitionName][b.name].selectedOption&&(f=angular.copy(a.b.oFormValues[a.b.sFormDefinitionName][b.name].selectedOption));a.Fd.emptySelectOptions(b,a.b.sFormDefinitionName,a.b.oFormValues);if(e){var e=c.parameters,g=
c.parents,h=c.parameters.original_filter,k={relation:"AND",operators:[]},g=null!=g?g:[];null!=h&&""!==h.trim()||(h={relation:"AND",operators:[]});for(var p=0;p<g.length;p++)if(n(d[g[p].name])&&n(d[g[p].name].selectedOption)){if(!n(d[g[p].name].selectedOption.value)){if(!q(d[g[p].name].selectedOption))continue;if(1>d[g[p].name].selectedOption.length)continue}var m=[];!q(d[g[p].name].selectedOption)&&n(d[g[p].name].selectedOption.value)?m.push(d[g[p].name].selectedOption):m=d[g[p].name].selectedOption;
for(var N=g[p].filter_attr,P=g[p].filter_equality,K={relation:"OR",operators:[]},G=0;G<m.length;G++){var ba=m[G].value;null==ba||r(ba)&&0< !ba.length||(K.operators.push({column:N,compare_operator:P,value:ba}),delete ba)}0!==K.operators.length&&(k.operators.push(K),delete m,delete N,delete P,delete K)}delete p;0<k.operators.length&&h.operators.push(k);e.filter=h;a.da.log({"filter: ":angular.copy(c.parameters.filter)});a.Fd.setWebServiceSelectOptions(b,a.b.sFormDefinitionName,a.b.oFormValues,c,f)}},
!0);c();a.un.push(a.b.$watch(b.KI,c))},1E3,{KI:k,Vr:b,tt:c,Zw:f,$w:g,Ou:h});delete f;delete g;delete k}}
function Ky(a,b){if(!n(a.datasource.id_key)||!n(a.datasource.label_key))return null;b=angular.copy(b[a.datasource.datasource_id]);b.id_key=a.datasource.id_key;b.label_key=a.datasource.label_key;b.parameters=n(b.parameters)?b.parameters:{};n(a.datasource.parents)&&(b.parents=a.datasource.parents);n(a.datasource.filter)&&(b.parameters.filter=a.datasource.filter);n(a.datasource.distinct)&&(b.parameters.distinct=a.datasource.distinct);n(a.datasource.attributs)&&(b.parameters.attributs=a.datasource.attributs);
n(a.datasource.order_by)&&(b.parameters.order_by=a.datasource.order_by);n(a.datasource.sort_order)&&(b.parameters.sort_order=a.datasource.sort_order);return b}
function Ly(a,b){var c=[];if(n(b[a.datasource.datasource_id].data)&&n(a.datasource.id_key)&&n(a.datasource.label_key)){var d=a.datasource.id_key,e=a.datasource.label_key,f=b[a.datasource.datasource_id].data;n(d)||console.error("id_key not defined (required in for data json source)");n(e)||console.error("label_key not defined (required in for data json source)");if(n(d)&&n(e))for(var g=0;g<f.length;g++)c.push(f[g][e]+"|"+f[g][d]);delete d;delete e;delete f}n(b[a.datasource.datasource_id].options)&&
(c=b[a.datasource.datasource_id].options);return c}
function Ny(a,b,c){var d=!0;if(null==a)return console.error("formReader.formReaderController.prototype.areParentsReady: oFormValues not defined"),!1;if(null==b||q(b)&&0===b.length)return!0;for(var e=0;e<b.length;e++)if("false"!==b[e].wait_for_parent&&!1!==b[e].wait_for_parent){if(!0===c)return!1;if(null!=a[b[e].name])if(null!=a[b[e].name].selectedOption){if(q(a[b[e].name].selectedOption)){if(0===a[b[e].name].selectedOption.length){d=!1;continue}if(0===a[b[e].name].selectedOption[0].value.length){d=
!1;continue}}q(a[b[e].name].selectedOption)||(null!=a[b[e].name].selectedOption.value?0===a[b[e].name].selectedOption.value.length&&(d=!1):d=!1)}else d=!1;else d=!1}return d}
Jy.prototype.Dg=function(a,b){a=n(a)?a:"";if(b=n(b)?b:!1)return this.mh(a);a=a.replace(",",".");var c=a.split(".");if(0===c.length)return NaN;if(1===c.length)return"."===a.charAt(a.length-1)?this.mh(a)+".":this.mh(a);if(2<=c.length){b=this.mh(c[0]);if(2===c.length){if(""===c[1])return this.mh(a)+".";c=this.mh(c[1])}else{a="";for(var d=1;d<c.length;d++)a+=c[d];c=this.mh(a)}return parseFloat(b+"."+c)}return NaN};Jy.prototype.numberParser=Jy.prototype.Dg;
Jy.prototype.mh=function(a){for(var b="",c=0;c<a.length;c++){var d=a.charAt(c);isNaN(parseInt(d))||(b+=d)}return parseInt(b)};Jy.prototype.integerParser=Jy.prototype.mh;ey.sL={};
ey.cv=function(a){return{restrict:"A",controller:"AppMapWorkbenchController",controllerAs:"ctrl",templateUrl:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/"+sessionStorage.appEnv+"/javascript/externs/formReader/component/map_workbench/map_workbench.html",compile:function(){return{pre:function(a){var b=[{name:"map_workbench_index",visible:!1}];if(q(a.field.attributes_def))for(var d=0;d<a.field.attributes_def.length;d++)b.push({name:a.field.attributes_def[d].name,displayName:a.field.attributes_def[d].label});
a.gridOptions={enableSorting:!0,enableRowSelection:!0,enableSelectAll:!0,multiSelect:!1,columnDefs:b,data:[]};a.featureForm={draw:{symbol:"fa-home",color:"red",outline_color:"white",size:4,dash:20},text:{text:"",size:14,font:"Arial",color:"white",outline_color:"black",outline_size:1,offsetX:0,offsetY:10,rotation:0},attributes:{}};a.aIcons=[];a.olSelectedFeature=null;a.sSelectedFeatureType=null;a.bFormDisabled=!0;a.aFeatures=[];a.custom_form=null;a.oSubformScope=null;var e=Date.now(),f=null;a.clearSelectedFeature=
function(b){a.olSelectedFeature=null;null!=a.oMap.oa&&fa(a.oMap.oa.wa)&&null!=a.oMap.oa.wa()&&(a.oMap.oa.wa().clear(),b&&a.oMap.aa.Ig(a.oMap.oa));f=null;a.gridApi.selection.clearSelectedRows()};a.closeModal=function(a){$(a).modal("hide")};a.gridOptions.onRegisterApi=function(b){a.gridApi=b;a.gridApi.selection.on.rowSelectionChanged(a,function(b){if(e+100>Date.now())return null;e=Date.now();for(var c=null,d=0;d<a.aFeatures.length;d++)if(a.aFeatures[d].get("attributes").map_workbench_index===b.entity.map_workbench_index){c=
a.aFeatures[d];break}if(null!=f&&f===b.entity.map_workbench_index)return a.clearSelectedFeature(!0),null;f=b.entity.map_workbench_index;if(null!=a.oMap.oa&&fa(a.oMap.oa.get)&&"select"===a.oMap.oa.get("type")&&(d=a.oMap.oa.wa().R(),q(d)&&0<d.length&&(d=d[0].get("attributes"),null!=d&&d.map_workbench_index===b.entity.map_workbench_index)))return null;a.oMap.activeInteraction("select",!0);a.oMap.oa.wa().push(c);setTimeout(function(){a.oMap.oa.Or()})})}},post:function(b,c){function d(){b.oSubformScope=
b.getSubFormScope();b.oSubformScope.loadSubForm({sFormDefinitionName:"update",oFormDefinition:b.field.custom_form.form,oFormValues:{update:{}},oProperties:b.oProperties});var a=angular.element(u.f).injector().get(["formSrvc"]);null!=b.oSubformScope&&null!=b.oSubformScope.oSubformValues&&b.$watch("oSubformScope.oSubformValues",function(c,d){c=a.getFormData("update",!0,{oFormDefinition:b.field.custom_form.form,oFormValues:ib(c)});d=a.getFormData("update",!0,{oFormDefinition:b.field.custom_form.form,
oFormValues:ib(d)});var e=b.field.custom_form.featureStructure.field,f=b.field.custom_form.featureStructure.types,g=c[e],e=d[e];if(null!=g&&e&&g!==e&&null!=f[g]&&f[e]&&f[g].geometryType!==f[e].geometryType)return $.notify("Ce type est incompatible avec la g\u00e9om\u00e9trie s\u00e9lectionn\u00e9e","error"),b.oSubformScope.setFormValues({update:d}),null;kb(b.featureForm.attributes,c);null!=b.olSelectedFeature&&Oy(b.ctrl,b.olSelectedFeature)},!0)}function e(){n(b.oMap)&&(b.oMap.aa.Dh(null),delete b.oMap);
null!=b.field.custom_form&&Py(b.ctrl);b.oMap=new Y({target:$(c).find(".form-map")[0],options:b.field.map_options,hiddenFieldId:b.field.id,oFormValues:b.oFormValues[b.sFormDefinitionName],sFormName:b.field.name,oProj:b.$root.proj});ny(b.oMap,function(a){b.$applyAsync(function(){b.olSelectedFeature=a})});oy(b.oMap,function(a){if(!q(a))return null;b.aFeatures=a;a=b.ctrl;a.da.info("MapWorkbenchController.fillGridFromFeatures_");var c=a.b.aFeatures,d=[],e;if(q(c))for(var f=0;f<c.length;f++)e=null!=c[f].get("attributes")?
c[f].get("attributes"):{},e.map_workbench_index=angular.copy(f),c[f].set("attributes",e),d.push(e);a.b.gridOptions.data=d;a.b.gridApi.grid.refresh()});py(b.oMap,function(a){setTimeout(function(){b.olSelectedFeature=a;b.oMap.activeInteraction("select");b.oMap.oa.wa().push(a);setTimeout(function(){b.oMap.oa.Or();Py(b.ctrl)})})});setTimeout(function(){jy(b.oMap)})}b.getSubFormScope=function(){return angular.element("#map_workbench_"+b.sFormUniqueName+"_subform").scope()};setTimeout(function(){e();b.$watch("field.nb_cols",
function(){a(function(){b.oMap.aa.zd()})});b.$watch("field.style",function(){a(function(){b.oMap.aa.zd()})},!0);b.$watch("oMap.bLayersTreeOpen",function(){a(function(){b.oMap.aa.zd()})},!0);b.$on("studio resized",function(){b.oMap.aa.zd()});b.$on("updateMap",function(a,c){switch(c){case "center":b.oMap.setCenter([b.field.map_options.center.coord[0],b.field.map_options.center.coord[1]]);break;case "zoom":b.oMap.setZoom(b.field.map_options.center.zoom);break;case "source":b.oMap.setBingSource(b.field.map_options.source);
break;case "extent":b.oMap.setExtent(b.field.map_options.center.extent);break;case "controls":b.oMap.setControls(b.field.map_options.controls);break;case "interact":b.oMap.setInteractions(b.field.map_options.interactions);break;case "proj":a=b.oMap.getExtent();c=b.oMap.getCenter();var d=b.oMap.getProj();b.field.map_options.center.extent=b.oMap.transformExtent(a,d,b.field.map_options.proj);b.field.map_options.center.coord=b.oMap.transformer(c,d,b.field.map_options.proj);e();break;default:e()}})});
setTimeout(function(){null!=b.field.custom_form&&null!=b.field.custom_form.form&&(kb(b.field.custom_form,b.oFormValues[b.sFormDefinitionName].custom_form),d())})}}}}};ey.cv.$inject=["$timeout"];Iy.module.directive("appMapWorkbench",ey.cv);ey.hC=function(){return{scope:{model:"="},link:function(a,b){$(b).colorpicker({format:"hex"});var c;$(b).on("changeColor",function(){clearTimeout(c);c=setTimeout(function(){a.model=$(b).colorpicker("getValue");a.$parent.$apply()},100)})}}};
Iy.module.directive("appColorpicker",ey.hC);
ey.Se=function(a,b){b.info("MapWorkbenchController");var c=this;this.da=b;this.b=a;var d=Date.now(),e=Date.now();a.$watch("featureForm",function(){if(d+50>Date.now())return null;d=Date.now();if(null==c.b.oMap||null==c.b.oMap.wc||null==c.b.olSelectedFeature)return 0;Qy(c);Ry(c);setTimeout(function(){jy(c.b.oMap)})},!0);a.$watch("olSelectedFeature",function(){if(e+200>Date.now())return null;e=Date.now();a.bFormDisabled=null!=a.olSelectedFeature?!1:!0;if(null!=a.olSelectedFeature)switch(c.b.olSelectedFeature.j().K()){case "Point":case "MultiPoint":c.b.sSelectedFeatureType=
"Point";break;case "LineString":case "MultiLineString":c.b.sSelectedFeatureType="Line";break;case "Polygon":case "MultiPolygon":c.b.sSelectedFeatureType="Polygon";break;default:c.b.sSelectedFeatureType=null}if(null!=a.olSelectedFeature){var b=null!=a.olSelectedFeature.get("attributes")?a.olSelectedFeature.get("attributes"):{};a.featureForm.attributes=b;if(null!=a.oSubformScope){var d=a.field.custom_form.featureStructure.field,h=a.field.custom_form.featureStructure.types,k=angular.copy(a.field.custom_form.form);
if(null!=b[d]&&null!=h[b[d]]&&q(h[b[d]].disableAttrs))for(d=h[b[d]].disableAttrs,h=0;h<k.update.rows.length;h++)for(var m=0;m<k.update.rows[h].fields.length;m++)-1!==d.indexOf(k.update.rows[h].fields[m].name)&&(k.update.rows[h].fields[m].visible=!1);a.oSubformScope.loadSubForm({sFormDefinitionName:"update",oFormDefinition:k,oFormValues:{update:angular.copy(b)},oProperties:a.oProperties})}b=a.olSelectedFeature.ts();null!=b.draw&&(a.featureForm.draw=b.draw);null!=b.text&&(a.featureForm.text=b.text)}else a.featureForm.attributes=
{},null!=a.oSubformScope&&a.oSubformScope.setFormValues({update:{}});null!=a.olSelectedFeature?(b=a.aFeatures.indexOf(a.olSelectedFeature),c.b.gridApi.selection.clearSelectedRows(),c.b.gridApi.selection.selectRowByVisibleIndex(b)):a.clearSelectedFeature(!1)});Sy(this)};ey.Se.$inject=["$scope","$log"];Iy.module.controller("AppMapWorkbenchController",ey.Se);
function Sy(a){a.da.info("MapWorkbenchController.loadIconsList_");var b=gr.prototype.jg.vs,c=gr.prototype.jg.fonts,d=[],e,f;for(f in b)null!=b[f].font&&null!=c[b[f].font]!=null&&(e="",null!=c[b[f].font].prefix!=null&&(e+=c[b[f].font].prefix,e+=" "),e+=f,d.push({def:f,"class":e}));a.b.$applyAsync(function(a){a.aIcons=d;a.sSelectedIcon=d[0]["class"];a.featureForm.draw.symbol=d[0].def})}
function Qy(a){a.da.info("MapWorkbenchController.updateFeatureStyleFromForm_");a.b.olSelectedFeature.gu(a.b.featureForm)}function Ry(a){a.da.info("MapWorkbenchController.updateFeatureAttributes_");a.b.olSelectedFeature.set("attributes",a.b.featureForm.attributes)}
ey.Se.prototype.tJ=function(){this.da.info("MapWorkbenchController.showAddFeatureModal");for(var a=this,b=this.b.field.custom_form.featureStructure.field,c=angular.copy(this.b.field.custom_form.form),d=!1,e=0;e<c.update.rows.length;e++)for(var f=0;f<c.update.rows[e].fields.length;f++)c.update.rows[e].fields[f].name!==b&&(c.update.rows[e].fields[f].visible=!1,d=!0);if(!d)return console.error("Field "+b+" not present in the form"),null;angular.element("#map_workbench_"+this.b.sFormUniqueName+"_feature_type_modal_subform").scope().loadSubForm({sFormDefinitionName:"update",
oFormDefinition:c,oFormValues:{update:{}},oProperties:this.b.oProperties});this.b.clearSelectedFeature();setTimeout(function(){$("#map_workbench_"+a.b.sFormUniqueName+"_feature_type_modal").modal("show")})};ey.Se.prototype.showAddFeatureModal=ey.Se.prototype.tJ;
ey.Se.prototype.Gc=function(){this.da.info("MapWorkbenchController.addFeature");var a=this,b=angular.element(u.f).injector().get(["formSrvc"]),c=this.b.field.custom_form.featureStructure.field,d=this.b.field.custom_form.featureStructure.types,e=angular.copy(this.b.field.custom_form.form),f=angular.element("#map_workbench_"+this.b.sFormUniqueName+"_feature_type_modal_subform").scope(),g=b.getFormData("update",!0,{oFormDefinition:e,oFormValues:ib(f.oSubformValues)}),b=null;null!=g[c]&&null!=d[g[c]]&&
(b=null!=d[g[c]].geometryType?d[g[c]].geometryType:"all");qy(this.b.oMap,function(b){setTimeout(function(){var d=b.get("attributes"),d=ha(d)?d:{};d[c]=g[c];b.set("attributes",d);setTimeout(function(){Oy(a,b)})})});Py(this);null!=b?(Ty(this,b),$("#map_workbench_"+this.b.sFormUniqueName+"_feature_type_modal").modal("hide")):$.notify("Veuillez s\u00e9lectionner un type","error")};ey.Se.prototype.addFeature=ey.Se.prototype.Gc;
ey.Se.prototype.lD=function(){this.da.info("MapWorkbenchController.deleteSelectedFeature");var a=this;if(null==this.b.olSelectedFeature)return $.notify("Aucune g\u00e9o\u00e9trie s\u00e9lectionn\u00e9e","error"),null;bootbox.confirm("Supprimer d\u00e9finitivement la g\u00e9om\u00e9trie ?",function(b){b&&(a.b.oMap.fc(a.b.olSelectedFeature),a.b.olSelectedFeature=null,setTimeout(function(){jy(a.b.oMap)}))})};ey.Se.prototype.deleteSelectedFeature=ey.Se.prototype.lD;
function Oy(a,b){a.da.info("MapWorkbenchController.setStyleFromType_");if(null!=b){var c=a.b.field.custom_form.featureStructure.field,d=a.b.field.custom_form.featureStructure.types;b=b.get("attributes");if(null!=b[c]&&null!=d[b[c]]&&null!=d[b[c]].style){var c=angular.copy(d[b[c]].style),e;for(e in c)for(var f in c[e])r(c[e][f])&&"{{"===c[e][f].substr(0,2)&&"}}"===c[e][f].substr(-2,2)&&(d=c[e][f].substr(2,c[e][f].length-4),c[e][f]=null!=b[d]?b[d]:"");a.b.featureForm.draw=c.draw;a.b.featureForm.text=
c.text}}}
function Ty(a,b){a.da.info("MapWorkbenchController.activeDrawInteraction_");switch(b){case "all":a.b.field.map_options.interactions.point=!0;a.b.field.map_options.interactions.line=!0;a.b.field.map_options.interactions.polygon=!0;break;case "point":a.b.field.map_options.interactions.point=!0;break;case "line":a.b.field.map_options.interactions.line=!0;break;case "polygon":a.b.field.map_options.interactions.polygon=!0;break;default:console.error("Bad sGeometryType: ",b);return}a.b.oMap.setInteractions(a.b.field.map_options.interactions);"point"!==
b&&"line"!==b&&"polygon"!==b||a.b.oMap.activeInteraction(b)}function Py(a){a.da.info("MapWorkbenchController.unactiveDrawInteractions_");for(var b="point line polygon DP DL DPol RA remove_all RO remove".split(" "),c=0;c<b.length;c++)null!=a.b.oMap&&null!=a.b.oMap.removeInteraction&&a.b.oMap.removeInteraction(b[c]),null!=a.b.field.map_options.interactions[b[c]]&&(a.b.field.map_options.interactions[b[c]]=!1)};Iy.directive={};Iy.directive.WL={};
function Uy(a,b,c,d,e){return{restrict:"A",scope:{oProperties:"=?appProperties",oFormValues:"=?appFormValues",oFormDefinition:"=?appFormDefinition",sFormDefinitionName:"=?appFormDefinitionName",oFormEventsContainer:"=?appFormEventsContainer",wabState:"=?appWabState",wabGroup:"=?appWabGroup",showTabs:"=?appTabs"},controller:"AppFormReaderController",controllerAs:"ctrl",templateUrl:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/"+sessionStorage.appEnv+
"/javascript/externs/formReader/formReader.html",link:function(f,g){d.log("formReader.formReaderDirective.link");f.showTabs="false"===f.showTabs||!1===f.showTabs?f.showTabs=!1:f.showTabs=!0;f.wabState=null!=f.wabState&&""!==f.wabState?f.wabState:null;f.wabGroup=null!=f.wabGroup&&""!==f.wabGroup?f.wabGroup:null;f.submitButton=!1;f.oFormEventsContainer=n(f.oFormEventsContainer)?f.oFormEventsContainer:f;b.oProperties=f.oProperties;b.oFormValues=f.oFormValues;b.oFormDefinition=f.oFormDefinition;b.sFormDefinitionName=
f.sFormDefinitionName;b.oFormEventsContainer=f.oFormEventsContainer;var h=f.$root.$on("formDefinitionLoaded",function(a,b){h();null!=f.oFormDefinition&&null!=f.oFormDefinition[b]&&null!=f.oFormDefinition[b].wab&&(f.showTabs=!1,f.wabState=f.oFormValues[b].status_name,f.userGroups=[],z({method:"GET",url:c.web_server_name+"/"+c.services_alias+"/vitis/users/"+sessionStorage.user_id,scope:f,headers:{Accept:"application/x-vm-json"},success:function(a){f.userGroups=a.data.data[0].groups_label.split(",");
for(var c in f.oFormDefinition[b].wab[f.wabState])if(-1<f.userGroups.indexOf(c)){f.wabGroup=c;break}null!=f.wabGroup||console.warn("this user can't see this form")}}),null!=f.wabGroup||console.warn("this user can't see this form"))});f.isFormTextElement=function(a){return-1!=="text password datetime datetime-local date month time week integer float number email url search tel color".split(" ").indexOf(a)?!0:!1};f.sendForm=function(){d.log("scope.sendForm");if(!0===f[f.oFormDefinition[f.sFormDefinitionName].name].$valid){var c=
a.defer(),e=c.promise,g=f.oFormDefinition[f.sFormDefinitionName].beforeEvent;"undefined"!==typeof g?r(g)?a.when(b.callFunction(g)).then(function(){c.resolve()}):fa(g)&&a.when(g(f.oFormValues)).then(function(){c.resolve()}):c.resolve();e.then(function(){c=a.defer();e=c.promise;var d=f.oFormDefinition[f.sFormDefinitionName].event;"undefined"!==typeof d?r(d)?a.when(b.callFunction(d)).then(function(){c.resolve()}):fa(d)&&a.when(d(f.oFormValues)).then(function(){c.resolve()}):c.resolve();e.then(function(){var a=
f.oFormDefinition[f.sFormDefinitionName].afterEvent;"undefined"!==typeof a&&(r(a)?b.callFunction(a):fa(a)&&a(f.oFormValues))})})}};f.testElementsValidityTab=function(a){d.log("scope.testElementsValidityTab");var c=f.oFormDefinition[f.sFormDefinitionName].name;if(!0===!f[c].$valid){for(var e=b.getAllFormElementDefinition(f.sFormDefinitionName,f.oFormDefinition),g=[],h=0;h<e.length;h++)null!=e[h].name&&null!=f[c][e[h].name]&&(f[c][e[h].name].$valid||g.push(e[h].name));if(null!=g[0]&&null!=f.oFormDefinition[f.sFormDefinitionName].tabs&&
null!=f.oFormDefinition[f.sFormDefinitionName].tabs.list)for(c=f.oFormDefinition[f.sFormDefinitionName].tabs.list,h=0;h<c.length;h++)if(-1!==c[h].elements.indexOf(g[0])){f.iDisplayedTab=h;break}}null!=a&&a.call()};f.executeButtonEvent=function(a,c){d.log("scope.executeButtonEvent");r(c)?b.callFunction(c):fa(c)&&c(f.oFormValues)};f.getValidationCssClass=function(a){if("undefined"!=typeof a){var b=f.oFormDefinition[f.sFormDefinitionName].name;if("undefined"!=typeof f[b]&&"undefined"!=typeof f[b][a]&&
f[b][a].$invalid&&f[b][a].$dirty)return"has-error"}};f.switchSelectedOptions=function(a,c,e,g){d.log("scope.switchSelectedOptions");e=f.oFormValues[a][e];f.oFromSelect=e;"undefined"!==typeof c.switch_event&&b.isFunctionCall(c.switch_event)&&(r(c.switch_event)?b.callFunction(c.switch_event):fa(c.switch_event)&&c.switch_event(f.oFormValues));if(0<e.selectedOption.length){a=f.oFormValues[a][g];for(c=0;c<e.selectedOption.length;)1!=e.selectedOption[c].disabled&&a.options.unshift(e.options.splice(e.options.indexOf(e.selectedOption[c]),
1)[0]),c++;e.selectedOption=[]}};f.reloadSelectField=function(a,c){b.reloadSelectField(a,c,f.oFormValues,f.oFormDefinition)};f.isStringNotEmpty=function(a){return null==a||!r(a)||0< !a.length?!1:!0};f.getLinkFileName=function(a){if(!r(a))return"";-1!==a.lastIndexOf("/")&&(a=a.substr(a.lastIndexOf("/")+1));-1!==a.lastIndexOf("?")&&(a=a.substr(0,a.lastIndexOf("?")));return a};f.isFieldPresent=function(a,b,c){var d=!0;if(!1===a.visible||"false"===a.visible)d=!1;var e=!1;-1!==b.elements.indexOf(a.name)&&
(e=!0);!0===a.visibleAllTabs&&(e=!0);null!=a.buttons&&!1===(null!=c?c:!1)&&(e=!0);f.showTabs||(e=!0);if(this.useWab()){var g=!1;b=this.getWabField(a);if("r"===b||"rw"===b)g=!0;null!=a.buttons&&(g=!0);"r"===b&&(a.disabled=!0)}return null!=g?d&&e&&g?!0:!1:d&&e?!0:!1};f.isButtonPresent=function(a,b,c){var d=!0;if(!1===a.visible||"false"===a.visible)d=!1;var e=!1;-1!==c.elements.indexOf(a.name)&&(e=!0);!0===a.visibleAllTabs&&(e=!0);this.isFieldPresent(b,c,!0)&&(e=!0);if(this.useWab()){var f=!1;c=this.isFieldPresent(b,
c,!0)?this.getWabField(b):this.getWabField(a);if("r"===c||"rw"===c)f=!0;"r"===c&&(a.disabled=!0);""==c&&(b.visible=!1)}return null!=f?d&&e&&f?!0:!1:d&&e?!0:!1};f.getWabField=function(a){if(null!=f.wabState&&null!=f.wabGroup&&null!=f.oFormDefinition&&null!=f.oFormDefinition[f.sFormDefinitionName]&&null!=f.oFormDefinition[f.sFormDefinitionName].wab&&null!=f.oFormDefinition[f.sFormDefinitionName].wab[f.wabState]&&null!=f.oFormDefinition[f.sFormDefinitionName].wab[f.wabState][f.wabGroup]){var b=f.oFormDefinition[f.sFormDefinitionName].wab[f.wabState][f.wabGroup];
if(null!=b[a.name])return b[a.name]}return null};f.useWab=function(){var a=!1;null!=f.wabState&&null!=f.wabGroup&&null!=f.oFormDefinition&&null!=f.oFormDefinition[f.sFormDefinitionName]&&null!=f.oFormDefinition[f.sFormDefinitionName].wab&&(a=!0);return a};f.compileTemplate=function(){z({method:"GET",url:c.web_server_name+"/"+sessionStorage.appEnv+"/javascript/externs/formReader/formReader.html",scope:f,success:function(a){if(null==a.data)return console.error("template not founded"),0;a=e(a.data)(f);
g.children().replaceWith(a)}})};f.resetFileInputs=function(){$(g).find(".file").each(function(){$(this).fileinput("clear")})};f.$on("$destroy",function(){f.$root.clearFormData(f.sFormDefinitionName,f)});f.$on("loadForm",function(){f.resetFileInputs()})}}}Iy.formReaderDirective=Uy;Uy.$inject=["$q","formReaderService","propertiesSrvc","$log","$compile"];Iy.module.directive("appFormReader",Uy);
Iy.xv=function(a,b,c,d,e){return{link:function(b,g){e.log("formReader.appFormFieldSpecificParamsDrtv.link");if("undefined"!==typeof b.field.attributes)for(var f=0,k=Object.keys(b.field.attributes);f<k.length;)g[0].setAttribute(k[f],b.field.attributes[k[f]]),f++;!0===b.field.autofocus&&g[0].focus();switch(b.field.type){case "captcha":a(function(){grecaptcha.render(b.field.id,{sitekey:b.field.key,callback:function(a){b.oFormValues[b.sFormDefinitionName][b.field.name]=a}})},10);break;case "date":case "datetime":f=
{useCurrent:!1};kb(f,{date:{fr:{locale:"fr",format:"DD/MM/YYYY"},en:{format:"MM/DD/YYYY"}},datetime:{fr:{locale:"fr",format:"DD/MM/YYYY HH:mm"},en:{format:"MM/DD/YYYY HH:mm"}}}[b.field.type][c.language]);"undefined"!==typeof b.field.options&&kb(f,b.field.options);$(g).datetimepicker(f);$(g).on("dp.change",function(){b.oFormValues[b.sFormDefinitionName][g[0].name]=g[0].value});break;case "checkbox":"undefined"==typeof b.oFormValues[b.sFormDefinitionName][b.field.name]&&(b.oFormValues[b.sFormDefinitionName][b.field.name]=
"undefined"!=typeof b.field.default_value?b.field.default_value:!1);break;case "upload":g[0].addEventListener("change",function(){b.oFormValues[b.sFormDefinitionName][g[0].name]={aFiles:this.files}},!1);f={showPreview:!1,showRemove:!0,showUpload:!1};"undefined"!==typeof b.field.options&&kb(f,b.field.options);f.mainClass="input-file-"+b.oFormDefinition[b.sFormDefinitionName].input_size;"en"!=c.language&&(f.language=c.language);$(g).fileinput(f);break;case "file_wsdata":g[0].addEventListener("change",
function(){b.oFormValues[b.sFormDefinitionName][g[0].name]={aFiles:this.files}},!1);f=[];null!=b.field.formats&&(f=b.field.formats.split("|"));f={showPreview:!1,showRemove:!1,showUpload:!1,allowedFileExtensions:f};"undefined"!==typeof b.field.options&&kb(f,b.field.options);f.mainClass="input-file-"+b.oFormDefinition[b.sFormDefinitionName].input_size;"en"!=c.language&&(f.language=c.language);$(g).fileinput(f);break;case "image_wsdata":null!=b.field.display_width||(b.field.display_width="100%");g[0].addEventListener("change",
function(){b.oFormValues[b.sFormDefinitionName][g[0].name]={aFiles:this.files}},!1);f={showPreview:!1,showRemove:!1,showUpload:!1,allowedFileTypes:["image"]};f.mainClass="input-file-"+b.oFormDefinition[b.sFormDefinitionName].input_size;"en"!=c.language&&(f.language=c.language);$(g).fileinput(f);break;case "email":b.field.pattern="^(([a-zA-Z]|[0-9])|([-]|[_]|[.]))+[@](([a-zA-Z]|[0-9])|([-]|[_]|[.])){2,63}[.](([a-zA-Z0-9]){2,63})+$";var m=angular.copy(b.field.pattern);b.$watch("oFormValues."+b.sFormDefinitionName+
'["'+b.field.name+'"]',function(){b.field.pattern=angular.copy(m);a(function(){if(-1!==g[0].className.indexOf("ng-invalid-pattern")){var a;a="fr"===b.oProperties.language?"ceci n'est pas une adresse mail":"this is not a mail adress";$(g).notify(a,{position:"top",className:"error",autoHide:!1,clickToHide:!1})}else{a=g[0].parentNode.children;for(var c=-1,d=0;d<a.length;d++)"notifyjs-wrapper"===a[d].className&&(c=d);-1<c&&$(a[c]).remove()}},1)});break;case "url":b.field.pattern="^https?:\\/\\/.{1,}";
m=angular.copy(b.field.pattern);b.$watch("oFormValues."+b.sFormDefinitionName+'["'+b.field.name+'"]',function(){b.field.pattern=angular.copy(m);a(function(){if(-1!==g[0].className.indexOf("ng-invalid-pattern")){var a;a="fr"===b.oProperties.language?"ce champ doit contenir une url qui commence\n par http:// ou https://":"this field must contain an url that begin\n by http:// or https://";$(g).notify(a,{position:"top",className:"error",autoHide:!1,clickToHide:!1})}else{a=g[0].parentNode.children;for(var c=
-1,d=0;d<a.length;d++)"notifyjs-wrapper"===a[d].className&&(c=d);-1<c&&$(a[c]).remove()}},1)});break;case "integer":"undefined"!==typeof b.field.min&&g[0].setAttribute("min",b.field.min);"undefined"!==typeof b.field.max&&g[0].setAttribute("max",b.field.max);"undefined"!==typeof b.field.max_length&&g[0].setAttribute("maxLength",b.field.max_length);b.$parent.valid=!0;b.numberUpdate=function(){var a=b.oFormValues[b.sFormDefinitionName][g[0].name];!n(a)||"string"!==typeof a&&"number"!==typeof a?console.error("bad type argument"):
"string"===typeof a?(a=b.ctrl.numberParser(a,!0),b.oFormValues[b.sFormDefinitionName][g[0].name]=isNaN(a)?"":a):b.oFormValues[b.sFormDefinitionName][g[0].name]=a};a(function(){b.oFormValues[b.sFormDefinitionName][g[0].name]+=" ";b.numberUpdate()},500);break;case "float":case "number":"undefined"!==typeof b.field.min&&g[0].setAttribute("min",b.field.min);"undefined"!==typeof b.field.max&&g[0].setAttribute("max",b.field.max);"undefined"!==typeof b.field.max_length&&g[0].setAttribute("maxLength",b.field.max_length);
b.$parent.valid=!0;b.numberUpdate=function(){var a=b.oFormValues[b.sFormDefinitionName][g[0].name];!n(a)||"string"!==typeof a&&"number"!==typeof a?console.error("bad type argument"):"string"===typeof a?(a=b.ctrl.numberParser(a,!1),b.oFormValues[b.sFormDefinitionName][g[0].name]=isNaN(a)&&"string"!==typeof a?"":a):b.oFormValues[b.sFormDefinitionName][g[0].name]=a};a(function(){b.oFormValues[b.sFormDefinitionName][g[0].name]+=" ";b.numberUpdate()},500);break;case "image":case "imageurl":case "image_wsdata":null!=
b.field&&(null==b.field.width||0!=b.field.width&&"0px"!=b.field.width||(b.field.width=null),null==b.field.style||null==b.field.style.height||0!=b.field.style.height&&"0px"!=b.field.style.height||(b.field.style.height=null));break;case "image":f={inline:!1,button:!0,navbar:!1,title:2,toolbar:2,tooltip:!0,fullscreen:!1,url:function(){return b.oProperties.web_server_name+"/"+b.oProperties[b.field.alias]+"/"+b.field.folder+"/"+b.oFormValues[b.sFormDefinitionName][b.field.name]}};b.viewer=new Viewer(g[0],
f);b.openViewer=function(){e.log("openViewer");b.viewer.show();angular.element(".viewer-prev").remove();angular.element(".viewer-next").remove()};break;case "imageurl":f={inline:!1,button:!0,navbar:!1,title:2,toolbar:2,tooltip:!0,fullscreen:!1,url:function(){return b.oFormValues[b.sFormDefinitionName][b.field.name]}};b.viewer=new Viewer(g[0],f);b.openViewer=function(){e.log("openViewer");b.viewer.show();angular.element(".viewer-prev").remove();angular.element(".viewer-next").remove()};break;case "select":case "editable_select":var p=
b.field,f=b.oFormValues[b.sFormDefinitionName][b.field.name];"string"!=typeof f||isNaN(f)||1!=f.length&&-1==f.search(/^[1-9][0-9]+$/)||(b.oFormValues[b.sFormDefinitionName][b.field.name]=Number(f));"undefined"!==typeof p.multiple&&!0===p.multiple&&g[0].setAttribute("multiple","");"undefined"!==typeof p.size&&(g[0].setAttribute("size",p.size),g[0].style.height="auto");if(r(p.options)){for(var k=p.options.split(","),t,f=0;f<k.length;f++)t=k[f].split("|"),k[f]={label:t[0],value:t[1]};b.oFormValues[b.sFormDefinitionName][p.name].options=
k}"undefined"!=typeof b.field.child_select&&g[0].addEventListener("change",function(){b.reloadSelectField(b.field,b.sFormDefinitionName)},!1);null!=p.onchange&&g[0].addEventListener("change",function(){if(d.isFunctionCall(p.onchange))if(r(p.onchange))d.callFunction(p.onchange);else if(fa(p.onchange))p.onchange(b.oFormValues)},!1);break;case "map_bing":case "map_osm":case "map_vmap":var v=function(){n(b.oMap)&&(b.oMap.aa.Dh(null),delete b.oMap);b.oMap=new Y({target:g[0],options:b.field.map_options,
hiddenFieldId:b.field.id,oFormValues:b.oFormValues[b.sFormDefinitionName],sFormName:b.field.name,oProj:b.$root.proj});"undefined"!=typeof b.field.style&&"undefined"!=typeof b.field.style.height&&"ratio"==b.field.style.height&&(b.field.style.height=parseInt(g[0].clientWidth/(window.innerWidth/window.innerHeight))+"px");b.$root.$emit("OpenLayersMapCreated",b.oMap);b.oMap.on("moveend",function(){b.field.map_options.center=b.oMap.getConfig();b.$apply()},b.oMap)};setTimeout(function(){v();b.$watch("field.nb_cols",
function(){a(function(){b.oMap.aa.zd()})});b.$watch("field.style",function(){a(function(){b.oMap.aa.zd()})},!0);b.$watch("oMap.bLayersTreeOpen",function(){a(function(){b.oMap.aa.zd()})},!0);b.$on("studio resized",function(){b.oMap.aa.zd()});b.$on("updateMap",function(a,c){switch(c){case "center":b.oMap.setCenter([b.field.map_options.center.coord[0],b.field.map_options.center.coord[1]]);break;case "zoom":b.oMap.setZoom(b.field.map_options.center.zoom);break;case "source":b.oMap.setBingSource(b.field.map_options.source);
break;case "extent":b.oMap.setExtent(b.field.map_options.center.extent);break;case "controls":b.oMap.setControls(b.field.map_options.controls);break;case "interact":b.oMap.setInteractions(b.field.map_options.interactions);break;case "proj":a=b.oMap.getExtent();c=b.oMap.getCenter();var d=b.oMap.getProj();b.field.map_options.center.extent=b.oMap.transformExtent(a,d,b.field.map_options.proj);b.field.map_options.center.coord=b.oMap.transformer(c,d,b.field.map_options.proj);v();break;default:v()}})});
break;case "slider":b.field.options.id=b.field.id+"_slider";$(g).slider(b.field.options);null!=b.oFormValues[b.sFormDefinitionName][b.field.name]||(b.oFormValues[b.sFormDefinitionName][b.field.name]=0);$(g).on("slide",function(){b.oFormValues[b.sFormDefinitionName][b.field.name]=$(g).slider("getValue")});b.$watch("oFormValues."+b.sFormDefinitionName+'["'+b.field.name+'"]',function(){setTimeout(function(){null!=$(g)&&null!=b.oFormValues&&null!=b.oFormValues[b.sFormDefinitionName]&&null!=b.oFormValues[b.sFormDefinitionName][b.field.name]&&
$(g).slider("setValue",parseFloat(b.oFormValues[b.sFormDefinitionName][b.field.name]))},10)});b.$watch("field.options",function(){setTimeout(function(){$(g).slider(b.field.options)},10)},!0);break;case "color_picker":$(g).colorpicker({format:"rgba"});$(g).on("changeColor",function(){b.oFormValues[b.sFormDefinitionName][b.field.name]=$(g).colorpicker("getValue")});b.$watch("oFormValues."+b.sFormDefinitionName+'["'+b.field.name+'"]',function(){setTimeout(function(){null!=$(g)&&null!=b.oFormValues&&
null!=b.oFormValues[b.sFormDefinitionName]&&null!=b.oFormValues[b.sFormDefinitionName][b.field.name]&&$(g).colorpicker("setValue",b.oFormValues[b.sFormDefinitionName][b.field.name])},10)});break;case "double_select":f=parseInt($(g).css("line-height"))-1;"undefined"!==typeof b.field.size&&(g[0].style.minHeight=f*b.field.size+"px");break;case "password":if("undefined"===typeof b.field.autocomplete||!1===b.field.autocomplete)if(g[0].readOnly=!0,null===document.getElementById("FormBuilder"))var w=b.$root.$on("endFormNgRepeat",
function(){a(function(){g[0].readOnly=!1},300);w()});else a(function(){g[0].readOnly=!1},300);break;case "text":"undefined"!==typeof b.field.max_length&&g[0].setAttribute("maxLength",b.field.max_length);break;case "treeview":var x=angular.copy(b.field.options);d.callFunction(x.data).then(function(a){x.data=a;"undefined"!=typeof x.showCheckbox&&!0===x.showCheckbox&&(this.setTreeviewNodesState=function(a){for(var c in a)if("undefined"!=typeof a[c].nodes)this.setTreeviewNodesState(a[c].nodes);else{"undefined"==
typeof a[c].state&&(a[c].state={});var d=[],e=b.oFormValues[b.sFormDefinitionName][b.field.name];"string"==typeof e&&""!=e&&(d=e.split("|"));-1!=d.indexOf(String(a[c].value))&&(a[c].state.checked=!0)}},this.setTreeviewNodesState(x.data),x.onNodeChecked=function(a,c){if("undefined"!=typeof c.nodes)for(var d in c.nodes)$(g).treeview("checkNode",c.nodes[d].nodeId);else a=[],"undefined"!=typeof c.value&&(d=b.oFormValues[b.sFormDefinitionName][b.field.name],"string"==typeof d&&""!=d&&(a=d.split("|")),
a.push(c.value),b.oFormValues[b.sFormDefinitionName][b.field.name]=a.join("|"))},x.onNodeUnchecked=function(a,c){if("undefined"!=typeof c.nodes)for(var d in c.nodes)$(g).treeview("uncheckNode",c.nodes[d].nodeId);else a=[],"undefined"!=typeof c.value&&(d=b.oFormValues[b.sFormDefinitionName][b.field.name],"string"==typeof d&&""!=d&&(a=d.split("|")),a.splice(a.indexOf(c.value),1),b.oFormValues[b.sFormDefinitionName][b.field.name]=a.join("|"))});$(g).treeview(x)})}"undefined"!=typeof b.field.read_only&&
1==b.field.read_only&&(g[0].readOnly=!0)}}};Iy.xv.$inject=["$timeout","$translate","propertiesSrvc","formReaderService","$log"];Iy.module.directive("appFormFieldSpecificParams",Iy.xv);
Iy.yv=function(a,b,c,d){return{link:function(e,f){d.log("formReader.appFormRowNgRepeatDrtv.link");if("undefined"!=typeof e.row.tab){var g=!1,h=e.sFormDefinitionName+"_"+e.row.tab.parent+"_tab_container";if(null==document.getElementById(h)){var k=document.createElement("div");k.className="tab-content";k.id=h;f[0].parentNode.insertBefore(k,f[0]);g=!0}document.getElementById(h).appendChild(f[0]);f[0].id=e.sFormDefinitionName+"_"+e.row.tab.name+"_tab";f[0].setAttribute("role","tabpanel");a(function(){f[0].className+=
" tab-pane fade";g&&(f[0].className+=" in active")})}a(function(){e.$last&&b.$emit("endFormNgRepeat",c.oSelectedObject.name)})}}};Iy.yv.$inject=["$timeout","$rootScope","envSrvc","$log"];Iy.module.directive("appFormRowNgRepeat",Iy.yv);
function Vy(a,b,c,d,e){return{link:function(f,g){"string"==typeof f.field.default_value&&/^[A-Z0-9_]+$/.test(f.field.default_value)&&a([f.field.default_value]).then(function(a){f.oFormValues[f.sFormDefinitionName][f.field.name]==f.field.default_value&&(f.oFormValues[f.sFormDefinitionName][f.field.name]=a[f.field.default_value])});"undefined"!=typeof f.field.name&&-1!=f.field.name.indexOf(".")&&(f.oFormValues[f.sFormDefinitionName][f.field.name]=c.getFormValueFromObject(f.oFormValues[f.sFormDefinitionName],
f.field.name));"undefined"!==typeof f.field.visible&&c.isFunctionCall(f.field.visible)&&(f.field.visible=f.$eval(f.field.visible));if("editable_double_select"===f.field.type)var h=f.$root.$on("webServiceTagsloaded",function(a,c){b(function(){var a={};"undefined"!==typeof c.options&&(a=c.options);$("#"+c.id).tagsinput(a);$("#"+c.id_available_tags).tagsinput(a);$("#"+c.id).on("itemRemoved itemAdded",function(a){"itemRemoved"==a.type?($("#"+c.id_available_tags).tagsinput("add",a.item),f.$root.setTagsInput([c.id_available_tags])):
f.$root.setTagsInput([c.id])});$("#"+c.id_available_tags).on("itemRemoved itemAdded",function(a){"itemRemoved"==a.type?($("#"+c.id).tagsinput("add",a.item),f.$root.setTagsInput([c.id])):f.$root.setTagsInput([c.id_available_tags])});f.$root.setTagsInput([c.id_available_tags,c.id])});h()});else if("ui_grid"==f.field.type||"bo_grid"==f.field.type||"section_grid"==f.field.type){null!=f.field.options||(f.field.options={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!1,enablePaginationControls:!1,
enableColumnMenus:!1,enableColumnResizing:!1,appHeader:!0,appHeaderTitleBar:!0,columnDefs:[],data:[]});f.gridOptions=angular.copy(f.field.options);var k=[],m=angular.copy(f.gridOptions.columnDefs);m.forEach(function(a){k.push(a.name)});a(k).then(function(a){k.forEach(function(b,c){m[c].name=a[b];m[c].displayName=a[b]});f.gridOptions.columnDefs=angular.copy(m)});!0===f.gridOptions.appEnableDragAndDrop&&(f.gridOptions.rowTemplate='<div grid="grid" class="ui-grid-draggable-row" draggable="true"><div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader, \'custom\': true }" ui-grid-cell></div></div>');
f.gridOptions.onRegisterApi=function(a){f.$root.$emit("registeredUiGridApi",a);f.gridApi=a;b(function(){e.resizeWin();a.core.handleWindowResize()});f.gridOptions.gridApi=a;b(function(){$(a.grid.element).find(".ui-grid-render-container-body").on("click.selectRow",function(a){a=a.target;if($(a).hasClass("ui-grid-cell")||$(a).hasClass("ui-grid-cell-contents"))a=$(g).find(".ui-grid-render-container-body .ui-grid-canvas").children().index($(a).parents(".ui-grid-row")),$(g).find(".ui-grid-render-container-left .ui-grid-row").eq(a).find(".ui-grid-selection-row-header-buttons").click()})});
"undefined"!==typeof a.dragndrop&&(!0===f.gridOptions.appEnableDragAndDrop?(a.dragndrop.setDragDisabled=!1,a.draggableRows.on.rowDragged(f,function(){}),a.draggableRows.on.rowFinishDrag(f,function(){if("undefined"!==typeof f.gridOptions.appDragAndDropEvent&&"undefined"!==typeof f.gridOptions.appDragAndDropEvent.rowFinishDrag)if(fa(f.$root[f.gridOptions.appDragAndDropEvent.rowFinishDrag]))f.$root[f.gridOptions.appDragAndDropEvent.rowFinishDrag]();else console.error(f.gridOptions.appDragAndDropEvent.rowFinishDrag+
" is not a function of scope.$root")}),a.draggableRows.on.rowEnterRow(f,function(){}),a.draggableRows.on.beforeRowMove(f,function(){})):a.dragndrop.setDragDisabled=!0);g[0].querySelector(".ui-grid-render-container-body").style.height="100%";g[0].querySelector(".ui-grid-render-container-body .ui-grid-viewport").style.height="Calc(100% - 30px)"}}else"codemirror"==f.field.type?("undefined"!=typeof f.field.codemirrorOptions&&(f.field.cm_options=f.field.codemirrorOptions),null!=f.field.cm_options&&(f.field.cm_options.onLoad=
function(a){"undefined"==typeof f.oCodeMirrorEditor&&(f.oCodeMirrorEditor={});f.oCodeMirrorEditor[a.options.appName]=a;if("undefined"!=typeof a.options.appHeight){var b=a.options.appHeight;"string"==typeof b&&(-1!=b.indexOf("%")?b=parseInt(window.innerHeight*parseInt(b)/100):isNaN(b)||(b=parseInt(b)));"number"==typeof b&&a.setSize(null,b)}if("undefined"!=typeof f.field.cm_options.appHints)a.on("keyup",function(b,c){c.key==f.field.cm_options.appHints.key&&a.showHint({hint:function(){return{from:a.getDoc().getCursor(),
to:a.getDoc().getCursor(),list:f.field.cm_options.appHints.hints}}})})})):"codemirror"==f.field.type&&("undefined"!=typeof f.field.codemirrorOptions&&(f.field.cm_options=f.field.codemirrorOptions),f.field.cm_options.onLoad=function(a){"undefined"==typeof f.oCodeMirrorEditor&&(f.oCodeMirrorEditor={});f.oCodeMirrorEditor[a.options.appName]=a;if("undefined"!=typeof a.options.appHeight){var b=a.options.appHeight;"string"==typeof b&&(-1!=b.indexOf("%")?b=parseInt(window.innerHeight*parseInt(b)/100):isNaN(b)||
(b=parseInt(b)));"number"==typeof b&&a.setSize(null,b)}if("undefined"!=typeof f.field.cm_options.appHints)a.on("keyup",function(b,c){c.key==f.field.cm_options.appHints.key&&a.showHint({hint:function(){return{from:a.getDoc().getCursor(),to:a.getDoc().getCursor(),list:f.field.cm_options.appHints.hints}}})})});b(function(){if("undefined"!==typeof f.field.tooltip&&!1!==f.field.visible){"undefined"===typeof f.field.tooltip.trigger&&(f.field.tooltip.trigger="hover");var b=document.createElement("span");
b.className="form-field-label-tooltip";b.id=f.field.id+"_tooltip";if("undefined"!=typeof f.field.tooltip.thumbnail){var c=f.oFormValues[f.sFormDefinitionName][f.field.tooltip.thumbnail];""!=c&&null!=c&&(c=d.web_server_name+"/"+d.public_alias+"/"+d.application+"/"+c,f.field.tooltip.html=!0,f.field.tooltip.content='<img src="'+c+'" class="popover-thumbnail-img">',f.field.tooltip.template='<div class="popover popover-thumbnail" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>',
g[0].querySelector("label").appendChild(b),$(g).find("label .form-field-label-tooltip").popover(f.field.tooltip))}else g[0].querySelector("label").appendChild(b),a([f.field.tooltip.title,f.field.tooltip.content]).then(function(a){f.field.tooltip.title=a[f.field.tooltip.title];f.field.tooltip.content=a[f.field.tooltip.content];$(g).find("label .form-field-label-tooltip").popover(f.field.tooltip).on("inserted.bs.popover",function(){"undefined"!==typeof f.field.tooltip.width&&(g[0].querySelector(".popover").style.width=
f.field.tooltip.width)})})}"undefined"!=typeof f.field.autocomplete&&(f.field.autocomplete?g[0].querySelector("[name='"+f.field.name+"']").setAttribute("autocomplete","on"):g[0].querySelector("[name='"+f.field.name+"']").setAttribute("autocomplete","off"))});"tinymce"==f.field.type&&("undefined"==typeof f.field.tinymceOptions&&(f.field.tinymceOptions={}),"en"!=d.language&&(f.field.tinymceOptions.language=d.language+"_"+d.language.toUpperCase()))}}}Vy.$inject="$translate $timeout formReaderService propertiesSrvc externFunctionSrvc $log".split(" ");
Iy.module.directive("appFormFieldNgRepeat",Vy);Iy.vv=function(a,b){return{link:function(c,d){b.log("formReader.appButtonDrtv.link");"undefined"!==typeof c.button.tooltip&&a([c.button.tooltip.title]).then(function(a){c.button.tooltip.title=a[c.button.tooltip.title];$(d).tooltip(c.button.tooltip)})}}};Iy.vv.$inject=["$translate","$log"];Iy.module.directive("appButton",Iy.vv);
Iy.Yv=function(a,b,c,d,e){return{link:function(a,c){e.log("formReader.appSubformGridDrtv.link");var f=angular.element("#formreader_"+a.sFormUniqueName+"_grid_subform_modal").scope(),g=c.closest("form").parent();a.initBoSubformGrid=function(){e.log("formReader.appSubformGridDrtv.initBoSubformGrid");var c=a.field.bo_id,h="formreader_"+a.sFormUniqueName+"_grid_subform_modal",k={},v={},w=a.field.bo_filter_attr,x=a.field.form_filter_value,y=angular.element(u.f).injector().get(["envSrvc"]),F=angular.element(u.f).injector().get(["formSrvc"]),
H=angular.element("#"+("formreader_"+a.sFormUniqueName+"_grid_subform")).scope(),B=!1;f.closeModal=function(a){$(a).modal("hide")};$("#"+h).on("hidden.bs.modal",function(){setTimeout(function(){y.oFormValues=f.oFormValues;y.oFormDefinition=f.oFormDefinition;y.sFormDefinitionName=f.sFormDefinitionName})});a.haveInsertRights=!1;a.haveDeleteRights=!1;a.haveUpdateRights=!1;a.haveCardRights=!1;a.oListWebService={dataType:"businessObject",ressource_id:"vmap/querys/"+c+"/list",parameters:{filter:""}};d.getBusinessObjectDef(c).then(function(e){function p(){d.getWebServiceData(angular.copy(a.oListWebService)).then(function(h){if(null==
h)return null;if(null!=h[0]){a.gridOptions.columnDefs=[{name:"",field:"actions",cellTemplate:"<app-ui-grid-action></app-ui-grid-action>",width:60,enableSorting:!1,enableColumnMoving:!1,enableColumnResizing:!1}];for(var k=0;k<h[0].bo_list_attributs.length;k++)a.gridOptions.columnDefs.push({field:h[0].bo_list_attributs[k]});m(h);a.haveUpdateRights&&(a.gridApi.grid.appScope.edit_column="edit");a.haveCardRights&&(a.gridApi.grid.appScope.show_column="show");a.gridApi.grid.appScope.executeActionButtonEvent=
function(h,k){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,"error")}),0;var p=h.entity.bo_object_infos,t="edit"===k?"update":"display";d.getWebServiceData({dataType:"businessObject",ressource_id:"vmap/querys/"+c+"/form",parameters:{filter:{column:p.bo_id_field,compare_operator:"=",value:p.bo_id_value}}}).then(function(g){var h=g[0].bo_json_form,k={},v="formreader_"+a.sFormUniqueName+"_grid_subform_modal";"update"===t&&(h.update.event=function(e){d.updateBoElement(c,
p,h,t,e,function(){$("#"+v).modal("hide");setTimeout(function(){d.getWebServiceData(angular.copy(a.oListWebService)).then(function(a){m(a)})});b("LIST_EDIT_OK").then(function(a){$.notify(a,"success")})})});k[t]=g[0].bo_form;h[t].name="formreader_"+a.sFormUniqueName+"_grid_subform_form";B&&(h=d.disableFormElement(h,w,t));if(null==p)return console.error("oObject undefined"),0;if(null==H)return console.error("oSubformScope undefined"),0;if(null==h)return console.error("oSubformDefinition undefined"),
0;if(null==t)return console.error("sSubformDefinitionName undefined"),0;if(null==k)return console.error("oSubformValues undefined"),0;f.$applyAsync(function(){f.grid_subform_title=g[0].bo_title;f.grid_subform_definition_name=t;"update"===t&&(f.grid_subform_size=e.edit_form_size);"display"===t&&(f.grid_subform_size=e.display_form_size)});d.showModalSubform(v,H,h,t,k)})};a.gridApi.grid.refresh()}else m([])})}function m(b){for(var c=[],d=0;d<b.length;d++)b[d].bo_list.bo_object_infos={bo_id_value:b[d].bo_id_value,
bo_id_field:b[d].bo_id_field,bo_type:b[d].bo_type},c.push(b[d].bo_list);a.gridOptions.data=c}if(null==e.business_object_id)return console.error("error while loading business object ("+c+")"),0;null!=w&&""!==w&&null!=x&&""!==x&&null!=f.oFormValues&&null!=f.oFormValues[f.sFormDefinitionName]&&null!=f.oFormValues[f.sFormDefinitionName][x]&&(B=!0,k[w]=f.oFormValues[f.sFormDefinitionName][x],v[w]=f.oFormValues[f.sFormDefinitionName][x]);var t=d.parseFilter(k);a.oListWebService.parameters.filter=t;a.oListWebService.parameters.limit=
100;-1!==e.user_rights.indexOf("INSERT")&&(a.haveInsertRights=!0);-1!==e.user_rights.indexOf("DELETE")&&(a.haveDeleteRights=!0);-1!==e.user_rights.indexOf("UPDATE")&&null!=e.json_form&&null!=e.json_form[0]&&null!=e.json_form[0].update&&(a.haveUpdateRights=!0);-1!==e.user_rights.indexOf("SELECT")&&null!=e.json_form&&null!=e.json_form[0]&&null!=e.json_form[0].display&&(a.haveCardRights=!0);a.addObject=function(){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,
"error")}),0;var h={insert:angular.copy(v)},k="formreader_"+a.sFormUniqueName+"_grid_subform_modal",m=e.json_form[0];B&&(m=d.disableFormElement(m,w,"insert"));f.$applyAsync(function(){f.grid_subform_title=e.title;f.grid_subform_size=e.add_form_size;f.grid_subform_definition_name="insert"});m.insert.name="formreader_"+a.sFormUniqueName+"_grid_subform_form";var t=Date.now();m.insert.event=function(a){if(t>Date.now()-2E3)return!1;t=Date.now();d.insertBoElement(c,e,m,"insert",a,function(){$("#"+k).modal("hide");
setTimeout(function(){p()});b("LIST_ADD_OK").then(function(a){$.notify(a,"success")})})};d.showModalSubform(k,H,m,"insert",h)};a.removeSelection=function(){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,"error")}),0;var e=[],f=a.gridApi.selection.getSelectedRows();0<f.length?b("LIST_DELETE_CONFIRM").then(function(g){bootbox.confirm(g,function(g){if(!0===g){for(g=0;g<f.length;g++)e.push(f[g].bo_object_infos.bo_id_value);d.deleteBoElements(c,e,function(){setTimeout(function(){d.getWebServiceData(angular.copy(a.oListWebService)).then(function(a){m(a)})});
b("LIST_DELETE_OK").then(function(a){$.notify(a,"success")})})}})}):b("LIST_NO_ELEMENT_SELECTED").then(function(a){$.notify(a,"warning")})};a.showFilterFormModal=function(){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,"error")}),0;var c=e.json_form[0],p={search:k};B&&(c=d.disableFormElement(c,w,"search"));c.search.name="formreader_"+a.sFormUniqueName+"_grid_subform_form";c.search.event=function(e){y.oFormValues=e;y.oFormDefinition=c;y.sFormDefinitionName=
"search";e=F.getFormData("search",!0);e=d.parseFilter(e);a.oListWebService.parameters.filter=e;$("#"+h).modal("hide");d.getWebServiceData(angular.copy(a.oListWebService)).then(function(a){m(a)});b("LIST_SEARCH_OK").then(function(a){$.notify(a,"success")})};f.$applyAsync(function(){f.grid_subform_title=e.title;f.grid_subform_definition_name="search"});H.loadSubForm({sFormDefinitionName:"search",oFormDefinition:c,oFormValues:p,oProperties:a.oProperties});$("#"+h).modal("show")};p()})};a.initSectionSubformGrid=
function(){e.log("formReader.appSubformGridDrtv.initSectionSubformGrid");var c=a.field.section_id,h="formreader_"+a.sFormUniqueName+"_grid_subform",k="formreader_"+a.sFormUniqueName+"_grid_subform_modal",v=angular.element(u.f).injector().get(["envSrvc"]),w=angular.element(u.f).injector().get(["formSrvc"]),x=angular.element("#"+h).scope(),y={},F={},H=a.field.section_filter_attr,h=a.field.form_filter_value,B=!1;a.haveInsertRights=!1;a.haveDeleteRights=!1;f.closeModal=function(a){$(a).modal("hide")};
$("#"+k).on("hidden.bs.modal",function(){setTimeout(function(){v.oFormValues=f.oFormValues;v.oFormDefinition=f.oFormDefinition;v.sFormDefinitionName=f.sFormDefinitionName})});null!=H&&""!==H&&null!=h&&""!==h&&null!=f.oFormValues&&null!=f.oFormValues[f.sFormDefinitionName]&&null!=f.oFormValues[f.sFormDefinitionName][h]&&(B=!0,y[H]=f.oFormValues[f.sFormDefinitionName][h],F[H]=f.oFormValues[f.sFormDefinitionName][h]);a.addObject=function(){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,
"error")}),0;var c={insert:angular.copy(F)},e=a.oSubformDefinition,h=angular.element("#formreader_"+a.sFormUniqueName+"_grid_subform").scope();B&&(e=d.disableFormElement(e,H,"insert"));f.$applyAsync(function(){f.grid_subform_title=a.oRessourceTab.name;f.grid_subform_definition_name="insert"});e.insert.name="formreader_"+a.sFormUniqueName+"_grid_subform_form";null!=e.insert.afterEvent&&delete e.insert.afterEvent;e.insert.event=function(c){d.insertSectionElement(a.oSection.ressource_id,a.sIdField,a.oSubformDefinition,
"insert",c).then(function(){$("#"+k).modal("hide");setTimeout(function(){d.getSectionRessourceData(a.oSection.ressource_id).then(function(b){a.gridOptions.data=b})});b("LIST_ADD_OK").then(function(a){$.notify(a,"success")})})};d.showModalSubform(k,h,e,"insert",c)};a.removeSelection=function(){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,"error")}),0;var c=[],e=a.gridApi.selection.getSelectedRows();0<e.length?b("LIST_DELETE_CONFIRM").then(function(f){bootbox.confirm(f,
function(f){if(!0===f){for(f=0;f<e.length;f++)c.push(e[f][a.sIdField]);d.deleteSectionElements(a.oSection.ressource_id,c).then(function(){setTimeout(function(){d.getSectionRessourceData(a.oSection.ressource_id).then(function(b){a.gridOptions.data=b})});b("LIST_DELETE_OK").then(function(a){$.notify(a,"success")})})}})}):b("LIST_NO_ELEMENT_SELECTED").then(function(a){$.notify(a,"warning")})};a.showFilterFormModal=function(){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,
"error")}),0;var c=a.oSubformDefinition,e={search:y};B&&(c=d.disableFormElement(c,H,"search"));c.search.name="formreader_"+a.sFormUniqueName+"_grid_subform_form";c.search.event=function(e){v.oFormValues=e;v.oFormDefinition=c;v.sFormDefinitionName="search";e=w.getFormData("search",!0);e=d.parseFilter(e);$("#"+k).modal("hide");d.getSectionRessourceData(a.oSection.ressource_id,e).then(function(b){a.gridOptions.data=b});b("LIST_SEARCH_OK").then(function(a){$.notify(a,"success")})};f.$applyAsync(function(){f.grid_subform_title=
a.oRessourceTab.name;f.grid_subform_definition_name="search"});x.loadSubForm({sFormDefinitionName:"search",oFormDefinition:c,oFormValues:e,oProperties:a.oProperties});$("#"+k).modal("show")};d.getSectionDef(c).then(function(c){a.oSection=c;d.getSectionRessourceTab(a.oSection.ressource_id).then(function(c){a.oRessourceTab=c;d.getSectionRessourceData(a.oSection.ressource_id).then(function(c){a.aRessourceData=c;d.getSectionForm(a.oSection,!0).then(function(c){a.oSubformDefinition=c;var e,h,p;c=a.oRessourceTab.ressource_id.substr(a.oRessourceTab.ressource_id.lastIndexOf("/")+
1);for(var m=0;m<a.oRessourceTab[c].length;m++)null!=a.oRessourceTab[c][m].columns&&(e=a.oRessourceTab[c][m].columns),null!=a.oRessourceTab[c][m].actions&&(h=a.oRessourceTab[c][m].actions),null!=a.oRessourceTab[c][m].tabs&&(p=a.oRessourceTab[c][m].tabs[0]);a.sIdField=angular.copy(e[0].name);"showSectionForm"===p.show_column&&(a.gridApi.grid.appScope.show_column="show");"editSectionForm"===p.edit_column&&(a.gridApi.grid.appScope.edit_column="edit");a.gridOptions.columnDefs=[{name:"",field:"actions",
cellTemplate:"<app-ui-grid-action></app-ui-grid-action>",width:60,enableSorting:!1,enableColumnMoving:!1,enableColumnResizing:!1}];null!=e&&Wa(a.gridOptions.columnDefs,e);a.gridOptions.data=angular.copy(a.aRessourceData);for(m=0;m<h.length;m++)"AddSectionForm"===h[m].event&&(a.haveInsertRights=!0),"DeleteSelection"===h[m].event&&(a.haveDeleteRights=!0);a.gridApi.grid.appScope.executeActionButtonEvent=function(c,e){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,
"error")}),0;var h="edit"===e?"update":"display";e={};e[h]=angular.copy(c.entity);a.oSubformDefinition[h].name="formreader_"+a.sFormUniqueName+"_grid_subform_form";"update"===h&&(a.oSubformDefinition.update.event=function(c){d.updateSectionElement(a.oSection.ressource_id,a.sIdField,a.oSubformDefinition,h,c).then(function(){$("#"+k).modal("hide");setTimeout(function(){d.getSectionRessourceData(a.oSection.ressource_id).then(function(b){a.gridOptions.data=b})});b("LIST_EDIT_OK").then(function(a){$.notify(a,
"success")})})});B&&(a.oSubformDefinition=d.disableFormElement(a.oSubformDefinition,H,h));if(null==x)return console.error("oSubformScope undefined"),0;if(null==a.oSubformDefinition)return console.error("scope.oSubformDefinition undefined"),0;if(null==h)return console.error("sSubformDefinitionName undefined"),0;if(null==e)return console.error("oSubformValues undefined"),0;f.$applyAsync(function(){f.grid_subform_title=a.oRessourceTab.name;f.grid_subform_definition_name=h});d.showModalSubform(k,x,a.oSubformDefinition,
h,e)};a.gridApi.grid.refresh()})})})})};a.initSubformGrid=function(){e.log("initSubformGrid");"bo_grid"===a.field.type?a.initBoSubformGrid():"section_grid"===a.field.type&&a.initSectionSubformGrid()};null!=f.initSubformGridEvent_counter||(f.initSubformGridEvent_counter=0);null!=f.initSubformGridEvent&&(f["initSubformGridEvent_"+a.field.name](),f["initSubformGridEvent_"+a.field.name]=null);f["initSubformGridEvent_"+a.field.name]=f.$on("extractFormDefinitionInfos",function(){f.initSubformGridEvent_counter++;
var b=angular.copy(f.initSubformGridEvent_counter);setTimeout(function(){b===f.initSubformGridEvent_counter&&a.initSubformGrid()},500)})}}};Iy.Yv.$inject=["$timeout","$translate","propertiesSrvc","formReaderService","$log"];Iy.module.directive("appSubformGrid",Iy.Yv);
Iy.Xv=function(a,b){return{link:function(c,d){b.log("formReader.appSubformDrtv.link");var e;c.oSubformValues=null;c.loadSubForm=function(f){b.log("formReader.loadSubForm");if(null==f.sFormDefinitionName)return console.error("opt_options['sFormDefinitionName'] undefined"),0;if(null==f.oFormDefinition)return console.error("opt_options['oFormDefinition'] undefined"),0;if(null==f.oFormValues)return console.error("opt_options['oFormValues'] undefined"),0;if(null==f.oProperties)return console.error("opt_options['oProperties'] undefined"),
0;c.oSubformValues=f.oFormValues;c.$applyAsync(function(){c.oProperties=f.oProperties;e=a('<div app-form-reader app-properties="oProperties"></div>')(c);d.html("");d.append(e);setTimeout(function(){c.oFormReaderScope=angular.element($(d).find("[app-form-reader]").children()).scope();c.oFormReaderScope.ctrl.setDefinitionName(f.sFormDefinitionName);c.oFormReaderScope.ctrl.setFormValues(c.oSubformValues);c.oFormReaderScope.ctrl.setFormDefinition(f.oFormDefinition);c.oFormReaderScope.ctrl.loadForm()})})};
c.setFormValues=function(a){b.log("formReader.setFormValues");c.oSubformValues=a;null!=c.oFormReaderScope&&null!=c.oFormReaderScope.ctrl&&(c.oFormReaderScope.ctrl.setFormValues(c.oSubformValues),c.oFormReaderScope.ctrl.loadForm())}}}};Iy.Xv.$inject=["$compile","$log"];Iy.module.directive("appSubform",Iy.Xv);Iy.service={};Iy.service.XL={};
function Wy(a,b,c,d,e){return{reloadSelectField:function(a,b,c,d){d=this.getFormElementDefinition(a.child_select,b,d);if(n(d)){var e=d.web_service.parameters;n(e)||(e={filter:{}});r(e.filter)&&(e.filter={stringFilter:e.filter});n(e.filter)||(e.filter={});e.filter[a.name]=c[b][a.name].selectedOption.value;d.web_service.parameters=e;this.setWebServiceSelectOptions(d,b,c,d.web_service)}},getFormElementDefinition:function(a,b,c){c=c[b];b=0;for(var d,e;b<c.rows.length;){for(d=0;d<c.rows[b].fields.length;){if(c.rows[b].fields[d].name===
a)return c.rows[b].fields[d];if("undefined"!=typeof c.rows[b].fields[d].buttons)for(e=0;e<c.rows[b].fields[d].buttons.length;){if(c.rows[b].fields[d].buttons[e].name===a)return c.rows[b].fields[d].buttons[e];e++}d++}b++}},getAllFormElementDefinition:function(a,b){b=b[a];a=[];for(var c=0,d;c<b.rows.length;){for(d=0;d<b.rows[c].fields.length;)a.push(b.rows[c].fields[d]),d++;c++}return a},setWebServiceSelectOptions:function(d,g,h,k,m){var f=this;h=h[g];var t=c.defer(),v;b.oFormPromises[g].push(t.promise);
if(null==d)return console.error("oFormElementDefinition not defined"),0;if(null==g)return console.error("sFormDefinitionName not defined"),0;if(null==h)return console.error("oFormValues not defined"),0;if(null==k)return console.error("oWebService not defined"),0;n(h)||(console.error("oFormValues["+g+"] not defined"),h={});this.getWebServiceData(k).then(function(c){if(null==c)return null;var p,w,F,H="",B,R=k.label_key,N=k.id_key,P=[];B=h[d.name];if(ea(B))P[0]=String(B);else if(r(B)&&""!==B)P=B.split("|");
else if(ha(B)&&q(B.options))for(var K in B.options)P.push(B.options[K].value);p=0;w={selectedOption:[],options:[]};F={selectedOption:[],options:[]};"double_select"===d.type?(H=d.name_from,B=d.name_to):B=d.name;for(;p<c.length;)n(c[p][R])?n(c[p][N])?(v=Number(c[p][N]),isNaN(v)||!parseInt(v,10)!==v&&(parseInt(v,10)!==v||0==String(c[p][N]).substr(0,1))||(c[p][N]=v),-1!==P.indexOf(String(c[p][N]))||""===H?F.options.push({label:c[p][R],value:c[p][N]}):w.options.push({label:c[p][R],value:c[p][N]})):(console.error("result."+
N+" does not exist, check the id_key param on the JSON file"),c[p][N]=null):(console.error("result."+R+" does not exist, check the label_key param on the JSON file"),c[p][R]=null),p++;if(""!==H)h[H]=w;else{if(null!=m)F.selectedOption=m;else{if("select"===d.type||"editable_select"===d.type){c=angular.copy(h[d.name]);var G;null!==c&&ha(c)&&(c=c.selectedOption.value,G=h[d.name].selectedOption.label);"undefined"===typeof c&&"undefined"!==typeof d.default_value&&(c=d.default_value,r(c)&&f.isFunctionCall(c)&&
(c=f.callFunction(c)));c=n(c)?c:null;G=n(G)?G:"";F.selectedOption={value:c,label:G}}if("list"===d.type)if(c=angular.copy(h[d.name]),null!=c&&q(c.selectedOption)&&(c=c.selectedOption),null!=c&&"undefined"!==typeof d.default_value&&(c=d.default_value,r(c)&&f.isFunctionCall(c)&&(c=f.callFunction(c))),q(c)&&0<c.length)F.selectedOption=c;else for(G=[],r(c)&&(G=c.split("|")),ea(c)&&(G=[c]),F.selectedOption=[],K=0;K<G.length;K++)for(c=0;c<F.options.length;c++)F.options[c].value==G[K]&&(ea(F.options[c].value)&&
r(G[K])&&(G[K]=parseFloat(G[K])),F.selectedOption.push({value:G[K],label:F.options[c].label}))}if(null!=d.options){K=0;c=[];for(var ba=[];K<d.options.length;)G=d.options[K].split("|"),c.push(G[0]),ba.push(G[1]),K++;a(c).then(function(a){var b=Object.keys(a);for(K=0;K<b.length;)F.options.unshift({label:a[b[K]],value:ba[K]}),K++})}if(!0!==d.required&&"true"!==d.required){G=!1;for(K=0;K<F.options.length;K++)""===F.options[K].value&&(G=!0);G||F.options.unshift({label:"",value:""})}}h[B]=F;if("editable_select"!==
d.type){G=!1;for(K=0;K<h[B].options.length;K++)F.selectedOption.value===h[B].options[K].value&&(F.selectedOption.label=h[B].options[K].label,G=!0);G||(delete h[B].selectedOption.value,delete h[B].selectedOption.label)}null!=h[B]||(h[B]={});null!=h[B].selectedOption||(h[B].selectedOption={});null==h[B].selectedOption.value&&(h[B].selectedOption.value="",h[B].selectedOption.label="");"list"===d.type&&ha(h[B].selectedOption)&&!q(h[B].selectedOption)&&(h[B].selectedOption=[h[B].selectedOption]);this.oFormValues=
h;this.sFormDefinitionName=g;e.oFormDefaultValues[g]=f.copyFormValues(h);"undefined"!==typeof k.callback&&f.isFunctionCall(k.callback)&&f.callFunction(k.callback);b.$emit("webServiceSelectOptionsloaded");t.resolve()})},getWebServiceData:function(a){var d=this.oProperties,e={},f=c.defer();if(null==a)return console.error("oWebService not defined"),0;n(a.parameters)&&(e=a.parameters,"businessObject"===a.dataType&&null!=e.attributs&&delete e.attributs,n(a.parameters.filter)||n(a.parameters.filter_extension))&&
(a.parameters.filter=this.parseFilter(a.parameters.filter),""===a.parameters.filter&&delete a.parameters.filter);z({method:"POST",url:d.web_server_name+"/"+d.services_alias+"/"+a.ressource_id,data:e,scope:b,headers:{"X-HTTP-Method-Override":"GET",Accept:"application/x-vm-json"},success:function(b){null!=a.parameters&&(a.parameters.filter=a.parameters.original_filter);b=b.data;b.data=n(b.data)?b.data:[];if(1===b.status){var c;if(null!=a.subObject){c=[];for(var d=0;d<b.data.length;d++)null!=b.data[d][a.subObject]&&
c.push(b.data[d][a.subObject])}else c=n(b.data)?b.data:[]}f.resolve(c)}});return f.promise},emptySelectOptions:function(a,b,c){a="double_select"===a.type?a.name_to:a.name;null!=c[b]&&null!=c[b][a]&&null!=c[b][a].options&&(c[b][a]="");this.oFormValues=c;null!=e.oFormDefaultValues&&null!=e.oFormDefaultValues[b]&&(e.oFormDefaultValues[b]=this.copyFormValues(c))},callFunction:function(a){if(null==a)return console.error("callFunction: no function defined"),0;if(0< !a.length)return console.error('callFunction: function === ""'),
0;var c="",e=[];if(-1!==a.indexOf("(")){c=a.substr(a.indexOf("("));c=c.substr(1,c.length-2);0<c.length&&(e=c.split(","));for(var f=0;f<e.length;f++)r(e[f])&&(e[f]=e[f].trim())}for(f=0;f<e.length;f++)this.isFunctionCall(e[f])&&(e[f]="'"+this.callFunction(e[f])+"'");0<e.length&&(a=a.replace(c,e.join(",")));var c=a.substr(0,a.indexOf("(")),m;this.eventsContainer=this.oFormEventsContainer;this.rootScope_=b;if("function"==typeof eval("window."+c))try{d.log(a),m=eval(a)}catch(p){!0===this.oProperties.debug_mode&&
console.error(p)}else if("undefined"!=typeof this.eventsContainer&&"function"==typeof this.eventsContainer[c])try{d.log("eventsContainer."+a),m=eval("this.eventsContainer."+a)}catch(p){!0===this.oProperties.debug_mode&&console.error(p)}else if("function"==typeof this[c])try{d.log("this."+a),m=eval("this."+a)}catch(p){!0===this.oProperties.debug_mode&&console.error(p)}else if("undefined"!=typeof this.rootScope_&&"function"==typeof this.rootScope_[c])try{d.log("$rootScope."+a),m=eval("this.rootScope_."+
a)}catch(p){!0===this.oProperties.debug_mode&&console.error(p)}return m},isFunctionCall:function(a,c){"undefined"==typeof c&&(c=!0);var e=!1;"string"===typeof a&&(aMatchResult=a.match(/(.+)\((.*)\)/),null!==aMatchResult&&(c?(c=a.substr(0,a.indexOf("(")),"function"==typeof c?e=!0:"undefined"!=typeof this.oFormEventsContainer&&"function"==typeof this.oFormEventsContainer[c]?e=!0:"function"==typeof this[c]?e=!0:"function"==typeof b[c]&&(e=!0),e||d.warn("Function not found : "+a)):e=!0));return e},selectFirstOption:function(a,
b,c){b=n(b)?b:this.oFormValues;c=n(c)?c:this.sFormDefinitionName;b=b[c];0<b[a].options.length&&(b[a].selectedOption.value=b[a].options[0].value)},setSelectOptions:function(b,c,h,k){function f(a,b){var c=[];if(!q(a))return console.error("getFormatedOptions: aKeys is not an array",a),c;if(!q(b))return console.error("getFormatedOptions: aKeys is not an array",b),c;if(a.length!==b.length)return console.error("getFormatedOptions: aKeys.length !== aValues.length",a,b),c;for(var d=0;d<a.length;d++)c.push({label:a[d],
value:b[d]});return c}d.log("setSelectOptions");var g=0,t,v,w={selectedOption:{value:""},options:[]},x,y,F;k=n(k)?k:b.options;var H=[],B=[];for(r(k)&&(k=k.split(","));g<k.length;)v=k[g].split("|"),t=v[0],H.push(t),t=1<v.length?v[1]:t,B.push(t),g++;g=h[c][b.name];if("list"===b.type&&r(g)&&(k=g.split("|"),0<k.length)){t=[];for(g=0;g<k.length;g++)t.push({label:"",value:k[g]});g={selectedOption:t}}"undefined"===typeof g&&"undefined"!==typeof b.default_value&&(g=b.default_value,"string"===typeof g&&this.isFunctionCall(g)&&
(g=this.callFunction(g)));null!=g&&(null!=g.selectedOption?(null!=g.selectedOption.value&&(w=g),q(g.selectedOption)&&(w=g)):w.selectedOption.value=String(g));a(H).then(function(a){for(var d=0;d<H.length;d++)isNaN(H[d])&&(H[d]=a[H[d]]);w.options=f(H,B);if("double_select"===b.type){y=b.name_from;F=b.name_to;var g=angular.copy(H),k=angular.copy(B);a=[];for(var p=[],d=k.length-1;0<=d;d--)p.unshift(k[d]),a.unshift(g[d]),k.splice(d,1),g.splice(d,1);d={options:f(g,k)};a={options:f(a,p)};h[c][y]=d;h[c][F]=
a}else x=b.name,h[c][x]=w;"undefined"===typeof e.oFormDefaultValues[c]&&(e.oFormDefaultValues[c]={});"undefined"==typeof e.oFormDefaultValues[c][x]&&(e.oFormDefaultValues[c][x]=angular.copy(w))})},selectOptionAfterLoad:function(a,b,c,d,e){if("double_select"!==b.type)if("select"===b.type){b=a[c][d].options;for(var f=0;f<b.length;f++)if(b[f].value===e){a[c][d].sM=b[f];break}}else"list"!==b.type&&console.error("this element is not a select")},extractWebServiceData:function(a,b){var c=[];"undefined"!==
typeof b[a]&&(Array.isArray(b[a])?0<b[a].length&&(c=b[a]):c=b[a]);return c},parseFilter:function(a){if(ha(a)){var b=!1;null!=a.operators&&null!=a.relation&&(b=!0);null!=a.column&&null!=a.compare_operator&&null!=a.value&&(b=!0);if(!b){var b=[],c,d;for(d in a)if("stringFilter"===d)b.push(a[d]);else if(c=a[d],""!==c&&(this.isFunctionCall(c)&&(c=this.callFunction(c)),n(c))){var e="=";r(c)&&"not null"===c.toLowerCase().trim()&&(e="!=",c="NULL");b.push({column:d,compare_operator:e,value:c})}if(0<b.length)for(a=
{relation:"AND",operators:[]},d=0;d<b.length;d++)a.operators.push(b[d]);else a=""}}return a},setWebServiceTags:function(a,c,d){var f=angular.copy(a.web_service),g=f.ressource_id.split("/");d=d[c];var h=this,t={};"undefined"!==typeof f.parameters&&(t=f.parameters,"undefined"!==typeof f.parameters.filter&&(f.parameters.filter=this.parseFilter(f.parameters.filter),""===f.parameters.filter&&delete f.parameters.filter));z({method:"POST",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+
"/"+f.ressource_id,headers:{"X-HTTP-Method-Override":"GET"},data:t,scope:b,success:function(k){k=k.data;if(1===k.status){k=h.extractWebServiceData(g[1],k);var p=[];"string"===typeof d[a.name]&&(p=d[a.name].split(","));for(var m=f.id_key,t=0,v=[];t<k.length;)-1===p.indexOf(k[t][m])&&v.push(k[t][m]),t++;d[a[["name_available_tags"]]]=v.join(",");"undefined"==typeof e.oFormDefaultValues[c][a[["name_available_tags"]]]&&(e.oFormDefaultValues[c][a[["name_available_tags"]]]=angular.copy(d[a[["name_available_tags"]]]));
b.$emit("webServiceTagsloaded",a)}}})},checkFormModifications:function(a){var b=c.defer(),d=b.promise;if("insert"!=e.sMode&&"update"!=e.sMode||"undefined"==typeof a)b.resolve();else if(a=e.oFormDefinition[a],"undefined"!=typeof a&&"undefined"!=typeof a.event){a=a.name;var f=angular.element("form[name='"+a+"']");0<f.length?(f=f.scope(),f[a].$dirty&&!f[a].$submitted?f.$root.modalWindow("confirm","FORM_MODIFIED_WARNING_TITLE",{className:"modal-warning",message:"FORM_MODIFIED_WARNING",callback:function(a){a&&
b.resolve()}}):b.resolve()):b.resolve()}else b.resolve();return d},checkStudioFormModifications:function(){var a=c.defer(),d=a.promise;"vmap"===X.eh()?!0===X.Cx()?b.modalWindow("confirm","FORM_MODIFIED_WARNING_TITLE",{className:"modal-warning",message:"FORM_MODIFIED_WARNING",callback:function(b){b&&a.resolve()}}):a.resolve():a.resolve();return d},getFormValueFromObject:function(a,b){d.info("getFormValueFromObject");var c=this.copyFormValues(a);b.split(".").forEach(function(a){c=c[a]});return c},copyFormValues:function(a){d.info("copyFormValues");
var b={};try{b=angular.copy(a)}catch(m){for(var c in a)try{b[c]=angular.copy(a[c])}catch(p){if(ha(a[c])){b[c]={};for(var e in a[c])try{b[c][e]=angular.copy(a[c][e])}catch(t){}}}}return b},getFormValue:function(a){d.info("getFormValue");if(!r(a))return null;a=a.trim();var b=this.oFormValues[this.sFormDefinitionName];if(null==b)return null;a=b[a.trim()];null!=a.selectedOption&&null!=a.selectedOption.value&&(a=a.selectedOption.value);return a},concat:function(){d.info("concat");for(var a="",b=0;b<arguments.length;b++)r(arguments[b])&&
(a+=arguments[b]);return a},getBusinessObjectDef:function(d){var e=c.defer();cd();z({method:"GET",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/vmap/businessobjects/"+d,scope:b,headers:{Accept:"application/x-vm-json"},success:function(b){dd();if(!n(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(!n(b.data.data)||!n(b.data.data[0])||!n(b.data.data[0].business_object_id))return 0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),
0;e.resolve(b.data.data[0])},error:function(a){dd();console.error(a);bootbox.alert(a)}});return e.promise},showModalSubform:function(a,b,c,d,e){var f=this.sToken,g=this.oProperties;null!=b.loadSubForm&&(b.loadSubForm({sFormDefinitionName:d,oFormDefinition:c,oFormValues:e,oProperties:g,sToken:f}),$("#"+a).modal("show"))},updateBoElement:function(c,d,e,k,m,p){var f=angular.element(u.f).injector().get(["envSrvc"]),g=angular.element(u.f).injector().get(["formSrvc"]);d=[d.bo_id_field];f.oFormValues=m;
f.oFormDefinition=e;f.sFormDefinitionName=k;e=g.getFormData(k,!0);for(f=0;f<d.length;f++)null!=m[k][d[f]]&&(e[d[f]]=m[k][d[f]]);k=new FormData;for(var h in e)null!=e[h].aFiles?(k.append(h+"_attached_content",e[h].aFiles[0]),k.append(h,e[h].aFiles[0].name)):k.append(h,e[h]);z({method:"PUT",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/vmap/querys/"+c,data:k,scope:b,success:function(b){if(!n(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),
0;if(n(b.status)&&500===b.status)return bootbox.alert(b.statusText),0;p.call()},error:function(a){bootbox.alert(a);console.error(a)}})},insertBoElement:function(c,d,e,k,m,p){var f=angular.element(u.f).injector().get(["envSrvc"]),g=angular.element(u.f).injector().get(["formSrvc"]);d=[d.id_field];f.oFormValues=m;f.oFormDefinition=e;f.sFormDefinitionName=k;e=g.getFormData(k,!0);for(f=0;f<d.length;f++)null!=m[k][d[f]]&&(e[d[f]]=m[k][d[f]]);k=new FormData;for(var h in e)null!=e[h].aFiles?(k.append(h+"_attached_content",
e[h].aFiles[0]),k.append(h,e[h].aFiles[0].name)):k.append(h,e[h]);z({method:"POST",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/vmap/querys/"+c,data:k,scope:b,success:function(b){if(!n(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;if(n(b.status)&&500===b.status)return bootbox.alert(b.statusText),0;p.call()},error:function(a){bootbox.alert(a);console.error(a)}})},deleteBoElements:function(c,
d,e){z({method:"DELETE",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/vmap/querys/"+c,params:{idList:d.join("|")},scope:b,success:function(b){if(!n(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;if(n(b.status)&&500===b.status)return bootbox.alert(b.statusText),0;e.call()},error:function(a){bootbox.alert(a);console.error(a)}})},getSectionDef:function(d){var e=c.defer();z({method:"GET",
url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/vitis/vitissections/"+d,scope:b,success:function(b){if(!n(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(!n(b.data.data)||!n(b.data.data[0])||!n(b.data.data[0].ressource_id))return a("NO_SECTION_FOUNDED").then(function(a){bootbox.alert(a)}),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;e.resolve(b.data.data[0])},error:function(a){bootbox.alert(a);console.error(a)}});
return e.promise},getSectionRessourceTab:function(d){var e=c.defer();z({method:"GET",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/vitis/ressources/"+d,headers:{Accept:"application/json"},scope:b,success:function(b){if(!n(b.data)||!n(b.data.ressources)||!n(b.data.ressources[0]))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;e.resolve(b.data.ressources[0])},error:function(a){bootbox.alert(a);
console.error(a)}});return e.promise},getSectionRessourceData:function(d,e){var f=c.defer(),g={limit:100};null!=e&&""!==e&&(g.filter=e);z({method:"GET",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/"+d,params:g,scope:b,success:function(b){if(!n(b.data)||!n(b.data.data)||!n(b.data.data[0]))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;f.resolve(b.data.data)},error:function(a){bootbox.alert(a);
console.error(a)}});return f.promise},getSectionForm:function(d,e){e=null!=e?e:!1;var f=c.defer();z({method:"GET",url:"modules/"+d.module_name+"/forms/"+d.mode_id+"/"+(1<d.index?d.mode_id+"_"+d.tab_name+"_"+d.name+".json":d.mode_id+"_"+d.tab_name+".json"),scope:b,success:function(b){if(!n(b.data))return a("NO_FORM_FOUNDED").then(function(a){bootbox.alert(a)}),0;b=b.data;if(e)for(var c in b)if(null!=b[c]&&null!=b[c].rows)for(var d=b[c].rows.length-1;0<=d;d--)if(null!=b[c].rows[d].fields)for(var g=
b[c].rows[d].fields.length-1;0<=g;g--)"button"===b[c].rows[d].fields[g].type&&b[c].rows[d].fields.splice(g,1);f.resolve(b)},error:function(a){bootbox.alert(a);console.error(a)}});return f.promise},updateSectionElement:function(d,e,h,k,m){var f=c.defer();e=m[k][e];var g=angular.element(u.f).injector().get(["envSrvc"]),v=angular.element(u.f).injector().get(["formSrvc"]);g.oFormValues=m;g.oFormDefinition=h;g.sFormDefinitionName=k;h=v.getFormData(g.sFormDefinitionName);z({method:"PUT",url:null!=e?this.oProperties.web_server_name+
"/"+this.oProperties.services_alias+"/"+d+"/"+e:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/"+d,data:h,scope:b,success:function(b){if(!n(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;if(n(b.status)&&500===b.status)return bootbox.alert(b.statusText),0;f.resolve(b.data)},error:function(a){console.error(a);bootbox.alert(a)}});return f.promise},insertSectionElement:function(d,
e,h,k,m){var f=c.defer();e=angular.element(u.f).injector().get(["envSrvc"]);var g=angular.element(u.f).injector().get(["formSrvc"]);e.oFormValues=m;e.oFormDefinition=h;e.sFormDefinitionName=k;h=g.getFormData(e.sFormDefinitionName);z({method:"POST",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/"+d,data:h,scope:b,success:function(b){if(!n(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),
0;if(n(b.status)&&500===b.status)return bootbox.alert(b.statusText),0;f.resolve(b.data)},error:function(a){console.error(a);bootbox.alert(a)}});return f.promise},deleteSectionElements:function(d,e){var f=c.defer();z({method:"DELETE",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/"+d,params:{idList:e.join("|")},scope:b,success:function(b){if(!n(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),
0;if(n(b.status)&&500===b.status)return bootbox.alert(b.statusText),0;f.resolve(b.data)},error:function(a){console.error(a);bootbox.alert(a)}});return f.promise},disableFormElement:function(a,b,c){if(null==a)return console.error("oFormDefinition not defined"),null;if(null==b)return console.error("sElement not defined"),null;c=null!=c?[c]:Object.keys(a);for(var d=0;d<c.length;d++)if(null!=a[c[d]]&&q(a[c[d]].rows))for(var e=0;e<a[c[d]].rows.length;e++)if(null!=a[c[d]].rows[e].fields)for(var f=0;f<a[c[d]].rows[e].fields.length;f++)a[c[d]].rows[e].fields[f].name===
b&&(a[c[d]].rows[e].fields[f].disabled=!0);return a},extractFormDefinitionInfos:function(a){angular.element("form[name='"+a+"']").scope().ctrl.lo()}}}Wy.$inject=["$translate","$rootScope","$q","$log","envSrvc"];Iy.module.service("formReaderService",Wy);u.Px=function(a,b,c,d,e,f,g,h){a.getMainTemplateUrl=function(){return d.sMainTemplateUrl};a.disconnect=function(){e.disconnect()};a.$root.clearFormData=function(a,c){b.info("clearFormData");d.toGarbageCollection(d.oFormDefinition[a]);d.oFormDefinition[a]=null;d.oFormDefinition[a]={};d.toGarbageCollection(d.oFormValues[a]);d.oFormValues[a]=null;d.oFormValues[a]={};delete c.oFormDefinition;delete c.oFormValues;delete c.oProperties;delete c.oFormEventsContainer};a.$root.connectFromUrl=function(c){b.info("connectFromUrl");
z({method:"POST",url:oClientProperties.web_server_name+"/"+oClientProperties.services_alias+"/"+e.web_service+"/"+e.web_service_controller,scope:a,data:{user:c.login,password:c.password,duration:e.duration},success:function(a){1==a.data.status?(e.token=a.data.token,e.validity_date=a.data.validity_date,sessionStorage.session_token=e.token,g.login=c.login,g.id=parseInt(a.data.user_id),g.privileges=a.data.privileges,sessionStorage.user_login=c.login,sessionStorage.user_id=g.id,sessionStorage.privileges=
g.privileges,e.saveSessionToLocalStorage(),k.resolve()):e.disconnect()}})};h(["CONFIRM_OK","CONFIRM_CANCEL","CONFIRM_CONFIRM"]).then(function(a){bootbox.addLocale("fr",{OK:a.CONFIRM_OK,CANCEL:a.CONFIRM_CANCEL,CONFIRM:a.CONFIRM_CONFIRM})});var k=c.defer();c=k.promise;var m=Object.keys(oUrlParams);null===e.getAppLocalStorageItem("session_token")&&-1!==m.indexOf("login")&&-1!==m.indexOf("password")?a.$root.connectFromUrl(oUrlParams):k.resolve();c.then(function(){var b=e.getAppLocalStorageItem("session_token");
null!==b?(f=_.extendOwn(f,oClientProperties),"unstable"!=f.status?(sessionStorage.session_token=b,z({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/vitis/privatetoken",scope:a,success:function(a){1==a.data.status?f.getFromServer().then(function(){h.use(f.language);bootbox.setLocale(f.language);e.restoreSessionFromAppLocalStorage();e.token=b;g.login=sessionStorage.user_login;g.id=parseInt(sessionStorage.user_id);g.privileges=a.data.privileges;sessionStorage.privileges=a.data.privileges;
f.app_name=sessionStorage.application.toLowerCase().charAt(0).toUpperCase()+sessionStorage.application.slice(1);document.title=f.app_name.toUpperCase();"undefined"!=typeof sessionStorage.environment&&(f.environment=sessionStorage.environment);e.connect()}):e.disconnect()}})):e.disconnect()):(e.clearSessionStorage(),f=_.extendOwn(f,oClientProperties),f.getFromServer().then(function(){h.use(f.language);bootbox.setLocale(f.language);f.app_name=sessionStorage.application.toLowerCase().charAt(0).toUpperCase()+
sessionStorage.application.slice(1);a.translationData={app_name:f.app_name};document.title=f.app_name.toUpperCase();a.$evalAsync(function(){});d.sMainTemplateUrl="templates/loginTpl.html";d.sFormDefinitionName="login_form"}))})};u.Px.$inject="$scope $log $q envSrvc sessionSrvc propertiesSrvc userSrvc $translate".split(" ");u.module.controller("initCtrl",u.Px);u.sy=function(a,b,c,d,e,f,g,h,k,m,p,t,v){e.oFormDefinition={};e.oFormValues={};e.oSectionForm=k.oSectionForm;e.gridOptions={};e.gridApi={};a.oProperties=t;a.aDropdownMenu=[{event:"selectMode('user')",label:"USER_INFOS"}];less.refresh();moment.locale(t.language);c(["USER"],{sUserLogin:p.login}).then(function(b){a.sUserLoginText=b.USER});m.loadModes().then(function(){a.modes=m.modes;e.sSelectedObjectName=k.oSelectedObject.name;k.sSelectedSectionName="";a.objects=m.modes[0].objects;null!=oUrlParams.mode_id?
setTimeout(function(){m.selectMode(a,oUrlParams.mode_id);setTimeout(function(){$(".mode_selected").removeClass("mode_selected");$("#mode_"+oUrlParams.mode_id).addClass("mode_selected")},500)}):m.selectMode(a,m.modes[0].mode_id);null!=oUrlParams.object_id&&null!=oUrlParams.mode_id&&(m.selectObject(a,oUrlParams.object_id,oUrlParams.mode_id),e.$on(oUrlParams.object_id+"_form",function(){if(null!=oUrlParams.action&&null!=oUrlParams.ids){var a=oUrlParams.ids.split("|")[0];setTimeout(function(){angular.element(u.X).scope().$root[oUrlParams.action](a)},
1E3)}}))});a.editObjectElement=function(a,b,c){this.actionOnObjectElement(a,b,c,"editSectionForm")};a.executeEvent=function(b,c){a.$eval(c)};a.displayObjectElement=function(a,b,c){this.actionOnObjectElement(a,b,c,"showSectionForm")};a.actionOnObjectElement=function(a,c,d,f){m.scope.selectObject(c,a);var g=e.$on(c,function(){null!=f&&null!=d&&b(function(){angular.element(u.X).scope().$root[f](d)},500);g()})};a.selectMode=function(c,d){m.selectMode(a,c,d).then(function(){b(function(){v.resizeWin();
a.setFullScreen(k.oSelectedMode.fullScreen);sessionStorage.ajaxLoader=k.oSelectedMode.ajaxLoader;var b=a.$root.gridApi[a.sSelectedGridOptionsName];null!=b&&b.core.handleWindowResize()},100)})};a.selectObject=function(c,d,e){if(null!=d&&k.oSelectedMode.mode_id!==d){var f,g=m.getMode(d);if(null==g.objects)return console.error(c+" is not object of "+d),0;for(var h=0;h<g.objects.length;h++)g.objects[h].name===c&&(f=angular.copy(h));if(null==f)return console.error(c+" is not object of "+d),0;m.selectMode(a,
d,e,f).then(function(){b(function(){a.setFullScreen(k.oSelectedMode.fullScreen);sessionStorage.ajaxLoader=k.oSelectedMode.ajaxLoader},100);var c=a.$root.gridApi[a.sSelectedGridOptionsName];null!=c&&c.core.handleWindowResize()})}else m.selectObject(a,c,d,e)};e.compileObjectTemplate=function(b){f(b).then(function(b){g($("#container_mode_"+k.oSelectedMode.mode_id).html(b).contents())(a);$("#data_column .container-mode").hide();$("#container_mode_"+k.oSelectedMode.mode_id).show()});h.info("compileObjectTemplate : "+
b)};e.loadList=function(a,b){h.info("loadList");k.sMode="search";if("undefined"!==typeof b){""===b.lang&&(b.lang=t.language);var c={relation:"AND",operators:[]},d;for(d in b)c.operators.push({column:d,compare_operator:"=",value:b[d]});k.oSelectedObject.filter=c}if(null!==a)var f=e.$on("workspaceListTplCompiled",function(){e.$eval(a);f()})};e.showModeScrollBoutton=function(){return document.getElementById("mode_column").scrollHeight>document.getElementById("mode_column").clientHeight};e.scrollMode=
function(a){$("#mode_column").animate({scrollTop:$("#mode_column").scrollTop()+a},200)}};u.sy.$inject="$scope $timeout $translate $translatePartialLoader $rootScope $templateRequest $compile $log envSrvc modesSrvc userSrvc propertiesSrvc externFunctionSrvc".split(" ");u.module.controller("mainCtrl",u.sy);u.yB=function(a,b,c,d,e){b.info("initWorkspaceList");a.$emit("initWorkspaceList",a);e.addScopeToObject(c.oSelectedObject.name,c.oSelectedMode.mode_id,a);a.edit_column=c.oSelectedObject.edit_column;a.show_column=c.oSelectedObject.show_column;var f;0===Object.keys(a.gridOptions).length&&(b.info("Init GridOptions"),a.gridOptions={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:d.rows_per_page,enableColumnMenus:!1,enableColumnResizing:!0,
paginationPageSizes:[5,10,20,50,100,200,500],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!0,appHeaderOptionBar:!1,appLoadGridData:!0,appGridTitle:c.oSelectedObject.label,appResizeGrid:!1,appFooter:!0,appShowPagination:!0,appEnableDragAndDrop:!1,appDragAndDropEvent:{},appActions:[],appShowActions:!0,exporterCsvFilename:new String(c.oSelectedObject.label)});var g=c.oSelectedObject.name;a.sSelectedObjectName=g;a.sSelectedSectionName=c.sSelectedSectionName;c.sSelectedGridOptionsName=g;""!=c.sSelectedSectionName&&
(c.sSelectedGridOptionsName+="_"+c.sSelectedSectionName);a.sSelectedGridOptionsName=c.sSelectedGridOptionsName;c.oGridOptions[c.sSelectedGridOptionsName]=a.gridOptions;"undefined"===typeof c.oDefaultGridOptions[c.sSelectedGridOptionsName]&&(c.oDefaultGridOptions[c.sSelectedGridOptionsName]=angular.copy(a.gridOptions));"undefined"===typeof c.oWorkspaceList[c.sSelectedGridOptionsName]?c.oWorkspaceList[c.sSelectedGridOptionsName]={}:("undefined"!==typeof c.oWorkspaceList[c.sSelectedGridOptionsName].oFilter&&
(f=angular.copy(c.oWorkspaceList[c.sSelectedGridOptionsName].oFilter)),"undefined"!==typeof c.oWorkspaceList[c.sSelectedGridOptionsName].oFormValue&&(c.oFormValues[c.sFormDefinitionName]=angular.copy(c.oWorkspaceList[c.sSelectedGridOptionsName].oFormValue)));"undefined"!==typeof f&&(a.gridOptions.oFilter=f);"undefined"!==typeof c.oGridOptionsCopy[c.sSelectedGridOptionsName]&&(a.gridOptions.oUrlParams=angular.copy(c.oGridOptionsCopy[c.sSelectedGridOptionsName].oUrlParams));!0===a.gridOptions.appEnableDragAndDrop&&
(a.gridOptions.rowTemplate='<div grid="grid" class="ui-grid-draggable-row" draggable="true"><div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader, \'custom\': true }" ui-grid-cell></div></div>');var h=c.getSectionWebServiceResourceId(),k=0;"undefined"!==typeof c.oSectionForm&&"undefined"!==typeof c.oSectionForm[c.oSelectedObject.name]&&"undefined"!==typeof c.oSectionForm[c.oSelectedObject.name].iSelectedSectionIndex&&
(k=c.oSectionForm[c.oSelectedObject.name].iSelectedSectionIndex);0<k&&delete c.oSelectedObject.sections[0].columns;if(null!==h&&"undefined"===typeof a.gridOptions.columnDefs)if(null!=c.oSelectedObject.sections[k].columns){c.oGridOptions[c.sSelectedGridOptionsName].paginationCurrentPage=c.oWorkspaceList[c.sSelectedGridOptionsName].oldPaginationSave;a.gridOptions.columnDefs=c.oSelectedObject.sections[k].columns.slice(0);for(var m=0;m<a.gridOptions.columnDefs.length;m++)a.gridOptions.columnDefs[m].cellEditableCondition=
!1;"display"!=c.sMode&&(a.gridOptions.appActions=c.oSelectedObject.sections[k].actions.slice(0));a.$root.$emit("workspaceListHeaderActionsAdded",a.gridOptions)}else c.oWorkspaceList[c.oSelectedObject.name].oldPaginationSave=1,z({method:"GET",url:d.web_server_name+"/"+d.services_alias+"/vitis/ressources/"+h,scope:a,success:function(d){if(1===d.data.status){var e=c.explodeWebServiceResourceId(h),f=d.data.ressources[0][e[1]][0].columns;if(0<f.length){f=a.$root.formatGridColumn(f,g);b.info(a.$root.formatGridColumn(f,
g));c.oSelectedObject.sIdField=f[0].field;if("undefined"==typeof a.gridOptions.appShowActions||!1!==a.gridOptions.appShowActions)null===c.oSelectedObject.edit_column&&null===c.oSelectedObject.show_column||f.unshift({name:"",field:"actions",cellTemplate:"<app-ui-grid-action></app-ui-grid-action>",width:60,enableSorting:!1,enableColumnMoving:!1,enableColumnResizing:!1});c.oSelectedObject.sections[k].columns=f.slice(0);a.gridOptions.columnDefs=c.oSelectedObject.sections[k].columns.slice(0);for(f=0;f<
a.gridOptions.columnDefs.length;f++)a.gridOptions.columnDefs[f].cellEditableCondition=!1;d=d.data.ressources[0][e[1]][1].actions;c.oSelectedObject.sections[k].actions="undefined"!==typeof d?a.$root.formatGridAction(d,g):[];"display"!=c.sMode&&(a.gridOptions.appActions=c.oSelectedObject.sections[k].actions.slice(0));a.$root.$emit("workspaceListHeaderActionsAdded",a.gridOptions)}}}});a.showExportModal=function(){b.info("showExportModal");$("#ExportModal").modal("show");c.oGridOptions[c.sSelectedGridOptionsName].oUrlParams.limit=
1E4};a.exportCSVFormat=function(){b.info("ExportCSVFormat");var e=c.getSectionWebServiceResourceId(),f=c.explodeWebServiceResourceId(e),e=c.oGridOptions[c.sSelectedGridOptionsName].oUrlParams,g=document.getElementById("SelectValue"),h=g.options[g.selectedIndex].text,k=a.gridOptions.exporterCsvFilename+".xlsx",y=a.gridOptions.exporterCsvFilename+".csv",F=[],H=[];for(m=0;m<c.oSelectedObject.sections[0].columns.length;m++)""!==c.oSelectedObject.sections[0].columns[m].name&&F.push(c.oSelectedObject.sections[0].columns[m]);
z({method:"GET",url:d.web_server_name+"/"+d.services_alias+"/"+f[0]+"/"+f[1],params:angular.copy(e),scope:a,success:function(a){if(1===a.data.status){var b=a.data[f[1]];for(m=0;m<b.length;m++){var c=[],d={};angular.forEach(F,function(b){d=null!==a.data[f[1]][m][b.field]?a.data[f[1]][m][b.field]:"null";""===a.data[f[1]][m][b.field]&&(d="null");c[b.field]=d});H.push(c)}".XLSX"===h&&alasql("SELECT * INTO XLSX('"+k+"' ,{headers:true}) FROM ? ",[H]);".CSV"===h&&alasql("SELECT * INTO CSV('"+y+"' ,{headers:true}) FROM ? ",
[H])}}})}};u.yB.$inject="$scope $log envSrvc propertiesSrvc modesSrvc uiGridExporterService".split(" ");u.module.controller("workspaceListCtrl",u.yB);u.oA=function(a,b,c,d,e,f){b.info("initSimpleForm");f.addScopeToObject(e.oSelectedObject.name,e.oSelectedMode.mode_id,a);a.bFormValidationMessage=!0;var g=c.$on("formDefinitionLoaded",function(){var a=e.oFormDefinition[e.sFormDefinitionName].title;d([a],e.oFormValues[e.sFormDefinitionName]).then(function(b){e.oFormDefinition[e.sFormDefinitionName].title=b[a]});g()})};u.oA.$inject="$scope $log $rootScope $translate envSrvc modesSrvc".split(" ");u.module.controller("simpleFormCtrl",u.oA);u.Kw=function(a,b,c,d,e,f,g){d.info("initDoubleForm");g.addScopeToObject(f.oSelectedObject.name,f.oSelectedMode.mode_id,a);a.sSelectedObjectName=f.oSelectedObject.name;var h=e.$on("doubleFormCompiled",function(){var e="modules/"+f.oSelectedMode.module_name+"/"+f.sTemplateFolder,g=f.getSectionWebServiceResourceId();null!=g?(g=f.explodeWebServiceResourceId(g),e+=g[1]):e="undefined"!=typeof f.oSelectedObject.template_name?e+f.oSelectedObject.template_name:e+f.oSelectedMode.mode_id;g=e+"RightTpl.html";
b(g).then(function(b){c($("#double_form_right_section_"+f.oSelectedObject.name).html(b).contents())(a)});d.info("compileDoubleFormRightTemplate : "+g);e+="LeftTpl.html";b(e).then(function(b){c($("#double_form_left_section_"+f.oSelectedObject.name).html(b).contents())(a)});d.info("compileDoubleFormLeftTemplate : "+e);h()})};u.Kw.$inject="$scope $templateRequest $compile $log $rootScope envSrvc modesSrvc".split(" ");u.module.controller("doubleFormCtrl",u.Kw);u.Sz=function(a,b,c,d,e,f,g,h,k,m,p){d.info("initSectionForm");p.addScopeToObject(h.oSelectedObject.name,h.oSelectedMode.mode_id,a);e.bLastSectionContainer=!1;a.bFormValidationMessage=!0;var t={};t.sections=h.oSelectedObject.sections;for(f=t.iSelectedSectionIndex=0;f<t.sections.length;)t.sections[f].bLoaded=!1,f++;var v="SECTION_"+h.sMode.toUpperCase()+"_TITLE_"+h.oSelectedObject.name.toUpperCase();g([v],{sId:h.sId}).then(function(a){t.title=a[v]});h.oSectionForm[h.oSelectedObject.name]=t;h.sFormDefinitionName=
h.oSelectedObject.name+"_"+t.sections[0].name+"_"+h.sMode+"_form";h.oSelectedObject.sFormDefinitionName=h.sFormDefinitionName;h.sSelectedSectionName=t.sections[0].name;var w=e.$watch(e.bLastSectionContainer,function(){a.loadObjectSectionTemplate();w()},!1);a.selectSection=function(b,c){"insert"!=h.sMode&&(h.oSectionForm[h.oSelectedObject.name].iSelectedSectionIndex=b,h.sSelectedSectionName=h.oSectionForm[h.oSelectedObject.name].sections[b].name,h.sFormDefinitionName=h.oSelectedObject.name+"_"+h.oSectionForm[h.oSelectedObject.name].sections[b].name+
"_"+h.sMode+"_form",h.oLastSelectedObjectMode[h.oSelectedMode.mode_id].sFormDefinitionName=h.sFormDefinitionName,$("#container_mode_"+h.oSelectedMode.mode_id+" .container-section").hide(),$("#container_section_"+h.oSelectedObject.name+"_"+c.name).show(),a.loadObjectSectionTemplate(),a.$root.$broadcast("updateStudio_"+h.oSelectedObject.name,{index:b,oSectionForm:c}))};a.loadObjectSectionTemplate=function(){var e=h.oSectionForm[h.oSelectedObject.name],f=e.iSelectedSectionIndex,g;g=0==f?h.sSelectedTemplate:
e.sections[f].template;-1==g.indexOf("/")&&(g=h.sTemplateFolder+g);d.info("loadObjectSectionTemplate : "+g);e.sections[f].bLoaded||(a.sSelectedObjectName=h.oSelectedObject.name,c(g).then(function(c){b($("#container_section_"+h.oSelectedObject.name+"_"+e.sections[f].name).html(c).contents())(a)}),d.info("loadObjectSectionTemplate (compilation) : "+g),g=h.oSelectedObject.sections[f].event,"undefined"!=typeof g&&""!=g&&(g=g.replace(/javascript:/i,""),-1==g.indexOf("(")&&(g+="()"),a.$eval(g)));h.oSectionForm[h.oSelectedObject.name].sections[f].bLoaded=
!0;$(".form-map").each(function(a,b){try{angular.element(b).scope().oMap.MapObject.zd()}catch(R){}})}};u.Sz.$inject="$scope $compile $templateRequest $log $rootScope $timeout $translate envSrvc sessionSrvc propertiesSrvc modesSrvc".split(" ");u.module.controller("sectionFormCtrl",u.Sz);u.oy=function(a,b,c,d,e,f,g,h,k,m,p,t){a.showErrorAlert=function(c){b([c]).then(function(b){a.sLoginErrorMessage=b[c];document.getElementById("login_error_alert").style.display="block"})};a.hideErrorAlert=function(){document.getElementById("login_error_alert").style.display="none"};c.oFormDefinition={};c.oFormValues={};g.oSelectedObject={name:"login",sections:[]};less.refresh();"unstable"==h.status&&a.showErrorAlert("FORM_APP_STATUS_ERROR");"UNSTABLE"==h.VM_STATUS&&a.showErrorAlert("FORM_VAS_STATUS_ERROR");
a.oFormRequestParams={sUrl:"forms/login.json"};var v=c.$on("formDefinitionLoaded",function(){v();if("undefined"!=typeof h.domain&&(1<Object.keys(h.domain).length||""!=Object.keys(h.domain)[0])){for(var b=0,c=[{label:"",value:""}],d=Object.keys(h.domain);b<d.length;)""!=d[b]&&h.domain[d[b]]&&c.push({label:d[b],value:h.domain[d[b]]}),b++;for(var d=t.getFormElementDefinition("domain","login_form"),e=[],b=0;b<c.length;b++)e.push(c[b].label+"|"+c[b].value);d.visible=!0;d.options=e;a.$broadcast("$$rebind::refresh");
a.$apply()}});$("#modal_forgotten_password").on("hidden.bs.modal",function(){a.sFormDefinitionName="login_form";a.oFormRequestParams={sUrl:"forms/login.json"};a.$digest()});$("#modal_sign_up").on("hidden.bs.modal",function(){a.sFormDefinitionName="login_form";a.oFormRequestParams={sUrl:"forms/login.json"};a.$digest()});a.showModalForgottenPassword=function(){$("#modal_forgotten_password").modal("show");a.sFormDefinitionName=g.oSelectedObject.name+"_forgotten_password_form";a.oFormRequestParams={sUrl:"forms/forgotten_password.json"};
a.$root.clearFormData(a.sFormDefinitionName,a);a.bLoadFormValues=!1;g.oFormValues[a.sFormDefinitionName]={};m("templates/formTpl.html").then(function(b){p($("#modal_forgotten_password_form_container").html(b).contents())(a)})};a.showModalSignUp=function(){$("#modal_sign_up").modal("show");a.sFormDefinitionName=g.oSelectedObject.name+"_sign_up_form";a.oFormRequestParams={sUrl:"forms/sign_up.json"};a.$root.clearFormData(a.sFormDefinitionName,a);a.bLoadFormValues=!1;g.oFormValues[a.sFormDefinitionName]=
{};m("templates/formTpl.html").then(function(b){p($("#modal_sign_up_form_container").html(b).contents())(a)})};a.sendInscriptionRequest=function(){var c=a.sFormDefinitionName;null!=a.oFormValues[c].captcha?null!=a.oFormValues[c].signupcgi?!1===a.oFormValues[c].signupcgi?b("CHECKCGI").then(function(a){$.notify(a,"error")}):null!=a.oFormValues[c].signuppasswordconfirmation?a.oFormValues[c].signuppasswordconfirmation!==a.oFormValues[c].signuppassword?b("CONFIRMPASSWORD").then(function(a){$.notify(a,
"error")}):(cd(),z({method:"POST",url:h.web_server_name+"/"+h.services_alias+"/vitis/accounts/sign_up",params:{username:a.oFormValues[c].signupusername,fullname:a.oFormValues[c].signupfullname,password:a.oFormValues[c].signuppassword,mail:a.oFormValues[c].signupmail,company:a.oFormValues[c].signuporganization,captcha:a.oFormValues[c].captcha},success:function(d){dd();403===d.status?b("ACCOUNTSERVICENOTAVAILABLE").then(function(a){$.notify(a,"error")}):null!=d.data.status?5===d.data.status?(b("LOGINNOTAVAILABLE").then(function(a){$.notify(a,
"error")}),grecaptcha.reset(),a.oFormValues[c].captcha=null):($("#modal_sign_up").modal("hide"),b("CHECKMAIL").then(function(a){$.notify(a,"success")})):""===d.data?(b("LOGINNOTAVAILABLE").then(function(a){$.notify(a,"error")}),grecaptcha.reset(),a.oFormValues[c].captcha=null):($("#modal_sign_up").modal("hide"),b("CHECKMAIL").then(function(a){$.notify(a,"success")}))},error:function(){dd();console.error("ERROR")}})):b("CONFIRMPASSWORD").then(function(a){$.notify(a,"error")}):b("CHECKCGI").then(function(a){$.notify(a,
"error")}):b("NOCAPTCHA").then(function(a){$.notify(a,"error")})};a.sendFpwdRequest=function(){var c=a.sFormDefinitionName;cd();z({method:"POST",url:h.web_server_name+"/"+h.services_alias+"/vitis/accounts/fpwd",params:{username:a.oFormValues[c].fpwd_login,mail:a.oFormValues[c].fpwdmail,company:a.oFormValues[c].fpwdporganization},success:function(a){dd();403===a.status?b("ACCOUNTSERVICENOTAVAILABLE").then(function(a){$.notify(a,"error")}):null!=a.data.status&&(7===a.data.status?b("LOGINNOTKNOWN").then(function(a){$.notify(a,
"error")}):($("#modal_forgotten_password").modal("hide"),b("CHECKMAIL").then(function(a){$.notify(a,"success")})))},error:function(){dd();console.error("ERROR")}})};a.sendLoginForm=function(){var b=d.defer(),c=b.promise;if("unstable"==h.status)b.reject();else{a.hideErrorAlert();var f=a.sFormDefinitionName,g=a.oFormValues[f].user_login,p=a.oFormValues[f].domain;"undefined"!=typeof p&&"undefined"!=typeof p.selectedOption&&""!=p.selectedOption.value&&"undefined"!=typeof p.selectedOption.value&&-1==g.indexOf("@")&&
(g+="@"+p.selectedOption.value);z({method:"POST",url:h.web_server_name+"/"+h.services_alias+"/"+e.web_service+"/"+e.web_service_controller,scope:a,data:{user:g,password:a.oFormValues[f].user_password},success:function(c){1==c.data.status?(a.hideErrorAlert(),e.token=c.data.token,e.validity_date=c.data.validity_date,sessionStorage.session_token=e.token,k.login=g,k.id=parseInt(c.data.user_id),k.privileges=c.data.privileges,sessionStorage.user_login=g,sessionStorage.user_id=k.id,sessionStorage.privileges=
k.privileges,h.getFromServer().then(function(){h.app_name=sessionStorage.application.toLowerCase().charAt(0).toUpperCase()+sessionStorage.application.slice(1);"undefined"!=typeof sessionStorage.environment&&(h.environment=sessionStorage.environment);e.connect();b.resolve()}),!0===a.oFormValues[f].remember_me&&e.saveSessionToLocalStorage()):(a.showErrorAlert("FORM_LOGIN_CONNECTION_ERROR"),b.reject())}})}return c}};u.oy.$inject="$scope $translate $rootScope $q sessionSrvc externFunctionSrvc envSrvc propertiesSrvc userSrvc $templateRequest $compile formSrvc".split(" ");
u.module.controller("loginCtrl",u.oy);u.Kx=function(a,b,c,d,e,f,g,h){b.info("initHtmlForm");a.oFormScope=a;a.oProperties=f;a.sToken=g.token;"function"===typeof destructor_form&&destructor_form();"undefined"==typeof a.sFormDefinitionName&&(a.sFormDefinitionName=e.sFormDefinitionName);var k=c.defer();c=k.promise;g=e.oSelectedObject.name;var m=e.getSectionWebServiceResourceId();if("undefined"!=typeof g){var p="";if(1<e.oSelectedObject.sections.length){var t=e.oSectionForm[g];"undefined"==typeof t||fb(t)||0!=t.iSelectedSectionIndex&&(p=t.sections[t.iSelectedSectionIndex].name)}}"undefined"==
typeof e.oFormValues[a.sFormDefinitionName]&&(e.oFormValues[a.sFormDefinitionName]={});"boolean"!=typeof a.bLoadFormValues&&(a.bLoadFormValues=!0);if(null==m||"update"!=e.sMode&&"display"!=e.sMode||!0!==a.bLoadFormValues)"insert"==e.sMode&&(e.oFormValues[a.sFormDefinitionName]={},e.oFormDefaultValues[a.sFormDefinitionName]={}),d(function(){k.resolve("load form. def.")});else{b.info("initHtmlForm : Form. values");var v=e.explodeWebServiceResourceId(m);z({method:"GET",url:f.web_server_name+"/"+f.services_alias+
"/"+v[0]+"/"+v[1]+"/"+e.sId,scope:a,success:function(b){if(1==b.data.status)e.oFormValues[a.sFormDefinitionName]={},e.oFormValues[a.sFormDefinitionName]=e.extractWebServiceData(v[1],b.data)[0],e.oFormDefaultValues[a.sFormDefinitionName]=angular.copy(e.oFormValues[a.sFormDefinitionName]),k.resolve("load form. def.");else{var c={className:"modal-danger",buttons:{ok:{label:"OK",className:"btn-default"}}};null!=b.data.errorMessage&&(c.message=b.data.errorMessage);h.modalWindow("alert","FORM_VALUES_LOADING_ERROR",
c)}}})}if("undefined"!=typeof g){var w={};null!=a.oFormRequestParams?w=a.oFormRequestParams:(w.sUrl="modules/"+e.oSelectedMode.module_name+"/forms/"+e.oSelectedMode.mode_id+"/"+g,""!=p&&(w.sUrl+="_"+p),w.sUrl+=".json");var x={params:w.oParams};"undefined"!=typeof w.oHeaders&&(x.headers=w.oHeaders);b.info("initHtmlForm : Form. def. : "+w.sUrl);c.then(function(){z({method:"GET",url:w.sUrl,params:x.params,headers:x.headers,scope:a,success:function(c){if(0!=c.data.status){e.oFormDefinition[a.sFormDefinitionName]=
{};var d="",f="",g;for(g in c.data)Array.isArray(c.data[g])&&(d=c.data[g][0].json_form[1],f=c.data[g][0].json_form[2]);"undefined"!=typeof w.sExtractData&&(w.oData=c.data,c.data=a.$eval(w.sExtractData));if(null!=c.data){if(n(c.data.datasources))var k=angular.copy(c.data.datasources);c.data=c.data[e.sMode];e.oFormDefinition[a.sFormDefinitionName]=c.data;e.oFormDefinition[a.sFormDefinitionName].JS_url=d;e.oFormDefinition[a.sFormDefinitionName].CSS_url=f;""!=d&&!1!==c.data.javascript&&(c.data.javascript=
!0);null!=k&&(e.oFormDefinition.datasources=k);a.$root.$emit("formDefinitionLoaded",a.sFormDefinitionName);if(!0===c.data.javascript){var p="",p=-1===w.sUrl.indexOf(".json")?d:w.sUrl.replace(/.json/g,".js");b.info("initHtmlForm : javascript assoc. to : "+w.sUrl);ad([p],{callback:function(){angular.element(u.Pb).ready();"function"==typeof constructor_form&&constructor_form(a,p)},async:!0,scriptInBody:!0})}}a.oFormRequestParams=null}else e.oFormDefinition[a.sFormDefinitionName]={},e.oFormValues[a.sFormDefinitionName]=
{},e.oFormDefaultValues[a.sFormDefinitionName]={},d={className:"modal-danger",buttons:{ok:{label:"OK",className:"btn-default"}}},null!=c.data.errorMessage&&(d.message=c.data.errorMessage),h.modalWindow("alert","FORM_DEFINITION_LOADING_ERROR",d)}})})}};u.Kx.$inject="$scope $log $q $timeout envSrvc propertiesSrvc sessionSrvc externFunctionSrvc".split(" ");u.module.controller("htmlFormCtrl",u.Kx);u.An=function(a){a.clearLessCache();$.notify.defaults({autoHideDelay:3E3});return{restrict:"A",controller:"initCtrl",controllerAs:"ctrl"}};u.appInitDrtv=u.An;u.An.$inject=["externFunctionSrvc"];u.module.directive("appInit",u.An);u.f=function(a,b){return{restrict:"A",controller:"mainCtrl",controllerAs:"ctrl",link:function(c){u.gl("appMainDrtvLoaded");a.onresize=function(){b.resizeWin()};c.$on("$destroy",function(){a.onresize=null})}}};u.appMainDrtv=u.f;u.f.$inject=["$window","externFunctionSrvc"];u.module.directive("appMain",u.f);u.Pv=function(a){return{link:function(b,c){a(function(){$(c).children().popover({trigger:"hover"});$("#object_column").mCustomScrollbar({axis:"x",theme:"dark-thick"})});b.$on("$destroy",function(){$(c).children().popover("destroy")})}}};
u.Pv.$inject=["$timeout"];u.module.directive("repeatMode",u.Pv);u.X=function(a,b,c,d,e,f,g,h){return{restrict:"A",controller:"workspaceListCtrl",controllerAs:"ctrl",scope:!0,link:function(e,m){var k;e.gridOptions.onRegisterApi=function(a){e.$root.gridApi[h.sSelectedGridOptionsName]=a;h.oGridOptions[h.sSelectedGridOptionsName].oUrlParams=null!=e.gridOptions.oUrlParams?e.gridOptions.oUrlParams:{order_by:h.oSelectedObject.sorted_by,sort_order:h.oSelectedObject.sorted_dir};a.pagination.on.paginationChanged(e,function(a,b){"undefined"!==typeof h.oGridOptions[h.sSelectedGridOptionsName]&&
"undefined"!==typeof e.$root.gridApi[h.sSelectedGridOptionsName]&&(h.oGridOptions[h.sSelectedGridOptionsName].oFilter=angular.copy(h.oGridOptions[h.sSelectedGridOptionsName].oFilter),e.setGridPage(a,b,h.oGridOptions[h.sSelectedGridOptionsName].oFilter,h.oGridOptions[h.sSelectedGridOptionsName].oUrlParams),g.rows_per_page=h.oGridOptions[h.sSelectedGridOptionsName].paginationPageSize)});a.core.on.sortChanged(e,function(a,b){a={};0<b.length&&(a.order_by=b[0].field,a.sort_order=b[0].sort.direction.toUpperCase());
h.oGridOptionsCopy[h.sSelectedGridOptionsName].oUrlParams.order_by=a.order_by;h.oGridOptionsCopy[h.sSelectedGridOptionsName].oUrlParams.sort_order=a.sort_order;b=0;"undefined"!=typeof h.oSectionForm&&"undefined"!=typeof h.oSectionForm[h.oSelectedObject.name]&&"undefined"!=typeof h.oSectionForm[h.oSelectedObject.name].iSelectedSectionIndex&&(b=h.oSectionForm[h.oSelectedObject.name].iSelectedSectionIndex);for(var c=h.oSelectedObject.sections[b].columns,d=0;d<c.length;)delete c[d].sort,d++;h.oSelectedObject.sections[b].columns=
c;h.oGridOptions[h.sSelectedGridOptionsName].oUrlParams=a;1===h.oGridOptions[h.sSelectedGridOptionsName].paginationCurrentPage?e.$root.gridApi[h.sSelectedGridOptionsName].pagination.raise.paginationChanged(1,h.oGridOptions[h.sSelectedGridOptionsName].paginationPageSize):h.oGridOptions[h.sSelectedGridOptionsName].paginationCurrentPage=1});"undefined"!==typeof a.dragndrop&&(!0===e.gridOptions.appEnableDragAndDrop?(a.dragndrop.setDragDisabled=!1,a.draggableRows.on.rowDragged(e,function(){}),a.draggableRows.on.rowFinishDrag(e,
function(){if("undefined"!==typeof e.gridOptions.appDragAndDropEvent&&"undefined"!==typeof e.gridOptions.appDragAndDropEvent.rowFinishDrag)e.$root[e.gridOptions.appDragAndDropEvent.rowFinishDrag]()}),a.draggableRows.on.rowEnterRow(e,function(){}),a.draggableRows.on.beforeRowMove(e,function(){})):a.dragndrop.setDragDisabled=!0);h.oGridOptionsCopy[h.sSelectedGridOptionsName]=angular.copy(h.oGridOptions[h.sSelectedGridOptionsName]);h.oGridOptions[h.sSelectedGridOptionsName].appLoadGridData&&e.setGridPage(1,
h.oGridOptions[h.sSelectedGridOptionsName].paginationPageSize,h.oGridOptions[h.sSelectedGridOptionsName].oFilter,h.oGridOptions[h.sSelectedGridOptionsName].oUrlParams);!0===h.oGridOptions[h.sSelectedGridOptionsName].appResizeGrid&&e.$root.gridApi[h.sSelectedGridOptionsName].core.handleWindowResize()};a(function(){f.resizeWin();e.$root.gridApi[h.sSelectedGridOptionsName].core.handleWindowResize();$(m).find(".ui-grid-render-container-body").on("click.selectRow",function(a){a=a.target;if($(a).hasClass("ui-grid-cell")||
$(a).hasClass("ui-grid-cell-contents"))a=$(m).find(".ui-grid-render-container-body .ui-grid-canvas").children().index($(a).parents(".ui-grid-row")),$(m).find(".ui-grid-render-container-left .ui-grid-row").eq(a).find(".ui-grid-selection-row-header-buttons").click()});m[0].querySelector(".ui-grid-render-container-body").style.height="100%";m[0].querySelector(".ui-grid-render-container-body .ui-grid-viewport").style.height="Calc(100% - 30px)";b.$emit("workspaceListTplCompiled")});$(m).find(".workspacelist-grid-header-search-button-arrow-right").click(function(){e.searchFormCompiled||
(c("templates/formTpl.html").then(function(a){d($("#"+h.oSelectedObject.name+"_"+h.sSelectedSectionName+"_grid_header_search_form").html(a).contents())(e);k=e.$root.$on("formExtracted",function(a,b){b===h.sFormDefinitionName&&(k(),"undefined"==typeof h.oWorkspaceList[h.sSelectedGridOptionsName].oDefaultValues?(h.oWorkspaceList[h.sSelectedGridOptionsName].oDefaultValues=angular.copy(h.oFormValues[h.sFormDefinitionName]),h.oWorkspaceList[h.sSelectedGridOptionsName].oValues=angular.copy(h.oFormValues[h.sFormDefinitionName])):
(h.oFormValues[h.sFormDefinitionName]=angular.copy(h.oWorkspaceList[h.sSelectedGridOptionsName].oValues),e.$broadcast("$$rebind::refresh"),e.$apply()))})}),e.searchFormCompiled=!0);a(function(){$(this).parent().find(".workspacelist-grid-header-search-button-arrow-icon").toggleClass("icon-keyboard_arrow_right");$(this).parent().find(".workspacelist-grid-header-search-button-arrow-icon").toggleClass("icon-keyboard_arrow_down");$(m).find(".workspacelist-grid-header-search-form").slideToggle(400,function(){f.resizeWin();
e.$root.gridApi[h.sSelectedGridOptionsName].core.handleWindowResize()})})});e.$on("$destroy",function(){$(m).find(".ui-grid-render-container-body").off("click.selectRow");var a=h.oGridOptions[h.sSelectedGridOptionsName];null!==a&&("columnDefs data appActions oFilter oUrlParams paginationPageSizes".split(" ").forEach(function(b){h.toGarbageCollection(a[b])}),a.onRegisterApi=null,h.oGridOptions[h.sSelectedGridOptionsName]=null,e.gridOptions=null,b.gridApi[h.sSelectedGridOptionsName]=null,h.oGridOptions[h.sSelectedGridOptionsName]=
{});fa(k)&&k()})}}};u.appWorkspaceListDrtv=u.X;u.X.$inject="$timeout $rootScope $templateRequest $compile uiGridConstants externFunctionSrvc propertiesSrvc envSrvc".split(" ");u.module.directive("appWorkspaceList",u.X);u.sC=function(){return{replace:!0,templateUrl:"templates/uiGridActionTpl.html"}};u.module.directive("appUiGridAction",u.sC);u.tC=function(){return{templateUrl:"templates/uiGridPaginationTpl.html"}};u.module.directive("appUiGridPagination",u.tC);u.pC=function(){return{replace:!0}};
u.module.directive("appSearchForm",u.pC);u.Vv=function(){return{restrict:"A",controller:"simpleFormCtrl",controllerAs:"ctrl",scope:!0}};u.appSimpleFormDrtv=u.Vv;u.module.directive("appSimpleForm",u.Vv);
u.Wv=function(a,b,c,d,e,f,g){return{replace:!0,templateUrl:"templates/formTpl.html",link:function(h){a(function(){e.resizeWin()});h.$root.sendSimpleForm=function(a,e){var k=c.defer(),m=k.promise,v=d.sFormDefinitionName;null!=e||(e=g.getFormData(d.sFormDefinitionName));var w=d.getSectionWebServiceResourceId(),w=d.explodeWebServiceResourceId(w),x=d.oFormDefinition[d.sFormDefinitionName].name,y=angular.element("form[name='"+x+"']").scope();"undefined"==typeof y[x].appFormSubmitted&&(y[x].appFormSubmitted=
!1);if(y[x].$valid&&!y[x].appFormSubmitted){if(y[x].appFormSubmitted=!0,"update"==d.sMode||"insert"==d.sMode){var w=f.web_server_name+"/"+f.services_alias+"/"+w[0]+"/"+w[1],F;"update"==d.sMode?(F="PUT",w+="/"+d.sId):F="POST";z({method:F,url:w,data:e,scope:h,success:function(c){!0===a&&h.$root.clearFormData(v,h);if(1==c.data.status)h.bFormValidationMessage&&b("FORM_VALIDATION_OK").then(function(a){$.notify(a,"success")}),"insert"==d.sMode&&(d.sId=c.data[d.oSelectedObject.sIdField]),y[x].appFormSubmitted=
!1,k.resolve(!0);else{if(h.bFormValidationMessage){if("undefined"!=typeof c.data.errorMessage&&null!=c.data.errorMessage)var e=c.data.errorMessage;h.modalWindow("dialog","FORM_VALIDATION_ERROR",{className:"modal-danger",message:e,callback:function(){k.reject(!1)}})}y[x].appFormSubmitted=!1;k.resolve(!1)}}})}}else k.reject(!1);return m}}}};u.Wv.$inject="$timeout $translate $q envSrvc externFunctionSrvc propertiesSrvc formSrvc".split(" ");u.module.directive("appSimpleFormFormular",u.Wv);u.qr=function(a,b,c){return{restrict:"A",controller:"doubleFormCtrl",controllerAs:"ctrl",scope:!0,replace:!0,link:function(){a(function(){b.$emit("doubleFormCompiled");c.resizeWin()})}}};u.appDoubleFormDrtv=u.qr;u.qr.$inject=["$timeout","$rootScope","externFunctionSrvc"];u.module.directive("appDoubleForm",u.qr);u.Qv=function(){return{restrict:"A",controller:"sectionFormCtrl",controllerAs:"ctrl",scope:!0}};u.appSectionFormDrtv=u.Qv;u.module.directive("appSectionForm",u.Qv);
u.Rv=function(a){return{link:function(b,c){var d="col-xs-12",d="insert"==a.sMode?d+" section-form-section-insert":d+" section-form-section";b.$index==b.oSectionForm[b.sSelectedObjectName].iSelectedSectionIndex&&(d+=" section-form-section-selected");c[0].className=d;$(c).on("click.selectSection",function(){"insert"!=a.sMode&&($(this).parent().find(".section-form-section").removeClass("section-form-section-selected"),$(this).addClass("section-form-section-selected"))});b.$on("$destroy",function(){$(c).off("click.selectSection")})}}};
u.Rv.$inject=["envSrvc"];u.module.directive("appSectionFormMenu",u.Rv);u.Sv=function(a,b){return{link:function(c,d){c.$index==b.oSectionForm[c.sSelectedObjectName].iSelectedSectionIndex?$(d).show():$(d).hide();c.$last&&(a.bLastSectionContainer=!0)}}};u.Sv.$inject=["$rootScope","envSrvc"];u.module.directive("appSectionFormSection",u.Sv);u.rr=function(){return{restrict:"A",controller:"loginCtrl",controllerAs:"ctrl"}};u.appLoginDrtv=u.rr;u.module.directive("appLogin",u.rr);u.Dv=function(a,b){return{replace:!0,templateUrl:"templates/formTpl.html",link:function(c){var d=c.$root.$on("formDefinitionLoaded",function(){a(function(){if("unstable"==String(b.status).toLowerCase()||"unstable"==String(b.VM_STATUS).toLowerCase())document.querySelector("button[type='submit']").disabled=!0;d()})})}}};u.Dv.$inject=["$timeout","propertiesSrvc"];
u.module.directive("appLoginForm",u.Dv);u.jC=function(){return{replace:!0,templateUrl:"templates/formTpl.html",link:function(){}}};u.module.directive("appFpwdForm",u.jC);u.Pb=function(a){return{restrict:"A",controller:"htmlFormCtrl",controllerAs:"ctrl",link:function(b){b.oFormDefinition=a.oFormDefinition;b.oFormValues=a.oFormValues;b.submitButton=!1}}};u.appHtmlFormDrtv=u.Pb;u.Pb.$inject=["envSrvc"];u.module.directive("appHtmlForm",u.Pb);function Xy(a){var b=this;this.url=a;this.callbacks={};this.yK=!0;this.Qs=!1;this.lI=5E3;this.XC=3E4;this.connect();Yy(this);this.on("reconnectClient",function(){Zy(b,"reconnectClient",sessionStorage.user_id)})}Xy.prototype.on=function(a,b){this.callbacks[a]=this.callbacks[a]||[];this.callbacks[a].push(b);return this};Xy.prototype.on=Xy.prototype.on;function Zy(a,b,c,d){a.md.send(JSON.stringify(null!=d?{service:d,action:b,data:c}:{action:b,data:c}))}
Xy.prototype.AA=function(a){function b(){Zy(c,"subscribe",sessionStorage.user_id,a)}var c=this;this.md.readyState===this.md.OPEN&&(b(),this.on("connect",function(){b()}));if(this.md.readyState===this.md.CONNECTING)this.on("connect",function(){b()})};Xy.prototype.subscribeService=Xy.prototype.AA;Xy.prototype.Sx=function(){return this.md.readyState===this.md.OPEN};Xy.prototype.isConnected=Xy.prototype.Sx;Xy.prototype.sendMessage=function(a){Zy(this,"echo",a)};Xy.prototype.sendMessage=Xy.prototype.sendMessage;
Xy.prototype.WI=function(a){Zy(this,"event",a)};Xy.prototype.sendEvent=Xy.prototype.WI;Xy.prototype.aA=function(){Zy(this,"ping","")};Xy.prototype.sendPing=Xy.prototype.aA;
Xy.prototype.connect=function(){var a=this;this.md="function"===typeof MozWebSocket?new MozWebSocket(this.url):new WebSocket(this.url);this.md.onmessage=function(b){var c,d;try{c=JSON.parse(b.data)}catch(e){d=b.data}null!=c&&null!=c.action&&$y(a,c.action,c.data);null!=d&&$y(a,"message",d)};this.md.onclose=function(){this.Qs=!1;$y(a,"disconnect",null);a.yK&&setTimeout(function(){a.connect()},a.lI)};this.md.onopen=function(){Zy(a,"connect",sessionStorage.user_id)};this.on("connect",function(){this.Qs=
!0})};Xy.prototype.connect=Xy.prototype.connect;Xy.prototype.disconnect=function(){this.md.close()};Xy.prototype.disconnect=Xy.prototype.disconnect;function $y(a,b,c){a=a.callbacks[b];if("undefined"!==typeof a)for(b=0;b<a.length;b++)a[b](c)}
function Yy(a){function b(){setTimeout(function(){null!=a.md.readyState&&null!=a.md.OPEN&&a.md.readyState===a.md.OPEN&&(c=!1,a.aA(),setTimeout(function(){!1===c?(console.error("WebSocket connection broken"),a.disconnect()):a.Qs=!0},1E3));b()},a.XC)}var c;a.on("ping",function(){c=!0});b()};u.on("appMainDrtvLoaded",function(){var a=angular.element(u.Pb).injector().get(["$q"]),b=angular.element(u.f).injector().get(["$log"]),c=angular.element(u.f).injector().get(["envSrvc"]),d=angular.element(u.X).injector().get(["formSrvc"]),e=angular.element(u.X).injector().get(["$timeout"]),f=angular.element(u.X).injector().get(["$compile"]),g=angular.element(u.f).injector().get(["modesSrvc"]),h=angular.element(u.f).injector().get(["$translate"]),k=angular.element(u.f).injector().get(["propertiesSrvc"]),
m=angular.element(u.X).injector().get(["uiGridConstants"]),p=angular.element(u.X).injector().get(["$templateRequest"]),t=angular.element(u.f).injector().get(["externFunctionSrvc"]);if(null!=k.websocket_alias){var v="wss://"+location.host+"/"+k.websocket_alias+"/";u.oWebsocket=new Xy(v);u.oWebsocket.oGridRefreshEvents={};u.oWebsocket.on("connect",function(a){b.info("VitisWebsocket: Connected to "+v+" with "+a)});u.oWebsocket.on("disconnect",function(){b.info("VitisWebsocket: Disconnected")});u.oWebsocket.on("subscribe",
function(a){b.info("VitisWebsocket: Subscribed to "+a)});u.oWebsocket.on("echo",function(a){b.info("VitisWebsocket echo: "+a);$.notify("VitisWebsocket: "+a,"success")});u.oWebsocket.on("event",function(a){b.info("VitisWebsocket event: ",a)});setTimeout(function(){u.oWebsocket.Sx()||(b.error("VitisWebsocket was not able to connect"),h(["INACCESSIBLE_WEBSOCKET"]).then(function(a){$.notify(a.INACCESSIBLE_WEBSOCKET,"error")}))},5E3)}angular.element(u.f).scope().loadSimpleForm=function(){c.sMode="update";
b.info("loadSimpleForm")};angular.element(u.f).scope().scopeEval=function(a,c){b.info(c);a.$eval(c)};angular.element(u.X).scope().AddDoubleForm=function(){c.addDoubleForm();b.info("AddDoubleForm")};angular.element(u.X).scope().AddSectionForm=function(){b.info("AddSectionForm");var a="before"+Ga(c.oSelectedObject.name,"_").replace(/_/g,"")+"Edition";if("undefined"!=typeof this[a])this[a]();c.addSectionForm()};angular.element(u.f).scope().setMode=function(a){b.info("setMode: "+a);var d=c.oSelectedMode.mode_id,
e=c.oSelectedObject.name;c.setMode(a).then(function(){angular.element("#container_mode_"+d).empty();g.clearObjectData(e,d)})};angular.element(u.f).scope().setFullScreen=function(a){b.info("setFullScreen",a);var c=$("#header_line").height();null==a||!0===a?"0px"===$("#header_line").css("margin-top")&&($("#header_line").animate({"margin-top":-c+"px"}),$("#works_line").animate({height:c+$("#works_line").height()+"px"}),$(".popover").hide()):"0px"!==$("#header_line").css("margin-top")&&($("#header_line").animate({"margin-top":"0px"}),
$("#works_line").animate({height:$("#works_line").height()-c+"px"}),e(function(){t.resizeWin()},500))};angular.element(u.f).scope().reloadSection=function(){b.info("reloadSection : "+c.sMode);c.setSectionForm(c.sMode,c.sId)};angular.element(u.f).scope().getProperty=function(a,c){b.info("getProperty : "+a);var d;-1!=a.indexOf(".")?eval("sValue = propertiesSrvc."+a):d=k[a];"undefined"!=typeof c&&("undefined"!=typeof c.concatBefore&&(d=c.concatBefore+d),"undefined"!=typeof c.concatAfter&&(d+=c.concatAfter));
return d};angular.element(u.f).scope().getPropertie=function(a){return angular.element(u.f).scope().getProperty(a)};u.compileProvider.directive("appSetBooleanIconColumn",function(){return{link:function(a,b,c){var d=c.$observe("appSetBooleanIconColumn",function(){var c;a.row.entity[a.col.field]?c="true-icon":a.row.entity[a.col.field]||(c="false-icon");b[0].className="ui-grid-cell-contents "+c});a.$on("$destroy",function(){d()})}}});u.module.directive("appSetBooleanIconColumn",u.FL);u.compileProvider.directive("appSetTrueIconColumn",
function(){return{link:function(a,b,c){var d=c.$observe("appSetTrueIconColumn",function(){var c;a.row.entity[a.col.field]?c="true-icon":a.row.entity[a.col.field]||(c="");b[0].className="ui-grid-cell-contents "+c});a.$on("$destroy",function(){d()})}}});u.module.directive("appSetTrueIconColumn",u.GL);angular.element(u.f).scope().modalWindow=function(a,c,d){b.info("modalWindow");return t.modalWindow(a,c,d)};angular.element(u.f).scope().selectFirstOption=function(a,d){b.info("selectFirstOption");oFormValues=
c.oFormValues[c.sFormDefinitionName];"undefined"==typeof oFormValues[a]&&(oFormValues[a]={options:[]});0==oFormValues[a].options.length&&!0===d&&oFormValues[a].options.push({label:"",value:""});oFormValues[a].selectedOption=oFormValues[a].options[0]};angular.element(u.f).scope().loadSection=function(){b.info("loadSection")};angular.element(u.f).scope().reloadSectionForm=function(){b.info("reloadSectionForm")};angular.element(u.f).scope().refreshGridByEvent=function(a,d,e){b.info("refreshGridByEvent");
if(null==u.oWebsocket)return null;var f=null!=k.minimum_refresh_period?1E3*k.minimum_refresh_period:1E4;if(null==a||null==d||null!=u.oWebsocket.oGridRefreshEvents[a]&&null!=u.oWebsocket.oGridRefreshEvents[a].events[d])return null;null!=u.oWebsocket.oGridRefreshEvents[a]||(u.oWebsocket.oGridRefreshEvents[a]={events:[],lastUpdateDate:(new Date).getTime()});null!=u.oWebsocket.oGridRefreshEvents[a].events[d]||u.oWebsocket.oGridRefreshEvents[a].events.push(d);var g=this;u.oWebsocket.on("event",function(b){if(b.event!==
d||c.oSelectedObject.name!==a)return null;var h=(new Date).getTime();if(h-u.oWebsocket.oGridRefreshEvents[a].lastUpdateDate<f)return null;if(null!=e){if(!e.call(this,b))return console.log("not loaded"),null;console.log("loaded")}u.oWebsocket.oGridRefreshEvents[a].lastUpdateDate=h;g.saveGridSelection(g.$root.gridApi[c.sSelectedGridOptionsName].grid.appScope,g.$root.gridApi[c.sSelectedGridOptionsName].grid.options);g.$root.refreshGrid(g.$root.gridApi[c.sSelectedGridOptionsName].grid.appScope,c.oGridOptions[c.sSelectedGridOptionsName])})};
angular.element(u.f).scope().resetForm=function(a){b.info("resetForm");a="undefined"==typeof a?c.oFormDefinition[c.sFormDefinitionName].name:c.oFormDefinition[a].name;angular.element("form[name='"+a+"']").scope()[a].$setPristine();document.querySelector("form[name='"+a+"']").reset()};angular.element(u.X).scope().editSectionForm=function(a){b.info("editSectionForm");var d="before"+Ga(c.oSelectedObject.name,"_").replace(/_/g,"")+"Edition";if("undefined"!=typeof this[d])this[d](a);"undefined"==typeof a&&
(a=c.sId);c.setSectionForm("update",a)};angular.element(u.X).scope().showSectionForm=function(a){b.info("showSectionForm");"undefined"==typeof a&&(a=c.sId);c.setSectionForm("display",a)};angular.element(u.X).scope().editDoubleForm=function(a){b.info("editDoubleForm");"undefined"==typeof a&&(a=c.sId);c.sSelectedTemplate="doubleFormTpl.html";c.sId=a;c.setMode("update",c.sTemplateFolder+c.sSelectedTemplate)};angular.element(u.X).scope().showDoubleForm=function(a){b.info("showDoubleForm");"undefined"==
typeof a&&(a=c.sId);c.sSelectedTemplate="doubleFormTpl.html";c.sId=a;c.setMode("display",c.sTemplateFolder+c.sSelectedTemplate)};angular.element(u.f).scope().showCredits=function(){b.info("showCredits");var a=this.$new();g.addScopeToObject(c.oSelectedObject.name,c.oSelectedMode.mode_id,a);z({method:"GET",url:"conf/credits.json",scope:a,success:function(c){"object"==typeof c.data&&(a.oCredits=c.data,a.modalWindow("dialog","CREDITS",{className:"dialog-modal-window",message:'<div id="login_credits" class="login-credits"></div>'}),
a.translationData={app_name:k.app_name,build:k.build,version:k.version,month_year:k.month_year},p("templates/creditsTpl.html").then(function(b){f($("#login_credits").html(b).contents())(a)}),b.info("compileObjectTemplate : templates/creditsTpl.html"))}})};angular.element(u.f).scope().setTagsInput=function(a){b.info("setTagsInput");var c,d;a.forEach(function(a){c=0;for(d=document.getElementById(a).parentNode.querySelectorAll(".tag");c<d.length;)d[c].addEventListener("click",function(){this.querySelector("span[data-role='remove']").click()}),
c++})};angular.element(u.X).scope().refreshGrid=function(a,d){b.info("refreshGrid");a.saveGridSelection(a,d);a.setGridPage(d.paginationCurrentPage,d.paginationPageSize,c.oGridOptions[c.sSelectedGridOptionsName].oFilter,c.oGridOptions[c.sSelectedGridOptionsName].oUrlParams)};angular.element(u.X).scope().saveGridSelection=function(a,d){b.info("saveGridSelection");a=d.appSelectedRows=a.$root.gridApi[a.sSelectedGridOptionsName].selection.getSelectedRows();if(0<a.length)for(var e=0,f=[];e<a.length;)f.push(a[e][c.oSelectedObject.sIdField]),
e++;d.appSelectedRows=f};angular.element(u.X).scope().setGridFilter=function(){b.info("setGridFilter");c.oWorkspaceList[c.sSelectedGridOptionsName].oValues=angular.copy(c.oFormValues[c.sFormDefinitionName]);for(var a,e,f={relation:"AND",operators:[]},g=d.getFormData(c.sFormDefinitionName,!0),h=Object.keys(g),k=0;k<h.length;){e=d.getFormElementDefinition(h[k],c.sFormDefinitionName);a=g[h[k]];if("date"===e.type||"datetime"===e.type){var p=$("#"+e.id).data("DateTimePicker").date();null!==p&&(a="date"===
e.type?p.format("YYYY-MM-DD"):p.format("YYYY-MM-DD HH:mm:ss"))}"undefined"!==typeof a&&""!==a.toString()&&(null!=e.comparator?(null!=e.comparator.formater&&(a=e.comparator.formater.replace(/<VALUE_TO_REPLACE>/g,a)),e.comparator.value=a,f.operators.push(e.comparator)):"text"==e.type?f.operators.push({column:h[k],compare_operator:"LIKE",compare_operator_options:{case_insensitive:!0},value:"%"+a+"%"}):"date"==e.type||"datetime"==e.type?f.operators.push({column:h[k],compare_operator:">",value:a},{column:h[k],
compare_operator:"<",value:moment(a).add(1,"days").format("YYYY-MM-DD")}):f.operators.push({column:h[k],compare_operator:"=",value:a}));k++}c.oGridOptions[c.sSelectedGridOptionsName].oFilter=angular.copy(f);"search"==c.sMode&&(c.oWorkspaceList[c.sSelectedGridOptionsName].oFilter=angular.copy(f));this.$root.$broadcast("oFilterLoaded_"+c.oSelectedObject.name,c.oGridOptions[c.sSelectedGridOptionsName].oFilter);1==c.oGridOptions[c.sSelectedGridOptionsName].paginationCurrentPage?this.$root.gridApi[c.sSelectedGridOptionsName].pagination.raise.paginationChanged(1,
c.oGridOptions[c.sSelectedGridOptionsName].paginationPageSize):c.oGridOptions[c.sSelectedGridOptionsName].paginationCurrentPage=1};angular.element(u.X).scope().resetGridFilter=function(){b.info("resetGridFilter");for(var a=d.getFormData(c.sFormDefinitionName,!0),f=Object.keys(a),a=0;a<f.length;){var g=d.getFormElementDefinition(f[a],c.sFormDefinitionName);"date"!==g.type&&"datetime"!==g.type||angular.element("#"+g.id).data("DateTimePicker").clear();a++}c.oFormValues[c.sFormDefinitionName]=angular.copy(c.oWorkspaceList[c.sSelectedGridOptionsName].oDefaultValues);
c.oGridOptionsCopy[c.sSelectedGridOptionsName].oFilter=c.oDefaultGridOptions[c.sSelectedGridOptionsName].oFilter;this.setGridFilter();e(function(){f.forEach(function(a){var b=d.getFormElementDefinition(a,c.sFormDefinitionName);"select"===b.type&&document.querySelectorAll("#"+b.id).forEach(function(b){"undefined"!=typeof b.options&&Array.from(b.options).forEach(function(b){var d=c.oFormValues[c.sFormDefinitionName][a];b.selected=!1;"object"==typeof d&&"object"==typeof d.selectedOption&&b.value==d.selectedOption.value&&
(b.selected=!0)})})})})};angular.element(u.X).scope().setPaginationStatus=function(){b.info("setPaginationStatus");var a=this,d;if(0<c.oGridOptions[c.sSelectedGridOptionsName].totalItems){d="PAGINATION_STATUS";var e={totalItems:c.oGridOptions[c.sSelectedGridOptionsName].totalItems,itemStart:(c.oGridOptions[c.sSelectedGridOptionsName].paginationCurrentPage-1)*c.oGridOptions[c.sSelectedGridOptionsName].paginationPageSize+1};e.itemEnd=e.itemStart+c.oGridOptions[c.sSelectedGridOptionsName].paginationPageSize-
1;e.itemEnd>e.totalItems&&(e.itemEnd=e.totalItems)}else d="PAGINATION_STATUS_NO_ITEMS";h([d],e).then(function(b){a.sPaginationStatus=b[d]})};angular.element(u.X).scope().setGridPage=function(a,b,d,e){"number"!=typeof a&&(a=1);var f=angular.element(u.X).scope();a--;a*=b;e="undefined"==typeof e?{}:angular.copy(e);kb(e,{offset:a,limit:b});"undefined"==typeof d&&(d={relation:"AND",operators:[]});"undefined"!=typeof c.oSelectedObject.filter&&(d.operators=d.operators.concat(c.oSelectedObject.filter.operators));
"undefined"!=typeof c.oSelectedObject.aModeFilter&&(d.operators=d.operators.concat(c.oSelectedObject.aModeFilter.operators));0<d.operators.length?e.filter=angular.copy(d):delete e.filter;b=c.getSectionWebServiceResourceId();var g=c.explodeWebServiceResourceId(b);"undefined"!=typeof c.oGridOptions[c.sSelectedGridOptionsName].appBeforeEvent&&f.$root.$eval(c.oGridOptions[c.sSelectedGridOptionsName].appBeforeEvent);z({method:"GET",url:k.web_server_name+"/"+k.services_alias+"/"+g[0]+"/"+g[1],params:angular.copy(e),
scope:f,success:function(a){if(1==parseInt(a.data.status)){var b=[];"undefined"!=typeof a.data[g[1]]&&(b=a.data[g[1]]);c.oGridOptions[c.sSelectedGridOptionsName].data=b;c.oGridOptions[c.sSelectedGridOptionsName].totalItems=a.data.total_row_number;f.$root.setPaginationStatus();"undefined"!=typeof c.oGridOptions[c.sSelectedGridOptionsName].appAfterEvent&&f.$root.$eval(c.oGridOptions[c.sSelectedGridOptionsName].appAfterEvent);"undefined"!=typeof c.oGridOptions[c.sSelectedGridOptionsName].appSelectedRows&&
(f.$root.gridApi[c.sSelectedGridOptionsName].grid.modifyRows(c.oGridOptions[c.sSelectedGridOptionsName].data),b.forEach(function(a,b){-1!=c.oGridOptions[c.sSelectedGridOptionsName].appSelectedRows.indexOf(a[c.oSelectedObject.sIdField])&&f.$root.gridApi[c.sSelectedGridOptionsName].selection.selectRow(c.oGridOptions[c.sSelectedGridOptionsName].data[b])}))}}})};angular.element(u.X).scope().formatGridColumn=function(a,d){b.info("formatGridColumn");for(var e=[],f,g=0;g<a.length;)"number"!=typeof a[g].width&&
(a[g].width="50"),f={name:a[g].field_label,displayName:a[g].field_label,field:a[g].name,width:parseInt(a[g].width)+15,enableSorting:a[g].sortable,enableColumnResizing:a[g].resizeable,headerCellClass:d+"_"+a[g].name,cellClass:"cell-align-"+a[g].align},null!=a[g].template&&(f.cellTemplate=a[g].template),f.field==c.oSelectedObject.sorted_by&&(f.sort={direction:m[c.oSelectedObject.sorted_dir],ignoreSort:!0,priority:0}),e.push(f),g++;return e};angular.element(u.X).scope().formatGridAction=function(a,c){b.info("formatGridAction");
for(var d=[],e=0;e<a.length;)"string"===typeof a[e].event&&-1===a[e].event.indexOf("(")&&(a[e].event+="()"),d.push({label:Ga(a[e].button_label,""),event:a[e].event,name:c+"_"+a[e].button_class}),e++;return d};angular.element(u.X).scope().executeActionButtonEvent=function(a,d,e){b.info("executeActionButtonEvent");var f=angular.element(u.X).scope(),g=c.oSelectedObject.sIdField;"undefined"!=typeof e.appIdField&&(g=e.appIdField);f.$root[d](a.entity[g])};angular.element(u.X).scope().DeleteSelection=function(a){b.info("DeleteSelection");
var d=angular.element(u.X).scope(),e=d.$root.gridApi[c.sSelectedGridOptionsName].selection.getSelectedRows();if(0<e.length){"undefined"==typeof a&&(a={});var f="LIST_DELETE_CONFIRM";"undefined"!=typeof a.sMessage&&(f=a.sMessage);d.$root.modalWindow("confirm","",{message:f,callback:function(b){if(b){var f=0;b=[];var g;if("undefined"!=typeof a.aSelectedId)b=a.aSelectedId;else{var h=c.oSelectedObject.sIdField;for("undefined"!=typeof a&&"undefined"!=typeof a.sIdField&&(h=a.sIdField);f<e.length;)g=e[f][h],
b.push(g),f++}0<b.length?(f=c.getSectionWebServiceResourceId(),f=c.explodeWebServiceResourceId(f),z({method:"DELETE",url:k.web_server_name+"/"+k.services_alias+"/"+f[0]+"/"+f[1],params:{idList:b.join("|")},scope:d,success:function(a){if(1==a.data.status){if(1==c.oGridOptions[c.sSelectedGridOptionsName].paginationCurrentPage?d.$root.gridApi[c.sSelectedGridOptionsName].pagination.raise.paginationChanged(1,c.oGridOptions[c.sSelectedGridOptionsName].paginationPageSize):c.oGridOptions[c.sSelectedGridOptionsName].paginationCurrentPage=
1,a="after"+Ga(c.oSelectedMode.mode_id,"_").replace(/_/g,"")+"Removal","undefined"!=typeof d.$root[a])d.$root[a]()}else d.$root.modalWindow("dialog","LIST_DELETE_ERROR",{className:"modal-danger",message:a.data.errorMessage})}})):(d.$root.gridApi[c.sSelectedGridOptionsName].selection.clearSelectedRows(),d.$root.gridApi[c.sSelectedGridOptionsName].core.refresh())}}})}else h(["LIST_DELETE_NO_SELECTION"]).then(function(a){d.$root.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:a.LIST_DELETE_NO_SELECTION})})};
angular.element(u.f).scope().toGarbageCollection=function(a){c.toGarbageCollection(a)};angular.element(u.f).scope().concatSelectAttributes=function(a,d){b.info("concatSelectAttributes");"undefined"==typeof d&&(d=" ");var e;a.split("|").forEach(function(a){e=c.oFormValues[c.sFormDefinitionName][a];fb(e)||fb(e.options)||e.options.forEach(function(a){""!=a.label&&""!=a.value&&(a.label=a.value+d+a.label)})})};angular.element(u.f).scope().workspaceTooltipPlacement=function(a){b.info("workspaceTooltipPlacement");
return $(a).offset().left<window.innerWidth/2?"right":"left"};angular.element(u.f).scope().hideAllModalWindow=function(){b.info("hideAllModalWindow");bootbox.hideAll()};angular.element(u.f).scope().addSelectEmptyOption=function(a){b.info("addSelectEmptyOption");oFormValues=c.oFormValues[c.sFormDefinitionName];"undefined"==typeof oFormValues[a]&&(oFormValues[a]={options:[]});oFormValues[a].options.unshift({label:"",value:""});if("undefined"==typeof oFormValues[a].selectedOption||"undefined"==typeof oFormValues[a].selectedOption.value)oFormValues[a].selectedOption=
oFormValues[a].options[0]};u.compileProvider.directive("appFormatDateColumn",function(){return{link:function(a,b,c){var d=c.$observe("appFormatDateColumn",function(){null!=c.format||(c.format="L LTS");b[0].className+=" ui-grid-cell-contents";b[0].innerHTML=null!=a.row.entity[a.col.field]?moment(a.row.entity[a.col.field]).format(c.format):""});a.$on("$destroy",function(){d()})}}});u.module.directive("appFormatDateColumn",u.EL);angular.element(u.f).scope().getBooleanTranslation=function(c){b.info("getBooleanTranslation");
var d=a.defer(),e=d.promise;"boolean"==typeof c?h(["FORM_YES","FORM_NO"]).then(function(a){d.resolve(c?a.FORM_YES:a.FORM_NO)}):d.resolve(c);return e};angular.element(u.f).scope().loadSectionList=function(a){b.info("loadSectionList");var d=this.$root.$on("initWorkspaceList",function(b,e){d();e.gridOptions={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:k.rows_per_page,enableColumnMenus:!1,enableColumnResizing:!0,
paginationPageSizes:[10,20,50,100,200,500],appHeader:!1,appHeaderTitleBar:!0,appHeaderSearchForm:!1,appHeaderOptionBar:!1,appLoadGridData:!0,appGridTitle:c.oSelectedObject.label,appResizeGrid:!1,appFooter:!0,appShowPagination:!0,appEnableDragAndDrop:!1,appDragAndDropEvent:{},appActions:[],oFilter:{relation:"AND",operators:[{column:c.oSelectedObject.sIdField,compare_operator:"=",value:c.sId}]},appShowActions:!1};"undefined"!=typeof a&&kb(e.gridOptions,a);e.bLoadFormValues=!1})};angular.element(u.f).scope().getTabIdFieldValue=
function(){b.info("getTabIdFieldValue");return c.sId};angular.element(u.f).scope().setRadioTranslation=function(a){b.info("setRadioTranslation");angular.element(u.f).scope().$root.getBooleanTranslation(c.oFormValues[c.sFormDefinitionName][a]).then(function(b){c.oFormValues[c.sFormDefinitionName][a]=b})};angular.element(u.f).scope().cloneSectionForm=function(a){b.info("cloneSectionForm");var d=this,e=angular.copy(c.oFormValues[c.sFormDefinitionName]);if("undefined"!=typeof a)for(var f=0;f<a.length;f++)delete e[a[f]];
this.AddSectionForm();var g=d.$root.$on("formExtracted",function(a,b){b===c.sFormDefinitionName&&(g(),c.oFormValues[c.sFormDefinitionName]=angular.copy(e),d.$broadcast("$$rebind::refresh"),d.$apply())})};angular.element(u.f).scope().copyFormElemContentToClipboard=function(a){b.info("copyFormElemContentToClipboard");var d=document.createElement("textarea");document.getElementsByTagName("body")[0].appendChild(d);d.innerHTML=c.oFormValues[c.sFormDefinitionName][a];d.select();document.execCommand("copy");
document.getElementsByTagName("body")[0].removeChild(d)};angular.element(u.f).scope().addModalSectionForm=function(){b.info("addModalSectionForm");c.setModalSectionForm("insert")};angular.element(u.f).scope().editModalSectionForm=function(a){b.info("editModalSectionForm");"undefined"==typeof a&&(a=c.sId);c.setModalSectionForm("update",a)};angular.element(u.f).scope().showModalSectionForm=function(a){b.info("showModalSectionForm");"undefined"==typeof a&&(a=c.sId);c.setModalSectionForm("display",a)};
angular.element(u.f).scope().closeModalSectionForm=function(a){var d=angular.element(u.f).injector().get(["$rootScope"]);b.info("closeModalSectionForm");!0===a&&d.refreshGrid(d.gridApi[c.sSelectedGridOptionsName].grid.appScope,c.oGridOptions[c.sSelectedGridOptionsName]);d.hideAllModalWindow()};angular.element(u.f).scope().setModeFilter=function(a){var d=angular.element(u.f).injector().get(["$rootScope"]);b.info("setModeFilter");var e=d.gridApi[c.sSelectedGridOptionsName].selection.getSelectedRows();
if(0<e.length){"undefined"==typeof a&&(a=[]);a.push(c.oSelectedObject.name);for(var f=0;f<c.oSelectedMode.objects.length;f++)-1==a.indexOf(c.oSelectedMode.objects[f].name)&&(c.oSelectedMode.objects[f].aModeFilter={relation:"AND",operators:[{column:c.oSelectedObject.sIdField,compare_operator:"=",value:e[0][c.oSelectedObject.sIdField]}]});a=c.oGridOptions[c.sSelectedGridOptionsName].appActions;for(f=0;f<a.length;f++)-1!=a[f].name.indexOf("_set_mode_filter")?a[f].disabled=!0:-1!=a[f].name.indexOf("_unset_mode_filter")&&
(a[f].disabled=!1);d=d.gridApi[c.sSelectedGridOptionsName].grid.appScope;d.$broadcast("$$rebind::refresh");d.$applyAsync()}};angular.element(u.f).scope().unsetModeFilter=function(){var a=angular.element(u.f).injector().get(["$rootScope"]);b.info("unsetModeFilter");for(var d=0;d<c.oSelectedMode.objects.length;d++)delete c.oSelectedMode.objects[d].aModeFilter;for(var e=c.oGridOptions[c.sSelectedGridOptionsName].appActions,d=0;d<e.length;d++)-1!=e[d].name.indexOf("set_mode_filter")&&(e[d].disabled=!1);
a=a.gridApi[c.sSelectedGridOptionsName].grid.appScope;a.$broadcast("$$rebind::refresh");a.$applyAsync()}});u.qy=function(a,b,c,d,e,f){b.info("initLogs");e.oFormValues[e.sFormDefinitionName]={min_days_files:5};e.oFormDefaultValues[e.sFormDefinitionName]=angular.copy(e.oFormValues[e.sFormDefinitionName]);a.getFileContent=function(b,d){if("undefined"!=typeof b){var e=f.log_size;isNaN(e)&&(e=1024);d<1024*e?z({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/vitis/logs/"+b.log_directory+"/file/"+b.name,params:{folder:b.folder},scope:c,success:function(d){1==d.data.status?(c.sLogContent=d.data.file,
a.sLogPath=b.path,"undefined"!=typeof c.sLogContent&&($("#logs-content-container").show(),c.resizeLogsContainer(),window.addEventListener("resize",c.resizeLogsContainer))):c.modalWindow("dialog","LOADING_FILE_ERROR_LOGS",{className:"modal-danger",message:d.data.errorMessage,appDuration:2E3})}}):(a.sLogPath=b.path,$("#logs-content-container").show(),c.sLogContent="",d=$("#logs-content-container").height()-document.getElementById("logs-content-container").children[0].offsetHeight,document.getElementById("logs-content-container").children[1].style.height=
d+"px",c.modalWindow("dialog","FILE_TOO_BIG_LOGS",{className:"dialog-modal-window",appDuration:2E3}))}};a.deleteFile=function(a){null!=a&&z({method:"DELETE",url:f.web_server_name+"/"+f.services_alias+"/vitis/logs/"+a.log_directory+"/file/"+a.name,params:{folder:a.folder},scope:c,success:function(a){var b={};1==a.data.status?(d("DELETE_FILE_SUCCESS_LOGS").then(function(a){$.notify(a,"success")}),setTimeout(function(){c.loadTreeview()})):(b.className="modal-danger",b.message=a.data.errorMessage,c.modalWindow("dialog",
"DELETE_FILE_ERROR_LOGS",b))}})};c.resizeLogsContainer=function(){b.info("resizeLogsContainer");if("logs"==e.oSelectedMode.mode_id){var a=$("#logs-content-container").height()-document.getElementById("logs-content-container").children[0].offsetHeight;document.getElementById("logs-content-container").children[1].style.height=a+"px"}}};u.qy.$inject="$rootScope $log $scope $translate envSrvc propertiesSrvc".split(" ");u.module.controller("logsCtrl",u.qy);u.Rh=function(a,b,c,d){a.info("initWebsocketConfiguration");var e=this;this.$log=a;this.bg=b;this.Yu=c;this.propertiesSrvc=d;this.vr=this.mw=!1;b.sWebSocketUrl="wss://"+location.host+"/"+d.websocket_alias+"/";b.oServerInfos=null;u.oWebsocket.on("serverInfo",function(a){e.bg.$applyAsync(function(){e.vr=!1;e.bg.oServerInfos=a;e.mw&&c(["WEBSOCKET_INFOS_REFRESHED_CONFIGURATION"]).then(function(a){$.notify(a.WEBSOCKET_INFOS_REFRESHED_CONFIGURATION,"success")})})})};
u.Rh.$inject=["$log","$scope","$translate","propertiesSrvc"];u.Rh.prototype.Az=function(){this.$log.info("websocketConfigurationCtrl.reloadWebsocketStatus");var a=this;this.vr=this.mw=!0;Zy(u.oWebsocket,"serverInfo","","Status");setTimeout(function(){a.vr&&(a.Yu(["WEBSOCKET_NO_SERVER_RESPONSE_CONFIGURATION"]).then(function(a){$.notify(a.WEBSOCKET_NO_SERVER_RESPONSE_CONFIGURATION,"error")}),a.bg.$applyAsync(function(){a.bg.oServerInfos=null}))},2E3)};u.Rh.prototype.reloadWebsocketStatus=u.Rh.prototype.Az;
u.Rh.prototype.mI=function(){this.$log.info("websocketConfigurationCtrl.refreshClients");Zy(u.oWebsocket,"refreshClients","refreshClients");var a=this,b=!1;u.oWebsocket.on("connect",function(){b||setTimeout(function(){a.Yu(["WEBSOCKET_USERS_RECONNECTED_CONFIGURATION"]).then(function(a){$.notify(a.WEBSOCKET_USERS_RECONNECTED_CONFIGURATION,"success")});setTimeout(function(){a.Az()},1E3)},500);b=!0})};u.Rh.prototype.refreshClients=u.Rh.prototype.mI;u.module.controller("websocketConfigurationCtrl",u.Rh);u.jB=function(a,b,c){a.info("initVersionConfiguration");b.getStateCssClass=function(a){return a?"install-state-ok":"install-state-error"};z({method:"GET",url:c.web_server_name+"/"+c.services_alias+"/vitis/Versions",params:{app:sessionStorage.application},scope:b,success:function(a){1==a.data.status&&(a.data.VM_VERSION=c.version,a.data.VM_BUILD=c.build,b.oVersion=a.data,b.oVersion.neededUpdate=!0,"trunk"===c.version?delete b.oVersion.appVersion:null===b.oVersion.appVersion?b.oVersion.update="ERROR_RETRIEVE_UPDATE_CONFIGURATION":
(a=angular.copy(c.version).replace(".",""),angular.copy(b.oVersion.appVersion).replace(".","")>a?b.oVersion.update="NEEDED_UPDATE_CONFIGURATION":(b.oVersion.neededUpdate=!1,b.oVersion.update="NO_NEEDED_UPDATE_CONFIGURATION")))}})};u.jB.$inject=["$log","$scope","propertiesSrvc"];u.module.controller("versionConfigurationCtrl",u.jB);u.kv=function(a,b,c,d,e,f){a.info("initActiveDirectoryTree");b.aTreeviewActiveDirectoryTree={};b.gridOptions={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:10,enableColumnMenus:!1,enableColumnResizing:!0,paginationPageSizes:[10,20,50,100],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!1,appLoadGridData:!1,data:[],columnDefs:[]};d("NAME_SEARCH_ACTIVE_DIRECTORY_USERS_USER ACCOUNT_SEARCH_ACTIVE_DIRECTORY_USERS_USER EMAIL_SEARCH_ACTIVE_DIRECTORY_USERS_USER AGENCY_SEARCH_ACTIVE_DIRECTORY_USERS_USER DEPARTMENT_SEARCH_ACTIVE_DIRECTORY_USERS_USER GROUP_SEARCH_ACTIVE_DIRECTORY_USERS_USER".split(" ")).then(function(a){b.gridOptions.columnDefs=
"person"==b.oActiveDirectoryParameters.sObject?[{name:a.NAME_SEARCH_ACTIVE_DIRECTORY_USERS_USER,displayName:a.NAME_SEARCH_ACTIVE_DIRECTORY_USERS_USER,field:"displayname",width:200,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"active_directory_"+e.oSelectedObject.name+"_name"},{name:a.ACCOUNT_SEARCH_ACTIVE_DIRECTORY_USERS_USER,displayName:a.ACCOUNT_SEARCH_ACTIVE_DIRECTORY_USERS_USER,field:"userprincipalname",width:200,enableSorting:!0,type:"string",enableColumnMoving:!0,
enableColumnResizing:!0,headerCellClass:"active_directory_"+e.oSelectedObject.name+"_login"},{name:a.EMAIL_SEARCH_ACTIVE_DIRECTORY_USERS_USER,displayName:a.EMAIL_SEARCH_ACTIVE_DIRECTORY_USERS_USER,field:"email",width:300,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"active_directory_"+e.oSelectedObject.name+"_email"},{name:a.AGENCY_SEARCH_ACTIVE_DIRECTORY_USERS_USER,displayName:a.AGENCY_SEARCH_ACTIVE_DIRECTORY_USERS_USER,field:"company",width:200,enableSorting:!0,
type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"active_directory_"+e.oSelectedObject.name+"_company"},{name:a.DEPARTMENT_SEARCH_ACTIVE_DIRECTORY_USERS_USER,displayName:a.DEPARTMENT_SEARCH_ACTIVE_DIRECTORY_USERS_USER,field:"department",width:200,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"active_directory_"+e.oSelectedObject.name+"_company"}]:[{name:a.GROUP_SEARCH_ACTIVE_DIRECTORY_USERS_USER,displayName:a.GROUP_SEARCH_ACTIVE_DIRECTORY_USERS_USER,
field:"name",width:400,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"active_directory_"+e.oSelectedObject.name+"_name"}]});d("BTN_IMPORT_SELECTION_"+e.oSelectedObject.name.toUpperCase()).then(function(a){e.oSelectedObject.actions=[{label:a,name:b.sSelectedObjectName+"_import_btn",event:"importAdSelection()"}];b.gridOptions.appActions=e.oSelectedObject.actions});b.sFormDefinitionName=e.oSelectedObject.name+"_search_form";b.oFormRequestParams={sUrl:"modules/vitis/forms/users/search_active_directory_"+
b.oActiveDirectoryParameters.sObject+".json"};b.$root.clearFormData(b.sFormDefinitionName,b);e.oFormValues[b.sFormDefinitionName]={};b.bLoadFormValues=!1;b.convertAdTreeToBootstrapTreeview=function(a){for(var c=[],d,e=0;e<a.length;)d={text:a[e].id.split(",")[0],branch:a[e].id},0<a[e].items.length&&(d.nodes=b.convertAdTreeToBootstrapTreeview(a[e].items)),c.push(d),e++;return c};b.loadAdTreeBranch=function(a){z({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/vitis/ActiveDirectory/"+b.oActiveDirectoryParameters.sWebServicePath+
"/"+a,params:{domain_id:b.oLdap.sIdLdap,login:b.oLdap.sLoginLdap.split("@")[0],password:b.oLdap.sPwdLdap,object:b.oActiveDirectoryParameters.sObject},scope:b,success:function(a){1==a.data.status&&(b.gridOptions.data=e.extractWebServiceData("activedirectory",a.data)[0][b.oActiveDirectoryParameters.sWebServicePath.toLowerCase()])}})};b.importAdSelection=function(){var a=b.$root.gridApi[e.sSelectedGridOptionsName].selection.getSelectedRows();b.aSelection=angular.copy(a);for(var c=0,k={domain_id:b.oLdap.sIdLdap,
ldap_name:b.oLdap.sLdapName};c<a.length;)k.action="importFromAd","person"==b.oActiveDirectoryParameters.sObject?(k.company=a[c].company,k.department=a[c].department,k.email=a[c].email,k.name=a[c].displayname,k.login=a[c].userprincipalname):k.name=a[c].name,z({method:"POST",url:f.web_server_name+"/"+f.services_alias+"/vitis/"+b.oActiveDirectoryParameters.sWebServicePath.toLowerCase(),params:k,scope:b,success:function(a){if(1==a.data.status)b.aSelection.shift(),0==b.aSelection.length&&(d("SUCCESFULL_IMPORTATION_"+
e.oSelectedObject.name.toUpperCase()).then(function(a){$.notify(a,"success")}),b.$root.gridApi[e.sSelectedGridOptionsName].selection.clearSelectedRows());else{b.aSelection=[];var c={className:"modal-danger"};null!=a.data.errorMessage&&(c.message=a.data.errorMessage);b.modalWindow("alert","FORM_VALIDATION_ERROR",c)}}}),c++};b.searchAdTree=function(){for(var a=c.defer(),d=a.promise,k={domain_id:b.oLdap.sIdLdap,login:b.oLdap.sLoginLdap.split("@")[0],password:b.oLdap.sPwdLdap},m=e.oFormValues[b.sFormDefinitionName],
p=Object.keys(m),t=0;t<p.length;)""!=m[p[t]]&&(k[p[t]]=m[p[t]]),t++;z({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/vitis/ActiveDirectory/"+b.oActiveDirectoryParameters.sWebServicePath,params:k,scope:b,success:function(c){1==c.data.status&&(b.gridOptions.data=e.extractWebServiceData("activedirectory",c.data)[0][b.oActiveDirectoryParameters.sWebServicePath.toLowerCase()]);a.resolve()}});return d}};u.kv.$inject="$log $scope $q $translate envSrvc propertiesSrvc".split(" ");
u.module.controller("activeDirectoryTreeCtrl",u.kv);u.sB=function(a,b,c){a.info("initWebServiceHelp");b.sUrlWebServiceDoc=c.web_server_name+"/"+c.doc_alias+"/index.phtml"};u.sB.$inject=["$log","$scope","propertiesSrvc"];u.module.controller("webServiceHelpCtrl",u.sB);u.Ev=function(a){return{restrict:"A",controller:"logsCtrl",controllerAs:"ctrl",link:function(b){a(["FORM_BTN_DELETE_FILE_LOGS"]).then(function(a){a={title:a.FORM_BTN_DELETE_FILE_LOGS,placement:"bottom",trigger:"hover",container:"body"};angular.element("#btn_delete_log_file").tooltip(a)});b.$on("$destroy",function(){angular.element("#btn_delete_log_file").tooltip("destroy");window.removeEventListener("resize",b.resizeLogsContainer)})}}};u.Ev.$inject=["$translate"];u.module.directive("appLogs",u.Ev);
u.lC=function(){return{replace:!0,templateUrl:"templates/formTpl.html"}};u.module.directive("appLogsForm",u.lC);
u.Fv=function(a,b,c,d){return{link:function(e,f){e.loadTreeview=function(){$("#logs-content-container").hide();z({method:"GET",url:c.web_server_name+"/"+c.services_alias+"/vitis/Logs",params:{application_name:sessionStorage.application},scope:e,success:function(b){1==b.data.status&&a(function(){b.data=b.data.tree;e.oSelectedLogFile={};e.aTreeviewLogs=b.data;$(f).treeview({showBorder:!1,expandIcon:"glyphicon glyphicon-folder-close",collapseIcon:"glyphicon glyphicon-folder-open",onNodeSelected:function(a,
b){e.oSelectedLogFile=b;e.getFileContent(b,b.size)},onNodeUnselected:function(){e.oSelectedLogFile=[]},highlightSelected:!0,multiSelect:!1,data:e.aTreeviewLogs.data})})}})};e.deleteLogsHistory=function(){var a=d.oFormValues[d.sFormDefinitionName].min_days_files;b("DELETE_HISTORY_CONFIRM_LOGS",{min_days_files:a}).then(function(b){e.modalWindow("confirm","",{className:"modal-warning",message:b,callback:function(b){b&&z({method:"DELETE",url:c.web_server_name+"/"+c.services_alias+"/vitis/Logs",params:{min_days:a},
scope:e,success:function(){e.loadTreeview()}})}})})};e.deleteLogFile=function(a){e.modalWindow("confirm","",{className:"modal-warning",message:"DELETE_FILE_CONFIRM_LOGS",callback:function(b){b&&e.deleteFile(a)}})};e.loadTreeview();e.$on("$destroy",function(){$("#"+f[0].id).treeview("remove")})}}};u.Fv.$inject=["$timeout","$translate","propertiesSrvc","envSrvc"];u.module.directive("appLogsTreeviewContainer",u.Fv);u.dw=function(){return{restrict:"A",controller:"websocketConfigurationCtrl",controllerAs:"ctrl"}};u.appWebsocketConfigurationDrtv=u.dw;u.module.directive("appWebsocketConfiguration",u.dw);u.aw=function(){return{restrict:"A",controller:"versionConfigurationCtrl",controllerAs:"ctrl"}};u.appVersionConfigurationDrtv=u.aw;u.module.directive("appVersionConfiguration",u.aw);u.Mv=function(a,b){return{link:function(c,d){a.info("initPhpInfoConfiguration");z({method:"GET",url:b.web_server_name+"/"+b.services_alias+"/vitis/Phpinfo",scope:c,success:function(a){if(1==a.data.status){var b=document.implementation.createHTMLDocument("phpinfo");b.documentElement.innerHTML=a.data.phpinfo;d[0].innerHTML=b.body.innerHTML}}})}}};u.Mv.$inject=["$log","propertiesSrvc"];u.module.directive("appPhpInfo",u.Mv);u.dC=function(){return{restrict:"A",controller:"activeDirectoryTreeCtrl",controllerAs:"ctrl",templateUrl:"templates/workspaceListTpl.html"}};u.module.directive("appActiveDirectoryFiles",u.dC);u.eC=function(){return{replace:!0,templateUrl:"templates/formTpl.html"}};u.module.directive("appActiveDirectoryTreeForm",u.eC);
u.tv=function(a,b,c){return{link:function(d,e){e[0].id=d.sSelectedObjectName+"_treeview";a("TITLE_SECTION_"+c.oSelectedObject.name.toUpperCase()).then(function(a){document.querySelector("#container_mode_"+c.oSelectedMode.mode_id+" .double-form-title").textContent=a});z({method:"GET",url:b.web_server_name+"/"+b.services_alias+"/vitis/ActiveDirectory/Tree",params:{domain_id:d.oLdap.sIdLdap,login:d.oLdap.sLoginLdap.split("@")[0],password:d.oLdap.sPwdLdap,object:d.oActiveDirectoryParameters.sObject},
scope:d,success:function(a){1==a.data.status&&(a.data=c.extractWebServiceData("activedirectory",a.data)[0].tree,d.aTreeviewActiveDirectoryTree.data=d.convertAdTreeToBootstrapTreeview(a.data),d.oLdap.sDn=a.data[0].id.split(",").slice(1).join(","),$(e).treeview({showBorder:!1,expandIcon:"glyphicon glyphicon-plus",collapseIcon:"glyphicon glyphicon-minus",highlightSelected:!0,multiSelect:!1,levels:0,data:d.aTreeviewActiveDirectoryTree.data,onNodeSelected:function(a,b){d.loadAdTreeBranch(b.branch)}}))}});
d.$on("$destroy",function(){$("#"+e[0].id).treeview("remove")})}}};u.tv.$inject=["$translate","propertiesSrvc","envSrvc"];u.module.directive("appActiveDirectoryTreeTreeviewContainer",u.tv);u.cw=function(){return{restrict:"A",controller:"webServiceHelpCtrl",controllerAs:"ctrl",link:function(a,b){cd();b[0].onload=function(){var a=b[0].contentDocument.querySelector("header");a.parentNode.removeChild(a);dd()}}}};u.appWebServiceHelpDrtv=u.cw;u.module.directive("appWebServiceHelp",u.cw);u.on("appMainDrtvLoaded",function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["envSrvc"]);angular.element(u.f).injector().get(["sessionSrvc"]);var c=angular.element(u.f).injector().get(["propertiesSrvc"]);angular.element(u.Pb).scope().preventUserPasswordChanged=function(a){var b=angular.element(u.Pb).injector().get(["$q"]),c=angular.element(u.f).injector().get(["$log"]),d=angular.element(u.f).injector().get(["envSrvc"]),h=angular.element(u.f).injector().get(["userSrvc"]);
c.info("preventUserPasswordChanged");var k=b.defer(),b=k.promise,c=document.querySelector("form[name='"+d.oFormDefinition[d.sFormDefinitionName].name+"'] input[name='password']"),m=document.querySelector("form[name='"+d.oFormDefinition[d.sFormDefinitionName].name+"'] input[name='password_confirm']");null==d.oFormValues[d.sFormDefinitionName].domain&&""!==c.value?c.value!==m.value?(a={className:"modal-danger",appCallback:function(){k.reject()}},this.modalWindow("dialog","ERROR_PASSWORD_CONFIRM_USER_USER",
a)):a||d.oFormValues[d.sFormDefinitionName].user_id===h.id?(a={className:"modal-warning",message:"UPDATE_PASSWORD_USER_USER",callback:function(a){a?k.resolve():k.reject()}},this.modalWindow("confirm","WARNING_PASSWORD_CHANGE_USER_USER",a)):k.resolve():k.resolve();return b};angular.element(u.Pb).scope().disconnectUserPasswordChanged=function(){var a=angular.element(u.f).injector().get(["envSrvc"]),b=angular.element(u.f).injector().get(["$log"]),c=angular.element(u.f).injector().get(["userSrvc"]);b.info("disconnectUserPasswordChanged");
if(null===a.oFormValues[a.sFormDefinitionName].domain){var b=document.querySelector("form[name='"+a.oFormDefinition[a.sFormDefinitionName].name+"'] input[name='password']"),g=document.querySelector("form[name='"+a.oFormDefinition[a.sFormDefinitionName].name+"'] input[name='password_confirm']");""!==b.value&&b.value===g.value&&a.oFormValues[a.sFormDefinitionName].user_id===c.id&&angular.element(u.Pb).injector().get(["sessionSrvc"]).disconnect()}};angular.element(u.f).scope().loadLogsJob=function(){var a=
angular.element(u.f).injector().get(["$log"]);angular.element(u.f).injector().get(["envSrvc"]).sMode="update";a.info("loadLogsJob")};angular.element(u.f).scope().loadConfiguration=function(){var a=angular.element(u.f).injector().get(["$log"]);angular.element(u.f).injector().get(["envSrvc"]).sMode="update";a.info("loadConfiguration")};angular.element(u.f).scope().setPropertiesFormValues=function(a){var b=angular.element(u.f).injector().get(["$log"]),c=angular.element(u.f).injector().get(["envSrvc"]),
d=angular.element(u.f).injector().get(["propertiesSrvc"]),h=angular.element(u.f).injector().get(["formSrvc"]);b.info("setPropertiesFormValues");if("undefined"===typeof c.oFormValues[c.sFormDefinitionName]||fb(c.oFormValues[c.sFormDefinitionName]))var k=this.$root.$on("formDefinitionLoaded",function(){k();var b=0,e,f=Object.keys(d);c.oFormValues[c.sFormDefinitionName]={log_directories:d.log_directories};Array.isArray(a)||(a=[]);for(a.forEach(function(a){c.oFormValues[c.sFormDefinitionName][a]=angular.copy(d[a])});b<
f.length;)e=h.getFormElementDefinition(f[b],c.sFormDefinitionName),"undefined"!==typeof e&&(c.oFormValues[c.sFormDefinitionName][f[b]]="select"===e.type?{selectedOption:{value:angular.copy(d[f[b]])}}:angular.copy(d[f[b]])),b++;b=parseInt(c.oFormValues[c.sFormDefinitionName].max_upload_file_size);"NaN"===b?b="":0<b&&(b=parseInt(b/1048576));c.oFormValues[c.sFormDefinitionName].max_upload_file_size=b;"undefined"!=typeof c.oFormValues[c.sFormDefinitionName].rows_per_page&&(c.oFormValues[c.sFormDefinitionName].rows_per_page.selectedOption.value=
String(c.oFormValues[c.sFormDefinitionName].rows_per_page.selectedOption.value));c.oFormDefaultValues[c.sFormDefinitionName]=angular.copy(c.oFormValues[c.sFormDefinitionName])})};angular.element(u.Pb).scope().testPublicConnection=function(){var b=angular.element(u.f).injector().get(["propertiesSrvc"]);a.info("testPublicConnection");var c=this.$new();z({method:"POST",url:b.web_server_name+"/"+b.services_alias+"/vitis/PrivateToken",data:{user:document.getElementById("configuration_vitis_configuration_general_update_form_public_login").value,
password:document.getElementById("configuration_vitis_configuration_general_update_form_public_password").value},scope:c,success:function(a){if(1===a.data.status){var b={className:"modal-success"};c.modalWindow("dialog","Connexion R\u00e9ussie",b)}else b={className:"modal-danger"},null!==a.data.errorMessage&&(b.message=a.data.errorMessage),c.modalWindow("alert","ERROR_BIND_ACTIVE_DIRECTORY_USERS_USER",b)}})};angular.element(u.f).scope().loadUser=function(){var a=angular.element(u.f).injector().get(["$log"]),
b=angular.element(u.f).injector().get(["envSrvc"]),c=angular.element(u.f).injector().get(["userSrvc"]);a.info("loadUser");b.sId=c.id;a="before"+Ga(b.oSelectedObject.name,"_").replace(/_/g,"")+"Edition";this.$root[a]();angular.element(u.f).scope().loadSimpleForm()};u.$v=function(a){return{link:function(b,c,d){var e=d.$observe("appUserRoleColumn",function(d){if(null===b.row.entity[b.col.field]||""===b.row.entity[b.col.field])c[0].className="";else{var e;"admin"===d?e="admin-role":"user"===d&&(e="user-role");
c[0].className="ui-grid-cell-contents "+e;a(["USER_ROLE_TOOLTIP_TITLE_USERS_USER","USER_ROLE_ADMIN_TOOLTIP_CONTENT_USERS_USER","USER_ROLE_USER_TOOLTIP_CONTENT_USERS_USER"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:a.USER_ROLE_TOOLTIP_TITLE_USERS_USER,content:function(){var c="";"admin"===b.row.entity[b.col.field]?c=a.USER_ROLE_ADMIN_TOOLTIP_CONTENT_USERS_USER:"user"===b.row.entity[b.col.field]&&(c=a.USER_ROLE_USER_TOOLTIP_CONTENT_USERS_USER);return c},placement:function(a,
c){return b.$root.workspaceTooltipPlacement(c)}})})}});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};u.$v.$inject=["$translate"];u.compileProvider.directive("appUserRoleColumn",u.$v);angular.element(u.f).scope().hideExcludedUserPrivileges=function(a){var b=angular.element(u.f).injector().get(["$log"]),c=angular.element(u.f).injector().get(["$timeout"]),d=angular.element(u.f).injector().get(["envSrvc"]),h=angular.element(u.f).injector().get(["userSrvc"]),k=angular.element(u.f).injector().get(["formSrvc"]);
b.info("hideExcludedUserPrivileges");d.sId===h.id&&c(function(){for(var b=["vitis_admin","vitis_user"],c=k.getFormElementDefinition(a,d.sFormDefinitionName),e=d.oFormValues[d.sFormDefinitionName],f=[c.id,c.id_from],c=[a,c.name_from],g,h,y=0;y<f.length;){g=0;for(h=document.getElementById(f[y]);h.options.length>g;)h.options[g].style.display="",-1!==b.indexOf(h.options[g].text)&&(h.options[g].style.display="none",e[c[y]].options[g].disabled=!0),g++;y++}});null!=d.oFormValues[d.sFormDefinitionName].last_connection&&
(d.oFormValues[d.sFormDefinitionName].last_connection_pretty=moment(d.oFormValues[d.sFormDefinitionName].last_connection).format("L LTS"))};angular.element(u.f).scope().ImportFromAd=function(a){var b=angular.element(u.f).injector().get(["$log"]),c=angular.element(u.X).injector().get(["$compile"]),d=angular.element(u.X).injector().get(["$templateRequest"]),h=angular.element(u.f).injector().get(["envSrvc"]);angular.element(u.f).injector().get(["formSrvc"]);angular.element(u.f).injector().get(["modesSrvc"]);
b.info("ImportFromAd");var k=this.$new();k.oActiveDirectoryParameters={sObject:a};k.oActiveDirectoryParameters.sWebServicePath="person"==a?"Users":"Groups";var m="form_active_directory_connection_"+h.oSelectedObject.name;k.modalWindow("dialog","TITLE_ACTIVE_DIRECTORY_CONNECTION",{className:"dialog-modal-window dialog-modal-window-ad-connection",message:'<div id="'+m+'"></div>'});k.sFormDefinitionName=h.oSelectedObject.name+"_import_ad_form";h.sFormDefinitionName=k.sFormDefinitionName;k.oFormRequestParams=
{sUrl:"modules/vitis/forms/users/active_directory_connection.json"};k.$root.clearFormData(k.sFormDefinitionName,k);k.bLoadFormValues=!1;h.oFormValues[k.sFormDefinitionName]={};d("templates/formTpl.html").then(function(a){c($("#"+m).html(a).contents())(k)});b.info("compileObjectTemplate : templates/formTpl.html");var p=k.$root.$on("endFormNgRepeat",function(){p();var a=document.createElement("span");a.id=h.sFormDefinitionName+"_login_domain";a.className="dialog-modal-window-login-domain";document.querySelector("form[name='"+
h.oFormDefinition[h.sFormDefinitionName].name+"'] .row:nth-child(2)").appendChild(a);var b=k.$root.$on("webServiceSelectOptionsloaded",function(){b();0==h.oFormValues[k.sFormDefinitionName].domain.options.length?document.querySelector("form[name='"+h.oFormDefinition[h.sFormDefinitionName].name+"'] select[name='domain']").options.length=0:a.innerHTML="@"+h.oFormValues[k.sFormDefinitionName].domain.selectedOption.value});document.querySelector("form[name='"+h.oFormDefinition[h.sFormDefinitionName].name+
"'] select[name='domain']").addEventListener("change",function(){a.innerHTML="@"+this.selectedOptions[0].value})})};angular.element(u.f).scope().loadImportForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$q"]),c=angular.element(u.X).injector().get(["$compile"]),g=angular.element(u.X).injector().get(["$templateRequest"]),h=angular.element(u.f).injector().get(["envSrvc"]),k=angular.element(u.f).injector().get(["propertiesSrvc"]),m=angular.element(u.f).injector().get(["modesSrvc"]);
a.info("loadImportForm");var p=this;m.addScopeToObject(h.oSelectedObject.name,h.oSelectedMode.mode_id,p);p=p.$new();m.addScopeToObject(h.oSelectedObject.name,h.oSelectedMode.mode_id,p);var t=b.defer(),b=t.promise,v=h.oFormValues[p.sFormDefinitionName],w=des(v.login+"@"+v.domain.selectedOption.value,v.password,1,0),v={login:v.login,password:stringToHex(w),object:p.oActiveDirectoryParameters.sObject,domain:v.domain.selectedOption.value};z({method:"GET",url:k.web_server_name+"/"+k.services_alias+"/vitis/ActiveDirectory/Test",
params:v,scope:p,success:function(b){if(1===b.data.status)bootbox.hideAll(),p.oLdap=h.extractWebServiceData("activedirectory",b.data)[0],h.oSelectedObject={actions:[],columns:[],mode_id:h.oSelectedMode.mode_id,name:"active_directory_"+h.oSelectedObject.name,sections:"",template_name:"activeDirectoryTree",aScope:h.oSelectedObject.aScope},m.getMode(h.oSelectedMode.mode_id).objects.push(h.oSelectedObject),m.addScopeToObject(h.oSelectedObject.name,h.oSelectedMode.mode_id,p),g("templates/doubleFormTpl.html").then(function(a){c($("#container_mode_"+
h.oSelectedMode.mode_id).html(a).contents())(p)}),a.info("compileObjectTemplate : templates/doubleFormTpl.html"),t.resolve();else{p.aSelection=[];var d={className:"modal-danger"};null!==b.data.errorMessage&&(d.message=b.data.errorMessage);p.modalWindow("alert","ERROR_BIND_ACTIVE_DIRECTORY_USERS_USER",d)}}});return b};angular.element(u.f).scope().updateProperties=function(a){var b=angular.element(u.f).injector().get(["$log"]),c=angular.element(u.f).injector().get(["$translate"]),d=angular.element(u.f).injector().get(["$window"]),
h=angular.element(u.f).injector().get(["envSrvc"]),k=angular.element(u.f).injector().get(["propertiesSrvc"]),m=angular.element(u.f).injector().get(["formSrvc"]);b.info("updateProperties");var p=this,t={properties:m.getFormData(h.sFormDefinitionName,!0),module_name:a};z({method:"PUT",url:k.web_server_name+"/"+k.services_alias+"/vitis/Properties/"+a,data:t,scope:p,success:function(b){if(1===b.data.status){c("FORM_VALIDATION_OK").then(function(a){$.notify(a,"success")});if("vitis"===a&&k.language!==
t.properties.language){var e={className:"modal-warning",message:"PAGE_RELOAD_CONFIRM_CONFIGURATION",callback:function(a){a&&d.location.reload()}};p.modalWindow("confirm","",e)}k.getFromServer()}else e={className:"modal-danger"},null!==b.data.errorMessage&&(e.message=b.data.errorMessage),p.modalWindow("alert","FORM_VALIDATION_ERROR",e)}})};angular.element(u.f).scope().beforeUsersVitisUsersEdition=function(a){var b=angular.element(u.f).injector().get(["$log"]),c=angular.element(u.f).injector().get(["envSrvc"]),
d=angular.element(u.f).injector().get(["formSrvc"]),h=angular.element(u.f).injector().get(["propertiesSrvc"]);b.info("beforeUsersVitisUsersEdition");var k=this,m=k.$root.$on("formDefinitionLoaded",function(b,e){m();if(null!=c.oFormValues[e].domain){b=d.getAllFormElementDefinition(e);for(var f=0;f<b.length;){switch(b[f].name){case "name":case "email":case "company":case "department":b[f].type="label";break;case "new_password_title":case "password":case "password_confirm":b[f].visible=!1;break;case "groups":case "privileges":h.mixed_rights_management||
(b[f].visible=!1);break;case "active_directory_groups":b[f].visible=!0;z({method:"GET",url:h.web_server_name+"/"+h.services_alias+"/vitis/ActiveDirectory/UserGroups/"+a,scope:k,success:function(a){1===a.data.status&&(c.oFormValues[e].active_directory_groups=a.data.activedirectory[0].adGroups,c.oFormValues[e].all_groups=a.data.activedirectory[0].allGroups)}});break;case "all_groups":h.mixed_rights_management&&(b[f].visible=!0)}f++}}})};angular.element(u.f).scope().beforeUserVitisUserEdition=function(){var a=
angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["envSrvc"]),c=angular.element(u.f).injector().get(["formSrvc"]);a.info("beforeUserVitisUserEdition");var g=this.$root.$on("formDefinitionLoaded",function(a,d){g();if(null!==b.oFormValues[d].domain)for(a=c.getAllFormElementDefinition(d),d=0;d<a.length;){switch(a[d].name){case "new_password_title":case "password":case "password_confirm":a[d].visible=!1}d++}})};angular.element(u.f).scope().beforeSendingDomainForm=function(){var a=
angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["envSrvc"]);a.info("beforeSendingDomainForm");a=b.oFormValues[b.sFormDefinitionName];null!=a.login&&(-1===a.login.indexOf("@")&&(a.login+="@"+a.domain),null!=a.password&&"0x"!==a.password.substr(0,2)&&(b=des(a.login,a.password,1,0),a.password=stringToHex(b)))};angular.element(u.f).scope().getUsers2DomainFilter=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["propertiesSrvc"]);
a.info("getUsers2DomainFilter");if(!b.mixed_rights_management)return"IS NULL"};angular.element(u.f).scope().isImgFile=function(a){-1!==a.indexOf("?")&&(a=a.substr(0,a.indexOf("?")));a=a.split(".");return-1<["jpg","png","jpeg"].indexOf(a[a.length-1].toLowerCase())};u.iC=function(){return{replace:!0,template:'<div><img class="miniature_picture ui-grid-cell-contents" width="50" height="50" ng-src="{{urlToPicture}}" ng-hide="true"></img><span ng-show="responseHavePicture && !bFileIsPdf" ng-click="openViewer()" class="glyphicon glyphicon-picture grid-column-glyph-icon"></span><a ng-show="responseHavePicture && bFileIsPdf" ng-href="{{urlToPicture}}" target="_blank"><span class="glyphicon glyphicon-link grid-column-glyph-icon"></span></a></div>',
link:function(a,b,c){var d=c.$observe("file",function(){null===c.file||""===c.file?(b[0].children[1].className="",a.responseHavePicture=!1):a.responseHavePicture=!0;if(null==c.path)console.error("Path attribute is not present on directive caller");else if(null==c.file)console.error("File attribute is not present on directive caller");else if(""!==c.file&&(null==c.alias&&(console.warn("alias attribute is not present on directive caller (set with default value : public_alias)"),c.alias="public_alias"),
null!=c.maxPopover?""===c.maxPopover?(console.warn("File attribute is an empty string (set with default value : 200)"),c.maxPopover=200):r(c.maxPopover)&&(c.maxPopover=parseInt(c.maxPopover)):(console.warn("maxPopover attribute is not present on directive caller (set with default value : 200)"),c.maxPopover=200),null!=c.imgClass?r(c.imgClass)||(c.imgClass=""):c.imgClass="",null!=c.popoverClass?r(c.popoverClass)||(c.popoverClass=""):c.popoverClass="",a.oProperties=angular.element("#works_line").scope().oProperties,
a.path=null!=a[c.path]?a[c.path]:c.path,a.urlToPicture=a.oProperties.web_server_name+"/"+a.oProperties[c.alias]+"/"+a.path+"/"+c.file,/^https?:\/\//.test(c.file)&&(a.urlToPicture=c.file),b.find("img")[0].onerror=function(){console.error("Fail to load image",c.file)},a.bFileIsPdf=!a.$root.isImgFile(c.file),b[0].parentNode.style.textAlign="center",!a.bFileIsPdf))if(null===c.file||""===c.file)b[0].children[1].className="";else{var e={inline:!1,button:!0,navbar:!1,title:2,toolbar:2,tooltip:!0,fullscreen:!1,
url:function(){return a.urlToPicture}};null!=a.viewer?a.viewer.update():a.viewer=new Viewer(b[0].children[0],e);a.openViewer=function(){a.viewer.show();angular.element(".viewer-prev").remove();angular.element(".viewer-next").remove()};$(b[0].children[1]).popover({trigger:"hover",container:"body",title:"",content:function(){var b=document.createElement("img");b.src=a.urlToPicture;var d=c.maxPopover,e=b.naturalWidth,f=b.naturalHeight,d=e<f?f/d:e/d;b.width=0<d?e/d:e;b.height=0<d?f/d:f;b.className=c.imgClass;
return b.outerHTML},html:!0,template:'<div class="popover '+c.popoverClass+' " role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'});a.$on("$destroy",function(){$(b[0].children[1]).popover("destroy");a.viewer.destroy();d()})}})}}};u.compileProvider.directive("appDocumentViewer",u.iC);u.Cv=function(a){return{replace:!1,template:'<a ng-click="goToItem()">{{itemData}}</a>',link:function(b,c,d){var e=angular.element(u.X).injector().get(["envSrvc"]),
f=d.$observe("itemData",function(){null==(d.itemData||""===d.itemData)&&(console.warn("No data display in column"),d.itemData="");null==(d.mode||""===d.mode)&&(console.warn("No mode selected (set to 'update' as default value)"),d.mode="update");null!=d.object?""===d.object?console.error("objet name is empty"):null!=d.fieldToSelect?""===d.fieldToSelect?console.error("fieldToSelect name is empty"):(b.itemData=d.itemData,b.goToItem=function(){angular.element("#object_column").scope().selectObject(d.object,
void 0,{});a(function(){e.setSectionForm(d.mode,d.fieldToSelect)},800)},b.$on("$destroy",function(){f()})):console.error("No fieldToSelect define"):console.error("No object define")})}}};u.Cv.$inject=["$timeout"];u.compileProvider.directive("appLinker",u.Cv);angular.element(u.f).scope().setWorkObject=function(a,b){var c=angular.element(u.X).injector().get(["$log"]),d=angular.element(u.f).injector().get(["propertiesSrvc"]),e=angular.element(u.X).scope(),k=angular.element(u.X).injector().get(["envSrvc"]);
angular.element(u.f).scope();var m=angular.element(u.f).scope().oWorkObjects[a][b].config;if(-1===sessionStorage.application_modules.split(",").indexOf(a))return 0;c.info("setWorkObject for module : "+a+" on Object "+b);var p=e.$root.gridApi[k.sSelectedGridOptionsName].selection.getSelectedRows();if(!q(p))return console.error("aSelectedRows is not an array"),0;if(1!==p.length)return bootbox.alert("<h4>Veuillez s\u00e9lectionner un(e) unique "+b+"</h4>"),0;c={user_id:sessionStorage.user_id};c[m.sFieldId]=
p[0][m.sFieldId];z({method:"POST",url:d.web_server_name+"/"+d.services_alias+"/"+m.sWebService,params:c,success:function(c){n(c.data)||(bootbox.alert("<h4>Erreur lors de la d\u00e9finition du "+b+" de travail</h4>"),console.error("response: ",c));n(c.data.errorMessage)&&(bootbox.alert("<h4>Erreur lors de la d\u00e9finition du "+b+" de travail</h4><br>"+c.data.errorType+"<br>"+c.data.errorMessage),console.error("response: ",c));angular.element(u.X).scope().refreshGrid(e,k.oGridOptions[k.sSelectedGridOptionsName]);
angular.element("#"+m.sIdButtonLock).prop("disabled",!0);angular.element("#"+m.sIdButtonUnlock).prop("disabled",!1);angular.element(u.f).scope().oWorkObjects[a][b].value=p[0][m.sFieldId]},error:function(a){bootbox.alert("<h4>Erreur lors de la d\u00e9finition du "+b+" de travail:</h4><br>"+a.status);console.error("response: ",a.status)}})};u.Zv=function(){return{link:function(a,b,c){var d=c.$observe("text",function(){n(c.text)&&""!==c.text?(b[0].className="ui-grid-cell-contents info-icon",$(b).popover({trigger:"hover",
container:"body",title:c.title,content:function(){return c.text},html:"html"===c.mode,placement:function(b,c){return a.$root.workspaceTooltipPlacement(c)}})):b[0].className="";a.$on("$destroy",function(){$(b).popover("destroy");d()})})}}};u.Zv.$inject=["$translate"];u.compileProvider.directive("appTextPopoverDisplay",u.Zv);u.Lv=function(){return{replace:!0,template:'<div class="progress" style="margin: 5px 10px 10px;"><div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width:{{row.entity[col.field]}}%">{{textValue}}</div></div>',
link:function(a,b,c){a.vM=null!=c.hidevalue?"":a.rM.PL[a.LL.RL]+"%";null!=c.mode&&(b[0].firstChild.className=b[0].firstChild.className+" progress-bar-"+c.mode);null!=c.striped&&(b[0].firstChild.className+=" progress-bar-striped",null!=c.active&&(b[0].firstChild.className+=" active"))}}};u.Lv.$inject=["$translate"];u.compileProvider.directive("appNavbar",u.Lv);angular.element(u.f).scope().clearWorkObject=function(a,b){var c=angular.element(u.X).injector().get(["$log"]),d=angular.element(u.f).injector().get(["propertiesSrvc"]),
e=angular.element(u.X).scope(),k=angular.element(u.X).injector().get(["envSrvc"]);angular.element(u.f).scope();var m=angular.element(u.f).scope().oWorkObjects[a][b].config;if(-1===sessionStorage.application_modules.split(",").indexOf(a))return 0;c.info("clearWorkPost for module : "+a+" on Object "+b);z({method:"DELETE",url:d.web_server_name+"/"+d.services_alias+"/"+m.sWebService+"/"+sessionStorage.user_id,success:function(c){n(c.data)||(bootbox.alert("<h4>Erreur lors de la lib\u00e9ration du "+b+
" de travail</h4>"),console.error("response: ",c));n(c.data.errorMessage)&&(bootbox.alert("<h4>Erreur lors de la lib\u00e9ration du "+b+" de travail</h4><br>"+c.data.errorType+"<br>"+c.data.errorMessage),console.error("response: ",c));angular.element(u.X).scope().refreshGrid(e,k.oGridOptions[k.sSelectedGridOptionsName]);angular.element("#"+m.sIdButtonLock).prop("disabled",!1);angular.element("#"+m.sIdButtonUnlock).prop("disabled",!0);angular.element(u.f).scope().oWorkObjects[a][b].value=!1},error:function(a){bootbox.alert("<h4>Erreur lors de la lib\u00e9ration du "+
b+" de travail:</h4><br>"+a.status);console.error("response: ",a.status)}})};angular.element(u.f).scope().initWorkObject=function(a,b,c){null!=angular.element(u.f).scope().oWorkObjects||(angular.element(u.f).scope().oWorkObjects={});angular.element(u.f).scope().oWorkObjects[a]={};angular.element(u.f).scope().oWorkObjects[a][b]={};angular.element(u.f).scope().oWorkObjects[a][b].value=!1;angular.element(u.f).scope().oWorkObjects[a][b].config=c};angular.element(u.f).scope().getWorkObject=function(a,
b){return angular.element(u.f).scope().oWorkObjects[a][b].value};angular.element(u.f).scope().lookWorkObjectIsAlreadyLock=function(a,b){var c=angular.element(u.f).injector().get(["propertiesSrvc"]),d=angular.element(u.f).scope().oWorkObjects[a][b].config;z({method:"GET",headers:{Accept:"application/x-vm-json"},url:c.web_server_name+"/"+c.services_alias+"/"+d.sWebService,params:{filter:{relation:"AND",operators:[{column:"user_id",compare_operator:"=",value:sessionStorage.user_id}]},distinct:!0},success:function(c){n(c.data)||
(bootbox.alert("<h4>Erreur lors de la d\u00e9finition du "+b+"</h4>"),console.error("response: ",c));n(c.data.errorMessage)&&(bootbox.alert("<h4>Erreur lors de la d\u00e9finition du "+b+"</h4><br>"+c.data.errorType+"<br>"+c.data.errorMessage),console.error("response: ",c));1===c.data.list_count?(angular.element(u.f).scope().oWorkObjects[a][b].value=c.data.data[0][d.sFieldId],angular.element("#"+d.sIdButtonLock).prop("disabled",!0),angular.element("#"+d.sIdButtonUnlock).prop("disabled",!1)):(angular.element("#"+
d.sIdButtonLock).prop("disabled",!1),angular.element("#"+d.sIdButtonUnlock).prop("disabled",!0))},error:function(a){bootbox.alert("<h4>Erreur lors de la r\u00e9cup\u00e9ration du "+b+":</h4><br>"+a.status);console.error("response: ",a.status)}})};angular.element(u.f).scope().loadHelp=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.X).injector().get(["envSrvc"]);a.info("loadHelp");b.sMode="update"};angular.element(u.f).scope().os=function(){var a=angular.element(u.f).scope();
z({method:"GET",url:"modules/vitis/data/proj.json",scope:a,success:function(b){a.proj=b.data},error:function(a){console.error("ERROR : (AJAX request : "+a.status+" ) On loading Projections, contact Veremes please")}})};angular.element(u.f).scope().os();angular.element(u.f).scope().deleteUsers=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$translate"]),c=angular.element(u.f).injector().get(["envSrvc"]),g=angular.element(u.f).injector().get(["userSrvc"]);
a.info("deleteUsers");var h=angular.element(u.X).scope(),k=!0;h.$root.gridApi[c.sSelectedGridOptionsName].selection.getSelectedRows().forEach(function(a){a.user_id==g.id&&(k=!1,h.$root.gridApi[c.sSelectedGridOptionsName].selection.unSelectRow(a),b(["ERROR_DELETING_OWN_USER"]).then(function(a){h.$root.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:a.ERROR_DELETING_OWN_USER})}))});k&&h.$root.DeleteSelection()};angular.element(u.f).scope().hideCurrentUserFromExcludedPrivileges=
function(a){var b=angular.element(u.f).injector().get(["$log"]),c=angular.element(u.f).injector().get(["$timeout"]),d=angular.element(u.f).injector().get(["envSrvc"]),h=angular.element(u.f).injector().get(["userSrvc"]),k=angular.element(u.f).injector().get(["formSrvc"]);b.info("hideCurrentUserFromExcludedPrivileges");-1!=["vitis_admin","vitis_user"].indexOf(d.sId)&&c(function(){for(var b=k.getFormElementDefinition(a,d.sFormDefinitionName),c=d.oFormValues[d.sFormDefinitionName],e=[b.id,b.id_from],
b=[a,b.name_from],f,g,x=0;x<e.length;){f=0;for(g=document.getElementById(e[x]);g.options.length>f;)g.options[f].style.display="",h.id==g.options[f].value&&(g.options[f].style.display="none",c[b[x]].options[f].disabled=!0),f++;x++}})};angular.element(u.f).scope().loadModes=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$translate"]),c=angular.element(u.X).injector().get(["envSrvc"]);a.info("loadModes");var g=this,a=document.getElementById("container_section_"+
c.oSelectedObject.name+"_modes");a.className+=" section-container-workspace-list";g.gridOptions={enableRowSelection:!0,enableSelectAll:!1,enablePagination:!1,enablePaginationControls:!1,multiSelect:!1,useExternalPagination:!0,paginationPageSize:999,enableColumnMenus:!1,enableColumnResizing:!1,appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!1,appHeaderOptionBar:!1,appLoadGridData:!0,appGridTitle:"LIST_TITLE_GRID_MODES",appFooter:!1,appShowPagination:!1,appEnableDragAndDrop:!0,appDragAndDropEvent:{rowFinishDrag:"updateModesSorting"},
appActions:[],oUrlParams:{action:"getAll",distinct:!0,order_by:"index",sort_order:"ASC"}};g.bLoadFormValues=!1;b(["LIST_MODE_ICONE_MODE_CONFIGURATION","LIST_MODE_ID_MODE_CONFIGURATION"]).then(function(a){g.gridOptions.columnDefs=[{name:a.LIST_MODE_ID_MODE_CONFIGURATION,displayName:a.LIST_MODE_ID_MODE_CONFIGURATION,field:"mode_id",width:300,enableSorting:!1,type:"string",enableColumnMoving:!1,enableColumnResizing:!1,headerCellClass:"vitis_mode_"+c.oSelectedObject.name+"_mode_id"},{name:a.LIST_MODE_ICONE_MODE_CONFIGURATION,
displayName:a.LIST_MODE_ICONE_MODE_CONFIGURATION,field:"mode_id",width:50,enableSorting:!1,type:"number",enableColumnMoving:!1,enableColumnResizing:!1,headerCellClass:"vitis_mode_"+c.oSelectedObject.name+"_index",cellClass:"cell-align-center",cellTemplate:'<div style="font-size:16px;color:#9a9a9a;margin-top:5px;vertical-align:middle" class="icon-{{row.entity[col.field]}}"></div>'}]})};angular.element(u.f).scope().updateModesSorting=function(){a.info("updateMapLayerSorting");for(var d=this,e=b.oGridOptions[b.sSelectedGridOptionsName],
f=0,g=[];f<e.data.length;)g.push(e.data[f].mode_id),f++;z({method:"PUT",url:c.web_server_name+"/"+c.services_alias+"/vitis/modes/sorting",data:{modes_id:g.join("|")},scope:d,success:function(a){0===a.data.status&&d.modalWindow("dialog","ERROR_ADD_MAP_LAYERS_VMAP_MAP_MAP_LAYERS",{className:"modal-danger",message:a.data.errorMessage})}})};angular.element(u.f).scope().reloadWebsocketStatus=function(){function a(){if(!(10<b)){var c=angular.element($('[data-app-websocket-configuration=""]')).scope();null!=
c?null!=c.ctrl?angular.element($('[data-app-websocket-configuration=""]')).scope().ctrl.reloadWebsocketStatus():setTimeout(function(){a()},500):setTimeout(function(){a()},500);b++}}var b=0;setTimeout(function(){a()})}});function az(){return{restrict:"A",controller:"AppImportBoController",controllerAs:"ctrl",bindToController:!0,templateUrl:window.oClientProperties.vmap_folder+"/template/vitis/importBo.html",link:function(a,b){$(b).find(".file").fileinput({showUpload:!1,showPreview:!1,mainClass:"input-group-sm"});a.refreshCodeMirror=function(){setTimeout(function(){$(b).find(".CodeMirror").each(function(a,b){b.CodeMirror.refresh()})});setTimeout(function(){$(b).find(".CodeMirror").each(function(a,b){b.CodeMirror.refresh()})},
500);setTimeout(function(){$(b).find(".CodeMirror").each(function(a,b){b.CodeMirror.refresh()})},1E3)}}}}pa("nsVmap.importBoDrtv",az);A.module.directive("appImportBo",az);function bz(a,b,c,d){b.info("nsVmap.importBoCtrl");this.da=b;this.b=a;this.Ja=c;this.Tq=d;this.op=angular.element(u.f).scope();this.oProperties=angular.element(u.f).injector().get(["propertiesSrvc"]);this.sToken=sessionStorage.session_token;this.oTranslations={};this.Zk=[];this.OI=new RegExp(/^([a-zA-Z0-9_]*)$/);a.displayedStep="import_folder";a.oImportedBo=null;a.usedDatabase=null;a.usedSchema=null;a.oCoordsys=null;a.sSql=null;a.aDatabases=[];a.aSchemas=[];a.aCoordsys=[];a.aConnections=null;a.aWmsServices=
null;a.aVmapServices=null;a.creatingNewSchema="";a.selectedExistingSchema="";a.oBoDef=null;a.oEventDef=null;a.aReportsDef=null;a.aLayersDef=[];a.oBoForm=null;a.oEventForm=null;a.oReportForm=null;a.selectedSteps={import_sql:!0,import_layers:!0,import_bo:!0};a.oImportSteps={test:null,business_object:null,business_object_reports:null,business_object_events:null,layers:null,sql:null};a.oTestSteps={business_objet:null,reports:null,event:null,layers:null,schema:null,tables:null};a.bImportOk=!1;a.steps=
"import_folder select_elements select_database import_schema import_coordsys import_sql import_layers import_bo execute_import finalize".split(" ");cz(this)}pa("nsVmap.importBoCtrl",bz);bz.$inject=["$scope","$log","$q","$translate"];
bz.prototype.MJ=function(a){this.da.info("nsVmap.importBoCtrl.submitStep");var b=this;switch(a){case "import_folder":dz(this);break;case "select_elements":ez(this).then(function(){b.Nf()});break;case "select_database":fz(this).then(function(){b.Nf()});break;case "import_schema":gz(this).then(function(){b.Nf()});break;case "import_coordsys":hz(this).then(function(){b.Nf()});break;case "import_layers":iz(this).then(function(){b.Nf()});break;case "import_bo":jz(this);kz(this).then(function(a){!0===a?
b.Nf():lz(b)});break;default:this.Nf()}};bz.prototype.submitStep=bz.prototype.MJ;bz.prototype.Nf=function(){this.da.info("nsVmap.importBoCtrl.nextStep");var a=angular.copy(this.b.displayedStep),a=this.b.steps.indexOf(a);if(-1!==a)if(null!=this.b.steps[a+1])a=this.b.steps[a+1];else return console.error("next step doesn't exists"),null;else return console.error("this step doesn't exists"),null;this.ws(a)};bz.prototype.nextStep=bz.prototype.Nf;
bz.prototype.jz=function(){this.da.info("nsVmap.importBoCtrl.prevStep");var a=angular.copy(this.b.displayedStep),a=this.b.steps.indexOf(a);if(-1!==a)if(null!=this.b.steps[a-1])a=this.b.steps[a-1];else return console.error("previous step doesn't exists"),null;else return console.error("this step doesn't exists"),null;this.ws(a)};bz.prototype.prevStep=bz.prototype.jz;
bz.prototype.ws=function(a){this.da.info("nsVmap.importBoCtrl.goStep");var b=this;switch(a){case "import_sql":case "import_layers":case "import_bo":if(!1===this.b.selectedSteps[a]){var c=this.b.steps.indexOf(this.b.displayedStep),d=this.b.steps.indexOf(a);if(-1!==c&&-1!==d){this.b.displayedStep=a;if(c<d)return b.Nf(),!0;if(c>d)return b.jz(),!0}}}switch(a){case "select_database":mz(this).then(function(){b.b.displayedStep=a});break;case "select_elements":b.b.displayedStep=a;break;case "import_schema":nz(this).then(function(){b.b.displayedStep=
a});break;case "import_coordsys":oz(this).then(function(){b.b.displayedStep=a});break;case "import_sql":this.da.info("nsVmap.importBoCtrl.loadSql_");this.b.codemirrorSQLOptions={styleActiveLine:!0,indentWithTabs:!0,lineWrapping:!0,lineNumbers:!0,readOnly:!1,mode:"sql",tabSize:2,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]};null==this.b.sSql&&(this.b.sSql="",-1===this.b.aSchemas.indexOf(this.b.usedSchema)&&0<this.b.usedSchema.length&&(this.b.sSql+="\n--",this.b.sSql+="\n-- Creation Schema",
this.b.sSql+="\n--",this.b.sSql+="\n",this.b.sSql+="\nCREATE SCHEMA [TABLE_SCHEMA] AUTHORIZATION u_vitis;",this.b.sSql+="\nGRANT ALL ON SCHEMA [TABLE_SCHEMA] TO u_vitis;",this.b.sSql+="\n",this.b.sSql+="\n"),null!=this.b.oImportedBo&&null!=this.b.oImportedBo.sql&&null!=this.b.oImportedBo.sql.table&&(this.b.sSql+=this.b.oImportedBo.sql.table));this.b.displayedStep=a;break;case "import_layers":pz(this).then(function(){b.b.displayedStep=a});break;case "import_bo":lz(this);this.b.displayedStep=a;break;
case "execute_import":this.b.oImportSteps={test:null,business_object:null,business_object_reports:null,business_object_events:null,layers:null,sql:null};this.b.oTestSteps={business_objet:null,reports:null,event:null,layers:null,schema:null,tables:null};this.b.displayedStep=a;break;default:this.b.displayedStep=a}};bz.prototype.goStep=bz.prototype.ws;
bz.prototype.qJ=function(a,b){this.da.info("nsVmap.importBoCtrl.setUsedSchema");b?this.b.selectedExistingSchema="":this.b.creatingNewSchema="";this.b.usedSchema=null!=this.b.creatingNewSchema&&""!==this.b.creatingNewSchema||null!=this.b.selectedExistingSchema&&""!==this.b.selectedExistingSchema?a:null};bz.prototype.setUsedSchema=bz.prototype.qJ;
bz.prototype.MD=function(a){this.da.info("nsVmap.importBoCtrl.executeImport");var b=this;this.b.bImportOk=!1;this.b.oImportSteps={test:null,business_object:null,business_object_reports:null,business_object_events:null,layers:null,sql:null};Na(this.Zk);this.b.oImportSteps.test=!1;qz(this).then(function(c){if(!0===c){b.b.oImportSteps.test=!0;if(a)return null;rz(b).then(function(a){!0===a?(b.b.oImportSteps.business_object=!0,sz(b).then(function(a){!0===a?(b.b.oImportSteps.business_object_reports=!0,
tz(b).then(function(a){!0===a?(b.b.oImportSteps.business_object_events=!0,uz(b).then(function(a){!0===a?(b.b.oImportSteps.layers=!0,vz(b).then(function(a){!0===a?(b.b.oImportSteps.sql=!0,b.b.bImportOk=!0):(b.Bj(),b.b.oImportSteps.sql=!1)})):(b.Bj(),b.b.oImportSteps.layers=!1)})):(b.Bj(),b.b.oImportSteps.business_object_events=!1)})):(b.Bj(),b.b.oImportSteps.business_object_reports=!1)})):(b.Bj(),b.b.oImportSteps.business_object=!1)})}else b.b.oImportSteps.test=!1})};bz.prototype.executeImport=bz.prototype.MD;
bz.prototype.Bj=function(){function a(){c--;0<=c&&wz(b,b.Zk[c].sRessource,b.Zk[c].sId).then(function(){a()})}this.da.info("nsVmap.importBoCtrl.cancelImport");var b=this,c=this.Zk.length;a()};bz.prototype.cancelImport=bz.prototype.Bj;bz.prototype.TC=function(){this.da.info("nsVmap.importBoCtrl.closeImportModal");$(".bootbox.modal").each(function(){$(this).modal("hide")});this.op.setMode("development")};bz.prototype.closeImportModal=bz.prototype.TC;
function cz(a){for(var b=[],c=0;c<a.b.steps.length;c++)b.push("CTRL_IMPORT_BO_STEP_"+a.b.steps[c]);b.push("CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END");b.push("CTRL_IMPORT_BO_ERROR_SELECT_FOLDER");b.push("CTRL_IMPORT_BO_ERROR_NO_FOLDER_RESULT");b.push("CTRL_IMPORT_BO_ERROR_NO_DB_CONNECTION");b.push("CTRL_IMPORT_BO_ERROR_ANY_SELECTED_STEP_SELECTED");b.push("CTRL_IMPORT_BO_ERROR_NO_DB_VALID");b.push("CTRL_IMPORT_BO_ERROR_NO_SCHEMA_VALID");b.push("CTRL_IMPORT_BO_ERROR_NO_COORDSYS_VALID");b.push("CTRL_IMPORT_BO_ERROR_NO_VALID_LAYER_1");
b.push("CTRL_IMPORT_BO_ERROR_NO_VALID_LAYER_2");b.push("CTRL_IMPORT_BO_ERROR_NO_COMPLETE_OBJECT");b.push("CTRL_IMPORT_BO_ERROR_OBJECT_ALREADY_EXISTS");b.push("CTRL_IMPORT_BO_ERROR_NO_DEFINED_SCHEMA");b.push("CTRL_IMPORT_BO_ERROR_NO_TABLES_TO_IMPORT");b.push("CTRL_IMPORT_BO_ERROR_TABLE_ALREADY_PRESENT");b.push("CTRL_IMPORT_BO_ERROR_NO_DEFINED_SCHEMA");b.push("CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1");b.push("CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_IMPORT");b.push("CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_ASSOCIATE_LAYER");
b.push("CTRL_IMPORT_BO_ERROR_REMOVE_ERROR");a.Tq(b).then(function(b){a.oTranslations=b})}
function dz(a){a.da.info("nsVmap.importBoCtrl.importFolder_");var b=$("#import-bo-folder-input").prop("files");if(null==b[0])$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_SELECT_FOLDER,"error");else{var c=new FormData;c.append("package_definition",b[0]);z({method:"POST",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vmap/businessobjects/package_definition",headers:{Accept:"application/x-vm-json"},data:c,scope:a.b,success:function(b){if(null==b.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,
"error"),null;if(null!=b.data&&null!=b.data.errorMessage)return angular.element(u.f).scope().modalWindow("dialog","Erreur serveur",{className:"modal-danger",message:b.data.errorMessage}),null;if(null==b.data.businessobjects||null==b.data.businessobjects[0])return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_FOLDER_RESULT,"error"),null;if(1!==b.data.status)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error"),null;a.b.oImportedBo=b.data.businessobjects[0];a.Nf()},
error:function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error")}})}}
function jz(a){a.da.info("nsVmap.importBoCtrl.submitBo_");var b=angular.element(u.f).injector().get(["formSrvc"]),c=angular.element($("#import_bo_def_formreader").children()).scope(),c=b.getFormData(c.sFormDefinitionName,!0,{oFormDefinition:c.oFormDefinition,oFormValues:c.oFormValues});a.b.oBoDef=c;null!=a.b.oEventDef&&(c=angular.element($("#import_bo_event_formreader").children()).scope(),c=b.getFormData(c.sFormDefinitionName,!0,{oFormDefinition:c.oFormDefinition,oFormValues:c.oFormValues}),a.b.oEventDef=
c);if(null!=a.b.aReportsDef){for(var c=[],d=0;d<a.b.aReportsDef.length;d++)c[d]=angular.element($("#import_bo_reports_"+a.b.aReportsDef[d].printreport_id+"_formreader").children()).scope();for(var e=[],d=0;d<c.length;d++)e[d]=b.getFormData(c[d].sFormDefinitionName,!0,{oFormDefinition:c[d].oFormDefinition,oFormValues:c[d].oFormValues,aParamsToSave:["printreport_id"]});a.b.aReportsDef=e}null!=a.b.oImportedBo&&null!=a.b.oImportedBo.json&&(a.b.oImportedBo.json.business_object=a.b.oBoDef,null!=a.b.oEventDef&&
(a.b.oImportedBo.json.event=a.b.oEventDef),null!=a.b.aReportsDef&&(a.b.oImportedBo.json.reports=a.b.aReportsDef))}
function xz(a,b){a.da.info("nsVmap.importBoCtrl.getJsonForm_");var c=a.Ja.defer();if(!r(b))return console.error("importBoCtrl.getJsonForm missing parameter sForm"),null;if("vmap_business_object"===b)var d=a.oProperties.web_server_name+"/"+sessionStorage.appEnv+"/modules/vmap/forms/vmap_business_object/vmap_business_object_vmap_business_object.json";"vmap_printreport"===b&&(d=a.oProperties.web_server_name+"/"+sessionStorage.appEnv+"/modules/vmap/forms/vmap_business_object/vmap_business_object_vmap_business_object_printreport.json");
"vmap_event"===b&&(d=a.oProperties.web_server_name+"/"+sessionStorage.appEnv+"/modules/vmap/forms/vmap_business_object/vmap_business_object_vmap_business_object_event.json");z({method:"GET",url:d,headers:{Accept:"application/x-vm-json"},params:{vitis_version:a.oProperties.build},scope:a.b,success:function(d){if(null==d.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error"),null;c.resolve(yz(a,d.data,b))},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,
"error")}});return c.promise}
function yz(a,b,c){a.da.info("nsVmap.prepareForm_");var d={vmap_business_object:["database","schema","table","id_field","event_id"],vmap_printreport:["business_object_id"],vmap_event:[]},e;for(e in b)if(q(b[e].rows)){a=b[e].rows[b[e].rows.length-1];if(q(a.fields))for(var f=a.fields.length-1;0<=f;f--)"button"===a.fields[f].type&&a.fields.splice(f,1);delete f;if(null!=d[c])for(f=0;f<b[e].rows.length;f++)if(q(b[e].rows[f].fields))for(var g=0;g<b[e].rows[f].fields.length;g++)-1!==d[c].indexOf(b[e].rows[f].fields[g].name)&&
(b[e].rows[f].fields[g].disabled=!0),-1!==d[c].indexOf(b[e].rows[f].fields[g].name)&&(b[e].rows[f].fields[g].type="text");delete f;delete g}return b}
function mz(a){a.da.info("nsVmap.importBoCtrl.loadDatabases_");var b=a.Ja.defer(),c=["postgres"];null!=a.b.usedDatabase?setTimeout(function(){b.resolve()}):(Na(a.b.aDatabases),z({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vitis/genericquerys/databases",headers:{Accept:"application/x-vm-json"},scope:a.b,success:function(d){if(null==d.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error"),null;if(null==d.data.data)return console.error("Aucun r\u00e9sultat: databases",
d),null;for(var e=0;e<d.data.data.length;e++)null!=d.data.data[e].database&&-1===c.indexOf(d.data.data[e].database)&&a.b.aDatabases.push(d.data.data[e].database);a.b.usedDatabase=a.oProperties.database;b.resolve()},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error")}}));return b.promise}
function nz(a){a.da.info("nsVmap.importBoCtrl.loadSchemas_");var b=a.Ja.defer(),c=["pg_catalog","information_schema"];Na(a.b.aSchemas);z({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vitis/genericquerys/"+a.b.usedDatabase+"/schemas",headers:{Accept:"application/x-vm-json"},scope:a.b,success:function(d){if(null==d.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error"),null;if(null==d.data.data)return console.error("Aucun r\u00e9sultat: schemas",
d),null;for(var e=0;e<d.data.data.length;e++)null!=d.data.data[e].schema_name&&-1===c.indexOf(d.data.data[e].schema_name)&&a.b.aSchemas.push(d.data.data[e].schema_name);setTimeout(function(){null!=a.b.usedSchema&&(-1!==a.b.aSchemas.indexOf(a.b.usedSchema)?(a.b.selectedExistingSchema=a.b.usedSchema,a.b.creatingNewSchema=""):(a.b.creatingNewSchema=a.b.usedSchema,a.b.selectedExistingSchema=""))});b.resolve()},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error")}});
return b.promise}
function oz(a){a.da.info("nsVmap.importBoCtrl.loadCoordsys_");var b=a.Ja.defer();null!=a.b.oCoordsys?setTimeout(function(){b.resolve()}):(Na(a.b.aCoordsys),z({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vm4ms/coordinatesystems",headers:{Accept:"application/x-vm-json"},params:{order_by:"coordsys_id"},scope:a.b,success:function(c){if(null==c.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error"),null;if(null==c.data.data)return console.error("Aucun r\u00e9sultat: coordinatesystems",c),
null;a.b.aCoordsys=c.data.data;if(null!=a.b.oImportedBo.sql&&null!=a.b.oImportedBo.sql.structure&&null!=a.b.oImportedBo.sql.structure.srid){c=a.b.oImportedBo.sql.structure.srid;for(var d=0;d<a.b.aCoordsys.length;d++)parseFloat(a.b.aCoordsys[d].coordsys_id)===parseFloat(c)&&(a.b.oCoordsys=a.b.aCoordsys[d])}b.resolve()},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error")}}));return b.promise}
function pz(a){a.da.info("nsVmap.importBoCtrl.loadLayers_");var b=a.Ja.defer();a.b.codemirrorLayerDefOptions={styleActiveLine:!0,indentWithTabs:!0,lineWrapping:!0,lineNumbers:!0,readOnly:!1,mode:"map",tabSize:2,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]};if(!(null!=a.b.aLayersDef&&0<a.b.aLayersDef.length)&&null!=a.b.oImportedBo&&null!=a.b.oImportedBo.json&&null!=a.b.oImportedBo.json.mapserver_layers)for(var c=a.b.oImportedBo.json.mapserver_layers,d=0;d<c.length;d++)a.b.aLayersDef.push({title:c[d].title,
name:c[d].name,ms_layertype_id:c[d].ms_layertype_id,tablename:c[d].tablename,tableidfield:c[d].tableidfield,definition:c[d].definition,database:"[DATABASE]",tableschema:"[TABLE_SCHEMA]",coordsys_id:a.b.oCoordsys.coordsys_id,connection_id:"",wmsservice_id:"",private_connection:!1,active:!1});null!=a.b.aConnections?setTimeout(function(){b.resolve()}):z({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vm4ms/layerconnections",headers:{Accept:"application/x-vm-json"},
params:{order_by:"name",filter:'{"relation": "OR","operators": [{"column":"database","compare_operator":"=","value":"'+a.b.usedDatabase+'"}, {"column":"database","compare_operator":"IS NULL","value":""}]}'},scope:a.b,success:function(c){if(null==c.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error"),null;0===c.data.list_count&&($.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_DB_CONNECTION,"warning"),c.data.data=[]);if(null==c.data.data)return console.error("Aucun r\u00e9sultat: layerconnections",
c),null;a.b.aConnections=c.data.data;null!=a.b.aVmapServices&&b.resolve()},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error");return null}});null!=a.b.aVmapServices?setTimeout(function(){b.resolve()}):z({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vmap/services",headers:{Accept:"application/x-vm-json"},scope:a.b,success:function(c){if(null==c.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,
"error"),null;if(null==c.data.data)return console.error("Aucun r\u00e9sultat: services",c),null;a.b.aVmapServices=c.data.data;null!=a.b.aConnections&&b.resolve()},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error");return null}});a.b.refreshCodeMirror();return b.promise}
function lz(a){a.da.info("nsVmap.importBoCtrl.loadBo_");if(null!=a.b.oImportedBo&&null!=a.b.oImportedBo.json){a.b.oBoDef=a.b.oImportedBo.json.business_object;a.b.oEventDef=a.b.oImportedBo.json.event;a.b.aReportsDef=a.b.oImportedBo.json.reports;a.b.oBoDef.database="[DATABASE]";a.b.oBoDef.schema="[TABLE_SCHEMA]";a.b.oBoDef.event_id="[EVENT]";var b=angular.element($("#import_bo_def_formreader").children()).scope();null!=a.b.oBoForm?zz(a,{oFormReader:b,oFormValues:{insert:angular.copy(a.b.oBoDef)}}):
xz(a,"vmap_business_object").then(function(c){a.b.oBoForm=c;Az(a,{oFormReader:b,sFormDefinitionName:"insert",oFormDefinition:a.b.oBoForm,oFormValues:{insert:angular.copy(a.b.oBoDef)}})});if(null!=a.b.oEventDef){var c=angular.element($("#import_bo_event_formreader").children()).scope();null!=a.b.oEventForm?zz(a,{oFormReader:c,oFormValues:{insert:angular.copy(a.b.oEventDef)}}):xz(a,"vmap_event").then(function(b){a.b.oEventForm=b;Az(a,{oFormReader:c,sFormDefinitionName:"insert",oFormDefinition:a.b.oEventForm,
oFormValues:{insert:angular.copy(a.b.oEventDef)}})})}if(null!=a.b.aReportsDef){for(var d=0;d<a.b.aReportsDef.length;d++)a.b.aReportsDef[d].business_object_id="[BUSINESS_OBJECT]";if(null!=a.b.oReportForm)for(var e=[],d=0;d<a.b.aReportsDef.length;d++)e[d]=angular.element($("#import_bo_reports_"+a.b.aReportsDef[d].printreport_id+"_formreader").children()).scope(),Az(a,{oFormReader:e[d],sFormDefinitionName:"insert",oFormDefinition:a.b.oReportForm,oFormValues:{insert:angular.copy(a.b.aReportsDef[d])}});
else xz(a,"vmap_printreport").then(function(b){a.b.oReportForm=b;b=[];for(var c=0;c<a.b.aReportsDef.length;c++)b[c]=angular.element($("#import_bo_reports_"+a.b.aReportsDef[c].printreport_id+"_formreader").children()).scope(),Az(a,{oFormReader:b[c],sFormDefinitionName:"insert",oFormDefinition:a.b.oReportForm,oFormValues:{insert:angular.copy(a.b.aReportsDef[c])}})})}}}
function Az(a,b){a.da.info("nsVmap.importBoCtrl.loadBoForm_");a=b.oFormReader;var c=b.sFormDefinitionName,d=b.oFormDefinition;b=b.oFormValues;null==a?console.error("cannot execute importBoCtrl.loadBoForm_: missing parameter oFormReader"):null==c?console.error("cannot execute importBoCtrl.loadBoForm_: missing parameter sFormDefinitionName"):null==d?console.error("cannot execute importBoCtrl.loadBoForm_: missing parameter oFormDefinition"):(a.ctrl.setDefinitionName(c),null!=b&&a.ctrl.setFormValues(b),
a.ctrl.setFormDefinition(d),a.ctrl.loadForm())}function zz(a,b){a.da.info("nsVmap.importBoCtrl.loadBoFormValues_");a=b.oFormReader;b=b.oFormValues;null==a?console.error("cannot execute importBoCtrl.loadBoFormValues_: missing parameter oFormReader"):null==b?console.error("cannot execute importBoCtrl.loadBoFormValues_: missing parameter oFormValues"):(a.ctrl.setFormValues(b),a.ctrl.loadForm())}
function ez(a){a.da.info("nsVmap.importBoCtrl.validateSelectedSteps_");var b=a.Ja.defer(),c=!1;setTimeout(function(){if(!1!==a.b.selectedSteps.import_sql||!1!==a.b.selectedSteps.import_layers||!1!==a.b.selectedSteps.import_bo)c=!0;c?b.resolve(!0):$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_ANY_SELECTED_STEP_SELECTED,"error")});return b.promise}
function fz(a){a.da.info("nsVmap.importBoCtrl.validateDatabase_");var b=a.Ja.defer(),c=!1;setTimeout(function(){null!=a.b.usedDatabase&&r(a.b.usedDatabase)&&0<a.b.usedDatabase.length&&(c=!0);c?b.resolve(!0):$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_DB_VALID,"error")});return b.promise}
function gz(a){a.da.info("nsVmap.importBoCtrl.validateSchema_");var b=a.Ja.defer(),c=!1,d=angular.element(u.f).injector().get(["$translate"]),e=["s_vmap","s_vitis","s_vm4ms","s_majic","s_cadastre"];setTimeout(function(){null!=a.b.usedSchema&&r(a.b.usedSchema)&&0<a.b.usedSchema.length&&a.OI.test(a.b.usedSchema)&&(c=!0);c?-1!==e.indexOf(a.b.usedSchema)?d(["CREATE_BO_ON_UNRECOMMENDED_SCHEMA1","CREATE_BO_ON_UNRECOMMENDED_SCHEMA2","CREATE_BO_ON_UNRECOMMENDED_SCHEMA3"]).then(function(c){c={className:"modal-warning",
message:"<b>"+c.CREATE_BO_ON_UNRECOMMENDED_SCHEMA1+a.b.usedSchema+c.CREATE_BO_ON_UNRECOMMENDED_SCHEMA2+"<br>"+c.CREATE_BO_ON_UNRECOMMENDED_SCHEMA3+"</b>",callback:function(a){a?b.resolve(!0):b.reject()}};angular.element(u.f).scope().modalWindow("confirm","",c)}):b.resolve(!0):$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_SCHEMA_VALID,"error")});return b.promise}
function hz(a){a.da.info("nsVmap.importBoCtrl.validateCoordsys_");var b=a.Ja.defer(),c=!1;setTimeout(function(){null!=a.b.oCoordsys&&ea(a.b.oCoordsys.coordsys_id)&&0<a.b.oCoordsys.coordsys_id&&(c=!0);c?b.resolve(!0):$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_COORDSYS_VALID,"error")});return b.promise}
function iz(a){a.da.info("nsVmap.importBoCtrl.validateLayers_");var b=a.Ja.defer(),c=!0,d=a.b.aLayersDef,e="name title coordsys_id wmsservice_id connection_id active ms_layertype_id tableidfield tableschema tablename".split(" ");setTimeout(function(){for(var f=0;f<d.length;f++)Bz(a,d[f],e)||(console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_VALID_LAYER_1+d[f].title+a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_VALID_LAYER_2),a.op.modalWindow("dialog","Error",{className:"modal-danger",message:a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_VALID_LAYER_1+
d[f].title+a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_VALID_LAYER_2}),c=!1);c&&Cz(a).then(function(a){!0===a&&b.resolve(!0)})});return b.promise}function kz(a){a.da.info("nsVmap.importBoCtrl.validateBo_");var b=a.Ja.defer();Dz(a).then(function(c){!0===c?Ez(a).then(function(c){!0===c?Fz(a).then(function(a){!0===a?b.resolve(!0):b.resolve(!1)}):b.resolve(!1)}):b.resolve(!1)});return b.promise}
function qz(a){a.da.info("nsVmap.importBoCtrl.testImport_");var b=a.Ja.defer();a.b.oTestSteps={business_objet:null,reports:null,event:null,layers:null,schema:null,tables:null};Dz(a).then(function(c){!0===c?(a.b.oTestSteps.business_objet=!0,Ez(a).then(function(c){!0===c?(a.b.oTestSteps.reports=!0,Fz(a).then(function(c){!0===c?(a.b.oTestSteps.event=!0,Cz(a).then(function(c){!0===c?(a.b.oTestSteps.layers=!0,Gz(a).then(function(c){!0===c?(a.b.oTestSteps.schema=!0,Hz(a).then(function(c){!0===c?(a.b.oTestSteps.tables=
!0,b.resolve(!0)):(a.b.oTestSteps.tables=!1,b.resolve(!1))})):(a.b.oTestSteps.schema=!1,b.resolve(!1))})):(a.b.oTestSteps.layers=!1,b.resolve(!1))})):(a.b.oTestSteps.event=!1,b.resolve(!1))})):(a.b.oTestSteps.reports=!1,b.resolve(!1))})):(a.b.oTestSteps.business_objet=!1,b.resolve(!1))});return b.promise}
function Bz(a,b,c){a.da.info("nsVmap.importBoCtrl.checkObjectKeys_");for(a=0;a<c.length;a++)if(null==b[c[a]]||(r(b[c[a]])||q(b[c[a]]))&&0< !b[c[a]].length)return console.error("checkObjectKeys_: missing "+c[a]+" in object",b),!1;return!0}
function Iz(a,b,c,d,e){a.da.info("nsVmap.importBoCtrl.testRessource_");var f=a.Ja.defer();if(!Bz(a,b,e))return setTimeout(function(){console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_COMPLETE_OBJECT,null!=b[c]?b[c]:d);a.op.modalWindow("dialog","Error",{className:"modal-danger",message:a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_COMPLETE_OBJECT+b});f.resolve(!1)}),f.promise;z({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/"+d,headers:{Accept:"application/x-vm-json"},
params:{filter:'{"column":"'+c+'","compare_operator":"=","value":"'+b[c]+'"}'},scope:a.b,success:function(d){if(null==d.data||null==d.data.list_count)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error"),console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,b[c]),f.resolve(!1),null;0<d.data.list_count?(console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_OBJECT_ALREADY_EXISTS,b[c]),a.op.modalWindow("dialog","Error",{className:"modal-danger",message:a.oTranslations.CTRL_IMPORT_BO_ERROR_OBJECT_ALREADY_EXISTS+
b[c]}),f.resolve(!1)):f.resolve(!0)},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error")}});return f.promise}function Dz(a){a.da.info("nsVmap.importBoCtrl.testBo_");var b=a.Ja.defer(),c=a.b.oBoDef,d="business_object_id title database schema table id_field sql_summary sql_list geom_column index".split(" ");!1===a.b.selectedSteps.import_bo?b.resolve(!0):Iz(a,c,"business_object_id","vmap/businessobjects",d).then(function(a){b.resolve(a)});return b.promise}
function Ez(a){a.da.info("nsVmap.importBoCtrl.testReports_");var b=a.Ja.defer(),c=a.b.aReportsDef,d="name rt_format_id rt_orientation_id outputformats_id business_object_id htmldefinition".split(" "),e=0;if(!1===a.b.selectedSteps.import_bo)b.resolve(!0);else if(null!=a.b.aReportsDef)for(var f=0;f<c.length;f++)Iz(a,c[f],"name","vmap/printreports",d).then(function(a){e++;!1===a?b.resolve(!1):e===c.length&&b.resolve(!0)});else setTimeout(function(){b.resolve(!0)});return b.promise}
function Fz(a){a.da.info("nsVmap.importBoCtrl.Event_");var b=a.Ja.defer(),c=a.b.oEventDef,d=["event_id"];!1===a.b.selectedSteps.import_bo?b.resolve(!0):null!=a.b.oEventDef?Iz(a,c,"event_id","vmap/businessobjectevents",d).then(function(a){b.resolve(a)}):setTimeout(function(){b.resolve(!0)});return b.promise}
function Cz(a){a.da.info("nsVmap.importBoCtrl.testLayers_");var b=a.Ja.defer(),c=a.b.aLayersDef,d="name title coordsys_id connection_id active ms_layertype_id tableidfield tableschema tablename".split(" "),e=0;if(!1===a.b.selectedSteps.import_layers)b.resolve(!0);else for(var f=0;f<c.length;f++)(function(f){Iz(a,c[f],"name","vm4ms/layers",d).then(function(d){var g={service_id:"vm4ms_"+c[f].wmsservice_id,name:c[f].title,layer_list:c[f].name,bo_id_list:"[BUSINESS_OBJECT]",is_dynamic:!0,is_filtered:!1};
!1===d?b.resolve(!1):Iz(a,g,"name","vmap/layers",[]).then(function(a){e++;!1===a?b.resolve(!1):e===c.length&&b.resolve(!0)})})})(f);return b.promise}function Gz(a){a.da.info("nsVmap.importBoCtrl.testSchema_");var b=a.Ja.defer();setTimeout(function(){!1===a.b.selectedSteps.import_sql?b.resolve(!0):null!=a.b.usedSchema?b.resolve(!0):($.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_DEFINED_SCHEMA,"error"),b.resolve(!1))});return b.promise}
function Hz(a){a.da.info("nsVmap.importBoCtrl.testTables_");var b=a.Ja.defer();setTimeout(function(){!1===a.b.selectedSteps.import_sql?b.resolve(!0):null!=a.b.usedSchema?-1===a.b.aSchemas.indexOf(a.b.usedSchema)?b.resolve(!0):z({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vitis/genericquerys",headers:{Accept:"application/x-vm-json"},params:{attributs:"tablename",schema:"pg_catalog",table:"pg_tables",distinct:"true",sort_order:"ASC",filter:'{"column":"schemaname","compare_operator":"=","value":"'+
a.b.usedSchema+'"}'},scope:this.b,success:function(c){if(null==c.data||null==c.data.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error"),b.resolve(!1),null;for(var d=[],e=0;e<c.data.data.length;e++)null!=c.data.data[e].tablename&&d.push(c.data.data[e].tablename);c=a.b.oImportedBo.sql.structure.tables;if(null==c)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_TABLES_TO_IMPORT,"error"),console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_TABLES_TO_IMPORT),
b.resolve(!1),null;for(e=0;e<c.length;e++)if(-1!==d.indexOf(c[e]))return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_TABLE_ALREADY_PRESENT+": "+c[e],"error"),b.resolve(!1),null;b.resolve(!0)},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error")}}):($.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_DEFINED_SCHEMA,"error"),b.resolve(!1))});return b.promise}
function Jz(a,b,c,d,e,f){a.da.info("nsVmap.importBoCtrl.importObject_");e=null!=e?e:[];var g=a.Ja.defer();b=angular.copy(b);for(var h in b)r(b[h])&&(null!=a.b.usedSchema&&(b[h]=b[h].replace(/\[TABLE_SCHEMA\]/g,a.b.usedSchema)),null!=a.b.usedDatabase&&(b[h]=b[h].replace(/\[DATABASE\]/g,a.b.usedDatabase)),null!=a.b.oCoordsys&&null!=a.b.oCoordsys.coordsys_id&&(b[h]=b[h].replace(/\[SRID\]/g,a.b.oCoordsys.coordsys_id)),null!=a.b.oBoDef&&null!=a.b.oBoDef.business_object_id&&(b[h]=b[h].replace(/\[BUSINESS_OBJECT\]/g,
a.b.oBoDef.business_object_id)),null!=a.b.oEventDef&&(b[h]=b[h].replace(/\[EVENT\]/g,a.b.oEventDef.event_id)));if(null!=f)for(h in f)r(f[h])&&(null!=a.b.usedSchema&&(f[h]=f[h].replace(/\[TABLE_SCHEMA\]/g,a.b.usedSchema)),null!=a.b.usedDatabase&&(f[h]=f[h].replace(/\[DATABASE\]/g,a.b.usedDatabase)),null!=a.b.oCoordsys&&null!=a.b.oCoordsys.coordsys_id&&(f[h]=f[h].replace(/\[SRID\]/g,a.b.oCoordsys.coordsys_id)),null!=a.b.oBoDef&&null!=a.b.oBoDef.business_object_id&&(f[h]=f[h].replace(/\[BUSINESS_OBJECT\]/g,
a.b.oBoDef.business_object_id)),null!=a.b.oEventDef&&(f[h]=f[h].replace(/\[EVENT\]/g,a.b.oEventDef.event_id)));for(var k=0;k<e.length;k++)null!=b[e[k]]&&delete b[e[k]];e=new FormData;for(h in b)e.append(h,b[h]);if(null!=f)for(h in f)e.append(h,new Blob([f[h]],{type:"text"}));z({method:"POST",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/"+c,headers:{Accept:"application/x-vm-json"},data:e,scope:a.b,success:function(b){if(null==b.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+
a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_IMPORT+c,"error"),console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_IMPORT+c),g.resolve({status:!1}),null;if(null!=b.data&&null!=b.data.errorMessage)return angular.element(u.f).scope().modalWindow("dialog","Erreur serveur",{className:"modal-danger",message:b.data.errorMessage}),g.resolve({status:!1}),null;1===b.data.status?(null!=d&&a.Zk.push({sId:b.data[d],
sRessource:c}),g.resolve({status:!0,objectId:null!=d?b.data[d]:null})):g.resolve({status:!1})},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_IMPORT+c,"error");console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_IMPORT+c);g.resolve({status:!1})}});return g.promise}
function Kz(a,b,c,d){a.da.info("nsVmap.importBoCtrl.putForm_");var e=a.Ja.defer(),f=new FormData,g;for(g in b)f.append(g,b[g]);z({method:"PUT",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/"+c+"/"+d,headers:{Accept:"application/x-vm-json"},params:{cmd:"Save"},data:f,scope:a.b,success:function(b){if(null==b.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_IMPORT+c,"error"),console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+
a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_IMPORT+c),e.resolve(!1),null;e.resolve(!0)},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_IMPORT+c,"error");console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_IMPORT+c)}});return e.promise}
function wz(a,b,c){a.da.info("nsVmap.importBoCtrl.deleteObject_");var d=a.Ja.defer();z({method:"DELETE",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/"+b+"/"+c,headers:{Accept:"application/x-vm-json"},scope:a.b,abord:d.promise,success:function(c){if(null==c.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REMOVE_ERROR+b,"error"),console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REMOVE_ERROR+b),null;1===c.data.status&&a.da.info("deleteObject_ ("+b+") ok");d.resolve()},
error:function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REMOVE_ERROR+b,"error");console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REMOVE_ERROR+b)}});setTimeout(function(){d.resolve()},5E3);return d.promise}
function rz(a){a.da.info("nsVmap.importBoCtrl.importBo_");var b=a.Ja.defer();setTimeout(function(){!1===a.b.selectedSteps.import_bo?b.resolve(!0):Jz(a,a.b.oBoDef,"vmap/businessobjects","business_object_id",["$$hashKey"]).then(function(c){if(!0===c.status){for(var d=["default","custom","published"],e,f=0,g=0,h=0;h<d.length;h++)null!=a.b.oImportedBo.forms[d[h]]&&(f++,e={Json:JSON.stringify(a.b.oImportedBo.forms[d[h]])},null!=a.b.oImportedBo.forms.ressources&&null!=a.b.oImportedBo.forms.ressources.js&&
null!=a.b.oImportedBo.forms.ressources.js[d[h]]&&(e.Js=a.b.oImportedBo.forms.ressources.js[d[h]]),null!=a.b.oImportedBo.forms.ressources&&null!=a.b.oImportedBo.forms.ressources.css&&null!=a.b.oImportedBo.forms.ressources.css[d[h]]&&(e.Css=a.b.oImportedBo.forms.ressources.css[d[h]]),Kz(a,angular.copy(e),"vmap/businessobjects/"+c.objectId+"/forms",d[h]).then(function(a){!0===a&&(g++,g===f&&b.resolve(!0))}));0===f&&b.resolve(!0)}else b.resolve(!1)})});return b.promise}
function sz(a){a.da.info("nsVmap.importBoCtrl.importReports_");var b=a.Ja.defer(),c=a.b.aReportsDef,d=0;setTimeout(function(){if(!1===a.b.selectedSteps.import_bo)b.resolve(!0);else if(null!=a.b.aReportsDef)for(var e=0;e<c.length;e++)Jz(a,c[e],"vmap/printreports","printreport_id",["printreport_id","$$hashKey"]).then(function(a){!0===a.status?(d++,d===c.length&&b.resolve(!0)):b.resolve(!0)});else b.resolve(!0)});return b.promise}
function tz(a){a.da.info("nsVmap.importBoCtrl.importEvent_");var b=a.Ja.defer();setTimeout(function(){!1===a.b.selectedSteps.import_bo?b.resolve(!0):null!=a.b.oEventDef?Jz(a,a.b.oEventDef,"vmap/businessobjectevents","event_id",["$$hashKey"]).then(function(a){b.resolve(a.status)}):b.resolve(!0)});return b.promise}
function uz(a){a.da.info("nsVmap.importBoCtrl.importLayers_");var b=a.Ja.defer(),c=a.b.aLayersDef,d=0;setTimeout(function(){if(!1===a.b.selectedSteps.import_layers)b.resolve(!0);else for(var e=0;e<c.length;e++)(function(e){Jz(a,c[e],"vm4ms/layers","ms_layer_id",["$$hashKey","ms_layer_id"]).then(function(f){if(!0===f.status){for(var g=0;g<a.b.aVmapServices.length;g++)if(a.b.aVmapServices[g].name==="vm4ms_"+c[e].wmsservice_id)var k=a.b.aVmapServices[g].service_id;c[e].ms_layer_id=f.objectId;Lz(a,c[e]).then(function(f){!0===
f.status?null!=k?Jz(a,{service_id:k,name:c[e].name,layer_list:c[e].name,bo_id_list:"[BUSINESS_OBJECT]",is_dynamic:!0,is_filtered:!1},"vmap/layers","layer_id",["$$hashKey","layer_id"]).then(function(a){!0===a.status?(d++,d===c.length&&b.resolve(!0)):b.resolve(!1)}):b.resolve(!1):b.resolve(!1)})}else b.resolve(!1)})})(e)});return b.promise}
function Lz(a,b){a.da.info("nsVmap.importBoCtrl.associateLayers_");var c=a.Ja.defer();z({method:"PUT",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vm4ms/layerwmsservices/"+b.ms_layer_id,headers:{Accept:"application/x-vm-json"},data:{wmsservices:b.wmsservice_id},scope:a.b,success:function(d){if(null==d.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_ASSOCIATE_LAYER+b.name,"error"),
console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_ASSOCIATE_LAYER+b.name),c.resolve({status:!1}),null;1===d.data.status?c.resolve({status:!0}):c.resolve({status:!1})},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_ASSOCIATE_LAYER+b.name,"error");console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+
a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_ASSOCIATE_LAYER+b.name);c.resolve({status:!1})}});return c.promise}function vz(a){a.da.info("nsVmap.importBoCtrl.importSql_");var b=a.Ja.defer();setTimeout(function(){!1===a.b.selectedSteps.import_sql?b.resolve(!0):Jz(a,{database:a.b.usedDatabase},"vmap/businessobjects/data_model",null,[],{data_model:a.b.sSql}).then(function(a){b.resolve(a.status)})});return b.promise}
bz.prototype.rJ=function(a){this.da.info("nsVmap.importBoCtrl.setWmsServices");var b=this,c=!1,d;for(d in this.b.aConnections)if(this.b.aConnections[d].connection_id==a){!0===this.b.aConnections[d]["private"]&&(c=!0);break}a="publicwmsservices";c&&(a="privatewmsservices");z({method:"GET",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/vm4ms/"+a,headers:{Accept:"application/x-vm-json"},params:{order_by:"wmsservice_id"},scope:this.b,success:function(a){if(null==a.data)return $.notify(b.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,
"error"),null;if(null==a.data.data)return console.error("Aucun r\u00e9sultat: wmsservices",a),null;b.b.aWmsServices=a.data.data},error:function(){$.notify(b.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error")}})};bz.prototype.setWmsServices=bz.prototype.rJ;A.module.controller("AppImportBoController",bz);u.on("appMainDrtvLoaded",function(){var a=angular.element(u.f).injector().get(["$q"]),b=angular.element(u.f).injector().get(["$log"]),c=angular.element(u.f).injector().get(["$timeout"]),d=angular.element(u.f).injector().get(["$translate"]),e=angular.element(u.f).injector().get(["envSrvc"]),f=angular.element(u.f).injector().get(["formSrvc"]),g=angular.element(u.f).injector().get(["modesSrvc"]),h=angular.element(u.f).injector().get(["sessionSrvc"]),k=angular.element(u.f).injector().get(["propertiesSrvc"]),
m=new FormData;m.append("wmsservice_id",k.private_wms_service);m.append("type","prod");z({method:"POST",url:k.web_server_name+"/"+k.services_alias+"/vm4ms/WmsServices/MapFile",data:m});angular.element(u.Pb).scope().$on("updateStudio_vmap_business_object_vmap_business_object",function(a,b){1===b.index&&"modules/vmap/template/studio.html"===b.oSectionForm.template&&(X.reset(),X.setId(e.sId),X.setApplication("vmap"),X.setToken(h.token),X.setContainer("#container_section_"+e.oSelectedObject.name+"_studio"),
X.setAppProperties(k))},!0);angular.element(u.f).scope().loadVmap=function(){b.info("loadVmap");e.oSelectedMode.fullScreen=!0;g.setModeReload("vmap",!1);u.jo().resizeWin();angular.element(u.f).scope().setFullScreen();g.getMode("vmap").ajaxLoader=!1;"vmap"==g.modes[0].mode_id&&(sessionStorage.ajaxLoader=!1);A.lh()};u.Hv=function(a){return{link:function(b,c,d){var e=d.$observe("appMapDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className=
"ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};u.Hv.$inject=["$translate"];u.compileProvider.directive("appMapDescriptionColumn",u.Hv);u.Jv=
function(){return{replace:!0,template:'<span class="glyphicon glyphicon-picture grid-column-glyph-icon"></span>',link:function(a,b,c){var d=c.$observe("appMapThumbnailColumn",function(){null==a.row.entity[a.col.field]||""==a.row.entity[a.col.field]?b[0].className="":(b[0].className="glyphicon glyphicon-picture grid-column-glyph-icon",b[0].parentNode.style.textAlign="center",$(b).popover({trigger:"hover",container:"body",title:"",content:function(){var c=document.createElement("img");c.onerror=function(){$(b).popover("destroy")};
c.src=a.row.entity[a.col.field];c.className="popover-thumbnail-img";return c.outerHTML},html:!0,placement:function(b,c){return a.$root.workspaceTooltipPlacement(c)},template:'<div class="popover popover-thumbnail" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}))});a.$on("$destroy",function(){$(b).popover("destroy");d()})}}};u.Jv.$inject=["propertiesSrvc"];u.compileProvider.directive("appMapThumbnailColumn",u.Jv);u.qC=function(){return{replace:!0,
template:'<a href="" target="_blank" class="glyphicon glyphicon-link grid-column-glyph-icon"></a>',link:function(a,b,c){var d=c.$observe("appServiceUrlColumn",function(){null==a.row.entity[a.col.field]||""==a.row.entity[a.col.field]?b[0].className="":(b[0].className="glyphicon glyphicon-link grid-column-glyph-icon",b[0].href=a.row.entity[a.col.field],b[0].alt=b[0].href,b[0].title=b[0].href,b[0].parentNode.style.textAlign="center")});a.$on("$destroy",function(){$(b).popover("destroy");d()})}}};u.compileProvider.directive("appServiceUrlColumn",
u.qC);u.Tv=function(a){return{link:function(b,c,d){var e=d.$observe("appServiceDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_SERVICE"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_SERVICE},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},
html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};u.Tv.$inject=["$translate"];u.compileProvider.directive("appServiceDescriptionColumn",u.Tv);u.Uv=function(){return{replace:!0,template:'<span class="glyphicon glyphicon-picture grid-column-glyph-icon"></span>',link:function(a,b,c){var d=c.$observe("appServiceThumbnailColumn",function(){null==a.row.entity[a.col.field]||""==a.row.entity[a.col.field]?b[0].className="":(b[0].className="glyphicon glyphicon-picture grid-column-glyph-icon",
b[0].parentNode.style.textAlign="center",$(b).popover({trigger:"hover",container:"body",title:"",content:function(){var c=document.createElement("img");c.onerror=function(){$(b).popover("destroy")};c.src=a.row.entity[a.col.field];c.className="popover-thumbnail-img";return c.outerHTML},html:!0,placement:function(b,c){return a.$root.workspaceTooltipPlacement(c)},template:'<div class="popover popover-thumbnail" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}))});
a.$on("$destroy",function(){$(b).popover("destroy");d()})}}};u.Uv.$inject=["propertiesSrvc"];u.compileProvider.directive("appServiceThumbnailColumn",u.Uv);u.zv=function(a){return{link:function(b,c,d){var e=d.$observe("appLayerDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_LAYER"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_LAYER},
content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};u.zv.$inject=["$translate"];u.compileProvider.directive("appLayerDescriptionColumn",u.zv);angular.element(u.f).scope().loadVmapGroup=function(){var a=angular.element(u.X).injector().get(["envSrvc"]);b.info("loadVmapGroup");var c=a.oSelectedObject.name;this.oFormRequestParams={sUrl:"modules/vmap/forms/"+
a.oSelectedMode.mode_id+"/"+c+"_"+a.oSectionForm[c].sections[a.oSectionForm[c].iSelectedSectionIndex].name+".json"}};u.wv=function(a){return{link:function(b,c,d){var e=d.$observe("appCrsListDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["COORDINATE_SYSTEM_TOOLTIP_TITLE_VMAP_MAP_LAYER"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.COORDINATE_SYSTEM_TOOLTIP_TITLE_VMAP_MAP_LAYER},
content:function(){return b.row.entity[b.col.field].replace(/\|/g,"<br>")},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};u.wv.$inject=["$translate"];u.compileProvider.directive("appCrsListDescriptionColumn",u.wv);u.rC=function(){return{template:' <select class="form-control minus" ng-model="oLayerStyle" ng-options="oStyle.Title for oStyle in aStyles" ng-disabled="aStyles.length < 1"></select>',link:function(a){function b(){a.aStyles=
angular.copy(a.row.entity[a.col.field]);a.aStyles=null!=a.aStyles?a.aStyles:[{Title:"",Name:""}];if(null!=a.row.entity[a.col.field+"_selected"]){for(var b=0,c=0;c<a.aStyles.length;c++)a.aStyles[c].Name===a.row.entity[a.col.field+"_selected"].Name&&(b=angular.copy(c));a.oLayerStyle=a.aStyles[b]}else a.oLayerStyle=a.aStyles[0];a.$watch("oLayerStyle",function(){a.row.entity[a.col.field+"_selected"]=a.oLayerStyle;a.$root.$broadcast("layerStyleChanged",a.row.entity)})}a.$root.$on("addLayersToLayer",function(){a.row.grid.refresh();
setTimeout(function(){b()})});b()}}};u.compileProvider.directive("appStyleListColumn",u.rC);angular.element(u.f).scope().initVmapServiceForm=function(){b.info("initVmapServiceForm");var a=angular.element(u.f).scope();"insert"==e.sMode?document.querySelector("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"'] select[name='service_type_id']").addEventListener("change",function(){a.$root.setVmapServiceForm(this.value);angular.element("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+
"']").scope().$apply()}):(a.$root.setVmapServiceForm(e.oFormValues[e.sFormDefinitionName].service_type_id),angular.element("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"']").scope().$apply());if(null!=e.oFormValues[e.sFormDefinitionName].service_options){var c=e.oFormValues[e.sFormDefinitionName].service_options,c=null!=c?r(c)?JSON.parse(c):{}:{};null!=c.login&&null!=c.password&&(e.oFormValues[e.sFormDefinitionName].login=c.login,e.oFormValues[e.sFormDefinitionName].password=c.password)}};
angular.element(u.f).scope().setVmapServiceForm=function(a){b.info("setVmapServiceForm");var g={xyz:"name description url thumbnail form_submit return_list".split(" "),osm:"name description url thumbnail form_submit return_list".split(" "),bing:"name description key thumbnail lang imagery form_submit return_list".split(" "),imagewms:"name wms_service_type description url service_type_version wms_test_button wms_test_submit_button return_list login password service_options".split(" "),tilewms:"name wms_service_type description url service_type_version wms_test_button wms_test_submit_button return_list login password service_options".split(" "),
wmts:"name description url service_type_version service_type_type capabilities_url wmts_test_button wmts_test_submit_button return_list service_options".split(" ")};Object.keys(g).forEach(function(a){g[a].unshift("service_id","service_type_id")});var h=f.getAllFormElementDefinition(e.sFormDefinitionName);"undefined"==typeof a&&(a=e.oFormValues[e.sFormDefinitionName].service_type_id);if("tilewms"===a||"imagewms"===a)e.oFormValues[e.sFormDefinitionName].wms_service_type=a;h.forEach(function(b){var f=
!0;if("undefined"!=typeof g[a])if("button"!==b.type)-1==g[a].indexOf(b.name)&&(f=!1);else{var h=b.buttons;null!=h&&h.forEach(function(b){b.visible=-1===g[a].indexOf(b.name)?!1:!0})}"service_type_version"==b.name&&f&&c(function(){d(["FORM_SERVICE_TYPE_VERSION_TOOLTIP_VMAP_MAP_SERVICE"]).then(function(a){a={title:"",content:a.FORM_SERVICE_TYPE_VERSION_TOOLTIP_VMAP_MAP_SERVICE,container:"body",trigger:"hover"};if(null==document.getElementById(b.id+"_tooltip")){var c=document.createElement("span");c.className=
"form-field-label-tooltip";c.id=b.id+"_tooltip";null!=document.getElementById(b.id+"_label")&&document.getElementById(b.id+"_label").appendChild(c)}angular.element(c).popover(a)})});b.visible=f;!e.oFormValues[e.sFormDefinitionName].service_vm4ms||"name"!==b.name&&"url"!==b.name||(b.type="label")});"tilewms"!==a&&"imagewms"!==a||"update"!==e.sMode?f.getFormElementDefinition("service_type_id",e.sFormDefinitionName,e.sFormDefinition).visible=!0:f.getFormElementDefinition("service_type_id",e.sFormDefinitionName,
e.sFormDefinition).visible=!1;"wmts"===a&&c(function(){""!==e.oFormValues[e.sFormDefinitionName].service_type_version&&null!=e.oFormValues[e.sFormDefinitionName].service_type_version||(e.oFormValues[e.sFormDefinitionName].service_type_version="1.0.0")})};angular.element(u.f).scope().beforeVmapServiceForm=function(){b.info("beforeVmapServiceForm");var a=e.oFormValues[e.sFormDefinitionName].service_type_id;if("tilewms"===a||"imagewms"===a)null!=e.oFormValues[e.sFormDefinitionName].wms_service_type&&
null!=e.oFormValues[e.sFormDefinitionName].wms_service_type.selectedOption&&null!=e.oFormValues[e.sFormDefinitionName].wms_service_type.selectedOption.value&&(e.oFormValues[e.sFormDefinitionName].service_type_id=e.oFormValues[e.sFormDefinitionName].wms_service_type.selectedOption.value,f.getFormElementDefinition("service_type_id",e.sFormDefinitionName,e.sFormDefinition).type="text"),this.setWMSServiceOptions()};angular.element(u.f).scope().setWMSServiceOptions=function(){b.info("setWMSServiceOptions");
if(null!=e.oFormValues[e.sFormDefinitionName].login&&null!=e.oFormValues[e.sFormDefinitionName].password){var a=e.oFormValues[e.sFormDefinitionName].service_options,a=null!=a?r(a)?JSON.parse(a):{}:{};a.login=e.oFormValues[e.sFormDefinitionName].login;a.password=e.oFormValues[e.sFormDefinitionName].password;e.oFormValues[e.sFormDefinitionName].service_options=JSON.stringify(a)}};angular.element(u.f).scope().afterVmapServiceForm=function(){b.info("afterVmapServiceForm");var a=e.oFormValues[e.sFormDefinitionName].service_type_id;
if("tilewms"===a||"imagewms"===a)f.getFormElementDefinition("service_type_id",e.sFormDefinitionName,e.sFormDefinition).type="label";this.editSectionForm()};angular.element(u.f).scope().testWMTSCapabilities=function(a){b.info("testWMTSCapabilities");var d=angular.copy(e.oFormValues[e.sFormDefinitionName].url),f=angular.copy(e.oFormValues[e.sFormDefinitionName].service_type_version),g=angular.copy(e.oFormValues[e.sFormDefinitionName].service_type_type),h=angular.copy(e.oFormValues[e.sFormDefinitionName].name);
ha(g)&&null!=g.selectedOption&&null!=g.selectedOption.value&&(g=g.selectedOption.value);if(null==h||""===h)return $.notify("Nom non d\u00e9fini","error"),null;if(null==d||""===d)return $.notify("Lien non d\u00e9fini","error"),null;if(null==f||""===f)return $.notify("Version non d\u00e9finie","error"),null;if(null==g||""===g)return $.notify("Type non d\u00e9fini","error"),null;if(0<d.toLowerCase().indexOf("service="))return $.notify('Veuillez ne pas utiliser le param\u00e8tre SERVICE dans le champ "Lien"',
"error"),null;if(0<d.toLowerCase().indexOf("request="))return $.notify('Veuillez ne pas utiliser le param\u00e8tre REQUEST dans le champ "Lien"',"error"),null;if(0<d.toLowerCase().indexOf("version="))return $.notify('Veuillez ne pas utiliser le param\u00e8tre VERSION dans le champ "Lien"',"error"),null;this.WMTSCapabilities({serviceUrl:d,serviceVersion:f,WMTSType:g},function(b){$.notify("Service valide","success");c(function(){var c=JSON.stringify(b);e.oFormValues[e.sFormDefinitionName].service_options=
c;if(a){e.oFormValues[e.sFormDefinitionName].url=Zc(d);var c=e.oFormDefinition[e.sFormDefinitionName].name,f=angular.element("form[name='"+c+"']").scope();f[c].$setPristine();f.sendForm()}})})};angular.element(u.f).scope().WMTSCapabilities=function(a,c,d){function e(a){"string"==typeof a&&(a=a.replace(/&gt;/ig,">"),a=a.replace(/&lt;/ig,"<"),a=a.replace(/&#039;/g,"'"),a=a.replace(/&quot;/ig,'"'),a=a.replace(/&amp;/ig,"&"));return a}var f=this;b.info("WMTSCapabilities");if(null==a.serviceUrl)return console.error("serviceUrl not defined"),
null;if(null==a.serviceVersion)return console.error("serviceVersion not defined"),null;if(null==a.WMTSType)return console.error("WMTSType not defined"),null;null!=d||(d=function(a){f.$root.modalWindow("dialog","Service non valide",{className:"modal-danger",message:a})});var g=a.serviceUrl,h=a.serviceVersion;a=a.WMTSType;var m,p=!0,g=Zc(g);"KVP"===a?m=-1===g.indexOf("?")?g+"?SERVICE=WMTS&VERSION="+h+"&REQUEST=GetCapabilities":g+"&SERVICE=WMTS&VERSION="+h+"&REQUEST=GetCapabilities":"REST"===a&&(m=g+
"/"+h+"/WMTSCapabilities.xml");null!=m&&z({method:"GET",url:k.proxy_url+"?url="+encodeURIComponent(m),headers:{charset:"charset=utf-8"},responseType:"text",scope:f,success:function(a){var g=a.data;if(r(a.data)&&0<a.data.length){try{var h=(new nq).read(e(g))}catch(K){h={}}b.info(h);null!=h.Contents&&q(h.Contents.Layer)&&null!=h.Contents.Layer[0]&&q(h.Contents.Layer[0].TileMatrixSetLink)&&null!=h.Contents.Layer[0].TileMatrixSetLink[0]&&r(h.Contents.Layer[0].TileMatrixSetLink[0].TileMatrixSet)&&(p=!1)}p?
(a="Impossible de r\u00e9cup\u00e9rer les informations depuis "+m.replace(/</g,"&lt;").replace(/>/g,"&gt;"),500>g.length&&(a+="<br><br>"+g),null!=d&&d.call(f,a)):c.call(f,h)},error:function(a){null!=d&&d.call(f,"Impossible de r\u00e9cup\u00e9rer les informations depuis "+m.replace(/</g,"&lt;").replace(/>/g,"&gt;"));console.error("error: ",a)}})};angular.element(u.f).scope().testWMSCapabilities=function(a){b.info("testWMSCapabilities");var d=this,f=angular.copy(e.oFormValues[e.sFormDefinitionName].url),
g=angular.copy(e.oFormValues[e.sFormDefinitionName].name);if(null==f||""===f)return $.notify("Lien non d\u00e9fini","error"),null;if(null==g||""===g)return $.notify("Nom non d\u00e9fini","error"),null;if(0<f.toLowerCase().indexOf("service="))return $.notify('Veuillez ne pas utiliser le param\u00e8tre SERVICE dans le champ "Lien"',"error"),null;if(0<f.toLowerCase().indexOf("request="))return $.notify('Veuillez ne pas utiliser le param\u00e8tre REQUEST dans le champ "Lien"',"error"),null;if(0<f.toLowerCase().indexOf("version="))return $.notify('Veuillez ne pas utiliser le param\u00e8tre VERSION dans le champ "Lien"',
"error"),null;this.getCapabilities(f).then(function(b){null!=b?null!=b.json?($.notify("Service valide","success"),c(function(){if(a){e.oFormValues[e.sFormDefinitionName].url=Zc(f);var c=e.oFormDefinition[e.sFormDefinitionName].name,g=angular.element("form[name='"+c+"']").scope();g[c].$setPristine();g.sendForm()}else d.showLayerModalWindow({capabilities:b,service_url:f})})):$.notify("Service non valide","error"):$.notify("Service non valide","error")})};angular.element(u.f).scope().cloneService=function(){b.info("cloneService")};
angular.element(u.f).scope().initVmapLayerForm=function(){b.info("initVmapLayerForm");this.showStudioIfLayerIsFiltered();var a=angular.element(u.f).scope();z({method:"GET",url:k.web_server_name+"/"+k.services_alias+"/vmap/services",scope:a,success:function(b){if(1==b.data.status&&0<b.data.list_count){var c={};b.data.services.forEach(function(a){c[a.service_id]=a});a.oServices=c;"update"==e.sMode&&a.$root.setVmapLayerForm()}}});var c=e.oFormValues[e.sFormDefinitionName].service_type_id;if(("tilewms"==
c||"imagewms"==c)&&"update"==e.sMode){var c=angular.element("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"'] .ui-grid-form-field-data").scope().$parent.gridOptions,d=e.oFormValues[e.sFormDefinitionName].layer_list,f=[],g=[];null!=d&&(f=d.split(","));f=a.cleanLayersArray(f);for(d=f.length-1;0<=d;d--)g.push({name:f[d]});c.data=g}"insert"==e.sMode?setTimeout(function(){document.querySelector("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"'] select[name='service_id']").addEventListener("change",
function(){a.$root.setVmapLayerForm(this.value);angular.element("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"']").scope().$apply()})}):a.$root.setVmapLayerForm(e.oFormValues[e.sFormDefinitionName].service_id)};angular.element(u.f).scope().setVmapLayerForm=function(a){b.info("setVmapLayerForm");var d=angular.element(u.f).scope(),g=this,h={xyz:"layer_id service_id service_name name layertheme_id theme_name bo_id bo_id_list form_submit return_list".split(" "),osm:"layer_id service_id service_name name layertheme_id theme_name bo_id bo_id_list form_submit return_list".split(" "),
bing:"layer_id service_id service_name name layertheme_id theme_name bo_id bo_id_list form_submit return_list".split(" "),tilewms:"layer_id service_id service_name name description layertheme_id theme_name layer_list layer_options bo_id bo_id_list is_dynamic is_filtered form_submit return_list".split(" "),imagewms:"layer_id service_id service_name name description layertheme_id theme_name layer_list layer_options bo_id bo_id_list is_dynamic is_filtered form_submit return_list".split(" "),wmts:"layer_id service_id service_name name description layertheme_id theme_name wmts_layer matrix_set layer_style layer_format layer_options bo_id bo_id_list form_submit return_list".split(" ")},
k,m=f.getAllFormElementDefinition(e.sFormDefinitionName);null==a&&(a=e.oFormValues[e.sFormDefinitionName].service_id,null!=a.selectedOption&&null!=a.selectedOption.value&&(a=a.selectedOption.value));"insert"===e.sMode?null!=d.oServices[a]&&(k=d.oServices[a].service_type_id,e.oFormValues[e.sFormDefinitionName].service_type_id=k,null!=d.oServices[a].url&&(e.oFormValues[e.sFormDefinitionName].service_url=d.oServices[a].url)):k=e.oFormValues[e.sFormDefinitionName].service_type_id;m.forEach(function(a){null!=
h[k]&&("button"===a.type?(a=a.buttons,null!=a&&a.forEach(function(a){a.visible=-1===h[k].indexOf(a.name)?!1:!0})):a.visible=-1!==h[k].indexOf(a.name)?!0:!1)});if("wmts"===k){var p=e.oFormValues[e.sFormDefinitionName].wmts_layer,H=e.oFormValues[e.sFormDefinitionName].matrix_set,B=e.oFormValues[e.sFormDefinitionName].layer_style,R=e.oFormValues[e.sFormDefinitionName].layer_format,p=null!=p?p:{options:[],selectedOption:{value:""}},H=null!=H?H:{options:[],selectedOption:{value:""}},B=null!=B?B:{options:[],
selectedOption:{value:""}},R=null!=R?R:{options:[],selectedOption:{value:""}};c(function(){"update"===e.sMode?(p.selectedOption.value=e.oFormValues[e.sFormDefinitionName].layer_list,q(p.options)&&0===p.options.length&&(p.options=[{label:p.selectedOption.value,value:p.selectedOption.value}]),q(H.options)&&0===H.options.length&&(H.options=[{label:H.selectedOption.value,value:H.selectedOption.value}]),q(B.options)&&0===B.options.length&&(B.options=[{label:B.selectedOption.value,value:B.selectedOption.value}]),
q(R.options)&&0===R.options.length&&(R.options=[{label:R.selectedOption.value,value:R.selectedOption.value}])):"display"===e.sMode&&(e.oFormValues[e.sFormDefinitionName].wmts_layer=e.oFormValues[e.sFormDefinitionName].layer_list)});var N=function(a){var b=[];if(null!=a.Contents&&q(a.Contents.Layer)){a=a.Contents.Layer;for(var c=0;c<a.length;c++)b.push({label:a[c].Title,value:a[c].Identifier})}return b},P=function(a,b){var c=[],d=[],e=[];if(null!=b&&null!=b.value&&(b=b.value,null!=a.Contents)){if(null!=
a.Contents.Layer)for(var f=a.Contents.Layer,g=0;g<f.length;g++)if(f[g].Identifier===b&&null!=f[g].TileMatrixSetLink)for(var h=0;h<f[g].TileMatrixSetLink.length;h++)r(f[g].TileMatrixSetLink[h].TileMatrixSet)&&e.push(f[g].TileMatrixSetLink[h].TileMatrixSet);if(null!=a.Contents.TileMatrixSet&&0<e.length)for(g=0;g<a.Contents.TileMatrixSet.length;g++)-1!==e.indexOf(a.Contents.TileMatrixSet[g].Identifier)&&d.push(a.Contents.TileMatrixSet[g]);if(0<d.length)for(g=0;g<d.length;g++)c.push({label:d[g].Identifier+
" ("+d[g].SupportedCRS+")",value:d[g].Identifier})}return c},K=function(a,b){var c=[],d=[];if(null!=b&&null!=b.value&&(b=b.value,null!=a.Contents)){if(null!=a.Contents.Layer){a=a.Contents.Layer;for(var e=0;e<a.length;e++)a[e].Identifier===b&&null!=a[e].Style&&(d=a[e].Style)}if(0<d.length)for(e=0;e<d.length;e++)c.push({label:d[e].Identifier,value:d[e].Identifier})}return c},G=function(a,b){var c=[],d=[];if(null!=b&&null!=b.value&&(b=b.value,null!=a.Contents)){if(null!=a.Contents.Layer){a=a.Contents.Layer;
for(var e=0;e<a.length;e++)a[e].Identifier===b&&null!=a[e].Format&&(d=a[e].Format)}if(0<d.length)for(e=0;e<d.length;e++)c.push({label:d[e],value:d[e]})}return c},ba=function(a){var d=N(a),f,h,k;c(function(){null!=p&&(p.options=d)});g.wmtsLayerSelected=function(){b.info("wmtsLayerSelected");null!=p&&null!=p.selectedOption&&null!=p.selectedOption.value&&(f=P(a,p.selectedOption),h=K(a,p.selectedOption),k=G(a,p.selectedOption),c(function(){null!=H&&(H.options=f,e.oFormValues[e.sFormDefinitionName].matrix_set=
H);null!=B&&(B.options=h,e.oFormValues[e.sFormDefinitionName].layer_style=B);null!=R&&(R.options=k,e.oFormValues[e.sFormDefinitionName].layer_format=R);e.oFormValues[e.sFormDefinitionName].layer_list=p.selectedOption.value}))};null!=p&&null!=p.selectedOption&&null!=p.selectedOption.value&&0<p.selectedOption.value.length&&g.wmtsLayerSelected()};a=d.oServices[a];null!=a&&"display"!==e.sMode&&(null!=a.service_options?(a=JSON.parse(a.service_options),ba(a)):this.WMTSCapabilities({serviceUrl:a.url,serviceVersion:a.service_type_version,
WMTSType:a.service_type_type},function(a){ba(a)}))}"insert"==e.sMode&&(a=document.querySelector("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"'] .ui-grid-form-field-data"),null!=a&&(angular.element(a).scope().$parent.gridOptions.data.length=0))};angular.element(u.f).scope().loadVmapMapLayers=function(){var a=angular.element(u.X).injector().get(["envSrvc"]);b.info("loadVmapMapLayers");var c=this,e=a.oSelectedObject.sorted_by,f=a.oSelectedObject.sorted_dir;a.oSelectedObject.sorted_by=
"layer_index";a.oSelectedObject.sorted_dir="ASC";var g=document.getElementById("container_section_"+a.oSelectedObject.name+"_layers");g.className+=" section-container-workspace-list";c.gridOptions={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!1,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:999,enableColumnMenus:!1,enableColumnResizing:!0,paginationPageSizes:[10,20,50,100],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!1,appHeaderOptionBar:!1,appLoadGridData:!0,
oFilter:{relation:"AND",operators:[{column:"map_id",compare_operator:"=",value:a.sId}]},appGridTitle:"TITLE_GRID_MAP_LAYERS_VMAP_MAP_MAP_LAYERS",appFooter:!1,appShowPagination:!1,appEnableDragAndDrop:!0,appDragAndDropEvent:{rowFinishDrag:"updateMapLayerSorting"},appActions:[],oUrlParams:{order_by:"layer_index",sort_order:"DESC"}};c.bLoadFormValues=!1;d(["FORM_MAP_ID_VMAP_MAP_MAP","FORM_NAME_VMAP_MAP_MAP","FORM_THEME_VMAP_MAP_MAP","FORM_VISIBLE_VMAP_MAP_MAP_LAYERS","FORM_OPACITY_VMAP_MAP_MAP_LAYERS"]).then(function(b){c.gridOptions.columnDefs=
[{name:b.FORM_MAP_ID_VMAP_MAP_MAP,displayName:b.FORM_MAP_ID_VMAP_MAP_MAP,field:"layer_id",width:50,enableSorting:!1,type:"number",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+a.oSelectedObject.name+"_layer_id",cellClass:"cell-align-right"},{name:b.FORM_NAME_VMAP_MAP_MAP,displayName:b.FORM_NAME_VMAP_MAP_MAP,field:"name",width:250,enableSorting:!1,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+a.oSelectedObject.name+
"_name"},{name:b.FORM_THEME_VMAP_MAP_MAP,displayName:b.FORM_THEME_VMAP_MAP_MAP,field:"theme_name",width:200,enableSorting:!1,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+a.oSelectedObject.name+"_theme_name"},{name:b.FORM_VISIBLE_VMAP_MAP_MAP_LAYERS,displayName:b.FORM_VISIBLE_VMAP_MAP_MAP_LAYERS,field:"layer_visible",width:60,enableSorting:!1,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,cellTemplate:'<div data-app-set-boolean-icon-column="{{row.entity[col.field]}}"></div>',
headerCellClass:"vmap_map_layers_"+a.oSelectedObject.name+"_layer_visible"},{name:b.FORM_OPACITY_VMAP_MAP_MAP_LAYERS,displayName:b.FORM_OPACITY_VMAP_MAP_MAP_LAYERS,field:"layer_opacity",width:65,enableSorting:!1,type:"number",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+a.oSelectedObject.name+"_layer_opacity",cellClass:"cell-align-right",cellTemplate:'<div data-app-map-layers-opacity-column="{{row.entity.layer_id}}" class="cell-input-type-text"><input type="number" class="form-control" min="0" max="100"></div>'}]});
if("update"==a.sMode){d(["BTN_VISIBLE_VMAP_MAP_MAP_LAYERS","BTN_INVISIBLE_VMAP_MAP_MAP_LAYERS","BTN_ADD_LAYERS_VMAP_MAP_MAP_LAYERS","BTN_DELETE_LAYERS_VMAP_MAP_MAP_LAYERS"]).then(function(a){c.gridOptions.appActions=[{label:a.BTN_ADD_LAYERS_VMAP_MAP_MAP_LAYERS,name:c.sSelectedObjectName+"_add_layer_btn",event:"showAddLayersToMapModalWindow()"},{label:a.BTN_DELETE_LAYERS_VMAP_MAP_MAP_LAYERS,name:c.sSelectedObjectName+"_delete_layer_btn",event:"deleteMapLayers()"},{label:a.BTN_VISIBLE_VMAP_MAP_MAP_LAYERS,
name:c.sSelectedObjectName+"_visible_btn",event:"setMapLayerVisibility(true)"},{label:a.BTN_INVISIBLE_VMAP_MAP_MAP_LAYERS,name:c.sSelectedObjectName+"_invisible_btn",event:"setMapLayerVisibility(false)"}]});var h=c.$root.$on("workspaceListTplCompiled",function(){h();var b=document.querySelector("#"+a.oSelectedObject.name+"_"+a.sSelectedSectionName+"_grid .workspacelist-grid-data"),d=c.sSelectedObjectName+"_layer_up_btn",g=c.sSelectedObjectName+"_layer_down_btn";angular.element(b).append('<button type="button" id="'+
d+'" class="btn btn-sm btn-primary map-layer-order-up" aria-label="Left Align"><span class="glyphicon glyphicon-chevron-up"></span></button>');angular.element(b).append('<button type="button" id="'+g+'" class="btn btn-sm btn-primary map-layer-order-down" aria-label="Left Align"><span class="glyphicon glyphicon-chevron-down"></span></button>');document.getElementById(d).addEventListener("click",function(){c.$root.changeMapLayerSorting("up")});document.getElementById(g).addEventListener("click",function(){c.$root.changeMapLayerSorting("down")});
a.oSelectedObject.sorted_by=e;a.oSelectedObject.sorted_dir=f})}};angular.element(u.f).scope().showAddLayersToMapModalWindow=function(){var a=angular.element(u.X).injector().get(["$compile"]),c=angular.element(u.X).injector().get(["$templateRequest"]),d=angular.element(u.X).injector().get(["$translate"]),f=angular.element(u.X).injector().get(["uiGridConstants"]);b.info("showAddLayersToMapModalWindow");var h=this.$new();g.addScopeToObject(e.oSelectedObject.name,e.oSelectedMode.mode_id,h);var k=g.getObject(e.oSelectedObject.name,
g.getMode(e.oSelectedMode.mode_id)),m=e.sMode,H=e.sSelectedGridOptionsName;e.oSelectedObject={actions:[],columns:[],mode_id:k.mode_id,name:k.name+"_available_layers",ressource_id:"vmap/layers",sections:"",template_name:"",order_by:"name",sort_order:"ASC"};e.sMode="search";h.sSelectedObjectName=e.oSelectedObject.name;h.gridOptions={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:100,enableColumnMenus:!1,enableColumnResizing:!0,
paginationPageSizes:[10,20,50,100],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!0,appHeaderOptionBar:!1,appLoadGridData:!0,appGridTitle:"TITLE_GRID_AVAILABLE_LAYERS_VMAP_MAP_MAP_LAYERS",appResizeGrid:!0,appFooter:!0,appShowPagination:!0,appActions:[],oUrlParams:{order_by:"name",sort_order:"ASC"}};d(["FORM_MAP_ID_VMAP_MAP_MAP","FORM_NAME_VMAP_MAP_MAP","FORM_THEME_VMAP_MAP_MAP","FORM_COORDINATE_SYSTEM_VMAP_MAP_LAYER","FORM_DESCRIPTION_VMAP_MAP_LAYER"]).then(function(a){h.gridOptions.columnDefs=
[{name:a.FORM_MAP_ID_VMAP_MAP_MAP,displayName:a.FORM_MAP_ID_VMAP_MAP_MAP,field:"layer_id",width:50,enableSorting:!0,type:"number",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+"_layer_id"},{name:a.FORM_NAME_VMAP_MAP_MAP,displayName:a.FORM_NAME_VMAP_MAP_MAP,field:"name",width:380,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+"_name",sort:{direction:f.ASC,
ignoreSort:!0,priority:0}},{name:a.FORM_THEME_VMAP_MAP_MAP,displayName:a.FORM_THEME_VMAP_MAP_MAP,field:"theme_name",width:200,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+"_theme_name"},{name:a.FORM_DESCRIPTION_VMAP_MAP_LAYER,displayName:a.FORM_DESCRIPTION_VMAP_MAP_LAYER,field:"description",width:150,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+
e.oSelectedObject.name+"_crs_list",cellTemplate:'<div data-app-layer-description-column="{{row.entity[col.field]}}"></div>'}]});"display"!=e.sMode&&d(["BTN_ADD_VMAP_MAP_MAP_LAYERS"]).then(function(a){h.gridOptions.appActions=[{label:a.BTN_ADD_VMAP_MAP_MAP_LAYERS,name:h.sSelectedObjectName+"_add_layer_btn",event:"addLayersToMap()"}]});d=e.oGridOptions[k.name].data;if(0<d.length){for(var B=[],R=0;R<d.length;R++)null!=d[R].layer_id&&B.push(d[R].layer_id);0<B.length&&(e.oSelectedObject.filter={relation:"AND",
operators:[{column:"layer_id",compare_operator:"NOT IN",value:B}]})}var N="container_"+e.oSelectedObject.name+"_available_layers";h.modalWindow("dialog",null,{className:"dialog-modal-window dialog-modal-window-workspace-list dialog-modal-window-available-layers",message:'<div id="'+N+'" class="col-xs-12"></div>'}).then(function(b){$(b).on("shown.bs.modal",function(){var b=document.querySelector(".dialog-modal-window-available-layers > .modal-dialog");b.className+=" modal-lg";c("templates/workspaceListTpl.html").then(function(b){a($("#"+
N).html(b).contents())(h)})});$(b).on("hide.bs.modal",function(){e.oSelectedObject=k;e.sMode=m;e.sSelectedGridOptionsName=H;h.$root.refreshGrid(h.$root.gridApi[e.sSelectedGridOptionsName].grid.appScope,e.oGridOptions[e.sSelectedGridOptionsName])})})};angular.element(u.f).scope().setMapLayerVisibility=function(a){b.info("setMapLayerVisibility");var c=this;a={visibility:""+a,map_id:e.sId};var f=c.$root.gridApi[e.sSelectedGridOptionsName].selection.getSelectedRows();if(0<f.length){for(var g=0,h=[];g<
f.length;)h.push(f[g].layer_id),g++;a.map_layers=h.join("|");z({method:"PUT",url:k.web_server_name+"/"+k.services_alias+"/vmap/maplayers/"+e.sId+"/visibility",data:a,scope:c,success:function(a){0==a.data.status?c.modalWindow("dialog","ERROR_MAP_LAYER_VISIBILITY_VMAP_MAP_MAP_LAYERS",{className:"modal-danger",message:a.data.errorMessage}):(c.$root.gridApi[e.sSelectedGridOptionsName].selection.clearSelectedRows(),c.refreshGrid(c,c.gridOptions),d("SUCCESSFUL_OPERATION").then(function(a){$.notify(a,"success")}))}})}};
angular.element(u.f).scope().addLayersToMap=function(){b.info("addLayersToMap");var a=this,c={map_id:e.sId},f=a.$root.gridApi[e.sSelectedGridOptionsName].selection.getSelectedRows();if(0<f.length){for(var g=0,h=[];g<f.length;)h.push(f[g].layer_id),g++;c.map_layers=h.join("|");z({method:"PUT",url:k.web_server_name+"/"+k.services_alias+"/vmap/maplayers/"+e.sId,data:c,scope:a,success:function(b){0==b.data.status?a.modalWindow("dialog","ERROR_ADD_MAP_LAYERS_VMAP_MAP_MAP_LAYERS",{className:"modal-danger",
message:b.data.errorMessage}):(bootbox.hideAll(),d("SUCCESSFUL_OPERATION").then(function(a){$.notify(a,"success")}))}})}};angular.element(u.f).scope().deleteMapLayers=function(){b.info("deleteMapLayers");var a=this,c={map_id:e.sId},f=a.$root.gridApi[e.sSelectedGridOptionsName].selection.getSelectedRows();if(0<f.length){for(var g=0,h=[];g<f.length;)h.push(f[g].layer_id),g++;c.idList=h.join("|");z({method:"DELETE",url:k.web_server_name+"/"+k.services_alias+"/vmap/maplayers/"+e.sId,params:c,scope:a,
success:function(b){0==b.data.status?a.modalWindow("dialog","ERROR_DELETE_MAP_LAYER_VMAP_MAP_MAP_LAYERS",{className:"modal-danger",message:b.data.errorMessage}):(a.$root.gridApi[e.sSelectedGridOptionsName].selection.clearSelectedRows(),a.refreshGrid(a,a.gridOptions),d("SUCCESSFUL_OPERATION").then(function(a){$.notify(a,"success")}))}})}};angular.element(u.f).scope().changeMapLayerSorting=function(a){b.info("changeMapLayerSorting");var c=e.oGridOptions[e.sSelectedGridOptionsName],d=this.$root.gridApi[e.sSelectedGridOptionsName].selection.getSelectedRows();
if(0<d.length){for(var f=!1,g=0,h=[];g<d.length;)c.data.forEach(function(a,b){a.$$hashKey==d[g].$$hashKey&&h.push(b)}),g++;"up"==a&&h.forEach(function(a,b){0<a&&a>b&&(b=c.data.splice(a,1),c.data.splice(a-1,0,b[0]),f=!0)});h.reverse();"down"==a&&h.forEach(function(a,b){a<c.data.length-1&&a<c.data.length-1-b&&(b=c.data.splice(a,1),c.data.splice(a+1,0,b[0]),f=!0)});g=0;for(a=[];g<c.data.length;)a.push(c.data[g].layer_id),g++;f&&this.$root.updateMapLayerSorting()}};angular.element(u.f).scope().updateMapLayerSorting=
function(){b.info("updateMapLayerSorting");for(var a=this,c={map_id:e.sId},d=e.oGridOptions[e.sSelectedGridOptionsName],f=0,g=[],f=d.data.length-1;0<=f;f--)g.push(d.data[f].layer_id);c.map_layers=g.join("|");z({method:"PUT",url:k.web_server_name+"/"+k.services_alias+"/vmap/maplayers/"+e.sId+"/sorting",data:c,scope:a,success:function(b){0==b.data.status&&a.modalWindow("dialog","ERROR_ADD_MAP_LAYERS_VMAP_MAP_MAP_LAYERS",{className:"modal-danger",message:b.data.errorMessage})}})};u.Av=function(a){return{link:function(b,
c,d){var e=d.$observe("appLayerThemeDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_LAYER_THEME"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_LAYER_THEME},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},
html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};u.Av.$inject=["$translate"];u.compileProvider.directive("appLayerThemeDescriptionColumn",u.Av);u.Iv=function(a){return{link:function(b,c,d){var e=d.$observe("appMapThemeDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP_THEME"]).then(function(a){$(c).popover({trigger:"hover",
container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP_THEME},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};u.Iv.$inject=["$translate"];u.compileProvider.directive("appMapThemeDescriptionColumn",u.Iv);u.Kv=function(a){return{link:function(b,c,d){var e=d.$observe("appModuleDescriptionColumn",function(){null==b.row.entity[b.col.field]||
""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};u.Kv.$inject=["$translate"];u.compileProvider.directive("appModuleDescriptionColumn",
u.Kv);angular.element(u.f).scope().loadVmapUser=function(){b.info("loadVmapUser");var a=e.oSelectedObject.name;this.oFormRequestParams={sUrl:"modules/vmap/forms/"+e.oSelectedMode.mode_id+"/"+a+"_"+e.oSectionForm[a].sections[e.oSectionForm[a].iSelectedSectionIndex].name+".json"}};angular.element(u.f).scope().beforeVmapAdminPrintVmapAdminTemplateEdition=function(){b.info("beforeVmapAdminPrintVmapAdminTemplateEdition")};angular.element(u.f).scope().beforeVmapAdminTemplateSubmit=function(){b.info("beforeVmapAdminTemplateSubmit")};
u.Ov=function(a){return{link:function(b,c,d){var e=d.$observe("appPrintParameterPlaceholderColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["PLACEHOLDER_TOOLTIP_TITLE_VMAP_PRINT_PARAMETER"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.PLACEHOLDER_TOOLTIP_TITLE_VMAP_PRINT_PARAMETER},content:function(){return b.row.entity[b.col.field]},placement:function(a,
c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};u.Ov.$inject=["$translate"];u.compileProvider.directive("appPrintParameterPlaceholderColumn",u.Ov);u.Nv=function(a){return{link:function(b,c,d){var e=d.$observe("appPrintParameterDefaultValueColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["PLACEHOLDER_TOOLTIP_TITLE_VMAP_PRINT_PARAMETER"]).then(function(a){$(c).popover({trigger:"hover",
container:"body",title:function(){return a.PLACEHOLDER_TOOLTIP_TITLE_VMAP_PRINT_PARAMETER},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};u.Nv.$inject=["$translate"];u.compileProvider.directive("appPrintParameterDefaultValueColumn",u.Nv);u.mC=function(){return{link:function(a,b,c){var d=c.$observe("appMapLayersOpacityColumn",function(){var c=b[0].querySelector("input[type='number']");
c.value=a.row.entity[a.col.field];c.setAttribute("data-layer-id",a.row.entity.layer_id)});b[0].querySelector("input[type='number']").addEventListener("change",a.$root.setMapLayerOpacity);a.$on("$destroy",function(){d();b[0].querySelector("input[type='number']").removeEventListener("change",a.$root.setMapLayerOpacity)})}}};u.compileProvider.directive("appMapLayersOpacityColumn",u.mC);angular.element(u.f).scope().setMapLayerOpacity=function(a){b.info("setMapLayerOpacity");var c=angular.element(u.f).scope(),
d=parseInt(a.target.value);0>d?d=0:100<d&&(d=100);a.target.value=d;a={map_id:e.sId,layer_id:a.target.getAttribute("data-layer-id"),layer_opacity:d};z({method:"PUT",url:k.web_server_name+"/"+k.services_alias+"/vmap/maplayers/"+e.sId+"/opacity",data:a,scope:c,success:function(a){0==a.data.status?c.modalWindow("dialog","ERROR_ADD_MAP_LAYERS_VMAP_MAP_MAP_LAYERS",{className:"modal-danger",message:a.data.errorMessage}):c.$root.refreshGrid(c.$root.gridApi[e.sSelectedGridOptionsName].grid.appScope,e.oGridOptions[e.sSelectedGridOptionsName])}})};
angular.element(u.f).scope().initOLMapExtent=function(){b.info("initOLMapExtent");setTimeout(function(){var a=angular.element($("#vmap_map_map_extent")).scope().oMap.aa;angular.element(u.f).scope().updateOLMapExtent();a.on("moveend",function(){(null==a.get("lastManualUpdate")||Date.now()>a.get("lastManualUpdate")+200)&&angular.element(u.f).scope().updateExtent()});document.querySelector("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"'] select[name='crs_id']").addEventListener("change",
function(){angular.element(u.f).scope().updateExtent()})},1E3)};angular.element(u.f).scope().updateExtent=function(){b.info("updateExtent");var a=[],c=angular.element($("#vmap_map_map_extent")).scope().oMap.aa,d=Oh(D(c),c.Ta()),c=D(c).D().V;Sg(d,c,e.oFormValues[e.sFormDefinitionName].crs_id.selectedOption.value).forEach(function(b){a.push(b.toPrecision(10))});e.oFormValues[e.sFormDefinitionName].extent=a.join("|");d=angular.element($("[name=vmap_map_update_form]")).scope();c=angular.element($("[name=vmap_map_insert_form]")).scope();
null!=d&&d.$apply();null!=c&&c.$apply()};angular.element(u.f).scope().updateOLMapExtent=function(){b.info("updateOLMapExtent");if(null==e.oFormValues[e.sFormDefinitionName].extent)return angular.element(u.f).scope().updateExtent(),0;f.getFormElementDefinition("map_extent",e.sFormDefinitionName,e.oFormDefinition);for(var a=angular.element($("#vmap_map_map_extent")).scope().oMap.aa,c=e.oFormValues[e.sFormDefinitionName].extent.split("|"),d=0;d<c.length;d++)c[d]=parseFloat(c[d]);d=D(a).D().V;c=Sg(c,
e.oFormValues[e.sFormDefinitionName].crs_id.selectedOption.value,d);Th(D(a),c,{Ib:!1,Ti:!0});a.set("lastManualUpdate",Date.now())};angular.element(u.f).scope().showAddLayersToLayerModalWindow=function(){var a=angular.element(u.X).injector().get(["$translate"]);b.info("showAddLayersToLayerModalWindow");var c=this,d=e.sFormDefinitionName,f=this.$new();a(["BTN_ADD_LAYERS_VMAP_MAP_LAYER"]).then(function(a){var b=e.oFormValues[d].service_url,b=b.replace("[token]",$c(h.token)),b=b.replace("[ms_cgi_url]",
k.ms_cgi_url);c.showLayerModalWindow({service_url:b,buttons:[{label:a.BTN_ADD_LAYERS_VMAP_MAP_LAYER,name:f.sSelectedObjectName+"_add_layer_btn",event:"addLayersToLayer('"+d+"')"}]})})};angular.element(u.f).scope().showLayerModalWindow=function(a){function c(a){if(null!=a&&null!=a.json&&null!=a.xml){var b=[],c=[],g=function(a){if(void 0===a.Layer)c.push(a);else for(var b=0;b<a.Layer.length;b++)g(a.Layer[b])};if("undefined"!=typeof a){var h=[],k=e.oFormValues[p].layer_list;null!=k&&(h=k.split(","));
g(a.json.Capability.Layer);for(k=0;k<c.length;k++)-1==h.indexOf(c[k].Name)&&b.push({name:c[k].Name,description:c[k].Title,style:c[k].Style,crs_list:null!=c[k].CRS?c[k].CRS.join(","):[],oLayer:c[k]})}b.sort(function(a,b){return a.name.localeCompare(b.name)});N.gridOptions.data=b;N.gridOptions.totalItems=b.length;var m="container_"+e.oSelectedObject.name+"_wms_layers";N.modalWindow("dialog",null,{className:"dialog-modal-window dialog-modal-window-workspace-list dialog-modal-window-wms_layers",message:'<div id="'+
m+'" class="col-xs-12"></div>'}).then(function(g){$(g).on("shown.bs.modal",function(){var g=document.querySelector(".dialog-modal-window-wms_layers > .modal-dialog");g.className+=" modal-l";f("modules/vmap/template/vitis/serviceLayers.html").then(function(g){d($("#"+m).html(g).contents())(N);var h=angular.element($("#"+m)).scope();f("templates/workspaceListTpl.html").then(function(a){d($("#"+m).find("#service_layers_layers_list").html(a).contents())(N)});null!=h&&(h.$applyAsync(function(){h.xml=a.xml;
h.codemirror_options={lineWrapping:!0,lineNumbers:!0,readOnly:"nocursor",mode:"xml"}}),$("#"+m).find("#service_layers_capabilities_codemirror").find(".CodeMirror").css("height","100%"));var k=!1;h.showOlMap=function(){k||z({method:"GET",url:"modules/vmap/forms/vmap_admin_map/vmap_admin_map_vmap_layers_openlayers_test.json",scope:N,success:function(a){k=!0;a=a.data;for(var d=angular.element($("#"+m).find("#service_layers_layers_ol_formreader").children()).scope(),f=a.update.rows[0].fields[0],g=[{extent:[-1901744.2199433097,
4779520.942381757,2501744.2199433097,7220479.057618243],projection:"EPSG:3857"},{extent:[-2648.2345550218597,6231825.554877603,7024177.333740164,7024177.333740164],projection:"EPSG:2154"},{extent:[-4.6307373046875,42.802734375,51.0205078125,51.0205078125],projection:"EPSG:4326"}],h=0,t=0;t<g.length;t++){for(var v=!0,w=0;w<c.length;w++)-1===(q(c[w].CRS)?c[w].CRS:q(c[w].SRS)?c[w].CRS:[]).indexOf(g[t].projection)&&(v=!1);if(v){h=angular.copy(t);break}}f.map_options.proj=g[h].projection;f.map_options.center=
{extent:g[h].extent};f.map_options.tree.children[0].view=g[h];g={name:"Service WMS",children:[]};for(t=0;t<c.length;t++){h="";for(w=0;w<b.length;w++)b[w].name===c[t].Name&&null!=b[w].style_selected&&null!=b[w].style_selected.Name&&(h=b[w].style_selected.Name);g.children.push({name:c[t].Name,layerType:"imagewms",visible:!1,select:!0,url:H,params:{LAYERS:c[t].Name,VERSION:"1.3.0",STYLES:h,TIMESTAMP:(new Date).getTime()},service_options:e.oFormValues[p].service_options,index:t+1})}f.map_options.tree.children.push(g);
f.style.height=$("#"+m).find("#service_layers_layers_ol").height()+"px";d.initOL3TestService=function(){setTimeout(function(){var a=angular.element($("#"+m).find("#service_layers_layers_ol_formreader").find("#layer_test_map")).scope();a.$applyAsync(function(){a.oMap.bLayersTreeOpen=!0});N.$root.$on("layerStyleChanged",function(b,c){b=a.oMap.aTree[1].layers;for(var d=0;d<b.length;d++)if(b[d].name===c.name){b[d].params.STYLES=c.style_selected.Name;var e=b[d].olLayer.v().Cc;e.STYLES=c.style_selected.Name;
b[d].olLayer.v().updateParams(e)}})})};a.update.initEvent="initOL3TestService()";d.ctrl.setDefinitionName("update");d.ctrl.setFormValues({display:{},insert:{},update:{}});d.ctrl.setFormDefinition(a);d.ctrl.loadForm()}})}})});$(g).on("hide.bs.modal",function(){e.oSelectedObject=P;e.sMode=K;e.sFormDefinitionName=p;N.$destroy()})})}}var d=angular.element(u.X).injector().get(["$compile"]),f=angular.element(u.X).injector().get(["$templateRequest"]),h=angular.element(u.X).injector().get(["$translate"]),
m=angular.element(u.X).injector().get(["uiGridConstants"]),p=e.sFormDefinitionName;this.setWMSServiceOptions();a=null!=a?a:{};var H=null!=a.service_url?a.service_url:e.oFormValues[p].service_url,B=null!=a.capabilities?a.capabilities:null,R=null!=a.buttons?a.buttons:[];b.info("showLayerModalWindow");var N=this.$new(),P=g.getObject(e.oSelectedObject.name,g.getMode(e.oSelectedMode.mode_id)),K=e.sMode;e.oSelectedObject={actions:[],columns:[],mode_id:P.mode_id,name:P.name+"_wms_layers",sections:"",template_name:""};
e.sMode="search";N.sSelectedObjectName=e.oSelectedObject.name;N.sFormDefinitionName=e.oSelectedObject.name;e.sFormDefinitionName=N.sFormDefinitionName;N.gridOptions="vmap_admin_map_vmap_services_wms_layers"===e.oSelectedObject.name?{enableRowSelection:!1,enableSelectAll:!1,enableRowHeaderSelection:!1,enableFullRowSelection:!1,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:k.rows_per_page,enableColumnMenus:!1,enableColumnResizing:!0,paginationPageSizes:[10,
20,50,100],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!1,appHeaderOptionBar:!1,appLoadGridData:!1,appGridTitle:"TITLE_GRID_VMAP_MAP_LAYER_WMS_LAYERS",appResizeGrid:!0,appFooter:!1,appShowPagination:!1,appActions:[]}:{enableRowSelection:!0,enableSelectAll:!0,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:k.rows_per_page,enableColumnMenus:!1,enableColumnResizing:!0,paginationPageSizes:[10,20,50,100],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!1,
appHeaderOptionBar:!1,appLoadGridData:!1,appGridTitle:"TITLE_GRID_VMAP_MAP_LAYER_WMS_LAYERS",appResizeGrid:!0,appFooter:!1,appShowPagination:!1,appActions:[]};h(["FORM_NAME_VMAP_MAP_LAYER_WMS_LAYERS","FORM_CRS_VMAP_MAP_LAYER_WMS_LAYERS","FORM_DESCRIPTION_VMAP_MAP_LAYER_WMS_LAYERS"]).then(function(a){N.gridOptions.columnDefs=[{name:a.FORM_NAME_VMAP_MAP_LAYER_WMS_LAYERS,displayName:a.FORM_NAME_VMAP_MAP_LAYER_WMS_LAYERS,field:"name",width:250,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,
headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+"_name",sort:{direction:m.ASC,ignoreSort:!0,priority:0}},{name:a.FORM_DESCRIPTION_VMAP_MAP_LAYER_WMS_LAYERS,displayName:a.FORM_DESCRIPTION_VMAP_MAP_LAYER_WMS_LAYERS,field:"description",width:350,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+"_crs_list"},{name:"Style",displayName:"Style",field:"style",width:180,enableSorting:!1,type:"object",enableColumnMoving:!1,
enableColumnResizing:!1,headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+"_style",cellTemplate:"<div data-app-style-list-column></div>"},{name:a.FORM_CRS_VMAP_MAP_LAYER_WMS_LAYERS,displayName:a.FORM_CRS_VMAP_MAP_LAYER_WMS_LAYERS,field:"crs_list",width:180,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+"_crs_list",cellTemplate:'<div data-app-crs-list-description-column="{{row.entity[col.field]}}"></div>'},
{name:"oLayer",visible:!1}]});h(["BTN_ADD_VMAP_MAP_MAP_LAYERS"]).then(function(){N.gridOptions.appActions=R});null!=B?c(B):null!=H&&N.$root.getCapabilities(H).then(function(a){B=a;null!=B?null!=B.xml&&null!=B.json&&c(a):e.sFormDefinitionName=p})};angular.element(u.f).scope().getCapabilities=function(c,d){function e(a){z({method:"GET",url:k.proxy_url,params:{url:a},scope:g,responseType:"text",success:function(b){var c;if(""==b.data)d.showErrorMessage&&(b={className:"modal-danger",message:"ERROR_CONTENT_NO_DATA_VMAP_MAP_LAYER_WMS_LAYERS"},
g.modalWindow("dialog","ERROR_TITLE_GET_CAPABILITIES_VMAP_MAP_LAYER_WMS_LAYERS",b));else{c={xml:f(b.data)};var e=(new DOMParser).parseFromString(f(b.data),"text/xml");if(null===e.querySelector("WMS_Capabilities")){c=null;if(0==b.data.status&&null!=b.data.sMessage)var h='<a href="'+a+'" target="_blank">'+a+"</a><br><br>",h=h+b.data.sMessage;null!=h||(h=null!=e.querySelector("BODY")?null!=e.querySelector("BODY").textContent?e.querySelector("BODY").textContent:$(e).find("body").html():$(e).find("body").html());
d.showErrorMessage&&(b={className:"modal-danger",message:h},g.modalWindow("dialog","ERROR_TITLE_GET_CAPABILITIES_VMAP_MAP_LAYER_WMS_LAYERS",b))}else c.json=(new Ir).read(f(b.data))}m.resolve(c)}})}function f(a){"string"==typeof a&&(a=a.replace(/&gt;/ig,">"),a=a.replace(/&lt;/ig,"<"),a=a.replace(/&#039;/g,"'"),a=a.replace(/&quot;/ig,'"'),a=a.replace(/&amp;/ig,"&"));return a}b.info("getCapabilities");var g=this,m=a.defer(),p=m.promise,t={showErrorMessage:!0};"undefined"!=typeof d&&kb(t,d);d=t;c=-1===
c.indexOf("?")?c+"?":c+"&";c+="service=wms&version=1.3.0&request=GetCapabilities&no_cache="+(new Date).getTime();(new RegExp(/\[token\]/)).test(c)?(c=c.replace(/\[token\]/,$c(h.token)),z({method:"GET",url:k.web_server_name+"/"+k.services_alias+"/vm4ms/wmsservices/private/MapFile",params:{creation:!0,type:"prod"},scope:g,success:function(){e(c)}})):e(c);return p};angular.element(u.f).scope().addLayersToLayer=function(a){b.info("addLayersToLayer");var c=angular.element("form[name='"+e.oFormDefinition[a].name+
"'] .ui-grid-form-field-data").scope().$parent.gridOptions,d=this.$root.gridApi[e.sSelectedGridOptionsName].selection.getSelectedRows();if(0<d.length){var f=0,g=e.oFormValues[a].layer_list,g="string"==typeof g?g.split(","):[],h=e.oFormValues[a].layer_options;"string"===typeof h?h=JSON.parse(h):"object"!==typeof h&&(h={});var k={};null!=h&&null!=h.layer_style&&(k=h.layer_style);for(f=d.length-1;0<=f;f--)delete d[f].$$hashKey,-1===g.indexOf(d[f].name)?(null!=d[f].name&&g.unshift(d[f].name),k[d[f].name]=
d[f].style_selected):($.notify("Calque d\u00e9j\u00e0 pr\u00e9sent: "+d[f].name,"warning"),d.splice(f,1));g=this.cleanLayersArray(g);h.layer_style=k;c.data=c.data.concat(d);c.totalItems=c.data.length;e.oFormValues[a].layer_list=g.join(",");e.oFormValues[a].layer_options=JSON.stringify(h);var m=[];this.gridOptions.data.forEach(function(a){-1==d.indexOf(a)&&m.push(a)});this.$root.gridApi[e.sSelectedGridOptionsName].selection.clearSelectedRows();this.gridOptions.data=m}this.$root.$broadcast("addLayersToLayer")};
angular.element(u.f).scope().cleanLayersArray=function(a){for(var b=a.length-1;0<=b;b--)r(a[b])?0===a[b].trim().length&&a.splice(b,1):a.splice(b,1);return a};angular.element(u.f).scope().updateLayerLayersSorting=function(){b.info("updateLayerLayersSorting");var a=e.sFormDefinitionName;if(null==e.oFormValues[a])return 0;var c=angular.element("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"'] .ui-grid-form-field-data").scope().$parent.gridOptions.data;if(0<c.length){for(var d=[],f=c.length-
1;0<=f;f--)null!=c[f].name&&d.push(c[f].name);d=this.cleanLayersArray(d);e.oFormValues[a].layer_list=d.join(",")}};angular.element(u.f).scope().removeLayersOfLayer=function(){b.info("removeLayersOfLayer");var a=angular.element("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"'] .ui-grid-form-field-data").scope().$parent.gridOptions,c=e.oFormValues[e.sFormDefinitionName].layer_options,c="string"===typeof c?JSON.parse(c):{},d={};null!=c&&null!=c.layer_style&&(d=c.layer_style);var f=a.gridApi.selection.getSelectedRows();
if(0<f.length){var g=[],h=[];a.data.forEach(function(a){-1===f.indexOf(a)?(g.push(a),h.unshift(a.name)):null!=d[a.name]&&delete d[a.name]});c.layer_style=d;h=this.cleanLayersArray(h);e.oFormValues[e.sFormDefinitionName].layer_list=h.join(",");e.oFormValues[e.sFormDefinitionName].layer_options=JSON.stringify(c);a.gridApi.selection.clearSelectedRows();a.data=g}};angular.element(u.f).scope().loadVmapConfig=function(){var a=angular.element(u.X).injector().get(["envSrvc"]);angular.element(u.X).injector().get(["propertiesSrvc"]);
b.info("loadVmapConfig");angular.element(u.f).scope().setPropertiesFormValues(["vmap","popup","print","selection","controls"]);var c=a.oSelectedObject.name;this.oFormRequestParams={sUrl:"modules/vmap/forms/"+a.oSelectedMode.mode_id+"/"+c+"_"+a.oSectionForm[c].sections[a.oSectionForm[c].iSelectedSectionIndex].name+".json"}};angular.element(u.f).scope().loadStudioVmap=function(a){var c=angular.element(u.X).injector().get(["envSrvc"]),d=angular.element(u.X).injector().get(["propertiesSrvc"]);b.info("loadStudioVmap");
var e="title subtitle label checkbox radio textarea select list double_select date datetime tinymce codemirror hidden text password email url integer float button color_picker slider hr map_osm map_bing map_vmap imageurl image_wsdata linkurl file_wsdata bo_grid section_grid".split(" ");if("business_object"===a)var f={avaliable_elems:e,avaliable_form_types:["display","search","update","insert"],default_form_type:"update",get:{api:"vmap",ressource:"businessobjects",no_result_function:"suggestGenerateForm"},
reset_default_function:"suggestColumnsToGenerateForm"};"layer_filter"===a&&(f={avaliable_elems:e,avaliable_form_types:["search"],default_form_type:"search",get:{api:"vmap",ressource:"layers",no_result_function:"useEmptyForm"}});X.reset();X.setId(c.sId);X.setApplication("vmap");X.setToken(h.token);X.setContainer("#container_section_"+c.oSelectedObject.name+"_studio");X.setAppProperties(d);null!=f&&X.lh(f)};angular.element(u.f).scope().showStudioIfLayerIsFiltered=function(){var a=angular.element(u.X).injector().get(["envSrvc"]);
b.info("showStudioIfLayerIsFiltered");setTimeout(function(){null!=a.oFormValues.vmap_admin_map_vmap_layers_general_update_form&&(a.oFormValues.vmap_admin_map_vmap_layers_general_update_form.is_filtered?$("#container_mode_vmap_admin_map").find(".section-form-edit-first").find(".section-form-section").show():$("#container_mode_vmap_admin_map").find(".section-form-edit-first").find(".section-form-section").hide());"insert"===a.sMode&&$("#container_mode_vmap_admin_map").find(".section-form-edit-first").find(".section-form-section-insert").hide()},
500)};angular.element(u.f).scope().importBusinessObject=function(){var a=angular.element(u.X).injector().get(["$compile"]),b=this,c=!1,e=sessionStorage.privileges.split(",");q(e)&&-1!==e.indexOf("vitis_admin")&&-1!==e.indexOf("vmap_admin")&&-1!==e.indexOf("vm4ms_admin")&&(c=!0);d(["CTRL_IMPORT_BO_ERROR_INSUFFICIENT_PRIVILEGES","CTRL_IMPORT_BO_ERROR_INSUFFICIENT_PRIVILEGES_DESCRIPTION","CTRL_IMPORT_BO_IMPORT_TITLE","CTRL_IMPORT_BO_LOADING"]).then(function(d){if(!c)return b.modalWindow("dialog",d.CTRL_IMPORT_BO_ERROR_INSUFFICIENT_PRIVILEGES,
{className:"modal-danger",message:d.CTRL_IMPORT_BO_ERROR_INSUFFICIENT_PRIVILEGES_DESCRIPTION}),0;var e=bootbox.dialog({size:"large",title:d.CTRL_IMPORT_BO_IMPORT_TITLE,message:'<div app-import-bo id="import-bo">'+d.CTRL_IMPORT_BO_LOADING+"</div>"});e.init(function(){setTimeout(function(){var c=e.find(".bootbox-body");a(c)(b)},1E3)})})};angular.element(u.f).scope().checkBoSchema=function(){var a=angular.element(u.Pb).injector().get(["$q"]);b.info("checkBoSchema");for(var c=this,f=a.defer(),g=e.oFormValues[e.sFormDefinitionName].schema,
a=["s_vmap","s_vitis","s_vm4ms","s_majic","s_cadastre"],h=!1,k=0;k<a.length;k++)g===a[k]&&(h=!0,d(["CREATE_BO_ON_UNRECOMMENDED_SCHEMA1","CREATE_BO_ON_UNRECOMMENDED_SCHEMA2","CREATE_BO_ON_UNRECOMMENDED_SCHEMA3"]).then(function(a){c.modalWindow("confirm","",{className:"modal-warning",message:"<b>"+a.CREATE_BO_ON_UNRECOMMENDED_SCHEMA1+g+a.CREATE_BO_ON_UNRECOMMENDED_SCHEMA2+"<br>"+a.CREATE_BO_ON_UNRECOMMENDED_SCHEMA3+"</b>",callback:function(a){a?f.resolve():f.reject()}})}));h||setTimeout(function(){f.resolve()});
return f.promise};u.uv=function(a){return{link:function(b,c,d){var e=d.$observe("appBusinessObjectEventDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["FORM_DESCRIPTION_VMAP_BUSINESS_OBJECT_EVENT"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.FORM_DESCRIPTION_VMAP_BUSINESS_OBJECT_EVENT},content:function(){return b.row.entity[b.col.field]},
placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};u.uv.$inject=["$translate"];u.compileProvider.directive("appBusinessObjectEventDescriptionColumn",u.uv);angular.element(u.f).scope().checkVmapLayerWmsLayers=function(){var a=angular.element(u.X).injector().get(["$translate"]);b.info("checkVmapLayerWmsLayers");var c=this,d=e.oFormValues[e.sFormDefinitionName].service_url,d=d.replace("[token]",$c(h.token)),
d=d.replace("[ms_cgi_url]",k.ms_cgi_url);c.$root.getCapabilities(d).then(function(b){if(null!=b&&null!=b.xml&&null!=b.json){var d=[],f=function(a){if(void 0===a.Layer)d.push(a.Name);else for(var b=0;b<a.Layer.length;b++)f(a.Layer[b])};if("undefined"!=typeof b){var g=[],h=e.oFormValues[e.sFormDefinitionName].layer_list;null!=h&&(g=h.split(","));var k=[];f(b.json.Capability.Layer);for(b=0;b<g.length;b++)-1==d.indexOf(g[b])&&k.push(g[b]);0==k.length?a("FORM_BTN_CHECK_LAYERS_SUCCESSFUL_VMAP_MAP_LAYER").then(function(a){$.notify(a,
"success")}):a("FORM_BTN_CHECK_LAYERS_ERROR_MESSAGE_VMAP_MAP_LAYER").then(function(a){c.$root.modalWindow("dialog","FORM_BTN_CHECK_LAYERS_ERROR_TITLE_VMAP_MAP_LAYER",{className:"modal-danger",message:a+"<br>- "+k.join("<br>- "),html:!0})})}}})}});u.vB=function(a,b,c,d,e,f,g,h,k,m,p){a.info("initWmsServiceTests");b.aWmsServiceTestTabs={get_capabilities:{loaded:!1},openlayers_test:{loaded:!1},maplayer_test:{loaded:!1},mapserver_log:{loaded:!1,file_content:""},map_file:{loaded:!1}};p.addScopeToObject(h.oSelectedObject.name,h.oSelectedMode.mode_id,b);b.showWmsServiceGetCapabilities=function(c){a.info("showWmsServiceGetCapabilities");if(null!=g.ms_cgi_url&&""!=g.ms_cgi_url){if(!b.aWmsServiceTestTabs.get_capabilities.loaded||!0===c){c=new FormData;
c.append("wmsservice_id",h.sId);c.append("type","test");if("undefined"!=typeof h.oFormValues[h.sFormDefinitionName]){var d=h.oFormValues[h.sFormDefinitionName].wms_service_login,f=h.oFormValues[h.sFormDefinitionName].wms_service_password;null!=d&&null!=f&&(c.append("user_login",d),c.append("user_password",f))}z({method:"POST",url:g.web_server_name+"/"+g.services_alias+"/vm4ms/WmsServices/MapFile",data:c,scope:b,success:function(a){if(1==a.data.status){var c=h.extractWebServiceData("wmsservices",a.data)[0],
d=g.ms_cgi_url+"/test/"+c.map_file_hash;h.sId!=g.private_wms_service&&(d+="_"+c.wmsservice_id);b.aWmsServiceTestTabs.map_file_hash=c.map_file_hash;b.$root.getCapabilities(d,{showErrorMessage:!1}).then(function(a){null!=a?(b.aWmsServiceTestTabs.get_capabilities.oCodeMirrorEditor.setValue(a.xml),b.oGetCapabilities=a,b.oGetCapabilities.service_url=d,"undefined"!=typeof c.layers_sources&&(b.oGetCapabilities.layers_sources=c.layers_sources)):e(function(){document.querySelector(".wms-service-tests .nav-tabs > li:nth-child(1)").style.display=
"none";document.querySelector(".wms-service-tests .nav-tabs > li:nth-child(2)").style.display="none";document.querySelector(".wms-service-tests .nav-tabs > li:nth-child(3)").style.display="none";document.querySelector(".wms-service-tests .nav-tabs > li > a[aria-controls='wms_service_tests_wms_service_log']").click()})})}else{delete b.oGetCapabilities;b.clearWmsServiceTestsTabs();b.aWmsServiceTestTabs.get_capabilities.loaded=!1;b.aWmsServiceTestTabs.openlayers_test.loaded=!1;b.aWmsServiceTestTabs.maplayer_test.loaded=
!1;var f={className:"modal-danger"};null!=a.data.errorMessage&&(f.message=a.data.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",f)}}});b.aWmsServiceTestTabs.get_capabilities.loaded=!0}}else b.$root.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:"ERROR_MS_CGI_URL_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG"})};b.testWmsServiceWithOpenLayers=function(e){a.info("testWmsServiceWithOpenLayers");null!=g.ms_cgi_url&&""!=g.ms_cgi_url?b.aWmsServiceTestTabs.openlayers_test.loaded&&
!0!==e||"undefined"==typeof b.oGetCapabilities||"undefined"==typeof b.oGetCapabilities.json||(b.sFormDefinitionName=h.sFormDefinitionName+"_openlayers_test",b.oFormRequestParams={sUrl:"modules/"+h.oSelectedMode.module_name+"/forms/"+h.oSelectedMode.mode_id+"/vm4ms_vm4ms_web_service_openlayers_test.json"},$("#wms_service_tests_wms_service_ol_map").empty(),c("templates/formTpl.html").then(function(a){d($("#wms_service_tests_wms_service_ol_map").html(a).contents())(b);var c=b.$root.$on("formDefinitionLoaded",
function(){c();var a=b.$root.proj.projections[0].code;"undefined"!=typeof b.oGetCapabilities.json.Capability.Layer&&b.$root.proj.projections.forEach(function(c){c=b.oGetCapabilities.json.Capability.Layer.CRS.indexOf(c.code);-1!=c&&"undefined"==typeof a&&(a=b.oGetCapabilities.json.Capability.Layer.CRS[c])});var d=m.getFormElementDefinition("wms_service_test_map",b.sFormDefinitionName);d.map_options.bLayersTreeOpen=!0;d.map_options.proj=a;d.map_options.tree.children[0].view.projection=a;Y.prototype.al();
if(null!=b.oGetCapabilities.json.Capability.Layer)d.map_options.center.extent=Sg(b.oGetCapabilities.json.Capability.Layer.EX_GeographicBoundingBox,"EPSG:4326",a);else{var e={"EPSG:3857":[-1901744.2199433097,4779520.942381757,2501744.2199433097,7220479.057618243],"EPSG:2154":[-2648.2345550218597,6231825.554877603,7024177.333740164,7024177.333740164],"EPSG:4326":[-4.6307373046875,42.802734375,51.0205078125,51.0205078125]};null!=e[a]&&(d.map_options.center.extent=e[a])}d.map_options.tree.children[0].view.extent=
d.map_options.center.extent;if("undefined"!=typeof b.oGetCapabilities.json.Capability.Layer){var g={name:"Service",children:[]},e=angular.copy(b.oGetCapabilities.json.Capability.Layer.Layer);e.sort(function(a,b){return a.Name.localeCompare(b.Name)});e.forEach(function(a,c){c={name:a.Name,layerType:"imagewms",visible:!1,legend:"true",select:!0,url:b.oGetCapabilities.service_url,params:{LAYERS:a.Name,VERSION:"1.3.0",TIMESTAMP:(new Date).getTime()},index:c+1};"undefined"!=typeof b.oGetCapabilities.layers_sources[a.Name]&&
(c.attributions=[new Um({html:b.oGetCapabilities.layers_sources[a.Name]})]);g.children.push(c)});d.map_options.tree.children.push(g)}var h=b.$root.$on("OpenLayersMapCreated",function(a,c){h();c.aa.Tc(new Zh);b.aEventKey=[];c.aa.getLayers().R().forEach(function(a){a instanceof fr&&(b.aEventKey[b.aEventKey.length]=a.v().on(["imageloaderror","tileloaderror"],function(a){f.displayLayerLoadingError(a)}))})})})}),b.aWmsServiceTestTabs.openlayers_test.loaded=!0):b.$root.modalWindow("dialog","REQUEST_ERROR",
{className:"modal-danger",message:"ERROR_MS_CGI_URL_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG"})};b.testWmsServiceWithMapServer=function(c){a.info("testWmsServiceWithMapServer");null!=g.ms_cgi_url&&""!=g.ms_cgi_url?b.aWmsServiceTestTabs.maplayer_test.loaded&&!0!==c||"undefined"==typeof b.oGetCapabilities||"undefined"==typeof b.oGetCapabilities.json||"undefined"==typeof b.oGetCapabilities.json.Capability.Layer||(b.aMSTestLayers=[],$("#wms_service_tests_layer_select_modal").modal("show"),b.testWmsServiceSelectedLayersWithMapServer=
function(c){a.info("testWmsServiceSelectedLayersWithMapServer",c);$("#wms_service_tests_layer_select_modal").modal("hide");b.aWmsServiceTestTabs.map_file;var d=g.ms_cgi_url+"/test/"+b.aWmsServiceTestTabs.map_file_hash;h.sId!=g.private_wms_service&&(d+="_"+h.sId);c=d+"?ms_cgi_url="+g.ms_cgi_url+"&LAYERS="+c.join(" ")+"&no_cache="+(new Date).getTime();d=document.getElementById("wms_service_tests_wms_service_mapserver");null!==d&&(c+="&MAPSIZE="+(parseInt(.75*d.clientWidth)-23)+"+"+(d.clientHeight-83));
document.getElementById("wms_service_tests_wms_service_ms_iframe").contentWindow.location.href=c;b.aWmsServiceTestTabs.maplayer_test.loaded=!0;$("#wms_service_tests_wms_service_ms_iframe").load(function(){var a=this;$("link").each(function(){if("stylesheet"===this.rel&&"text/css"===this.type){var b=document.createElement("link");b.href=this.href;b.rel="stylesheet";b.type="text/css";a.contentWindow.document.body.appendChild(b)}});this.contentWindow.document.body.style.overflow="auto"})},b.testWmsServiceSelectAllLayers=
function(){b.aMSTestLayers=[];b.oGetCapabilities.json.Capability.Layer.Layer.forEach(function(a){b.aMSTestLayers.push(a.Name)})}):b.$root.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:"ERROR_MS_CGI_URL_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG"})};b.$root.refreshWmsServiceTestsTab=function(){a.info("refreshWmsServiceTestsTab");var c=h.oFormValues[h.sFormDefinitionName].wms_service_login,d=h.oFormValues[h.sFormDefinitionName].wms_service_password,e=angular.element("form[name='"+
h.oFormDefinition[h.sFormDefinitionName].name).scope(),f=!0;e[h.oFormDefinition[h.sFormDefinitionName].name].wms_service_login.$setValidity("wms_service_login",!0);e[h.oFormDefinition[h.sFormDefinitionName].name].wms_service_password.$setValidity("wms_service_password",!0);if(null!=c&&""!=c||null!=d&&""!=d){if(null==c||""==c)e[h.oFormDefinition[h.sFormDefinitionName].name].wms_service_login.$setValidity("wms_service_login",!1),e[h.oFormDefinition[h.sFormDefinitionName].name].wms_service_login.$setDirty(),
f=!1;if(null==d||""==d)e[h.oFormDefinition[h.sFormDefinitionName].name].wms_service_password.$setValidity("wms_service_password",!1),e[h.oFormDefinition[h.sFormDefinitionName].name].wms_service_password.$setDirty(),f=!1}f&&($(".wms-service-tests a[href='#wms_service_tests_get_capabilities']").tab("show"),b.showWmsServiceGetCapabilities(!0),b.aWmsServiceTestTabs.openlayers_test.loaded=!1,b.aWmsServiceTestTabs.maplayer_test.loaded=!1,b.aWmsServiceTestTabs.mapserver_log.loaded=!1,b.aWmsServiceTestTabs.map_file.loaded=
!1)};b.clearWmsServiceTestsTabs=function(){a.info("clearWmsServiceTestsTabs");b.aWmsServiceTestTabs.get_capabilities.oCodeMirrorEditor.setValue("");document.getElementById("wms_service_tests_wms_service_ms_iframe").contentWindow.location.href="about:blank";$("#wms_service_tests_wms_service_ol_map").empty()};b.loadWmsServiceMapServerLog=function(c){a.info("loadWmsServiceMapServerLog");b.aWmsServiceTestTabs.mapserver_log.loaded&&!0!==c||(z({method:"GET",url:g.web_server_name+"/"+g.services_alias+"/vm4ms/wmsservices/"+
h.sId+"/MapServerLog",scope:b,success:function(a){if(1==a.data.status)a=h.extractWebServiceData("wmsservices",a.data)[0],b.aWmsServiceTestTabs.mapserver_log.file_content=a.log_file_content;else{var c={className:"modal-danger"};null!=a.data.errorMessage&&(c.message=a.data.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",c)}}}),b.aWmsServiceTestTabs.mapserver_log.loaded=!0)};b.loadWmsServiceMapFile=function(c){a.info("loadWmsServiceMapFile");b.aWmsServiceTestTabs.map_file.loaded&&!0!==c||(z({method:"GET",
url:g.web_server_name+"/"+g.services_alias+"/vm4ms/wmsservices/"+h.sId+"/MapFile",params:{wmsservice_id:h.sId,type:"test"},scope:b,success:function(a){if(1==a.data.status)a=h.extractWebServiceData("wmsservices",a.data)[0],b.aWmsServiceTestTabs.map_file.oCodeMirrorEditor.setValue(a.map_file_content);else{var c={className:"modal-danger"};null!=a.data.errorMessage&&(c.message=a.data.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",c)}}}),b.aWmsServiceTestTabs.map_file.loaded=!0)}};
u.vB.$inject="$log $scope $templateRequest $compile $timeout $rootScope propertiesSrvc envSrvc sessionSrvc formSrvc modesSrvc".split(" ");u.module.controller("wmsServiceTestsCtrl",u.vB);u.$x=function(a,b,c,d,e,f,g,h,k,m){a.info("initLayerTests");b.aLayerTestTabs={get_capabilities:{},openlayers_test:{loaded:!1},maplayer_test:{loaded:!1},mapserver_log:{loaded:!1,file_content:""},map_file:{loaded:!1}};m.addScopeToObject(g.oSelectedObject.name,g.oSelectedMode.mode_id,b);b.testLayerWithOpenLayers=function(e){a.info("testLayerWithOpenLayers");null!=f.ms_cgi_url&&""!=f.ms_cgi_url?b.aLayerTestTabs.openlayers_test.loaded&&!0!==e||"undefined"==typeof b.oGetCapabilities||"undefined"==typeof b.oGetCapabilities.json||
(b.sFormDefinitionName=g.sFormDefinitionName+"_openlayers_test",b.oFormRequestParams={sUrl:"modules/"+g.oSelectedMode.module_name+"/forms/"+g.oSelectedMode.mode_id+"/vm4ms_vm4ms_layer_openlayers_test.json"},$("#layer_tests_layer_ol_map").empty(),c("templates/formTpl.html").then(function(a){d($("#layer_tests_layer_ol_map").html(a).contents())(b);var c=b.$root.$on("formDefinitionLoaded",function(){c();var a=b.$root.proj.projections[0].code;"undefined"!=typeof b.oGetCapabilities.json.Capability.Layer&&
b.$root.proj.projections.forEach(function(c){c=b.oGetCapabilities.json.Capability.Layer.CRS.indexOf(c.code);-1!=c&&"undefined"==typeof a&&(a=b.oGetCapabilities.json.Capability.Layer.CRS[c])});var d=k.getFormElementDefinition("layer_test_map",b.sFormDefinitionName);d.map_options.proj=a;d.map_options.tree.children[0].view.projection=a;Y.prototype.al();"undefined"!=typeof b.oGetCapabilities.json.Capability.Layer&&(d.map_options.center.extent=Sg(b.oGetCapabilities.json.Capability.Layer.EX_GeographicBoundingBox,
"EPSG:4326",a));d.map_options.tree.children[0].view.extent=d.map_options.center.extent;"undefined"!=typeof b.oGetCapabilities.json.Capability.Layer&&b.oGetCapabilities.json.Capability.Layer.Layer.forEach(function(a,c){c={name:a.Name,children:[{name:a.Name,layerType:"imagewms",visible:!0,select:!0,url:b.oGetCapabilities.service_url,params:{LAYERS:a.Name,VERSION:"1.3.0",TIMESTAMP:(new Date).getTime()},index:c+1}]};"undefined"!=typeof b.oGetCapabilities.layers_sources[a.Name]&&(c.children[0].attributions=
[new Um({html:b.oGetCapabilities.layers_sources[a.Name]})]);d.map_options.tree.children.push(c)});var e=b.$root.$on("OpenLayersMapCreated",function(a,c){e();c.aa.Tc(new Zh);b.aEventKey=[];c.aa.getLayers().R().forEach(function(a){a instanceof fr&&(b.aEventKey[b.aEventKey.length]=a.v().on(["imageloaderror","tileloaderror"],function(a){b.$root.displayLayerLoadingError(a)}))})})})}),b.aLayerTestTabs.openlayers_test.loaded=!0):b.$root.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:"ERROR_MS_CGI_URL_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG"})};
b.testLayerWithMapServer=function(c){a.info("testLayerWithMapServer");if(null!=f.ms_cgi_url&&""!=f.ms_cgi_url)if(b.aLayerTestTabs.maplayer_test.loaded&&!0!==c)document.getElementById("layer_tests_layer_ms_iframe").contentWindow.document.body.style.overflow="hidden",setTimeout(function(){document.getElementById("layer_tests_layer_ms_iframe").contentWindow.document.body.style.overflow="auto"},100);else{if("undefined"!=typeof b.oGetCapabilities&&"undefined"!=typeof b.oGetCapabilities.json){$("#layer_tests_layer_ms_iframe").load(function(){var a=
this;$("link").each(function(){if("stylesheet"===this.rel&&"text/css"===this.type){var b=document.createElement("link");b.href=this.href;b.rel="stylesheet";b.type="text/css";a.contentWindow.document.body.appendChild(b)}});this.contentWindow.document.body.style.overflow="auto"});var d=[];"undefined"!=typeof b.oGetCapabilities.json.Capability.Layer&&b.oGetCapabilities.json.Capability.Layer.Layer.forEach(function(a){d.push(a.Name)});c=b.oGetCapabilities.service_url+"?ms_cgi_url="+f.ms_cgi_url+"&LAYERS="+
d.join(" ")+"&no_cache="+(new Date).getTime();var e=document.getElementById("layer_tests_layer_mapserver");null!==e&&(c+="&MAPSIZE="+(parseInt(.75*e.clientWidth)-23)+"+"+(e.clientHeight-83));document.getElementById("layer_tests_layer_ms_iframe").contentWindow.location.href=c;b.aLayerTestTabs.maplayer_test.loaded=!0}}else b.$root.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:"ERROR_MS_CGI_URL_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG"})};b.clearLayerTestsTabs=function(){a.info("clearLayerTestsTabs");
document.getElementById("layer_tests_layer_ms_iframe").contentWindow.location.href="about:blank";$("#layer_tests_layer_ol_map").empty()};b.loadLayerMapServerLog=function(c){a.info("loadLayerMapServerLog");b.aLayerTestTabs.mapserver_log.loaded&&!0!==c||(z({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/vm4ms/layers/"+g.sId+"/MapServerLog",scope:b,success:function(a){if(1==a.data.status)a=g.extractWebServiceData("layers",a.data)[0],b.aLayerTestTabs.mapserver_log.file_content=a.log_file_content;
else{var c={className:"modal-danger"};null!=a.data.errorMessage&&(c.message=a.data.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",c)}}}),b.aLayerTestTabs.mapserver_log.loaded=!0)};b.loadLayerMapFile=function(c){a.info("loadLayerMapFile");b.aLayerTestTabs.map_file.loaded&&!0!==c||(z({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/vm4ms/Layers/"+ +g.sId+"/MapFile/",params:{ms_layer_id:g.sId,creation:!1},scope:b,success:function(a){if(1==a.data.status)a=g.extractWebServiceData("layers",
a.data)[0],b.oMapFileCodeMirrorEditor.setValue(a.map_file_content);else{var c={className:"modal-danger"};null!=a.data.errorMessage&&(c.message=a.data.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",c)}}}),b.aLayerTestTabs.map_file.loaded=!0)};h=new FormData;h.append("ms_layer_id",g.sId);if("undefined"!=typeof g.oFormValues[g.sFormDefinitionName]){m=g.oFormValues[g.sFormDefinitionName].layer_login;var p=g.oFormValues[g.sFormDefinitionName].layer_password;null!=m&&null!=p&&(h.append("user_login",
m),h.append("user_password",p))}z({method:"POST",url:f.web_server_name+"/"+f.services_alias+"/vm4ms/Layers/MapFile",data:h,scope:b,success:function(a){if(1==a.data.status){var c=g.extractWebServiceData("layers",a.data)[0],d=f.ms_cgi_url+"/test/"+c.map_file_hash+"_"+c.name;b.$root.getCapabilities(d,{showErrorMessage:!1}).then(function(a){null!=a?(b.oGetCapabilities=a,b.oGetCapabilities.service_url=d,"undefined"!=typeof c.layers_sources&&(b.oGetCapabilities.layers_sources=c.layers_sources),b.testLayerWithMapServer()):
e(function(){document.querySelector(".layer-tests .nav-tabs > li:nth-child(1)").style.display="none";document.querySelector(".layer-tests .nav-tabs > li:nth-child(2)").style.display="none";document.querySelector(".layer-tests .nav-tabs > li > a[aria-controls='layer_mapserver_log']").click()})})}else{delete b.oGetCapabilities;b.clearLayerTestsTabs();b.aLayerTestTabs.openlayers_test.loaded=!1;b.aLayerTestTabs.maplayer_test.loaded=!1;var h={className:"modal-danger"};null!=a.data.errorMessage&&(h.message=
a.data.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",h)}}})};u.$x.$inject="$log $scope $templateRequest $compile $timeout propertiesSrvc envSrvc sessionSrvc formSrvc modesSrvc".split(" ");u.module.controller("layerTestsCtrl",u.$x);u.uC=function(){return{restrict:"A",controller:"wmsServiceTestsCtrl",controllerAs:"ctrl",scope:!0,link:function(a,b){b[0].querySelector(".tab-content").style.height="calc(100% - 46px)";b=CodeMirror.fromTextArea(document.getElementById("wms_service_tests_get_capabilities_textarea"),{lineNumbers:!1,mode:"xml",readOnly:"true",indentUnit:4});a.aWmsServiceTestTabs.get_capabilities.oCodeMirrorEditor=b;b.setSize("100%","100%");a.showWmsServiceGetCapabilities();b=CodeMirror.fromTextArea(document.getElementById("wms_service_tests_wms_service_map_file_textarea"),
{lineNumbers:!0,mode:"map",indentUnit:4,readOnly:"true"});a.aWmsServiceTestTabs.map_file.oCodeMirrorEditor=b;b.setSize("100%","100%");a.$on("$destroy",function(){"undefined"!=typeof a.aEventKey&&0<a.aEventKey.length&&(Hd(a.aEventKey),a.aEventKey.length=0)})}}};u.module.directive("appWmsServiceTests",u.uC);
u.fw=function(a,b,c,d){return{replace:!0,link:function(e,f){c.sId==d.private_wms_service&&a("templates/formTpl.html").then(function(a){b($(f).html(a).contents())(e);var c=e.$root.$on("formExtracted",function(){c();f[0].parentNode.parentNode.firstChild.style.height="Calc(100% - 60px)"})})}}};u.fw.$inject=["$templateRequest","$compile","envSrvc","propertiesSrvc"];u.module.directive("appWmsServiceTestsConnectionForm",u.fw);u.kC=function(){return{restrict:"A",controller:"layerTestsCtrl",controllerAs:"ctrl",scope:!0,link:function(a,b){document.querySelector(".layer-test-dialog-modal-window .bootbox-body").style.height="calc(100% - 3px)";b[0].querySelector(".tab-content").style.height="calc(100% - 46px)";a.oMapFileCodeMirrorEditor=CodeMirror.fromTextArea(document.getElementById("layer_map_file_textarea"),{lineNumbers:!0,mode:"map",indentUnit:4,readOnly:"true"});a.oMapFileCodeMirrorEditor.setSize("100%","100%");a.$on("$destroy",
function(){"undefined"!=typeof a.aEventKey&&0<a.aEventKey.length&&(Hd(a.aEventKey),a.aEventKey.length=0)})}}};u.module.directive("appLayerTests",u.kC);u.xy=function(a,b,c,d,e,f){a.info("initMapServerSymbols");b.loadMapServerSymbols=function(){a.info("loadMapServerSymbols");z({method:"GET",url:e.web_server_name+"/"+e.services_alias+"/vm4ms/mapserver/Symbols",scope:b,success:function(a){if(1==a.data.status){var c=f.extractWebServiceData("mapserver",a.data)[0],c=angular.copy(c.symbols_content);c.forEach(function(a,b){a.definition.forEach(function(a,d){c[b].definition[d]="<span>"+a.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;")+"</span>"})});
b.oMapServerSymbols=c}else{var d={className:"modal-danger"};null!=a.data.errorMessage&&(d.message=a.data.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",d)}}})};b.trustAsHtml=function(a){return d.trustAsHtml(a)};b.loadMapServerSymbols()};u.xy.$inject="$log $scope $timeout $sce propertiesSrvc envSrvc sessionSrvc".split(" ");u.module.controller("mapServerSymbolsCtrl",u.xy);u.oC=function(){return{restrict:"A",controller:"mapServerSymbolsCtrl",controllerAs:"ctrl",scope:!0}};u.module.directive("appMapServerSymbols",u.oC);u.nC=function(){return{replace:!0,link:function(a,b){a.$index&&$(b).parent().find(".collapse").collapse("hide")}}};u.module.directive("appMapServerSymbolsCollapse",u.nC);u.on("appMainDrtvLoaded",function(){u.ew=function(a){return{link:function(b,c,d){var e=d.$observe("appWmsServiceDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP},content:function(){return b.row.entity[b.col.field]},
placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};u.ew.$inject=["$translate"];u.compileProvider.directive("appWmsServiceDescriptionColumn",u.ew);angular.element(u.f).scope().beforeSendingLayerForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.Pb).injector().get(["$q"]),c=angular.element(u.f).injector().get(["envSrvc"]),d=angular.element(u.f).injector().get(["propertiesSrvc"]);
a.info("beforeSendingLayerForm");var e=this,f=b.defer(),a=f.promise;z({method:"GET",url:d.web_server_name+"/"+d.services_alias+"/vm4ms/layerconnections/"+c.oFormValues[c.sFormDefinitionName].connection_id.selectedOption.value,scope:e,success:function(a){if(1==a.data.status)if(!1===c.oFormValues[c.sFormDefinitionName].private_connection&&!0===c.extractWebServiceData("layerconnections",a.data)[0]["private"]){var b={className:"modal-warning",message:"FORM_PRIVATE_CONNECTION_TOOLTIP_CONTENT_VM4MS_VM4MS_LAYER",
callback:function(a){a?f.resolve():f.reject()}};e.modalWindow("confirm","FORM_PRIVATE_CONNECTION_TOOLTIP_TITLE_VM4MS_VM4MS_LAYER",b)}else f.resolve();else b={className:"modal-danger",buttons:{ok:{label:"OK",className:"btn-default"}}},null!=a.data.errorMessage&&(b.message=a.data.errorMessage),e.modalWindow("alert","REQUEST_ERROR",b)}});return a};angular.element(u.f).scope().testVm4msLayer=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.X).injector().get(["$compile"]),
c=angular.element(u.X).injector().get(["$templateRequest"]),d=angular.element(u.f).injector().get(["envSrvc"]),e=angular.element(u.f).injector().get(["formSrvc"]),f=angular.element(u.f).injector().get(["propertiesSrvc"]);a.info("testVm4msLayer");var g=this;d.oFormValues[d.sFormDefinitionName].create_ws_map_file="false";d.oFormValues[d.sFormDefinitionName].test_layer=!0;var a=e.getFormData(d.sFormDefinitionName),h=d.oFormDefinition[d.sFormDefinitionName].name;angular.element("form[name='"+h+"']").scope()[h].appFormSubmitted=
!1;g.$root.sendSimpleForm(void 0,a).then(function(a){d.oFormValues[d.sFormDefinitionName].create_ws_map_file="true";d.oFormValues[d.sFormDefinitionName].test_layer=!1;if(a){var h;null!=f.test_wms_service&&""!=f.test_wms_service?null!=f.ms_cgi_url&&""!=f.ms_cgi_url||(h="ERROR_MS_CGI_URL_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG"):h="ERROR_TEST_WMS_SERVICE_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG";if("undefined"==typeof h){a=!0;h=d.oFormValues[d.sFormDefinitionName].layer_login;var k=d.oFormValues[d.sFormDefinitionName].layer_password,
t=d.oFormValues[d.sFormDefinitionName].private_connection,v=e.getFormElementDefinition("layer_login",d.sFormDefinitionName,d.oFormDefinition),w=e.getFormElementDefinition("layer_password",d.sFormDefinitionName,d.oFormDefinition);t&&(document.getElementById(v.id).parentNode.parentNode.parentNode.className="",document.getElementById(w.id).parentNode.parentNode.parentNode.className="",null!=h&&""!=h||null!=k&&""!=k)&&(null!=h&&""!=h||!t||(document.getElementById(v.id).parentNode.parentNode.parentNode.className=
"has-error",a=!1),null!=k&&""!=k||!t||(document.getElementById(w.id).parentNode.parentNode.parentNode.className="has-error",a=!1));a&&(a={className:"dialog-modal-window layer-test-dialog-modal-window",message:'<div id="layer_test_container" class="layer_test_container"></div>'},g.$root.modalWindow("dialog","FORM_MAP_SERVER_MODAL_TITLE_VM4MS_VM4MS_LAYER_DEFINITION",a).then(function(a){a[0].querySelector(".modal-title").innerHTML+=d.oFormValues[d.oSelectedObject.name+"_general_"+d.sMode+"_form"].name;
var e=document.querySelector("body").clientHeight-50;a[0].querySelector(".modal-dialog").style.width=document.querySelector("body").clientWidth-50+"px";a[0].querySelector(".modal-dialog").style.height=e+"px";a[0].querySelector(".modal-header").style.height="56px";a[0].querySelector(".modal-body").style.height=e-56-4+"px";c("modules/vm4ms/template/layerTestsTpl.html").then(function(a){b($("#layer_test_container").html(a).contents())(g)})}))}else a={className:"modal-danger",message:h},g.modalWindow("dialog",
"REQUEST_ERROR",a)}})};angular.element(u.f).scope().showAddLayersToWmsServiceModalWindow=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.X).injector().get(["$compile"]),c=angular.element(u.X).injector().get(["$templateRequest"]),d=angular.element(u.X).injector().get(["$translate"]),e=angular.element(u.f).injector().get(["envSrvc"]),f=angular.element(u.X).injector().get(["uiGridConstants"]),g=angular.element(u.f).injector().get(["modesSrvc"]),h=angular.element(u.f).injector().get(["propertiesSrvc"]);
a.info("showAddLayersToWmsServiceModalWindow");var k=this.$new();g.addScopeToObject(e.oSelectedObject.name,e.oSelectedMode.mode_id,k);var m=g.getObject(e.oSelectedObject.name,g.getMode(e.oSelectedMode.mode_id)),p=e.sMode,t=e.sSelectedGridOptionsName;e.oSelectedObject={actions:[],columns:[],mode_id:m.mode_id,name:m.name+"_available_layers",ressource_id:"vm4ms/publiclayers",sections:"",template_name:"",sorted_by:"name",sorted_dir:"ASC"};e.sMode="search";k.sSelectedObjectName=e.oSelectedObject.name;
k.gridOptions={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:h.rows_per_page,enableColumnMenus:!1,enableColumnResizing:!0,paginationPageSizes:[10,20,50,100],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!1,appHeaderOptionBar:!1,appLoadGridData:!0,appGridTitle:"TITLE_GRID_AVAILABLE_LAYERS_VM4MS_PUBLIC_WMS_SERVICE_LAYERS",appResizeGrid:!0,appFooter:!0,appShowPagination:!0,appActions:[]};d(["FORM_LAYER_ID_VM4MS_VM4MS_LAYER",
"FORM_LAYER_TITLE_VM4MS_VM4MS_LAYER","FORM_LAYER_NAME_VM4MS_VM4MS_LAYER"]).then(function(a){k.gridOptions.columnDefs=[{name:a.FORM_LAYER_ID_VM4MS_VM4MS_LAYER,displayName:a.FORM_LAYER_ID_VM4MS_VM4MS_LAYER,field:"ms_layer_id",width:40,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vm4ms_wms_service_layers_"+e.oSelectedObject.name+"_layer_id"},{name:a.FORM_LAYER_NAME_VM4MS_VM4MS_LAYER,displayName:a.FORM_LAYER_NAME_VM4MS_VM4MS_LAYER,field:"name",width:200,
enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vm4ms_wms_service_layers_"+e.oSelectedObject.name+"_name",sort:{direction:f.ASC,ignoreSort:!0,priority:0}},{name:a.FORM_LAYER_TITLE_VM4MS_VM4MS_LAYER,displayName:a.FORM_LAYER_TITLE_VM4MS_VM4MS_LAYER,field:"title",width:300,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vm4ms_wms_service_layers_"+e.oSelectedObject.name+"_title"}]});"display"!=e.sMode&&d(["BTN_ADD_LAYERS_VM4MS_PUBLIC_WMS_SERVICE_LAYERS"]).then(function(a){k.gridOptions.appActions=
[{label:a.BTN_ADD_LAYERS_VM4MS_PUBLIC_WMS_SERVICE_LAYERS,name:k.sSelectedObjectName+"_add_layer_btn",event:"addLayersToWmsService()"}]});a=e.oGridOptions[e.sSelectedGridOptionsName].data;if(0<a.length){d=0;for(g=[];d<a.length;)g.push(a[d].ms_layer_id),d++;e.oSelectedObject.filter={relation:"AND",operators:[{column:"ms_layer_id",compare_operator:"NOT IN",value:g}]}}var v="container_"+e.oSelectedObject.name+"_available_layers";k.modalWindow("dialog",null,{className:"dialog-modal-window dialog-modal-window-workspace-list dialog-modal-window-available-layers",
message:'<div id="'+v+'" class="col-xs-12"></div>'}).then(function(a){$(a).on("shown.bs.modal",function(){var a=document.querySelector(".dialog-modal-window-available-layers > .modal-dialog");a.className+=" modal-lg";c("templates/workspaceListTpl.html").then(function(a){b($("#"+v).html(a).contents())(k)})});$(a).on("hide.bs.modal",function(){e.oSelectedObject=m;e.sMode=p;e.sSelectedGridOptionsName=t;k.$root.refreshGrid(k.$root.gridApi[e.sSelectedGridOptionsName].grid.appScope,e.oGridOptions[e.sSelectedGridOptionsName])})})};
angular.element(u.f).scope().addLayersToWmsService=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$translate"]),c=angular.element(u.f).injector().get(["envSrvc"]),d=angular.element(u.f).injector().get(["propertiesSrvc"]);a.info("addLayersToWmsService");var e=this,a={wmsservice_id:c.sId},f=e.$root.gridApi[c.sSelectedGridOptionsName].selection.getSelectedRows();if(0<f.length){for(var g=0,h=[];g<f.length;)h.push(f[g].ms_layer_id),g++;a.wmsservice_ms_layers=
h.join("|");z({method:"PUT",url:d.web_server_name+"/"+d.services_alias+"/vm4ms/wmsservicelayers/"+c.sId,data:a,scope:e,success:function(a){0==a.data.status?e.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:a.data.errorMessage}):(bootbox.hideAll(),b("SUCCESSFUL_OPERATION").then(function(a){$.notify(a,"success")}),c.oSectionForm[c.oSelectedObject.name].sections.forEach(function(a){"tests"==a.name&&(a.bLoaded=!1)}))}})}};angular.element(u.f).scope().deleteWmsServiceLayers=function(){var a=
angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$translate"]),c=angular.element(u.f).injector().get(["envSrvc"]),d=angular.element(u.f).injector().get(["propertiesSrvc"]);a.info("deleteWmsServiceLayers");var e=this,a={wmsservice_id:c.sId},f=e.$root.gridApi[c.sSelectedGridOptionsName].selection.getSelectedRows();if(0<f.length){for(var g=0,h=[];g<f.length;)h.push(f[g].ms_layer_id),g++;a.idList=h.join("|");z({method:"DELETE",url:d.web_server_name+"/"+d.services_alias+
"/vm4ms/wmsservicelayers/"+c.sId,params:a,scope:e,success:function(a){0==a.data.status?e.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:a.data.errorMessage}):(e.$root.gridApi[c.sSelectedGridOptionsName].selection.clearSelectedRows(),e.refreshGrid(e,e.gridOptions),b("SUCCESSFUL_OPERATION").then(function(a){$.notify(a,"success")}),c.oSectionForm[c.oSelectedObject.name].sections.forEach(function(a){"tests"==a.name&&(a.bLoaded=!1)}))}})}};angular.element(u.f).scope().cloneVm4msLayer=
function(){var a=angular.element(u.X).injector().get(["$log"]),b=angular.element(u.X).injector().get(["envSrvc"]);a.info("cloneVm4msLayer");var c=angular.copy(b.oFormValues[b.sFormDefinitionName]);this.AddSectionForm();var d=this.$root.$on("formDefinitionLoaded",function(){d();c.name="";c.title="";b.oFormValues[b.sFormDefinitionName]=angular.copy(c)})};angular.element(u.f).scope().initVm4msLayerForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),
c=angular.element(u.f).injector().get(["envSrvc"]),d=angular.element(u.f).injector().get(["formSrvc"]),e=angular.element(u.f).injector().get(["propertiesSrvc"]);a.info("initVm4msLayerForm");var f=this;"insert"==c.sMode&&(document.querySelector("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name+"'] input[name='name']").addEventListener("input",function(){var a=this.value,b={a:"\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5",A:"\u00c0\u00c1\u00c2\u00c3\u00c4\u00c5",e:"\u00e8\u00e9\u00ea\u00eb",E:"\u00c8\u00c9\u00ca\u00cb",
i:"\u00ec\u00ed\u00ee\u00ef",I:"\u00cc\u00cd\u00ce\u00cf",o:"\u00f2\u00f3\u00f4\u00f5\u00f6\u00f8",O:"\u00d2\u00d3\u00d4\u00d5\u00d6\u00d8",u:"\u00f9\u00fa\u00fb\u00fc",U:"\u00d9\u00da\u00db\u00dc",y:"\u00ff",Y:"\u0178",c:"\u00e7",C:"\u00c7",n:"\u00f1",N:"\u00d1"};Object.keys(b).forEach(function(c){a=a.replace(new RegExp("["+b[c]+"]","g"),c)});c.oFormValues[c.sFormDefinitionName].name=a.replace(/[^a-zA-Z0-9]/g,"_");angular.element("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name).scope().$apply()}),
a=c.oFormValues[c.sFormDefinitionName],null!=a.definition&&""!=a.definition||(a.definition='LAYER\r\tNAME "{LAYER_NAME}"\r\tTYPE {LAYER_TYPE}\r\tSTATUS ON\r\t{CONNECTION}\r\tDATA "geom from {TABLE_SCHEMA}.{TABLE_NAME} USING SRID={SRID} USING UNIQUE {TABLE_ID}"\r\tDEBUG 0\r\r\t{COORDSYS}\r\r\t{METADATA}\r\r\tCLASS\r\t\tNAME "{LAYER_NAME}"\r\t\tSTYLE\r\t\t\tSYMBOL "circle"\r\t\t\tSIZE 15\r\t\t\tOUTLINECOLOR 0 0 0\r\t\t\tCOLOR 204 204 204\r\t\t\tWIDTH 2\r\t\tEND\r\tEND\rEND'));var g=b.$on("formExtracted",
function(){function a(a){null!=a&&""!=a&&z({method:"GET",url:e.web_server_name+"/"+e.services_alias+"/vm4ms/layerconnections/"+a,scope:f,success:function(a){if(1==a.data.status){a=c.extractWebServiceData("layerconnections",a.data)[0];null!=a.server||(a.server=e.server);null!=a.port||(a.port=e.port);null!=a.database||(a.database=e.database);f.oLayerConnection=angular.copy(a);var d={order_by:"schemaname",server:a.server,port:a.port,database:a.database,schema:"pg_catalog",table:"pg_tables",sort_order:"ASC",
attributs:"schemaname",distinct:!0};null!=a.user&&(d.login=a.user);null!=a.password&&(d.password=a.password);b.setOptionsFromWebService("tableschema","vitis/genericquerys",d)}}})}g();var k=c.oFormValues[c.sFormDefinitionName].connection_id.selectedOption.value;isNaN(k)||a(k);k=d.getFormElementDefinition("connection_id",c.sFormDefinitionName);document.getElementById(k.id).addEventListener("change",function(){a(this.value)});k=document.querySelector("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name+
"']");k.className+=" form-vm4ms-layer-general";var k=document.querySelector(".form-row-layer-palette > div > div > div > div"),m=document.createElement("div");m.id=c.sFormDefinitionName+"_palette";m.className="input-group colorpicker-component vm4ms-layer-palette";m.innerHTML='<input type="text" name="color" value="#00AABB" class="form-control"><span class="input-group-addon"><i></i></span>';k.appendChild(m);$(m).colorpicker({format:"hex"});var p=document.querySelector("#container_section_"+c.oSelectedObject.name+
"_general > div");f.iCodeMirrorDefinitionHeight=parseInt(document.querySelector("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name+"'] .CodeMirror").style.height);m=document.createElement("button");m.id=c.sFormDefinitionName+"layer_definition_full_screen_icon";m.className="btn btn-xs btn-primary layer-definition-full-screen-icon";m.type="button";m.innerHTML='<span class="glyphicon glyphicon-fullscreen"></span>';m.setAttribute("aria-label","Left Align");k.appendChild(m);f.bCodeMirrorDefinitionFullScreen=
!1;m.addEventListener("click",function(){var a;f.bCodeMirrorDefinitionFullScreen?a=f.iCodeMirrorDefinitionHeight:(a=document.getElementById("container_section_"+c.oSelectedObject.name+"_general").clientHeight,null!=document.querySelector(".form-row-layer-btn")&&(a-=parseInt(document.querySelector(".form-row-layer-btn").offsetHeight)),a-=parseInt(document.querySelector(".form-row-layer-palette").offsetHeight),a-=parseInt(document.querySelector(".form-row-layer-definition").offsetHeight),a=f.iCodeMirrorDefinitionHeight+
(a-20));f.bCodeMirrorDefinitionFullScreen=!f.bCodeMirrorDefinitionFullScreen;var b=document.querySelector("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name+"'] .CodeMirror");b.style.height=a+"px";p.scrollTop=p.scrollHeight-p.clientHeight;b.CodeMirror.refresh()},!1);k=c.oFormValues[c.sFormDefinitionName];!0===k.private_connection&&angular.element(document.getElementById("container_mode_"+c.oSelectedMode.mode_id).querySelectorAll(".section-form-section")[1]).off("click");if("update"==c.sMode){var m=
d.getFormElementDefinition("layer_login",c.sFormDefinitionName),t=d.getFormElementDefinition("layer_password",c.sFormDefinitionName);!1===k.private_connection?(m.visible=!1,t.visible=!1):(m.visible=!0,t.visible=!0,document.querySelector(".form-row-layer-palette > div:last-child").style.bottom="80px");k=angular.element("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name).scope();k.$broadcast("$$rebind::refresh");k.$apply()}})};angular.element(u.f).scope().displayMapServerSymbolsModal=function(){var a=
angular.element(u.f).injector().get(["$log"]),b=angular.element(u.X).injector().get(["$compile"]),c=angular.element(u.X).injector().get(["$templateRequest"]);a.info("displayMapServerSymbolsModal");var d=this;d.$root.modalWindow("dialog","FORM_MAP_SERVER_SYMBOLS_MODAL_TITLE_VM4MS_VM4MS_LAYER",{className:"dialog-modal-window dialog-modal-window-mapserver-symbols",message:'<div id="mapserver_symbols_container" class="mapserver-symbols-container"></div>'}).then(function(a){var e=document.querySelector("body").clientHeight-
50;a[0].querySelector(".modal-dialog").style.width=parseInt(document.querySelector("body").clientWidth/2)+"px";a[0].querySelector(".modal-dialog").style.height=e+"px";a[0].querySelector(".modal-header").style.height="56px";a[0].querySelector(".modal-body").style.height=e-56-4+"px";c("modules/vm4ms/template/mapServerSymbolsTpl.html").then(function(a){b($("#mapserver_symbols_container").html(a).contents())(d)})})};angular.element(u.f).scope().displayMapServerFontsModal=function(){var a=angular.element(u.f).injector().get(["$log"]),
b=angular.element(u.X).injector().get(["$compile"]),c=angular.element(u.X).injector().get(["$templateRequest"]),d=angular.element(u.f).injector().get(["propertiesSrvc"]),e=angular.element(u.f).injector().get(["envSrvc"]);a.info("displayMapServerFontsModal");var f=this;f.$root.modalWindow("dialog","FORM_MAP_SERVER_FONTS_MODAL_TITLE_VM4MS_VM4MS_LAYER",{className:"dialog-modal-window dialog-modal-window-mapserver-fonts",message:'<div id="mapserver_fonts_container" class="mapserver-fonts-container"></div>'}).then(function(a){var g=
document.querySelector("body").clientHeight-50;a[0].querySelector(".modal-dialog").style.width=parseInt(document.querySelector("body").clientWidth/2)+"px";a[0].querySelector(".modal-dialog").style.height=g+"px";a[0].querySelector(".modal-header").style.height="56px";a[0].querySelector(".modal-body").style.height=g-56-4+"px";z({method:"GET",url:d.web_server_name+"/"+d.services_alias+"/vm4ms/mapserver/Fonts",scope:f,success:function(a){if(1==a.data.status)f.oMapServerFonts=e.extractWebServiceData("mapserver",
a.data)[0].fonts,c("modules/vm4ms/template/mapServerFontsTpl.html").then(function(a){b($("#mapserver_fonts_container").html(a).contents())(f)});else{var d={className:"modal-danger"};null!=a.data.errorMessage&&(d.message=a.data.errorMessage);f.$root.modalWindow("alert","REQUEST_ERROR",d)}}})})};angular.element(u.f).scope().loadPrivateWmsServiceLayers=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["envSrvc"]),c=angular.element(u.X).injector().get(["$translate"]);
a.info("loadPrivateWmsServiceLayers");var d=this,e=b.oSelectedObject.sorted_by,f=b.oSelectedObject.sorted_dir;b.oSelectedObject.sorted_by="name";b.oSelectedObject.sorted_dir="ASC";c("FORM_GRID_TITLE_VM4MS_PRIVATE_WMS_SERVICE_LAYERS").then(function(a){d.$root.loadSectionList({appHeader:!0,appHeaderSearchForm:!1,appGridTitle:a})});var g=d.$root.$on("workspaceListTplCompiled",function(){g();b.oSelectedObject.sorted_by=e;b.oSelectedObject.sorted_dir=f})};angular.element(u.f).scope().loadPublicWmsServiceLayers=
function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["envSrvc"]),c=angular.element(u.X).injector().get(["$translate"]);a.info("loadPublicWmsServiceLayers");var d=this,e=b.oSelectedObject.sorted_by,f=b.oSelectedObject.sorted_dir;b.oSelectedObject.sorted_by="name";b.oSelectedObject.sorted_dir="ASC";c("FORM_GRID_TITLE_VM4MS_PUBLIC_WMS_SERVICE_LAYERS").then(function(a){d.$root.loadSectionList({appHeader:!0,appHeaderSearchForm:!1,appGridTitle:a,oFilter:{relation:"AND",
operators:[{column:"wmsservice_id",compare_operator:"=",value:b.sId}]}})});var g=d.$root.$on("workspaceListTplCompiled",function(){g();b.oSelectedObject.sorted_by=e;b.oSelectedObject.sorted_dir=f})};angular.element(u.f).scope().setOptionsFromWebService=function(a,b,c){var d=angular.element(u.f).injector().get(["$log"]),e=angular.element(u.Pb).injector().get(["$q"]),f=angular.element(u.f).injector().get(["envSrvc"]),g=angular.element(u.f).injector().get(["propertiesSrvc"]),h=angular.element("form[name='"+
f.oFormDefinition[f.sFormDefinitionName].name).scope();d.info("setOptionsFromWebService");var k=this,m=e.defer(),d=m.promise,p=b.split("/");p.shift();z({method:"GET",url:g.web_server_name+"/"+g.services_alias+"/"+b,params:c,scope:k,success:function(b){if(0!=b.data.status)null!=h.oFormValues[f.sFormDefinitionName][a]||(h.oFormValues[f.sFormDefinitionName][a]={}),h.oFormValues[f.sFormDefinitionName][a].options=[],f.extractWebServiceData(p[0],b.data).forEach(function(b){h.oFormValues[f.sFormDefinitionName][a].options.push({value:b[Object.keys(b)[0]],
label:b[Object.keys(b)[0]]})}),m.resolve();else{h.oFormValues[f.sFormDefinitionName][a].options=[];var c={className:"modal-danger",buttons:{ok:{label:"OK",className:"btn-default"}}};null!=b.data.errorMessage&&(c.message=b.data.errorMessage);k.modalWindow("alert","REQUEST_ERROR",c)}}});return d};angular.element(u.f).scope().loadVm4msConfig=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.X).injector().get(["envSrvc"]),c=angular.element(u.f).injector().get(["propertiesSrvc"]);
a.info("loadVm4msConfig");"string"==typeof c.test_wms_service_default_content&&(c.test_wms_service_default_content=c.test_wms_service_default_content.replace(/\\+"/g,'"'));angular.element(u.f).scope().setPropertiesFormValues(["mapserver_alias","test_wms_service"]);a=b.oSelectedObject.name;this.oFormRequestParams={sUrl:"modules/vm4ms/forms/"+b.oSelectedMode.mode_id+"/"+a+"_"+b.oSectionForm[a].sections[b.oSectionForm[a].iSelectedSectionIndex].name+".json"}};angular.element(u.f).scope().setLayerTableOptions=
function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["envSrvc"]);a.info("setLayerTableOptions");a=b.oFormValues[b.sFormDefinitionName].tableschema.selectedOption.value;null!=a&&""!=a&&(a={order_by:"table_name",server:this.oLayerConnection.server,port:this.oLayerConnection.port,database:this.oLayerConnection.database,schema:a,sort_order:"ASC",attributs:"table_name",distinct:!0},null!=this.oLayerConnection.user&&(a.login=this.oLayerConnection.user),null!=
this.oLayerConnection.password&&(a.password=this.oLayerConnection.password),this.$root.setOptionsFromWebService("tablename","vitis/genericquerys",a))};angular.element(u.f).scope().setLayerIdFieldOptions=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["envSrvc"]);a.info("setLayerIdFieldOptions");a=b.oFormValues[b.sFormDefinitionName].tablename.selectedOption.value;null!=a&&""!=a&&(b={order_by:"column_name",server:this.oLayerConnection.server,port:this.oLayerConnection.port,
database:this.oLayerConnection.database,schema:b.oFormValues[b.sFormDefinitionName].tableschema.selectedOption.value,table:a,sort_order:"ASC",attributs:"column_name",distinct:!0},null!=this.oLayerConnection.user&&(b.login=this.oLayerConnection.user),null!=this.oLayerConnection.password&&(b.password=this.oLayerConnection.password),this.$root.setOptionsFromWebService("tableidfield","vitis/genericquerys/workspace/columns",b))};angular.element(u.f).scope().afterSendingWmsServiceForm=function(){var a=
angular.element(u.f).injector().get(["$log"]),b=angular.element(u.X).injector().get(["envSrvc"]);a.info("afterSendingWmsServiceForm");b.oSectionForm[b.oSelectedObject.name].sections.forEach(function(a){"tests"==a.name&&(a.bLoaded=!1)})};angular.element(u.f).scope().displayLayerLoadingError=function(a){function b(){d(["ERROR_LOAD_IMAGE_OPEN_LAYERS_M4MS_WMS_SERVICE_TESTS_MULTIPLE_INFO"]).then(function(a){a=a.ERROR_LOAD_IMAGE_OPEN_LAYERS_M4MS_WMS_SERVICE_TESTS_MULTIPLE_INFO;var b=0,c;for(c in f.oVM4MSLayerLoadingErrorLayers)a+=
'<div class="">',a+="<li>",a+='<a data-toggle="collapse" href="#ERROR_LOAD_IMAGE_OPEN_LAYERS_M4MS_WMS_SERVICE_TESTS_MULTIPLE_INFO_'+b+'">',a+=f.oVM4MSLayerLoadingErrorLayers[c].layer,a+="</a>",a+="</li>",a+="</div>",a+='<div id="ERROR_LOAD_IMAGE_OPEN_LAYERS_M4MS_WMS_SERVICE_TESTS_MULTIPLE_INFO_'+b+'" class="collapse">',a+='<div class="">',a+=null!=f.oVM4MSLayerLoadingErrorLayers[c].errorMessage?f.oVM4MSLayerLoadingErrorLayers[c].errorMessage:"-",a+="</div>",a+="</div>",b++;f.VM4MSLayerLoadingErrorModal.find(".bootbox-body").html(a)})}
var c=angular.element(u.f).injector().get(["$log"]),d=angular.element(u.f).injector().get(["$translate"]),e=angular.element(u.f).injector().get(["propertiesSrvc"]);c.info("displayLayerLoadingError");var f=this;if("undefined"==typeof f.oVM4MSLayerLoadingErrorLayers||null==f.oVM4MSLayerLoadingErrorLayers)f.oVM4MSLayerLoadingErrorLayers={};if(ha(f.oVM4MSLayerLoadingErrorLayers)){var g=c=a.target.Cc.LAYERS;"undefined"==typeof c&&(c="fr"==e.language?"Couche sans nom":"Unnamed layer",g=c+a.target.$y);null!=
f.oVM4MSLayerLoadingErrorLayers[g]||(f.oVM4MSLayerLoadingErrorLayers[g]={layer:c,url:a.Lb.Me,errorMessage:null})}else f.oVM4MSLayerLoadingErrorLayers={};null==f.VM4MSLayerLoadingErrorModal&&(f.VM4MSLayerLoadingErrorModal={},d(["ERROR_LOAD_IMAGE_OPEN_LAYERS_M4MS_WMS_SERVICE_TESTS_MULTIPLE"]).then(function(a){angular.element(u.f).scope().$root.modalWindow("dialog",a.ERROR_LOAD_IMAGE_OPEN_LAYERS_M4MS_WMS_SERVICE_TESTS_MULTIPLE,{className:"modal-danger",message:"",appCallback:function(a,b){f.VM4MSLayerLoadingErrorModal=
b;b[0].onblur=function(){f.oVM4MSLayerLoadingErrorLayers=null;f.VM4MSLayerLoadingErrorModal=null}}})}));setTimeout(function(){if(null!=f.VM4MSLayerLoadingErrorModal)for(var a in f.oVM4MSLayerLoadingErrorLayers)null!=f.oVM4MSLayerLoadingErrorLayers[a].errorMessage||z({method:"GET",url:f.oVM4MSLayerLoadingErrorLayers[a].url,scope:f,responseType:"text",success:angular.bind(this,function(a,b,c){if(r(c.data)){var d="";(new DOMParser).parseFromString(c.data,"text/xml").querySelectorAll("ServiceException").forEach(function(a){d+=
a.textContent});f.oVM4MSLayerLoadingErrorLayers[a].errorMessage=d;b()}},a,b)})})};u.appVm4msConnectionTypeColumn=function(){return{link:function(a,b,c){var d=c.$observe("appVm4msConnectionTypeColumn",function(){var c;a.row.entity[a.col.field]?c="icon-lock":a.row.entity[a.col.field]||(c="icon-unlocked");b[0].className="ui-grid-cell-contents ui-grid-cell-svg-icon "+c});a.$on("$destroy",function(){d()})}}};u.compileProvider.directive("appVm4msConnectionTypeColumn",u.appVm4msConnectionTypeColumn);u.appTestWmsServiceColumn=
function(a){return{link:function(b,c,d){var e=d.$observe("appTestWmsServiceColumn",function(){var d="";b.row.entity.wmsservice_id==a.test_wms_service&&(d="true-icon");c[0].className="ui-grid-cell-contents ui-grid-cell-svg-icon "+d});b.$on("$destroy",function(){e()})}}};u.appTestWmsServiceColumn.$inject=["propertiesSrvc"];u.compileProvider.directive("appTestWmsServiceColumn",u.appTestWmsServiceColumn);u.Bv=function(a){return{link:function(b,c,d){var e=d.$observe("appLayerTitleColumn",function(){null==
b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["TOOLTIP_TITLE_TITLE_VM4MS_VM4MS_LAYER"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.TOOLTIP_TITLE_TITLE_VM4MS_VM4MS_LAYER},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};u.Bv.$inject=
["$translate"];u.compileProvider.directive("appLayerTitleColumn",u.Bv);angular.element(u.f).scope().initVm4msConnectionForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["envSrvc"]);angular.element(u.f).injector().get(["$timeout"]);a.info("initVm4msConnectionForm");var c=this;document.querySelectorAll("form[name='"+b.oFormDefinition[b.sFormDefinitionName].name+"'] input[name='private']").forEach(function(a){a.addEventListener("click",function(){c.$root.setVm4msConnectionForm()})});
"update"===b.sMode&&(a=b.oFormValues[b.sFormDefinitionName],a.private_database=a.database,a.public_database=a.database);this.setVm4msConnectionForm()};angular.element(u.f).scope().setVm4msConnectionForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["envSrvc"]),c=angular.element(u.f).injector().get(["formSrvc"]);angular.element(u.f).injector().get(["$translate"]);angular.element(u.f).injector().get(["$timeout"]);a.info("setVm4msConnectionForm");
var a=angular.element("form[name='"+b.oFormDefinition[b.sFormDefinitionName].name).scope(),d=b.oFormValues[b.sFormDefinitionName],e=c.getFormElementDefinition("server",b.sFormDefinitionName),f=c.getFormElementDefinition("port",b.sFormDefinitionName),g=c.getFormElementDefinition("user",b.sFormDefinitionName),h=c.getFormElementDefinition("password",b.sFormDefinitionName),k=c.getFormElementDefinition("public_database",b.sFormDefinitionName),b=c.getFormElementDefinition("private_database",b.sFormDefinitionName);
!0===d["private"]?(null!=e&&(e.visible=!1),null!=f&&(f.visible=!1),null!=g&&(g.visible=!1),null!=h&&(h.visible=!1),null!=k&&(k.visible=!1),null!=b&&(b.visible=!0)):(null!=e&&(e.visible=!0),null!=f&&(f.visible=!0),null!=g&&(g.visible=!0),null!=h&&(h.visible=!0),null!=k&&(k.visible=!0),null!=b&&(b.visible=!1));a.$apply()};angular.element(u.f).scope().beforeSendingVm4msConnectionForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["envSrvc"]);a.info("beforeSendingVm4msConnectionForm");
a=b.oFormValues[b.sFormDefinitionName];!0===a["private"]?(a.database=a.private_database.selectedOption.value,a.server="",a.port="",a.user="",a.password=""):a.database=a.public_database};angular.element(u.f).scope().updateVm4msProperties=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),c=angular.element(u.f).injector().get(["$timeout"]),d=angular.element(u.f).injector().get(["envSrvc"]);a.info("updateVm4msProperties");var e=d.oFormValues[d.sFormDefinitionName],
f=e.test_wms_service_default_content;b.updateProperties("vm4ms");c(function(){e.test_wms_service_default_content=f})};angular.element(u.f).scope().activateVm4msLayers=function(a){var b=angular.element(u.f).injector().get(["$log"]),c=angular.element(u.f).injector().get(["$q"]),d=angular.element(u.f).injector().get(["envSrvc"]),e=angular.element(u.f).injector().get(["propertiesSrvc"]);b.info("activateVm4msLayers");"undefined"==typeof a&&(a=!0);var f=this,b=c.defer().promise,c={},g=f.$root.gridApi[f.sSelectedObjectName].selection.getSelectedRows();
if(0<g.length){var h;a?(a="activate",h="ERROR_ACTIVATE_VM4MS_VM4MS_LAYER"):(a="desactivate",h="ERROR_DESACTIVATE_VM4MS_VM4MS_LAYER");for(var k=0,m=[];k<g.length;)m.push(g[k][d.oSelectedObject.sIdField]),k++;c.idList=m.join("|");z({method:"PUT",url:e.web_server_name+"/"+e.services_alias+"/vm4ms/layers/"+a,data:c,scope:f,success:function(a){0==a.data.status?f.modalWindow("dialog",h,{className:"modal-danger",message:a.data.errorMessage}):(bootbox.hideAll(),f.$root.gridApi[f.sSelectedObjectName].pagination.raise.paginationChanged(1,
f.gridOptions.paginationPageSize))}})}else f.modalWindow("dialog","ERROR_NO_SELECTION_RESET_VM4MS_VM4MS_LAYER",{className:"modal-danger",appDuration:2E3});return b};angular.element(u.f).scope().desactivateVm4msLayers=function(){angular.element(u.f).injector().get(["$log"]).info("desactivateVm4msLayers");this.activateVm4msLayers(!1)}});u.on("appMainDrtvLoaded",function(){angular.element(u.f).scope().initAncControlForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),c=angular.element(u.f).injector().get(["envSrvc"]),d=angular.element(u.f).injector().get(["formSrvc"]);a.info("initAncControlForm");var e=b.$on("formExtracted",function(){e();var a=["controle_type",c.sMode+"_button"],g,h=[];if("search"==c.sMode)g={"BON FONCTIONNEMENT":"controle_ss_type des_date_control des_refus_visite cl_avis cl_classe_cbf cl_date_avis cl_auteur_avis cl_date_prochain_controle cl_facture".split(" "),
CONCEPTION:"dep_date_depot dep_dossier_complet cl_avis cl_date_avis cl_auteur_avis cl_date_prochain_controle cl_facture".split(" "),REALISATION:"des_date_control cl_avis cl_date_avis cl_auteur_avis cl_date_prochain_controle cl_facture".split(" ")},b.displayFormFields(a);else if(g={"BON FONCTIONNEMENT":"id_controle id_installation controle_ss_type des_date_control des_pers_control des_agent_control des_refus_visite des_date_installation des_date_recommande des_numero_recommande des_reamenage_terrain des_reamenage_immeuble des_real_trvx des_anc_ss_accord des_collecte_ep des_sep_ep_eu des_eu_nb_sortie des_eu_tes_regards des_eu_pente_ecoul des_eu_regars_acces des_eu_alteration des_eu_ecoulement des_eu_depot_regard des_commentaire Element_0 Element_4 Element_5 Element_7 Element_8".split(" "),
CONCEPTION:"id_controle id_installation dep_date_depot dep_liste_piece dep_dossier_complet dep_date_envoi_incomplet des_nature_projet des_concepteur car_surface_dispo_m2 car_permea car_valeur_permea car_hydromorphie car_prof_app car_nappe_fond car_terrain_innondable car_roche_sol car_dist_hab car_dist_lim_par car_dist_veget car_dist_puit des_collecte_ep des_sep_ep_eu Element_0 Element_2 Element_3 Element_5".split(" "),REALISATION:"id_controle id_installation des_date_control des_pers_control des_agent_control des_date_installation des_collecte_ep des_sep_ep_eu des_eu_nb_sortie des_eu_tes_regards des_eu_pente_ecoul Element_0 Element_5 Element_8 des_installateur element_7 des_commentaire".split(" ")},
"insert"==c.sMode){var k=c.oSelectedObject.aModeFilter;"object"==typeof k&&(c.oFormValues[c.sFormDefinitionName].id_installation.selectedOption.value=k.operators[0].value);b.displayFormFields(a)}else h="update"==c.sMode?g[c.oFormValues[c.sFormDefinitionName].controle_type.selectedOption.value]:g[c.oFormValues[c.sFormDefinitionName].controle_type],b.displayFormFields(h.concat(a));k=d.getFormElementDefinition("controle_type",c.sFormDefinitionName,c.oFormDefinition);document.getElementById(k.id).addEventListener("change",
function(){"undefined"!=typeof g[this.value]&&(h=g[this.value]);h=h.concat(a);b.displayFormFields(h)});k=c.oFormValues[c.sFormDefinitionName];null!=k.des_date_control&&(k.des_date_control=moment(k.des_date_control).format("L"));null!=k.des_date_installation&&(k.des_date_installation=moment(k.des_date_installation).format("L"));null!=k.des_date_recommande&&(k.des_date_recommande=moment(k.des_date_recommande).format("L"));null!=k.dep_date_depot&&(k.dep_date_depot=moment(k.dep_date_depot).format("L"));
null!=k.dep_date_envoi_incomplet&&(k.dep_date_envoi_incomplet=moment(k.dep_date_envoi_incomplet).format("L"))})};angular.element(u.f).scope().displayFormFields=function(a){var b=angular.element(u.f).injector().get(["$log"]),c=angular.element(u.f).injector().get(["envSrvc"]),d=angular.element(u.f).injector().get(["formSrvc"]),e=angular.element(u.f).injector().get(["externFunctionSrvc"]);b.info("displayFormFields");b=d.getAllFormElementDefinition(c.sFormDefinitionName,c.oFormDefinition);if(Array.isArray(b)){for(d=
0;d<b.length;d++)b[d].visible=-1==a.indexOf(b[d].name)?!1:!0;a=angular.element("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name).scope();a.$broadcast("$$rebind::refresh");a.$applyAsync();e.resizeWin()}};angular.element(u.f).scope().initAncInstallationForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),c=angular.element(u.f).injector().get(["envSrvc"]),d=angular.element(u.f).injector().get(["formSrvc"]),e=angular.element(u.f).injector().get(["propertiesSrvc"]);
a.info("initAncInstallationForm");var f=c.oFormValues[c.sFormDefinitionName];"insert"!=c.sMode&&(f.parcelle=f.id_parc);var g=b.$on("formExtracted",function(){g();var a=d.getFormElementDefinition("id_parc",c.sFormDefinitionName,c.oFormDefinition),k=angular.element("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name).scope();document.getElementById(a.id).addEventListener("change",function(){var a=this.value;z({method:"GET",url:e.web_server_name+"/"+e.services_alias+"/cadastreV2/fichedescriptiveparcelle/"+
a,scope:b,success:function(d){if(0!=d.data.status){f.parcelle=a;d=d.data.data;for(var g=Object.keys(d),h=0;h<g.length;h++)"string"==typeof d[g[h]]&&(d[g[h]]=d[g[h]].trim());f.parc_sup=d.sup_fiscale;f.parc_adresse=d.DVOILIB;f.code_postal=d.ID_COM;f.parc_commune=d.commune;z({method:"GET",url:e.web_server_name+"/"+e.services_alias+"/vitis/genericquerys/v_vmap_parcelle_proprietaire",params:{schema:"s_majic",table:"v_vmap_parcelle_proprietaire",filter:{relation:"AND",operators:[{column:"id_par",compare_operator:"=",
value:a}]},attributs:"prop_titre|prop_nom_prenom|prop_adresse|prop_code_postal|prop_commune"},scope:b,success:function(a){if(0!=a.data.status){if(a=c.extractWebServiceData("genericquerys",a.data)[0],"object"==typeof a){for(var d=Object.keys(a),e=0;e<d.length;e++)"string"==typeof a[d[e]]&&(a[d[e]]=a[d[e]].trim());f.prop_titre=a.dqualp;f.prop_nom_prenom=a.ddenom;f.prop_adresse=a.dlign4;f.prop_code_postal=a.dlign6.substr(0,a.dlign6.indexOf(" "));f.prop_commune=a.dlign6.substr(a.dlign6.indexOf(" "))}}else d=
{className:"modal-danger"},null!=a.data.errorMessage&&(d.message=a.data.errorMessage),b.modalWindow("alert","REQUEST_ERROR",d)}})}else g={className:"modal-danger"},null!=d.data.errorMessage&&(g.message=d.data.errorMessage),b.modalWindow("alert","REQUEST_ERROR",g)}});k.$apply()})})};angular.element(u.f).scope().initAncInstallationSuiviForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),c=angular.element(u.f).injector().get(["envSrvc"]);
a.info("initAncInstallationSuiviForm");var d=b.$on("formExtracted",function(){d();var a=c.oFormValues[c.sFormDefinitionName];a.create_date=moment(a.create_date).format("L");null!=a.maj_date&&(a.maj_date=moment(a.maj_date).format("L"));angular.element("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name).scope().$apply()})};angular.element(u.f).scope().initAncPretraitementForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),
c=angular.element(u.f).injector().get(["envSrvc"]),d=angular.element(u.f).injector().get(["formSrvc"]),e=angular.element(u.f).injector().get(["propertiesSrvc"]);a.info("initAncPretraitementForm");var f=b.$on("formExtracted",function(){f();var a=[c.sMode+"_button","id_pretraitement","id_installation","id_controle"],h,k=[];"search"!=c.sMode&&(h={"BON FONCTIONNEMENT":"tra_dist_hab ptr_im_puit ptr_adapte ptr_type_eau ptr_type ptr_volume ptr_marque ptr_materiau ptr_cloison ptr_commentaire ptr_im_distance ptr_im_acces ptr_et_degrad ptr_et_real ptr_vi_date ptr_vi_justi ptr_vi_entr ptr_vi_bord ptr_vi_dest ptr_vi_perc maj maj_date create create_date Element_0 Element_1 Element_2 Element_3 Element_4".split(" "),
CONCEPTION:"ptr_type ptr_volume ptr_marque ptr_materiau ptr_commentaire ptr_im_distance maj maj_date create create_date Element_0 Element_1 Element_4".split(" "),REALISATION:"ptr_type ptr_volume ptr_marque ptr_materiau ptr_commentaire ptr_im_distance ptr_im_hydrom maj maj_date create create_date Element_0 Element_4 ptr_pose ptr_adapte ptr_conforme_projet ptr_renforce ptr_verif_mise_en_eau ptr_type_eau ptr_im_dalle ptr_im_puit tra_dist_hab".split(" ")},"insert"==c.sMode?b.displayFormFields(a):(k=h[c.oFormValues[c.sFormDefinitionName].controle_type],
b.displayFormFields(k.concat(a))));k=d.getFormElementDefinition("id_controle",c.sFormDefinitionName,c.oFormDefinition);document.getElementById(k.id).addEventListener("change",function(){z({method:"GET",url:e.web_server_name+"/"+e.services_alias+"/anc/controles/"+this.value,scope:b,success:function(d){d=c.extractWebServiceData("controles",d.data)[0];b.displayFormFields(h[d.controle_type].concat(a))}})})}),a=c.oFormValues[c.sFormDefinitionName];null!=a.create_date&&(a.create_date=moment(a.create_date).format("L"));
null!=a.maj_date&&(a.maj_date=moment(a.maj_date).format("L"));null!=a.ptr_vi_date&&(a.ptr_vi_date=moment(a.ptr_vi_date).format("L"))};angular.element(u.f).scope().loadAncPretraitementsControl=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),c=angular.element(u.f).injector().get(["$translate"]),d=angular.element(u.f).injector().get(["envSrvc"]);a.info("loadAncPretraitementsControl");var e=d.oSelectedObject.sorted_by,f=d.oSelectedObject.sorted_dir,
g=d.oSelectedObject.edit_column,h=d.oSelectedObject.show_column;d.oSelectedObject.sIdField="id_controle";d.oSelectedObject.sorted_by="id_pretraitement";d.oSelectedObject.sorted_dir="ASC";d.oSelectedObject.edit_column="editModalSectionForm";d.oSelectedObject.show_column="showModalSectionForm";c(["GRID_TITLE_ANC_SAISIE_ANC_CONTROLE_CONTROLE_PRETRAITEMENT"]).then(function(a){b.loadSectionList({appHeader:!0,appHeaderSearchForm:!1,appGridTitle:a.GRID_TITLE_ANC_SAISIE_ANC_CONTROLE_CONTROLE_PRETRAITEMENT,
appShowActions:!0,appIdField:"id_pretraitement"})});var k=b.$on("workspaceListHeaderActionsAdded",function(a,b){k();d.oSelectedObject.sorted_by=e;d.oSelectedObject.sorted_dir=f;d.oSelectedObject.edit_column=g;d.oSelectedObject.show_column=h;for(a=0;a<b.appActions.length;a++)-1!=b.appActions[a].name.indexOf("_add")?b.appActions[a].event="addModalSectionForm()":-1!=b.appActions[a].name.indexOf("_delete")&&(b.appActions[a].event="DeleteSelection({'sIdField':'id_pretraitement'})")})};angular.element(u.f).scope().initAncControlDryToiletsForm=
function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),c=angular.element(u.f).injector().get(["envSrvc"]);a.info("initAncControlDryToiletsForm");var d=b.$on("formExtracted",function(){d();b.displayFormFields({"BON FONCTIONNEMENT":"ts_type_effluent ts_capacite_bac ts_nb_bac ts_coher_taille_util ts_aire_etanche ts_aire_abri ts_ventilation ts_cuve_etanche ts_val_comp ts_ruissel_ep ts_absence_nuisance ts_respect_regles ts_commentaires".split(" "),
CONCEPTION:["ts_type_effluent","ts_capacite_bac","ts_nb_bac","ts_val_comp","ts_commentaires"],REALISATION:"ts_conforme ts_type_effluent ts_capacite_bac ts_nb_bac ts_aire_etanche ts_aire_abri ts_ventilation ts_cuve_etanche ts_val_comp ts_commentaires".split(" ")}[c.oFormValues[c.sFormDefinitionName].controle_type].concat([c.sMode+"_button"]))})};angular.element(u.f).scope().initAncControlVentilationForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),
c=angular.element(u.f).injector().get(["envSrvc"]);a.info("initAncControlVentilationForm");var d=b.$on("formExtracted",function(){d();b.displayFormFields({"BON FONCTIONNEMENT":"vt_primaire vt_secondaire vt_prim_loc vt_prim_ht vt_prim_type_extract vt_second_loc vt_second_ht vt_second_diam vt_second_type_extract Element_0 Element_1 Element_2 vt_commentaire".split(" "),CONCEPTION:["vt_primaire","emplacement_vt_secondaire"],REALISATION:"vt_primaire vt_secondaire vt_prim_loc vt_prim_ht vt_prim_type_extract vt_second_loc vt_second_ht vt_second_diam vt_second_type_extract Element_0 Element_1 Element_2 vt_commentaire".split(" ")}[c.oFormValues[c.sFormDefinitionName].controle_type].concat([c.sMode+
"_button"]))})};angular.element(u.f).scope().loadAncTraitementsControl=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),c=angular.element(u.f).injector().get(["$translate"]),d=angular.element(u.f).injector().get(["envSrvc"]);a.info("loadAncTraitementsControl");var e=d.oSelectedObject.sorted_by,f=d.oSelectedObject.sorted_dir,g=d.oSelectedObject.edit_column,h=d.oSelectedObject.show_column;d.oSelectedObject.sorted_by="id_traitement";
d.oSelectedObject.sorted_dir="ASC";d.oSelectedObject.edit_column="editModalSectionForm";d.oSelectedObject.show_column="showModalSectionForm";d.oSelectedObject.sIdField="id_controle";c(["GRID_TITLE_ANC_SAISIE_ANC_CONTROLE_CONTROLE_TRAITEMENT"]).then(function(a){b.loadSectionList({appHeader:!0,appHeaderSearchForm:!1,appGridTitle:a.GRID_TITLE_ANC_SAISIE_ANC_CONTROLE_CONTROLE_TRAITEMENT,appShowActions:!0,appIdField:"id_traitement"})});var k=b.$on("workspaceListHeaderActionsAdded",function(a,b){k();d.oSelectedObject.sorted_by=
e;d.oSelectedObject.sorted_dir=f;d.oSelectedObject.edit_column=g;d.oSelectedObject.show_column=h;for(a=0;a<b.appActions.length;a++)-1!=b.appActions[a].name.indexOf("_add")?b.appActions[a].event="addModalSectionForm()":-1!=b.appActions[a].name.indexOf("_delete")&&(b.appActions[a].event="DeleteSelection({'sIdField':'id_traitement'})")})};angular.element(u.f).scope().initAncTraitementForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),
c=angular.element(u.f).injector().get(["envSrvc"]),d=angular.element(u.f).injector().get(["formSrvc"]),e=angular.element(u.f).injector().get(["propertiesSrvc"]);a.info("initAncTraitementForm");var f=b.$on("formExtracted",function(){f();var a=[c.sMode+"_button","id_traitement","id_controle","tra_type","id_installation"],h,k;if("search"!=c.sMode){h={"BON FONCTIONNEMENT":"tra_dist_hab tra_dist_lim_parc tra_dist_veget tra_dist_puit tra_regrep_mat tra_regrep_affl tra_regrep_equi tra_regbl_mat tra_regbl_affl tra_regcol_mat tra_regcol_affl maj maj_date create create_date Element_0 Element_1 Element_3 Element_4 Element_5 Element_6".split(" "),
CONCEPTION:"maj maj_date create create_date Element_0 Element_6".split(" "),REALISATION:"tra_dist_lim_parc tra_dist_veget tra_dist_puit tra_vm_grav_qual tra_vm_grav_ep tra_vm_geo_text tra_vm_bon_mat tra_regrep_mat tra_regrep_affl tra_regrep_equi tra_regrep_perf tra_regbl_mat tra_regbl_affl tra_regbl_hz tra_regbl_epand tra_regbl_perf tra_regcol_mat tra_regcol_affl tra_regcol_hz maj maj_date create create_date Element_0 Element_1 Element_2 Element_3 Element_4 Element_5 Element_6 tra_dist_hab tra_vm_racine tra_vm_humidite tra_vm_imper tra_vm_geogrille tra_vm_tuy_perf tra_vm_sab_qual tra_vm_sab_ep tra_vm_geomembrane".split(" ")};
var m=function(d){d="undefined"!=typeof d?d.target.value:c.oFormValues[c.sFormDefinitionName].tra_type.selectedOption.value;ha(d)&&null!=d.selectedOption&&null!=d.selectedOption.value&&(d=angular.copy(d.selectedOption.value));"undefined"!=typeof k&&""!=k&&("TRANCH\u00c9ES D'EPANDAGE"==d?b.displayFormFields(h[k].concat(["tra_nb","tra_longueur","tra_tot_lin","tra_profond","tra_largeur"]).concat(a)):b.displayFormFields(h[k].concat(["tra_long","tra_larg","tra_surf","tra_profondeur"]).concat(a)))},p=d.getFormElementDefinition("tra_type",
c.sFormDefinitionName,c.oFormDefinition);"insert"==c.sMode?b.displayFormFields(a):(k="string"==typeof c.oFormValues[c.sFormDefinitionName].controle_type?c.oFormValues[c.sFormDefinitionName].controle_type:c.oFormValues[c.sFormDefinitionName].controle_type.selectedOption.value,m())}var t=d.getFormElementDefinition("id_controle",c.sFormDefinitionName,c.oFormDefinition);document.getElementById(t.id).addEventListener("change",function(){z({method:"GET",url:e.web_server_name+"/"+e.services_alias+"/anc/controles/"+
this.value,scope:b,success:function(d){d=c.extractWebServiceData("controles",d.data)[0];k=d.controle_type;b.displayFormFields(h[d.controle_type].concat(a))}})});document.getElementById(p.id).addEventListener("change",m)}),a=c.oFormValues[c.sFormDefinitionName];null!=a.create_date&&(a.create_date=moment(a.create_date).format("L"));null!=a.maj_date&&(a.maj_date=moment(a.maj_date).format("L"))};angular.element(u.f).scope().initAncFilieresAgreeesForm=function(){var a=angular.element(u.f).injector().get(["$log"]),
b=angular.element(u.f).injector().get(["$rootScope"]),c=angular.element(u.f).injector().get(["envSrvc"]),d=angular.element(u.f).injector().get(["formSrvc"]),e=angular.element(u.f).injector().get(["propertiesSrvc"]);a.info("initAncFilieresAgreeesForm");var f=b.$on("formExtracted",function(){f();var a=[c.sMode+"_button","id_fag","id_controle","id_installation"],h,k=[];"search"!=c.sMode&&(h={"BON FONCTIONNEMENT":"id_fag id_controle fag_type fag_agree fag_integerer fag_denom fag_fab fag_num_ag fag_cap_eh fag_nb_cuv fag_et_deg fag_et_od fag_et_dy fag_en_date fag_en_jus fag_en_entr fag_en_bord fag_en_dest fag_en_perc fag_en_contr fag_en_mainteger fag_dist_arb fag_dist_parc fag_dist_hab fag_dist_cap maj maj_date create create_date Element_6 Element_7 Element_8 fag_num fag_num_filt fag_mat_cuv fag_guide fag_contr fag_soc Element_0 fag_pres fag_tamp fag_ventil fag_mil_typ fag_mil_filt fag_pres_reg fag_pres_alar fag_commentaires".split(" "),
CONCEPTION:"id_fag id_controle fag_type fag_agree fag_integerer fag_denom fag_fab fag_num_ag fag_cap_eh fag_nb_cuv maj maj_date create create_date".split(" "),REALISATION:"id_fag id_controle fag_type fag_agree fag_integerer fag_denom fag_fab fag_num_ag fag_cap_eh fag_nb_cuv fag_surpr fag_surpr_ref fag_surpr_dist fag_surpr_elec fag_surpr_aer fag_reac_bull fag_broy fag_dec fag_type_eau fag_reg_mar fag_reg_mat fag_reg_affl fag_reg_hz fag_reg_van fag_fvl_nb fag_fvl_long fag_fvl_larg fag_fvl_prof fag_fvl_sep fag_fvl_pla fag_fvl_drain fag_fvl_resp fag_fhz_long fag_fhz_larg fag_fhz_prof fag_fhz_drain fag_fhz_resp fag_mat_qual fag_mat_epa fag_pres_veg fag_pres_pro maj maj_date create create_date Element_1 Element_2 Element_3 Element_5 fag_num fag_num_filt fag_mat_cuv fag_guide fag_contr fag_soc fag_soc fag_livret Element_0 fag_pres fag_plan fag_tamp fag_ancrage fag_ventil fag_mil_typ fag_mil_filt fag_mise_eau fag_pres_alar fag_pres_reg fag_pres fag_plan fag_tamp fag_rep fag_respect fag_att_conf Element_10 fag_commentaires".split(" ")},
"insert"==c.sMode?b.displayFormFields(a):(k=h[c.oFormValues[c.sFormDefinitionName].controle_type],b.displayFormFields(k.concat(a))));k=d.getFormElementDefinition("id_controle",c.sFormDefinitionName,c.oFormDefinition);document.getElementById(k.id).addEventListener("change",function(){z({method:"GET",url:e.web_server_name+"/"+e.services_alias+"/anc/controles/"+this.value,scope:b,success:function(d){d=c.extractWebServiceData("controles",d.data)[0];b.displayFormFields(h[d.controle_type].concat(a))}})});
var k=c.oFormValues[c.sFormDefinitionName],m=k.fag_en_date;null!=m&&""!=m&&(k.fag_en_date=moment(m).format("L"));null!=k.create_date&&(k.create_date=moment(k.create_date).format("L"));null!=k.maj_date&&(k.maj_date=moment(k.maj_date).format("L"))})};angular.element(u.f).scope().loadAncFilieresAgreeesControl=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),c=angular.element(u.f).injector().get(["$translate"]),d=angular.element(u.f).injector().get(["envSrvc"]);
a.info("loadAncFilieresAgreeesControl");var e=d.oSelectedObject.sorted_by,f=d.oSelectedObject.sorted_dir,g=d.oSelectedObject.edit_column,h=d.oSelectedObject.show_column;d.oSelectedObject.sIdField="id_controle";d.oSelectedObject.sorted_by="id_fag";d.oSelectedObject.sorted_dir="ASC";d.oSelectedObject.edit_column="editModalSectionForm";d.oSelectedObject.show_column="showModalSectionForm";c(["GRID_TITLE_ANC_SAISIE_ANC_CONTROLE_CONTROLE_PRETRAITEMENT"]).then(function(a){b.loadSectionList({appHeader:!0,
appHeaderSearchForm:!1,appGridTitle:a.GRID_TITLE_ANC_SAISIE_ANC_CONTROLE_CONTROLE_PRETRAITEMENT,appShowActions:!0,appIdField:"id_fag"})});var k=b.$on("workspaceListHeaderActionsAdded",function(a,b){k();d.oSelectedObject.sorted_by=e;d.oSelectedObject.sorted_dir=f;d.oSelectedObject.edit_column=g;d.oSelectedObject.show_column=h;for(a=0;a<b.appActions.length;a++)-1!=b.appActions[a].name.indexOf("_add")?b.appActions[a].event="addModalSectionForm()":-1!=b.appActions[a].name.indexOf("_delete")&&(b.appActions[a].event=
"DeleteSelection({'sIdField':'id_fag'})")})};angular.element(u.f).scope().initAncControlDispositifsAnnexesForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),c=angular.element(u.f).injector().get(["envSrvc"]);a.info("initAncControlDispositifsAnnexesForm");var d=b.$on("formExtracted",function(){d();b.displayFormFields({"BON FONCTIONNEMENT":"da_chasse_acces da_chasse_pr_nat_eau da_chasse_dysfonctionnement da_chasse_degradation da_chasse_entretien da_pr_loc_pompe da_pr_acces da_pr_clapet da_pr_etanche da_pr_dysfonctionnement da_pr_degradation da_pr_entretien da_commentaires da_pr_ventilatio".split(" "),
CONCEPTION:"da_chasse_auto da_chasse_pr_nat_eau da_pr_loc_pompe da_pr_nb_pompe da_pr_nat_eau da_commentaires".split(" "),REALISATION:"da_chasse_pr_nat_eau da_chasse_ok da_pr_loc_pompe da_pr_ok da_pr_clapet da_pr_etanche da_pr_branchement da_pr_ventilatio da_pr_alarme da_commentaires".split(" ")}[c.oFormValues[c.sFormDefinitionName].controle_type].concat([c.sMode+"_button","Element_1","Element_2"]))})};angular.element(u.f).scope().initAncControlConclusionForm=function(){var a=angular.element(u.f).injector().get(["$log"]),
b=angular.element(u.f).injector().get(["$rootScope"]),c=angular.element(u.f).injector().get(["envSrvc"]),d=angular.element(u.f).injector().get(["formSrvc"]);a.info("initAncControlConclusionForm");var e="ABSENCE D'INSTALLATION;NON CONFORME - D\u00c9FAUT DE S\u00c9CURIT\u00c9 SANITAIRE;NON CONFORME - D\u00c9FAUT DE STRUCTURE OU DE FERMETURE;NON CONFORME - INSTALLATION IMPLANT\u00c9E \u00c0 MOINS DE 35M D'UN PUITS D\u00c9CLAR\u00c9 ET UTILIS\u00c9;NON CONFORME - INSTALLATION INCOMPL\u00c8TE;NON CONFORME - INSTALLATION SIGNIFICATIVEMENT SOUS DIMENSIONN\u00c9E;NON CONFORME - INSTALLATION PR\u00c9SENTANT DES DYSFONCTIONNEMENTS MAJEURS;INSTALLATION NECESSITANT DES RECOMMANDATIONS DE TRAVAUX".split(";");
if("update"==c.sMode){var a=d.getFormElementDefinition("cl_montant",c.sFormDefinitionName,c.oFormDefinition),a=c.oFormDefinition.datasources[a.datasource.datasource_id],f=c.oFormValues[c.oSelectedObject.name+"_"+c.oSectionForm[c.oSelectedObject.name].sections[0].name+"_"+c.sMode+"_form"];if(null!=f.des_date_control){var g=f.des_date_control.match(/[0-9]{4}/);null!==g&&(a.parameters.filter.annee_validite=g[0])}a.parameters.filter.controle_type=f.controle_type.selectedOption.value}var h=b.$on("formExtracted",
function(){h();var a=[c.sMode+"_button","Element_1","Element_2"],f={"BON FONCTIONNEMENT":"cl_classe_cbf cl_commentaires cl_date_avis cl_auteur_avis cl_montant cl_facture cl_facture_le cl_constat cl_travaux".split(" "),CONCEPTION:"cl_avis cl_commentaires cl_date_avis cl_auteur_avis cl_montant cl_facture cl_facture_le".split(" "),REALISATION:"cl_commentaires cl_date_avis cl_auteur_avis cl_montant cl_facture cl_facture_le cl_classe_cbf".split(" ")}[c.oFormValues[c.sFormDefinitionName].controle_type];
b.displayFormFields(f.concat(a));if("BON FONCTIONNEMENT"==c.oFormValues[c.sFormDefinitionName].controle_type){-1!=e.indexOf(c.oFormValues[c.sFormDefinitionName].cl_classe_cbf.selectedOption.value)?b.displayFormFields(f.concat(a).concat(["cl_classe_cbf_warning"])):b.displayFormFields(f.concat(a));var g=d.getFormElementDefinition("cl_classe_cbf",c.sFormDefinitionName,c.oFormDefinition);document.getElementById(g.id).addEventListener("change",function(){-1!=e.indexOf(this.value)?b.displayFormFields(f.concat(a).concat(["cl_classe_cbf_warning"])):
b.displayFormFields(f.concat(a))})}g=c.oFormValues[c.sFormDefinitionName].cl_date_avis;null!=g&&""!=g&&(c.oFormValues[c.sFormDefinitionName].cl_date_avis=moment(g).format("L"));g=c.oFormValues[c.sFormDefinitionName].cl_facture_le;null!=g&&""!=g&&(c.oFormValues[c.sFormDefinitionName].cl_facture_le=moment(g).format("L"))})};angular.element(u.f).scope().initAncEvacuationEauxForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),c=angular.element(u.f).injector().get(["envSrvc"]),
d=angular.element(u.f).injector().get(["formSrvc"]),e=angular.element(u.f).injector().get(["propertiesSrvc"]);a.info("initAncEvacuationEauxForm");var f=b.$on("formExtracted",function(){f();var a=[c.sMode+"_button","id_eva","id_installation","id_controle"],h,k=[];h={"BON FONCTIONNEMENT":"evacuation_eaux.id_eva id_controle evac_type evac_is_long evac_is_larg evac_is_surface evac_is_profondeur evac_is_reg_rep evac_is_reb_bcl evac_is_veg evac_is_acc_reg evac_rp_grav evac_rp_tamp evac_rp_type_eff evac_rp_trap evac_hs_type evac_hs_gestionnaire evac_hs_gestionnaire_auth evac_commentaires maj maj_date create create_date Element_0 Element_1 Element_2 Element_4 evac_is_lin_total evac_rp_type evac_hs_intr evac_hs_type_eff evac_hs_ecoul".split(" "),
CONCEPTION:"evacuation_eaux.id_eva id_controle evac_type evac_is_long evac_is_larg evac_is_surface evac_is_profondeur evac_rp_etude_hydrogeol evac_rp_rejet evac_hs_type evac_hs_gestionnaire evac_hs_gestionnaire_auth evac_commentaires maj maj_date create create_date photos_f fiche_f schema_f documents_f plan_f Element_0 Element_1 Element_2 Element_3 Element_4 evac_is_inf_perm".split(" "),REALISATION:"evacuation_eaux.id_eva id_controle evac_type evac_is_long evac_is_larg evac_is_surface evac_is_profondeur evac_is_geotex evac_is_rac evac_is_hum evac_is_reg_rep evac_is_reb_bcl evac_is_veg evac_rp_grav evac_rp_tamp evac_hs_type evac_commentaires maj maj_date create create_date Element_0 Element_1 Element_2 Element_4 evac_is_lin_total evac_rp_bons_grav evac_hs_intr evac_hs_type_eff evac_hs_ecoul".split(" ")};
"insert"==c.sMode?b.displayFormFields(a):(k=h[c.oFormValues[c.sFormDefinitionName].controle_type],b.displayFormFields(k.concat(a)));"display"!=c.sMode&&(k=d.getFormElementDefinition("id_controle",c.sFormDefinitionName,c.oFormDefinition),document.getElementById(k.id).addEventListener("change",function(){z({method:"GET",url:e.web_server_name+"/"+e.services_alias+"/anc/controles/"+this.value,scope:b,success:function(d){d=c.extractWebServiceData("controles",d.data)[0];b.displayFormFields(h[d.controle_type].concat(a))}})}))}),
a=c.oFormValues[c.sFormDefinitionName];null!=a.create_date&&(a.create_date=moment(a.create_date).format("L"));null!=a.maj_date&&(a.maj_date=moment(a.maj_date).format("L"))};angular.element(u.f).scope().loadAncEvacuationEauxControl=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),c=angular.element(u.f).injector().get(["$translate"]),d=angular.element(u.f).injector().get(["envSrvc"]);a.info("loadAncEvacuationEauxControl");var e=d.oSelectedObject.sorted_by,
f=d.oSelectedObject.sorted_dir,g=d.oSelectedObject.edit_column,h=d.oSelectedObject.show_column;d.oSelectedObject.sIdField="id_controle";d.oSelectedObject.sorted_by="id_eva";d.oSelectedObject.sorted_dir="ASC";d.oSelectedObject.edit_column="editModalSectionForm";d.oSelectedObject.show_column="showModalSectionForm";c(["GRID_TITLE_ANC_SAISIE_ANC_CONTROLE_CONTROLE_EVACUATION_EAUX"]).then(function(a){b.loadSectionList({appHeader:!0,appHeaderSearchForm:!1,appGridTitle:a.GRID_TITLE_ANC_SAISIE_ANC_CONTROLE_CONTROLE_EVACUATION_EAUX,
appShowActions:!0,appIdField:"id_eva"})});var k=b.$on("workspaceListHeaderActionsAdded",function(a,b){k();d.oSelectedObject.sorted_by=e;d.oSelectedObject.sorted_dir=f;d.oSelectedObject.edit_column=g;d.oSelectedObject.show_column=h;for(a=0;a<b.appActions.length;a++)-1!=b.appActions[a].name.indexOf("_add")?b.appActions[a].event="addModalSectionForm()":-1!=b.appActions[a].name.indexOf("_delete")&&(b.appActions[a].event="DeleteSelection({'sIdField':'id_eva'})")})};angular.element(u.f).scope().initAncControlPretraitementForm=
function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),c=angular.element(u.f).injector().get(["$timeout"]),d=angular.element(u.f).injector().get(["envSrvc"]),e=angular.element(u.f).injector().get(["formSrvc"]),f=angular.element(u.f).injector().get(["propertiesSrvc"]);a.info("initAncControlPretraitementForm");var g=d.oFormValues[d.oSelectedObject.name+"_"+d.oSectionForm[d.oSelectedObject.name].sections[0].name+"_"+this.$parent.sParentMode+
"_form"],h=e.getFormElementDefinition("id_controle",d.sFormDefinitionName,d.oFormDefinition);"insert"==d.sMode&&(e.getFormElementDefinition("id_installation",d.sFormDefinitionName,d.oFormDefinition).default_value=g.id_installation.selectedOption.value,h.default_value=g.id_controle);var k=b.$on("formExtracted",function(){k();var a=[d.sMode+"_button","id_pretraitement","id_installation","id_controle"],e,t=[];e={"BON FONCTIONNEMENT":"ptr_im_puit ptr_adapte ptr_type_eau ptr_type ptr_volume ptr_marque ptr_materiau ptr_cloison ptr_commentaire ptr_im_distance ptr_im_acces ptr_et_degrad ptr_et_real ptr_vi_date ptr_vi_justi ptr_vi_entr ptr_vi_bord ptr_vi_dest ptr_vi_perc maj maj_date create create_date Element_0 Element_1 Element_3 Element_4".split(" "),
CONCEPTION:"ptr_type ptr_volume ptr_marque ptr_materiau ptr_commentaire ptr_im_distance maj maj_date create create_date Element_0 Element_1 Element_4".split(" "),REALISATION:"ptr_type ptr_volume ptr_marque ptr_materiau ptr_commentaire ptr_im_distance ptr_im_hydrom maj maj_date create create_date Element_0 Element_4 ptr_pose ptr_adapte ptr_conforme_projet ptr_renforce ptr_verif_mise_en_eau ptr_type_eau ptr_im_dalle ptr_im_puit".split(" ")};t=e["string"==typeof g.controle_type?g.controle_type:g.controle_type.selectedOption.value];
b.displayFormFields(t.concat(a));"display"!=d.sMode&&c(function(){document.getElementById(h.id).addEventListener("change",function(){z({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/anc/controles/"+this.value,scope:b,success:function(c){c=d.extractWebServiceData("controles",c.data)[0];b.displayFormFields(e[c.controle_type].concat(a))}})})})}),a=d.oFormValues[d.sFormDefinitionName];null!=a.create_date&&(a.create_date=moment(a.create_date).format("L"));null!=a.maj_date&&(a.maj_date=moment(a.maj_date).format("L"));
null!=a.ptr_vi_date&&(a.ptr_vi_date=moment(a.ptr_vi_date).format("L"))};angular.element(u.f).scope().initAncControlTraitementForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),c=angular.element(u.f).injector().get(["$timeout"]),d=angular.element(u.f).injector().get(["envSrvc"]),e=angular.element(u.f).injector().get(["formSrvc"]),f=angular.element(u.f).injector().get(["propertiesSrvc"]);a.info("initAncControlTraitementForm");var g=
d.oFormValues[d.oSelectedObject.name+"_"+d.oSectionForm[d.oSelectedObject.name].sections[0].name+"_"+this.$parent.sParentMode+"_form"],h=e.getFormElementDefinition("id_controle",d.sFormDefinitionName,d.oFormDefinition);"insert"==d.sMode&&(e.getFormElementDefinition("id_installation",d.sFormDefinitionName,d.oFormDefinition).default_value=g.id_installation.selectedOption.value,h.default_value=g.id_controle);var k=b.$on("formExtracted",function(){function a(a){a="undefined"!=typeof a?a.target.value:
d.oFormValues[d.sFormDefinitionName].tra_type;ha(a)&&null!=a.selectedOption&&null!=a.selectedOption.value&&(a=angular.copy(a.selectedOption.value));"undefined"!=typeof w&&""!=w&&("TRANCH\u00c9ES D'EPANDAGE"==a?b.displayFormFields(t[w].concat(["tra_nb","tra_longueur","tra_tot_lin","tra_profond","tra_largeur"]).concat(p)):b.displayFormFields(t[w].concat(["tra_long","tra_larg","tra_surf","tra_profondeur"]).concat(p)))}k();var p=[d.sMode+"_button","id_traitement","id_controle","tra_type","id_installation"],
t,v=[];t={"BON FONCTIONNEMENT":"tra_dist_hab tra_dist_lim_parc tra_dist_veget tra_dist_puit tra_regrep_mat tra_regrep_affl tra_regrep_equi tra_regbl_mat tra_regbl_affl tra_regcol_mat tra_regcol_affl maj maj_date create create_date Element_0 Element_1 Element_3 Element_4 Element_5 Element_6".split(" "),CONCEPTION:"maj maj_date create create_date Element_0 Element_6".split(" "),REALISATION:["tra_dist_lim_parc","tra_dist_veget","tra_dist_puit","tra_vm_grav_qual","tra_vm_grav_ep","tra_vm_geo_text","tra_vm_bon_mat",
"tra_regrep_mat","tra_regrep_affl","tra_regrep_equi","tra_regrep_perf","tra_regbl_mat","tra_regbl_affl","tra_regbl_hz","tra_regbl_epand","tra_regbl_perf","tra_regcol_mat","tra_regcol_affl","tra_regcol_hz","maj","maj_date","create","create_date","Element_0","Element_1","Element_2","Element_3","Element_4","Element_5","Element_6",,"tra_vm_racine","tra_vm_humidite","tra_vm_imper","tra_vm_geogrille","tra_vm_tuy_perf","tra_vm_sab_qual","tra_vm_sab_ep","tra_vm_geomembrane"]};var w="string"==typeof g.controle_type?
g.controle_type:g.controle_type.selectedOption.value,v=t[w],x=e.getFormElementDefinition("tra_type",d.sFormDefinitionName,d.oFormDefinition);"insert"==d.sMode?b.displayFormFields(v.concat(p)):a();"display"!=d.sMode&&(document.getElementById(x.id).removeEventListener("change",a),c(function(){document.getElementById(h.id).addEventListener("change",function(){z({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/anc/controles/"+this.value,scope:b,success:function(a){a=d.extractWebServiceData("controles",
a.data)[0];w=a.controle_type;b.displayFormFields(t[a.controle_type].concat(p))}})});document.getElementById(x.id).addEventListener("change",a)}))})};angular.element(u.f).scope().initAncControlFilieresAgreeesForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),c=angular.element(u.f).injector().get(["$timeout"]),d=angular.element(u.f).injector().get(["envSrvc"]),e=angular.element(u.f).injector().get(["formSrvc"]),f=angular.element(u.f).injector().get(["propertiesSrvc"]);
a.info("initAncControlFilieresAgreeesForm");var g=d.oFormValues[d.oSelectedObject.name+"_"+d.oSectionForm[d.oSelectedObject.name].sections[0].name+"_"+this.$parent.sParentMode+"_form"],h=e.getFormElementDefinition("id_controle",d.sFormDefinitionName,d.oFormDefinition);"insert"==d.sMode&&(e.getFormElementDefinition("id_installation",d.sFormDefinitionName,d.oFormDefinition).default_value=g.id_installation.selectedOption.value,h.default_value=g.id_controle);var k=b.$on("formExtracted",function(){k();
var a=[d.sMode+"_button","id_fag","id_controle","id_installation"],e,t=[];e={"BON FONCTIONNEMENT":"id_fag id_controle fag_type fag_agree fag_integerer fag_denom fag_fab fag_num_ag fag_cap_eh fag_nb_cuv fag_et_deg fag_et_od fag_et_dy fag_en_date fag_en_jus fag_en_entr fag_en_bord fag_en_dest fag_en_perc fag_en_contr fag_en_mainteger fag_dist_arb fag_dist_parc fag_dist_hab fag_dist_cap maj maj_date create create_date Element_6 Element_7 Element_8 fag_num fag_num_filt fag_mat_cuv fag_guide fag_contr fag_soc Element_0 fag_pres fag_tamp fag_ventil fag_mil_typ fag_mil_filt fag_pres_reg fag_pres_alar fag_commentaires".split(" "),
CONCEPTION:"id_fag id_controle fag_type fag_agree fag_integerer fag_denom fag_fab fag_num_ag fag_cap_eh fag_nb_cuv maj maj_date create create_date".split(" "),REALISATION:"id_fag id_controle fag_type fag_agree fag_integerer fag_denom fag_fab fag_num_ag fag_cap_eh fag_nb_cuv fag_surpr fag_surpr_ref fag_surpr_dist fag_surpr_elec fag_surpr_aer fag_reac_bull fag_broy fag_dec fag_type_eau fag_reg_mar fag_reg_mat fag_reg_affl fag_reg_hz fag_reg_van fag_fvl_nb fag_fvl_long fag_fvl_larg fag_fvl_prof fag_fvl_sep fag_fvl_pla fag_fvl_drain fag_fvl_resp fag_fhz_long fag_fhz_larg fag_fhz_prof fag_fhz_drain fag_fhz_resp fag_mat_qual fag_mat_epa fag_pres_veg fag_pres_pro maj maj_date create create_date Element_1 Element_2 Element_3 Element_5 fag_num fag_num_filt fag_mat_cuv fag_guide fag_contr fag_soc fag_soc fag_livret Element_0 fag_pres fag_plan fag_tamp fag_ancrage fag_ventil fag_mil_typ fag_mil_filt fag_mise_eau fag_pres_alar fag_pres_reg fag_pres fag_plan fag_tamp fag_rep fag_respect fag_att_conf Element_10 fag_commentaires".split(" ")};
t=e["string"==typeof g.controle_type?g.controle_type:g.controle_type.selectedOption.value];b.displayFormFields(t.concat(a));"display"!=d.sMode&&c(function(){document.getElementById(h.id).addEventListener("change",function(){z({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/anc/controles/"+this.value,scope:b,success:function(c){c=d.extractWebServiceData("controles",c.data)[0];b.displayFormFields(e[c.controle_type].concat(a))}})})})}),a=d.oFormValues[d.sFormDefinitionName],e=a.fag_en_date;
null!=e&&""!=e&&(a.fag_en_date=moment(e).format("L"));null!=a.create_date&&(a.create_date=moment(a.create_date).format("L"));null!=a.maj_date&&(a.maj_date=moment(a.maj_date).format("L"))};angular.element(u.f).scope().initAncControlEvacuationEauxForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["$rootScope"]),c=angular.element(u.f).injector().get(["$timeout"]),d=angular.element(u.f).injector().get(["envSrvc"]),e=angular.element(u.f).injector().get(["formSrvc"]),
f=angular.element(u.f).injector().get(["propertiesSrvc"]);a.info("initAncControlEvacuationEauxForm");var g=d.oFormValues[d.oSelectedObject.name+"_"+d.oSectionForm[d.oSelectedObject.name].sections[0].name+"_"+this.$parent.sParentMode+"_form"],h=e.getFormElementDefinition("id_controle",d.sFormDefinitionName,d.oFormDefinition);"insert"==d.sMode&&(e.getFormElementDefinition("id_installation",d.sFormDefinitionName,d.oFormDefinition).default_value=g.id_installation.selectedOption.value,h.default_value=
g.id_controle);var k=b.$on("formExtracted",function(){k();var a=[d.sMode+"_button","id_eva","id_installation","id_controle"],e,t=[];e={"BON FONCTIONNEMENT":"evacuation_eaux.id_eva id_controle evac_type evac_is_long evac_is_larg evac_is_surface evac_is_profondeur evac_is_reg_rep evac_is_reb_bcl evac_is_veg evac_is_acc_reg evac_rp_grav evac_rp_tamp evac_rp_type_eff evac_rp_trap evac_hs_type evac_hs_gestionnaire evac_hs_gestionnaire_auth evac_commentaires maj maj_date create create_date Element_0 Element_1 Element_2 Element_4 evac_is_lin_total evac_rp_type evac_hs_intr evac_hs_type_eff evac_hs_ecoul".split(" "),
CONCEPTION:"evacuation_eaux.id_eva id_controle evac_type evac_is_long evac_is_larg evac_is_surface evac_is_profondeur evac_rp_etude_hydrogeol evac_rp_rejet evac_hs_type evac_hs_gestionnaire evac_hs_gestionnaire_auth evac_commentaires maj maj_date create create_date photos_f fiche_f schema_f documents_f plan_f Element_0 Element_1 Element_2 Element_3 Element_4 evac_is_inf_perm".split(" "),REALISATION:"evacuation_eaux.id_eva id_controle evac_type evac_is_long evac_is_larg evac_is_surface evac_is_profondeur evac_is_geotex evac_is_rac evac_is_hum evac_is_reg_rep evac_is_reb_bcl evac_is_veg evac_rp_grav evac_rp_tamp evac_hs_type evac_commentaires maj maj_date create create_date Element_0 Element_1 Element_2 Element_4 evac_is_lin_total evac_rp_bons_grav evac_hs_intr evac_hs_type_eff evac_hs_ecoul".split(" ")};
t=e["string"==typeof g.controle_type?g.controle_type:g.controle_type.selectedOption.value];b.displayFormFields(t.concat(a));"display"!=d.sMode&&c(function(){document.getElementById(h.id).addEventListener("change",function(){z({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/anc/controles/"+this.value,scope:b,success:function(c){c=d.extractWebServiceData("controles",c.data)[0];b.displayFormFields(e[c.controle_type].concat(a))}})})})}),a=d.oFormValues[d.sFormDefinitionName];null!=a.create_date&&
(a.create_date=moment(a.create_date).format("L"));null!=a.maj_date&&(a.maj_date=moment(a.maj_date).format("L"))};angular.element(u.f).scope().beforeSendingAncInstallationForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["envSrvc"]);a.info("beforeSendingAncInstallationForm");var a=["parc_commune","prop_adresse","prop_commune","prop_nom_prenom","prop_titre"],b=b.oFormValues[b.sFormDefinitionName],c;for(c in a)"string"==typeof b[a[c]]&&(b[a[c]]=
b[a[c]].toUpperCase())};angular.element(u.f).scope().initAncControleSuiviForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["envSrvc"]);a.info("initAncControleSuiviForm");a=b.oFormValues[b.sFormDefinitionName];null!=a.create_date&&(a.create_date=moment(a.create_date).format("L"));null!=a.maj_date&&(a.maj_date=moment(a.maj_date).format("L"))};u.fC=function(){return{link:function(a,b,c){var d=c.$observe("appAdminDescriptionColumn",function(){console.log(a.row.entity[a.col.field]);
null==a.row.entity[a.col.field]||""==a.row.entity[a.col.field]?b[0].className="":(b[0].className="ui-grid-cell-contents wk-params-icon",$(b).popover({trigger:"hover",container:"body",html:!0,title:function(){return"#"+a.row.entity.id_parametre_admin},placement:function(b,c){return a.$root.workspaceTooltipPlacement(c)},content:function(){return String(a.row.entity[a.col.field]).replace(/,/g,"<br>")}}))});a.$on("$destroy",function(){$(b).popover("destroy");d()})}}};u.compileProvider.directive("appAdminDescriptionColumn",
u.fC);u.gC=function(){return{link:function(a,b,c){var d=c.$observe("appAdminSignatureColumn",function(){console.log(a.row.entity[a.col.field]);null==a.row.entity[a.col.field]||""==a.row.entity[a.col.field]?b[0].className="":(b[0].className="ui-grid-cell-contents wk-params-icon",$(b).popover({trigger:"hover",container:"body",html:!0,title:function(){return"#"+a.row.entity.id_parametre_admin},placement:function(b,c){return a.$root.workspaceTooltipPlacement(c)},content:function(){return String(a.row.entity[a.col.field]).replace(/,/g,
"<br>")}}))});a.$on("$destroy",function(){$(b).popover("destroy");d()})}}};u.compileProvider.directive("appAdminSignatureColumn",u.gC);angular.element(u.f).scope().initAncParametrageEntrepriseForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["envSrvc"]);a.info("initAncParametrageEntrepriseForm");a=b.oFormValues[b.sFormDefinitionName];null!=a.create_date&&(a.create_date=moment(a.create_date).format("L"));null!=a.maj_date&&(a.maj_date=moment(a.maj_date).format("L"))};
angular.element(u.f).scope().initAncParametrageAdministrateurForm=function(){var a=angular.element(u.f).injector().get(["$log"]),b=angular.element(u.f).injector().get(["envSrvc"]);a.info("initAncParametrageAdministrateurForm");a=b.oFormValues[b.sFormDefinitionName];null!=a.date_fin_validite&&(a.date_fin_validite=moment(a.date_fin_validite).format("L"))}});
}).call(this)
//# sourceMappingURL=../javascript/vmap.min.js.map
