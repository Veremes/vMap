(function(){
var l,aa=this;function n(a){return void 0!==a}
function ba(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function q(a){return"array"==ba(a)}function ca(a){var b=ba(a);return"array"==b||"object"==b&&"number"==typeof a.length}function r(a){return"string"==typeof a}function ea(a){return"number"==typeof a}function ga(a){return"function"==ba(a)}function ha(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var ia="closure_uid_"+(1E9*Math.random()>>>0),ja=0;function ka(a,b,c){return a.call.apply(a.bind,arguments)}
function la(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function na(a,b,c){na=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ka:la;return na.apply(null,arguments)}
function oa(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}}var pa=Date.now||function(){return+new Date};function qa(a,b){a=a.split(".");var c=aa;a[0]in c||!c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)!a.length&&n(b)?c[d]=b:c=c[d]?c[d]:c[d]={}}
function ra(a,b){function c(){}c.prototype=b.prototype;a.Fw=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.OP=function(a,c,f){for(var d=Array(arguments.length-2),e=2;e<arguments.length;e++)d[e-2]=arguments[e];return b.prototype[c].apply(a,d)}};function sa(){0!=ta&&(ua[this[ia]||(this[ia]=++ja)]=this);this.fj=this.fj;this.pr=this.pr}var ta=0,ua={};sa.prototype.fj=!1;sa.prototype.ue=function(){if(!this.fj&&(this.fj=!0,this.Ya(),0!=ta)){var a=this[ia]||(this[ia]=++ja);delete ua[a]}};sa.prototype.Ya=function(){if(this.pr)for(;this.pr.length;)this.pr.shift()()};var va=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};function wa(a){if(!xa.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(za,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(Aa,"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(Ba,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(Da,"&quot;"));-1!=a.indexOf("'")&&(a=a.replace(Ea,"&#39;"));-1!=a.indexOf("\x00")&&(a=a.replace(Fa,"&#0;"));return a}var za=/&/g,Aa=/</g,Ba=/>/g,Da=/"/g,Ea=/'/g,Fa=/\x00/g,xa=/[\x00&<>"']/;
function Ga(a,b){return a<b?-1:a>b?1:0}var Ha=2147483648*Math.random()|0;function Ia(a,b){b=r(b)?String(b).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"):"\\s";return a.replace(new RegExp("(^"+(b?"|["+b+"]+":"")+")([a-z])","g"),function(a,b,e){return b+e.toUpperCase()})};function Ja(a){var b;b=b||0;return function(){return a.apply(this,Array.prototype.slice.call(arguments,0,b))}};var Ka=Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(r(a))return r(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},La=Array.prototype.forEach?function(a,b,c){Array.prototype.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=r(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)},Ma=Array.prototype.filter?function(a,b,c){return Array.prototype.filter.call(a,
b,c)}:function(a,b,c){for(var d=a.length,e=[],f=0,g=r(a)?a.split(""):a,h=0;h<d;h++)if(h in g){var k=g[h];b.call(c,k,h,a)&&(e[f++]=k)}return e},Na=Array.prototype.map?function(a,b,c){return Array.prototype.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=r(a)?a.split(""):a,g=0;g<d;g++)g in f&&(e[g]=b.call(c,f[g],g,a));return e};function Oa(a,b){return 0<=Ka(a,b)}function Pa(a){if(!q(a))for(var b=a.length-1;0<=b;b--)delete a[b];a.length=0}function Qa(a,b){Oa(a,b)||a.push(b)}
function Ra(a,b){oa(Sa,a,-1,0).apply(null,b)}function Ta(a,b){Array.prototype.splice.call(a,b,1)}function Ua(a){return Array.prototype.concat.apply(Array.prototype,arguments)}function Va(a){return Array.prototype.concat.apply(Array.prototype,arguments)}function Wa(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]}
function Xa(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(ca(d)){var e=a.length||0,f=d.length||0;a.length=e+f;for(var g=0;g<f;g++)a[e+g]=d[g]}else a.push(d)}}function Sa(a,b,c,d){return Array.prototype.splice.apply(a,Ya(arguments,1))}function Ya(a,b,c){return 2>=arguments.length?Array.prototype.slice.call(a,b):Array.prototype.slice.call(a,b,c)}
function Za(a){for(var b={},c=0,d=0;d<a.length;){var e=a[d++],f;f=e;f=ha(f)?"o"+(f[ia]||(f[ia]=++ja)):(typeof f).charAt(0)+f;Object.prototype.hasOwnProperty.call(b,f)||(b[f]=!0,a[c++]=e)}a.length=c}function $a(a,b){var c;c=0;for(var d=a.length,e;c<d;){var f=c+d>>1,g;g=a[f];g=b>g?1:b<g?-1:0;0<g?c=f+1:(d=f,e=!g)}c=e?c:~c;0>c&&Sa(a,-(c+1),0,b)}function ab(a){for(var b=[],c=0;c<a;c++)b[c]=0;return b};var bb;a:{var cb=aa.navigator;if(cb){var db=cb.userAgent;if(db){bb=db;break a}}bb=""};function eb(a,b){for(var c in a)b.call(void 0,a[c],c,a)}function fb(a,b){for(var c in a)if(b.call(void 0,a[c],c,a))return!0;return!1}function gb(a,b){for(var c in a)if(a[c]==b)return!0;return!1}function hb(a){for(var b in a)return!1;return!0}function ib(a){for(var b in a)delete a[b]}function jb(a,b){b in a&&delete a[b]}function kb(a){var b={},c;for(c in a)b[c]=a[c];return b}var lb="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
function mb(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<lb.length;f++)c=lb[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};function nb(a){nb[" "](a);return a}nb[" "]=function(){};function ob(a,b,c){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:a[b]=c(b)};var pb=-1!=bb.indexOf("Opera"),rb=-1!=bb.indexOf("Trident")||-1!=bb.indexOf("MSIE"),sb=-1!=bb.indexOf("Edge"),tb=-1!=bb.indexOf("Gecko")&&!(-1!=bb.toLowerCase().indexOf("webkit")&&-1==bb.indexOf("Edge"))&&!(-1!=bb.indexOf("Trident")||-1!=bb.indexOf("MSIE"))&&-1==bb.indexOf("Edge"),ub=-1!=bb.toLowerCase().indexOf("webkit")&&-1==bb.indexOf("Edge");function vb(){var a=aa.document;return a?a.documentMode:void 0}var wb;
a:{var xb="",yb=function(){var a=bb;if(tb)return/rv\:([^\);]+)(\)|;)/.exec(a);if(sb)return/Edge\/([\d\.]+)/.exec(a);if(rb)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(ub)return/WebKit\/(\S+)/.exec(a);if(pb)return/(?:Version)[ \/]?(\S+)/.exec(a)}();yb&&(xb=yb?yb[1]:"");if(rb){var zb=vb();if(null!=zb&&zb>parseFloat(xb)){wb=String(zb);break a}}wb=xb}var Ab={};
function Bb(a){return ob(Ab,a,function(){for(var b=0,c=va(String(wb)).split("."),d=va(String(a)).split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",h=d[f]||"";do{g=/(\d*)(\D*)(.*)/.exec(g)||["","","",""];h=/(\d*)(\D*)(.*)/.exec(h)||["","","",""];if(0==g[0].length&&0==h[0].length)break;b=Ga(0==g[1].length?0:parseInt(g[1],10),0==h[1].length?0:parseInt(h[1],10))||Ga(0==g[2].length,0==h[2].length)||Ga(g[2],h[2]);g=g[3];h=h[3]}while(0==b)}return 0<=b})}var Cb;var Db=aa.document;
Cb=Db&&rb?vb()||("CSS1Compat"==Db.compatMode?parseInt(wb,10):5):void 0;var Eb=!rb||9<=Number(Cb),Fb=rb&&!Bb("9");!ub||Bb("528");tb&&Bb("1.9b")||rb&&Bb("8")||pb&&Bb("9.5")||ub&&Bb("528");tb&&!Bb("8")||rb&&Bb("9");function Gb(a,b){this.type=a;this.currentTarget=this.target=b;this.defaultPrevented=this.Vv=!1}Gb.prototype.stopPropagation=function(){this.Vv=!0};Gb.prototype.preventDefault=function(){this.defaultPrevented=!0};function Hb(a,b){Gb.call(this,a?a.type:"");this.relatedTarget=this.currentTarget=this.target=null;this.charCode=this.keyCode=this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0;this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.Nm=this.state=null;a&&this.yj(a,b)}ra(Hb,Gb);
Hb.prototype.yj=function(a,b){var c=this.type=a.type,d=a.changedTouches?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.currentTarget=b;if(b=a.relatedTarget){if(tb){var e;a:{try{nb(b.nodeName);e=!0;break a}catch(f){}e=!1}e||(b=null)}}else"mouseover"==c?b=a.fromElement:"mouseout"==c&&(b=a.toElement);this.relatedTarget=b;null===d?(this.offsetX=ub||void 0!==a.offsetX?a.offsetX:a.layerX,this.offsetY=ub||void 0!==a.offsetY?a.offsetY:a.layerY,this.clientX=void 0!==a.clientX?a.clientX:a.pageX,
this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0):(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0);this.button=a.button;this.keyCode=a.keyCode||0;this.charCode=a.charCode||("keypress"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.state=a.state;this.Nm=a;a.defaultPrevented&&this.preventDefault()};
Hb.prototype.stopPropagation=function(){Hb.Fw.stopPropagation.call(this);this.Nm.stopPropagation?this.Nm.stopPropagation():this.Nm.cancelBubble=!0};Hb.prototype.preventDefault=function(){Hb.Fw.preventDefault.call(this);var a=this.Nm;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,Fb)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var Ib="closure_listenable_"+(1E6*Math.random()|0),Jb=0;function Kb(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.np=!!d;this.Ru=e;this.key=++Jb;this.Sn=this.Bk=!1}function Lb(a){a.Sn=!0;a.listener=null;a.proxy=null;a.src=null;a.Ru=null};function Mb(a){this.src=a;this.ce={};this.Bo=0}Mb.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.ce[f];a||(a=this.ce[f]=[],this.Bo++);var g=Nb(a,b,d,e);-1<g?(b=a[g],c||(b.Bk=!1)):(b=new Kb(b,this.src,f,!!d,e),b.Bk=c,a.push(b));return b};Mb.prototype.remove=function(a,b,c,d){a=a.toString();if(!(a in this.ce))return!1;var e=this.ce[a];b=Nb(e,b,c,d);return-1<b?(Lb(e[b]),Ta(e,b),0==e.length&&(delete this.ce[a],this.Bo--),!0):!1};
Mb.prototype.removeAll=function(a){a=a&&a.toString();var b=0,c;for(c in this.ce)if(!a||c==a){for(var d=this.ce[c],e=0;e<d.length;e++)++b,Lb(d[e]);delete this.ce[c];this.Bo--}return b};Mb.prototype.hasListener=function(a,b){var c=n(a),d=c?a.toString():"",e=n(b);return fb(this.ce,function(a){for(var f=0;f<a.length;++f)if(!(c&&a[f].type!=d||e&&a[f].np!=b))return!0;return!1})};function Nb(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.Sn&&f.listener==b&&f.np==!!c&&f.Ru==d)return e}return-1};var Ob="closure_lm_"+(1E6*Math.random()|0),Pb={},Qb=0;function Rb(a,b,c,d,e){if(q(b)){for(var f=0;f<b.length;f++)Rb(a,b[f],c,d,e);return null}c=Sb(c);return a&&a[Ib]?a.mQ(b,c,d,e):Tb(a,b,c,!1,d,e)}
function Tb(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=!!e,h=Ub(a);h||(a[Ob]=h=new Mb(a));c=h.add(b,c,d,e,f);if(c.proxy)return c;d=Vb();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)a.addEventListener(b.toString(),d,g);else if(a.attachEvent)a.attachEvent(Wb(b.toString()),d);else throw Error("addEventListener and attachEvent are unavailable.");Qb++;return c}
function Vb(){var a=Xb,b=Eb?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b}function Yb(a,b,c,d,e){if(q(b))for(var f=0;f<b.length;f++)Yb(a,b[f],c,d,e);else c=Sb(c),a&&a[Ib]?a.nQ(b,c,d,e):Tb(a,b,c,!0,d,e)}
function Zb(a){if(!ea(a)&&a&&!a.Sn){var b=a.src;if(b&&b[Ib])b.KQ(a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.np):b.detachEvent&&b.detachEvent(Wb(c),d);Qb--;if(c=Ub(b)){var d=a.type,e;if(e=d in c.ce){e=c.ce[d];var f=Ka(e,a),g;(g=0<=f)&&Ta(e,f);e=g}e&&(Lb(a),0==c.ce[d].length&&(delete c.ce[d],c.Bo--));0==c.Bo&&(c.src=null,b[Ob]=null)}else Lb(a)}}}function Wb(a){return a in Pb?Pb[a]:Pb[a]="on"+a}
function $b(a,b,c,d){var e=!0;if(a=Ub(a))if(b=a.ce[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.np==c&&!f.Sn&&(f=ac(f,d),e=e&&!1!==f)}return e}function ac(a,b){var c=a.listener,d=a.Ru||a.src;a.Bk&&Zb(a);return c.call(d,b)}
function Xb(a,b){if(a.Sn)return!0;if(!Eb){if(!b)a:{b=["window","event"];for(var c=aa,d;d=b.shift();)if(null!=c[d])c=c[d];else{b=null;break a}b=c}d=b;b=new Hb(d,this);c=!0;if(!(0>d.keyCode||void 0!=d.returnValue)){a:{var e=!1;if(0==d.keyCode)try{d.keyCode=-1;break a}catch(g){e=!0}if(e||void 0==d.returnValue)d.returnValue=!0}d=[];for(e=b.currentTarget;e;e=e.parentNode)d.push(e);a=a.type;for(e=d.length-1;!b.Vv&&0<=e;e--){b.currentTarget=d[e];var f=$b(d[e],a,!0,b),c=c&&f}for(e=0;!b.Vv&&e<d.length;e++)b.currentTarget=
d[e],f=$b(d[e],a,!1,b),c=c&&f}return c}return ac(a,new Hb(b,this))}function Ub(a){a=a[Ob];return a instanceof Mb?a:null}var bc="__closure_events_fn_"+(1E9*Math.random()>>>0);function Sb(a){if(ga(a))return a;a[bc]||(a[bc]=function(b){return a.handleEvent(b)});return a[bc]};var cc=!rb||9<=Number(Cb);!tb&&!rb||rb&&9<=Number(Cb)||tb&&Bb("1.9.1");rb&&Bb("9");function dc(a,b){eb(b,function(b,d){"style"==d?a.style.cssText=b:"class"==d?a.className=b:"for"==d?a.htmlFor=b:ec.hasOwnProperty(d)?a.setAttribute(ec[d],b):0==d.lastIndexOf("aria-",0)||0==d.lastIndexOf("data-",0)?a.setAttribute(d,b):a[d]=b})}var ec={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};
function fc(a,b,c){var d=arguments,e=document,f=String(d[0]),g=d[1];if(!cc&&g&&(g.name||g.type)){f=["<",f];g.name&&f.push(' name="',wa(g.name),'"');if(g.type){f.push(' type="',wa(g.type),'"');var h={};mb(h,g);delete h.type;g=h}f.push(">");f=f.join("")}f=e.createElement(f);g&&(r(g)?f.className=g:q(g)?f.className=g.join(" "):dc(f,g));2<d.length&&gc(e,f,d);return f}
function gc(a,b,c){function d(c){c&&b.appendChild(r(c)?a.createTextNode(c):c)}for(var e=2;e<c.length;e++){var f=c[e];!ca(f)||ha(f)&&0<f.nodeType?d(f):La(hc(f)?Wa(f):f,d)}}function hc(a){if(a&&"number"==typeof a.length){if(ha(a))return"function"==typeof a.item||"string"==typeof a.item;if(ga(a))return"function"==typeof a.item}return!1};function ic(a,b,c){sa.call(this);this.Bd=null;this.hx=!1;this.YJ=a;this.zJ=c;this.Dg=b||window;this.xt=na(this.qz,this)}ra(ic,sa);l=ic.prototype;l.start=function(){this.stop();this.hx=!1;var a=jc(this),b=kc(this);a&&!b&&this.Dg.mozRequestAnimationFrame?(this.Bd=Rb(this.Dg,"MozBeforePaint",this.xt),this.Dg.mozRequestAnimationFrame(null),this.hx=!0):this.Bd=a&&b?a.call(this.Dg,this.xt):this.Dg.setTimeout(Ja(this.xt),20)};
l.stop=function(){if(null!=this.Bd){var a=jc(this),b=kc(this);a&&!b&&this.Dg.mozRequestAnimationFrame?Zb(this.Bd):a&&b?b.call(this.Dg,this.Bd):this.Dg.clearTimeout(this.Bd)}this.Bd=null};l.fire=function(){this.stop();this.qz()};l.qz=function(){this.hx&&this.Bd&&Zb(this.Bd);this.Bd=null;this.YJ.call(this.zJ,pa())};l.Ya=function(){this.stop();ic.Fw.Ya.call(this)};
function jc(a){a=a.Dg;return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||null}function kc(a){a=a.Dg;return a.cancelAnimationFrame||a.cancelRequestAnimationFrame||a.webkitCancelRequestAnimationFrame||a.mozCancelRequestAnimationFrame||a.oCancelRequestAnimationFrame||a.msCancelRequestAnimationFrame||null};function mc(a){return Na(a,function(a){a=a.toString(16);return 1<a.length?a:"0"+a}).join("")};function nc(){this.yk=-1};function oc(a,b){this.yk=pc;this.op=aa.Uint8Array?new Uint8Array(this.yk):Array(this.yk);this.os=this.fl=0;this.Tb=[];this.kL=a;this.MA=b;this.fP=aa.Int32Array?new Int32Array(64):Array(64);n(qc)||(qc=aa.Int32Array?new Int32Array(rc):rc);this.reset()}var qc;ra(oc,nc);var pc=64,sc=Ua(128,ab(pc-1));oc.prototype.reset=function(){this.os=this.fl=0;this.Tb=aa.Int32Array?new Int32Array(this.MA):Wa(this.MA)};
function tc(a){for(var b=a.op,c=a.fP,d=0,e=0;e<b.length;)c[d++]=b[e]<<24|b[e+1]<<16|b[e+2]<<8|b[e+3],e=4*d;for(b=16;64>b;b++){var e=c[b-15]|0,d=c[b-2]|0,f=(c[b-16]|0)+((e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3)|0,g=(c[b-7]|0)+((d>>>17|d<<15)^(d>>>19|d<<13)^d>>>10)|0;c[b]=f+g|0}for(var d=a.Tb[0]|0,e=a.Tb[1]|0,h=a.Tb[2]|0,k=a.Tb[3]|0,m=a.Tb[4]|0,p=a.Tb[5]|0,t=a.Tb[6]|0,f=a.Tb[7]|0,b=0;64>b;b++)var u=((d>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10))+(d&e^d&h^e&h)|0,g=m&p^~m&t,f=f+((m>>>6|m<<26)^(m>>>11|m<<21)^
(m>>>25|m<<7))|0,g=g+(qc[b]|0)|0,g=f+(g+(c[b]|0)|0)|0,f=t,t=p,p=m,m=k+g|0,k=h,h=e,e=d,d=g+u|0;a.Tb[0]=a.Tb[0]+d|0;a.Tb[1]=a.Tb[1]+e|0;a.Tb[2]=a.Tb[2]+h|0;a.Tb[3]=a.Tb[3]+k|0;a.Tb[4]=a.Tb[4]+m|0;a.Tb[5]=a.Tb[5]+p|0;a.Tb[6]=a.Tb[6]+t|0;a.Tb[7]=a.Tb[7]+f|0}
oc.prototype.update=function(a,b){n(b)||(b=a.length);var c=0,d=this.fl;if(r(a))for(;c<b;)this.op[d++]=a.charCodeAt(c++),d==this.yk&&(tc(this),d=0);else if(ca(a))for(;c<b;){var e=a[c++];if(!("number"==typeof e&&0<=e&&255>=e&&e==(e|0)))throw Error("message must be a byte array");this.op[d++]=e;d==this.yk&&(tc(this),d=0)}else throw Error("message must be string or array");this.fl=d;this.os+=b};
oc.prototype.digest=function(){var a=[],b=8*this.os;56>this.fl?this.update(sc,56-this.fl):this.update(sc,this.yk-(this.fl-56));for(var c=63;56<=c;c--)this.op[c]=b&255,b/=256;tc(this);for(c=b=0;c<this.kL;c++)for(var d=24;0<=d;d-=8)a[b++]=this.Tb[c]>>d&255;return a};
var rc=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,
4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function uc(){oc.call(this,8,vc)}ra(uc,oc);var vc=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function wc(a,b){this.Bc=a|0;this.Db=b|0}var xc={},yc={};function zc(a){return-128<=a&&128>a?ob(xc,a,function(a){return new wc(a|0,0>a?-1:0)}):new wc(a|0,0>a?-1:0)}function Ac(a){return isNaN(a)?Bc():a<=-Cc?Dc():a+1>=Cc?Ec():0>a?Fc(Ac(-a)):new wc(a%Gc|0,a/Gc|0)}var Gc=4294967296,Cc=Gc*Gc/2;function Bc(){return ob(yc,Hc,function(){return zc(0)})}function Ic(){return ob(yc,Kc,function(){return zc(1)})}function Lc(){return ob(yc,Mc,function(){return zc(-1)})}
function Ec(){return ob(yc,Nc,function(){return new wc(-1,2147483647)})}function Dc(){return ob(yc,Oc,function(){return new wc(0,-2147483648)})}function Pc(){return ob(yc,Qc,function(){return zc(16777216)})}l=wc.prototype;
l.toString=function(a){a=a||10;if(2>a||36<a)throw Error("radix out of range: "+a);if(Rc(this))return"0";if(0>this.Db){if(this.equals(Dc())){var b=Ac(a),c=Sc(this,b),b=Tc(c.multiply(b),this);return c.toString(a)+b.Bc.toString(a)}return"-"+Fc(this).toString(a)}for(var c=Ac(Math.pow(a,6)),b=this,d="";;){var e=Sc(b,c),f=(Tc(b,e.multiply(c)).Bc>>>0).toString(a),b=e;if(Rc(b))return f+d;for(;6>f.length;)f="0"+f;d=""+f+d}};function Uc(a){return 0<=a.Bc?a.Bc:Gc+a.Bc}
function Rc(a){return 0==a.Db&&0==a.Bc}l.equals=function(a){return this.Db==a.Db&&this.Bc==a.Bc};l.compare=function(a){if(this.equals(a))return 0;var b=0>this.Db,c=0>a.Db;return b&&!c?-1:!b&&c?1:0>Tc(this,a).Db?-1:1};function Fc(a){return a.equals(Dc())?Dc():a.not().add(Ic())}
l.add=function(a){var b=this.Db>>>16,c=this.Db&65535,d=this.Bc>>>16,e=a.Db>>>16,f=a.Db&65535,g=a.Bc>>>16;a=0+((this.Bc&65535)+(a.Bc&65535));g=0+(a>>>16)+(d+g);d=0+(g>>>16);d+=c+f;b=0+(d>>>16)+(b+e)&65535;return new wc((g&65535)<<16|a&65535,b<<16|d&65535)};function Tc(a,b){return a.add(Fc(b))}
l.multiply=function(a){if(Rc(this)||Rc(a))return Bc();if(this.equals(Dc()))return 1==(a.Bc&1)?Dc():Bc();if(a.equals(Dc()))return 1==(this.Bc&1)?Dc():Bc();if(0>this.Db)return 0>a.Db?Fc(this).multiply(Fc(a)):Fc(Fc(this).multiply(a));if(0>a.Db)return Fc(this.multiply(Fc(a)));if(0>this.compare(Pc())&&0>a.compare(Pc()))return Ac((this.Db*Gc+Uc(this))*(a.Db*Gc+Uc(a)));var b=this.Db>>>16,c=this.Db&65535,d=this.Bc>>>16,e=this.Bc&65535,f=a.Db>>>16,g=a.Db&65535,h=a.Bc>>>16;a=a.Bc&65535;var k,m,p,t;t=0+e*a;
p=0+(t>>>16)+d*a;m=0+(p>>>16);p=(p&65535)+e*h;m+=p>>>16;m+=c*a;k=0+(m>>>16);m=(m&65535)+d*h;k+=m>>>16;m=(m&65535)+e*g;k=k+(m>>>16)+(b*a+c*h+d*g+e*f)&65535;return new wc((p&65535)<<16|t&65535,k<<16|m&65535)};
function Sc(a,b){if(Rc(b))throw Error("division by zero");if(Rc(a))return Bc();if(a.equals(Dc())){if(b.equals(Ic())||b.equals(Lc()))return Dc();if(b.equals(Dc()))return Ic();var c;c=1;if(0==c)c=a;else{var d=a.Db;c=32>c?new wc(a.Bc>>>c|d<<32-c,d>>c):new wc(d>>c-32,0<=d?0:-1)}c=Sc(c,b).shiftLeft(1);if(c.equals(Bc()))return 0>b.Db?Ic():Lc();a=Tc(a,b.multiply(c));return c.add(Sc(a,b))}if(b.equals(Dc()))return Bc();if(0>a.Db)return 0>b.Db?Sc(Fc(a),Fc(b)):Fc(Sc(Fc(a),b));if(0>b.Db)return Fc(Sc(a,Fc(b)));
for(d=Bc();0<=a.compare(b);){c=Math.max(1,Math.floor((a.Db*Gc+Uc(a))/(b.Db*Gc+Uc(b))));for(var e=Math.ceil(Math.log(c)/Math.LN2),e=48>=e?1:Math.pow(2,e-48),f=Ac(c),g=f.multiply(b);0>g.Db||0<g.compare(a);)c-=e,f=Ac(c),g=f.multiply(b);Rc(f)&&(f=Ic());d=d.add(f);a=Tc(a,g)}return d}l.not=function(){return new wc(~this.Bc,~this.Db)};l.shiftLeft=function(a){a&=63;if(0==a)return this;var b=this.Bc;return 32>a?new wc(b<<a,this.Db<<a|b>>>32-a):new wc(0,b<<a-32)};var Nc=1,Oc=2,Hc=3,Kc=4,Mc=5,Qc=6;Ua([128],ab(127));
for(var Vc=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,
1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,
1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,
289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],Wc=[],Xc=0;Xc<Vc.length;Xc+=2)Wc.push(new wc(Vc[Xc+1],Vc[Xc]));function v(){}qa("vitisApp",v);v.ol={};v.on=function(a,b){null!=v.ol[a]?v.ol[a].push(b):v.ol[a]=[b]};v.zk=function(a){if(null!=v.ol[a])for(var b=0;b<v.ol[a].length;b++)v.ol[a][b].call()};v.htmlentities=function(a){var b="\u00e0\u00e2\u00e7\u00e8\u00e9\u00ea\u00ee\u00ef\u00f4\u00f9\u00fb".split("");return a.replace(/./gm,function(a){return-1!=b.indexOf(a)?"&#"+a.charCodeAt(0)+";":a})};
$(document).ready(function(){$(document).on("show.bs.modal",".modal",function(){$(this).parent().append('<div class="submodal-backdrop modal-backdrop fade in"></div>')});$(document).on("hide.bs.modal",".modal",function(){$(this).parent().find(".submodal-backdrop").remove()})});
function Yc(a){for(var b=[/[\300-\306]/g,/[\340-\346]/g,/[\310-\313]/g,/[\350-\353]/g,/[\314-\317]/g,/[\354-\357]/g,/[\322-\330]/g,/[\362-\370]/g,/[\331-\334]/g,/[\371-\374]/g,/[\321]/g,/[\361]/g,/[\307]/g,/[\347]/g],c="AaEeIiOoUuNnCc".split(""),d=0;d<b.length;d++)a=a.replace(b[d],c[d]);return a}
function Zc(a){for(var b=["request","service","version"],c,d,e=0;e<b.length;e++)c=a.toLowerCase().indexOf("&"+b[e]+"="),-1!==c?(d=a.toLowerCase().indexOf("&",c+1),a=0<d?a.replace(a.slice(c,d),""):a.replace(a.slice(c),"")):(c=a.toLowerCase().indexOf("?"+b[e]+"="),-1!==c&&(d=a.toLowerCase().indexOf("&",c+1),a=0<d?a.replace(a.slice(c,d+1),"?"):a.replace(a.slice(c),"")));return a}
function $c(a){for(var b=new uc,c=[],d=0,e=0;e<a.length;e++){for(var f=a.charCodeAt(e);255<f;)c[d++]=f&255,f>>=8;c[d++]=f}b.update(c);a=b.digest();return a=mc(a)}NodeList.prototype.forEach||(NodeList.prototype.forEach=Array.prototype.forEach);function ad(a,b){var c=Date.now();"undefined"!=typeof oClientProperties&&(c=oClientProperties.build);if("object"==typeof a&&null!=a){var d,e=!0,f=!1;"object"===typeof b&&(d=b.callback,"boolean"===typeof b.async&&(e=b.async),"boolean"===typeof b.scriptInBody&&(f=b.scriptInBody));b=document.getElementsByTagName("script");for(var g=[],h=0;h<b.length;)""!==b[h].src&&g.push(b[h].src),h++;for(var h=0,k=[];h<a.length;)a[h]=a[h]+"?version="+c,b=document.createElement("script"),b.setAttribute("src",a[h]),
-1===cd(b.src,g)?k.push(a[h]):console.log(a[h]+" -> d\u00e9ja charg\u00e9"),h++;for(h=0;h<k.length;){b=document.createElement("script");b.setAttribute("src",k[h]);b.async=e;b.setAttribute("type","text/javascript");if("function"===typeof d){var m=function(){"undefined"===typeof d.Yu&&(d.Yu=0);d.Yu++;d.Yu===k.length&&(d(),this.onload=null)};void 0!==b.onload?b.onload=m:void 0!==b.onreadystatechange&&(b.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||m()})}f?document.getElementsByTagName("body")[0].appendChild(b):
document.getElementsByTagName("head")[0].appendChild(b);h++}0===k.length&&"function"===typeof d&&d()}}
function dd(a){if("object"==typeof a&&null!=a){var b=Date.now();"undefined"!=typeof oClientProperties&&(b=oClientProperties.build);for(var c=document.getElementsByTagName("link"),d=[],e=0;e<c.length;)""!=c[e].href&&d.push(c[e].href),e++;for(var e=0,f=!1;e<a.length;)a[e]=a[e]+"?version="+b,c=document.createElement("link"),c.setAttribute("href",a[e]),-1==cd(c.href,d)?(c.setAttribute("type","text/css"),-1==a[e].indexOf(".less")?(c.setAttribute("rel","stylesheet"),document.getElementsByTagName("head")[0].appendChild(c)):
(c.setAttribute("rel","stylesheet/less"),less.sheets.push(c),f=!0)):console.log(a[e]+" -> d\u00e9ja charg\u00e9"),e++;f&&less.refresh()}}function cd(a,b){var c=-1;if("undefined"!=typeof b.indexOf)c=b.indexOf(a);else for(var d=0;d<b;){if(-1!=b[d].indexOf(a)){c=d;break}d++}return c}
function ed(){if(null===document.getElementById("ajax-modal")){var a=document.createElement("div");a.id="ajax-modal";a.className="modal-backdrop fade in";a.style.opacity="0.2";a.style["z-index"]="9999";document.getElementsByTagName("body")[0].appendChild(a)}if(null===document.getElementById("ajax-container")){var a=document.createElement("div"),b=document.createElement("span");a.id="ajax-container";a.className="ajax_loader_container";b.className="icon-refresh glyphicon-refresh-animate";a.appendChild(b);
document.getElementsByTagName("body")[0].appendChild(a)}}function fd(){sessionStorage.loading_counter=0;var a=document.getElementById("ajax-modal");null!=a&&a.parentNode.removeChild(a);a=document.getElementById("ajax-container");null!=a&&a.parentNode.removeChild(a)}
function A(a){var b=new XMLHttpRequest,c=angular.copy(oClientProperties.web_server_name);-1!==c.indexOf(":",6)&&(c=c.substr(0,c.indexOf(":",6)));var d=!1;a.url.substr(0,c.length)===c&&(d=!0);"string"==typeof oClientProperties.proxy_url&&a.url.substr(0,oClientProperties.proxy_url.length)===oClientProperties.proxy_url&&(d=!1);c={Accept:"application/json"};d&&!1!==a.sendToken&&(c.Token=sessionStorage.session_token);"undefined"==typeof a.async&&(a.async=!0);"undefined"!=typeof a.headers&&gd(c,a.headers);
null!=a.timeout||null!=oClientProperties.max_request_time&&(a.timeout=1E3*oClientProperties.max_request_time);switch(a.responseType){case "":break;case "text":break;case "json":break;case "blob":break;case "arraybuffer":break;case "document":break;default:a.responseType="json"}"undefined"==typeof a.disconnect&&(a.disconnect=!0);if("undefined"!=typeof a.method&&"undefined"!=typeof a.url){b.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE){switch(a.responseType){case "":case "text":var c=
{data:this.responseText,status:this.status,statusText:this.statusText};break;default:c={data:this.response,status:this.status,statusText:this.statusText}}null!=c.data&&"json"==a.responseType&&"string"==typeof c.data&&(c.data=JSON.parse(c.data));if(200===this.status){if("json"==a.responseType&&null!=c.data&&"object"==typeof c.data){var d=angular.element(v.Wb).injector().get(["sessionSrvc"]),e=angular.element(v.Wb).injector().get(["externFunctionSrvc"]),f={className:"modal-danger",buttons:{ok:{label:"OK",
className:"btn-default"}},callback:function(){!0===a.disconnect&&d.disconnect()}},p="";if(null!=c.data)switch(c.data.errorCode){case 15:p="EXPIRED_TOKEN_ERROR_TITLE";f.message=!0===a.disconnect?"EXPIRED_TOKEN_ERROR":"EXPIRED_TOKEN_NO_DISCONNECT_ERROR";break;case 16:p="INVALID_TOKEN_ERROR_TITLE",f.message=!0===a.disconnect?"INVALID_TOKEN_ERROR":"INVALID_TOKEN_NO_DISCONNECT_ERROR"}n(f.message)&&e.modalWindow("alert",p,f)}"function"==typeof a.success&&("undefined"!=typeof a.scope?a.scope.$applyAsync(a.success(c)):
a.success(c))}else 500<=parseInt(this.status)&&600>parseInt(this.status)?(e=angular.element(v.Wb).injector().get(["externFunctionSrvc"]),f={className:"modal-danger",buttons:{ok:{label:"OK",className:"btn-default"}},message:"ERROR_SERVER_REQUEST_500",translationData:{status:this.status,statusText:this.statusText}},e.modalWindow("alert","REQUEST_ERROR",f)):!0===b.aborded?"function"==typeof a.aborded&&("undefined"!=typeof a.scope?a.scope.$applyAsync(a.aborded(c)):a.aborded(c)):(console.error(a.url,this),
"function"==typeof a.error&&("undefined"!=typeof a.scope?a.scope.$applyAsync(a.error(c)):a.error(c)));setTimeout(function(){var a=parseInt(sessionStorage.loading_counter);0<a?a--:a=0;sessionStorage.loading_counter=a;0===a&&fd()})}};a.url=-1===a.url.indexOf("?")?a.url+("?vitis_version="+sessionStorage.build):a.url+("&vitis_version="+sessionStorage.build);if("undefined"!=typeof a.params){a.params=hd(a.params,a.url);for(var e in a.params)ha(a.params[e])&&(a.params[e]=JSON.stringify(a.params[e])),a.url+=
"&"+e+"="+encodeURIComponent(a.params[e])}-1==navigator.userAgent.indexOf("Trident")&&(b.responseType=a.responseType);b.open(a.method,a.url,a.async);-1!=navigator.userAgent.indexOf("Trident")&&(b.responseType=a.responseType);for(var f in c)b.setRequestHeader(f,c[f]);d=null;"undefined"!=typeof a.data&&ha(a.data)&&(d=a.data instanceof FormData?a.data:JSON.stringify(hd(a.data,a.url)));b.send(d);"true"==sessionStorage.ajaxLoader&&!1!==a.ajaxLoader&&ed();d=parseInt(sessionStorage.loading_counter);d++;
sessionStorage.loading_counter=d;ea(a.timeout)&&setTimeout(function(){if(4!==b.readyState&&!0!==b.aborded){var c=a.timeout/1E3,d,e,f=function(){e=bootbox.confirm({message:"Requ\u00eate sans r\u00e9ponse",buttons:{confirm:{label:"Annuler",className:"btn-success"},cancel:{label:"Attendre",className:"btn-default"}},callback:function(c){c?(b.abort(),console.info("request aborded"),clearInterval(d)):setTimeout(function(){4!==b.readyState&&f()},a.timeout)}})};f();e.init(function(){function a(){var a="<h4>Requ\u00eate sans r\u00e9ponse depuis "+
c+"s...</h4>";e.find(".bootbox-body").html(a)}d=window.setInterval(function(){4===b.readyState&&(e.modal("hide"),clearInterval(d));100<c&&(b.abort(),console.info("request aborded"),clearInterval(d));a();c++},1E3);a()})}},a.timeout);ha(a.abord)&&ga(a.abord.then)&&a.abord.then(function(){b.aborded=!0;b.abort()},function(){b.aborded=!0;b.abort()})}}qa("ajaxRequest",A);function gd(a,b){for(var c in b)a[c]=b[c]}
function hd(a,b){for(var c in a)if(n(a[c])||jb(a,c),"token"===c||"undefined"!=typeof sessionStorage.session_token&&a[c]===sessionStorage.session_token)console.error("Token in params:",a,b),alert("Attention: token pass\u00e9 en param\u00e8tre"),jb(a,c);return a};var B={};qa("oVmap",B);B.module=angular.module("vmap",["formReader"]);B.config=function(a){a.defaults.headers.get={Accept:"application/x-vm-json"};a.defaults.headers.post={Accept:"application/x-vm-json"}};B.config.$inject=["$httpProvider"];B.module.config(B.config);B.HL=function(){return function(a,b,c){var d=[];angular.forEach(a,function(a){d.push(a)});d.sort(function(a,c){return a[b]>c[b]?1:-1});c&&d.reverse();return d}};B.module.filter("orderObjectBy",B.HL);B.F=function(){return function(a){return typeof a}};
B.module.filter("getType",B.F);B.nn=function(){return function(a){return null!=a}};B.module.filter("isDef",B.nn);B.properties={};B.YB={};B.oa={};B.D={};B.log=function(a,b){null!=B.properties&&B.properties.debug_mode&&(n(b)?console.log(a,b):console.log(a))};B.log=B.log;
B.yj=function(){B.log("oVmap.init");v.zk("vmapLoaded");if(null!=angular.element($("#app-vmap-loader")).scope())angular.element($("#app-vmap-loader")).scope().compileVmapTemplates();else v.on("vmapLoaderOk",function(){angular.element($("#app-vmap-loader")).scope().compileVmapTemplates()});var a=window.location.href;a.slice(0,a.lastIndexOf("/"));null!=sessionStorage.application||(sessionStorage.application=document.location.pathname.replace(/\//g,""));B.properties=window.oClientProperties;B.properties.api_url=
B.properties.web_server_name+"/"+B.properties.services_alias;B.properties.token=n(sessionStorage.session_token)?sessionStorage.session_token:B.Sz("token",window.location.href);null!=B.properties.token&&(A({method:"GET",url:B.properties.api_url+"/vitis/properties",async:!1,responseType:"",success:function(a){a=JSON.parse(a.data);mb(B.properties,a);B.log("properties: ",B.properties)}}),A({method:"GET",url:B.properties.api_url+"/vmap/crss",success:function(a){a=a.data.crss;B.oProjections={};for(var b=
0;b<a.length;b++)B.oProjections[a[b].crs_id]=a[b].name}}));B.YB=new C;B.oa=new id;B.D=new jd;B.QC();$(window).resize(B.QC);$('[data-toggle="tooltip"]').tooltip({animation:!1});B.rQ=0;null!=v.oWebsocket&&v.oWebsocket.LD("VmapEvents")};B.init=B.yj;function kd(){B.log("oVmap.vmapDirective");v.zk("vmapDirectiveLoaded");return{restrict:"A",controller:"AppVmapController",controllerAs:"vmapCtrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/vmap.html"}}B.vmapDirective=kd;
function ld(a){B.log("oVmap.vmapController");this.lang=this.lang="fr";this.bottom_open=this.right_open=this.left_open=!1;this.map=this.map=B.g().B;this.gz=this.currentAction="";this.kM=this.proj=E(this.map).J().Z;this.jQ=this.infos=[];B.scope=angular.element("#app-vmap").scope();B.ctrl=B.scope.vmapCtrl;B.$sanitize=a;B.scope.sizeOf=function(a){return Object.keys(a).length};B.scope.isDef=function(a){return null!=a};B.scope.$on("mapChanged",function(){B.scope.$applyAsync(function(){B.scope.ctrl.bottom_open=
!1;B.LB()});B.vD("tool-btn-active")})}B.vmapController=ld;ld.$inject=["$sanitize"];B.g=function(){return this.YB};B.getMap=B.g;B.wu=function(){return this.oa};B.getMapManager=B.wu;B.yI=function(){return this.D};B.getToolsManager=B.yI;B.Sz=function(a,b){if(-1!==b.indexOf("?")&&(b=b.slice(b.indexOf("?")+1),-1!==b.indexOf(a+"=")))return b=b.slice(b.indexOf(a+"=")),-1!==b.indexOf("&")&&(a=b.indexOf("&"),b=b.slice(0,a)),a=b.indexOf("="),b=b.slice(a+1)};B.findInURL=B.Sz;
B.ZA=function(){$("#current-projection").html(B.oProjections[E(B.g().B).J().Z]);for(var a=B.oa.Zb,b=0;b<a.maps.length;b++)if(!0===a.maps[b].used)var c=a.maps[b].name;$("#map-name").html(c)};B.qQ=function(a,b,c){if(c>=a.length)for(var d=c-a.length;d--+1;)a.push(void 0);a.splice(c,0,a.splice(b,1)[0]);return a};
B.Cx=function(a){a="object"!==typeof a?JSON.parse(a):a;var b="",c="";if($("#quote").is(":checked"))for(var d in a[0])var e=d+"",c=c+('"'+e.replace(/"/g,'""')+'",');else for(d in a[0])c+=d+",";for(var c=c.slice(0,-1),b=b+(c+"\r\n"),f=0;f<a.length;f++){c="";for(d in a[f])e=a[f][d]+"",c+='"'+e.replace(/"/g,'""')+'",';c=c.slice(0,-1);b+=c+"\r\n"}return b};
B.Vl=function(a){B.log("simuleClick : "+a);if(null!=document.getElementById(a)){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);document.getElementById(a).dispatchEvent(b);b=document.createEvent("MouseEvents");b.initMouseEvent("mouseout",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);document.getElementById(a).dispatchEvent(b)}else console.error("target undefined: ",a)};B.simuleClick=B.Vl;
B.vD=function(a){B.log("simuleClickOnClass : "+a);var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);for(var c=document.getElementsByClassName(a),d=0;d<c.length;d++)c[d].dispatchEvent(b);b=document.createEvent("MouseEvents");b.initMouseEvent("mouseout",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);c=document.getElementsByClassName(a);for(d=0;d<c.length;d++)c[d].dispatchEvent(b)};B.simuleClickOnClass=B.vD;
B.UG=function(a,b){$("#"+b).show();var c=document.getElementById(b),d=c.getElementsByTagName("*").length,e=fc("div",{id:b+"_"+d,"class":"alert alert-warning",role:"alert"},null);c.appendChild(e);c=fc("button",{"class":"close"},"x");c.onclick=function(){$("#"+b+"_"+d).hide()};e.appendChild(c);a=fc("strong",null,a);e.appendChild(a)};B.displaySucces=B.UG;
B.IG=function(a,b){$("#"+b).show();var c=document.getElementById(b),d=c.getElementsByTagName("*").length,e=fc("div",{id:b+"_"+d,"class":"alert alert-warning",role:"alert"},null);c.appendChild(e);c=fc("button",{"class":"close"},"x");c.onclick=function(){$("#"+b+"_"+d).hide()};e.appendChild(c);a=fc("strong",null,a);e.appendChild(a)};B.displayInfo=B.IG;
B.XG=function(a,b){$("#"+b).show();var c=document.getElementById(b),d=c.getElementsByTagName("*").length,e=fc("div",{id:b+"_"+d,"class":"alert alert-warning",role:"alert"},null);c.appendChild(e);c=fc("button",{"class":"close"},"x");c.onclick=function(){$("#"+b+"_"+d).hide()};e.appendChild(c);a=fc("strong",null,a);e.appendChild(a)};B.displayWarning=B.XG;
B.EG=function(a,b){a="Erreur: "+a;$("#"+b).show();var c=document.getElementById(b),d=c.getElementsByTagName("*").length,e=fc("div",{id:b+"_"+d,"class":"alert alert-warning",role:"alert"},null);c.appendChild(e);c=fc("button",{"class":"close"},"x");c.onclick=function(){$("#"+b+"_"+d).hide()};e.appendChild(c);a=fc("strong",null,a);e.appendChild(a)};B.displayError=B.EG;
B.pz=function(a,b){var c=0,d=0;n(a.target)&&$(a.target).animate({opacity:0},300,"linear").animate({opacity:1},300,"linear").animate({opacity:0},300,"linear").animate({opacity:1},300,"linear").animate({opacity:0},300,"linear").animate({opacity:1},300,"linear");if(n(a.target)){var e=$(a.target).offset();a.coordinates=[e.left,e.top]}if(!n(a.coordinates))return 0;a.type=n(a.type)?a.type:"top-right";var f=fc("div",{"class":"tooltip-error tooltip-error-"+a.type,role:"alert"},null);b=fc("strong",null,b);
document.body.appendChild(f);f.appendChild(b);"top-left"===a.type?(c=n(a.target)?0-f.offsetWidth+33:0-f.offsetWidth+13,d=0-f.offsetHeight-12):"top-right"===a.type?(c=$(a.target).width()-35,d=0-f.offsetHeight-12):"bottom-left"===a.type?(c=0-f.offsetWidth+33,d=$(a.target).height()+12):"bottom-right"===a.type&&(c=$(a.target).width()-35,d=$(a.target).height()+12);f.style.left=a.coordinates[0]+c+"px";f.style.top=a.coordinates[1]+d+"px";Yb(document.body,"click",function(a){B.log("remove error tooltip");
a.target!==f&&document.body.removeChild(f)});return f};B.displayTooltipError=B.pz;
B.Pj=function(a){function b(a){return"out"===$("#"+a).attr("collapse")?!0:!1}B.log("oVmap.resizeLayerTools: "+a);if(B.properties.is_mobile)return null;n(angular.element($("#olMap")).scope())&&angular.element($("#olMap")).scope().ctrl.no();for(var c=["layertree","layersorder","maplegendcontainer"],d=0,e=c.length,f=0,f=$("#maplistlitle-container").height(),g=0;g<c.length;g++)f+=$("#"+c[g]+"-button").height(),!0===b(c[g])&&d++;for(var h=[],k=[],f=($("#left-sidebar").height()-f)/(e-d)-0,g=0;g<c.length;g++)h[g]=
$("#"+c[g]).css("max-height"),$("#"+c[g]).css({"max-height":""}),k[g]=$("#"+c[g]).height(),$("#"+c[g]).css({"max-height":h[g]}),!1===b(c[g])?h[g]=f:h[g]=0;(function(c,d,e){for(var f=[],g=[],h=[],k=0,m=0;m<c.length;m++)e[m]>=d[m]&&!1===b(c[m])?(f.push(c[m]),g.push(e[m]),h.push(d[m])):(d[m]>e[m]&&(k+=d[m]-e[m]),!0===a?$("#"+c[m]).animate({"max-height":d[m]}):$("#"+c[m]).css({"max-height":d[m]}));for(m=0;m<f.length;m++)c=k/f.length,!0===a?$("#"+f[m]).animate({"max-height":h[m]+c}):$("#"+f[m]).css({"max-height":h[m]+
c})})(c,h,k)};B.resizeLayerTools=B.Pj;
B.hM=function(a){B.log("print: "+a);var b=this;a=$(a).html();this.sg=window.open("","Impression","height=400,width=600");this.sg.document.write("<html><head><title>Impression</title>");this.sg.document.write($("HEAD").html());this.sg.document.write("<style>.print-hidden{visibility: hidden !important;}</style>");this.sg.document.write("</head><body>");this.sg.document.write(a);this.sg.document.write("</body></html>");setTimeout(function(){b.sg.document.close();b.sg.focus();b.sg.print();b.sg.close()},
500)};B.printElem=B.hM;B.GK=function(){angular.element($("#olMap")).scope().ctrl.no();$(".open-more-selection-info").toggleClass("reverse");$("#map-container").hasClass("open2")?($("#map-container").removeClass("open2"),$("#bottombar").removeClass("open2")):($("#map-container").addClass("open2"),$("#bottombar").addClass("open2"))};B.maxResizeBottomBar=B.GK;
B.LB=function(){angular.element($("#olMap")).scope().ctrl.no();$("#map-container").hasClass("open2")?($("#map-container").removeClass("open2"),$("#bottombar").removeClass("open2"),$(".open-more-selection-info").removeClass("reverse")):$("#map-container").hasClass("open")&&$("#map-container").addClass("minus")};B.minResizeBottomBar=B.LB;B.QC=function(){B.Pj(!1)};
B.gI=function(a,b){B.log("getMultiGeomFromSingleFeatures");var c,d,e;if("MultiPoint"===b)c=new md;else if("MultiLineString"===b)c=new nd;else if("MultiPolygon"===b)c=new od;else return console.error("startSelection: type ("+b+") not allowed"),null;for(var f=0;f<a.length;f++){d=a[f].j();if(d.F()===b){if("MultiPoint"===b)e=d.pj();else if("MultiLineString"===b)e=pd(d);else if("MultiPolygon"===b)e=qd(d);else return console.error("startSelection: type ("+b+") not allowed"),null;for(var g=0;g<e.length;g++)if("MultiPoint"===
b)rd(c,e[g]);else if("MultiLineString"===b)sd(c,e[g]);else if("MultiPolygon"===b)ud(c,e[g]);else return console.error("startSelection: type ("+b+") not allowed"),null}if(d.F()===b.substr(5))if("MultiPoint"===b)rd(c,d);else if("MultiLineString"===b)sd(c,d);else if("MultiPolygon"===b)ud(c,d);else return console.error("startSelection: type ("+b+") not allowed"),null}return new vd({geometry:c})};B.gA=function(a,b){B.log("getEWKTFromWKT");return wd(a,b)};B.getEWKTFromWKT=B.gA;
B.CI=function(a){B.log("getWKTFromEWKT");return xd(a)};B.getWKTFromEWKT=B.CI;B.Oe=function(a,b){B.log("getEWKTFromGeom",a);b=null!=b?b:E(B.g().B).J().Z;return yd(a,b)};B.getEWKTFromGeom=B.Oe;B.OJ=function(a){B.log("isEWKTGeom");return zd(a)};B.isEWKTGeom=B.OJ;B.xf=function(a,b){B.log("getGeomFromEWKT");b=null!=b?b:E(B.g().B).J().Z;return Ad(a,b)};B.getGeomFromEWKT=B.xf;
B.pA=function(){var a=[];$('link[rel="stylesheet"]').each(function(){A({method:"GET",url:$(this).attr("href"),async:!1,responseType:"",success:function(b){b=b.data;var c=document.createElement("style");c.type="text/css";c.styleSheet?c.styleSheet.cssText=b:c.appendChild(document.createTextNode(b));a.push(c)}})});$("style").each(function(){var b=this.innerHTML,c=document.createElement("style");c.type="text/css";c.styleSheet?c.styleSheet.cssText=b:c.appendChild(document.createTextNode(b));a.push(c)});
return a};B.getStyles=B.pA;
B.Up=function(a){B.log("oVmap.generatePrintReport");if(null==a.printReportId)return console.error("generatePrintReport: opt_options.printReportId undefined"),0;if(null==a.ids)return console.error("generatePrintReport: opt_options.ids undefined"),0;var b=a.printReportId;a=a.ids;for(var c="",d=0;d<a.length;d++)0<d&&(c+="|"),c+=a[d];var e=window.open("","_blank","height=400,width=600");if(null==e)return $.notify("Fen\u00eatre d'impression bloqu\u00e9e par le navigateur","error"),0;e.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>');
A({method:"POST",url:B.properties.api_url+"/vmap/printreportservices",headers:{Accept:"application/x-vm-json"},data:{printreport_id:b,ids:c},timeout:3E5,success:function(a){var b=!1;null!=a.data?null!=a.data.printreportservices?null!=a.data.printreportservices.fileurl?1!==a.data.status&&(b=!0):b=!0:b=!0:b=!0;if(b)return $.notify("Une erreur est survenue lors de l'impression","error"),e.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">Une erreur est survenue lors de l\'impression</div>'),
console.error("response: ",a),0;$.notify("Impression r\u00e9ussie","success");for(var b=B.pA(),c=0;c<b.length;c++)try{e.document.head.appendChild(b[c])}catch(k){}e.document.body.style.textAlign="center";e.document.body.innerHTML='<a href="'+a.data.printreportservices.fileurl+'" style="margin-top: calc(50vh - 46px);" class="btn btn-lg btn-primary btn-bs btn-outline" download>T\u00e9l\u00e9charger le rapport</a>'},error:function(){$.notify("Une erreur est survenue lors de l'impression","error");e.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">Une erreur est survenue lors de l\'impression</div>')}})};
B.generatePrintReport=B.Up;B.pn=function(a,b){if(null==a||!r(a))return!1;b=null!=b?b:"link";return-1!==a.indexOf("["+b)&&-1!==a.indexOf("[/"+b+"]")?!0:!1};B.isLink=B.pn;
B.Jn=function(a,b){if(null==a||!r(a))return"";b=null!=b?b:"link";var c=a.substr(a.indexOf("["+b),a.indexOf("[/"+b+"]")-a.indexOf("["+b)+10),d=B.LH(c);b=B.XH(c,d,"[/"+b+"]");c=B.YH(d);d=null!=c.href?c.href:null;c=null!=c.target?c.target:"_blank";b=0<b.length?b:d;if(null!=d)return'<a href="'+d+'" target="'+c+'">'+b+"</a>";console.error("cannot parse href");return a};B.parseLink=B.Jn;
B.LH=function(a){for(var b=null,c=null,d,e="",f=0;f<a.length;f++)if(e+=a[f],'"'===a[f]&&null===b&&"\\"!==a[f-1])b=f;else if('"'===a[f]&&null===c&&null!==b&&"\\"!==a[f-1])c=f;else if(null!==b&&null===c?d=!0:(d=!1,null!==b&&null!==c&&(c=b=null)),!d&&"]"===a[f])break;return e};B.XH=function(a,b,c){a=a.substr(a.indexOf(b)+b.length);return a.substr(0,a.indexOf(c))};
B.YH=function(a){for(var b=null,c=null,d=null,e=null,f=null,g=null,h,k={},m=0;m<a.length;m++)'"'===a[m]&&null===b&&"\\"!==a[m-1]?b=m:'"'===a[m]&&null===c&&null!==b&&"\\"!==a[m-1]?c=m:(null!==b&&null===c?h=!0:(h=!1,null!==b&&null!==c&&(f=a.substr(b+1,c-b-1),c=b=null)),h||(" "===a[m]&&null===d&&(d=m),"="===a[m]&&null===e&&(e=m),null!==d&&null!==e&&(g=a.substr(d+1,e-d-1),e=d=null)),null!==f&&null!==g&&(k[g]=f,g=f=null));return k};
B.gj=function(a,b){if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(a,b);else{var c=document.createElement("a");a=window.URL.createObjectURL(a);document.body.appendChild(c);c.style="display: none";c.href=a;c.download=b;c.click();window.URL.revokeObjectURL(a)}};B.downloadBlob=B.gj;
B.Dy=function(a,b){return{link:function(c,d){b.log("formReader.appSubformDrtv.link");var e;c.compileVmapTemplates=function(){b.log("compileVmapTemplates");c.$applyAsync(function(){e=a('<div app-vmap id="app-vmap"></div>')(c);d.html("");d.append(e)})};v.zk("vmapLoaderOk")}}};B.Dy.$inject=["$compile","$log"];B.module.directive("appVmapLoader",B.Dy);B.module.directive("appVmap",kd);B.module.controller("AppVmapController",ld);var Bd,Cd;function F(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a}function Dd(){}function I(a){return a.gC||(a.gC=++Ed)}var Ed=0;function Fd(a){this.message="Assertion failed. See https://openlayers.org/en/latest/doc/errors/#"+a+" for details.";this.code=a;this.name="AssertionError"}F(Fd,Error);var Gd="function"===typeof Object.assign?Object.assign:function(a,b){if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var c=Object(a),d=1,e=arguments.length;d<e;++d){var f=arguments[d];if(void 0!==f&&null!==f)for(var g in f)f.hasOwnProperty(g)&&(c[g]=f[g])}return c};function Hd(a){for(var b in a)delete a[b]}function Id(a){var b=[],c;for(c in a)b.push(a[c]);return b}function Jd(a){for(var b in a)return!1;return!b};function Kd(a){function b(b){var c=a.listener,e=a.Oy||a.target;a.Bk&&Ld(a);return c.call(e,b)}return a.Ry=b}function Md(a,b,c,d){for(var e,f=0,g=a.length;f<g;++f)if(e=a[f],e.listener===b&&e.Oy===c)return d&&(e.deleteIndex=f),e}function Nd(a,b){return(a=a.or)?a[b]:void 0}function Od(a){var b=a.or;b||(b=a.or={});return b}
function Pd(a,b){var c=Nd(a,b);if(c){for(var d=0,e=c.length;d<e;++d)a.removeEventListener(b,c[d].Ry),Hd(c[d]);c.length=0;if(c=a.or)delete c[b],0===Object.keys(c).length&&delete a.or}}function J(a,b,c,d,e){var f=Od(a),g=f[b];g||(g=f[b]=[]);(f=Md(g,c,d,!1))?e||(f.Bk=!1):(f={Oy:d,Bk:!!e,listener:c,target:a,type:b},a.addEventListener(b,Kd(f)),g.push(f));return f}function Qd(a,b,c,d){return J(a,b,c,d,!0)}function Td(a,b,c,d){(a=Nd(a,b))&&(c=Md(a,c,d,!0))&&Ld(c)}
function Ld(a){if(a&&a.target){a.target.removeEventListener(a.type,a.Ry);var b=Nd(a.target,a.type);if(b){var c="deleteIndex"in a?a.deleteIndex:b.indexOf(a);-1!==c&&b.splice(c,1);0===b.length&&Pd(a.target,a.type)}Hd(a)}}function Ud(a){var b=Od(a),c;for(c in b)Pd(a,c)};function Vd(){}Vd.prototype.fj=!1;Vd.prototype.ue=function(){this.fj||(this.fj=!0,this.Ya())};Vd.prototype.Ya=Dd;function Wd(a){this.type=a;this.target=null}Wd.prototype.preventDefault=Wd.prototype.stopPropagation=function(){this.vC=!0};function Xd(a){a.stopPropagation()};function Yd(){this.Kn={};this.Hk={};this.Bj={}}F(Yd,Vd);l=Yd.prototype;l.addEventListener=function(a,b){var c=this.Bj[a];c||(c=this.Bj[a]=[]);-1===c.indexOf(b)&&c.push(b)};
l.dispatchEvent=function(a){var b="string"===typeof a?new Wd(a):a;a=b.type;b.target=this;var c=this.Bj[a],d;if(c){a in this.Hk||(this.Hk[a]=0,this.Kn[a]=0);++this.Hk[a];for(var e=0,f=c.length;e<f;++e)if(!1===c[e].call(this,b)||b.vC){d=!1;break}--this.Hk[a];if(0===this.Hk[a]){b=this.Kn[a];for(delete this.Kn[a];b--;)this.removeEventListener(a,Dd);delete this.Hk[a]}return d}};l.Ya=function(){Ud(this)};l.hasListener=function(a){return a?a in this.Bj:0<Object.keys(this.Bj).length};
l.removeEventListener=function(a,b){var c=this.Bj[a];c&&(b=c.indexOf(b),a in this.Kn?(c[b]=Dd,++this.Kn[a]):(c.splice(b,1),0===c.length&&delete this.Bj[a]))};function Zd(){Yd.call(this);this.Xa=0}F(Zd,Yd);function $d(a){if(Array.isArray(a))for(var b=0,c=a.length;b<c;++b)Ld(a[b]);else Ld(a)}Zd.prototype.L=function(){++this.Xa;this.dispatchEvent("change")};Zd.prototype.on=function(a,b,c){if(Array.isArray(a)){for(var d=a.length,e=Array(d),f=0;f<d;++f)e[f]=J(this,a[f],b,c);return e}return J(this,a,b,c)};
function ae(a){var b=B.g().B;if(Array.isArray("postcompose"))for(var c=Array(11),d=0;11>d;++d)c[d]=Qd(b,"postcompose"[d],a,void 0);else Qd(b,"postcompose",a,void 0)};function be(a){Zd.call(this);I(this);this.Ki={};void 0!==a&&ce(this,a)}F(be,Zd);var de={};function ee(a){return de.hasOwnProperty(a)?de[a]:de[a]="change:"+a}be.prototype.get=function(a){var b;this.Ki.hasOwnProperty(a)&&(b=this.Ki[a]);return b};be.prototype.cq=function(){return Object.keys(this.Ki)};function fe(a){return Gd({},a.Ki)}be.prototype.notify=function(a,b){var c;c=ee(a);this.dispatchEvent(new ge(c,a,b));this.dispatchEvent(new ge("propertychange",a,b))};
be.prototype.set=function(a,b,c){c?this.Ki[a]=b:(c=this.Ki[a],this.Ki[a]=b,c!==b&&this.notify(a,c))};function ce(a,b){for(var c in b)a.set(c,b[c],void 0)}function ge(a,b,c){Wd.call(this,a);this.key=b;this.oldValue=c}F(ge,Wd);function he(a,b){be.call(this);this.ex=!!(b||{}).unique;this.Ge=a?a:[];if(this.ex)for(a=0,b=this.Ge.length;a<b;++a)ie(this,this.Ge[a],a);je(this)}F(he,be);l=he.prototype;l.clear=function(){for(;0<this.cc();)this.pop()};l.extend=function(a){var b,c;b=0;for(c=a.length;b<c;++b)this.push(a[b]);return this};l.forEach=function(a,b){a=b?a.bind(b):a;b=this.Ge;for(var c=0,d=b.length;c<d;++c)a(b[c],c,b)};l.P=function(){return this.Ge};l.item=function(a){return this.Ge[a]};l.cc=function(){return this.get(ke)};
l.pop=function(){return le(this,this.cc()-1)};l.push=function(a){this.ex&&ie(this,a);var b=this.cc();this.ex&&ie(this,a);this.Ge.splice(b,0,a);je(this);this.dispatchEvent(new me("add",a));return this.cc()};l.remove=function(a){var b=this.Ge,c,d;c=0;for(d=b.length;c<d;++c)if(b[c]===a)return le(this,c)};function le(a,b){var c=a.Ge[b];a.Ge.splice(b,1);je(a);a.dispatchEvent(new me("remove",c));return c}function je(a){a.set(ke,a.Ge.length)}
function ie(a,b,c){for(var d=0,e=a.Ge.length;d<e;++d)if(a.Ge[d]===b&&d!==c)throw new Fd(58);}var ke="length";function me(a,b){Wd.call(this,a);this.element=b}F(me,Wd);function ne(a,b,c){Wd.call(this,a);this.map=b;this.wf=void 0!==c?c:null}F(ne,Wd);function oe(a,b,c,d,e){ne.call(this,a,b,e);this.originalEvent=c;this.Sc=pe(b,c);this.Qb=b.zc(this.Sc)}F(oe,ne);oe.prototype.preventDefault=function(){ne.prototype.preventDefault.call(this);this.originalEvent.preventDefault()};oe.prototype.stopPropagation=function(){ne.prototype.stopPropagation.call(this);this.originalEvent.stopPropagation()};var qe=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function re(a,b){var c,d,e=qe.length;for(d=0;d<e;++d)try{if(c=a.getContext(qe[d],b))return c}catch(f){}return null};var se,te="undefined"!==typeof navigator?navigator.userAgent.toLowerCase():"",ue=-1!==te.indexOf("firefox"),ve=-1!==te.indexOf("safari")&&-1==te.indexOf("chrom"),ye=-1!==te.indexOf("webkit")&&-1==te.indexOf("edge"),ze=-1!==te.indexOf("macintosh"),Ae=window.devicePixelRatio||1,Be=!1;(function(){if(!("HTMLCanvasElement"in window))return!1;try{var a=document.createElement("CANVAS").getContext("2d");return a?(void 0!==a.setLineDash&&(Be=!0),!0):!1}catch(b){return!1}})();
var Ce="geolocation"in navigator,De="ontouchstart"in window,Ee="PointerEvent"in window,Fe=!!navigator.msPointerEnabled,Ge=!1,He,Ie=[];if("WebGLRenderingContext"in window)try{var Je=re(document.createElement("CANVAS"),{failIfMajorPerformanceCaveat:!0});Je&&(Ge=!0,He=Je.getParameter(Je.MAX_TEXTURE_SIZE),Ie=Je.getSupportedExtensions())}catch(a){}se=Ge;Cd=Ie;Bd=He;var Ke={GP:"singleclick",rP:"click",sP:"dblclick",xP:"pointerdrag",AP:"pointermove",wP:"pointerdown",FP:"pointerup",EP:"pointerover",BP:"pointerout",yP:"pointerenter",zP:"pointerleave",vP:"pointercancel"};function Le(a,b,c,d,e){oe.call(this,a,b,c.originalEvent,0,e);this.vr=c}F(Le,oe);function Me(a,b){this.qb=a;this.Yq=b};function Ne(a){Me.call(this,a,{mousedown:this.mousedown,mousemove:this.mousemove,mouseup:this.mouseup,mouseover:this.mouseover,mouseout:this.mouseout});this.tc=a.tc;this.YA=[]}F(Ne,Me);function Oe(a,b){a=a.YA;var c=b.clientX;b=b.clientY;for(var d=0,e=a.length,f;d<e&&(f=a[d]);d++){var g=Math.abs(b-f[1]);if(25>=Math.abs(c-f[0])&&25>=g)return!0}return!1}
function Pe(a){var b=Qe(a,a),c=b.preventDefault;b.preventDefault=function(){a.preventDefault();c()};b.pointerId=1;b.isPrimary=!0;b.pointerType="mouse";return b}l=Ne.prototype;l.mousedown=function(a){if(!Oe(this,a)){(1).toString()in this.tc&&this.cancel(a);var b=Pe(a);this.tc[(1).toString()]=a;this.qb.Jk(b,a)}};l.mousemove=function(a){if(!Oe(this,a)){var b=Pe(a);this.qb.move(b,a)}};
l.mouseup=function(a){if(!Oe(this,a)){var b=this.tc[(1).toString()];b&&b.button===a.button&&(b=Pe(a),this.qb.km(b,a),delete this.tc[(1).toString()])}};l.mouseover=function(a){if(!Oe(this,a)){var b=Pe(a);Re(this.qb,b,a)}};l.mouseout=function(a){if(!Oe(this,a)){var b=Pe(a);Se(this.qb,b,a)}};l.cancel=function(a){var b=Pe(a);this.qb.cancel(b,a);delete this.tc[(1).toString()]};function Te(a){Me.call(this,a,{MSPointerDown:this.dL,MSPointerMove:this.eL,MSPointerUp:this.hL,MSPointerOut:this.fL,MSPointerOver:this.gL,MSPointerCancel:this.cL,MSGotPointerCapture:this.aL,MSLostPointerCapture:this.bL});this.tc=a.tc;this.VE=["","unavailable","touch","pen","mouse"]}F(Te,Me);function Ue(a,b){var c=b;"number"===typeof b.pointerType&&(c=Qe(b,b),c.pointerType=a.VE[b.pointerType]);return c}l=Te.prototype;
l.dL=function(a){this.tc[a.pointerId.toString()]=a;var b=Ue(this,a);this.qb.Jk(b,a)};l.eL=function(a){var b=Ue(this,a);this.qb.move(b,a)};l.hL=function(a){var b=Ue(this,a);this.qb.km(b,a);delete this.tc[a.pointerId.toString()]};l.fL=function(a){var b=Ue(this,a);Se(this.qb,b,a)};l.gL=function(a){var b=Ue(this,a);Re(this.qb,b,a)};l.cL=function(a){var b=Ue(this,a);this.qb.cancel(b,a);delete this.tc[a.pointerId.toString()]};l.bL=function(a){this.qb.dispatchEvent(new Ve("lostpointercapture",a,a))};
l.aL=function(a){this.qb.dispatchEvent(new Ve("gotpointercapture",a,a))};function We(a){Me.call(this,a,{pointerdown:this.YL,pointermove:this.ZL,pointerup:this.bM,pointerout:this.$L,pointerover:this.aM,pointercancel:this.XL,gotpointercapture:this.HI,lostpointercapture:this.tK})}F(We,Me);l=We.prototype;l.YL=function(a){Xe(this.qb,a)};l.ZL=function(a){Xe(this.qb,a)};l.bM=function(a){Xe(this.qb,a)};l.$L=function(a){Xe(this.qb,a)};l.aM=function(a){Xe(this.qb,a)};l.XL=function(a){Xe(this.qb,a)};l.tK=function(a){Xe(this.qb,a)};l.HI=function(a){Xe(this.qb,a)};function Ve(a,b,c){Wd.call(this,a);this.originalEvent=b;a=c?c:{};this.buttons=Ye(a);this.pressure=a.pressure?a.pressure:this.buttons?.5:0;this.bubbles="bubbles"in a?a.bubbles:!1;this.cancelable="cancelable"in a?a.cancelable:!1;this.view="view"in a?a.view:null;this.detail="detail"in a?a.detail:null;this.screenX="screenX"in a?a.screenX:0;this.screenY="screenY"in a?a.screenY:0;this.clientX="clientX"in a?a.clientX:0;this.clientY="clientY"in a?a.clientY:0;this.ctrlKey="ctrlKey"in a?a.ctrlKey:!1;this.altKey=
"altKey"in a?a.altKey:!1;this.shiftKey="shiftKey"in a?a.shiftKey:!1;this.metaKey="metaKey"in a?a.metaKey:!1;this.button="button"in a?a.button:0;this.relatedTarget="relatedTarget"in a?a.relatedTarget:null;this.pointerId="pointerId"in a?a.pointerId:0;this.width="width"in a?a.width:0;this.height="height"in a?a.height:0;this.tiltX="tiltX"in a?a.tiltX:0;this.tiltY="tiltY"in a?a.tiltY:0;this.pointerType="pointerType"in a?a.pointerType:"";this.hwTimestamp="hwTimestamp"in a?a.hwTimestamp:0;this.isPrimary=
"isPrimary"in a?a.isPrimary:!1;b.preventDefault&&(this.preventDefault=function(){b.preventDefault()})}F(Ve,Wd);function Ye(a){if(a.buttons||Ze)a=a.buttons;else switch(a.which){case 1:a=1;break;case 2:a=4;break;case 3:a=2;break;default:a=0}return a}var Ze=!1;try{Ze=1===(new MouseEvent("click",{buttons:1})).buttons}catch(a){};function $e(a,b){return a>b?1:a<b?-1:0}function af(a,b,c){var d=a.length;if(a[0]<=b)return 0;if(!(b<=a[d-1]))if(0<c)for(c=1;c<d;++c){if(a[c]<b)return c-1}else if(0>c)for(c=1;c<d;++c){if(a[c]<=b)return c}else for(c=1;c<d;++c){if(a[c]==b)return c;if(a[c]<b)return a[c-1]-b<b-a[c]?c-1:c}return d-1}function bf(a,b){var c=Array.isArray(b)?b:[b],d=c.length;for(b=0;b<d;b++)a[a.length]=c[b]}function cf(a,b){for(var c=a.length>>>0,d,e=0;e<c;e++)if(d=a[e],b(d,e,a))return d;return null}
function df(a,b){var c=a.length;if(c!==b.length)return!1;for(var d=0;d<c;d++)if(a[d]!==b[d])return!1;return!0}function ef(a){var b=ff,c=a.length,d=Array(a.length),e;for(e=0;e<c;e++)d[e]={index:e,value:a[e]};d.sort(function(a,c){return b(a.value,c.value)||a.index-c.index});for(e=0;e<a.length;e++)a[e]=d[e].value}function gf(a,b){var c;return a.every(function(d,e){c=e;return!b(d,e,a)})?-1:c}
function hf(a,b){var c=b||$e;return a.every(function(b,e){if(0===e)return!0;b=c(a[e-1],b);return!(0<b||0===b)})};function jf(a,b){Me.call(this,a,{touchstart:this.zO,touchmove:this.yO,touchend:this.xO,touchcancel:this.wO});this.tc=a.tc;this.WK=b;this.Sm=void 0;this.Bt=0;this.$n=void 0}F(jf,Me);l=jf.prototype;l.PC=function(){this.Bt=0;this.$n=void 0};
function kf(a,b,c){b=Qe(b,c);b.pointerId=c.identifier+2;b.bubbles=!0;b.cancelable=!0;b.detail=a.Bt;b.button=0;b.buttons=1;b.width=c.webkitRadiusX||c.radiusX||0;b.height=c.webkitRadiusY||c.radiusY||0;b.pressure=c.webkitForce||c.force||.5;b.isPrimary=a.Sm===c.identifier;b.pointerType="touch";b.clientX=c.clientX;b.clientY=c.clientY;b.screenX=c.screenX;b.screenY=c.screenY;return b}
function lf(a,b,c){function d(){b.preventDefault()}var e=Array.prototype.slice.call(b.changedTouches),f=e.length,g,h;for(g=0;g<f;++g)h=kf(a,b,e[g]),h.preventDefault=d,c.call(a,b,h)}
l.zO=function(a){var b=a.touches,c=Object.keys(this.tc),d=c.length;if(d>=b.length){var e=[],f,g,h;for(f=0;f<d;++f){g=c[f];h=this.tc[g];var k;if(!(k=1==g))a:{k=b.length;for(var m,p=0;p<k;p++)if(m=b[p],m.identifier===g-2){k=!0;break a}k=!1}k||e.push(h.nh)}for(f=0;f<e.length;++f)this.yt(a,e[f])}b=a.changedTouches[0];c=Object.keys(this.tc).length;if(0===c||1===c&&(1).toString()in this.tc)this.Sm=b.identifier,void 0!==this.$n&&clearTimeout(this.$n);mf(this,a);this.Bt++;lf(this,a,this.JL)};
l.JL=function(a,b){this.tc[b.pointerId]={target:b.target,nh:b,jC:b.target};var c=this.qb;b.bubbles=!0;c.fireEvent("pointerover",b,a);this.qb.enter(b,a);this.qb.Jk(b,a)};l.yO=function(a){a.preventDefault();lf(this,a,this.YK)};l.YK=function(a,b){var c=this.tc[b.pointerId];if(c){var d=c.nh,e=c.jC;this.qb.move(b,a);d&&e!==b.target&&(d.relatedTarget=b.target,b.relatedTarget=e,d.target=e,b.target?(Se(this.qb,d,a),Re(this.qb,b,a)):(b.target=e,b.relatedTarget=null,this.yt(a,b)));c.nh=b;c.jC=b.target}};
l.xO=function(a){mf(this,a);lf(this,a,this.OO)};l.OO=function(a,b){this.qb.km(b,a);this.qb.nh(b,a);this.qb.leave(b,a);delete this.tc[b.pointerId];b.isPrimary&&(this.Sm=void 0,this.$n=setTimeout(this.PC.bind(this),200))};l.wO=function(a){lf(this,a,this.yt)};l.yt=function(a,b){this.qb.cancel(b,a);this.qb.nh(b,a);this.qb.leave(b,a);delete this.tc[b.pointerId];b.isPrimary&&(this.Sm=void 0,this.$n=setTimeout(this.PC.bind(this),200))};
function mf(a,b){var c=a.WK.YA;b=b.changedTouches[0];if(a.Sm===b.identifier){var d=[b.clientX,b.clientY];c.push(d);setTimeout(function(){var a=c.indexOf(d);-1<a&&c.splice(a,1)},2500)}};function nf(a){Yd.call(this);this.qd=a;this.tc={};this.Lz={};this.Mm=[];Ee?of(this,new We(this)):Fe?of(this,new Te(this)):(a=new Ne(this),of(this,a),De&&of(this,new jf(this,a)));a=this.Mm.length;for(var b,c=0;c<a;c++)b=this.Mm[c],pf(this,Object.keys(b.Yq))}F(nf,Yd);function of(a,b){var c=Object.keys(b.Yq);c&&(c.forEach(function(a){var c=b.Yq[a];c&&(this.Lz[a]=c.bind(b))},a),a.Mm.push(b))}l=nf.prototype;l.Kz=function(a){var b=this.Lz[a.type];b&&b(a)};
function pf(a,b){b.forEach(function(a){J(this.qd,a,this.Kz,this)},a)}function qf(a,b){b.forEach(function(a){Td(this.qd,a,this.Kz,this)},a)}function Qe(a,b){for(var c={},d,e=0,f=rf.length;e<f;e++)d=rf[e][0],c[d]=a[d]||b[d]||rf[e][1];return c}l.Jk=function(a,b){this.fireEvent("pointerdown",a,b)};l.move=function(a,b){this.fireEvent("pointermove",a,b)};l.km=function(a,b){this.fireEvent("pointerup",a,b)};l.enter=function(a,b){a.bubbles=!1;this.fireEvent("pointerenter",a,b)};
l.leave=function(a,b){a.bubbles=!1;this.fireEvent("pointerleave",a,b)};l.nh=function(a,b){a.bubbles=!0;this.fireEvent("pointerout",a,b)};l.cancel=function(a,b){this.fireEvent("pointercancel",a,b)};function Se(a,b,c){a.nh(b,c);var d=b.target,e=b.relatedTarget;d&&e&&d.contains(e)||a.leave(b,c)}function Re(a,b,c){b.bubbles=!0;a.fireEvent("pointerover",b,c);var d=b.target,e=b.relatedTarget;d&&e&&d.contains(e)||a.enter(b,c)}l.fireEvent=function(a,b,c){this.dispatchEvent(new Ve(a,c,b))};
function Xe(a,b){a.dispatchEvent(new Ve(b.type,b,b))}l.Ya=function(){for(var a=this.Mm.length,b,c=0;c<a;c++)b=this.Mm[c],qf(this,Object.keys(b.Yq));Yd.prototype.Ya.call(this)};
var rf=[["bubbles",!1],["cancelable",!1],["view",null],["detail",null],["screenX",0],["screenY",0],["clientX",0],["clientY",0],["ctrlKey",!1],["altKey",!1],["shiftKey",!1],["metaKey",!1],["button",0],["relatedTarget",null],["buttons",0],["pointerId",0],["width",0],["height",0],["pressure",0],["tiltX",0],["tiltY",0],["pointerType",""],["hwTimestamp",0],["isPrimary",!1],["type",""],["target",null],["currentTarget",null],["which",0]];function vf(a,b){Yd.call(this);this.W=a;this.ym=0;this.Mh=!1;this.Kk=[];this.RB=b?b*Ae:Ae;this.Fm=null;a=this.W.ac;this.Lx=0;this.Xw={};this.yl=new nf(a);this.Lh=null;this.Sv=J(this.yl,"pointerdown",this.jJ,this);this.Zv=J(this.yl,"pointermove",this.wM,this)}F(vf,Yd);
function wf(a,b){var c=new Le("click",a.W,b);a.dispatchEvent(c);0!==a.ym?(clearTimeout(a.ym),a.ym=0,c=new Le("dblclick",a.W,b),a.dispatchEvent(c)):a.ym=setTimeout(function(){this.ym=0;var a=new Le("singleclick",this.W,b);this.dispatchEvent(a)}.bind(a),250)}function xf(a,b){"pointerup"==b.type||"pointercancel"==b.type?delete a.Xw[b.pointerId]:"pointerdown"==b.type&&(a.Xw[b.pointerId]=!0);a.Lx=Object.keys(a.Xw).length}l=vf.prototype;
l.zA=function(a){xf(this,a);var b=new Le("pointerup",this.W,a);this.dispatchEvent(b);b.vC||this.Mh||0!==a.button||wf(this,this.Fm);0===this.Lx&&(this.Kk.forEach(Ld),this.Kk.length=0,this.Mh=!1,this.Fm=null,this.Lh.ue(),this.Lh=null)};l.jJ=function(a){xf(this,a);var b=new Le("pointerdown",this.W,a);this.dispatchEvent(b);this.Fm=a;0===this.Kk.length&&(this.Lh=new nf(document),this.Kk.push(J(this.Lh,"pointermove",this.$k,this),J(this.Lh,"pointerup",this.zA,this),J(this.yl,"pointercancel",this.zA,this)))};
l.$k=function(a){if(Math.abs(a.clientX-this.Fm.clientX)>this.RB||Math.abs(a.clientY-this.Fm.clientY)>this.RB){this.Mh=!0;var b=new Le("pointerdrag",this.W,a);this.dispatchEvent(b)}a.preventDefault()};l.wM=function(a){this.dispatchEvent(new Le(a.type,this.W,a))};l.Ya=function(){this.Zv&&(Ld(this.Zv),this.Zv=null);this.Sv&&(Ld(this.Sv),this.Sv=null);this.Kk.forEach(Ld);this.Kk.length=0;this.Lh&&(this.Lh.ue(),this.Lh=null);this.yl&&(this.yl.ue(),this.yl=null);Yd.prototype.Ya.call(this)};function yf(a,b){if(!a)throw new Fd(b);};function zf(a,b){this.tC=a;this.Dq=b;this.Zf=[];this.Bl=[];this.Ij={}}l=zf.prototype;l.clear=function(){this.Zf.length=0;this.Bl.length=0;Hd(this.Ij)};l.dequeue=function(){var a=this.Zf,b=this.Bl,c=a[0];1==a.length?(a.length=0,b.length=0):(a[0]=a.pop(),b[0]=b.pop(),Af(this,0));a=this.Dq(c);delete this.Ij[a];return c};l.enqueue=function(a){yf(!(this.Dq(a)in this.Ij),31);var b=this.tC(a);return Infinity!=b?(this.Zf.push(a),this.Bl.push(b),this.Ij[this.Dq(a)]=!0,Bf(this,0,this.Zf.length-1),!0):!1};
l.Qk=function(){return this.Zf.length};l.Bf=function(){return 0===this.Zf.length};function Af(a,b){for(var c=a.Zf,d=a.Bl,e=c.length,f=c[b],g=d[b],h=b;b<e>>1;){var k=2*b+1,m=2*b+2,k=m<e&&d[m]<d[k]?m:k;c[b]=c[k];d[b]=d[k];b=k}c[b]=f;d[b]=g;Bf(a,h,b)}function Bf(a,b,c){var d=a.Zf;a=a.Bl;for(var e=d[c],f=a[c];c>b;){var g=c-1>>1;if(a[g]>f)d[c]=d[g],a[c]=a[g],c=g;else break}d[c]=e;a[c]=f}
function Cf(a){var b=a.tC,c=a.Zf,d=a.Bl,e=0,f=c.length,g,h,k;for(h=0;h<f;++h)g=c[h],k=b(g),Infinity==k?delete a.Ij[a.Dq(g)]:(d[e]=k,c[e++]=g);c.length=e;d.length=e;for(b=(a.Zf.length>>1)-1;0<=b;b--)Af(a,b)};function Df(a,b){zf.call(this,function(b){return a.apply(null,b)},function(a){return a[0].getKey()});this.TD=b;this.ls=0;this.ks={}}F(Df,zf);Df.prototype.enqueue=function(a){var b=zf.prototype.enqueue.call(this,a);b&&J(a[0],"change",this.pq,this);return b};Df.prototype.pq=function(a){a=a.target;var b=a.ab();if(2===b||3===b||4===b||5===b)Td(a,"change",this.pq,this),a=a.getKey(),a in this.ks&&(delete this.ks[a],--this.ls),this.TD()};function Ef(a,b,c){return Math.min(Math.max(a,b),c)}var Ff="cosh"in Math?Math.cosh:function(a){a=Math.exp(a);return(a+1/a)/2};function Gf(a){yf(0<a,29);return Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function Hf(a,b,c,d){a=c-a;b=d-b;return a*a+b*b}function If(a){return a*Math.PI/180}function Jf(a,b){a%=b;return 0>a*b?a+b:a}function Kf(a,b,c){return a+c*(b-a)};function Lf(a){return function(b){if(b)return[Ef(b[0],a[0],a[2]),Ef(b[1],a[1],a[3])]}}function Mf(a){return a};function Nf(a){return function(b,c,d){if(void 0!==b)return b=af(a,b,d),b=Ef(b+c,0,a.length-1),c=Math.floor(b),b!=c&&c<a.length-1?a[c]/Math.pow(a[c]/a[c+1],b-c):a[c]}}function Of(a,b,c){return function(d,e,f){if(void 0!==d)return d=Math.max(Math.floor(Math.log(b/d)/Math.log(a)+(-f/2+.5))+e,0),void 0!==c&&(d=Math.min(d,c)),b/Math.pow(a,d)}};function Pf(a){if(void 0!==a)return 0}function Qf(a,b){if(void 0!==a)return a+b}function Rf(a){var b=2*Math.PI/a;return function(a,d){if(void 0!==a)return a=Math.floor((a+d)/b+.5)*b}}function Sf(){var a=If(5);return function(b,c){if(void 0!==b)return Math.abs(b+c)<=a?0:b+c}};function Tf(a){a=""+a;var b=a.indexOf("."),b=-1===b?a.length:b;return 2<b?a:Array(3-b).join("0")+a}function Uf(a){a=(""+a).split(".");for(var b=["1","3"],c=0;c<Math.max(a.length,b.length);c++){var d=parseInt(a[c]||"0",10),e=parseInt(b[c]||"0",10);if(d>e)return 1;if(e>d)return-1}return 0};function Vf(a,b){a[0]+=b[0];a[1]+=b[1]}function Wf(a,b){var c=b.yf(),d=b.Ka();b=d[0];var d=d[1],e=a[0]-b;a=a[1]-d;0===e&&0===a&&(e=1);var f=Math.sqrt(e*e+a*a);return[b+c*e/f,d+c*a/f]}function Xf(a,b){var c=a[0];a=a[1];var d=b[0],e=b[1];b=d[0];var d=d[1],f=e[0],e=e[1],g=f-b,h=e-d,c=0===g&&0===h?0:(g*(c-b)+h*(a-d))/(g*g+h*h||0);0>=c?(a=b,c=d):1<=c?(a=f,c=e):(a=b+c*g,c=d+c*h);return[a,c]}function Yf(a,b){for(var c=!0,d=a.length-1;0<=d;--d)if(a[d]!=b[d]){c=!1;break}return c}
function Zf(a,b){var c=Math.cos(b);b=Math.sin(b);var d=a[1]*c+a[0]*b;a[0]=a[0]*c-a[1]*b;a[1]=d}function $f(a,b){var c=a[0]-b[0];a=a[1]-b[1];return c*c+a*a}function ag(a,b){return Math.sqrt($f(a,b))}function bg(a,b){return $f(a,Xf(a,b))};function cg(a){return 1-Math.pow(1-a,3)}function dg(a){return 3*a*a-2*a*a*a}function eg(a){return a};function fg(a){for(var b=gg(),c=0,d=a.length;c<d;++c)hg(b,a[c]);return b}function ig(a,b,c){return c?(c[0]=a[0]-b,c[1]=a[1]-b,c[2]=a[2]+b,c[3]=a[3]+b,c):[a[0]-b,a[1]-b,a[2]+b,a[3]+b]}function jg(a,b){return b?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b):a.slice()}function kg(a,b,c){b=b<a[0]?a[0]-b:a[2]<b?b-a[2]:0;a=c<a[1]?a[1]-c:a[3]<c?c-a[3]:0;return b*b+a*a}function lg(a,b){var c=b[0];b=b[1];return a[0]<=c&&c<=a[2]&&a[1]<=b&&b<=a[3]}
function qg(a,b){return a[0]<=b[0]&&b[2]<=a[2]&&a[1]<=b[1]&&b[3]<=a[3]}function gg(){return[Infinity,Infinity,-Infinity,-Infinity]}function rg(a,b,c,d,e){return e?(e[0]=a,e[1]=b,e[2]=c,e[3]=d,e):[a,b,c,d]}function sg(a){return rg(Infinity,Infinity,-Infinity,-Infinity,a)}function tg(a,b){var c=a[0];a=a[1];return rg(c,a,c,a,b)}function ug(a,b){return a[0]==b[0]&&a[2]==b[2]&&a[1]==b[1]&&a[3]==b[3]}
function vg(a,b){b[0]<a[0]&&(a[0]=b[0]);b[2]>a[2]&&(a[2]=b[2]);b[1]<a[1]&&(a[1]=b[1]);b[3]>a[3]&&(a[3]=b[3])}function hg(a,b){b[0]<a[0]&&(a[0]=b[0]);b[0]>a[2]&&(a[2]=b[0]);b[1]<a[1]&&(a[1]=b[1]);b[1]>a[3]&&(a[3]=b[1])}function wg(a,b,c,d,e){for(;c<d;c+=e){var f=a,g=b[c],h=b[c+1];f[0]=Math.min(f[0],g);f[1]=Math.min(f[1],h);f[2]=Math.max(f[2],g);f[3]=Math.max(f[3],h)}return a}function xg(a){var b=0;yg(a)||(b=zg(a)*Ag(a));return b}function Bg(a){return[(a[0]+a[2])/2,(a[1]+a[3])/2]}
function Cg(a,b,c,d,e){var f=b*d[0]/2;d=b*d[1]/2;b=Math.cos(c);var g=Math.sin(c);c=f*b;f*=g;b*=d;var h=d*g,k=a[0],m=a[1];a=k-c+h;d=k-c-h;g=k+c-h;c=k+c+h;var h=m-f-b,k=m-f+b,p=m+f+b,f=m+f-b;return rg(Math.min(a,d,g,c),Math.min(h,k,p,f),Math.max(a,d,g,c),Math.max(h,k,p,f),e)}function Ag(a){return a[3]-a[1]}function Dg(a,b){var c=gg();Eg(a,b)&&(c[0]=a[0]>b[0]?a[0]:b[0],c[1]=a[1]>b[1]?a[1]:b[1],c[2]=a[2]<b[2]?a[2]:b[2],c[3]=a[3]<b[3]?a[3]:b[3]);return c}function Fg(a){return[a[0],a[3]]}
function zg(a){return a[2]-a[0]}function Eg(a,b){return a[0]<=b[2]&&a[2]>=b[0]&&a[1]<=b[3]&&a[3]>=b[1]}function yg(a){return a[2]<a[0]||a[3]<a[1]}function Gg(a,b){var c=(a[2]-a[0])/2*(b-1);b=(a[3]-a[1])/2*(b-1);a[0]-=c;a[2]+=c;a[1]-=b;a[3]+=b}function Hg(a,b){a=[a[0],a[1],a[0],a[3],a[2],a[1],a[2],a[3]];b(a,a,2);var c=[a[0],a[2],a[4],a[6]],d=[a[1],a[3],a[5],a[7]];b=Math.min.apply(null,c);a=Math.min.apply(null,d);c=Math.max.apply(null,c);d=Math.max.apply(null,d);return rg(b,a,c,d,void 0)};function Ig(){return!0}function Jg(){return!1};function Kg(a,b,c,d,e){var f=e?e:[],g=0,h;for(h=0;h<b;h+=c){var k=a[h],m=a[h+1];f[g++]=d[0]*k+d[2]*m+d[4];f[g++]=d[1]*k+d[3]*m+d[5]}e&&f.length!=g&&(f.length=g);return f}function Lg(a,b,c,d,e,f,g){for(var h=g?g:[],k=0,m;b<c;b+=d)for(h[k++]=a[b]+e,h[k++]=a[b+1]+f,m=b+2;m<b+d;++m)h[k++]=a[m];g&&h.length!=k&&(h.length=k);return h};/*

 Latitude/longitude spherical geodesy formulae taken from
 http://www.movable-type.co.uk/scripts/latlong.html
 Licensed under CC-BY-3.0.
*/
function Mg(a){this.cb=a}Mg.prototype.offset=function(a,b,c){var d=If(a[1]);b/=this.cb;var e=Math.asin(Math.sin(d)*Math.cos(b)+Math.cos(d)*Math.sin(b)*Math.cos(c));return[180*(If(a[0])+Math.atan2(Math.sin(c)*Math.sin(b)*Math.cos(d),Math.cos(b)-Math.sin(d)*Math.sin(e)))/Math.PI,180*e/Math.PI]};function Ng(a,b,c){var d=If(a[1]),e=If(b[1]),f=(e-d)/2;a=If(b[0]-a[0])/2;d=Math.sin(f)*Math.sin(f)+Math.sin(a)*Math.sin(a)*Math.cos(d)*Math.cos(e);return 2*c*Math.atan2(Math.sqrt(d),Math.sqrt(1-d))}
function Og(a,b){for(var c=0,d=a.length,e=a[d-1][0],f=a[d-1][1],g=0;g<d;g++)var h=a[g][0],k=a[g][1],c=c+If(h-e)*(2+Math.sin(If(f))+Math.sin(If(k))),e=h,f=k;return c*b*b/2};var Pg={};Pg.degrees=12741994*Math.PI/360;Pg.ft=.3048;Pg.m=1;Pg["us-ft"]=1200/3937;function Qg(a){this.Z=a.code;this.gx=a.units;this.Rg=void 0!==a.aa?a.aa:null;this.IE=void 0!==a.nx?a.nx:null;this.fp=void 0!==a.ut?a.ut:"enu";this.gn=void 0!==a.global?a.global:!1;this.bj=!(!this.gn||!this.Rg);this.mI=a.lI;this.lz=null;this.IB=a.HB;var b=a.code,c=window.proj4;"function"==typeof c&&(b=c.Ng(b),void 0!==b&&(void 0!==b.axis&&void 0===a.ut&&(this.fp=b.axis),void 0===a.HB&&(this.IB=b.JQ),void 0===a.units&&(this.gx=b.units)))}Qg.prototype.V=function(){return this.Rg};Qg.prototype.Uh=function(){return this.gx};
function Rg(a){return a.IB||Pg[a.gx]}Qg.prototype.co=function(a){this.Rg=a;this.bj=!(!this.gn||!a)};function Sg(a){Qg.call(this,{code:a,units:"m",aa:Tg,global:!0,nx:Ug,lI:function(a,c){return a/Ff(c[1]/6378137)}})}F(Sg,Qg);var Vg=6378137*Math.PI,Tg=[-Vg,-Vg,Vg,Vg],Ug=[-180,-85,180,85],Wg=[new Sg("EPSG:3857"),new Sg("EPSG:102100"),new Sg("EPSG:102113"),new Sg("EPSG:900913"),new Sg("urn:ogc:def:crs:EPSG:6.18:3:3857"),new Sg("urn:ogc:def:crs:EPSG::3857"),new Sg("http://www.opengis.net/gml/srs/epsg.xml#3857")];
function Xg(a,b,c){var d=a.length;c=1<c?c:2;void 0===b&&(b=2<c?a.slice():Array(d));for(var e=0;e<d;e+=c){b[e]=Vg*a[e]/180;var f=6378137*Math.log(Math.tan(Math.PI*(a[e+1]+90)/360));f>Vg?f=Vg:f<-Vg&&(f=-Vg);b[e+1]=f}return b}function Yg(a,b,c){var d=a.length;c=1<c?c:2;void 0===b&&(b=2<c?a.slice():Array(d));for(var e=0;e<d;e+=c)b[e]=180*a[e]/Vg,b[e+1]=360*Math.atan(Math.exp(a[e+1]/6378137))/Math.PI-90;return b};function Zg(a,b){Qg.call(this,{code:a,units:"degrees",aa:$g,ut:b,global:!0,HB:ah,nx:$g})}F(Zg,Qg);var $g=[-180,-90,180,90],ah=6378137*Math.PI/180,bh=[new Zg("CRS:84"),new Zg("EPSG:4326","neu"),new Zg("urn:ogc:def:crs:EPSG::4326","neu"),new Zg("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new Zg("urn:ogc:def:crs:OGC:1.3:CRS84"),new Zg("urn:ogc:def:crs:OGC:2:84"),new Zg("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Zg("urn:x-ogc:def:crs:EPSG:4326","neu")];var ch={};var dh={};function eh(a,b,c){a=a.Z;b=b.Z;a in dh||(dh[a]={});dh[a][b]=c}function fh(a,b){var c;a in dh&&b in dh[a]&&(c=dh[a][b]);return c};var gh=new Mg(6371008.8);function hh(a,b,c,d){a=ih(a);var e=a.mI;e?b=e(b,c):"degrees"==a.Uh()&&!d||"degrees"==d||(e=jh(a,ih("EPSG:4326")),b=[c[0]-b/2,c[1],c[0]+b/2,c[1],c[0],c[1]-b/2,c[0],c[1]+b/2],b=e(b,b,2),c=b.slice(0,2),e=b.slice(2,4),c=Ng(c,e,gh.cb),e=b.slice(4,6),b=b.slice(6,8),b=(c+Ng(e,b,gh.cb))/2,a=d?Pg[d]:Rg(a),void 0!==a&&(b/=a));return b}function kh(a){a.forEach(lh);a.forEach(function(b){a.forEach(function(a){b!==a&&eh(b,a,mh)})})}function lh(a){ch[a.Z]=a;eh(a,a,mh)}
function nh(a){return a?"string"===typeof a?ih(a):a:ih("EPSG:3857")}function oh(a,b,c,d){a=ih(a);b=ih(b);eh(a,b,ph(c));eh(b,a,ph(d))}function ph(a){return function(b,c,d){var e=b.length;d=void 0!==d?d:2;c=void 0!==c?c:Array(e);var f,g;for(g=0;g<e;g+=d)for(f=a([b[g],b[g+1]]),c[g]=f[0],c[g+1]=f[1],f=d-1;2<=f;--f)c[g+f]=b[g+f];return c}}
function ih(a){var b=null;if(a instanceof Qg)b=a;else if("string"===typeof a&&(b=ch[a]||null,!b)){var c=window.proj4;"function"==typeof c&&void 0!==c.Ng(a)&&(b=new Qg({code:a}),lh(b))}return b}function qh(a,b){if(a===b)return!0;var c=a.Uh()===b.Uh();return a.Z===b.Z?c:jh(a,b)===mh&&c}function rh(a,b){a=ih(a);b=ih(b);return jh(a,b)}
function jh(a,b){var c=a.Z,d=b.Z,e=fh(c,d);if(!e){var f=window.proj4;if("function"==typeof f){var g=f.Ng(c),h=f.Ng(d);void 0!==g&&void 0!==h&&(g===h?kh([b,a]):(e=f(d,c),oh(b,a,e.forward,e.inverse)),e=fh(c,d))}}e||(e=sh);return e}function sh(a,b){if(void 0!==b&&a!==b){for(var c=0,d=a.length;c<d;++c)b[c]=a[c];a=b}return a}function mh(a,b){if(void 0!==b){for(var c=0,d=a.length;c<d;++c)b[c]=a[c];a=b}else a=a.slice();return a}function th(a,b,c){return rh(b,c)(a,void 0,a.length)}
function uh(a,b,c){b=rh(b,c);return Hg(a,b)}kh(Wg);kh(bh);bh.forEach(function(a){Wg.forEach(function(b){eh(a,b,Xg);eh(b,a,Yg)})});var vh=Array(6);function wh(){return[1,0,0,1,0,0]}function xh(a){return yh(a,1,0,0,1,0,0)}function zh(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],k=b[0],m=b[1],p=b[2],t=b[3],u=b[4];b=b[5];a[0]=c*k+e*m;a[1]=d*k+f*m;a[2]=c*p+e*t;a[3]=d*p+f*t;a[4]=c*u+e*b+g;a[5]=d*u+f*b+h}function yh(a,b,c,d,e,f,g){a[0]=b;a[1]=c;a[2]=d;a[3]=e;a[4]=f;a[5]=g;return a}function Ah(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a}
function Bh(a,b){var c=b[0],d=b[1];b[0]=a[0]*c+a[2]*d+a[4];b[1]=a[1]*c+a[3]*d+a[5];return b}function Ch(a,b){var c=Math.cos(b);b=Math.sin(b);zh(a,yh(vh,c,b,-b,c,0,0))}function Dh(a,b,c){zh(a,yh(vh,b,0,0,c,0,0))}function Kh(a,b,c){zh(a,yh(vh,1,0,0,1,b,c))}function Lh(a,b,c,d,e,f,g,h){var k=Math.sin(f);f=Math.cos(f);a[0]=d*f;a[1]=e*k;a[2]=-d*k;a[3]=e*f;a[4]=g*d*f-h*d*k+b;a[5]=g*e*k+h*e*f+c;return a};function Mh(){be.call(this);this.Rg=gg();this.Nz=-1;this.Ai={};this.Yr=this.Bi=0;this.Uw=wh()}F(Mh,be);Mh.prototype.Xf=Jg;Mh.prototype.V=function(a){this.Nz!=this.Xa&&(this.Rg=this.sp(this.Rg),this.Nz=this.Xa);var b=this.Rg;a?(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3]):a=b;return a};
Mh.prototype.transform=function(a,b){var c=this.Uw;a=ih(a);var d="tile-pixels"==a.Uh()?function(d,f,g){var e=a.V(),k=a.IE,e=Ag(k)/Ag(e);Lh(c,k[0],k[3],e,-e,0,0,0);Kg(d,d.length,g,c,f);return rh(a,b)(d,f,g)}:rh(a,b);this.um(d);return this};function Nh(){Mh.call(this);this.gb="XY";this.S=2;this.l=null}F(Nh,Mh);function Oh(a){var b;"XY"==a?b=2:"XYZ"==a||"XYM"==a?b=3:"XYZM"==a&&(b=4);return b}l=Nh.prototype;l.Xf=Jg;l.sp=function(a){var b=this.l,c=this.l.length,d=this.S;a=sg(a);return wg(a,b,0,c,d)};function Ph(a){return a.l.slice(0,a.S)}function Qh(a){return a.l.slice(a.l.length-a.S)}
l.Du=function(a){this.Yr!=this.Xa&&(Hd(this.Ai),this.Bi=0,this.Yr=this.Xa);if(0>a||0!==this.Bi&&a<=this.Bi)return this;var b=a.toString();if(this.Ai.hasOwnProperty(b))return this.Ai[b];var c=this.Vk(a);if(c.l.length<this.l.length)return this.Ai[b]=c;this.Bi=a;return this};l.Vk=function(){return this};function Rh(a,b,c){a.S=Oh(b);a.gb=b;a.l=c}
function Sh(a,b,c,d){if(b)c=Oh(b);else{for(b=0;b<d;++b){if(0===c.length){a.gb="XY";a.S=2;return}c=c[0]}c=c.length;var e;2==c?e="XY":3==c?e="XYZ":4==c&&(e="XYZM");b=e}a.gb=b;a.S=c}l.um=function(a){this.l&&(a(this.l,this.l,this.S),this.L())};
l.rotate=function(a,b){var c=this.l;if(c){var d=c.length,e=this.S,f=c?c:[],g=Math.cos(a);a=Math.sin(a);var h=b[0];b=b[1];for(var k=0,m=0;m<d;m+=e){var p=c[m]-h,t=c[m+1]-b;f[k++]=h+p*g-t*a;f[k++]=b+p*a+t*g;for(p=m+2;p<m+e;++p)f[k++]=c[p]}c&&f.length!=k&&(f.length=k);this.L()}};
l.scale=function(a,b,c){var d=b;void 0===d&&(d=a);var e=c;e||(e=Bg(this.V()));if(c=this.l){b=c.length;for(var f=this.S,g=c?c:[],h=e[0],e=e[1],k=0,m=0;m<b;m+=f){var p=c[m]-h,t=c[m+1]-e;g[k++]=h+a*p;g[k++]=e+d*t;for(p=m+2;p<m+f;++p)g[k++]=c[p]}c&&g.length!=k&&(g.length=k);this.L()}};l.translate=function(a,b){var c=this.l;c&&(Lg(c,0,c.length,this.S,a,b,c),this.L())};function Th(a,b,c,d){for(var e=0,f=a[c-d],g=a[c-d+1];b<c;b+=d)var h=a[b],k=a[b+1],e=e+(g*h-f*k),f=h,g=k;return e/2}function Uh(a,b,c,d){var e=0,f,g;f=0;for(g=c.length;f<g;++f){var h=c[f],e=e+Th(a,b,h,d);b=h}return e};function Vh(a,b,c,d,e,f,g){var h=a[b],k=a[b+1],m=a[c]-h,p=a[c+1]-k;if(0!==m||0!==p)if(f=((e-h)*m+(f-k)*p)/(m*m+p*p),1<f)b=c;else if(0<f){for(e=0;e<d;++e)g[e]=Kf(a[b+e],a[c+e],f);g.length=d;return}for(e=0;e<d;++e)g[e]=a[b+e];g.length=d}function Wh(a,b,c,d,e){var f=a[b],g=a[b+1];for(b+=d;b<c;b+=d){var h=a[b],k=a[b+1],f=Hf(f,g,h,k);f>e&&(e=f);f=h;g=k}return e}function Xh(a,b,c,d,e){var f,g;f=0;for(g=c.length;f<g;++f){var h=c[f];e=Wh(a,b,h,d,e);b=h}return e}
function Yh(a,b,c,d,e,f,g,h,k,m,p){if(b==c)return m;var t;if(0===e){t=Hf(g,h,a[b],a[b+1]);if(t<m){for(p=0;p<d;++p)k[p]=a[b+p];k.length=d;return t}return m}for(var u=p?p:[NaN,NaN],w=b+d;w<c;)if(Vh(a,w-d,w,d,g,h,u),t=Hf(g,h,u[0],u[1]),t<m){m=t;for(p=0;p<d;++p)k[p]=u[p];k.length=d;w+=d}else w+=d*Math.max((Math.sqrt(t)-Math.sqrt(m))/e|0,1);if(f&&(Vh(a,c-d,b,d,g,h,u),t=Hf(g,h,u[0],u[1]),t<m)){m=t;for(p=0;p<d;++p)k[p]=u[p];k.length=d}return m}
function Zh(a,b,c,d,e,f,g,h,k,m,p){p=p?p:[NaN,NaN];var t,u;t=0;for(u=c.length;t<u;++t){var w=c[t];m=Yh(a,b,w,d,e,f,g,h,k,m,p);b=w}return m};function $h(a,b){var c=0,d,e;d=0;for(e=b.length;d<e;++d)a[c++]=b[d];return c}function ai(a,b,c,d){var e,f;e=0;for(f=c.length;e<f;++e){var g=c[e],h;for(h=0;h<d;++h)a[b++]=g[h]}return b}function bi(a,b,c,d,e){e=e?e:[];var f=0,g,h;g=0;for(h=c.length;g<h;++g)b=ai(a,b,c[g],d),e[f++]=b;e.length=f;return e};function ci(a,b,c,d,e){e=void 0!==e?e:[];for(var f=0;b<c;b+=d)e[f++]=a.slice(b,b+d);e.length=f;return e}function di(a,b,c,d,e){e=void 0!==e?e:[];var f=0,g,h;g=0;for(h=c.length;g<h;++g){var k=c[g];e[f++]=ci(a,b,k,d,e[f]);b=k}e.length=f;return e}function ei(a,b,c,d,e){e=void 0!==e?e:[];var f=0,g,h;g=0;for(h=c.length;g<h;++g){var k=c[g];e[f++]=di(a,b,k,d,e[f]);b=k[k.length-1]}e.length=f;return e};function fi(a,b,c,d,e,f,g){var h=(c-b)/d;if(3>h){for(;b<c;b+=d)f[g++]=a[b],f[g++]=a[b+1];return g}var k=Array(h);k[0]=1;k[h-1]=1;c=[b,c-d];for(var m=0,p;0<c.length;){var t=c.pop(),u=c.pop(),w=0,x=a[u],z=a[u+1],D=a[t],H=a[t+1];for(p=u+d;p<t;p+=d){var G;G=a[p];var L=a[p+1],N=x,T=z,U=D-N,K=H-T;if(0!==U||0!==K){var X=((G-N)*U+(L-T)*K)/(U*U+K*K);1<X?(N=D,T=H):0<X&&(N+=U*X,T+=K*X)}G=Hf(G,L,N,T);G>w&&(m=p,w=G)}w>e&&(k[(m-b)/d]=1,u+d<m&&c.push(u,m),m+d<t&&c.push(m,t))}for(p=0;p<h;++p)k[p]&&(f[g++]=a[b+p*
d],f[g++]=a[b+p*d+1]);return g}
function gi(a,b,c,d,e,f,g,h){var k,m;k=0;for(m=c.length;k<m;++k){var p=c[k];a:{var t=a,u=p,w=d,x=e,z=f;if(b!=u){var D=x*Math.round(t[b]/x),H=x*Math.round(t[b+1]/x);b+=w;z[g++]=D;z[g++]=H;var G,L;do if(G=x*Math.round(t[b]/x),L=x*Math.round(t[b+1]/x),b+=w,b==u){z[g++]=G;z[g++]=L;break a}while(G==D&&L==H);for(;b<u;){var N,T;N=x*Math.round(t[b]/x);T=x*Math.round(t[b+1]/x);b+=w;if(N!=G||T!=L){var U=G-D,K=L-H,X=N-D,ma=T-H;U*ma==K*X&&(0>U&&X<U||U==X||0<U&&X>U)&&(0>K&&ma<K||K==ma||0<K&&ma>K)||(z[g++]=G,z[g++]=
L,D=G,H=L);G=N;L=T}}z[g++]=G;z[g++]=L}}h.push(g);b=p}return g};function hi(a,b){Nh.call(this);this.de=this.ee=-1;this.zb(a,b)}F(hi,Nh);l=hi.prototype;l.clone=function(){var a=new hi(null);a.ya(this.gb,this.l.slice());return a};l.Vf=function(a,b,c,d){if(d<kg(this.V(),a,b))return d;this.de!=this.Xa&&(this.ee=Math.sqrt(Wh(this.l,0,this.l.length,this.S,0)),this.de=this.Xa);return Yh(this.l,0,this.l.length,this.S,this.ee,!0,a,b,c,d)};l.Pk=function(){return Th(this.l,0,this.l.length,this.S)};l.T=function(){return ci(this.l,0,this.l.length,this.S)};
l.Vk=function(a){var b=[];b.length=fi(this.l,0,this.l.length,this.S,a,b,0);a=new hi(null);a.ya("XY",b);return a};l.F=function(){return"LinearRing"};l.zb=function(a,b){a?(Sh(this,b,a,1),this.l||(this.l=[]),this.l.length=ai(this.l,0,a,this.S),this.L()):this.ya("XY",null)};l.ya=function(a,b){Rh(this,a,b);this.L()};function ii(a,b){Nh.call(this);this.zb(a,b)}F(ii,Nh);l=ii.prototype;l.clone=function(){var a=new ii(null);a.ya(this.gb,this.l.slice());return a};l.Vf=function(a,b,c,d){var e=this.l;a=Hf(a,b,e[0],e[1]);if(a<d){d=this.S;for(b=0;b<d;++b)c[b]=e[b];c.length=d;return a}return d};l.T=function(){return this.l?this.l.slice():[]};l.sp=function(a){return tg(this.l,a)};l.F=function(){return"Point"};l.zb=function(a,b){a?(Sh(this,b,a,0),this.l||(this.l=[]),this.l.length=$h(this.l,a),this.L()):this.ya("XY",null)};
l.ya=function(a,b){Rh(this,a,b);this.L()};function ji(a,b,c,d,e,f){for(var g=0,h=a[c-d],k=a[c-d+1];b<c;b+=d){var m=a[b],p=a[b+1];k<=f?p>f&&0<(m-h)*(f-k)-(e-h)*(p-k)&&g++:p<=f&&0>(m-h)*(f-k)-(e-h)*(p-k)&&g--;h=m;k=p}return 0!==g}function ki(a,b,c,d,e,f){if(0===c.length||!ji(a,b,c[0],d,e,f))return!1;var g;b=1;for(g=c.length;b<g;++b)if(ji(a,c[b-1],c[b],d,e,f))return!1;return!0};function li(a,b,c,d,e,f,g){for(var h,k,m,p,t,u=e[f+1],w=[],x=0,z=c.length;x<z;++x){var D=c[x];m=a[D-d];t=a[D-d+1];for(h=b;h<D;h+=d){p=a[h];k=a[h+1];if(u<=t&&k<=u||t<=u&&u<=k)m=(u-t)/(k-t)*(p-m)+m,w.push(m);m=p;t=k}}x=NaN;z=-Infinity;w.sort($e);m=w[0];h=1;for(k=w.length;h<k;++h)p=w[h],D=Math.abs(p-m),D>z&&(m=(m+p)/2,ki(a,b,c,d,m,u)&&(x=m,z=D)),m=p;isNaN(x)&&(x=e[f]);return g?(g.push(x,u,z),g):[x,u,z]};function mi(a,b,c,d){for(var e=0,f=a[c-d],g=a[c-d+1];b<c;b+=d)var h=a[b],k=a[b+1],e=e+(h-f)*(k+g),f=h,g=k;return 0<e}function ni(a,b,c,d){var e=0;d=void 0!==d?d:!1;var f,g;f=0;for(g=b.length;f<g;++f){var h=b[f],e=mi(a,e,h,c);if(0===f){if(d&&e||!d&&!e)return!1}else if(d&&!e||!d&&e)return!1;e=h}return!0}
function oi(a,b,c,d,e){e=void 0!==e?e:!1;var f,g;f=0;for(g=c.length;f<g;++f){var h=c[f],k=mi(a,b,h,d);if(0===f?e&&k||!e&&!k:e&&!k||!e&&k)for(var k=a,m=h,p=d;b<m-p;){var t;for(t=0;t<p;++t){var u=k[b+t];k[b+t]=k[m-p+t];k[m-p+t]=u}b+=p;m-=p}b=h}return b}function pi(a,b,c,d){var e=0,f,g;f=0;for(g=b.length;f<g;++f)e=oi(a,e,b[f],c,d);return e};function qi(a,b){Nh.call(this);this.Qa=[];this.Tz=-1;this.Uz=null;this.Fn=this.de=this.ee=-1;this.Gf=null;this.zb(a,b)}F(qi,Nh);function ri(a,b){a.l?bf(a.l,b.l):a.l=b.l.slice();a.Qa.push(a.l.length);a.L()}l=qi.prototype;l.clone=function(){var a=new qi(null);a.ya(this.gb,this.l.slice(),this.Qa.slice());return a};
l.Vf=function(a,b,c,d){if(d<kg(this.V(),a,b))return d;this.de!=this.Xa&&(this.ee=Math.sqrt(Xh(this.l,0,this.Qa,this.S,0)),this.de=this.Xa);return Zh(this.l,0,this.Qa,this.S,this.ee,!0,a,b,c,d)};l.Xf=function(a,b){return ki(this.Yd(),0,this.Qa,this.S,a,b)};l.Pk=function(){return Uh(this.Yd(),0,this.Qa,this.S)};l.T=function(a){var b;void 0!==a?(b=this.Yd().slice(),oi(b,0,this.Qa,this.S,a)):b=this.l;return di(b,0,this.Qa,this.S)};
function si(a){if(a.Tz!=a.Xa){var b=Bg(a.V());a.Uz=li(a.Yd(),0,a.Qa,a.S,b,0);a.Tz=a.Xa}return a.Uz}function ti(a){return new ii(si(a),"XYM")}function ui(a){if(0>=a.Qa.length)return null;var b=new hi(null);b.ya(a.gb,a.l.slice(0,a.Qa[0]));return b}function vi(a){var b=a.gb,c=a.l;a=a.Qa;var d=[],e=0,f,g;f=0;for(g=a.length;f<g;++f){var h=a[f],k=new hi(null);k.ya(b,c.slice(e,h));d.push(k);e=h}return d}
l.Yd=function(){if(this.Fn!=this.Xa){var a=this.l;ni(a,this.Qa,this.S)?this.Gf=a:(this.Gf=a.slice(),this.Gf.length=oi(this.Gf,0,this.Qa,this.S));this.Fn=this.Xa}return this.Gf};l.Vk=function(a){var b=[],c=[];b.length=gi(this.l,0,this.Qa,this.S,Math.sqrt(a),b,0,c);a=new qi(null);a.ya("XY",b,c);return a};l.F=function(){return"Polygon"};l.zb=function(a,b){a?(Sh(this,b,a,2),this.l||(this.l=[]),a=bi(this.l,0,a,this.S,this.Qa),this.l.length=0===a.length?0:a[a.length-1],this.L()):this.ya("XY",null,this.Qa)};
l.ya=function(a,b,c){Rh(this,a,b);this.Qa=c;this.L()};function wi(a){var b=a[0],c=a[1],d=a[2];a=a[3];b=[b,c,b,a,d,a,d,c,b,c];c=new qi(null);c.ya("XY",b,[b.length]);return c}function xi(a){for(var b=a.S,c=a.gb,d=new qi(null,c),b=33*b,e=Array(b),f=0;f<b;f++)e[f]=0;d.ya(c,e,[e.length]);c=a.Ka();a=a.yf();for(var b=d.l,e=d.gb,f=d.S,g=d.Qa,h=b.length/f-1,k,m,p=0;p<=h;++p)m=p*f,k=0+2*Jf(p,h)*Math.PI/h,b[m]=c[0]+a*Math.cos(k),b[m+1]=c[1]+a*Math.sin(k);d.ya(e,b,g);return d};function yi(a){be.call(this);a=Gd({},a);this.Zd=[0,0];this.Kg=[];this.vs=this.vs.bind(this);this.Dl=nh(a.pa);var b={};b.center=void 0!==a.Oa?a.Oa:null;var c,d,e,f=void 0!==a.Te?a.Te:0;c=void 0!==a.Cc?a.Cc:28;var g=void 0!==a.QE?a.QE:2;if(void 0!==a.Kd){var h=a.Kd;d=h[f];e=void 0!==h[c]?h[c]:h[h.length-1];c=Nf(h)}else{d=nh(a.pa);e=d.V();var h=(e?Math.max(zg(e),Ag(e)):360*Pg.degrees/Rg(d))/256/Math.pow(2,0),k=h/Math.pow(2,28);d=a.Df;void 0!==d?f=0:d=h/Math.pow(g,f);e=a.Se;void 0===e&&(e=void 0!==a.Cc?
void 0!==a.Df?d/Math.pow(g,c):h/Math.pow(g,c):k);c=f+Math.floor(Math.log(d/e)/Math.log(g));e=d/Math.pow(g,c-f);c=Of(g,d,c-f)}this.kg=d;this.yn=e;this.Oo=g;this.Ub=a.Kd;this.zn=f;(void 0!==a.Iz?a.Iz:1)?(f=a.tp,f=void 0===f||!0===f?Sf():!1===f?Qf:"number"===typeof f?Rf(f):Qf):f=Pf;this.Wf={Oa:void 0!==a.aa?Lf(a.aa):Mf,ra:c,rotation:f};void 0!==a.ra?b.resolution=a.ra:void 0!==a.zoom&&(b.resolution=this.kc(this.kg,a.zoom-this.zn),this.Ub&&(b.resolution=Ef(Number(this.Fa()||b.resolution),this.yn,this.kg)));
b.rotation=void 0!==a.rotation?a.rotation:0;ce(this,b)}F(yi,be);l=yi.prototype;
l.animate=function(a){var b=arguments.length,c;1<b&&"function"===typeof arguments[b-1]&&(c=arguments[b-1],--b);if(this.nn()){for(var d=Date.now(),e=this.Ka().slice(),f=this.Fa(),g=this.Cb(),h=[],k=0;k<b;++k){var m=arguments[k],p={start:d,complete:!1,anchor:m.anchor,duration:void 0!==m.duration?m.duration:1E3,Wc:m.Wc||dg};m.Oa&&(p.ko=e,p.ro=m.Oa,e=p.ro);void 0!==m.zoom?(p.mo=f,p.Xj=this.kc(this.kg,m.zoom-this.zn,0),f=p.Xj):m.ra&&(p.mo=f,p.Xj=m.ra,f=p.Xj);void 0!==m.rotation&&(p.as=g,p.so=g+(Jf(m.rotation-
g+Math.PI,2*Math.PI)-Math.PI),g=p.so);p.Bb=c;p.ko&&p.ro&&!Yf(p.ko,p.ro)||p.mo!==p.Xj||p.as!==p.so?d+=p.duration:p.complete=!0;h.push(p)}this.Kg.push(h);zi(this,0,1);this.vs()}else b=arguments[b-1],b.Oa&&this.tb(b.Oa),void 0!==b.zoom&&this.Tj(b.zoom),void 0!==b.rotation&&this.Rl(b.rotation),c&&c(!0)};function Ai(a){zi(a,0,-a.Zd[0]);for(var b=0,c=a.Kg.length;b<c;++b){var d=a.Kg[b];d[0].Bb&&d[0].Bb(!1)}a.Kg.length=0}
l.vs=function(){void 0!==this.us&&(cancelAnimationFrame(this.us),this.us=void 0);if(0<this.Zd[0]){for(var a=Date.now(),b=!1,c=this.Kg.length-1;0<=c;--c){for(var d=this.Kg[c],e=!0,f=0,g=d.length;f<g;++f){var h=d[f];if(!h.complete){b=a-h.start;b=0<h.duration?b/h.duration:1;1<=b?(h.complete=!0,b=1):e=!1;b=h.Wc(b);if(h.ko){var k=h.ko[0],m=h.ko[1];this.set("center",[k+b*(h.ro[0]-k),m+b*(h.ro[1]-m)])}h.mo&&h.Xj&&(k=1===b?h.Xj:h.mo+b*(h.Xj-h.mo),h.anchor&&this.set("center",Bi(this,k,h.anchor)),this.set("resolution",
k));void 0!==h.as&&void 0!==h.so&&(b=1===b?Jf(h.so+Math.PI,2*Math.PI)-Math.PI:h.as+b*(h.so-h.as),h.anchor&&this.set("center",Ci(this,b,h.anchor)),this.set("rotation",b));b=!0;if(!h.complete)break}}e&&(this.Kg[c]=null,zi(this,0,-1),(d=d[0].Bb)&&d(!0))}this.Kg=this.Kg.filter(Boolean);b&&void 0===this.us&&(this.us=requestAnimationFrame(this.vs))}};function Ci(a,b,c){var d,e=a.Ka();void 0!==e&&(d=[e[0]-c[0],e[1]-c[1]],Zf(d,b-a.Cb()),Vf(d,c));return d}
function Bi(a,b,c){var d,e=a.Ka();a=a.Fa();void 0!==e&&void 0!==a&&(d=[c[0]-b*(c[0]-e[0])/a,c[1]-b*(c[1]-e[1])/a]);return d}function Di(a){var b=[100,100];a='.ol-viewport[data-view="'+I(a)+'"]';if(a=document.querySelector(a))a=getComputedStyle(a),b[0]=parseInt(a.width,10),b[1]=parseInt(a.height,10);return b}l.kc=function(a,b,c){return this.Wf.ra(a,b||0,c||0)};l.tp=function(a,b){return this.Wf.rotation(a,b||0)};l.Ka=function(){return this.get("center")};
function Ei(a,b){b=b||Di(a);var c=a.Ka();yf(c,1);var d=a.Fa();yf(void 0!==d,2);a=a.Cb();yf(void 0!==a,3);return Cg(c,d,a,b)}l.Tk=function(){return this.kg};l.Uk=function(){return this.yn};l.lA=function(){return Fi(this,this.yn)};l.xu=function(){return Fi(this,this.kg)};l.J=function(){return this.Dl};l.Fa=function(){return this.get("resolution")};l.qj=function(){return this.Ub};function Gi(a,b,c){a=c||Di(a);return Math.max(zg(b)/a[0],Ag(b)/a[1])}
function Hi(a){var b=a.kg,c=Math.log(b/a.yn)/Math.log(2);return function(a){return b/Math.pow(2,a*c)}}l.Cb=function(){return this.get("rotation")};function Ii(a){var b=a.kg,c=Math.log(b/a.yn)/Math.log(2);return function(a){return Math.log(b/a)/Math.log(2)/c}}l.ab=function(){var a=this.Ka(),b=this.J(),c=this.Fa(),d=this.Cb();return{Oa:a.slice(),pa:void 0!==b?b:null,ra:c,rotation:d,zoom:this.zf()}};l.zf=function(){var a,b=this.Fa();void 0!==b&&(a=Fi(this,b));return a};
function Fi(a,b){var c=a.zn||0,d;if(a.Ub){var e=af(a.Ub,b,1),c=e;d=a.Ub[e];a=e==a.Ub.length-1?2:d/a.Ub[e+1]}else d=a.kg,a=a.Oo;return c+Math.log(d/b)/Math.log(a)}
function Ji(a,b,c){c=c||{};var d=c.size;d||(d=Di(a));var e;b instanceof Nh?"Circle"===b.F()?(b=b.V(),e=wi(b),e.rotate(a.Cb(),Bg(b))):e=b:(yf(Array.isArray(b),24),yf(!yg(b),25),e=wi(b));var f=void 0!==c.padding?c.padding:[0,0,0,0],g=void 0!==c.kc?c.kc:!0,h=void 0!==c.Dj?c.Dj:!1,k;k=void 0!==c.Se?c.Se:void 0!==c.Cc?a.kc(a.kg,c.Cc-a.zn,0):0;var m=e.l,p=a.Cb();b=Math.cos(-p);var p=Math.sin(-p),t=Infinity,u=Infinity,w=-Infinity,x=-Infinity;e=e.S;for(var z=0,D=m.length;z<D;z+=e)var H=m[z]*b-m[z+1]*p,G=
m[z]*p+m[z+1]*b,t=Math.min(t,H),u=Math.min(u,G),w=Math.max(w,H),x=Math.max(x,G);d=Gi(a,[t,u,w,x],[d[0]-f[1]-f[3],d[1]-f[0]-f[2]]);d=isNaN(d)?k:Math.max(d,k);g&&(g=a.kc(d,0,0),!h&&g<d&&(g=a.kc(g,-1,0)),d=g);p=-p;h=(t+w)/2+(f[1]-f[3])/2*d;f=(u+x)/2+(f[0]-f[2])/2*d;b=[h*b-f*p,f*b+h*p];f=c.Bb?c.Bb:Dd;void 0!==c.duration?a.animate({ra:d,Oa:b,duration:c.duration,Wc:c.Wc},f):(Ki(a,d),a.tb(b),setTimeout(f.bind(void 0,!0),0))}l.nn=function(){return!!this.Ka()&&void 0!==this.Fa()};
l.rotate=function(a,b){void 0!==b&&(b=Ci(this,a,b),this.tb(b));this.Rl(a)};l.tb=function(a){this.set("center",a);0<this.Zd[0]&&Ai(this)};function zi(a,b,c){a.Zd[b]+=c;a.L()}function Ki(a,b){a.set("resolution",b);0<a.Zd[0]&&Ai(a)}l.Rl=function(a){this.set("rotation",a);0<this.Zd[0]&&Ai(this)};l.Tj=function(a){Ki(this,this.kc(this.kg,a-this.zn,0))};function Li(a,b){var c=document.createElement("CANVAS");a&&(c.width=a);b&&(c.height=b);return c.getContext("2d")}function Mi(a,b){var c=b.parentNode;c&&c.replaceChild(a,b)}function Ni(a){a&&a.parentNode&&a.parentNode.removeChild(a)};function Oi(a){be.call(this);var b=Gd({},a);b.opacity=void 0!==a.opacity?a.opacity:1;b.visible=void 0!==a.visible?a.visible:!0;b.zIndex=void 0!==a.zIndex?a.zIndex:0;b.maxResolution=void 0!==a.Df?a.Df:Infinity;b.minResolution=void 0!==a.Se?a.Se:0;ce(this,b);this.fa={layer:this,Uq:!0}}F(Oi,be);l=Oi.prototype;l.F=function(){return this.type};
function Pi(a){a.fa.opacity=Ef(a.Vg(),0,1);a.fa.AD=a.Eu();a.fa.visible=a.getVisible();a.fa.aa=a.V();a.fa.zIndex=a.Xc();a.fa.Df=a.Tk();a.fa.Se=Math.max(a.Uk(),0);return a.fa}l.V=function(){return this.get("extent")};l.Tk=function(){return this.get("maxResolution")};l.Uk=function(){return this.get("minResolution")};l.Vg=function(){return this.get("opacity")};l.getVisible=function(){return this.get("visible")};l.Xc=function(){return this.get("zIndex")};l.co=function(a){this.set("extent",a)};
l.Ql=function(a){this.set("opacity",a)};l.setVisible=function(a){this.set("visible",a)};l.tD=function(a){this.set("zIndex",a)};function Qi(a){var b=a||{};a=Gd({},b);delete a.vb;b=b.vb;Oi.call(this,a);this.iv=[];this.Aj={};J(this,ee(Ri),this.aJ,this);b?Array.isArray(b)?b=new he(b.slice(),{unique:!0}):yf(b instanceof he,43):b=new he(void 0,{unique:!0});this.set(Ri,b)}F(Qi,Oi);l=Qi.prototype;l.nq=function(){this.L()};
l.aJ=function(){this.iv.forEach(Ld);this.iv.length=0;var a=this.getLayers();this.iv.push(J(a,"add",this.$I,this),J(a,"remove",this.bJ,this));for(var b in this.Aj)this.Aj[b].forEach(Ld);Hd(this.Aj);var a=a.P(),c,d;b=0;for(c=a.length;b<c;b++)d=a[b],this.Aj[I(d).toString()]=[J(d,"propertychange",this.nq,this),J(d,"change",this.nq,this)];this.L()};l.$I=function(a){a=a.element;var b=I(a).toString();this.Aj[b]=[J(a,"propertychange",this.nq,this),J(a,"change",this.nq,this)];this.L()};
l.bJ=function(a){a=I(a.element).toString();this.Aj[a].forEach(Ld);delete this.Aj[a];this.L()};l.getLayers=function(){return this.get(Ri)};l.uu=function(a){var b=void 0!==a?a:[],c=b.length;this.getLayers().forEach(function(a){a.uu(b)});a=Pi(this);var d,e;for(d=b.length;c<d;c++)e=b[c],e.opacity*=a.opacity,e.visible=e.visible&&a.visible,e.Df=Math.min(e.Df,a.Df),e.Se=Math.max(e.Se,a.Se),void 0!==a.aa&&(e.aa=void 0!==e.aa?Dg(e.aa,a.aa):a.aa);return b};l.Eu=function(){return"ready"};var Ri="layers";var Si=[],Ti=[];function Ui(a,b){switch(a){case "MAP_RENDERER":a=Si;a.push(b);break;case "LAYER_RENDERER":a=Ti;a.push(b);break;default:throw Error("Unsupported plugin type: "+a);}}function Vi(a){for(var b=0,c=a.length;b<c;++b)Ui("LAYER_RENDERER",a[b])};function Wi(a,b,c){void 0===c&&(c=[0,0]);c[0]=a[0]*b+.5|0;c[1]=a[1]*b+.5|0;return c}function Xi(a,b){if(Array.isArray(a))return a;void 0===b?b=[a,a]:b[0]=b[1]=a;return b};function Yi(a){be.call(this);var b=ej(a);this.eK=void 0!==a.dK?a.dK:!1;this.gK=void 0!==a.fK?a.fK:!1;this.og=void 0!==a.mb?a.mb:Ae;this.sK=b.ml;this.Tx=function(){this.Yi=void 0;this.IM.call(this,Date.now())}.bind(this);this.lG=wh();this.WL=wh();this.wH=0;this.Kq=this.Fs=this.Gs=this.pi=this.Jc=null;this.ac=document.createElement("DIV");this.ac.className="ol-viewport"+(De?" ol-touch":"");this.ac.style.position="relative";this.ac.style.overflow="hidden";this.ac.style.width="100%";this.ac.style.height=
"100%";this.ac.style.msTouchAction="none";this.ac.style.touchAction="none";this.In=document.createElement("DIV");this.In.className="ol-overlaycontainer";this.ac.appendChild(this.In);this.Hn=document.createElement("DIV");this.Hn.className="ol-overlaycontainer-stopevent";for(var c="click dblclick mousedown touchstart MSPointerDown pointerdown mousewheel wheel".split(" "),d=0,e=c.length;d<e;++d)J(this.Hn,c[d],Xd);this.ac.appendChild(this.Hn);this.uB=new vf(this,a.$K);for(var f in Ke)J(this.uB,Ke[f],
this.xA,this);this.UA=b.rn;this.qn=null;J(this.ac,"wheel",this.Xk,this);J(this.ac,"mousewheel",this.Xk,this);this.controls=b.controls||new he;this.Rc=b.Rc||new he;this.fd=b.wl;this.lC={};this.Jl=b.xK.create(this.ac,this);this.jj=null;this.qC=[];this.UD=new Df(this.xI.bind(this),this.tJ.bind(this));this.yw={};J(this,ee("layergroup"),this.YI,this);J(this,ee("view"),this.xJ,this);J(this,ee("size"),this.nJ,this);J(this,ee("target"),this.sJ,this);ce(this,b.values);this.controls.forEach(function(a){a.ib(this)},
this);J(this.controls,"add",function(a){a.element.ib(this)},this);J(this.controls,"remove",function(a){a.element.ib(null)},this);this.Rc.forEach(function(a){a.ib(this)},this);J(this.Rc,"add",function(a){a.element.ib(this)},this);J(this.Rc,"remove",function(a){a.element.ib(null)},this);this.fd.forEach(this.Rx,this);J(this.fd,"add",function(a){this.Rx(a.element)},this);J(this.fd,"remove",function(a){var b=a.element.mc();void 0!==b&&delete this.lC[b.toString()];a.element.ib(null)},this)}F(Yi,be);l=Yi.prototype;
l.ad=function(a){this.$f().push(a)};l.Ob=function(a){this.Rc.push(a)};l.Pb=function(a){fj(this).getLayers().push(a)};l.Hg=function(a){this.fd.push(a)};l.Rx=function(a){var b=a.mc();void 0!==b&&(this.lC[b.toString()]=a);a.ib(this)};l.Ya=function(){this.uB.ue();Td(this.ac,"wheel",this.Xk,this);Td(this.ac,"mousewheel",this.Xk,this);void 0!==this.Wh&&(window.removeEventListener("resize",this.Wh,!1),this.Wh=void 0);this.Yi&&(cancelAnimationFrame(this.Yi),this.Yi=void 0);this.yi(null);be.prototype.Ya.call(this)};
function gj(a,b,c,d){if(a.Jc)return b=a.zc(b),d=void 0!==d?d:{},a.Jl.yc(b,a.Jc,void 0!==d.$h?d.$h*a.Jc.mb:0,c,null,void 0!==d.Iq?d.Iq:Ig,null)}function pe(a,b){a=a.ac.getBoundingClientRect();b=b.changedTouches?b.changedTouches[0]:b;return[b.clientX-a.left,b.clientY-a.top]}function hj(a){a=a.get("target");return void 0!==a?"string"===typeof a?document.getElementById(a):a:null}l.zc=function(a){var b=this.Jc;return b?Bh(b.nC,a.slice()):null};l.$f=function(){return this.controls};
function fj(a){return a.get("layergroup")}l.getLayers=function(){return fj(this).getLayers()};function ij(a,b){return(a=a.Jc)?Bh(a.Ek,b.slice(0,2)):null}l.$a=function(){return this.get("size")};function E(a){return a.get("view")}l.xI=function(a,b,c,d){var e=this.Jc;if(!(e&&b in e.Ko&&e.Ko[b][a.getKey()]))return Infinity;a=c[0]-e.focus[0];c=c[1]-e.focus[1];return 65536*Math.log(d)+Math.sqrt(a*a+c*c)/d};l.Xk=function(a,b){a=new oe(b||a.type,this,a);this.xA(a)};
l.xA=function(a){if(this.Jc){this.jj=a.Qb;a.wf=this.Jc;var b=this.Rc.P(),c;if(!1!==this.dispatchEvent(a))for(c=b.length-1;0<=c;c--){var d=b[c];if(jj(d)&&!d.handleEvent(a))break}}};
l.mJ=function(){var a=this.Jc,b=this.UD;if(!b.Bf()){var c=16,d=c;if(a){var e=a.Of;e[0]&&(c=this.eK?8:0,d=2);e[1]&&(c=this.gK?8:0,d=2)}if(b.ls<c){Cf(b);for(var e=0,f=!1,g,h,k;b.ls<c&&e<d&&0<b.Qk();)h=b.dequeue()[0],k=h.getKey(),g=h.ab(),5===g?f=!0:0!==g||k in b.ks||(b.ks[k]=!0,++b.ls,++e,h.load());0===e&&f&&b.TD()}}b=this.qC;c=0;for(d=b.length;c<d;++c)b[c](this,a);b.length=0};l.nJ=function(){this.La()};
l.sJ=function(){var a;this.get("target")&&(a=hj(this));if(this.qn){for(var b=0,c=this.qn.length;b<c;++b)Ld(this.qn[b]);this.qn=null}if(a){a.appendChild(this.ac);var d=this.UA?this.UA:a;this.qn=[J(d,"keydown",this.Xk,this),J(d,"keypress",this.Xk,this)];this.Wh||(this.Wh=this.Qd.bind(this),window.addEventListener("resize",this.Wh,!1))}else{a=this.Jl;for(d in a.bh)kj(a,d).ue();Ni(this.ac);void 0!==this.Wh&&(window.removeEventListener("resize",this.Wh,!1),this.Wh=void 0)}this.Qd()};l.tJ=function(){this.La()};
l.AA=function(){this.La()};l.xJ=function(){this.Gs&&(Ld(this.Gs),this.Gs=null);this.Fs&&(Ld(this.Fs),this.Fs=null);var a=E(this);a&&(this.ac.setAttribute("data-view",I(a)),this.Gs=J(a,"propertychange",this.AA,this),this.Fs=J(a,"change",this.AA,this));this.La()};l.YI=function(){this.Kq&&(this.Kq.forEach(Ld),this.Kq=null);var a=fj(this);a&&(this.Kq=[J(a,"propertychange",this.La,this),J(a,"change",this.La,this)]);this.La()};l.La=function(){void 0===this.Yi&&(this.Yi=requestAnimationFrame(this.Tx))};
l.hd=function(a){return this.Rc.remove(a)};l.Fl=function(a){return fj(this).getLayers().remove(a)};
l.IM=function(a){var b,c,d=this.$a(),e=E(this),f=gg(),g=this.Jc,h=null;if(void 0!==d&&0<d[0]&&0<d[1]&&e&&e.nn()){h=this.Jc?this.Jc.Of:void 0;void 0!==h?(h[0]=e.Zd[0],h[1]=e.Zd[1]):h=e.Zd.slice();var k=fj(this).uu(),m={};b=0;for(c=k.length;b<c;++b)m[I(k[b].layer)]=k[b];b=e.ab();e=b.Oa;c=b.ra/this.og;e[0]=Math.round(e[0]/c)*c;e[1]=Math.round(e[1]/c)*c;h={animate:!1,Ek:this.lG,aa:f,focus:this.jj?this.jj:e,index:this.wH++,Lq:m,hl:k,ml:Gd({},this.sK),mb:this.og,nC:this.WL,qg:[],size:d,Xl:this.yw,kO:this.UD,
time:a,Bs:{},Ma:b,Of:h,Ko:{}}}h&&(h.aa=Cg(b.Oa,b.ra,b.rotation,h.size,f));this.Jc=h;this.Jl.fw(h);h&&(h.animate&&this.La(),Array.prototype.push.apply(this.qC,h.qg),!g||this.pi&&(yg(this.pi)||ug(h.aa,this.pi))||(this.dispatchEvent(new ne("movestart",this,g)),this.pi=sg(this.pi)),!this.pi||h.Of[0]||h.Of[1]||ug(h.aa,this.pi)||(this.dispatchEvent(new ne("moveend",this,h)),jg(h.aa,this.pi)));this.dispatchEvent(new ne("postrender",this,h));setTimeout(this.mJ.bind(this),0)};
l.Sl=function(a){this.set("size",a)};l.yi=function(a){this.set("target",a)};l.zi=function(a){this.set("view",a)};l.wD=function(a){a=I(a).toString();this.yw[a]=!0;this.La()};l.Qd=function(){var a=hj(this);if(a){var b=getComputedStyle(a);this.Sl([a.offsetWidth-parseFloat(b.borderLeftWidth)-parseFloat(b.paddingLeft)-parseFloat(b.paddingRight)-parseFloat(b.borderRightWidth),a.offsetHeight-parseFloat(b.borderTopWidth)-parseFloat(b.paddingTop)-parseFloat(b.paddingBottom)-parseFloat(b.borderBottomWidth)])}else this.Sl(void 0)};
l.gE=function(a){a=I(a).toString();delete this.yw[a];this.La()};var lj=["canvas","webgl"];
function ej(a){var b=null;void 0!==a.rn&&(b="string"===typeof a.rn?document.getElementById(a.rn):a.rn);var c={},d={};if(void 0===a.dc||"boolean"===typeof a.dc&&a.dc)d["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAHGAAABxgEXwfpGAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAhNQTFRF////AP//AICAgP//AFVVQECA////K1VVSbbbYL/fJ05idsTYJFtbbcjbJllmZszWWMTOIFhoHlNiZszTa9DdUcHNHlNlV8XRIVdiasrUHlZjIVZjaMnVH1RlIFRkH1RkH1ZlasvYasvXVsPQH1VkacnVa8vWIVZjIFRjVMPQa8rXIVVkXsXRsNveIFVkIFZlIVVj3eDeh6GmbMvXH1ZkIFRka8rWbMvXIFVkIFVjIFVkbMvWH1VjbMvWIFVlbcvWIFVla8vVIFVkbMvWbMvVH1VkbMvWIFVlbcvWIFVkbcvVbMvWjNPbIFVkU8LPwMzNIFVkbczWIFVkbsvWbMvXIFVkRnB8bcvW2+TkW8XRIFVkIlZlJVloJlpoKlxrLl9tMmJwOWd0Omh1RXF8TneCT3iDUHiDU8LPVMLPVcLPVcPQVsPPVsPQV8PQWMTQWsTQW8TQXMXSXsXRX4SNX8bSYMfTYcfTYsfTY8jUZcfSZsnUaIqTacrVasrVa8jTa8rWbI2VbMvWbcvWdJObdcvUdszUd8vVeJaee87Yfc3WgJyjhqGnitDYjaarldPZnrK2oNbborW5o9bbo9fbpLa6q9ndrL3ArtndscDDutzfu8fJwN7gwt7gxc/QyuHhy+HizeHi0NfX0+Pj19zb1+Tj2uXk29/e3uLg3+Lh3+bl4uXj4ufl4+fl5Ofl5ufl5ujm5+jmySDnBAAAAFp0Uk5TAAECAgMEBAYHCA0NDg4UGRogIiMmKSssLzU7PkJJT1JTVFliY2hrdHZ3foSFhYeJjY2QkpugqbG1tre5w8zQ09XY3uXn6+zx8vT09vf4+Pj5+fr6/P39/f3+gz7SsAAAAVVJREFUOMtjYKA7EBDnwCPLrObS1BRiLoJLnte6CQy8FLHLCzs2QUG4FjZ5GbcmBDDjxJBXDWxCBrb8aM4zbkIDzpLYnAcE9VXlJSWlZRU13koIeW57mGx5XjoMZEUqwxWYQaQbSzLSkYGfKFSe0QMsX5WbjgY0YS4MBplemI4BdGBW+DQ11eZiymfqQuXZIjqwyadPNoSZ4L+0FVM6e+oGI6g8a9iKNT3o8kVzNkzRg5lgl7p4wyRUL9Yt2jAxVh6mQCogae6GmflI8p0r13VFWTHBQ0rWPW7ahgWVcPm+9cuLoyy4kCJDzCm6d8PSFoh0zvQNC5OjDJhQopPPJqph1doJBUD5tnkbZiUEqaCnB3bTqLTFG1bPn71kw4b+GFdpLElKIzRxxgYgWNYc5SCENVHKeUaltHdXx0dZ8uBI1hJ2UUDgq82CM2MwKeibqAvSO7MCABq0wXEPiqWEAAAAAElFTkSuQmCC"]="https://openlayers.org/";
else{var e=a.dc;"string"===typeof e?d[e]="":e instanceof HTMLElement?d[I(e).toString()]=e:e&&(yf("string"==typeof e.href,44),yf("string"==typeof e.src,45),d[e.src]=e.href)}e=a.vb instanceof Qi?a.vb:new Qi({vb:a.vb});c.layergroup=e;c.target=a.target;c.view=void 0!==a.view?a.view:new yi;var f;void 0!==a.Il?(Array.isArray(a.Il)?f=a.Il:"string"===typeof a.Il?f=[a.Il]:yf(!1,46),0<=f.indexOf("dom")&&(f=f.concat(lj))):f=lj;var g,e=0,h=f.length;a:for(;e<h;++e)for(var k=f[e],m=0,p=Si.length;m<p;++m){var t=
Si[m];if(t.handles(k)){g=t;break a}}if(!g)throw Error("Unable to create a map renderer for types: "+f.join(", "));var u;void 0!==a.controls&&(Array.isArray(a.controls)?u=new he(a.controls.slice()):(yf(a.controls instanceof he,47),u=a.controls));var w;void 0!==a.Rc&&(Array.isArray(a.Rc)?w=new he(a.Rc.slice()):(yf(a.Rc instanceof he,48),w=a.Rc));void 0!==a.wl?Array.isArray(a.wl)?a=new he(a.wl.slice()):(yf(a.wl instanceof he,49),a=a.wl):a=new he;return{controls:u,Rc:w,rn:b,ml:d,wl:a,xK:g,values:c}};function mj(a){be.call(this);this.element=a.element?a.element:null;this.W=this.Jw=null;this.zj=[];this.La=a.La?a.La:Dd;a.target&&this.yi(a.target)}F(mj,be);mj.prototype.Ya=function(){Ni(this.element);be.prototype.Ya.call(this)};mj.prototype.g=function(){return this.W};
mj.prototype.ib=function(a){this.W&&Ni(this.element);for(var b=0,c=this.zj.length;b<c;++b)Ld(this.zj[b]);this.zj.length=0;if(this.W=a)(this.Jw?this.Jw:a.Hn).appendChild(this.element),this.La!==Dd&&this.zj.push(J(a,"postrender",this.La,this)),a.La()};mj.prototype.yi=function(a){this.Jw="string"===typeof a?document.getElementById(a):a};var nj=function(){var a,b={};return function(c){a||(a=document.createElement("div").style);if(!(c in b)){a.font=c;var d=a.fontFamily;a.font="";if(!d)return null;b[c]=d.split(/,\s?/)}return b[c]}}();function oj(a){var b=Gd({},a);delete b.source;Oi.call(this,b);this.$r=this.Xq=this.Wq=null;a.map&&this.ib(a.map);J(this,ee("source"),this.qJ,this);this.set("source",a.source?a.source:null)}F(oj,Oi);function pj(a,b){return a.visible&&b>=a.Se&&b<a.Df}l=oj.prototype;l.uu=function(a){a=a?a:[];a.push(Pi(this));return a};l.s=function(){return this.get("source")||null};l.Eu=function(){var a=this.s();return a?a.ab():"undefined"};l.pJ=function(){this.L()};
l.qJ=function(){this.$r&&(Ld(this.$r),this.$r=null);var a=this.s();a&&(this.$r=J(a,"change",this.pJ,this));this.L()};l.ib=function(a){this.Wq&&(Ld(this.Wq),this.Wq=null);a||this.L();this.Xq&&(Ld(this.Xq),this.Xq=null);a&&(this.Wq=J(a,"precompose",function(a){var b=Pi(this);b.Uq=!1;b.zIndex=Infinity;a.wf.hl.push(b);a.wf.Lq[I(this)]=b},this),this.Xq=J(this,"change",a.La,a),this.L())};function qj(a){a=a?a:{};this.jm=document.createElement("UL");this.ll=document.createElement("LI");this.jm.appendChild(this.ll);this.ll.style.display="none";this.Ud=void 0!==a.collapsed?a.collapsed:!0;this.Lg=void 0!==a.Dt?a.Dt:!0;this.Lg||(this.Ud=!1);var b=void 0!==a.className?a.className:"ol-attribution",c=void 0!==a.yh?a.yh:"Attributions",d=void 0!==a.Ct?a.Ct:"\u00bb";"string"===typeof d?(this.sf=document.createElement("span"),this.sf.textContent=d):this.sf=d;d=void 0!==a.label?a.label:"i";"string"===
typeof d?(this.Ac=document.createElement("span"),this.Ac.textContent=d):this.Ac=d;var e=this.Lg&&!this.Ud?this.sf:this.Ac,d=document.createElement("button");d.setAttribute("type","button");d.title=c;d.appendChild(e);J(d,"click",this.Qe,this);c=document.createElement("div");c.className=b+" ol-unselectable ol-control"+(this.Ud&&this.Lg?" ol-collapsed":"")+(this.Lg?"":" ol-uncollapsible");c.appendChild(this.jm);c.appendChild(d);mj.call(this,{element:c,La:a.La?a.La:rj,target:a.target});this.Kr=[];this.Mc=
!0;this.rK={}}F(qj,mj);function rj(a){this.xs(a.wf)}
qj.prototype.xs=function(a){if(a){for(var b={},c=[],d=a.hl,e=a.Ma.ra,f=0,g=d.length;f<g;++f){var h=d[f];if(pj(h,e)&&(h=h.layer.s())&&(h=h.Ky)&&(h=h(a)))if(Array.isArray(h))for(var k=0,m=h.length;k<m;++k)h[k]in b||(c.push(h[k]),b[h[k]]=!0);else h in b||(c.push(h),b[h]=!0)}if(!df(c,this.Kr)){for(;this.jm.lastChild!==this.ll;)this.jm.removeChild(this.jm.lastChild);b=0;for(d=c.length;b<d;++b)e=document.createElement("LI"),e.innerHTML=c[b],this.jm.appendChild(e);0===c.length&&0<this.Kr.length?this.element.classList.add("ol-logo-only"):
0===this.Kr.length&&0<c.length&&this.element.classList.remove("ol-logo-only");b=0<c.length||!Jd(a.ml);this.Mc!=b&&(this.element.style.display=b?"":"none",this.Mc=b);this.Kr=c;var p;a=a.ml;c=this.rK;for(p in c)p in a||(Ni(c[p]),delete c[p]);for(var t in a)d=a[t],d instanceof HTMLElement&&(this.ll.appendChild(d),c[t]=d),t in c||(p=new Image,p.src=t,""===d?b=p:(b=document.createElement("a"),b.href=d,b.appendChild(p)),this.ll.appendChild(b),c[t]=b);this.ll.style.display=Jd(a)?"none":""}}else this.Mc&&
(this.element.style.display="none",this.Mc=!1)};qj.prototype.Qe=function(a){a.preventDefault();this.Pu()};qj.prototype.Pu=function(){this.element.classList.toggle("ol-collapsed");this.Ud?Mi(this.sf,this.Ac):Mi(this.Ac,this.sf);this.Ud=!this.Ud};function sj(a){a=a?a:{};var b=void 0!==a.className?a.className:"ol-rotate",c=void 0!==a.label?a.label:"\u21e7";this.Ac=null;"string"===typeof c?(this.Ac=document.createElement("span"),this.Ac.className="ol-compass",this.Ac.textContent=c):(this.Ac=c,this.Ac.classList.add("ol-compass"));var d=a.yh?a.yh:"Reset rotation",c=document.createElement("button");c.className=b+"-reset";c.setAttribute("type","button");c.title=d;c.appendChild(this.Ac);J(c,"click",sj.prototype.Qe,this);d=document.createElement("div");
d.className=b+" ol-unselectable ol-control";d.appendChild(c);b=a.La?a.La:tj;this.Ty=a.OM?a.OM:void 0;mj.call(this,{element:d,La:b,target:a.target});this.Yb=void 0!==a.duration?a.duration:250;this.My=void 0!==a.Ly?a.Ly:!0;this.Md=void 0;this.My&&this.element.classList.add("ol-hidden")}F(sj,mj);sj.prototype.Qe=function(a){a.preventDefault();void 0!==this.Ty?this.Ty():(a=E(this.g()))&&void 0!==a.Cb()&&(0<this.Yb?a.animate({rotation:0,duration:this.Yb,Wc:cg}):a.Rl(0))};
function tj(a){if(a=a.wf){a=a.Ma.rotation;if(a!=this.Md){var b="rotate("+a+"rad)";if(this.My){var c=this.element.classList.contains("ol-hidden");c||0!==a?c&&0!==a&&this.element.classList.remove("ol-hidden"):this.element.classList.add("ol-hidden")}this.Ac.style.msTransform=b;this.Ac.style.webkitTransform=b;this.Ac.style.transform=b}this.Md=a}};function uj(a){a=a?a:{};var b=void 0!==a.className?a.className:"ol-zoom",c=void 0!==a.ej?a.ej:1,d=void 0!==a.lP?a.lP:"+",e=void 0!==a.nP?a.nP:"\u2212",f=void 0!==a.mP?a.mP:"Zoom in",g=void 0!==a.oP?a.oP:"Zoom out",h=document.createElement("button");h.className=b+"-in";h.setAttribute("type","button");h.title=f;h.appendChild("string"===typeof d?document.createTextNode(d):d);J(h,"click",uj.prototype.Qe.bind(this,c));d=document.createElement("button");d.className=b+"-out";d.setAttribute("type","button");
d.title=g;d.appendChild("string"===typeof e?document.createTextNode(e):e);J(d,"click",uj.prototype.Qe.bind(this,-c));c=document.createElement("div");c.className=b+" ol-unselectable ol-control";c.appendChild(h);c.appendChild(d);mj.call(this,{element:c,target:a.target});this.Yb=void 0!==a.duration?a.duration:250}F(uj,mj);uj.prototype.Qe=function(a,b){b.preventDefault();if(b=E(this.g())){var c=b.Fa();c&&(a=b.kc(c,a),0<this.Yb?(0<b.Zd[0]&&Ai(b),b.animate({ra:a,duration:this.Yb,Wc:cg})):Ki(b,a))}};function vj(a,b,c){this.vG=a;this.MB=b;this.CG=c;this.Lc=[];this.yq=this.qf=0}function wj(a){a.Lc.length=0;a.qf=0;a.yq=0}vj.prototype.update=function(a,b){this.Lc.push(a,b,Date.now())};
vj.prototype.end=function(){if(6>this.Lc.length)return!1;var a=Date.now()-this.CG,b=this.Lc.length-3;if(this.Lc[b+2]<a)return!1;for(var c=b-3;0<c&&this.Lc[c+2]>a;)c-=3;a=this.Lc[b+2]-this.Lc[c+2];if(a<1E3/60)return!1;var d=this.Lc[b]-this.Lc[c],b=this.Lc[b+1]-this.Lc[c+1];this.qf=Math.atan2(b,d);this.yq=Math.sqrt(d*d+b*b)/a;return this.yq>this.MB};function xj(a){be.call(this);this.W=null;this.setActive(!0);this.handleEvent=a.handleEvent}F(xj,be);function jj(a){return a.get("active")}xj.prototype.g=function(){return this.W};xj.prototype.setActive=function(a){this.set("active",a)};xj.prototype.ib=function(a){this.W=a};function yj(a,b,c,d){if(void 0!==b){var e=a.Cb(),f=a.Ka();void 0!==e&&f&&0<d?a.animate({rotation:b,anchor:c,duration:d,Wc:cg}):a.rotate(b,c)}}
function zj(a,b,c,d){var e=a.Fa();b=a.kc(e,b,0);if(void 0!==b){var f=a.qj();b=Ef(b,a.Uk()||f[f.length-1],a.Tk()||f[0])}c&&void 0!==b&&b!==e&&(f=a.Ka(),c=Bi(a,b,c),c=a.Wf.Oa(c),c=[(b*f[0]-e*c[0])/(b-e),(b*f[1]-e*c[1])/(b-e)]);Aj(a,b,c,d)}function Aj(a,b,c,d){if(b){var e=a.Fa(),f=a.Ka();void 0!==e&&f&&b!==e&&d?a.animate({ra:b,anchor:c,duration:d,Wc:cg}):(c&&(c=Bi(a,b,c),a.tb(c)),Ki(a,b))}};function Bj(a){a=a?a:{};this.Yf=a.ej?a.ej:1;xj.call(this,{handleEvent:Cj});this.Yb=void 0!==a.duration?a.duration:250}F(Bj,xj);function Cj(a){var b=!1,c=a.originalEvent;if("dblclick"==a.type){var b=a.Qb,c=c.shiftKey?-this.Yf:this.Yf,d=E(a.map);zj(d,c,b,this.Yb);a.preventDefault();b=!0}return!b};function Dj(a){a=a.originalEvent;return a.altKey&&!(a.metaKey||a.ctrlKey)&&a.shiftKey}function Ej(a){return"click"==a.type}function Fj(a){a=a.originalEvent;return 0==a.button&&!(ye&&ze&&a.ctrlKey)}function Gj(a){return"pointermove"==a.type}function Hj(a){return"singleclick"==a.type}function Ij(a){a=a.originalEvent;return!a.altKey&&!(a.metaKey||a.ctrlKey)&&!a.shiftKey}function Jj(a){a=a.originalEvent;return!a.altKey&&!(a.metaKey||a.ctrlKey)&&a.shiftKey}
function Kj(a){a=a.originalEvent.target.tagName;return"INPUT"!==a&&"SELECT"!==a&&"TEXTAREA"!==a}function Lj(a){yf(a.vr,56);return"mouse"==a.vr.pointerType}function Mj(a){a=a.vr;return a.isPrimary&&0===a.button};function Nj(a){a=a?a:{};xj.call(this,{handleEvent:a.handleEvent?a.handleEvent:Oj});this.MI=a.bg?a.bg:Jg;this.NI=a.Vh?a.Vh:Dd;this.hJ=a.yA?a.yA:Dd;this.wJ=a.cg?a.cg:Jg;this.Yh=!1;this.zo={};this.vd=[]}F(Nj,xj);function Pj(a){for(var b=a.length,c=0,d=0,e=0;e<b;e++)c+=a[e].clientX,d+=a[e].clientY;return[c/b,d/b]}
function Oj(a){if(!(a instanceof Le))return!0;var b=!1,c=a.type;if("pointerdown"===c||"pointerdrag"===c||"pointerup"===c){var c=a.vr,d=c.pointerId.toString();"pointerup"==a.type?delete this.zo[d]:"pointerdown"==a.type?this.zo[d]=c:d in this.zo&&(this.zo[d]=c);this.vd=Id(this.zo)}this.Yh?"pointerdrag"==a.type?this.NI(a):"pointerup"==a.type&&(this.Yh=this.wJ(a)&&0<this.vd.length):"pointerdown"==a.type?(this.Yh=a=this.MI(a),b=this.Uj(a)):"pointermove"==a.type&&this.hJ(a);return!b}Nj.prototype.Uj=function(a){return a};function Qj(a){Nj.call(this,{bg:Rj,Vh:Sj,cg:Tj});a=a?a:{};this.Re=a.RJ;this.gl=null;this.od=a.Xb?a.Xb:Ij;this.TB=!1}F(Qj,Nj);function Sj(a){var b=this.vd,c=Pj(b);if(b.length==this.UJ){if(this.Re&&this.Re.update(c[0],c[1]),this.gl){var d=this.gl[0]-c[0],e=c[1]-this.gl[1];a=E(a.map);var f=a.ab(),e=d=[d,e],g=f.ra;e[0]*=g;e[1]*=g;Zf(d,f.rotation);Vf(d,f.Oa);d=a.Wf.Oa(d);a.tb(d)}}else this.Re&&wj(this.Re);this.gl=c;this.UJ=b.length}
function Tj(a){var b=a.map;a=E(b);if(0===this.vd.length){if(!this.TB&&this.Re&&this.Re.end()){var c;c=this.Re;c=(c.MB-c.yq)/c.vG;var d=this.Re.qf,e=a.Ka(),e=ij(b,e),b=b.zc([e[0]-c*Math.cos(d),e[1]-c*Math.sin(d)]);a.animate({Oa:a.Wf.Oa(b),duration:500,Wc:cg})}zi(a,1,-1);return!1}this.Re&&wj(this.Re);this.gl=null;return!0}
function Rj(a){if(0<this.vd.length&&this.od(a)){var b=E(a.map);this.gl=null;this.Yh||zi(b,1,1);0<b.Zd[0]&&b.tb(a.wf.Ma.Oa);this.Re&&wj(this.Re);this.TB=1<this.vd.length;return!0}return!1}Qj.prototype.Uj=Jg;function Uj(a){a=a?a:{};Nj.call(this,{bg:Vj,Vh:Wj,cg:Xj});this.od=a.Xb?a.Xb:Dj;this.ah=void 0;this.Yb=void 0!==a.duration?a.duration:250}F(Uj,Nj);function Wj(a){if(Lj(a)){var b=a.map,c=E(b);if(c.Wf.rotation!==Pf){b=b.$a();a=a.Sc;a=Math.atan2(b[1]/2-a[1],a[0]-b[0]/2);if(void 0!==this.ah){var b=a-this.ah,d=c.Cb();yj(c,d-b)}this.ah=a}}}function Xj(a){if(!Lj(a))return!0;a=E(a.map);zi(a,1,-1);var b=a.Cb(),c=this.Yb,b=a.tp(b,0);yj(a,b,void 0,c);return!1}
function Vj(a){return Lj(a)&&Fj(a)&&this.od(a)?(zi(E(a.map),1,1),this.ah=void 0,!0):!1}Uj.prototype.Uj=Jg;function Yj(a){this.mj=null;this.qd=document.createElement("div");this.qd.style.position="absolute";this.qd.className="ol-box "+a;this.Jp=this.vg=this.W=null}F(Yj,Vd);Yj.prototype.Ya=function(){this.ib(null)};Yj.prototype.Vn=function(){var a=this.vg,b=this.Jp,c=this.qd.style;c.left=Math.min(a[0],b[0])+"px";c.top=Math.min(a[1],b[1])+"px";c.width=Math.abs(b[0]-a[0])+"px";c.height=Math.abs(b[1]-a[1])+"px"};
Yj.prototype.ib=function(a){if(this.W){this.W.In.removeChild(this.qd);var b=this.qd.style;b.left=b.top=b.width=b.height="inherit"}(this.W=a)&&this.W.In.appendChild(this.qd)};function Zj(a){var b=a.vg,c=a.Jp,b=[b,[b[0],c[1]],c,[c[0],b[1]]].map(a.W.zc,a.W);b[4]=b[0].slice();a.mj?a.mj.zb([b]):a.mj=new qi([b])}Yj.prototype.j=function(){return this.mj};function ak(a){Nj.call(this,{bg:bk,Vh:ck,cg:dk});a=a?a:{};this.wm=new Yj(a.className||"ol-dragbox");this.NK=void 0!==a.MK?a.MK:64;this.vg=null;this.od=a.Xb?a.Xb:Ig;this.SF=a.RF?a.RF:ek}F(ak,Nj);function ek(a,b,c){a=c[0]-b[0];b=c[1]-b[1];return a*a+b*b>=this.NK}function ck(a){if(Lj(a)){var b=this.wm,c=a.Sc;b.vg=this.vg;b.Jp=c;Zj(b);b.Vn();this.dispatchEvent(new fk(gk,a.Qb))}}ak.prototype.j=function(){return this.wm.j()};ak.prototype.hC=Dd;
function dk(a){if(!Lj(a))return!0;this.wm.ib(null);this.SF(a,this.vg,a.Sc)&&(this.hC(a),this.dispatchEvent(new fk(hk,a.Qb)));return!1}function bk(a){if(Lj(a)&&Fj(a)&&this.od(a)){this.vg=a.Sc;this.wm.ib(a.map);var b=this.wm,c=this.vg;b.vg=this.vg;b.Jp=c;Zj(b);b.Vn();this.dispatchEvent(new fk(ik,a.Qb));return!0}return!1}var ik="boxstart",gk="boxdrag",hk="boxend";function fk(a,b){Wd.call(this,a);this.Qb=b}F(fk,Wd);function jk(a){a=a?a:{};var b=a.Xb?a.Xb:Jj;this.Yb=void 0!==a.duration?a.duration:200;this.IL=void 0!==a.nh?a.nh:!1;ak.call(this,{Xb:b,className:a.className||"ol-dragzoom"})}F(jk,ak);jk.prototype.hC=function(){var a=this.g(),b=E(a),c=a.$a(),d=this.j().V();if(this.IL){var e=Ei(b,c),d=[ij(a,[d[0],d[1]]),ij(a,[d[2],d[3]])],a=sg(void 0),f,g;f=0;for(g=d.length;f<g;++f)hg(a,d[f]);d=Gi(b,a,c);Gg(e,1/d);d=e}c=b.kc(Gi(b,d,c));e=Bg(d);e=b.Wf.Oa(e);b.animate({ra:c,Oa:e,duration:this.Yb,Wc:cg})};function kk(a){xj.call(this,{handleEvent:lk});a=a||{};this.zG=function(a){return Ij(a)&&Kj(a)};this.od=void 0!==a.Xb?a.Xb:this.zG;this.Yb=void 0!==a.duration?a.duration:100;this.VL=void 0!==a.UL?a.UL:128}F(kk,xj);
function lk(a){var b=!1;if("keydown"==a.type){var c=a.originalEvent.keyCode;if(this.od(a)&&(40==c||37==c||39==c||38==c)){var b=E(a.map),d=b.Fa()*this.VL,e=0,f=0;40==c?f=-d:37==c?e=-d:39==c?e=d:f=d;d=[e,f];Zf(d,b.Cb());c=this.Yb;if(e=b.Ka())d=b.Wf.Oa([e[0]+d[0],e[1]+d[1]]),c?b.animate({duration:c,Wc:eg,Oa:d}):b.tb(d);a.preventDefault();b=!0}}return!b};function mk(a){xj.call(this,{handleEvent:nk});a=a?a:{};this.od=a.Xb?a.Xb:Kj;this.Yf=a.ej?a.ej:1;this.Yb=void 0!==a.duration?a.duration:100}F(mk,xj);function nk(a){var b=!1;if("keydown"==a.type||"keypress"==a.type){var c=a.originalEvent.charCode;!this.od(a)||43!=c&&45!=c||(b=43==c?this.Yf:-this.Yf,c=E(a.map),zj(c,b,void 0,this.Yb),a.preventDefault(),b=!0)}return!b};function ok(a){xj.call(this,{handleEvent:pk});a=a||{};this.Yf=0;this.Yb=void 0!==a.duration?a.duration:250;this.Sw=void 0!==a.timeout?a.timeout:80;this.XO=void 0!==a.WO?a.WO:!0;this.Ht=a.kc||!1;this.ci=null;this.ec=this.Rw=this.am=void 0;this.$D=400;this.ps=void 0;this.BO=300;this.aE=1.5}F(ok,xj);
function pk(a){var b=a.type;if("wheel"!==b&&"mousewheel"!==b)return!0;a.preventDefault();var b=a.map,c=a.originalEvent;this.XO&&(this.ci=a.Qb);var d;"wheel"==a.type?(d=c.deltaY,ue&&c.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(d/=Ae),c.deltaMode===WheelEvent.DOM_DELTA_LINE&&(d*=40)):"mousewheel"==a.type&&(d=-c.wheelDeltaY,ve&&(d/=3));if(0===d)return!1;a=Date.now();void 0===this.am&&(this.am=a);if(!this.ec||a-this.am>this.$D)this.ec=4>Math.abs(d)?qk:rk;if(this.ec===qk){b=E(b);this.ps?clearTimeout(this.ps):
zi(b,1,1);this.ps=setTimeout(this.yG.bind(this),this.$D);var c=b.Fa()*Math.pow(2,d/this.BO),e=b.Uk(),f=b.Tk(),g=0;c<e?(c=Math.max(c,e/this.aE),g=1):c>f&&(c=Math.min(c,f*this.aE),g=-1);if(this.ci){var h=Bi(b,c,this.ci);b.tb(b.Wf.Oa(h))}Ki(b,c);0===g&&this.Ht&&b.animate({ra:b.kc(c,0<d?-1:1),Wc:cg,anchor:this.ci,duration:this.Yb});0<g?b.animate({ra:e,Wc:cg,anchor:this.ci,duration:500}):0>g&&b.animate({ra:f,Wc:cg,anchor:this.ci,duration:500});this.am=a;return!1}this.Yf+=d;d=Math.max(this.Sw-(a-this.am),
0);clearTimeout(this.Rw);this.Rw=setTimeout(this.yJ.bind(this,b),d);return!1}ok.prototype.yG=function(){this.ps=void 0;zi(E(this.g()),1,-1)};ok.prototype.yJ=function(a){a=E(a);0<a.Zd[0]&&Ai(a);zj(a,-Ef(this.Yf,-1,1),this.ci,this.Yb);this.ec=void 0;this.Yf=0;this.ci=null;this.Rw=this.am=void 0};var qk="trackpad",rk="wheel";function sk(a){Nj.call(this,{bg:tk,Vh:uk,cg:vk});a=a||{};this.Uc=null;this.ah=void 0;this.ao=!1;this.Nr=0;this.gO=void 0!==a.threshold?a.threshold:.3;this.Yb=void 0!==a.duration?a.duration:250}F(sk,Nj);
function uk(a){var b=0,c=this.vd[0],d=this.vd[1],c=Math.atan2(d.clientY-c.clientY,d.clientX-c.clientX);void 0!==this.ah&&(b=c-this.ah,this.Nr+=b,!this.ao&&Math.abs(this.Nr)>this.gO&&(this.ao=!0));this.ah=c;a=a.map;c=E(a);if(c.Wf.rotation!==Pf){var d=a.ac.getBoundingClientRect(),e=Pj(this.vd);e[0]-=d.left;e[1]-=d.top;this.Uc=a.zc(e);this.ao&&(d=c.Cb(),a.La(),yj(c,d+b,this.Uc))}}
function vk(a){if(2>this.vd.length){a=E(a.map);zi(a,1,-1);if(this.ao){var b=a.Cb(),c=this.Uc,d=this.Yb,b=a.tp(b,0);yj(a,b,c,d)}return!1}return!0}function tk(a){return 2<=this.vd.length?(a=a.map,this.Uc=null,this.ah=void 0,this.ao=!1,this.Nr=0,this.Yh||zi(E(a),1,1),!0):!1}sk.prototype.Uj=Jg;function wk(a){Nj.call(this,{bg:xk,Vh:yk,cg:zk});a=a?a:{};this.Ht=a.kc||!1;this.Uc=null;this.Yb=void 0!==a.duration?a.duration:400;this.Eq=void 0;this.fv=1}F(wk,Nj);
function yk(a){var b=1,c=this.vd[0],d=this.vd[1],e=c.clientX-d.clientX,c=c.clientY-d.clientY,e=Math.sqrt(e*e+c*c);void 0!==this.Eq&&(b=this.Eq/e);this.Eq=e;a=a.map;var e=E(a),d=e.Fa(),f=e.Tk(),g=e.Uk(),c=d*b;c>f?(b=f/d,c=f):c<g&&(b=g/d,c=g);1!=b&&(this.fv=b);b=a.ac.getBoundingClientRect();d=Pj(this.vd);d[0]-=b.left;d[1]-=b.top;this.Uc=a.zc(d);a.La();Aj(e,c,this.Uc)}
function zk(a){if(2>this.vd.length){a=E(a.map);zi(a,1,-1);var b=a.Fa();if(this.Ht||b<a.Uk()||b>a.Tk()){var c=this.Uc,d=this.Yb,b=a.kc(b,0,this.fv-1);Aj(a,b,c,d)}return!1}return!0}function xk(a){return 2<=this.vd.length?(a=a.map,this.Uc=null,this.Eq=void 0,this.fv=1,this.Yh||zi(E(a),1,1),!0):!1}wk.prototype.Uj=Jg;function Ak(){var a={},b=new he,c=new vj(-.005,.05,100);(void 0!==a.mF?a.mF:1)&&b.push(new Uj);(void 0!==a.YG?a.YG:1)&&b.push(new Bj({ej:a.kP,duration:a.Ts}));(void 0!==a.ZG?a.ZG:1)&&b.push(new Qj({RJ:c}));(void 0!==a.RL?a.RL:1)&&b.push(new sk);(void 0!==a.TL?a.TL:1)&&b.push(new wk({kc:a.kc,duration:a.Ts}));if(void 0!==a.keyboard?a.keyboard:1)b.push(new kk),b.push(new mk({ej:a.kP,duration:a.Ts}));(void 0!==a.XK?a.XK:1)&&b.push(new ok({kc:a.kc,duration:a.Ts}));(void 0!==a.AN?a.AN:1)&&b.push(new jk({duration:a.Ts}));
return b};function Bk(a,b,c,d){Yd.call(this);this.aa=a;this.og=c;this.ra=b;this.state=d}F(Bk,Yd);Bk.prototype.L=function(){this.dispatchEvent("change")};Bk.prototype.V=function(){return this.aa};Bk.prototype.Fa=function(){return this.ra};Bk.prototype.ab=function(){return this.state};function Ck(a,b,c,d,e){this.un=void 0!==e?e:null;Bk.call(this,a,b,c,void 0!==e?0:2);this.qa=d;this.Jz=null}F(Ck,Bk);Ck.prototype.getError=function(){return this.Jz};Ck.prototype.cJ=function(a){a?(this.Jz=a,this.state=3):this.state=2;this.L()};Ck.prototype.load=function(){0==this.state&&(this.state=1,this.L(),this.un(this.cJ.bind(this)))};Ck.prototype.na=function(){return this.qa};function Dk(a,b,c,d){Wd.call(this,a);this.wf=c;this.context=d}F(Dk,Wd);function Ek(a){Yd.call(this);this.highWaterMark=void 0!==a?a:2048;this.Fk=0;this.Me={};this.td=this.ed=null}F(Ek,Yd);l=Ek.prototype;l.Ih=function(){return this.Qk()>this.highWaterMark};l.clear=function(){this.Fk=0;this.Me={};this.td=this.ed=null;this.dispatchEvent("clear")};function Fk(a,b){return a.Me.hasOwnProperty(b)}l.forEach=function(a,b){for(var c=this.ed;c;)a.call(b,c.Ji,c.$g,this),c=c.sd};
l.get=function(a){a=this.Me[a];yf(void 0!==a,15);if(a===this.td)return a.Ji;a===this.ed?(this.ed=this.ed.sd,this.ed.We=null):(a.sd.We=a.We,a.We.sd=a.sd);a.sd=null;a.We=this.td;this.td=this.td.sd=a;return a.Ji};l.remove=function(a){var b=this.Me[a];yf(void 0!==b,15);if(b===this.td){if(this.td=b.We)this.td.sd=null}else if(b===this.ed){if(this.ed=b.sd)this.ed.We=null}else b.sd.We=b.We,b.We.sd=b.sd;delete this.Me[a];--this.Fk;return b.Ji};l.Qk=function(){return this.Fk};
l.cq=function(){var a=Array(this.Fk),b=0,c;for(c=this.td;c;c=c.We)a[b++]=c.$g;return a};l.pop=function(){var a=this.ed;delete this.Me[a.$g];a.sd&&(a.sd.We=null);this.ed=a.sd;this.ed||(this.td=null);--this.Fk;return a.Ji};l.replace=function(a,b){this.get(a);this.Me[a].Ji=b};l.set=function(a,b){yf(!(a in this.Me),16);b={$g:a,sd:null,We:this.td,Ji:b};this.td?this.td.sd=b:this.ed=b;this.td=b;this.Me[a]=b;++this.Fk};var Gk=[0,0,0,1],Hk=[],Ik=[0,0,0,1],Jk=[0,0,0,0],Kk=new Ek,Lk={},Mk=null,Nk={},Pk=function(){function a(a){var b=Ok();b.font="32px monospace";f=b.measureText("wmytzilWMYTZIL@#/&?$%10").width;var c=!0;"monospace"!=a&&(b.font="32px "+a+",monospace",c=b.measureText("wmytzilWMYTZIL@#/&?$%10").width!=f);return c}function b(){var b=!0,f;for(f in c)60>c[f]&&(a(f)?(c[f]=60,Hd(Nk),Mk=null,d.clear()):(++c[f],b=!1));b&&(window.clearInterval(e),e=void 0)}var c=Lk,d=Kk,e,f;return function(d){if(d=nj(d))for(var f=
0,g=d.length;f<g;++f){var m=d[f];m in c||(c[m]=60,a(m)||(c[m]=0,void 0===e&&(e=window.setInterval(b,32))))}}}();function Ok(){var a=Mk;a||(a=Mk=Li(1,1));return a}
var Qk=function(){var a;return function(b){var c=Nk[b];void 0==c&&(a||(a=document.createElement("span"),a.textContent="M",a.style.margin=a.style.padding="0 !important",a.style.position="absolute !important",a.style.left="-99999px !important"),a.style.font=b,document.body.appendChild(a),c=Nk[b]=a.offsetHeight,document.body.removeChild(a));return c}}();function Rk(a,b){var c=Ok();a!=c.font&&(c.font=a);return c.measureText(b).width}
function Sk(a,b,c,d){0!==b&&(a.translate(c,d),a.rotate(b),a.translate(-c,-d))}var Tk=wh();function Uk(a,b,c,d,e,f,g,h,k,m,p){var t;1!=c&&(t=a.globalAlpha,a.globalAlpha=t*c);b&&a.setTransform.apply(a,b);a.drawImage(d,e,f,g,h,k,m,g*p,h*p);t&&(a.globalAlpha=t);b&&a.setTransform.apply(a,Tk)};var Vk=/^#(?:[0-9a-f]{3,4}){1,2}$/i,Wk=/^([a-z]*)$/i;function Xk(a){return Array.isArray(a)?a:Yk(a)}function Zk(a){if("string"!==typeof a){var b=a[0];b!=(b|0)&&(b=b+.5|0);var c=a[1];c!=(c|0)&&(c=c+.5|0);var d=a[2];d!=(d|0)&&(d=d+.5|0);a="rgba("+b+","+c+","+d+","+(void 0===a[3]?1:a[3])+")"}return a}
var Yk=function(){var a={},b=0;return function(c){var d;if(a.hasOwnProperty(c))d=a[c];else{if(1024<=b){d=0;for(var e in a)0===(d++&3)&&(delete a[e],--b)}d=c;var f,g,h;Wk.exec(d)&&(e=document.createElement("div"),e.style.color=d,document.body.appendChild(e),d=getComputedStyle(e).color,document.body.removeChild(e));if(Vk.exec(d)){e=d.length-1;h=4>=e?1:2;var k=4===e||8===e;e=parseInt(d.substr(1+0*h,h),16);f=parseInt(d.substr(1+1*h,h),16);g=parseInt(d.substr(1+2*h,h),16);d=k?parseInt(d.substr(1+3*h,h),
16):255;1==h&&(e=(e<<4)+e,f=(f<<4)+f,g=(g<<4)+g,k&&(d=(d<<4)+d));h=[e,f,g,d/255]}else 0==d.indexOf("rgba(")?(d=d.slice(5,-1).split(",").map(Number),h=$k(d)):0==d.indexOf("rgb(")?(d=d.slice(4,-1).split(",").map(Number),d.push(1),h=$k(d)):yf(!1,14);d=h;a[c]=d;++b}return d}}();function $k(a){var b=[];b[0]=Ef(a[0]+.5|0,0,255);b[1]=Ef(a[1]+.5|0,0,255);b[2]=Ef(a[2]+.5|0,0,255);b[3]=Ef(a[3],0,1);return b};function al(a){return"string"===typeof a||a instanceof CanvasPattern||a instanceof CanvasGradient?a:Zk(a)};function bl(){}l=bl.prototype;l.xz=function(){};l.le=function(){};l.Gm=function(){};l.Xt=function(){};l.Yt=function(){};l.Zt=function(){};l.$t=function(){};l.Nh=function(){};l.Hm=function(){};l.Pg=function(){};l.df=function(){};l.Rr=function(){};l.uh=function(){};function cl(a){Zd.call(this);this.Mq=a}F(cl,Zd);cl.prototype.yc=Dd;cl.prototype.It=function(a,b,c){return function(d,e){return dl(a,b,d,e,function(a){c[d]||(c[d]={});c[d][a.Nb.toString()]=a})}};cl.prototype.Kb=function(){return this.Mq};cl.prototype.WI=function(a){2===a.target.ab()&&el(this)};function fl(a,b){var c=b.ab();2!=c&&3!=c&&J(b,"change",a.WI,a);0==c&&(b.load(),c=b.ab());return 2==c}function el(a){var b=a.Kb();b.getVisible()&&"ready"==b.Eu()&&a.L()}
function gl(a,b){b.Ih()&&(b=function(a,b,e){b=I(a).toString();b in e.Bs&&a.Lk(e.Ma.pa,e.Bs[b])}.bind(null,b),a.qg.push(b))}function hl(a,b){b=b.pB;void 0!==b&&("string"===typeof b?a.ml[b]="":b&&(yf("string"==typeof b.href,44),yf("string"==typeof b.src,45),a.ml[b.src]=b.href))}function il(a,b,c,d){b=I(b).toString();c=c.toString();b in a?c in a[b]?a[b][c].extend(d):a[b][c]=d:(a[b]={},a[b][c]=d)}
function jl(a,b,c,d,e,f,g,h,k,m){var p=I(b).toString();p in a.Ko||(a.Ko[p]={});var t=a.Ko[p];a=a.kO;var u,w,x,z,D,H;for(H=c.xu();H<=g;++H)for(w=kl(c,f,H,w),x=c.Fa(H),z=w.Wa;z<=w.lb;++z)for(D=w.Sa;D<=w.bb;++D)g-H<=h?(u=ll(b,H,z,D,d,e),0==u.ab()&&(t[u.getKey()]=!0,u.getKey()in a.Ij||a.enqueue([u,p,ml(c,u.Nb),x])),void 0!==k&&k.call(m,u)):b.pE(H,z,D,e)};function nl(a){cl.call(this,a);this.qe=wh()}F(nl,cl);nl.prototype.clip=function(a,b,c){var d=b.mb,e=b.size[0]*d,f=b.size[1]*d,g=b.Ma.rotation,h=Fg(c),k=[c[2],c[3]],m=[c[2],c[1]];c=[c[0],c[1]];Bh(b.Ek,h);Bh(b.Ek,k);Bh(b.Ek,m);Bh(b.Ek,c);a.save();Sk(a,-g,e/2,f/2);a.beginPath();a.moveTo(h[0]*d,h[1]*d);a.lineTo(k[0]*d,k[1]*d);a.lineTo(m[0]*d,m[1]*d);a.lineTo(c[0]*d,c[1]*d);a.clip();Sk(a,g,e/2,f/2)};
nl.prototype.se=function(a,b,c,d){var e=this.Kb();if(e.hasListener(a)){var f=c.size[0]*c.mb,g=c.size[1]*c.mb,h=c.Ma.rotation;Sk(b,-h,f/2,g/2);void 0!==d||this.Th(c,0);e.dispatchEvent(new Dk(a,0,c,b));Sk(b,h,f/2,g/2)}};nl.prototype.xr=function(a,b,c,d){this.se("postcompose",a,b,d)};nl.prototype.Th=function(a,b){var c=a.Ma,d=a.mb,e=d/c.ra;return Lh(this.qe,d*a.size[0]/2,d*a.size[1]/2,e,-e,-c.rotation,-c.Oa[0]+b,-c.Oa[1])};function pl(a){nl.call(this,a);this.cz=wh()}F(pl,nl);pl.prototype.Dk=function(a,b,c){this.se("precompose",c,a,void 0);var d=this.na();if(d){var e=b.aa,f=void 0!==e&&!qg(e,a.aa)&&Eg(e,a.aa);f&&this.clip(c,a,e);var e=this.wq,g=c.globalAlpha;c.globalAlpha=b.opacity;c.drawImage(d,0,0,+d.width,+d.height,Math.round(e[4]),Math.round(e[5]),Math.round(d.width*e[0]),Math.round(d.height*e[3]));c.globalAlpha=g;f&&c.restore()}this.xr(c,a,b)};
pl.prototype.yc=function(a,b,c,d,e){var f=this.Kb();return f.s().yc(a,b.Ma.ra,b.Ma.rotation,c,b.Xl,function(a){return d.call(e,a,f)})};function ql(a){pl.call(this,a);this.la=null;this.wq=wh();this.xD=[];this.Es=null}F(ql,pl);ql.handles=function(a,b){return"canvas"===a&&("IMAGE"===b.F()||"VECTOR"===b.F()&&"image"===b.Un)};ql.create=function(a,b){var c=new ql(b);if("VECTOR"===b.F())for(var d=0,e=Ti.length;d<e;++d){var f=Ti[d];f!==ql&&f.handles("canvas",b)&&(f=f.create(a,b),c.Es=f)}return c};ql.prototype.na=function(){return this.la?this.la.na():null};
ql.prototype.rg=function(a,b){var c=a.mb,d=a.size,e=a.Ma,f=e.Oa,g=e.ra,h=this.Kb().s(),k=a.Of,m=a.aa;void 0!==b.aa&&(m=Dg(m,b.aa));if(!k[0]&&!k[1]&&!yg(m))if(k=e.pa,e=this.Es){var k=e.context,p=Gd({},a,{size:[zg(m)/g,Ag(m)/g],Ma:Gd({},a.Ma,{rotation:0})}),t=Object.keys(p.Xl).sort();!e.rg(p,b)||!e.kw&&df(t,this.xD)||(k.canvas.width=p.size[0]*c,k.canvas.height=p.size[1]*c,e.Dk(p,b,k),this.la=new Ck(m,g,c,k.canvas),this.xD=t)}else(e=h.na(m,g,c,k))&&fl(this,e)&&(this.la=e);this.la&&(e=this.la,m=e.V(),
b=e.Fa(),e=e.og,k=c*b/(g*e),m=Lh(this.wq,c*d[0]/2,c*d[1]/2,k,k,0,e*(m[0]-f[0])/b,e*(f[1]-m[3])/b),Lh(this.cz,c*d[0]/2-m[4],c*d[1]/2-m[5],c/g,-c/g,0,-f[0],-f[1]),hl(a,h),this.Hl=b*c/e);return!!this.la};ql.prototype.yc=function(a,b,c,d,e){return this.Es?this.Es.yc(a,b,c,d,e):pl.prototype.yc.call(this,a,b,c,d,e)};function rl(){this.aj={};this.kp=0;this.BB=32}rl.prototype.clear=function(){this.aj={};this.kp=0};function sl(a){if(a.kp>a.BB){var b=0,c,d;for(c in a.aj)d=a.aj[c],0!==(b++&3)||d.hasListener()||(delete a.aj[c],--a.kp)}}rl.prototype.get=function(a,b,c){a=b+":"+a+":"+(c?Zk(c):"null");return a in this.aj?this.aj[a]:null};rl.prototype.set=function(a,b,c,d){this.aj[b+":"+a+":"+(c?Zk(c):"null")]=d;++this.kp};rl.prototype.Sl=function(a){this.BB=a;sl(this)};var tl=new rl;function ul(a,b){this.W=b;this.bh={};this.gv={}}F(ul,Vd);function vl(a){var b=a.Ma,c=a.Ek,d=a.nC;Lh(c,a.size[0]/2,a.size[1]/2,1/b.ra,-1/b.ra,-b.rotation,-b.Oa[0],-b.Oa[1]);a=Ah(d,c);b=a[0]*a[3]-a[1]*a[2];yf(0!==b,32);var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5];a[0]=f/b;a[1]=-d/b;a[2]=-e/b;a[3]=c/b;a[4]=(e*h-f*g)/b;a[5]=-(c*h-d*g)/b}function wl(){sl(tl)}l=ul.prototype;
l.yc=function(a,b,c,d,e,f,g){function h(a,c){var f=I(a).toString(),g=b.Lq[I(c)].Uq;if(!(f in b.Xl)||g)return d.call(e,a,g?c:null)}var k,m=b.Ma,p=m.ra,t=m.pa,m=a;if(t.bj){var t=t.V(),u=zg(t),w=a[0];if(w<t[0]||w>t[2])m=[w+u*Math.ceil((t[0]-w)/u),a[1]]}t=b.hl;for(u=t.length-1;0<=u;--u){var x=t[u],w=x.layer;if(pj(x,p)&&f.call(g,w)&&(x=xl(this,w),w.s()&&(k=x.yc(w.s().Js?m:a,b,c,h,e)),k))return k}};
function xl(a,b){var c=I(b).toString();if(c in a.bh)return a.bh[c];for(var d,e=a.F(),f=0,g=Ti.length;f<g;++f){var h=Ti[f];if(h.handles(e,b)){d=h.create(a,b);break}}if(d)a.bh[c]=d,a.gv[c]=J(d,"change",a.ZI,a);else throw Error("Unable to create renderer for layer: "+b.F());return d}l.g=function(){return this.W};l.ZI=function(){this.W.La()};function kj(a,b){var c=a.bh[b];delete a.bh[b];Ld(a.gv[b]);delete a.gv[b];return c}l.fw=Dd;l.GM=function(a,b){for(var c in this.bh)b&&c in b.Lq||kj(this,c).ue()};
function yl(a,b){for(var c in a.bh)if(!(c in b.Lq)){b.qg.push(a.GM.bind(a));break}}function ff(a,b){return a.zIndex-b.zIndex};function zl(a,b){ul.call(this,0,b);this.Mg=Li();this.qa=this.Mg.canvas;this.qa.style.width="100%";this.qa.style.height="100%";this.qa.style.display="block";this.qa.className="ol-unselectable";a.insertBefore(this.qa,a.childNodes[0]||null);this.Mc=!0;this.qe=wh()}F(zl,ul);zl.handles=function(a){return"canvas"===a};zl.create=function(a,b){return new zl(a,b)};zl.prototype.se=function(a,b){var c=this.g(),d=this.Mg;c.hasListener(a)&&(this.Th(b),c.dispatchEvent(new Dk(a,0,b,d)))};
zl.prototype.Th=function(a){var b=a.Ma;a=a.mb/b.ra;return Lh(this.qe,this.qa.width/2,this.qa.height/2,a,-a,-b.rotation,-b.Oa[0],-b.Oa[1])};zl.prototype.F=function(){return"canvas"};
zl.prototype.fw=function(a){if(a){var b=this.Mg,c=a.mb,d=Math.round(a.size[0]*c),e=Math.round(a.size[1]*c);this.qa.width!=d||this.qa.height!=e?(this.qa.width=d,this.qa.height=e):b.clearRect(0,0,d,e);c=a.Ma.rotation;vl(a);this.se("precompose",a);var f=a.hl;ef(f);c&&(b.save(),Sk(b,c,d/2,e/2));var d=a.Ma.ra,g,h,k,e=0;for(g=f.length;e<g;++e)k=f[e],h=k.layer,h=xl(this,h),pj(k,d)&&"ready"==k.AD&&h.rg(a,k)&&h.Dk(a,k,b);c&&b.restore();this.se("postcompose",a);this.Mc||(this.qa.style.display="",this.Mc=!0);
yl(this,a);a.qg.push(wl)}else this.Mc&&(this.qa.style.display="none",this.Mc=!1)};function Al(a,b,c,d){this.Wa=a;this.lb=b;this.Sa=c;this.bb=d}function Bl(a,b,c,d,e){return void 0!==e?(e.Wa=a,e.lb=b,e.Sa=c,e.bb=d,e):new Al(a,b,c,d)}l=Al.prototype;l.contains=function(a){return this.Xf(a[1],a[2])};l.Xf=function(a,b){return this.Wa<=a&&a<=this.lb&&this.Sa<=b&&b<=this.bb};l.equals=function(a){return this.Wa==a.Wa&&this.Sa==a.Sa&&this.lb==a.lb&&this.bb==a.bb};
l.extend=function(a){a.Wa<this.Wa&&(this.Wa=a.Wa);a.lb>this.lb&&(this.lb=a.lb);a.Sa<this.Sa&&(this.Sa=a.Sa);a.bb>this.bb&&(this.bb=a.bb)};l.$a=function(){return[this.Qc(),this.bb-this.Sa+1]};l.Qc=function(){return this.lb-this.Wa+1};function Cl(a){pl.call(this,a);this.context=null===this.context?null:Li();this.De=null;this.Nj=[];this.VD=gg();this.mO=new Al(0,0,0,0);this.wq=wh();this.OE=0}F(Cl,pl);Cl.handles=function(a,b){return"canvas"===a&&"TILE"===b.F()};Cl.create=function(a,b){return new Cl(b)};function Dl(a,b){b=b.ab();a=El(a.Kb());return 2==b||4==b||3==b&&!a}
Cl.prototype.rg=function(a,b){var c=a.mb,d=a.size,e=a.Ma,f=e.pa,g=e.ra,e=e.Oa,h=this.Kb(),k=h.s(),m=k.Xa,p=k.Pe(f),t=Fl(p,g,this.OE),u=p.Fa(t),w=Math.round(g/u)||1,x=a.aa;void 0!==b.aa&&(x=Dg(x,b.aa));if(yg(x))return!1;var z=kl(p,x,t),D=Gl(p,t,z),H=k.cn(c),G={};G[t]={};var L=this.It(k,f,G),N=this.VD,T=this.mO,U=!1,K,X,ma;for(X=z.Wa;X<=z.lb;++X)for(ma=z.Sa;ma<=z.bb;++ma){K=ll(k,t,X,ma,c,f);3==K.ab()&&(El(h)?0<h.get("preload")&&(U=!0):K.Tr(2));Dl(this,K)||(K=Hl(K));if(Dl(this,K)){var fa=I(this);if(2==
K.ab()){G[t][K.Nb.toString()]=K;var ya=K.Ao?-1!==K.qs[fa]:!1;U||!ya&&-1!==this.Nj.indexOf(K)||(U=!0)}if(1===Il(K,fa,a.time))continue}fa=Jl(p,K.Nb,T,N);ya=!1;fa&&(ya=L(t+1,fa));ya||Kl(p,K.Nb,L,T,N)}K=a.Of;K=K[0]||K[1];if(!(this.Hl&&16<Date.now()-a.time&&K||!U&&this.De&&qg(this.De,x)&&this.hw==m&&w==this.mC&&(K||u*c/H*w==this.Hl))){if(K=this.context)ma=Ll(k,t,c,f),X=Math.round(z.Qc()*ma[0]/w),ma=Math.round((z.bb-z.Sa+1)*ma[1]/w),U=K.canvas,U.width!=X||U.height!=ma?(this.mC=w,U.width=X,U.height=ma):
(this.De&&!ug(D,this.De)&&K.clearRect(0,0,X,ma),w=this.mC);this.Nj.length=0;U=Object.keys(G).map(Number);U.sort(function(a,b){return a===t?1:b===t?-1:a>b?1:a<b?-1:0});for(var Ca,da,qb,Rd,Sd,fa=0,ya=U.length;fa<ya;++fa){T=U[fa];L=Ll(k,T,c,f);K=p.Fa(T);Ca=K/u;da=H*k.qu(f);qb=G[T];for(var Eh in qb)K=qb[Eh],ma=Ml(p,K.Nb,N),X=(ma[0]-D[0])/u*H/w,ma=(D[3]-ma[3])/u*H/w,Rd=L[0]*Ca/w,Sd=L[1]*Ca/w,this.bu(K,a,b,X,ma,Rd,Sd,da,t===T),this.Nj.push(K)}this.hw=m;this.Hl=u*c/H*w;this.De=D}b=this.Hl/g;b=Lh(this.wq,
c*d[0]/2,c*d[1]/2,b,b,0,(this.De[0]-e[0])/this.Hl*c,(e[1]-this.De[3])/this.Hl*c);Lh(this.cz,c*d[0]/2-b[4],c*d[1]/2-b[5],c/g,-c/g,0,-e[0],-e[1]);il(a.Bs,k,t,z);jl(a,k,p,c,f,x,t,h.get("preload"));gl(a,k);hl(a,k);return 0<this.Nj.length};
Cl.prototype.bu=function(a,b,c,d,e,f,g,h,k){if(c=a.na(this.Kb())){var m=I(this),p=k?Il(a,m,b.time):1;1!==p||this.Kb().s().yu(b.Ma.pa)||this.context.clearRect(d,e,f,g);var t=p!==this.context.globalAlpha;t&&(this.context.save(),this.context.globalAlpha=p);this.context.drawImage(c,h,h,c.width-2*h,c.height-2*h,d,e,f,g);t&&this.context.restore();1!==p?b.animate=!0:k&&a.Ao&&(a.qs[m]=-1)}};Cl.prototype.na=function(){var a=this.context;return a?a.canvas:null};var Nl={Jj:function(){}};
(function(){(function(a){function b(a,e,f,g,h){f=f||0;g=g||a.length-1;for(h=h||d;g>f;){if(600<g-f){var k=g-f+1,m=e-f+1,p=Math.log(k),t=.5*Math.exp(2*p/3),p=.5*Math.sqrt(p*t*(k-t)/k)*(0>m-k/2?-1:1);b(a,e,Math.max(f,Math.floor(e-m*t/k+p)),Math.min(g,Math.floor(e+(k-m)*t/k+p)),h)}k=a[e];m=f;t=g;c(a,f,e);for(0<h(a[g],k)&&c(a,f,g);m<t;){c(a,m,t);m++;for(t--;0>h(a[m],k);)m++;for(;0<h(a[t],k);)t--}0===h(a[f],k)?c(a,f,t):(t++,c(a,t,g));t<=e&&(f=t+1);e<=t&&(g=t-1)}}function c(a,b,c){var d=a[b];a[b]=a[c];a[c]=
d}function d(a,b){return a<b?-1:a>b?1:0}function e(a,b){if(!(this instanceof e))return new e(a,b);this.Zs=Math.max(4,a||9);this.Ix=Math.max(2,Math.ceil(.4*this.Zs));b&&this.aF(b);this.clear()}function f(a,b){g(a,0,a.children.length,b,a)}function g(a,b,c,d,e){e||(e=x(null));e.Wa=Infinity;e.Sa=Infinity;e.lb=-Infinity;e.bb=-Infinity;for(var f;b<c;b++)f=a.children[b],h(e,a.bd?d(f):f);return e}function h(a,b){a.Wa=Math.min(a.Wa,b.Wa);a.Sa=Math.min(a.Sa,b.Sa);a.lb=Math.max(a.lb,b.lb);a.bb=Math.max(a.bb,
b.bb)}function k(a,b){return a.Wa-b.Wa}function m(a,b){return a.Sa-b.Sa}function p(a){return(a.lb-a.Wa)*(a.bb-a.Sa)}function t(a){return a.lb-a.Wa+(a.bb-a.Sa)}function u(a,b){return a.Wa<=b.Wa&&a.Sa<=b.Sa&&b.lb<=a.lb&&b.bb<=a.bb}function w(a,b){return b.Wa<=a.lb&&b.Sa<=a.bb&&b.lb>=a.Wa&&b.bb>=a.Sa}function x(a){return{children:a,height:1,bd:!0,Wa:Infinity,Sa:Infinity,lb:-Infinity,bb:-Infinity}}function z(a,b,c,d,e){for(var f=[b,c],g;f.length;)c=f.pop(),b=f.pop(),c-b<=d||(g=b+Math.ceil((c-b)/d/2)*
d,D(a,g,b,c,e),f.push(b,g,g,c))}var D=b;e.prototype={all:function(){return this.Ex(this.data,[])},search:function(a){var b=this.data,c=[],d=this.pe;if(!w(a,b))return c;for(var e=[],f,g,h,k;b;){f=0;for(g=b.children.length;f<g;f++)h=b.children[f],k=b.bd?d(h):h,w(a,k)&&(b.bd?c.push(h):u(a,k)?this.Ex(h,c):e.push(h));b=e.pop()}return c},fG:function(a){var b=this.data,c=this.pe;if(!w(a,b))return!1;for(var d=[],e,f,g,h;b;){e=0;for(f=b.children.length;e<f;e++)if(g=b.children[e],h=b.bd?c(g):g,w(a,h)){if(b.bd||
u(a,h))return!0;d.push(g)}b=d.pop()}return!1},load:function(a){if(!a||!a.length)return this;if(a.length<this.Ix){for(var b=0,c=a.length;b<c;b++)this.Lb(a[b]);return this}a=this.Gx(a.slice(),0,a.length-1,0);this.data.children.length?this.data.height===a.height?this.Jx(this.data,a):(this.data.height<a.height&&(b=this.data,this.data=a,a=b),this.Hx(a,this.data.height-a.height-1,!0)):this.data=a;return this},Lb:function(a){a&&this.Hx(a,this.data.height-1);return this},clear:function(){this.data=x([]);
return this},remove:function(a,b){if(!a)return this;for(var c=this.data,d=this.pe(a),e=[],f=[],g,h,k,m;c||e.length;){c||(c=e.pop(),h=e[e.length-1],g=f.pop(),m=!0);if(c.bd){a:{k=a;var p=c.children,t=b;if(t){for(var w=0;w<p.length;w++)if(t(k,p[w])){k=w;break a}k=-1}else k=p.indexOf(k)}if(-1!==k){c.children.splice(k,1);e.push(c);this.$E(e);break}}m||c.bd||!u(c,d)?h?(g++,c=h.children[g],m=!1):c=null:(e.push(c),f.push(g),g=0,h=c,c=c.children[0])}return this},pe:function(a){return a},Et:k,Ft:m,toJSON:function(){return this.data},
Ex:function(a,b){for(var c=[];a;)a.bd?b.push.apply(b,a.children):c.push.apply(c,a.children),a=c.pop();return b},Gx:function(a,b,c,d){var e=c-b+1,g=this.Zs,h;if(e<=g)return h=x(a.slice(b,c+1)),f(h,this.pe),h;d||(d=Math.ceil(Math.log(e)/Math.log(g)),g=Math.ceil(e/Math.pow(g,d-1)));h=x([]);h.bd=!1;h.height=d;var e=Math.ceil(e/g),g=e*Math.ceil(Math.sqrt(g)),k,m,p;for(z(a,b,c,g,this.Et);b<=c;b+=g)for(m=Math.min(b+g-1,c),z(a,b,m,e,this.Ft),k=b;k<=m;k+=e)p=Math.min(k+e-1,m),h.children.push(this.Gx(a,k,p,
d-1));f(h,this.pe);return h},ZE:function(a,b,c,d){for(var e,f,g,h,k,m,t,u;;){d.push(b);if(b.bd||d.length-1===c)break;t=u=Infinity;e=0;for(f=b.children.length;e<f;e++)g=b.children[e],k=p(g),m=(Math.max(g.lb,a.lb)-Math.min(g.Wa,a.Wa))*(Math.max(g.bb,a.bb)-Math.min(g.Sa,a.Sa))-k,m<u?(u=m,t=k<t?k:t,h=g):m===u&&k<t&&(t=k,h=g);b=h||b.children[0]}return b},Hx:function(a,b,c){var d=this.pe;c=c?a:d(a);var d=[],e=this.ZE(c,this.data,b,d);e.children.push(a);for(h(e,c);0<=b;)if(d[b].children.length>this.Zs)this.bF(d,
b),b--;else break;this.WE(c,d,b)},bF:function(a,b){var c=a[b],d=c.children.length,e=this.Ix;this.XE(c,e,d);d=this.YE(c,e,d);d=x(c.children.splice(d,c.children.length-d));d.height=c.height;d.bd=c.bd;f(c,this.pe);f(d,this.pe);b?a[b-1].children.push(d):this.Jx(c,d)},Jx:function(a,b){this.data=x([a,b]);this.data.height=a.height+1;this.data.bd=!1;f(this.data,this.pe)},YE:function(a,b,c){var d,e,f,h,k,m,t;k=m=Infinity;for(d=b;d<=c-b;d++)e=g(a,0,d,this.pe),f=g(a,d,c,this.pe),h=Math.max(0,Math.min(e.lb,f.lb)-
Math.max(e.Wa,f.Wa))*Math.max(0,Math.min(e.bb,f.bb)-Math.max(e.Sa,f.Sa)),e=p(e)+p(f),h<k?(k=h,t=d,m=e<m?e:m):h===k&&e<m&&(m=e,t=d);return t},XE:function(a,b,c){var d=a.bd?this.Et:k,e=a.bd?this.Ft:m,f=this.Fx(a,b,c,d);b=this.Fx(a,b,c,e);f<b&&a.children.sort(d)},Fx:function(a,b,c,d){a.children.sort(d);d=this.pe;var e=g(a,0,b,d),f=g(a,c-b,c,d),k=t(e)+t(f),m,p;for(m=b;m<c-b;m++)p=a.children[m],h(e,a.bd?d(p):p),k+=t(e);for(m=c-b-1;m>=b;m--)p=a.children[m],h(f,a.bd?d(p):p),k+=t(f);return k},WE:function(a,
b,c){for(;0<=c;c--)h(b[c],a)},$E:function(a){for(var b=a.length-1,c;0<=b;b--)0===a[b].children.length?0<b?(c=a[b-1].children,c.splice(c.indexOf(a[b]),1)):this.clear():f(a[b],this.pe)},aF:function(a){var b=["return a"," - b",";"];this.Et=new Function("a","b",b.join(a[0]));this.Ft=new Function("a","b",b.join(a[1]));this.pe=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")}};a["default"]=e})(this.Jj=this.Jj||{})}).call(Nl);Nl.Jj=Nl.Jj.default;function Ol(){};function Pl(a,b,c,d){var e=a[b],f=a[b+1],g=0;for(b+=d;b<c;b+=d)var h=a[b],k=a[b+1],g=g+Math.sqrt((h-e)*(h-e)+(k-f)*(k-f)),e=h,f=k;return g};var Ql="Polygon Circle LineString Image Text Default".split(" "),Rl={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};function Sl(a,b,c,d,e,f){this.jz=f;this.Tw=gg();this.YD=a;this.$q=b;this.Mv=e;this.mb=d;this.br=0;this.ra=c;this.Ak=this.ip=this.hp=null;this.Mb=[];this.coordinates=[];this.kG={};this.iw=wh();this.Eb=[];this.Ln=null;this.state={};this.Hs=0;this.lO=wh()}F(Sl,bl);function Tl(a,b,c,d,e,f,g,h){b.beginPath();b.moveTo.apply(b,c);b.lineTo.apply(b,d);b.lineTo.apply(b,e);b.lineTo.apply(b,f);b.lineTo.apply(b,c);g&&(a.Pp=g[2],a.ua(b));h&&(a.ug(b,h),b.stroke())}
function Ul(a,b,c,d,e,f,g,h,k,m,p,t,u,w,x,z,D,H,G){var L=H||G,N=a.lO;f*=w;g*=w;c-=f;d-=g;x&&(c=Math.round(c),d=Math.round(d));x=z+p>e.width?e.width-p:z;k=k+t>e.height?e.height-t:k;z=a.Tw;var T=D[3]+x*w+D[1],U=D[0]+k*w+D[2],K=c-D[3],X=d-D[0],ma,fa,ya,Ca;if(L||0!==u)ma=[K,X],fa=[K+T,X],ya=[K+T,X+U],Ca=[K,X+U];D=null;0!==u?(f=c+f,g=d+g,D=Lh(N,f,g,1,1,u,-f,-g),sg(z),hg(z,Bh(N,ma)),hg(z,Bh(N,fa)),hg(z,Bh(N,ya)),hg(z,Bh(N,Ca))):rg(K,X,K+T,X+U,z);u=b.canvas;u=z[0]<=u.width&&0<=z[2]&&z[1]<=u.height&&0<=z[3];
if(h){if(u||1!=h[4])vg(h,z),(a=u?[b,D?D.slice(0):null,m,e,p,t,x,k,c,d,w]:null)&&L&&a.push(H,G,ma,fa,ya,Ca),h.push(a)}else u&&(L&&Tl(a,b,ma,fa,ya,Ca,H,G),Uk(b,D,m,e,p,t,x,k,c,d,w))}function Vl(a,b){var c=a.mb;return 1==c?b:b.map(function(a){return a*c})}
function Wl(a,b,c,d,e,f,g){var h=a.coordinates.length,k=Xl(a);g&&(c+=e);g=[b[c],b[c+1]];var m=[NaN,NaN],p=!0,t,u,w;for(t=c+e;t<d;t+=e){m[0]=b[t];m[1]=b[t+1];w=k[1];var x=k[2],z=k[3],D=m[0],H=m[1],G=0;D<k[0]?G|=16:D>x&&(G|=4);H<w?G|=8:H>z&&(G|=2);0===G&&(G=1);w=G;w!==u?(p&&(a.coordinates[h++]=g[0],a.coordinates[h++]=g[1]),a.coordinates[h++]=m[0],a.coordinates[h++]=m[1],p=!1):1===w?(a.coordinates[h++]=m[0],a.coordinates[h++]=m[1],p=!1):p=!0;g[0]=m[0];g[1]=m[1];u=w}if(f&&p||t===c+e)a.coordinates[h++]=
g[0],a.coordinates[h++]=g[1];return h}function Yl(a,b,c,d,e,f){for(var g=0,h=d.length;g<h;++g){var k=d[g];c=Wl(a,b,c,k,e,!1,!1);f.push(c);c=k}return c}l=Sl.prototype;
l.xz=function(a,b,c){Zl(this,b);var d=a.F(),e=a.S,f=this.coordinates.length,g,h;if("MultiPolygon"==d){d=a.Yd();g=[];for(var k=a.lc,m=h=0,p=k.length;m<p;++m){var t=[];h=Yl(this,d,h,k[m],e,t);g.push(t)}this.Mb.push([4,f,g,a,c,ei])}else"Polygon"==d||"MultiLineString"==d?(g=[],d="Polygon"==d?a.Yd():a.l,Yl(this,d,0,a.Qa,e,g),this.Mb.push([4,f,g,a,c,di])):"LineString"==d||"MultiPoint"==d?(d=a.l,e=Wl(this,d,0,d.length,e,!1,!1),this.Mb.push([4,f,e,a,c,ci])):"Point"==d&&(d=a.l,this.coordinates.push(d[0],d[1]),
e=this.coordinates.length,this.Mb.push([4,f,e,a,c]));$l(this,b)};function Zl(a,b){a.hp=[0,b,0];a.Mb.push(a.hp);a.ip=[0,b,0];a.Eb.push(a.ip)}l.ua=function(a){if(this.Pp){var b=Bh(this.iw,this.Pp.slice());a.translate(b[0],b[1]);a.rotate(this.Hs)}a.fill();this.Pp&&a.setTransform.apply(a,Tk)};l.ug=function(a,b){a.strokeStyle=b[1];a.lineWidth=b[2];a.lineCap=b[3];a.lineJoin=b[4];a.miterLimit=b[5];Be&&(a.lineDashOffset=b[7],a.setLineDash(b[6]))};
function am(a,b,c){if(b&&5<b.length){var d=b[4];if(1==d||d==b.length-5){c={Wa:b[0],Sa:b[1],lb:b[2],bb:b[3],value:c};if(!a.jz.fG(c))for(a.jz.Lb(c),c=5,d=b.length;c<d;++c){var e=b[c];e&&(11<e.length&&Tl(a,e[0],e[13],e[14],e[15],e[16],e[11],e[12]),Uk.apply(void 0,e))}b.length=5;sg(b)}}}
function bm(a,b,c,d,e,f,g){var h;a.Ln&&df(c,a.iw)?h=a.Ln:(a.Ln||(a.Ln=[]),h=Kg(a.coordinates,a.coordinates.length,2,c,a.Ln),Ah(a.iw,c));for(var k=!Jd(d),m=0,p=e.length,t=0,u,w,x,z,D,H,G,L,N,T=0,U=0,K=null,X=null,ma=a.kG,fa=a.Hs,ya={context:b,mb:a.mb,ra:a.ra,rotation:fa},Ca=a.Mb!=e||a.Mv?0:200;m<p;){var da=e[m],qb,Rd,Sd;switch(da[0]){case 0:qb=da[1];k&&d[I(qb).toString()]||!qb.j()?m=da[2]:void 0===g||Eg(g,qb.j().V())?++m:m=da[2]+1;break;case 1:T>Ca&&(a.ua(b),T=0);U>Ca&&(b.stroke(),U=0);T||U||(b.beginPath(),
z=D=NaN);++m;break;case 2:var t=da[1],Eh=h[t],hm=h[t+1],Bq=h[t+2]-Eh,Jq=h[t+3]-hm,Kq=Math.sqrt(Bq*Bq+Jq*Jq);b.moveTo(Eh+Kq,hm);b.arc(Eh,hm,Kq,0,2*Math.PI,!0);++m;break;case 3:b.closePath();++m;break;case 4:t=da[1];u=da[2];var Cw=da[4],Lq=6==da.length?da[5]:void 0;ya.geometry=da[3];ya.ka=qb;m in ma||(ma[m]=[]);var Fh=ma[m];Lq?Lq(h,t,u,2,Fh):(Fh[0]=h[t],Fh[1]=h[t+1],Fh.length=2);Cw(Fh,ya);++m;break;case 6:t=da[1];u=da[2];N=da[3];w=da[4];x=da[5];L=f?null:da[6];var Dw=da[7],Ew=da[8],Fw=da[9],Gw=da[10],
Hw=da[11],Mq=da[12],Iw=da[13],Jw=da[14],Kw=da[15],jm,km,lm;16<da.length?(jm=da[16],km=da[17],lm=da[18]):(jm=Jk,km=lm=!1);for(Hw&&(Mq+=fa);t<u;t+=2)Ul(a,b,h[t],h[t+1],N,w,x,L,Dw,Ew,Fw,Gw,Mq,Iw,Jw,Kw,jm,km?K:null,lm?X:null);am(a,L,qb);++m;break;case 5:var Nq=da[1],Oq=da[2],mm=da[3];L=f?null:da[4];var Lw=da[5],Pq=da[6],Mw=da[7],Qq=da[8],Rq=da[9],Sq=da[10],Tq=da[11],Uq=da[12],nm=da[13],Vq=da[14],Wq=Pl(h,Nq,Oq,2),Xq=Qq(Uq);if(Lw||Xq<=Wq){var sf;a:{for(var we=h,bd=Nq,Yq=Oq,Zq=Uq,Nw=Qq,$q=(Wq-Xq)*Rl[a.fs[nm].textAlign],
Ow=Mw,om=[],Gh=we[bd]>we[Yq-2],ar=Zq.length,Hh=we[bd],Ih=we[bd+1],bd=bd+2,mg=we[bd],ng=we[bd+1],pm=0,Zi=Math.sqrt(Math.pow(mg-Hh,2)+Math.pow(ng-Ih,2)),tf="",$i=0,uf=void 0,br=void 0,aj=void 0,bj=0;bj<ar;++bj){for(var br=Gh?ar-bj-1:bj,qm=Zq.charAt(br),tf=Gh?qm+tf:tf+qm,og=Nw(tf)-$i,$i=$i+og,cr=$q+og/2;bd<Yq-2&&pm+Zi<cr;)Hh=mg,Ih=ng,bd+=2,mg=we[bd],ng=we[bd+1],pm+=Zi,Zi=Math.sqrt(Math.pow(mg-Hh,2)+Math.pow(ng-Ih,2));var Pw=cr-pm,pg=Math.atan2(ng-Ih,mg-Hh);Gh&&(pg+=0<pg?-Math.PI:Math.PI);if(void 0!==
aj){var Jh=pg-aj,Jh=Jh+(Jh>Math.PI?-2*Math.PI:Jh<-Math.PI?2*Math.PI:0);if(Math.abs(Jh)>Ow){sf=null;break a}}var dr=Pw/Zi,er=Kf(Hh,mg,dr),fr=Kf(Ih,ng,dr);aj==pg?(Gh&&(uf[0]=er,uf[1]=fr,uf[2]=og/2),uf[4]=tf):(tf=qm,$i=og,uf=[er,fr,og/2,pg,tf],Gh?om.unshift(uf):om.push(uf),aj=pg);$q+=og}sf=om}if(sf){var xe,cj,dj,td,Jc;if(Sq)for(xe=0,cj=sf.length;xe<cj;++xe)Jc=sf[xe],dj=Jc[4],td=a.na(dj,nm,"",Sq),w=Jc[2]+Tq,x=mm*td.height+2*(.5-mm)*Tq-Rq,Ul(a,b,Jc[0],Jc[1],td,w,x,L,td.height,1,0,0,Jc[3],Vq,!1,td.width,
Jk,null,null);if(Pq)for(xe=0,cj=sf.length;xe<cj;++xe)Jc=sf[xe],dj=Jc[4],td=a.na(dj,nm,Pq,""),w=Jc[2],x=mm*td.height-Rq,Ul(a,b,Jc[0],Jc[1],td,w,x,L,td.height,1,0,0,Jc[3],Vq,!1,td.width,Jk,null,null)}}am(a,L,qb);++m;break;case 7:if(void 0!==f){qb=da[1];var gr=f(qb);if(gr)return gr}++m;break;case 8:Ca?T++:a.ua(b);++m;break;case 9:t=da[1];u=da[2];Rd=h[t];Sd=h[t+1];H=Rd+.5|0;G=Sd+.5|0;if(H!==z||G!==D)b.moveTo(Rd,Sd),z=H,D=G;for(t+=2;t<u;t+=2)if(Rd=h[t],Sd=h[t+1],H=Rd+.5|0,G=Sd+.5|0,t==u-2||H!==z||G!==
D)b.lineTo(Rd,Sd),z=H,D=G;++m;break;case 10:K=da;a.Pp=da[2];T&&(a.ua(b),T=0,U&&(b.stroke(),U=0));b.fillStyle=da[1];++m;break;case 11:X=da;U&&(b.stroke(),U=0);a.ug(b,da);++m;break;case 12:Ca?U++:b.stroke();++m;break;default:++m}}T&&a.ua(b);U&&b.stroke()}l.ke=function(a,b,c,d){this.Hs=c;bm(this,a,b,d,this.Mb,void 0,void 0)};
function cm(a){var b=a.Eb;b.reverse();var c,d=b.length,e,f,g=-1;for(c=0;c<d;++c)if(e=b[c],f=e[0],7==f)g=c;else if(0==f){e[2]=c;e=a.Eb;for(f=c;g<f;){var h=e[g];e[g]=e[f];e[f]=h;++g;--f}g=-1}}
l.df=function(a,b){var c=this.state;a?(a=a.sa,c.fillStyle=al(a?a:Gk)):c.fillStyle=void 0;b?(a=b.sa,c.strokeStyle=al(a?a:Ik),a=b.di,c.lineCap=void 0!==a?a:"round",a=b.getLineDash(),c.sb=a?a.slice():Hk,a=b.fh,c.lineDashOffset=a?a:0,a=b.ei,c.lineJoin=void 0!==a?a:"round",a=b.Qc(),c.lineWidth=void 0!==a?a:1,b=b.ii,c.miterLimit=void 0!==b?b:10,c.lineWidth>this.br&&(this.br=c.lineWidth,this.Ak=null)):(c.strokeStyle=void 0,c.lineCap=void 0,c.sb=null,c.lineDashOffset=void 0,c.lineJoin=void 0,c.lineWidth=
void 0,c.miterLimit=void 0)};l.Iy=function(a,b){var c=a.fillStyle;a=[10,c];"string"!==typeof c&&(b=b.V(),a.push([b[0],b[3]]));this.Mb.push(a)};l.vk=function(a){this.Mb.push([11,a.strokeStyle,a.lineWidth*this.mb,a.lineCap,a.lineJoin,a.miterLimit,Vl(this,a.sb),a.lineDashOffset*this.mb])};function dm(a,b,c,d){var e=b.fillStyle;if("string"!==typeof e||b.oG!=e)c.call(a,b,d),b.oG=e}
function em(a,b,c){var d=b.strokeStyle,e=b.lineCap,f=b.sb,g=b.lineDashOffset,h=b.lineJoin,k=b.lineWidth,m=b.miterLimit;if(b.uG!=d||b.pG!=e||f!=b.hz&&!df(b.hz,f)||b.qG!=g||b.rG!=h||b.sG!=k||b.tG!=m)c.call(a,b),b.uG=d,b.pG=e,b.hz=f,b.qG=g,b.rG=h,b.sG=k,b.tG=m}function $l(a,b){a.hp[2]=a.Mb.length;a.hp=null;a.ip[2]=a.Eb.length;a.ip=null;b=[7,b];a.Mb.push(b);a.Eb.push(b)}l.finish=Dd;function Xl(a){a.Ak||(a.Ak=jg(a.$q),0<a.br&&ig(a.Ak,a.ra*(a.br+1)/2,a.Ak));return a.Ak};function fm(a,b,c,d,e,f){Sl.call(this,a,b,c,d,e,f);this.la=this.Zg=this.Ie=null;this.Cg=this.Kf=this.bf=this.Md=this.Ld=this.tl=this.sl=this.mh=this.al=this.uk=this.tk=void 0}F(fm,Sl);l=fm.prototype;l.Le=function(a,b,c,d){return Wl(this,a,b,c,d,!1,!1)};
l.Nh=function(a,b){if(this.la){Zl(this,b);var c=a.l,d=this.coordinates.length;a=this.Le(c,0,c.length,a.S);this.Mb.push([6,d,a,this.la,this.tk,this.uk,this.Ie,this.al,this.mh,this.sl,this.tl,this.Ld,this.Md,this.bf*this.mb,this.Kf,this.Cg]);this.Eb.push([6,d,a,this.Zg,this.tk,this.uk,this.Ie,this.al,this.mh,this.sl,this.tl,this.Ld,this.Md,this.bf,this.Kf,this.Cg]);$l(this,b)}};
l.Zt=function(a,b){if(this.la){Zl(this,b);var c=a.l,d=this.coordinates.length;a=this.Le(c,0,c.length,a.S);this.Mb.push([6,d,a,this.la,this.tk,this.uk,this.Ie,this.al,this.mh,this.sl,this.tl,this.Ld,this.Md,this.bf*this.mb,this.Kf,this.Cg]);this.Eb.push([6,d,a,this.Zg,this.tk,this.uk,this.Ie,this.al,this.mh,this.sl,this.tl,this.Ld,this.Md,this.bf,this.Kf,this.Cg]);$l(this,b)}};
l.finish=function(){cm(this);this.uk=this.tk=void 0;this.la=this.Zg=null;this.Cg=this.Kf=this.Md=this.Ld=this.tl=this.sl=this.mh=this.bf=this.al=void 0};l.Rr=function(a,b){var c=a.Um(),d=a.$a(),e=a.Ym(1),f=a.na(1),g=a.ag();this.tk=c[0];this.uk=c[1];this.Ie=b;this.Zg=e;this.la=f;this.al=d[1];this.mh=a.Vg();this.sl=g[0];this.tl=g[1];this.Ld=a.Ld;this.Md=a.Cb();this.bf=a.Za();this.Kf=a.Kf;this.Cg=d[0]};function gm(a,b,c,d,e,f){Sl.call(this,a,b,c,d,e,f)}F(gm,Sl);function im(a,b,c,d,e){var f=a.coordinates.length;b=Wl(a,b,c,d,e,!1,!1);f=[9,f,b];a.Mb.push(f);a.Eb.push(f);return d}gm.prototype.Xt=function(a,b){var c=this.state,d=c.lineWidth;void 0!==c.strokeStyle&&void 0!==d&&(em(this,c,this.vk),Zl(this,b),this.Eb.push([11,c.strokeStyle,c.lineWidth,c.lineCap,c.lineJoin,c.miterLimit,c.sb,c.lineDashOffset],[1]),c=a.l,im(this,c,0,c.length,a.S),this.Eb.push([12]),$l(this,b))};
gm.prototype.Yt=function(a,b){var c=this.state,d=c.lineWidth;if(void 0!==c.strokeStyle&&void 0!==d){em(this,c,this.vk);Zl(this,b);this.Eb.push([11,c.strokeStyle,c.lineWidth,c.lineCap,c.lineJoin,c.miterLimit,c.sb,c.lineDashOffset],[1]);c=a.Qa;d=a.l;a=a.S;var e=0,f,g;f=0;for(g=c.length;f<g;++f)e=im(this,d,e,c[f],a);this.Eb.push([12]);$l(this,b)}};gm.prototype.finish=function(){var a=this.state;void 0!=a.tn&&a.tn!=this.coordinates.length&&this.Mb.push([12]);cm(this);this.state=null};
gm.prototype.vk=function(a){void 0!=a.tn&&a.tn!=this.coordinates.length&&(this.Mb.push([12]),a.tn=this.coordinates.length);a.tn=0;Sl.prototype.vk.call(this,a);this.Mb.push([1])};function rm(a,b,c,d,e,f){Sl.call(this,a,b,c,d,e,f)}F(rm,Sl);function sm(a,b,c,d,e){var f=a.state,g=void 0!==f.fillStyle,f=void 0!=f.strokeStyle,h=d.length,k=[1];a.Mb.push(k);a.Eb.push(k);for(k=0;k<h;++k){var m=d[k],p=a.coordinates.length;c=Wl(a,b,c,m,e,!0,!f);c=[9,p,c];a.Mb.push(c);a.Eb.push(c);f&&(c=[3],a.Mb.push(c),a.Eb.push(c));c=m}b=[8];a.Eb.push(b);g&&a.Mb.push(b);f&&(g=[12],a.Mb.push(g),a.Eb.push(g));return c}
rm.prototype.Gm=function(a,b){var c=this.state,d=c.strokeStyle;if(void 0!==c.fillStyle||void 0!==d){tm(this,a);Zl(this,b);this.Eb.push([10,Zk(Gk)]);void 0!==c.strokeStyle&&this.Eb.push([11,c.strokeStyle,c.lineWidth,c.lineCap,c.lineJoin,c.miterLimit,c.sb,c.lineDashOffset]);var e=a.l,d=this.coordinates.length;Wl(this,e,0,e.length,a.S,!1,!1);a=[1];d=[2,d];this.Mb.push(a,d);this.Eb.push(a,d);a=[8];this.Eb.push(a);void 0!==c.fillStyle&&this.Mb.push(a);void 0!==c.strokeStyle&&(c=[12],this.Mb.push(c),this.Eb.push(c));
$l(this,b)}};rm.prototype.Hm=function(a,b){var c=this.state;tm(this,a);Zl(this,b);this.Eb.push([10,Zk(Gk)]);void 0!==c.strokeStyle&&this.Eb.push([11,c.strokeStyle,c.lineWidth,c.lineCap,c.lineJoin,c.miterLimit,c.sb,c.lineDashOffset]);var c=a.Qa,d=a.Yd();sm(this,d,0,c,a.S);$l(this,b)};
rm.prototype.$t=function(a,b){var c=this.state,d=c.strokeStyle;if(void 0!==c.fillStyle||void 0!==d){tm(this,a);Zl(this,b);this.Eb.push([10,Zk(Gk)]);void 0!==c.strokeStyle&&this.Eb.push([11,c.strokeStyle,c.lineWidth,c.lineCap,c.lineJoin,c.miterLimit,c.sb,c.lineDashOffset]);c=a.lc;d=a.Yd();a=a.S;var e=0,f,g;f=0;for(g=c.length;f<g;++f)e=sm(this,d,e,c[f],a);$l(this,b)}};
rm.prototype.finish=function(){cm(this);this.state=null;var a=this.YD;if(0!==a){var b=this.coordinates,c,d;c=0;for(d=b.length;c<d;++c)b[c]=a*Math.round(b[c]/a)}};function tm(a,b){var c=a.state;void 0!==c.fillStyle&&dm(a,c,a.Iy,b);void 0!==c.strokeStyle&&em(a,c,a.vk)};function um(a,b,c,d,e,f){Sl.call(this,a,b,c,d,e,f);this.xa="";this.es=this.Lw=0;this.Mw=void 0;this.Nw=0;this.cm=null;this.ku={};this.Zj=null;this.Dw={};this.vo={};this.fs={};this.Cw=this.ju=this.uo="";for(this.DE={};Kk.Ih();)Kk.pop()}F(um,Sl);
um.prototype.Pg=function(a,b){var c=this.cm,d=this.Zj,e=this.vo;if(""!==this.xa&&e&&(c||d)){var c=this.coordinates.length,f=a.F(),d=null,g=2,h=2;if("line"===e.placement){if(!Eg(Xl(this),a.V()))return;var k,d=a.l,h=a.S;if("LineString"==f)k=[d.length];else if("MultiLineString"==f)k=a.Qa;else if("Polygon"==f)k=a.Qa.slice(0,1);else if("MultiPolygon"==f)for(a=a.lc,k=[],g=0,f=a.length;g<f;++g)k.push(a[g][0]);Zl(this,b);a=e.textAlign;for(var m=0,p,f=0,t=k.length;f<t;++f){if(void 0==a){p=g=m;for(var u=0,
w=0,x=m,z,D=z=void 0,H=void 0,G=void 0,L=void 0,N=void 0;m<k[f];m+=h){var T=d[m],U=d[m+1];void 0!==H&&(H=T-H,G=U-G,D=Math.sqrt(H*H+G*G),void 0!==L&&(w+=z,z=Math.acos((L*H+N*G)/(z*D)),z>e.nl&&(w>u&&(u=w,g=x,p=m),w=0,x=m-h)),z=D,L=H,N=G);H=T;G=U}g=w+D>u?[x,m]:[g,p];m=g[0];p=g[1]}else p=k[f];for(g=m;g<p;g+=h)this.coordinates.push(d[g],d[g+1]);g=this.coordinates.length;m=k[f];vm(this,c,g,this.Ie);c=g}}else{k=this.na(this.xa,this.uo,this.ju,this.Cw);t=k.width/this.mb;switch(f){case "Point":case "MultiPoint":d=
a.l;g=d.length;break;case "LineString":d=wm(a);break;case "Circle":d=a.Ka();break;case "MultiLineString":d=xm(a);g=d.length;break;case "Polygon":d=si(a);if(!e.overflow&&d[2]/this.ra<t)return;h=3;break;case "MultiPolygon":p=ym(a);d=[];g=0;for(f=p.length;g<f;g+=3)(e.overflow||p[g+2]/this.ra>=t)&&d.push(p[g],p[g+1]);g=d.length;if(0==g)return}g=Wl(this,d,0,g,h,!1,!1);Zl(this,b);if(e.wk||e.xk)this.df(e.wk,e.xk),dm(this,this.state,this.Iy,a),em(this,this.state,this.vk);zm(this,k,c,g)}$l(this,b)}};
um.prototype.na=function(a,b,c,d){var e,f=d+b+a+c+this.mb;if(!Fk(Kk,f)){var g=d?this.Dw[d]||this.Zj:null,h=c?this.ku[c]||this.cm:null,k=this.fs[b]||this.vo,m=k.scale*this.mb,p=Rl[k.textAlign||"center"];b=d&&g.lineWidth?g.lineWidth:0;a=a.split("\n");var t=a.length,u=[],w,x=k.font;w=a.length;e=0;var z,D;for(D=0;D<w;++D)z=Rk(x,a[D]),e=Math.max(e,z),u.push(z);w=e;x=Qk(k.font);w=Li(Math.ceil((w+b)*m),Math.ceil((x*t+b)*m));e=w.canvas;Kk.set(f,e);1!=m&&w.scale(m,m);w.font=k.font;d&&(w.strokeStyle=g.strokeStyle,
w.lineWidth=b*(ve?m:1),w.lineCap=g.lineCap,w.lineJoin=g.lineJoin,w.miterLimit=g.miterLimit,Be&&g.sb.length&&(w.setLineDash(g.sb),w.lineDashOffset=g.lineDashOffset));c&&(w.fillStyle=h.fillStyle);w.textBaseline="middle";w.textAlign="center";g=.5-p;h=p*e.width/m+g*b;if(d)for(d=0;d<t;++d)w.strokeText(a[d],h+g*u[d],.5*(b+x)+d*x);if(c)for(d=0;d<t;++d)w.fillText(a[d],h+g*u[d],.5*(b+x)+d*x)}return Kk.get(f)};
function zm(a,b,c,d){var e=a.vo,f=a.Zj,g=a.mb,h=Rl[e.textAlign||"center"],k=Rl[e.textBaseline],f=f&&f.lineWidth?f.lineWidth:0,h=h*b.width/g+2*(.5-h)*f,k=k*b.height/g+2*(.5-k)*f;a.Mb.push([6,c,d,b,(h-a.Lw)*g,(k-a.es)*g,a.Ie,b.height,1,0,0,a.Mw,a.Nw,1,!0,b.width,e.padding==Jk?Jk:e.padding.map(function(a){return a*g}),!!e.wk,!!e.xk]);a.Eb.push([6,c,d,b,(h-a.Lw)*g,(k-a.es)*g,a.Ie,b.height,1,0,0,a.Mw,a.Nw,1/g,!0,b.width,e.padding,!!e.wk,!!e.xk])}
function vm(a,b,c,d){var e=a.Zj,f=a.vo,g=a.cm,h=a.Cw;e&&(h in a.Dw||(a.Dw[h]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,sb:e.sb}));var k=a.uo;a.uo in a.fs||(a.fs[a.uo]={font:f.font,textAlign:f.textAlign||"center",scale:f.scale});var m=a.ju;g&&(m in a.ku||(a.ku[m]={fillStyle:g.fillStyle}));var p=a.mb,g=Rl[f.textBaseline],t=a.es*p,u=a.xa,w=f.font,x=f.scale,e=e?e.lineWidth*x/2:0,z=a.DE[w];z||(a.DE[w]=
z={});a.Mb.push([5,b,c,g,d,f.overflow,m,f.nl,function(a){var b=z[a];b||(b=z[a]=Rk(w,a));return b*x*p},t,h,e*p,u,k,1]);a.Eb.push([5,b,c,g,d,f.overflow,m,f.nl,function(a){var b=z[a];b||(b=z[a]=Rk(w,a));return b*x},t,h,e,u,k,1/p])}
um.prototype.uh=function(a,b){var c,d;if(a){this.Ie=b;(d=a.ua)?(b=this.cm,b||(b=this.cm={}),b.fillStyle=al(d.sa||Gk)):b=this.cm=null;if(c=a.ha){d=this.Zj;d||(d=this.Zj={});var e=c.getLineDash(),f=c.fh,g=c.Qc(),h=c.ii;d.lineCap=c.di||"round";d.sb=e?e.slice():Hk;d.lineDashOffset=void 0===f?0:f;d.lineJoin=c.ei||"round";d.lineWidth=void 0===g?1:g;d.miterLimit=void 0===h?10:h;d.strokeStyle=al(c.sa||Ik)}else d=this.Zj=null;c=this.vo;e=a.Ph||"10px sans-serif";Pk(e);f=a.Za();c.overflow=a.kC;c.font=e;c.nl=
a.AB;c.placement=a.oC;c.textAlign=a.Ei;c.textBaseline=a.Yj||"middle";c.wk=a.NF;c.xk=a.OF;c.padding=a.ML||Jk;c.scale=void 0===f?1:f;e=a.mg;f=a.ng;g=a.Ld;h=a.Cb();this.xa=a.xa||"";this.Lw=void 0===e?0:e;this.es=void 0===f?0:f;this.Mw=void 0===g?!1:g;this.Nw=void 0===h?0:h;this.Cw=d?("string"==typeof d.strokeStyle?d.strokeStyle:I(d.strokeStyle))+d.lineCap+d.lineDashOffset+"|"+d.lineWidth+d.lineJoin+d.miterLimit+"["+d.sb.join()+"]":"";this.uo=c.font+c.scale+(c.textAlign||"?");this.ju=b?"string"==typeof b.fillStyle?
b.fillStyle:"|"+I(b.fillStyle):""}else this.xa=""};function Am(a,b,c,d,e,f,g){this.tf=f;this.Ie=null;this.Vw=a;this.ar=b;this.sr=e;this.og=d;this.PM=c;this.$e=g;this.hc={};this.DJ=Li(1,1);this.EJ=wh()}F(Am,Ol);var Bm={0:[[!0]]};function Cm(a,b,c){var d,e=Math.floor(a.length/2);if(b>=e)for(d=e;d<b;d++)a[d][c]=!0;else if(b<e)for(d=b+1;d<e;d++)a[d][c]=!0}
function Dm(a){if(void 0!==Bm[a])return Bm[a];for(var b=2*a+1,c=Array(b),d=0;d<b;d++)c[d]=Array(b);for(var b=a,e=d=0;b>=d;)Cm(c,a+b,a+d),Cm(c,a+d,a+b),Cm(c,a-d,a+b),Cm(c,a-b,a+d),Cm(c,a-b,a-d),Cm(c,a-d,a-b),Cm(c,a+d,a-b),Cm(c,a+b,a-d),d++,e+=1+2*d,0<2*(e-b)+1&&(--b,e+=1-2*b);return Bm[a]=c}l=Am.prototype;l.Qf=function(a){var b=null;this.tf&&(a?(b=this.Ie,b[4]++):(b=this.Ie=gg(),b.push(1)));return b};
l.clip=function(a,b){b=Em(this,b);a.beginPath();a.moveTo(b[0],b[1]);a.lineTo(b[2],b[3]);a.lineTo(b[4],b[5]);a.lineTo(b[6],b[7]);a.clip()};l.finish=function(){for(var a in this.hc){var b=this.hc[a],c;for(c in b)b[c].finish()}};
l.yc=function(a,b,c,d,e,f,g){d=Math.round(d);var h=2*d+1,k=Lh(this.EJ,d+.5,d+.5,1/b,-1/b,-c,-a[0],-a[1]),m=this.DJ;m.canvas.width!==h||m.canvas.height!==h?(m.canvas.width=h,m.canvas.height=h):m.clearRect(0,0,h,h);var p;void 0!==this.$e&&(p=gg(),hg(p,a),ig(p,b*(this.$e+d),p));var t=Dm(d),u;this.tf&&(u=this.tf.all().map(function(a){return a.value}));return this.lw(m,k,c,e,function(a){for(var b=m.getImageData(0,0,h,h).data,c=0;c<h;c++)for(var d=0;d<h;d++)if(t[c][d]&&0<b[4*(d*h+c)+3]){var e;u&&-1===u.indexOf(a)||
(e=f(a));if(e)return e;m.clearRect(0,0,h,h);return}},p,g)};function Em(a,b){var c=a.ar;a=c[0];var d=c[1],e=c[2],c=c[3];a=[a,d,a,c,e,c,e,d];Kg(a,8,2,b,a);return a}l.rd=function(a,b){var c=void 0!==a?a.toString():"0";a=this.hc[c];void 0===a&&(a={},this.hc[c]=a);c=a[b];void 0===c&&(c=new Fm[b](this.Vw,this.ar,this.PM,this.og,this.sr,this.tf),a[b]=c);return c};l.Bf=function(){return Jd(this.hc)};
l.ke=function(a,b,c,d,e,f){var g=Object.keys(this.hc).map(Number);g.sort($e);a.save();this.clip(a,b);e=e?e:Ql;var h,k,m,p,t,u;h=0;for(k=g.length;h<k;++h){var w=g[h].toString();t=this.hc[w];m=0;for(p=e.length;m<p;++m){var x=e[m];u=t[x];void 0!==u&&(!f||"Image"!=x&&"Text"!=x?u.ke(a,b,c,d):(x=f[w])?x.push(u,b.slice(0)):f[w]=[u,b.slice(0)])}}a.restore()};
l.lw=function(a,b,c,d,e,f,g){var h=Object.keys(this.hc).map(Number);h.sort($e);var k,m,p,t;for(k=h.length-1;0<=k;--k){var u=h[k].toString();p=this.hc[u];for(m=Ql.length-1;0<=m;--m){var w=Ql[m];t=p[w];if(void 0!==t)if(!g||"Image"!=w&&"Text"!=w){var w=a,x=b,z=d,D=e,H=f;t.Hs=c;if(t=bm(t,w,x,z,t.Eb,D,H))return t}else(w=g[u])?w.push(t,b.slice(0)):g[u]=[t,b.slice(0)]}}};var Fm={Circle:rm,Default:Sl,Image:fm,LineString:gm,Polygon:rm,Text:um};function Gm(a,b){return I(a)-I(b)}function Hm(a,b){a=.5*a/b;return a*a}function Im(a,b,c,d,e,f){var g=!1,h,k;if(h=c.na())k=h.Sk(),2==k||3==k?h.eE(e,f):(0==k&&h.load(),h.eB(e,f),g=!0);if(e=(0,c.Xd)(b))if(d=e.Du(d),c.Jl)Jm(a,d,c,b);else(0,Km[d.F()])(a,d,c,b);return g}function Jm(a,b,c,d){if("GeometryCollection"==b.F()){b=Lm(b.Rb);for(var e=0,f=b.length;e<f;++e)Jm(a,b[e],c,d)}else a.rd(c.Xc(),"Default").xz(b,d,c.Jl)}
var Km={Point:function(a,b,c,d){var e=c.na();if(e){if(2!=e.Sk())return;var f=a.rd(c.Xc(),"Image");f.Rr(e,a.Qf(!1));f.Nh(b,d)}if(f=c.xa)c=a.rd(c.Xc(),"Text"),c.uh(f,a.Qf(!!e)),c.Pg(b,d)},LineString:function(a,b,c,d){var e=c.ha;if(e){var f=a.rd(c.Xc(),"LineString");f.df(null,e);f.Xt(b,d)}if(e=c.xa)c=a.rd(c.Xc(),"Text"),c.uh(e,a.Qf(!1)),c.Pg(b,d)},Polygon:function(a,b,c,d){var e=c.ua,f=c.ha;if(e||f){var g=a.rd(c.Xc(),"Polygon");g.df(e,f);g.Hm(b,d)}if(e=c.xa)c=a.rd(c.Xc(),"Text"),c.uh(e,a.Qf(!1)),c.Pg(b,
d)},MultiPoint:function(a,b,c,d){var e=c.na();if(e){if(2!=e.Sk())return;var f=a.rd(c.Xc(),"Image");f.Rr(e,a.Qf(!1));f.Zt(b,d)}if(f=c.xa)c=a.rd(c.Xc(),"Text"),c.uh(f,a.Qf(!!e)),c.Pg(b,d)},MultiLineString:function(a,b,c,d){var e=c.ha;if(e){var f=a.rd(c.Xc(),"LineString");f.df(null,e);f.Yt(b,d)}if(e=c.xa)c=a.rd(c.Xc(),"Text"),c.uh(e,a.Qf(!1)),c.Pg(b,d)},MultiPolygon:function(a,b,c,d){var e=c.ua,f=c.ha;if(f||e){var g=a.rd(c.Xc(),"Polygon");g.df(e,f);g.$t(b,d)}if(e=c.xa)c=a.rd(c.Xc(),"Text"),c.uh(e,a.Qf(!1)),
c.Pg(b,d)},GeometryCollection:function(a,b,c,d){b=b.Rb;var e,f;e=0;for(f=b.length;e<f;++e)(0,Km[b[e].F()])(a,b[e],c,d)},Circle:function(a,b,c,d){var e=c.ua,f=c.ha;if(e||f){var g=a.rd(c.Xc(),"Circle");g.df(e,f);g.Gm(b,d)}if(e=c.xa)c=a.rd(c.Xc(),"Text"),c.uh(e,a.Qf(!1)),c.Pg(b,d)}};function Mm(a){nl.call(this,a);this.tf=a.Lt?Nl.Jj(9):null;this.Vd=!1;this.af=-1;this.Xn=NaN;this.De=gg();this.Id=this.Wn=null;this.kw=!0;this.context=Li();J(Kk,"clear",this.kn,this)}F(Mm,nl);Mm.handles=function(a,b){return"canvas"===a&&"VECTOR"===b.F()};Mm.create=function(a,b){return new Mm(b)};l=Mm.prototype;l.Ya=function(){Td(Kk,"clear",this.kn,this);nl.prototype.Ya.call(this)};
l.Dk=function(a,b,c){var d=a.aa,e=a.mb,f=b.Uq?a.Xl:{},g=a.Ma,h=g.pa,k=g.rotation,m=h.V(),p=this.Kb().s(),t=this.Th(a,0);this.se("precompose",c,a,t);var u=b.aa;(g=void 0!==u)&&this.clip(c,a,u);var w=this.Id;if(w&&!w.Bf()){this.tf&&this.tf.clear();var x=this.Kb(),z=u=0,D,H=1!==b.opacity,x=x.hasListener("render");if(H||x){D=c.canvas.width;var G=c.canvas.height;if(k){var L=Math.round(Math.sqrt(D*D+G*G)),u=(L-D)/2,z=(L-G)/2;D=G=L}this.context.canvas.width=D;this.context.canvas.height=G;D=this.context}else D=
c;G=D.globalAlpha;H||(D.globalAlpha=b.opacity);D!=c&&D.translate(u,z);L=a.size[0]*e;e*=a.size[1];Sk(D,-k,L/2,e/2);w.ke(D,t,k,f);if(p.Js&&h.bj&&!qg(m,d)){for(var h=d[0],p=zg(m),N=0;h<m[0];)--N,t=p*N,t=this.Th(a,t),w.ke(D,t,k,f),h+=p;N=0;for(h=d[2];h>m[2];)++N,t=p*N,t=this.Th(a,t),w.ke(D,t,k,f),h-=p;t=this.Th(a,0)}Sk(D,k,L/2,e/2);D!=c&&(x&&this.se("render",D,a,t),H?(d=c.globalAlpha,c.globalAlpha=b.opacity,c.drawImage(D.canvas,-u,-z),c.globalAlpha=d):c.drawImage(D.canvas,-u,-z),D.translate(-u,-z));H||
(D.globalAlpha=G)}g&&c.restore();this.xr(c,a,b,t)};l.yc=function(a,b,c,d,e){if(this.Id){var f=b.Ma.ra;b=b.Ma.rotation;var g=this.Kb(),h={};return this.Id.yc(a,f,b,c,{},function(a){var b=I(a).toString();if(!(b in h))return h[b]=!0,d.call(e,a,g)},null)}};l.kn=function(){var a=this.Kb();a.getVisible()&&this.Id&&a.L()};l.Xh=function(){el(this)};
l.rg=function(a){var b=this.Kb(),c=b.s();hl(a,c);var d=a.Of[0],e=a.Of[1],f=b.lE,g=b.mE;if(!this.Vd&&!f&&d||!g&&e)return!0;var f=a.aa,h=a.Ma,g=h.pa,k=h.ra,m=a.mb,d=b.Xa,p=b.$e,e=b.get(Nm);void 0===e&&(e=Gm);f=ig(f,p*k);p=h.pa.V();c.Js&&h.pa.bj&&!qg(p,a.aa)&&(a=Math.max(zg(f)/2,zg(p)),f[0]=p[0]-a,f[2]=p[2]+a);if(!this.Vd&&this.Xn==k&&this.af==d&&this.Wn==e&&qg(this.De,f))return this.kw=!1,!0;this.Id=null;this.Vd=!1;var t=new Am(.5*k/m,f,k,m,c.sr,this.tf,b.$e);Om(c,f,k,g);a=function(a){var c,d=a.wg;
d?c=d.call(a,k):(d=b.wg)&&(c=d(a,k));c&&(a=this.Tn(a,k,m,c,t),this.Vd=this.Vd||a)}.bind(this);if(e){var u=[];Pm(c,f,function(a){u.push(a)},this);u.sort(e);c=0;for(g=u.length;c<g;++c)a(u[c])}else Pm(c,f,a,this);t.finish();this.Xn=k;this.af=d;this.Wn=e;this.De=f;this.Id=t;return this.kw=!0};l.Tn=function(a,b,c,d,e){if(!d)return!1;var f=!1;if(Array.isArray(d))for(var g=0,h=d.length;g<h;++g)f=Im(e,a,d[g],Hm(b,c),this.Xh,this)||f;else f=Im(e,a,d,Hm(b,c),this.Xh,this);return f};function Qm(a){this.context=null;Cl.call(this,a);this.tf=a.Lt?Nl.Jj(9):null;this.Vd=!1;this.Uw=wh();this.OE="vector"==a.Un?1:0;J(Kk,"clear",this.kn,this)}F(Qm,Cl);Qm.handles=function(a,b){return"canvas"===a&&"VECTOR_TILE"===b.F()};Qm.create=function(a,b){return new Qm(b)};var Rm={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"]},Sm={image:["Default"],hybrid:["Image","Text","Default"],vector:Ql};l=Qm.prototype;l.Ya=function(){Td(Kk,"clear",this.kn,this);Cl.prototype.Ya.call(this)};
l.rg=function(a,b){var c=this.Kb(),d=c.Xa;this.LC!=d&&(this.Nj.length=0,c=c.Un,this.context||"vector"==c||(this.context=Li()),this.context&&"vector"==c&&(this.context=null));this.LC=d;return Cl.prototype.rg.apply(this,arguments)};
function Tm(a,b,c){var d=a.Kb(),e=c.mb;c=c.Ma.pa;var f=d.Xa,g=d.get(Nm)||null,h=b.qI(d);if(h.St||h.hw!=f||h.MC!=g){for(var k=d.s(),m=k.$b,p=k.Pe(c),t=p.Fa(b.Nb[0]),p=Ml(p,b.ox),u=0,w=b.ck.length;u<w;++u){var x=ll(b,b.ck[u]);if(3!=x.ab()){var z=Ml(m,x.Nb),D=Dg(p,z),H=ug(z,D)?null:ig(D,d.$e*t),G=x.J(),L=!1;qh(c,G)||(L=!0,x.Sr(c));h.St=!1;var N=new Am(0,D,t,e,k.sr,a.tf,d.$e),T=Hm(t,e),D=function(a){var b,c=a.wg;c?b=c.call(a,t):(c=d.wg)&&(b=c(a,t));b&&(a=this.Tn(a,T,b,N),this.Vd=this.Vd||a,h.St=h.St||
a)},U=x.Ca();g&&g!==h.MC&&U.sort(g);for(var K,X=0,ma=U.length;X<ma;++X)K=U[X],L&&("tile-pixels"==G.Uh()&&(G.IE=z,G.co(x.V())),K.j().transform(G,c)),H&&!Eg(H,K.j().V())||D.call(a,K);N.finish();for(var fa in N.hc);x.EQ(d,b.Nb.toString(),N)}}h.hw=f;h.MC=g}}
l.bu=function(a,b,c,d,e,f,g,h,k){var m=a;Tm(this,m,b);if(this.context){var p=b,t=this.Kb(),u=m.qI(t),w=t.Xa,x=Rm[t.Un];if(x&&u.LM!==w){u.LM=w;var z=m.ox,D=z[0],u=p.mb,H=t.s(),G=H.Pe(p.Ma.pa),w=G.Fa(D),L=m.getContext(t),p=Ll(H,D,u,p.Ma.pa);L.canvas.width=p[0];L.canvas.height=p[1];p=Ml(G,z);z=0;for(G=m.ck.length;z<G;++z)if(D=ll(m,m.ck[z]),3!=D.ab()){var H=u/w,N=xh(this.Uw);Dh(N,H,-H);Kh(N,-p[0],-p[3]);D.oA(t,m.Nb.toString()).ke(L,N,0,{},x)}}Cl.prototype.bu.apply(this,arguments)}};
l.yc=function(a,b,c,d,e){var f=b.Ma.ra,g=b.Ma.rotation;c=void 0==c?0:c;var h=this.Kb(),k={},m=this.Nj;b=h.s().Pe(b.Ma.pa);var p,t,u,w,x,z,D;u=0;for(w=m.length;u<w;++u)if(z=m[u],D=z.ox,D=Ml(b,D,this.VD),p=ig(D,c*f,p),lg(p,a)){D=0;for(var H=z.ck.length;D<H;++D)x=ll(z,z.ck[D]),3!=x.ab()&&(x=x.oA(h,z.Nb.toString()),t=t||x.yc(a,f,g,c,{},function(a){var b=I(a).toString();if(!(b in k))return k[b]=!0,d.call(e,a,h)},null))}return t};l.kn=function(){var a=this.Kb();a.getVisible()&&void 0!==this.LC&&a.L()};
l.Xh=function(){el(this)};
l.xr=function(a,b,c){var d=this.Kb(),e=d.Lt?{}:null,f=d.s(),g=d.Un,h=Sm[g],k=b.mb,m=b.Ma.rotation,p=b.size,t,u;m&&(t=Math.round(k*p[0]/2),u=Math.round(k*p[1]/2),Sk(a,-m,t,u));e&&this.tf.clear();for(var k=this.Nj,f=f.Pe(b.Ma.pa),p=[],w=[],x=k.length-1;0<=x;--x){var z=k[x];if(5!=z.ab())for(var D=z.Nb,H=Ml(f,D)[0]-Ml(f,z.ox)[0],G=void 0,L=0,N=z.ck.length;L<N;++L){var T=ll(z,z.ck[L]);if(3!=T.ab()){var U=T.oA(d,D.toString()),K;if(!(K="vector"==g))a:{K=void 0;for(K in U.hc)for(var X=U.hc[K],ma=0,fa=h.length;ma<
fa;++ma)if(h[ma]in X){K=!0;break a}K=!1}if(K){G||(G=this.Th(b,H));T=T.Nb[0];K=Em(U,G);a.save();a.globalAlpha=c.opacity;X=0;for(ma=p.length;X<ma;++X)fa=p[X],T<w[X]&&(a.beginPath(),a.moveTo(K[0],K[1]),a.lineTo(K[2],K[3]),a.lineTo(K[4],K[5]),a.lineTo(K[6],K[7]),a.moveTo(fa[6],fa[7]),a.lineTo(fa[4],fa[5]),a.lineTo(fa[2],fa[3]),a.lineTo(fa[0],fa[1]),a.clip());U.ke(a,G,m,{},h,e);a.restore();p.push(K);w.push(T)}}}}if(e)for(d=e,e=a,g=m,h=Object.keys(d).map(Number).sort($e),k={},f=0,p=h.length;f<p;++f)for(w=
d[h[f].toString()],x=0,z=w.length;x<z;)D=w[x++],H=w[x++],D.ke(e,H,g,k);m&&Sk(a,m,t,u);Cl.prototype.xr.apply(this,arguments)};l.Tn=function(a,b,c,d){if(!c)return!1;var e=!1;if(Array.isArray(c))for(var f=0,g=c.length;f<g;++f)e=Im(d,a,c[f],b,this.Xh,this)||e;else e=Im(d,a,c,b,this.Xh,this);return e};function Um(a){this.uc=a}Um.prototype.s=function(){return this.uc};function Vm(a){this.uc=a}F(Vm,Um);Vm.prototype.F=function(){return 35632};function Wm(a){this.uc=a}F(Wm,Um);Wm.prototype.F=function(){return 35633};var Xm=new Vm("precision mediump float;\nvarying vec2 v_center;\nvarying vec2 v_offset;\nvarying float v_halfWidth;\nvarying float v_pixelRatio;\n\n\n\nuniform float u_opacity;\nuniform vec4 u_fillColor;\nuniform vec4 u_strokeColor;\nuniform vec2 u_size;\n\nvoid main(void) {\n  vec2 windowCenter = vec2((v_center.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\n      (v_center.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\n  vec2 windowOffset = vec2((v_offset.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\n      (v_offset.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\n  float radius = length(windowCenter - windowOffset);\n  float dist = length(windowCenter - gl_FragCoord.xy);\n  if (dist > radius + v_halfWidth) {\n    if (u_strokeColor.a == 0.0) {\n      gl_FragColor = u_fillColor;\n    } else {\n      gl_FragColor = u_strokeColor;\n    }\n    gl_FragColor.a = gl_FragColor.a - (dist - (radius + v_halfWidth));\n  } else if (u_fillColor.a == 0.0) {\n    // Hooray, no fill, just stroke. We can use real antialiasing.\n    gl_FragColor = u_strokeColor;\n    if (dist < radius - v_halfWidth) {\n      gl_FragColor.a = gl_FragColor.a - (radius - v_halfWidth - dist);\n    }\n  } else {\n    gl_FragColor = u_fillColor;\n    float strokeDist = radius - v_halfWidth;\n    float antialias = 2.0 * v_pixelRatio;\n    if (dist > strokeDist) {\n      gl_FragColor = u_strokeColor;\n    } else if (dist >= strokeDist - antialias) {\n      float step = smoothstep(strokeDist - antialias, strokeDist, dist);\n      gl_FragColor = mix(u_fillColor, u_strokeColor, step);\n    }\n  }\n  gl_FragColor.a = gl_FragColor.a * u_opacity;\n  if (gl_FragColor.a <= 0.0) {\n    discard;\n  }\n}\n"),
Ym=new Wm("varying vec2 v_center;\nvarying vec2 v_offset;\nvarying float v_halfWidth;\nvarying float v_pixelRatio;\n\n\nattribute vec2 a_position;\nattribute float a_instruction;\nattribute float a_radius;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_lineWidth;\nuniform float u_pixelRatio;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  v_center = vec4(u_projectionMatrix * vec4(a_position, 0.0, 1.0)).xy;\n  v_pixelRatio = u_pixelRatio;\n  float lineWidth = u_lineWidth * u_pixelRatio;\n  v_halfWidth = lineWidth / 2.0;\n  if (lineWidth == 0.0) {\n    lineWidth = 2.0 * u_pixelRatio;\n  }\n  vec2 offset;\n  // Radius with anitaliasing (roughly).\n  float radius = a_radius + 3.0 * u_pixelRatio;\n  // Until we get gl_VertexID in WebGL, we store an instruction.\n  if (a_instruction == 0.0) {\n    // Offsetting the edges of the triangle by lineWidth / 2 is necessary, however\n    // we should also leave some space for the antialiasing, thus we offset by lineWidth.\n    offset = vec2(-1.0, 1.0);\n  } else if (a_instruction == 1.0) {\n    offset = vec2(-1.0, -1.0);\n  } else if (a_instruction == 2.0) {\n    offset = vec2(1.0, -1.0);\n  } else {\n    offset = vec2(1.0, 1.0);\n  }\n\n  gl_Position = u_projectionMatrix * vec4(a_position + offset * radius, 0.0, 1.0) +\n      offsetMatrix * vec4(offset * lineWidth, 0.0, 0.0);\n  v_offset = vec4(u_projectionMatrix * vec4(a_position.x + a_radius, a_position.y,\n      0.0, 1.0)).xy;\n\n  if (distance(v_center, v_offset) > 20000.0) {\n    gl_Position = vec4(v_center, 0.0, 1.0);\n  }\n}\n\n\n");function Zm(a,b){this.im=a.getUniformLocation(b,"u_projectionMatrix");this.ss=a.getUniformLocation(b,"u_offsetScaleMatrix");this.rs=a.getUniformLocation(b,"u_offsetRotateMatrix");this.ax=a.getUniformLocation(b,"u_lineWidth");this.bx=a.getUniformLocation(b,"u_pixelRatio");this.hm=a.getUniformLocation(b,"u_opacity");this.HO=a.getUniformLocation(b,"u_fillColor");this.JO=a.getUniformLocation(b,"u_strokeColor");this.cx=a.getUniformLocation(b,"u_size");this.xc=a.getAttribLocation(b,"a_position");this.ct=
a.getAttribLocation(b,"a_instruction");this.it=a.getAttribLocation(b,"a_radius")};function $m(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function an(a,b){a[0]=b[0];a[1]=b[1];a[4]=b[2];a[5]=b[3];a[12]=b[4];a[13]=b[5];return a};function bn(a,b){this.YD=a;this.$q=b;this.origin=Bg(b);this.lM=wh();this.BL=wh();this.CL=wh();this.em=$m();this.M=[];this.fg=null;this.Ba=[];this.ld=[];this.ba=[];this.Bg=null;this.be=void 0}F(bn,bl);
bn.prototype.ke=function(a,b,c,d,e,f,g,h,k,m,p){var t=a.Sb,u,w,x,z,D,H,G,L;this.be&&(u=t.isEnabled(t.STENCIL_TEST),w=t.getParameter(t.STENCIL_FUNC),x=t.getParameter(t.STENCIL_VALUE_MASK),z=t.getParameter(t.STENCIL_REF),D=t.getParameter(t.STENCIL_WRITEMASK),H=t.getParameter(t.STENCIL_FAIL),G=t.getParameter(t.STENCIL_PASS_DEPTH_PASS),L=t.getParameter(t.STENCIL_PASS_DEPTH_FAIL),t.enable(t.STENCIL_TEST),t.clear(t.STENCIL_BUFFER_BIT),t.stencilMask(255),t.stencilFunc(t.ALWAYS,1,255),t.stencilOp(t.KEEP,
t.KEEP,t.REPLACE),this.be.ke(a,b,c,d,e,f,g,h,k,m,p),t.stencilMask(0),t.stencilFunc(t.NOTEQUAL,1,255));a.bindBuffer(34962,this.Bg);a.bindBuffer(34963,this.fg);f=this.Ur(t,a,e,f);var N=xh(this.lM);Dh(N,2/(c*e[0]),2/(c*e[1]));Ch(N,-d);Kh(N,-(b[0]-this.origin[0]),-(b[1]-this.origin[1]));b=xh(this.CL);Dh(b,2/e[0],2/e[1]);e=xh(this.BL);0!==d&&Ch(e,-d);t.uniformMatrix4fv(f.im,!1,an(this.em,N));t.uniformMatrix4fv(f.ss,!1,an(this.em,b));t.uniformMatrix4fv(f.rs,!1,an(this.em,e));t.uniform1f(f.hm,g);var T;void 0===
k?this.Im(t,a,h,!1):(m?a=this.Ep(t,a,h,k,p):(t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.Im(t,a,h,!0),a=(a=k(null))?a:void 0),T=a);this.Xr(t,f);this.be&&(u||t.disable(t.STENCIL_TEST),t.clear(t.STENCIL_BUFFER_BIT),t.stencilFunc(w,z,x),t.stencilMask(D),t.stencilOp(H,L,G));return T};bn.prototype.drawElements=function(a,b,c,d){a.drawElements(4,d-c,b.qq?5125:5123,c*(b.qq?4:2))};var cn=[0,0,0,1],dn=[],en=[0,0,0,1];function fn(a,b,c,d,e,f){a=(c-a)*(f-b)-(e-a)*(d-b);return a<=gn&&a>=-gn?void 0:0<a}var gn=Number.EPSILON||2.220446049250313E-16;function hn(a,b){this.JF=void 0!==a?a:[];this.VO=void 0!==b?b:jn}hn.prototype.P=function(){return this.JF};var jn=35044;function kn(a,b){bn.call(this,a,b);this.oc=null;this.jc=[];this.Fb=[];this.Pa=0;this.fa={fillColor:null,strokeColor:null,sb:null,lineDashOffset:void 0,lineWidth:void 0,L:!1}}F(kn,bn);l=kn.prototype;
l.Le=function(a,b,c,d){for(var e=this.ba.length,f=this.M.length,g=e/4;b<c;b+=d)this.ba[e++]=a[b],this.ba[e++]=a[b+1],this.ba[e++]=0,this.ba[e++]=this.Pa,this.ba[e++]=a[b],this.ba[e++]=a[b+1],this.ba[e++]=1,this.ba[e++]=this.Pa,this.ba[e++]=a[b],this.ba[e++]=a[b+1],this.ba[e++]=2,this.ba[e++]=this.Pa,this.ba[e++]=a[b],this.ba[e++]=a[b+1],this.ba[e++]=3,this.ba[e++]=this.Pa,this.M[f++]=g,this.M[f++]=g+1,this.M[f++]=g+2,this.M[f++]=g+2,this.M[f++]=g+3,this.M[f++]=g,g+=4};
l.Gm=function(a,b){var c=a.yf(),d=a.S;c?(this.Ba.push(this.M.length),this.ld.push(b),this.fa.L&&(this.Fb.push(this.M.length),this.fa.L=!1),this.Pa=c,a=a.l,a=Lg(a,0,2,d,-this.origin[0],-this.origin[1]),this.Le(a,0,2,d)):this.fa.L&&(this.jc.pop(),this.jc.length&&(d=this.jc[this.jc.length-1],this.fa.fillColor=d[0],this.fa.strokeColor=d[1],this.fa.lineWidth=d[2],this.fa.L=!1))};
l.finish=function(){this.Bg=new hn(this.ba);this.fg=new hn(this.M);this.Ba.push(this.M.length);0===this.Fb.length&&0<this.jc.length&&(this.jc=[]);this.M=this.ba=null};l.Rh=function(a){var b=this.Bg,c=this.fg;return function(){a.deleteBuffer(b);a.deleteBuffer(c)}};
l.Ur=function(a,b,c,d){var e=ln(b,Xm,Ym),f;this.oc?f=this.oc:this.oc=f=new Zm(a,e);b.useProgram(e);a.enableVertexAttribArray(f.xc);a.vertexAttribPointer(f.xc,2,5126,!1,16,0);a.enableVertexAttribArray(f.ct);a.vertexAttribPointer(f.ct,1,5126,!1,16,8);a.enableVertexAttribArray(f.it);a.vertexAttribPointer(f.it,1,5126,!1,16,12);a.uniform2fv(f.cx,c);a.uniform1f(f.bx,d);return f};l.Xr=function(a,b){a.disableVertexAttribArray(b.xc);a.disableVertexAttribArray(b.ct);a.disableVertexAttribArray(b.it)};
l.Im=function(a,b,c){if(Jd(c)){var d,e,f;e=this.Ba[this.Ba.length-1];for(c=this.Fb.length-1;0<=c;--c)d=this.Fb[c],f=this.jc[c],this.Qj(a,f[0]),this.ug(a,f[1],f[2]),this.drawElements(a,b,d,e),e=d}else this.Jm(a,b,c)};
l.Ep=function(a,b,c,d,e){var f,g,h,k,m,p,t;t=this.Ba.length-2;h=this.Ba[t+1];for(f=this.Fb.length-1;0<=f;--f)for(g=this.jc[f],this.Qj(a,g[0]),this.ug(a,g[1],g[2]),k=this.Fb[f];0<=t&&this.Ba[t]>=k;){g=this.Ba[t];m=this.ld[t];p=I(m).toString();if(void 0===c[p]&&m.j()&&(void 0===e||Eg(e,m.j().V()))&&(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),this.drawElements(a,b,g,h),h=d(m)))return h;t--;h=g}};
l.Jm=function(a,b,c){var d,e,f,g,h,k,m;k=this.Ba.length-2;f=e=this.Ba[k+1];for(d=this.Fb.length-1;0<=d;--d){g=this.jc[d];this.Qj(a,g[0]);this.ug(a,g[1],g[2]);for(g=this.Fb[d];0<=k&&this.Ba[k]>=g;)m=this.Ba[k],h=this.ld[k],h=I(h).toString(),c[h]&&(e!==f&&this.drawElements(a,b,e,f),f=m),k--,e=m;e!==f&&this.drawElements(a,b,e,f);e=f=g}};l.Qj=function(a,b){a.uniform4fv(this.oc.HO,b)};l.ug=function(a,b,c){a.uniform4fv(this.oc.JO,b);a.uniform1f(this.oc.ax,c)};
l.df=function(a,b){var c;b?(c=b.getLineDash(),this.fa.sb=c?c:dn,c=b.fh,this.fa.lineDashOffset=c?c:0,c=b.sa,c=c instanceof CanvasGradient||c instanceof CanvasPattern?en:Xk(c).map(function(a,b){return 3!=b?a/255:a})||en,b=b.Qc(),b=void 0!==b?b:1):(c=[0,0,0,0],b=0);a=a?a.sa:[0,0,0,0];a=a instanceof CanvasGradient||a instanceof CanvasPattern?cn:Xk(a).map(function(a,b){return 3!=b?a/255:a})||cn;this.fa.strokeColor&&df(this.fa.strokeColor,c)&&this.fa.fillColor&&df(this.fa.fillColor,a)&&this.fa.lineWidth===
b||(this.fa.L=!0,this.fa.fillColor=a,this.fa.strokeColor=c,this.fa.lineWidth=b,this.jc.push([a,c,b]))};var mn=new Vm("precision mediump float;\nvarying vec2 v_texCoord;\nvarying float v_opacity;\n\nuniform float u_opacity;\nuniform sampler2D u_image;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_image, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  float alpha = texColor.a * v_opacity * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n"),nn=new Wm("varying vec2 v_texCoord;\nvarying float v_opacity;\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nattribute vec2 a_offsets;\nattribute float a_opacity;\nattribute float a_rotateWithView;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix;\n  if (a_rotateWithView == 1.0) {\n    offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  }\n  vec4 offsets = offsetMatrix * vec4(a_offsets, 0.0, 0.0);\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n  v_texCoord = a_texCoord;\n  v_opacity = a_opacity;\n}\n\n\n");function on(a,b){this.im=a.getUniformLocation(b,"u_projectionMatrix");this.ss=a.getUniformLocation(b,"u_offsetScaleMatrix");this.rs=a.getUniformLocation(b,"u_offsetRotateMatrix");this.hm=a.getUniformLocation(b,"u_opacity");this.xc=a.getAttribLocation(b,"a_position");this.Gg=a.getAttribLocation(b,"a_texCoord");this.gt=a.getAttribLocation(b,"a_offsets");this.ht=a.getAttribLocation(b,"a_opacity");this.jt=a.getAttribLocation(b,"a_rotateWithView")};function pn(a,b){this.qa=a;this.Sb=b;this.Hh={};this.Tl={};this.Cl={};this.Uu=this.Vu=this.mn=this.Kt=null;(this.qq=0<=Cd.indexOf("OES_element_index_uint"))&&b.getExtension("OES_element_index_uint");J(this.qa,"webglcontextlost",this.uj,this);J(this.qa,"webglcontextrestored",this.Qu,this)}F(pn,Vd);l=pn.prototype;
l.bindBuffer=function(a,b){var c=this.Sb,d=b.P(),e=String(I(b));if(e in this.Hh)c.bindBuffer(a,this.Hh[e].buffer);else{var f=c.createBuffer();c.bindBuffer(a,f);var g;34962==a?g=new Float32Array(d):34963==a&&(g=this.qq?new Uint32Array(d):new Uint16Array(d));c.bufferData(a,g,b.VO);this.Hh[e]={PP:b,buffer:f}}};l.deleteBuffer=function(a){var b=this.Sb;a=String(I(a));var c=this.Hh[a];b.isContextLost()||b.deleteBuffer(c.buffer);delete this.Hh[a]};
l.Ya=function(){Ud(this.qa);var a=this.Sb;if(!a.isContextLost()){for(var b in this.Hh)a.deleteBuffer(this.Hh[b].buffer);for(b in this.Cl)a.deleteProgram(this.Cl[b]);for(b in this.Tl)a.deleteShader(this.Tl[b]);a.deleteFramebuffer(this.mn);a.deleteRenderbuffer(this.Uu);a.deleteTexture(this.Vu)}};
function qn(a){if(!a.mn){var b=a.Sb,c=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,c);var d=rn(b,1,1),e=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,e);b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,1,1);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,d,0);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,e);b.bindTexture(b.TEXTURE_2D,null);b.bindRenderbuffer(b.RENDERBUFFER,null);b.bindFramebuffer(b.FRAMEBUFFER,null);a.mn=
c;a.Vu=d;a.Uu=e}return a.mn}function sn(a,b){var c=String(I(b));if(c in a.Tl)return a.Tl[c];var d=a.Sb,e=d.createShader(b.F());d.shaderSource(e,b.s());d.compileShader(e);return a.Tl[c]=e}function ln(a,b,c){var d=I(b)+"/"+I(c);if(d in a.Cl)return a.Cl[d];var e=a.Sb,f=e.createProgram();e.attachShader(f,sn(a,b));e.attachShader(f,sn(a,c));e.linkProgram(f);return a.Cl[d]=f}l.uj=function(){Hd(this.Hh);Hd(this.Tl);Hd(this.Cl);this.Uu=this.Vu=this.mn=this.Kt=null};l.Qu=function(){};
l.useProgram=function(a){if(a==this.Kt)return!1;this.Sb.useProgram(a);this.Kt=a;return!0};function tn(a,b,c){var d=a.createTexture();a.bindTexture(a.TEXTURE_2D,d);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);void 0!==b&&a.texParameteri(3553,10242,b);void 0!==c&&a.texParameteri(3553,10243,c);return d}function rn(a,b,c){var d=tn(a,void 0,void 0);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null);return d}
function un(a,b){var c=tn(a,33071,33071);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b);return c};function vn(a,b){bn.call(this,a,b);this.Yo=this.Wo=void 0;this.Wk=[];this.bl=[];this.imageWidth=this.imageHeight=this.height=void 0;this.Nt=null;this.width=this.scale=this.rotation=this.Zc=this.rr=this.qr=this.opacity=void 0}F(vn,bn);l=vn.prototype;l.Rh=function(a){var b=this.Bg,c=this.fg,d=this.Gu(!0),e=a.Sb;return function(){if(!e.isContextLost()){var f,g;f=0;for(g=d.length;f<g;++f)e.deleteTexture(d[f])}a.deleteBuffer(b);a.deleteBuffer(c)}};
function wn(a,b,c,d){var e=a.Wo,f=a.Yo,g=a.height,h=a.imageHeight,k=a.imageWidth,m=a.opacity,p=a.qr,t=a.rr,u=a.Zc?1:0,w=-a.rotation,x=a.scale,z=a.width,D=Math.cos(w),w=Math.sin(w),H=a.M.length,G=a.ba.length,L,N,T,U,K,X;for(L=0;L<c;L+=d)K=b[L]-a.origin[0],X=b[L+1]-a.origin[1],N=G/8,T=-x*e,U=-x*(g-f),a.ba[G++]=K,a.ba[G++]=X,a.ba[G++]=T*D-U*w,a.ba[G++]=T*w+U*D,a.ba[G++]=p/k,a.ba[G++]=(t+g)/h,a.ba[G++]=m,a.ba[G++]=u,T=x*(z-e),U=-x*(g-f),a.ba[G++]=K,a.ba[G++]=X,a.ba[G++]=T*D-U*w,a.ba[G++]=T*w+U*D,a.ba[G++]=
(p+z)/k,a.ba[G++]=(t+g)/h,a.ba[G++]=m,a.ba[G++]=u,T=x*(z-e),U=x*f,a.ba[G++]=K,a.ba[G++]=X,a.ba[G++]=T*D-U*w,a.ba[G++]=T*w+U*D,a.ba[G++]=(p+z)/k,a.ba[G++]=t/h,a.ba[G++]=m,a.ba[G++]=u,T=-x*e,U=x*f,a.ba[G++]=K,a.ba[G++]=X,a.ba[G++]=T*D-U*w,a.ba[G++]=T*w+U*D,a.ba[G++]=p/k,a.ba[G++]=t/h,a.ba[G++]=m,a.ba[G++]=u,a.M[H++]=N,a.M[H++]=N+1,a.M[H++]=N+2,a.M[H++]=N,a.M[H++]=N+2,a.M[H++]=N+3}
function xn(a,b,c,d){var e,f,g,h=b.length;for(g=0;g<h;++g)e=b[g],f=I(e).toString(),f in c?e=c[f]:(e=un(d,e),c[f]=e),a[g]=e}
l.Ur=function(a,b){var c=ln(b,mn,nn),d;this.Nt?d=this.Nt:this.Nt=d=new on(a,c);b.useProgram(c);a.enableVertexAttribArray(d.xc);a.vertexAttribPointer(d.xc,2,5126,!1,32,0);a.enableVertexAttribArray(d.gt);a.vertexAttribPointer(d.gt,2,5126,!1,32,8);a.enableVertexAttribArray(d.Gg);a.vertexAttribPointer(d.Gg,2,5126,!1,32,16);a.enableVertexAttribArray(d.ht);a.vertexAttribPointer(d.ht,1,5126,!1,32,24);a.enableVertexAttribArray(d.jt);a.vertexAttribPointer(d.jt,1,5126,!1,32,28);return d};
l.Xr=function(a,b){a.disableVertexAttribArray(b.xc);a.disableVertexAttribArray(b.gt);a.disableVertexAttribArray(b.Gg);a.disableVertexAttribArray(b.ht);a.disableVertexAttribArray(b.jt)};
l.Im=function(a,b,c,d){var e=d?this.su():this.Gu();d=d?this.bl:this.Wk;if(Jd(c)){var f,g;c=0;f=e.length;for(g=0;c<f;++c){a.bindTexture(3553,e[c]);var h=d[c];this.drawElements(a,b,g,h);g=h}}else for(g=f=0,h=e.length;g<h;++g){a.bindTexture(3553,e[g]);for(var k=0<g?d[g-1]:0,m=d[g],p=k;f<this.Ba.length&&this.Ba[f]<=m;){var t=I(this.ld[f]).toString();void 0!==c[t]?(p!==k&&this.drawElements(a,b,p,k),k=p=f===this.Ba.length-1?m:this.Ba[f+1]):k=f===this.Ba.length-1?m:this.Ba[f+1];f++}p!==k&&this.drawElements(a,
b,p,k)}};l.Ep=function(a,b,c,d,e){var f,g,h,k,m,p,t=this.Ba.length-1,u=this.su();for(f=u.length-1;0<=f;--f)for(a.bindTexture(3553,u[f]),g=0<f?this.bl[f-1]:0,k=this.bl[f];0<=t&&this.Ba[t]>=g;){h=this.Ba[t];m=this.ld[t];p=I(m).toString();if(void 0===c[p]&&m.j()&&(void 0===e||Eg(e,m.j().V()))&&(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),this.drawElements(a,b,h,k),k=d(m)))return k;k=h;t--}};
l.finish=function(){this.imageWidth=this.imageHeight=this.height=this.Yo=this.Wo=void 0;this.M=null;this.scale=this.rotation=this.Zc=this.rr=this.qr=this.opacity=void 0;this.ba=null;this.width=void 0};function yn(a,b){vn.call(this,a,b);this.Cd=[];this.xj=[];this.$j=[];this.Wu=[]}F(yn,vn);l=yn.prototype;l.Zt=function(a,b){this.Ba.push(this.M.length);this.ld.push(b);b=a.l;wn(this,b,b.length,a.S)};l.Nh=function(a,b){this.Ba.push(this.M.length);this.ld.push(b);b=a.l;wn(this,b,b.length,a.S)};
l.finish=function(a){var b=a.Sb;this.Wk.push(this.M.length);this.bl.push(this.M.length);this.Bg=new hn(this.ba);this.fg=new hn(this.M);var c={};xn(this.$j,this.Cd,c,b);xn(this.Wu,this.xj,c,b);this.xj=this.Cd=null;vn.prototype.finish.call(this,a)};
l.Rr=function(a){var b=a.Um(),c=a.na(1),d=a.$p(),e=a.Ym(1),f=a.Vg(),g=a.ag(),h=a.Ld,k=a.Cb(),m=a.$a();a=a.Za();var p;0===this.Cd.length?this.Cd.push(c):(p=this.Cd[this.Cd.length-1],I(p)!=I(c)&&(this.Wk.push(this.M.length),this.Cd.push(c)));0===this.xj.length?this.xj.push(e):(p=this.xj[this.xj.length-1],I(p)!=I(e)&&(this.bl.push(this.M.length),this.xj.push(e)));this.Wo=b[0];this.Yo=b[1];this.height=m[1];this.imageHeight=d[1];this.imageWidth=d[0];this.opacity=f;this.qr=g[0];this.rr=g[1];this.rotation=
k;this.Zc=h;this.scale=a;this.width=m[0]};l.Gu=function(a){return a?this.$j.concat(this.Wu):this.$j};l.su=function(){return this.Wu};function zn(a,b,c,d){var e=c-d;return a[b]===a[e]&&a[b+1]===a[e+1]&&3<(c-b)/d?!!Th(a,b,c,d):!1};var An=new Vm("precision mediump float;\nvarying float v_round;\nvarying vec2 v_roundVertex;\nvarying float v_halfWidth;\n\n\n\nuniform float u_opacity;\nuniform vec4 u_color;\nuniform vec2 u_size;\nuniform float u_pixelRatio;\n\nvoid main(void) {\n  if (v_round > 0.0) {\n    vec2 windowCoords = vec2((v_roundVertex.x + 1.0) / 2.0 * u_size.x * u_pixelRatio,\n        (v_roundVertex.y + 1.0) / 2.0 * u_size.y * u_pixelRatio);\n    if (length(windowCoords - gl_FragCoord.xy) > v_halfWidth * u_pixelRatio) {\n      discard;\n    }\n  }\n  gl_FragColor = u_color;\n  float alpha = u_color.a * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n"),
Bn=new Wm("varying float v_round;\nvarying vec2 v_roundVertex;\nvarying float v_halfWidth;\n\n\nattribute vec2 a_lastPos;\nattribute vec2 a_position;\nattribute vec2 a_nextPos;\nattribute float a_direction;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_lineWidth;\nuniform float u_miterLimit;\n\nbool nearlyEquals(in float value, in float ref) {\n  float epsilon = 0.000000000001;\n  return value >= ref - epsilon && value <= ref + epsilon;\n}\n\nvoid alongNormal(out vec2 offset, in vec2 nextP, in float turnDir, in float direction) {\n  vec2 dirVect = nextP - a_position;\n  vec2 normal = normalize(vec2(-turnDir * dirVect.y, turnDir * dirVect.x));\n  offset = u_lineWidth / 2.0 * normal * direction;\n}\n\nvoid miterUp(out vec2 offset, out float round, in bool isRound, in float direction) {\n  float halfWidth = u_lineWidth / 2.0;\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 dirVect = a_nextPos - a_position;\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\n  float miterLength = abs(halfWidth / dot(normal, tmpNormal));\n  offset = normal * direction * miterLength;\n  round = 0.0;\n  if (isRound) {\n    round = 1.0;\n  } else if (miterLength > u_miterLimit + u_lineWidth) {\n    offset = halfWidth * tmpNormal * direction;\n  }\n}\n\nbool miterDown(out vec2 offset, in vec4 projPos, in mat4 offsetMatrix, in float direction) {\n  bool degenerate = false;\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 dirVect = a_lastPos - a_position;\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\n  vec2 longOffset, shortOffset, longVertex;\n  vec4 shortProjVertex;\n  float halfWidth = u_lineWidth / 2.0;\n  if (length(a_nextPos - a_position) > length(a_lastPos - a_position)) {\n    longOffset = tmpNormal * direction * halfWidth;\n    shortOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\n    longVertex = a_nextPos;\n    shortProjVertex = u_projectionMatrix * vec4(a_lastPos, 0.0, 1.0);\n  } else {\n    shortOffset = tmpNormal * direction * halfWidth;\n    longOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\n    longVertex = a_lastPos;\n    shortProjVertex = u_projectionMatrix * vec4(a_nextPos, 0.0, 1.0);\n  }\n  //Intersection algorithm based on theory by Paul Bourke (http://paulbourke.net/geometry/pointlineplane/).\n  vec4 p1 = u_projectionMatrix * vec4(longVertex, 0.0, 1.0) + offsetMatrix * vec4(longOffset, 0.0, 0.0);\n  vec4 p2 = projPos + offsetMatrix * vec4(longOffset, 0.0, 0.0);\n  vec4 p3 = shortProjVertex + offsetMatrix * vec4(-shortOffset, 0.0, 0.0);\n  vec4 p4 = shortProjVertex + offsetMatrix * vec4(shortOffset, 0.0, 0.0);\n  float denom = (p4.y - p3.y) * (p2.x - p1.x) - (p4.x - p3.x) * (p2.y - p1.y);\n  float firstU = ((p4.x - p3.x) * (p1.y - p3.y) - (p4.y - p3.y) * (p1.x - p3.x)) / denom;\n  float secondU = ((p2.x - p1.x) * (p1.y - p3.y) - (p2.y - p1.y) * (p1.x - p3.x)) / denom;\n  float epsilon = 0.000000000001;\n  if (firstU > epsilon && firstU < 1.0 - epsilon && secondU > epsilon && secondU < 1.0 - epsilon) {\n    shortProjVertex.x = p1.x + firstU * (p2.x - p1.x);\n    shortProjVertex.y = p1.y + firstU * (p2.y - p1.y);\n    offset = shortProjVertex.xy;\n    degenerate = true;\n  } else {\n    float miterLength = abs(halfWidth / dot(normal, tmpNormal));\n    offset = normal * direction * miterLength;\n  }\n  return degenerate;\n}\n\nvoid squareCap(out vec2 offset, out float round, in bool isRound, in vec2 nextP,\n    in float turnDir, in float direction) {\n  round = 0.0;\n  vec2 dirVect = a_position - nextP;\n  vec2 firstNormal = normalize(dirVect);\n  vec2 secondNormal = vec2(turnDir * firstNormal.y * direction, -turnDir * firstNormal.x * direction);\n  vec2 hypotenuse = normalize(firstNormal - secondNormal);\n  vec2 normal = vec2(turnDir * hypotenuse.y * direction, -turnDir * hypotenuse.x * direction);\n  float length = sqrt(v_halfWidth * v_halfWidth * 2.0);\n  offset = normal * length;\n  if (isRound) {\n    round = 1.0;\n  }\n}\n\nvoid main(void) {\n  bool degenerate = false;\n  float direction = float(sign(a_direction));\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  vec2 offset;\n  vec4 projPos = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n  bool round = nearlyEquals(mod(a_direction, 2.0), 0.0);\n\n  v_round = 0.0;\n  v_halfWidth = u_lineWidth / 2.0;\n  v_roundVertex = projPos.xy;\n\n  if (nearlyEquals(mod(a_direction, 3.0), 0.0) || nearlyEquals(mod(a_direction, 17.0), 0.0)) {\n    alongNormal(offset, a_nextPos, 1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 5.0), 0.0) || nearlyEquals(mod(a_direction, 13.0), 0.0)) {\n    alongNormal(offset, a_lastPos, -1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 23.0), 0.0)) {\n    miterUp(offset, v_round, round, direction);\n  } else if (nearlyEquals(mod(a_direction, 19.0), 0.0)) {\n    degenerate = miterDown(offset, projPos, offsetMatrix, direction);\n  } else if (nearlyEquals(mod(a_direction, 7.0), 0.0)) {\n    squareCap(offset, v_round, round, a_nextPos, 1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 11.0), 0.0)) {\n    squareCap(offset, v_round, round, a_lastPos, -1.0, direction);\n  }\n  if (!degenerate) {\n    vec4 offsets = offsetMatrix * vec4(offset, 0.0, 0.0);\n    gl_Position = projPos + offsets;\n  } else {\n    gl_Position = vec4(offset, 0.0, 1.0);\n  }\n}\n\n\n");function Cn(a,b){this.im=a.getUniformLocation(b,"u_projectionMatrix");this.ss=a.getUniformLocation(b,"u_offsetScaleMatrix");this.rs=a.getUniformLocation(b,"u_offsetRotateMatrix");this.ax=a.getUniformLocation(b,"u_lineWidth");this.IO=a.getUniformLocation(b,"u_miterLimit");this.hm=a.getUniformLocation(b,"u_opacity");this.$w=a.getUniformLocation(b,"u_color");this.cx=a.getUniformLocation(b,"u_size");this.bx=a.getUniformLocation(b,"u_pixelRatio");this.dt=a.getAttribLocation(b,"a_lastPos");this.xc=a.getAttribLocation(b,
"a_position");this.et=a.getAttribLocation(b,"a_nextPos");this.bt=a.getAttribLocation(b,"a_direction")};function Dn(a,b){bn.call(this,a,b);this.oc=null;this.jc=[];this.Fb=[];this.fa={strokeColor:null,lineCap:void 0,sb:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:void 0,miterLimit:void 0,L:!1}}F(Dn,bn);l=Dn.prototype;
l.Le=function(a,b,c,d){var e,f=this.ba.length,g=this.M.length,h="bevel"===this.fa.lineJoin?0:"miter"===this.fa.lineJoin?1:2,k="butt"===this.fa.lineCap?0:"square"===this.fa.lineCap?1:2,m=zn(a,b,c,d),p,t,u,w=g,x=1,z,D,H;for(e=b;e<c;e+=d){u=f/7;z=D;D=H||[a[e],a[e+1]];if(e===b){H=[a[e+d],a[e+d+1]];if(c-b===2*d&&df(D,H))break;if(m)z=[a[c-2*d],a[c-2*d+1]],p=H;else{k&&(f=En(this,[0,0],D,H,x*Fn*k,f),f=En(this,[0,0],D,H,-x*Fn*k,f),this.M[g++]=u+2,this.M[g++]=u,this.M[g++]=u+1,this.M[g++]=u+1,this.M[g++]=u+
3,this.M[g++]=u+2);f=En(this,[0,0],D,H,x*Gn*(k||1),f);f=En(this,[0,0],D,H,-x*Gn*(k||1),f);w=f/7-1;continue}}else if(e===c-d){m?H=p:(z=z||[0,0],f=En(this,z,D,[0,0],x*Hn*(k||1),f),f=En(this,z,D,[0,0],-x*Hn*(k||1),f),this.M[g++]=u,this.M[g++]=w-1,this.M[g++]=w,this.M[g++]=w,this.M[g++]=u+1,this.M[g++]=u,k&&(f=En(this,z,D,[0,0],x*In*k,f),f=En(this,z,D,[0,0],-x*In*k,f),this.M[g++]=u+2,this.M[g++]=u,this.M[g++]=u+1,this.M[g++]=u+1,this.M[g++]=u+3,this.M[g++]=u+2));break}else H=[a[e+d],a[e+d+1]];t=fn(z[0],
z[1],D[0],D[1],H[0],H[1])?-1:1;f=En(this,z,D,H,t*Jn*(h||1),f);f=En(this,z,D,H,t*Kn*(h||1),f);f=En(this,z,D,H,-t*Ln*(h||1),f);e>b&&(this.M[g++]=u,this.M[g++]=w-1,this.M[g++]=w,this.M[g++]=u+2,this.M[g++]=u,this.M[g++]=0<x*t?w:w-1);this.M[g++]=u;this.M[g++]=u+2;this.M[g++]=u+1;w=u+2;x=t;h&&(f=En(this,z,D,H,t*Mn*h,f),this.M[g++]=u+1,this.M[g++]=u+3,this.M[g++]=u)}m&&(u=u||f/7,t=mi([z[0],z[1],D[0],D[1],H[0],H[1]],0,6,2)?1:-1,f=En(this,z,D,H,t*Jn*(h||1),f),En(this,z,D,H,-t*Ln*(h||1),f),this.M[g++]=u,this.M[g++]=
w-1,this.M[g++]=w,this.M[g++]=u+1,this.M[g++]=u,this.M[g++]=0<x*t?w:w-1)};function En(a,b,c,d,e,f){a.ba[f++]=b[0];a.ba[f++]=b[1];a.ba[f++]=c[0];a.ba[f++]=c[1];a.ba[f++]=d[0];a.ba[f++]=d[1];a.ba[f++]=e;return f}function Nn(a,b,c,d){c-=b;return c<2*d?!1:c===2*d?!df([a[b],a[b+1]],[a[b+d],a[b+d+1]]):!0}
l.Xt=function(a,b){var c=a.l;a=a.S;Nn(c,0,c.length,a)&&(c=Lg(c,0,c.length,a,-this.origin[0],-this.origin[1]),this.fa.L&&(this.Fb.push(this.M.length),this.fa.L=!1),this.Ba.push(this.M.length),this.ld.push(b),this.Le(c,0,c.length,a))};
l.Yt=function(a,b){var c=this.M.length,d=a.Qa;d.unshift(0);var e=a.l;a=a.S;var f,g;if(1<d.length)for(f=1,g=d.length;f<g;++f)if(Nn(e,d[f-1],d[f],a)){var h=Lg(e,d[f-1],d[f],a,-this.origin[0],-this.origin[1]);this.Le(h,0,h.length,a)}this.M.length>c&&(this.Ba.push(c),this.ld.push(b),this.fa.L&&(this.Fb.push(c),this.fa.L=!1))};
function On(a,b,c,d){zn(b,0,b.length,d)||(b.push(b[0]),b.push(b[1]));a.Le(b,0,b.length,d);if(c.length){var e;b=0;for(e=c.length;b<e;++b)zn(c[b],0,c[b].length,d)||(c[b].push(c[b][0]),c[b].push(c[b][1])),a.Le(c[b],0,c[b].length,d)}}function Pn(a,b,c){c=void 0===c?a.M.length:c;a.Ba.push(c);a.ld.push(b);a.fa.L&&(a.Fb.push(c),a.fa.L=!1)}l.finish=function(){this.Bg=new hn(this.ba);this.fg=new hn(this.M);this.Ba.push(this.M.length);0===this.Fb.length&&0<this.jc.length&&(this.jc=[]);this.M=this.ba=null};
l.Rh=function(a){var b=this.Bg,c=this.fg;return function(){a.deleteBuffer(b);a.deleteBuffer(c)}};
l.Ur=function(a,b,c,d){var e=ln(b,An,Bn),f;this.oc?f=this.oc:this.oc=f=new Cn(a,e);b.useProgram(e);a.enableVertexAttribArray(f.dt);a.vertexAttribPointer(f.dt,2,5126,!1,28,0);a.enableVertexAttribArray(f.xc);a.vertexAttribPointer(f.xc,2,5126,!1,28,8);a.enableVertexAttribArray(f.et);a.vertexAttribPointer(f.et,2,5126,!1,28,16);a.enableVertexAttribArray(f.bt);a.vertexAttribPointer(f.bt,1,5126,!1,28,24);a.uniform2fv(f.cx,c);a.uniform1f(f.bx,d);return f};
l.Xr=function(a,b){a.disableVertexAttribArray(b.dt);a.disableVertexAttribArray(b.xc);a.disableVertexAttribArray(b.et);a.disableVertexAttribArray(b.bt)};
l.Im=function(a,b,c,d){var e=a.getParameter(a.DEPTH_FUNC),f=a.getParameter(a.DEPTH_WRITEMASK);d||(a.enable(a.DEPTH_TEST),a.depthMask(!0),a.depthFunc(a.NOTEQUAL));if(Jd(c)){var g,h,k;h=this.Ba[this.Ba.length-1];for(c=this.Fb.length-1;0<=c;--c)g=this.Fb[c],k=this.jc[c],this.ug(a,k[0],k[1],k[2]),this.drawElements(a,b,g,h),a.clear(a.DEPTH_BUFFER_BIT),h=g}else this.Jm(a,b,c);d||(a.disable(a.DEPTH_TEST),a.clear(a.DEPTH_BUFFER_BIT),a.depthMask(f),a.depthFunc(e))};
l.Jm=function(a,b,c){var d,e,f,g,h,k,m;k=this.Ba.length-2;f=e=this.Ba[k+1];for(d=this.Fb.length-1;0<=d;--d){g=this.jc[d];this.ug(a,g[0],g[1],g[2]);for(g=this.Fb[d];0<=k&&this.Ba[k]>=g;)m=this.Ba[k],h=this.ld[k],h=I(h).toString(),c[h]&&(e!==f&&(this.drawElements(a,b,e,f),a.clear(a.DEPTH_BUFFER_BIT)),f=m),k--,e=m;e!==f&&(this.drawElements(a,b,e,f),a.clear(a.DEPTH_BUFFER_BIT));e=f=g}};
l.Ep=function(a,b,c,d,e){var f,g,h,k,m,p,t;t=this.Ba.length-2;h=this.Ba[t+1];for(f=this.Fb.length-1;0<=f;--f)for(g=this.jc[f],this.ug(a,g[0],g[1],g[2]),k=this.Fb[f];0<=t&&this.Ba[t]>=k;){g=this.Ba[t];m=this.ld[t];p=I(m).toString();if(void 0===c[p]&&m.j()&&(void 0===e||Eg(e,m.j().V()))&&(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),this.drawElements(a,b,g,h),h=d(m)))return h;t--;h=g}};l.ug=function(a,b,c,d){a.uniform4fv(this.oc.$w,b);a.uniform1f(this.oc.ax,c);a.uniform1f(this.oc.IO,d)};
l.df=function(a,b){a=b.di;this.fa.lineCap=void 0!==a?a:"round";a=b.getLineDash();this.fa.sb=a?a:dn;a=b.fh;this.fa.lineDashOffset=a?a:0;a=b.ei;this.fa.lineJoin=void 0!==a?a:"round";a=b.sa;a=a instanceof CanvasGradient||a instanceof CanvasPattern?en:Xk(a).map(function(a,b){return 3!=b?a/255:a})||en;var c=b.Qc(),c=void 0!==c?c:1;b=b.ii;b=void 0!==b?b:10;this.fa.strokeColor&&df(this.fa.strokeColor,a)&&this.fa.lineWidth===c&&this.fa.miterLimit===b||(this.fa.L=!0,this.fa.strokeColor=a,this.fa.lineWidth=
c,this.fa.miterLimit=b,this.jc.push([a,c,b]))};var Gn=3,Hn=5,Fn=7,In=11,Jn=13,Kn=17,Ln=19,Mn=23;var Qn=new Vm("precision mediump float;\n\n\n\nuniform vec4 u_color;\nuniform float u_opacity;\n\nvoid main(void) {\n  gl_FragColor = u_color;\n  float alpha = u_color.a * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n"),Rn=new Wm("\n\nattribute vec2 a_position;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n}\n\n\n");function Sn(a,b){this.im=a.getUniformLocation(b,"u_projectionMatrix");this.ss=a.getUniformLocation(b,"u_offsetScaleMatrix");this.rs=a.getUniformLocation(b,"u_offsetRotateMatrix");this.$w=a.getUniformLocation(b,"u_color");this.hm=a.getUniformLocation(b,"u_opacity");this.xc=a.getAttribLocation(b,"a_position")};function Tn(a){a=a||{};this.sa=void 0!==a.color?a.color:null;this.di=a.lineCap;this.Oq=void 0!==a.sb?a.sb:null;this.fh=a.lineDashOffset;this.ei=a.lineJoin;this.ii=a.miterLimit;this.Cg=a.width;this.Td=void 0}l=Tn.prototype;l.clone=function(){var a=this.sa;return new Tn({color:a&&a.slice?a.slice():a||void 0,lineCap:this.di,sb:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.fh,lineJoin:this.ei,miterLimit:this.ii,width:this.Qc()})};l.getLineDash=function(){return this.Oq};
l.Qc=function(){return this.Cg};l.setLineDash=function(a){this.Oq=a;this.Td=void 0};l.Qh=function(){void 0===this.Td&&(this.Td="s",this.Td=this.sa?"string"===typeof this.sa?this.Td+this.sa:this.Td+I(this.sa).toString():this.Td+"-",this.Td+=","+(void 0!==this.di?this.di.toString():"-")+","+(this.Oq?this.Oq.toString():"-")+","+(void 0!==this.fh?this.fh:"-")+","+(void 0!==this.ei?this.ei:"-")+","+(void 0!==this.ii?this.ii.toString():"-")+","+(void 0!==this.Cg?this.Cg.toString():"-"));return this.Td};function Un(a){this.Ua=this.ye=this.Ne=void 0;this.Vy=void 0===a?!0:a;this.eh=0}Un.prototype.removeItem=function(){var a=this.Ua;if(a){var b=a.next,c=a.prev;b&&(b.prev=c);c&&(c.next=b);this.Ua=b||c;this.Ne===this.ye?this.ye=this.Ne=this.Ua=void 0:this.Ne===a?this.Ne=this.Ua:this.ye===a&&(this.ye=c?this.Ua.prev:this.Ua);this.eh--}};function Vn(a){a.Ua=a.Ne;if(a.Ua)return a.Ua.data}function Wn(a){if(a.Ua&&a.Ua.next)return a.Ua=a.Ua.next,a.Ua.data}
function Xn(a){if(a.Ua&&a.Ua.next)return a.Ua.next.data}function Yn(a){if(a.Ua&&a.Ua.prev)return a.Ua=a.Ua.prev,a.Ua.data}function Zn(a){if(a.Ua&&a.Ua.prev)return a.Ua.prev.data}function $n(a){if(a.Ua)return a.Ua.data}Un.prototype.concat=function(a){if(a.Ua){if(this.Ua){var b=this.Ua.next;this.Ua.next=a.Ne;a.Ne.prev=this.Ua;b.prev=a.ye;a.ye.next=b;this.eh+=a.eh}else this.Ua=a.Ua,this.Ne=a.Ne,this.ye=a.ye,this.eh=a.eh;a.Ua=void 0;a.Ne=void 0;a.ye=void 0;a.eh=0}};Un.prototype.cc=function(){return this.eh};function ao(a){this.qh=Nl.Jj(a);this.gg={}}l=ao.prototype;l.Lb=function(a,b){a={Wa:a[0],Sa:a[1],lb:a[2],bb:a[3],value:b};this.qh.Lb(a);this.gg[I(b)]=a};l.load=function(a,b){for(var c=Array(b.length),d=0,e=b.length;d<e;d++){var f=a[d],g=b[d],f={Wa:f[0],Sa:f[1],lb:f[2],bb:f[3],value:g};c[d]=f;this.gg[I(g)]=f}this.qh.load(c)};l.remove=function(a){a=I(a);var b=this.gg[a];delete this.gg[a];return null!==this.qh.remove(b)};
l.update=function(a,b){var c=this.gg[I(b)];ug([c.Wa,c.Sa,c.lb,c.bb],a)||(this.remove(b),this.Lb(a,b))};l.getAll=function(){return this.qh.all().map(function(a){return a.value})};function bo(a,b){return a.qh.search({Wa:b[0],Sa:b[1],lb:b[2],bb:b[3]}).map(function(a){return a.value})}l.forEach=function(a,b){return co(this.getAll(),a,b)};function eo(a,b,c,d){return co(bo(a,b),c,d)}function co(a,b,c){for(var d,e=0,f=a.length;e<f&&!(d=b.call(c,a[e]));e++);return d}l.Bf=function(){return Jd(this.gg)};
l.clear=function(){this.qh.clear();this.gg={}};l.V=function(a){var b=this.qh.data;return rg(b.Wa,b.Sa,b.lb,b.bb,a)};l.concat=function(a){this.qh.load(a.qh.all());for(var b in a.gg)this.gg[b|0]=a.gg[b|0]};function fo(a,b){bn.call(this,a,b);this.be=new Dn(a,b);this.oc=null;this.jc=[];this.Fb=[];this.fa={fillColor:null,L:!1}}F(fo,bn);l=fo.prototype;
l.Le=function(a,b,c){var d=new Un,e=new ao;go(this,a,c,d,e,!0);a=ho(d);if(b.length){var f,g,h=[];f=0;for(g=b.length;f<g;++f){var k={list:new Un,hi:void 0,nw:new ao};h.push(k);go(this,b[f],c,k.list,k.nw,!1);io(k.list,k.nw,!0);k.hi=ho(k.list)}h.sort(function(a,b){return b.hi[0]===a.hi[0]?a.hi[1]-b.hi[1]:b.hi[0]-a.hi[0]});for(f=0;f<h.length;++f){b=h[f].list;g=c=Vn(b);var m;do{if(jo(g,e).length){m=!0;break}g=Wn(b)}while(c!==g);!m&&ko(b,h[f].hi[0],d,a[0],e)&&(e.concat(h[f].nw),io(d,e,!1))}}else io(d,e,
!1);lo(this,d,e)};
function go(a,b,c,d,e,f){var g,h,k=a.ba.length/2,m,p,t=[],u=[];if(f===mi(b,0,b.length,c))for(m=f=mo(a,b[0],b[1],k++),g=c,h=b.length;g<h;g+=c)p=mo(a,b[g],b[g+1],k++),u.push(no(m,p,d)),t.push([Math.min(m.x,p.x),Math.min(m.y,p.y),Math.max(m.x,p.x),Math.max(m.y,p.y)]),m=p;else for(g=b.length-c,m=f=mo(a,b[g],b[g+1],k++),g-=c,h=0;g>=h;g-=c)p=mo(a,b[g],b[g+1],k++),u.push(no(m,p,d)),t.push([Math.min(m.x,p.x),Math.min(m.y,p.y),Math.max(m.x,p.x),Math.max(m.y,p.y)]),m=p;u.push(no(p,f,d));t.push([Math.min(m.x,p.x),
Math.min(m.y,p.y),Math.max(m.x,p.x),Math.max(m.y,p.y)]);e.load(t,u)}function ho(a){var b=Vn(a),c=b,d=[c.ta.x,c.ta.y];do c=Wn(a),c.ta.x>d[0]&&(d=[c.ta.x,c.ta.y]);while(c!==b);return d}function io(a,b,c){var d=Vn(a),e=d,f=Wn(a),g=!1;do{var h=c?fn(f.ia.x,f.ia.y,e.ia.x,e.ia.y,e.ta.x,e.ta.y):fn(e.ta.x,e.ta.y,e.ia.x,e.ia.y,f.ia.x,f.ia.y);void 0===h?(oo(e,f,a,b),g=!0,f===d&&(d=Xn(a)),f=e,Yn(a)):e.ia.Ze!==h&&(e.ia.Ze=h,g=!0);e=f;f=Wn(a)}while(e!==d);return g}
function ko(a,b,c,d,e){for(var f=Vn(a);f.ia.x!==b;)f=Wn(a);b=f.ia;d={x:d,y:b.y,Ad:-1};var g=Infinity,h,k,m,p;m=jo({ta:b,ia:d},e,!0);h=0;for(k=m.length;h<k;++h){var t=m[h],u=po(b,d,t.ta,t.ia,!0),w=Math.abs(b.x-u[0]);w<g&&void 0!==fn(b.x,b.y,t.ta.x,t.ta.y,t.ia.x,t.ia.y)&&(g=w,p={x:u[0],y:u[1],Ad:-1},f=t)}if(Infinity===g)return!1;m=f.ia;if(0<g&&(f=qo(b,p,f.ia,e),f.length))for(p=Infinity,h=0,k=f.length;h<k;++h)if(g=f[h],t=Math.atan2(b.y-g.y,d.x-g.x),t<p||t===p&&g.x<m.x)p=t,m=g;for(f=Vn(c);f.ia.x!==m.x||
f.ia.y!==m.y;)f=Wn(c);d={x:b.x,y:b.y,Ad:b.Ad,Ze:void 0};h={x:f.ia.x,y:f.ia.y,Ad:f.ia.Ad,Ze:void 0};Xn(a).ta=d;no(b,f.ia,a,e);no(h,d,a,e);f.ia=h;a.Vy&&a.Ua&&(a.Ne=a.Ua,a.ye=a.Ua.prev);c.concat(a);return!0}
function lo(a,b,c){for(var d=!1,e=ro(b,c);3<b.cc();)if(e){if(!so(a,b,c,e,d)&&!io(b,c,d)&&!to(a,b,c,!0))break}else if(!so(a,b,c,e,d)&&!io(b,c,d)&&!to(a,b,c))if(e=ro(b,c)){var d=b,f=2*d.cc(),g=Array(f),h=Vn(d),k=h,m=0;do g[m++]=k.ta.x,g[m++]=k.ta.y,k=Wn(d);while(k!==h);d=!mi(g,0,f,2);io(b,c,d)}else{e=a;d=b;f=g=Vn(d);do{h=jo(f,c);if(h.length){g=h[0];h=po(f.ta,f.ia,g.ta,g.ia);h=mo(e,h[0],h[1],e.ba.length/2);k=new Un;m=new ao;no(h,f.ia,k,m);f.ia=h;c.update([Math.min(f.ta.x,h.x),Math.min(f.ta.y,h.y),Math.max(f.ta.x,
h.x),Math.max(f.ta.y,h.y)],f);for(f=Wn(d);f!==g;)no(f.ta,f.ia,k,m),c.remove(f),d.removeItem(),f=$n(d);no(g.ta,h,k,m);g.ta=h;c.update([Math.min(g.ia.x,h.x),Math.min(g.ia.y,h.y),Math.max(g.ia.x,h.x),Math.max(g.ia.y,h.y)],g);io(d,c,!1);lo(e,d,c);io(k,m,!1);lo(e,k,m);break}f=Wn(d)}while(f!==g);break}3===b.cc()&&(e=a.M.length,a.M[e++]=Zn(b).ta.Ad,a.M[e++]=$n(b).ta.Ad,a.M[e++]=Xn(b).ta.Ad)}
function so(a,b,c,d,e){var f=a.M.length,g=Vn(b),h=Zn(b),k=g,m=Wn(b),p=Xn(b),t,u,w,x=!1;do{t=k.ta;u=k.ia;w=m.ia;if(!1===u.Ze){var z;z=d?0===qo(t,u,w,c,!0).length:e?uo(p.ia,w,u,t,h.ta):uo(h.ta,t,u,w,p.ia);!d&&0!==jo({ta:t,ia:w},c).length||!z||!d&&!1!==t.Ze&&!1!==w.Ze&&mi([h.ta.x,h.ta.y,t.x,t.y,u.x,u.y,w.x,w.y,p.ia.x,p.ia.y],0,10,2)!==!e||(a.M[f++]=t.Ad,a.M[f++]=u.Ad,a.M[f++]=w.Ad,oo(k,m,b,c),m===g&&(g=p),x=!0)}h=Zn(b);k=$n(b);m=Wn(b);p=Xn(b)}while(k!==g&&3<b.cc());return x}
function to(a,b,c,d){var e=Vn(b);Wn(b);var f=e,g=Wn(b),h=!1;do{var k=po(f.ta,f.ia,g.ta,g.ia,d);if(k){var m,h=a.M.length,p=a.ba.length/2,t=Yn(b);b.removeItem();c.remove(t);m=t===e;d?(k[0]===f.ta.x&&k[1]===f.ta.y?(Yn(b),k=f.ta,g.ta=k,c.remove(f),m=m||f===e):(k=g.ia,f.ia=k,c.remove(g),m=m||g===e),b.removeItem()):(k=mo(a,k[0],k[1],p),f.ia=k,g.ta=k,c.update([Math.min(f.ta.x,f.ia.x),Math.min(f.ta.y,f.ia.y),Math.max(f.ta.x,f.ia.x),Math.max(f.ta.y,f.ia.y)],f),c.update([Math.min(g.ta.x,g.ia.x),Math.min(g.ta.y,
g.ia.y),Math.max(g.ta.x,g.ia.x),Math.max(g.ta.y,g.ia.y)],g));a.M[h++]=t.ta.Ad;a.M[h++]=t.ia.Ad;a.M[h++]=k.Ad;h=!0;if(m)break}f=Zn(b);g=Wn(b)}while(f!==e);return h}function ro(a,b){var c=Vn(a),d=c;do{if(jo(d,b).length)return!1;d=Wn(a)}while(d!==c);return!0}function mo(a,b,c,d){var e=a.ba.length;a.ba[e++]=b;a.ba[e++]=c;return{x:b,y:c,Ad:d,Ze:void 0}}
function no(a,b,c,d){var e={ta:a,ia:b},f={prev:void 0,next:void 0,data:e},g=c.Ua;if(g){var h=g.next;f.prev=g;f.next=h;g.next=f;h&&(h.prev=f);g===c.ye&&(c.ye=f)}else c.Ne=f,c.ye=f,c.Vy&&(f.next=f,f.prev=f);c.Ua=f;c.eh++;d&&d.Lb([Math.min(a.x,b.x),Math.min(a.y,b.y),Math.max(a.x,b.x),Math.max(a.y,b.y)],e);return e}function oo(a,b,c,d){$n(c)===b&&(c.removeItem(),a.ia=b.ia,d.remove(b),d.update([Math.min(a.ta.x,a.ia.x),Math.min(a.ta.y,a.ia.y),Math.max(a.ta.x,a.ia.x),Math.max(a.ta.y,a.ia.y)],a))}
function qo(a,b,c,d,e){var f,g,h,k=[],m=bo(d,[Math.min(a.x,b.x,c.x),Math.min(a.y,b.y,c.y),Math.max(a.x,b.x,c.x),Math.max(a.y,b.y,c.y)]);d=0;for(f=m.length;d<f;++d)for(g in m[d])h=m[d][g],"object"!==typeof h||e&&!h.Ze||h.x===a.x&&h.y===a.y||h.x===b.x&&h.y===b.y||h.x===c.x&&h.y===c.y||-1!==k.indexOf(h)||!ji([a.x,a.y,b.x,b.y,c.x,c.y],0,6,2,h.x,h.y)||k.push(h);return k}
function jo(a,b,c){var d=a.ta,e=a.ia;b=bo(b,[Math.min(d.x,e.x),Math.min(d.y,e.y),Math.max(d.x,e.x),Math.max(d.y,e.y)]);var f=[],g,h;g=0;for(h=b.length;g<h;++g){var k=b[g];a!==k&&(c||k.ta!==e||k.ia!==d)&&po(d,e,k.ta,k.ia,c)&&f.push(k)}return f}
function po(a,b,c,d,e){var f=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y);if(0!==f&&(d=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))/f,c=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))/f,!e&&d>gn&&d<1-gn&&c>gn&&c<1-gn||e&&0<=d&&1>=d&&0<=c&&1>=c))return[a.x+d*(b.x-a.x),a.y+d*(b.y-a.y)]}
function uo(a,b,c,d,e){if(void 0===b.Ze||void 0===d.Ze)return!1;var f=(c.x-d.x)*(b.y-d.y)>(c.y-d.y)*(b.x-d.x);e=(e.x-d.x)*(b.y-d.y)<(e.y-d.y)*(b.x-d.x);a=(a.x-b.x)*(d.y-b.y)>(a.y-b.y)*(d.x-b.x);c=(c.x-b.x)*(d.y-b.y)<(c.y-b.y)*(d.x-b.x);b=b.Ze?c||a:c&&a;return(d.Ze?e||f:e&&f)&&b}
l.$t=function(a,b){var c=a.lc,d=a.S,e=this.M.length,f=this.be.M.length;a=a.l;var g,h,k,m;g=k=0;for(h=c.length;g<h;++g){var p=c[g];if(0<p.length){var t=Lg(a,k,p[0],d,-this.origin[0],-this.origin[1]);if(t.length){var u=[],w;k=1;for(m=p.length;k<m;++k)p[k]!==p[k-1]&&(w=Lg(a,p[k-1],p[k],d,-this.origin[0],-this.origin[1]),u.push(w));On(this.be,t,u,d);this.Le(t,u,d)}}k=p[p.length-1]}this.M.length>e&&(this.Ba.push(e),this.ld.push(b),this.fa.L&&(this.Fb.push(e),this.fa.L=!1));this.be.M.length>f&&Pn(this.be,
b,f)};l.Hm=function(a,b){var c=a.Qa,d=a.S;if(0<c.length){a=a.l.map(Number);var e=Lg(a,0,c[0],d,-this.origin[0],-this.origin[1]);if(e.length){var f=[],g,h,k;g=1;for(h=c.length;g<h;++g)c[g]!==c[g-1]&&(k=Lg(a,c[g-1],c[g],d,-this.origin[0],-this.origin[1]),f.push(k));this.Ba.push(this.M.length);this.ld.push(b);this.fa.L&&(this.Fb.push(this.M.length),this.fa.L=!1);Pn(this.be,b);On(this.be,e,f,d);this.Le(e,f,d)}}};
l.finish=function(a){this.Bg=new hn(this.ba);this.fg=new hn(this.M);this.Ba.push(this.M.length);this.be.finish(a);0===this.Fb.length&&0<this.jc.length&&(this.jc=[]);this.M=this.ba=null};l.Rh=function(a){var b=this.Bg,c=this.fg,d=this.be.Rh(a);return function(){a.deleteBuffer(b);a.deleteBuffer(c);d()}};l.Ur=function(a,b){var c=ln(b,Qn,Rn),d;this.oc?d=this.oc:this.oc=d=new Sn(a,c);b.useProgram(c);a.enableVertexAttribArray(d.xc);a.vertexAttribPointer(d.xc,2,5126,!1,8,0);return d};l.Xr=function(a,b){a.disableVertexAttribArray(b.xc)};
l.Im=function(a,b,c,d){var e=a.getParameter(a.DEPTH_FUNC),f=a.getParameter(a.DEPTH_WRITEMASK);d||(a.enable(a.DEPTH_TEST),a.depthMask(!0),a.depthFunc(a.NOTEQUAL));if(Jd(c)){var g,h,k;h=this.Ba[this.Ba.length-1];for(c=this.Fb.length-1;0<=c;--c)g=this.Fb[c],k=this.jc[c],this.Qj(a,k),this.drawElements(a,b,g,h),h=g}else this.Jm(a,b,c);d||(a.disable(a.DEPTH_TEST),a.clear(a.DEPTH_BUFFER_BIT),a.depthMask(f),a.depthFunc(e))};
l.Ep=function(a,b,c,d,e){var f,g,h,k,m,p,t;t=this.Ba.length-2;h=this.Ba[t+1];for(f=this.Fb.length-1;0<=f;--f)for(g=this.jc[f],this.Qj(a,g),k=this.Fb[f];0<=t&&this.Ba[t]>=k;){g=this.Ba[t];m=this.ld[t];p=I(m).toString();if(void 0===c[p]&&m.j()&&(void 0===e||Eg(e,m.j().V()))&&(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),this.drawElements(a,b,g,h),h=d(m)))return h;t--;h=g}};
l.Jm=function(a,b,c){var d,e,f,g,h,k,m;k=this.Ba.length-2;f=e=this.Ba[k+1];for(d=this.Fb.length-1;0<=d;--d){g=this.jc[d];this.Qj(a,g);for(g=this.Fb[d];0<=k&&this.Ba[k]>=g;)m=this.Ba[k],h=this.ld[k],h=I(h).toString(),c[h]&&(e!==f&&(this.drawElements(a,b,e,f),a.clear(a.DEPTH_BUFFER_BIT)),f=m),k--,e=m;e!==f&&(this.drawElements(a,b,e,f),a.clear(a.DEPTH_BUFFER_BIT));e=f=g}};l.Qj=function(a,b){a.uniform4fv(this.oc.$w,b)};
l.df=function(a,b){a=a?a.sa:[0,0,0,0];a=a instanceof CanvasGradient||a instanceof CanvasPattern?cn:Xk(a).map(function(a,b){return 3!=b?a/255:a})||cn;this.fa.fillColor&&df(a,this.fa.fillColor)||(this.fa.fillColor=a,this.fa.L=!0,this.jc.push(a));b?this.be.df(null,b):this.be.df(null,new Tn({color:[0,0,0,0],lineWidth:0}))};function vo(a,b){this.ne=b;this.Hp=[{x:0,y:0,width:a,height:a}];this.Me={};this.Mg=Li(a,a);this.qa=this.Mg.canvas}vo.prototype.get=function(a){return this.Me[a]||null};
vo.prototype.add=function(a,b,c,d,e){var f,g,h;g=0;for(h=this.Hp.length;g<h;++g)if(f=this.Hp[g],f.width>=b+this.ne&&f.height>=c+this.ne)return h={offsetX:f.x+this.ne,offsetY:f.y+this.ne,kb:this.qa},this.Me[a]=h,d.call(e,this.Mg,f.x+this.ne,f.y+this.ne),a=b+this.ne,b=c+this.ne,f.width-a>f.height-b?(c={x:f.x+a,y:f.y,width:f.width-a,height:f.height},f={x:f.x,y:f.y+b,width:a,height:f.height-b}):(c={x:f.x+a,y:f.y,width:f.width-a,height:b},f={x:f.x,y:f.y+b,width:f.width,height:f.height-b}),g=[g,1],0<c.width&&
0<c.height&&g.push(c),0<f.width&&0<f.height&&g.push(f),this.Hp.splice.apply(this.Hp,g),h;return null};function wo(a){a=a||{};this.yp=void 0!==a.KJ?a.KJ:256;this.cr=void 0!==a.HK?a.HK:void 0!==Bd?Bd:2048;this.ne=void 0!==a.BD?a.BD:1;this.$i=[new vo(this.yp,this.ne)];this.Jt=this.yp;this.DA=[new vo(this.Jt,this.ne)]}function xo(a,b){var c,d,e;d=0;for(e=a.length;d<e;++d)if(c=a[d],c=c.get(b))return c;return null}function yo(a,b){return{offsetX:a.offsetX,offsetY:a.offsetY,kb:a.kb,FJ:b.kb}}
wo.prototype.add=function(a,b,c,d,e,f){if(b+this.ne>this.cr||c+this.ne>this.cr)return null;d=zo(this,!1,a,b,c,d,f);if(!d)return null;a=zo(this,!0,a,b,c,void 0!==e?e:Dd,f);return yo(d,a)};function zo(a,b,c,d,e,f,g){var h=b?a.DA:a.$i,k,m,p;m=0;for(p=h.length;m<p;++m){k=h[m];if(k=k.add(c,d,e,f,g))return k;k||m!==p-1||(b?(k=Math.min(2*a.Jt,a.cr),a.Jt=k):(k=Math.min(2*a.yp,a.cr),a.yp=k),k=new vo(k,a.ne),h.push(k),++p)}return null};function Ao(a,b){vn.call(this,a,b);this.Cd=[];this.$j=[];this.EB=Li(0,0).canvas;this.fa={strokeColor:null,lineCap:void 0,sb:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:0,miterLimit:void 0,fillColor:null,font:void 0,scale:void 0};this.xa="";this.ng=this.mg=this.Yj=this.Ei=void 0;this.$i={};this.Am=void 0;this.opacity=this.scale=1}F(Ao,vn);l=Ao.prototype;
l.Pg=function(a,b){if(this.xa){var c=null,d=2,e=2;switch(a.F()){case "Point":case "MultiPoint":c=a.l;d=c.length;e=a.S;break;case "Circle":c=a.Ka();break;case "LineString":c=wm(a);break;case "MultiLineString":c=xm(a);d=c.length;break;case "Polygon":c=si(a);break;case "MultiPolygon":c=ym(a),d=c.length}this.Ba.push(this.M.length);this.ld.push(b);a=this.Am;b=this.xa.split("\n");var f=Bo(this,b),g,h,k,m,p,t,u,w=Math.round(f[0]*this.Ei-this.mg),x=Math.round(f[1]*this.Yj-this.ng),z=this.fa.lineWidth/2*this.fa.scale,
f=0;for(g=b.length;f<g;++f)for(m=0,p=a.height*f,t=b[f].split(""),h=0,k=t.length;h<k;++h){u=a.Jy;var D=t[h],H=xo(u.$i,D);H?(u=xo(u.DA,D),u=yo(H,u)):u=null;u&&(H=u.kb,this.Wo=w-m,this.Yo=x-p,this.qr=0===h?u.offsetX-z:u.offsetX,this.rr=u.offsetY,this.height=a.height,this.width=0===h||h===t.length-1?a.width[t[h]]+z:a.width[t[h]],this.imageHeight=H.height,this.imageWidth=H.width,0===this.Cd.length?this.Cd.push(H):(u=this.Cd[this.Cd.length-1],I(u)!=I(H)&&(this.Wk.push(this.M.length),this.Cd.push(H))),this.cH(c,
d,e));m+=this.width}}};function Bo(a,b){var c=a.Am,d=b.length*c.height;return[b.map(function(b){var d=0,e,h;e=0;for(h=b.length;e<h;++e){var k=b[e];c.width[k]||Co(a,k);d+=c.width[k]?c.width[k]:0}return d}).reduce(function(a,b){return Math.max(a,b)}),d]}l.cH=function(a,b,c){var d;for(d=0;d<b;d+=c)wn(this,a,b,c)};
function Co(a,b){if(1===b.length){var c=a.Am,d=a.fa;a=a.EB.getContext("2d");a.font=d.font;a=Math.ceil(a.measureText(b).width*d.scale);c.Jy.add(b,a,c.height,function(a,c,g){a.font=d.font;a.fillStyle=d.fillColor;a.strokeStyle=d.strokeColor;a.lineWidth=d.lineWidth;a.lineCap=d.lineCap;a.lineJoin=d.lineJoin;a.miterLimit=d.miterLimit;a.textAlign="left";a.textBaseline="top";Be&&d.sb&&(a.setLineDash(d.sb),a.lineDashOffset=d.lineDashOffset);1!==d.scale&&a.setTransform(d.scale,0,0,d.scale,0,0);d.strokeColor&&
a.strokeText(b,c,g);d.fillColor&&a.fillText(b,c,g)})&&(c.width[b]=a)}}l.finish=function(a){var b=a.Sb;this.Wk.push(this.M.length);this.bl=this.Wk;this.Bg=new hn(this.ba);this.fg=new hn(this.M);xn(this.$j,this.Cd,{},b);this.fa={strokeColor:null,lineCap:void 0,sb:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:0,miterLimit:void 0,fillColor:null,font:void 0,scale:void 0};this.xa="";this.ng=this.mg=this.Yj=this.Ei=void 0;this.Cd=null;this.$i={};this.Am=void 0;vn.prototype.finish.call(this,a)};
l.uh=function(a){var b=this.fa,c=a.ua,d=a.ha;if(a&&a.xa&&(c||d)){c?(c=c.sa,b.fillColor=al(c?c:cn)):b.fillColor=null;d?(c=d.sa,b.strokeColor=al(c?c:en),b.lineWidth=d.Qc()||1,b.lineCap=d.di||"round",b.lineDashOffset=d.fh||0,b.lineJoin=d.ei||"round",b.miterLimit=d.ii||10,d=d.getLineDash(),b.sb=d?d.slice():dn):(b.strokeColor=null,b.lineWidth=0);b.font=a.Ph||"10px sans-serif";b.scale=a.Za()||1;this.xa=a.xa;d=Rl[a.Ei];c=Rl[a.Yj];this.Ei=void 0===d?.5:d;this.Yj=void 0===c?.5:c;this.mg=a.mg||0;this.ng=a.ng||
0;this.Zc=!!a.Ld;this.rotation=a.Cb()||0;a=[];for(var e in b)if(b[e]||0===b[e])Array.isArray(b[e])?a=a.concat(b[e]):a.push(b[e]);c="";e=0;for(d=a.length;e<d;++e)c+=a[e];e=c;this.$i[e]||(a=this.EB.getContext("2d"),a.font=b.font,a=Math.ceil((1.5*a.measureText("M").width+b.lineWidth/2)*b.scale),this.$i[e]={Jy:new wo({BD:b.lineWidth+1}),width:{},height:a});this.Am=this.$i[e]}else this.xa=""};l.Gu=function(){return this.$j};l.su=function(){return this.$j};function Do(a,b,c){this.ar=b;this.Vw=a;this.$e=c;this.hc={}}F(Do,Ol);l=Do.prototype;l.Qf=function(){};l.Rh=function(a){var b=[],c;for(c in this.hc){var d=this.hc[c],e;for(e in d)b.push(d[e].Rh(a))}return function(){for(var a=b.length,c,d=0;d<a;d++)c=b[d].apply(this,arguments);return c}};l.finish=function(a){for(var b in this.hc){var c=this.hc[b],d;for(d in c)c[d].finish(a)}};
l.rd=function(a,b){var c=void 0!==a?a.toString():"0";a=this.hc[c];void 0===a&&(a={},this.hc[c]=a);c=a[b];void 0===c&&(c=new Eo[b](this.Vw,this.ar),a[b]=c);return c};l.Bf=function(){return Jd(this.hc)};l.ke=function(a,b,c,d,e,f,g,h){var k=Object.keys(this.hc).map(Number);k.sort($e);var m,p,t,u,w,x;m=0;for(p=k.length;m<p;++m)for(w=this.hc[k[m].toString()],t=0,u=Ql.length;t<u;++t)x=w[Ql[t]],void 0!==x&&x.ke(a,b,c,d,e,f,g,h,void 0,!1)};
l.lw=function(a,b,c,d,e,f,g,h,k,m,p){var t=Object.keys(this.hc).map(Number);t.sort(function(a,b){return b-a});var u,w,x,z,D;u=0;for(w=t.length;u<w;++u)for(z=this.hc[t[u].toString()],x=Ql.length-1;0<=x;--x)if(D=z[Ql[x]],void 0!==D&&(D=D.ke(a,b,c,d,e,f,g,h,k,m,p)))return D};
l.yc=function(a,b,c,d,e,f,g,h,k,m){var p=b.Sb;p.bindFramebuffer(p.FRAMEBUFFER,qn(b));var t;void 0!==this.$e&&(t=ig(tg(a),d*this.$e));return this.lw(b,a,d,e,Fo,g,h,k,function(a){var b=new Uint8Array(4);p.readPixels(0,0,1,1,p.RGBA,p.UNSIGNED_BYTE,b);if(0<b[3]&&(a=m(a)))return a},!0,t)};var Fo=[1,1],Eo={Circle:kn,Image:yn,LineString:Dn,Polygon:fo,Text:Ao};var Go=new Vm("precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform float u_opacity;\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_texture, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  gl_FragColor.a = texColor.a * u_opacity;\n}\n"),Ho=new Wm("varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform mat4 u_texCoordMatrix;\nuniform mat4 u_projectionMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0., 1.);\n  v_texCoord = (u_texCoordMatrix * vec4(a_texCoord, 0., 1.)).st;\n}\n\n\n");function Io(a,b){this.KO=a.getUniformLocation(b,"u_texCoordMatrix");this.im=a.getUniformLocation(b,"u_projectionMatrix");this.hm=a.getUniformLocation(b,"u_opacity");this.dx=a.getUniformLocation(b,"u_texture");this.xc=a.getAttribLocation(b,"a_position");this.Gg=a.getAttribLocation(b,"a_texCoord")};function Jo(a,b){cl.call(this,b);this.jg=a;this.KF=new hn([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);this.Sp=this.gf=null;this.Tp=void 0;this.Kw=wh();this.uC=wh();this.em=$m();this.oc=null}F(Jo,cl);
Jo.prototype.bindFramebuffer=function(a,b){var c=this.jg.Sb;if(void 0===this.Tp||this.Tp!=b){var d=function(a,b,c){a.isContextLost()||(a.deleteFramebuffer(b),a.deleteTexture(c))}.bind(null,c,this.Sp,this.gf);a.qg.push(d);a=rn(c,b,b);d=c.createFramebuffer();c.bindFramebuffer(36160,d);c.framebufferTexture2D(36160,36064,3553,a,0);this.gf=a;this.Sp=d;this.Tp=b}else c.bindFramebuffer(36160,this.Sp)};
Jo.prototype.Dk=function(a,b,c){this.se("precompose",c,a);c.bindBuffer(34962,this.KF);var d=c.Sb,e=ln(c,Go,Ho),f;this.oc?f=this.oc:this.oc=f=new Io(d,e);c.useProgram(e)&&(d.enableVertexAttribArray(f.xc),d.vertexAttribPointer(f.xc,2,5126,!1,16,0),d.enableVertexAttribArray(f.Gg),d.vertexAttribPointer(f.Gg,2,5126,!1,16,8),d.uniform1i(f.dx,0));d.uniformMatrix4fv(f.KO,!1,an(this.em,this.Kw));d.uniformMatrix4fv(f.im,!1,an(this.em,this.uC));d.uniform1f(f.hm,b.opacity);d.bindTexture(3553,this.gf);d.drawArrays(5,
0,4);this.se("postcompose",c,a)};Jo.prototype.se=function(a,b,c){b=this.Kb();b.hasListener(a)&&b.dispatchEvent(new Dk(a,0,c,null))};Jo.prototype.uj=function(){this.Sp=this.gf=null;this.Tp=void 0};function Ko(a,b){Jo.call(this,a,b);this.la=null}F(Ko,Jo);Ko.handles=function(a,b){return"webgl"===a&&"IMAGE"===b.F()};Ko.create=function(a,b){return new Ko(a,b)};function Lo(a,b){b=b.na();return un(a.jg.Sb,b)}Ko.prototype.yc=function(a,b,c,d,e){var f=this.Kb();return f.s().yc(a,b.Ma.ra,b.Ma.rotation,c,b.Xl,function(a){return d.call(e,a,f)})};
Ko.prototype.rg=function(a,b){var c=this.jg.Sb,d=a.mb,e=a.Ma,f=e.Oa,g=e.ra,h=e.rotation,k=this.la,m=this.gf,p=this.Kb().s(),t=a.Of,u=a.aa;void 0!==b.aa&&(u=Dg(u,b.aa));t[0]||t[1]||yg(u)||(b=p.na(u,g,d,e.pa))&&fl(this,b)&&(k=b,m=Lo(this,b),this.gf&&(c=function(a,b){a.isContextLost()||a.deleteTexture(b)}.bind(null,c,this.gf),a.qg.push(c)));k&&(c=this.jg.getContext().qa,Mo(this,c.width,c.height,d,f,g,h,k.V()),d=this.Kw,xh(d),Dh(d,1,-1),Kh(d,0,-1),this.la=k,this.gf=m,hl(a,p));return!!k};
function Mo(a,b,c,d,e,f,g,h){b*=f;c*=f;a=a.uC;xh(a);Dh(a,2*d/b,2*d/c);Ch(a,-g);Kh(a,h[0]-e[0],h[1]-e[1]);Dh(a,(h[2]-h[0])/2,(h[3]-h[1])/2);Kh(a,1,1)};function No(a,b){ul.call(this,0,b);this.qa=document.createElement("CANVAS");this.qa.style.width="100%";this.qa.style.height="100%";this.qa.style.display="block";this.qa.className="ol-unselectable";a.insertBefore(this.qa,a.childNodes[0]||null);this.Yy=this.Zy=0;this.$y=Li();this.Mc=!0;this.Sb=re(this.qa,{antialias:!0,depth:!0,failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!1,stencil:!0});this.Mg=new pn(this.qa,this.Sb);J(this.qa,"webglcontextlost",this.uj,this);J(this.qa,"webglcontextrestored",
this.Qu,this);this.oe=new Ek;this.jj=null;this.xo=new zf(function(a){var b=a[1];a=a[2];var c=b[0]-this.jj[0],b=b[1]-this.jj[1];return 65536*Math.log(a)+Math.sqrt(c*c+b*b)/a}.bind(this),function(a){return a[0].getKey()});this.cK=function(){if(!this.xo.Bf()){Cf(this.xo);var a=this.xo.dequeue();Oo(this,a[0],a[3],a[4])}return!1}.bind(this);this.wo=0;Po(this)}F(No,ul);No.handles=function(a){return se&&"webgl"===a};No.create=function(a,b){return new No(a,b)};
function Oo(a,b,c,d){var e=a.Sb,f=b.getKey();if(Fk(a.oe,f))a=a.oe.get(f),e.bindTexture(3553,a.gf),9729!=a.rB&&(e.texParameteri(3553,10240,9729),a.rB=9729),9729!=a.JB&&(e.texParameteri(3553,10241,9729),a.JB=9729);else{var g=e.createTexture();e.bindTexture(3553,g);if(0<d){var h=a.$y.canvas,k=a.$y;a.Zy!==c[0]||a.Yy!==c[1]?(h.width=c[0],h.height=c[1],a.Zy=c[0],a.Yy=c[1]):k.clearRect(0,0,c[0],c[1]);k.drawImage(b.na(),d,d,c[0],c[1],0,0,c[0],c[1]);e.texImage2D(3553,0,6408,6408,5121,h)}else e.texImage2D(3553,
0,6408,6408,5121,b.na());e.texParameteri(3553,10240,9729);e.texParameteri(3553,10241,9729);e.texParameteri(3553,10242,33071);e.texParameteri(3553,10243,33071);a.oe.set(f,{gf:g,rB:9729,JB:9729})}}l=No.prototype;l.se=function(a,b){var c=this.g();c.hasListener(a)&&c.dispatchEvent(new Dk(a,0,b,null))};l.Ya=function(){var a=this.Sb;a.isContextLost()||this.oe.forEach(function(b){b&&a.deleteTexture(b.gf)});this.Mg.ue();ul.prototype.Ya.call(this)};
l.kH=function(a,b){a=this.Sb;for(var c;1024<this.oe.Qk()-this.wo;){if(c=this.oe.ed.Ji)a.deleteTexture(c.gf);else if(+this.oe.ed.$g==b.index)break;else--this.wo;this.oe.pop()}};l.getContext=function(){return this.Mg};l.F=function(){return"webgl"};l.uj=function(a){a.preventDefault();this.oe.clear();this.wo=0;a=this.bh;for(var b in a)a[b].uj()};l.Qu=function(){Po(this);this.g().La()};
function Po(a){a=a.Sb;a.activeTexture(33984);a.blendFuncSeparate(770,771,1,771);a.disable(2884);a.disable(2929);a.disable(3089);a.disable(2960)}
l.fw=function(a){var b=this.getContext(),c=this.Sb;if(c.isContextLost())return!1;if(!a)return this.Mc&&(this.qa.style.display="none",this.Mc=!1),!1;this.jj=a.focus;this.oe.set((-a.index).toString(),null);++this.wo;this.se("precompose",a);var d=[],e=a.hl;ef(e);var f=a.Ma.ra,g,h,k,m;g=0;for(h=e.length;g<h;++g)m=e[g],pj(m,f)&&"ready"==m.AD&&(k=xl(this,m.layer),k.rg(a,m,b)&&d.push(m));e=a.size[0]*a.mb;f=a.size[1]*a.mb;if(this.qa.width!=e||this.qa.height!=f)this.qa.width=e,this.qa.height=f;c.bindFramebuffer(36160,
null);c.clearColor(0,0,0,0);c.clear(16384);c.enable(3042);c.viewport(0,0,this.qa.width,this.qa.height);g=0;for(h=d.length;g<h;++g)m=d[g],k=xl(this,m.layer),k.Dk(a,m,b);this.Mc||(this.qa.style.display="",this.Mc=!0);vl(a);1024<this.oe.Qk()-this.wo&&a.qg.push(this.kH.bind(this));this.xo.Bf()||(a.qg.push(this.cK),a.animate=!0);this.se("postcompose",a);yl(this,a);a.qg.push(wl)};
l.yc=function(a,b,c,d,e,f,g){var h;if(this.Sb.isContextLost())return!1;var k=b.Ma,m=b.hl,p;for(p=m.length-1;0<=p;--p){h=m[p];var t=h.layer;if(pj(h,k.ra)&&f.call(g,t)&&(h=xl(this,t).yc(a,b,c,d,e)))return h}};var Qo=new Vm("precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  gl_FragColor = texture2D(u_texture, v_texCoord);\n}\n"),Ro=new Wm("varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nuniform vec4 u_tileOffset;\n\nvoid main(void) {\n  gl_Position = vec4(a_position * u_tileOffset.xy + u_tileOffset.zw, 0., 1.);\n  v_texCoord = a_texCoord;\n}\n\n\n");function So(a,b){this.LO=a.getUniformLocation(b,"u_tileOffset");this.dx=a.getUniformLocation(b,"u_texture");this.xc=a.getAttribLocation(b,"a_position");this.Gg=a.getAttribLocation(b,"a_texCoord")};function To(a,b){Jo.call(this,a,b);this.vH=Qo;this.dP=Ro;this.gh=null;this.JC=new hn([0,0,0,1,1,0,1,1,0,1,0,0,1,1,1,0]);this.gw=this.Lr=null;this.af=-1;this.fm=[0,0]}F(To,Jo);To.handles=function(a,b){return"webgl"===a&&"TILE"===b.F()};To.create=function(a,b){return new To(a,b)};To.prototype.Ya=function(){this.jg.getContext().deleteBuffer(this.JC);Jo.prototype.Ya.call(this)};
To.prototype.It=function(a,b,c){var d=this.jg;return function(e,f){return dl(a,b,e,f,function(a){var b=Fk(d.oe,a.getKey());b&&(c[e]||(c[e]={}),c[e][a.Nb.toString()]=a);return b})}};To.prototype.uj=function(){Jo.prototype.uj.call(this);this.gh=null};
To.prototype.rg=function(a,b,c){var d=this.jg,e=c.Sb,f=a.Ma,g=f.pa,h=this.Kb(),k=h.s(),m=k.Pe(g),p=Fl(m,f.ra),t=m.Fa(p),u=Ll(k,p,a.mb,g),w=u[0]/Xi(Uo(m,p),this.fm)[0],x=t/w,z=k.cn(w)*k.qu(g),D=f.Oa,H=a.aa,G=kl(m,H,p);if(this.Lr&&this.Lr.equals(G)&&this.af==k.Xa)x=this.gw;else{var L=G.$a(),N=Gf(Math.max(L[0]*u[0],L[1]*u[1])),L=x*N,T=m.ag(p),U=T[0]+G.Wa*u[0]*x,x=T[1]+G.Sa*u[1]*x,x=[U,x,U+L,x+L];this.bindFramebuffer(a,N);e.viewport(0,0,N,N);e.clearColor(0,0,0,0);e.clear(16384);e.disable(3042);N=ln(c,
this.vH,this.dP);c.useProgram(N);this.gh||(this.gh=new So(e,N));c.bindBuffer(34962,this.JC);e.enableVertexAttribArray(this.gh.xc);e.vertexAttribPointer(this.gh.xc,2,5126,!1,16,0);e.enableVertexAttribArray(this.gh.Gg);e.vertexAttribPointer(this.gh.Gg,2,5126,!1,16,8);e.uniform1i(this.gh.dx,0);c={};c[p]={};var K=this.It(k,g,c),X=El(h),N=!0,U=gg(),ma=new Al(0,0,0,0),fa,ya,Ca;for(ya=G.Wa;ya<=G.lb;++ya)for(Ca=G.Sa;Ca<=G.bb;++Ca){T=ll(k,p,ya,Ca,w,g);if(void 0!==b.aa&&(fa=Ml(m,T.Nb,U),!Eg(fa,b.aa)))continue;
fa=T.ab();(fa=2==fa||4==fa||3==fa&&!X)||(T=Hl(T));fa=T.ab();if(2==fa){if(Fk(d.oe,T.getKey())){c[p][T.Nb.toString()]=T;continue}}else if(4==fa||3==fa&&!X)continue;N=!1;fa=Kl(m,T.Nb,K,ma,U);fa||(T=Jl(m,T.Nb,ma,U))&&K(p+1,T)}b=Object.keys(c).map(Number);b.sort($e);for(var K=new Float32Array(4),da,X=0,ma=b.length;X<ma;++X)for(da in ya=c[b[X]],ya)T=ya[da],fa=Ml(m,T.Nb,U),K[0]=2*(fa[2]-fa[0])/L,K[1]=2*(fa[3]-fa[1])/L,K[2]=2*(fa[0]-x[0])/L-1,K[3]=2*(fa[1]-x[1])/L-1,e.uniform4fv(this.gh.LO,K),Oo(d,T,u,z*
w),e.drawArrays(5,0,4);N?(this.Lr=G,this.gw=x,this.af=k.Xa):(this.gw=this.Lr=null,this.af=-1,a.animate=!0)}il(a.Bs,k,p,G);var qb=d.xo;jl(a,k,m,w,g,H,p,h.get("preload"),function(a){var b;(b=2!=a.ab()||Fk(d.oe,a.getKey()))||(b=a.getKey()in qb.Ij);b||qb.enqueue([a,ml(m,a.Nb),m.Fa(a.Nb[0]),u,z*w])},this);gl(a,k);hl(a,k);e=this.Kw;xh(e);Kh(e,(Math.round(D[0]/t)*t-x[0])/(x[2]-x[0]),(Math.round(D[1]/t)*t-x[1])/(x[3]-x[1]));0!==f.rotation&&Ch(e,f.rotation);Dh(e,a.size[0]*f.ra/(x[2]-x[0]),a.size[1]*f.ra/(x[3]-
x[1]));Kh(e,-.5,-.5);return!0};function Vo(a,b){Jo.call(this,a,b);this.Vd=!1;this.af=-1;this.Xn=NaN;this.De=gg();this.hv=this.Id=this.Wn=null}F(Vo,Jo);Vo.handles=function(a,b){return"webgl"===a&&"VECTOR"===b.F()};Vo.create=function(a,b){return new Vo(a,b)};l=Vo.prototype;l.Dk=function(a,b,c){this.hv=b;var d=a.Ma,e=this.Id,f=a.size,g=a.mb,h=this.jg.Sb;e&&!e.Bf()&&(h.enable(h.SCISSOR_TEST),h.scissor(0,0,f[0]*g,f[1]*g),e.ke(c,d.Oa,d.ra,d.rotation,f,g,b.opacity,b.Uq?a.Xl:{}),h.disable(h.SCISSOR_TEST))};
l.Ya=function(){var a=this.Id;if(a){var b=this.jg.getContext();a.Rh(b)();this.Id=null}Jo.prototype.Ya.call(this)};l.yc=function(a,b,c,d,e){if(this.Id&&this.hv){c=this.jg.getContext();var f=b.Ma,g=this.Kb(),h={};return this.Id.yc(a,c,f.Oa,f.ra,f.rotation,b.size,b.mb,this.hv.opacity,{},function(a){var b=I(a).toString();if(!(b in h))return h[b]=!0,d.call(e,a,g)})}};l.Xh=function(){el(this)};
l.rg=function(a,b,c){function d(a){var b,c=a.wg;c?b=c.call(a,m):(c=e.wg)&&(b=c(a,m));b&&(a=this.Tn(a,m,p,b,u),this.Vd=this.Vd||a)}var e=this.Kb();b=e.s();hl(a,b);var f=a.Of[0],g=a.Of[1],h=e.lE,k=e.mE;if(!this.Vd&&!h&&f||!k&&g)return!0;var g=a.aa,h=a.Ma,f=h.pa,m=h.ra,p=a.mb,h=e.Xa,t=e.$e,k=e.get(Nm);void 0===k&&(k=Gm);g=ig(g,t*m);if(!this.Vd&&this.Xn==m&&this.af==h&&this.Wn==k&&qg(this.De,g))return!0;this.Id&&a.qg.push(this.Id.Rh(c));this.Vd=!1;var u=new Do(.5*m/p,g,e.$e);Om(b,g,m,f);if(k){var w=[];
Pm(b,g,function(a){w.push(a)},this);w.sort(k);w.forEach(d,this)}else Pm(b,g,d,this);u.finish(c);this.Xn=m;this.af=h;this.Wn=k;this.De=g;this.Id=u;return!0};l.Tn=function(a,b,c,d,e){if(!d)return!1;var f=!1;if(Array.isArray(d))for(var g=d.length-1;0<=g;--g)f=Im(e,a,d[g],Hm(b,c),this.Xh,this)||f;else f=Im(e,a,d,Hm(b,c),this.Xh,this)||f;return f};Ui("MAP_RENDERER",zl);Vi([ql,Cl,Mm,Qm]);Ui("MAP_RENDERER",No);Vi([Ko,To,Vo]);function Wo(a){a=Gd({},a);if(!a.controls){var b=a,c={},d=new he;(void 0!==c.zoom?c.zoom:1)&&d.push(new uj(c.NQ));(void 0!==c.rotate?c.rotate:1)&&d.push(new sj(c.AQ));(void 0!==c.attribution?c.attribution:1)&&d.push(new qj(c.LP));b.controls=d}a.Rc||(a.Rc=Ak());Yi.call(this,a)}F(Wo,Yi);function Xo(a){a=a?a:{};var b=Gd({},a);delete b.rC;delete b.oE;oj.call(this,b);this.set("preload",void 0!==a.rC?a.rC:0);this.set("useInterimTilesOnError",void 0!==a.oE?a.oE:!0);this.type="TILE"}F(Xo,oj);function El(a){return a.get("useInterimTilesOnError")};function Yo(a,b,c){Yd.call(this);c=c?c:{};this.Nb=a;this.state=b;this.Dd=null;this.key="";this.Ao=void 0===c.transition?250:c.transition;this.qs={}}F(Yo,Yd);Yo.prototype.L=function(){this.dispatchEvent("change")};Yo.prototype.getKey=function(){return this.key+"/"+this.Nb};function Hl(a){if(!a.Dd)return a;var b=a.Dd;do{if(2==b.ab())return b;b=b.Dd}while(b);return a}function Zo(a){if(a.Dd){var b=a.Dd;do{if(2==b.ab()){b.Dd=null;break}else 1==b.ab()?a=b:0==b.ab()?a.Dd=b.Dd:a=b;b=a.Dd}while(b)}}
Yo.prototype.ab=function(){return this.state};Yo.prototype.Tr=function(a){this.state=a;this.L()};function Il(a,b,c){if(!a.Ao)return 1;var d=a.qs[b];if(!d)d=c,a.qs[b]=d;else if(-1===d)return 1;b=c-d+1E3/60;return b>=a.Ao?1:Math.pow(b/a.Ao,3)};function $o(a,b,c,d,e,f){Yo.call(this,a,b,f);this.cj=d;this.ff=c;this.la=new Image;null!==d&&(this.la.crossOrigin=d);this.Af=null;this.hO=e}F($o,Yo);l=$o.prototype;l.Ya=function(){1==this.state&&(this.Ah(),this.la=ap());this.Dd&&this.Dd.ue();this.state=5;this.L();Yo.prototype.Ya.call(this)};l.na=function(){return this.la};l.getKey=function(){return this.ff};l.Yk=function(){this.state=3;this.Ah();this.la=ap();this.L()};
l.ln=function(){this.state=this.la.naturalWidth&&this.la.naturalHeight?2:4;this.Ah();this.L()};l.load=function(){3==this.state&&(this.state=0,this.la=new Image,null!==this.cj&&(this.la.crossOrigin=this.cj));0==this.state&&(this.state=1,this.L(),this.Af=[Qd(this.la,"error",this.Yk,this),Qd(this.la,"load",this.ln,this)],this.hO(this,this.ff))};l.Ah=function(){this.Af.forEach(Ld);this.Af=null};function ap(){var a=Li(1,1);a.fillStyle="rgba(0,0,0,0)";a.fillRect(0,0,1,1);return a.canvas};function bp(a,b,c,d){return void 0!==d?(d[0]=a,d[1]=b,d[2]=c,d):[a,b,c]}function cp(a){var b=a[0],c=Array(b),d=1<<b-1,e,f;for(e=0;e<b;++e)f=48,a[1]&d&&(f+=1),a[2]&d&&(f+=2),c[e]=String.fromCharCode(f),d>>=1;return c.join("")};function dp(a){Ek.call(this,a)}F(dp,Ek);dp.prototype.Lk=function(a){for(var b,c;this.Ih()&&!(b=this.ed.Ji,c=b.Nb[0].toString(),c in a&&a[c].contains(b.Nb));)this.pop().ue()};function ep(a){if(0!==a.Qk()){var b=a.td.$g.split("/").map(Number)[0];a.forEach(function(a){if(a.Nb[0]!==b){var c=a.Nb;this.remove(c[0]+"/"+c[1]+"/"+c[2]);a.ue()}},a)}};function fp(a,b,c,d){var e=th(c,b,a);c=hh(b,d,c);b=Rg(b);void 0!==b&&(c*=b);b=Rg(a);void 0!==b&&(c/=b);b=a.V();if(!b||lg(b,e))a=hh(a,c,e)/c,isFinite(a)&&0<a&&(c/=a);return c}function gp(a,b,c,d){a=c-a;b=d-b;var e=Math.sqrt(a*a+b*b);return[Math.round(c+a/e),Math.round(d+b/e)]}
function hp(a,b,c,d,e,f,g,h,k,m,p){var t=Li(Math.round(c*a),Math.round(c*b));if(0===k.length)return t.canvas;t.scale(c,c);var u=gg();k.forEach(function(a){vg(u,a.aa)});var w=Li(Math.round(c*zg(u)/d),Math.round(c*Ag(u)/d)),x=c/d;k.forEach(function(a){w.drawImage(a.kb,m,m,a.kb.width-2*m,a.kb.height-2*m,(a.aa[0]-u[0])*x,-(a.aa[3]-u[3])*x,zg(a.aa)*x,Ag(a.aa)*x)});var z=Fg(g);h.Fi.forEach(function(a){var b=a.source,e=a.target,g=b[1][0],h=b[1][1],k=b[2][0],m=b[2][1];a=(e[0][0]-z[0])/f;var p=-(e[0][1]-z[1])/
f,x=(e[1][0]-z[0])/f,D=-(e[1][1]-z[1])/f,fa=(e[2][0]-z[0])/f,ya=-(e[2][1]-z[1])/f,e=b[0][0],b=b[0][1],g=g-e,h=h-b,k=k-e,m=m-b;a:{g=[[g,h,0,0,x-a],[k,m,0,0,fa-a],[0,0,g,h,D-p],[0,0,k,m,ya-p]];h=g.length;for(k=0;k<h;k++){for(var m=k,Ca=Math.abs(g[k][k]),da=k+1;da<h;da++){var qb=Math.abs(g[da][k]);qb>Ca&&(Ca=qb,m=da)}if(0===Ca){g=null;break a}Ca=g[m];g[m]=g[k];g[k]=Ca;for(m=k+1;m<h;m++)for(Ca=-g[m][k]/g[k][k],da=k;da<h+1;da++)g[m][da]=k==da?0:g[m][da]+Ca*g[k][da]}k=Array(h);for(m=h-1;0<=m;m--)for(k[m]=
g[m][h]/g[m][m],Ca=m-1;0<=Ca;Ca--)g[Ca][h]-=g[Ca][m]*k[m];g=k}g&&(t.save(),t.beginPath(),k=(a+x+fa)/3,m=(p+D+ya)/3,h=gp(k,m,a,p),x=gp(k,m,x,D),fa=gp(k,m,fa,ya),t.moveTo(x[0],x[1]),t.lineTo(h[0],h[1]),t.lineTo(fa[0],fa[1]),t.clip(),t.transform(g[0],g[2],g[1],g[3],a,p),t.translate(u[0]-e,u[3]-b),t.scale(d/c,-d/c),t.drawImage(w.canvas,0,0),t.restore())});p&&(t.save(),t.strokeStyle="black",t.lineWidth=1,h.Fi.forEach(function(a){var b=a.target;a=(b[0][0]-z[0])/f;var c=-(b[0][1]-z[1])/f,d=(b[1][0]-z[0])/
f,e=-(b[1][1]-z[1])/f,g=(b[2][0]-z[0])/f,b=-(b[2][1]-z[1])/f;t.beginPath();t.moveTo(d,e);t.lineTo(a,c);t.lineTo(g,b);t.closePath();t.stroke()}),t.restore());return t.canvas};function ip(a,b,c,d,e){this.Di=a;this.bm=b;var f={},g=rh(this.bm,this.Di);this.zh=function(a){var b=a[0]+"/"+a[1];f[b]||(f[b]=g(a));return f[b]};this.dr=d;this.hH=e*e;this.Fi=[];this.JE=!1;this.VF=this.Di.bj&&!!d&&!!this.Di.V()&&zg(d)==zg(this.Di.V());this.Mf=this.Di.V()?zg(this.Di.V()):null;this.ND=this.bm.V()?zg(this.bm.V()):null;a=Fg(c);b=[c[2],c[3]];d=[c[2],c[1]];c=[c[0],c[1]];e=this.zh(a);var h=this.zh(b),k=this.zh(d),m=this.zh(c);jp(this,a,b,d,c,e,h,k,m,10);if(this.JE){var p=Infinity;this.Fi.forEach(function(a){p=
Math.min(p,a.source[0][0],a.source[1][0],a.source[2][0])});this.Fi.forEach(function(a){if(Math.max(a.source[0][0],a.source[1][0],a.source[2][0])-p>this.Mf/2){var b=[[a.source[0][0],a.source[0][1]],[a.source[1][0],a.source[1][1]],[a.source[2][0],a.source[2][1]]];b[0][0]-p>this.Mf/2&&(b[0][0]-=this.Mf);b[1][0]-p>this.Mf/2&&(b[1][0]-=this.Mf);b[2][0]-p>this.Mf/2&&(b[2][0]-=this.Mf);Math.max(b[0][0],b[1][0],b[2][0])-Math.min(b[0][0],b[1][0],b[2][0])<this.Mf/2&&(a.source=b)}},this)}f={}}
function jp(a,b,c,d,e,f,g,h,k,m){var p=fg([f,g,h,k]),t=a.Mf?zg(p)/a.Mf:null,u=a.Mf,w=a.Di.bj&&.5<t&&1>t,x=!1;if(0<m){if(a.bm.gn&&a.ND)var z=fg([b,c,d,e]),x=x|.25<zg(z)/a.ND;!w&&a.Di.gn&&t&&(x|=.25<t)}if(x||!a.dr||Eg(p,a.dr)){if(!(x||isFinite(f[0])&&isFinite(f[1])&&isFinite(g[0])&&isFinite(g[1])&&isFinite(h[0])&&isFinite(h[1])&&isFinite(k[0])&&isFinite(k[1])))if(0<m)x=!0;else return;if(0<m&&(x||(p=a.zh([(b[0]+d[0])/2,(b[1]+d[1])/2]),u=w?(Jf(f[0],u)+Jf(h[0],u))/2-Jf(p[0],u):(f[0]+h[0])/2-p[0],p=(f[1]+
h[1])/2-p[1],x=u*u+p*p>a.hH),x)){Math.abs(b[0]-d[0])<=Math.abs(b[1]-d[1])?(w=[(c[0]+d[0])/2,(c[1]+d[1])/2],u=a.zh(w),p=[(e[0]+b[0])/2,(e[1]+b[1])/2],t=a.zh(p),jp(a,b,c,w,p,f,g,u,t,m-1),jp(a,p,w,d,e,t,u,h,k,m-1)):(w=[(b[0]+c[0])/2,(b[1]+c[1])/2],u=a.zh(w),p=[(d[0]+e[0])/2,(d[1]+e[1])/2],t=a.zh(p),jp(a,b,w,p,e,f,u,t,k,m-1),jp(a,w,c,d,p,u,g,h,t,m-1));return}if(w){if(!a.VF)return;a.JE=!0}a.Fi.push({source:[f,h,k],target:[b,d,e]});a.Fi.push({source:[f,g,h],target:[b,c,d]})}}
function kp(a){var b=gg();a.Fi.forEach(function(a){a=a.source;hg(b,a[0]);hg(b,a[1]);hg(b,a[2])});return b};function lp(a,b,c,d,e,f,g,h,k,m,p){Yo.call(this,e,0);this.HM=void 0!==p?p:!1;this.og=g;this.lq=h;this.qa=null;this.bs=b;this.ds=d;this.Ks=f?f:e;this.Yl=[];this.Zl=null;this.cs=0;f=Ml(d,this.Ks);h=this.ds.V();e=this.bs.V();f=h?Dg(f,h):f;if(0===xg(f))this.state=4;else if((h=a.V())&&(e=e?Dg(e,h):h),d=d.Fa(this.Ks[0]),d=fp(a,c,Bg(f),d),!isFinite(d)||0>=d)this.state=4;else if(this.gm=new ip(a,c,f,e,d*(void 0!==m?m:.5)),0===this.gm.Fi.length)this.state=4;else if(this.cs=Fl(b,d),c=kp(this.gm),e&&(a.bj?(c[1]=
Ef(c[1],e[1],e[3]),c[3]=Ef(c[3],e[1],e[3])):c=Dg(c,e)),xg(c)){a=kl(b,c,this.cs);for(b=a.Wa;b<=a.lb;b++)for(c=a.Sa;c<=a.bb;c++)(m=k(this.cs,b,c,g))&&this.Yl.push(m);0===this.Yl.length&&(this.state=4)}else this.state=4}F(lp,Yo);lp.prototype.Ya=function(){1==this.state&&(this.Zl.forEach(Ld),this.Zl=null);Yo.prototype.Ya.call(this)};lp.prototype.na=function(){return this.qa};
lp.prototype.Yn=function(){var a=[];this.Yl.forEach(function(b){b&&2==b.ab()&&a.push({aa:Ml(this.bs,b.Nb),kb:b.na()})},this);this.Yl.length=0;if(0===a.length)this.state=3;else{var b=this.Ks[0],c=Uo(this.ds,b),d="number"===typeof c?c:c[0],c="number"===typeof c?c:c[1],b=this.ds.Fa(b),e=this.bs.Fa(this.cs),f=Ml(this.ds,this.Ks);this.qa=hp(d,c,this.og,e,this.bs.V(),b,f,this.gm,a,this.lq,this.HM);this.state=2}this.L()};
lp.prototype.load=function(){if(0==this.state){this.state=1;this.L();var a=0;this.Zl=[];this.Yl.forEach(function(b){var c=b.ab();if(0==c||1==c){a++;var d;d=J(b,"change",function(){var c=b.ab();if(2==c||3==c||4==c)Ld(d),a--,0===a&&(this.Zl.forEach(Ld),this.Zl=null,this.Yn())},this);this.Zl.push(d)}},this);this.Yl.forEach(function(a){0==a.ab()&&a.load()});0===a&&setTimeout(this.Yn.bind(this),0)}};function mp(a,b){var c=/\{z\}/g,d=/\{x\}/g,e=/\{y\}/g,f=/\{-y\}/g;return function(g){if(g)return a.replace(c,g[0].toString()).replace(d,g[1].toString()).replace(e,function(){return(-g[2]-1).toString()}).replace(f,function(){var a=b.Ok?b.Ok[g[0]]:null;yf(a,55);return(a.bb-a.Sa+1+g[2]).toString()})}}function np(a,b){for(var c=a.length,d=Array(c),e=0;e<c;++e)d[e]=mp(a[e],b);return op(d)}function op(a){return 1===a.length?a[0]:function(b,c,d){if(b)return a[Jf((b[1]<<b[0])+b[2],a.length)](b,c,d)}}
function pp(){}function qp(a){var b=[],c=/\{([a-z])-([a-z])\}/.exec(a);if(c){var d=c[2].charCodeAt(0),e;for(e=c[1].charCodeAt(0);e<=d;++e)b.push(a.replace(c[0],String.fromCharCode(e)));return b}if(c=c=/\{(\d+)-(\d+)\}/.exec(a)){d=parseInt(c[2],10);for(e=parseInt(c[1],10);e<=d;e++)b.push(a.replace(c[0],e.toString()));return b}b.push(a);return b};function rp(a){this.Te=void 0!==a.Te?a.Te:0;this.Ub=a.Kd;yf(hf(this.Ub,function(a,b){return b-a}),17);var b;if(!a.Gn)for(var c=0,d=this.Ub.length-1;c<d;++c)if(!b)b=this.Ub[c]/this.Ub[c+1];else if(this.Ub[c]/this.Ub[c+1]!==b){b=void 0;break}this.Oo=b;this.Cc=this.Ub.length-1;this.ie=void 0!==a.origin?a.origin:null;this.ul=null;void 0!==a.Gn&&(this.ul=a.Gn,yf(this.ul.length==this.Ub.length,20));b=a.aa;void 0===b||this.ie||this.ul||(this.ie=Fg(b));yf(!this.ie&&this.ul||this.ie&&!this.ul,18);this.dm=
null;void 0!==a.hs&&(this.dm=a.hs,yf(this.dm.length==this.Ub.length,19));this.gs=void 0!==a.xh?a.xh:this.dm?null:256;yf(!this.gs&&this.dm||this.gs&&!this.dm,22);this.Rg=void 0!==b?b:null;this.Ok=null;this.fm=[0,0];void 0!==a.sizes?this.Ok=a.sizes.map(function(a){return new Al(Math.min(0,a[0]),Math.max(a[0]-1,-1),Math.min(0,a[1]),Math.max(a[1]-1,-1))},this):b&&sp(this,b)}var tp=[0,0,0];
function Kl(a,b,c,d,e){var f,g,h=null,k=b[0]-1;2===a.Oo?(f=b[1],g=b[2]):h=Ml(a,b,e);for(;k>=a.Te;){2===a.Oo?(f=Math.floor(f/2),g=Math.floor(g/2),b=Bl(f,f,g,g,d)):b=kl(a,h,k,d);if(c.call(null,k,b))return!0;--k}return!1}l=rp.prototype;l.V=function(){return this.Rg};l.lA=function(){return this.Cc};l.xu=function(){return this.Te};l.ag=function(a){return this.ie?this.ie:this.ul[a]};l.Fa=function(a){return this.Ub[a]};l.qj=function(){return this.Ub};
function Jl(a,b,c,d){if(b[0]<a.Cc){if(2===a.Oo)return a=2*b[1],b=2*b[2],Bl(a,a+1,b,b+1,c);d=Ml(a,b,d);return kl(a,d,b[0]+1,c)}return null}function Gl(a,b,c){var d=a.ag(b),e=a.Fa(b);a=Xi(Uo(a,b),a.fm);return rg(d[0]+c.Wa*a[0]*e,d[1]+c.Sa*a[1]*e,d[0]+(c.lb+1)*a[0]*e,d[1]+(c.bb+1)*a[1]*e,void 0)}function kl(a,b,c,d){up(a,b[0],b[1],c,!1,tp);var e=tp[1],f=tp[2];up(a,b[2],b[3],c,!0,tp);return Bl(e,tp[1],f,tp[2],d)}
function ml(a,b){var c=a.ag(b[0]),d=a.Fa(b[0]);a=Xi(Uo(a,b[0]),a.fm);return[c[0]+(b[1]+.5)*a[0]*d,c[1]+(b[2]+.5)*a[1]*d]}function Ml(a,b,c){var d=a.ag(b[0]),e=a.Fa(b[0]);a=Xi(Uo(a,b[0]),a.fm);var f=d[0]+b[1]*a[0]*e;b=d[1]+b[2]*a[1]*e;return rg(f,b,f+a[0]*e,b+a[1]*e,c)}
function up(a,b,c,d,e,f){var g=a.ag(d),h=a.Fa(d);a=Xi(Uo(a,d),a.fm);b=Math.floor((b-g[0])/h+(e?.5:0))/a[0];c=Math.floor((c-g[1])/h+(e?0:.5))/a[1];e?(b=Math.ceil(b)-1,c=Math.ceil(c)-1):(b=Math.floor(b),c=Math.floor(c));return bp(d,b,c,f)}function Uo(a,b){return a.gs?a.gs:a.dm[b]}function Fl(a,b,c){return Ef(af(a.Ub,b,c||0),a.Te,a.Cc)}function sp(a,b){for(var c=a.Ub.length,d=Array(c),e=a.Te;e<c;++e)d[e]=kl(a,b,e);a.Ok=d};function vp(a){var b=a.lz;if(!b){var b=wp(a),c=xp(b,void 0,void 0),b=new rp({aa:b,origin:Fg(b),Kd:c,xh:void 0});a.lz=b}return b}function yp(a){var b={};Gd(b,void 0!==a?a:{});void 0===b.aa&&(b.aa=ih("EPSG:3857").V());b.Kd=xp(b.aa,b.Cc,b.xh);delete b.Cc;return new rp(b)}function xp(a,b,c){b=void 0!==b?b:42;var d=Ag(a);a=zg(a);c=Xi(void 0!==c?c:256);c=Math.max(a/c[0],d/c[1]);b+=1;d=Array(b);for(a=0;a<b;++a)d[a]=c/Math.pow(2,a);return d}
function wp(a){a=ih(a);var b=a.V();b||(a=180*Pg.degrees/Rg(a),b=rg(-a,-a,a,a));return b};function zp(a){this.FA=a.html};function Ap(a){be.call(this);this.Dl=ih(a.pa);this.Ky=Bp(a.nc);this.pB=a.dc;this.fa=void 0!==a.state?a.state:"ready";this.Js=void 0!==a.nb?a.nb:!1}F(Ap,be);function Bp(a){if(!a)return null;if(a instanceof zp)return function(){return[a.FA]};if(Array.isArray(a)){if(a[0]instanceof zp){var b=a.map(function(a){return a.FA});return function(){return b}}a.map(function(a){return new zp({html:a})});return function(){return a}}return"function"===typeof a?a:function(){return[a]}}l=Ap.prototype;l.yc=Dd;l.J=function(){return this.Dl};
l.ab=function(){return this.fa};l.refresh=function(){this.L()};function Cp(a,b){a.Ky=Bp(b);a.L()}l.Tr=function(a){this.fa=a;this.L()};function Dp(a){Ap.call(this,{nc:a.nc,aa:a.aa,dc:a.dc,pa:a.pa,state:a.state,nb:a.nb});this.EL=void 0!==a.Xe?a.Xe:!1;this.jO=void 0!==a.yg?a.yg:1;this.$b=void 0!==a.$b?a.$b:null;this.Pd=new dp(a.Sd);this.yo=[0,0];this.$g="";this.iO={transition:a.transition}}F(Dp,Ap);l=Dp.prototype;l.Ih=function(){return this.Pd.Ih()};l.Lk=function(a,b){(a=this.bn(a))&&a.Lk(b)};
function dl(a,b,c,d,e){a=a.bn(b);if(!a)return!1;b=!0;for(var f,g,h=d.Wa;h<=d.lb;++h)for(var k=d.Sa;k<=d.bb;++k)f=c+"/"+h+"/"+k,g=!1,Fk(a,f)&&(f=a.get(f),(g=2===f.ab())&&(g=!1!==e(f))),g||(b=!1);return b}l.qu=function(){return 0};l.getKey=function(){return this.$g};function Ep(a,b){a.$g!==b&&(a.$g=b,a.L())}l.yu=function(){return this.EL};l.qj=function(){return this.$b.qj()};l.Pe=function(a){return this.$b?this.$b:vp(a)};l.bn=function(a){var b=this.J();return b&&!qh(b,a)?null:this.Pd};l.cn=function(){return this.jO};
function Ll(a,b,c,d){d=a.Pe(d);c=a.cn(c);b=Xi(Uo(d,b),a.yo);return 1==c?b:Wi(b,c,a.yo)}function Fp(a,b,c){var d=void 0!==c?c:a.J();c=a.Pe(d);if(a.Js&&d.gn){var e=b;b=e[0];a=ml(c,e);d=wp(d);lg(d,a)?b=e:(e=zg(d),a[0]+=e*Math.ceil((d[0]-a[0])/e),b=up(c,a[0],a[1],b,!1,void 0))}e=b[0];d=b[1];a=b[2];if(c.xu()>e||e>c.lA())c=!1;else{var f=c.V();c=(c=f?kl(c,f,e):c.Ok?c.Ok[e]:null)?c.Xf(d,a):!0}return c?b:null}l.refresh=function(){this.Pd.clear();this.L()};l.pE=Dd;
function Gp(a,b){Wd.call(this,a);this.tile=b}F(Gp,Wd);function Hp(a){Dp.call(this,{nc:a.nc,Sd:a.Sd,aa:a.aa,dc:a.dc,Xe:a.Xe,pa:a.pa,state:a.state,$b:a.$b,yg:a.yg,nb:a.nb,transition:a.transition});this.Tc=a.Tc;this.zg=this.Oh?this.Oh.bind(this):pp;this.Fc=null;a.Fc?this.sD(a.Fc):a.url&&this.rD(a.url);a.zg&&Ip(this,a.zg);this.Qw={}}F(Hp,Dp);
Hp.prototype.pq=function(a){a=a.target;var b=I(a),c=a.ab(),d;1==c?(this.Qw[b]=!0,d="tileloadstart"):b in this.Qw&&(delete this.Qw[b],d=3==c?"tileloaderror":2==c||5==c?"tileloadend":void 0);void 0!=d&&this.dispatchEvent(new Gp(d,a))};function Ip(a,b,c){a.zg=b;ep(a.Pd);"undefined"!==typeof c?Ep(a,c):a.L()}Hp.prototype.rD=function(a){var b=this.Fc=qp(a);Ip(this,this.Oh?this.Oh.bind(this):np(b,this.$b),a)};
Hp.prototype.sD=function(a){this.Fc=a;var b=a.join("\n");Ip(this,this.Oh?this.Oh.bind(this):np(a,this.$b),b)};Hp.prototype.pE=function(a,b,c){a=a+"/"+b+"/"+c;Fk(this.Pd,a)&&this.Pd.get(a)};function Jp(a){Hp.call(this,{nc:a.nc,Sd:a.Sd,aa:a.aa,dc:a.dc,Xe:a.Xe,pa:a.pa,state:a.state,$b:a.$b,Tc:a.Tc?a.Tc:Kp,yg:a.yg,zg:a.zg,url:a.url,Fc:a.Fc,nb:a.nb,transition:a.transition});this.crossOrigin=void 0!==a.crossOrigin?a.crossOrigin:null;this.bk=void 0!==a.bk?a.bk:$o;this.ak={};this.Pw={};this.MM=a.tg;this.KM=!1}F(Jp,Hp);l=Jp.prototype;l.Ih=function(){if(this.Pd.Ih())return!0;for(var a in this.ak)if(this.ak[a].Ih())return!0;return!1};
l.Lk=function(a,b){a=this.bn(a);this.Pd.Lk(this.Pd==a?b:{});for(var c in this.ak){var d=this.ak[c];d.Lk(d==a?b:{})}};l.qu=function(a){return this.J()&&a&&!qh(this.J(),a)?0:this.ru()};l.ru=function(){return 0};l.yu=function(a){return this.J()&&a&&!qh(this.J(),a)?!1:Hp.prototype.yu.call(this,a)};l.Pe=function(a){var b=this.J();return!this.$b||b&&!qh(b,a)?(b=I(a).toString(),b in this.Pw||(this.Pw[b]=vp(a)),this.Pw[b]):this.$b};
l.bn=function(a){var b=this.J();if(!b||qh(b,a))return this.Pd;a=I(a).toString();a in this.ak||(this.ak[a]=new dp(this.Pd.highWaterMark));return this.ak[a]};function Lp(a,b,c,d,e,f,g){b=[b,c,d];e=(c=Fp(a,b,f))?a.zg(c,e,f):void 0;e=new a.bk(b,void 0!==e?0:4,void 0!==e?e:"",a.crossOrigin,a.Tc,a.iO);e.key=g;J(e,"change",a.pq,a);return e}
function ll(a,b,c,d,e,f){var g=a.J();if(g&&f&&!qh(g,f)){var h=a.bn(f);d=[b,c,d];var k;b=d[0]+"/"+d[1]+"/"+d[2];Fk(h,b)&&(k=h.get(b));c=a.getKey();if(k&&k.key==c)return k;var m=a.Pe(g),p=a.Pe(f),t=Fp(a,d,f);a=new lp(g,m,f,p,d,t,a.cn(e),a.ru(),function(a,b,c,d){return Mp(this,a,b,c,d,g)}.bind(a),a.MM,a.KM);a.key=c;k?(a.Dd=k,Zo(a),h.replace(b,a)):h.set(b,a);return a}return Mp(a,b,c,d,e,g||f)}
function Mp(a,b,c,d,e,f){var g,h=b+"/"+c+"/"+d,k=a.getKey();if(Fk(a.Pd,h)){if(g=a.Pd.get(h),g.key!=k){var m=g;g=Lp(a,b,c,d,e,f,k);0==m.ab()?g.Dd=m.Dd:g.Dd=m;Zo(g);a.Pd.replace(h,g)}}else g=Lp(a,b,c,d,e,f,k),a.Pd.set(h,g);return g}function Kp(a,b){a.na().src=b};function Np(a){a=a||{};var b=void 0!==a.pa?a.pa:"EPSG:3857",c=void 0!==a.$b?a.$b:yp({aa:wp(b),Cc:a.Cc,Te:a.Te,xh:a.xh});Jp.call(this,{nc:a.nc,Sd:a.Sd,crossOrigin:a.crossOrigin,dc:a.dc,Xe:a.Xe,pa:b,tg:a.tg,$b:c,Tc:a.Tc,yg:a.yg,zg:a.zg,url:a.url,Fc:a.Fc,nb:void 0!==a.nb?a.nb:!0,transition:a.transition})}F(Np,Jp);function Op(a){a=a||{};Np.call(this,{nc:void 0!==a.nc?a.nc:['&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.'],Sd:a.Sd,crossOrigin:void 0!==a.crossOrigin?a.crossOrigin:"anonymous",Xe:void 0!==a.Xe?a.Xe:!0,Cc:void 0!==a.Cc?a.Cc:19,tg:a.tg,Tc:a.Tc,url:void 0!==a.url?a.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",nb:a.nb})}F(Op,Np);function Pp(a){this.mh=a.opacity;this.Ld=a.Zc;this.Md=a.rotation;this.bf=a.scale;this.Kf=a.Jf}l=Pp.prototype;l.Vg=function(){return this.mh};l.Cb=function(){return this.Md};l.Za=function(){return this.bf};l.Ql=function(a){this.mh=a};l.Rl=function(a){this.Md=a};l.Ee=function(a){this.bf=a};function Qp(a){this.uq=this.qa=this.nd=null;this.ua=void 0!==a.fill?a.fill:null;this.ie=[0,0];this.Lc=a.pC;this.Pa=void 0!==a.cb?a.cb:a.wQ;this.Hf=a.qM;this.qf=void 0!==a.angle?a.angle:0;this.ha=void 0!==a.stroke?a.stroke:null;this.dl=this.Nd=this.Uc=null;this.bp=a.ap;this.Vn(this.bp);Pp.call(this,{opacity:1,Zc:void 0!==a.Zc?a.Zc:!1,rotation:void 0!==a.rotation?a.rotation:0,scale:1,Jf:void 0!==a.Jf?a.Jf:!0})}F(Qp,Pp);l=Qp.prototype;
l.clone=function(){var a=new Qp({fill:this.ua?this.ua.clone():void 0,pC:this.pj(),cb:this.yf(),qM:this.Hf,angle:this.qf,Jf:this.Kf,stroke:this.ha?this.ha.clone():void 0,rotation:this.Cb(),Zc:this.Ld,ap:this.bp});a.Ql(this.Vg());a.Ee(this.Za());return a};l.Um=function(){return this.Uc};l.Wp=function(){return this.ua};l.Ym=function(){return this.uq};l.na=function(){return this.qa};l.$p=function(){return this.dl};l.Sk=function(){return 2};l.ag=function(){return this.ie};l.pj=function(){return this.Lc};
l.yf=function(){return this.Pa};l.$a=function(){return this.Nd};l.iq=function(){return this.ha};l.eB=function(){};l.load=function(){};l.eE=function(){};
l.Vn=function(a){var b="",c="",d=0,e=null,f=0,g,h=0;this.ha&&(g=this.ha.sa,null===g&&(g=Ik),g=al(g),h=this.ha.Qc(),void 0===h&&(h=1),e=this.ha.getLineDash(),f=this.ha.fh,Be||(e=null,f=0),c=this.ha.ei,void 0===c&&(c="round"),b=this.ha.di,void 0===b&&(b="round"),d=this.ha.ii,void 0===d&&(d=10));var k=2*(this.Pa+h)+1,b={strokeStyle:g,HD:h,size:k,lineCap:b,sb:e,lineDashOffset:f,lineJoin:c,miterLimit:d};if(void 0===a){var m=Li(k,k);this.qa=m.canvas;a=k=this.qa.width;this.yb(b,m,0,0);this.ua?this.uq=this.qa:
(m=Li(b.size,b.size),this.uq=m.canvas,this.yz(b,m,0,0))}else k=Math.round(k),(c=!this.ua)&&(m=this.yz.bind(this,b)),d=this.Qh(),m=a.add(d,k,k,this.yb.bind(this,b),m),this.qa=m.kb,this.ie=[m.offsetX,m.offsetY],a=m.kb.width,this.uq=c?m.FJ:this.qa;this.Uc=[k/2,k/2];this.Nd=[k,k];this.dl=[a,a]};
l.yb=function(a,b,c,d){var e;b.setTransform(1,0,0,1,0,0);b.translate(c,d);b.beginPath();var f=this.Lc;if(Infinity===f)b.arc(a.size/2,a.size/2,this.Pa,0,2*Math.PI,!0);else{var g=void 0!==this.Hf?this.Hf:this.Pa;g!==this.Pa&&(f*=2);for(c=0;c<=f;c++)d=2*c*Math.PI/f-Math.PI/2+this.qf,e=0===c%2?this.Pa:g,b.lineTo(a.size/2+e*Math.cos(d),a.size/2+e*Math.sin(d))}this.ua&&(c=this.ua.sa,null===c&&(c=Gk),b.fillStyle=al(c),b.fill());this.ha&&(b.strokeStyle=a.strokeStyle,b.lineWidth=a.HD,a.sb&&(b.setLineDash(a.sb),
b.lineDashOffset=a.lineDashOffset),b.lineCap=a.lineCap,b.lineJoin=a.lineJoin,b.miterLimit=a.miterLimit,b.stroke());b.closePath()};
l.yz=function(a,b,c,d){b.setTransform(1,0,0,1,0,0);b.translate(c,d);b.beginPath();c=this.Lc;if(Infinity===c)b.arc(a.size/2,a.size/2,this.Pa,0,2*Math.PI,!0);else{d=void 0!==this.Hf?this.Hf:this.Pa;d!==this.Pa&&(c*=2);var e,f,g;for(e=0;e<=c;e++)g=2*e*Math.PI/c-Math.PI/2+this.qf,f=0===e%2?this.Pa:d,b.lineTo(a.size/2+f*Math.cos(g),a.size/2+f*Math.sin(g))}b.fillStyle=Gk;b.fill();this.ha&&(b.strokeStyle=a.strokeStyle,b.lineWidth=a.HD,a.sb&&(b.setLineDash(a.sb),b.lineDashOffset=a.lineDashOffset),b.stroke());
b.closePath()};l.Qh=function(){var a=this.ha?this.ha.Qh():"-",b=this.ua?this.ua.Qh():"-";this.nd&&a==this.nd[1]&&b==this.nd[2]&&this.Pa==this.nd[3]&&this.Hf==this.nd[4]&&this.qf==this.nd[5]&&this.Lc==this.nd[6]||(this.nd=["r"+a+b+(void 0!==this.Pa?this.Pa.toString():"-")+(void 0!==this.Hf?this.Hf.toString():"-")+(void 0!==this.qf?this.qf.toString():"-")+(void 0!==this.Lc?this.Lc.toString():"-"),a,b,this.Pa,this.Hf,this.qf,this.Lc]);return this.nd[0]};function Rp(a){a=a||{};Qp.call(this,{pC:Infinity,fill:a.fill,cb:a.cb,Jf:a.Jf,stroke:a.stroke,ap:a.ap})}F(Rp,Qp);Rp.prototype.clone=function(){var a=new Rp({fill:this.ua?this.ua.clone():void 0,stroke:this.ha?this.ha.clone():void 0,cb:this.yf(),Jf:this.Kf,ap:this.bp});a.Ql(this.Vg());a.Ee(this.Za());return a};Rp.prototype.tw=function(a){this.Pa=a;this.Vn(this.bp)};function Sp(a){a=a||{};this.sa=void 0!==a.color?a.color:null;this.Td=void 0}Sp.prototype.clone=function(){var a=this.sa;return new Sp({color:a&&a.slice?a.slice():a||void 0})};Sp.prototype.Qh=function(){void 0===this.Td&&(this.Td=this.sa instanceof CanvasPattern||this.sa instanceof CanvasGradient?I(this.sa).toString():"f"+(this.sa?Zk(this.sa):"-"));return this.Td};function Tp(a){a=a||{};this.mj=null;this.Xd=Up;void 0!==a.geometry&&this.jd(a.geometry);this.ua=void 0!==a.fill?a.fill:null;this.la=void 0!==a.kb?a.kb:null;this.Jl=void 0!==a.Il?a.Il:null;this.ha=void 0!==a.stroke?a.stroke:null;this.xa=void 0!==a.text?a.text:null;this.PE=a.zIndex}l=Tp.prototype;
l.clone=function(){var a=this.j();a&&a.clone&&(a=a.clone());return new Tp({geometry:a,fill:this.ua?this.ua.clone():void 0,kb:this.na()?this.na().clone():void 0,stroke:this.ha?this.ha.clone():void 0,text:this.xa?this.xa.clone():void 0,zIndex:this.Xc()})};l.j=function(){return this.mj};l.Wp=function(){return this.ua};l.iD=function(a){this.ua=a};l.na=function(){return this.la};l.Qr=function(a){this.la=a};l.iq=function(){return this.ha};l.pD=function(a){this.ha=a};l.fo=function(a){this.xa=a};l.Xc=function(){return this.PE};
l.jd=function(a){"function"===typeof a?this.Xd=a:"string"===typeof a?this.Xd=function(b){return b.get(a)}:a?void 0!==a&&(this.Xd=function(){return a}):this.Xd=Up;this.mj=a};l.tD=function(a){this.PE=a};function Vp(a){if("function"!==typeof a){var b;Array.isArray(a)?b=a:(yf(a instanceof Tp,41),b=[a]);a=function(){return b}}return a}var Wp=null;
function Xp(){if(!Wp){var a=new Sp({color:"rgba(255,255,255,0.4)"}),b=new Tn({color:"#3399CC",width:1.25});Wp=[new Tp({kb:new Rp({fill:a,stroke:b,cb:5}),fill:a,stroke:b})]}return Wp}
function Yp(){var a={},b=[255,255,255,1],c=[0,153,255,1];a.Polygon=[new Tp({fill:new Sp({color:[255,255,255,.5]})})];a.MultiPolygon=a.Polygon;a.LineString=[new Tp({stroke:new Tn({color:b,width:5})}),new Tp({stroke:new Tn({color:c,width:3})})];a.MultiLineString=a.LineString;a.Circle=a.Polygon.concat(a.LineString);a.Point=[new Tp({kb:new Rp({cb:6,fill:new Sp({color:c}),stroke:new Tn({color:b,width:1.5})}),zIndex:Infinity})];a.MultiPoint=a.Point;a.GeometryCollection=a.Polygon.concat(a.LineString,a.Point);
return a}function Up(a){return a.j()};var Zp=document.implementation.createDocument("","",null);function $p(a){return aq(a,!1,[]).join("")}function aq(a,b,c){if(a.nodeType==Node.CDATA_SECTION_NODE||a.nodeType==Node.TEXT_NODE)b?c.push(String(a.nodeValue).replace(/(\r\n|\r|\n)/g,"")):c.push(a.nodeValue);else for(a=a.firstChild;a;a=a.nextSibling)aq(a,b,c);return c}function bq(a){return(new DOMParser).parseFromString(a,"application/xml")}function cq(a,b){return function(c,d){c=a.call(b,c,d);void 0!==c&&bf(d[d.length-1],c)}}
function dq(a,b){return function(c,d){c=a.call(void 0!==b?b:this,c,d);void 0!==c&&d[d.length-1].push(c)}}function eq(a){return function(b,c){b=a.call(this,b,c);void 0!==b&&(c[c.length-1]=b)}}function fq(a){return function(b,c){var d=a.call(this,b,c);void 0!==d&&(c=c[c.length-1],b=b.localName,(b in c?c[b]:c[b]=[]).push(d))}}function M(a,b){return function(c,d){var e=a.call(this,c,d);void 0!==e&&(d[d.length-1][void 0!==b?b:c.localName]=e)}}
function O(a){return function(b,c,d){a.call(this,b,c,d);d[d.length-1].node.appendChild(b)}}function gq(a){var b,c;return function(d,e,f){if(void 0===b){b={};var g={};g[d.localName]=a;b[d.namespaceURI]=g;c=hq(d.localName)}iq(b,c,e,f)}}function hq(a){return function(b,c,d){b=c[c.length-1].node;c=a;void 0===c&&(c=d);return Zp.createElementNS(b.namespaceURI,c)}}var jq=hq();function kq(a,b){for(var c=b.length,d=Array(c),e=0;e<c;++e)d[e]=a[b[e]];return d}
function P(a,b,c){c=void 0!==c?c:{};var d,e;d=0;for(e=a.length;d<e;++d)c[a[d]]=b;return c}function lq(a,b,c,d){for(b=b.firstElementChild;b;b=b.nextElementSibling){var e=a[b.namespaceURI];void 0!==e&&(e=e[b.localName],void 0!==e&&e.call(d,b,c))}}function mq(a,b,c,d,e){d.push(a);lq(b,c,d,e);return d.pop()}function iq(a,b,c,d,e,f){for(var g=(void 0!==e?e:c).length,h,k,m=0;m<g;++m)h=c[m],void 0!==h&&(k=b.call(f,h,d,void 0!==e?e[m]:void 0),void 0!==k&&a[k.namespaceURI][k.localName].call(f,k,h,d))}
function nq(a,b,c,d,e,f,g){e.push(a);iq(b,c,d,e,f,g);e.pop()};function oq(a,b,c){return function(d,e,f){var g=new XMLHttpRequest;g.open("GET","function"===typeof a?a(d,e,f):a,!0);"arraybuffer"==b.F()&&(g.responseType="arraybuffer");g.onload=function(){if(!g.status||200<=g.status&&300>g.status){var a=b.F(),d;"json"==a||"text"==a?d=g.responseText:"xml"==a?(d=g.responseXML)||(d=bq(g.responseText)):"arraybuffer"==a&&(d=g.response);d&&c.call(this,b.si(d,{Ic:f}),b.Br(d),null)}}.bind(this);g.onerror=function(){}.bind(this);g.send()}}
function pq(a,b){return oq(a,b,function(a){this.Rf(a)})};function qq(){return[[-Infinity,-Infinity,Infinity,Infinity]]};function rq(a){a=a||{};Ap.call(this,{nc:a.nc,dc:a.dc,pa:void 0,state:"ready",nb:void 0!==a.nb?a.nb:!0});this.un=Dd;this.Rp=a.format;this.sr=void 0==a.Mv?!0:a.Mv;this.jf=a.url;void 0!==a.hK?this.un=a.hK:void 0!==this.jf&&(yf(this.Rp,7),this.un=pq(this.jf,this.Rp));this.UN=void 0!==a.TN?a.TN:qq;var b=void 0!==a.re?a.re:!0;this.pc=b?new ao:null;this.jB=new ao;this.ge={};this.eg={};this.Gi={};this.Mk={};this.Hb=null;var c,d;a.features instanceof he?(c=a.features,d=c.P()):Array.isArray(a.features)&&(d=
a.features);b||void 0!==c||(c=new he(d));void 0!==d&&sq(this,d);void 0!==c&&tq(this,c)}F(rq,Ap);l=rq.prototype;l.xb=function(a){var b=I(a).toString();if(uq(this,b,a)){vq(this,b,a);var c=a.j();c?(b=c.V(),this.pc&&this.pc.Lb(b,a)):this.ge[b]=a;this.dispatchEvent(new wq("addfeature",a))}this.L()};function vq(a,b,c){a.Mk[b]=[J(c,"change",a.tj,a),J(c,"propertychange",a.tj,a)]}
function uq(a,b,c){var d=!0,e=c.mc();void 0!==e?e.toString()in a.eg?d=!1:a.eg[e.toString()]=c:(yf(!(b in a.Gi),30),a.Gi[b]=c);return d}l.Rf=function(a){sq(this,a);this.L()};function sq(a,b){var c,d,e,f,g=[],h=[],k=[];d=0;for(e=b.length;d<e;d++)f=b[d],c=I(f).toString(),uq(a,c,f)&&h.push(f);d=0;for(e=h.length;d<e;d++)f=h[d],c=I(f).toString(),vq(a,c,f),(b=f.j())?(c=b.V(),g.push(c),k.push(f)):a.ge[c]=f;a.pc&&a.pc.load(g,k);d=0;for(e=h.length;d<e;d++)a.dispatchEvent(new wq("addfeature",h[d]))}
function tq(a,b){var c=!1;J(a,"addfeature",function(a){c||(c=!0,b.push(a.ka),c=!1)});J(a,"removefeature",function(a){c||(c=!0,b.remove(a.ka),c=!1)});J(b,"add",function(a){c||(c=!0,this.xb(a.element),c=!1)},a);J(b,"remove",function(a){c||(c=!0,this.Jb(a.element),c=!1)},a);a.Hb=b}
l.clear=function(a){if(a){for(var b in this.Mk)this.Mk[b].forEach(Ld);this.Hb||(this.Mk={},this.eg={},this.Gi={})}else if(this.pc){this.pc.forEach(this.$v,this);for(var c in this.ge)this.$v(this.ge[c])}this.Hb&&this.Hb.clear();this.pc&&this.pc.clear();this.jB.clear();this.ge={};this.dispatchEvent(new wq("clear"));this.L()};function Pm(a,b,c,d){a.pc?eo(a.pc,b,c,d):a.Hb&&a.Hb.forEach(c,d)}l.Ca=function(){var a;this.Hb?a=this.Hb.P():this.pc&&(a=this.pc.getAll(),Jd(this.ge)||bf(a,Id(this.ge)));return a};
l.V=function(a){return this.pc.V(a)};l.qj=function(){};l.tj=function(a){a=a.target;var b=I(a).toString(),c=a.j();c?(c=c.V(),b in this.ge?(delete this.ge[b],this.pc&&this.pc.Lb(c,a)):this.pc&&this.pc.update(c,a)):b in this.ge||(this.pc&&this.pc.remove(a),this.ge[b]=a);c=a.mc();void 0!==c?(c=c.toString(),b in this.Gi?(delete this.Gi[b],this.eg[c]=a):this.eg[c]!==a&&(xq(this,a),this.eg[c]=a)):b in this.Gi||(xq(this,a),this.Gi[b]=a);this.L();this.dispatchEvent(new wq("changefeature",a))};
l.Bf=function(){return this.pc.Bf()&&Jd(this.ge)};function Om(a,b,c,d){var e=a.jB;b=a.UN(b,c);var f,g;f=0;for(g=b.length;f<g;++f){var h=b[f];eo(e,h,function(a){return qg(a.aa,h)})||(a.un.call(a,h,c,d),e.Lb(h,{aa:h.slice()}))}}l.Jb=function(a){var b=I(a).toString();b in this.ge?delete this.ge[b]:this.pc&&this.pc.remove(a);this.$v(a);this.L()};
l.$v=function(a){var b=I(a).toString();this.Mk[b].forEach(Ld);delete this.Mk[b];var c=a.mc();void 0!==c?delete this.eg[c.toString()]:delete this.Gi[b];this.dispatchEvent(new wq("removefeature",a))};function xq(a,b){for(var c in a.eg)if(a.eg[c]===b){delete a.eg[c];break}}function wq(a,b){Wd.call(this,a);this.ka=b}F(wq,Wd);function yq(a){a=a?a:{};var b=Gd({},a);delete b.style;delete b.KC;delete b.Hi;delete b.Ii;oj.call(this,b);this.Lt=void 0!==a.xG?a.xG:!1;this.$e=void 0!==a.KC?a.KC:100;this.xg=null;this.wg=void 0;this.le(a.style);this.lE=void 0!==a.Hi?a.Hi:!1;this.mE=void 0!==a.Ii?a.Ii:!1;this.Un=a.JM||"vector";this.type="VECTOR"}F(yq,oj);yq.prototype.le=function(a){this.xg=void 0!==a?a:Xp;this.wg=null===a?void 0:Vp(this.xg);this.L()};var Nm="renderOrder";function C(){B.log("nsVmap.Map");this.eC=[];this.Lv=new yi({Oa:[0,0],zoom:2});this.B=new Wo({vb:this.eC,view:this.Lv,$K:5});this.Hv=new Tp({fill:new Sp({color:"rgba(255, 255, 255, 0.3)"}),stroke:new Tn({color:"#d9534f",width:3}),kb:new Rp({cb:7,fill:new Sp({color:"#d9534f"})})});this.Cn=new he;this.Ae=new yq({map:this.B,style:this.Hv,source:new rq({features:this.Cn,re:!1}),Hi:!0,Ii:!0});this.$B=new Tp({fill:new Sp({color:"rgba(255, 255, 255, 0.3)"}),stroke:new Tn({color:"#337ab7",width:2}),kb:new Rp({cb:10,
stroke:new Tn({color:"#337ab7",width:2}),fill:new Sp({color:"rgba(255, 255, 255, 0.2)"})})});this.mi=new he;this.Fj=new yq({map:this.B,style:this.$B,source:new rq({features:this.mi,re:!1})});this.Fv=new he;this.Gv=new yq({map:this.B,style:this.$B,source:new rq({features:this.Fv,re:!1})});this.wL=new Tp({fill:new Sp({color:"rgba(30, 132, 202, 1)"}),stroke:new Tn({color:"rgba(255, 255, 255, 1)",width:2}),kb:new Rp({cb:6,stroke:new Tn({color:"rgba(255, 255, 255, 1)",width:3}),fill:new Sp({color:"rgba(30, 132, 202, 1)"})})});
this.ZB=new he;this.Dv=new yq({map:this.B,style:this.wL,source:new rq({features:this.ZB,re:!1})});this.xL=new Tp({fill:new Sp({color:"rgba(255, 255, 255, 0.2)"}),stroke:new Tn({color:"#ffcc33",width:2}),kb:new Rp({cb:6,fill:new Sp({color:"#ffcc33",width:1}),stroke:new Tn({color:"#FFFFFF"})})});this.aC=new he;this.lr=new yq({map:this.B,style:this.xL,source:new rq({features:this.aC,re:!1})});this.yL=new Tp({fill:new Sp({color:"rgba(255,255,255,0.4)"}),stroke:new Tn({color:"#3399CC",width:1.25}),kb:new Rp({cb:7,
stroke:new Tn({color:"rgba(255, 255, 255, 1)",width:2}),fill:new Sp({color:"rgba(30, 132, 202, 1)"})})});this.bC=new he;this.Ev=new yq({map:this.B,style:this.yL,source:new rq({features:this.bC,re:!1})});this.jx=[];this.Io=[];this.kx=[];this.za={};this.Jo=new he;this.lx=new yq({map:this.B,source:new rq({features:this.Jo})});this.tm();for(var a=this.B.Rc.P(),b=0;b<a.length;b++)a[b]instanceof Bj&&this.B.hd(a[b]);this.B.ac.setAttribute("id","map1");this.ki=this.An=null;this.wv=!1;this.li=[];this.ih=[];
this.Kc=[];this.ji=null;this.gr=[];this.OB=this.NB=null;B.log("nsVmap.Map.prototype.getGeomEditionModifyInteraction_");this.hr=new zq({pg:100,BA:10,features:this.bC});$(document).keydown(function(a){27===a.keyCode&&B.g().El()});this.Cf=[];this.Cf.push(this.Ev);this.Cf.push(this.lr);this.Cf.push(this.Ae);this.Cf.push(this.Fj);this.Cf.push(this.Gv);this.Cf.push(this.Dv);this.Cf.push(this.lx);B.properties.is_mobile&&this.ZD()}qa("nsVmap.Map",C);
C.prototype.Za=function(a){B.log("nsVmap.Map.prototype.getScale");a=n(a)?a:{};a.pretty=n(a.pretty)?a.pretty:!1;var b=new Mg(6378137),c=E(this.B).J(),d=Ei(E(B.g().B),[37.795275591,0]),e=th([d[0],d[1]],c,"EPSG:4326"),c=th([d[2],d[3]],c,"EPSG:4326"),b=100*Ng(e,c,b.cb);!0===a.pretty&&(b=Aq(0,b));return b};C.prototype.getScale=C.prototype.Za;function Aq(a,b){b=String(Math.round(b));a=1;for(var c=b.length-1;0<c;c--)0===a%3&&(b=b.slice(0,c)+","+b.slice(c+Math.abs(0))),a++;return"1:"+b}
C.prototype.Ee=function(a){B.log("nsVmap.Map.prototype.setScale");var b=this.Za(),c=E(this.B).Fa();a=a*c/b;Ki(E(this.B),a);b=this.Za();B.log(b)};C.prototype.setScale=C.prototype.Ee;
C.prototype.tm=function(){var a=new Qg({code:"EPSG:2154",aa:[-378305.81,6093283.21,1212610.74,7186901.68],units:"m"});lh(a);oh("EPSG:4326","EPSG:2154",this.Xs,this.ev);oh("EPSG:3857","EPSG:2154",function(a){a=th(a,"EPSG:3857","EPSG:4326");return th(a,"EPSG:4326","EPSG:2154")},function(a){a=th(a,"EPSG:2154","EPSG:4326");return th(a,"EPSG:4326","EPSG:3857")})};
C.prototype.Xs=function(a){var b=a[0],c=a[1];lc=3/180*Math.PI;a=46.5/180*Math.PI;var d=44/180*Math.PI,e=49/180*Math.PI,f=c/180*Math.PI,b=b/180*Math.PI,c=6378137/Math.sqrt(1-.006694380025712785*Math.sin(d)*Math.sin(d)),g=Math.log(Math.tan(Math.PI/4+d/2)*Math.pow((1-.08181919106*Math.sin(d))/(1+.08181919106*Math.sin(d)),.04090959553)),f=Math.log(Math.tan(Math.PI/4+f/2)*Math.pow((1-.08181919106*Math.sin(f))/(1+.08181919106*Math.sin(f)),.04090959553)),e=Math.log(6378137/Math.sqrt(1-.006694380025712785*
Math.sin(e)*Math.sin(e))*Math.cos(e)/(c*Math.cos(d)))/(g-Math.log(Math.tan(Math.PI/4+e/2)*Math.pow((1-.08181919106*Math.sin(e))/(1+.08181919106*Math.sin(e)),.04090959553))),d=c*Math.cos(d)/e*Math.exp(e*g);return[7E5+d*Math.exp(-1*e*f)*Math.sin(e*(b-lc)),66E5+d*Math.exp(-1*e*Math.log(Math.tan(Math.PI/4+a/2)*Math.pow((1-.08181919106*Math.sin(a))/(1+.08181919106*Math.sin(a)),.04090959553)))-d*Math.exp(-1*e*f)*Math.cos(e*(b-lc))]};
C.prototype.ev=function(a){Math.atanh=Math.atanh||function(a){return Math.log((1+a)/(1-a))/2};Math.tanh=Math.tanh||function(a){return Infinity===a?1:-Infinity===a?-1:(Math.exp(a)-Math.exp(-a))/(Math.exp(a)+Math.exp(-a))};var b=1/298.257222101,b=Math.sqrt(2*b-b*b),c=parseFloat(a[0]).toFixed(10)-7E5;a=parseFloat(a[1]).toFixed(10)-1.26556120499E7;var d=Math.log(1.1754255426096E7/Math.sqrt(c*c+a*a))/.725607765053267;return[(Math.atan(-c/a)/.725607765053267+3/180*Math.PI)/Math.PI*180,Math.asin(Math.tanh(d+
b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.sin(1))))))))))))))))/Math.PI*180]};C.prototype.Ol=function(a,b,c,d){B.log("nsVmap.Map.prototype.setEventOnMap");if(!n(a))return console.error("setEventOnMap: type not defined"),0;if(!n(b))return console.error("setEventOnMap: listener not defined"),0;c=n(c)?c:"";this.Ce();a=this.Ox(a,b,c);n(d)&&this.wi(d);return a};
C.prototype.setEventOnMap=C.prototype.Ol;C.prototype.Ox=function(a,b,c,d){if(!n(a))return console.error("setEventOnMap: type not defined"),0;if(!n(b))return console.error("setEventOnMap: listener not defined"),0;c=n(c)?c:"";a=this.B.on(a,b,c);this.jx.push(a);n(d)&&this.wi(d);return a};C.prototype.addEventOnMap=C.prototype.Ox;
C.prototype.sh=function(a,b){B.log("nsVmap.Map.prototype.setDrawInteraction");if(!n(a.type))return console.error("addDrawOnMap: opt_options.type not defined"),0;this.Ce();a=this.Nx(a);n(b)&&this.wi(b);return a};C.prototype.setDrawInteraction=C.prototype.sh;
C.prototype.Nx=function(a,b){if(!n(a.type))return console.error("addDrawOnMap: opt_options.type not defined"),0;a.style=n(a.style)?a.style:new Tp({fill:new Sp({color:"rgba(54,184,255,0.6)"}),stroke:new Tn({color:"rgba(0, 0, 0, 0.5)",sb:[10,10],width:2}),kb:new Rp({cb:5,stroke:new Tn({color:"rgba(0, 0, 0, 0.7)"}),fill:new Sp({color:"rgba(54,184,255,0.6)"})})});a=new Cq(a);this.Ob(a);n(b)&&this.wi(b);return a};C.prototype.addDrawInteraction=C.prototype.Nx;
function Dq(a,b,c){B.log("nsVmap.Map.prototype.setInteraction");a.Ce();a.Ob(b);n(c)&&a.wi(c)}C.prototype.Ob=function(a,b){B.log("nsVmap.Map.prototype.addInteraction");this.B.Ob(a);this.Io.push(a);n(b)&&this.wi(b);return a};C.prototype.Ce=function(){B.log("nsVmap.Map.prototype.removeActionsOnMap");for(var a=0;a<this.jx.length;a++)$d(this.jx[a]);for(a=0;a<this.Io.length;a++)n(this.Io[a].Ca)&&this.Io[a].Ca().clear(),this.B.hd(this.Io[a]);this.wi("")};C.prototype.removeActionsOnMap=C.prototype.Ce;
C.prototype.Hg=function(a){this.kx.push(a);this.B.Hg(a)};C.prototype.addOverlay=C.prototype.Hg;C.prototype.El=function(){this.Ce();this.za.hide();for(var a=0;a<this.kx.length;a++)Eq(this.kx[a]).style.display="none"};C.prototype.removeActionsAndTooltips=C.prototype.El;C.prototype.xN=function(a,b){this.Jo.clear();this.Uo(a,b)};C.prototype.setTextOverlayFeature=C.prototype.xN;
C.prototype.Uo=function(a,b){a=new Tp({kb:new Rp({cb:3,stroke:new Tn({color:"#fff"}),fill:new Sp({color:"blue"})}),text:new Fq({text:a,fill:new Sp({color:"blue"}),offsetY:-13})});b=new vd({geometry:new ii(b)});b.le(a);this.lx.s().xb(b)};C.prototype.addTextOverlayFeature=C.prototype.Uo;
function Gq(a,b){B.log("nsVmap.Map.prototype.addVectorLayer");var c=new yq({map:a.B,source:new rq({re:!1}),Hi:!0,Ii:!0});n(b)&&(n(b.style)&&c.le(b.style),n(b.aa)&&c.co(b.aa),n(b.Se)&&c.set("minResolution",b.Se),n(b.Df)&&c.set("maxResolution",b.Df),n(b.opacity)&&c.Ql(b.opacity),n(b.properties)&&ce(c,b.properties),n(b.visible)&&c.setVisible(b.visible),n(b.zIndex)&&c.tD(b.zIndex));a.Cf.push(c);return c}C.prototype.refresh=function(){B.log("nsVmap.Map.prototype.refresh");this.B.ud()};
C.prototype.refresh=C.prototype.refresh;C.prototype.rv=function(a,b,c){B.log("nsVmap.Map.prototype.locateFeatures");b=null!=b?b:!0;if(0===a.length)return 0;(null!=c?c:1)&&this.xx(a);b&&B.g().mi.clear();for(b=a.length-1;0<=b;b--)Oa(B.g().Fj.s().Ca(),a[b])&&B.g().Fj.s().Jb(a[b]),B.g().Fj.s().xb(a[b])};C.prototype.locateFeatures=C.prototype.rv;
C.prototype.aD=function(a,b,c){B.log("nsVmap.Map.prototype.selectFeatures");b=null!=b?b:!0;if(0===a.length)return 0;(null!=c?c:1)&&this.xx(a);b&&B.g().Cn.clear();for(b=a.length-1;0<=b;b--)Oa(B.g().Ae.s().Ca(),a[b])&&B.g().Ae.s().Jb(a[b]),B.g().Ae.s().xb(a[b])};C.prototype.selectFeatures=C.prototype.aD;
C.prototype.xx=function(a){B.log("nsVmap.Map.prototype.zoomOnFeatures");if(0===a.length)return 0;for(var b=[],b=jQuery.extend(!0,[],a[0].j().V()),c=a.length-1;0<=c;c--){var d=a[c].j().V();d[0]<b[0]&&(b[0]=d[0]);d[1]<b[1]&&(b[1]=d[1]);d[2]>b[2]&&(b[2]=d[2]);d[3]>b[3]&&(b[3]=d[3]);delete d}b[0]===b[2]&&(b[0]-=1E-4*b[0],b[2]+=1E-4*b[2]);b[1]===b[3]&&(b[1]-=1E-4*b[1],b[3]+=1E-4*b[3]);setTimeout(function(){Ji(E(B.g().B),b,{padding:[50,50,50,50]})})};C.prototype.zoomOnFeatures=C.prototype.xx;
C.prototype.Zp=function(){B.log("nsVmap.Map.prototype.getGPS");return null!=v.oGeoLocation?v.oGeoLocation:null};C.prototype.Wm=function(a){B.log("nsVmap.Map.prototype.getGPSPosition");var b,c=this.Zp();return null!=c?(c=c.Wg(),null!=c?b=th(c,"EPSG:4326",null!=a?a:"EPSG:4326"):$.notify("Impossible de r\u00e9cup\u00e9rer la position actuelle","error"),b):null};C.prototype.getGPSPosition=C.prototype.Wm;
C.prototype.At=function(){B.log("nsVmap.Map.prototype.centerGPSPosition");var a=this.Wm(E(B.g().B).J());null!=a&&E(B.g().B).tb(a)};C.prototype.centerGPSPosition=C.prototype.At;
C.prototype.ZD=function(){function a(){var a=b.Wm(E(B.g().B).J());b.ZB.clear();console.log("aGPSPosition: ",a);if(q(a)&&ea(a[0])&&ea(a[1])){b.Dv.s().xb(new vd({geometry:new ii(a)}));var c=b.Zp().get("accuracy"),a=new vd({geometry:new Hq(a,c)});a.le(new Tp({fill:new Sp({color:"rgba(30, 132, 202, 0.3)"}),stroke:new Tn({color:"rgba(255, 255, 255, 0)",width:2}),kb:new Rp({cb:8,stroke:new Tn({color:"rgba(255, 255, 255, 0)",width:3}),fill:new Sp({color:"rgba(30, 132, 202, 0.3)"})})}));b.Dv.s().xb(a)}}B.log("nsVmap.Map.prototype.trackGPSPosition");
var b=this,c=this.Zp();if(null!=c){c.on("change",function(){a()});setTimeout(function(){a()});var d=Date.now();this.Zp().on("error",function(){d<Date.now()-5E3&&(d=Date.now(),$.notify("Impossible de r\u00e9cup\u00e9rer la position actuelle","error"))})}};C.prototype.trackGPSPosition=C.prototype.ZD;
function Iq(){B.log("nsVmap.Map.prototype.getGeomEditionModifyTargetPixel");var a=$(".ol_geom_edit_menu_vertical_bar")[0].offsetLeft,b=$(".ol_geom_edit_menu_horizontal_bar")[0].offsetTop;return[a+1,b-38]}
C.prototype.$l=function(a,b){B.log("nsVmap.Map.prototype.startMobileDraw");this.An=b;var c=this;this.wv=!1;"MULTI"===a.substr(0,5).toUpperCase()&&(this.wv=!0,a=a.substr(5).toUpperCase());if("POINT"!==a&&"LINESTRING"!==a&&"POLYGON"!==a&&"CIRCLE"!==a)return console.error("Type non valide: ",a),null;this.ki=a;this.aC.clear();this.Kc=[];this.li=[];this.ih=[];this.gr=[];$("#mobile-draw-menu").removeClass("hidden");var d=hr();d.$applyAsync(function(){d.aDrawFeatures=c.Kc;d.aDrawType=c.ki})};
C.prototype.startMobileDraw=C.prototype.$l;function ir(a){B.log("nsVmap.Map.prototype.renderDrawTmpFeature_");jr(a);var b=hr();b.$applyAsync(function(){b.aDrawFeatures=a.Kc;b.mobileDrawUndoHistory=a.li;b.mobileDrawRedoHistory=a.ih})}function kr(a,b){B.log("nsVmap.Map.prototype.createTmpDrawGeom_");var c=null;1===b.length?c=new ii(b[0]):1<b.length&&(c=lr(a,b));return c}
function lr(a,b){B.log("nsVmap.Map.prototype.getDrawOutput_");switch(a.ki){case "POINT":return new ii(b[0]);case "LINESTRING":return new mr(b);case "POLYGON":return b=angular.copy(b),b.push(b[0]),new qi([b]);case "CIRCLE":if(2!==b.length)return null;a=(new mr(b)).cc();return new Hq(b[0],a)}}function jr(a){B.log("nsVmap.Map.prototype.displayDrawTmpFeature_");null!=a.ji&&(a.lr.s().Jb(a.ji),a.ji=null);a.ji=new vd({geometry:kr(a,a.Kc)});a.lr.s().xb(a.ji)}
C.prototype.Nk=function(){B.log("nsVmap.Map.prototype.finishMobileDraw");var a=this;if(this.wv)bootbox.dialog({message:"<h4>Valider la g\u00e9om\u00e9trie ?</h4>",buttons:{cancel:{label:"Non, annuler la saisie",className:"btn-danger width-100 margin-10",callback:function(){a.Lm()}},addPart:{label:"Ajouter une autre partie",className:"btn-primary width-100 margin-10",callback:function(){var b=new vd({geometry:kr(a,a.Kc)});a.gr.push(b);a.Kc=[];a.li=[];a.ih=[];a.ji=null}},confirm:{label:"Oui, terminer",
className:"btn-success width-100 margin-10",callback:function(){var b=new vd({geometry:kr(a,a.Kc)});a.gr.push(b);a.Lm();null!=a.An&&a.An.call(a,a.gr)}}}});else{var b=this.Lm();null!=this.An&&this.An.call(this,b)}};C.prototype.finishMobileDraw=C.prototype.Nk;C.prototype.lp=function(){B.log("nsVmap.Map.prototype.cancelMobileDraw");this.Lm()};C.prototype.cancelMobileDraw=C.prototype.lp;
C.prototype.Lm=function(){B.log("nsVmap.Map.prototype.endMobileDraw");var a=new vd({geometry:kr(this,this.Kc)});$("#mobile-draw-menu").addClass("hidden");null!=this.ji&&(this.lr.s().clear(),this.ji=null);return a};C.prototype.endMobileDraw=C.prototype.Lm;C.prototype.Aq=function(){var a=!1;q(this.Kc)&&("POINT"===this.ki?0<this.Kc.length&&(a=!0):1<this.Kc.length&&(a=!0));return a};C.prototype.isDrawFeatureComplete=C.prototype.Aq;
C.prototype.ts=function(){B.log("nsVmap.Map.prototype.undoLastChange");2<=this.li.length&&(this.ih.push(angular.copy(this.Kc)),this.Kc=angular.copy(this.li[this.li.length-2]),this.li.pop(),ir(this))};C.prototype.undoLastChange=C.prototype.ts;C.prototype.Cr=function(){B.log("nsVmap.Map.prototype.redoLastChange");1<=this.ih.length&&(this.Kc=angular.copy(this.ih[this.ih.length-1]),this.ih.pop(),ir(this))};C.prototype.redoLastChange=C.prototype.Cr;
function hr(){return angular.element($("#mobile-draw-menu")).scope()}C.prototype.GD=function(a,b){B.log("nsVmap.Map.prototype.startMobileGeomEdition");if(null==a||!a instanceof vd)return null;null!=b&&(this.NB=b);$("#mobile-geom-edit-menu").removeClass("hidden");this.OB=a;this.Ev.s().xb(a);var c=hr().$parent;c.$applyAsync(function(){c.edit_state=1});Dq(this,this.hr,"map-mobile-geom-edit-modify");this.hr.Ww(Iq(),this.B)};C.prototype.startMobileGeomEdition=C.prototype.GD;
C.prototype.Ds=function(){B.log("nsVmap.Map.prototype.validateGeomEditionModifyVertex");this.hr.sE(Iq(),this.B);var a=hr().$parent;a.$applyAsync(function(){a.edit_state=2})};C.prototype.validateGeomEditionModifyVertex=C.prototype.Ds;C.prototype.Cs=function(){B.log("nsVmap.Map.prototype.validateGeomEditionModifyGeometry");this.hr.rE(Iq(),this.B);var a=hr().$parent;a.$applyAsync(function(){a.edit_state=1})};C.prototype.validateGeomEditionModifyGeometry=C.prototype.Cs;
C.prototype.mp=function(){B.log("nsVmap.Map.prototype.cancelMobileGeomEdition");nr(this)};C.prototype.cancelMobileGeomEdition=C.prototype.mp;C.prototype.Qp=function(){B.log("nsVmap.Map.prototype.finishMobileGeomEdition");this.NB.call(this,this.OB);nr(this)};C.prototype.finishMobileGeomEdition=C.prototype.Qp;function nr(a){B.log("nsVmap.Map.prototype.endMobileGeomEdition_");$("#mobile-geom-edit-menu").addClass("hidden");a.Ev.s().clear();a.Ce()}
C.prototype.vK=function(){B.log("nsVmap.Map.prototype.mapDirective");return{restrict:"E",scope:{map:"=appMap",proj:"=appProj",currentAction:"=appAction"},controller:"AppMapController",controllerAs:"ctrl",bindToController:!0,template:'<div id="olMap"></div><div app-map-menu app-map="ctrl.map"></div>'}};
C.prototype.wK=function(){B.log("nsVmap.Map.prototype.mapMenuDirective");return{restrict:"A",scope:{map:"=appMap"},controller:"AppMapMenuController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/map/map.html"}};
C.prototype.wn=function(a,b,c){B.log("nsVmap.Map.prototype.mapController");var d=this;this.b=a;this.element=c;this.duration=1E3;this.map=this.map;this.kM=this.proj;this.Pq=[];this.map.yi("olMap");this.qt=new ic(function(){d.map.Qd();var a=d.map;a.Yi&&cancelAnimationFrame(a.Yi);a.Tx();pa()-start<d.duration&&d.qt.start()},b);a.$watchCollection(function(){return[d.element.children()[0].clientWidth,d.element.children()[0].clientHeight]},function(){d.no()});B.g().za=new or({id:"map-tooltip"});var e=0;
this.map.getLayers().on("change:length",function(){e++;var a=angular.copy(e);setTimeout(function(){e===a&&B.scope.$broadcast("layersChanged")},200)});var f=0;B.scope.$on("layersChanged",function(){function a(){f++;var a=angular.copy(f);setTimeout(function(){f===a&&B.scope.$broadcast("layersChanged")},200)}for(var b=d.map.getLayers().P(),c=0;c<b.length;c++)b[c].on("change:visible",a,d)});B.scope.$on("layersChanged",function(){B.log("oVmap event: layersChanged");B.log("nsVmap.Map.prototype.emptyLoadErrorsEvents");
for(var a=0;a<d.Pq.length;a++)$d(d.Pq[a].event);pr(d)});B.scope.$on("mapChanged",function(){B.g().Ae.s().clear();B.g().Fj.s().clear()})};C.prototype.wn.$inject=["$scope","$window","$element"];C.prototype.ob=function(){B.log("nsVmap.Map.prototype.mapMenuController")};C.prototype.ob.$inject=["$scope","$window","$element"];B.module.directive("appMap",C.prototype.vK);B.module.directive("appMapMenu",C.prototype.wK);B.module.controller("AppMapController",C.prototype.wn);
B.module.controller("AppMapMenuController",C.prototype.ob);
function pr(a){B.log("nsVmap.Map.prototype.listenLoadErrors");a.map.getLayers().forEach(function(b){b.s()instanceof qr?a.Pq.push({event:b.s().on("tileloaderror",function(b){null!=b.tile?null!=b.tile.ff?rr(a,b.tile.ff):console.error("tileloaderror: ",b.tile):console.error("tileloaderror: ",b)}),layer:b}):b.s()instanceof sr&&a.Pq.push({event:b.s().on("imageloaderror",function(b){null!=b.image?null!=b.image.ff?rr(a,b.image.ff):console.error("imageloaderror: ",b.image):console.error("imageloaderror: ",
b)}),layer:b})})}function rr(a,b){B.log("nsVmap.Map.prototype.mapController.prototype.displayLoadErrors");A({method:"GET",url:b,headers:{Accept:"application/x-vm-json"},ajaxLoader:!1,scope:a.b,success:function(a){var b=jQuery.parseXML(a.data);null!=b?console.error("Layer server error: ",b):null!=a.data&&""!==a.data?console.error("Layer server error: ",a.data):console.error("Layer server error: ",a)}})}
C.prototype.wn.prototype.no=function(){B.log("nsVmap.Map.prototype.mapController.prototype.startAnimation");start=pa();this.qt.stop();this.qt.start()};C.prototype.wn.prototype.startAnimation=C.prototype.wn.prototype.no;
C.prototype.ob.prototype.fF=function(){B.log("nsVmap.Map.prototype.mapMenuController.prototype.addMobileDrawPoint");var a=B.g(),b=tr();B.log("nsVmap.Map.prototype.addMobileDrawPoint_");"POINT"===a.ki&&(a.Kc.length=0);"CIRCLE"===a.ki&&2<=a.Kc.length&&(a.Kc.length=0);a.Kc.push(b);a.li.push(angular.copy(a.Kc));a.ih.length=0;ir(a);"POINT"===a.ki&&a.Nk();"CIRCLE"===a.ki&&2===a.Kc.length&&a.Nk()};C.prototype.ob.prototype.addMobileDrawPoint=C.prototype.ob.prototype.fF;
function tr(){B.log("nsVmap.Map.prototype.mapMenuController.prototype.getInsertTargetPosition_");var a;B.g();B.log("nsVmap.Map.prototype.getMobileDrawTargetPixel");a=$(".ol_draw_menu_vertical_bar")[0].offsetLeft;var b=$(".ol_draw_menu_horizontal_bar")[0].offsetTop;a=[a+1,b-38];return B.g().B.zc(a)}C.prototype.ob.prototype.Nk=function(){B.log("nsVmap.Map.prototype.mapMenuController.prototype.finishMobileDraw");return B.g().Nk()};C.prototype.ob.prototype.finishMobileDraw=C.prototype.ob.prototype.Nk;
C.prototype.ob.prototype.lp=function(){B.log("nsVmap.Map.prototype.mapMenuController.prototype.cancelMobileDraw");return B.g().lp()};C.prototype.ob.prototype.cancelMobileDraw=C.prototype.ob.prototype.lp;C.prototype.ob.prototype.Aq=function(){return B.g().Aq()};C.prototype.ob.prototype.isDrawFeatureComplete=C.prototype.ob.prototype.Aq;
C.prototype.ob.prototype.ou=function(){B.log("nsVmap.Map.prototype.mapMenuController.prototype.geolocateMe");var a=B.g().Wm(E(B.g().B).J());null!=a&&(E(B.g().B).tb(a),setTimeout(function(){var b=tr();if(null!=a&&null!=b){var c=a[0],d=a[1],e=b[0],b=b[1];E(B.g().B).tb([c+(c-e),d+(d-b)])}}))};C.prototype.ob.prototype.geolocateMe=C.prototype.ob.prototype.ou;C.prototype.ob.prototype.ts=function(){B.log("nsVmap.Map.prototype.mapMenuController.prototype.undoLastChange");return B.g().ts()};
C.prototype.ob.prototype.undoLastChange=C.prototype.ob.prototype.ts;C.prototype.ob.prototype.Cr=function(){B.log("nsVmap.Map.prototype.mapMenuController.prototype.redoLastChange");return B.g().Cr()};C.prototype.ob.prototype.redoLastChange=C.prototype.ob.prototype.Cr;C.prototype.ob.prototype.Ds=function(){B.log("nsVmap.Map.prototype.mapMenuController.prototype.validateGeomEditionModifyVertex");return B.g().Ds()};C.prototype.ob.prototype.validateGeomEditionModifyVertex=C.prototype.ob.prototype.Ds;
C.prototype.ob.prototype.Cs=function(){B.log("nsVmap.Map.prototype.mapMenuController.prototype.validateGeomEditionModifyGeometry");return B.g().Cs()};C.prototype.ob.prototype.validateGeomEditionModifyGeometry=C.prototype.ob.prototype.Cs;C.prototype.ob.prototype.mp=function(){B.log("nsVmap.Map.prototype.mapMenuController.prototype.cancelMobileGeomEdition");return B.g().mp()};C.prototype.ob.prototype.cancelMobileGeomEdition=C.prototype.ob.prototype.mp;
C.prototype.ob.prototype.Qp=function(){B.log("nsVmap.Map.prototype.mapMenuController.prototype.finishMobileGeomEdition");return B.g().Qp()};C.prototype.ob.prototype.finishMobileGeomEdition=C.prototype.ob.prototype.Qp;C.prototype.iI=function(){return this.B.getLayers()};C.prototype.getOpenLayersLayers=C.prototype.iI;C.prototype.sN=function(a){this.eC=a;this.B.set("layergroup",a)};C.prototype.setOpenLayersLayers=C.prototype.sN;C.prototype.jI=function(){return E(this.B)};
C.prototype.getOpenLayersView=C.prototype.jI;C.prototype.mD=function(a){this.Lv=a;this.B.zi(this.Lv)};C.prototype.setOpenLayersView=C.prototype.mD;C.prototype.hI=function(){return this.B};C.prototype.getOLMap=C.prototype.hI;C.prototype.tN=function(a){this.B=a};C.prototype.setOpenLayersMap=C.prototype.tN;C.prototype.sI=function(){return this.Ae};C.prototype.getSelectionOverlay=C.prototype.sI;C.prototype.tI=function(){return this.Cn};C.prototype.getSelectionOverlayFeatures=C.prototype.tI;
C.prototype.$H=function(){return this.Fj};C.prototype.getLocationOverlay=C.prototype.$H;C.prototype.bI=function(){return this.Fj.s()};C.prototype.getLocationOverlaySource=C.prototype.bI;C.prototype.aI=function(){return this.mi};C.prototype.getLocationOverlayFeatures=C.prototype.aI;C.prototype.nI=function(){return this.Gv};C.prototype.getPopupOverlay=C.prototype.nI;C.prototype.Zm=function(){return this.Gv.s()};C.prototype.getPopupOverlaySource=C.prototype.Zm;C.prototype.oI=function(){return this.Fv};
C.prototype.getPopupOverlayFeatures=C.prototype.oI;C.prototype.uI=function(){return this.Hv};C.prototype.getSelectionStyle=C.prototype.uI;C.prototype.vN=function(a){this.Hv=a};C.prototype.setSelectionStyle=C.prototype.vN;C.prototype.fA=function(){return angular.element($("#map1")).scope().ctrl.currentAction};C.prototype.getCurrentAction=C.prototype.fA;C.prototype.wi=function(a){angular.element($("#map1")).scope().$evalAsync(function(b){b.ctrl.currentAction=a})};C.prototype.setCurrentAction=C.prototype.wi;
C.prototype.vI=function(){return this.lx};C.prototype.getTextOverlay=C.prototype.vI;C.prototype.wI=function(){return this.Jo};C.prototype.getTextOverlayFeatures=C.prototype.wI;C.prototype.VH=function(){return this.Cf};C.prototype.getLayersToTransform=C.prototype.VH;C.prototype.TH=function(a){for(var b=this.B.getLayers().P(),c=0;c<b.length;c++)if(b[c].get("layer_id")===a)return b[c];return null};C.prototype.getLayerById=C.prototype.TH;function ur(a){be.call(this);this.options=a;this.id=a.id;this.bv=void 0!==a.bv?a.bv:!0;this.Aw=void 0!==a.Aw?a.Aw:!0;this.element=document.createElement("DIV");this.element.className=void 0!==a.className?a.className:"ol-overlay-container ol-selectable";this.element.style.position="absolute";this.cp=void 0!==a.cp?a.cp:!1;this.ep=a.ep||{};this.tt=void 0!==a.tt?a.tt:20;this.Yc={jp:"",Nq:"",Mr:"",ns:"",visible:!0};this.Vq=null;J(this,ee(vr),this.SI,this);J(this,ee(wr),this.dJ,this);J(this,ee(xr),this.iJ,
this);J(this,ee(yr),this.kJ,this);J(this,ee(zr),this.lJ,this);void 0!==a.element&&this.set(vr,a.element);this.set(xr,void 0!==a.offset?a.offset:[0,0]);this.set(zr,void 0!==a.Al?a.Al:"top-left");void 0!==a.position&&this.setPosition(a.position)}F(ur,be);function Eq(a){return a.get(vr)}l=ur.prototype;l.mc=function(){return this.id};l.g=function(){return this.get(wr)};l.Wg=function(){return this.get(yr)};l.SI=function(){for(var a=this.element;a.lastChild;)a.removeChild(a.lastChild);(a=Eq(this))&&this.element.appendChild(a)};
l.dJ=function(){this.Vq&&(Ni(this.element),Ld(this.Vq),this.Vq=null);var a=this.g();a&&(this.Vq=J(a,"postrender",this.La,this),Ar(this),a=this.Aw?a.Hn:a.In,this.bv?a.insertBefore(this.element,a.childNodes[0]||null):a.appendChild(this.element))};l.La=function(){Ar(this)};l.iJ=function(){Ar(this)};
l.kJ=function(){Ar(this);if(this.get(yr)&&this.cp){var a=this.g();if(a&&hj(a)){var b=Br(hj(a),a.$a()),c=Eq(this),d=c.offsetWidth,e=getComputedStyle(c),d=d+(parseInt(e.marginLeft,10)+parseInt(e.marginRight,10)),e=c.offsetHeight,f=getComputedStyle(c),e=e+(parseInt(f.marginTop,10)+parseInt(f.marginBottom,10)),g=Br(c,[d,e]),c=this.tt;qg(b,g)||(d=g[0]-b[0],e=b[2]-g[2],f=g[1]-b[1],g=b[3]-g[3],b=[0,0],0>d?b[0]=d-c:0>e&&(b[0]=Math.abs(e)+c),0>f?b[1]=f-c:0>g&&(b[1]=Math.abs(g)+c),0===b[0]&&0===b[1])||(c=E(a).Ka(),
c=ij(a,c),b=[c[0]+b[0],c[1]+b[1]],E(a).animate({Oa:a.zc(b),duration:this.ep.duration,Wc:this.ep.Wc}))}}};l.lJ=function(){Ar(this)};l.ib=function(a){this.set(wr,a)};l.setPosition=function(a){this.set(yr,a)};function Br(a,b){var c=a.getBoundingClientRect();a=c.left+window.pageXOffset;c=c.top+window.pageYOffset;return[a,c,a+b[0],c+b[1]]}l.setVisible=function(a){this.Yc.visible!==a&&(this.element.style.display=a?"":"none",this.Yc.visible=a)};
function Ar(a){var b=a.g(),c=a.Wg();if(b&&b.Jc&&c){var c=ij(b,c),d=b.$a(),b=a.element.style,e=a.get(xr),f=a.get(zr);a.setVisible(!0);var g=e[0],e=e[1];if("bottom-right"==f||"center-right"==f||"top-right"==f)""!==a.Yc.Nq&&(a.Yc.Nq=b.left=""),g=Math.round(d[0]-c[0]-g)+"px",a.Yc.Mr!=g&&(a.Yc.Mr=b.right=g);else{""!==a.Yc.Mr&&(a.Yc.Mr=b.right="");if("bottom-center"==f||"center-center"==f||"top-center"==f)g-=a.element.offsetWidth/2;g=Math.round(c[0]+g)+"px";a.Yc.Nq!=g&&(a.Yc.Nq=b.left=g)}if("bottom-left"==
f||"bottom-center"==f||"bottom-right"==f)""!==a.Yc.ns&&(a.Yc.ns=b.top=""),c=Math.round(d[1]-c[1]-e)+"px",a.Yc.jp!=c&&(a.Yc.jp=b.bottom=c);else{""!==a.Yc.jp&&(a.Yc.jp=b.bottom="");if("center-left"==f||"center-center"==f||"center-right"==f)e-=a.element.offsetHeight/2;c=Math.round(c[1]+e)+"px";a.Yc.ns!=c&&(a.Yc.ns=b.top=c)}}else a.setVisible(!1)}var vr="element",wr="map",xr="offset",yr="position",zr="positioning";function or(a){B.log("nsVmap.Map.MapTooltip");if(!n(a.id))return 0;this.id=a.id;this.className=n(a.className)?a.className:"map-tooltip";this.map=B.g().B;this.vj=document.createElement("div");this.vj.id=this.id;this.vj.className=this.className;this.vj.style.display="none";this.sq=new ur({element:this.vj,offset:[15,15],Al:"center-left"});this.map.Hg(this.sq);this.map.on("pointermove",function(a){this.sq.setPosition(a.Qb)},this)}C.MapTooltip=or;
or.prototype.Ja=function(a){if(!n(a))return"message not defined";this.vj.innerHTML=a;this.vj.style.display="block";this.sq.setPosition([0,0])};or.prototype.hide=function(){this.vj.style.display="none"};function Cr(a,b){B.log("nsVmap.Map.MapPopup");var c=this;this.Kv=a;this.W=B.g().B;this.Dl=E(this.W).J().Z;this.Na=[];this.nr={};Oa(B.g().Zm().Ca(),a)||B.g().Zm().xb(a);this.Fg=document.createElement("div");this.Fg.className="ol-popup";this.Ro=document.createElement("div");this.Fg.appendChild(this.Ro);this.Ni=document.createElement("div");this.Ni.className="ol-popup-buttons-container";this.Ro.appendChild(this.Ni);if(null!=B.properties.popup&&null!=B.properties.popup.style&&r(B.properties.popup.style)){for(var d=
B.properties.popup.style.replace(/<return>/g,"").split(";"),e=0;e<d.length;e++){var f=d[e].split(":");null!=f[0]&&null!=f[1]&&(this.nr[f[0]]=f[1]);delete f}for(var g in this.nr)this.Fg.style[g]=this.nr[g]}this.Oi=document.createElement("a");this.Oi.href="#";this.Oi.className="ol-popup-closer";this.Ni.appendChild(this.Oi);this.Pi=document.createElement("div");this.Pi.classList.add("popup-content");this.Ro.appendChild(this.Pi);this.Oi.onclick=function(){c.remove();return!1};B.properties.is_mobile?($("#mobile-popup-bar").removeClass("hidden"),
$("#mobile-popup-bar").append(this.Fg.children)):(this.wr=new ur({element:this.Fg,cp:!0,position:null!=b?Dr(b):Dr(a.j()),ep:{duration:250}}),this.Fg.onclick=function(){for(var a=B.g().B.fd.P(),b=0;b<a.length;b++)$(Eq(a[b])).hasClass("ol-popup")&&$(Eq(a[b])).css("z-index",10);$(c.Fg).css("z-index",11)},this.W.Hg(this.wr),this.W.on("change:view",function(){var a=this.Dl,b=this.wr.Wg();if(!n(b)||!n(a))return 0;var c=E(this.W).J().Z,a=th(b,a,c);this.wr.setPosition(a);this.Dl=c},this))}C.MapPopup=Cr;
Cr.prototype.Ja=function(a){B.log("nsVmap.Map.MapPopup.prototype.displayMessage");B.log("nsVmap.Map.MapPopup.prototype.removeMessages");this.Pi.innerHTML="";this.Qx(a)};Cr.prototype.displayMessage=Cr.prototype.Ja;Cr.prototype.Qx=function(a){B.log("nsVmap.Map.MapPopup.prototype.displayMessage");if(!n(a))return console.error("MapPopup: message not defined"),0;this.Pi.innerHTML=a;return!0};Cr.prototype.addMessage=Cr.prototype.Qx;
Cr.prototype.Sx=function(a){B.log("nsVmap.Map.MapPopup.prototype.addPhoto");if(!n(a))return console.error("MapPopup: addPhoto not defined"),0;var b=document.createElement("img");b.style.width="100px";b.src=a;null!=this.nr["min-width"]&&"0px"!==$(this.Fg).css("min-width")||$(this.Fg).css("min-width","300px");n(this.jk)||(this.jk=document.createElement("div"),this.jk.classList.add("popup-image-content"),this.jk.style.position="relative",this.jk.style["float"]="right",this.Pi.style["float"]="left",this.Pi.style.width=
"calc(100% - 100px)",this.Ro.appendChild(this.jk));this.jk.appendChild(b);return!0};Cr.prototype.addPhoto=Cr.prototype.Sx;
function Er(a,b){B.log("nsVmap.Map.MapPopup.prototype.addMessageTable");if(n(b)){var c=document.createElement("table"),d=["getPropertie"],e;for(e in b)if("feature"!==e){var f=document.createElement("tr"),g=document.createElement("td");g.className="padding-sides-5 map-popup-cell";f.appendChild(g);var h=document.createElement("td");h.className="padding-sides-5 map-popup-cell";f.appendChild(h);if(r(b[e])){B.pn(b[e],"bo_link")&&(b[e]=B.Jn(b[e],"bo_link"));b[e]=B.$sanitize(b[e]);for(var k=0;k<d.length;k++)-1!==
b[e].indexOf("{{"+d[k]+"(")&&-1!==b[e].indexOf(")}}")&&(b[e]=Fr(b[e]))}g.innerHTML=e;h.innerHTML=b[e];c.appendChild(f);delete f;delete g;delete h}a.Pi.appendChild(c)}else console.error("MapPopup: data not defined")}
function Fr(a){var b=a.substr(a.indexOf("{{")+2,a.indexOf("}}")-a.indexOf("{{")-2),c="";1<b.split(";").length&&console.error("Attention: plusieurs fonctions d\u00e9tect\u00e9es dans "+a);try{c=eval("angular.element(vitisApp.appMainDrtv).scope()."+b.split(";")[0])}catch(d){}return a=a.replace("{{"+b+"}}",c)}Cr.prototype.sm=function(a){-1===this.Na.indexOf(a)&&(this.Na.push(a),this.Gt())};Cr.prototype.addAction=Cr.prototype.sm;
Cr.prototype.yM=function(a){-1!==this.Na.indexOf(a)&&(this.Na.splice(this.Na.indexOf(a),1),this.Gt())};Cr.prototype.removeAction=Cr.prototype.yM;
Cr.prototype.Gt=function(){B.log("nsVmap.Map.MapPopup.prototype.compileActions");var a=this;n(this.Qi)&&this.Ni.removeChild(this.Qi);this.Qi=document.createElement("div");this.Qi.className="dropup";this.Qi.style.position="inherit";this.qm=document.createElement("a");this.qm.href="#";this.qm.className="ol-popup-list icon-format_list_bulleted";this.qm.addEventListener("click",function(){$(a.Ri).toggleClass("block")});$("body").click(function(b){$(a.qm)[0]!==$(b.target)[0]&&$(a.Ri).removeClass("block")});
this.Ri=document.createElement("ul");this.Ri.style="right: 0;left: inherit;";this.Ri.className="dropdown-menu";for(var b=0;b<this.Na.length;b++)this.Bx=document.createElement("li"),this.pm=document.createElement("a"),this.pm.href="#",this.pm.innerHTML=this.Na[b].content,this.pm.addEventListener("click",this.Na[b].event),this.pm.addEventListener("click",function(){$(a.Ri).removeClass("block")}),this.Ri.appendChild(this.Bx),this.Bx.appendChild(this.pm);this.Qi.appendChild(this.Ri);this.Qi.appendChild(this.qm);
this.Ni.appendChild(this.Qi)};Cr.prototype.compileActions=Cr.prototype.Gt;Cr.prototype.remove=function(a){B.log("nsVmap.Map.MapPopup.prototype.remove");a=n(a)?a:!0;this.Oi.blur();B.properties.is_mobile?($("#mobile-popup-bar").empty(),$("#mobile-popup-bar").addClass("hidden")):this.wr.setPosition(void 0);n(this.Kv)&&!1!==a&&Oa(B.g().Zm().Ca(),this.Kv)&&B.g().Zm().Jb(this.Kv);return!0};
function Dr(a){B.log("nsVmap.Map.MapPopup.prototype.getGeometryCenter");if("Polygon"===a.F())a=Qh(ti(a));else if("MultiPolygon"===a.F()){a=qd(a);for(var b=0,c=0,d=0;d<a.length;d++)b<a[d].Pk()&&(b=a[d].Pk(),c=d);a=Qh(ti(a[c]))}else if("LineString"===a.F())b=Math.round(a.T().length/2),a=a.T()[b];else if("Circle"===a.F())a=a.Ka();else if("Point"===a.F()||"MultiPoint"===a.F())a=Qh(a);else return"GeometryCollection"===a.F()?0:Qh(a);return a};function vd(a){be.call(this);this.Bd=void 0;this.zd="geometry";this.xg=null;this.wg=void 0;this.Vp=null;J(this,ee(this.zd),this.mq,this);void 0!==a&&(a instanceof Mh||!a?this.jd(a):ce(this,a))}F(vd,be);l=vd.prototype;l.clone=function(){var a=new vd(fe(this));Gr(a,this.zd);var b=this.j();b&&a.jd(b.clone());(b=this.xg)&&a.le(b);return a};l.j=function(){return this.get(this.zd)};l.mc=function(){return this.Bd};l.UI=function(){this.L()};
l.mq=function(){this.Vp&&(Ld(this.Vp),this.Vp=null);var a=this.j();a&&(this.Vp=J(a,"change",this.UI,this));this.L()};l.jd=function(a){this.set(this.zd,a)};l.le=function(a){this.wg=(this.xg=a)?Hr(a):void 0;this.L()};function Gr(a,b){Td(a,ee(a.zd),a.mq,a);a.zd=b;J(a,ee(a.zd),a.mq,a);a.mq()}function Hr(a){var b;if("function"===typeof a)b=2==a.length?function(b){return a(this,b)}:a;else{var c;Array.isArray(a)?c=a:(yf(a instanceof Tp,41),c=[a]);b=function(){return c}}return b};function Ir(){this.kz=this.Pc=null}function Jr(a,b,c){var d;c&&(d={xd:c.xd?c.xd:a.Br(b),Ic:c.Ic});return Kr(a,d)}function Kr(a,b){return Gd({xd:a.Pc,Ic:a.kz},b)}function Lr(a,b,c){var d=c?ih(c.Ic):null,e=c?ih(c.xd):null,d=d&&e&&!qh(d,e)?a instanceof Mh?(b?a.clone():a).transform(b?d:e,b?e:d):uh(a,e,d):a;if(b&&c&&void 0!==c.wG){var f=Math.pow(10,c.wG);d===a&&(d=d.clone());d.um(function(a){for(var b=0,c=a.length;b<c;++b)a[b]=Math.round(a[b]*f)/f;return a})}return d};function Mr(){Ir.call(this)}F(Mr,Ir);function Nr(a){return"string"===typeof a?(a=JSON.parse(a))?a:null:null!==a?a:null}l=Mr.prototype;l.F=function(){return"json"};l.si=function(a,b){return this.zC(Nr(a),Jr(this,a,b))};l.On=function(a,b){return this.BC(Nr(a),Jr(this,a,b))};l.Br=function(a){return this.DC(Nr(a))};l.px=function(a,b){return JSON.stringify(this.qx(a,b))};l.mm=function(a,b){return JSON.stringify(this.KE(a,b))};l.tx=function(a,b){return JSON.stringify(this.ME(a,b))};function Or(a){Mh.call(this);this.Rb=a?a:null;Pr(this)}F(Or,Mh);function Lm(a){var b=[],c,d;c=0;for(d=a.length;c<d;++c)b.push(a[c].clone());return b}function Qr(a){var b,c;if(a.Rb)for(b=0,c=a.Rb.length;b<c;++b)Td(a.Rb[b],"change",a.L,a)}function Pr(a){var b,c;if(a.Rb)for(b=0,c=a.Rb.length;b<c;++b)J(a.Rb[b],"change",a.L,a)}l=Or.prototype;l.clone=function(){var a=new Or(null),b=Lm(this.Rb);Qr(a);a.Rb=b;Pr(a);a.L();return a};
l.Vf=function(a,b,c,d){if(d<kg(this.V(),a,b))return d;var e=this.Rb,f,g;f=0;for(g=e.length;f<g;++f)d=e[f].Vf(a,b,c,d);return d};l.Xf=function(a,b){var c=this.Rb,d,e;d=0;for(e=c.length;d<e;++d)if(c[d].Xf(a,b))return!0;return!1};l.sp=function(a){sg(a);for(var b=this.Rb,c=0,d=b.length;c<d;++c)vg(a,b[c].V());return a};
l.Du=function(a){this.Yr!=this.Xa&&(Hd(this.Ai),this.Bi=0,this.Yr=this.Xa);if(0>a||0!==this.Bi&&a<this.Bi)return this;var b=a.toString();if(this.Ai.hasOwnProperty(b))return this.Ai[b];var c=[],d=this.Rb,e=!1,f,g;f=0;for(g=d.length;f<g;++f){var h=d[f],k=h.Du(a);c.push(k);k!==h&&(e=!0)}if(e)return a=new Or(null),Qr(a),a.Rb=c,Pr(a),a.L(),this.Ai[b]=a;this.Bi=a;return this};l.F=function(){return"GeometryCollection"};l.Bf=function(){return 0===this.Rb.length};
l.rotate=function(a,b){for(var c=this.Rb,d=0,e=c.length;d<e;++d)c[d].rotate(a,b);this.L()};l.scale=function(a,b,c){c||(c=Bg(this.V()));for(var d=this.Rb,e=0,f=d.length;e<f;++e)d[e].scale(a,b,c);this.L()};l.um=function(a){var b=this.Rb,c,d;c=0;for(d=b.length;c<d;++c)b[c].um(a);this.L()};l.translate=function(a,b){var c=this.Rb,d,e;d=0;for(e=c.length;d<e;++d)c[d].translate(a,b);this.L()};l.Ya=function(){Qr(this);Mh.prototype.Ya.call(this)};function Rr(a,b,c,d,e){var f=NaN,g=NaN,h=(c-b)/d;if(1===h)f=a[b],g=a[b+1];else if(2==h)f=.5*a[b]+.5*a[b+d],g=.5*a[b+1]+.5*a[b+d+1];else if(0!==h){var g=a[b],h=a[b+1],k=0,f=[0],m;for(m=b+d;m<c;m+=d){var p=a[m],t=a[m+1],k=k+Math.sqrt((p-g)*(p-g)+(t-h)*(t-h));f.push(k);g=p;h=t}c=.5*k;k=0;m=f.length;for(p=!1;k<m;)g=k+(m-k>>1),h=+$e(f[g],c),0>h?k=g+1:(m=g,p=!h);g=p?k:~k;0>g?(c=(c-f[-g-2])/(f[-g-1]-f[-g-2]),b+=(-g-2)*d,f=Kf(a[b],a[b+d],c),g=Kf(a[b+1],a[b+d+1],c)):(f=a[b+g*d],g=a[b+g*d+1])}return e?(e[0]=
f,e[1]=g,e):[f,g]};function mr(a,b){Nh.call(this);this.lu=null;this.de=this.ee=this.Xz=-1;this.zb(a,b)}F(mr,Nh);l=mr.prototype;l.clone=function(){var a=new mr(null);a.ya(this.gb,this.l.slice());return a};l.Vf=function(a,b,c,d){if(d<kg(this.V(),a,b))return d;this.de!=this.Xa&&(this.ee=Math.sqrt(Wh(this.l,0,this.l.length,this.S,0)),this.de=this.Xa);return Yh(this.l,0,this.l.length,this.S,this.ee,!1,a,b,c,d)};l.T=function(){return ci(this.l,0,this.l.length,this.S)};l.cc=function(){return Pl(this.l,0,this.l.length,this.S)};
function wm(a){if(a.Xz!=a.Xa){var b;b=Rr(a.l,0,a.l.length,a.S,a.lu);a.lu=b;a.Xz=a.Xa}return a.lu}l.Vk=function(a){var b=[];b.length=fi(this.l,0,this.l.length,this.S,a,b,0);a=new mr(null);a.ya("XY",b);return a};l.F=function(){return"LineString"};l.zb=function(a,b){a?(Sh(this,b,a,1),this.l||(this.l=[]),this.l.length=ai(this.l,0,a,this.S),this.L()):this.ya("XY",null)};l.ya=function(a,b){Rh(this,a,b);this.L()};function nd(a,b){Nh.call(this);this.Qa=[];this.de=this.ee=-1;this.zb(a,b)}F(nd,Nh);function sd(a,b){a.l?bf(a.l,b.l.slice()):a.l=b.l.slice();a.Qa.push(a.l.length);a.L()}l=nd.prototype;l.clone=function(){var a=new nd(null);a.ya(this.gb,this.l.slice(),this.Qa.slice());return a};l.Vf=function(a,b,c,d){if(d<kg(this.V(),a,b))return d;this.de!=this.Xa&&(this.ee=Math.sqrt(Xh(this.l,0,this.Qa,this.S,0)),this.de=this.Xa);return Zh(this.l,0,this.Qa,this.S,this.ee,!1,a,b,c,d)};
l.T=function(){return di(this.l,0,this.Qa,this.S)};function pd(a){var b=a.l,c=a.Qa;a=a.gb;var d=[],e=0,f,g;f=0;for(g=c.length;f<g;++f){var h=c[f],k=new mr(null);k.ya(a,b.slice(e,h));d.push(k);e=h}return d}function xm(a){var b=[],c=a.l,d=0,e=a.Qa;a=a.S;var f,g;f=0;for(g=e.length;f<g;++f){var h=e[f],d=Rr(c,d,h,a);bf(b,d);d=h}return b}
l.Vk=function(a){var b=[],c=[],d=this.l,e=this.Qa,f=this.S,g=0,h=0,k,m;k=0;for(m=e.length;k<m;++k){var p=e[k],h=fi(d,g,p,f,a,b,h);c.push(h);g=p}b.length=h;a=new nd(null);a.ya("XY",b,c);return a};l.F=function(){return"MultiLineString"};l.zb=function(a,b){a?(Sh(this,b,a,2),this.l||(this.l=[]),a=bi(this.l,0,a,this.S,this.Qa),this.l.length=0===a.length?0:a[a.length-1],this.L()):this.ya("XY",null,this.Qa)};l.ya=function(a,b,c){Rh(this,a,b);this.Qa=c;this.L()};
function Sr(a,b){var c=a.gb,d=[],e=[],f,g;f=0;for(g=b.length;f<g;++f){var h=b[f];0===f&&(c=h.gb);bf(d,h.l);e.push(d.length)}a.ya(c,d,e)};function md(a,b){Nh.call(this);this.zb(a,b)}F(md,Nh);function rd(a,b){a.l?bf(a.l,b.l):a.l=b.l.slice();a.L()}l=md.prototype;l.clone=function(){var a=new md(null);a.ya(this.gb,this.l.slice());return a};l.Vf=function(a,b,c,d){if(d<kg(this.V(),a,b))return d;var e=this.l,f=this.S,g,h,k;g=0;for(h=e.length;g<h;g+=f)if(k=Hf(a,b,e[g],e[g+1]),k<d){d=k;for(k=0;k<f;++k)c[k]=e[g+k];c.length=f}return d};l.T=function(){return ci(this.l,0,this.l.length,this.S)};
function Tr(a){if(0>=(a.l?a.l.length/a.S:0))return null;var b=new ii(null);b.ya(a.gb,a.l.slice(0*a.S,1*a.S));return b}l.pj=function(){var a=this.l,b=this.gb,c=this.S,d=[],e,f;e=0;for(f=a.length;e<f;e+=c){var g=new ii(null);g.ya(b,a.slice(e,e+c));d.push(g)}return d};l.F=function(){return"MultiPoint"};l.zb=function(a,b){a?(Sh(this,b,a,1),this.l||(this.l=[]),this.l.length=ai(this.l,0,a,this.S),this.L()):this.ya("XY",null)};l.ya=function(a,b){Rh(this,a,b);this.L()};function od(a,b){Nh.call(this);this.lc=[];this.Vz=-1;this.Wz=null;this.Fn=this.de=this.ee=-1;this.Gf=null;this.zb(a,b)}F(od,Nh);function ud(a,b){if(a.l){var c=a.l.length;bf(a.l,b.l);b=b.Qa.slice();var d,e;d=0;for(e=b.length;d<e;++d)b[d]+=c}else a.l=b.l.slice(),b=b.Qa.slice(),a.lc.push();a.lc.push(b);a.L()}l=od.prototype;l.clone=function(){for(var a=new od(null),b=this.lc.length,c=Array(b),d=0;d<b;++d)c[d]=this.lc[d].slice();a.ya(this.gb,this.l.slice(),c);return a};
l.Vf=function(a,b,c,d){if(d<kg(this.V(),a,b))return d;if(this.de!=this.Xa){var e=this.lc,f=0,g=0,h,k;h=0;for(k=e.length;h<k;++h)var m=e[h],g=Xh(this.l,f,m,this.S,g),f=m[m.length-1];this.ee=Math.sqrt(g);this.de=this.Xa}e=this.Yd();f=this.lc;g=this.S;h=this.ee;k=0;var m=[NaN,NaN],p,t;p=0;for(t=f.length;p<t;++p){var u=f[p];d=Zh(e,k,u,g,h,!0,a,b,c,d,m);k=u[u.length-1]}return d};
l.Xf=function(a,b){a:{var c=this.Yd(),d=this.lc,e=0;if(0!==d.length){var f,g;f=0;for(g=d.length;f<g;++f){var h=d[f];if(ki(c,e,h,this.S,a,b)){a=!0;break a}e=h[h.length-1]}}a=!1}return a};l.Pk=function(){var a=this.Yd(),b=this.lc,c=0,d=0,e,f;e=0;for(f=b.length;e<f;++e)var g=b[e],d=d+Uh(a,c,g,this.S),c=g[g.length-1];return d};l.T=function(a){var b;void 0!==a?(b=this.Yd().slice(),pi(b,this.lc,this.S,a)):b=this.l;return ei(b,0,this.lc,this.S)};
function ym(a){if(a.Vz!=a.Xa){var b=a.l,c=a.lc,d=a.S,e=0,f=[],g,h,k;g=0;for(h=c.length;g<h;++g){var m=c[g];k=b;var p=m[0],t=d,u=sg(void 0);k=wg(u,k,e,p,t);f.push((k[0]+k[2])/2,(k[1]+k[3])/2);e=m[m.length-1]}b=a.Yd();c=a.lc;d=a.S;g=0;h=[];m=0;for(k=c.length;m<k;++m)e=c[m],h=li(b,g,e,d,f,2*m,h),g=e[e.length-1];a.Wz=h;a.Vz=a.Xa}return a.Wz}
l.Yd=function(){if(this.Fn!=this.Xa){var a=this.l,b;a:{b=this.lc;var c,d;c=0;for(d=b.length;c<d;++c)if(!ni(a,b[c],this.S,void 0)){b=!1;break a}b=!0}b?this.Gf=a:(this.Gf=a.slice(),this.Gf.length=pi(this.Gf,this.lc,this.S));this.Fn=this.Xa}return this.Gf};l.Vk=function(a){var b=[],c=[],d=this.l,e=this.lc,f=this.S;a=Math.sqrt(a);var g=0,h=0,k,m;k=0;for(m=e.length;k<m;++k){var p=e[k],t=[],h=gi(d,g,p,f,a,b,h,t);c.push(t);g=p[p.length-1]}b.length=h;d=new od(null);d.ya("XY",b,c);return d};
function qd(a){var b=a.gb,c=a.l;a=a.lc;var d=[],e=0,f,g,h,k;f=0;for(g=a.length;f<g;++f){var m=a[f].slice(),p=m[m.length-1];if(0!==e)for(h=0,k=m.length;h<k;++h)m[h]-=e;h=new qi(null);h.ya(b,c.slice(e,p),m);d.push(h);e=p}return d}l.F=function(){return"MultiPolygon"};
l.zb=function(a,b){if(a){Sh(this,b,a,3);this.l||(this.l=[]);b=this.l;var c=this.S,d=this.lc,e=0,d=d?d:[],f=0,g,h;g=0;for(h=a.length;g<h;++g)e=bi(b,e,a[g],c,d[f]),d[f++]=e,e=e[e.length-1];d.length=f;0===d.length?this.l.length=0:(a=d[d.length-1],this.l.length=0===a.length?0:a[a.length-1]);this.L()}else this.ya("XY",null,this.lc)};l.ya=function(a,b,c){Rh(this,a,b);this.lc=c;this.L()};function Ur(a){a=a?a:{};Ir.call(this);this.Pc=ih(a.Pc?a.Pc:"EPSG:4326");a.Ic&&(this.kz=ih(a.Ic));this.zd=a.zH;this.lH=a.YP}F(Ur,Mr);function Vr(a,b){return a?Lr((0,Wr[a.type])(a),!1,b):null}function Xr(a,b){return(0,Yr[a.F()])(Lr(a,!0,b),b)}
var Wr={Point:function(a){return new ii(a.coordinates)},LineString:function(a){return new mr(a.coordinates)},Polygon:function(a){return new qi(a.coordinates)},MultiPoint:function(a){return new md(a.coordinates)},MultiLineString:function(a){return new nd(a.coordinates)},MultiPolygon:function(a){return new od(a.coordinates)},GeometryCollection:function(a,b){a=a.geometries.map(function(a){return Vr(a,b)});return new Or(a)}},Yr={Point:function(a){return{type:"Point",coordinates:a.T()}},LineString:function(a){return{type:"LineString",
coordinates:a.T()}},Polygon:function(a,b){var c;b&&(c=b.QM);return{type:"Polygon",coordinates:a.T(c)}},MultiPoint:function(a){return{type:"MultiPoint",coordinates:a.T()}},MultiLineString:function(a){return{type:"MultiLineString",coordinates:a.T()}},MultiPolygon:function(a,b){var c;b&&(c=b.QM);return{type:"MultiPolygon",coordinates:a.T(c)}},GeometryCollection:function(a,b){return{type:"GeometryCollection",geometries:a.Rb.map(function(a){var c=Gd({},b);delete c.Ic;return Xr(a,c)})}},Circle:function(){return{type:"GeometryCollection",
geometries:[]}}};l=Ur.prototype;l.Yv=function(a,b){a="Feature"===a.type?a:{type:"Feature",geometry:a};b=Vr(a.geometry,b);var c=new vd;this.zd?Gr(c,this.zd):this.lH&&void 0!==a.AH&&Gr(c,a.AH);c.jd(b);void 0!==a.id&&(c.Bd=a.id,c.L());a.properties&&ce(c,a.properties);return c};l.zC=function(a,b){var c;if("FeatureCollection"===a.type){c=[];a=a.features;var d,e;d=0;for(e=a.length;d<e;++d)c.push(this.Yv(a[d],b))}else c=[this.Yv(a,b)];return c};l.BC=function(a,b){return Vr(a,b)};
l.DC=function(a){a=a.crs;var b;a?"name"==a.type?b=ih(a.properties.name):yf(!1,36):b=this.Pc;return b};l.qx=function(a,b){b=Kr(this,b);var c={type:"Feature"},d=a.mc();void 0!==d&&(c.id=d);d=a.j();c.geometry=d?Xr(d,b):null;b=fe(a);delete b[a.zd];c.properties=Jd(b)?null:b;return c};l.KE=function(a,b){b=Kr(this,b);var c=[],d,e;d=0;for(e=a.length;d<e;++d)c.push(this.qx(a[d],b));return{type:"FeatureCollection",features:c}};l.ME=function(a,b){return Xr(a,Kr(this,b))};function Zr(a){return a.getAttributeNS("http://www.w3.org/1999/xlink","href")};function $r(){}$r.prototype.read=function(a){return a instanceof Document?this.zr(a):a instanceof Node?this.Kj(a):"string"===typeof a?(a=bq(a),this.zr(a)):null};function as(a){a=$p(a);return bs(a)}function bs(a){if(a=/^\s*(true|1)|(false|0)\s*$/.exec(a))return void 0!==a[1]||!1}function cs(a){a=$p(a);a=Date.parse(a);return isNaN(a)?void 0:a/1E3}function ds(a){a=$p(a);return es(a)}function es(a){if(a=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(a))return parseFloat(a[1])}function fs(a){a=$p(a);return gs(a)}function gs(a){if(a=/^\s*(\d+)\s*$/.exec(a))return parseInt(a[1],10)}function Q(a){return $p(a).trim()}function hs(a,b){is(a,b?"1":"0")}
function js(a,b){a.appendChild(Zp.createTextNode(b.toPrecision()))}function ks(a,b){a.appendChild(Zp.createTextNode(b.toString()))}function is(a,b){a.appendChild(Zp.createTextNode(b))};function ls(){}F(ls,$r);ls.prototype.zr=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType==Node.ELEMENT_NODE)return this.Kj(a);return null};ls.prototype.Kj=function(a){return(a=mq({},ms,a,[]))?a:null};
var ns=[null,"http://www.opengis.net/ows/1.1"],ms=P(ns,{ServiceIdentification:M(function(a,b){return mq({},os,a,b)}),ServiceProvider:M(function(a,b){return mq({},ps,a,b)}),OperationsMetadata:M(function(a,b){return mq({},qs,a,b)})}),rs=P(ns,{DeliveryPoint:M(Q),City:M(Q),AdministrativeArea:M(Q),PostalCode:M(Q),Country:M(Q),ElectronicMailAddress:M(Q)}),ss=P(ns,{Value:fq(function(a){return Q(a)})}),ts=P(ns,{AllowedValues:M(function(a,b){return mq({},ss,a,b)})}),vs=P(ns,{Phone:M(function(a,b){return mq({},
us,a,b)}),Address:M(function(a,b){return mq({},rs,a,b)})}),xs=P(ns,{HTTP:M(function(a,b){return mq({},ws,a,b)})}),ws=P(ns,{Get:fq(function(a,b){var c=Zr(a);if(c)return mq({href:c},ys,a,b)}),Post:void 0}),zs=P(ns,{DCP:M(function(a,b){return mq({},xs,a,b)})}),qs=P(ns,{Operation:function(a,b){var c=a.getAttribute("name");(a=mq({},zs,a,b))&&(b[b.length-1][c]=a)}}),us=P(ns,{Voice:M(Q),Facsimile:M(Q)}),ys=P(ns,{Constraint:fq(function(a,b){var c=a.getAttribute("name");if(c)return mq({name:c},ts,a,b)})}),
As=P(ns,{IndividualName:M(Q),PositionName:M(Q),ContactInfo:M(function(a,b){return mq({},vs,a,b)})}),os=P(ns,{Abstract:M(Q),AccessConstraints:M(Q),Fees:M(Q),Title:M(Q),ServiceTypeVersion:M(Q),ServiceType:M(Q)}),ps=P(ns,{ProviderName:M(Q),ProviderSite:M(Zr),ServiceContact:M(function(a,b){return mq({},As,a,b)})});function Bs(){this.LL=new ls}F(Bs,$r);Bs.prototype.zr=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType==Node.ELEMENT_NODE)return this.Kj(a);return null};Bs.prototype.Kj=function(a){var b=a.getAttribute("version").trim(),c=this.LL.Kj(a);if(!c)return null;c.version=b;return(c=mq(c,Cs,a,[]))?c:null};function Ds(a){var b=Q(a).split(" ");if(b&&2==b.length&&(a=+b[0],b=+b[1],!isNaN(a)&&!isNaN(b)))return[a,b]}
var Es=[null,"http://www.opengis.net/wmts/1.0"],Fs=[null,"http://www.opengis.net/ows/1.1"],Cs=P(Es,{Contents:M(function(a,b){return mq({},Gs,a,b)})}),Gs=P(Es,{Layer:fq(function(a,b){return mq({},Hs,a,b)}),TileMatrixSet:fq(function(a,b){return mq({},Is,a,b)})}),Hs=P(Es,{Style:fq(function(a,b){if(b=mq({},Js,a,b))return a="true"===a.getAttribute("isDefault"),b.isDefault=a,b}),Format:fq(Q),TileMatrixSetLink:fq(function(a,b){return mq({},Ks,a,b)}),Dimension:fq(function(a,b){return mq({},Ls,a,b)}),ResourceURL:fq(function(a){var b=
a.getAttribute("format"),c=a.getAttribute("template");a=a.getAttribute("resourceType");var d={};b&&(d.format=b);c&&(d.template=c);a&&(d.resourceType=a);return d})},P(Fs,{Title:M(Q),Abstract:M(Q),WGS84BoundingBox:M(function(a,b){a=mq([],Ms,a,b);if(2==a.length)return fg(a)}),Identifier:M(Q)})),Js=P(Es,{LegendURL:fq(function(a){var b={};b.format=a.getAttribute("format");b.href=Zr(a);return b})},P(Fs,{Title:M(Q),Identifier:M(Q)})),Ks=P(Es,{TileMatrixSet:M(Q),TileMatrixSetLimits:M(function(a,b){return mq([],
Ns,a,b)})}),Ns=P(Es,{TileMatrixLimits:dq(function(a,b){return mq({},Os,a,b)})}),Os=P(Es,{TileMatrix:M(Q),MinTileRow:M(fs),MaxTileRow:M(fs),MinTileCol:M(fs),MaxTileCol:M(fs)}),Ls=P(Es,{Default:M(Q),Value:fq(Q)},P(Fs,{Identifier:M(Q)})),Ms=P(Fs,{LowerCorner:dq(Ds),UpperCorner:dq(Ds)}),Is=P(Es,{WellKnownScaleSet:M(Q),TileMatrix:fq(function(a,b){return mq({},Ps,a,b)})},P(Fs,{SupportedCRS:M(Q),Identifier:M(Q)})),Ps=P(Es,{TopLeftCorner:M(Ds),ScaleDenominator:M(ds),TileWidth:M(fs),TileHeight:M(fs),MatrixWidth:M(fs),
MatrixHeight:M(fs)},P(Fs,{Identifier:M(Q)}));function Qs(a,b){function c(){delete window[e];d.parentNode.removeChild(d)}var d=document.createElement("script"),e="olc_"+I(b);d.async=!0;d.src=a+(-1==a.indexOf("?")?"?":"&")+"jsonp="+e;var f=setTimeout(function(){c()},1E4);window[e]=function(a){clearTimeout(f);c();b(a)};document.getElementsByTagName("head")[0].appendChild(d)};function Rs(a){this.Zh=void 0!==a.wj?a.wj:!1;Jp.call(this,{Sd:a.Sd,crossOrigin:"anonymous",Xe:!0,pa:ih("EPSG:3857"),tg:a.tg,state:"loading",Tc:a.Tc,yg:this.Zh?2:1,nb:void 0!==a.nb?a.nb:!0,transition:a.transition});this.fz=void 0!==a.dj?a.dj:"en-us";this.DB=void 0!==a.Cc?a.Cc:-1;this.pF=a.key;this.HJ=a.$u;Qs("https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.HJ+"?uriScheme=https&include=ImageryProviders&key="+this.pF+"&c="+this.fz,this.XI.bind(this))}F(Rs,Jp);
Rs.prototype.XI=function(a){if(200!=a.statusCode||"OK"!=a.statusDescription||"ValidCredentials"!=a.authenticationResultCode||1!=a.resourceSets.length||1!=a.resourceSets[0].resources.length)this.Tr("error");else{var b=a.brandLogoUri;-1==b.indexOf("https")&&(b=b.replace("http","https"));var c=a.resourceSets[0].resources[0];a=-1==this.DB?c.zoomMax:this.DB;var d=this.J(),d=wp(d);this.$b=yp({aa:d,Te:c.zoomMin,Cc:a,xh:(c.imageWidth==c.imageHeight?c.imageWidth:[c.imageWidth,c.imageHeight])/(this.Zh?2:1)});
var e=this.fz,f=this.Zh;this.zg=op(c.imageUrlSubdomains.map(function(a){var b=[0,0,0],d=c.imageUrl.replace("{subdomain}",a).replace("{culture}",e);return function(a){if(a)return bp(a[0],a[1],-a[2]-1,b),a=d,f&&(a+="&dpi=d1&device=mobile"),a.replace("{quadkey}",cp(b))}}));if(c.imageryProviders){var g=jh(ih("EPSG:4326"),this.J());Cp(this,function(a){var b=[],d=a.Ma.zoom;c.imageryProviders.map(function(c){for(var e=!1,f=c.coverageAreas,h=0,k=f.length;h<k;++h){var m=f[h];if(d>=m.zoomMin&&d<=m.zoomMax&&
(m=m.bbox,m=Hg([m[1],m[0],m[3],m[2]],g),Eg(m,a.aa))){e=!0;break}}e&&b.push(c.attribution)});b.push('<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html">Terms of Use</a>');return b})}this.pB=b;this.Tr("ready")}};function Ss(a,b){var c=[];Object.keys(b).forEach(function(a){null!==b[a]&&void 0!==b[a]&&c.push(a+"="+encodeURIComponent(b[a]))});var d=c.join("&");a=a.replace(/[?&]$/,"");a=-1===a.indexOf("?")?a+"?":a+"&";return a+d};function qr(a){a=a||{};var b=a.params||{};Jp.call(this,{nc:a.nc,Sd:a.Sd,crossOrigin:a.crossOrigin,dc:a.dc,Xe:!("TRANSPARENT"in b?b.TRANSPARENT:1),pa:a.pa,tg:a.tg,bk:a.bk,$b:a.$b,Tc:a.Tc,url:a.url,Fc:a.Fc,nb:void 0!==a.nb?a.nb:!0,transition:a.transition});this.lq=void 0!==a.wA?a.wA:0;this.gc=b;this.dk=!0;this.Ml=a.rw;this.Zh=void 0!==a.wj?a.wj:!0;this.Tw=gg();this.Fo();Ep(this,Ts(this))}F(qr,Jp);l=qr.prototype;l.ru=function(){return this.lq};
l.Cu=function(a,b,c,d,e,f){var g=this.Fc;if(g){f.WIDTH=b[0];f.HEIGHT=b[1];f[this.dk?"CRS":"SRS"]=e.Z;"STYLES"in this.gc||(f.STYLES="");if(1!=d)switch(this.Ml){case "geoserver":b=90*d+.5|0;f.FORMAT_OPTIONS="FORMAT_OPTIONS"in f?f.FORMAT_OPTIONS+(";dpi:"+b):"dpi:"+b;break;case "mapserver":f.MAP_RESOLUTION=90*d;break;case "carmentaserver":case "qgis":f.DPI=90*d;break;default:yf(!1,52)}e=e.fp;this.dk&&"ne"==e.substr(0,2)&&(e=c[0],c[0]=c[1],c[1]=e,e=c[2],c[2]=c[3],c[3]=e);f.BBOX=c.join(",");return Ss(1==
g.length?g[0]:g[Jf((a[1]<<a[0])+a[2],g.length)],f)}};l.cn=function(a){return this.Zh&&void 0!==this.Ml?a:1};function Ts(a){var b=0,c=[],d;for(d in a.gc)c[b++]=d+"-"+a.gc[d];return c.join("/")}
l.Oh=function(a,b,c){var d=this.$b;d||(d=this.Pe(c));if(!(d.qj().length<=a[0])){1==b||this.Zh&&void 0!==this.Ml||(b=1);var e=d.Fa(a[0]),f=Ml(d,a,this.Tw),g=Xi(Uo(d,a[0]),this.yo),d=this.lq;if(0!==d){var h=this.yo;void 0===h&&(h=[0,0]);h[0]=g[0]+2*d;h[1]=g[1]+2*d;g=h;f=ig(f,e*d,f)}1!=b&&(g=Wi(g,b,this.yo));e={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};Gd(e,this.gc);return this.Cu(a,g,f,b,c,e)}};l.updateParams=function(a){Gd(this.gc,a);this.Fo();Ep(this,Ts(this))};
l.Fo=function(){this.dk=0<=Uf(this.gc.VERSION||"1.3.0")};function Us(a,b,c,d,e,f){Bk.call(this,a,b,c,0);this.ff=d;this.la=new Image;null!==e&&(this.la.crossOrigin=e);this.Af=null;this.state=0;this.Zu=f}F(Us,Bk);l=Us.prototype;l.na=function(){return this.la};l.Yk=function(){this.state=3;this.Ah();this.L()};l.ln=function(){void 0===this.ra&&(this.ra=Ag(this.aa)/this.la.height);this.state=2;this.Ah();this.L()};
l.load=function(){if(0==this.state||3==this.state)this.state=1,this.L(),this.Af=[Qd(this.la,"error",this.Yk,this),Qd(this.la,"load",this.ln,this)],this.Zu(this,this.ff)};l.Qr=function(a){this.la=a};l.Ah=function(){this.Af.forEach(Ld);this.Af=null};function Vs(a,b,c,d,e,f){this.bm=b;this.dr=a.V();var g=b.V(),h=g?Dg(c,g):c,g=fp(a,b,Bg(h),d);this.gm=new ip(a,b,h,this.dr,.5*g);this.Iw=d;this.Hw=c;a=kp(this.gm);this.zD=(this.Lf=f(a,g,e))?this.Lf.og:1;this.lo=this.qa=null;e=2;this.Lf&&(e=0);Bk.call(this,c,d,this.zD,e)}F(Vs,Bk);l=Vs.prototype;l.Ya=function(){1==this.state&&(Ld(this.lo),this.lo=null);Bk.prototype.Ya.call(this)};l.na=function(){return this.qa};l.J=function(){return this.bm};
l.Yn=function(){var a=this.Lf.ab();2==a&&(this.qa=hp(zg(this.Hw)/this.Iw,Ag(this.Hw)/this.Iw,this.zD,this.Lf.Fa(),0,this.Iw,this.Hw,this.gm,[{aa:this.Lf.V(),kb:this.Lf.na()}],0));this.state=a;this.L()};l.load=function(){if(0==this.state){this.state=1;this.L();var a=this.Lf.ab();2==a||3==a?this.Yn():(this.lo=J(this.Lf,"change",function(){var a=this.Lf.ab();if(2==a||3==a)Ld(this.lo),this.lo=null,this.Yn()},this),this.Lf.load())}};function Ws(a){Ap.call(this,{nc:a.nc,aa:a.aa,dc:a.dc,pa:a.pa,state:a.state});this.Ub=void 0!==a.Kd?a.Kd:null;this.rh=null;this.OC=0}F(Ws,Ap);Ws.prototype.qj=function(){return this.Ub};
Ws.prototype.na=function(a,b,c,d){var e=this.J();if(e&&d&&!qh(e,d)){if(this.rh){if(this.OC==this.Xa&&qh(this.rh.J(),d)&&this.rh.Fa()==b&&ug(this.rh.V(),a))return this.rh;this.rh.ue();this.rh=null}this.rh=new Vs(e,d,a,b,c,function(a,b,c){return Xs(this,a,b,c,e)}.bind(this));this.OC=this.Xa;return this.rh}e&&(d=e);return Xs(this,a,b,c,d)};
Ws.prototype.VI=function(a){a=a.target;switch(a.ab()){case 1:this.dispatchEvent(new Ys(Zs,a));break;case 2:this.dispatchEvent(new Ys($s,a));break;case 3:this.dispatchEvent(new Ys(at,a))}};function bt(a,b){a.na().src=b}function Ys(a,b){Wd.call(this,a);this.kb=b}F(Ys,Wd);var Zs="imageloadstart",$s="imageloadend",at="imageloaderror";function sr(a){a=a||{};Ws.call(this,{nc:a.nc,dc:a.dc,pa:a.pa,Kd:a.Kd});this.cj=void 0!==a.crossOrigin?a.crossOrigin:null;this.jf=a.url;this.Zu=void 0!==a.GA?a.GA:bt;this.gc=a.params||{};this.dk=!0;this.Fo();this.Ml=a.rw;this.Zh=void 0!==a.wj?a.wj:!0;this.la=null;this.dl=[0,0];this.af=0;this.wC=void 0!==a.ratio?a.ratio:1.5}F(sr,Ws);
function Xs(a,b,c,d,e){if(void 0===a.jf)return null;a.Ub&&(c=a.Ub[af(a.Ub,c,0)]);1==d||a.Zh&&void 0!==a.Ml||(d=1);var f=c/d,g=Bg(b),h=Cg(g,f,0,[Math.ceil(zg(b)/f),Math.ceil(Ag(b)/f)]);b=Cg(g,f,0,[Math.ceil(a.wC*zg(b)/f),Math.ceil(a.wC*Ag(b)/f)]);if((g=a.la)&&a.af==a.Xa&&g.Fa()==c&&g.og==d&&qg(g.V(),h))return g;h={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};Gd(h,a.gc);a.dl[0]=Math.round(zg(b)/f);a.dl[1]=Math.round(Ag(b)/f);e=a.Cu(b,a.dl,d,e,h);a.la=new Us(b,c,
d,e,a.cj,a.Zu);a.af=a.Xa;J(a.la,"change",a.VI,a);return a.la}
sr.prototype.Cu=function(a,b,c,d,e){yf(void 0!==this.jf,9);e[this.dk?"CRS":"SRS"]=d.Z;"STYLES"in this.gc||(e.STYLES="");if(1!=c)switch(this.Ml){case "geoserver":c=90*c+.5|0;e.FORMAT_OPTIONS="FORMAT_OPTIONS"in e?e.FORMAT_OPTIONS+(";dpi:"+c):"dpi:"+c;break;case "mapserver":e.MAP_RESOLUTION=90*c;break;case "carmentaserver":case "qgis":e.DPI=90*c;break;default:yf(!1,8)}e.WIDTH=b[0];e.HEIGHT=b[1];b=d.fp;e.BBOX=(this.dk&&"ne"==b.substr(0,2)?[a[1],a[0],a[3],a[2]]:a).join(",");return Ss(this.jf,e)};
sr.prototype.rD=function(a){a!=this.jf&&(this.jf=a,this.la=null,this.L())};sr.prototype.updateParams=function(a){Gd(this.gc,a);this.Fo();this.la=null;this.L()};sr.prototype.Fo=function(){this.dk=0<=Uf(this.gc.VERSION||"1.3.0")};function ct(a){this.DK=a.CK;rp.call(this,{aa:a.aa,origin:a.origin,Gn:a.Gn,Kd:a.Kd,xh:a.xh,hs:a.hs,sizes:a.sizes})}F(ct,rp);
function dt(a,b,c){var d=[],e=[],f=[],g=[],h=[],k=void 0!==c?c:[];c=a.SupportedCRS;c=ih(c.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||ih(c);var m=Rg(c),p="ne"==c.fp.substr(0,2);a.TileMatrix.sort(function(a,b){return b.ScaleDenominator-a.ScaleDenominator});a.TileMatrix.forEach(function(a){if(0<k.length?cf(k,function(b){return a.Identifier==b.TileMatrix}):1){e.push(a.Identifier);var b=2.8E-4*a.ScaleDenominator/m,c=a.TileWidth,t=a.TileHeight;p?f.push([a.TopLeftCorner[1],a.TopLeftCorner[0]]):
f.push(a.TopLeftCorner);d.push(b);g.push(c==t?c:[c,t]);h.push([a.MatrixWidth,-a.MatrixHeight])}});return new ct({aa:b,Gn:f,Kd:d,CK:e,hs:g,sizes:h})};function et(a){this.bP=void 0!==a.version?a.version:"1.0.0";this.Rp=void 0!==a.format?a.format:"image/jpeg";this.Rt=void 0!==a.nz?a.nz:{};this.Mq=a.layer;this.EK=a.Zq;this.xg=a.style;var b=a.Fc;void 0===b&&void 0!==a.url&&(b=qp(a.url));var c=this.NM=void 0!==a.Zn?a.Zn:"KVP",d=a.$b,e={layer:this.Mq,style:this.xg,tilematrixset:this.EK};"KVP"==c&&Gd(e,{Service:"WMTS",Request:"GetTile",Version:this.bP,Format:this.Rp});var f=this.Rt;this.ez=function(a){a="KVP"==c?Ss(a,e):a.replace(/\{(\w+?)\}/g,function(a,
b){return b.toLowerCase()in e?e[b.toLowerCase()]:a});return function(b){if(b){var e={TileMatrix:d.DK[b[0]],TileCol:b[1],TileRow:-b[2]-1};Gd(e,f);b=a;return b="KVP"==c?Ss(b,e):b.replace(/\{(\w+?)\}/g,function(a,b){return e[b]})}}};var g=b&&0<b.length?op(b.map(this.ez)):pp;Jp.call(this,{nc:a.nc,Sd:a.Sd,crossOrigin:a.crossOrigin,dc:a.dc,pa:a.pa,tg:a.tg,bk:a.bk,$b:d,Tc:a.Tc,yg:a.yg,zg:g,Fc:b,nb:void 0!==a.nb?a.nb:!1,transition:a.transition});Ep(this,ft(this))}F(et,Jp);
et.prototype.sD=function(a){this.Fc=a;var b=a.join("\n");Ip(this,this.Oh?this.Oh.bind(this):op(a.map(this.ez.bind(this))),b)};et.prototype.Kb=function(){return this.Mq};function ft(a){var b=0,c=[],d;for(d in a.Rt)c[b++]=d+"-"+a.Rt[d];return c.join("/")}
function gt(a,b){var c=cf(a.Contents.Layer,function(a){return a.Identifier==b.layer});if(null===c)return null;var d=a.Contents.TileMatrixSet,e,f,g;e=1<c.TileMatrixSetLink.length?"projection"in b?gf(c.TileMatrixSetLink,function(a){var c=cf(d,function(b){return b.Identifier==a.TileMatrixSet}).SupportedCRS,e=ih(c.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||ih(c),f=ih(b.projection);return e&&f?qh(e,f):c==b.projection}):gf(c.TileMatrixSetLink,function(a){return a.TileMatrixSet==b.matrixSet}):
0;0>e&&(e=0);f=c.TileMatrixSetLink[e].TileMatrixSet;g=c.TileMatrixSetLink[e].TileMatrixSetLimits;var h=c.Format[0];"format"in b&&(h=b.format);e=gf(c.Style,function(a){return"style"in b?a.Title==b.style:a.isDefault});0>e&&(e=0);e=c.Style[e].Identifier;var k={};"Dimension"in c&&c.Dimension.forEach(function(a){var b=a.Identifier,c=a.Default;void 0===c&&(c=a.Value[0]);k[b]=c});var m=cf(a.Contents.TileMatrixSet,function(a){return a.Identifier==f}),p,t=m.SupportedCRS;t&&(p=ih(t.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,
"$1:$3"))||ih(t));"projection"in b&&(t=ih(b.projection),!t||p&&!qh(t,p)||(p=t));var t=c.WGS84BoundingBox,u,w;void 0!==t&&(w=ih("EPSG:4326").V(),w=t[0]==w[0]&&t[2]==w[2],u=uh(t,"EPSG:4326",p),(t=p.V())&&(qg(t,u)||(u=void 0)));g=dt(m,u,g);var x=[],m=b.requestEncoding,m=void 0!==m?m:"";if("OperationsMetadata"in a&&"GetTile"in a.OperationsMetadata)for(a=a.OperationsMetadata.GetTile.DCP.HTTP.Get,u=0,t=a.length;u<t;++u)if(a[u].Constraint){var z=cf(a[u].Constraint,function(a){return"GetEncoding"==a.name}).AllowedValues.Value;
""===m&&(m=z[0]);if("KVP"===m)0<=z.indexOf("KVP")&&x.push(a[u].href);else break}else a[u].href&&(m="KVP",x.push(a[u].href));0===x.length&&(m="REST",c.ResourceURL.forEach(function(a){"tile"===a.resourceType&&(h=a.format,x.push(a.template))}));return{Fc:x,layer:b.layer,Zq:f,format:h,pa:p,Zn:m,$b:g,style:e,nz:k,nb:w,crossOrigin:b.crossOrigin}};function ht(a){oj.call(this,a?a:{});this.type="IMAGE"}F(ht,oj);function it(a){options=a||{};a=0;options.stroke&&(a=options.stroke.Qc());Qp.call(this,{cb:options.cb,fill:options.fill,rotation:options.rotation,Zc:options.Zc});this.sa=options.color;this.sH=options.fontSize||1;this.ha=options.stroke;this.ua=options.fill;this.Pa=options.cb-a;this.Sg=options.form||"none";this.JI=options.II;this.En=[options.offsetX?options.offsetX:0,options.offsetY?options.offsetY:0];this.kq=this.Xm(options.DI)||"";var b,c=0;this.ha&&(b=Zk(this.ha.sa),c=this.ha.Qc());a=this.na();var d=
b,e=a.width;b=a.getContext("2d");b.clearRect(0,0,a.width,a.height);var f=this.ua?this.ua.sa:"#000",g=this.ha?this.ha.sa:"#000";"none"==this.Sg&&this.ha&&this.ua&&(g=this.ua.sa,f=this.ha.sa);b.setTransform(1,0,0,1,0,0);b.translate(0,0);var h;h=2*this.Pa+c+1;var k=c/2,m=e/2,p={ve:1,zl:e/2,Be:e/2};b.lineJoin="round";b.beginPath();switch(this.Sg){case "none":p.ve=1;break;case "circle":case "ban":b.arc(m,m,h/2,0,2*Math.PI,!0);break;case "poi":b.arc(m,m-.4*this.Pa,.6*this.Pa,.15*Math.PI,.85*Math.PI,!0);
b.lineTo(m-.89*.05*h,(.95+.45*.05)*h+k);b.arc(m,.95*h+k,.05*h,.85*Math.PI,.15*Math.PI,!0);p={ve:.45,zl:m,Be:m-.35*this.Pa};break;case "bubble":b.arc(m,m-.2*this.Pa,.8*this.Pa,.4*Math.PI,.6*Math.PI,!0);b.lineTo(.5*h+k,h+k);p={ve:.7,zl:m,Be:m-.2*this.Pa};break;case "marker":b.arc(m,m-.2*this.Pa,.8*this.Pa,.25*Math.PI,.75*Math.PI,!0);b.lineTo(.5*h+k,h+k);p={ve:.7,zl:m,Be:m-.2*this.Pa};break;case "coma":b.moveTo(m+.8*this.Pa,m-.2*this.Pa);b.quadraticCurveTo(.95*h+k,.75*h+k,.5*h+k,h+k);b.arc(m,m-.2*this.Pa,
.8*this.Pa,.45*Math.PI,0,!1);p={ve:.7,zl:m,Be:m-.2*this.Pa};break;default:switch(this.Sg){case "shield":m=[.05,0,.95,0,.95,.8,.5,1,.05,.8,.05,0];p.Be=.45*h+k;break;case "blazon":m=[.1,0,.9,0,.9,.8,.6,.8,.5,1,.4,.8,.1,.8,.1,0];p.ve=.8;p.Be=.4*h+k;break;case "bookmark":m=[.05,0,.95,0,.95,1,.5,.8,.05,1,.05,0];p.ve=.9;p.Be=.4*h+k;break;case "hexagon":m=[.05,.2,.5,0,.95,.2,.95,.8,.5,1,.05,.8,.05,.2];p.ve=.9;p.Be=.5*h+k;break;case "diamond":m=[.25,0,.75,0,1,.2,1,.4,.5,1,0,.4,0,.2,.25,0];p.ve=.75;p.Be=.35*
h+k;break;case "triangle":m=[0,0,1,0,.5,1,0,0];p.ve=.6;p.Be=.3*h+k;break;case "sign":m=[.5,.05,1,.95,0,.95,.5,.05];p.ve=.7;p.Be=.65*h+k;break;case "lozenge":m=[.5,0,1,.5,.5,1,0,.5,.5,0];p.ve=.7;break;default:m=[0,0,1,0,1,1,0,1,0,0]}for(var t=0;t<m.length;t+=2)b.lineTo(m[t]*h+k,m[t+1]*h+k)}b.closePath();h=p;this.ua&&(this.JI&&"none"!=this.Sg?(e=b.createLinearGradient(0,0,e/2,e),e.addColorStop(1,Zk(f)),e.addColorStop(0,Zk(g)),b.fillStyle=e):b.fillStyle=Zk(f),b.fill());this.ha&&c&&(b.strokeStyle=d,b.lineWidth=
c,b.stroke());this.kq.char&&(b.font=2*h.ve*this.Pa*this.sH+"px "+this.kq.font,b.strokeStyle=b.fillStyle,b.lineWidth=c*("none"==this.Sg?2:1),b.fillStyle=Zk(this.sa||g),b.textAlign="center",b.textBaseline="middle",f=this.kq.char,c&&"transparent"!=g&&b.strokeText(f,h.zl,h.Be),b.fillText(f,h.zl,h.Be));"ban"==this.Sg&&this.ha&&c&&(b.strokeStyle=d,b.lineWidth=c,d=this.Pa+c,c=this.Pa*Math.cos(Math.PI/4),b.moveTo(d+c,d-c),b.lineTo(d-c,d+c),b.stroke());b=this.Um();b[0]=a.width/2-this.En[0];b[1]=a.width/2-
this.En[1]}F(it,Qp);l=it.prototype;l.Ng={fonts:{},Mu:{}};l.Wp=function(){return this.ua};l.iq=function(){return this.ha};l.Xm=function(a){return a?it.prototype.Ng.Mu[a]||{font:"none","char":a.charAt(0),theme:"none",name:"none",search:""}:this.kq};
l.Qh=function(){var a=null!==this.ha?this.ha.Qh():"-",b=null!==this.ua?this.ua.Qh():"-";if(null===this.nd||a!=this.nd[1]||b!=this.nd[2]||this.Pa!=this.nd[3]||this.Sg+"-"+this.uA!=this.nd[4])this.nd=["c"+a+b+(void 0!==this.Pa?this.Pa.toString():"-")+this.Sg+"-"+this.uA,a,b,this.Pa,this.Sg+"-"+this.uA];return this.nd[0]};var jt={font:"FontAwesome",name:"FontAwesome",copyright:"SIL OFL 1.1",prefix:"fa"},kt={"fa-glass":"\uf000","fa-music":"\uf001","fa-search":"\uf002","fa-envelope-o":"\uf003","fa-heart":"\uf004","fa-star":"\uf005","fa-star-o":"\uf006","fa-user":"\uf007","fa-film":"\uf008","fa-th-large":"\uf009","fa-th":"\uf00a","fa-th-list":"\uf00b","fa-check":"\uf00c","fa-remove":"\uf00d","fa-close":"\uf00d","fa-times":"\uf00d","fa-search-plus":"\uf00e","fa-search-minus":"\uf010","fa-power-off":"\uf011","fa-signal":"\uf012",
"fa-gear":"\uf013","fa-cog":"\uf013","fa-trash-o":"\uf014","fa-home":"\uf015","fa-file-o":"\uf016","fa-clock-o":"\uf017","fa-road":"\uf018","fa-download":"\uf019","fa-arrow-circle-o-down":"\uf01a","fa-arrow-circle-o-up":"\uf01b","fa-inbox":"\uf01c","fa-play-circle-o":"\uf01d","fa-rotate-right":"\uf01e","fa-repeat":"\uf01e","fa-refresh":"\uf021","fa-list-alt":"\uf022","fa-lock":"\uf023","fa-flag":"\uf024","fa-headphones":"\uf025","fa-volume-off":"\uf026","fa-volume-down":"\uf027","fa-volume-up":"\uf028",
"fa-qrcode":"\uf029","fa-barcode":"\uf02a","fa-tag":"\uf02b","fa-tags":"\uf02c","fa-book":"\uf02d","fa-bookmark":"\uf02e","fa-print":"\uf02f","fa-camera":"\uf030","fa-font":"\uf031","fa-bold":"\uf032","fa-italic":"\uf033","fa-text-height":"\uf034","fa-text-width":"\uf035","fa-align-left":"\uf036","fa-align-center":"\uf037","fa-align-right":"\uf038","fa-align-justify":"\uf039","fa-list":"\uf03a","fa-dedent":"\uf03b","fa-outdent":"\uf03b","fa-indent":"\uf03c","fa-video-camera":"\uf03d","fa-photo":"\uf03e",
"fa-image":"\uf03e","fa-picture-o":"\uf03e","fa-pencil":"\uf040","fa-map-marker":"\uf041","fa-adjust":"\uf042","fa-tint":"\uf043","fa-edit":"\uf044","fa-pencil-square-o":"\uf044","fa-share-square-o":"\uf045","fa-check-square-o":"\uf046","fa-arrows":"\uf047","fa-step-backward":"\uf048","fa-fast-backward":"\uf049","fa-backward":"\uf04a","fa-play":"\uf04b","fa-pause":"\uf04c","fa-stop":"\uf04d","fa-forward":"\uf04e","fa-fast-forward":"\uf050","fa-step-forward":"\uf051","fa-eject":"\uf052","fa-chevron-left":"\uf053",
"fa-chevron-right":"\uf054","fa-plus-circle":"\uf055","fa-minus-circle":"\uf056","fa-times-circle":"\uf057","fa-check-circle":"\uf058","fa-question-circle":"\uf059","fa-info-circle":"\uf05a","fa-crosshairs":"\uf05b","fa-times-circle-o":"\uf05c","fa-check-circle-o":"\uf05d","fa-ban":"\uf05e","fa-arrow-left":"\uf060","fa-arrow-right":"\uf061","fa-arrow-up":"\uf062","fa-arrow-down":"\uf063","fa-mail-forward":"\uf064","fa-share":"\uf064","fa-expand":"\uf065","fa-compress":"\uf066","fa-plus":"\uf067",
"fa-minus":"\uf068","fa-asterisk":"\uf069","fa-exclamation-circle":"\uf06a","fa-gift":"\uf06b","fa-leaf":"\uf06c","fa-fire":"\uf06d","fa-eye":"\uf06e","fa-eye-slash":"\uf070","fa-warning":"\uf071","fa-exclamation-triangle":"\uf071","fa-plane":"\uf072","fa-calendar":"\uf073","fa-random":"\uf074","fa-comment":"\uf075","fa-magnet":"\uf076","fa-chevron-up":"\uf077","fa-chevron-down":"\uf078","fa-retweet":"\uf079","fa-shopping-cart":"\uf07a","fa-folder":"\uf07b","fa-folder-open":"\uf07c","fa-arrows-v":"\uf07d",
"fa-arrows-h":"\uf07e","fa-bar-t-o":"\uf080","fa-bar-t":"\uf080","fa-twitter-square":"\uf081","fa-facebook-square":"\uf082","fa-camera-retro":"\uf083","fa-key":"\uf084","fa-gears":"\uf085","fa-cogs":"\uf085","fa-comments":"\uf086","fa-thumbs-o-up":"\uf087","fa-thumbs-o-down":"\uf088","fa-star-half":"\uf089","fa-heart-o":"\uf08a","fa-sign-out":"\uf08b","fa-linkedin-square":"\uf08c","fa-thumb-tack":"\uf08d","fa-external-link":"\uf08e","fa-sign-in":"\uf090","fa-trophy":"\uf091","fa-github-square":"\uf092",
"fa-upload":"\uf093","fa-lemon-o":"\uf094","fa-phone":"\uf095","fa-square-o":"\uf096","fa-bookmark-o":"\uf097","fa-phone-square":"\uf098","fa-twitter":"\uf099","fa-facebook-f":"\uf09a","fa-facebook":"\uf09a","fa-github":"\uf09b","fa-unlock":"\uf09c","fa-credit-card":"\uf09d","fa-feed":"\uf09e","fa-rss":"\uf09e","fa-hdd-o":"\uf0a0","fa-bullhorn":"\uf0a1","fa-bell":"\uf0f3","fa-certificate":"\uf0a3","fa-hand-o-right":"\uf0a4","fa-hand-o-left":"\uf0a5","fa-hand-o-up":"\uf0a6","fa-hand-o-down":"\uf0a7",
"fa-arrow-circle-left":"\uf0a8","fa-arrow-circle-right":"\uf0a9","fa-arrow-circle-up":"\uf0aa","fa-arrow-circle-down":"\uf0ab","fa-globe":"\uf0ac","fa-wrench":"\uf0ad","fa-tasks":"\uf0ae","fa-filter":"\uf0b0","fa-briefcase":"\uf0b1","fa-arrows-alt":"\uf0b2","fa-group":"\uf0c0","fa-users":"\uf0c0","fa-chain":"\uf0c1","fa-link":"\uf0c1","fa-cloud":"\uf0c2","fa-flask":"\uf0c3","fa-cut":"\uf0c4","fa-scissors":"\uf0c4","fa-copy":"\uf0c5","fa-files-o":"\uf0c5","fa-paperclip":"\uf0c6","fa-save":"\uf0c7",
"fa-floppy-o":"\uf0c7","fa-square":"\uf0c8","fa-navicon":"\uf0c9","fa-reorder":"\uf0c9","fa-bars":"\uf0c9","fa-list-ul":"\uf0ca","fa-list-ol":"\uf0cb","fa-strikethrough":"\uf0cc","fa-underline":"\uf0cd","fa-table":"\uf0ce","fa-magic":"\uf0d0","fa-truck":"\uf0d1","fa-pinterest":"\uf0d2","fa-pinterest-square":"\uf0d3","fa-google-plus-square":"\uf0d4","fa-google-plus":"\uf0d5","fa-money":"\uf0d6","fa-caret-down":"\uf0d7","fa-caret-up":"\uf0d8","fa-caret-left":"\uf0d9","fa-caret-right":"\uf0da","fa-columns":"\uf0db",
"fa-unsorted":"\uf0dc","fa-sort":"\uf0dc","fa-sort-down":"\uf0dd","fa-sort-desc":"\uf0dd","fa-sort-up":"\uf0de","fa-sort-asc":"\uf0de","fa-envelope":"\uf0e0","fa-linkedin":"\uf0e1","fa-rotate-left":"\uf0e2","fa-undo":"\uf0e2","fa-legal":"\uf0e3","fa-gavel":"\uf0e3","fa-dashboard":"\uf0e4","fa-tachometer":"\uf0e4","fa-comment-o":"\uf0e5","fa-comments-o":"\uf0e6","fa-flash":"\uf0e7","fa-bolt":"\uf0e7","fa-sitemap":"\uf0e8","fa-umbrella":"\uf0e9","fa-paste":"\uf0ea","fa-clipboard":"\uf0ea","fa-lightbulb-o":"\uf0eb",
"fa-exchange":"\uf0ec","fa-cloud-download":"\uf0ed","fa-cloud-upload":"\uf0ee","fa-user-md":"\uf0f0","fa-stethoscope":"\uf0f1","fa-suitcase":"\uf0f2","fa-bell-o":"\uf0a2","fa-coffee":"\uf0f4","fa-cutlery":"\uf0f5","fa-file-text-o":"\uf0f6","fa-building-o":"\uf0f7","fa-hospital-o":"\uf0f8","fa-ambulance":"\uf0f9","fa-medkit":"\uf0fa","fa-fighter-jet":"\uf0fb","fa-beer":"\uf0fc","fa-h-square":"\uf0fd","fa-plus-square":"\uf0fe","fa-angle-double-left":"\uf100","fa-angle-double-right":"\uf101","fa-angle-double-up":"\uf102",
"fa-angle-double-down":"\uf103","fa-angle-left":"\uf104","fa-angle-right":"\uf105","fa-angle-up":"\uf106","fa-angle-down":"\uf107","fa-desktop":"\uf108","fa-laptop":"\uf109","fa-tablet":"\uf10a","fa-mobile-phone":"\uf10b","fa-mobile":"\uf10b","fa-circle-o":"\uf10c","fa-quote-left":"\uf10d","fa-quote-right":"\uf10e","fa-spinner":"\uf110","fa-circle":"\uf111","fa-mail-reply":"\uf112","fa-reply":"\uf112","fa-github-alt":"\uf113","fa-folder-o":"\uf114","fa-folder-open-o":"\uf115","fa-smile-o":"\uf118",
"fa-frown-o":"\uf119","fa-meh-o":"\uf11a","fa-gamepad":"\uf11b","fa-keyboard-o":"\uf11c","fa-flag-o":"\uf11d","fa-flag-checkered":"\uf11e","fa-terminal":"\uf120","fa-code":"\uf121","fa-mail-reply-all":"\uf122","fa-reply-all":"\uf122","fa-star-half-empty":"\uf123","fa-star-half-full":"\uf123","fa-star-half-o":"\uf123","fa-location-arrow":"\uf124","fa-crop":"\uf125","fa-code-fork":"\uf126","fa-unlink":"\uf127","fa-chain-broken":"\uf127","fa-question":"\uf128","fa-info":"\uf129","fa-exclamation":"\uf12a",
"fa-superscript":"\uf12b","fa-subscript":"\uf12c","fa-eraser":"\uf12d","fa-puzzle-piece":"\uf12e","fa-microphone":"\uf130","fa-microphone-slash":"\uf131","fa-shield":"\uf132","fa-calendar-o":"\uf133","fa-fire-extinguisher":"\uf134","fa-rocket":"\uf135","fa-maxcdn":"\uf136","fa-chevron-circle-left":"\uf137","fa-chevron-circle-right":"\uf138","fa-chevron-circle-up":"\uf139","fa-chevron-circle-down":"\uf13a","fa-html5":"\uf13b","fa-css3":"\uf13c","fa-anchor":"\uf13d","fa-unlock-alt":"\uf13e","fa-bullseye":"\uf140",
"fa-ellipsis-h":"\uf141","fa-ellipsis-v":"\uf142","fa-rss-square":"\uf143","fa-play-circle":"\uf144","fa-ticket":"\uf145","fa-minus-square":"\uf146","fa-minus-square-o":"\uf147","fa-level-up":"\uf148","fa-level-down":"\uf149","fa-check-square":"\uf14a","fa-pencil-square":"\uf14b","fa-external-link-square":"\uf14c","fa-share-square":"\uf14d","fa-compass":"\uf14e","fa-toggle-down":"\uf150","fa-caret-square-o-down":"\uf150","fa-toggle-up":"\uf151","fa-caret-square-o-up":"\uf151","fa-toggle-right":"\uf152",
"fa-caret-square-o-right":"\uf152","fa-euro":"\uf153","fa-eur":"\uf153","fa-gbp":"\uf154","fa-dollar":"\uf155","fa-usd":"\uf155","fa-rupee":"\uf156","fa-inr":"\uf156","fa-cny":"\uf157","fa-rmb":"\uf157","fa-yen":"\uf157","fa-jpy":"\uf157","fa-ruble":"\uf158","fa-rouble":"\uf158","fa-rub":"\uf158","fa-won":"\uf159","fa-krw":"\uf159","fa-bitcoin":"\uf15a","fa-btc":"\uf15a","fa-file":"\uf15b","fa-file-text":"\uf15c","fa-sort-alpha-asc":"\uf15d","fa-sort-alpha-desc":"\uf15e","fa-sort-amount-asc":"\uf160",
"fa-sort-amount-desc":"\uf161","fa-sort-numeric-asc":"\uf162","fa-sort-numeric-desc":"\uf163","fa-thumbs-up":"\uf164","fa-thumbs-down":"\uf165","fa-youtube-square":"\uf166","fa-youtube":"\uf167","fa-xing":"\uf168","fa-xing-square":"\uf169","fa-youtube-play":"\uf16a","fa-dropbox":"\uf16b","fa-stack-overflow":"\uf16c","fa-instagram":"\uf16d","fa-flickr":"\uf16e","fa-adn":"\uf170","fa-bitbucket":"\uf171","fa-bitbucket-square":"\uf172","fa-tumblr":"\uf173","fa-tumblr-square":"\uf174","fa-long-arrow-down":"\uf175",
"fa-long-arrow-up":"\uf176","fa-long-arrow-left":"\uf177","fa-long-arrow-right":"\uf178","fa-apple":"\uf179","fa-windows":"\uf17a","fa-android":"\uf17b","fa-linux":"\uf17c","fa-dribbble":"\uf17d","fa-skype":"\uf17e","fa-foursquare":"\uf180","fa-trello":"\uf181","fa-female":"\uf182","fa-male":"\uf183","fa-gittip":"\uf184","fa-gratipay":"\uf184","fa-sun-o":"\uf185","fa-moon-o":"\uf186","fa-archive":"\uf187","fa-bug":"\uf188","fa-vk":"\uf189","fa-weibo":"\uf18a","fa-renren":"\uf18b","fa-pagelines":"\uf18c",
"fa-stack-exchange":"\uf18d","fa-arrow-circle-o-right":"\uf18e","fa-arrow-circle-o-left":"\uf190","fa-toggle-left":"\uf191","fa-caret-square-o-left":"\uf191","fa-dot-circle-o":"\uf192","fa-wheelchair":"\uf193","fa-vimeo-square":"\uf194","fa-turkish-lira":"\uf195","fa-try":"\uf195","fa-plus-square-o":"\uf196","fa-space-shuttle":"\uf197","fa-slack":"\uf198","fa-envelope-square":"\uf199","fa-wordpress":"\uf19a","fa-openid":"\uf19b","fa-institution":"\uf19c","fa-bank":"\uf19c","fa-university":"\uf19c",
"fa-mortar-board":"\uf19d","fa-graduation-cap":"\uf19d","fa-yahoo":"\uf19e","fa-google":"\uf1a0","fa-reddit":"\uf1a1","fa-reddit-square":"\uf1a2","fa-stumbleupon-circle":"\uf1a3","fa-stumbleupon":"\uf1a4","fa-delicious":"\uf1a5","fa-digg":"\uf1a6","fa-pied-piper":"\uf1a7","fa-pied-piper-alt":"\uf1a8","fa-drupal":"\uf1a9","fa-joomla":"\uf1aa","fa-language":"\uf1ab","fa-fax":"\uf1ac","fa-building":"\uf1ad","fa-child":"\uf1ae","fa-paw":"\uf1b0","fa-spoon":"\uf1b1","fa-cube":"\uf1b2","fa-cubes":"\uf1b3",
"fa-behance":"\uf1b4","fa-behance-square":"\uf1b5","fa-steam":"\uf1b6","fa-steam-square":"\uf1b7","fa-recycle":"\uf1b8","fa-automobile":"\uf1b9","fa-car":"\uf1b9","fa-cab":"\uf1ba","fa-taxi":"\uf1ba","fa-tree":"\uf1bb","fa-spotify":"\uf1bc","fa-deviantart":"\uf1bd","fa-soundcloud":"\uf1be","fa-database":"\uf1c0","fa-file-pdf-o":"\uf1c1","fa-file-word-o":"\uf1c2","fa-file-excel-o":"\uf1c3","fa-file-powerpoint-o":"\uf1c4","fa-file-photo-o":"\uf1c5","fa-file-picture-o":"\uf1c5","fa-file-image-o":"\uf1c5",
"fa-file-zip-o":"\uf1c6","fa-file-archive-o":"\uf1c6","fa-file-sound-o":"\uf1c7","fa-file-audio-o":"\uf1c7","fa-file-movie-o":"\uf1c8","fa-file-video-o":"\uf1c8","fa-file-code-o":"\uf1c9","fa-vine":"\uf1ca","fa-codepen":"\uf1cb","fa-jsfiddle":"\uf1cc","fa-life-bouy":"\uf1cd","fa-life-buoy":"\uf1cd","fa-life-saver":"\uf1cd","fa-support":"\uf1cd","fa-life-ring":"\uf1cd","fa-circle-o-notch":"\uf1ce","fa-ra":"\uf1d0","fa-rebel":"\uf1d0","fa-ge":"\uf1d1","fa-empire":"\uf1d1","fa-git-square":"\uf1d2","fa-git":"\uf1d3",
"fa-y-combinator-square":"\uf1d4","fa-yc-square":"\uf1d4","fa-hacker-news":"\uf1d4","fa-tencent-weibo":"\uf1d5","fa-qq":"\uf1d6","fa-wechat":"\uf1d7","fa-weixin":"\uf1d7","fa-send":"\uf1d8","fa-paper-plane":"\uf1d8","fa-send-o":"\uf1d9","fa-paper-plane-o":"\uf1d9","fa-history":"\uf1da","fa-circle-thin":"\uf1db","fa-header":"\uf1dc","fa-paragraph":"\uf1dd","fa-sliders":"\uf1de","fa-share-alt":"\uf1e0","fa-share-alt-square":"\uf1e1","fa-bomb":"\uf1e2","fa-soccer-ball-o":"\uf1e3","fa-futbol-o":"\uf1e3",
"fa-tty":"\uf1e4","fa-binoculars":"\uf1e5","fa-plug":"\uf1e6","fa-slideshare":"\uf1e7","fa-twitch":"\uf1e8","fa-yelp":"\uf1e9","fa-newspaper-o":"\uf1ea","fa-wifi":"\uf1eb","fa-calculator":"\uf1ec","fa-paypal":"\uf1ed","fa-google-wallet":"\uf1ee","fa-cc-visa":"\uf1f0","fa-cc-mastercard":"\uf1f1","fa-cc-discover":"\uf1f2","fa-cc-amex":"\uf1f3","fa-cc-paypal":"\uf1f4","fa-cc-stripe":"\uf1f5","fa-bell-slash":"\uf1f6","fa-bell-slash-o":"\uf1f7","fa-trash":"\uf1f8","fa-copyright":"\uf1f9","fa-at":"\uf1fa",
"fa-eyedropper":"\uf1fb","fa-paint-brush":"\uf1fc","fa-birthday-cake":"\uf1fd","fa-area-t":"\uf1fe","fa-pie-t":"\uf200","fa-line-t":"\uf201","fa-lastfm":"\uf202","fa-lastfm-square":"\uf203","fa-toggle-off":"\uf204","fa-toggle-on":"\uf205","fa-bicycle":"\uf206","fa-bus":"\uf207","fa-ioxhost":"\uf208","fa-angellist":"\uf209","fa-cc":"\uf20a","fa-shekel":"\uf20b","fa-sheqel":"\uf20b","fa-ils":"\uf20b","fa-meanpath":"\uf20c","fa-buysellads":"\uf20d","fa-connectdevelop":"\uf20e","fa-dashcube":"\uf210",
"fa-forumbee":"\uf211","fa-leanpub":"\uf212","fa-sellsy":"\uf213","fa-shirtsinbulk":"\uf214","fa-simplybuilt":"\uf215","fa-skyatlas":"\uf216","fa-cart-plus":"\uf217","fa-cart-arrow-down":"\uf218","fa-diamond":"\uf219","fa-ship":"\uf21a","fa-user-secret":"\uf21b","fa-motorcycle":"\uf21c","fa-street-view":"\uf21d","fa-heartbeat":"\uf21e","fa-venus":"\uf221","fa-mars":"\uf222","fa-mercury":"\uf223","fa-intersex":"\uf224","fa-transgender":"\uf224","fa-transgender-alt":"\uf225","fa-venus-double":"\uf226",
"fa-mars-double":"\uf227","fa-venus-mars":"\uf228","fa-mars-stroke":"\uf229","fa-mars-stroke-v":"\uf22a","fa-mars-stroke-h":"\uf22b","fa-neuter":"\uf22c","fa-genderless":"\uf22d","fa-facebook-official":"\uf230","fa-pinterest-p":"\uf231","fa-whatsapp":"\uf232","fa-server":"\uf233","fa-user-plus":"\uf234","fa-user-times":"\uf235","fa-hotel":"\uf236","fa-bed":"\uf236","fa-viacoin":"\uf237","fa-train":"\uf238","fa-subway":"\uf239","fa-medium":"\uf23a","fa-yc":"\uf23b","fa-y-combinator":"\uf23b","fa-optin-monster":"\uf23c",
"fa-opencart":"\uf23d","fa-expeditedssl":"\uf23e","fa-battery-4":"\uf240","fa-battery-full":"\uf240","fa-battery-3":"\uf241","fa-battery-three-quarters":"\uf241","fa-battery-2":"\uf242","fa-battery-half":"\uf242","fa-battery-1":"\uf243","fa-battery-quarter":"\uf243","fa-battery-0":"\uf244","fa-battery-empty":"\uf244","fa-mouse-pointer":"\uf245","fa-i-cursor":"\uf246","fa-object-group":"\uf247","fa-object-ungroup":"\uf248","fa-sticky-note":"\uf249","fa-sticky-note-o":"\uf24a","fa-cc-jcb":"\uf24b",
"fa-cc-diners-club":"\uf24c","fa-clone":"\uf24d","fa-balance-scale":"\uf24e","fa-hourglass-o":"\uf250","fa-hourglass-1":"\uf251","fa-hourglass-start":"\uf251","fa-hourglass-2":"\uf252","fa-hourglass-half":"\uf252","fa-hourglass-3":"\uf253","fa-hourglass-end":"\uf253","fa-hourglass":"\uf254","fa-hand-grab-o":"\uf255","fa-hand-rock-o":"\uf255","fa-hand-stop-o":"\uf256","fa-hand-paper-o":"\uf256","fa-hand-scissors-o":"\uf257","fa-hand-lizard-o":"\uf258","fa-hand-spock-o":"\uf259","fa-hand-pointer-o":"\uf25a",
"fa-hand-peace-o":"\uf25b","fa-trademark":"\uf25c","fa-registered":"\uf25d","fa-creative-commons":"\uf25e","fa-gg":"\uf260","fa-gg-circle":"\uf261","fa-tripadvisor":"\uf262","fa-odnoklassniki":"\uf263","fa-odnoklassniki-square":"\uf264","fa-get-pocket":"\uf265","fa-wikipedia-w":"\uf266","fa-safari":"\uf267","fa-chrome":"\uf268","fa-firefox":"\uf269","fa-opera":"\uf26a","fa-internet-explorer":"\uf26b","fa-tv":"\uf26c","fa-television":"\uf26c","fa-contao":"\uf26d","fa-500px":"\uf26e","fa-amazon":"\uf270",
"fa-calendar-plus-o":"\uf271","fa-calendar-minus-o":"\uf272","fa-calendar-times-o":"\uf273","fa-calendar-check-o":"\uf274","fa-industry":"\uf275","fa-map-pin":"\uf276","fa-map-signs":"\uf277","fa-map-o":"\uf278","fa-map":"\uf279","fa-commenting":"\uf27a","fa-commenting-o":"\uf27b","fa-houzz":"\uf27c","fa-vimeo":"\uf27d","fa-black-tie":"\uf27e","fa-fonticons":"\uf280"},lt=jt;"string"==typeof jt&&(lt={font:jt,name:jt,copyright:""});
if(lt.font&&"string"==typeof lt.font){it.prototype.Ng.fonts[lt.font]=lt;for(var mt in kt){var nt=kt[mt];"string"==typeof nt&&1==nt.length&&(nt={char:nt});it.prototype.Ng.Mu[mt]={font:lt.font,char:nt.char||""+String.fromCharCode(nt.code)||"",fO:nt.fO||lt.name,name:nt.name||mt,search:nt.search||""}}}else console.log("bad font def");function ot(a){Nj.call(this,{bg:pt,Vh:qt,handleEvent:rt,cg:st});this.od=a.Xb?a.Xb:Mj;this.Mt=function(a){var b=a.originalEvent;return b.altKey&&!(b.metaKey||b.ctrlKey)&&!b.shiftKey&&Hj(a)};this.mz=a.Ot?a.Ot:this.Mt;this.MJ=a.LJ?a.LJ:Ig;this.Go=this.vc=null;this.Gq=[0,0];this.lg=this.cl=!1;this.pb=new ao;this.je=void 0!==a.pg?a.pg:10;this.Uf=this.Wj=!1;this.Gc=[];this.Ye=new yq({source:new rq({re:!1,nb:!!a.nb}),style:a.style?a.style:tt(),Hi:!0,Ii:!0});this.Ti={Point:this.Rs,LineString:this.fk,LinearRing:this.fk,
Polygon:this.Ss,MultiPoint:this.Ps,MultiLineString:this.Os,MultiPolygon:this.Qs,Circle:this.Ls,GeometryCollection:this.Ms};this.uc=null;a.source?(this.uc=a.source,a=new he(this.uc.Ca()),J(this.uc,"addfeature",this.oJ,this),J(this.uc,"removefeature",this.rJ,this)):a=a.features;if(!a)throw Error("The modify interaction requires features or a source");this.Ib=a;this.Ib.forEach(this.pk,this);J(this.Ib,"add",this.hn,this);J(this.Ib,"remove",this.jn,this);this.Hq=null}F(ot,Nj);l=ot.prototype;
l.pk=function(a){var b=a.j();b&&b.F()in this.Ti&&this.Ti[b.F()].call(this,a,b);(b=this.g())&&b.Jc&&jj(this)&&this.Zk(this.Gq,b);J(a,"change",this.tj,this)};function ut(a){a.lg||(a.lg=!0,a.dispatchEvent(new vt("modifystart",a.Ib)))}l.Dr=function(a){wt(this,a);this.vc&&0===this.Ib.cc()&&(this.Ye.s().Jb(this.vc),this.vc=null);Td(a,"change",this.tj,this)};function wt(a,b){a=a.pb;var c=[];a.forEach(function(a){b===a.ka&&c.push(a)});for(var d=c.length-1;0<=d;--d)a.remove(c[d])}
l.setActive=function(a){this.vc&&!a&&(this.Ye.s().Jb(this.vc),this.vc=null);Nj.prototype.setActive.call(this,a)};l.ib=function(a){this.Ye.ib(a);Nj.prototype.ib.call(this,a)};l.oJ=function(a){a.ka&&this.Ib.push(a.ka)};l.rJ=function(a){a.ka&&this.Ib.remove(a.ka)};l.hn=function(a){this.pk(a.element)};l.tj=function(a){this.Uf||(a=a.target,this.Dr(a),this.pk(a))};l.jn=function(a){this.Dr(a.element)};l.Rs=function(a,b){var c=b.T();a={ka:a,geometry:b,Ha:[c,c]};this.pb.Lb(b.V(),a)};
l.Ps=function(a,b){var c=b.T(),d,e,f;e=0;for(f=c.length;e<f;++e)d=c[e],d={ka:a,geometry:b,depth:[e],index:e,Ha:[d,d]},this.pb.Lb(b.V(),d)};l.fk=function(a,b){var c=b.T(),d,e,f,g;d=0;for(e=c.length-1;d<e;++d)f=c.slice(d,d+2),g={ka:a,geometry:b,index:d,Ha:f},this.pb.Lb(fg(f),g)};l.Os=function(a,b){var c=b.T(),d,e,f,g,h,k,m;g=0;for(h=c.length;g<h;++g)for(d=c[g],e=0,f=d.length-1;e<f;++e)k=d.slice(e,e+2),m={ka:a,geometry:b,depth:[g],index:e,Ha:k},this.pb.Lb(fg(k),m)};
l.Ss=function(a,b){var c=b.T(),d,e,f,g,h,k,m;g=0;for(h=c.length;g<h;++g)for(d=c[g],e=0,f=d.length-1;e<f;++e)k=d.slice(e,e+2),m={ka:a,geometry:b,depth:[g],index:e,Ha:k},this.pb.Lb(fg(k),m)};l.Qs=function(a,b){var c=b.T(),d,e,f,g,h,k,m,p,t,u;k=0;for(m=c.length;k<m;++k)for(p=c[k],g=0,h=p.length;g<h;++g)for(d=p[g],e=0,f=d.length-1;e<f;++e)t=d.slice(e,e+2),u={ka:a,geometry:b,depth:[g,k],index:e,Ha:t},this.pb.Lb(fg(t),u)};
l.Ls=function(a,b){var c=b.Ka(),d={ka:a,geometry:b,index:0,Ha:[c,c]};a={ka:a,geometry:b,index:1,Ha:[c,c]};d.Rm=a.Rm=[d,a];this.pb.Lb(tg(c),d);this.pb.Lb(b.V(),a)};l.Ms=function(a,b){var c=b.Rb;for(b=0;b<c.length;++b)this.Ti[c[b].F()].call(this,a,c[b])};function xt(a,b){var c=a.vc;c?c.j().zb(b):(c=new vd(new ii(b)),a.vc=c,a.Ye.s().xb(c))}function yt(a,b){return a.index-b.index}
function pt(a){if(!this.od(a))return!1;this.Zk(a.Sc,a.map);var b=a.map.zc(a.Sc);this.Gc.length=0;this.lg=!1;var c=this.vc;if(c){var d=[],c=c.j().T(),e=fg([c]),e=bo(this.pb,e),f={};e.sort(yt);for(var g=0,h=e.length;g<h;++g){var k=e[g],m=k.Ha,p=I(k.ka),t=k.depth;t&&(p+="-"+t.join("-"));f[p]||(f[p]=Array(2));if("Circle"===k.geometry.F()&&1===k.index)m=zt(b,k),Yf(m,c)&&!f[p][0]&&(this.Gc.push([k,0]),f[p][0]=k);else if(Yf(m[0],c)&&!f[p][0])this.Gc.push([k,0]),f[p][0]=k;else if(Yf(m[1],c)&&!f[p][1]){if("LineString"!==
k.geometry.F()&&"MultiLineString"!==k.geometry.F()||!f[p][0]||0!==f[p][0].index)this.Gc.push([k,1]),f[p][1]=k}else this.MJ(a)&&I(m)in this.Go&&!f[p][0]&&!f[p][1]&&d.push([k,c])}d.length&&ut(this);for(a=d.length-1;0<=a;--a)this.NA.apply(this,d[a])}return!!this.vc}
function qt(a){this.cl=!1;ut(this);a=a.Qb;for(var b=0,c=this.Gc.length;b<c;++b){for(var d=this.Gc[b],e=d[0],f=e.depth,g=e.geometry,h,k=e.Ha,d=d[1];a.length<g.S;)a.push(k[d][a.length]);switch(g.F()){case "Point":h=a;k[0]=k[1]=a;break;case "MultiPoint":h=g.T();h[e.index]=a;k[0]=k[1]=a;break;case "LineString":h=g.T();h[e.index+d]=a;k[d]=a;break;case "MultiLineString":h=g.T();h[f[0]][e.index+d]=a;k[d]=a;break;case "Polygon":h=g.T();h[f[0]][e.index+d]=a;k[d]=a;break;case "MultiPolygon":h=g.T();h[f[1]][f[0]][e.index+
d]=a;k[d]=a;break;case "Circle":k[0]=k[1]=a,0===e.index?(this.Uf=!0,g.tb(a)):(this.Uf=!0,g.tw(ag(g.Ka(),a))),this.Uf=!1}h&&At(this,g,h)}xt(this,a)}function st(){for(var a,b,c=this.Gc.length-1;0<=c;--c)if(a=this.Gc[c][0],b=a.geometry,"Circle"===b.F()){var d=b.Ka(),e=a.Rm[0];a=a.Rm[1];e.Ha[0]=e.Ha[1]=d;a.Ha[0]=a.Ha[1]=d;this.pb.update(tg(d),e);this.pb.update(b.V(),a)}else this.pb.update(fg(a.Ha),a);this.lg&&(this.dispatchEvent(new vt("modifyend",this.Ib)),this.lg=!1);return!1}
function rt(a){if(!(a instanceof Le))return!0;this.Hq=a;var b;0<E(a.map).Zd[1]||"pointermove"!=a.type||this.Yh||this.$k(a);if(this.vc&&this.mz(a)){var c;if("singleclick"==a.type&&this.cl)c=!0;else if(this.Hq&&"pointerdrag"!=this.Hq.type){ut(this);b=this.Gc;var d={},e,f,g,h,k,m,p,t,u;for(k=b.length-1;0<=k;--k)h=b[k],u=h[0],c=I(u.ka),u.depth&&(c+="-"+u.depth.join("-")),c in d||(d[c]={}),0===h[1]?(d[c].right=u,d[c].index=u.index):1==h[1]&&(d[c].left=u,d[c].index=u.index+1);for(c in d){t=d[c].right;m=
d[c].left;k=d[c].index;p=k-1;u=void 0!==m?m:t;0>p&&(p=0);h=u.geometry;f=g=h.T();e=!1;switch(h.F()){case "MultiLineString":2<g[u.depth[0]].length&&(g[u.depth[0]].splice(k,1),e=!0);break;case "LineString":2<g.length&&(g.splice(k,1),e=!0);break;case "MultiPolygon":f=f[u.depth[1]];case "Polygon":f=f[u.depth[0]],4<f.length&&(k==f.length-1&&(k=0),f.splice(k,1),e=!0,0===k&&(f.pop(),f.push(f[0]),p=f.length-1))}e&&(At(this,h,g),e=[],void 0!==m&&(this.pb.remove(m),e.push(m.Ha[0])),void 0!==t&&(this.pb.remove(t),
e.push(t.Ha[1])),void 0!==m&&void 0!==t&&(m={depth:u.depth,ka:u.ka,geometry:u.geometry,index:p,Ha:e},this.pb.Lb(fg(m.Ha),m)),Bt(this,h,k,u.depth,-1),this.vc&&(this.Ye.s().Jb(this.vc),this.vc=null),b.length=0)}this.dispatchEvent(new vt("modifyend",this.Ib));this.lg=!1;c=!0}else c=!1;b=c}"singleclick"==a.type&&(this.cl=!1);return Oj.call(this,a)&&!b}l.$k=function(a){this.Gq=a.Sc;this.Zk(a.Sc,a.map)};
l.Zk=function(a,b){function c(a,b){return Ct(d,a)-Ct(d,b)}var d=b.zc(a),e=ig(tg(d),E(b).Fa()*this.je),e=bo(this.pb,e);if(0<e.length){e.sort(c);var f=e[0],g=f.Ha,h=zt(d,f),k=ij(b,h),m=ag(a,k);if(m<=this.je){a={};if("Circle"===f.geometry.F()&&1===f.index)this.Wj=!0,xt(this,h);else for(m=ij(b,g[0]),f=ij(b,g[1]),b=$f(k,m),k=$f(k,f),m=Math.sqrt(Math.min(b,k)),(this.Wj=m<=this.je)&&(h=b>k?g[1]:g[0]),xt(this,h),k=1,b=e.length;k<b;++k)if(h=e[k].Ha,Yf(g[0],h[0])&&Yf(g[1],h[1])||Yf(g[0],h[1])&&Yf(g[1],h[0]))a[I(h)]=
!0;else break;a[I(g)]=!0;this.Go=a;return}}this.vc&&(this.Ye.s().Jb(this.vc),this.vc=null)};function Ct(a,b){var c=b.geometry;return"Circle"===c.F()&&1===b.index?(a=$f(c.Ka(),a),c=Math.sqrt(a)-c.yf(),c*c):bg(a,b.Ha)}function zt(a,b){var c=b.geometry;"Circle"===c.F()&&1===b.index?(b=[NaN,NaN],c.Vf(a[0],a[1],b,Infinity),a=b):a=Xf(a,b.Ha);return a}
l.NA=function(a,b){for(var c=a.Ha,d=a.ka,e=a.geometry,f=a.depth,g=a.index,h;b.length<e.S;)b.push(0);switch(e.F()){case "MultiLineString":h=e.T();h[f[0]].splice(g+1,0,b);break;case "Polygon":h=e.T();h[f[0]].splice(g+1,0,b);break;case "MultiPolygon":h=e.T();h[f[1]][f[0]].splice(g+1,0,b);break;case "LineString":h=e.T();h.splice(g+1,0,b);break;default:return}At(this,e,h);h=this.pb;h.remove(a);Bt(this,e,g,f,1);a={Ha:[c[0],b],ka:d,geometry:e,depth:f,index:g};h.Lb(fg(a.Ha),a);this.Gc.push([a,1]);b={Ha:[b,
c[1]],ka:d,geometry:e,depth:f,index:g+1};h.Lb(fg(b.Ha),b);this.Gc.push([b,0]);this.cl=!0};function At(a,b,c){a.Uf=!0;b.zb(c);a.Uf=!1}function Bt(a,b,c,d,e){eo(a.pb,b.V(),function(a){a.geometry===b&&(void 0===d||void 0===a.depth||df(a.depth,d))&&a.index>c&&(a.index+=e)})}function tt(){var a=Yp();return function(){return a.Point}}function vt(a,b){Wd.call(this,a);this.features=b}F(vt,Wd);function zq(a){Nj.call(this,{});this.od=a.Xb?a.Xb:Mj;this.Mt=function(a){return Ij(a)&&Hj(a)};this.mz=a.Ot?a.Ot:this.Mt;this.Go=this.vc=null;this.Gq=[0,0];this.lg=this.cl=!1;this.pb=new ao;this.je=void 0!==a.pg?a.pg:10;this.AJ=void 0!==a.BA?a.BA:10;this.Uf=this.Wj=!1;this.Gc=[];this.Ye=new yq({source:new rq({re:!1,nb:!!a.nb}),style:a.style?a.style:tt(),Hi:!0,Ii:!0});this.Ti={Point:this.Rs,LineString:this.fk,LinearRing:this.fk,Polygon:this.Ss,MultiPoint:this.Ps,MultiLineString:this.Os,MultiPolygon:this.Qs,
Circle:this.Ls,GeometryCollection:this.Ms};this.Ib=a.features;this.Ib.forEach(this.pk,this);J(this.Ib,"add",this.hn,this);J(this.Ib,"remove",this.jn,this);this.Hq=null}F(zq,ot);
function Dt(a,b){a.cl=!1;for(var c=0,d=a.Gc.length;c<d;++c){for(var e=a.Gc[c],f=e[0],g=f.depth,h=f.geometry,k,m=f.Ha,e=e[1];b.length<h.S;)b.push(m[e][b.length]);switch(h.F()){case "Point":k=b;m[0]=m[1]=b;break;case "MultiPoint":k=h.T();k[f.index]=b;m[0]=m[1]=b;break;case "LineString":k=h.T();k[f.index+e]=b;m[e]=b;break;case "MultiLineString":k=h.T();k[g[0]][f.index+e]=b;m[e]=b;break;case "Polygon":k=h.T();k[g[0]][f.index+e]=b;m[e]=b;break;case "MultiPolygon":k=h.T();k[g[1]][g[0]][f.index+e]=b;m[e]=
b;break;case "Circle":m[0]=m[1]=b,f.index===zq.tP?(a.Uf=!0,h.tb(b)):(a.Uf=!0,h.tw(ag(h.Ka(),b))),a.Uf=!1}k&&At(a,h,k)}xt(a,b)}
zq.prototype.Zk=function(a,b){function c(a,b){return Ct(d,a)-Ct(d,b)}var d=b.zc(a),e=ig(tg(d),E(b).Fa()*this.je),e=bo(this.pb,e);if(0<e.length){e.sort(c);var f=e[0],g=f.Ha,h=zt(d,f),k=ij(b,h),m=ag(a,k);if(m<=this.je){a={};if("Circle"===f.geometry.F()&&f.index===zq.UE)this.Wj=!0,xt(this,h);else for(m=ij(b,g[0]),f=ij(b,g[1]),b=$f(k,m),k=$f(k,f),m=Math.sqrt(Math.min(b,k)),(this.Wj=m<=this.AJ)&&(h=b>k?g[1]:g[0]),xt(this,h),k=1,b=e.length;k<b;++k)if(h=e[k].Ha,Yf(g[0],h[0])&&Yf(g[1],h[1])||Yf(g[0],h[1])&&
Yf(g[1],h[0]))a[I(h)]=!0;else break;a[I(g)]=!0;this.Go=a;return}}this.vc&&(this.Ye.s().Jb(this.vc),this.vc=null)};zq.prototype.Ww=function(a,b){this.AO=b.on("pointerdrag",function(){this.Gq=a;this.Zk(a,b)},this)};zq.prototype.trackVertex=zq.prototype.Ww;zq.prototype.hE=function(){$d(this.AO)};zq.prototype.untrackVertex=zq.prototype.hE;
zq.prototype.sE=function(a,b){this.hE();this.Zk(a,b);var c=b.zc(a);this.Gc.length=0;this.lg=!1;var d=this.vc;if(d){var e=[],d=d.j().T(),f=fg([d]),f=bo(this.pb,f),g={};f.sort(zq.RP);for(var h=0,k=f.length;h<k;++h){var m=f[h],p=m.Ha,t=I(m.ka),u=m.depth;u&&(t+="-"+u.join("-"));g[t]||(g[t]=Array(2));if("Circle"===m.geometry.F()&&m.index===zq.UE)p=zt(c,m),Yf(p,d)&&!g[t][0]&&(this.Gc.push([m,0]),g[t][0]=m);else if(Yf(p[0],d)&&!g[t][0])this.Gc.push([m,0]),g[t][0]=m;else if(Yf(p[1],d)&&!g[t][1]){if("LineString"!==
m.geometry.F()&&"MultiLineString"!==m.geometry.F()||!g[t][0]||0!==g[t][0].index)this.Gc.push([m,1]),g[t][1]=m}else I(p)in this.Go&&!g[t][0]&&!g[t][1]&&e.push([m,d])}e.length&&console.error("willModifyFeatures_");for(c=e.length-1;0<=c;--c)this.NA.apply(this,e[c])}this.wz(a,b)};zq.prototype.validateVertex=zq.prototype.sE;zq.prototype.wz=function(a,b){this.$G=E(b).on("change:center",function(){var c=b.zc(a);Dt(this,c)},this);var c=b.zc(a);Dt(this,c)};zq.prototype.dragVertex=zq.prototype.wz;
zq.prototype.dE=function(){$d(this.$G)};zq.prototype.undragVertex=zq.prototype.dE;zq.prototype.rE=function(a,b){for(var c,d,e=this.Gc.length-1;0<=e;--e)if(c=this.Gc[e][0],d=c.geometry,"Circle"===d.F()){var f=d.Ka(),g=c.Rm[0];c=c.Rm[1];g.Ha[0]=g.Ha[1]=f;c.Ha[0]=c.Ha[1]=f;this.pb.update(tg(f),g);this.pb.update(d.V(),c)}else this.pb.update(fg(c.Ha),c);this.lg&&(this.lg=!1);this.dE();this.Ww(a,b)};zq.prototype.validateGeometry=zq.prototype.rE;var Et=null;function Ft(a){if(null==Et)try{Et=angular.element(v.f).injector().get(["$log"])}catch(b){Et=null}null!=Et&&Et.info(a)}Wo.prototype.ud=function(a){Ft("ol.Map.prototype.refreshWithTimestamp");this.getLayers().forEach(function(b){b.s().ud(a)})};Wo.prototype.refreshWithTimestamp=Wo.prototype.ud;oj.prototype.ud=function(a){Ft("ol.layer.Layer.prototype.refreshWithTimestamp ");this.s().ud(a)};oj.prototype.refreshWithTimestamp=oj.prototype.ud;
Ap.prototype.ud=function(a){Ft("ol.source.Source.prototype.refreshWithTimestamp");if(this instanceof sr||this instanceof qr){var b=this.gc;b.TIMESTAMP=Date.now();this.updateParams(b);!0!==a&&this.refresh()}};Ap.prototype.refreshWithTimestamp=Ap.prototype.ud;function Gt(a,b){Ft("ol.geom.SimpleGeometry.prototype.containsPolygon");b=b.T()[0];for(var c=0;c<b.length;c++)if(!a.Xf(b[c][0],b[c][1]))return!1;return!0}
vd.prototype.Fu=function(){Ft("ol.Feature.prototype.getStyleAsJSON");switch(this.j().F()){case "Point":case "MultiPoint":var a=this.xg,b={draw:{color:"rgba(54,184,255,0.6)",outline_color:"rgba(0,0,0,0.4)",size:7},text:null};null!=a&&(null!=a.na()&&(null!=a.na().Xm&&null!=a.na().Xm()&&null!=a.na().Xm().name&&(b.draw.symbol=a.na().Xm().name),null!=a.na().Hf&&(b.draw.size=a.na().Hf),null!=a.na().Wp&&null!=a.na().ua&&(b.draw.color=a.na().ua.sa),null!=a.na().iq&&null!=a.na().ha&&(b.draw.outline_color=
a.na().ha.sa),null!=a.na().rj&&null!=a.na().rj()&&(b.draw.image=a.na().rj()),null!=a.na().Cb&&null!=a.na().Cb()&&(b.draw.rotation=a.na().Cb())),b.text=Ht(a));return b;case "LineString":case "MultiLineString":return a=this.xg,b={draw:{color:"rgba(54,184,255,0.6)",outline_color:"rgba(0,0,0,0.4)",size:7},text:null},null!=a&&(null!=a.ua&&null!=a.ua.sa&&(b.draw.color=a.ua.sa),null!=a.ha&&(q(a.ha.getLineDash())&&(b.draw.dash=a.ha.getLineDash()[0]),null!=a.ha.Qc()&&(b.draw.size=a.ha.Qc())),b.text=Ht(a)),
b;case "Polygon":case "MultiPolygon":return a=this.xg,b={draw:{color:"rgba(54,184,255,0.6)",outline_color:"rgba(0,0,0,0.4)",size:7},text:null},null!=a&&(null!=a.ua&&null!=a.ua.sa&&(b.draw.color=a.ua.sa),null!=a.ha&&(null!=a.ha.sa&&(b.draw.outline_color=a.ha.sa),null!=a.ha.Qc()&&(b.draw.size=a.ha.Qc())),b.text=Ht(a)),b;default:console.error("undefined type: ",this.j().F())}};vd.prototype.getStyleAsJSON=vd.prototype.Fu;
function Ht(a){var b=null;if(null!=a.xa){b={};if(null!=a.xa.Ph){var c=a.xa.Ph.split(" "),d=14;r(c[0])&&-1!==c[0].indexOf("px")&&(d=parseInt(angular.copy(c[0])),c.shift());b.font=c.join(" ");b.size=d}null!=a.xa.ua&&null!=a.xa.ua.sa&&(b.color=a.xa.ua.sa);null!=a.xa.mg&&(b.offsetX=a.xa.mg);null!=a.xa.ng&&(b.offsetY=-1*parseFloat(a.xa.ng));null!=a.xa.ha&&(null!=a.xa.ha.sa&&(b.outline_color=a.xa.ha.sa),null!=a.xa.ha.Qc()&&(b.outline_size=a.xa.ha.Qc()));null!=a.xa.Cb()&&(b.rotation=180*parseFloat(a.xa.Cb())/
Math.PI);null!=a.xa.xa&&(b.text=a.xa.xa)}return b}
vd.prototype.vw=function(a){Ft("ol.Feature.prototype.setStyleByJSON");if(null==a)return console.error("oJSON not provided"),!1;r(a)&&(a=JSON.parse(a));if(!ha(a))return console.error("oJSON is neither JSON string nor object"),!1;switch(this.j().F()){case "Point":case "MultiPoint":this.le(It(a));break;case "LineString":case "MultiLineString":this.le(Jt(a));break;case "Polygon":case "MultiPolygon":this.le(Kt(a));break;default:console.error("undefined type: ",this.j().F())}};
vd.prototype.setStyleByJSON=vd.prototype.vw;
function It(a){a.draw=null!=a.draw?a.draw:{};a.draw.color=null!=a.draw.color?a.draw.color:"rgba(54,184,255,0.6)";a.draw.outline_color=null!=a.draw.outline_color?a.draw.outline_color:"rgba(0,0,0,0.4)";a.draw.size=null!=a.draw.size?a.draw.size:7;var b=new Tp({stroke:new Tn({width:a.draw.size,color:a.draw.color}),fill:new Sp({color:a.draw.outline_color})});if(null!=a.draw.symbol)b.Qr(new it({form:"none",II:!1,DI:a.draw.symbol,fontSize:.6,cb:a.draw.size,rotation:0,Zc:!1,offsetY:0,color:"",fill:new Sp({color:a.draw.color}),
stroke:new Tn({color:a.draw.outline_color,width:2})}));else if(null!=a.draw.image){var c=document.createElement("img");c.src=a.draw.image;setTimeout(function(){var d=0;null!=a.draw.rotation&&ea(parseFloat(a.draw.rotation))&&(Number.isNaN(parseFloat(a.draw.rotation))||(d=parseFloat(a.draw.rotation)));var e=20;null!=a.draw.size&&ea(parseFloat(a.draw.size))&&(Number.isNaN(parseFloat(a.draw.size))||(e=parseFloat(a.draw.size)));var f=e,e=c.width/c.height*e,g=document.createElement("canvas"),h=g.getContext("2d");
g.height=f;g.width=e;h.drawImage(c,0,0,e,f);b.Qr(new Lt({HA:g,IA:[e,f],rotation:d*Math.PI/180}))})}else b.Qr(new Rp({cb:a.draw.size,fill:new Sp({color:a.draw.color}),stroke:new Tn({color:a.draw.outline_color,width:2})}));null!=a.text&&(a.text.size=null!=a.text.size?a.text.size:14,a.text.font=null!=a.text.font?a.text.font:"Arial",a.text.color=null!=a.text.color?a.text.color:"black",a.text.outline_color=null!=a.text.outline_color?a.text.outline_color:"white",a.text.outline_size=null!=a.text.outline_size?
a.text.outline_size:1,a.text.offsetX=null!=a.text.offsetX?a.text.offsetX:0,a.text.offsetY=null!=a.text.offsetY?a.text.offsetY:0,a.text.rotation=null!=a.text.rotation?a.text.rotation:0,b.fo(new Fq({font:a.text.size+"px "+a.text.font,text:a.text.text,fill:new Sp({color:a.text.color}),stroke:new Tn({color:a.text.outline_color,width:a.text.outline_size}),offsetX:a.text.offsetX,offsetY:-1*parseFloat(a.text.offsetY),rotation:parseFloat(a.text.rotation)*Math.PI/180})));return b}
function Jt(a){a.draw=null!=a.draw?a.draw:{};a.draw.color=null!=a.draw.color?a.draw.color:"rgba(54,184,255,0.6)";a.draw.size=null!=a.draw.size?a.draw.size:2;a.draw.dash=null!=a.draw.dash?a.draw.dash:0;var b=new Tp({fill:new Sp({color:a.draw.color}),stroke:new Tn({color:a.draw.color,width:a.draw.size,sb:[a.draw.dash]})});null!=a.text&&(a.text.size=null!=a.text.size?a.text.size:14,a.text.font=null!=a.text.font?a.text.font:"Arial",a.text.color=null!=a.text.color?a.text.color:"black",a.text.outline_color=
null!=a.text.outline_color?a.text.outline_color:"white",a.text.outline_size=null!=a.text.outline_size?a.text.outline_size:1,a.text.offsetX=null!=a.text.offsetX?a.text.offsetX:0,a.text.offsetY=null!=a.text.offsetY?a.text.offsetY:0,a.text.rotation=null!=a.text.rotation?a.text.rotation:0,b.fo(new Fq({font:a.text.size+"px "+a.text.font,text:a.text.text,fill:new Sp({color:a.text.color}),stroke:new Tn({color:a.text.outline_color,width:a.text.outline_size}),offsetX:a.text.offsetX,offsetY:-1*parseFloat(a.text.offsetY),
rotation:parseFloat(a.text.rotation)*Math.PI/180})));return b}
function Kt(a){a.draw=null!=a.draw?a.draw:{};a.draw.color=null!=a.draw.color?a.draw.color:"rgba(54,184,255,0.6)";a.draw.outline_color=null!=a.draw.outline_color?a.draw.outline_color:"rgba(0,0,0,0.4)";a.draw.size=null!=a.draw.size?a.draw.size:2;var b=new Tp({fill:new Sp({color:a.draw.color}),stroke:new Tn({color:a.draw.outline_color,width:a.draw.size})});null!=a.text&&(a.text.size=null!=a.text.size?a.text.size:14,a.text.font=null!=a.text.font?a.text.font:"Arial",a.text.color=null!=a.text.color?a.text.color:
"black",a.text.outline_color=null!=a.text.outline_color?a.text.outline_color:"white",a.text.outline_size=null!=a.text.outline_size?a.text.outline_size:1,a.text.offsetX=null!=a.text.offsetX?a.text.offsetX:0,a.text.offsetY=null!=a.text.offsetY?a.text.offsetY:0,a.text.rotation=null!=a.text.rotation?a.text.rotation:0,b.fo(new Fq({font:a.text.size+"px "+a.text.font,text:a.text.text,fill:new Sp({color:a.text.color}),stroke:new Tn({color:a.text.outline_color,width:a.text.outline_size}),offsetX:a.text.offsetX,
offsetY:-1*parseFloat(a.text.offsetY),rotation:parseFloat(a.text.rotation)*Math.PI/180})));return b}function wd(a,b){Ft("ol.getEWKTFromWKT");return r(a)?r(b)?"SRID="+b.substr(5)+";"+a:(console.error("EPSGProj is not a string"),null):(console.error("WKTGeom is not a string"),null)}qa("ol.getEWKTFromWKT",wd);
function xd(a){Ft("ol.getWKTFromEWKT");var b,c;if(!r(a))return console.error("EWKTGeom is not a string"),null;c=a.substr(a.indexOf(";")+1);b="EPSG:"+a.slice(5,a.indexOf(";"));var d=!1;3===a.substr(a.lastIndexOf("(")+1,a.indexOf(")",a.lastIndexOf("("))-a.lastIndexOf("(")-1).split(",")[0].split(" ").length&&(d=!0);d&&(c=c.substr(0,c.indexOf("("))+" Z"+c.substr(c.indexOf("(")));return{proj:b,geom:c}}qa("ol.getWKTFromEWKT",xd);
function yd(a,b){Ft("ol.getEWKTFromGeom");if(null==a)return console.error("geom is not defined"),null;if(!r(b))return console.error("proj is not a string"),null;a=(new Mt).tx(a,{xd:b,Ic:b});a=a.substr(0,a.indexOf("(")).replace(" Z","")+a.substr(a.indexOf("("));return"SRID="+b.substr(5)+";"+a}qa("ol.getEWKTFromGeom",yd);
function Ad(a,b){Ft("ol.getGeomFromEWKT");if(!r(a))return console.error("EWKTGeom is not a string: ",a),null;if(zd(a)){var c=new Mt;a=xd(a);return c.On(a.geom,{xd:a.proj,Ic:b})}console.error("Geom is not an EWKT Geometry: ",a);return null}qa("ol.getGeomFromEWKT",Ad);
function Nt(a,b){Ft("ol.getFeaturesFromEWKT");if(!r(a))return console.error("EWKTGeom is not a string: ",a),null;if(zd(a)){var c=new Mt;a=xd(a);return c.si(a.geom,{xd:a.proj,Ic:b})}console.error("Geom is not an EWKT Geometry: ",a);return null}qa("ol.getFeaturesFromEWKT",Nt);
function Ot(a,b){Ft("ol.getEWKTFromGeom");if(null==a)return console.error("geom is not defined"),null;if(!r(b))return console.error("proj is not a string"),null;a=(new Mt).mm(a,{xd:b,Ic:b});a=a.substr(0,a.indexOf("(")).replace(" Z","")+a.substr(a.indexOf("("));return"SRID="+b.substr(5)+";"+a}qa("ol.getEWKTFromFeatures",Ot);
function zd(a){Ft("ol.isEWKTGeom");if("SRID="!==a.substr(0,5).toUpperCase())return!1;var b=new Mt,c=xd(a).geom;try{b.On(c)}catch(d){return console.error("readGeometry failed: ",a),!1}return!0}qa("ol.isEWKTGeom",zd);function Pt(a,b){Ft("ol.getEWKTFromGeom");return null==a?(console.error("geom is not defined"),null):r(b)?(new Mt).mm(a,{xd:b,Ic:b}):(console.error("proj is not a string"),null)}qa("ol.getWKTFromFeatures",Pt);function Qt(a){if(null==a)return console.error("opt_options undefied"),0;if(null==a.properties)return console.error("opt_options.properties undefied"),0;this.properties=a.properties}
Qt.prototype.jq=function(a,b){b=null!=b?b:{};if(null==a)return console.error("oMapDefinition is not defined: "+a),null;if(null==a.children)return console.error("oMapDefinition.children is not defined: "+a),null;if(null==a.children[0])return console.error("oMapDefinition.children[0] is not defined: "+a),null;if(null==a.children[0].view)return console.error("oMapDefinition.children[0].view is not defined: "+a),null;a=a.children[0].view;var c={};c.Oa=null!=a.center?a.center:[0,0];c.zoom=null!=a.zoom?
a.zoom:0;c.tp=a.constrainRotation;c.Iz=null!=a.enableRotation?a.enableRotation:!1;c.aa=a.maxExtent;c.Df=a.maxResolution;c.Se=a.minResolution;c.Cc=a.maxZoom;c.Te=a.minZoom;c.pa=a.projection;c.ra=a.resolution;c.Kd=a.resolutions;c.rotation=a.rotation;c.QE=a.zoomFactor;c=new yi(c);null!=a.extent&&(null!=b.size?Ji(c,a.extent,{size:b.size,Dj:!0}):console.error("Cannot calc olView.extent if opt_options.size is not defined"));return c};Qt.prototype.getViewFromDef=Qt.prototype.jq;
Qt.prototype.vu=function(a,b){b=null!=b?b:{};if(null==a)return console.error("oMapDefinition is not defined: "+a),null;if(null==a.children)return console.error("oMapDefinition.children is not defined: "+a),null;if(null==b.size)return console.error("opt_options.size not defined"),null;if(null==b.tileSize)return console.error("opt_options.tileSize not defined"),null;var c,d;d=a.children;for(var e=[],f=1;f<d.length;f++)for(c=0;c<d[f].children.length;c++)e.push(d[f].children[c]);d=e=Rt(e);e=[];for(f=
0;f<d.length;f++)null!=d[f].url&&(-1<d[f].url.indexOf("[token]")&&(d[f].url=d[f].url.replace(/\[token\]/,$c(sessionStorage.session_token))),-1<d[f].url.indexOf("[localhost]")&&(d[f].url=d[f].url.replace(/\[localhost\]/,this.properties.web_server_name))),c=St(this,a,d[f],b),null!=c&&(c=Tt(d[f],c),null!=c&&e.push(c));return e};Qt.prototype.getLayersFromDef=Qt.prototype.vu;
Qt.prototype.qA=function(a,b){b=null!=b?b:{};var c=this.jq(a,b);if(null==c)return null;if(null==b.tileSize)return console.error("opt_options.tileSize not defined"),null;if(null==b.size)return console.error("opt_options.size not defined"),null;a=Ei(c,b.size);for(var c=c.J().V(),d=zg(c)/256,e=Array(22),f=0,g=e.length;f<g;++f)e[f]=d/Math.pow(2,f);return new rp({origin:Fg(a),aa:c,Kd:e,xh:b.tileSize})};Qt.prototype.getTileGridFromDef=Qt.prototype.qA;
function Rt(a){a.sort(function(a,c){return a.index<c.index?-1:a.index>c.index?1:0});return a}
function St(a,b,c,d){d=null!=d?d:{};if(null==d.tileSize)return console.error("opt_options.tileSize not defined"),null;if(null==d.size)return console.error("opt_options.size not defined"),null;var e=c.layerType;null!=c.params&&!0===c.is_dynamic&&(c.params.TIMESTAMP=Date.now());var f={};if("string"===typeof c.service_options)try{f=JSON.parse(c.service_options)}catch(u){f={}}else"object"!==typeof c.service_options&&(f=c.service_options);var g={};if("string"===typeof c.layer_options)try{g=JSON.parse(c.layer_options)}catch(u){g=
{}}else"object"!==typeof c.layer_options&&(g=c.layer_options);if("tilewms"===e||"imagewms"===e){if(null!=g&&null!=g.layer_style&&null!=c.params.LAYERS){for(var h=c.params.LAYERS.split(","),k=[],m=0;m<h.length;m++)null!=g.layer_style[h[m]]?k.push(g.layer_style[h[m]].Name):k.push("");c.params.STYLES=k.join(",")}null!=c.params.STYLES||null!=c.params.styles||(c.params.STYLES="");null!=c.tileLoadFunction||(c.tileLoadFunction=function(a,b){b=b.replace("STYLES&","STYLES=&");a.na().src=b});null!=f&&(null!=
f.login&&(c.service_login=f.login),null!=f.password&&(c.service_password=f.password))}null!=c.service_login&&null!=c.service_password&&(f=function(a,b){b=b.replace("STYLES&","STYLES=&");var d=new XMLHttpRequest;d.responseType="blob";d.onreadystatechange=function(){d.readyState===XMLHttpRequest.DONE&&200===d.status&&(a.na().src=URL.createObjectURL(d.response))};d.open("GET",b,!0);d.setRequestHeader("Authorization","Basic "+btoa(c.service_login+":"+c.service_password));d.send()},c.tileLoadFunction=
f,c.imageLoadFunction=f);if("bing"===e)a=new Rs({key:c.key,nb:c.wrapX,dj:c.culture,Cc:c.maxZoom,Tc:c.tileLoadFunction,$u:c.imagerySet});else if("tilewms"===e)a=new qr({url:a.properties.use_proxy_for_tiles?a.oh(c.url):c.url,Fc:a.properties.use_proxy_for_tiles?a.tr(c.urls):c.urls,dc:c.logo,wj:c.hidpi,nb:c.wrapX,wA:c.gutter,Cc:c.maxZoom,$b:a.qA(b,d),pa:c.projection,rw:c.serverType,crossOrigin:c.crossOrigin,Tc:c.tileLoadFunction,params:c.params});else if("imagewms"===e)a=new sr({url:a.properties.use_proxy_for_tiles?
a.oh(c.url):c.url,dc:c.logo,wj:c.hidpi,ratio:c.ratio,pa:c.projection,rw:c.serverType,Kd:c.resolutions,crossOrigin:c.crossOrigin,nc:c.attributions,GA:c.imageLoadFunction,params:c.params});else if("imagevector"===e)if(c.features)a=new rq({features:c.features});else if(c.url)a=new rq({format:new Ur,url:a.properties.use_proxy_for_tiles?a.oh(c.url):c.url});else{console.error("Error: veuillez renseinger une url ou une feature");return}else if("wmts"===e){var p;if(null==c.service_options)return console.error("oLayerDef.service_options undefined"),
null;try{var t=JSON.parse(c.service_options);p=gt(t,{layer:c.layer,matrixSet:c.matrixSet,requestEncoding:c.requestEncoding,style:c.style,format:c.format});null!=c.style&&(p.style=c.style);null!=c.tileLoadFunction&&(p.Tc=c.tileLoadFunction)}catch(u){console.error("error while parsing options")}a=new et(p)}else"xyz"===e?a=new Np({url:c.url,Tc:c.tileLoadFunction}):"osm"===e?(null!=c.url&&""!==c.url||(c.url="https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png"),a=new Op({url:c.url})):(console.error("Error: layerType ("+
e+") is not supported"),a=null);return a}
function Tt(a,b){var c=a.layerType;b="imagewms"===c?new ht({source:b}):"imagevector"===c?new yq({JM:"image",style:a.style,source:b}):new Xo({source:b});b.set("type",c);b.set("name",a.name);b.set("legend",!0);b.set("queryable",!0);"imagewms"!==c&&"tilewms"!==c&&b.set("queryable",!1);a.select=!0;b.set("select",!0);!0===a.bo_queryable&&(b.set("bo_queryable",!0),null!=a.business_objects&&b.set("business_objects",a.business_objects));b.set("layer_id",a.layer_id);null!=a.service_login&&b.set("service_login",
a.service_login);null!=a.service_password&&b.set("service_password",a.service_password);null!=a.events&&b.set("events",a.events);null!=a.params&&null!=a.params.LAYERS&&(c=a.params.LAYERS.split(","),q(c)&&(b.set("sublayers",c),b.set("activeSublayers",c)));null!=a.is_dynamic&&b.set("is_dynamic",a.is_dynamic);null!=a.is_filtered&&null!=a.filter_form&&r(a.filter_form)&&0!==a.filter_form.length&&(a.filter_form=JSON.parse(a.filter_form),a.filter_values=Ut(a.filter_form),b.set("filter_form",a.filter_form),
b.set("filter_form_embedjs",a.filter_form_embedjs),b.set("is_filtered",a.is_filtered),b.set("is_bo_filtered",a.is_bo_filtered),b.set("filter_values",a.filter_values),b.applyFilter=function(){if(null!=this.get("filter_values")&&null!=this.get("filter_values").search){var a;b:{var b=this.get("filter_values").search;try{a=kb(b)}catch(k){a={};break b}for(var c in a)if(ha(a[c])){if(null!=a[c].selectedOption)if(null!=a[c].selectedOption.value)a[c]=a[c].selectedOption.value;else if(q(a[c].selectedOption)){for(var b=
[],g=0;g<a[c].selectedOption.length;g++)null!=a[c].selectedOption[g].value&&b.push(a[c].selectedOption[g].value);a[c]=angular.copy(b)}else delete a[c]}else null!=a[c]||delete a[c]}this.set("filter_values_cleared",a);"undefined"!==typeof B&&null!=B&&null!=B.scope&&B.scope.$broadcast("layersChanged");if(this.s()instanceof sr||this.s()instanceof qr){c=this.s().gc;for(var h in a)q(a[h])?c[h]=a[h].join("|"):c[h]=a[h],null!=c[h]&&(q(c[h])&&ha(c[h])?delete c[h]:r(c[h])&&""===c[h]&&delete c[h]);this.s().updateParams(c);
this.s().refresh()}}},b.applyFilter());a.visible="true"===a.visible||!0===a.visible?!0:!1;b.setVisible(a.visible);null!=a.opacity&&b.Ql(a.opacity);a.olLayer=b;b.values=b.Ki;return b}function Ut(a){var b={},c;for(c in a)if("datasources"!==c){b[c]={};for(var d=0;d<a[c].rows.length;d++)for(var e=0;e<a[c].rows[d].fields.length;e++){var f=a[c].rows[d].fields[e].name,g=a[c].rows[d].fields[e].default_value;null!=b[c][f]?null!=g&&""===b[c][f]&&(b[c][f]=g):(b[c][f]="",null!=g&&(b[c][f]=g))}}return b}
Qt.prototype.oh=function(a){var b=a;"undefined"!==typeof B&&null!=B&&null!=B.wu&&null!=B.oa.oh&&(b=B.oa.oh(a));return b};Qt.prototype.tr=function(a){var b=a;"undefined"!==typeof B&&null!=B&&null!=B.wu&&null!=B.oa.tr&&(b=B.oa.tr(a));return b};function Vt(){B.log("nsVmap.nsMapManager.LayersTree")}qa("nsVmap.nsMapManager.LayersTree",Vt);Vt.prototype.XJ=function(){B.log("nsVmap.nsMapManager.LayersTree.prototype.layertreeDirective");return{restrict:"A",scope:{map:"=appMap",proj:"=appProj",lang:"=appLang"},controller:"AppLayertreeController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/layers/layertree.html"}};B.module.directive("appLayertree",Vt.prototype.XJ);
Vt.prototype.WJ=function(){B.log("nsVmap.nsMapManager.LayersTree.prototype.layerOpacitySliderDirective");return{restrict:"A",link:function(a,b){setTimeout(function(){var c=new Slider(b[0],{value:100*a.layer.olLayer.Vg(),step:1,min:0,max:100,eQ:function(a){return a+" %"}});c.on("change",function(){var b=c.getValue();a.layer.olLayer.Ql(b/100)})})}}};B.module.directive("appLayerOpacitySlider",Vt.prototype.WJ);
Vt.prototype.Da=function(a,b){B.log("nsVmap.nsMapManager.LayersTree.prototype.LayertreeController");var c=this;this.If=a;a.tree=B.oa.oj();this.properties=B.properties;this.token=B.properties.token;this.olFilteredLayer={};this.refreshLayersEvents=[];null!=B.properties.vmap&&(this.layers_collapsed=B.properties.vmap.layers_collapsed,this.layerstree_collapsed=B.properties.vmap.layerstree_collapsed);this.il();if(null!=v.oWebsocket)v.oWebsocket.on("event",function(a){for(var b=0;b<c.refreshLayersEvents.length;b++)c.refreshLayersEvents[b].event===
a&&B.bRefreshWebsockets&&null!=c.refreshLayersEvents[b].layer&&null!=c.refreshLayersEvents[b].layer.ud&&c.refreshLayersEvents[b].layer.ud(!0)});$("body").click(function(b){$(b.target).hasClass(".layer-menu")||$(b.target).closest(".layer-menu").length||$(b.target).hasClass(".layer-menu-button")||$(b.target).closest(".layer-menu-button").length||a.$applyAsync(function(){c.qp()})});if(B.properties.is_mobile)b.find(".modal").on("shown.bs.modal",function(){$(".modal-backdrop.fade.in").hide();$(".modal.fade.in").find(".modal-dialog").addClass("mobile-full-modal")})};
Vt.prototype.LayertreeController=Vt.prototype.Da;Vt.prototype.Da.$inject=["$scope","$element"];B.module.controller("AppLayertreeController",Vt.prototype.Da);Vt.prototype.Da.prototype.setVisible=function(a,b){B.log("nsVmap.nsMapManager.LayersTree.prototype.LayertreeController.prototype.setVisible",b);a.setVisible(b);this.map.La()};Vt.prototype.Da.prototype.setVisible=Vt.prototype.Da.prototype.setVisible;
Vt.prototype.Da.prototype.nN=function(a){for(var b=0;b<a.children.length;b++)void 0!==a.children[b].olLayer.get("select")&&a.children[b].olLayer.set("select",a.selectable);this.FB(a)};Vt.prototype.Da.prototype.setGroupSelectable=Vt.prototype.Da.prototype.nN;Vt.prototype.Da.prototype.PJ=function(a){for(var b=0,c=0;c<a.children.length;c++)!0===a.children[c].olLayer.getVisible(a.visible)&&b++;return b===a.children.length?!0:0===b?!1:null};Vt.prototype.Da.prototype.isGroupVisible=Vt.prototype.Da.prototype.PJ;
Vt.prototype.Da.prototype.oN=function(a){for(var b=0;b<a.children.length;b++)a.children[b].olLayer.setVisible(a.visible);this.GB(a)};Vt.prototype.Da.prototype.setGroupVisible=Vt.prototype.Da.prototype.oN;Vt.prototype.Da.prototype.FB=function(a){if(void 0!==a){var b=a.children;void 0===a.Or&&(a.Or=[]);for(var c=a.Or.length=0;c<b.length;c++)!0===b[c].olLayer.get("select")&&a.Or.push(b[c].olLayer);a.selectable=0===a.Or.length?!1:!0}};Vt.prototype.Da.prototype.memoriseGroupSelectable=Vt.prototype.Da.prototype.FB;
Vt.prototype.Da.prototype.GB=function(a){if(void 0!==a){var b=a.children;void 0===a.visibleLayers&&(a.visibleLayers=[]);for(var c=a.visibleLayers.length=0;c<b.length;c++)!0===b[c].olLayer.getVisible()&&a.visibleLayers.push(b[c].olLayer);a.visible=0===a.visibleLayers.length?!1:!0}};Vt.prototype.Da.prototype.memoriseGroupVisible=Vt.prototype.Da.prototype.GB;
Vt.prototype.Da.prototype.Qn=function(){B.log("nsVmap.nsMapManager.LayersTree.prototype.LayertreeController.prototype.reloadTree");var a=jQuery.extend(!0,{},B.oa.oj());B.oa.Sj(a);0<this.map.getLayers().P().length&&this.map.getLayers().clear();this.If.tree=a;this.il();B.Pj(!1)};Vt.prototype.Da.prototype.reloadTree=Vt.prototype.Da.prototype.Qn;
Vt.prototype.Da.prototype.il=function(){B.log("nsVmap.nsMapManager.LayersTree.prototype.LayertreeController.prototype.loadTree");0<this.map.getLayers().P().length&&this.map.getLayers().clear();B.log(this.If.tree);var a=[B.properties.vmap.wmsTilesWidth,B.properties.vmap.wmsTilesHeight],b=new Qt({properties:B.properties}),c=b.jq(this.If.tree,{size:this.map.$a(),tileSize:a}),a=b.vu(this.If.tree,{size:this.map.$a(),tileSize:a});B.log("nsVmap.nsMapManager.LayersTree.prototype.LayertreeController.prototype.addView");
var d=Ei(E(this.map),this.map.$a()),b=E(this.map).J().Z,e=c.J().Z;c.set("homePosition",{Oa:c.Ka(),ra:c.Fa()});var f=E(this.map).get("homePosition");B.g().mD(c);this.map.zi(c);this.proj=c.J().Z;if(n(b)&&n(e)&&n(d)&&n(f))for(d=uh(d,b,e),Ji(E(this.map),d,{Dj:!0}),d=B.g(),B.log("nsVmap.Map.prototype.reprojectFeatures"),f=0;f<d.Cf.length;f++){var g=d.Cf[f].s(),h=b,k=e;Ft("ol.source.Vector.prototype.transformFeatures");for(var g=g.Ca(),m=0;m<g.length;m++)g[m].jd(g[m].j().transform(h,k))}b=B.D.ub.$f().mA();
void 0!==b&&b.Hd.zi(new yi({ra:fe(c).ra,rotation:fe(c).rotation,Oa:fe(c).Oa,pa:c.J().Z}));$("#current-projection").html(B.oProjections[E(this.map).J().Z]);c=B.oa.Zb;for(b=0;b<c.maps.length;b++)if(!0===c.maps[b].used)var p=c.maps[b].name;$("map-name").html(p);Pa(this.refreshLayersEvents);for(p=0;p<a.length;p++)if(c=a[p].get("events"),q(c))for(Za(c),b=0;b<c.length;b++)this.refreshLayersEvents.push({layer:a[p],event:c[b]});for(p=0;p<a.length;p++)this.Pb(a[p])};
Vt.prototype.Da.prototype.Pb=function(a){B.log("nsVmap.nsMapManager.LayersTree.prototype.LayertreeController.prototype.addLayer");this.map.Pb(a);B.ZA()};
Vt.prototype.Da.prototype.HG=function(a){B.log("nsVmap.nsMapManager.LayersTree.LayertreeController.displayFilterLayerModal");this.olFilteredLayer=a;null!=a.get("filter_form")||a.set("filter_form",{search:{}});null!=a.get("filter_values")||a.set("filter_values",{search:{}});var b=a.get("filter_form"),c=a.get("filter_values"),d=a.get("filter_form_embedjs"),e={fields:[{type:"button","class":"btn-ungroup btn-group-sm hidden",nb_cols:12,buttons:[{visibleAllTabs:!0,id:"layerstree_filter_formreader_submit_btn",
type:"submit",label:"FORM_UPDATE",name:"form_submit","class":"btn-primary"}]}]};angular.equals(b.search.rows[b.search.rows.length-1],e)||b.search.rows.push(e);b.search.event=function(b){a.set("filter_values",b);a.applyFilter();$("#layerstree-filter-modal").modal("hide");$.notify("Op\u00e9ration r\u00e9alis\u00e9e avec succ\u00e8s, les couches de la carte se mettent \u00e0 jour","info")};var f=angular.element($("#layerstree_filter_formreader").children()).scope();f.$evalAsync(function(){f.ctrl.setDefinitionName("search");
f.ctrl.setFormValues(c);f.ctrl.setFormDefinition(b);f.ctrl.loadForm();"function"===typeof destructor_form&&destructor_form();"function"===typeof constructor_form&&(constructor_form=void 0);null!=d&&(eval(d),constructor_form(f,null));$("#layerstree-filter-modal").modal("show")})};Vt.prototype.Da.prototype.displayFilterLayerModal=Vt.prototype.Da.prototype.HG;
Vt.prototype.Da.prototype.tO=function(a,b){B.log("nsVmap.nsMapManager.LayersTree.LayertreeController.toggleLayerMenu");!0===a.displayedMenu?this.qp():(this.qp(),a.displayedMenu=!0);setTimeout(function(){var a=$(b.target).closest(".layers-tree-ul").find(".layer-menu").position().top,a=$("body").height()-a-40;$(b.target).closest(".layers-tree-ul").find(".layer-menu").css("max-height",a+"px")})};Vt.prototype.Da.prototype.toggleLayerMenu=Vt.prototype.Da.prototype.tO;
Vt.prototype.Da.prototype.qp=function(){for(var a=0;a<this.If.tree.children.length;a++)if(null!=this.If.tree.children[a].children)for(var b=0;b<this.If.tree.children[a].children.length;b++)null!=this.If.tree.children[a].children[b].olLayer&&(this.If.tree.children[a].children[b].displayedMenu=!1)};Vt.prototype.Da.prototype.closeLayersMenus=Vt.prototype.Da.prototype.qp;
Vt.prototype.Da.prototype.uO=function(a,b,c){B.log("nsVmap.nsMapManager.LayersTree.LayertreeController.toggleSubLayer");if(-1===a.get("sublayers").indexOf(b))return console.error("Sublayer not avaliable"),null;var d=a.s().gc;if(null==d)return console.error("Params not avaliable"),null;if(!r(d.LAYERS))return console.error("Params[LAYERS] not avaliable"),null;d=this.SA(a,b);!0===d?this.cE(a,b,c):!1===d&&this.Mx(a,b)};Vt.prototype.Da.prototype.toggleSubLayer=Vt.prototype.Da.prototype.uO;
Vt.prototype.Da.prototype.SA=function(a,b){a=a.get("activeSublayers");return null==a?(console.error("aActiveSublayers undefined"),!1):-1!==a.indexOf(b)?!0:!1};Vt.prototype.Da.prototype.isSublayerActive=Vt.prototype.Da.prototype.SA;
Vt.prototype.Da.prototype.Mx=function(a,b){B.log("nsVmap.nsMapManager.LayersTree.LayertreeController.activeSublayer");var c=a.get("sublayers"),d=a.get("activeSublayers");if(-1===c.indexOf(b))return console.error("Sublayer not avaliable"),null;var e=a.s().gc;if(null==e)return console.error("Params not avaliable"),null;if(!r(e.LAYERS))return console.error("Params[LAYERS] not avaliable"),null;if(-1!==d.indexOf(b))return console.error("sublayer already active in layer"),null;for(var f=[],g=0;g<c.length;g++)c[g]!=
b&&-1===d.indexOf(c[g])||f.push(c[g]);a.set("activeSublayers",f);e.LAYERS=f.join(",");a.s().updateParams(e)};Vt.prototype.Da.prototype.activeSublayer=Vt.prototype.Da.prototype.Mx;
Vt.prototype.Da.prototype.cE=function(a,b,c){B.log("nsVmap.nsMapManager.LayersTree.LayertreeController.unactiveSublayer");if(-1===a.get("sublayers").indexOf(b))return console.error("Sublayer not avaliable"),null;var d=a.s().gc;if(null==d)return console.error("Params not avaliable"),null;if(!r(d.LAYERS))return console.error("Params[LAYERS] not avaliable"),null;var e=d.LAYERS.split(",");if(1>=e.length)return $.notify("Au moins une couche doit \u00eatre pr\u00e9sente par calque","error"),$(c.replace(":",
"\\:")).prop("checked",!0),null;if(-1!==e.indexOf(b))e.splice(e.indexOf(b),1);else return console.error("sublayer not defined in layer"),null;a.set("activeSublayers",e);d.LAYERS=e.join(",");a.s().updateParams(d)};Vt.prototype.Da.prototype.unactiveSublayer=Vt.prototype.Da.prototype.cE;function Wt(){B.log("nsVmap.nsMapManager.LayersOrder")}qa("nsVmap.nsMapManager.LayersOrder",Wt);Wt.prototype.bB=function(){B.log("nsVmap.nsMapManager.LayersOrder.prototype.layersorderDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang"},controller:"AppLayersorderController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/layers/layersorder.html"}};Wt.prototype.layersorderDirective=Wt.prototype.bB;
Wt.prototype.dh=function(){B.log("nsVmap.nsMapManager.LayersOrder.prototype.layersorderController");var a=this;this.selectedLayers=this.map.getLayers().P().slice().reverse();null!=B.properties.vmap&&(this.layersorder_collapsed=B.properties.vmap.layersorder_collapsed);fj(B.g().B).on("change",function(){this.selectedLayers=this.map.getLayers().P().slice().reverse()},this);var b=$(".sortable-list").sortable({handle:".sortable-handle",onDrop:function(c,d){c.removeClass(d.group.options.draggedClass).removeAttr("style");
$("body").removeClass(d.group.options.bodyClass);data=b.sortable("serialize").get();c=data[0];d=a.selectedLayers;B.g().B.getLayers().clear();for(var e=c.length-1;0<=e;e--)for(var f=0;f<d.length;f++)d[f].$$hashKey===c[e].hashkey&&B.g().B.getLayers().push(d[f])},onDragStart:function(a,b,e){var c=a.offset(),d=b.rootGroup.pointer;adjustment={left:d.left-c.left,top:d.top-c.top};e(a,b)},onDrag:function(a,b){a.css({left:b.left-adjustment.left,top:b.top-adjustment.top})}})};
Wt.prototype.layersorderController=Wt.prototype.dh;Wt.prototype.dh.$inject=["$scope"];Wt.prototype.dh.prototype.setVisible=function(a,b){B.log("nsVmap.nsMapManager.LayersOrder.prototype.layersorderController.prototype.setVisible",b);a.setVisible(b);this.map.La()};Wt.prototype.dh.prototype.setVisible=Wt.prototype.dh.prototype.setVisible;
Wt.prototype.dh.prototype.uN=function(a){var b=a.get("select"),c=B.oa.oj();a.set("select",!b);for(var d=0;d<c.children.length;d++)if(c.children[d].children){oService=c.children[d].children;for(var e=0;e<oService.length;e++)oService[e].olLayer.$$hashKey===a.$$hashKey&&(oService[e].select=!b)}};Wt.prototype.dh.prototype.setSelectable=Wt.prototype.dh.prototype.uN;B.module.directive("appLayersorder",Wt.prototype.bB);B.module.controller("AppLayersorderController",Wt.prototype.dh);function Xt(){B.log("nsVmap.nsMapManager.MapLegend")}qa("nsVmap.nsMapManager.MapLegend",Xt);Xt.prototype.CJ=function(a){B.log("nsVmap.nsMapManager.MapLegend.prototype.hideBrokenLegend");$(a).closest(".layer-legend").hide()};Xt.prototype.hideBrokenLegend=Xt.prototype.CJ;
Xt.prototype.yB=function(){B.log("nsVmap.nsMapManager.MapLegend.prototype.maplegendDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang"},controller:"AppMaplegendController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/layers/maplegend.html"}};Xt.prototype.maplegendDirective=Xt.prototype.yB;
Xt.prototype.zB=function(){B.log("nsVmap.nsMapManager.MapLegend.prototype.maplegendImageDirective");return{link:function(a,b){var c=0;$(b).mouseenter(function(){c++;var b=angular.copy(c);setTimeout(function(){if(b===c){var d;$("[app-maplegend]").popover({html:!0,content:'<img src="'+a.node.legendURL+'" class="img-responsive">',placement:function(a){d=a;return"right"}});$("[app-maplegend]").popover("show");setTimeout(function(){var a=$(d).offset().top,b=$(d).height(),b=a+b,c=$("body").height(),e=$("#footer_line").height(),
c=c-e;b>c&&$(d).css("top",a-(b-c)+"px")})}},500)}).mouseleave(function(){c++;$("[app-maplegend]").popover("destroy")})}}};Xt.prototype.maplegendImageDirective=Xt.prototype.zB;Xt.prototype.Ed=function(a){B.log("nsVmap.nsMapManager.MapLegend.prototype.maplegendController");var b=this;this.b=a;this.aUrls=[];null!=B.properties.vmap&&(this.legend_collapsed=B.properties.vmap.legend_collapsed);B.scope.$on("layersChanged",function(){b.ov()});setTimeout(function(){b.ov()})};
Xt.prototype.maplegendController=Xt.prototype.Ed;Xt.prototype.Ed.$inject=["$scope"];
Xt.prototype.Ed.prototype.ov=function(){B.log("nsVmap.nsMapManager.MapLegend.maplegendController.loadLegend");B.log("nsVmap.nsMapManager.MapLegend.maplegendController.getLegendUrls");for(var a=B.g().B.getLayers().P(),b={},c=0;c<a.length;c++)if(!0===a[c].get("legend")&&!0===a[c].get("visible"))if("tilewms"===a[c].get("type")){var d=a[c].get("name");b[d]=[];for(var e=0;e<a[c].s().Fc.length;e++){var f=a[c].s().gc.LAYERS,g=[];null!=f&&(g=a[c].s().gc.LAYERS.split(","));for(f=0;f<g.length;f++){var h=-1!==
a[c].s().Fc[e].indexOf("?")?"&":"?";b[d].push({layerId:c,collapsed:!1,url:a[c].s().Fc[e],layer:g[f],olLayer:a[c],layerName:a[c].get("name"),service_login:null!=a[c].get("service_login")?a[c].get("service_login"):null,service_password:null!=a[c].get("service_password")?a[c].get("service_password"):null,legendURL:a[c].s().Fc[e]+h+"request=GetLegendGraphic&LAYER="+g[f]+"&FORMAT=image/png&VERSION=1.1.0&service=wms"})}}}else if("imagewms"===a[c].get("type"))for(d=a[c].get("name"),f=a[c].s().gc.LAYERS,
g=[],null!=f&&(g=a[c].s().gc.LAYERS.split(",")),b[d]=[],f=0;f<g.length;f++)h=-1!==a[c].s().jf.indexOf("?")?"&":"?",b[d].push({layerId:c,collapsed:!1,url:a[c].s().jf,layer:g[f],olLayer:a[c],layerName:a[c].get("name"),service_login:null!=a[c].get("service_login")?a[c].get("service_login"):null,service_password:null!=a[c].get("service_password")?a[c].get("service_password"):null,legendURL:a[c].s().jf+h+"request=GetLegendGraphic&LAYER="+g[f]+"&FORMAT=image/png&VERSION=1.1.0&service=wms"});this.oUrls=
b;this.vz(this.oUrls)};Xt.prototype.Ed.prototype.loadLegend=Xt.prototype.Ed.prototype.ov;Xt.prototype.Ed.prototype.vz=function(a){B.log("nsVmap.nsMapManager.MapLegend.maplegendController.downloadLegendImgs");for(var b in a)for(var c=0;c<a[b].length;c++)a[b][c].legendBlobURL=this.uz(a[b][c])};Xt.prototype.Ed.prototype.downloadLegendImgs=Xt.prototype.Ed.prototype.vz;
Xt.prototype.Ed.prototype.uz=function(a){B.log("nsVmap.nsMapManager.MapLegend.maplegendController.downloadLegendImg");var b=this,c=new XMLHttpRequest;c.responseType="blob";c.onreadystatechange=function(){b.b.$applyAsync(function(){a.legendBlobURL=c.readyState!==XMLHttpRequest.DONE||200!==c.status||"image/png"!==c.response.type&&"image/jpg"!==c.response.type&&"image/jpeg"!==c.response.type?!1:URL.createObjectURL(c.response)})};c.open("GET",a.legendURL,!0);null!=a.service_login&&null!=a.service_password&&
c.setRequestHeader("Authorization","Basic "+btoa(a.service_login+":"+a.service_password));b.b.$applyAsync(function(){a.legendBlobURL=!1});c.send()};Xt.prototype.Ed.prototype.downloadLegendImg=Xt.prototype.Ed.prototype.uz;Xt.prototype.Ed.prototype.IF=function(a){for(var b=!1,c=0;c<a.length;c++)!1!==a[c].legendBlobURL&&(b=!0);return b};Xt.prototype.Ed.prototype.areLegendsLoaded=Xt.prototype.Ed.prototype.IF;B.module.directive("appMaplegend",Xt.prototype.yB);B.module.directive("legendImageNode",Xt.prototype.zB);
B.module.controller("AppMaplegendController",Xt.prototype.Ed);function Yt(){B.log("nsVmap.nsMapManager.nsMapModal.MapList")}qa("nsVmap.nsMapManager.nsMapModal.MapList",Yt);Yt.prototype.XF=function(a){B.log("nsVmap.nsMapManager.nsMapModal.MapList.prototype.changeFilePath");var b=$(a).val(),c=b.lastIndexOf("\\");-1!==c&&(b=b.slice(c+1));$("#upload-file-info").val(b);$("#upload-file-add-button").attr("url","");$("#upload-file-add-button").attr("file-container",a.id)};Yt.prototype.changeFilePath=Yt.prototype.XF;
Yt.prototype.yK=function(){B.log("nsVmap.nsMapManager.nsMapModal.MapList.prototype.maplistDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppMaplistController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/layers/mapmodal/maplist.html"}};
Yt.prototype.gi=function(){B.log("nsVmap.nsMapManager.nsMapModal.MapList.prototype.maplistController");this.newMapUrl="";this.catalog=B.oa.Ef.Zb;this.projections=B.oProjections;this.mapForm={view:{}};var a=document.getElementById("maplist-file-drop-zone");a.addEventListener("dragover",function(a){this.className="upload-drop-zone drop";a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy";return!1},!1);a.addEventListener("dragleave",function(){this.className="upload-drop-zone";return!1},
!1);a.addEventListener("drop",function(a){a.stopPropagation();a.preventDefault();this.files=a=a.dataTransfer.files;$("#upload-file-info").val(a[0].name);$("#upload-file-add-button").attr("file-container",this.id);this.className="upload-drop-zone";return!1},!1)};Yt.prototype.maplistController=Yt.prototype.gi;
Yt.prototype.gi.prototype.IJ=function(){B.log("nsVmap.nsMapManager.nsMapModal.MapList.prototype.initNewMapForm");this.mapForm.view={center:E(this.map).Ka(),zoom:E(this.map).zf(),maxZoom:28,minZoom:0,projection:E(this.map).J().Z}};Yt.prototype.gi.prototype.initNewMapForm=Yt.prototype.gi.prototype.IJ;
Yt.prototype.gi.prototype.nG=function(){B.log("nsVmap.nsMapManager.nsMapModal.MapList.prototype.createNewMap");B.oa.Sj({name:"Tree",children:[{view:this.mapForm.view}]});B.oa.Lj();for(var a=B.oa.Zb,b=0;b<a.maps.length;b++)a.maps[b].used=!1;B.ZA()};Yt.prototype.gi.prototype.createNewMap=Yt.prototype.gi.prototype.nG;B.module.directive("appMaplist",Yt.prototype.yK);B.module.controller("AppMaplistController",Yt.prototype.gi);function Zt(){B.log("nsVmap.nsMapManager.nsMapModal.MapListLitle")}qa("nsVmap.nsMapManager.nsMapModal.MapListLitle",Zt);Zt.prototype.zK=function(){B.log("nsVmap.nsMapManager.nsMapModal.MapListLitle.prototype.maplistlitleDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppMaplistlitleController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/layers/mapmodal/"+(B.properties.is_mobile?"maplistlitle_mobile.html":"maplistlitle.html")}};
Zt.prototype.uv=function(a){B.log("nsVmap.nsMapManager.nsMapModal.MapListLitle.prototype.maplistlitleController");var b=this;this.catalog=B.oa.Ef.Zb;a.filter="";a.themes=$t(this.catalog.maps);a.mapsByThemes=[];a.filterTheme="";a.$watchGroup(["filter","filterTheme"],function(){var c=Ma(b.catalog.maps,function(b){var c=Yc(String(a.filter).toLowerCase()),d=Yc(String(b.name).toLowerCase()),g=Yc(String(b.description).toLowerCase());b=Yc(String(b.theme_name).toLowerCase());b="null"===b?"autres":b;return-1!==
d.indexOf(c)||-1!==g.indexOf(c)||-1!==b.indexOf(c)?""===a.filterTheme||a.filterTheme.toLowerCase()===b?!0:!1:!1});a.mapsByThemes=au(c)});$("body").click(function(a){try{$.contains($("#maplistlitle-container")[0],$(a.target)[0])||$("#maplistlitle-container").removeClass("open")}catch(d){}});$(".maplist-map").click(function(){$("#maplistlitle-container").removeClass("open")})};Zt.prototype.maplistlitleController=Zt.prototype.uv;Zt.prototype.uv.$inject=["$scope"];
function au(a){for(var b={},c=0;c<a.length;c++)n(b[a[c].theme_name])?b[a[c].theme_name].push(a[c]):b[a[c].theme_name]=[a[c]];return b}function $t(a){for(var b=[],c,d=0;d<a.length;d++)c=null===a[d].theme_name?"Autres":a[d].theme_name,-1===b.indexOf(c)&&b.push(c);return b}B.module.directive("appMaplistlitle",Zt.prototype.zK);B.module.controller("AppMaplistlitleController",Zt.prototype.uv);function bu(){B.log("nsVmap.nsMapManager.nsMapModal.MyMap")}qa("nsVmap.nsMapManager.nsMapModal.MyMap",bu);bu.prototype.jL=function(){B.log("nsVmap.nsMapManager.nsMapModal.MyMap.prototype.mymapDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppMymapController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/layers/mapmodal/mymap.html"}};
bu.prototype.fe=function(){B.log("nsVmap.nsMapManager.nsMapModal.MyMap.prototype.mymapController");this.mapFileHref="";this.oLayersTree={};this.view=this.view={};this.displayedView={};var a=!!document.documentMode,b=!a&&!!window.StyleMedia;this.isIE=!0===a||!0===b};bu.prototype.mymapController=bu.prototype.fe;
bu.prototype.fe.prototype.Qn=function(){B.log("nsVmap.nsMapManager.nsMapModal.MyMap.prototype.mymapController.prototype.reloadTree");this.oLayersTree=B.oa.oj();this.view={zoom:E(B.g().B).zf(),center:E(B.g().B).Ka(),projection:E(B.g().B).J().Z,extent:Ei(E(this.map),this.map.$a())};this.displayedView={zoom:this.view.zoom,center:this.view.center[0]+", "+this.view.center[1],projection:B.oProjections[this.view.projection],extent:this.view.extent[0]+", "+this.view.extent[1]+", "+this.view.extent[3]+", "+
this.view.extent[3]};this.FC();$('[data-toggle="tooltip"]').tooltip()};bu.prototype.fe.prototype.reloadTree=bu.prototype.fe.prototype.Qn;bu.prototype.fe.prototype.Fl=function(a){B.log("nsVmap.nsMapManager.nsMapModal.MyMap.prototype.mymapController.prototype.removeLayer");B.oa.Fl(a);this.Qn()};bu.prototype.fe.prototype.removeLayer=bu.prototype.fe.prototype.Fl;
bu.prototype.fe.prototype.FC=function(){B.log("nsVmap.nsMapManager.nsMapModal.MyMap.prototype.mymapController.prototype.reloadMapFile");var a=B.oa.aq();this.mapFileHref=a="data:text/json;charset=utf-8,"+encodeURIComponent(a);$("#exportMapButton").attr("href",a)};bu.prototype.fe.prototype.reloadMapFile=bu.prototype.fe.prototype.FC;
bu.prototype.fe.prototype.gj=function(){B.log("nsVmap.nsMapManager.nsMapModal.MyMap.prototype.mymapController.prototype.downloadBlob");var a=new Blob([B.oa.aq()]);window.navigator.msSaveBlob(a,"map.json")};bu.prototype.fe.prototype.downloadBlob=bu.prototype.fe.prototype.gj;B.module.directive("appMymap",bu.prototype.jL);B.module.controller("AppMymapController",bu.prototype.fe);function cu(){this.version=void 0}F(cu,$r);cu.prototype.zr=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType==Node.ELEMENT_NODE)return this.Kj(a);return null};cu.prototype.Kj=function(a){this.version=a.getAttribute("version").trim();return(a=mq({version:this.version},du,a,[]))?a:null};function eu(a,b){return mq({},fu,a,b)}function gu(a,b){return mq({},hu,a,b)}function iu(a,b){if(b=eu(a,b))return a=[gs(a.getAttribute("width")),gs(a.getAttribute("height"))],b.size=a,b}
function ju(a,b){return mq([],ku,a,b)}
var lu=[null,"http://www.opengis.net/wms"],du=P(lu,{Service:M(function(a,b){return mq({},mu,a,b)}),Capability:M(function(a,b){return mq({},nu,a,b)})}),nu=P(lu,{Request:M(function(a,b){return mq({},ou,a,b)}),Exception:M(function(a,b){return mq([],pu,a,b)}),Layer:M(function(a,b){return mq({},qu,a,b)})}),mu=P(lu,{Name:M(Q),Title:M(Q),Abstract:M(Q),KeywordList:M(ju),OnlineResource:M(Zr),ContactInformation:M(function(a,b){return mq({},ru,a,b)}),Fees:M(Q),AccessConstraints:M(Q),LayerLimit:M(fs),MaxWidth:M(fs),
MaxHeight:M(fs)}),ru=P(lu,{ContactPersonPrimary:M(function(a,b){return mq({},su,a,b)}),ContactPosition:M(Q),ContactAddress:M(function(a,b){return mq({},tu,a,b)}),ContactVoiceTelephone:M(Q),ContactFacsimileTelephone:M(Q),ContactElectronicMailAddress:M(Q)}),su=P(lu,{ContactPerson:M(Q),ContactOrganization:M(Q)}),tu=P(lu,{AddressType:M(Q),Address:M(Q),City:M(Q),StateOrProvince:M(Q),PostCode:M(Q),Country:M(Q)}),pu=P(lu,{Format:dq(Q)}),qu=P(lu,{Name:M(Q),Title:M(Q),Abstract:M(Q),KeywordList:M(ju),CRS:fq(Q),
EX_GeographicBoundingBox:M(function(a,b){var c=mq({},uu,a,b);if(c){a=c.westBoundLongitude;b=c.southBoundLatitude;var d=c.eastBoundLongitude,c=c.northBoundLatitude;if(void 0!==a&&void 0!==b&&void 0!==d&&void 0!==c)return[a,b,d,c]}}),BoundingBox:fq(function(a){var b=[es(a.getAttribute("minx")),es(a.getAttribute("miny")),es(a.getAttribute("maxx")),es(a.getAttribute("maxy"))],c=[es(a.getAttribute("resx")),es(a.getAttribute("resy"))];return{crs:a.getAttribute("CRS"),extent:b,res:c}}),Dimension:fq(function(a){return{name:a.getAttribute("name"),
units:a.getAttribute("units"),unitSymbol:a.getAttribute("unitSymbol"),"default":a.getAttribute("default"),multipleValues:bs(a.getAttribute("multipleValues")),nearestValue:bs(a.getAttribute("nearestValue")),current:bs(a.getAttribute("current")),values:Q(a)}}),Attribution:M(function(a,b){return mq({},vu,a,b)}),AuthorityURL:fq(function(a,b){if(b=eu(a,b))return b.name=a.getAttribute("name"),b}),Identifier:fq(Q),MetadataURL:fq(function(a,b){if(b=eu(a,b))return b.type=a.getAttribute("type"),b}),DataURL:fq(eu),
FeatureListURL:fq(eu),Style:fq(function(a,b){return mq({},wu,a,b)}),MinScaleDenominator:M(ds),MaxScaleDenominator:M(ds),Layer:fq(function(a,b){var c=b[b.length-1],d=mq({},qu,a,b);if(d)return b=bs(a.getAttribute("queryable")),void 0===b&&(b=c.queryable),d.queryable=void 0!==b?b:!1,b=gs(a.getAttribute("cascaded")),void 0===b&&(b=c.cascaded),d.cascaded=b,b=bs(a.getAttribute("opaque")),void 0===b&&(b=c.opaque),d.opaque=void 0!==b?b:!1,b=bs(a.getAttribute("noSubsets")),void 0===b&&(b=c.noSubsets),d.noSubsets=
void 0!==b?b:!1,(b=es(a.getAttribute("fixedWidth")))||(b=c.fixedWidth),d.fixedWidth=b,(a=es(a.getAttribute("fixedHeight")))||(a=c.fixedHeight),d.fixedHeight=a,["Style","CRS","AuthorityURL"].forEach(function(a){a in c&&(d[a]=(d[a]||[]).concat(c[a]))}),"EX_GeographicBoundingBox BoundingBox Dimension Attribution MinScaleDenominator MaxScaleDenominator".split(" ").forEach(function(a){a in d||(d[a]=c[a])}),d})}),vu=P(lu,{Title:M(Q),OnlineResource:M(Zr),LogoURL:M(iu)}),uu=P(lu,{westBoundLongitude:M(ds),
eastBoundLongitude:M(ds),southBoundLatitude:M(ds),northBoundLatitude:M(ds)}),ou=P(lu,{GetCapabilities:M(gu),GetMap:M(gu),GetFeatureInfo:M(gu)}),hu=P(lu,{Format:fq(Q),DCPType:fq(function(a,b){return mq({},xu,a,b)})}),xu=P(lu,{HTTP:M(function(a,b){return mq({},yu,a,b)})}),yu=P(lu,{Get:M(eu),Post:M(eu)}),wu=P(lu,{Name:M(Q),Title:M(Q),Abstract:M(Q),LegendURL:fq(iu),StyleSheetURL:M(eu),StyleURL:M(eu)}),fu=P(lu,{Format:M(Q),OnlineResource:M(Zr)}),ku=P(lu,{Keyword:dq(Q)});function zu(){B.log("nsVmap.nsMapManager.nsMapModal.WMSSuggestions")}qa("nsVmap.nsMapManager.nsMapModal.WMSSuggestions",zu);zu.prototype.FE=function(){B.log("nsVmap.wmssuggestionsDirective");return{restrict:"E",scope:{map:"=appMap",proj:"=appProj",lang:"=appLang"},controller:"AppWmssuggestionsController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/layers/mapmodal/wmssuggestions.html"}};zu.prototype.wmssuggestionsDirective=zu.prototype.FE;
zu.prototype.kf=function(a){B.log("nsVmap.wmssuggestionsController");var b=this;this.b=a;this.aLayers=[];a.aServices=[];this.WC=this.VC=this.qw="";a.oSelectedService={url:"",login:"",password:""};a.oSelectedStyle={};a.filter="";a.$watch("filter",function(){var c=Ma(b.aLayers,function(b){var c=Yc(String(a.filter).toLowerCase()),d=Yc(String(b.Name).toLowerCase()),g=Yc(String(b.Title).toLowerCase());b=Yc(String(b.projections).toLowerCase());return-1!==d.indexOf(c)||-1!==g.indexOf(c)||-1!==b.indexOf(c)?
!0:!1});b.aLayersFiltered=c});this.GC()};zu.prototype.wmssuggestionsController=zu.prototype.kf;zu.prototype.kf.$inject=["$scope"];
zu.prototype.kf.prototype.pu=function(){B.log("getCapabilities");var a=this,b=angular.copy(Zc(this.b.oSelectedService.url)),c=[];Pa(this.aLayers);Pa(this.aLayersFiltered);if(""===b)return $.notify("Veuillez renseigner une URL","error"),0;this.qw=angular.copy(Zc(this.b.oSelectedService.url));this.VC=angular.copy(this.b.oSelectedService.login);this.WC=angular.copy(this.b.oSelectedService.password);b=-1===b.indexOf("?")?b+"?":b+"&";b+="service=WMS&version=1.3.0&request=GetCapabilities";$("#log-message").empty();
$("#load-img-wms").show();var d={charset:"charset=utf-8"};r(this.b.oSelectedService.login)&&r(this.b.oSelectedService.password)&&0<this.b.oSelectedService.login.length&&0<this.b.oSelectedService.password.length&&(d.Authorization="Basic "+btoa(this.b.oSelectedService.login+":"+this.b.oSelectedService.password));A({method:"GET",url:B.properties.proxy_url+"?url="+encodeURIComponent(b),headers:d,scope:this.b,timeout:5E3,responseType:"text",success:function(b){function d(a){if(void 0===a.Layer)c.push(a);
else for(var b=0;b<a.Layer.length;b++)d(a.Layer[b])}function e(a){"string"==typeof a&&(a=a.replace(/&gt;/ig,">"),a=a.replace(/&lt;/ig,"<"),a=a.replace(/&#039;/g,"'"),a=a.replace(/&quot;/ig,'"'),a=a.replace(/&amp;/ig,"&"));return a}$("#load-img-wms").hide();if(""===b.data)return B.log("GetCapabilities sans r\u00e9sultat"),$.notify("Requ\u00eate GetCapabilities sans r\u00e9sultat, veuillez v\u00e9rifier l'URL du service","error"),0;B.log("GetCapabilities pass");var h=new cu,k=e(b.data);try{k=h.read(k)}catch(p){return bootbox.alert(b.data),
0}var m=[];E(B.g().B).J();h=k.Service.Title;d(k.Capability.Layer);c.serviceTitle=h;c.version=k.version;$(e(b.data)).find("Layer").each(function(){var a={UM:$(this).children("Name").text(),bo:""};if(0<$(this).children("CRS").length&&10>$(this).children("CRS").length)for(var b=0;b<$(this).children("CRS").length;b++)a.bo+=$(this).children("CRS")[b].innerHTML+" ";if(0<$(this).children("SRS").length&&10>$(this).children("SRS").length)for(b=0;b<$(this).children("SRS").length;b++)a.bo+=$(this).children("SRS")[b].innerHTML+
" ";m.push(a)});for(b=0;b<c.length;b++)for(k=0;k<m.length;k++)m[k].UM===c[b].Name&&(c[b].projections=m[k].bo);$("#wms-suggestions-list").show();a.aLayers=c;a.aLayersFiltered=c},error:function(a){$("#load-img-wms").hide();console.error(a);$.notify("Erreur lors du chargement (plus d'infos en console)","error")}})};zu.prototype.kf.prototype.getCapabilities=zu.prototype.kf.prototype.pu;
zu.prototype.kf.prototype.Pb=function(a,b){B.log("nsVmap.nsMapManager.nsMapModal.WMSSuggestions.prototype.wmssuggestionsController.prototype.addLayer");var c=this.qw,d=a.Name,e=a.Title,f=a.queryable,g=this.aLayers.version,h;if(null!=b)h=b,$("#wms-select-style-modal").modal("hide");else if(q(a.Style)){if(1<a.Style.length)return this.oLayerToAdd=a,this.b.oSelectedStyle=this.oLayerToAdd.Style[0],$("#wms-select-style-modal").modal("show"),0;null!=a.Style[0]&&null!=a.Style[0].Name&&(h=a.Style[0].Name)}-1===
c.indexOf("?")&&(c+="?service=wms");B.log("nsVmap.nsMapManager.nsMapModal.WMSSuggestions.prototype.wmssuggestionsController.prototype.getServiceTitle");var k;a=this.b.aServices;for(b=0;b<a.length;b++)a[b].url===this.qw&&(k=a[b].name);null!=k||(k=this.aLayers.serviceTitle);a={};a.url=c;a.sv=this.VC;a.password=this.WC;a.ze="imagewms";a.$c=k;a.$d=d;a.ae=e;a.pM=f;a.version=g;a.style=h;B.oa.Pb(a)};zu.prototype.kf.prototype.addLayer=zu.prototype.kf.prototype.Pb;
zu.prototype.kf.prototype.GC=function(){B.log("nsVmap.nsMapManager.nsMapModal.WMSSuggestions.prototype.wmssuggestionsController.prototype.reloadServicesList");var a=[],b;b=angular.copy(B.oa.Zb);for(var c=0;c<b.services.wms.length;c++)a.push(b.services.wms[c]);for(c=0;c<a.length;c++){b={};if(null!=a[c].service_options)if(r(a[c].service_options))try{b=JSON.parse(a[c].service_options)}catch(d){b={}}else ha(a[c].service_options)&&(b=a[c].service_options);null!=b.login&&null!=b.password?(a[c].login=b.login,
a[c].password=b.password):(a[c].login="",a[c].password="")}this.b.aServices=a};zu.prototype.kf.prototype.reloadServicesList=zu.prototype.kf.prototype.GC;B.module.directive("appWmssuggestions",zu.prototype.FE);B.module.controller("AppWmssuggestionsController",zu.prototype.kf);function Au(){B.log("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions")}qa("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions",Au);Au.prototype.GE=function(){B.log("nsVmap.wmtssuggestionsDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppWmtssuggestionsController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/layers/mapmodal/wmtssuggestions.html"}};Au.prototype.wmtssuggestionsDirective=Au.prototype.GE;
Au.prototype.Rd=function(a){B.log("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions.prototype.wmtssuggestionsController");var b=this;this.b=a;this.hy=angular.element(v.f).scope();this.catalog=B.oa.Ef.Zb;this.aLayers=[];a.filter="";this.oService;this.sRequestUrl="";this.sRequestType="KVP";this.sRequestVersion="1.0.0";this.oLayerToAdd;this.sLayerToAdd_name;this.sLayerToAdd_style_name;this.sLayerToAdd_matrix_name;this.oLayerToAdd_matrix_def={};this.oCapabilities;a.iServiceIndex;a.iSelectedStyleIndex;a.$watch("ctrl.sLayerToAdd_matrix_name",
function(a){ib(b.oLayerToAdd_matrix_def);if(null!=a&&""!==a&&null!=b.oCapabilities&&null!=b.oCapabilities.Contents&&null!=b.oCapabilities.Contents&&q(b.oCapabilities.Contents.TileMatrixSet))for(var c=b.oCapabilities.Contents.TileMatrixSet,e=0;e<c.length;e++)c[e].Identifier===a&&(b.oLayerToAdd_matrix_def=angular.copy(c[e]))});a.$watch("filter",function(){var c=Ma(b.aLayers,function(b){var c=Yc(String(a.filter).toLowerCase()),d=Yc(String(b.Identifier).toLowerCase());b=Yc(String(b.Title).toLowerCase());
return-1!==d.indexOf(c)||-1!==b.indexOf(c)?!0:!1});b.aLayersFiltered=c})};Au.prototype.wmtssuggestionsController=Au.prototype.Rd;Au.prototype.Rd.$inject=["$scope"];
Au.prototype.Rd.prototype.dN=function(a){B.log("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions.prototype.wmtssuggestionsController.prototype.selectService");this.oService=this.catalog.services.wmts[a];null!=this.oService?(this.sRequestUrl=null!=this.oService.url?this.oService.url:"",this.sRequestType=null!=this.oService.service_type_type?this.oService.service_type_type:"KVP",this.sRequestVersion=null!=this.oService.service_type_version?this.oService.service_type_version:"1.0.0"):(this.sRequestUrl=
"",this.sRequestType="KVP",this.sRequestVersion="1.0.0")};Au.prototype.Rd.prototype.selectService=Au.prototype.Rd.prototype.dN;
Au.prototype.Rd.prototype.pu=function(){B.log("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions.prototype.wmtssuggestionsController.prototype.getCapabilities");if(null==this.sRequestUrl||""===this.sRequestUrl)return $.notify("Informations insuffisantes: URL","error"),null;if(null==this.sRequestType||""===this.sRequestType)return $.notify("Informations insuffisantes: Type","error"),null;if(null==this.sRequestVersion||""===this.sRequestVersion)return $.notify("Informations insuffisantes: Version","error"),
null;var a=this;$("#load-img-wmts").show();$("#wmts-suggestions-list").hide();Pa(this.aLayers);Pa(this.aLayersFiltered);ib(a.oCapabilities);var b=angular.copy(Zc(this.sRequestUrl));this.hy.WMTSCapabilities({serviceUrl:b,serviceVersion:this.sRequestVersion,WMTSType:this.sRequestType},function(b){a.oCapabilities=b;$("#load-img-wmts").hide();$("#wmts-suggestions-list").show();b=!1;null!=a.oCapabilities&&null!=a.oCapabilities.Contents&&null!=a.oCapabilities.Contents.Layer&&(b=!0);if(b)a.aLayers=a.oCapabilities.Contents.Layer,
a.aLayersFiltered=a.oCapabilities.Contents.Layer;else return $.notify("Contenu du service incoh\u00e9rent","error"),null},function(b){$("#load-img-wmts").hide();a.hy.$root.modalWindow("dialog","Service non valide",{className:"modal-danger",message:b})})};Au.prototype.Rd.prototype.getCapabilities=Au.prototype.Rd.prototype.pu;
Au.prototype.Rd.prototype.Pb=function(a){B.log("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions.prototype.wmtssuggestionsController.prototype.addLayer");this.sLayerToAdd_matrix_name=this.sLayerToAdd_format_name=this.sLayerToAdd_style_name=this.sLayerToAdd_name="";if(!q(a.Style))return $.notify("Informations insuffisantes: Style","error"),null;if(!q(a.TileMatrixSetLink))return $.notify("Informations insuffisantes: Matrice","error"),null;this.oLayerToAdd=a;this.sLayerToAdd_name=a.Identifier;this.sLayerToAdd_title=
a.Title;1===a.Style.length&&1===a.Format.length&&1===a.TileMatrixSetLink.length?(this.sLayerToAdd_style_name=this.oLayerToAdd.Style[0].Identifier,this.sLayerToAdd_format_name=this.oLayerToAdd.Format[0],this.sLayerToAdd_matrix_name=this.oLayerToAdd.TileMatrixSetLink[0].TileMatrixSet,this.Px()):(this.sLayerToAdd_matrix_name=this.sLayerToAdd_format_name=this.sLayerToAdd_style_name="?",$("#wmts-select-matrix-modal").modal("show"))};Au.prototype.Rd.prototype.addLayer=Au.prototype.Rd.prototype.Pb;
Au.prototype.Rd.prototype.Px=function(){B.log("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions.prototype.wmtssuggestionsController.prototype.addLayerToAdd");if(null==this.sLayerToAdd_name||""===this.sLayerToAdd_name)return $.notify("Informations insuffisantes: Nom de la couche","error"),null;if(null==this.sLayerToAdd_title||""===this.sLayerToAdd_title)return $.notify("Informations insuffisantes: Titre de la couche","error"),null;if(null==this.sLayerToAdd_style_name||"?"===this.sLayerToAdd_style_name)return $.notify("Informations insuffisantes: Style",
"error"),null;if(null==this.sLayerToAdd_matrix_name||"?"===this.sLayerToAdd_matrix_name)return $.notify("Informations insuffisantes: Matrice","error"),null;if(null==this.sLayerToAdd_format_name||"?"===this.sLayerToAdd_format_name)return $.notify("Informations insuffisantes Format","error"),null;var a=!1;null!=this.oCapabilities&&null!=this.oCapabilities.Contents&&null!=this.oCapabilities.Contents.Layer&&(a=!0);if(!a)return $.notify("Contenu du service incoh\u00e9rent","error"),null;$("#wmts-select-matrix-modal").modal("hide");
a={ze:"wmts"};a.$d=this.sLayerToAdd_name;a.ae=this.sLayerToAdd_title;a.style=this.sLayerToAdd_style_name;a.Zq=this.sLayerToAdd_matrix_name;a.format=this.sLayerToAdd_format_name;a.Zn=this.sRequestType;a.version=this.sRequestVersion;a.url=this.sRequestUrl;a.Nl=JSON.stringify(this.oCapabilities);null!=this.b.iServiceIndex&&null!=this.catalog&&null!=this.catalog.services&&null!=this.catalog.services.wmts&&null!=this.catalog.services.wmts[this.b.iServiceIndex]&&null!=this.catalog.services.wmts[this.b.iServiceIndex].name&&
(a.$c=this.catalog.services.wmts[this.b.iServiceIndex].name);null==a.$c&&null!=this.oCapabilities.ServiceProvider&&null!=this.oCapabilities.ServiceProvider.ProviderName&&(a.$c=this.oCapabilities.ServiceProvider.ProviderName);null==a.$c&&null!=this.oCapabilities.ServiceIdentification&&null!=this.oCapabilities.ServiceIdentification.Title&&(a.$c=this.oCapabilities.ServiceIdentification.Title);null==a.$c&&(a.$c="Service WMTS");B.oa.Pb(a)};Au.prototype.Rd.prototype.addLayerToAdd=Au.prototype.Rd.prototype.Px;
B.module.directive("appWmtssuggestions",Au.prototype.GE);B.module.controller("AppWmtssuggestionsController",Au.prototype.Rd);function Bu(){B.log("nsVmap.nsMapManager.nsMapModal.XYZSuggestions")}qa("nsVmap.nsMapManager.nsMapModal.XYZSuggestions",Bu);Bu.prototype.NE=function(){B.log("nsVmap.xyzsuggestionsDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppXyzsuggestionsController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/layers/mapmodal/xyzsuggestions.html"}};Bu.prototype.xyzsuggestionsDirective=Bu.prototype.NE;
Bu.prototype.Mi=function(){B.log("nsVmap.nsMapManager.nsMapModal.XYZSuggestions.xyzsuggestionsController");this.properties=B.properties;this.catalog=B.oa.Ef.Zb;this.projection=E(B.g().B).J().Z;this.oLayerToAdd={sService:"",sLayer:"",sUrl:""}};Bu.prototype.xyzsuggestionsController=Bu.prototype.Mi;
Bu.prototype.Mi.prototype.Pb=function(a){B.log("nsVmap.nsMapManager.nsMapModal.XYZSuggestions.prototype.xyzsuggestionsController.prototype.addLayer");var b,c;null!=a?(c=b=a.name,a=a.url):(b=this.oLayerToAdd.sService,c=this.oLayerToAdd.sLayer,a=this.oLayerToAdd.sUrl);if(null==b)return $.notify("Informations insuffisantes: Service","error"),null;if(null==c)return $.notify("Informations insuffisantes: sLayer","error"),null;if(null==a)return $.notify("Informations insuffisantes: sUrl","error"),null;B.oa.Pb({url:a,
ze:"xyz",$c:b,ae:c})};Bu.prototype.Mi.prototype.addLayer=Bu.prototype.Mi.prototype.Pb;Bu.prototype.Mi.prototype.reload=function(){this.catalog=B.oa.Ef.Zb;this.projection=E(B.g().B).J().Z};Bu.prototype.Mi.prototype.reload=Bu.prototype.Mi.prototype.reload;B.module.directive("appXyzsuggestions",Bu.prototype.NE);B.module.controller("AppXyzsuggestionsController",Bu.prototype.Mi);function Cu(){B.log("nsVmap.nsMapManager.nsMapModal.LoadGeometry")}qa("nsVmap.nsMapManager.nsMapModal.LoadGeometry",Cu);Cu.prototype.kB=function(){B.log("nsVmap.loadgeometryDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppLoadgeometryController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/layers/mapmodal/loadgeometry.html"}};Cu.prototype.loadgeometryDirective=Cu.prototype.kB;
Cu.prototype.jl=function(a){B.log("nsVmap.loadgeometryController");var b=this;this.Eg=a;a.oSelectedFile={};a.sFileName="";a.sServiceName="";a.sLayerTitle="";a.bIsUrl=!1;var c=document.getElementById("upload-geometry-file-drop-zone");document.getElementById("browse-geometry-button").addEventListener("change",function(){var c=this;b.TC=c.id;a.$applyAsync(function(){a.oSelectedFile=c.files[0];a.bIsUrl=!1;a.sFileName=null!=a.oSelectedFile?angular.copy(a.oSelectedFile.name):""})},!1);c.addEventListener("dragover",
function(a){this.className="upload-drop-zone drop";a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy";return!1},!1);c.addEventListener("dragleave",function(){this.className="upload-drop-zone";return!1},!1);c.addEventListener("drop",function(c){c.stopPropagation();c.preventDefault();var d=c.dataTransfer.files;this.files=d;b.TC=this.id;a.$applyAsync(function(){a.oSelectedFile=d[0];a.bIsUrl=!1;a.sFileName=null!=a.oSelectedFile?angular.copy(a.oSelectedFile.name):""});this.className=
"upload-drop-zone";return!1},!1)};Cu.prototype.loadgeometryController=Cu.prototype.jl;Cu.prototype.jl.$inject=["$scope"];
Cu.prototype.jl.prototype.Pb=function(){B.log("nsVmap.nsMapManager.nsMapModal.LoadGeometry.prototype.loadgeometryController.prototype.addLayer");var a=this.TC,b=this.Eg.sFileName,c=this.Eg.sServiceName,d=this.Eg.sLayerTitle,c=""!==c?c:"Local",d=""!==d?d:"Local";""===c||""===d?$.notify("Veuillez renseigner les noms du service et de la couche","error"):this.Eg.bIsUrl&&""!==b?"http"!==b.substr(0,4)?$.notify("URL incorrecte"):(ed(),$.get(b).done(function(a){fd();B.oa.lt(a,c,d)&&B.Vl("close-modal-button")}).error(function(){fd();
$.notify("impossible de charger le contenu de l'URL")})):r(a)&&""!==a?(a=document.getElementById(a).files,a.length?(a=a[0],b=new FileReader,d="Local"!==d?d:a.name,b.onloadend=function(a){a.target.readyState===FileReader.DONE&&B.oa.lt(a.target.result,c,d)&&B.Vl("close-modal-button")},b.readAsText(a)):$.notify("Veuillez s\u00e9lectionner un fichier ou une url","error")):$.notify("Veuillez s\u00e9lectionner un fichier ou une URL","error")};Cu.prototype.jl.prototype.addLayer=Cu.prototype.jl.prototype.Pb;
B.module.directive("appLoadgeometry",Cu.prototype.kB);B.module.controller("AppLoadgeometryController",Cu.prototype.jl);function Du(){B.log("nsVmap.nsMapManager.nsMapModal.OSMSuggestions")}qa("nsVmap.nsMapManager.nsMapModal.OSMSuggestions",Du);Du.prototype.iC=function(){B.log("nsVmap.osmsuggestionsDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppOsmsuggestionsController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/layers/mapmodal/osmsuggestions.html"}};Du.prototype.osmsuggestionsDirective=Du.prototype.iC;
Du.prototype.ni=function(){B.log("nsVmap.nsMapManager.nsMapModal.OSMSuggestions.osmsuggestionsController");this.catalog=B.oa.Ef.Zb;this.pa=this.projection=E(B.g().B).J().Z;this.properties=B.properties;this.sLayerUrl=this.sLayerName=""};Du.prototype.osmsuggestionsController=Du.prototype.ni;
Du.prototype.ni.prototype.Pb=function(a){B.log("nsVmap.nsMapManager.nsMapModal.OSMSuggestions.prototype.osmsuggestionsController.prototype.addLayer");var b;null!=a?(b=a.name,a=a.url):(b=this.sLayerName,a=this.sLayerUrl);if(r(b)&&""!==b){var c={};c.url=a;c.ze="osm";c.$c="Open Street Map";c.ae=b;B.oa.Pb(c)}else $.notify("Informations manquantes: Nom","error")};Du.prototype.ni.prototype.addLayer=Du.prototype.ni.prototype.Pb;
Du.prototype.ni.prototype.reload=function(){this.catalog=B.oa.Ef.Zb;this.pa=this.projection=E(B.g().B).J().Z};Du.prototype.ni.prototype.reload=Du.prototype.ni.prototype.reload;B.module.directive("appOsmsuggestions",Du.prototype.iC);B.module.controller("AppOsmsuggestionsController",Du.prototype.ni);function Eu(){B.log("nsVmap.nsMapManager.nsMapModal.BingSuggestions")}qa("nsVmap.nsMapManager.nsMapModal.BingSuggestions",Eu);Eu.prototype.QF=function(){B.log("nsVmap.bingsuggestionsDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppBingsuggestionsController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/layers/mapmodal/bingsuggestions.html"}};
Eu.prototype.Gh=function(){B.log("nsVmap.bingsuggestionsController");this.catalog=B.oa.Ef.Zb;this.pa=this.projection=E(B.g().B).J().Z;this.properties=B.properties};Eu.prototype.bingsuggestionsController=Eu.prototype.Gh;
Eu.prototype.Gh.prototype.Pb=function(a){B.log("nsVmap.nsMapManager.nsMapModal.BingSuggestions.prototype.bingsuggestionsController.prototype.addLayer");var b,c;null!=a?(b=a.key,c=a.imagerySet,a=a.culture):(b=this.sKey,c=this.sImagerySet,a=this.sCulture);if(null==b||""===b)return $.notify("Veuillez renseigner la cl\u00e9 Bing Maps","error"),0;if(null==c||""===c)return $.notify("Veuillez renseigner une couche \u00e0 utiliser","error"),0;if(null==a||""===a)return $.notify("Veuillez renseigner une langue \u00e0 utiliser",
"error"),0;var d={ze:"bing",$c:"Bing Maps"};d.key=b;d.$d=c;d.dj=a;B.oa.Pb(d)};Eu.prototype.Gh.prototype.addLayer=Eu.prototype.Gh.prototype.Pb;Eu.prototype.Gh.prototype.reload=function(){this.catalog=B.oa.Ef.Zb;this.pa=this.projection=E(B.g().B).J().Z};Eu.prototype.Gh.prototype.reload=Eu.prototype.Gh.prototype.reload;B.module.directive("appBingsuggestions",Eu.prototype.QF);B.module.controller("AppBingsuggestionsController",Eu.prototype.Gh);function Fu(a){B.log("nsVmap.nsMapManager.nsMapModal.MapModalManager");this.Zb=a;new Zt;this.uL=new Yt;new bu;new zu;new Au;new Cu;new Du;new Bu;new Eu}qa("nsVmap.nsMapManager.nsMapModal.MapModalManager",Fu);Fu.prototype.BK=function(){B.log("nsVmap.mapmodalDirective");return{restrict:"E",scope:{map:"=appMap",proj:"=appProj",lang:"=appLang"},controller:"AppMapmodalController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/layers/mapmodal/mapmodal.html"}};
Fu.prototype.AK=function(){B.log("nsVmap.mapmodalController")};Fu.prototype.dI=function(){return this.uL};Fu.prototype.getMapListTool=Fu.prototype.dI;Fu.prototype.kA=function(){return this.Zb};B.module.directive("appMapmodal",Fu.prototype.BK);B.module.controller("AppMapmodalController",Fu.prototype.AK);function Gu(){this.ux=new XMLSerializer;Ir.call(this)}F(Gu,Ir);l=Gu.prototype;l.F=function(){return"xml"};l.si=function(a,b){return a instanceof Document?Hu(this,a,b):a instanceof Node?this.yr(a,b):"string"===typeof a?(a=bq(a),Hu(this,a,b)):[]};function Hu(a,b,c){var d=[];for(b=b.firstChild;b;b=b.nextSibling)b.nodeType==Node.ELEMENT_NODE&&bf(d,a.yr(b,c));return d}l.On=function(a){if(a instanceof Document||a instanceof Node)return null;"string"===typeof a&&bq(a);return null};
l.Br=function(a){return a instanceof Document||a instanceof Node?this.Pc:"string"===typeof a?(bq(a),this.Pc):null};l.px=function(){return this.ux.serializeToString(null)};l.mm=function(a,b){a=this.sx(a,b);return this.ux.serializeToString(a)};l.sx=function(){return null};l.tx=function(){return this.ux.serializeToString(null)};function Iu(a){a=a?a:{};Gu.call(this);this.Pc=ih("EPSG:4326");this.xC=a.xQ}F(Iu,Gu);var Ju=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"];function Ku(a,b,c,d){a.push(parseFloat(c.getAttribute("lon")),parseFloat(c.getAttribute("lat")));"ele"in d?(a.push(d.ele),delete d.ele,b.Tu=!0):a.push(0);"time"in d?(a.push(d.time),delete d.time,b.Su=!0):a.push(0);return a}
function Lu(a,b,c){var d="XY",e=2;a.Tu&&a.Su?(d="XYZM",e=4):a.Tu?(d="XYZ",e=3):a.Su&&(d="XYM",e=3);if(4!==e){var f,g;f=0;for(g=b.length/4;f<g;f++)b[f*e]=b[4*f],b[f*e+1]=b[4*f+1],a.Tu&&(b[f*e+2]=b[4*f+2]),a.Su&&(b[f*e+2]=b[4*f+3]);b.length=b.length/4*e;if(c)for(f=0,g=c.length;f<g;f++)c[f]=c[f]/4*e}return d}function Mu(a,b){var c=b[b.length-1],d=a.getAttribute("href");null!==d&&(c.link=d);lq(Nu,a,b)}function Ou(a,b){b[b.length-1].extensionsNode_=a}
var Su=P(Ju,{rte:dq(function(a,b){var c=b[0];if(a=mq({flatCoordinates:[],layoutOptions:{}},Pu,a,b)){b=a.flatCoordinates;delete a.flatCoordinates;var d=a.layoutOptions;delete a.layoutOptions;var d=Lu(d,b),e=new mr(null);e.ya(d,b);Lr(e,!1,c);c=new vd(e);ce(c,a);return c}}),trk:dq(function(a,b){var c=b[0];if(a=mq({flatCoordinates:[],ends:[],layoutOptions:{}},Qu,a,b)){b=a.flatCoordinates;delete a.flatCoordinates;var d=a.ends;delete a.ends;var e=a.layoutOptions;delete a.layoutOptions;var e=Lu(e,b,d),f=
new nd(null);f.ya(e,b,d);Lr(f,!1,c);c=new vd(f);ce(c,a);return c}}),wpt:dq(function(a,b){var c=b[0];if(b=mq({},Ru,a,b)){var d={};a=Ku([],d,a,b);d=Lu(d,a);a=new ii(a,d);Lr(a,!1,c);c=new vd(a);ce(c,b);return c}})}),Nu=P(Ju,{text:M(Q,"linkText"),type:M(Q,"linkType")}),Pu=P(Ju,{name:M(Q),cmt:M(Q),desc:M(Q),src:M(Q),link:Mu,number:M(fs),extensions:Ou,type:M(Q),rtept:function(a,b){var c=mq({},Tu,a,b);c&&(b=b[b.length-1],Ku(b.flatCoordinates,b.layoutOptions,a,c))}}),Tu=P(Ju,{ele:M(ds),time:M(cs)}),Qu=P(Ju,
{name:M(Q),cmt:M(Q),desc:M(Q),src:M(Q),link:Mu,number:M(fs),type:M(Q),extensions:Ou,trkseg:function(a,b){var c=b[b.length-1];lq(Uu,a,b);c.ends.push(c.flatCoordinates.length)}}),Uu=P(Ju,{trkpt:function(a,b){var c=mq({},Vu,a,b);c&&(b=b[b.length-1],Ku(b.flatCoordinates,b.layoutOptions,a,c))}}),Vu=P(Ju,{ele:M(ds),time:M(cs)}),Ru=P(Ju,{ele:M(ds),time:M(cs),magvar:M(ds),geoidheight:M(ds),name:M(Q),cmt:M(Q),desc:M(Q),src:M(Q),link:Mu,sym:M(Q),type:M(Q),fix:M(Q),sat:M(fs),hdop:M(ds),vdop:M(ds),pdop:M(ds),
ageofdgpsdata:M(ds),dgpsid:M(fs),extensions:Ou});Iu.prototype.yr=function(a,b){if(!(0<=Ju.indexOf(a.namespaceURI)))return[];if("gpx"==a.localName&&(a=mq([],Su,a,[Jr(this,a,b)]))){(b=a)||(b=[]);for(var c=0,d=b.length;c<d;++c){var e=b[c];if(this.xC){var f=e.get("extensionsNode_")||null;this.xC(e,f)}e.set("extensionsNode_",void 0)}return a}return[]};function Wu(a,b,c){a.setAttribute("href",b);b=c[c.length-1].properties;nq({node:a},Xu,jq,[b.linkText,b.linkType],c,Yu)}
function Zu(a,b,c){var d=c[c.length-1],e=d.node.namespaceURI,f=d.properties;a.setAttributeNS(null,"lat",b[1]);a.setAttributeNS(null,"lon",b[0]);switch(d.geometryLayout){case "XYZM":0!==b[3]&&(f.time=b[3]);case "XYZ":0!==b[2]&&(f.ele=b[2]);break;case "XYM":0!==b[2]&&(f.time=b[2])}b="rtept"==a.nodeName?$u[e]:av[e];d=kq(f,b);nq({node:a,properties:f},bv,jq,d,c,b)}
var Yu=["text","type"],Xu=P(Ju,{text:O(is),type:O(is)}),cv=P(Ju,"name cmt desc src link number type rtept".split(" ")),dv=P(Ju,{name:O(is),cmt:O(is),desc:O(is),src:O(is),link:O(Wu),number:O(ks),type:O(is),rtept:gq(O(Zu))}),$u=P(Ju,["ele","time"]),ev=P(Ju,"name cmt desc src link number type trkseg".split(" ")),hv=P(Ju,{name:O(is),cmt:O(is),desc:O(is),src:O(is),link:O(Wu),number:O(ks),type:O(is),trkseg:gq(O(function(a,b,c){nq({node:a,geometryLayout:b.gb,properties:{}},fv,gv,b.T(),c)}))}),gv=hq("trkpt"),
fv=P(Ju,{trkpt:O(Zu)}),av=P(Ju,"ele time magvar geoidheight name cmt desc src link sym type fix sat hdop vdop pdop ageofdgpsdata dgpsid".split(" ")),bv=P(Ju,{ele:O(js),time:O(function(a,b){b=new Date(1E3*b);a.appendChild(Zp.createTextNode(b.getUTCFullYear()+"-"+Tf(b.getUTCMonth()+1)+"-"+Tf(b.getUTCDate())+"T"+Tf(b.getUTCHours())+":"+Tf(b.getUTCMinutes())+":"+Tf(b.getUTCSeconds())+"Z"))}),magvar:O(js),geoidheight:O(js),name:O(is),cmt:O(is),desc:O(is),src:O(is),link:O(Wu),sym:O(is),type:O(is),fix:O(is),
sat:O(ks),hdop:O(js),vdop:O(js),pdop:O(js),ageofdgpsdata:O(js),dgpsid:O(ks)}),iv={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function jv(a,b){if(a=a.j())if(a=iv[a.F()])return Zp.createElementNS(b[b.length-1].node.namespaceURI,a)}
var kv=P(Ju,{rte:O(function(a,b,c){var d=c[0],e=fe(b);a={node:a,properties:e};if(b=b.j())b=Lr(b,!0,d),a.geometryLayout=b.gb,e.rtept=b.T();d=cv[c[c.length-1].node.namespaceURI];e=kq(e,d);nq(a,dv,jq,e,c,d)}),trk:O(function(a,b,c){var d=c[0],e=fe(b);a={node:a,properties:e};if(b=b.j())b=Lr(b,!0,d),e.trkseg=pd(b);d=ev[c[c.length-1].node.namespaceURI];e=kq(e,d);nq(a,hv,jq,e,c,d)}),wpt:O(function(a,b,c){var d=c[0],e=c[c.length-1];e.properties=fe(b);if(b=b.j())b=Lr(b,!0,d),e.geometryLayout=b.gb,Zu(a,b.T(),
c)})});Iu.prototype.sx=function(a,b){b=Kr(this,b);var c=Zp.createElementNS("http://www.topografix.com/GPX/1/1","gpx");c.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance");c.setAttributeNS("http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation","http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd");c.setAttribute("version","1.1");c.setAttribute("creator","OpenLayers");nq({node:c},kv,jv,a,[b]);return c};function lv(){Ir.call(this)}F(lv,Ir);l=lv.prototype;l.F=function(){return"text"};l.si=function(a,b){return this.AC("string"===typeof a?a:"",Kr(this,b))};l.On=function(a,b){return this.Ar("string"===typeof a?a:"",Kr(this,b))};l.Br=function(){return this.Pc};l.px=function(a,b){return this.rx(a,Kr(this,b))};l.mm=function(a,b){return this.LE(a,Kr(this,b))};l.tx=function(a,b){return this.Ns(a,Kr(this,b))};function mv(a){a=a?a:{};Ir.call(this);this.Pc=ih("EPSG:4326");this.oF=a.nF?a.nF:"none"}F(mv,lv);var nv=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,ov=/^H.([A-Z]{3}).*?:(.*)/,pv=/^HFDTE(\d{2})(\d{2})(\d{2})/,qv=/\r\n|\r|\n/;l=mv.prototype;
l.yC=function(a,b){var c=this.oF,d=a.split(qv);a={};var e=[],f=2E3,g=0,h=1,k=-1,m,p;m=0;for(p=d.length;m<p;++m){var t=d[m],u;if("B"==t.charAt(0)){if(u=nv.exec(t)){var t=parseInt(u[1],10),w=parseInt(u[2],10),x=parseInt(u[3],10),z=parseInt(u[4],10)+parseInt(u[5],10)/6E4;"S"==u[6]&&(z=-z);var D=parseInt(u[7],10)+parseInt(u[8],10)/6E4;"W"==u[9]&&(D=-D);e.push(D,z);"none"!=c&&e.push("gps"==c?parseInt(u[11],10):"barometric"==c?parseInt(u[12],10):0);u=Date.UTC(f,g,h,t,w,x);u<k&&(u=Date.UTC(f,g,h+1,t,w,x));
e.push(u/1E3);k=u}}else"H"==t.charAt(0)&&((u=pv.exec(t))?(h=parseInt(u[1],10),g=parseInt(u[2],10)-1,f=2E3+parseInt(u[3],10)):(u=ov.exec(t))&&(a[u[1]]=u[2].trim()))}if(0===e.length)return null;d=new mr(null);d.ya("none"==c?"XYM":"XYZM",e);b=new vd(Lr(d,!1,b));ce(b,a);return b};l.AC=function(a,b){return(a=this.yC(a,b))?[a]:[]};l.rx=function(){};l.LE=function(){};l.Ns=function(){};l.Ar=function(){};function rv(a,b,c,d,e,f){Yd.call(this);this.Zg=null;this.la=a?a:new Image;null!==d&&(this.la.crossOrigin=d);this.qa=f?document.createElement("CANVAS"):null;this.sa=f;this.Af=null;this.el=e;this.Nd=c;this.ff=b;this.Gw=!1;2==this.el&&sv(this)}F(rv,Yd);function sv(a){var b=Li(1,1);try{b.drawImage(a.la,0,0),b.getImageData(0,0,1,1)}catch(c){a.Gw=!0}}l=rv.prototype;l.Yk=function(){this.el=3;this.Ah();this.dispatchEvent("change")};
l.ln=function(){this.el=2;this.Nd&&(this.la.width=this.Nd[0],this.la.height=this.Nd[1]);this.Nd=[this.la.width,this.la.height];this.Ah();sv(this);if(!this.Gw&&null!==this.sa){this.qa.width=this.la.width;this.qa.height=this.la.height;var a=this.qa.getContext("2d");a.drawImage(this.la,0,0);for(var b=a.getImageData(0,0,this.la.width,this.la.height),c=b.data,d=this.sa[0]/255,e=this.sa[1]/255,f=this.sa[2]/255,g=0,h=c.length;g<h;g+=4)c[g]*=d,c[g+1]*=e,c[g+2]*=f;a.putImageData(b,0,0)}this.dispatchEvent("change")};
l.na=function(){return this.qa?this.qa:this.la};l.Sk=function(){return this.el};l.Ym=function(){if(!this.Zg)if(this.Gw){var a=this.Nd[0],b=this.Nd[1],c=Li(a,b);c.fillRect(0,0,a,b);this.Zg=c.canvas}else this.Zg=this.la;return this.Zg};l.$a=function(){return this.Nd};l.rj=function(){return this.ff};l.load=function(){if(0==this.el){this.el=1;this.Af=[Qd(this.la,"error",this.Yk,this),Qd(this.la,"load",this.ln,this)];try{this.la.src=this.ff}catch(a){this.Yk()}}};
l.Ah=function(){this.Af.forEach(Ld);this.Af=null};function Lt(a){a=a||{};this.Uc=void 0!==a.anchor?a.anchor:[.5,.5];this.jr=null;this.sk=void 0!==a.Vo?a.Vo:"top-left";this.ot=void 0!==a.Xo?a.Xo:"fraction";this.pt=void 0!==a.Zo?a.Zo:"fraction";this.cj=void 0!==a.crossOrigin?a.crossOrigin:null;var b=void 0!==a.HA?a.HA:null,c=void 0!==a.IA?a.IA:null,d=a.src;yf(!(void 0!==d&&b),4);yf(!b||b&&c,5);void 0!==d&&0!==d.length||!b||(d=b.src||I(b).toString());yf(void 0!==d&&0<d.length,6);var e=void 0!==a.src?0:2;this.sa=void 0!==a.color?Xk(a.color):null;var f=
this.cj,g=this.sa,h=tl.get(d,f,g);h||(h=new rv(b,d,c,f,e,g),tl.set(d,f,g,h));this.dg=h;this.En=void 0!==a.offset?a.offset:[0,0];this.rl=void 0!==a.Jv?a.Jv:"top-left";this.ie=null;this.Nd=void 0!==a.size?a.size:null;Pp.call(this,{opacity:void 0!==a.opacity?a.opacity:1,rotation:void 0!==a.rotation?a.rotation:0,scale:void 0!==a.scale?a.scale:1,Jf:void 0!==a.Jf?a.Jf:!0,Zc:void 0!==a.Zc?a.Zc:!1})}F(Lt,Pp);l=Lt.prototype;
l.clone=function(){return new Lt({anchor:this.Uc.slice(),Vo:this.sk,Xo:this.ot,Zo:this.pt,crossOrigin:this.cj,color:this.sa&&this.sa.slice?this.sa.slice():this.sa||void 0,src:this.rj(),offset:this.En.slice(),Jv:this.rl,size:null!==this.Nd?this.Nd.slice():void 0,opacity:this.Vg(),scale:this.Za(),Jf:this.Kf,rotation:this.Cb(),Zc:this.Ld})};
l.Um=function(){if(this.jr)return this.jr;var a=this.Uc,b=this.$a();if("fraction"==this.ot||"fraction"==this.pt){if(!b)return null;a=this.Uc.slice();"fraction"==this.ot&&(a[0]*=b[0]);"fraction"==this.pt&&(a[1]*=b[1])}if("top-left"!=this.sk){if(!b)return null;a===this.Uc&&(a=this.Uc.slice());if("top-right"==this.sk||"bottom-right"==this.sk)a[0]=-a[0]+b[0];if("bottom-left"==this.sk||"bottom-right"==this.sk)a[1]=-a[1]+b[1]}return this.jr=a};l.na=function(a){return this.dg.na(a)};l.$p=function(){return this.dg.$a()};
l.Sk=function(){return this.dg.Sk()};l.Ym=function(a){return this.dg.Ym(a)};l.ag=function(){if(this.ie)return this.ie;var a=this.En;if("top-left"!=this.rl){var b=this.$a(),c=this.dg.$a();if(!b||!c)return null;a=a.slice();if("top-right"==this.rl||"bottom-right"==this.rl)a[0]=c[0]-b[0]-a[0];if("bottom-left"==this.rl||"bottom-right"==this.rl)a[1]=c[1]-b[1]-a[1]}return this.ie=a};l.rj=function(){return this.dg.rj()};l.$a=function(){return this.Nd?this.Nd:this.dg.$a()};
l.eB=function(a,b){return J(this.dg,"change",a,b)};l.load=function(){this.dg.load()};l.eE=function(a,b){Td(this.dg,"change",a,b)};function Fq(a){a=a||{};this.Ph=a.font;this.Md=a.rotation;this.Ld=a.Zc;this.bf=a.scale;this.xa=a.text;this.Ei=a.textAlign;this.Yj=a.textBaseline;this.ua=void 0!==a.fill?a.fill:new Sp({color:"#333"});this.AB=void 0!==a.nl?a.nl:Math.PI/4;this.oC=void 0!==a.placement?a.placement:"point";var b=void 0===a.overflow?a.XP:a.overflow;this.kC=void 0!==b?b:!1;this.ha=void 0!==a.stroke?a.stroke:null;this.mg=void 0!==a.offsetX?a.offsetX:0;this.ng=void 0!==a.offsetY?a.offsetY:0;this.NF=a.wk?a.wk:null;this.OF=a.xk?
a.xk:null;this.ML=void 0===a.padding?null:a.padding}l=Fq.prototype;l.clone=function(){return new Fq({font:this.Ph,placement:this.oC,nl:this.AB,overflow:this.kC,rotation:this.Cb(),Zc:this.Ld,scale:this.Za(),text:this.xa,textAlign:this.Ei,textBaseline:this.Yj,fill:this.ua?this.ua.clone():void 0,stroke:this.ha?this.ha.clone():void 0,offsetX:this.mg,offsetY:this.ng})};l.Wp=function(){return this.ua};l.Cb=function(){return this.Md};l.Za=function(){return this.bf};l.iq=function(){return this.ha};
l.iD=function(a){this.ua=a};l.Rl=function(a){this.Md=a};l.Ee=function(a){this.bf=a};l.pD=function(a){this.ha=a};l.fo=function(a){this.xa=a};function tv(a){a=a?a:{};Gu.call(this);uv||(vv=[255,255,255,1],wv=new Sp({color:vv}),xv=[20,2],yv=zv="pixels",Av=[64,64],Bv="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",Cv=.5,Dv=new Lt({anchor:xv,Vo:"bottom-left",Xo:zv,Zo:yv,crossOrigin:"anonymous",rotation:0,scale:Cv,size:Av,src:Bv}),Ev="NO_IMAGE",Fv=new Tn({color:vv,width:1}),Gv=new Tn({color:[51,51,51,1],width:2}),Hv=new Fq({font:"bold 16px Helvetica",fill:wv,stroke:Gv,scale:.8}),Iv=new Tp({fill:wv,kb:Dv,text:Hv,stroke:Fv,zIndex:0}),
uv=[Iv]);this.Pc=ih("EPSG:4326");this.BG=a.AG?a.AG:uv;this.nH=void 0!==a.mH?a.mH:!0;this.jP=void 0!==a.iP?a.iP:!0;this.ww={};this.HN=void 0!==a.GN?a.GN:!0}var uv,vv,wv,xv,zv,yv,Av,Bv,Cv,Dv,Ev,Fv,Gv,Hv,Iv;F(tv,Gu);var Jv=["http://www.google.com/kml/ext/2.2"],Kv=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],Lv={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"};
function Mv(a,b){var c=[0,0],d="start";if(a.na()){var e=a.na().$p();null===e&&(e=Av);2==e.length&&(d=a.na().Za(),c[0]=d*e[0]/2,c[1]=-d*e[1]/2,d="left")}null!==a.xa?(e=a.xa,a=e.clone(),a.Ph=e.Ph||Hv.Ph,a.Ee(e.Za()||Hv.Za()),a.iD(e.ua||Hv.ua),a.pD(e.ha||Gv)):a=Hv.clone();a.fo(b);a.mg=c[0];a.ng=c[1];a.Ei=d;return new Tp({text:a})}
function Nv(a,b,c,d,e){return function(){var f=e,g="";f&&this.j()&&(f="Point"===this.j().F());f&&(g=this.get("name"),f=f&&g);if(a)return f?(f=Mv(a[0],g),a.concat(f)):a;if(b){var h=Ov(b,c,d);return f?(f=Mv(h[0],g),h.concat(f)):h}return f?(f=Mv(c[0],g),c.concat(f)):c}}function Ov(a,b,c){return Array.isArray(a)?a:"string"===typeof a?(!(a in c)&&"#"+a in c&&(a="#"+a),Ov(c[a],b,c)):b}
function Pv(a){a=$p(a);if(a=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(a))return a=a[1],[parseInt(a.substr(6,2),16),parseInt(a.substr(4,2),16),parseInt(a.substr(2,2),16),parseInt(a.substr(0,2),16)/255]}function Qv(a){a=$p(a);for(var b=[],c=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?))?\s*/i,d;d=c.exec(a);)b.push(parseFloat(d[1]),parseFloat(d[2]),d[3]?parseFloat(d[3]):0),a=a.substr(d[0].length);if(""===a)return b}
function Rv(a){var b=$p(a).trim();a=a.baseURI;a&&"about:blank"!=a||(a=window.location.href);return a?(new URL(b,a)).href:b}function Sv(a){return ds(a)}function Tv(a,b){return mq(null,Uv,a,b)}function Vv(a,b){if(b=mq({l:[],CE:[]},Wv,a,b)){a=b.l;b=b.CE;var c,d;c=0;for(d=Math.min(a.length,b.length);c<d;++c)a[4*c+3]=b[c];b=new mr(null);b.ya("XYZM",a);return b}}function Xv(a,b){var c=mq({},Yv,a,b);if(a=mq(null,Zv,a,b))return b=new mr(null),b.ya("XYZ",a),ce(b,c),b}
function $v(a,b){var c=mq({},Yv,a,b);if(a=mq(null,Zv,a,b))return b=new qi(null),b.ya("XYZ",a,[a.length]),ce(b,c),b}
function aw(a,b){a=mq([],bw,a,b);if(!a)return null;if(0===a.length)return new Or(a);var c,d=!0,e=a[0].F(),f,g;f=1;for(g=a.length;f<g;++f)if(b=a[f],b.F()!=e){d=!1;break}if(d)if("Point"==e){c=a[0];d=c.gb;e=c.l;f=1;for(g=a.length;f<g;++f)b=a[f],bf(e,b.l);c=new md(null);c.ya(d,e);cw(c,a)}else if("LineString"==e)c=new nd(null),Sr(c,a),cw(c,a);else if("Polygon"==e){b=c=new od(null);f=b.gb;g=[];var d=[],h,k,e=0;for(h=a.length;e<h;++e){var m=a[e];0===e&&(f=m.gb);var p=g.length;k=m.Qa;var t,u;t=0;for(u=k.length;t<
u;++t)k[t]+=p;bf(g,m.l);d.push(k)}b.ya(f,g,d);cw(c,a)}else"GeometryCollection"==e?c=new Or(a):yf(!1,37);else c=new Or(a);return c}function dw(a,b){var c=mq({},Yv,a,b);if(a=mq(null,Zv,a,b))return b=new ii(null),b.ya("XYZ",a),ce(b,c),b}function ew(a,b){var c=mq({},Yv,a,b);if((a=mq([null],fw,a,b))&&a[0]){b=new qi(null);var d=a[0],e=[d.length],f,g;f=1;for(g=a.length;f<g;++f)bf(d,a[f]),e.push(d.length);b.ya("XYZ",d,e);ce(b,c);return b}}
function gw(a,b){b=mq({},hw,a,b);if(!b)return null;a="fillStyle"in b?b.fillStyle:wv;var c=b.fill;void 0===c||c||(a=null);c="imageStyle"in b?b.imageStyle:Dv;c==Ev&&(c=void 0);var d="textStyle"in b?b.textStyle:Hv,e="strokeStyle"in b?b.strokeStyle:Fv;b=b.outline;void 0===b||b||(e=null);return[new Tp({fill:a,kb:c,stroke:e,text:d,zIndex:void 0})]}
function cw(a,b){var c=b.length,d=Array(b.length),e=Array(b.length),f=Array(b.length),g,h,k,m,p;k=m=p=!1;for(h=0;h<c;++h)g=b[h],d[h]=g.get("extrude"),e[h]=g.get("tessellate"),f[h]=g.get("altitudeMode"),k=k||void 0!==d[h],m=m||void 0!==e[h],p=p||f[h];k&&a.set("extrude",d);m&&a.set("tessellate",e);p&&a.set("altitudeMode",f)}function iw(a,b){lq(jw,a,b)}function kw(a,b){lq(lw,a,b)}
var mw=P(Kv,{displayName:M(Q),value:M(Q)}),jw=P(Kv,{Data:function(a,b){var c=a.getAttribute("name");lq(mw,a,b);a=b[b.length-1];null!==c?a[c]=a.value:null!==a.displayName&&(a[a.displayName]=a.value);delete a.value},SchemaData:function(a,b){lq(nw,a,b)}}),lw=P(Kv,{LatLonAltBox:function(a,b){if(a=mq({},ow,a,b))b=b[b.length-1],b.extent=[parseFloat(a.west),parseFloat(a.south),parseFloat(a.east),parseFloat(a.north)],b.altitudeMode=a.altitudeMode,b.minAltitude=parseFloat(a.minAltitude),b.maxAltitude=parseFloat(a.maxAltitude)},
Lod:function(a,b){if(a=mq({},pw,a,b))b=b[b.length-1],b.minLodPixels=parseFloat(a.minLodPixels),b.maxLodPixels=parseFloat(a.maxLodPixels),b.minFadeExtent=parseFloat(a.minFadeExtent),b.maxFadeExtent=parseFloat(a.maxFadeExtent)}}),ow=P(Kv,{altitudeMode:M(Q),minAltitude:M(ds),maxAltitude:M(ds),north:M(ds),south:M(ds),east:M(ds),west:M(ds)}),pw=P(Kv,{minLodPixels:M(ds),maxLodPixels:M(ds),minFadeExtent:M(ds),maxFadeExtent:M(ds)}),Yv=P(Kv,{extrude:M(as),tessellate:M(as),altitudeMode:M(Q)}),Uv=P(Kv,{coordinates:eq(Qv)}),
fw=P(Kv,{innerBoundaryIs:function(a,b){(a=mq(void 0,qw,a,b))&&b[b.length-1].push(a)},outerBoundaryIs:function(a,b){(a=mq(void 0,rw,a,b))&&(b[b.length-1][0]=a)}}),Wv=P(Kv,{when:function(a,b){b=b[b.length-1].CE;a=$p(a);a=Date.parse(a);b.push(isNaN(a)?0:a)}},P(Jv,{coord:function(a,b){b=b[b.length-1].l;a=$p(a);(a=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(a))?b.push(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]),
0):b.push(0,0,0,0)}})),Zv=P(Kv,{coordinates:eq(Qv)}),sw=P(Kv,{href:M(Rv)},P(Jv,{x:M(ds),y:M(ds),w:M(ds),h:M(ds)})),tw=P(Kv,{Icon:M(function(a,b){return(a=mq({},sw,a,b))?a:null}),heading:M(ds),hotSpot:M(function(a){var b=a.getAttribute("xunits"),c=a.getAttribute("yunits"),d;d="insetPixels"!==b?"insetPixels"!==c?"bottom-left":"top-left":"insetPixels"!==c?"bottom-right":"top-right";return{x:parseFloat(a.getAttribute("x")),vx:Lv[b],y:parseFloat(a.getAttribute("y")),wx:Lv[c],origin:d}}),scale:M(Sv)}),
qw=P(Kv,{LinearRing:eq(Tv)}),uw=P(Kv,{color:M(Pv),scale:M(Sv)}),vw=P(Kv,{color:M(Pv),width:M(ds)}),bw=P(Kv,{LineString:dq(Xv),LinearRing:dq($v),MultiGeometry:dq(aw),Point:dq(dw),Polygon:dq(ew)}),ww=P(Jv,{Track:dq(Vv)});P(Kv,{ExtendedData:iw,Region:kw,Link:function(a,b){lq(xw,a,b)},address:M(Q),description:M(Q),name:M(Q),open:M(as),phoneNumber:M(Q),visibility:M(as)});
var xw=P(Kv,{href:M(Rv)}),rw=P(Kv,{LinearRing:eq(Tv)}),yw=P(Kv,{Style:M(gw),key:M(Q),styleUrl:M(Rv)}),Aw=P(Kv,{ExtendedData:iw,Region:kw,MultiGeometry:M(aw,"geometry"),LineString:M(Xv,"geometry"),LinearRing:M($v,"geometry"),Point:M(dw,"geometry"),Polygon:M(ew,"geometry"),Style:M(gw),StyleMap:function(a,b){if(a=mq(void 0,zw,a,b))b=b[b.length-1],Array.isArray(a)?b.Style=a:"string"===typeof a?b.styleUrl=a:yf(!1,38)},address:M(Q),description:M(Q),name:M(Q),open:M(as),phoneNumber:M(Q),styleUrl:M(Rv),visibility:M(as)},
P(Jv,{MultiTrack:M(function(a,b){if(a=mq([],ww,a,b))return b=new nd(null),Sr(b,a),b},"geometry"),Track:M(Vv,"geometry")})),Bw=P(Kv,{color:M(Pv),fill:M(as),outline:M(as)}),nw=P(Kv,{SimpleData:function(a,b){var c=a.getAttribute("name");null!==c&&(a=Q(a),b[b.length-1][c]=a)}}),hw=P(Kv,{IconStyle:function(a,b){if(a=mq({},tw,a,b)){b=b[b.length-1];var c="Icon"in a?a.Icon:{},d=!("Icon"in a)||0<Object.keys(c).length,e,f=c.href;f?e=f:d&&(e=Bv);var g,h,k,f="bottom-left",m=a.hotSpot;m?(g=[m.x,m.y],h=m.vx,k=
m.wx,f=m.origin):e===Bv?(g=xv,h=zv,k=yv):/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(e)&&(g=[.5,0],k=h="fraction");var p,m=c.x,t=c.y;void 0!==m&&void 0!==t&&(p=[m,t]);var u,m=c.w,c=c.h;void 0!==m&&void 0!==c&&(u=[m,c]);var w,c=a.heading;void 0!==c&&(w=If(c));a=a.scale;d?(e==Bv&&(u=Av,void 0===a&&(a=Cv)),e=new Lt({anchor:g,Vo:f,Xo:h,Zo:k,crossOrigin:"anonymous",offset:p,Jv:"bottom-left",rotation:w,scale:a,size:u,src:e}),b.imageStyle=e):b.imageStyle=Ev}},LabelStyle:function(a,b){(a=mq({},uw,a,
b))&&(b[b.length-1].textStyle=new Fq({fill:new Sp({color:"color"in a?a.color:vv}),scale:a.scale}))},LineStyle:function(a,b){(a=mq({},vw,a,b))&&(b[b.length-1].strokeStyle=new Tn({color:"color"in a?a.color:vv,width:"width"in a?a.width:1}))},PolyStyle:function(a,b){if(a=mq({},Bw,a,b)){b=b[b.length-1];b.fillStyle=new Sp({color:"color"in a?a.color:vv});var c=a.fill;void 0!==c&&(b.fill=c);a=a.outline;void 0!==a&&(b.outline=a)}}}),zw=P(Kv,{Pair:function(a,b){if(a=mq({},yw,a,b)){var c=a.key;c&&"normal"==
c&&((c=a.styleUrl)&&(b[b.length-1]=c),(a=a.Style)&&(b[b.length-1]=a))}}});l=tv.prototype;l.Xv=function(a,b){var c=P(Kv,{Document:cq(this.Xv,this),Folder:cq(this.Xv,this),Placemark:dq(this.CC,this),Style:this.sM.bind(this),StyleMap:this.rM.bind(this)});if(a=mq([],c,a,b,this))return a};
l.CC=function(a,b){var c=mq({geometry:null},Aw,a,b);if(c){var d=new vd;a=a.getAttribute("id");null!==a&&(d.Bd=a,d.L());b=b[0];(a=c.geometry)&&Lr(a,!1,b);d.jd(a);delete c.geometry;this.nH&&d.le(Nv(c.Style,c.styleUrl,this.BG,this.ww,this.HN));delete c.Style;ce(d,c);return d}};l.sM=function(a,b){var c=a.getAttribute("id");null!==c&&(b=gw(a,b))&&(a=a.baseURI,a&&"about:blank"!=a||(a=window.location.href),c=a?(new URL("#"+c,a)).href:"#"+c,this.ww[c]=b)};
l.rM=function(a,b){var c=a.getAttribute("id");null!==c&&(b=mq(void 0,zw,a,b))&&(a=a.baseURI,a&&"about:blank"!=a||(a=window.location.href),c=a?(new URL("#"+c,a)).href:"#"+c,this.ww[c]=b)};l.yr=function(a,b){if(!(0<=Kv.indexOf(a.namespaceURI)))return[];var c;c=a.localName;if("Document"==c||"Folder"==c)return(c=this.Xv(a,[Jr(this,a,b)]))?c:[];if("Placemark"==c)return(b=this.CC(a,[Jr(this,a,b)]))?[b]:[];if("kml"==c){c=[];for(a=a.firstElementChild;a;a=a.nextElementSibling){var d=this.yr(a,b);d&&bf(c,d)}return c}return[]};
function Qw(a,b){b=Xk(b);b=[255*(4==b.length?b[3]:1),b[2],b[1],b[0]];var c;for(c=0;4>c;++c){var d=parseInt(b[c],10).toString(16);b[c]=1==d.length?"0"+d:d}is(a,b.join(""))}function Rw(a,b,c){a={node:a};var d=b.F(),e,f;"GeometryCollection"==d?(e=Lm(b.Rb),f=Sw):"MultiPoint"==d?(e=b.pj(),f=Tw):"MultiLineString"==d?(e=pd(b),f=Uw):"MultiPolygon"==d?(e=qd(b),f=Vw):yf(!1,39);nq(a,Ww,f,e,c)}function Xw(a,b,c){nq({node:a},Yw,Zw,[b],c)}
function $w(a,b,c){var d={node:a};b.mc()&&a.setAttribute("id",b.mc());a=fe(b);var e={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};e[b.zd]=1;var f=Object.keys(a||{}).sort().filter(function(a){return!e[a]});if(0<f.length){var g=kq(a,f);nq(d,ax,bx,[{names:f,values:g}],c)}if(f=b.wg)if(f=f.call(b,0))f=Array.isArray(f)?f[0]:f,this.jP&&(a.Style=f),(f=f.xa)&&(a.name=f.xa);f=cx[c[c.length-1].node.namespaceURI];a=kq(a,f);nq(d,ax,jq,a,c,f);a=c[0];(b=b.j())&&(b=Lr(b,!0,a));nq(d,
ax,Sw,[b],c)}function dx(a,b,c){var d=b.l;a={node:a};a.layout=b.gb;a.stride=b.S;b=fe(b);b.coordinates=d;d=ex[c[c.length-1].node.namespaceURI];b=kq(b,d);nq(a,fx,jq,b,c,d)}function gx(a,b,c){b=vi(b);var d=b.shift();a={node:a};nq(a,hx,ix,b,c);nq(a,hx,jx,[d],c)}function kx(a,b){js(a,Math.round(1E6*b)/1E6)}
var lx=P(Kv,["Document","Placemark"]),ox=P(Kv,{Document:O(function(a,b,c){nq({node:a},mx,nx,b,c,void 0,this)}),Placemark:O($w)}),mx=P(Kv,{Placemark:O($w)}),px=P(Kv,{Data:O(function(a,b,c){a.setAttribute("name",b.name);a={node:a};b=b.value;"object"==typeof b?(null!==b&&b.displayName&&nq(a,px,jq,[b.displayName],c,["displayName"]),null!==b&&b.value&&nq(a,px,jq,[b.value],c,["value"])):nq(a,px,jq,[b],c,["value"])}),value:O(function(a,b){is(a,b)}),displayName:O(function(a,b){a.appendChild(Zp.createCDATASection(b))})}),
qx={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},rx=P(Kv,["href"],P(Jv,["x","y","w","h"])),sx=P(Kv,{href:O(is)},P(Jv,{x:O(js),y:O(js),w:O(js),h:O(js)})),tx=P(Kv,["scale","heading","Icon","hotSpot"]),vx=P(Kv,{Icon:O(function(a,b,c){a={node:a};var d=rx[c[c.length-1].node.namespaceURI],e=kq(b,d);nq(a,sx,jq,e,c,d);d=rx[Jv[0]];e=kq(b,d);nq(a,sx,
ux,e,c,d)}),heading:O(js),hotSpot:O(function(a,b){a.setAttribute("x",b.x);a.setAttribute("y",b.y);a.setAttribute("xunits",b.vx);a.setAttribute("yunits",b.wx)}),scale:O(kx)}),wx=P(Kv,["color","scale"]),xx=P(Kv,{color:O(Qw),scale:O(kx)}),yx=P(Kv,["color","width"]),zx=P(Kv,{color:O(Qw),width:O(js)}),Yw=P(Kv,{LinearRing:O(dx)}),Ww=P(Kv,{LineString:O(dx),Point:O(dx),Polygon:O(gx),GeometryCollection:O(Rw)}),cx=P(Kv,"name open visibility address phoneNumber description styleUrl Style".split(" ")),ax=P(Kv,
{ExtendedData:O(function(a,b,c){a={node:a};var d=b.names;b=b.values;for(var e=d.length,f=0;f<e;f++)nq(a,px,Ax,[{name:d[f],value:b[f]}],c)}),MultiGeometry:O(Rw),LineString:O(dx),LinearRing:O(dx),Point:O(dx),Polygon:O(gx),Style:O(function(a,b,c){a={node:a};var d={},e=b.ua,f=b.ha,g=b.na();b=b.xa;g instanceof Lt&&(d.IconStyle=g);b&&(d.LabelStyle=b);f&&(d.LineStyle=f);e&&(d.PolyStyle=e);b=Bx[c[c.length-1].node.namespaceURI];d=kq(d,b);nq(a,Cx,jq,d,c,b)}),address:O(is),description:O(is),name:O(is),open:O(hs),
phoneNumber:O(is),styleUrl:O(is),visibility:O(hs)}),ex=P(Kv,["extrude","tessellate","altitudeMode","coordinates"]),fx=P(Kv,{extrude:O(hs),tessellate:O(hs),altitudeMode:O(is),coordinates:O(function(a,b,c){c=c[c.length-1];var d=c.layout;c=c.stride;var e;"XY"==d||"XYM"==d?e=2:"XYZ"==d||"XYZM"==d?e=3:yf(!1,34);var f,g=b.length,h="";if(0<g){h+=b[0];for(d=1;d<e;++d)h+=","+b[d];for(f=c;f<g;f+=c)for(h+=" "+b[f],d=1;d<e;++d)h+=","+b[f+d]}is(a,h)})}),hx=P(Kv,{outerBoundaryIs:O(Xw),innerBoundaryIs:O(Xw)}),Dx=
P(Kv,{color:O(Qw)}),Bx=P(Kv,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),Cx=P(Kv,{IconStyle:O(function(a,b,c){a={node:a};var d={},e=b.rj(),f=b.$a(),g=b.$p(),e={href:e};if(f){e.w=f[0];e.h=f[1];var h=b.Um(),k=b.ag();k&&g&&0!==k[0]&&k[1]!==f[1]&&(e.x=k[0],e.y=g[1]-(k[1]+f[1]));!h||h[0]===f[0]/2&&h[1]===f[1]/2||(d.hotSpot={x:h[0],vx:"pixels",y:f[1]-h[1],wx:"pixels"})}d.Icon=e;f=b.Za();1!==f&&(d.scale=f);b=b.Cb();0!==b&&(d.heading=b);b=tx[c[c.length-1].node.namespaceURI];d=kq(d,b);nq(a,vx,jq,d,
c,b)}),LabelStyle:O(function(a,b,c){a={node:a};var d={},e=b.ua;e&&(d.color=e.sa);(b=b.Za())&&1!==b&&(d.scale=b);b=wx[c[c.length-1].node.namespaceURI];d=kq(d,b);nq(a,xx,jq,d,c,b)}),LineStyle:O(function(a,b,c){a={node:a};var d=yx[c[c.length-1].node.namespaceURI];b=kq({color:b.sa,width:b.Qc()},d);nq(a,zx,jq,b,c,d)}),PolyStyle:O(function(a,b,c){nq({node:a},Dx,Ex,[b.sa],c)})});function ux(a,b,c){return Zp.createElementNS(Jv[0],"gx:"+c)}
function nx(a,b){return Zp.createElementNS(b[b.length-1].node.namespaceURI,"Placemark")}function Sw(a,b){if(a)return Zp.createElementNS(b[b.length-1].node.namespaceURI,qx[a.F()])}var Ex=hq("color"),Ax=hq("Data"),bx=hq("ExtendedData"),ix=hq("innerBoundaryIs"),Tw=hq("Point"),Uw=hq("LineString"),Zw=hq("LinearRing"),Vw=hq("Polygon"),jx=hq("outerBoundaryIs");
tv.prototype.sx=function(a,b){b=Kr(this,b);var c=Zp.createElementNS(Kv[4],"kml");c.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:gx",Jv[0]);c.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance");c.setAttributeNS("http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation","http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd");var d={node:c},e={};1<a.length?e.Document=a:1==a.length&&(e.Placemark=a[0]);a=
lx[c.namespaceURI];e=kq(e,a);nq(d,ox,jq,e,[b],a,this);return c};function Fx(a){a=a?a:{};Ir.call(this);this.VJ=a.$d;this.aB=a.vb?a.vb:null;this.Pc=ih(a.Pc?a.Pc:"EPSG:4326")}F(Fx,Mr);function Gx(a,b){var c=[],d,e,f;e=0;for(f=a.length;e<f;++e)d=a[e],0<e&&c.pop(),d=0<=d?b[d]:b[~d].slice().reverse(),c.push.apply(c,d);a=0;for(b=c.length;a<b;++a)c[a]=c[a].slice();return c}function Hx(a,b,c,d,e,f,g){a=a.geometries;var h=[],k,m;k=0;for(m=a.length;k<m;++k)h[k]=Ix(a[k],b,c,d,e,f,g);return h}
function Ix(a,b,c,d,e,f,g){var h=a.type,k=Jx[h];c="Point"===h||"MultiPoint"===h?k(a,c,d):k(a,b);b=new vd;b.jd(Lr(c,!1,g));void 0!==a.id&&(b.Bd=a.id,b.L());a=a.properties;e&&(a||(a={}),a[e]=f);a&&ce(b,a);return b}
Fx.prototype.zC=function(a,b){if("Topology"==a.type){var c,d=null,e=null;a.transform&&(c=a.transform,d=c.scale,e=c.translate);var f=a.Zi;if(c){c=d;var g=e,h,k;h=0;for(k=f.length;h<k;++h){var m=f[h],p=c,t=g,u=0,w=0,x,z,D;z=0;for(D=m.length;z<D;++z)x=m[z],u+=x[0],w+=x[1],x[0]=u,x[1]=w,Kx(x,p,t)}}c=[];a=a.vQ;var g=this.VJ,H;for(H in a)this.aB&&-1==this.aB.indexOf(H)||("GeometryCollection"===a[H].type?(h=a[H],c.push.apply(c,Hx(h,f,d,e,g,H,b))):(h=a[H],c.push(Ix(h,f,d,e,g,H,b))));return c}return[]};
function Kx(a,b,c){a[0]=a[0]*b[0]+c[0];a[1]=a[1]*b[1]+c[1]}Fx.prototype.DC=function(){return this.Pc};
var Jx={Point:function(a,b,c){a=a.coordinates;b&&c&&Kx(a,b,c);return new ii(a)},LineString:function(a,b){a=Gx(a.Zi,b);return new mr(a)},Polygon:function(a,b){var c=[],d,e;d=0;for(e=a.Zi.length;d<e;++d)c[d]=Gx(a.Zi[d],b);return new qi(c)},MultiPoint:function(a,b,c){a=a.coordinates;var d,e;if(b&&c)for(d=0,e=a.length;d<e;++d)Kx(a[d],b,c);return new md(a)},MultiLineString:function(a,b){var c=[],d,e;d=0;for(e=a.Zi.length;d<e;++d)c[d]=Gx(a.Zi[d],b);return new nd(c)},MultiPolygon:function(a,b){var c=[],
d,e,f,g,h,k;h=0;for(k=a.Zi.length;h<k;++h){d=a.Zi[h];e=[];f=0;for(g=d.length;f<g;++f)e[f]=Gx(d[f],b);c[h]=e}return new od(c)}};l=Fx.prototype;l.qx=function(){};l.KE=function(){};l.ME=function(){};l.BC=function(){};l.Yv=function(){};function id(){B.log("nsVmap.nsMapManager.MapManager");this.Zb=[];this.Ej={};this.Ef={};this.Bv={};this.Av={};this.Cv={};if(n(B.properties.token)){var a=this;A({method:"GET",url:B.properties.api_url+"/vmap/mapcatalog",async:!1,responseType:"",success:function(b){b=JSON.parse(b.data);n(b.mapcatalogs)&&(b=b.mapcatalogs[0]);a.Qq(b)},error:function(){a.Qq({maps:[],services:{wms:[],bing:[],osm:[]},usedMap:null})}})}else this.Qq({maps:[],services:{},status:0})}qa("nsVmap.nsMapManager.MapManager",id);
id.prototype.Qq=function(a){B.log("nsVmap.nsMapManager.MapManager.loadMapTools");B.log("oMapCatalog: ",a);0===a.maps.length&&(a.maps.push({name:"Carte vide",description:"",thumbnail:"",projection:"EPSG:3857",url:null}),1===a.status&&null!=angular.element(v.f).injector()&&setTimeout(function(){"vmap"===angular.element(v.f).injector().get(["envSrvc"]).oSelectedMode.mode_id&&bootbox.alert("<h4>Aucune carte n'est associ\u00e9e \u00e0 cet utilisateur, veuillez contacter l'administrateur de l'application</h4>")},
3E3));this.Zb=a;var b=a.usedMap;if(null!=oUrlParams.map_id)for(var c=0;c<a.maps.length;c++)a.maps[c].map_id===parseFloat(oUrlParams.map_id)&&(b=angular.copy(c),a.usedMap=b);null!=b&&null!=a.maps[b].url?(Lx(this),this.fB(a.maps[b].url)):(this.Ej={name:"Tree",children:[{view:{center:[225989.8114356043,6761426.974988975],zoom:11,projection:"EPSG:2154"}}]},this.Bv=new Vt,this.Av=new Wt,this.Cv=new Xt);this.Ef=new Fu(a)};id.prototype.loadMapTools=id.prototype.Qq;
id.prototype.fB=function(a){B.log("nsVmap.nsMapManager.MapManager.loadLayersTools");var b=this;null!=a&&A({method:"GET",url:a,async:!1,responseType:"",success:function(a){a=JSON.parse(a.data);n(a.mapjsons)&&(a=a.mapjsons[0]);B.log(a);b.Ej=a;b.Bv=new Vt;b.Av=new Wt;b.Cv=new Xt}})};id.prototype.loadLayersTools=id.prototype.fB;
id.prototype.$J=function(a){B.log("nsVmap.nsMapManager.MapManager.loadMap");B.properties.is_mobile&&B.D.ub.qc();a=a.getAttribute("url");if(null==a||0===a.length)return 0;var b=Mx(a);B.log("oTree: ",b);this.Sj(b);this.Lj();for(b=0;b<this.Zb.maps.length;b++)this.Zb.maps[b].url===a&&(this.Zb.usedMap=b);Lx(this);B.log("oVmap.event: mapChanged");B.scope.$broadcast("mapChanged");setTimeout(function(){B.Pj()},1E3)};id.prototype.loadMap=id.prototype.$J;
function Lx(a){B.log("nsVmap.nsMapManager.MapManager.prototype.setUsedMap");for(var b=0;b<a.Zb.maps.length;b++)a.Zb.maps[b].used=!1;a.Zb.maps[a.Zb.usedMap].used=!0;B.Pj(!1)}
id.prototype.Pb=function(a){B.log("nsVmap.nsMapManager.MapManager.prototype.addLayer");for(var b=!1,c=jQuery.extend(!0,{},B.oa.oj()),d=B.g().B.getLayers().P(),e=E(B.g().B).Ka(),f=E(B.g().B).Fa(),g=E(B.g().B).zf(),h=0;h<c.children.length;h++)c.children[h].name===a.$c&&(b=h);a.select=null;"true"===a.pM&&(a.select=!1);c.children[0].view.zoom=g;c.children[0].view.center=e;c.children[0].view.resolution=f;if("tilewms"===a.ze||"imagewms"===a.ze){e=[];for(h=0;h<d.length;h++){if("tilewms"===d[h].get("type"))for(f=
d[h].s().Fc,g=0;g<f.length;g++)e.push({url:f[g],vb:d[h].s().gc.LAYERS});"imagewms"===d[h].get("type")&&e.push({url:d[h].s().jf,vb:d[h].s().gc.LAYERS})}for(h=0;h<e.length;h++)if(e[h].url===B.properties.use_proxy_for_tiles?B.oa.oh(a.url):a.url&&e[h].vb===a.$d)return $.notify("La couche est d\u00e9j\u00e0 pr\u00e9sente","wms-log-message"),null;a.Nl="";r(a.sv)&&r(a.password)&&0<a.sv.trim().length&&0<a.password.trim().length&&(a.Nl=JSON.stringify({login:a.sv,password:a.password}));!1===b?(a={name:a.$c,
children:[{name:a.ae,index:1E6,layerType:"tilewms",visible:"true",legend:"true",select:a.select,url:a.url,service_options:a.Nl,params:{LAYERS:a.$d,VERSION:a.version,STYLES:null!=a.style?a.style:""}}]},c.children.push(a)):(a={name:a.ae,index:1E6,layerType:"tilewms",visible:"true",legend:"true",select:a.select,url:a.url,service_options:a.Nl,params:{LAYERS:a.$d,VERSION:a.version,STYLES:null!=a.style?a.style:""}},c.children[b].children.push(a))}else if("osm"===a.ze){for(h=0;h<c.children.length;h++)if(c.children[h].children)for(g=
0;g<c.children[h].children.length;g++)if(c.children[h].children[g].url===a.url||""==a.url&&"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png"==c.children[h].children[g].url)return $.notify("La couche est d\u00e9j\u00e0 pr\u00e9sente","error"),0;!1===b?(a={name:a.$c,children:[{index:1E6,name:a.ae,visible:"true",layerType:"osm",url:a.url}]},c.children.push(a)):(a={name:a.ae,index:1E6,visible:"true",layerType:"osm",url:a.url},c.children[b].children.push(a))}else if("xyz"===a.ze){for(h=0;h<c.children.length;h++)if(c.children[h].children)for(g=
0;g<c.children[h].children.length;g++)if(c.children[h].children[g].url===a.url)return $.notify("La couche est d\u00e9j\u00e0 pr\u00e9sente","error"),0;!1===b?(a={name:a.$c,children:[{index:1E6,name:a.ae,visible:"true",layerType:"xyz",url:a.url}]},c.children.push(a)):(a={name:a.ae,index:1E6,visible:"true",layerType:"xyz",url:a.url},c.children[b].children.push(a))}else if("bing"===a.ze){for(h=0;h<c.children.length;h++)if(c.children[h].children)for(g=0;g<c.children[h].children.length;g++)if(c.children[h].children[g].imagerySet===
a.$d)return $.notify("La couche est d\u00e9j\u00e0 pr\u00e9sente","error"),0;!1===b?(a={name:a.$c,children:[{name:a.$d,index:1E6,imagerySet:a.$d,visible:"true",layerType:"bing",key:a.key,culture:a.dj}]},c.children.push(a)):(a={name:a.$d,index:1E6,imagerySet:a.$d,visible:"true",layerType:"bing",key:a.key,culture:a.dj},c.children[b].children.push(a))}else if("wmts"===a.ze){for(h=0;h<c.children.length;h++)if(c.children[h].children)for(g=0;g<c.children[h].children.length;g++)if(c.children[h].children[g].layer===
a.$d)return $.notify("La couche est d\u00e9j\u00e0 pr\u00e9sente","error"),0;!1===b?(a={name:a.$c,children:[{name:a.ae,index:1E6,layer:a.$d,visible:"true",layerType:"wmts",matrixSet:a.Zq,style:a.style,format:a.format,requestEncoding:a.Zn,service_options:a.Nl,version:a.version,url:a.url}]},c.children.push(a)):(a={name:a.ae,index:1E6,layer:a.$d,visible:"true",layerType:"wmts",matrixSet:a.Zq,style:a.style,format:a.format,requestEncoding:a.Zn,service_options:a.Nl,version:a.version,url:a.url},c.children[b].children.push(a))}else if("imagevector"===
a.ze){for(h=0;h<c.children.length;h++)if(c.children[h].children)for(g=0;g<c.children[h].children.length;g++)if("imagevector"===c.children[h].children[g].layerType&&void 0!==c.children[h].children[g].url&&(c.children[h].children[g].url===B.properties.use_proxy_for_tiles?B.oa.oh(a.url):a.url))return $.notify("La couche est d\u00e9j\u00e0 pr\u00e9sente","error"),0;!1===b?(a={name:a.$c,children:[{name:a.ae,index:1E6,visible:"true",layerType:"imagevector",url:a.url,features:a.features,style:a.style}]},
c.children.push(a)):(a={name:a.ae,index:1E6,visible:"true",layerType:"imagevector",url:a.url,features:a.features,style:a.style},c.children[b].children.push(a))}else console.error('type :"'+a.ze+'" non pris en compte');B.oa.Sj(c);B.oa.Lj();B.Pj(!1)};id.prototype.addLayer=id.prototype.Pb;
id.prototype.Fl=function(a){B.log("removeLayer");for(var b=this.Ej,c=E(B.g().B).Fa(),d=E(B.g().B).Ka(),e=0;e<b.children.length;e++)if(b.children[e].children)for(var f=b.children[e].children,g=0;g<f.length;g++)f[g].olLayer.$$hashKey===a.$$hashKey&&f.splice(g,1);B.g().B.Fl(a);for(e=0;e<b.children.length;e++)b.children[e].children&&0===b.children[e].children.length&&(B.g().B.getLayers().P().length=0,b.children.splice(e,1),this.Lj());Ki(E(B.g().B),c);E(B.g().B).tb(d)};id.prototype.removeLayer=id.prototype.Fl;
id.prototype.lt=function(a,b,c){B.log("nsVmap.nsMapManager.MapManager.addLayerFromVectorContent");var d;try{d=$.parseJSON(a)}catch(m){d=a}for(var e=[Iu,Ur,mv,tv,Fx],f=0;f<e.length;f++){var g=new e[f];try{var h=g.si(d,{Ic:E(B.g().B).J()});if(0<h.length)var k=h,f=e.length}catch(m){}}if(null!=k)return this.Pb({ze:"imagevector",$c:b,ae:c,features:k}),!0;$.notify("Impossible de lire les g\u00e9om\u00e9tries","error");console.error("Impossible de lire les g\u00e9om\u00e9tries: ",a);return!1};
id.prototype.addLayerFromVectorContent=id.prototype.lt;
id.prototype.aK=function(a){B.log("nsVmap.nsMapManager.MapManager.loadMapFromFile");var b=a.getAttribute("file-container");a=a.getAttribute("url");$("#maplist-log-message").empty();if(""!==a)if("htt"===a||"www"===a)oTree=Mx(a),B.oa.Sj(oTree),B.oa.Lj();else{$.notify("Erreur lors du chargement du fichier: Pour de raisons de s\u00e9curit\u00e9, lors de l'utilisation d'un fichier local, vous devez utiliser le bouton \"Chercher\"","error");return}else if(""!==b){b=document.getElementById(b).files;if(!b.length){$.notify("Veuillez s\u00e9lectionner un fichier",
"error");return}b=b[0];a=new FileReader;a.onloadend=function(a){a.target.readyState===FileReader.DONE&&(a=$.parseJSON(a.target.result),B.oa.Sj(a),B.oa.Lj())};a.readAsText(b)}else{$.notify("Veuillez s\u00e9lectionner un fichier","error");return}B.Vl("close-modal-button")};id.prototype.loadMapFromFile=id.prototype.aK;id.prototype.Lj=function(){B.log("nsVmap.nsMapManager.MapManager.reloadMap");angular.element($("#layertree")).scope().$evalAsync(function(a){a.ctrl.Qn()})};id.prototype.reloadMap=id.prototype.Lj;
function Mx(a){var b;A({method:"GET",url:a,async:!1,responseType:"",success:function(a){a=JSON.parse(a.data);n(a.mapjsons)&&(b=a.mapjsons[0])}});B.log(b);return b}
id.prototype.eG=function(a){var b=a.getAttribute("collapse"),c=$(a.getAttribute("data-target"))[0];"in"===b?(a.setAttribute("collapse","out"),$(a).find(".list-group-icon2").removeClass("icon-keyboard_arrow_down"),$(a).find(".list-group-icon2").addClass("icon-keyboard_arrow_right")):"out"===b?(a.setAttribute("collapse","in"),$(a).find(".list-group-icon2").removeClass("icon-keyboard_arrow_right"),$(a).find(".list-group-icon2").addClass("icon-keyboard_arrow_down")):console.error("value 'collapse' of element is not allowed: "+
a);c.setAttribute("collapse",a.getAttribute("collapse"));B.Pj(!0)};id.prototype.collapseElement=id.prototype.eG;id.prototype.oh=function(a){if(n(a)){var b=B.properties.proxy_url;a=a.replace(/\?/g,"&");return b+"?url="+a}};id.prototype.tr=function(a){if(n(a)){for(var b=[],c=0;c<a.length;c++)b.push(this.oh(a[c]));return b}};
id.prototype.xM=function(a){var b=B.g().B.getLayers().P(),c=!0;null!=B.properties.controls&&null!=B.properties.controls.RefreshSocket&&null!=B.properties.controls.RefreshSocket.keep_loaded_tiles&&(c=B.properties.controls.RefreshSocket.keep_loaded_tiles);for(var d=0;d<b.length;d++){var e=b[d].get("events");null!=e&&-1!==e.indexOf(a)&&b[d].ud(c);delete e}};id.prototype.reloadEventLayers=id.prototype.xM;id.prototype.WH=function(){return this.Bv};id.prototype.getLayersTreeTool=id.prototype.WH;
id.prototype.UH=function(){return this.Av};id.prototype.getLayersOrderTool=id.prototype.UH;id.prototype.cI=function(){return this.Cv};id.prototype.getMapLegendTool=id.prototype.cI;id.prototype.eI=function(){return this.Ef};id.prototype.getMapModalTool=id.prototype.eI;
id.prototype.oj=function(){function a(c){if(n(c.children))for(var d=0;d<c.children.length;d++)a(c.children[d]);n(c.olLayer)&&(c.visible=c.olLayer.getVisible(),c.index=b.indexOf(c.olLayer),c.opacity=c.olLayer.Vg())}for(var b=B.g().B.getLayers().P(),c=0;c<this.Ej.children.length;c++)a(this.Ej.children[c]);return this.Ej};id.prototype.getLayersTree=id.prototype.oj;
id.prototype.aq=function(){function a(b){if(n(b.children))for(var e=0;e<b.children.length;e++)a(b.children[e]);for(e=0;e<d.length;e++)n(b[d[e]])&&delete b[d[e]];n(b.view)&&(b.view.extent=Ei(E(c),c.$a()),b.view.projection=E(c).J().Z);"imagevector"===b.layerType&&null!=b.features&&(delete b.features,b.features=[])}for(var b=jQuery.extend(!0,{},B.oa.oj()),c=B.g().B,d=["olLayer","$$hashKey","visibleLayers"],e=0;e<b.children.length;e++)a(b.children[e]);var f=[],b=JSON.stringify(b,function(a,b){if("object"===
typeof b&&null!==b){if(-1!==f.indexOf(b))return;f.push(b)}return b}),f=null;return b};id.prototype.getJSONLayersTree=id.prototype.aq;id.prototype.Sj=function(a){this.Ej=a};id.prototype.setLayersTree=id.prototype.Sj;id.prototype.kA=function(){return this.Zb};id.prototype.getMapCatalog=id.prototype.kA;
id.prototype.Bu=function(a){B.log("nsVmap.nsMapManager.MapManager.prototype.getQueryableLayers");a=n(a)?a:!1;for(var b=B.g().B.getLayers().P(),c=[],d=0;d<b.length;d++)!0===b[d].get("bo_queryable")&&n(b[d].get("layer_id"))&&(!0===a&&!0!==b[d].getVisible()||c.push(b[d]));return c};id.prototype.getQueryableLayers=id.prototype.Bu;
function Nx(a){B.log("nsVmap.nsMapManager.MapManager.prototype.getBusinessObjectsFromLayers");for(var b={},c,d,e=0;e<a.length;e++){c=a[e].get("business_objects");for(var f=0;f<c.length;f++)d=c[f].business_object_id,null!=b[d]?b[d].layers.push(a[e]):b[d]={bo_id:d,layers:[a[e]],bo_title:c[f].title,bo_id_field:c[f].id_field,bo_user_rights:c[f].user_rights,bo_search_field:c[f].search_field,bo_result_field:c[f].result_field,bo_search_use_strict:c[f].search_use_strict,bo_selection_buffer:c[f].selection_buffer,
bo_geom_column:c[f].geom_column,bo_geom_type:c[f].geom_type,bo_min_edition_scale:c[f].min_edition_scale,bo_max_edition_scale:c[f].max_edition_scale,bo_index:null!=c[f].index?c[f].index:1E6}}return b}id.prototype.Xg=function(a){B.log("nsVmap.nsMapManager.MapManager.prototype.getQueryableBusinessObjects");a=Nx(this.Bu(a));var b={},c;for(c in a)null!=a[c].bo_user_rights&&-1!==a[c].bo_user_rights.indexOf("SELECT")&&(b[c]=a[c]);return b};id.prototype.getQueryableBusinessObjects=id.prototype.Xg;
id.prototype.Au=function(a){B.log("nsVmap.nsMapManager.MapManager.prototype.getQueryableBusinessObjectsAsArray");var b=[];a=this.Xg(a);for(var c in a)b.push(a[c]);return b};id.prototype.getQueryableBusinessObjectsAsArray=id.prototype.Au;id.prototype.tu=function(){B.log("nsVmap.nsMapManager.MapManager.prototype.getInsertableBusinessObjects");var a=Nx(this.Bu()),b=[],c;for(c in a)null!=a[c].bo_user_rights&&-1!==a[c].bo_user_rights.indexOf("INSERT")&&b.push(a[c]);return b};
id.prototype.getInsertableBusinessObjects=id.prototype.tu;var Ox={};function Px(){B.log("nsVmap.nsToolsManager.VmapUser")}qa("nsVmap.nsToolsManager.VmapUser",Px);Ox.VmapUser=Px;Px.prototype.eP=function(){B.log("nsVmap.nsToolsManager.VmapUser.prototype.vmapuserDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang"},controller:"AppVmapUserController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/tools/"+(B.properties.is_mobile?"user_mobile.html":"user.html")}};
Px.prototype.Dh=function(a,b,c){B.log("nsVmap.nsToolsManager.VmapUser.prototype.vmapuserController");a.sUserLoginText=sessionStorage.user_login;this.b=a;this.va=b;this.properties=B.properties;this.token=B.properties.token;if(B.properties.is_mobile)c.find(".modal").on("shown.bs.modal",function(){$(".modal-backdrop.fade.in").hide();$(".modal.fade.in").find(".modal-dialog").addClass("mobile-full-modal")})};Px.prototype.Dh.$inject=["$scope","$q","$element"];
Px.prototype.Dh.prototype.WG=function(){B.log("nsVmap.nsToolsManager.VmapUser.vmapuserController.displayUserInfos");var a=this;Qx(this).then(function(b){a.Lu().then(function(a){var c={display:a},e=angular.element($("#basictools-user-form-reader").children()).scope();e.$evalAsync(function(){e.ctrl.setDefinitionName("display");e.ctrl.setFormValues(c);e.ctrl.setFormDefinition(b);e.ctrl.loadForm();$("#basictools-user-form-reader-modal").modal("show")})})})};
Px.prototype.Dh.prototype.displayUserInfos=Px.prototype.Dh.prototype.WG;Px.prototype.Dh.prototype.disconnect=function(){B.log("nsVmap.nsToolsManager.VmapUser.vmapuserController.disconnect");angular.element(v.f).scope().disconnect()};Px.prototype.Dh.prototype.disconnect=Px.prototype.Dh.prototype.disconnect;
function Qx(a){B.log("nsVmap.nsToolsManager.VmapUser.vmapuserController.getUserForm_");var b=a.va.defer();A({method:"GET",url:"modules/vitis/forms/user/user_vitis_user.json",headers:{Accept:"application/x-vm-json"},scope:a.b,success:function(a){null!=a.data&&b.resolve(a.data)}});return b.promise}
Px.prototype.Dh.prototype.Lu=function(){B.log("nsVmap.nsToolsManager.VmapUser.vmapuserController.getUserInfos_");var a=this.va.defer();A({method:"GET",url:B.properties.api_url+"/vitis/users/"+sessionStorage.user_id,headers:{Accept:"application/x-vm-json"},scope:this.b,success:function(b){null!=b.data&&null!=b.data.data&&null!=b.data.data[0]&&a.resolve(b.data.data[0])}});return a.promise};B.module.directive("appVmapUser",Px.prototype.eP);B.module.controller("AppVmapUserController",Px.prototype.Dh);function Rx(a){a=a?a:{};this.xp=void 0!==a.className?a.className:"ol-full-screen";var b=void 0!==a.label?a.label:"\u2922";this.dv="string"===typeof b?document.createTextNode(b):b;b=void 0!==a.SJ?a.SJ:"\u00d7";this.VA="string"===typeof b?document.createTextNode(b):b;var c=a.yh?a.yh:"Toggle full-screen",b=document.createElement("button");b.className=this.xp+"-"+Sx();b.setAttribute("type","button");b.title=c;b.appendChild(this.dv);J(b,"click",this.Qe,this);c=document.createElement("div");c.className=
this.xp+" ol-unselectable ol-control "+(Tx()?"":"ol-unsupported");c.appendChild(b);mj.call(this,{element:c,target:a.target});this.QJ=void 0!==a.keys?a.keys:!1;this.uc=a.source}F(Rx,mj);
Rx.prototype.Qe=function(a){a.preventDefault();Tx()&&(a=this.g())&&(Sx()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(a=this.uc?"string"===typeof this.uc?document.getElementById(this.uc):this.uc:hj(a),this.QJ?a.mozRequestFullScreenWithKeys?a.mozRequestFullScreenWithKeys():a.webkitRequestFullscreen?a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):
Ux(a):Ux(a)))};Rx.prototype.TI=function(){var a=this.element.firstElementChild,b=this.g();Sx()?(a.className=this.xp+"-true",Mi(this.VA,this.dv)):(a.className=this.xp+"-false",Mi(this.dv,this.VA));b&&b.Qd()};Rx.prototype.ib=function(a){mj.prototype.ib.call(this,a);a&&this.zj.push(J(document,Vx(),this.TI,this))};
function Tx(){var a=document.body;return!!(a.webkitRequestFullscreen||a.mozRequestFullScreen&&document.mozFullScreenEnabled||a.msRequestFullscreen&&document.msFullscreenEnabled||a.requestFullscreen&&document.fullscreenEnabled)}function Sx(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)}
function Ux(a){a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen()}var Vx=function(){var a;return function(){if(!a){var b=document.body;b.webkitRequestFullscreen?a="webkitfullscreenchange":b.mozRequestFullScreen?a="mozfullscreenchange":b.msRequestFullscreen?a="MSFullscreenChange":b.requestFullscreen&&(a="fullscreenchange")}return a}}();function Wx(a){a=a?a:{};var b=document.createElement("DIV");b.className=void 0!==a.className?a.className:"ol-mouse-position";mj.call(this,{element:b,La:a.La?a.La:Xx,target:a.target});J(this,ee(Yx),this.Ou,this);a.wp&&this.set(Zx,a.wp);a.pa&&this.Sr(a.pa);this.NO=void 0!==a.MO?a.MO:"";this.Gl=b.innerHTML;this.Fq=this.qe=this.xn=null}F(Wx,mj);function Xx(a){a=a.wf;a?this.xn!=a.Ma.pa&&(this.xn=a.Ma.pa,this.qe=null):this.xn=null;$x(this,this.Fq)}l=Wx.prototype;l.Ou=function(){this.qe=null};l.J=function(){return this.get(Yx)};
l.fJ=function(a){this.Fq=pe(this.g(),a);$x(this,this.Fq)};l.gJ=function(){$x(this,null);this.Fq=null};l.ib=function(a){mj.prototype.ib.call(this,a);a&&(a=a.ac,this.zj.push(J(a,"mousemove",this.fJ,this),J(a,"mouseout",this.gJ,this)))};l.Sr=function(a){this.set(Yx,ih(a))};function $x(a,b){var c=a.NO;if(b&&a.xn){if(!a.qe){var d=a.J();a.qe=d?jh(a.xn,d):sh}if(b=a.g().zc(b))a.qe(b,b),c=(c=a.get(Zx))?c(b):b.toString()}a.Gl&&c==a.Gl||(a.element.innerHTML=c,a.Gl=c)}var Yx="projection",Zx="coordinateFormat";function ay(a){function b(a){a=h.zc(pe(h,a));E(k.g()).tb(a);window.removeEventListener("mousemove",c);window.removeEventListener("mouseup",b)}function c(a){a=h.zc(pe(h,{clientX:a.clientX-p.offsetWidth/2,clientY:a.clientY+p.offsetHeight/2}));m.setPosition(a)}a=a?a:{};this.Ud=void 0!==a.collapsed?a.collapsed:!0;this.Lg=void 0!==a.Dt?a.Dt:!0;this.Lg||(this.Ud=!1);var d=void 0!==a.className?a.className:"ol-overviewmap",e=void 0!==a.yh?a.yh:"Overview map",f=void 0!==a.Ct?a.Ct:"\u00ab";"string"===typeof f?
(this.sf=document.createElement("span"),this.sf.textContent=f):this.sf=f;f=void 0!==a.label?a.label:"\u00bb";"string"===typeof f?(this.Ac=document.createElement("span"),this.Ac.textContent=f):this.Ac=f;var g=this.Lg&&!this.Ud?this.sf:this.Ac,f=document.createElement("button");f.setAttribute("type","button");f.title=e;f.appendChild(g);J(f,"click",this.Qe,this);this.Nv=document.createElement("DIV");this.Nv.className="ol-overviewmap-map";var h=this.Hd=new Yi({controls:new he,Rc:new he,view:a.view});
a.vb&&a.vb.forEach(function(a){h.Pb(a)},this);e=document.createElement("DIV");e.className="ol-overviewmap-box";e.style.boxSizing="border-box";this.vm=new ur({position:[0,0],Al:"bottom-left",element:e});this.Hd.Hg(this.vm);e=document.createElement("div");e.className=d+" ol-unselectable ol-control"+(this.Ud&&this.Lg?" ol-collapsed":"")+(this.Lg?"":" ol-uncollapsible");e.appendChild(this.Nv);e.appendChild(f);mj.call(this,{element:e,La:a.La?a.La:by,target:a.target});var k=this,m=this.vm,p=Eq(this.vm);
p.addEventListener("mousedown",function(){window.addEventListener("mousemove",c);window.addEventListener("mouseup",b)})}F(ay,mj);l=ay.prototype;l.ib=function(a){var b=this.g();a!==b&&(b&&((b=E(b))&&Td(b,ee("rotation"),this.oq,this),this.Hd.yi(null)),mj.prototype.ib.call(this,a),a&&(this.Hd.yi(this.Nv),this.zj.push(J(a,"propertychange",this.eJ,this)),0===this.Hd.getLayers().cc()&&(b=fj(a),this.Hd.set("layergroup",b)),a=E(a)))&&(J(a,ee("rotation"),this.oq,this),a.nn()&&(this.Hd.Qd(),cy(this)))};
l.eJ=function(a){"view"===a.key&&((a=a.oldValue)&&Td(a,ee("rotation"),this.oq,this),a=E(this.g()),J(a,ee("rotation"),this.oq,this))};l.oq=function(){E(this.Hd).Rl(E(this.g()).Cb())};function by(){var a=this.g(),b=this.Hd;if(a.Jc&&b.Jc){var c=a.$a(),a=Ei(E(a),c),d=b.$a(),c=Ei(E(b),d),e=ij(b,Fg(a)),f=ij(b,[a[2],a[1]]),b=Math.abs(e[0]-f[0]),e=Math.abs(e[1]-f[1]),f=d[0],d=d[1];b<.1*f||e<.1*d||b>.75*f||e>.75*d?cy(this):qg(c,a)||(c=this.g(),a=this.Hd,c=E(c),E(a).tb(c.Ka()))}dy(this)}
function cy(a){var b=a.g();a=a.Hd;var c=b.$a(),b=Ei(E(b),c);a=E(a);Gg(b,1/(.1*Math.pow(2,Math.log(7.5)/Math.LN2/2)));Ji(a,b)}function dy(a){var b=a.g(),c=a.Hd;if(b.Jc&&c.Jc){var d=b.$a(),e=E(b),f=E(c),c=e.Cb(),b=a.vm,g=Eq(a.vm),h=Ei(e,d),d=f.Fa(),e=[h[0],h[1]],f=[h[2],h[3]],k;if(a=E(a.g()).Ka())k=[e[0]-a[0],e[1]-a[1]],Zf(k,c),Vf(k,a);b.setPosition(k);g&&(g.style.width=Math.abs((e[0]-f[0])/d)+"px",g.style.height=Math.abs((f[1]-e[1])/d)+"px")}}l.Qe=function(a){a.preventDefault();this.Pu()};
l.Pu=function(){this.element.classList.toggle("ol-collapsed");this.Ud?Mi(this.sf,this.Ac):Mi(this.Ac,this.sf);this.Ud=!this.Ud;var a=this.Hd;this.Ud||a.Jc||(a.Qd(),cy(this),Qd(a,"postrender",function(){dy(this)},this))};l.mA=function(){return this.Hd};function ey(a){a=a?a:{};var b=void 0!==a.className?a.className:"ol-scale-line";this.zq=document.createElement("DIV");this.zq.className=b+"-inner";this.qd=document.createElement("DIV");this.qd.className=b+" ol-unselectable";this.qd.appendChild(this.zq);this.uE=null;this.vv=void 0!==a.minWidth?a.minWidth:64;this.Mc=!1;this.NC=void 0;this.Gl="";mj.call(this,{element:this.qd,La:a.La?a.La:fy,target:a.target});J(this,ee(gy),this.vJ,this);this.set(gy,a.units||"metric")}F(ey,mj);var hy=[1,2,5];
ey.prototype.Uh=function(){return this.get(gy)};function fy(a){this.uE=(a=a.wf)?a.Ma:null;this.xs()}ey.prototype.vJ=function(){this.xs()};
ey.prototype.xs=function(){var a=this.uE;if(a){var b=a.Oa,c=a.pa,d=this.Uh(),a=hh(c,a.ra,b,"degrees"==d?"degrees":"m");"degrees"!=d&&(a*=Rg(c));var e=this.vv*a,b="";"degrees"==d?(b=Pg.degrees,"degrees"==c.Uh()?e*=b:a/=b,e<b/60?(b="\u2033",a*=3600):e<b?(b="\u2032",a*=60):b="\u00b0"):"imperial"==d?.9144>e?(b="in",a/=.0254):1609.344>e?(b="ft",a/=.3048):(b="mi",a/=1609.344):"nautical"==d?(a/=1852,b="nm"):"metric"==d?.001>e?(b="\u03bcm",a*=1E6):1>e?(b="mm",a*=1E3):1E3>e?b="m":(b="km",a/=1E3):"us"==d?.9144>
e?(b="in",a*=39.37):1609.344>e?(b="ft",a/=.30480061):(b="mi",a/=1609.3472):yf(!1,33);for(d=3*Math.floor(Math.log(this.vv*a)/Math.log(10));;){e=hy[(d%3+3)%3]*Math.pow(10,Math.floor(d/3));c=Math.round(e/a);if(isNaN(c)){this.qd.style.display="none";this.Mc=!1;return}if(c>=this.vv)break;++d}a=e+" "+b;this.Gl!=a&&(this.Gl=this.zq.innerHTML=a);this.NC!=c&&(this.zq.style.width=c+"px",this.NC=c);this.Mc||(this.qd.style.display="",this.Mc=!0)}else this.Mc&&(this.qd.style.display="none",this.Mc=!1)};
var gy="units";function iy(a){a=a?a:{};this.Gk=void 0;this.Cm=jy;this.Is=this.rq=0;this.Ow=null;this.yD=!1;this.Yb=void 0!==a.duration?a.duration:200;var b=void 0!==a.className?a.className:"ol-zoomslider",c=document.createElement("button");c.setAttribute("type","button");c.className=b+"-thumb ol-unselectable";var d=document.createElement("div");d.className=b+" ol-unselectable ol-control";d.appendChild(c);this.Dp=new nf(d);J(this.Dp,"pointerdown",this.RI,this);J(this.Dp,"pointermove",this.OI,this);J(this.Dp,"pointerup",
this.QI,this);J(d,"click",this.LI,this);J(c,"click",Xd);mj.call(this,{element:d,La:a.La?a.La:ky})}F(iy,mj);iy.prototype.Ya=function(){this.Dp.ue();mj.prototype.Ya.call(this)};var jy=0;l=iy.prototype;l.ib=function(a){mj.prototype.ib.call(this,a);a&&a.La()};
function ky(a){if(a.wf){if(!this.yD){var b=this.element,c=b.offsetWidth,d=b.offsetHeight,e=b.firstElementChild,f=getComputedStyle(e),b=e.offsetWidth+parseFloat(f.marginRight)+parseFloat(f.marginLeft),e=e.offsetHeight+parseFloat(f.marginTop)+parseFloat(f.marginBottom);this.Ow=[b,e];c>d?(this.Cm=1,this.Is=c-b):(this.Cm=jy,this.rq=d-e);this.yD=!0}a=a.wf.Ma.ra;a!==this.Gk&&(this.Gk=a,ly(this,a))}}
l.LI=function(a){var b=E(this.g());a=my(this,Ef(1===this.Cm?(a.offsetX-this.Ow[0]/2)/this.Is:(a.offsetY-this.Ow[1]/2)/this.rq,0,1));b.animate({ra:b.kc(a),duration:this.Yb,Wc:cg})};l.RI=function(a){this.Mh||a.originalEvent.target!==this.element.firstElementChild||(zi(E(this.g()),1,1),this.Tv=a.clientX,this.Uv=a.clientY,this.Mh=!0)};
l.OI=function(a){if(this.Mh){var b=this.element.firstElementChild;this.Gk=my(this,Ef(1===this.Cm?(a.clientX-this.Tv+parseInt(b.style.left,10))/this.Is:(a.clientY-this.Uv+parseInt(b.style.top,10))/this.rq,0,1));Ki(E(this.g()),this.Gk);ly(this,this.Gk);this.Tv=a.clientX;this.Uv=a.clientY}};l.QI=function(){if(this.Mh){var a=E(this.g());zi(a,1,-1);a.animate({ra:a.kc(this.Gk),duration:this.Yb,Wc:cg});this.Mh=!1;this.Uv=this.Tv=void 0}};
function ly(a,b){b=1-Ii(E(a.g()))(b);var c=a.element.firstElementChild;1==a.Cm?c.style.left=a.Is*b+"px":c.style.top=a.rq*b+"px"}function my(a,b){return Hi(E(a.g()))(1-b)};function ny(a){a=a?a:{};this.aa=a.aa?a.aa:null;var b=void 0!==a.className?a.className:"ol-zoom-extent",c=void 0!==a.label?a.label:"E",d=void 0!==a.yh?a.yh:"Fit to extent",e=document.createElement("button");e.setAttribute("type","button");e.title=d;e.appendChild("string"===typeof c?document.createTextNode(c):c);J(e,"click",this.Qe,this);c=document.createElement("div");c.className=b+" ol-unselectable ol-control";c.appendChild(e);mj.call(this,{element:c,target:a.target})}F(ny,mj);
ny.prototype.Qe=function(a){a.preventDefault();a=E(this.g());var b=this.aa?this.aa:a.J().V();Ji(a,b)};function oy(){B.log("nsVmap.nsToolsManager.Controls");this.rm=[{id:"Attribution",title:"Attributions",description:"Affiche les attributions de la couche"},{id:"MousePosition",title:"Position de la souris",description:"Affiche la position de la souris"},{id:"CurrentProjection",title:"Projection en cours",description:"Affiche la projection de la carte en cours"},{id:"MapName",title:"Nom de la carte en cours",description:"Affiche le nom de la carte en cours"},{id:"OverviewMap",title:"Carte de supervision",
description:"Affiche la carte de supervision"},{id:"Scale",title:"\u00c9chelle num\u00e9rique",description:"Outil de changement d'\u00e9chelle"},{id:"ScaleLine",title:"\u00c9chelle graphique",description:"Affiche la barre d'\u00e9chelle"},{id:"Zoom",title:"Zoom",description:"Affiche les boutons de zoom + et -"},{id:"ZoomSlider",title:"Slider de zoom",description:"Affiche le slider de zoom"},{id:"RefreshSocket",title:"Rafraichissement auto",description:"Rafraichit automatiquement les couches lorsque les donn\u00e9es sont modifi\u00e9es"}];
this.W=B.g().B;var a=["MapName","Scale","ScaleLine","Zoom","RefreshSocket"];if(oClientProperties.is_mobile)for(var b=this.rm.length-1;0<=b;b--)-1===a.indexOf(this.rm[b].id)&&this.rm.splice(b,1)}qa("nsVmap.nsToolsManager.Controls",oy);Ox.Controls=oy;
oy.prototype.ad=function(a){B.log("nsVmap.nsToolsManager.Controls.prototype.addControl: "+a);switch(a){case "Attribution":var b=new qj;b.set("type",a);this.W.ad(b);break;case "FullScreen":b=new Rx;b.set("type",a);this.W.ad(b);break;case "MousePosition":b=new Wx({wp:function(a){return[a[0].toPrecision(8),a[1].toPrecision(8)]}});b.set("type",a);this.W.ad(b);break;case "OverviewMap":this.KL=b=new ay({view:new yi({pa:E(this.W).J()})});b.set("type",a);this.W.ad(b);break;case "Rotate":b=new sj({Ly:!1});
b.set("type",a);this.W.ad(b);break;case "ScaleLine":b=new ey({minWidth:80});b.set("type",a);this.W.ad(b);break;case "Zoom":b=new uj;b.set("type",a);this.W.ad(b);break;case "ZoomSlider":b=new iy;b.set("type",a);this.W.ad(b);break;case "ZoomToExtent":b=new ny;b.set("type",a);this.W.ad(b);break;case "CurrentProjection":$("#olMap").children().children(".ol-overlaycontainer-stopevent").append('<div class="ol-current-projection ol-unselectable"><span id="current-projection" class="ol-control"></span></div>');
$("#current-projection").html(B.oProjections[E(B.g().B).J().Z]);break;case "MapName":$("#olMap").children().children(".ol-overlaycontainer-stopevent").append('<div class="ol-map-name ol-unselectable"><span id="map-name" class="ol-control"></span></div>');a=B.oa.Zb;for(var c=0;c<a.maps.length;c++)!0===a.maps[c].used&&(b=a.maps[c].name);$("#map-name").html(b);break;case "Scale":a='<div class="dropup"> <button class="btn btn-sm btn-default dropdown-toggle padding-sides-10 set-scale-btn" style="width: auto" type="button" onclick="$(\'#scale-list\').toggle()"> <span id="current-scale">'+
B.g().Za({pretty:!0})+'</span> <span class="caret"></span> </button> <ul id="scale-list" style="font-size: 12px" class="dropdown-menu" aria-labelledby="dropdownMenu2"> '+(B.properties.is_mobile?"":"<li><a class=\"pointer\" onclick=\"$('#scale-modal').modal('show')\">Ajouter \u00e0 la liste</a></li>")+' <li><a class="pointer" onclick="oVmap.getMap().setScale(1000000)">1:1,000,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(500000)">1:500,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(250000)">1:250,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(100000)">1:100,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(50000)">1:50,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(25000)">1:25,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(10000)">1:10,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(5000)">1:5,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(1000)">1:1,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(250)">1:250</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(100)">1:100</a></li> </ul> </div>';
$("#olMap").children().children(".ol-overlaycontainer-stopevent").append('<div id="current-scale-tool" class="ol-current-scale ol-unselectable ol-control"></div>');$("#current-scale-tool").html(a);this.W.on("click",function(){$("#scale-list").hide()},this);c=0;this.W.on("moveend",function(){c++;var a=angular.copy(c);setTimeout(function(){c===a&&$("#current-scale").html(B.g().Za({pretty:!0}))},100)},this);break;case "RefreshSocket":B.bRefreshWebsockets=!0;break;default:return console.error("Warning : control ("+
a+") is not available"),!1}};
oy.prototype.qD=function(a,b){B.log("nsVmap.nsToolsManager.Controls.prototype.setToolActive: "+a,b);var c=B.g().B,d=c.$f().P();b=n(b)?b:!0;if(!0===b)this.ad(a);else for(var e=0;e<d.length;e++)if(d[e].get("type")===a)return c.$f().remove(d[e]),0;"CurrentProjection"===a?!0===b?$("#current-projection").show():$("#current-projection").remove():"Scale"===a?!0===b?$("#current-scale-tool").show():$("#current-scale-tool").hide():"MapName"===a?!0===b?$("#map-name").show():$("#map-name").remove():"RefreshSocket"===
a&&(B.bRefreshWebsockets=b)};oy.prototype.setToolActive=oy.prototype.qD;oy.prototype.jG=function(){B.log("nsVmap.nsToolsManager.Controls.prototype.controlsDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang"},controller:"AppControlsController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/tools/controls.html"}};
oy.prototype.az=function(){B.log("nsVmap.nsToolsManager.Controls.prototype.controlsController");this.om=this.Controls=B.D.ub.$f();this.aAvaliableControls=this.Controls.rm;this.cF=B.properties.controls.active_controls;for(var a=B.g().B,b=a.$f().P(),c=0;c<b.length;c++)a.$f().remove(b[c]);for(c=0;c<this.aAvaliableControls.length;c++)this.aAvaliableControls[c].active=-1!==this.cF.indexOf(this.aAvaliableControls[c].id)?!0:!1,this.Controls.ad(this.aAvaliableControls[c].id),!1===this.aAvaliableControls[c].active&&
this.Controls.qD(this.aAvaliableControls[c].id,this.aAvaliableControls[c].active);setTimeout(function(){$('[data-toggle="tooltip"]').tooltip({animation:!1})},500)};oy.prototype.BH=function(){return this.rm};oy.prototype.getAvaliableControls=oy.prototype.BH;oy.prototype.mA=function(){return this.KL};B.module.directive("appControls",oy.prototype.jG);B.module.controller("AppControlsController",oy.prototype.az);function py(a){be.call(this);a=a||{};this.oi=null;this.qe=sh;this.ON=new Mg(6378137);this.Lo=void 0;J(this,ee("projection"),this.Ou,this);J(this,ee("tracking"),this.uJ,this);void 0!==a.pa&&this.Sr(a.pa);void 0!==a.Zw&&this.set("trackingOptions",a.Zw);this.set("tracking",void 0!==a.Yw?a.Yw:!1)}F(py,be);l=py.prototype;l.Ya=function(){this.set("tracking",!1);be.prototype.Ya.call(this)};l.Ou=function(){var a=this.J();a&&(this.qe=jh(ih("EPSG:4326"),a),this.oi&&this.set("position",this.qe(this.oi)))};
l.uJ=function(){if(Ce){var a=this.get("tracking");a&&void 0===this.Lo?this.Lo=navigator.geolocation.watchPosition(this.cM.bind(this),this.dM.bind(this),this.get("trackingOptions")):a||void 0===this.Lo||(navigator.geolocation.clearWatch(this.Lo),this.Lo=void 0)}};
l.cM=function(a){var b=a.coords;this.set("accuracy",b.accuracy);this.set("altitude",null===b.altitude?void 0:b.altitude);this.set("altitudeAccuracy",null===b.altitudeAccuracy?void 0:b.altitudeAccuracy);this.set("heading",null===b.heading?void 0:If(b.heading));this.oi?(this.oi[0]=b.longitude,this.oi[1]=b.latitude):this.oi=[b.longitude,b.latitude];a=this.qe(this.oi);this.set("position",a);this.set("speed",null===b.speed?void 0:b.speed);a=this.ON;var c=this.oi,d=b.accuracy,b=[],e;for(e=0;32>e;++e)bf(b,
a.offset(c,d,2*Math.PI*e/32));b.push(b[0],b[1]);a=new qi(null);a.ya("XY",b,[b.length]);a.um(this.qe);this.set("accuracyGeometry",a);this.L()};l.dM=function(a){a.type="error";this.set("tracking",!1);this.dispatchEvent(a)};l.Wg=function(){return this.get("position")};l.J=function(){return this.get("projection")};l.Sr=function(a){this.set("projection",ih(a))};function qy(){B.log("nsVmap.nsToolsManager.Location")}qa("nsVmap.nsToolsManager.Location",qy);qy.prototype.lK=function(){B.log("nsVmap.nsToolsManager.Location.prototype.locationDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang"},controller:"ApplocationController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/tools/"+(B.properties.is_mobile?"location_mobile.html":"location.html")}};
qy.prototype.hb=function(a,b,c){B.log("nsVmap.nsToolsManager.Location.prototype.locationController");var d=this;this.b=a;this.$timeout_=c;this.va=b;this.md=b.defer();this.W=this.map;E(this.W).Ka();E(this.W).zf();this.projections=B.oProjections;this.locationResults=[];this.locationSearch="";this.searching=!1;this.noResults="";this.sSelectedLocationService=null;this.oBusinessObjects=[];this.scale=Math.round(B.g().Za());a.goToX="";a.goToY="";a.goToProj="EPSG:4326";ry(this);a.$watch("ctrl.locationSearch",
function(){a.ctrl.XC(this.last)},!0);a.sizeOf=function(a){return Object.keys(a).length};B.scope.$on("layersChanged",function(){d.b.$applyAsync(function(){d.locationSearch="";ry(d);setTimeout(function(){d.b.$applyAsync(function(){d.sSelectedLocationService=sy(d)})})})});B.scope.$on("mapChanged",function(){n(d.vn)&&d.vn.remove()});a.locationServiceType="geocoder";this.locationServices=JSON.parse(B.properties.vmap_geocoders);setTimeout(function(){a.$applyAsync(function(){a.ctrl.sSelectedLocationService=
sy(d)})})};qy.prototype.locationController=qy.prototype.hb;qy.prototype.hb.$inject=["$scope","$q","$timeout"];
function sy(a){B.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.getDefaultlocationService_");var b=[],c;for(c in a.oBusinessObjects)b.push(a.oBusinessObjects[c]);if("business_object"===B.properties.vmap_default_geocoders&&0<b.length){a=0;null!=b[a].bo_index||(b[a].bo_index=1E6);if(1<b.length)for(c=1;c<b.length;c++)null!=b[c].bo_index&&null!=b[c].bo_search_field&&null!=b[c].bo_result_field&&b[c].bo_index<b[a].bo_index&&(a=angular.copy(c));return null!=b[a].bo_search_field&&
null!=b[a].bo_result_field?b[a].bo_id:"osm"}return null!=a.locationServices[B.properties.vmap_default_geocoders]?B.properties.vmap_default_geocoders:"osm"}
qy.prototype.hb.prototype.vM=function(){B.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.refreshMap");var a=this,b=new FormData;b.append("wmsservice_id",B.properties.private_wms_service);b.append("type","prod");A({method:"POST",url:B.properties.web_server_name+"/"+B.properties.services_alias+"/vm4ms/WmsServices/MapFile",data:b,success:function(){a.map.ud()},error:function(){a.map.ud()}})};qy.prototype.hb.prototype.refreshMap=qy.prototype.hb.prototype.vM;
qy.prototype.hb.prototype.hF=function(){B.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.addScale");var a=$("#new-scale-input").val();$("#scale-list").append('<li><a class="pointer" onclick="oVmap.getMap().setScale('+a+')">'+function(a){for(var b=1,d=a.length-1;0<d;d--)0===b%3&&(a=a.slice(0,d)+","+a.slice(d+Math.abs(0))),b++;return"1:"+a}(a)+"</a></li>");$("#scale-modal").modal("hide")};qy.prototype.hb.prototype.addScale=qy.prototype.hb.prototype.hF;
function ry(a){B.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.setBusinessObjectsList");a.oBusinessObjects=B.oa.Xg()}qy.prototype.hb.prototype.$q=function(){B.log("nsVmap.nsToolsManager.Location.prototype.locationController.maxExtent");var a=E(this.map),b=a.J().V();Ji(a,b)};qy.prototype.hb.prototype.maxExtent=qy.prototype.hb.prototype.$q;
qy.prototype.hb.prototype.EI=function(){B.log("nsVmap.nsToolsManager.Location.prototype.locationController.goHome");var a=E(B.g().B),b=a.get("homePosition");a.tb(b.Oa);Ki(a,b.ra)};qy.prototype.hb.prototype.goHome=qy.prototype.hb.prototype.EI;
qy.prototype.hb.prototype.GI=function(a,b,c){B.log("nsVmap.nsToolsManager.Location.prototype.locationController.goTo");a=[parseFloat(a),parseFloat(b)];b=E(B.g().B).J();b=th(a,c,b);var d=new vd(new ii(b));if(isNaN(b[0])||isNaN(b[1]))return bootbox.alert("<h4>Ces coordonn\u00e9es ne sont pas disponibles dans la projection saisie</h4>"),0;var e="X: "+a[0],e=e+("<br>Y: "+a[1]),e=e+("<br><i>"+B.oProjections[c]+"</i>");ty(this,d,e);E(this.map).tb(b)};qy.prototype.hb.prototype.goTo=qy.prototype.hb.prototype.GI;
qy.prototype.hb.prototype.ou=function(){B.log("nsVmap.nsToolsManager.Location.prototype.locationController.geolocateMe");if(B.properties.is_mobile)B.g().At();else{var a=B.g().Wm(E(B.g().B).J());null!=a&&(a=new vd(new ii(a)),ty(this,a,"Vous \u00eates ici"))}};qy.prototype.hb.prototype.geolocateMe=qy.prototype.hb.prototype.ou;
qy.prototype.hb.prototype.XC=function(a,b){function c(a,b){function c(a,b){return 1===a.length?null!=b[a[0]]?b[a[0]]:null:1<a.length&&null!=b[a[0]]?(b=b[a[0]],a.splice(0,1),c(a,b)):null}return c(a.split("."),b)}B.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.searchLocation");a=n(a)?a:this.locationSearch;b=n(b)?b:4;if(0===a.length)return 0;this.md.resolve();this.md=this.va.defer();B.D.ub.Nf();""!==a&&B.D.ub.Wr("#location-search-form");this.searching=!0;this.noResults="";
var d=null,e={};if(null!=this.locationServices[this.sSelectedLocationService]){this.b.locationServiceType="geocoder";var f=this.locationServices[this.sSelectedLocationService];null!=f.url&&(d=f.url.replace("[limit]",b).replace("[search]",a))}else if(null!=this.oBusinessObjects[this.sSelectedLocationService]){this.b.locationServiceType="business_object";var f=this.sSelectedLocationService,d=this.oBusinessObjects[f].bo_id,e=this.oBusinessObjects[f].bo_search_field,g=this.oBusinessObjects[f].bo_search_use_strict,
f="",f="true"===g||!0===g?{column:e,compare_operator:"=",value:g}:"left"===g?{column:e,compare_operator:"LIKE",compare_operator_options:{case_insensitive:!0},value:a+"%"}:"right"===g?{column:e,compare_operator:"LIKE",compare_operator_options:{case_insensitive:!0},value:"%"+a}:{column:e,compare_operator:"LIKE",compare_operator_options:{case_insensitive:!0},value:"%"+a+"%"},d=B.properties.api_url+"/vmap/querys/"+d+"/summary",e={filter:f,limit:b}}if(null!=d){var h=this;A({method:"GET",url:d,headers:{Accept:"application/x-vm-json"},
params:e,scope:this.b,timeout:5E3,abord:this.md.promise,success:function(a){h.searching=!1;h.locationResults=[];h.noResults="";if(!n(a.data)||null===a.data)return h.noResults="Aucun r\u00e9sultat",console.error("Pas de donn\u00e9es \u00e0 afficher"),0;if(n(a.data.error)&&n(a.data.error.errorMessage))return console.error(a.data.error.errorMessage),h.noResults=a.data.error.WP,a.data.error;null!=h.oBusinessObjects[h.sSelectedLocationService]&&null!=a.data&&null!=a.data.data&&(h.locationResults=a.data.data);
if(null!=h.locationServices[h.sSelectedLocationService]){var b=h.locationServices[h.sSelectedLocationService];a=c(b.data_field,a);for(var d=0;d<a.length;d++){var e={};e.title=c(b.title_field,a[d]);null!=b.description_field&&(e.description=c(b.description_field,a[d]));null!=b.geojson_field&&(e.geojson=c(b.geojson_field,a[d]));if(q(b.summary_fields)){e.summary=[];for(var f=0;f<b.summary_fields.length;f++)e.summary.push({label:b.summary_fields[f].label,value:c(b.summary_fields[f].key,a[d])})}h.locationResults.push(e)}}if(!n(h.locationResults))return 0;
if(0===h.locationResults.length)return h.noResults="Aucun r\u00e9sultat",0},error:function(){h.searching=!1;h.locationResults=[];h.noResults="";h.noResults="Requ\u00eate en erreur"}})}};qy.prototype.hb.prototype.searchLocation=qy.prototype.hb.prototype.XC;
qy.prototype.hb.prototype.jK=function(a){B.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.locatePlace");if(!n(a))return"place not defined";B.properties.is_mobile&&B.D.ub.qc();var b=a.geojson,c=E(this.map).J();n(a.lon)&&n(a.lat)&&(c=th([parseFloat(a.lon),parseFloat(a.lat)],"EPSG:4326",c),E(this.map).tb(c));if(!n(b))return 0;this.nB(b,"EPSG:4326",a.title)};qy.prototype.hb.prototype.locatePlace=qy.prototype.hb.prototype.jK;
qy.prototype.hb.prototype.lF=function(a){B.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.addSelection");B.properties.is_mobile&&B.D.ub.qc();var b=this,c=B.properties.api_url+"/vmap/querys/"+a.bo_type+"/summary",d=E(this.map).J().Z.substring(5);A({method:"GET",url:c,headers:{Accept:"application/x-vm-json"},params:{filter:{column:a.bo_id_field.replace(/\./g,'"."'),compare_operator:"=",value:a.bo_id_value},get_geom:!0,result_proj:d,get_image:!0,limit:200},scope:this.b,success:function(a){n(a.data.error)&&
n(a.data.error.errorMessage)&&console.error(a.data.error.errorMessage);if(n(a.data.data))var c=a.data.data;else console.error("Pas de donn\u00e9es \u00e0 afficher");if(0===c.length)return 0;var d=c[0];if(null==d.bo_intersect_geom)return $.notify("G\u00e9om\u00e9trie non disponible"),0;uy(b,d.bo_intersect_geom);var e=angular.element($("#vmap-basicselect-tool")).scope();e.$evalAsync(function(){var a=e.ctrl,b=Wa(a.aSelections);Xa(a.lk,b);a.Mj();a.Sf({data:[d],dataType:"summary",Bb:function(){a.Jh(a.lk,
!0);a.Bp(a.aSelections)}})})}})};qy.prototype.hb.prototype.addToSelection=qy.prototype.hb.prototype.lF;function uy(a,b){B.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.centerGeom");b=B.xf(b);var c=E(a.map).Fa();"Point"===b.F()?(E(a.map).tb(b.T()),Ki(E(a.map),c)):"MultiPoint"===b.F()?(Ji(E(a.map),b.V()),Ki(E(a.map),c)):Ji(E(a.map),b.V())}
qy.prototype.hb.prototype.nB=function(a,b,c){B.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.locateGeom");if(!n(a))return"geom not defined";"string"===typeof a&&(a=JSON.parse(a));var d=E(this.map).J();a=(new Ur({Pc:d})).On(a,{xd:b,Ic:d});a=new vd({geometry:a});ty(this,a,c)};qy.prototype.hb.prototype.locateGeom=qy.prototype.hb.prototype.nB;
function ty(a,b,c){B.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.locateFeature");var d=b.j().V(),e=E(a.map).Fa();"Point"===b.j().F()?E(a.map).tb(b.j().T()):"MultiPoint"===b.j().F()?(Ji(E(a.map),d),E(a.map).Tj(e)):Ji(E(a.map),d);n(a.vn)&&a.vn.remove();null!=c&&(a.vn=new Cr(b),a.vn.Ja(c))}qy.prototype.hb.prototype.DM=function(){B.D.ub.CA("#location-search-form")};qy.prototype.hb.prototype.removeLocation=qy.prototype.hb.prototype.DM;B.module.directive("appLocation",qy.prototype.lK);
B.module.controller("ApplocationController",qy.prototype.hb);function Hq(a,b,c){Nh.call(this);vy(this,a,b?b:0,c)}F(Hq,Nh);l=Hq.prototype;l.clone=function(){var a=new Hq(null);a.ya(this.gb,this.l.slice());return a};l.Vf=function(a,b,c,d){var e=this.l;a-=e[0];var f=b-e[1];b=a*a+f*f;if(b<d){0===b?d=0:(d=this.yf()/Math.sqrt(b),c[0]=e[0]+d*a,c[1]=e[1]+d*f,d=2);for(;d<this.S;++d)c[d]=e[d];c.length=this.S;return b}return d};l.Xf=function(a,b){var c=this.l;a-=c[0];b-=c[1];return a*a+b*b<=wy(this)};l.Ka=function(){return this.l.slice(0,this.S)};
l.sp=function(a){var b=this.l,c=b[this.S]-b[0];return rg(b[0]-c,b[1]-c,b[0]+c,b[1]+c,a)};l.yf=function(){return Math.sqrt(wy(this))};function wy(a){var b=a.l[a.S]-a.l[0];a=a.l[a.S+1]-a.l[1];return b*b+a*a}l.F=function(){return"Circle"};l.tb=function(a){var b=this.S,c=this.l[b]-this.l[0],d=a.slice();d[b]=d[0]+c;for(c=1;c<b;++c)d[b+c]=a[c];this.ya(this.gb,d)};
function vy(a,b,c,d){if(b){Sh(a,d,b,0);a.l||(a.l=[]);d=a.l;b=$h(d,b);d[b++]=d[0]+c;var e;c=1;for(e=a.S;c<e;++c)d[b++]=d[c];d.length=b;a.L()}else a.ya("XY",null)}l.T=function(){};l.zb=function(){};l.ya=function(a,b){Rh(this,a,b);this.L()};l.tw=function(a){this.l[this.S]=this.l[0]+a;this.L()};function Cq(a){Nj.call(this,{bg:xy,handleEvent:yy,cg:zy});this.io=!1;this.Cp=null;this.we=!1;this.uc=a.source?a.source:null;this.Ib=a.features?a.features:null;this.LN=a.KN?a.KN:12;this.Co=a.type;this.ec=Ay(this.Co);this.SN=!!a.GQ;this.KB=a.PK?a.PK:this.ec===By?3:2;this.CB=a.FK?a.FK:Infinity;this.qH=a.pH?a.pH:Ig;var b=a.gQ;if(!b)if("Circle"===this.Co)b=function(a,b){b=b?b:new Hq([NaN,NaN]);vy(b,a[0],Math.sqrt($f(a[0],a[1])));return b};else{var c,d=this.ec;d===Cy?c=ii:d===Dy?c=mr:d===By&&(c=qi);b=function(a,
b){b?d===By?a[0].length?b.zb([a[0].concat([a[0][0]])]):b.zb([]):b.zb(a):b=new c(a);return b}}this.Xd=b;this.Wl=this.vh=this.Vb=this.Ci=this.kd=this.Wd=null;this.DD=a.Xy?a.Xy*a.Xy:36;this.Ye=new yq({source:new rq({re:!1,nb:a.nb?a.nb:!1}),style:a.style?a.style:Ey()});this.zd=a.zH;this.od=a.Xb?a.Xb:Ij;this.yH=a.fQ?Ig:a.xH?a.xH:Jj;J(this,ee("active"),this.Eo,this)}F(Cq,Nj);function Ey(){var a=Yp();return function(b){return a[b.j().F()]}}l=Cq.prototype;l.ib=function(a){Nj.prototype.ib.call(this,a);this.Eo()};
function yy(a){this.we=this.ec!==Cy&&this.yH(a);var b=!0;this.we&&"pointerdrag"===a.type&&null!==this.kd?(Fy(this,a),b=!1):this.we&&"pointerdown"===a.type?b=!1:"pointermove"===a.type?b=this.$k(a):"dblclick"===a.type&&(b=!1);return Oj.call(this,a)&&b}function xy(a){this.io=!this.we;return this.we?(this.Cp=a.Sc,this.Wd||Gy(this,a),!0):this.od(a)?(this.Cp=a.Sc,!0):!1}
function zy(a){var b=!0;this.$k(a);var c=this.ec===Hy;this.io?(this.Wd?this.we||c?Iy(this):Jy(this,a)?this.qH(a)&&Iy(this):Fy(this,a):(Gy(this,a),this.ec===Cy&&Iy(this)),b=!1):this.we&&(this.Wd=null,Ky(this));!b&&this.SN&&a.stopPropagation();return b}
l.$k=function(a){if(this.Cp&&(!this.we&&this.io||this.we&&!this.io)){var b=this.Cp,c=a.Sc,d=b[0]-c[0],b=b[1]-c[1],d=d*d+b*b;this.io=this.we?d>this.DD:d<=this.DD}this.Wd?(d=a.Qb,b=this.kd.j(),this.ec===Cy?c=this.Vb:this.ec===By?(c=this.Vb[0],c=c[c.length-1],Jy(this,a)&&(d=this.Wd.slice())):(c=this.Vb,c=c[c.length-1]),c[0]=d[0],c[1]=d[1],this.Xd(this.Vb,b),this.Ci&&this.Ci.j().zb(d),b instanceof qi&&this.ec!==By?(this.vh||(this.vh=new vd(new mr(null))),d=ui(b),a=this.vh.j(),a.ya(d.gb,d.l)):this.Wl&&
(a=this.vh.j(),a.zb(this.Wl)),Ly(this)):(a=a.Qb.slice(),this.Ci?this.Ci.j().zb(a):(this.Ci=new vd(new ii(a)),Ly(this)));return!0};function Jy(a,b){var c=!1;if(a.kd){var d=!1,e=[a.Wd];a.ec===Dy?d=a.Vb.length>a.KB:a.ec===By&&(d=a.Vb[0].length>a.KB,e=[a.Vb[0][0],a.Vb[0][a.Vb[0].length-2]]);if(d)for(var d=b.map,f=0,g=e.length;f<g;f++){var h=e[f],k=ij(d,h),m=b.Sc,c=m[0]-k[0],k=m[1]-k[1];if(c=Math.sqrt(c*c+k*k)<=(a.we?1:a.LN)){a.Wd=h;break}}}return c}
function Gy(a,b){b=b.Qb;a.Wd=b;a.ec===Cy?a.Vb=b.slice():a.ec===By?(a.Vb=[[b.slice(),b.slice()]],a.Wl=a.Vb[0]):(a.Vb=[b.slice(),b.slice()],a.ec===Hy&&(a.Wl=a.Vb));a.Wl&&(a.vh=new vd(new mr(a.Wl)));b=a.Xd(a.Vb);a.kd=new vd;a.zd&&Gr(a.kd,a.zd);a.kd.jd(b);Ly(a);a.dispatchEvent(new My("drawstart",a.kd))}
function Fy(a,b){b=b.Qb;var c=a.kd.j(),d,e;a.ec===Dy?(a.Wd=b.slice(),e=a.Vb,e.length>=a.CB&&(a.we?e.pop():d=!0),e.push(b.slice()),a.Xd(e,c)):a.ec===By&&(e=a.Vb[0],e.length>=a.CB&&(a.we?e.pop():d=!0),e.push(b.slice()),d&&(a.Wd=e[0]),a.Xd(a.Vb,c));Ly(a);d&&Iy(a)}function Ny(a){if(a.kd){var b=a.kd.j(),c,d;a.ec===Dy?(c=a.Vb,c.splice(-2,1),a.Xd(c,b),2<=c.length&&(a.Wd=c[c.length-2].slice())):a.ec===By&&(c=a.Vb[0],c.splice(-2,1),d=a.vh.j(),d.zb(c),a.Xd(a.Vb,b));0===c.length&&(a.Wd=null);Ly(a)}}
function Iy(a){var b=Ky(a),c=a.Vb,d=b.j();a.ec===Dy?(c.pop(),a.Xd(c,d)):a.ec===By&&(c[0].pop(),a.Xd(c,d),c=d.T());"MultiPoint"===a.Co?b.jd(new md([c])):"MultiLineString"===a.Co?b.jd(new nd([c])):"MultiPolygon"===a.Co&&b.jd(new od([c]));a.dispatchEvent(new My("drawend",b));a.Ib&&a.Ib.push(b);a.uc&&a.uc.xb(b)}function Ky(a){a.Wd=null;var b=a.kd;b&&(a.kd=null,a.Ci=null,a.vh=null,a.Ye.s().clear(!0));return b}
l.extend=function(a){var b=a.j();this.kd=a;this.Vb=b.T();a=this.Vb[this.Vb.length-1];this.Wd=a.slice();this.Vb.push(a.slice());Ly(this);this.dispatchEvent(new My("drawstart",this.kd))};l.Uj=Jg;function Ly(a){var b=[];a.kd&&b.push(a.kd);a.vh&&b.push(a.vh);a.Ci&&b.push(a.Ci);a=a.Ye.s();a.clear(!0);a.Rf(b)}l.Eo=function(){var a=this.g(),b=jj(this);a&&b||Ky(this);this.Ye.ib(b?a:null)};
function Ay(a){var b;"Point"===a||"MultiPoint"===a?b=Cy:"LineString"===a||"MultiLineString"===a?b=Dy:"Polygon"===a||"MultiPolygon"===a?b=By:"Circle"===a&&(b=Hy);return b}var Cy="Point",Dy="LineString",By="Polygon",Hy="Circle";function My(a,b){Wd.call(this,a);this.ka=b}F(My,Wd);function Oy(a){xj.call(this,{handleEvent:Py});a=a?a:{};this.od=a.Xb?a.Xb:Hj;this.eF=a.dF?a.dF:Jg;this.AM=a.zM?a.zM:Jg;this.pO=a.oO?a.oO:Jj;this.SB=a.iL?a.iL:!1;this.Pz=a.filter?a.filter:Ig;this.vq=a.$h?a.$h:0;this.Qm=new yq({source:new rq({re:!1,features:a.features,nb:a.nb}),style:a.style?a.style:Qy(),Hi:!0,Ii:!0});if(a.vb)if("function"===typeof a.vb)a=a.vb;else{var b=a.vb;a=function(a){return 0<=b.indexOf(a)}}else a=Ig;this.Jq=a;this.Pm={};a=this.Qm.s().Hb;J(a,"add",this.pk,this);J(a,"remove",this.Dr,
this)}F(Oy,xj);l=Oy.prototype;l.Ca=function(){return this.Qm.s().Hb};l.Kb=function(a){a=I(a);return this.Pm[a]};
function Py(a){if(!this.od(a))return!0;var b=this.eF(a),c=this.AM(a),d=this.pO(a),e=!b&&!c&&!d,f=a.map,g=this.Qm.s().Hb,h=[],k=[];if(e){Hd(this.Pm);gj(f,a.Sc,function(a,b){if(this.Pz(a,b))return k.push(a),a=I(a),this.Pm[a]=b,!this.SB}.bind(this),{Iq:this.Jq,$h:this.vq});for(e=g.cc()-1;0<=e;--e){var f=g.item(e),m=k.indexOf(f);-1<m?k.splice(m,1):(g.remove(f),h.push(f))}0!==k.length&&g.extend(k)}else{gj(f,a.Sc,function(a,e){if(this.Pz(a,e))return!b&&!d||0<=g.P().indexOf(a)?(c||d)&&0<=g.P().indexOf(a)&&
(h.push(a),e=I(a),delete this.Pm[e]):(k.push(a),a=I(a),this.Pm[a]=e),!this.SB}.bind(this),{Iq:this.Jq,$h:this.vq});for(e=h.length-1;0<=e;--e)g.remove(h[e]);g.extend(k)}(0<k.length||0<h.length)&&this.dispatchEvent(new Ry(Sy,k));return Gj(a)}l.ib=function(a){var b=this.g(),c=this.Qm.s().Hb;b&&c.forEach(b.gE,b);xj.prototype.ib.call(this,a);this.Qm.ib(a);a&&c.forEach(a.wD,a)};
function Qy(){var a=Yp();bf(a.Polygon,a.LineString);bf(a.GeometryCollection,a.LineString);return function(b){return b.j()?a[b.j().F()]:null}}l.pk=function(a){var b=this.g();b&&b.wD(a.element)};l.Dr=function(a){var b=this.g();b&&b.gE(a.element)};function Ry(a,b){Wd.call(this,a);this.selected=b}F(Ry,Wd);var Sy="select";function Ty(){B.log("nsVmap.nsToolsManager.Measure")}qa("nsVmap.nsToolsManager.Measure",Ty);Ox.Measure=Ty;Ty.prototype.JK=function(){B.log("nsVmap.nsToolsManager.Measure.prototype.measureDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppmeasureController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/tools/"+(B.properties.is_mobile?"measure_mobile.html":"measure.html")}};
Ty.prototype.Aa=function(){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController");var a=this;this.Mo=new Mg(6378137);this.W=B.g().B;var b=new Tp({fill:new Sp({color:"rgba(255, 255, 255, 0.2)"}),stroke:new Tn({color:"#ffcc33",width:2}),kb:new Rp({cb:7,fill:new Sp({color:"#ffcc33"}),stroke:new Tn({color:"#FFFFFF"})})});this.Gj=Gq(B.g(),{style:b});this.pl=this.Gj.s().Hb;this.sq=new or({id:"measure-tooltip"});this.Fd=new ot({features:this.pl});this.cf=new Oy({vb:[this.Gj],Xb:Gj});this.Vc=
new Oy({vb:[this.Gj]});this.projection=E(this.map).J().Z;this.oProjections=B.oProjections;this.transform=th;this.map.on("change:view",function(){a.projection=E(a.map).J().Z});this.Vc.on("select",function(){for(var a=this.Vc.Ca().P(),b,e,f=a.length-1;0<=f;f--){b=B.g().B.fd.P();e=[];for(var g=b.length-1;0<=g;g--)b[g].get("feature")!==a[f]&&"info"!==b[g].get("feature")||e.push(b[g]);for(g=e.length-1;0<=g;g--)B.g().B.fd.remove(e[g]);this.pl.remove(a[f])}this.Vc.Ca().clear();this.cf.Ca().clear()},this);
this.lj=document.getElementById("geodesic")};Ty.prototype.measureController=Ty.prototype.Aa;function Uy(a,b){a.cd&&a.cd.parentNode.removeChild(a.cd);a.cd=document.createElement("div");a.cd.className="measure-tooltip measure-tooltip-measure";a.Cj=new ur({element:a.cd,offset:[0,-15],Al:"bottom-center"});a.Cj.set("type","measure");void 0!==b&&a.Cj.set("feature",b);a.W.Hg(a.Cj)}
function Vy(a,b){a.hh&&a.hh.parentNode.removeChild(a.hh);a.hh=document.createElement("div");a.hh.className="measure-tooltip measure-tooltip-measure";a.er=new ur({element:a.hh,offset:[0,-15],Al:"bottom-center"});a.er.set("type","measure");void 0!==b&&a.er.set("feature",b);B.g().Hg(a.er)}l=Ty.prototype.Aa.prototype;
l.Ob=function(a){B.log("addInteraction");var b=this;this.yb=B.g().sh({type:a,features:this.pl},"basicTools-measure"+a);Uy(this,"info");this.yb.on("drawstart",function(a){Vy(this,a.ka);this.Zr=a.ka;var c=a.Qb;b.listener=this.Zr.j().on("change",function(a){a=a.target;var d;a instanceof qi?(d=b.Tm(a),c=ti(a).T()):a instanceof mr?(d=b.vf(a),c=Qh(a)):a instanceof Hq&&(d=b.kj(a),c=Qh(a));b.hh.innerHTML=d;b.er.setPosition(c)})},this);this.yb.on("drawend",function(a){Wy(this,a.ka);a.ka.on("change",function(){Xy(this,
a.ka)},this);$d(b.listener)},this)};
function Wy(a,b){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController.prototype.createMeasure");Uy(a,b);a.Rj(b);if(null!=a.hh)a.cd.innerHTML=a.hh.innerHTML,a.hh.style.display="none";else{a.cd.innerHTML="";var c=b.hQ;c instanceof qi?(a.Tm(c),tooltipCoord=ti(c).T()):c instanceof mr?(a.vf(c),tooltipCoord=Qh(c)):c instanceof Hq&&(a.kj(c),tooltipCoord=Qh(c))}a.cd.className="measure-tooltip measure-tooltip-static";a.Cj.set(xr,[.8,-13]);a.Cj.setPosition(a.sj(b.j()));a.Zr=null;a.cd=null;a.Ul();
Xy(a,b);a.cd&&(a.cd.className="measure-tooltip measure-tooltip-static",a.cd.remove(),a.Cj.set(xr,[0,-7]),a.Zr=null,a.cd=null)}
function Xy(a,b,c){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController.prototype.updateTooltip");(n(c)?c:1)&&a.Rj(b);c=B.g().B.fd;for(var d=c.P().length-1;0<=d;d--)if(c.P()[d].get("feature")===b)if(c.P()[d].setPosition(a.sj(b.j())),"Ligne"===b.get("Type"))Eq(c.P()[d]).innerHTML=b.get("Longueur");else if("Polygone"===b.get("Type"))Eq(c.P()[d]).innerHTML=b.get("Superficie");else if("Cercle"===b.get("Type"))Eq(c.P()[d]).innerHTML="P\u00e9rim\u00e8tre: "+b.get("Perim\u00e8tre");else if("Point"===
b.get("Type")){var e=th(b.get("Coordonn\u00e9es"),a.projection,b.get("Projection")),f,g=document.createElement("select"),h;for(h in a.oProjections)f=document.createElement("option"),f.value=h,f.innerHTML=B.oProjections[h],g.appendChild(f);g.value=b.get("Projection");f=document.createElement("div");f.innerHTML="X = "+parseFloat(e[0]).toPrecision(9);f.innerHTML+="<br>";f.innerHTML+="Y = "+parseFloat(e[1]).toPrecision(9);var k=a;g.onchange=function(){b.set("Projection",this.value);Xy(k,b,!1)};$(Eq(c.P()[d])).empty();
Eq(c.P()[d]).appendChild(g);Eq(c.P()[d]).appendChild(f)}}
l.Rj=function(a){if(a.j()instanceof ii)a.set("Type","Point"),a.set("Coordonn\u00e9es",this.Zz(a.j())),a.set("Projection",E(this.map).J().Z);else if(a.j()instanceof mr)a.set("Type","Ligne"),a.set("Longueur",this.vf(a.j())),a.set("Projection",E(this.map).J().Z);else if(a.j()instanceof qi)a.set("Type","Polygone"),a.set("Perim\u00e8tre",this.mu(a.j())),a.set("Superficie",this.Tm(a.j())),a.set("Projection",E(this.map).J().Z);else if(a.j()instanceof Hq){var b=parseFloat(this.kj(a.j())),c=this.kj(a.j()).replace(b,
""),d=2*b,e=Math.PI*b*2,f=Math.PI*Math.pow(b,2);a.set("Type","Cercle");a.set("Rayon",b+c);a.set("Diam\u00e8tre",d.toFixed(4)+c);a.set("Perim\u00e8tre",e.toFixed(4)+c);a.set("Superficie",f.toFixed(4)+c+"\u00b2");a.set("Centre",[a.j().Ka()[0].toFixed(4),a.j().Ka()[1].toFixed(4)]);a.set("Projection",E(this.map).J().Z)}else a.set("Type","undefined");b=this.pl.cc()-1;a.set("Id",b);a.set("Keys",a.cq())};
l.sj=function(a){if("Polygon"===a.F())a=Qh(ti(a));else if("LineString"===a.F())a=Qh(a);else if("Circle"===a.F())a=a.Ka();else if("Point"===a.F())a=Qh(a);else return Qh(a);return a};l.vf=function(a){this.lj.checked&&"EPSG:3857"===E(this.W).J().Z||"EPSG:4326"===E(this.W).J().Z?(a=a.T(),a=this.xm(a)):a=a.cc();return 1E3<a?Math.round(a/1E3*100)/100+" km":Math.round(100*a)/100+" m"};
l.xm=function(a){length=0;for(var b=E(this.W).J(),c=0,d=a.length-1;c<d;++c){var e=th(a[c],b,"EPSG:4326"),f=th(a[c+1],b,"EPSG:4326");length+=Ng(e,f,this.Mo.cb)}return length};l.Zz=function(a){return[a.T()[0].toPrecision(9),a.T()[1].toPrecision(9)]};l.kj=function(a){this.lj.checked&&"EPSG:3857"===E(this.W).J().Z||"EPSG:4326"===E(this.W).J().Z?(a=[Ph(a),Qh(a)],a=this.xm(a)):a=Math.round(100*a.yf())/100;return 1E3<a?Math.round(a/1E3*100)/100+" km":Math.round(100*a)/100+" m"};
l.mu=function(a){a=new mr(a.T()[0],a.gb);return this.vf(a)};l.Tm=function(a){if(this.lj.checked&&"EPSG:3857"===E(this.W).J().Z||"EPSG:4326"===E(this.W).J().Z){var b=E(this.W).J();a=ui(a.clone().transform(b,"EPSG:4326")).T();a=Math.abs(Og(a,this.Mo.cb))}else a=a.Pk();return 1E6<a?Math.round(a/1E6*100)/100+" km\u00b2":Math.round(100*a)/100+" m\u00b2"};
l.Po=function(a){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController.zoomToFeature");"Point"===a.get("Type")?E(this.W).tb(a.j().T()):"Cercle"===a.get("Type")?(Ji(E(this.W),a.j(),{padding:[0,0,0,0]}),E(this.W).tb(a.j().Ka())):Ji(E(this.W),a.j(),{padding:[0,0,0,0]})};Ty.prototype.Aa.prototype.zoomToFeature=Ty.prototype.Aa.prototype.Po;
Ty.prototype.Aa.prototype.Ul=function(){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController.showHideAnotations");document.getElementById("measure-anotations").checked?$(".measure-tooltip-static").show():$(".measure-tooltip-static").hide()};Ty.prototype.Aa.prototype.showHideAnotations=Ty.prototype.Aa.prototype.Ul;
Ty.prototype.Aa.prototype.Nh=function(a){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController.drawPoint");this.vi();a||(B.g().za.Ja("Cliquer pour mesurer l'emplacement d'un point"),this.Ob("Point"))};Ty.prototype.Aa.prototype.drawPoint=Ty.prototype.Aa.prototype.Nh;Ty.prototype.Aa.prototype.KK=function(a){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController.measureLine");this.vi();a||(B.g().za.Ja("Cliquer pour commencer \u00e0 mesurer"),this.Ob("LineString"))};
Ty.prototype.Aa.prototype.measureLine=Ty.prototype.Aa.prototype.KK;Ty.prototype.Aa.prototype.LK=function(a){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController.measurePolygon");this.vi();a||(B.g().za.Ja("Cliquer pour commencer \u00e0 mesurer"),this.Ob("Polygon"))};Ty.prototype.Aa.prototype.measurePolygon=Ty.prototype.Aa.prototype.LK;
Ty.prototype.Aa.prototype.IK=function(a){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController.measureCircle");this.vi();a||(B.g().za.Ja("Cliquer pour commencer \u00e0 mesurer"),this.Ob("Circle"))};Ty.prototype.Aa.prototype.measureCircle=Ty.prototype.Aa.prototype.IK;Ty.prototype.Aa.prototype.xv=function(a){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController.modifyFeature");this.vi();a||(B.g().za.Ja("Cliquer sur une mesure pour la modifier"),Dq(B.g(),this.Fd,"basicTools-modifyMeasure"))};
Ty.prototype.Aa.prototype.modifyFeature=Ty.prototype.Aa.prototype.xv;Ty.prototype.Aa.prototype.Pt=function(a){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController.deleteFeature");this.vi();a||(Dq(B.g(),this.Vc,"basicTools-deleteMeasure"),B.g().za.Ja("Cliquer sur une mesure pour la supprimer"))};Ty.prototype.Aa.prototype.deleteFeature=Ty.prototype.Aa.prototype.Pt;
Ty.prototype.Aa.prototype.zp=function(){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController.deleteAllFeatures");this.vi();this.pl.clear();for(var a=B.g().B.fd.P(),b=[],c=a.length-1;0<=c;c--)"measure"===a[c].get("type")&&b.push(a[c]);for(c=b.length-1;0<=c;c--)B.g().B.fd.remove(b[c])};Ty.prototype.Aa.prototype.deleteAllFeatures=Ty.prototype.Aa.prototype.zp;
Ty.prototype.Aa.prototype.vi=function(){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController.removeMeasuresInteractions");this.cd&&(this.cd.className="measure-tooltip measure-tooltip-static",this.cd.remove(),this.Cj.set(xr,[0,-7]),this.cd=this.Zr=null);B.g().za.hide();B.g().Ce()};Ty.prototype.Aa.prototype.removeMeasuresInteractions=Ty.prototype.Aa.prototype.vi;
Ty.prototype.Aa.prototype.FG=function(){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController.displayFeatures");this.sketches=this.pl.P();for(var a="",b,c=0;c<this.sketches.length;c++){b=this.sketches[c];var d=this.sketches[c],e=[];if("Ligne"===d.get("Type")||"Polygone"===d.get("Type")){e=[];e.keys="Points Coordonn\u00e9es Longueur-segment Longueur-totale Delta-x Delta-y Angle/Nord".split(" ");for(var f="Polygone"===d.get("Type")?d.j().T()[0]:d.j().T(),g=0,h=0,k=0,m=0,p=0,t=[],u=0;u<f.length;u++)e[u]=
{},e[u].Points=u+1,e[u]["Coordonn\u00e9es"]=f[u],t.push(f[u]),0!==u&&(m=new mr([f[u-1],f[u]],d.j().gb),g=this.vf(m),m=new mr(t,d.j().gb),h=this.vf(m),m=new mr([[f[u-1][0],0],[f[u][0],0]],d.j().gb),k=this.vf(m),f[u][0]<f[u-1][0]&&(k="-"+k),m=new mr([[0,f[u-1][1]],[0,f[u][1]]],d.j().gb),m=this.vf(m),f[u][1]<f[u-1][1]&&(m="-"+m),p=180/Math.PI*Math.atan2(f[u][1]-f[u-1][1],f[u][0]-f[u-1][0]),p=90-p,0>p&&(p=360- -1*p),p=p.toFixed(2)+"\u00b0"),e[u]["Longueur-segment"]=g,e[u]["Longueur-totale"]=h,e[u]["Delta-x"]=
k,e[u]["Delta-y"]=m,e[u]["Angle/Nord"]=p}b.Points=e;b=this.sketches[c].cq();d={};for(e=0;e<b.length;e++)"geometry"!==b[e]&&"Keys"!==b[e]&&(d[b[e]]=this.sketches[c].get(b[e]));d=[d];b=JSON.stringify(d);b=B.Cx(b);a+=b+"\n";b=JSON.stringify(this.sketches[c].Points);b=B.Cx(b);a+=b+"\n\n"}a="data:text/csv;charset=utf-8,"+encodeURIComponent(a);$("#export-csv-button").attr("href",a)};Ty.prototype.Aa.prototype.displayFeatures=Ty.prototype.Aa.prototype.FG;
Ty.prototype.Aa.prototype.TK=function(){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController.mobileMeasurePoint");var a=this;B.D.ub.qc();B.g().$l("POINT",function(b){a.Gj.s().xb(b);Wy(a,b)})};Ty.prototype.Aa.prototype.mobileMeasurePoint=Ty.prototype.Aa.prototype.TK;Ty.prototype.Aa.prototype.SK=function(){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController.mobileMeasureLine");var a=this;B.D.ub.qc();B.g().$l("LINESTRING",function(b){a.Gj.s().xb(b);Wy(a,b)})};
Ty.prototype.Aa.prototype.mobileMeasureLine=Ty.prototype.Aa.prototype.SK;Ty.prototype.Aa.prototype.UK=function(){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController.mobileMeasurePolygon");var a=this;B.D.ub.qc();B.g().$l("POLYGON",function(b){a.Gj.s().xb(b);Wy(a,b)})};Ty.prototype.Aa.prototype.mobileMeasurePolygon=Ty.prototype.Aa.prototype.UK;
Ty.prototype.Aa.prototype.RK=function(){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController.mobileMeasureCircle");var a=this;B.D.ub.qc();B.g().$l("CIRCLE",function(b){a.Gj.s().xb(b);Wy(a,b)})};Ty.prototype.Aa.prototype.mobileMeasureCircle=Ty.prototype.Aa.prototype.RK;Ty.prototype.Aa.prototype.QK=function(){B.log("nsVmap.nsToolsManager.Measure.prototype.measureController.mobileDeleteAllFeatures");B.D.ub.qc();this.zp()};Ty.prototype.Aa.prototype.mobileDeleteAllFeatures=Ty.prototype.Aa.prototype.QK;
B.module.directive("appMeasure",Ty.prototype.JK);B.module.controller("AppmeasureController",Ty.prototype.Aa);function Yy(){B.log("nsVmap.nsToolsManager.BasicSelect")}qa("nsVmap.nsToolsManager.BasicSelect",Yy);Yy.prototype.PF=function(){B.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppBasicselectController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/tools/basicselect.html"}};
Yy.prototype.Ab=function(a,b,c){function d(){e.b.$applyAsync(function(){e.oQueryableBOs=B.oa.Xg(!0);e.aQueryableBOs=B.oa.Au(!0);e.aBusinessObjectsList=Object.keys(e.oQueryableBOs);if(null==e.oQueryableBOs[e.sSelectedBo]){var a=1E6,b="",c;for(c in e.oQueryableBOs)e.oQueryableBOs[c].bo_index<a&&(a=e.oQueryableBOs[c].bo_index,b=e.oQueryableBOs[c].bo_id);e.sSelectedBo=b}})}B.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController");var e=this;a.vmapScope=B.scope;this.b=a;this.$timeout_=
b;this.va=c;this.md=c.defer();this.Dc=B.D.ub.ql;this.properties=B.properties;this.token=B.properties.token;this.kv=B.properties.selection.limit_popup;this.limitList_=B.properties.selection.limit_list;this.allQueryables_=!1;this.aSelections=[];this.lk=[];this.tableSelection={};this.sSelectedBo="";this.oQueryableBOs={};this.aBusinessObjectsList=[];B.scope.$on("layersChanged",function(){d()});setTimeout(function(){d()});this.map.on("click",function(a){if(""===B.g().fA()){a=new ii(a.Qb);var b=B.Oe(a);
B.D.ub.Nf();this.ri(b,a)}},this);B.scope.$on("toggleOutTools",function(){e.md.resolve()});$(document).keydown(function(a){27===a.keyCode&&e.md.resolve()});B.scope.$on("mapChanged",function(){e.Gr()});a.$watch("ctrl.sSelectedBo",function(a,b){r(a)&&r(b)&&(0< !a.length||0< !b.length||a!==b&&B.scope.$broadcast("selectedBoChanged"))})};Yy.prototype.basicSelectController=Yy.prototype.Ab;Yy.prototype.Ab.$inject=["$scope","$timeout","$q"];
Yy.prototype.Ab.prototype.ri=function(a,b,c){B.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.queryByEWKTGeom");var d=this;this.Fh=a;this.fC=b;$("body").css({cursor:"wait"});this.md.resolve();this.md=this.va.defer();c=null!=c?c:this.sSelectedBo;if(null!=this.oQueryableBOs[c]){var e=Zy(this.oQueryableBOs[c]);this.Dc.ri({Tf:c,SM:e,Fh:a,zt:this.md,As:!1,buffer:this.oQueryableBOs[c].bo_selection_buffer,Bb:function(a){$("body").css({cursor:""});d.jw(a,b)}})}else $("body").css({cursor:""})};
function Zy(a){B.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototypeBO.getLayersFilters_");var b={},c={relation:"AND",operators:[]},d;if(q(a.layers))for(var e=0;e<a.layers.length;e++)a.layers[e].get("is_bo_filtered")&&(d=a.layers[e].get("filter_values_cleared"),ha(d)&&mb(b,d));for(var f in b)""!==b[f]&&(c.operators.push({column:f,compare_operator:"=",value:b[f]}),e++);return JSON.stringify(c)}
Yy.prototype.Ab.prototype.Sf=function(a){B.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.addQueryResult");var b=this,c=n(a.Bb)?a.Bb:function(){return 0};this.Dc.Sf({data:n(a.data)?a.data:[],selection:this.aSelections,dataType:n(a.dataType)?a.dataType:null,Bb:function(a){b.aSelections=a;c.call()}})};
Yy.prototype.Ab.prototype.jw=function(a,b){B.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.replaceSelectionPopup");for(var c=this,d=a.length-1;0<=d;d--){var e=!1;null!=a[d].bo_intersect_geom||null!=a[d].olFeature||(e=!0);null==a[d].olFeature||null==a[d].olFeature.j()&&(e=!0);e&&($.notify("L'objet s\u00e9lectionn\u00e9 ("+a[d].bo_id_field+" = "+a[d].bo_id_value+") n'a pas de g\u00e9om\u00e9trie"),a.splice(d,1))}0!==a.length&&(d=Wa(this.aSelections),Xa(this.lk,d),
this.Gr(),c.Sf({data:a,dataType:"summary",Bb:function(){c.Jh(c.lk);c.Bp(c.aSelections,b)}}))};Yy.prototype.Ab.prototype.replaceSelectionPopup=Yy.prototype.Ab.prototype.jw;
Yy.prototype.Ab.prototype.Bp=function(a,b){B.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.displaySelectionPopup");for(var c=this.b,d=0;d<a.length;d++){n(a[d].mapPopup)&&a[d].mapPopup.remove(!1);null!=a[d].olFeature.j().F&&"Point"===a[d].olFeature.j().F()&&(b=a[d].olFeature.j());a[d].mapPopup=new Cr(a[d].olFeature,b);a[d].mapPopup.Oi.selection=a[d];a[d].mapPopup.Oi.addEventListener("click",function(){this.selection.locked=!1},!0);if("true"===a[d].have_update_rights||
!0===a[d].have_update_rights)a[d].mapPopup.ik=document.createElement("a"),a[d].mapPopup.ik.href="#",a[d].mapPopup.ik.className="ol-popup-edit icon-draw",a[d].mapPopup.Ni.appendChild(a[d].mapPopup.ik),a[d].mapPopup.ik.scope=this.b,a[d].mapPopup.ik.selection=a[d],a[d].mapPopup.ik.addEventListener("click",function(){var a=this.selection;c.$apply(function(){c.ctrl.pd(a)})},!0);if("true"===a[d].have_card_rights||!0===a[d].have_card_rights)a[d].mapPopup.hk=document.createElement("a"),a[d].mapPopup.hk.href=
"#",a[d].mapPopup.hk.className="ol-popup-card glyphicon glyphicon-file",a[d].mapPopup.Ni.appendChild(a[d].mapPopup.hk),a[d].mapPopup.hk.scope=this.b,a[d].mapPopup.hk.selection=a[d],a[d].mapPopup.hk.addEventListener("click",function(){var a=this.selection;c.$apply(function(){c.ctrl.Ke(a)})},!0);a[d].mapPopup.Ja('<span class="vmap-popup-title">'+this.Dc.xl(a[d].bo_summarytitle,a[d].bo_summary)+"</span>");Er(a[d].mapPopup,a[d].bo_summary);n(a[d].bo_image_path)&&a[d].mapPopup.Sx(a[d].bo_image_path);"true"!==
a[d].have_update_rights&&!0!==a[d].have_update_rights||a[d].mapPopup.sm({content:'<span class="icon-polygon"></span> Modifier la g\u00e9om\u00e9trie',event:angular.bind(this,function(a){console.log("i: ",angular.copy(a));c.$apply(function(){c.ctrl.Qg(c.ctrl.aSelections[a])})},d)});"true"!==a[d].have_delete_rights&&!0!==a[d].have_delete_rights||a[d].mapPopup.sm({content:'<span class="icon-trash"></span> Supprimer l\'objet',event:angular.bind(this,function(a){console.log("i: ",angular.copy(a));c.$apply(function(){c.ctrl.Je(c.ctrl.aSelections[a])})},
d)});B.properties.is_mobile||a[d].mapPopup.sm({content:'<span class="icon-shopping_basket"></span> Ajouter au panier',event:angular.bind(this,function(a){console.log("i: ",angular.copy(a));c.$apply(function(){c.ctrl.Fe(c.ctrl.aSelections[a])})},d)});if(!1!==B.properties.selection.street_view){var e=Ph(a[d].olFeature.j()),f=E(this.map).J().Z,e=th(e,f,"EPSG:4326"),g="http://maps.google.com/maps?q=&layer=c&cbll="+e[1]+","+e[0]+"";a[d].mapPopup.sm({content:'<span class="icon-street-view"></span> Google Street View',
event:function(){window.open(g,"_blank").focus()}})}}Ra(this.aSelections,a);this.aSelections=this.Dc.Rn(this.aSelections)};Yy.prototype.Ab.prototype.Ke=function(a){B.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.displayObjectCard");this.Dc.Ke(a)};Yy.prototype.Ab.prototype.displayObjectCard=Yy.prototype.Ab.prototype.Ke;
Yy.prototype.Ab.prototype.pd=function(a){B.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.displayEditFrom");var b=this,c=angular.copy(a.bo_type);this.Dc.pd(a,function(){b.ri(b.Fh,b.fC,c)})};Yy.prototype.Ab.prototype.displayEditFrom=Yy.prototype.Ab.prototype.pd;Yy.prototype.Ab.prototype.Qg=function(a){B.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.editFeature");this.Jh();this.Dc.Qg(a)};Yy.prototype.Ab.prototype.editFeature=Yy.prototype.Ab.prototype.Qg;
Yy.prototype.Ab.prototype.Je=function(a){B.log("nsVmap.nsToolsManager.BasicSelect.basicSelectController.deleteObject");var b=this;this.Dc.Je(a,function(){b.Jh();b.Fr(a)})};Yy.prototype.Ab.prototype.deleteObject=Yy.prototype.Ab.prototype.Je;Yy.prototype.Ab.prototype.Gr=function(){B.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.removePopups");this.Jh();this.Mj()};Yy.prototype.Ab.prototype.removePopups=Yy.prototype.Ab.prototype.Gr;
Yy.prototype.Ab.prototype.Mj=function(a){B.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.removeSelections");for(var b=this.aSelections.length-1;0<=b;b--)null!=a?this.aSelections[b].bo_type===a&&Ta(this.aSelections,b):Ta(this.aSelections,b)};Yy.prototype.Ab.prototype.Fr=function(a){for(var b=this.aSelections.length-1;0<=b;b--)angular.equals(this.aSelections[b],a)&&this.aSelections.splice(b,1)};
Yy.prototype.Ab.prototype.Jh=function(a){B.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.closeSelectionPopup");a=null!=a?a:this.aSelections;for(var b=0;b<a.length;b++)n(a[b].mapPopup)&&a[b].mapPopup.remove()};Yy.prototype.Ab.prototype.Fe=function(a){B.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.tableAddToCard");this.Dc.Fe([a])};Yy.prototype.Ab.prototype.addToCard=Yy.prototype.Ab.prototype.Fe;
B.module.directive("appBasicselect",Yy.prototype.PF);B.module.controller("AppBasicselectController",Yy.prototype.Ab);function Mt(a){a=a?a:{};Ir.call(this);this.PN=void 0!==a.CD?a.CD:!1}F(Mt,lv);function $y(a){a=a.T();return 0===a.length?"":a.join(" ")}function az(a){a=a.T();for(var b=[],c=0,d=a.length;c<d;++c)b.push(a[c].join(" "));return b.join(",")}function bz(a){var b=[];a=vi(a);for(var c=0,d=a.length;c<d;++c)b.push("("+az(a[c])+")");return b.join(",")}
function cz(a){var b=a.F(),c=(0,dz[b])(a),b=b.toUpperCase();if(a instanceof Nh){a=a.gb;var d="";if("XYZ"===a||"XYZM"===a)d+="Z";if("XYM"===a||"XYZM"===a)d+="M";a=d;0<a.length&&(b+=" "+a)}return 0===c.length?b+" EMPTY":b+"("+c+")"}
var dz={Point:$y,LineString:az,Polygon:bz,MultiPoint:function(a){var b=[];a=a.pj();for(var c=0,d=a.length;c<d;++c)b.push("("+$y(a[c])+")");return b.join(",")},MultiLineString:function(a){var b=[];a=pd(a);for(var c=0,d=a.length;c<d;++c)b.push("("+az(a[c])+")");return b.join(",")},MultiPolygon:function(a){var b=[];a=qd(a);for(var c=0,d=a.length;c<d;++c)b.push("("+bz(a[c])+")");return b.join(",")},GeometryCollection:function(a){var b=[];a=Lm(a.Rb);for(var c=0,d=a.length;c<d;++c)b.push(cz(a[c]));return b.join(",")}};
l=Mt.prototype;l.yC=function(a,b){return(a=this.Ar(a,b))?(b=new vd,b.jd(a),b):null};l.AC=function(a,b){a=this.Ar(a,b);a=this.PN&&"GeometryCollection"==a.F()?a.Rb:[a];for(var c=[],d=0,e=a.length;d<e;++d)b=new vd,b.jd(a[d]),c.push(b);return c};l.Ar=function(a,b){return(a=(new ez(new fz(a))).parse())?Lr(a,!1,b):null};l.rx=function(a,b){return(a=a.j())?this.Ns(a,b):""};
l.LE=function(a,b){if(1==a.length)return this.rx(a[0],b);for(var c=[],d=0,e=a.length;d<e;++d)c.push(a[d].j());a=new Or(c);return this.Ns(a,b)};l.Ns=function(a,b){return cz(Lr(a,!0,b))};function fz(a){this.lm=a;this.ai=-1}
function gz(a){var b=a.lm.charAt(++a.ai),c={position:a.ai,value:b};if("("==b)c.type=2;else if(","==b)c.type=5;else if(")"==b)c.type=3;else if("0"<=b&&"9">=b||"."==b||"-"==b){c.type=4;var d,b=a.ai,e=!1,f=!1;do{if("."==d)e=!0;else if("e"==d||"E"==d)f=!0;d=a.lm.charAt(++a.ai)}while("0"<=d&&"9">=d||"."==d&&(void 0===e||!e)||!f&&("e"==d||"E"==d)||f&&("-"==d||"+"==d));a=parseFloat(a.lm.substring(b,a.ai--));c.value=a}else if("a"<=b&&"z">=b||"A"<=b&&"Z">=b){c.type=1;b=a.ai;do d=a.lm.charAt(++a.ai);while("a"<=
d&&"z">=d||"A"<=d&&"Z">=d);a=a.lm.substring(b,a.ai--).toUpperCase();c.value=a}else{if(" "==b||"\t"==b||"\r"==b||"\n"==b)return gz(a);if(""===b)c.type=6;else throw Error("Unexpected character: "+b);}return c}function ez(a){this.cB=a;this.jv="XY"}function hz(a){a.Ag=gz(a.cB)}l=ez.prototype;l.match=function(a){(a=this.Ag.type==a)&&hz(this);return a};l.parse=function(){hz(this);return iz(this)};
function iz(a){var b=a.Ag;if(a.match(1)){var b=b.value,c="XY",d=a.Ag;1==a.Ag.type&&(d=d.value,"Z"===d?c="XYZ":"M"===d?c="XYM":"ZM"===d&&(c="XYZM"),"XY"!==c&&hz(a));a.jv=c;if("GEOMETRYCOLLECTION"==b){a:{if(a.match(2)){b=[];do b.push(iz(a));while(a.match(5));if(a.match(3)){a=b;break a}}else if(jz(a)){a=[];break a}throw Error(kz(a));}return new Or(a)}d=lz[b];c=mz[b];if(!d||!c)throw Error("Invalid geometry type: "+b);b=d.call(a);return new c(b,a.jv)}throw Error(kz(a));}
l.Pv=function(){if(this.match(2)){var a=nz(this);if(this.match(3))return a}else if(jz(this))return null;throw Error(kz(this));};l.Ov=function(){if(this.match(2)){var a=oz(this);if(this.match(3))return a}else if(jz(this))return[];throw Error(kz(this));};l.Qv=function(){if(this.match(2)){var a=pz(this);if(this.match(3))return a}else if(jz(this))return[];throw Error(kz(this));};
l.OL=function(){if(this.match(2)){var a;if(2==this.Ag.type)for(a=[this.Pv()];this.match(5);)a.push(this.Pv());else a=oz(this);if(this.match(3))return a}else if(jz(this))return[];throw Error(kz(this));};l.NL=function(){if(this.match(2)){var a=pz(this);if(this.match(3))return a}else if(jz(this))return[];throw Error(kz(this));};l.PL=function(){if(this.match(2)){for(var a=[this.Qv()];this.match(5);)a.push(this.Qv());if(this.match(3))return a}else if(jz(this))return[];throw Error(kz(this));};
function nz(a){for(var b=[],c=a.jv.length,d=0;d<c;++d){var e=a.Ag;if(a.match(4))b.push(e.value);else break}if(b.length==c)return b;throw Error(kz(a));}function oz(a){for(var b=[nz(a)];a.match(5);)b.push(nz(a));return b}function pz(a){for(var b=[a.Ov()];a.match(5);)b.push(a.Ov());return b}function jz(a){var b=1==a.Ag.type&&"EMPTY"==a.Ag.value;b&&hz(a);return b}function kz(a){return"Unexpected `"+a.Ag.value+"` at position "+a.Ag.position+" in `"+a.cB.lm+"`"}
var mz={POINT:ii,LINESTRING:mr,POLYGON:qi,MULTIPOINT:md,MULTILINESTRING:nd,MULTIPOLYGON:od},lz={POINT:ez.prototype.Pv,LINESTRING:ez.prototype.Ov,POLYGON:ez.prototype.Qv,MULTIPOINT:ez.prototype.OL,MULTILINESTRING:ez.prototype.NL,MULTIPOLYGON:ez.prototype.PL};function qz(){B.log("nsVmap.nsToolsManager.AdvancedSelect")}qa("nsVmap.nsToolsManager.AdvancedSelect",qz);qz.prototype.TE=function(){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppAdvancedselectController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/tools/"+(B.properties.is_mobile?"advancedselect_mobile.html":"advancedselect.html")}};
qz.prototype.ja=function(a,b,c){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController");var d=this;a.vmapScope=B.scope;this.b=a;this.$timeout_=b;this.va=c;this.md=c.defer();this.Dc=B.D.ub.ql;this.properties=B.properties;this.token=B.properties.token;this.selectGeomType="Polygon";this.kv=B.properties.selection.limit_popup;this.limitList_=B.properties.selection.limit_list;this.wt=B.properties.selection.buffer;this.he=Gq(B.g());this.dd=this.he.s().Hb;this.Nu=0;this.allQueryables_=
!1;this.aSelections=[];this.lk=[];this.tableSelection={};this.tableSelectionMetadata={};this.oQueryableBOs=B.oa.Xg();this.aBusinessObjectsList=[];this.oBusinessObjects={};this.ms={};this.sSelectedBo=null;this.bGTFExport=!1;this.oGTFExportAttibutes=null;null!=B.properties.vmap_export&&r(B.properties.vmap_export.gtf_api_url)&&r(B.properties.vmap_export.gtf_public_token)&&r(B.properties.vmap_export.gtf_priority_id)&&r(B.properties.vmap_export.gtf_email_option_id)&&r(B.properties.vmap_export.gtf_workspace_id)&&
r(B.properties.vmap_export.gtf_export_formats)&&r(B.properties.vmap_export.gtf_export_coordsys)&&(this.bGTFExport=!0,this.gtf_export_formats=JSON.parse(B.properties.vmap_export.gtf_export_formats),this.gtf_export_coordsys=JSON.parse(B.properties.vmap_export.gtf_export_coordsys));B.scope.$on("layersChanged",function(){d.b.$applyAsync(function(){d.oQueryableBOs=B.oa.Xg();Pa(d.aBusinessObjectsList);for(var a in d.oQueryableBOs)d.aBusinessObjectsList.push(a)})});Pa(d.aBusinessObjectsList);for(var e in d.oQueryableBOs)d.aBusinessObjectsList.push(e);
$(document).keydown(function(a){27===a.keyCode&&d.md.resolve()});B.scope.$on("mapChanged",function(){d.Mj()})};qz.prototype.AdvancedSelectController=qz.prototype.ja;qz.prototype.ja.$inject=["$scope","$timeout","$q"];
qz.prototype.ja.prototype.RN=function(a,b){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.startSelection");B.g().Ce();B.g().za.hide();if(!0===b)return 0;if("Point"===a)b="Cliquez sur un point pour effectuer la s\u00e9lection",B.g().za.Ja(b),rz(this,a);else if("MultiPoint"===a)b="Dessinez un ou plusieurs points pour effectuer la s\u00e9lection",B.g().za.Ja(b),rz(this,a);else if("LineString"===a)b="Dessinez une ligne pour effectuer la s\u00e9lection",B.g().za.Ja(b),
rz(this,a);else if("Polygon"===a)b="Dessinez un polygone pour effectuer la s\u00e9lection",B.g().za.Ja(b),rz(this,a);else if("Circle"===a)b="Dessinez un cercle pour effectuer la s\u00e9lection",B.g().za.Ja(b),rz(this,a);else return console.error("startSelection: type ("+a+") not allowed"),0};qz.prototype.ja.prototype.startSelection=qz.prototype.ja.prototype.RN;qz.prototype.ja.prototype.WF=function(){B.g().Ce();B.g().za.hide()};qz.prototype.ja.prototype.cancelSelection=qz.prototype.ja.prototype.WF;
function rz(a,b){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.queryByDrawing");a.pw=E(a.map).J().Z;new Ur({Pc:a.pw});a.yb=B.g().sh({type:b,features:a.dd},"basicTools-selectBy"+b);a.yb.on("drawend",function(c){"Multi"===b.substr(0,5)?bootbox.dialog({message:"<h4>Valider la g\u00e9om\u00e9trie ?</h4>",buttons:{addPart:{label:"Ajouter une autre partie",className:"btn-primary width-100 margin-10",callback:function(){}},confirm:{label:"Oui, terminer",className:"btn-success width-100 margin-10",
callback:function(){var c=B.gI(a.dd.P(),b);a.Wv(c,b)}}}}):a.Wv(c.ka,b)},a)}qz.prototype.ja.prototype.Wv=function(a,b){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.queryByFeature");var c=this;"Circle"===b&&(a=a.j(),a=new xi(a),a=new vd({geometry:a}));a=B.Oe(a.j());this.ri(a,!0,!0);setTimeout(function(){c.he.s().clear()})};qz.prototype.ja.prototype.queryByFeature=qz.prototype.ja.prototype.Wv;
qz.prototype.ja.prototype.ri=function(a){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.queryByEWKTGeom");var b=this;this.Fh=a;var c=B.oa.Xg(!0);this.Jd=Object.keys(c).length;0<this.Jd&&$("body").css({cursor:"wait"});var d=Wa(this.aSelections);Xa(this.lk,d);this.Mj();this.md.resolve();this.md=this.va.defer();var e,f;for(f in c)e=c[f].bo_geom_column,d={},d[e]=a,this.Do(f,d,e,{gP:!1}).then(function(){b.Jd--;0===b.Jd&&$("body").css({cursor:""});b.ms={};0===b.Jd&&
b.Em(b.aSelections)})};qz.prototype.ja.prototype.Sf=function(a){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.addQueryResult");var b=n(a.data)?a.data:[];a=n(a.Bb)?a.Bb:function(){return 0};for(var c=[],d=0;d<b.length;d++)c.push(b[d]),n(b[d].bo_intersect_geom)&&(c[d].olFeature=this.Dc.Lp(b[d]));Ra(this.aSelections,c);this.aSelections=this.Dc.Rn(this.aSelections);a.call()};
qz.prototype.ja.prototype.Bp=function(a){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.displaySelectionPopup");a=[a];var b=angular.element($("#vmap-basicselect-tool")).scope();this.Dc.$m(a,function(a){if(null==a[0].olFeature||null==a[0].olFeature.j())return $.notify("L'objet n'a pas de g\u00e9om\u00e9trie"),0;if(null!=a[0]&&null!=a[0].olFeature){var c=a[0].olFeature.j(),e=B.Oe(c);b.ctrl.Fh=e;b.ctrl.fC=c}B.D.ub.qc();c=b.ctrl;e=a[0];B.log("nsVmap.nsToolsManager.BasicSelect.basicSelectController.centerMapOnPopup");
null!=e.olFeature?(e=e.olFeature.j(),null!=e?"Point"===e.F()?E(c.map).tb(e.T()):"MultiPoint"===e.F()?1===e.pj().length?E(c.map).tb(Tr(e).T()):Ji(E(c.map),e):Ji(E(c.map),e):console.error("selection['olFeature'].getGeometry() not defined")):console.error("selection['olFeature'] undefined:",e.olFeature);b.ctrl.jw(a);$("#select-list-modal").modal("hide")})};function sz(a){return angular.element($("#select_search_form_reader_"+a).children()).scope()}
function tz(a){var b;a=angular.element($("#select_search_form_reader_"+a).children()).injector();null!=a&&(b=a.get(["formReaderService"]));return b}
qz.prototype.ja.prototype.Em=function(a,b){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.displaySelectionTable");var c=this;uz(c,this.aBusinessObjectsList,function(){B.log("nsVmap.nsToolsManager.AdvancedSelect.AdvancedSelectController.setBoInfos finished");$(".select_modal_table").bootstrapTable("destroy");setTimeout(function(){for(var a=0;a<c.aBusinessObjectsList.length;a++)vz(c,c.aBusinessObjectsList[a]);for(a=0;a<c.aBusinessObjectsList.length;a++)if($("#select_table_"+
c.aBusinessObjectsList[a]).bootstrapTable({data:[],onSort:angular.bind(c,function(a,b,d){var e=c.tableSelectionMetadata[a].filter,f=c.tableSelectionMetadata[a].geom_column,g=c.tableSelectionMetadata[a].current_page;null!=e?null!=f?this.Do(a,e,f,{Dn:null!=g?g:1,orderBy:b,jo:d}):console.error("sGeomColumn not defined"):console.error("oFilter not defined")},c.aBusinessObjectsList[a])}),B.properties.is_mobile){var b=$("#vmap-advancedselect-tool").parent().height();$("#select_table_"+c.aBusinessObjectsList[a]).parent().height(b-
175)}else $("#select_table_"+c.aBusinessObjectsList[a]).parent().height($("body").height()/2)},100);c.Dc.fq(a,function(){ib(c.tableSelection);c.tableSelection=wz(a);B.log("tableSelection: ",c.tableSelection);setTimeout(function(){for(var a in c.tableSelection)$("#select_table_"+a).bootstrapTable("load",c.tableSelection[a])},100)});B.D.ub.Wr($("#basic-tools-dropdown-select-btn"));setTimeout(function(){$("#select-list-modal").modal("show");c.b.$applyAsync(function(){c.sSelectedBo=null!=b?b:B.D.ub.ql.hq()})},
100)})};qz.prototype.ja.prototype.displaySelectionTable=qz.prototype.ja.prototype.Em;
function uz(a,b,c){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.setBoInfos");var d,e=0;b=n(b)?b:[];c=n(c)?c:angular.noop;for(d in a.oBusinessObjects)-1===b.indexOf(d)&&delete a.oBusinessObjects[d];for(var f=0;f<b.length;f++)d=b[f],null!=a.oBusinessObjects[d]?(e++,e===b.length&&c.call()):A({method:"GET",url:B.properties.api_url+"/vmap/businessobjects/"+d,headers:{Accept:"application/x-vm-json"},scope:a.b,success:function(d){e++;if(!n(d.data))return bootbox.alert("response['data'] undefined"),
0;if(n(d.data.errorMessage))return bootbox.alert(d.data.errorType+": "+d.data.errorMessage),0;if(null==d.data.data)return console.error("Aucune valeur retourn\u00e9e"),0;a.oBusinessObjects[d.data.data[0].business_object_id]=d.data.data[0];e===b.length&&c.call()},error:function(a){e++;e===b.length&&c.call();console.error(a)}})}
function wz(a){B.log("nsVmap.nsToolsManager.AdvancedSelect.AdvancedSelectController.formatTableSelection");if(null==a)return{};for(var b={},c={},d=0;d<a.length;d++)null!==b&&a[d].bo_type in b||(b[a[d].bo_type]=[]),null!=a[d].bo_list&&(c=kb(a[d].bo_list)),c.bo_selection_=a[d],null!=c&&b[a[d].bo_type].push(c);for(var e in b)for(d=0;d<b[e].length;d++)for(var f in b[e][d])r(b[e][d][f])&&(B.pn(b[e][d][f],"bo_link")&&(b[e][d][f]=B.Jn(b[e][d][f],"bo_link")),b[e][d][f]=B.$sanitize(b[e][d][f]));return b}
function vz(a,b){B.log("nsVmap.nsToolsManager.AdvancedSelect.AdvancedSelectController.setSearchForm");null!=a.oBusinessObjects[b].json_form||(a.oBusinessObjects[b].json_form={});null!=a.oBusinessObjects[b].json_form[0]||(a.oBusinessObjects[b].json_form[0]={});null!=a.oBusinessObjects[b].json_form[0].search||(a.oBusinessObjects[b].json_form[0].search={name:"search-form",title:b,input_size:"xxs",nb_cols:12,javascript:!1,rows:[]});null!=a.oBusinessObjects[b].json_form[0].search.name||(a.oBusinessObjects[b].json_form[0].search.name=
"search-form");null!=a.oBusinessObjects[b].json_form[0].search.title||(a.oBusinessObjects[b].json_form[0].search.title=b);null!=a.oBusinessObjects[b].json_form[0].search.input_size||(a.oBusinessObjects[b].json_form[0].search.title="xxs");null!=a.oBusinessObjects[b].json_form[0].search.nb_cols||(a.oBusinessObjects[b].json_form[0].search.title=12);null!=a.oBusinessObjects[b].json_form[0].search.javascript||(a.oBusinessObjects[b].json_form[0].search.javascript=!1);null!=a.oBusinessObjects[b].json_form[0].search.rows||
(a.oBusinessObjects[b].json_form[0].search.rows=[]);var c=a.oBusinessObjects[b].json_form[0],d={search:{}},e=a.oBusinessObjects[b].geom_column,e=null!=e?e:"geom";null!=a.ms[b]?d.search=a.ms[b]:(d.search[e]=a.Fh,d.search.advanceddselect_use_geom=!0);if(!oClientProperties.is_mobile){var f={fields:[{type:"checkbox",name:"advanceddselect_use_geom",id:"advanceddselect_use_geom_"+b,"class":"advanced-select-geom-checkbox",nb_cols:8},{visibleAllTabs:!0,type:"text",name:e,label:"Activer / D\u00e9sactiver la requ\u00eate spatiale",
class_label:"advanced-select-geom-field-label",disabled:!1,required:!1,nb_cols:4}]};angular.equals(c.search.rows[c.search.rows.length-2],f)||c.search.rows.push(f);if(null!=c.search.tabs&&null!=c.search.tabs.list)for(f=0;f<c.search.tabs.list.length;f++)-1===c.search.tabs.list[f].elements.indexOf("advanceddselect_use_geom")&&c.search.tabs.list[f].elements.push("advanceddselect_use_geom"),-1===c.search.tabs.list[f].elements.indexOf(e)&&c.search.tabs.list[f].elements.push(e)}f={fields:[{type:"button",
"class":"btn-ungroup btn-group-xs",nb_cols:12,buttons:[{visibleAllTabs:!0,id:"select_search_form_reader_"+b+"_submit_buton",type:"submit",label:"Rechercher",name:"form_submit","class":"btn-primary right"},{visibleAllTabs:!0,id:"select_search_form_reader_"+b+"_empty_buton",type:"button",label:"R\u00e9initialiser",name:"form_reinit","class":"btn-primary right margin-sides-10",event:function(){a.Gz(b);a.Hz(b)}}]}]};angular.equals(c.search.rows[c.search.rows.length-1],f)||c.search.rows.push(f);if(null!=
c.search.tabs&&null!=c.search.tabs.list)for(f=0;f<c.search.tabs.list.length;f++)-1===c.search.tabs.list[f].elements.indexOf("form_submit")&&c.search.tabs.list[f].elements.push("form_submit"),-1===c.search.tabs.list[f].elements.indexOf("form_reinit")&&c.search.tabs.list[f].elements.push("form_reinit");c.search.event=function(d){d=a.Dc.Xp(d,c,"search");null!=d.advanceddselect_use_geom&&(!1===d.advanceddselect_use_geom&&null!=d[e]&&delete d[e],delete d.advanceddselect_use_geom);a.Do(angular.copy(b),
d,angular.copy(e))};setTimeout(function(){var a=sz(b),f=tz(b);null!=a&&a.$apply(function(){a.ctrl.setDefinitionName("search");a.ctrl.setFormValues(angular.copy(d));a.ctrl.setFormDefinition(angular.copy(c));a.ctrl.loadForm()});oClientProperties.is_mobile||a.$watch("oFormValues.search.advanceddselect_use_geom",function(b,c){if(b==c)return null;var d=f.getFormElementDefinition(e,"search",a.oFormDefinition);a.$applyAsync(function(){d.disabled=!b})})},500)}
qz.prototype.ja.prototype.Gz=function(a){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.emptySearchForm");var b={search:{}},c=sz(a);null!=c&&c.$applyAsync(function(){c.ctrl.setFormValues(angular.copy(b));c.ctrl.loadForm()})};qz.prototype.ja.prototype.emptySearchForm=qz.prototype.ja.prototype.Gz;
qz.prototype.ja.prototype.Hz=function(a){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.emptySelectionTable");this.tableSelection[a]=[];$("#select_table_"+a).bootstrapTable("load",this.tableSelection[a]);this.Mj(a);this.Sf({data:[],dataType:"list"});this.tableSelectionMetadata[a]={total_row_number:0,total_pages:1,current_page:1}};qz.prototype.ja.prototype.emptySelectionTable=qz.prototype.ja.prototype.Hz;
qz.prototype.ja.prototype.Do=function(a,b,c,d){B.log("nsVmap.nsToolsManager.AdvancedSelect.AdvancedSelectController.updateSelectionTable");if(null==a)return console.error("bo_id not defined or null"),0;d=null!=d?d:{};var e=this,f=this.b,g=this.va.defer(),h=g.promise,k=null!=d.Dn?d.Dn:1,m=null!=d.orderBy?d.orderBy:this.oQueryableBOs[a].bo_id_field,p=null!=d.jo?d.jo:"asc";this.tableSelectionMetadata[a]={total_row_number:null!=this.tableSelectionMetadata[a]?this.tableSelectionMetadata[a].total_row_number:
null,total_pages:null!=this.tableSelectionMetadata[a]?this.tableSelectionMetadata[a].total_pages:null,current_page:null!=this.tableSelectionMetadata[a]?this.tableSelectionMetadata[a].current_page:null,order_by:null!=this.tableSelectionMetadata[a]?this.tableSelectionMetadata[a].order_by:null,sort_order:null!=this.tableSelectionMetadata[a]?this.tableSelectionMetadata[a].sort_order:null,filter:angular.copy(b),geom_column:angular.copy(c)};xz(this,a,b,c,d).then(function(b){if(!n(b.data))return bootbox.alert("response['data'] undefined"),
f.selectedLayerId="",0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorType+": "+b.data.errorMessage),f.selectedLayerId="",0;null==b.data.data&&(!1!==d.gP&&$.notify("Aucune valeur retourn\u00e9e","warn"),b.data.data=[]);ea(parseFloat(b.data.total_row_number))&&(e.tableSelectionMetadata[a]={total_row_number:b.data.total_row_number,total_pages:Math.ceil(parseFloat(b.data.total_row_number)/parseFloat(e.limitList_)),current_page:k,order_by:m,sort_order:p,filter:e.tableSelectionMetadata[a].filter,
geom_column:e.tableSelectionMetadata[a].geom_column});e.tableSelection[a]=wz(b.data.data)[a];null!=e.tableSelection[a]||(e.tableSelection[a]=[]);for(var c in e.tableSelection)$("#select_table_"+c).bootstrapTable("load",e.tableSelection[c]);e.Mj(a);e.Sf({data:b.data.data,dataType:"list"});B.properties.is_mobile&&($("#vmap_menu_requeteur_menu_filtre_"+a).removeClass("in"),$("#vmap_menu_requeteur_menu_table_"+a).addClass("in"));g.resolve(b)});return h};
qz.prototype.ja.prototype.updateSelectionTable=qz.prototype.ja.prototype.Do;
function xz(a,b,c,d,e){B.log("nsVmap.nsToolsManager.AdvancedSelect.AdvancedSelectController.queryBusinessObject_");if(null==b)return console.error("bo_id not defined or null"),0;e=null!=e?e:{};var f=a.va.defer(),g=f.promise,h=null!=e.Dn?e.Dn:1,k=null!=e.orderBy?e.orderBy:a.oQueryableBOs[b].bo_id_field,m=null!=e.jo?e.jo:"asc";e=null!=e.ig?e.ig:a.limitList_;c=null!=c?c:{};var p=yz(c,b,d);a.ms[b]=c;var t=zz(a,b,c[d]);b=B.properties.api_url+"/vmap/querys/"+b+"/list";var u=E(a.map).J().Z.substring(5);
A({method:"POST",url:b,headers:{"X-HTTP-Method-Override":"GET",Accept:"application/x-vm-json"},data:{filter:p,intersect_geom:c[d],result_srid:u,get_geom:!1,get_image:!1,intersect_buffer:t,limit:e,offset:h*e-e,order_by:k,sort_order:m},scope:a.b,timeout:5E3,success:function(a){f.resolve(a)}});return g}
function yz(a,b,c){B.log("nsVmap.nsToolsManager.AdvancedSelect.AdvancedSelectController.getAPIFilterFromObject_");var d=sz(b);b=tz(b);var e=0,f={relation:"AND",operators:[]},g,h;for(h in a)h!==c&&""!==a[h]&&(null!=d&&null!=b?(g=b.getFormElementDefinition(h,"search",d.oFormDefinition),"select"===g.type||"editable_select"===g.type?f.operators.push({column:h,compare_operator:"=",value:a[h]}):"list"===g.type?f.operators.push({column:h,compare_operator:"IN",value:a[h].split("|")}):f.operators.push({column:h,
compare_operator:"LIKE",value:"%"+a[h]+"%",compare_operator_options:{case_insensitive:!0}})):f.operators.push({column:h,compare_operator:"LIKE",value:"%"+a[h]+"%",compare_operator_options:{case_insensitive:!0}}),e++);return JSON.stringify(f)}function zz(a,b,c){B.log("nsVmap.nsToolsManager.AdvancedSelect.AdvancedSelectController.getAPIBuffer_");if(null==b||null==c)return null;c=B.xf(c).F();return a.Dc.gq(a.oQueryableBOs[b].bo_selection_buffer,c)}
qz.prototype.ja.prototype.$N=function(a,b){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.tableAddToCard");a=$(a).bootstrapTable("getSelections");for(var c=[],d=0;d<a.length;d++)c.push(a[d].bo_selection_);this.Dc.Fe(c,b)};qz.prototype.ja.prototype.tableAddToCard=qz.prototype.ja.prototype.$N;
qz.prototype.ja.prototype.bO=function(a){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.tableDeleteSelection");var b=this;a=$(a).bootstrapTable("getSelections");for(var c=[],d=0;d<a.length;d++)c.push(a[d].bo_selection_);this.Dc.Bm(c,function(){for(var a=0;a<c.length;a++)b.Fr(c[a]),$("#select-list-modal").hasClass("in");b.Em(b.aSelections)})};qz.prototype.ja.prototype.tableDeleteSelection=qz.prototype.ja.prototype.bO;
qz.prototype.ja.prototype.vA=function(a,b){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.goTablePage");if(null==a)return console.error("bo_id not defined"),null;if(null==b)return console.error("iPage not defined"),null;if(1>b||b>this.tableSelectionMetadata[a].total_pages)$.notify("Impossible d'afficher la page "+angular.copy(b),"error"),b=1;var c=this.tableSelectionMetadata[a].filter,d=this.tableSelectionMetadata[a].geom_column;null!=c?null!=d?this.Do(a,
c,d,{Dn:b,orderBy:this.tableSelectionMetadata[a].order_by,jo:this.tableSelectionMetadata[a].sort_order}):console.error("sGeomColumn not defined"):console.error("oFilter not defined")};qz.prototype.ja.prototype.goTablePage=qz.prototype.ja.prototype.vA;qz.prototype.ja.prototype.FI=function(a,b){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.goTablePageWithTimeout");var c=this;this.Nu++;var d=angular.copy(this.Nu);setTimeout(function(){d===c.Nu&&c.vA(a,b)},1E3)};
qz.prototype.ja.prototype.goTablePageWithTimeout=qz.prototype.ja.prototype.FI;
qz.prototype.ja.prototype.hu=function(a,b,c){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.exportTable");var d=this,e=this.tableSelectionMetadata[a].total_row_number,f=$(b).bootstrapTable("getSelections");b={};f=angular.copy(f);0<f.length&&(b.selected_rows={label:"Enregistrements s\u00e9lectionn\u00e9s ("+f.length+")",className:"btn-primary",callback:function(){"gtf"!==c?d.gu(a,f,c):Az(d,{Tf:a,nk:f,TM:c})}});0<e&&(b.all_records={label:"Tous les enregistrements ("+
e+")",className:"btn-primary",callback:function(){"gtf"!==c?d.Mz(a,c):Az(d,{Tf:a,yv:d.tableSelectionMetadata[a].filter,TM:c})}});if(0< !e&&0< !f.length)return $.notify("Aucun enregistrement \u00e0 exporter","error"),null;bootbox.dialog({message:"<h4>Donn\u00e9es \u00e0 exporter</h4>",buttons:b})};qz.prototype.ja.prototype.exportTable=qz.prototype.ja.prototype.hu;
qz.prototype.ja.prototype.gu=function(a,b,c){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.exportSelectionElems");if(!q(b))return null;0< !b.length&&$.notify("Aucun enregistrement \u00e0 exporter","error");for(var d=0;d<b.length;d++)null!=b[d].bo_selection_&&delete b[d].bo_selection_;"csv"===c&&alasql("SELECT * INTO CSV('"+a+"."+c+"' ,{headers:true}) FROM ? ",[b]);"json"===c&&alasql("SELECT * INTO JSON('"+a+"."+c+"' ,{headers:true}) FROM ? ",[b]);"xlsx"===
c&&alasql("SELECT * INTO XLSX('"+a+"."+c+"' ,{headers:true}) FROM ? ",[b])};qz.prototype.ja.prototype.exportSelectionElems=qz.prototype.ja.prototype.gu;
qz.prototype.ja.prototype.Mz=function(a,b){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.exportAllTableElems");var c=this,d=this.tableSelectionMetadata[a].filter,e=this.tableSelectionMetadata[a].geom_column;null!=d?null!=e?xz(this,a,d,e,{ig:""}).then(function(d){null!=d.data&&null!=d.data.data&&(d=wz(d.data.data)[a],c.gu(a,d,b))}):console.error("sGeomColumn not defined"):console.error("oFilter not defined")};
qz.prototype.ja.prototype.exportAllTableElems=qz.prototype.ja.prototype.Mz;
function Az(a,b){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.showGtfExportFormModal_");var c,d,e;if(null==b.Tf)console.error("opt_options.bo_id non d\u00e9fini");else if(null==a.oQueryableBOs[b.Tf])console.error("opt_options.bo_id non d\u00e9fini");else{var f=null!=b.yv,g=null!=b.nk;c=a.oQueryableBOs[b.Tf].bo_geom_column;if(g){if(q(b.nk)&&0<b.nk.length){c={relation:"AND",operators:[{column:b.nk[0].bo_selection_.bo_id_field,compare_operator:"in",value:[]}]};
for(var h=0;h<b.nk.length;h++)c.operators[0].value.push(b.nk[h].bo_selection_.bo_id_value);d=JSON.stringify(c)}}else if(f)e=b.yv[c],d=yz(b.yv,b.Tf,c);else{console.error("ni opt_options.oFilter ni opt_options.aTableSelection d\u00e9finis");return}a.b.$applyAsync(function(){a.oGTFExportAttibutes={boId:b.Tf,format:"shape",coordsys:"2154",mails:"",filter:"",intersectGeom:null,intersectBuffer:null};g?a.oGTFExportAttibutes.filter=d:f&&(a.oGTFExportAttibutes.filter=d,null!=e&&(a.oGTFExportAttibutes.intersectGeom=
e,a.oGTFExportAttibutes.intersectBuffer=zz(a,b.Tf,e)));$("#vmap-gtf-export-form-modal").modal("show")})}}
qz.prototype.ja.prototype.VN=function(a){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.submitGtfExportFormModal");$("#vmap-gtf-export-form-modal").modal("hide");var b=!1;null==a.boId&&(console.error("oGTFExportAttibutes.bo_id non d\u00e9fini"),b=!0);null==a.coordsys&&(console.error("oGTFExportAttibutes.coordsys non d\u00e9fini"),b=!0);null==a.format&&(console.error("oGTFExportAttibutes.format non d\u00e9fini"),b=!0);null==a.mails&&(console.error("oGTFExportAttibutes.mails non d\u00e9fini"),
b=!0);null==a.filter&&(console.error("oGTFExportAttibutes.filter non d\u00e9fini"),b=!0);null==B.properties.vmap_export.gtf_api_url&&(console.error("properties.vmap_export.gtf_api_url non d\u00e9fini"),b=!0);null==B.properties.vmap_export.gtf_public_token&&(console.error("properties.vmap_export.gtf_public_token non d\u00e9fini"),b=!0);null==B.properties.vmap_export.gtf_workspace_id&&(console.error("properties.vmap_export.gtf_workspace_id non d\u00e9fini"),b=!0);null==B.properties.vmap_export.gtf_priority_id&&
(console.error("properties.vmap_export.gtf_workspace_id non d\u00e9fini"),b=!0);null==B.properties.vmap_export.gtf_email_option_id&&(console.error("properties.vmap_export.gtf_workspace_id non d\u00e9fini"),b=!0);if(b)return $.notify("Impossible de demander l'export","error"),null;a.vmapServerApi=B.properties.api_url;Bz(this).then(function(b){a.vmapUserToken=b;b=[];for(var c in a)b.push(c+"="+a[c]);A({method:"POST",url:B.properties.vmap_export.gtf_api_url+"/gtf/userorders",headers:{Token:B.properties.vmap_export.gtf_public_token},
data:{workspace_id:B.properties.vmap_export.gtf_workspace_id,priority_id:B.properties.vmap_export.gtf_priority_id,email_option_id:B.properties.vmap_export.gtf_email_option_id,wk_params:b.join("|")},scope:this.b,timeout:5E3,sendToken:!1,success:function(a){if(!n(a.data))return console.error("response['data'] undefined"),$.notify("\u00c9chec lors de l'envoi de la demande","error"),null;if(n(a.data.errorMessage))return bootbox.alert(a.data.errorType+": "+a.data.errorMessage),$.notify("\u00c9chec lors de l'envoi de la demande",
"error"),null;if(null!=a.data.order_id)$.notify("Demande envoy\u00e9e, le r\u00e9sultat sera renvoy\u00e9 par email","success");else return $.notify("\u00c9chec lors de l'envoi de la demande","error"),console.error("Aucune valeur retourn\u00e9e"),null},error:function(){$.notify("\u00c9chec lors de l'envoi de la demande","error")}})})};qz.prototype.ja.prototype.submitGtfExportFormModal=qz.prototype.ja.prototype.VN;
function Bz(a){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.getTokenForGtfExport_");var b=a.va.defer(),c=b.promise;A({method:"POST",url:B.properties.api_url+"/vitis/privatetoken",data:{duration:1440},scope:a.b,timeout:5E3,success:function(a){if(!n(a.data))return console.error("response['data'] undefined"),$.notify("\u00c9chec lors de l'envoi de la demande","error"),null;if(n(a.data.errorMessage))return bootbox.alert(a.data.errorType+": "+a.data.errorMessage),
$.notify("\u00c9chec lors de l'envoi de la demande","error"),null;if(null!=a.data.token)b.resolve(a.data.token);else return console.error("response['token'] undefined"),$.notify("\u00c9chec lors de l'envoi de la demande","error"),null},error:function(){$.notify("\u00c9chec lors de l'envoi de la demande","error")}});return c}
qz.selectTableFormatter=function(a,b){a=b.bo_selection_.have_card_rights;var c=b.bo_selection_.have_update_rights;b=b.bo_selection_.have_delete_rights;var d=20;"true"!==a||B.properties.is_mobile||(d+=20);"true"!==c||B.properties.is_mobile||(d+=20);"true"!==b||B.properties.is_mobile||(d+=20);d=['<div style="width: '+d+'px">','<a class="selection-table-popup" href="javascript:void(0)" title="Popup">','<i class="icon-comment padding-sides-5"></i>',"</a>"];"true"!==a||B.properties.is_mobile||(d.push('<a class="selection-table-card" href="javascript:void(0)" title="Fiche descriptive">'),
d.push('<i class="glyphicon glyphicon-file padding-sides-5"></i>'),d.push("</a>"));"true"!==c||B.properties.is_mobile||(d.push('<a class="selection-table-edit" href="javascript:void(0)" title="Editer">'),d.push('<i class="icon-draw padding-sides-5"></i>'),d.push("</a>"));"true"!==b||B.properties.is_mobile||(d.push('<a class="selection-table-delete" href="javascript:void(0)" title="Supprimer">'),d.push('<i class="icon-trash padding-sides-5"></i>'),d.push("</a>"));d.push("</div>");return d.join("")};
window.selectTableEvents={"click .selection-table-popup":function(a,b,c){var d=angular.element($("#vmap-advancedselect-tool")).scope();d.$evalAsync(function(){d.ctrl.Bp(c.bo_selection_)})},"click .selection-table-card":function(a,b,c){var d=angular.element($("#vmap-advancedselect-tool")).scope();d.$evalAsync(function(){d.ctrl.Ke(c.bo_selection_)})},"click .selection-table-edit":function(a,b,c){var d=angular.element($("#vmap-advancedselect-tool")).scope();d.$evalAsync(function(){d.ctrl.pd(c.bo_selection_)})},
"click .selection-table-delete":function(a,b,c){var d=angular.element($("#vmap-advancedselect-tool")).scope();d.$evalAsync(function(){d.ctrl.Je(c.bo_selection_)})}};qz.prototype.ja.prototype.Ke=function(a){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.displayObjectCard");this.Dc.Ke(a)};qz.prototype.ja.prototype.displayObjectCard=qz.prototype.ja.prototype.Ke;
qz.prototype.ja.prototype.pd=function(a){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.displayEditFrom");this.Dc.pd(a,function(){setTimeout(function(){$("#select-list-modal").modal("show");var b=a.bo_type;B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.sumbitSearchForm");B.Vl("select_search_form_reader_"+b+"_submit_buton")})})};qz.prototype.ja.prototype.displayEditFrom=qz.prototype.ja.prototype.pd;
qz.prototype.ja.prototype.Je=function(a){B.log("nsVmap.nsToolsManager.AdvancedSelect.AdvancedSelectController.deleteObject");var b=this;this.Dc.Je(a,function(){b.Fr(a);$("#select-list-modal").hasClass("in")&&b.Em(b.aSelections)})};qz.prototype.ja.prototype.deleteObject=qz.prototype.ja.prototype.Je;
qz.prototype.ja.prototype.Mj=function(a){B.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.removeSelections");for(var b=this.aSelections.length-1;0<=b;b--)null!=a?this.aSelections[b].bo_type===a&&Ta(this.aSelections,b):Ta(this.aSelections,b)};qz.prototype.ja.prototype.Fr=function(a){for(var b=this.aSelections.length-1;0<=b;b--)angular.equals(this.aSelections[b],a)&&this.aSelections.splice(b,1)};B.module.directive("appAdvancedselect",qz.prototype.TE);
B.module.controller("AppAdvancedselectController",qz.prototype.ja);function Cz(a){Nj.call(this,{handleEvent:Dz,bg:Ig,cg:Ez});a=a?a:{};this.uc=a.source?a.source:null;this.ix=void 0!==a.ek?a.ek:!0;this.cu=void 0!==a.Km?a.Km:!0;this.Ib=a.features?a.features:null;this.oH=[];this.iu={};this.JA={};this.ur={};this.Rv=null;this.je=void 0!==a.pg?a.pg:10;this.NN=Fz.bind(this);this.pb=new ao;this.Ti={Point:this.Rs,LineString:this.fk,LinearRing:this.fk,Polygon:this.Ss,MultiPoint:this.Ps,MultiLineString:this.Os,MultiPolygon:this.Qs,GeometryCollection:this.Ms,Circle:this.Ls}}
F(Cz,Nj);l=Cz.prototype;l.xb=function(a,b){b=void 0!==b?b:!0;var c=I(a),d=a.j();if(d){var e=this.Ti[d.F()];e&&(this.JA[c]=d.V(gg()),e.call(this,a,d))}b&&(this.iu[c]=J(a,"change",this.tj,this))};l.tH=function(a){this.xb(a)};l.uH=function(a){this.Jb(a)};l.hn=function(a){var b;a instanceof wq?b=a.ka:a instanceof me&&(b=a.element);this.xb(b)};l.jn=function(a){var b;a instanceof wq?b=a.ka:a instanceof me&&(b=a.element);this.Jb(b)};
l.tj=function(a){a=a.target;if(this.Yh){var b=I(a);b in this.ur||(this.ur[b]=a)}else this.jE(a)};l.Jb=function(a,b){b=void 0!==b?b:!0;var c=I(a),d=this.JA[c];if(d){var e=this.pb,f=[];eo(e,d,function(b){a===b.ka&&f.push(b)});for(d=f.length-1;0<=d;--d)e.remove(f[d])}b&&(Ld(this.iu[c]),delete this.iu[c])};
l.ib=function(a){var b=this.g(),c=this.oH,d;this.Ib?d=this.Ib:this.uc&&(d=this.uc.Ca());b&&(c.forEach(Ld),c.length=0,d.forEach(this.uH,this));Nj.prototype.ib.call(this,a);a&&(this.Ib?c.push(J(this.Ib,"add",this.hn,this),J(this.Ib,"remove",this.jn,this)):this.uc&&c.push(J(this.uc,"addfeature",this.hn,this),J(this.uc,"removefeature",this.jn,this)),d.forEach(this.tH,this))};l.Uj=Jg;
function Gz(a,b,c,d){var e=d.zc([b[0]-a.je,b[1]+a.je]),f=d.zc([b[0]+a.je,b[1]-a.je]),e=fg([e,f]),g=bo(a.pb,e);a.ix&&!a.cu&&(g=g.filter(function(a){return"Circle"!==a.ka.j().F()}));var h=!1,e=!1,k=f=null;if(0<g.length){a.Rv=c;g.sort(a.NN);var m=g[0].Ha,h="Circle"===g[0].ka.j().F();if(a.ix&&!a.cu){if(c=ij(d,m[0]),h=ij(d,m[1]),c=$f(b,c),b=$f(b,h),h=Math.sqrt(Math.min(c,b)),h=h<=a.je)e=!0,f=c>b?m[1]:m[0],k=ij(d,f)}else a.cu&&(f=h?Wf(c,g[0].ka.j()):Xf(c,m),k=ij(d,f),ag(b,k)<=a.je&&(e=!0,a.ix&&!h&&(c=ij(d,
m[0]),h=ij(d,m[1]),c=$f(k,c),b=$f(k,h),h=Math.sqrt(Math.min(c,b)),h=h<=a.je)))&&(f=c>b?m[1]:m[0],k=ij(d,f));e&&(k=[Math.round(k[0]),Math.round(k[1])])}return{MN:e,ek:f,cP:k}}l.jE=function(a){this.Jb(a,!1);this.xb(a,!1)};l.Ls=function(a,b){b=xi(b).T()[0];var c,d,e,f;c=0;for(d=b.length-1;c<d;++c)e=b.slice(c,c+2),f={ka:a,Ha:e},this.pb.Lb(fg(e),f)};l.Ms=function(a,b){var c=b.Rb;for(b=0;b<c.length;++b){var d=this.Ti[c[b].F()];d&&d.call(this,a,c[b])}};
l.fk=function(a,b){b=b.T();var c,d,e,f;c=0;for(d=b.length-1;c<d;++c)e=b.slice(c,c+2),f={ka:a,Ha:e},this.pb.Lb(fg(e),f)};l.Os=function(a,b){b=b.T();var c,d,e,f,g,h,k;f=0;for(g=b.length;f<g;++f)for(c=b[f],d=0,e=c.length-1;d<e;++d)h=c.slice(d,d+2),k={ka:a,Ha:h},this.pb.Lb(fg(h),k)};l.Ps=function(a,b){var c=b.T(),d,e,f;e=0;for(f=c.length;e<f;++e)d=c[e],d={ka:a,Ha:[d,d]},this.pb.Lb(b.V(),d)};
l.Qs=function(a,b){b=b.T();var c,d,e,f,g,h,k,m,p,t;h=0;for(k=b.length;h<k;++h)for(m=b[h],f=0,g=m.length;f<g;++f)for(c=m[f],d=0,e=c.length-1;d<e;++d)p=c.slice(d,d+2),t={ka:a,Ha:p},this.pb.Lb(fg(p),t)};l.Rs=function(a,b){var c=b.T();a={ka:a,Ha:[c,c]};this.pb.Lb(b.V(),a)};l.Ss=function(a,b){b=b.T();var c,d,e,f,g,h,k;f=0;for(g=b.length;f<g;++f)for(c=b[f],d=0,e=c.length-1;d<e;++d)h=c.slice(d,d+2),k={ka:a,Ha:h},this.pb.Lb(fg(h),k)};
function Dz(a){var b=Gz(this,a.Sc,a.Qb,a.map);b.MN&&(a.Qb=b.ek.slice(0,2),a.Sc=b.cP);return Oj.call(this,a)}function Ez(){var a=Id(this.ur);a.length&&(a.forEach(this.jE,this),this.ur={});return!1}function Fz(a,b){return bg(this.Rv,a.Ha)-bg(this.Rv,b.Ha)};function R(){new qz;new Yy}qa("nsVmap.nsToolsManager.Select",R);R.prototype.ri=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.ri(a)};R.prototype.gq=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.gq(a,b)};R.prototype.Lp=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.Lp(a)};R.prototype.Ke=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.Ke(a)};R.prototype.displayObjectCard=R.prototype.Ke;
R.prototype.pd=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.pd(a,b)};R.prototype.displayEditFrom=R.prototype.pd;l=R.prototype;l.Rn=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.Rn(a)};l.Sf=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.Sf(a)};l.$m=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.$m(a,b)};l.fq=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.fq(a,b)};
l.Yp=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.Yp(a,b)};l.ws=function(a,b,c,d){return angular.element($("#vmap-select-tool")).scope().ctrl.ws(a,b,c,d)};l.Xp=function(a,b,c,d){return angular.element($("#vmap-select-tool")).scope().ctrl.Xp(a,b,c,d)};l.Vm=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.Vm(a)};l.hq=function(){return angular.element($("#vmap-basicselect-tool")).scope().ctrl.sSelectedBo};R.prototype.getSelectedBo=R.prototype.hq;
R.prototype.Je=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.Je(a,b)};R.prototype.deleteObject=R.prototype.Je;R.prototype.Bm=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.Bm(a,b)};R.prototype.deleteMultipleObjects=R.prototype.Bm;R.prototype.Fe=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.Fe(a,b)};R.prototype.addToCard=R.prototype.Fe;R.prototype.Qg=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.Qg(a)};
R.prototype.editFeature=R.prototype.Qg;R.prototype.xl=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.xl(a,b)};R.prototype.parseFormTile=R.prototype.xl;R.prototype.bN=function(){B.log("nsVmap.nsToolsManager.Select.prototype.selectDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppSelectController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/tools/select.html"}};
R.prototype.ma=function(a,b,c,d,e){B.log("nsVmap.nsToolsManager.Select.prototype.selectController");var f=this;this.b=a;this.$timeout_=b;this.va=c;this.md=c.defer();this.gk=e;this.properties=B.properties;this.token=B.properties.token;this.addPartGeomType="";this.isMinScaleOk=this.isMaxScaleOk=!0;this.isSnapMenuCollapse=!1;this.snapOptions={mode:"segment_edge_node",tolerance:15,limit:2E3,visible:!1};null!=B.properties.snapping&&(this.snapOptions.tolerance=B.properties.snapping.defaut_tolerance,this.snapOptions.mode=
B.properties.snapping.defaut_snapp_mode,this.snapOptions.limit=B.properties.snapping.defaut_limit,this.snapOptions.visible=B.properties.snapping.defaut_visibility);this.tmpSnapOptions=angular.copy(this.snapOptions);this.kv=B.properties.selection.limit_popup;this.dB=B.properties.selection.limit_list;this.sc=Gq(B.g(),{style:new Tp({fill:new Sp({color:"rgba(255, 255, 255, 0.6)"}),stroke:new Tn({color:"#319FD3",width:2}),kb:new Rp({cb:7,fill:new Sp({color:"#319FD3"})})})});this.fc=this.sc.s().Hb;this.Ve=
Gq(B.g(),{style:new Tp({fill:new Sp({color:"rgba(0, 0, 0, 0.2)"})})});this.Gd=new yq({map:B.g().B,visible:!1,source:new rq({re:!1}),style:new Tp({fill:new Sp({color:"rgba(255, 255, 255, 0.2)"}),stroke:new Tn({color:"#1000ff",width:2}),kb:new Rp({cb:3,fill:new Sp({color:"#1000ff"})})})});this.Od=new Cz({ek:!0,Km:"segment_edge_node"===this.snapOptions.mode?!0:!1,pg:this.snapOptions.tolerance,source:this.Gd.s()});this.Fd=new ot({features:this.fc});this.Fd.on("modifyend",function(){setTimeout(function(){Hz(f,
f.fc.P())})});this.Vc=new Oy({vb:[this.sc]});this.Vc.on("select",function(){for(var a=this.Vc.Ca().P(),b=0;b<a.length;b++)this.sc.s().Jb(a[b]);this.Vc.Ca().clear();setTimeout(function(){Hz(f,f.fc.P())})},this);this.Og=new Oy({vb:[this.Ve]});this.Og.on("select",this.Qt,this);B.scope.$on("toggleOutTools",function(){f.Ck();f.md.resolve()});r(oUrlParams.bo_id)&&r(oUrlParams.ids)&&0<oUrlParams.bo_id.length&&0<oUrlParams.ids.length&&setTimeout(function(){var a=B.oa.Xg();if(null!=a[oUrlParams.bo_id]){for(var b=
[],c=oUrlParams.ids.split("|"),d=0;d<c.length;d++)b.push({bo_type:oUrlParams.bo_id,bo_id_value:c[d],bo_id_field:a[oUrlParams.bo_id].bo_id_field,bo_title:a[oUrlParams.bo_id].bo_title});0<b.length&&f.Fe(b,!0)}});B.g().B.on("moveend",function(){f.He();f.fi()});B.scope.$on("layersChanged",function(){f.He();Iz(f)});B.scope.$on("selectedBoChanged",function(){f.He();Iz(f)});setTimeout(function(){Iz(f)});if(B.properties.is_mobile)d.find(".modal").on("shown.bs.modal",function(){$(".modal-backdrop.fade.in").hide();
$(".modal.fade.in").find(".modal-dialog").addClass("mobile-full-modal")});this.Cq=!1;this.Fd.on("modifyend",function(){f.Cq=!1;f.He()});this.Fd.on("modifystart",function(){f.Cq=!0})};R.prototype.selectController=R.prototype.ma;R.prototype.ma.$inject=["$scope","$timeout","$q","$element","$translate"];
function Iz(a){B.log("nsVmap.nsToolsManager.Select.selectController.loadQueryableBos");a.b.$applyAsync(function(){setTimeout(function(){a.aQueryableBOs=B.oa.Au(!0);for(var b=0;b<a.aQueryableBOs.length;b++)a.aQueryableBOs[b].loadCanceller=a.va.defer(),a.aQueryableBOs[b].isMouseOverSnaoMenuOb=!1,a.aQueryableBOs[b].bo_snapping_loaded=null,a.aQueryableBOs[b].bo_id===B.D.ub.ql.hq()?a.aQueryableBOs[b].bo_snapping_enabled=!0:a.aQueryableBOs[b].bo_snapping_enabled=!1;null!=a.aQueryableBOs&&B.properties.is_mobile&&
(0<a.aQueryableBOs.length?$("#vmap_menu_mobile_menu_requeteur_button").show():$("#vmap_menu_mobile_menu_requeteur_button").hide(),angular.element("#select-bo-select")[0].style.width="23vw")})})}l=R.prototype.ma.prototype;
l.He=function(){B.log("nsVmap.nsToolsManager.Select.selectController.checkEditionScale");if(null!=this.aQueryableBOs){for(var a,b=0;b<this.aQueryableBOs.length;b++)if(this.aQueryableBOs[b].bo_id===B.D.ub.ql.hq()){a=this.aQueryableBOs[b];break}null!=a&&(b=a.bo_max_edition_scale,a=a.bo_min_edition_scale,"basicTools-select-editFeature"===this.currentAction&&(null!=a&&(a=parseFloat(a),B.g().Za()<a&&!this.Cq?(B.g().za.Ja("\u00c9chelle minimale de saisie atteinte, d\u00e9-zoomez pour continuer l'\u00e9dition"),
this.isMinScaleOk=!1,this.Fd.setActive(!1)):this.isMinScaleOk=!0),null!=b&&(b=parseFloat(b),B.g().Za()>b&&!this.Cq?(B.g().za.Ja("\u00c9chelle maximale de saisie atteinte, zoomez pour continuer l'\u00e9dition"),this.isMaxScaleOk=!1,this.Fd.setActive(!1)):this.isMaxScaleOk=!0),this.isMinScaleOk&&this.isMaxScaleOk&&(jj(this.Fd)||this.Fd.setActive(!0),jj(this.Fd)&&B.g().za.Ja("Cliquez sur la g\u00e9om\u00e9trie pour la modifier"))))}};
l.ri=function(a){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.queryByEWKTGeom");var b=this;if(null!=a)if(null!=a.As)if(null!=a.Fh)if(null!=a.Tf)if(null!=a.zt)if(null!=a.Bb){var c=!a.As,d=!0===a.As?"list":"summary",e=E(this.map).J().Z.substring(5),f=B.xf(a.Fh).F(),f=this.gq(a.buffer,f);A({method:"POST",url:B.properties.api_url+"/vmap/querys/"+a.Tf+"/"+d,headers:{"X-HTTP-Method-Override":"GET",Accept:"application/x-vm-json"},data:{filter:a.SM,intersect_geom:a.Fh,intersect_buffer:f,
get_geom:c,get_image:c,result_srid:e,limit:!0===a.As?this.dB:this.kv,d:Date.now()},scope:this.b,abord:a.zt.promise,success:function(c){if(1===a.zt.promise.$$state.status)return 0;var d=[];null!=c.data?null!=c.data.data?d=c.data.data:B.log("Pas de donn\u00e9es \u00e0 afficher"):B.log("Pas de donn\u00e9es \u00e0 afficher");d.length===b.dB&&$.notify("Limite d'objets \u00e0 afficher atteinte","warn");a.Bb.call(this,d)}})}else console.error("opt_options.callback not defined");else console.error("opt_options.canceler not defined");
else console.error("opt_options.bo_id not defined");else console.error("opt_options.EWKTGeometry not defined");else console.error("opt_options.useTableFormat not defined")};l.gq=function(a,b){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.getRealScaleBuffer");if(null==a||null==b)return null;var c=null;"Point"!==b&&"MultiPoint"!==b||null==a||(b=B.g().Za(),c=a*b/1E3);return c};
l.Lp=function(a){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.extractFeatureFromData");a=B.xf(a.bo_intersect_geom);return new vd({geometry:a})};l.Rk=function(){return angular.element($("#select_edit_form_reader").children()).scope()};
l.Ke=function(a){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.displayObjectCard");if(0===a.bo_title.length)return 0;this.editSelection=a;this.Yp([a],function(b){a=b[0];var c=a.bo_json_form,d={update:kb(a.bo_form),display:kb(a.bo_form)};B.log("oFormValues: ",d);B.log("oFormDefinition: ",c);var e=angular.element($("#select_display_form_reader").children()).scope();e.$evalAsync(function(){function b(){e.ctrl.setDefinitionName("display");e.ctrl.setFormValues(d);e.ctrl.setFormDefinition(c);
e.$applyAsync(function(){e.ctrl.loadForm();$("#select-card-modal").modal("show")})}try{n(destructor_form)&&destructor_form()}catch(h){B.log("destructor_form does not exist")}if(null!=a.bo_json_form_js){var g=a.bo_json_form_js;B.log("initHtmlForm : javascript assoc. to : "+g);ad([g],{callback:function(){b();try{n(constructor_form)&&constructor_form(e,g)}catch(h){B.log("constructor_form does not exist")}},async:!0,scriptInBody:!0})}else b()})})};R.prototype.ma.prototype.displayObjectCard=R.prototype.ma.prototype.Ke;
R.prototype.ma.prototype.pd=function(a,b){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.displayEditFrom");var c=this;if(0===a.bo_title.length)return 0;this.editSelection=a;c.$m([a],function(d){c.Yp(d,function(d){a=d[0];var e=a.bo_json_form,g={update:kb(a.bo_form),display:kb(a.bo_form)};d={fields:[{type:"button","class":"btn-ungroup btn-group-sm",nb_cols:12,buttons:[{visibleAllTabs:!0,type:"submit",label:"FORM_UPDATE",name:"form_submit","class":"btn-primary hidden",id:"basictools-select-form-reader-submit-btn"}]}]};
angular.equals(e.update.rows[e.update.rows.length-1],d)||e.update.rows.push(d);e.update.event=function(d){$("#select_edit_form_reader").find("button").attr("disabled",!0);ed();var f=[a.bo_id_field];null!=c.editableSelection&&null!=c.editableSelection.geom_column&&f.push(c.editableSelection.geom_column);var g=c.Xp(d,e,"update",f);a.bo_form=g;c.ws(a.bo_type,g,function(){$("#select-edit-modal").modal("hide");$("#select_edit_form_reader").find("button").attr("disabled",!1);c.Ck();null!=b&&b.call(this,
g)},function(){$("#select-edit-modal").modal("hide");$("#select_edit_form_reader").find("button").attr("disabled",!1);c.Ck();null!=b&&b.call(this,g)})};var h=c.Rk();h.$evalAsync(function(){function b(){h.ctrl.setDefinitionName("update");h.ctrl.setFormValues(g);h.ctrl.setFormDefinition(e);h.$applyAsync(function(){h.ctrl.loadForm();$("#select-edit-modal").modal("show")})}try{n(destructor_form)&&destructor_form()}catch(p){B.log("destructor_form does not exist")}if(null!=a.bo_json_form_js){var c=a.bo_json_form_js;
B.log("initHtmlForm : javascript assoc. to : "+c);ad([c],{callback:function(){b();try{n(constructor_form)&&constructor_form(h,c)}catch(p){B.log("constructor_form does not exist")}},async:!0,scriptInBody:!0})}else b()})})})};R.prototype.ma.prototype.displayEditFrom=R.prototype.ma.prototype.pd;l=R.prototype.ma.prototype;l.$m=function(a,b){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.getSummaryInfos");Jz(this,{Ui:a,dataType:"summary",Bb:b})};
l.fq=function(a,b){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.getListInfos");Jz(this,{Ui:a,dataType:"list",Bb:b})};l.Yp=function(a,b){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.getFormInfos");Jz(this,{Ui:a,dataType:"form",Bb:b})};
function Jz(a,b){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.complementDataOnSelection");var c=n(b.Ui)?b.Ui:[],d=n(b.dataType)?b.dataType:null,e=n(b.rp)?b.rp:{};b=n(b.Bb)?b.Bb:function(){return 0};for(var f=[],g=0;g<c.length;g++)$a(f,c[g].bo_type);a.Jd=ea(a.Jd)?a.Jd:0;a.Jd+=f.length;0<f.length&&ed();for(var h=[],g=0;g<f.length;g++){Pa(h);for(var k=0;k<c.length;k++)c[k].bo_type===f[g]&&h.push(c[k]);Kz(a,{Ui:Wa(h),Py:f[g],dataType:d,rp:e,Bb:b})}}
function Kz(a,b){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.complementDataOnSelection2_");for(var c=n(b.Ui)?b.Ui:[],d=n(b.dataType)?b.dataType:null,e=n(b.rp)?b.rp:{},f=n(b.Bb)?b.Bb:function(){return 0},g={relation:"OR",operators:[]},h=0;h<c.length;h++)n(c[h]["bo_"+d])||g.operators.push({column:c[h].bo_id_field.replace(/\./g,'"."'),compare_operator:"=",value:c[h].bo_id_value});h=E(a.map).J().Z.substring(5);n(b.Py)?(b=B.properties.api_url+"/vmap/querys/"+b.Py+"/"+d,h={result_srid:h,
limit:200},"summary"===d&&(h.get_geom=!0,h.get_image=!0),mb(h,e),0<g.operators.length?(h.filter=JSON.stringify(g),A({method:"POST",url:b,headers:{"X-HTTP-Method-Override":"GET",Accept:"application/x-vm-json"},data:h,scope:a.b,success:function(b){var e=[];a.Jd--;0===a.Jd&&($("body").css({cursor:""}),fd());n(b.data)&&n(b.data.errorMessage)&&bootbox.alert(b.data.errorMessage);n(b.data.data)?e=b.data.data:B.log("Pas de donn\u00e9es \u00e0 afficher");199<e.length&&bootbox.alert("<h4>Attention, vous avez atteint la limite d'objects affichables sur la carte</h4>");
a.Sf({data:e,selection:c,dataType:d,Bb:f})},error:function(){a.Jd--;0===a.Jd&&($("body").css({cursor:""}),fd(),f.call(this,c))}})):(a.Jd--,0===a.Jd&&($("body").css({cursor:""}),fd(),f.call(a,c)))):console.error("opt_options.bo_type not defined")}
l.Sf=function(a){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.addQueryResult");var b=n(a.data)?a.data:[],c=n(a.selection)?a.selection:[];a=n(a.Bb)?a.Bb:function(){return 0};for(var d=[],e=0;e<b.length;e++)d.push(b[e]),n(b[e].bo_intersect_geom)&&(d[e].olFeature=this.Lp(b[e]));Ra(c,d);c=this.Rn(c);a.call(this,c)};
l.Rn=function(a){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.removeDuplicateSelections");for(var b=[],c=0;c<a.length;c++){Pa(b);for(var d=c+1;d<a.length;d++)if(a[c].bo_id_field==a[d].bo_id_field&&a[c].bo_type==a[d].bo_type&&a[c].bo_id_value==a[d].bo_id_value){b.push(d);!0===a[d].locked&&(a[c].locked=!0);for(var e="olFeature mapPopup bo_image_path bo_summary bo_summary_attributs bo_list bo_list_attributs bo_form bo_form_attributs bo_json_form bo_json_form_js bo_json_form_css".split(" "),
f=0;f<e.length;f++)n(a[d][e[f]])&&!n(a[c][e[f]])&&(a[c][e[f]]=a[d][e[f]]),n(a[c][e[f]])&&!n(a[d][e[f]])&&(a[d][e[f]]=a[c][e[f]])}for(d=0;d<b.length;d++)Ta(a,b[d])}return a};
l.ws=function(a,b,c,d){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.updateBOValues");if(!n(a))return 0;b=n(b)?b:{};c=n(c)?c:angular.noop;d=n(d)?d:angular.noop;b=this.Vm(b);var e=this.map.getLayers().P();A({method:"PUT",url:B.properties.api_url+"/vmap/querys/"+a,headers:{Accept:"application/x-vm-json"},data:b,scope:this.b,success:function(b){if(!n(b.data))return console.error("Aucune valeur retourn\u00e9e"),d.call(),0;if(n(b.data.errorMessage))return console.error(b.data.errorMessage),
d.call(),0;for(b=0;b<e.length;b++){var f=fe(e[b]).business_objects;if(q(f))for(var h=0;h<f.length;h++)f[h].business_object_id===a&&e[b].ud()}$.notify("Op\u00e9ration r\u00e9alis\u00e9e avec succ\u00e8s, les couches de la carte se mettent \u00e0 jour","info");c.call()}})};
l.Xp=function(a,b,c,d){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.getFormData");if(null==a)return console.error("oFormValues is undefined or null"),null;if(null==b)return console.error("oFormDefinition is undefined or null"),null;if(null==c)return console.error("sFormDefinitionName is undefined or null"),null;null!=d||(d=[]);var e=angular.element(v.f).injector().get(["envSrvc"]),f=angular.element(v.f).injector().get(["formSrvc"]);e.oFormValues=a;e.oFormDefinition=b;e.sFormDefinitionName=
c;b=f.getFormData(c,!0);for(e=0;e<d.length;e++)null!=a[c][d[e]]&&(b[d[e]]=a[c][d[e]]);return b};l.Vm=function(a){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.getFormDataFromValues");var b=new FormData,c;for(c in a)null!=a[c].aFiles?(b.append(c+"_attached_content",a[c].aFiles[0]),b.append(c,a[c].aFiles[0].name)):b.append(c,a[c]);return b};
l.Je=function(a,b){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.deleteObject");var c=this;bootbox.confirm("<h4>Supprimer d\u00e9finitivement cet objet de la base de donn\u00e9es ?</h4>",function(d){!0===d&&Lz(c,a,b)})};R.prototype.ma.prototype.deleteObject=R.prototype.ma.prototype.Je;
R.prototype.ma.prototype.Bm=function(a,b){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.deleteMultipleObjects");var c=this;bootbox.confirm("<h4>Supprimer d\u00e9finitivement ces objets de la base de donn\u00e9es ?</h4>",function(d){if(!0===d)for(d=0;d<a.length;d++)Lz(c,a[d],b)})};R.prototype.ma.prototype.deleteMultipleObjects=R.prototype.ma.prototype.Bm;
function Lz(a,b,c){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.submitDeleteObject");var d=b.bo_type;b=b.bo_id_value;var e=a.map.getLayers().P();A({method:"DELETE",url:B.properties.api_url+"/vmap/querys/"+d,headers:{Accept:"application/x-vm-json"},params:{idList:b},scope:a.b,success:function(){for(var a=0;a<e.length;a++){var b=fe(e[a]).business_objects;if(q(b))for(var h=0;h<b.length;h++)b[h].business_object_id===d&&e[a].ud()}$.notify("Op\u00e9ration r\u00e9alis\u00e9e avec succ\u00e8s, les couches de la carte se mettent \u00e0 jour",
"info");c.call()},error:function(){}})}
R.prototype.ma.prototype.Fe=function(a,b){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.addToCard");b&&B.D.R.removeAll();var c=this;setTimeout(function(){c.$m(a,function(a){c.fq(a,function(a){if(!n(a)||0>=a.length)return console.error("aSelection empty or inexistent"),0;for(var b=[],c=a[0].bo_type,d=a[0].bo_title,e={xe:["selection","state"]},m=0;m<a.length;m++)null!=a[m].bo_list?null!=a[m].olFeature?(b.push(a[m].bo_list),b[m].feature=a[m].olFeature,null==b[m][a[m].bo_id_field]&&
(b[m][a[m].bo_id_field]=a[m].bo_id_value,e.xe.push(a[m].bo_id_field))):console.error("Selection[i]['olFeature'] undefined"):console.error("Selection[i]['bo_list'] undefined");void 0===B.D.R.Va(c)&&B.D.R.jb({Ta:c,wb:d,Na:["zoom","delete"]});a={Ta:c};e.data=b;B.D.R.mt(a,e);$("#select-list-modal").modal("hide");B.D.R.ef();B.D.R.uf(c);setTimeout(function(){B.D.R.nm(c)},500)})})})};R.prototype.ma.prototype.addToCard=R.prototype.ma.prototype.Fe;
R.prototype.ma.prototype.xl=function(a,b){if(!r(a)||!ha(b))return a;var c;-1!==a.search("{{")&&-1!==a.search("}}")&&(c=a.substr(a.search("{{")+2,a.search("}}")-a.search("{{")-2),null!=b[c]&&(a=a.replace("{{"+c+"}}",b[c])));-1!==a.search("{{")&&-1!==a.search("}}")&&this.xl(a,b);return a=$("<div/>").html(B.$sanitize(a)).text()};R.prototype.ma.prototype.parseFormTile=R.prototype.ma.prototype.xl;
R.prototype.ma.prototype.dH=function(a){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.editFormFeature");$("#select-edit-modal").modal("hide");angular.element($("#vmap-basicselect-tool")).scope().ctrl.Gr();$("#select-list-modal").modal("hide");this.Qg(a,!0)};R.prototype.ma.prototype.editFormFeature=R.prototype.ma.prototype.dH;
R.prototype.ma.prototype.Qg=function(a,b){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.editFeature");var c=this,d=B.oa.Xg();if(null==a.bo_type)return console.error("selection['bo_type'] not defined"),0;if(null==d[a.bo_type])return console.error("oBusinessObjects[selection['bo_type']] not defined"),0;if(null==d[a.bo_type].bo_geom_type)return console.error("oBusinessObjects[selection['bo_type']]['bo_geom_type'] not defined"),0;this.editableSelection=a;this.editableFeatureType=d[a.bo_type].bo_geom_type;
if("GEOMETRYCOLLECTION"===this.editableFeatureType)this.addPartGeomType="";else if("POLYGON"===this.editableFeatureType||"MULTIPOLYGON"===this.editableFeatureType)this.addPartGeomType="Polygon";else if("LINESTRING"===this.editableFeatureType||"MULTILINESTRING"===this.editableFeatureType)this.addPartGeomType="LineString";else if("POINT"===this.editableFeatureType||"MULTIPOINT"===this.editableFeatureType)this.addPartGeomType="Point";this.editGeometryFromForm=b?!0:!1;B.properties.is_mobile?B.g().GD(c.editableSelection.olFeature,
function(a){setTimeout(function(){c.editableSelection.olFeature=a;c.JD()})}):($("#basictools-select-modify-palette").show(),setTimeout(function(){null!=c.editableSelection.olFeature&&Mz(c);setTimeout(function(){0<c.sc.s().Hb.cc()&&c.FD("editFeature","basicTools-select-editFeature"===c.currentAction)},100)},500))};R.prototype.ma.prototype.editFeature=R.prototype.ma.prototype.Qg;
R.prototype.ma.prototype.FD=function(a,b){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.startEdition");var c=this;this.Uy();if(!0===b)return 0;if("insert"===a.substr(0,6))B.g().za.Ja("Cliquez pour commencer \u00e0 dessiner"),this.zw(a.substr(6));else if("editFeature"===a)B.g().za.Ja("Cliquez sur la g\u00e9om\u00e9trie pour la modifier"),Dq(B.g(),this.Fd,"basicTools-select-"+a),c.fi();else if("deleteFeature"===a)B.g().za.Ja("Cliquez sur la g\u00e9om\u00e9trie pour la supprimer"),Dq(B.g(),
this.Vc,"basicTools-select-"+a);else if("addHole"===a){B.g().za.Ja("Dessinez un polygone \u00e0 l'int\u00e9rieur d'un autre pour cr\u00e9er un trou");this.yb=B.g().sh({type:"Polygon"},"basicTools-select-"+a);var d=Wa(this.fc.P());this.yb.on("drawend",function(a){a=a.ka;for(var b=ui(a.j()),e=!1,h=0;h<d.length;h++)Gt(d[h].j(),a.j())&&(ri(d[h].j(),b),e=!0);e?setTimeout(function(){Hz(c,c.fc.P())}):bootbox.alert("<h4>Trou non valide: il doit \u00eatre contenu dans un polygone dessin\u00e9</h4>")},this)}else if("deleteHole"===
a)B.g().za.Ja("Cliquez dans un trou pour le supprimer"),this.kt(),Dq(B.g(),this.Og,"basicTools-select-"+a);else return console.error("startEdition: type ("+a+") not allowed"),0};R.prototype.ma.prototype.startEdition=R.prototype.ma.prototype.FD;R.prototype.ma.prototype.Uy=function(){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.cancelEdition");B.g().Ce();B.g().za.hide();this.Ve.s().clear()};R.prototype.ma.prototype.cancelEdition=R.prototype.ma.prototype.Uy;
R.prototype.ma.prototype.kt=function(){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.addHolesIntoHolesLayer");var a=this.fc.P();this.Ve.s().clear();for(var b=0;b<a.length;b++){var c=vi(a[b].j());if(1<c.length)for(var d=1;d<c.length;d++){var e=new qi;e.zb([c[d].T()]);this.Ve.s().xb(new vd({geometry:e}))}}};
R.prototype.ma.prototype.Qt=function(){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.deleteHole");var a=this,b=this.Og.Ca().P();if(0<b.length){for(var c=0;c<b.length;c++){for(var d=b[c].j(),e=!1,f=this.fc.P(),g=0;g<f.length;g++){for(var h=f[g].j().T(),k=h.length-1;0<=k;k--)angular.equals(d.T()[0],h[k])&&(h.splice(k,1),e=!0);f[g].j().zb(h)}e&&this.Ve.s().Jb(b[c])}this.Og.Ca().clear();setTimeout(function(){Hz(a,a.fc.P())})}};
R.prototype.ma.prototype.zw=function(a){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.startDrawing");var b=this;this.yb=B.g().sh({type:a,features:this.fc},"basicTools-select-insert"+a);this.yb.on("drawend",function(c){var d=c.ka;setTimeout(function(){if("Circle"===a){var c=d.j(),c=new xi(c);b.sc.s().Jb(d);d=new vd({geometry:c});b.sc.s().xb(d)}Hz(b,b.fc.P())})},this)};
function Hz(a,b){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.putFeaturesOnTheElement");if(null==b)console.error("aFeatures undefined");else if(q(b))if("MULTI"!==a.editableFeatureType.substr(0,5)&&"GEOMETRYCOLLECTION"!==a.editableFeatureType){a.editableSelection.olFeature=b[b.length-1];for(var c=0;c<b.length-1;c++)a.sc.s().Jb(b[c])}else{if("MULTIPOLYGON"===a.editableFeatureType){for(var d=new od,e=[],c=0;c<b.length;c++)"Polygon"===b[c].j().F()&&e.push(b[c].j().T());d.zb(e);a.editableSelection.olFeature=
new vd({geometry:d})}if("MULTILINESTRING"===a.editableFeatureType){d=new nd;e=[];for(c=0;c<b.length;c++)"LineString"===b[c].j().F()&&e.push(b[c].j().T());d.zb(e);a.editableSelection.olFeature=new vd({geometry:d})}if("MULTIPOINT"===a.editableFeatureType){d=new md;e=[];for(c=0;c<b.length;c++)"Point"===b[c].j().F()&&e.push(b[c].j().T());d.zb(e);a.editableSelection.olFeature=new vd({geometry:d})}}else console.error("aFeatures is not an array")}
function Mz(a){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.putElementFeatureOnOverlay");if(null==a.editableSelection.olFeature)console.error("this['editableSelection']['olFeature'] not defined");else if(null==a.editableSelection.olFeature.j())console.error("this['editableSelection']['olFeature'].getGeometry() not defined");else if("MULTI"!==a.editableFeatureType.substr(0,5)&&"GEOMETRYCOLLECTION"!==a.editableFeatureType)a.sc.s().clear,a.sc.s().xb(a.editableSelection.olFeature);else{var b=
[],c=[];"MULTIPOINT"===a.editableFeatureType&&(c=Wa(a.editableSelection.olFeature.j().pj()));"MULTILINESTRING"===a.editableFeatureType&&(c=Wa(pd(a.editableSelection.olFeature.j())));"MULTIPOLYGON"===a.editableFeatureType&&(c=Wa(qd(a.editableSelection.olFeature.j())));for(var d=0;d<c.length;d++)b.push(new vd({geometry:c[d]}));a.sc.s().clear;a.sc.s().Rf(b)}}
R.prototype.ma.prototype.JD=function(){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.submitGeomEdition");var a={};a[this.editableSelection.bo_id_field]=this.editableSelection.bo_id_value;a[this.editableSelection.geom_column]=null!=this.editableSelection.olFeature?B.Oe(this.editableSelection.olFeature.j()):"";this.ws(this.editableSelection.bo_type,a,function(){B.D.ub.Nf()},function(){B.D.ub.Nf()})};R.prototype.ma.prototype.submitGeomEdition=R.prototype.ma.prototype.JD;
R.prototype.ma.prototype.aP=function(){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.validateGeomAndDisplayEditForm");var a=this,b=this.Rk();b.$evalAsync(function(){null!=a.editableSelection.olFeature?null!=a.editableSelection.olFeature.j()?b.oFormValues.update[a.editableSelection.geom_column]=B.Oe(a.editableSelection.olFeature.j()):b.oFormValues.update[a.editableSelection.geom_column]="":b.oFormValues.update[a.editableSelection.geom_column]="";$("#basictools-select-modify-palette").hide();
B.g().El();$("#select-edit-modal").modal("show");a.Ck()})};R.prototype.ma.prototype.validateGeomAndDisplayEditForm=R.prototype.ma.prototype.aP;R.prototype.ma.prototype.Ck=function(){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.clearOverlays");0<this.sc.s().Hb.cc()&&this.sc.s().clear();0<this.Ve.s().Hb.cc()&&this.Ve.s().clear();this.Gd.s().clear();B.g().B.hd(this.Od)};R.prototype.ma.prototype.clearOverlays=R.prototype.ma.prototype.Ck;
R.prototype.ma.prototype.rH=function(){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.finishEdition");this.Gd.s().clear();B.g().B.hd(this.Od);this.Ck();B.g().za.hide();B.D.ub.Nf()};R.prototype.ma.prototype.finishEdition=R.prototype.ma.prototype.rH;R.prototype.ma.prototype.xw=function(){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.showSnappingOptionsModal");this.tmpSnapOptions=angular.copy(this.snapOptions);$("#vmap-select-snap-options-modal").modal("show")};
R.prototype.ma.prototype.showSnappingOptionsModal=R.prototype.ma.prototype.xw;R.prototype.ma.prototype.qo=function(){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.submitSnappingOptionsModal");this.snapOptions=angular.copy(this.tmpSnapOptions);B.g().B.hd(this.Od);this.Od=new Cz({ek:!0,Km:"segment_edge_node"===this.snapOptions.mode?!0:!1,pg:this.snapOptions.tolerance,source:this.Gd.s()});B.g().B.Ob(this.Od);$("#vmap-select-snap-options-modal").modal("hide");this.fi()};
R.prototype.ma.prototype.submitSnappingOptionsModal=R.prototype.ma.prototype.qo;
R.prototype.ma.prototype.mw=function(){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.resetSnapOptions");null!=B.properties.snapping&&(this.tmpSnapOptions.tolerance=B.properties.snapping.defaut_tolerance,this.tmpSnapOptions.mode=B.properties.snapping.defaut_snapp_mode,this.tmpSnapOptions.limit=B.properties.snapping.defaut_limit,this.tmpSnapOptions.visible=B.properties.snapping.defaut_visibility);this.qo()};R.prototype.ma.prototype.resetSnapOptions=R.prototype.ma.prototype.mw;
R.prototype.ma.prototype.fi=function(){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.loadVectorSnappingData");var a=this,b=null;a.Gd.setVisible(a.snapOptions.visible);a.Gd.s().clear();a.He();B.g().B.hd(a.Od);setTimeout(function(){if("basicTools-select-editFeature"===a.currentAction&&a.isMaxScaleOk&&a.isMinScaleOk){for(var c=0;c<a.aQueryableBOs.length;c++)b=a.aQueryableBOs[c],a.Bw(b),a.lv(b);for(c=0;c<b.length;c++)null===b[c].bo_snapping_loaded&&(b[c].bo_snapping_enabled=
!1);B.g().B.Ob(a.Od)}})};R.prototype.ma.prototype.loadVectorSnappingData=R.prototype.ma.prototype.fi;
R.prototype.ma.prototype.lv=function(a){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.loadBoVectorSnappingData");var b=this,c=a.bo_id,d=[],e=null,f=Ei(E(B.g().B),B.g().B.$a()),f=new wi(f);!0===a.bo_snapping_enabled&&(a.bo_snapping_loaded=!1,A({method:"POST",url:B.properties.api_url+"/vmap/querys/"+c+"/geometry",headers:{"X-HTTP-Method-Override":"GET",Accept:"application/x-vm-json"},data:{intersect_geom:B.Oe(f),snapping_limit:b.snapOptions.snappingObjectsLimit,snapping_mode:b.snapOptions.mode},
ajaxLoader:!1,abord:a.loadCanceller.promise,scope:this.b,success:function(c){if(null==c.data)return a.bo_snapping_loaded=null,0;if(null!=c.data.errorMessage)return console.error(c.data.errorMessage),a.bo_snapping_loaded=null,0;if(c.data[0].count>b.snapOptions.snappingObjectsLimit)return a.bo_snapping_loaded=null,$.notify("Limit de points atteinte pour object "+a.bo_title,"warn"),0;a.bo_snapping_loaded=!0;for(var f=0;f<c.data.length;f++)null!=c.data[f].geom&&(e=c.data[f].geom,d.push(new vd({geometry:B.xf(e)})));
b.Gd.s().Rf(d)},error:function(){a.bo_snapping_loaded=null}}))};R.prototype.ma.prototype.Bw=function(a){B.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.stopLoadingBoVectorSnappingData");null!=a.loadCanceller&&(a.loadCanceller.resolve(),a.loadCanceller=this.va.defer(),a.bo_snapping_loaded=null)};B.module.directive("appSelect",R.prototype.bN);B.module.controller("AppSelectController",R.prototype.ma);function Nz(){B.log("nsVmap.nsToolsManager.Insert")}qa("nsVmap.nsToolsManager.Insert",Nz);Nz.prototype.NJ=function(){B.log("nsVmap.nsToolsManager.Insert.prototype.inserttoolDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppInsertController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/tools/"+(B.properties.is_mobile?"insert_mobile.html":"insert.html")}};
Nz.prototype.Ga=function(a,b,c,d){B.log("nsVmap.nsToolsManager.Insert.prototype.inserttoolController");a.vmapScope=B.scope;var e=this;this.b=a;this.G=b;this.va=c;this.md=c.defer();this.pw=E(this.map).J().Z;new Ur({Pc:this.pw});this.sc=Gq(B.g());this.fc=this.sc.s().Hb;this.Ve=Gq(B.g(),{style:new Tp({fill:new Sp({color:"rgba(0, 0, 0, 0)"})})});this.Fd=new ot({features:this.fc});this.Vc=new Oy({vb:[this.sc]});this.properties=B.properties;this.token=B.properties.token;this.addPartGeomType="";this.isSnapMenuCollapse=
!1;this.snapOptions={mode:"segment_edge_node",tolerance:15,limit:2E3,visible:!1};null!=B.properties.snapping&&(this.snapOptions.tolerance=B.properties.snapping.defaut_tolerance,this.snapOptions.mode=B.properties.snapping.defaut_snapp_mode,this.snapOptions.limit=B.properties.snapping.defaut_limit,this.snapOptions.visible=B.properties.snapping.defaut_visibility);this.tmpSnapOptions=angular.copy(this.snapOptions);this.isMinScaleOk=this.isMaxScaleOk=!0;this.Gd=new yq({map:B.g().B,visible:!1,source:new rq({re:!1}),
style:new Tp({fill:new Sp({color:"rgba(255, 255, 255, 0.2)"}),stroke:new Tn({color:"#1000ff",width:2}),kb:new Rp({cb:3,fill:new Sp({color:"#1000ff"})})})});this.Od=new Cz({ek:!0,Km:"segment_edge_node"===this.snapOptions.mode?!0:!1,pg:this.snapOptions.tolerance,source:this.Gd.s()});a.selectedBoId;a.aInsertableBOs=B.oa.tu();a.oInsertObject={sFormDefinitionName:"insert",business_object_id:null,oResult:{},sGeomColumn:null,sGeomType:null,oFormDefinition:{},add_form_size:1,oFormValues:{insert:{}}};a.featuresLength=
0;B.scope.$on("layersChanged",function(){Oz(e)});setTimeout(function(){Oz(e)});this.Vc.on("select",function(){for(var a=this.Vc.Ca().P(),b=0;b<a.length;b++)this.sc.s().Jb(a[b]);this.Vc.Ca().clear()},this);this.Og=new Oy({vb:[this.Ve]});this.Og.on("select",this.Qt,this);var f=0;this.sc.s().on("change",function(){var b=a.oInsertObject.sGeomType;if(null!=b&&"MULTI"!==b.substr(0,5)&&"GEOMETRYCOLLECTION"!==b&&1<this.fc.cc())for(;1<this.fc.cc();)le(this.fc,0);f++;var c=angular.copy(f);setTimeout(function(){if(f===
c){B.log("nsVmap.nsToolsManager.Insert.inserttoolController.updateInsertObjectFeature");for(var a=e.b,b=Wa(e.fc.P()),d=a.oInsertObject.sGeomType,g=0;g<b.length;g++)if(b[g].j()instanceof Hq){var h=b[g].j(),h=new xi(h);b[g]=new vd({geometry:h})}h=new Mt;g="";if(0<b.length){if("MULTIPOINT"===d){d=new md;for(g=0;g<b.length;g++)"Point"===b[g].j().F()&&rd(d,b[g].j());b=new vd({geometry:d})}else if("MULTILINESTRING"===d){d=new nd;for(g=0;g<b.length;g++)"LineString"===b[g].j().F()&&sd(d,b[g].j());b=new vd({geometry:d})}else if("MULTIPOLYGON"===
d){d=new od;for(g=0;g<b.length;g++)"Polygon"===b[g].j().F()&&ud(d,b[g].j());b=new vd({geometry:d})}else b=b[0];g=h.px(b,{xd:E(e.map).J().Z,Ic:E(e.map).J().Z})}""===g?console.error("WKTGeometry is empty"):(b=B.gA(g,E(e.map).J().Z),a.oInsertObject.oFormValues.insert[a.oInsertObject.sGeomColumn]=b,a.oInsertObject.oResult[a.oInsertObject.sGeomColumn]=b)}},500)},this);$("#basictools-insert-form-reader-modal").on("shown.bs.modal",function(){$("#basictools-insert-form-reader").parent().scrollTop(0)});B.scope.$on("toggleOutTools",
function(){a.oInsertObject.oResult={};a.oInsertObject.oFormValues.insert={};a.selectedBoId=null;e.fc.clear();e.Gd.s().clear();B.g().B.hd(e.Od)});this.fc.on("change:length",function(){a.$applyAsync(function(){a.featuresLength=e.fc.cc()})},this);this.b.$watch("selectedBoId",function(){e.ys();B.log("nsVmap.nsToolsManager.Insert.inserttoolController.selectCurrentBoForSnapping");for(var a=0;a<e.b.aInsertableBOs.length;a++)e.b.aInsertableBOs[a].loadCanceller=e.va.defer(),e.b.aInsertableBOs[a].isMouseOverSnaoMenuOb=
!1,e.b.aInsertableBOs[a].bo_snapping_loaded=null,e.b.aInsertableBOs[a].bo_snapping_enabled=e.b.aInsertableBOs[a].bo_id===e.b.selectedBoId?!0:!1;e.He()});if(B.properties.is_mobile)d.find(".modal").on("shown.bs.modal",function(){$(".modal-backdrop.fade.in").hide();$(".modal.fade.in").find(".modal-dialog").addClass("mobile-full-modal")});B.g().B.on("moveend",function(){e.He();e.fi()})};Nz.prototype.inserttoolController=Nz.prototype.Ga;Nz.prototype.Ga.$inject=["$scope","$rootScope","$q","$element"];
function Oz(a){B.log("nsVmap.nsToolsManager.Insert.inserttoolController.loadInsertableBos");a.b.$applyAsync(function(){setTimeout(function(){a.b.aInsertableBOs=B.oa.tu();null!=a.b.aInsertableBOs&&B.properties.is_mobile&&(0<a.b.aInsertableBOs.length?$("#vmap_menu_mobile_menu_insert_button").show():$("#vmap_menu_mobile_menu_insert_button").hide())})});a.He()}
Nz.prototype.Ga.prototype.He=function(){B.log("nsVmap.nsToolsManager.Insert.inserttoolController.checkEditionScale");for(var a,b=0;b<this.b.aInsertableBOs.length;b++)if(this.b.aInsertableBOs[b].bo_id===this.b.selectedBoId){a=this.b.aInsertableBOs[b];break}null!=a&&(b=a.bo_max_edition_scale,a=a.bo_min_edition_scale,this.isMinScaleOk=this.isMaxScaleOk=!0,"basicTools-insert-"===this.currentAction.substr(0,18)&&(null!=a&&(a=parseFloat(a),B.g().Za()<a?(B.g().za.Ja("\u00c9chelle minimale de saisie atteinte, d\u00e9-zoomez pour continuer"),
this.isMinScaleOk=!1,"Point"===this.addPartGeomType&&this.yb.setActive(!1)):this.isMinScaleOk=!0),null!=b&&(b=parseFloat(b),B.g().Za()>b?(B.g().za.Ja("\u00c9chelle maximale de saisie atteinte, zoomez pour continuer"),this.isMaxScaleOk=!1,"Point"===this.addPartGeomType&&this.yb.setActive(!1)):this.isMaxScaleOk=!0),this.isMinScaleOk&&this.isMaxScaleOk&&(jj(this.yb)||this.yb.setActive(!0),jj(this.yb)&&B.g().za.Ja("Cliquez pour commencer \u00e0 dessiner"))))};
Nz.prototype.Ga.prototype.jA=function(){B.log("nsVmap.nsToolsManager.Insert.inserttoolController.getInsertableLayers");return B.oa.jA()};Nz.prototype.Ga.prototype.getInsertableLayers=Nz.prototype.Ga.prototype.jA;
Nz.prototype.Ga.prototype.pd=function(){B.log("nsVmap.nsToolsManager.Insert.inserttoolController.displayEditFrom");var a=this.b;B.D.ub.Wr($("#basic-tools-dropdown-insert-btn"));$("#basictools-insert-form-reader-modal").modal("show");var b=this.Rk();b.$evalAsync(function(){try{n(destructor_form)&&destructor_form()}catch(d){B.log("destructor_form does not exist")}if(null!=a.oInsertObject.oFormDefinition_js){var c=a.oInsertObject.oFormDefinition_js;B.log("initHtmlForm : javascript assoc. to : "+c);ad([c],
{callback:function(){try{n(constructor_form)&&constructor_form(b,c)}catch(d){B.log("constructor_form does not exist")}},async:!0,scriptInBody:!0})}b.ctrl.loadForm()})};Nz.prototype.Ga.prototype.displayEditFrom=Nz.prototype.Ga.prototype.pd;
Nz.prototype.Ga.prototype.qE=function(){B.log("nsVmap.nsToolsManager.Insert.inserttoolController.validateForm");var a=this,b=this.b;b.Bq=!1;setTimeout(function(){a.Rk().sendForm();setTimeout(function(){if(b.Bq){if(null!=b.oInsertObject.oResult[b.oInsertObject.sGeomColumn])var c=angular.copy(b.oInsertObject.oResult[b.oInsertObject.sGeomColumn]);var d=b.oInsertObject,e=b.oInsertObject.oFormValues;B.log("nsVmap.nsToolsManager.Insert.inserttoolController.getBOValuesFromFormValues");var f=a.b,g=angular.element(v.f).injector().get(["formSrvc"]),
e=kb(e),e=g.getFormData("insert",!0,{oFormDefinition:f.oInsertObject.oFormDefinition,oFormValues:e,aParamsToSave:["geom"]});d.oResult=e;null!=b.oInsertObject.oResult[b.oInsertObject.sGeomColumn]||(b.oInsertObject.oResult[b.oInsertObject.sGeomColumn]=c);$("#basictools-insert-form-reader-modal").modal("hide")}})})};Nz.prototype.Ga.prototype.validateForm=Nz.prototype.Ga.prototype.qE;
Nz.prototype.Ga.prototype.GO=function(){B.log("nsVmap.nsToolsManager.Insert.inserttoolController.trySubmitInsertion");var a=this,b=this.b;b.Bq=!1;this.qE();setTimeout(function(){b.Bq&&a.KD()},500)};Nz.prototype.Ga.prototype.trySubmitInsertion=Nz.prototype.Ga.prototype.GO;
function Pz(a,b){B.log("nsVmap.nsToolsManager.Insert.inserttoolController.isResultValid");if(null==a)return console.error("oResult not defined"),!1;if(null==b)return console.error("oFormDefinition not defined"),!1;var c=[];b=b.insert.rows;for(var d=0;d<b.length;d++)for(var e=0;e<b[d].fields.length;e++)!0===b[d].fields[e].required&&(null!=a[b[d].fields[e].name]&&""!==a[b[d].fields[e].name]||(r(b[d].fields[e].label)&&""!==b[d].fields[e].label?c.push(b[d].fields[e].label+"("+b[d].fields[e].name+")"):
c.push(b[d].fields[e].name)));return 0===c.length?!0:c}
Nz.prototype.Ga.prototype.ys=function(a,b){function c(){setTimeout(function(){!1===k&&bootbox.confirm("Annuler la requ\u00eate ?",function(a){!0===a?(m.resolve(),e.selectedBoId=""):c()})},5E3)}B.log("nsVmap.nsToolsManager.Insert.inserttoolController.updateInsertForm");var d=this,e=this.b,f=this.va,g=this.Rk(),h=null!=a?a:e.selectedBoId;if(null==h)return null;e.oInsertObject.oResult={};e.oInsertObject.sGeomColumn=null;e.oInsertObject.sGeomType=null;e.oInsertObject.business_object_id=null;e.oInsertObject.oFormDefinition=
{};e.oInsertObject.oFormValues.insert={};this.fc.clear();null!=g&&g.ctrl.refreshForm();var k=!1,m=f.defer();A({method:"GET",url:B.properties.api_url+"/vmap/businessobjects/"+h,headers:{Accept:"application/x-vm-json"},scope:this.b,abord:m.promise,success:function(a){k=!0;if(!n(a.data))return bootbox.alert("response['data'] undefined"),e.selectedBoId="",0;if(n(a.data.errorMessage))return bootbox.alert(a.data.errorType+": "+a.data.errorMessage),e.selectedBoId="",0;if(null==a.data.data)return bootbox.alert("Aucune valeur retourn\u00e9e, impossible de charger le formulaire correspondant \u00e0 la couche"),
e.selectedBoId="",0;if(null==a.data.data[0].json_form[0])return bootbox.alert("Impossible de charger le formulaire correspondant \u00e0 la couche"),e.selectedBoId="",0;a.data.data[0].json_form[0].insert.name="basictools-insert-form-reader-form";e.oInsertObject.oFormDefinition=a.data.data[0].json_form[0];e.oInsertObject.oFormDefinition_js=a.data.data[0].json_form_js;e.oInsertObject.add_form_size=a.data.data[0].add_form_size;e.oInsertObject.sBusinessObjectID=h;n(a.data.data[0].geom_column)&&(e.oInsertObject.sGeomColumn=
a.data.data[0].geom_column);n(a.data.data[0].geom_type)&&(e.oInsertObject.sGeomType=a.data.data[0].geom_type);if("GEOMETRYCOLLECTION"===e.oInsertObject.sGeomType)d.addPartGeomType="";else if("POLYGON"===e.oInsertObject.sGeomType||"MULTIPOLYGON"===e.oInsertObject.sGeomType)d.addPartGeomType="Polygon";else if("LINESTRING"===e.oInsertObject.sGeomType||"MULTILINESTRING"===e.oInsertObject.sGeomType)d.addPartGeomType="LineString";else if("POINT"===e.oInsertObject.sGeomType||"MULTIPOINT"===e.oInsertObject.sGeomType)d.addPartGeomType=
"Point";e.oInsertObject.oFormDefinition.insert.rows.push({fields:[{type:"button","class":"btn-ungroup btn-group-sm",nb_cols:12,buttons:[{visibleAllTabs:!0,type:"submit",label:"Sauvegarder",name:"form_submit","class":"btn-primary hidden",id:"basictools-insert-form-reader-submit-btn"}]}]});e.oInsertObject.oFormDefinition.insert.event=function(){e.Bq=!0};g.ctrl.refreshForm();null!=b&&b.call(d)},error:function(a){e.selectedBoId="";bootbox.alert(a)}});c()};Nz.prototype.Ga.prototype.updateInsertForm=Nz.prototype.Ga.prototype.ys;
Nz.prototype.Ga.prototype.Rk=function(){return angular.element($("#basictools-insert-form-reader").children()).scope()};
Nz.prototype.Ga.prototype.QN=function(a,b){B.log("nsVmap.nsToolsManager.Insert.inserttoolControlle.startInsertion");B.g().Ce();B.g().za.hide();this.Gd.s().clear();B.g().B.hd(this.Od);if(!0===b)return 0;if("insert"===a.substr(0,6))B.g().za.Ja("Cliquez pour commencer \u00e0 dessiner"),this.zw(a.substr(6));else if("editFeature"===a)B.g().za.Ja("Cliquez sur un dessin pour le modifier"),Dq(B.g(),this.Fd,"basicTools-insert-"+a);else if("deleteFeature"===a)B.g().za.Ja("Cliquez sur un dessin pour le supprimer"),
Dq(B.g(),this.Vc,"basicTools-insert-"+a);else if("addHole"===a){B.g().za.Ja("Dessinez un polygone \u00e0 l'int\u00e9rieur d'un autre pour cr\u00e9er un trou");this.yb=B.g().sh({type:"Polygon"},"basicTools-insert-"+a);a=Wa(this.fc.P());var c=[];for(b=0;b<a.length;b++)if("Polygon"===a[b].j().F())c.push(a[b]);else if("MultiPolygon"===a[b].j().F())for(var d=Wa(qd(a[b].j())),e=0;e<d.length;e++)c.push(new vd({geometry:d[e]}));this.yb.on("drawend",function(a){a=a.ka;for(var b=ui(a.j()),d=!1,e=0;e<c.length;e++)Gt(c[e].j(),
a.j())&&(ri(c[e].j(),b),d=!0);d?(this.sc.s().clear(),this.sc.s().Rf(c)):bootbox.alert("Trou non valide: il doit \u00eatre contenu dans un polygone dessin\u00e9")},this)}else if("deleteHole"===a)B.g().za.Ja("Cliquez dans un trou pour le supprimer"),this.kt(),Dq(B.g(),this.Og,"basicTools-insert-"+a);else return console.error("startSelection: type ("+a+") not allowed"),0};Nz.prototype.Ga.prototype.startInsertion=Nz.prototype.Ga.prototype.QN;
Nz.prototype.Ga.prototype.kt=function(){B.log("nsVmap.nsToolsManager.Insert.inserttoolController.addHolesIntoHolesLayer");var a=this.fc.P();this.Ve.s().clear();for(var b=0;b<a.length;b++){var c=vi(a[b].j());if(1<c.length)for(var d=1;d<c.length;d++){var e=new qi;e.zb([c[d].T()]);this.Ve.s().xb(new vd({geometry:e}))}}};
Nz.prototype.Ga.prototype.Qt=function(){B.log("nsVmap.nsToolsManager.Insert.inserttoolController.deleteHole");var a=this.Og.Ca().P();if(0<a.length){for(var b=0;b<a.length;b++){for(var c=a[b].j(),d=!1,e=this.fc.P(),f=0;f<e.length;f++){for(var g=e[f].j().T(),h=g.length-1;0<=h;h--)angular.equals(c.T()[0],g[h])&&(g.splice(h,1),d=!0);e[f].j().zb(g)}d&&this.Ve.s().Jb(a[b])}this.Og.Ca().clear()}};
Nz.prototype.Ga.prototype.zw=function(a){B.log("nsVmap.nsToolsManager.Insert.inserttoolController.startDrawing");this.yb=B.g().sh({type:a,features:this.fc},"basicTools-insert-insert"+a);var b=this;this.yb.on("drawend",function(a){Qz(a.ka)},this);this.yb.on("drawstart",function(){b.isMaxScaleOk||Ny(b.yb);b.isMinScaleOk||Ny(b.yb);var a=0;b.yb.kd.on("change",function(c){if(null!=c.target&&null!=c.target.j&&(c=c.target.j(),null!=c.F))switch(c.F()){case "LineString":case "MultiLineString":case "Point":case "MultiPoint":case "Polygon":case "MultiPolygon":c.T().length>
a&&(b.isMaxScaleOk||Ny(b.yb),b.isMinScaleOk||Ny(b.yb)),a=c.T().length}})});setTimeout(function(){b.He();b.fi()})};function Qz(a){B.log("nsVmap.nsToolsManager.Insert.inserttoolController.updateCircleGeoms");if(a.j()instanceof Hq){var b=a.j(),b=new xi(b);a.jd(b)}return a}
Nz.prototype.Ga.prototype.KD=function(){B.log("nsVmap.nsToolsManager.Insert.inserttoolController.submitInsertion");var a=this,b=this.b,c=b.oInsertObject.oResult,d=b.oInsertObject.sBusinessObjectID,b=Pz(c,b.oInsertObject.oFormDefinition);if(!0===b)Rz(this,c,d);else{if(q(b))for(c="Votre requ\u00eate n'a pas pu aboutir, les attributs suivants sont obligatoires: <br>",d=0;d<b.length;d++)c=0===d?c:c+", ",c+=b[d];else c="Votre requ\u00eate n'a pas pu aboutir, certains attributs obligatoires n'ont pas \u00e9t\u00e9s renseign\u00e9s";
bootbox.dialog({message:c,buttons:{cancel:{label:"Annuler",className:"btn-default"},editAttr:{label:"\u00c9diter les attributs",className:"btn-primary",callback:function(){a.pd()}}}})}};Nz.prototype.Ga.prototype.submitInsertion=Nz.prototype.Ga.prototype.KD;
function Rz(a,b,c){B.log("nsVmap.nsToolsManager.Insert.inserttoolController.sendInsertRequest");null==b?console.error("oResult not defined"):null==c?console.error("sBusinessObjectID not defined"):(b=a.Vm(b),A({method:"POST",url:B.properties.api_url+"/vmap/querys/"+c,headers:{Accept:"application/x-vm-json"},data:b,scope:a.b,success:function(b){if(!n(b.data))return bootbox.alert("response['data'] undefined"),0;if(200!==b.status)return 500===b.status?$.notify("Erreur interne du serveur","error"):null!=
b.statusText?$.notify(b.statusText,"error"):$.notify("Erreur "+b.status,"error"),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorType+": "+b.data.errorMessage),0;if(1===b.data.status){$.notify("Op\u00e9ration r\u00e9alis\u00e9e avec succ\u00e8s, les couches de la carte se mettent \u00e0 jour","info");a.ys();B.log("nsVmap.nsToolsManager.Insert.inserttoolController.reloadImpactedLayer");b=a.map.getLayers().P();for(var d,f=0;f<b.length;f++)if(d=b[f].get("business_objects"),q(d))for(var g=
0;g<d.length;g++)d[g].business_object_id===c&&b[f].ud();B.D.ub.Nf();B.D.ub.qc()}}}))}Nz.prototype.Ga.prototype.Vm=function(a){B.log("nsVmap.nsToolsManager.Insert.prototype.inserttoolController.prototype.getFormDataFromValues");var b=new FormData,c;for(c in a)null!=a[c]&&(null!=a[c].aFiles?(b.append(c+"_attached_content",a[c].aFiles[0]),b.append(c,a[c].aFiles[0].name)):b.append(c,a[c]));return b};
Nz.prototype.Ga.prototype.VK=function(a){B.log("nsVmap.nsToolsManager.Insert.inserttoolController.mobileStartInsertion");var b=this,c=this.b;this.ys(a,function(){Sz(b,c.oInsertObject).then(function(a){B.D.ub.qc();B.g().$l(a,function(a){if(q(a)){for(var c=0;c<a.length;c++)a[c]=Qz(a[c]);b.sc.s().Rf(a)}else a=Qz(a),b.sc.s().xb(a);setTimeout(function(){B.D.ub.Ap();$("#vmap_menu_mobile_menu_insert").removeClass("collapse");b.pd()})})})})};Nz.prototype.Ga.prototype.mobileStartInsertion=Nz.prototype.Ga.prototype.VK;
function Sz(a,b){B.log("nsVmap.nsToolsManager.Insert.inserttoolController.getMobileBoGeomType_");var c=a.va.defer(),d=angular.copy(b.sGeomType);"GEOMETRY"===d||"GEOMETRYCOLLECTION"===d?bootbox.prompt({title:"Type de g\u00e9om\u00e9trie \u00e0 ins\u00e9rer",lQ:"select",kQ:[{text:"Point",value:"POINT"},{text:"Ligne",value:"LINESTRING"},{text:"Polygone",value:"POLYGON"},{text:"Cercle",value:"CIRCLE"}],Bb:function(a){c.resolve(a)}}):setTimeout(function(){c.resolve(d)});return c.promise}
Nz.prototype.Ga.prototype.xw=function(){B.log("nsVmap.nsToolsManager.Insert.prototype.inserttoolController.prototype.showSnappingOptionsModal");this.tmpSnapOptions=angular.copy(this.snapOptions);$("#vmap-insert-snap-options-modal").modal("show")};Nz.prototype.Ga.prototype.showSnappingOptionsModal=Nz.prototype.Ga.prototype.xw;
Nz.prototype.Ga.prototype.qo=function(){B.log("nsVmap.nsToolsManager.Insert.prototype.inserttoolController.prototype.submitSnappingOptionsModal");this.snapOptions=angular.copy(this.tmpSnapOptions);B.g().B.hd(this.Od);this.Od=new Cz({ek:!0,Km:"segment_edge_node"===this.snapOptions.mode?!0:!1,pg:this.snapOptions.tolerance,source:this.Gd.s()});B.g().B.Ob(this.Od);$("#vmap-insert-snap-options-modal").modal("hide");this.He();this.fi()};Nz.prototype.Ga.prototype.submitSnappingOptionsModal=Nz.prototype.Ga.prototype.qo;
Nz.prototype.Ga.prototype.mw=function(){B.log("nsVmap.nsToolsManager.Insert.prototype.inserttoolController.prototype.resetSnapOptions");null!=B.properties.snapping&&(this.tmpSnapOptions.tolerance=B.properties.snapping.defaut_tolerance,this.tmpSnapOptions.mode=B.properties.snapping.defaut_snapp_mode,this.tmpSnapOptions.limit=B.properties.snapping.defaut_limit,this.tmpSnapOptions.visible=B.properties.snapping.defaut_visibility);this.qo()};Nz.prototype.Ga.prototype.resetSnapOptions=Nz.prototype.Ga.prototype.mw;
Nz.prototype.Ga.prototype.fi=function(){B.log("nsVmap.nsToolsManager.Insert.prototype.inserttoolController.prototype.loadVectorSnappingData");var a=this,b=null;a.Gd.setVisible(a.snapOptions.visible);a.Gd.s().clear();a.He();B.g().B.hd(a.Od);setTimeout(function(){if(null!=a.currentAction&&"basicTools-insert-"===a.currentAction.substr(0,18)&&a.isMaxScaleOk&&a.isMinScaleOk){for(var c=0;c<a.b.aInsertableBOs.length;c++)b=a.b.aInsertableBOs[c],a.Bw(b),a.lv(b);for(c=0;c<b.length;c++)null===b[c].bo_snapping_loaded&&
(b[c].bo_snapping_enabled=!1);B.g().B.Ob(a.Od)}})};
Nz.prototype.Ga.prototype.lv=function(a){B.log("nsVmap.nsToolsManager.Insert.prototype.inserttoolController.prototype.loadBoVectorSnappingData");var b=this,c=a.bo_id,d=[],e=null,f=Ei(E(B.g().B),B.g().B.$a()),f=new wi(f);!0===a.bo_snapping_enabled&&(a.bo_snapping_loaded=!1,A({method:"POST",url:B.properties.api_url+"/vmap/querys/"+c+"/geometry",headers:{"X-HTTP-Method-Override":"GET",Accept:"application/x-vm-json"},data:{intersect_geom:B.Oe(f),snapping_limit:b.snapOptions.snappingObjectsLimit,snapping_mode:b.snapOptions.mode},
ajaxLoader:!1,abord:a.loadCanceller.promise,scope:this.b,success:function(c){if(null==c.data)return a.bo_snapping_loaded=null,0;if(null!=c.data.errorMessage)return console.error(c.data.errorMessage),a.bo_snapping_loaded=null,0;if(c.data[0].count>b.snapOptions.snappingObjectsLimit)return a.bo_snapping_loaded=null,$.notify("Limit de points atteinte pour object "+a.bo_title,"warn"),0;a.bo_snapping_loaded=!0;for(var f=0;f<c.data.length;f++)null!=c.data[f].geom&&(e=c.data[f].geom,d.push(new vd({geometry:B.xf(e)})));
b.Gd.s().Rf(d)},error:function(){a.bo_snapping_loaded=null}}))};Nz.prototype.Ga.prototype.Bw=function(a){B.log("nsVmap.nsToolsManager.Insert.prototype.inserttoolController.prototype.stopLoadingBoVectorSnappingData");null!=a.loadCanceller&&(a.loadCanceller.resolve(),a.loadCanceller=this.va.defer(),a.bo_snapping_loaded=null)};B.module.directive("appInsert",Nz.prototype.NJ);B.module.controller("AppInsertController",Nz.prototype.Ga);function Tz(a){Nj.call(this,{bg:Uz,Vh:Vz,yA:Wz,cg:Xz});a=a?a:{};this.hg=null;this.Ib=void 0!==a.features?a.features:null;var b;if(a.vb)if("function"===typeof a.vb)b=a.vb;else{var c=a.vb;b=function(a){return 0<=c.indexOf(a)}}else b=Ig;this.Jq=b;this.vq=a.$h?a.$h:0;this.sn=null;J(this,ee("active"),this.KI,this)}F(Tz,Nj);
function Uz(a){this.sn=Yz(this,a.Sc,a.map);if(!this.hg&&this.sn){this.hg=a.Qb;Wz.call(this,a);var b=this.Ib||new he([this.sn]);this.dispatchEvent(new Zz("translatestart",b,a.Qb));return!0}return!1}function Xz(a){if(this.hg){this.hg=null;Wz.call(this,a);var b=this.Ib||new he([this.sn]);this.dispatchEvent(new Zz("translateend",b,a.Qb));return!0}return!1}
function Vz(a){if(this.hg){a=a.Qb;var b=a[0]-this.hg[0],c=a[1]-this.hg[1],d=this.Ib||new he([this.sn]);d.forEach(function(a){var d=a.j();d.translate(b,c);a.jd(d)});this.hg=a;this.dispatchEvent(new Zz("translating",d,a))}}function Wz(a){var b=a.map.ac;Yz(this,a.Sc,a.map)?(b.classList.remove(this.hg?"ol-grab":"ol-grabbing"),b.classList.add(this.hg?"ol-grabbing":"ol-grab")):b.classList.remove("ol-grab","ol-grabbing")}
function Yz(a,b,c){return gj(c,b,function(a){if(!this.Ib||0<=this.Ib.P().indexOf(a))return a}.bind(a),{Iq:a.Jq,$h:a.vq})}Tz.prototype.ib=function(a){var b=this.g();Nj.prototype.ib.call(this,a);this.Eo(b)};Tz.prototype.KI=function(){this.Eo(null)};Tz.prototype.Eo=function(a){var b=this.g(),c=jj(this);b&&c||(b=b||a)&&b.ac.classList.remove("ol-grab","ol-grabbing")};function Zz(a,b,c){Wd.call(this,a);this.features=b;this.Qb=c}F(Zz,Wd);function $z(a){B.log("nsVmap.nsToolsManager.PrintBox");this.W=B.g().B;a=null!=a?a:{};this.Nn=a.size;this.he=Gq(B.g());this.dd=this.he.s().Hb;this.EO=new Tz({features:this.dd})}qa("nsVmap.nsToolsManager.PrintBox",$z);Ox.Print=aA;$z.prototype.show=function(a){null!=a||(a=!0);this.au();a&&bA(this)};$z.prototype.show=$z.prototype.show;$z.prototype.hide=function(){$d(this.sC);this.dd.clear()};$z.prototype.hide=$z.prototype.hide;
$z.prototype.tB=function(a){B.log("nsVmap.nsToolsManager.PrintBox.managePrintBox");a=null!=a?a:"modifyPrintZone";$d(this.sC);Dq(B.g(),this.EO,a)};$z.prototype.managePrintBox=$z.prototype.tB;$z.prototype.fE=function(){B.log("nsVmap.nsToolsManager.PrintBox.unmanagePrintBox");B.g().El();this.au();bA(this)};$z.prototype.unmanagePrintBox=$z.prototype.fE;
$z.prototype.Za=function(){var a=this,b=E(this.W).Fa(),c=E(this.W).Ka();this.V();Ji(E(this.W),this.V(),{kc:!1,Dj:!0});var d=B.g().Za();setTimeout(function(){Ki(E(a.W),b);E(a.W).tb(c)});return d};$z.prototype.getScale=$z.prototype.Za;$z.prototype.Ee=function(a){var b=this.Za(),b=a/b,c=this.V();a=(c[2]-c[0])*b;b*=c[3]-c[1];c=ti(this.Mn.j()).T();a=wi([c[0]-a/2,c[1]-b/2,c[0]+a/2,c[1]+b/2]);this.Mn=new vd({geometry:a});this.dd.clear();this.he.s().xb(this.Mn)};$z.prototype.setScale=$z.prototype.Ee;
$z.prototype.$a=function(){return this.Nn};$z.prototype.getSize=$z.prototype.$a;$z.prototype.Sl=function(a){this.Nn=a};$z.prototype.setSize=$z.prototype.Sl;$z.prototype.V=function(){return this.Mn.j().V()};$z.prototype.getExtent=$z.prototype.V;function bA(a){a.sC=B.g().Ol("precompose",a.au,a)}
$z.prototype.au=function(){if(null==this.Nn)return console.error("Print box size undefined"),0;if(null==this.Nn)return console.error("Print box feature undefined"),0;this.dd.clear();var a=this.Nn,b=a[0],c=a[1],a=$("#map1").width()/2-b/2,b=$("#map1").width()/2+b/2,d=$("#map1").height()/2-c/2,c=$("#map1").height()/2+c/2,e=[b,d],f=this.W.zc([a,c]),e=this.W.zc(e),f=wi([f[0],e[1],e[0],f[1]]),f=new vd({geometry:f});f.set("pixelExtent",[a,d,b,c]);this.Mn=f;this.he.s().xb(this.Mn)};function aA(){B.log("nsVmap.nsToolsManager.Print")}qa("nsVmap.nsToolsManager.Print",aA);Ox.Print=aA;aA.prototype.print=function(a){B.log("nsVmap.nsToolsManager.Print.prototype.print");angular.element($("#select-print-format")).scope().$evalAsync(function(b){b.ctrl.print(a)})};aA.prototype.print=aA.prototype.print;
aA.prototype.gM=function(){B.log("nsVmap.nsToolsManager.Print.prototype.printDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppprintController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/tools/print.html"}};
aA.prototype.Ec=function(a,b,c,d){B.log("nsVmap.nsToolsManager.Print.prototype.printController");var e=this;this.$timeout_=a;this.b=c;this.va=d;c.modelIndex=0;c.printstyle_id="";this.models;this.printStyles=[];this.selectedModel;this.resolution=2;this.dpi=1;this.scale="auto";this.currentScale=B.g().Za({pretty:!0});this.Hj=new $z;cA(this);$("#print-select-btn").click(function(){$("#print-select-btn").hasClass("active")&&dA(e).then(function(){0<e.models.length&&(null!=e.models[c.modelIndex]&&0!==c.modelIndex||
(c.modelIndex="0"),e.printStyles=[],e.gB(c.modelIndex))})});B.scope.$on("toggleOutTools",function(){$("#print-select-btn").hasClass("active")||e.Hj.hide()})};aA.prototype.printController=aA.prototype.Ec;aA.prototype.Ec.$inject=["$timeout","$compile","$scope","$q"];
function dA(a){B.log("nsVmap.nsToolsManager.Print.printController.loadPrintProperties");var b=a.va.defer();A({method:"GET",url:B.properties.api_url+"/vmap/userprinttemplates",headers:{Accept:"application/x-vm-json"},params:{distinct:!0},scope:a.b,success:function(c){a.models=[];null!=c.data&&q(c.data.userprinttemplates)&&0<c.data.userprinttemplates.length&&(a.models=c.data.userprinttemplates,a.b.printstyle_id=null);b.resolve()}});return b.promise}
function cA(a){B.log("nsVmap.nsToolsManager.Print.printController.listenScaleChanges");var b=0;a.map.on("moveend",function(){b++;var c=angular.copy(b);setTimeout(function(){b===c&&"print-modifyPrintZone"!==a.currentAction&&(a.scale="auto",a.currentScale=Aq(B.g(),B.g().Za()/a.Oj),a.b.$apply())},100)})}
aA.prototype.Ec.prototype.gB=function(a){B.log("nsVmap.nsToolsManager.Print.printController.loadModelParmas");a=this.selectedModel=this.models[a];var b=this.bK;B.log("nsVmap.nsToolsManager.Print.printController.setTemplate");null!=a.definition||null!=a.url||bootbox.alert("<h4>Aucune d\u00e9finition pr\u00e9sente dans le mod\u00e8le d'impression</h4>");if(null!=a.definition){var c=document.createElement("div");c.innerHTML=a.definition;this.dO=c;b.call(this,[c])}this.printStyles=this.selectedModel.printstyles};
aA.prototype.Ec.prototype.loadModelParmas=aA.prototype.Ec.prototype.gB;
aA.prototype.Ec.prototype.bK=function(){B.log("nsVmap.nsToolsManager.Print.printController.loadModelParmas2");var a=this.dO;B.log("nsVmap.nsToolsManager.Print.printController.setPrintedMapSize");var b=$(a).find("#map_image");if(n(b.get(0))){$(a).addClass("print_template");$("body").append(a);var c=b.height(),b=b.width();$(a).remove();this.Oj=1;for(var a=angular.copy(b),d=angular.copy(c);b>$("#map1").width()||c>$("#map1").height();)this.Oj++,b=a/this.Oj,c=d/this.Oj;this.jM=[b,c]}else console.error("Aucune balise #map_image trouv\u00e9e dans le template");
this.resolution=this.Oj;this.currentScale=Aq(B.g(),B.g().Za()/this.Oj);this.Hj.Sl(this.jM);this.Hj.show()};aA.prototype.Ec.prototype.YF=function(a){B.log("nsVmap.nsToolsManager.Print.prototype.printController.prototype.changeScale");if("auto"===a)return 0;if("print-modifyPrintZone"===this.currentAction)return this.Hj.Ee(a),0;a*=this.Oj;B.g().Ee(a)};aA.prototype.Ec.prototype.changeScale=aA.prototype.Ec.prototype.YF;
aA.prototype.Ec.prototype.uK=function(){B.log("nsVmap.nsToolsManager.Print.prototype.printController.prototype.managePrintZone");"print-modifyPrintZone"===this.currentAction?this.Hj.fE():this.Hj.tB("print-modifyPrintZone")};aA.prototype.Ec.prototype.managePrintZone=aA.prototype.Ec.prototype.uK;
aA.prototype.Ec.prototype.eM=function(){B.log("nsVmap.nsToolsManager.Print.prototype.printController.prototype.prepareAndLaunchPrint");B.g().Za({pretty:!0});for(var a={},b=0;b<this.selectedModel.variables.length;b++)a[this.selectedModel.variables[b].name]=this.selectedModel.variables[b].value;var b=this.Hj.V(),c=this.selectedModel.printtemplate_id,d=B.g().mi.P(),e=B.g().Fv.P(),f=B.g().Cn.P();1===this.print({scope:a,aa:b,OD:c,iM:this.b.printstyle_id,RC:this.dpi,features:Ua(d,e,f)})&&B.D.ub.Nf()};
aA.prototype.Ec.prototype.prepareAndLaunchPrint=aA.prototype.Ec.prototype.eM;
aA.prototype.Ec.prototype.print=function(a){B.log("nsVmap.nsToolsManager.Print.prototype.printController.prototype.print");var b=this;if(null==a)return console.error("opt_options.templateId not defined"),0;var c=new Date,d=c.getDate(),e=c.getMonth()+1,c=c.getFullYear();10>d&&(d="0"+d);10>e&&(e="0"+e);var c=d+"/"+e+"/"+c,f=null!=a.RC?a.RC:1,g=a.OD,h=a.iM,k=JSON.stringify([{target:"#map_legend",html:eA()}]),d=null!=a.scope?a.scope:{};d.date=null!=d.date?d.date:c;var m=JSON.stringify(d),p,t;null!=a.vB?
p=a.vB:t=B.oa.aq();for(var d=null!=a.features?a.features:[],u="",c=0;c<d.length;c++)0<c&&(u+="|"),u+=B.Oe(d[c].j());for(var d=null!=a.aa?a.aa:[],w="",e=[d[0]-(d[2]-d[0]),d[1]-(d[3]-d[1]),d[2]+(d[2]-d[0]),d[3]+(d[3]-d[1])],x="",c=0;c<d.length;c++)0<c&&(w+="|",x+="|"),w+=d[c],x+=e[c];var z=100;null!=a.Oz?z=a.Oz:null!=B.properties.print.features_zoom&&(z=B.properties.print.features_zoom);var D=window.open("","_blank","height=400,width=600");if(null==D)return $.notify("Fen\u00eatre d'impression bloqu\u00e9e par le navigateur",
"error"),0;D.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>');A({method:"GET",url:B.properties.api_url+"/vmap/printtemplates/"+g,headers:{Accept:"application/x-vm-json"},scope:this.b,success:function(a){var c=!1;null!=a.data?null!=a.data.data?null!=a.data.data[0]?null!=a.data.data[0].definition?null!=a.data.data[0].rt_format_id?
null!=a.data.data[0].rt_orientation_id||(c=!0):c=!0:c=!0:c=!0:c=!0:c=!0;if(c)return $.notify("Erreur lors du chargement des donn\u00e9es du template "+g,"error"),console.error("response: ",a),0;var d=a.data.data[0].rt_format_id,e=a.data.data[0].rt_orientation_id,c=document.createElement("div");c.innerHTML=a.data.data[0].definition;a=fA(c,"#map_image");c=fA(c,"#map_overview");if(null!=a)var H={map_id:p,map_json:t,image_size:a[0]*f+"|"+a[1]*f,resolution_coeff:f,extent:w,features:u,features_zoom:z};
if(null!=c)var U={map_id:p,map_json:t,image_size:c[0]*f+"|"+c[1]*f,resolution_coeff:f,extent:x,features:u,features_zoom:400};a=[];null!=H&&a.push({target:"#map_image",map_definition:H});null!=U&&a.push({target:"#map_overview",map_definition:U});var K=JSON.stringify(a);b.Lu().then(function(a){var c=JSON.parse(m),f;for(f in a)n(c["user_"+f])||(c["user_"+f]=a[f]);m=JSON.stringify(c);A({method:"POST",url:B.properties.api_url+"/vmap/printtemplateservices",headers:{Accept:"application/x-vm-json"},data:{printtemplate_id:g,
printstyle_id:h,format:d,orientation:e,includes_json:k,maps_json:K,scope_json:m},scope:b.b,timeout:12E4,success:function(a){var b=!1;null!=a.data?null!=a.data.printtemplateservices?null!=a.data.printtemplateservices.image?1!==a.data.status&&(b=!0):b=!0:b=!0:b=!0;if(b)return $.notify("Une erreur est survenue lors de l'impression","error"),D.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">Une erreur est survenue lors de l\'impression</div>'),console.error("response: ",
a),0;$.notify("Impression r\u00e9ussie","success");D.location.href=a.data.printtemplateservices.image},error:function(a){console.error(a);$.notify("Une erreur est survenue lors de l'impression","error");D.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">Une erreur est survenue lors de l\'impression</div>')}})})},error:function(a){console.error(a);$.notify("Une erreur est survenue lors de l'impression","error");D.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">Une erreur est survenue lors de l\'impression</div>')}});
return 1};aA.prototype.Ec.prototype.print=aA.prototype.Ec.prototype.print;function fA(a,b){var c=$(a).find(b);if(n(c.get(0)))return $("body").append(a),b=c.height(),c=c.width(),$(a).remove(),[c,b];B.log("Aucune balise "+b+" trouv\u00e9e dans le template")}
function eA(){var a=$("#maplegend").clone();a.find("img").each(function(){try{var a=document.createElement("canvas"),c=a.getContext("2d");a.width=this.width;a.height=this.height;c.drawImage(this,0,0,this.width,this.height);var d=a.toDataURL("image/png");$(this).attr("src",d);$(this).removeAttr("ng-src")}catch(e){}});a=a.html();a=a.replace(/&amp;/g,"&");return a=a.replace(/"/g,'\\"')}
aA.prototype.Ec.prototype.Lu=function(){B.log("nsVmap.nsToolsManager.Print.prototype.printController.prototype.getUserInfos_");var a=this.va.defer();A({method:"GET",url:B.properties.api_url+"/vitis/users/"+sessionStorage.user_id,headers:{Accept:"application/x-vm-json"},scope:this.b,success:function(b){null!=b.data&&null!=b.data.data&&null!=b.data.data[0]&&a.resolve(b.data.data[0])}});return a.promise};B.module.directive("appPrint",aA.prototype.gM);B.module.controller("AppprintController",aA.prototype.Ec);function S(){B.log("nsVmap.nsToolsManager.BasicTools");this.tL=new qy;this.vL=new Ty;this.ql=new R;this.qL=new Nz;this.cC=new aA;this.lL=new oy}qa("nsVmap.nsToolsManager.BasicTools",S);S.prototype.vO=function(a){var b=$(a).hasClass("active");this.Nf();!1===b&&($(a).addClass("active"),$(a).parent().children(".dropdown-menu").show())};S.prototype.toggleTool=S.prototype.vO;S.prototype.Wr=function(a){$(a).addClass("active");$(a).parent().children(".dropdown-menu").show()};S.prototype.showTool=S.prototype.Wr;
S.prototype.CA=function(a){$(a).removeClass("active");$(a).parent().children(".dropdown-menu").hide()};S.prototype.hideTool=S.prototype.CA;S.prototype.Nf=function(){B.log("nsVmap.nsToolsManager.BasicTools.prototype.toggleOutTools");$(".basic-tools-element").removeClass("active");$(".basic-tools-dropdown-element").hide();B.g().El();B.log("oVmap event: toggleOutTools");B.scope.$broadcast("toggleOutTools")};S.prototype.toggleOutTools=S.prototype.Nf;
S.prototype.qc=function(){B.log("nsVmap.nsToolsManager.BasicTools.prototype.hideMobileMenu");angular.element("#map-basic-tools").scope().ctrl.hideMobileMenu();this.Nf()};S.prototype.hideMobileMenu=S.prototype.qc;S.prototype.Ap=function(){B.log("nsVmap.nsToolsManager.BasicTools.prototype.displayAdvancedMobileMenu");angular.element("#map-basic-tools").scope().ctrl.displayAdvancedMobileMenu()};S.prototype.displayAdvancedMobileMenu=S.prototype.Ap;
S.prototype.Ny=function(){B.log("nsVmap.nsToolsManager.BasicTools.prototype.basictoolsDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppBasictoolsController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/tools/"+(B.properties.is_mobile?"basictools_mobile.html":"basictools.html")}};S.prototype.basictoolsDirective=S.prototype.Ny;
S.prototype.fb=function(a,b,c){B.log("nsVmap.nsToolsManager.BasicTools.prototype.basictoolsController");this.b=a;this.Us=c;a.$oLocation;a.$oMeasure;a.$oSelect;a.$oInsert;a.$oPrint;a.$oControls;a.bMobileMenuOpen=!1;a.bMobileLocationMenuOpen=!1;a.bMobileLayersMenuOpen=!1;a.bMobileAdvancedMenuOpen=!1;a.locationGoToProjection="EPSG:4326";a.locationGoToX="";a.locationGoToY="";b(function(){for(var b=a.pP;b;b=b.qP)b.zm.constructor===qy.prototype.hb&&(a.$oLocation=b),b.zm.constructor===Ty.prototype.Aa&&(a.$oMeasure=
b),b.zm.constructor===R.prototype.DQ&&(a.$oSelect=b),b.zm.constructor===Nz.prototype.Ga&&(a.$oInsert=b),b.zm.constructor===aA.prototype.Ec&&(a.$oPrint=b),b.zm.constructor===oy.prototype.az&&(a.$oControls=b)});B.scope.$on("mapChanged",function(){B.D.ub.Nf()});if(B.properties.is_mobile)c.find(".modal").on("shown.bs.modal",function(){$(".modal-backdrop.fade.in").hide();$(".modal.fade.in").find(".modal-dialog").addClass("mobile-full-modal")})};S.prototype.basictoolsController=S.prototype.fb;
S.prototype.fb.$inject=["$scope","$timeout","$element"];S.prototype.rI=function(){return this.ql};S.prototype.getSelect=S.prototype.rI;S.prototype.QH=function(){return this.qL};S.prototype.getInsert=S.prototype.QH;S.prototype.ZH=function(){return this.tL};S.prototype.getLocation=S.prototype.ZH;S.prototype.fI=function(){return this.vL};S.prototype.getMeasure=S.prototype.fI;S.prototype.pI=function(){return this.cC};S.prototype.getPrint=S.prototype.pI;S.prototype.$f=function(){return this.lL};
S.prototype.getControls=S.prototype.$f;S.prototype.fb.prototype.Dm=function(){B.log("nsVmap.nsToolsManager.BasicTools.basictoolsController.displayMobileMenu");this.b.bMobileMenuOpen=!0};S.prototype.fb.prototype.displayMobileMenu=S.prototype.fb.prototype.Dm;
S.prototype.fb.prototype.qc=function(){B.log("nsVmap.nsToolsManager.BasicTools.basictoolsController.hideMobileMenu");this.b.bMobileMenuOpen=!1;this.b.bMobileLocationMenuOpen=!1;this.b.bMobileLayersMenuOpen=!1;this.b.bMobileAdvancedMenuOpen=!1;this.b.bMobileRequeteurOpen=!1;this.Jh();$(this.Us).find(".sublinks.collapse.in").collapse("hide")};S.prototype.fb.prototype.hideMobileMenu=S.prototype.fb.prototype.qc;
S.prototype.fb.prototype.MG=function(){B.log("nsVmap.nsToolsManager.BasicTools.basictoolsController.displayLocationMobileMenu");this.qc();this.b.bMobileLocationMenuOpen=!0;this.Dm()};S.prototype.fb.prototype.displayLocationMobileMenu=S.prototype.fb.prototype.MG;S.prototype.fb.prototype.LG=function(){B.log("nsVmap.nsToolsManager.BasicTools.basictoolsController.displayLayersMobileMenu");this.qc();this.b.bMobileLayersMenuOpen=!0;this.Dm()};S.prototype.fb.prototype.displayLayersMobileMenu=S.prototype.fb.prototype.LG;
S.prototype.fb.prototype.Ap=function(){B.log("nsVmap.nsToolsManager.BasicTools.basictoolsController.displayAdvancedMobileMenu");this.qc();this.b.bMobileAdvancedMenuOpen=!0;this.Dm()};S.prototype.fb.prototype.displayAdvancedMobileMenu=S.prototype.fb.prototype.Ap;S.prototype.fb.prototype.TG=function(){B.log("nsVmap.nsToolsManager.BasicTools.basictoolsController.displayRequeteur");this.qc();this.b.bMobileRequeteurOpen=!0;this.Dm();angular.element($("#vmap-advancedselect-tool")).scope().ctrl.Em([])};
S.prototype.fb.prototype.displayRequeteur=S.prototype.fb.prototype.TG;S.prototype.fb.prototype.Jh=function(){B.log("nsVmap.nsToolsManager.BasicTools.basictoolsController.closeSelectionPopup");angular.element($("#vmap-basicselect-tool")).scope().ctrl.Jh()};S.prototype.fb.prototype.oK=function(){B.log("nsVmap.nsToolsManager.BasicTools.basictoolsController.locationGoHome");this.qc();angular.element($("#location-search-tool")).scope().ctrl.goHome()};S.prototype.fb.prototype.locationGoHome=S.prototype.fb.prototype.oK;
S.prototype.fb.prototype.mK=function(){B.log("nsVmap.nsToolsManager.BasicTools.basictoolsController.locationGeolocateMe");this.qc();B.g().At()};S.prototype.fb.prototype.locationGeolocateMe=S.prototype.fb.prototype.mK;S.prototype.fb.prototype.qK=function(){B.log("nsVmap.nsToolsManager.BasicTools.basictoolsController.locationMaxExtent");this.qc();angular.element($("#location-search-tool")).scope().ctrl.maxExtent()};S.prototype.fb.prototype.locationMaxExtent=S.prototype.fb.prototype.qK;
S.prototype.fb.prototype.nK=function(){B.log("nsVmap.nsToolsManager.BasicTools.basictoolsController.locationGoCoordinates");this.b.locationGoToProjection="EPSG:4326";this.b.locationGoToX="";this.b.locationGoToY="";this.b.locationProjections=angular.element($("#location-search-tool")).scope().ctrl.projections;$("#location-goto-modal").modal("show")};S.prototype.fb.prototype.locationGoCoordinates=S.prototype.fb.prototype.nK;
S.prototype.fb.prototype.pK=function(a,b,c){B.log("nsVmap.nsToolsManager.BasicTools.basictoolsController.locationGoTo");$("#location-goto-modal").modal("hide");this.qc();angular.element($("#location-search-tool")).scope().ctrl.goTo(a,b,c)};S.prototype.fb.prototype.locationGoTo=S.prototype.fb.prototype.pK;B.module.directive("appBasictools",S.prototype.Ny);B.module.controller("AppBasictoolsController",S.prototype.fb);function V(){B.log("nsVmap.nsToolsManager.InfoContainer")}qa("nsVmap.nsToolsManager.InfoContainer",V);V.prototype.ef=function(){B.log("nsVmap.nsToolsManager.InfoContainer.showBar");ae(function(){angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(a){a.ctrl.ef()})})};V.prototype.showBar=V.prototype.ef;
V.prototype.jb=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.addTab");if(!n(a))return"opt_options not defined";if(!n(a.Ta))return"opt_options.tabCode not defined";if(!n(a.wb))return"opt_options.tabName not defined";angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){var c=new gA(a);b.ctrl.jb(c)})};V.prototype.addTab=V.prototype.jb;
V.prototype.wN=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.setTab");if(!n(a))return"opt_options not defined";if(!n(a.Ta))return"opt_options.tabCode not defined";if(!n(a.wb))return"opt_options.tabName not defined";var b=angular.element($("#infocontainer-info-container")).scope();if(void 0!==b.ctrl.infos)for(var c=b.ctrl.infos.length-1;0<=c;c--)b.ctrl.infos.splice(c,1);b.$evalAsync(function(b){var c=new gA(a);b.ctrl.jb(c)})};V.prototype.setTab=V.prototype.wN;
V.prototype.To=function(a,b){B.log("nsVmap.nsToolsManager.InfoContainer.addRow");if(void 0===a.Ta&&void 0===a.tabIndex)return"bad tab_options";if(void 0===b.data)return"row_options.data undefined";angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(c){c.ctrl.To(a,b);c.ctrl.Pn()});return!0};V.prototype.addRow=V.prototype.To;
V.prototype.mt=function(a,b){B.log("nsVmap.nsToolsManager.InfoContainer.addMultipleRows");if(void 0===a.Ta&&void 0===a.tabIndex)return"bad tab_options";if(void 0===b.data)return"row_options.data undefined";angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(c){for(var d,e=0;e<b.data.length;e++)d={data:b.data[e],Kh:b.Kh,xe:b.xe},c.ctrl.To(a,d);c.ctrl.Pn()});return!0};V.prototype.addMultipleRows=V.prototype.mt;
V.prototype.Pn=function(){B.log("nsVmap.nsToolsManager.InfoContainer.refreshTabs");angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(a){a.ctrl.Pn()});return!0};V.prototype.refreshTabs=V.prototype.Pn;V.prototype.te=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.displayTabByCode");angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){b.ctrl.te(a)})};V.prototype.displayTabByCode=V.prototype.te;
V.prototype.Ik=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.displayTabByIndex");angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){b.ctrl.Ik(a)})};V.prototype.displayTabByIndex=V.prototype.Ik;V.prototype.JG=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.displayInfos");this.ef();this.xi(a)};V.prototype.displayInfos=V.prototype.JG;
V.prototype.Va=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.getTabByCode");a=angular.element($("#infocontainer-info-container")).scope().ctrl.Va(a);if(void 0!==a)return jQuery.extend(!0,{},a)};V.prototype.getTabByCode=V.prototype.Va;V.prototype.an=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.getTabTable");return angular.element($("#infocontainer-info-container")).scope().ctrl.an(a)};V.prototype.getTabTable=V.prototype.an;
V.prototype.PH=function(){B.log("nsVmap.nsToolsManager.InfoContainer.getInfos");var a=angular.element($("#infocontainer-info-container")).scope().ctrl.infos;return jQuery.extend(!0,[],a)};V.prototype.getInfos=V.prototype.PH;V.prototype.xi=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.setInfos");B.log(a);angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){b.ctrl.xi(a)})};V.prototype.setInfos=V.prototype.xi;
V.prototype.qk=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.addInfos");B.log(a);angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){b.ctrl.qk(a)})};V.prototype.addInfos=V.prototype.qk;V.prototype.Ir=function(a){var b=angular.element($("#infocontainer-info-container")).scope(),c=b.ctrl.infos;if(void 0===a||void 0===c)return 0;for(var d=c.length-1;0<=d;d--)c[d].tabCode===a&&c.splice(d,1);b.$evalAsync(function(a){hA(a.ctrl)})};V.prototype.removeTabByCode=V.prototype.Ir;
V.prototype.removeAll=function(){B.log("nsVmap.nsToolsManager.InfoContainer.removeAll");B.g().Cn.clear();var a=angular.element($("#infocontainer-info-container")).scope(),b=a.ctrl.infos;if(void 0===b)return 0;for(var c=b.length-1;0<=c;c--)b.splice(c,1);a.$evalAsync(function(a){hA(a.ctrl)})};V.prototype.removeAll=V.prototype.removeAll;
V.prototype.Jr=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.removeTabRows");if(void 0===a)return 0;angular.element($("#infocontainer-info-container")).scope();var b=this.Va(a);this.an(b);for(b=b.tableParams.data.length-1;0<=b;b--)this.cw(a,b)};V.prototype.removeTabRows=V.prototype.Jr;
V.prototype.cw=function(a,b){B.log("nsVmap.nsToolsManager.InfoContainer.removeRow");var c=angular.element($("#infocontainer-info-container")).scope(),d=c.ctrl.infos;if(void 0===a||void 0===d||void 0===b)return 0;var e=this.Va(a),e=this.an(e).bootstrapTable("getData")[b];n(e.feature)&&B.g().Ae.s().Jb(e.feature);for(e=d.length-1;0<=e;e--)d[e].tabCode===a&&d[e].tableParams.data.splice(b,1);c.$evalAsync(function(a){hA(a.ctrl)})};V.prototype.removeRow=V.prototype.cw;
V.prototype.nm=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.zoomOnTabFeatures");if(!n(a))return"tabCode not defined";angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){b.ctrl.nm(a)})};V.prototype.zoomOnTabFeatures=V.prototype.nm;V.prototype.uf=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.displayTabFeatures");if(!n(a))return"tabCode not defined";angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){b.ctrl.uf(a)})};
V.prototype.displayTabFeatures=V.prototype.uf;
function gA(a){B.log("nsVmap.nsToolsManager.InfoContainer.Tab");if(!n(a)||!n(a.Ta)||!n(a.wb))return 0;var b=[],c=[],d={},e="";a.data=n(a.data)?a.data:[];a.Na=n(a.Na)?a.Na:[];a.xe=n(a.xe)?function(){var b=a.xe;Oa(b,"feature")||b.push("feature");return b}():["feature"];for(var f=0;f<a.Na.length;f++)"delete"===a.Na[f]?(e="info-container-goog_"+Ha++ +"-remove-feature",c.push('<a class="'+e+'" href="javascript:void(0)" title="Enlever du panier">'),c.push('<i class="glyphicon glyphicon-remove padding-sides-5"></i>'),c.push("</a>"),
d["click ."+e]=function(b,c,d,e){B.D.R.cw(a.Ta,e)}):"zoom"===a.Na[f]&&(e="info-container-goog_"+Ha++ +"-zoom-feature",c.push('<a class="'+e+'" href="javascript:void(0)" title="Zoom sur la g\u00e9om\u00e9trie">'),c.push('<i class="glyphicon glyphicon-globe padding-sides-5"></i>'),c.push("</a>"),d["click ."+e]=function(a,b,c){if(!n(c.feature))return console.error('Aucune g\u00e9om\u00e9trie renseign\u00e9e dans la colone "feature"'),0;B.g().rv([c.feature],!0,!0)});b.push({checkbox:!0,clickToSelect:!0,
"class":"info-container-checkbox-column"});b.push({formatter:function(){return c.join("")},"class":"info-container-list-events-column",events:d});a.Kh=n(a.Kh)?a.Kh:function(){for(var c in a.data[0])b.push({field:c,title:c,sortable:!0,visible:!Oa(a.xe,c)});return b}();d={search:!0,checkboxHeader:!0,data:a.data,columns:a.Kh};this.tabCode=a.Ta;this.tabName=a.wb;this.tableParams=d}V.Tab=gA;
V.prototype.KA=function(){B.log("nsVmap.nsToolsManager.InfoContainer.prototype.infocontainerDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",infos:"=appInfos"},controller:"AppInfocontainerController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/tools/infocontainer.html"}};V.prototype.infocontainerDirective=V.prototype.KA;
V.prototype.rb=function(a,b){B.log("nsVmap.nsToolsManager.InfoContainer.prototype.infocontainerController");this.$timeout=a;this.b=b;this.infos=[];this.selectedTabIndex=0;this.avaliablePrintReports=[];B.scope.$on("mapChanged",function(){B.D.R.removeAll()})};V.prototype.infocontainerController=V.prototype.rb;V.prototype.rb.$inject=["$timeout","$scope"];
V.prototype.rb.prototype.ef=function(){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.showBar");"hidden"===$("#opener-bottombar").css("visibility")&&$("#opener-bottombar").css("visibility","visible");$("#map-container").addClass("minus");this.$timeout(function(){!1===$("#map-container").hasClass("open")&&!1===$("#map-container").hasClass("open2")&&B.Vl("opener-bottombar-1")})};
V.prototype.rb.prototype.Ik=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.displayTabByIndex");this.selectedTabIndex=a};V.prototype.rb.prototype.displayTabByIndex=V.prototype.rb.prototype.Ik;V.prototype.rb.prototype.te=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.displayTabByCode");for(var b=0;b<this.infos.length;b++)if(this.infos[b].tabCode===a)var c=b;this.Ik(c)};V.prototype.rb.prototype.displayTabByCode=V.prototype.rb.prototype.te;
l=V.prototype.rb.prototype;l.Va=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.getTabByCode");for(var b=0;b<this.infos.length;b++)if(this.infos[b].tabCode===a)return this.infos[b]};l.an=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.getTabTable");return void 0===a?0:$("#infocontainer-table-"+a.index)};
l.jb=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.addTab");for(var b=0;b<this.infos.length;b++)if(this.infos[b].tabCode===a.tabCode){var c=!0;B.log('onglet "'+this.infos[b].tabCode+'"" d\u00e9j\u00e0 pr\u00e9sent');this.infos[b]=a}void 0===c&&this.infos.push(a);var d=this;this.$timeout(function(){hA(d)})};
l.To=function(a,b){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.addRow");if(void 0===a.Ta&&void 0===a.tabIndex)return"bad tab_options";if(void 0===b.data)return"row_options.data undefined";b.xe=n(b.xe)?function(){var a=b.xe;Oa(a,"feature")||a.push("feature");return a}():["feature"];var c=n(a.Ta)?this.Va(a.Ta):this.infos[a.tabIndex];if(null==c)return cosnole.error("impossible de trouver la tab, tab_options:",a),0;a=n(b.Kh)?b.Kh:function(){var a=[],c;for(c in b.data)a.push({field:c,
title:c,sortable:!0,visible:!Oa(b.xe,c)});return a}();for(var d=0;d<c.tableParams.data.length;d++){bRowExists=!0;for(var e=0;e<a.length;e++)"feature"!==a[e].field&&!1===gb(c.tableParams.data[d],b.data[a[e].field])&&(bRowExists=!1);if(!0===bRowExists)return B.log("ligne d\u00e9j\u00e0 existante"),"ligne d\u00e9j\u00e0 existante"}for(d=0;d<a.length;d++){for(var f=!1,e=0;e<c.tableParams.columns.length;e++)c.tableParams.columns[e].field===a[d].field&&(f=!0);!1===f&&Qa(c.tableParams.columns,a[d])}a={};
for(var g in b.data)r(b.data[g])?(B.pn(b.data[g],"bo_link")&&(b.data[g]=B.Jn(b.data[g],"bo_link")),a[g]=B.$sanitize(b.data[g])):a[g]=b.data[g];Qa(c.tableParams.data,a);return!0};l.Pn=function(){var a=this;this.$timeout(function(){hA(a)})};
l.qk=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.addInfos");if(void 0===a)return 0;if(0===this.infos.length)return this.xi(a);for(var b=0;b<a.length;b++){for(var c=!1,d=0;d<this.infos.length;d++)if(this.infos[d].tabCode===a[b].tabCode)for(var c=!0,e=0;e<a[b].tableParams.data.length;e++)Qa(this.infos[d].tableParams.data,a[b].tableParams.data[e]);!1===c&&Qa(this.infos,a[b])}var f=this;this.$timeout(function(){hA(f)})};
l.xi=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.setInfos");if(void 0===a)return 0;this.infos=a;var b=this;this.$timeout(function(){hA(b)})};
l.Jr=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.removeTabRows");if(void 0===a)return 0;$("body").css({cursor:"wait"});a=this.Va(a);for(var b={},c=a.tableParams.data.length-1;0<=c;c--)b=a.tableParams.data[c],Oa(B.g().Ae.s().Ca(),b.feature)&&B.g().Ae.s().Jb(b.feature),a.tableParams.data.splice(c,1);$("body").css({cursor:""});var d=this;this.$timeout(function(){hA(d)})};V.prototype.rb.prototype.removeTabRows=V.prototype.rb.prototype.Jr;
V.prototype.rb.prototype.Hr=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.removeTab");for(var b=this,c=!1,d=!1,e=0,f=0,g,h=0;h<this.infos.length;h++)this.infos[h].index===a.index&&(e=angular.copy(h));null!=this.selectedTabIndex&&null!=this.infos[this.selectedTabIndex]&&(c=!0,g=angular.copy(this.infos[this.selectedTabIndex].index));this.Ir(a.tabCode);setTimeout(function(){if(c)for(var a=0;a<b.infos.length;a++)b.infos[a].index===g&&(f=angular.copy(a),console.log("tab already displayed !"));
null!=b.selectedTabIndex&&null!=e&&b.selectedTabIndex===e&&(d=!0);d&&(null!=b.infos[e]?f=e:null!=b.infos[e-1]&&(f=e-1));b.b.$applyAsync(function(){b.Ik(f)})})};V.prototype.rb.prototype.removeTab=V.prototype.rb.prototype.Hr;V.prototype.rb.prototype.Ir=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.removeTabByCode");for(var b=this.infos,c=b.length-1;0<=c;c--)b[c].tabCode===a&&(this.Jr(a),b.splice(c,1))};V.prototype.rb.prototype.removeTabByCode=V.prototype.rb.prototype.Ir;
V.prototype.rb.prototype.nm=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.zoomOnTabFeatures");if(!n(a))return"tabCode not defined";var b=[];a=this.Va(a).tableParams.data;for(var c=a.length-1;0<=c;c--)n(a[c].feature)&&Qa(b,a[c].feature);B.g().aD(b,!1,!0)};V.prototype.rb.prototype.zoomOnTabFeatures=V.prototype.rb.prototype.nm;
V.prototype.rb.prototype.uf=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.displayTabFeatures");if(!n(a))return"tabCode not defined";var b=[];a=this.Va(a).tableParams.data;for(var c=a.length-1;0<=c;c--)n(a[c].feature)&&Qa(b,a[c].feature);if(0===b.length)return 0;for(c=b.length-1;0<=c;c--)Oa(B.g().Ae.s().Ca(),b[c])&&B.g().Ae.s().Jb(b[c]),B.g().Ae.s().xb(b[c])};V.prototype.rb.prototype.displayTabFeatures=V.prototype.rb.prototype.uf;
function hA(a){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.loadTables");for(var b=a.infos.length-1;0<=b;b--)$("#infocontainer-table-"+b).bootstrapTable("destroy"),$("#infocontainer-table-"+b).bootstrapTable(a.infos[b].tableParams),$("#infocontainer-table-"+b).bootstrapTable("load",a.infos[b].tableParams),$("#infocontainer-table-"+b).bootstrapTable("resetView",a.infos[b].tableParams),$("#infocontainer-table-"+b).bootstrapTable("resetWidth")}
V.prototype.rb.prototype.fN=function(a){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.setReports");var b=this;q(this.avaliablePrintReports)?this.avaliablePrintReports.length=0:this.avaliablePrintReports=[];if(null==a)return $.notify("Aucun rapport disponible","warning"),0;A({method:"GET",url:B.properties.api_url+"/vmap/printreports",headers:{Accept:"application/x-vm-json"},params:{attributs:"name|printreport_id|business_object_id|business_object_id_field|multiobject",filter:{column:"business_object_id",
compare_operator:"=",value:a}},scope:this.b,success:function(c){if(null==c.data)return console.error("response.data undefined: ",c),$("#infocontainer-dropdown-reports").dropdown("toggle"),0;if(null==c.data.data)return $.notify("Aucun rapport disponible pour "+a,"warning"),$("#infocontainer-dropdown-reports").dropdown("toggle"),0;b.avaliablePrintReports=c.data.data}})};V.prototype.rb.prototype.setAvaliablePrintReports=V.prototype.rb.prototype.fN;
V.prototype.rb.prototype.Up=function(a,b){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.generatePrintReport");b=$("#infocontainer-table-"+b).bootstrapTable("getSelections");if(!q(b))return $.notify("Impossible de r\u00e9cup\u00e9rer la s\u00e9lection du tableau"),0;if(0>=b.length)return $.notify("Aucun \u00e9l\u00e9ment s\u00e9lectionn\u00e9"),0;for(var c=[],d=0;d<b.length;d++)null!=b[d][a.business_object_id_field]&&c.push(b[d][a.business_object_id_field]);if(0< !c.length)return $.notify("G\u00e9n\u00e9ration du document impossible"),
console.error("generated aIds is empty"),0;B.Up({printReportId:a.printreport_id,ids:c})};V.prototype.rb.prototype.generatePrintReport=V.prototype.rb.prototype.Up;V.prototype.rb.prototype.hu=function(a,b){B.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.exportTable");$("#infocontainer-table-"+a).tableExport({type:b,escape:!1})};V.prototype.rb.prototype.exportTable=V.prototype.rb.prototype.hu;B.module.directive("appInfocontainer",V.prototype.KA);
B.module.controller("AppInfocontainerController",V.prototype.rb);Ox.Bn={};
function W(a){B.log("nsVmap.nsToolsManager.nsModules.Draw");a=n(a)?a:{};this.fields_=[{name:"Nom",id:"Nom",type:"text",required:"true",value:""},{name:"Th\u00e8me / Projet",id:"theme",type:"text",required:"false",value:""},{name:"Commentaire",id:"commentaire",type:"text",required:"false",value:""},{name:"Afficher l'\u00e9tiquette",id:"ShowName",type:"boolean",required:"",value:""},{name:"Afficher la partie vectorielle",id:"ShowVector",type:"boolean",required:"",value:""},{name:"Couleur de fond",id:"Fill",
type:"color",required:"false",value:"rgba(54,184,255,0.6)"},{name:"Couleur du contour",id:"Stroke",type:"color",required:"false",value:"rgba(0,0,0,0.4)"},{name:"Taille du contour",id:"StrokeSize",type:"number",required:"false",value:"2"},{name:"Couleur du texte",id:"Text",type:"color",required:"false",value:"rgba(0,0,0,1)"},{name:"Fond du texte",id:"TextBackground",type:"color",required:"false",value:"rgba(48,183,255,1)"},{name:"Taille du texte",id:"TextSize",type:"number",required:"false",value:"12"}];
this.features_=a.features}qa("nsVmap.nsToolsManager.nsModules.Draw",W);Ox.Bn.Draw=W;W.prototype.aH=function(){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawDirective");return{restrict:"C",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppdrawController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/modules/draw.html"}};
W.prototype.ga=function(){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController");this.fields_=B.D.Hu("Draw").hA();this.features_=B.D.Hu("Draw").Ca();this.exportFormats_=["GeoJSON"];this.exportFormatsConstructors_=[Ur];this.Mo=new Mg(6378137);this.W=B.g().B;this.he=Gq(B.g());this.dd=this.he.s().Hb;this.Fd=new ot({features:this.dd});this.Gp=new Oy({vb:[this.he]});this.Gp.on("select",function(){var a=this.Gp.Ca().P();this.Fp(a[0]);this.Gp.Ca().clear()},this);this.Vr=new Oy({vb:[this.he]});
this.Vr.on("select",function(){var a=this.Vr.Ca().P();this.Tt(a[0]);this.Vr.Ca().clear()},this);this.cf=new Oy({vb:[this.he],Xb:Gj});this.Vc=new Oy({vb:[this.he]});this.Vc.on("select",function(){var a=this.Vc.Ca().P();this.Er(a)},this);this.lj=document.getElementById("geodesic");void 0!==this.features_&&this.Rf(this.features_)};W.prototype.drawController=W.prototype.ga;
function iA(a,b){a.Hc&&a.Hc.parentNode.removeChild(a.Hc);a.Hc=document.createElement("div");a.Hc.className="draw-tooltip draw-tooltip-draw";a.hj=new ur({element:a.Hc,offset:[0,-15],Al:"bottom-center"});a.hj.set("type","draw");void 0!==b&&a.hj.set("feature",b);a.W.Hg(a.hj)}
function jA(a,b){if(void 0!==b.get("infoValues")){var c=0;iA(a,b);for(key in b.get("infoValues"))0==c&&(a.Hc.innerHTML=b.get("infoValues")[key]),c++;a.hj.setPosition(a.sj(b.j()));a.Hc.className="draw-tooltip draw-tooltip-static";a.hj.set(xr,[0,-7]);a.Hc.style.color=b.get("infoValues").Text;a.Hc.style.backgroundColor=b.get("infoValues").TextBackground;a.Hc.style.fontSize=b.get("infoValues").TextSize;"false"===b.get("infoValues").ShowName&&(a.Hc.style.opacity=0);"false"===b.get("infoValues").ShowVector&&
(a.Hc.style.opacity=0);a.Hc=null;iA(a,b);a.Ul();kA()}}W.prototype.ga.prototype.sj=function(a){if("Polygon"===a.F())a=Qh(ti(a));else if("MultiPolygon"===a.F()){var b=new md(null);b.ya("XYM",ym(a).slice());a=Qh(b)}else if("LineString"===a.F())b=Math.round(a.T().length/2),a=a.T()[b];else if("Circle"===a.F())a=a.Ka();else if("Point"===a.F()||"MultiPoint"===a.F())a=Qh(a);else return"GeometryCollection"===a.F()?0:Qh(a);return a};
W.prototype.ga.prototype.Ob=function(a){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.prototype.addInteraction");B.g().za.Ja("Cliquer pour commencer \u00e0 dessiner");this.yb=B.g().sh({type:a,features:this.dd},"draw-draw"+a);this.yb.on("drawstart",function(){"Point"===a||"Circle"===a?B.g().za.Ja("Cliquez pour terminer le dessin"):"LineString"!==a&&"Polygon"!==a||B.g().za.Ja("Double-cliquez pour terminer le dessin")},this);this.yb.on("drawend",function(a){$("#draw-edit-modal-header").addClass("hidden");
this.Rj(a.ka);this.Fp(a.ka);B.g().za.hide();a.ka.on("change",function(){aOverlays=B.g().B.fd;for(var b=aOverlays.P().length-1;0<=b;b--)aOverlays.P()[b].get("feature")===a.ka&&aOverlays.P()[b].setPosition(this.sj(a.ka.j()));this.Rj(a.ka)},this)},this)};
W.prototype.ga.prototype.Rf=function(a){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.prototype.addFeatures");for(var b=[Iu,Ur,mv,tv,Fx],c=[],d=0;d<b.length;d++){var e=new b[d];try{var f=e.si(a);0<f.length&&(c=f,d=b.length)}catch(h){}}for(d=0;d<c.length;d++){"Cercle"===c[d].get("Type")&&(a=c[d].get("Coordinates")[0],b=c[d].get("Coordinates")[1],e=new Hq([NaN,NaN]),vy(e,a,b,"XY"),c[d].jd(e));this.he.s().xb(c[d]);jA(this,c[d]);lA(c[d]);var g=this;c[d].on("change",function(){aOverlays=
B.g().B.fd;for(var a=aOverlays.P().length-1;0<=a;a--)aOverlays.P()[a].get("feature")===this&&aOverlays.P()[a].setPosition(g.sj(this.j()));g.Rj(this)},c[d])}};W.prototype.ga.prototype.addFeatures=W.prototype.ga.prototype.Rf;
W.prototype.ga.prototype.aw=function(a){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.prototype.removeFeatures");for(var b=a.length-1;0<=b;b--){aOverlays=B.g().B.fd.P();aDrawsToDelete=[];for(var c=aOverlays.length-1;0<=c;c--)aOverlays[c].get("feature")!==a[b]&&"info"!==aOverlays[c].get("feature")||aDrawsToDelete.push(aOverlays[c]);for(c=aDrawsToDelete.length-1;0<=c;c--)B.g().B.fd.remove(aDrawsToDelete[c]);this.he.s().Jb(a[b]);kA()}a=this.dd.P();for(b=0;b<a.length;b++)a[b].set("Id",
b)};W.prototype.ga.prototype.removeFeatures=W.prototype.ga.prototype.aw;
W.prototype.ga.prototype.Er=function(a){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.prototype.removeFeaturesWithControl");var b=0,c=[],d=[],e=this,f="",g=E(this.W).Ka(),h=E(this.W).zf();1===a.length&&this.Po(a[0]);for(var k=0;k<a.length;k++)for(key in b=0,d.push(a[k].get("Id")),a[k].get("infoValues"))0===b&&c.push(a[k].get("infoValues")[key]),b++;b="";if(1===c.length)b="<h4>Etes-vous certain de vouloir supprimer le dessin: <br><br> Id: "+d[0]+", Nom: "+c[0]+" ?</h4>";else if(1<
c.length){for(k=0;k<c.length;k++)f+="<br> Id: "+d[k]+", Nom: "+c[k]+"";b="<h4>Etes-vous certain de vouloir supprimer les dessins ci-dessous ? <br>"+f+" </h4>"}else return;bootbox.confirm(b,function(b){!0===b&&e.aw(a);E(e.W).tb(g);E(e.W).Tj(h)})};W.prototype.ga.prototype.removeFeaturesWithControl=W.prototype.ga.prototype.Er;
W.prototype.ga.prototype.EM=function(){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.removeSelectedFeatures");for(var a=$.map($("#draw-features-list-table").bootstrapTable("getSelections"),function(a){return a.column1}),b=[],c=this.dd.P(),d=0;d<a.length;d++)b.push(c[a[d]]);this.Er(b)};W.prototype.ga.prototype.removeSelectedFeatures=W.prototype.ga.prototype.EM;
W.prototype.ga.prototype.UF=function(a){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.prototype.calcelEditFeature");void 0===a.get("infoValues")&&this.aw([a]);kA()};W.prototype.ga.prototype.calcelEditFeature=W.prototype.ga.prototype.UF;
function lA(a){if(void 0!==a.get("infoValues")){var b=a.get("infoValues").Fill,c=a.get("infoValues").Stroke,d=a.get("infoValues").StrokeSize,e;"false"===a.get("infoValues").ShowVector&&(c=b="rgba(255, 255, 255, 0)");""===b||void 0===b?(b="rgba(54,184,255,0.6)",e="rgba(255,255,255,1)"):e=b;if(""===c||void 0===c)c="rgba(255,255,255,1)";if(""===d||void 0===d)d=2;a.le(new Tp({fill:new Sp({color:b}),stroke:new Tn({color:c,width:d}),kb:new Rp({cb:7,fill:new Sp({color:e}),stroke:new Tn({color:c,width:d})})}))}}
W.prototype.ga.prototype.Rj=function(a){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.setInfosToFeature");if(void 0===a.get("Id")){var b=this.dd.cc();a.set("Id",b)}a.set(this.fields_[0].name,"");if(a.j()instanceof ii)a.set("Type","Point"),a.set("P\u00e9rim\u00e8tre/longueur","-"),a.set("Superficie","-"),a.set("Coordinates",a.j().T());else if(a.j()instanceof mr)a.set("Type","Ligne"),a.set("P\u00e9rim\u00e8tre/longueur",this.vf(a.j())),a.set("Superficie","-"),a.set("Coordinates",
a.j().T());else if(a.j()instanceof qi)a.set("Type","Polygone"),a.set("P\u00e9rim\u00e8tre/longueur",this.mu(a.j())),a.set("Superficie",this.Tm(a.j())),a.set("Coordinates",a.j().T());else if(a.j()instanceof Hq){var c=parseFloat(this.kj(a.j())),b=this.kj(a.j()).replace(c,""),d=Math.PI*c*2,c=Math.PI*Math.pow(c,2);a.set("Type","Cercle");a.set("P\u00e9rim\u00e8tre/longueur",d.toFixed(4)+b);a.set("Superficie",c.toFixed(4)+b+"\u00b2");a.set("Coordinates",[a.j().Ka(),a.j().yf()])}else a.set("Type","undefined"),
a.set("P\u00e9rim\u00e8tre/longueur","-"),a.set("Superficie","-")};W.prototype.ga.prototype.setInfosToFeature=W.prototype.ga.prototype.Rj;
W.prototype.ga.prototype.SO=function(a,b){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.prototype.updateFeatureInfos");$(".modal").modal("hide");for(var c={},d=B.g().B.fd,e,f,g,h,k,m,p,t,u=0;u<this.fields_.length;u++)"Fill"===this.fields_[u].id?e=$("#print-"+b[u].id+"-input").val():"Stroke"===this.fields_[u].id?f=$("#print-"+b[u].id+"-input").val():"Text"===this.fields_[u].id?g=$("#print-"+b[u].id+"-input").val():"TextBackground"===this.fields_[u].id?h=$("#print-"+b[u].id+"-input").val():
"TextSize"===this.fields_[u].id?k=$("#print-"+b[u].id+"-input").val():"StrokeSize"===this.fields_[u].id?m=$("#print-"+b[u].id+"-input").val():"ShowName"===this.fields_[u].id?(p=$("#print-"+b[u].id+"-input")[0].checked,$("#print-"+b[u].id+"-input").val(p)):"ShowVector"===this.fields_[u].id&&(t=$("#print-"+b[u].id+"-input")[0].checked,$("#print-"+b[u].id+"-input").val(t));!1===t&&(f=e="rgba(255, 255, 255, 0)",p=!1);""===e?(e="rgba(54,184,255,0.6)",t="rgba(255,255,255,1)"):t=e;""===f&&(f="rgba(255,255,255,1)");
""===m&&(m=2);a.le(new Tp({fill:new Sp({color:e}),stroke:new Tn({color:f,width:parseFloat(m)}),kb:new Rp({cb:7,fill:new Sp({color:t}),stroke:new Tn({color:f,width:parseFloat(m)})})}));for(u=d.P().length-1;0<=u;u--)d.P()[u].get("feature")===a&&d.remove(d.P()[u]);iA(this,a);for(u=0;u<b.length;u++)0===u&&(this.Hc.innerHTML=$("#print-"+b[u].id+"-input").val(),a.set(b[u].name,$("#print-"+b[u].id+"-input").val())),c[b[u].id]=$("#print-"+b[u].id+"-input").val();a.set("infoValues",c);this.hj.setPosition(this.sj(a.j()));
this.Hc.className="draw-tooltip draw-tooltip-static";this.hj.set(xr,[0,-7]);this.Hc.style.color=g;this.Hc.style.backgroundColor=h;this.Hc.style.fontSize=k;!1===p&&(this.Hc.style.opacity=0);this.Hc=null;iA(this,a);this.Ul();kA();B.log("updateFeatureInfos done")};W.prototype.ga.prototype.updateFeatureInfos=W.prototype.ga.prototype.SO;l=W.prototype.ga.prototype;
l.vf=function(a){this.lj.checked&&"EPSG:3857"==E(this.W).J().Z||"EPSG:4326"==E(this.W).J().Z?(a=a.T(),a=this.xm(a)):a=a.cc();return 1E3<a?Math.round(a/1E3*100)/100+" km":Math.round(100*a)/100+" m"};l.xm=function(a){length=0;for(var b=E(this.W).J(),c=0,d=a.length-1;c<d;++c){var e=th(a[c],b,"EPSG:4326"),f=th(a[c+1],b,"EPSG:4326");length+=Ng(e,f,this.Mo.cb)}return length};l.Zz=function(a){return output=[a.T()[0].toFixed(4),a.T()[1].toFixed(4)]};
l.kj=function(a){this.lj.checked&&"EPSG:3857"==E(this.W).J().Z||"EPSG:4326"==E(this.W).J().Z?(a=[Ph(a),Qh(a)],a=this.xm(a)):a=Math.round(100*a.yf())/100;return 1E3<a?Math.round(a/1E3*100)/100+" km":Math.round(100*a)/100+" m"};l.mu=function(a){a=new mr(a.T()[0],a.gb);return output=this.vf(a)};
l.Tm=function(a){if(this.lj.checked&&"EPSG:3857"==E(this.W).J().Z||"EPSG:4326"==E(this.W).J().Z){var b=E(this.W).J();a=ui(a.clone().transform(b,"EPSG:4326")).T();a=Math.abs(Og(a,this.Mo.cb))}else a=a.Pk();return 1E6<a?Math.round(a/1E6*100)/100+" km\u00b2":Math.round(100*a)/100+" m\u00b2"};
l.Po=function(a){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.zoomToFeature");"Point"===a.get("Type")?E(this.W).tb(a.j().T()):"Cercle"===a.get("Type")?(Ji(E(this.W),a.j(),{padding:[0,0,0,0]}),E(this.W).tb(a.j().Ka())):Ji(E(this.W),a.j(),{padding:[0,0,0,0]})};W.prototype.ga.prototype.zoomToFeature=W.prototype.ga.prototype.Po;
function mA(a){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.initExportFeatureButtons");var b=a.dd.P(),c=a.exportFormats_;a=a.exportFormatsConstructors_;for(var d=E(B.g().B).J().Z,e="",f=0;f<c.length;f++)for(f=0;f<a.length;f++){var g=new a[f];try{e=g.mm(b,{xd:d,Ic:d});e=e.replace(/{/g,"{\n");e=e.replace(/}/g,"\n}");if(0==$("#draw-export-"+c[f]+"-button").length){var h=document.createElement("li"),k=document.createElement("a");k.setAttribute("id","draw-export-"+c[f]+"-button");
k.setAttribute("download","Features.json");h.appendChild(k);k.appendChild(document.createTextNode(c[f]));$("#draw-features-list-table").parents(".bootstrap-table").find(".export").find("ul")[0].appendChild(h)}$("#draw-export-"+c[f]+"-button").attr("href","data:text/csv;charset=utf-8,"+encodeURIComponent(e))}catch(m){}}}
W.prototype.ga.prototype.Tt=function(a){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.displayFeatureInfos");this.selectedFeature=a;for(var b=[],c=0;c<this.fields_.length;c++)b.push({field:this.fields_[c].name,result:a.get("infoValues")[this.fields_[c].id]});$("#draw-feature-description-table").bootstrapTable({columns:[{field:"field",title:"",sortable:!0,cellStyle:function(){return{classes:"active bold"}}},{field:"result",title:"",sortable:!0}],data:b,search:!0,showHeader:!1,
showExport:"true",height:.6*$("#feature-description-modal").height(),rowStyle:function(){return{classes:["active","success"]}}});$("#draw-feature-description-table").bootstrapTable("load",b);$(".modal").modal("hide");$("#feature-description-modal").modal("show")};W.prototype.ga.prototype.displayFeatureInfos=W.prototype.ga.prototype.Tt;
W.prototype.ga.prototype.Fp=function(a){function b(a){$("#print-"+c.fields_[a].id+"-input").colorpicker({format:"rgba",color:$("#print-"+c.fields_[a].id+"-input").val()}).on("changeColor",function(){$(this).parent().find(".color-span2").css("background-color",$(this).val())});$("#print-"+c.fields_[a].id+"-input").parent().find(".color-span2").css("background-color",$("#print-"+c.fields_[a].id+"-input").val())}B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.editFeatureInfos");
for(var c=this,d=0;d<this.fields_.length;d++)void 0!=a.get("infoValues")?($("#print-"+this.fields_[d].id+"-input").val(a.get("infoValues")[this.fields_[d].id]),"color"==this.fields_[d].type?b(d):"boolean"==this.fields_[d].type&&("false"==a.get("infoValues")[this.fields_[d].id]?$("#print-"+this.fields_[d].id+"-input").bootstrapToggle("off"):$("#print-"+this.fields_[d].id+"-input").bootstrapToggle("on"))):void 0!=this.fields_[d].value?($("#print-"+this.fields_[d].id+"-input").val(this.fields_[d].value),
"color"==this.fields_[d].type?b(d):"boolean"==this.fields_[d].type&&("false"==[this.fields_[d].value]?$("#print-"+this.fields_[d].id+"-input").bootstrapToggle("off"):$("#print-"+this.fields_[d].id+"-input").bootstrapToggle("on"))):($("#print-"+this.fields_[d].id+"-input").val(""),"boolean"==this.fields_[d].type&&$("#print-"+this.fields_[d].id+"-input").bootstrapToggle("on"),$(".colorpicker").colorpicker({format:"rgba"}).on("changeColor",function(){$(this).parent().find(".color-span2").css("background-color",
$(this).val())}));this.selectedFeature=a;$(".modal").modal("hide");$("#feature-edit-modal").modal("show");$(".bootstrap-toggle").bootstrapToggle()};W.prototype.ga.prototype.editFeatureInfos=W.prototype.ga.prototype.Fp;
W.prototype.ga.prototype.GG=function(){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.displayFeaturesList");var a=this,b=this.dd.P(),c=[];this.sketchesLenght=b.length;if(0===b.length)$(".modal").modal("hide"),$("#draw-features-list-modal").modal("show"),$("#draw-features-list-table").bootstrapTable("load",[]);else{for(var d=b[0].cq(),e=[{field:"state",checkbox:!0},{field:"action",formatter:function(){return'<a class="show-feature margin-sides-5" href="javascript:void(0)" title="Voir"><i class="glyphicon glyphicon-search"></i></a><a class="edit-feature margin-sides-5" href="javascript:void(0)" title="Editer"><i class="glyphicon glyphicon-edit"></i></a><a class="zoom-to-feature margin-sides-5" href="javascript:void(0)" title="Voir sur la carte"><i class="glyphicon glyphicon-globe"></i></a><a class="remove-feature margin-sides-5" href="javascript:void(0)" title="Supprimer"><i class="glyphicon glyphicon-trash"></i></a>'},
events:{"click .show-feature":function(c,d,e){a.Tt(b[e.column1])},"click .edit-feature":function(c,d,e){a.Fp(b[e.column1])},"click .zoom-to-feature":function(c,d,e){$(".modal").modal("hide");a.Po(b[e.column1])},"click .remove-feature":function(c,d,e){$(".modal").modal("hide");a.Er([b[e.column1]])}},"class":"draw-features-list-button-column"}],c=[],f=0;f<b.length;f++){for(var g={},h=0;h<d.length;h++)"geometry"!==d[h]&&"infoValues"!==d[h]&&"tooltip"!==d[h]&&"infoKeys"!==d[h]&&(0===f&&("Coordinates"!==
d[h]?e.push({field:"column"+h,title:d[h],sortable:!0}):e.push({field:"column"+h,title:d[h],sortable:!0,visible:!1})),g["column"+h]=b[f].get(d[h]));c.push(g);delete g}$("#draw-features-list-table").bootstrapTable({columns:e,data:c,search:!0,showColumns:!0,showExport:"true",height:.6*$("#feature-description-modal").height(),rowStyle:function(){return{classes:["active","success"]}}});$("#draw-features-list-table").bootstrapTable("load",c);$(".modal").modal("hide");$("#draw-features-list-modal").modal("show");
mA(this)}};W.prototype.ga.prototype.displayFeaturesList=W.prototype.ga.prototype.GG;W.prototype.ga.prototype.Ul=function(){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.showHideAnotations");document.getElementById("draw-anotations").checked?$(".draw-tooltip-static").show():$(".draw-tooltip-static").hide()};W.prototype.ga.prototype.showHideAnotations=W.prototype.ga.prototype.Ul;
W.prototype.ga.prototype.Nh=function(a){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.drawPoint");kA();a||this.Ob("Point")};W.prototype.ga.prototype.drawPoint=W.prototype.ga.prototype.Nh;W.prototype.ga.prototype.bH=function(a){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.drawLine");kA();a||this.Ob("LineString")};W.prototype.ga.prototype.drawLine=W.prototype.ga.prototype.bH;
W.prototype.ga.prototype.Hm=function(a){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.drawPolygon");kA();a||this.Ob("Polygon")};W.prototype.ga.prototype.drawPolygon=W.prototype.ga.prototype.Hm;W.prototype.ga.prototype.Gm=function(a){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.drawCircle");kA();a||this.Ob("Circle")};W.prototype.ga.prototype.drawCircle=W.prototype.ga.prototype.Gm;
W.prototype.ga.prototype.xv=function(a){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.modifyFeature");kA();a||(B.g().za.Ja("Cliquez sur un dessin pour le modifier"),Dq(B.g(),this.Fd,"draw-modifyFeature"))};W.prototype.ga.prototype.modifyFeature=W.prototype.ga.prototype.xv;
W.prototype.ga.prototype.eH=function(a){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.modifyFeature");kA();a||(B.g().za.Ja("Cliquez sur un dessin pour \u00e9diter les infos"),Dq(B.g(),this.Gp,"draw-editInfosFeature"))};W.prototype.ga.prototype.editInfosClick=W.prototype.ga.prototype.eH;
W.prototype.ga.prototype.EN=function(a){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.showInfosClick");kA();a||(B.g().za.Ja("Cliquez sur un dessin pour voir les infos"),Dq(B.g(),this.Vr,"showInfosFeature"))};W.prototype.ga.prototype.showInfosClick=W.prototype.ga.prototype.EN;
W.prototype.ga.prototype.Pt=function(a){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.deleteFeature");kA();a||(B.g().za.Ja("Cliquez sur un dessin pour le supprimer"),Dq(B.g(),this.Vc,"draw-deleteFeature"))};W.prototype.ga.prototype.deleteFeature=W.prototype.ga.prototype.Pt;
W.prototype.ga.prototype.zp=function(){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.deleteAllFeatures");kA();this.dd.clear();for(var a=B.g().B.fd.P(),b=[],c=a.length-1;0<=c;c--)"draw"===a[c].get("type")&&b.push(a[c]);for(c=b.length-1;0<=c;c--)B.g().B.fd.remove(b[c]);aFeatures=this.dd.P();for(c=0;c<aFeatures.length;c++)aFeatures[c].set("Id",c)};W.prototype.ga.prototype.deleteAllFeatures=W.prototype.ga.prototype.zp;
function kA(){B.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.removeDrawsInteractions");B.g().za.hide();B.g().Ce()}B.module.directive("appDraw",W.prototype.aH);B.module.controller("AppdrawController",W.prototype.ga);W.prototype.hA=function(){return this.fields_};W.prototype.getFields=W.prototype.hA;W.prototype.kN=function(a){this.fields_=a};W.prototype.setFields=W.prototype.kN;W.prototype.Ca=function(){return this.features_};W.prototype.getFeatures=W.prototype.Ca;
W.prototype.jN=function(a){this.features_=a};W.prototype.setFeatures=W.prototype.jN;function Y(){B.log("nsVmap.nsToolsManager.nsModules.Cadastre")}qa("nsVmap.nsToolsManager.nsModules.Cadastre",Y);Ox.Bn.Cadastre=Y;Y.prototype.aO=function(a){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.tableCheckAll");$(a).bootstrapTable("checkAll");$(a).bootstrapTable("toggleView");$(a).bootstrapTable("toggleView")};Y.prototype.tableCheckAll=Y.prototype.aO;
Y.prototype.cO=function(a){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.tableCheckAll");$(a).bootstrapTable("uncheckAll");$(a).bootstrapTable("toggleView");$(a).bootstrapTable("toggleView")};Y.prototype.tableUncheckAll=Y.prototype.cO;
Y.prototype.TF=function(){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreDirective");return{restrict:"C",scope:{map:"=appMap",lang:"=appLang",selection:"=appInfos",currentAction:"=appAction"},controller:"AppcadastreController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/modules/cadastre.html"}};
Y.prototype.v=function(a,b){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController");this.ig=100;null!=B.properties.cadastre&&null!=B.properties.cadastre.selection_limit&&(this.ig=B.properties.cadastre.selection_limit);this.wt=B.properties.cadastre.selection_buffer;this.isCadastreLightUser=-1===sessionStorage.privileges.indexOf("vmap_cadastre_user")&&-1!==sessionStorage.privileges.indexOf("vmap_cadastre_light_user");this.tmpID_DNUPRO=this.tmpID_PAR=this.searchOnMapCurrentDrawMode=
this.searchOnMapCurrentMode=this.currentParcelleMode=this.currentMode="";this.b=a;this.oParcelleInfos={};this.aCommunes=[];this.aSections=[];this.aAdresses=[];this.locationMultiple=!1;this.tablesSelection={"#Cadastre-rapports-table-parcelle":[],"#Cadastre-rapports-table-comptes":[]};this.Ia=[];this.Pf=0;this.Sy=B.properties.cadastre.database_projection;this.cadastreAPI_=B.properties.cadastre.api;this.aA(B.properties.cadastre.api+"/communes","aCommunes","","nom");$("#Section-table-section").bootstrapTable({data:{}});
$("#Lieu-dit-table-lieu-dit").bootstrapTable({data:{}});$("#Parcelle-table-parcelle").bootstrapTable({data:{}});$("#Parcelle-par-proprietaire-table-comptes").bootstrapTable({data:{}});$("#Parcelle-par-proprietaire-table-parcelles").bootstrapTable({data:{}});$("#Bati-par-proprietaire-table-comptes").bootstrapTable({data:{}});$("#Bati-par-proprietaire-table-invariants").bootstrapTable({data:{}});$("#Bati-par-proprietaire-table-parcelles").bootstrapTable({data:{}});$(".dropdown-menu-auto li a").click(function(){var a=
$(this).text();$(this).parents(".btn-group").find(".dropdown-toggle").find("div").html(a);$(".inactive").removeClass("active")});a.parseFloat=function(a){return parseFloat(a)};a.trim=function(a){return a.trim()};a.isLink=function(a){return B.pn(a,"link")};a.getRenderedParsedLink=function(a){a=B.Jn(a,"link");return b.trustAsHtml(a)}};Y.prototype.cadastreController=Y.prototype.v;Y.prototype.v.$inject=["$scope","$sce"];
Y.prototype.v.prototype.Fe=function(a){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addToCard");B.log("addToCard: "+a);var b=this;setTimeout(function(){"commune"===a?b.$C("#Commune-select-commune"):"section"===a?b.fD("#Section-select-commune","#Section-table-section"):"lieuDit"===a?b.bD("#Lieu-dit-select-commune","#Lieu-dit-table-lieu-dit"):"parcelle"===a?(B.log("addToCard: "+b.currentParcelleMode),"section"===b.currentParcelleMode?b.eD("#Parcelle-select-commune",
"#Parcelle-select-section","#Parcelle-table-parcelle"):"adresse"===b.currentParcelleMode?b.cD("#Parcelle-par-adresse-DGFiP-select-commune","#Parcelle-par-adresse-DGFiP-table-voie","#Parcelle-par-adresse-DGFiP-select-adresse"):"proprietaire"===b.currentParcelleMode&&b.dD("#Parcelle-par-proprietaire-select-commune","#Parcelle-par-proprietaire-table-proprietaire","#Parcelle-par-proprietaire-table-comptes","#Parcelle-par-proprietaire-table-parcelles")):"bati"===a&&b.ZC("#Bati-par-proprietaire-select-commune",
"#Bati-par-proprietaire-table-proprietaire","#Bati-par-proprietaire-table-comptes","#Bati-par-proprietaire-table-invariants","#Bati-par-proprietaire-table-parcelles")},100)};Y.prototype.v.prototype.addToCard=Y.prototype.v.prototype.Fe;
Y.prototype.v.prototype.kK=function(a){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.locateSelection");"commune"===a?this.qv(B.properties.cadastre.api+"/communes","id_com","#Commune-select-commune"):"section"===a?this.kl(B.properties.cadastre.api+"/sections","id_sec","#Section-table-section"):"lieuDit"===a?this.kl(B.properties.cadastre.api+"/lieudits","oid","#Lieu-dit-table-lieu-dit"):"parcelle"===a?(B.log(this.currentParcelleMode),"section"===this.currentParcelleMode?
this.kl(B.properties.cadastre.api+"/parcelles","id_par","#Parcelle-table-parcelle"):"adresse"===this.currentParcelleMode?(B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.localiseParcelleByAdresse"),""!==$("#Parcelle-par-adresse-DGFiP-select-adresse").val()?this.qv(B.properties.cadastre.api+"/parcelles","id_par","#Parcelle-par-adresse-DGFiP-select-adresse"):0<$("#Parcelle-par-adresse-DGFiP-table-voie").bootstrapTable("getAllSelections").length&&this.lB(B.properties.cadastre.api+
"/parcelles","id_par",this.aAdresses,"ID_PAR")):"proprietaire"===this.currentParcelleMode&&this.kl(B.properties.cadastre.api+"/parcelles","id_par","#Parcelle-par-proprietaire-table-parcelles","ID_PAR")):"bati"===a&&this.kl(B.properties.cadastre.api+"/parcelles","id_par","#Bati-par-proprietaire-table-parcelles")};Y.prototype.v.prototype.locateSelection=Y.prototype.v.prototype.kK;
Y.prototype.v.prototype.cN=function(){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectLocation");for(var a=B.g().mi.P(),b="",c={commune:[],section:[],lieuDit:[],parcelle:[],bati:[]},d=0;d<a.length;d++)b=a[d].get("type"),c[b].push(a[d]);for(var e in c)if(0<c[e].length){for(d=0;d<c[e].length;d++)c[e][d]=c[e][d].get("infos");"commune"===e?(void 0===B.D.R.Va("veremes_cadastre_commune")&&B.D.R.jb({Ta:"veremes_cadastre_commune",wb:"Commune",Na:["zoom","delete"]}),
this.Ig(B.properties.cadastre.api+"/communes","id_com",c[e],"id_com","veremes_cadastre_commune",function(){B.D.R.ef();B.D.R.uf("veremes_cadastre_commune")})):"section"===e?(void 0===B.D.R.Va("veremes_cadastre_section")&&B.D.R.jb({Ta:"veremes_cadastre_section",wb:"Section",Na:["zoom","delete"]}),this.Ig(B.properties.cadastre.api+"/sections","id_sec",c[e],"id_sec","veremes_cadastre_section",function(){B.D.R.ef();B.D.R.uf("veremes_cadastre_section")})):"lieuDit"===e?(void 0===B.D.R.Va("veremes_cadastre_lieu_dit")&&
B.D.R.jb({Ta:"veremes_cadastre_lieu_dit",wb:"Lieu-dit",Na:["zoom","delete"]}),this.Ig(B.properties.cadastre.api+"/lieudits","oid",c[e],"oid","veremes_cadastre_lieu_dit",function(){B.D.R.ef();B.D.R.uf("veremes_cadastre_lieu_dit")})):"parcelle"===e?(void 0===B.D.R.Va("veremes_cadastre_parcelle")&&B.D.R.jb({Ta:"veremes_cadastre_parcelle",wb:"Parcelle",Na:["zoom","delete"]}),this.Ig(B.properties.cadastre.api+"/parcelles","id_par",c[e],"id_par","veremes_cadastre_parcelle",function(){B.D.R.ef();B.D.R.uf("veremes_cadastre_parcelle")})):
"bati"===e&&(void 0===B.D.R.Va("veremes_cadastre_parcelle")&&B.D.R.jb({Ta:"veremes_cadastre_parcelle",wb:"Parcelle",Na:["zoom","delete"]}),void 0===B.D.R.Va("veremes_cadastre_invariant")&&B.D.R.jb({Ta:"veremes_cadastre_invariant",wb:"Invariant",Na:["delete"]}),this.Ig(B.properties.cadastre.api+"/invariants","ID_PAR",c[e],"id_par","veremes_cadastre_invariant",function(){B.D.R.ef();B.D.R.uf("veremes_cadastre_invariant");B.D.R.te("veremes_cadastre_invariant")}),this.Ig(B.properties.cadastre.api+"/parcelles",
"id_par",c[e],"id_par","veremes_cadastre_parcelle",function(){B.D.R.ef();B.D.R.uf("veremes_cadastre_parcelle");B.D.R.te("veremes_cadastre_invariant")}))}};Y.prototype.v.prototype.selectLocation=Y.prototype.v.prototype.cN;
Y.prototype.v.prototype.mB=function(a,b){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.locateCadastreOnMap");nA();if(b||""===this.searchOnMapCurrentMode)return 0;"Point"===a?(B.g().za.Ja("Cliquer sur un point pour s\u00e9lectionner"),B.g().Ol("singleclick",this.iK,this,"cadastre-selectBy"+a)):"LineString"===a?(B.g().za.Ja("Dessiner une ligne pour s\u00e9lectionner"),oA(this,"LineString")):"Polygon"===a?(B.g().za.Ja("Dessiner un polygone pour s\u00e9lectionner"),
oA(this,"Polygon")):"Circle"===a&&(B.g().za.Ja("Dessiner un cercle pour s\u00e9lectionner"),oA(this,"Circle"))};Y.prototype.v.prototype.locateCadastreOnMap=Y.prototype.v.prototype.mB;
Y.prototype.v.prototype.aN=function(a,b){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectCadastreOnMap");nA();if(b)return 0;"FicheDescriptive"===a&&(this.searchOnMapCurrentMode="FicheDescriptive",B.g().za.Ja("Cliquer sur un point pour g\u00e9n\u00e9rer la fiche descriptive"),B.g().Ol("singleclick",function(a){pA(this,a,"ficheDescriptive")},this,"cadastre-"+a));"ReleveDePropriete"===a&&(this.searchOnMapCurrentMode="ReleveDePropriete",B.g().za.Ja("Cliquer sur un point pour g\u00e9n\u00e9rer le relev\u00e9 de propri\u00e9t\u00e9"),
B.g().Ol("singleclick",function(a){pA(this,a,"releveDePropriete")},this,"cadastre-"+a));"FicheUrbanisme"===a&&(this.searchOnMapCurrentMode="FicheUrbanisme",B.g().za.Ja("Cliquer sur un point pour g\u00e9n\u00e9rer la fiche d'urbanisme"),B.g().Ol("singleclick",function(a){pA(this,a,"ficheUrbanisme")},this,"cadastre-"+a))};Y.prototype.v.prototype.selectCadastreOnMap=Y.prototype.v.prototype.aN;
function pA(a,b,c){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectRapportOnMap");var d=new ii(b.Qb),d=B.Oe(d);a.tmpID_PAR="";a.tmpID_DNUPRO="";var e=.01,e=B.g().Za(),e=a.wt*e/1E3;A({method:"GET",url:B.properties.api_url+"/"+B.properties.cadastre.api+"/parcelles",headers:{Accept:"application/x-vm-json"},params:{filter:{column:"geom",compare_operator:"intersect",compare_operator_options:{source_proj:a.Sy.substring(5),intersect_buffer:e,intersect_buffer_geom_type:"point"},
value:d},limit:1,result_srid:E(B.g().B).J().Z.substring(5)},scope:a.b,success:function(d){B.g().Jo.clear();if(!n(d.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;if(!n(d.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),B.g().Uo("Pas de donn\u00e9es \u00e0 afficher",b.Qb),0;d=d.data.data;d.length>=a.ig&&bootbox.alert("<h4>Attention, vous avez atteint la limite d'objects affichables sur la carte</h4>");var e=d[0].id_par;a.tmpID_PAR=e;!1===a.locationMultiple&&
B.g().mi.clear();a.rk(d,"parcelle",!1);"ficheDescriptive"===c&&a.Ut(e);"releveDePropriete"===c&&$("#releve-propriete-modal-menu").modal("show");"ficheUrbanisme"===c&&a.Wt(e);A({method:"GET",url:B.properties.api_url+"/"+B.properties.cadastre.api+"/descriptionparcelles",headers:{Accept:"application/x-vm-json"},params:{filter:{column:"cadastre"===a.cadastreAPI_?"ID_PAR":"id_par",compare_operator:"=",value:e},limit:a.ig,result_srid:E(B.g().B).J().Z.substring(5)},scope:a.b,success:function(b){if(!n(b.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
0;b=b.data.data;b.length>=a.ig&&$.notify("Attention, vous avez atteint la limite d'objects affichables sur la carte","warn");a.tmpID_DNUPRO=b[0].ID_DNUPRO}})}})}
function qA(a,b,c,d){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.locateByWKTGeom");var e="",f=B.xf(b).F(),e=null;if("Point"===f||"LineString"===f)e=B.g().Za(),e=a.wt*e/1E3;a.Ia.length=0;a.Pf=0;b={column:"geom",compare_operator:"intersect",compare_operator_options:{source_proj:a.Sy.substring(5)},value:b};null!=e&&(b.compare_operator_options.intersect_buffer=e,b.compare_operator_options.intersect_buffer_geom_type="point");if("commune"===c)e="communes";else if("section"===
c)e="sections";else if("lieuDit"===c)e="lieudits";else if("parcelle"===c)e="parcelles";else if("bati"===c)e="parcelles";else return;var g=a.ig;"Point"===f&&(g=1);$("body").css({cursor:"wait"});A({method:"POST",url:B.properties.api_url+"/"+B.properties.cadastre.api+"/"+e,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{filter:b,limit:g,result_srid:E(B.g().B).J().Z.substring(5)},scope:a.b,success:function(b){$("body").css({cursor:""});B.g().Jo.clear();if(!n(b.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
B.g().Uo("Pas de donn\u00e9es \u00e0 afficher",d),0;b=b.data.data;b.length>=a.ig&&$.notify("Attention, vous avez atteint la limite d'objects affichables sur la carte","warn");!1===a.locationMultiple&&B.g().mi.clear();a.rk(b,c,!1)},error:function(){$("body").css({cursor:""})}})}Y.prototype.v.prototype.iK=function(a){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.locateByPoint");var b=new ii(a.Qb),b=B.Oe(b);qA(this,b,this.searchOnMapCurrentMode,a.Qb)};
function oA(a,b){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.locateByDrawing");a.yb=B.g().sh({type:b},"cadastre-selectBy"+b);a.yb.on("drawend",function(a){var b=B.Oe(a.ka.j());qA(this,b,this.searchOnMapCurrentMode,Qh(a.ka.j()))},a)}
Y.prototype.v.prototype.ZM=function(a){if(this.searchOnMapCurrentMode===a)return this.searchOnMapCurrentMode="","cadastre-selectByPoint"!==this.currentAction&&"cadastre-selectByLineString"===this.currentAction&&"cadastre-selectByPolygon"===this.currentAction||B.g().El(),0;this.searchOnMapCurrentMode=a;"cadastre-selectByLineString"!==this.currentAction&&"cadastre-selectByPolygon"!==this.currentAction&&"cadastre-selectByPoint"!==this.gz&&this.mB("Point","cadastre-selectByPoint"===this.gz)};
Y.prototype.v.prototype.searchOnMapInit=Y.prototype.v.prototype.ZM;
Y.prototype.v.prototype.JJ=function(a){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.initRapportsBootstrapTables");var b=this;if(void 0===$("#Cadastre-rapports-table-parcelle").bootstrapTable("getOptions").dataType){$(a).find('[data-toggle="table"]').bootstrapTable({});var c=Date.now(),d=function(a){c>Date.now()-100||(c=Date.now(),setTimeout(function(){var c=$(a).bootstrapTable("getAllSelections");b.tablesSelection[a]=c}))};$("#Cadastre-rapports-table-parcelle").on("all.bs.table",
function(){d("#Cadastre-rapports-table-parcelle")});$("#Cadastre-rapports-table-comptes").on("all.bs.table",function(){d("#Cadastre-rapports-table-comptes")})}$(a).find('[data-toggle="table"]').bootstrapTable("load",[]);if(0===this.selection.length)return Yb(document.body,"click",function(){B.pz({target:"#cadastre-btn-container-actions-map-replace-card",type:"top-left"},"Ajoutez d'abord des donn\u00e9es au panier")}),0;this.show_veremes_cadastre_compte=this.show_veremes_cadastre_parcelle=!1;for(var e=
0;e<this.selection.length;e++)"veremes_cadastre_parcelle"===this.selection[e].tabCode&&(B.log(this.selection[e].tableParams.data),this.show_veremes_cadastre_parcelle=!0,$(a).find("#Cadastre-rapports-table-parcelle").bootstrapTable("load",this.selection[e].tableParams.data)),"veremes_cadastre_compte"===this.selection[e].tabCode&&(this.show_veremes_cadastre_compte=!0,$(a).find("#Cadastre-rapports-table-comptes").bootstrapTable("load",this.selection[e].tableParams.data));this.show_veremes_cadastre_parcelle||
this.show_veremes_cadastre_compte?$("#rapports-modal").modal("show"):$.notify("Aucun rapport disponible pour cette s\u00e9lection")};Y.prototype.v.prototype.initRapportsBootstrapTables=Y.prototype.v.prototype.JJ;
Y.prototype.v.prototype.NG=function(a){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayParcelleDescriptiveSheetByTable");a=$(a).bootstrapTable("getAllSelections");if(1!==a.length)return $.notify("Veuillez s\u00e9lectionner une unique parcelle","info"),0;this.Ut(a[0].id_par)};Y.prototype.v.prototype.displayParcelleDescriptiveSheetByTable=Y.prototype.v.prototype.NG;
Y.prototype.v.prototype.Ut=function(a){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayParcelleDescriptiveSheet");var b=this;A({method:"POST",url:B.properties.api_url+"/"+B.properties.cadastre.api+"/fichedescriptiveparcelle/"+a,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{result_srid:E(B.g().B).J().Z.substring(5)},scope:this.b,success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
0;b.oParcelleInfos=a.data.data;b.oz()}})};Y.prototype.v.prototype.displayParcelleDescriptiveSheet=Y.prototype.v.prototype.Ut;
Y.prototype.v.prototype.oz=function(){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayParcelleDescriptiveSheet2");var a=this.oParcelleInfos;a.sup_fiscale&&(a.sup_fiscale=parseFloat(a.sup_fiscale)+" m\u00b2");a.DCNTPA&&(a.DCNTPA=parseFloat(a.DCNTPA)+" m\u00b2");a.GPARBAT=""===a.GPARBAT||" "===a.GPARBAT||0===a.GPARBAT||null===a.GPARBAT?"N":"O";a.GURBPA="U"!==a.GURBPA?"N":"O";if(a.aProprietaires)for(var b=0;b<a.aProprietaires.length;b++)if(a.aProprietaires[b].accordSexe=
"(e)",a.aProprietaires[b].DQUALP=null!=a.aProprietaires[b].DQUALP?a.aProprietaires[b].DQUALP:"",a.aProprietaires[b].DQUALP&&(a.aProprietaires[b].DQUALP=a.aProprietaires[b].DQUALP.trim(),"M"===a.aProprietaires[b].DQUALP&&(a.aProprietaires[b].accordSexe=""),"MLE"===a.aProprietaires[b].DQUALP||"MME"===a.aProprietaires[b].DQUALP))a.aProprietaires[b].accordSexe="e";a.aSubdivisionFiscale&&(a.aSubdivisionFiscale.totalDcntsf=0);a.aSubdivisionFiscale.totalDrcsuba=0;for(b=a.aSubdivisionFiscale.totalDrcsub=
0;b<a.aSubdivisionFiscale.length;b++)null!=a.aSubdivisionFiscale[b].DCNTSF&&(a.aSubdivisionFiscale[b].DCNTSF=parseFloat(a.aSubdivisionFiscale[b].DCNTSF)+" m\u00b2"),null!=a.aSubdivisionFiscale[b].DRCSUBA&&(a.aSubdivisionFiscale[b].DRCSUBA=(Math.pow(10,-2)*parseFloat(a.aSubdivisionFiscale[b].DRCSUBA)).toFixed(2)+" \u20ac"),null!=a.aSubdivisionFiscale[b].DRCSUB&&(a.aSubdivisionFiscale[b].DRCSUB=(Math.pow(10,-2)*parseFloat(a.aSubdivisionFiscale[b].DRCSUB)).toFixed(2)+" \u20ac"),null!=a.aSubdivisionFiscale[b].DCNTSF&&
(a.aSubdivisionFiscale.totalDcntsf+=parseFloat(a.aSubdivisionFiscale[b].DCNTSF)),null!=a.aSubdivisionFiscale[b].DRCSUBA&&(a.aSubdivisionFiscale.totalDrcsuba+=parseFloat(a.aSubdivisionFiscale[b].DRCSUBA)),null!=a.aSubdivisionFiscale[b].DRCSUB&&(a.aSubdivisionFiscale.totalDrcsub+=parseFloat(a.aSubdivisionFiscale[b].DRCSUB));null!=a.aSubdivisionFiscale.totalDcntsf&&(a.aSubdivisionFiscale.totalDcntsf=parseFloat(a.aSubdivisionFiscale.totalDcntsf)+" m\u00b2");null!=a.aSubdivisionFiscale.totalDrcsuba&&(a.aSubdivisionFiscale.totalDrcsuba=
parseFloat(a.aSubdivisionFiscale.totalDrcsuba).toFixed(2)+" \u20ac");null!=a.aSubdivisionFiscale.totalDrcsub&&(a.aSubdivisionFiscale.totalDrcsub=parseFloat(a.aSubdivisionFiscale.totalDrcsub).toFixed(2)+" \u20ac");this.oParcelleInfos=a;$("#descriptive-parcelle-sheet-modal").modal("show")};Y.prototype.v.prototype.displayParcelleDescriptiveSheet2=Y.prototype.v.prototype.oz;
Y.prototype.v.prototype.VG=function(a){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayUrbanismeSheetByTable");a=$(a).bootstrapTable("getAllSelections");if(1!==a.length)return $.notify("Veuillez s\u00e9lectionner une unique parcelle","info"),0;this.Wt(a[0].id_par)};Y.prototype.v.prototype.displayUrbanismeSheetByTable=Y.prototype.v.prototype.VG;
Y.prototype.v.prototype.Wt=function(a){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayUrbanismeSheet");if(!n(a))return 0;var b=this;A({method:"POST",url:B.properties.api_url+"/"+B.properties.cadastre.api+"/ficheurbanisme/"+a,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{result_srid:E(B.g().B).J().Z.substring(5)},timeout:12E4,scope:this.b,success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
0;a=a.data.data;B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayUrbanismeSheet2");for(var c=[],e=0;n(a[e]);)a[e].CCOSEC=null!=a[e].CCOSEC?a[e].CCOSEC:"",a[e].DCNTPA=null!=a[e].DCNTPA?a[e].DCNTPA:"",a[e].DDENOM=null!=a[e].DDENOM?a[e].DDENOM:"",a[e].DLIGN3=null!=a[e].DLIGN3?a[e].DLIGN3:"",a[e].DLIGN4=null!=a[e].DLIGN4?a[e].DLIGN4:"",a[e].DLIGN6=null!=a[e].DLIGN6?a[e].DLIGN6:"",a[e].DNUPLA=null!=a[e].DNUPLA?a[e].DNUPLA:"",a[e].ID_PAR=null!=a[e].ID_PAR?a[e].ID_PAR:
"",a[e].LIBCOM=null!=a[e].LIBCOM?a[e].LIBCOM:"",a[e].LIBDEP=null!=a[e].LIBDEP?a[e].LIBDEP:"",a[e].ADRESSE=null!=a[e].ADRESSE?a[e].ADRESSE:"",a[e].NATURE=null!=a[e].DSGRPF?a[e].DSGRPF:"",c.push({nom:a[e].DDENOM.trim(),adresse:a[e].DLIGN3.trim()+a[e].DLIGN4.trim(),ville:a[e].DLIGN6.trim()}),e++;delete e;0===c.length&&($.notify("Pas d'information sur les propri\u00e9taires","error"),console.error("Pas d'information sur les propri\u00e9taires"));var f=new Date,e=f.getDate(),g=f.getMonth()+1,f=f.getFullYear();
n(B.properties.cadastre.fiche_urb)||(B.properties.cadastre.fiche_urb={});c={logo:n(B.properties.cadastre.fiche_urb.logo)?B.properties.cadastre.fiche_urb.logo:"",company:n(B.properties.cadastre.fiche_urb.company)?B.properties.cadastre.fiche_urb.company:"",departement:n(a[0])?a[0].LIBDEP.trim():"",commune:n(a[0])?a[0].LIBCOM.trim():"",parcelle:n(a[0])?parseFloat(a[0].DNUPLA):"",section:n(a[0])?a[0].CCOSEC.trim():"",contenance:n(a[0])?parseFloat(a[0].DCNTPA):"",adresse:n(a[0])?a[0].ADRESSE.trim():"",
date:(9<e?"":"0")+e+"/"+((9<g?"":"0")+g)+"/"+f,nature:n(a[0])?a[0].NATURE.trim():"",proprietaires:c,aIntersections:a.aIntersections,aIntersectionsArray:a.aIntersectionsArray};e=E(b.map).J().Z;a=B.xf(a.geometry.geom,e);a=new vd({geometry:a});null!=B.properties.cadastre.fiche_urb.printtemplate_id?null!=B.properties.cadastre.fiche_urb.map_id?B.D.ub.cC.print({scope:c,OD:B.properties.cadastre.fiche_urb.printtemplate_id,vB:B.properties.cadastre.fiche_urb.map_id,features:[a],Oz:B.properties.cadastre.fiche_urb.features_zoom}):
$.notify("properties.cadastre.fiche_urb.map_id undefined","error"):$.notify("properties.cadastre.fiche_urb.printtemplate_id undefined","error")}})};Y.prototype.v.prototype.displayUrbanismeSheet=Y.prototype.v.prototype.Wt;
Y.prototype.v.prototype.KG=function(a){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayInvariantDescriptiveSheet");if(!n(a))return"id_bat undefined";var b=this;A({method:"POST",url:B.properties.api_url+"/"+B.properties.cadastre.api+"/fichedescriptiveinvariant/"+a,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{result_srid:E(B.g().B).J().Z.substring(5)},scope:this.b,success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
0;b.oInvariant=a.data.data;n(b.oInvariant)||console.error("oInvariant non d\u00e9fini");n(b.oInvariant.PEV)||console.error("oInvariant.PEV non d\u00e9fini");n(b.oInvariant.habitations)||console.error("oInvariant.habitations non d\u00e9fini");n(b.oInvariant.locauxPros)||console.error("oInvariant.locauxPros non d\u00e9fini");n(b.oInvariant.dependances)||console.error("oInvariant.dependances non d\u00e9fini");n(b.oInvariant.proprietaires)||console.error("oInvariant.proprietaires non d\u00e9fini");n(b.oInvariant.lots)||
console.error("oInvariant.lots non d\u00e9fini");for(a=0;a<b.oInvariant.proprietaires.length;a++){b.oInvariant.proprietaires[a].DLIGN4=null!=b.oInvariant.proprietaires[a].DLIGN4?b.oInvariant.proprietaires[a].DLIGN4:"";for(var c=b.oInvariant.proprietaires[a].DLIGN4.trim(),e=0;e<c.length;e++)"0"!==c.charAt(e)&&(c=c.substring(e),e=c.length);b.oInvariant.proprietaires[a].DLIGN4=c}$("#descriptive-invariant-sheet-modal").modal("show")}})};Y.prototype.v.prototype.displayInvariantDescriptiveSheet=Y.prototype.v.prototype.KG;
function rA(a,b,c,d){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayReleveDeProprieteSheet");b={type:b,result_srid:E(B.g().B).J().Z.substring(5)};n(d)&&(b.ID_PAR=d);n(c)&&(b.IDDNUPRO=c);A({method:"POST",url:B.properties.api_url+"/"+B.properties.cadastre.api+"/relevedepropriete",headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:b,scope:a.b,timeout:12E4,success:function(b){if(!n(b.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
n(a.eb)&&a.eb.close(),a.eb=window.open("","Relev\u00e9 de propri\u00e9t\u00e9 ","height=400,width=600"),a.eb.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">Pas de donn\u00e9es \u00e0 afficher</div>'),0;A({method:"GET",url:b.data.data.releveDePropriete+"&",headers:{Accept:"application/x-vm-json"},scope:this.b,responseType:"blob",success:function(b){window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(b.data,"releve_de_propriete_"+d+".pdf"):B.gj(b.data,
"releve_de_propriete_"+d+".pdf");a.eb.close()}})},error:function(b){if(n(b.data.error)&&n(b.data.error.errorMessage))return console.error(b.data.error.errorMessage),$.notify(b.data.error.errorMessage,"error"),n(a.eb)&&a.eb.close(),a.eb=window.open("","Relev\u00e9 de propri\u00e9t\u00e9 ","height=400,width=600"),a.eb.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">'+b.data.error.errorMessage+"</div>"),0;if(500===b.status)return $.notify("Une erreur est survenue au sein du serveur",
"error"),n(a.eb)&&a.eb.close(),0;n(a.eb)&&a.eb.close()}})}
Y.prototype.v.prototype.QG=function(a){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayReleveDeProprieteSheetTiers");a=$(a).bootstrapTable("getAllSelections");if(1!==a.length)return $.notify("Veuillez s\u00e9lectionner une unique parcelle","info"),0;n(this.eb)&&this.eb.close();this.eb=window.open("","Relev\u00e9 de propri\u00e9t\u00e9 ","height=400,width=600");this.eb.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>');rA(this,
"parcelle","",a[0].id_par)};Y.prototype.v.prototype.displayReleveDeProprieteSheetParcelle=Y.prototype.v.prototype.QG;
Y.prototype.v.prototype.RG=function(a){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayReleveDeProprieteSheetStandard");a=$(a).bootstrapTable("getAllSelections");if(1!==a.length)return $.notify("Veuillez s\u00e9lectionner un unique compte","info"),0;n(this.eb)&&this.eb.close();this.eb=window.open("","Relev\u00e9 de propri\u00e9t\u00e9 ","height=400,width=600");this.eb.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>');
rA(this,"standard",a[0].ID_COM+a[0].DNUPRO)};Y.prototype.v.prototype.displayReleveDeProprieteSheetStandard=Y.prototype.v.prototype.RG;
Y.prototype.v.prototype.SG=function(a){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayReleveDeProprieteSheetTiers");a=$(a).bootstrapTable("getAllSelections");if(1!==a.length)return $.notify("Veuillez s\u00e9lectionner un unique compte","info"),0;n(this.eb)&&this.eb.close();this.eb=window.open("","Relev\u00e9 de propri\u00e9t\u00e9 ","height=400,width=600");this.eb.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>');
rA(this,"tiers",a[0].ID_COM+a[0].DNUPRO)};Y.prototype.v.prototype.displayReleveDeProprieteSheetTiers=Y.prototype.v.prototype.SG;
Y.prototype.v.prototype.PG=function(a,b,c){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayReleveDeProprieteSheetOnMap");n(this.eb)&&this.eb.close();this.eb=window.open("","Relev\u00e9 de propri\u00e9t\u00e9 ","height=400,width=600");this.eb.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>');rA(this,
a,b,c)};Y.prototype.v.prototype.displayReleveDeProprieteSheetOnMap=Y.prototype.v.prototype.PG;
Y.prototype.v.prototype.OG=function(a,b,c){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayRapportParcelle");a=$(a).bootstrapTable("getAllSelections");c=n(c)?c:!0;if(0===a.length)return $.notify("Veuillez s\u00e9lectionner une unique parcelle","info"),0;for(var d="",e=0;e<a.length;e++)0<e&&(d+="|"),d+=a[e].id_par;var f=this;n(this.eb)&&this.eb.close();c?(this.eb=window.open("","Rapport parcellaire","height=400,width=600"),this.eb.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>')):
bootbox.alert('<h4>Rapport en cours de cr\u00e9ation...</h4><br><div class="progress"><div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%"><span class="sr-only">45% Complete</span><span class="sr-only">45% Complete</span></div></div>');A({method:"POST",url:B.properties.api_url+"/"+B.properties.cadastre.api+"/rapportscadastreparcelle",headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},
data:{rapport_type:b,parcelles:d,result_srid:E(B.g().B).J().Z.substring(5)},timeout:12E4,scope:this.b,success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),$.notify("Pas de donn\u00e9es \u00e0 afficher","warn"),c?f.eb.close():$(".bootbox-alert").modal("hide"),0;var d=a.data.data;A({method:"GET",url:d.rapport+"&",headers:{Accept:"application/x-vm-json"},scope:this.b,responseType:"blob",success:function(a){c?(window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(a.data,
"vmap_cadastre_"+b+".pdf"):B.gj(a.data,"vmap_cadastre_"+b+".pdf"),f.eb.close()):(window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(a.data,b+"."+d.format):B.gj(a.data,b+"."+d.format),$(".bootbox-alert").modal("hide"))}})},error:function(a){if(n(a.data.error)&&n(a.data.error.errorMessage))return console.error(a.data.error.errorMessage),$.notify(a.data.error.errorMessage,"error"),c?f.eb.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">'+a.data.error.errorMessage+
"</div>"):$(".bootbox-alert").modal("hide"),0;if(500===a.status)return $.notify("Une erreur est survenue au sein du serveur","error"),c?f.eb.close():$(".bootbox-alert").modal("hide"),0;n(f.eb)&&f.eb.close()}})};Y.prototype.v.prototype.displayRapportParcelle=Y.prototype.v.prototype.OG;
Y.prototype.v.prototype.rk=function(a,b,c){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addLocationGeometries");c=n(c)?c:!0;b=n(b)?b:"";for(var d=[],e=a.length-1;0<=e;e--){var f=new vd({geometry:B.xf(a[e].geom)});f.set("type",b);d.push(f);var g={},h;for(h in a[e])"geom"!==h&&(g[h]=a[e][h]);f.set("infos",g)}a=!0;this.locationMultiple&&(a=!1);B.g().rv(d,a,c)};Y.prototype.v.prototype.addLocationGeometries=Y.prototype.v.prototype.rk;
Y.prototype.v.prototype.oD=function(a){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.setSelectionGeometries");for(var b=a.length-1;0<=b;b--)if(void 0!==a[b].geom){var c=B.xf(a[b].geom),d=new vd({geometry:c});a[b].feature=d;delete c;delete d}return a};Y.prototype.v.prototype.setSelectionGeometries=Y.prototype.v.prototype.oD;
Y.prototype.v.prototype.qk=function(a,b){if(!n(a))return"data is not defined";if(!n(b))return"tabCode is not defined";void 0===B.D.R.Va(b)?angular.element($("#cadastre-tools")).scope().$evalAsync(function(c){c.ctrl.xi(a,b)}):B.D.R.mt({Ta:b},{data:a,xe:["geom"]})};Y.prototype.v.prototype.addInfos=Y.prototype.v.prototype.qk;
Y.prototype.v.prototype.xi=function(a,b){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.setInfos");if(!n(a))return"data is not defined";b=n(b)?b:"Cadastre";a={Ta:b,data:a,TP:!0,xe:["geom"],Na:n(a[0].geom)?["zoom","delete"]:["delete"],layer:B.g().Ae};B.D.R.jb(a)};Y.prototype.v.prototype.setInfos=Y.prototype.v.prototype.xi;
Y.prototype.v.prototype.Jg=function(a,b,c,d){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFromFilter");B.log("filter: "+b);var e=this;a=B.properties.api_url+"/"+a;c=n(c)?c:"Cadastre";d=n(d)?d:function(){return 0};A({method:"POST",url:a,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{filter:b,result_srid:E(B.g().B).J().Z.substring(5)},scope:this.b,success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
0;a=a.data.data;B.g().mi.clear();a=e.oD(a);e.qk(a,c);B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.zoomOnLastTabFeatures");angular.element($("#cadastre-tools")).scope().ctrl.Pf++;a=angular.element($("#cadastre-tools")).scope().ctrl.Pf;var b=angular.element($("#cadastre-tools")).scope().ctrl.Ia,f=b[b.length-1];b.length===a&&(B.D.R.nm(f),B.D.R.ef());d(c)}})};Y.prototype.v.prototype.addSelectionFromFilter=Y.prototype.v.prototype.Jg;
Y.prototype.v.prototype.jF=function(a,b,c,d,e){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFromValue");if(null==c)return console.error("value undefined"),null;if(!r(c)&&!ea(c))return console.error("value not string or number"),null;if(0< !String(c).length)return console.error("value empty"),null;this.Jg(a,{column:"cadastre"===this.cadastreAPI_?b:b.toLowerCase(),compare_operator:"=",value:c},d,e)};
Y.prototype.v.prototype.addSelectionFromValue=Y.prototype.v.prototype.jF;Y.prototype.v.prototype.nt=function(a,b,c,d,e,f,g){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFrom2Values");"cadastre"!==this.cadastreAPI_&&(b=b.toLowerCase(),d=d.toLowerCase());this.Jg(a,{relation:"AND",operators:[{column:b,compare_operator:"=",value:c},{column:d,compare_operator:"=",value:e}]},f,g)};Y.prototype.v.prototype.addSelectionFrom2Values=Y.prototype.v.prototype.nt;
Y.prototype.v.prototype.Ig=function(a,b,c,d,e,f){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFromTable");b="cadastre"===this.cadastreAPI_?b:b.toLowerCase();for(var g={relation:"OR",operators:[]},h=0;h<c.length;h++)g.operators.push({column:b,compare_operator:"=",value:c[h][d]});this.Jg(a,g,e,f)};Y.prototype.v.prototype.addSelectionFromArray=Y.prototype.v.prototype.Ig;
Y.prototype.v.prototype.pf=function(a,b,c,d,e){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFromSelect");b={column:"cadastre"===this.cadastreAPI_?b:b.toLowerCase(),compare_operator:"=",value:$(c).val()};this.Jg(a,b,d,e)};Y.prototype.v.prototype.addSelectionFromSelect=Y.prototype.v.prototype.pf;
Y.prototype.v.prototype.iF=function(a,b,c,d,e,f,g){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFromSelect");"cadastre"!==this.cadastreAPI_&&(b=b.toLowerCase(),d=d.toLowerCase());c=$(c).val();e=$(e).val();this.Jg(a,{relation:"AND",operators:[{column:b,compare_operator:"=",value:c},{column:d,compare_operator:"=",value:e}]},f,g)};Y.prototype.v.prototype.addSelectionFrom2Select=Y.prototype.v.prototype.iF;
Y.prototype.v.prototype.Xi=function(a,b,c,d,e){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFromTable");c=$(c).bootstrapTable("getAllSelections");for(var f="cadastre"===this.cadastreAPI_?b:b.toLowerCase(),g={relation:"OR",operators:[]},h=0;h<c.length;h++)g.operators.push({column:f,compare_operator:"=",value:c[h][b]});this.Jg(a,g,d,e)};Y.prototype.v.prototype.addSelectionFromTable=Y.prototype.v.prototype.Xi;
Y.prototype.v.prototype.gH=function(){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.emptySelection");B.D.R.removeAll()};Y.prototype.v.prototype.emptySelection=Y.prototype.v.prototype.gH;
Y.prototype.v.prototype.qv=function(a,b,c){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.localiseFromSelect");c=$(c).val();a=B.properties.api_url+"/"+a;var d=this;""!==c?A({method:"POST",url:a,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{attributs:"geom|proj",filter:{column:b,compare_operator:"=",value:c},result_srid:E(B.g().B).J().Z.substring(5)},scope:this.b,success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
0;d.rk(a.data.data)}}):$.notify("Veuillez s\u00e9lectionner au moins un objet spatial","info")};Y.prototype.v.prototype.localiseFromSelect=Y.prototype.v.prototype.qv;
Y.prototype.v.prototype.lB=function(a,b,c,d){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.localiseFromTable");var e=this;a=B.properties.api_url+"/"+a;for(var f={relation:"OR",operators:[]},g=0;g<c.length;g++)f.operators.push({column:b,compare_operator:"=",value:c[g][d]});A({method:"POST",url:a,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{attributs:"geom|proj",filter:f,result_srid:E(B.g().B).J().Z.substring(5)},scope:this.b,
success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;e.rk(a.data.data)}})};Y.prototype.v.prototype.localiseFromArray=Y.prototype.v.prototype.lB;
Y.prototype.v.prototype.kl=function(a,b,c,d){function e(){for(var a={relation:"OR",operators:[]},c=0;c<g.length;c++)a.operators.push({column:b,compare_operator:"=",value:g[c][d]});A({method:"POST",url:h,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{attributs:"geom|proj",filter:a,result_srid:E(B.g().B).J().Z.substring(5)},scope:this.b,success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;f.rk(a.data.data)}})}B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.localiseFromTable");
d=n(d)?d:b;var f=this,g=$(c).bootstrapTable("getAllSelections"),h=B.properties.api_url+"/"+a;g.length>this.ig?bootbox.confirm("<h4>Attention, vous allez afficher "+g.length+" objets, cela peut ralentir l'application<br>voulez-vous continuer ?</h4>",function(a){!0===a&&e()}):0!==g.length?e():$.notify("Veuillez s\u00e9lectionner au moins un objet de la liste","info")};Y.prototype.v.prototype.localiseFromTable=Y.prototype.v.prototype.kl;
Y.prototype.v.prototype.aA=function(a,b,c,d){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBaseElem");c=n(c)?c:"";d=n(d)?d:"";var e=this;a=B.properties.api_url+"/"+a;var f={attributs:"-geom|proj",result_srid:E(B.g().B).J().Z.substring(5)};""!==c&&(f.filter=c);""!==d&&(f.order_by=d);this[b].length=0;A({method:"POST",url:a,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:f,scope:this.b,success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
0;e[b]=a.data.data}})};Y.prototype.v.prototype.getBaseElem=Y.prototype.v.prototype.aA;
Y.prototype.v.prototype.CH=function(a,b,c,d,e){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBaseElemBySelect");e=n(e)?e:"";this[d].length=0;var f=this;a=B.properties.api_url+"/"+a;var g=$(c).val();if(null==g)return console.error("$("+c+") undefined"),null;if(!r(g)&&!ea(g))return console.error("$("+c+") not string or number"),null;if(0< !String(g).length)return console.error("$("+c+") empty"),f[d]=[],null;b={attributs:"-geom|proj",filter:{column:b,compare_operator:"=",
value:g},jsonformat:"anonymous",result_srid:E(B.g().B).J().Z.substring(5)};""!==e&&(b.order_by=e);A({method:"POST",url:a,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:b,scope:this.b,success:function(a){if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;f[d]=a.data.data}})};Y.prototype.v.prototype.getBaseElemBySelect=Y.prototype.v.prototype.CH;
function sA(a,b,c,d,e){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.putBaseElemOnTable");$(d).bootstrapTable("showLoading");$(d).bootstrapTable("removeAll");e=n(e)?e:"";c={filter:c,jsonformat:"anonymous",result_srid:E(B.g().B).J().Z.substring(5)};""!==e&&(c.order_by=e);A({method:"POST",url:B.properties.api_url+"/"+b,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:c,scope:a.b,success:function(a){$(d).bootstrapTable("hideLoading");
if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(d).bootstrapTable("load",a);$(d+"-toolbar").show();1===a.length&&$(d).bootstrapTable("check",0)},error:function(){$(d).bootstrapTable("hideLoading")}})}
Y.prototype.v.prototype.oM=function(a,b,c,d,e){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.putBaseElemBySelectOnTable");e=n(e)?e:"";var f=$(c).val();if(null==f)return console.error("$("+c+") undefined"),null;if(!r(f)&&!ea(f))return console.error("$("+c+") not string or number"),null;if(0< !String(f).length)return console.error("$("+c+") empty"),$(d).bootstrapTable("removeAll"),null;sA(this,a,{column:b,compare_operator:"=",value:f},d,e)};
Y.prototype.v.prototype.putBaseElemBySelectOnTable=Y.prototype.v.prototype.oM;Y.prototype.v.prototype.nM=function(a,b,c,d,e,f,g){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.putBaseElemBy2SelectOnTable");g=n(g)?g:"";c=$(c).val();e=$(e).val();sA(this,a,{relation:"AND",operators:[{column:b,compare_operator:"=",value:c},{column:d,compare_operator:"=",value:e}]},f,g)};Y.prototype.v.prototype.putBaseElemBy2SelectOnTable=Y.prototype.v.prototype.nM;
Y.prototype.v.prototype.DH=function(a,b,c,d){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBaseVoiesOnTable");var e=$(c).val();a=B.properties.api_url+"/"+a;var f=this;if(null==e)return console.error("$("+c+") undefined"),null;if(!r(e)&&!ea(e))return console.error("$("+c+") not string or number"),null;if(0< !String(e).length)return console.error("$("+c+") empty"),$(d).bootstrapTable("load",[]),null;$(d).bootstrapTable({data:{}});c="cadastre"===f.cadastreAPI_?
"DVOILIB":"dvoilib";$(d).bootstrapTable("showLoading");A({method:"POST",url:a,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{order_by:c,filter:{column:b,compare_operator:"=",value:e},jsonformat:"anonymous",result_srid:E(B.g().B).J().Z.substring(5)},scope:this.b,success:function(a){$(d).bootstrapTable("hideLoading");if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(d).bootstrapTable("load",a);$(d).off("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table");
$(d).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",function(a,b){$("#Parcelle-par-adresse-DGFiP-select-adresse").prop("disabled",!0);tA(f,{path:B.properties.cadastre.api+"/adresses",variableName:"aAdresses",param:"cadastre"===f.cadastreAPI_?"ID_RIVOLI":"id_voie",value:b.ID_RIVOLI,order_by:"DNVOIRI",callback:function(){$("#Parcelle-par-adresse-DGFiP-select-adresse").prop("disabled",!1)}})});1===a.length&&$(d).bootstrapTable("check",0)},error:function(){$(d).bootstrapTable("hideLoading")}})};
Y.prototype.v.prototype.getBaseVoiesOnTable=Y.prototype.v.prototype.DH;
function tA(a,b){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBaseElemByValue");var c=b.path,d=b.variableName,e=b.param,f=b.value,g=b.callback;b=b.order_by;g=n(g)?g:function(){return 0};c=B.properties.api_url+"/"+c;a[d].length=0;null==f?console.error("value undefined"):r(f)||ea(f)?0< !String(f).length?console.error("value empty"):A({method:"POST",url:c,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{attributs:"-geom|proj",
filter:{column:e,compare_operator:"=",value:f},result_srid:E(B.g().B).J().Z.substring(5),order_by:null!=b?b:""},scope:a.b,success:function(b){if(!n(b.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a[d]=b.data.data;g()}}):console.error("value not string or number")}
Y.prototype.v.prototype.kI=function(a,b,c,d,e){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getParcelleBaseProprietairesOnTable");var f=this;a=$(a).val();b=$(b).val().toUpperCase();var g=B.properties.api_url+"/"+B.properties.cadastre.api+"/proprietaires";if(""!=a)if(3<=b.length){$(c).bootstrapTable({data:{}});$(c).bootstrapTable("showLoading");$(d).bootstrapTable("removeAll");$(e).bootstrapTable("removeAll");if("cadastre"===this.cadastreAPI_)var h="ID_COM",
k="DDENOM";else h="id_com",k="ddenom";A({method:"POST",url:g,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{filter:{relation:"AND",operators:[{column:h,compare_operator:"=",value:a},{column:k,compare_operator:"LIKE",compare_operator_options:{case_insensitive:!0},value:"%"+b+"%"}]},limit:500,attributs:k+"|"+h,distinct:!0,order_by:k,result_srid:E(B.g().B).J().Z.substring(5)},scope:this.b,success:function(a){$(c).bootstrapTable("hideLoading");if(!n(a.data.data))return $(c).bootstrapTable("removeAll"),
console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;500<=a.length&&$.notify("Attention: limite d'occurrences atteinte, veuillez affiner votre recherche","info");$(c).bootstrapTable("load",a);$(c+"-toolbar").show();""!==d&&($(c).off("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table"),$(c).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",function(a,b){$(d).bootstrapTable("removeAll");$(e).bootstrapTable("removeAll");f.nA(b,d,e)}));
1===a.length&&$(c).bootstrapTable("check",0)},error:function(){$(c).bootstrapTable("hideLoading")}})}else $(c).bootstrapTable("removeAll"),$.notify("Veuillez entrer au moins 3 caract\u00e8res...","error");else $(c).bootstrapTable("removeAll"),$.notify("Veuillez s\u00e9lectionner une commune","error")};Y.prototype.v.prototype.getParcelleBaseProprietairesOnTable=Y.prototype.v.prototype.kI;
Y.prototype.v.prototype.nA=function(a,b,c){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getParcelleBaseComptesOnTable");var d=this,e=B.properties.api_url+"/"+B.properties.cadastre.api+"/proprietaires";$(b).bootstrapTable("showLoading");if("cadastre"===this.cadastreAPI_)var f="ID_COM",g="DDENOM",h="DNUPRO";else f="id_com",g="ddenom",h="dnupro";A({method:"POST",url:e,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{filter:{relation:"AND",
operators:[{column:f,compare_operator:"=",value:a.ID_COM},{column:g,compare_operator:"=",value:a.DDENOM}]},attributs:f+"|"+h,order_by:h,result_srid:E(B.g().B).J().Z.substring(5)},scope:this.b,success:function(a){$(b).bootstrapTable("hideLoading");if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(b).bootstrapTable("load",a);$(b+"-toolbar").show();$(b).off("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table");$(b).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",
function(a,e){$(c).bootstrapTable("removeAll");d.bA(e.ID_COM,$(b).bootstrapTable("getAllSelections"),c)});1===a.length&&$(b).bootstrapTable("check",0)},error:function(){$(b).bootstrapTable("hideLoading")}})};Y.prototype.v.prototype.getParcelleBaseComptesOnTable=Y.prototype.v.prototype.nA;
Y.prototype.v.prototype.bA=function(a,b,c){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBaseParcellesByProprietaireOnTable");if(0!==b.length){var d=B.properties.api_url+"/"+B.properties.cadastre.api+"/descriptionparcelles";$(c).bootstrapTable("showLoading");if("cadastre"===this.cadastreAPI_){a="ID_COM";var e="DNUPRO",f="ID_PAR"}else a="id_com",e="dnupro",f="id_par";for(var g={relation:"OR",operators:[]},h=0;h<b.length;h++)g.operators.push({relation:"AND",
operators:[{column:a,compare_operator:"=",value:b[h].ID_COM},{column:e,compare_operator:"=",value:b[h].DNUPRO}]});A({method:"POST",url:d,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{attributs:f,filter:g,order_by:f,result_srid:E(B.g().B).J().Z.substring(5)},scope:this.b,success:function(a){$(c).bootstrapTable("hideLoading");if(n(a.data.errorMessage))return console.error(a.data.errorMessage),0;if(500===a.status)return $.notify("Une erreur est survenue au sein du serveur",
"error"),0;if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(c).bootstrapTable("load",a);$(c+"-toolbar").show();1===a.length&&$(c).bootstrapTable("check",0)},error:function(){$(c).bootstrapTable("hideLoading")}})}};Y.prototype.v.prototype.getBaseParcellesByProprietaireOnTable=Y.prototype.v.prototype.bA;
Y.prototype.v.prototype.FH=function(a,b,c,d,e,f){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBatiBaseProprietairesOnTable");var g=this;a=$(a).val();b=$(b).val().toUpperCase();var h=B.properties.api_url+"/"+B.properties.cadastre.api+"/proprietaires";if(""!=a)if(3<=b.length){$(c).bootstrapTable({data:{}});$(c).bootstrapTable("showLoading");$(d).bootstrapTable("removeAll");$(e).bootstrapTable("removeAll");$(f).bootstrapTable("removeAll");if("cadastre"===
this.cadastreAPI_)var k="ID_COM",m="DDENOM";else k="id_com",m="ddenom";A({method:"POST",url:h,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{filter:{relation:"AND",operators:[{column:k,compare_operator:"=",value:a},{column:m,compare_operator:"LIKE",compare_operator_options:{case_insensitive:!0},value:"%"+b+"%"}]},limit:"50",attributs:m+"|"+k,distinct:!0,order_by:m,result_srid:E(B.g().B).J().Z.substring(5)},scope:this.b,success:function(a){$(c).bootstrapTable("hideLoading");
if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(c).bootstrapTable("load",a);$(c+"-toolbar").show();""!==d&&($(c).off("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table"),$(c).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",function(a,b){$(d).bootstrapTable("removeAll");$(e).bootstrapTable("removeAll");$(f).bootstrapTable("removeAll");g.cA(b,d,e,f)}));1===a.length&&$(c).bootstrapTable("check",0)},error:function(){$(c).bootstrapTable("hideLoading")}})}else $(c).bootstrapTable("removeAll"),
$.notify("Veuillez entrer au moins 3 caract\u00e8res...","error");else $(c).bootstrapTable("removeAll"),$.notify("Veuillez s\u00e9lectionner une commune","error")};Y.prototype.v.prototype.getBatiBaseProprietairesOnTable=Y.prototype.v.prototype.FH;
Y.prototype.v.prototype.cA=function(a,b,c,d){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBatiBaseComptesOnTable");var e=this,f=B.properties.api_url+"/"+B.properties.cadastre.api+"/proprietaires";$(b).bootstrapTable("showLoading");if("cadastre"===this.cadastreAPI_)var g="ID_COM",h="DDENOM",k="DNUPRO";else g="id_com",h="ddenom",k="dnupro";A({method:"POST",url:f,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{filter:{relation:"AND",
operators:[{column:g,compare_operator:"=",value:a.ID_COM},{column:h,compare_operator:"=",value:a.DDENOM}]},attributs:k+"|"+g,order_by:k,result_srid:E(B.g().B).J().Z.substring(5)},scope:this.b,success:function(a){$(b).bootstrapTable("hideLoading");if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(b).bootstrapTable("load",a);$(b+"-toolbar").show();$(b).off("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table");$(b).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",
function(){$(c).bootstrapTable("removeAll");$(d).bootstrapTable("removeAll");e.dA($(b).bootstrapTable("getAllSelections"),c,d)});1===a.length&&$(b).bootstrapTable("check",0)},error:function(){$(b).bootstrapTable("hideLoading")}})};Y.prototype.v.prototype.getBatiBaseComptesOnTable=Y.prototype.v.prototype.cA;
Y.prototype.v.prototype.dA=function(a,b,c){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBatiBaseInvariantsOnTable");if(0!==a.length){var d=this,e=B.properties.api_url+"/"+B.properties.cadastre.api+"/invariants";if("cadastre"===this.cadastreAPI_)var f="ID_COM",g="DNUPRO",h="INVAR|ID_PAR|oid";else f="id_com",g="dnupro",h="INVAR|ID_PAR|id_local";for(var k={relation:"OR",operators:[]},m=0;m<a.length;m++)k.operators.push({relation:"AND",operators:[{column:g,
compare_operator:"=",value:a[m].DNUPRO},{column:f,compare_operator:"=",value:a[m].ID_COM}]});$(b).bootstrapTable("showLoading");A({method:"POST",url:e,headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},data:{filter:k,attributs:h,jsonformat:"anonymous",order_by:"INVAR",result_srid:E(B.g().B).J().Z.substring(5)},scope:this.b,success:function(a){$(b).bootstrapTable("hideLoading");if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(b).bootstrapTable("load",
a);$(b+"-toolbar").show();$(b).off("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table");$(b).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",function(){$(c).bootstrapTable("removeAll");d.eA($(b).bootstrapTable("getAllSelections"),c)});1===a.length&&$(b).bootstrapTable("check",0)},error:function(){$(b).bootstrapTable("hideLoading")}})}};Y.prototype.v.prototype.getBatiBaseInvariantsOnTable=Y.prototype.v.prototype.dA;
Y.prototype.v.prototype.eA=function(a,b){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBatiBaseParcellesOnTable");if(0!==a.length){$(b).bootstrapTable("showLoading");for(var c=B.properties.api_url+"/"+B.properties.cadastre.api+"/parcelles",d={relation:"OR",operators:[]},e=0;e<a.length;e++)d.operators.push({relation:"AND",operators:[{column:"id_par",compare_operator:"=",value:a[e].ID_PAR}]});A({method:"POST",url:c,headers:{Accept:"application/x-vm-json",
"X-HTTP-Method-Override":"GET"},data:{filter:d,attributs:"id_par",order_by:"parcelle",result_srid:E(B.g().B).J().Z.substring(5)},scope:this.b,success:function(a){$(b).bootstrapTable("hideLoading");if(!n(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(b).bootstrapTable("load",a);$(b+"-toolbar").show();1===a.length&&$(b).bootstrapTable("check",0)},error:function(){$(b).bootstrapTable("hideLoading")}})}};Y.prototype.v.prototype.getBatiBaseParcellesOnTable=Y.prototype.v.prototype.eA;
Y.prototype.v.prototype.$C=function(a){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectCommuneForm");if(!n(a))return"selectCommune non renseign\u00e9";this.Pf=this.Ia.length=0;""!==$(a).val()&&(this.Ia.push("veremes_cadastre_commune"),void 0===B.D.R.Va("veremes_cadastre_commune")&&B.D.R.jb({Ta:"veremes_cadastre_commune",wb:"Commune",Na:["zoom","delete"]}),this.pf(B.properties.cadastre.api+"/communes","id_com",a,"veremes_cadastre_commune"));B.D.R.te(this.Ia[this.Ia.length-
1])};Y.prototype.v.prototype.selectCommuneForm=Y.prototype.v.prototype.$C;
Y.prototype.v.prototype.fD=function(a,b){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectSectionForm");if(!n(a))return"selectCommune non renseign\u00e9";if(!n(b))return"tableSection non renseign\u00e9";this.Pf=this.Ia.length=0;""!==$(a).val()&&(this.Ia.push("veremes_cadastre_commune"),void 0===B.D.R.Va("veremes_cadastre_commune")&&B.D.R.jb({Ta:"veremes_cadastre_commune",wb:"Commune",Na:["zoom","delete"]}),this.pf(B.properties.cadastre.api+"/communes","id_com",
a,"veremes_cadastre_commune"));0<$(b).bootstrapTable("getAllSelections").length&&(this.Ia.push("veremes_cadastre_section"),void 0===B.D.R.Va("veremes_cadastre_section")&&B.D.R.jb({Ta:"veremes_cadastre_section",wb:"Section",Na:["zoom","delete"]}),this.Xi(B.properties.cadastre.api+"/sections","id_sec",b,"veremes_cadastre_section"));B.D.R.te(this.Ia[this.Ia.length-1])};Y.prototype.v.prototype.selectSectionForm=Y.prototype.v.prototype.fD;
Y.prototype.v.prototype.bD=function(a,b){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectSectionForm");if(!n(a))return"selectCommune non renseign\u00e9";if(!n(b))return"tableLieuDit non renseign\u00e9";this.Pf=this.Ia.length=0;""!==$(a).val()&&(this.Ia.push("veremes_cadastre_commune"),void 0===B.D.R.Va("veremes_cadastre_commune")&&B.D.R.jb({Ta:"veremes_cadastre_commune",wb:"Commune",Na:["zoom","delete"]}),this.pf(B.properties.cadastre.api+"/communes","id_com",
a,"veremes_cadastre_commune"));0<$(b).bootstrapTable("getAllSelections").length&&(this.Ia.push("veremes_cadastre_lieu_dit"),void 0===B.D.R.Va("veremes_cadastre_lieu_dit")&&B.D.R.jb({Ta:"veremes_cadastre_lieu_dit",wb:"Lieu-dit",Na:["zoom","delete"]}),this.Xi(B.properties.cadastre.api+"/lieudits","oid",b,"veremes_cadastre_lieu_dit"));B.D.R.te(this.Ia[this.Ia.length-1])};Y.prototype.v.prototype.selectLieuDitForm=Y.prototype.v.prototype.bD;
Y.prototype.v.prototype.eD=function(a,b,c){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectSectionForm");if(!n(a))return"selectCommune non renseign\u00e9";if(!n(b))return"selectSection non renseign\u00e9";if(!n(c))return"tableParcelle non renseign\u00e9";this.Pf=this.Ia.length=0;""!==$(a).val()&&(this.Ia.push("veremes_cadastre_commune"),void 0===B.D.R.Va("veremes_cadastre_commune")&&B.D.R.jb({Ta:"veremes_cadastre_commune",wb:"Commune",Na:["zoom","delete"]}),
this.pf(B.properties.cadastre.api+"/communes","id_com",a,"veremes_cadastre_commune"));""!==$(b).val()&&(this.Ia.push("veremes_cadastre_section"),void 0===B.D.R.Va("veremes_cadastre_section")&&B.D.R.jb({Ta:"veremes_cadastre_section",wb:"Section",Na:["zoom","delete"]}),this.pf(B.properties.cadastre.api+"/sections","id_sec",b,"veremes_cadastre_section"));0<$(c).bootstrapTable("getAllSelections").length&&(this.Ia.push("veremes_cadastre_parcelle"),void 0===B.D.R.Va("veremes_cadastre_parcelle")&&B.D.R.jb({Ta:"veremes_cadastre_parcelle",
wb:"Parcelle",Na:["zoom","delete"]}),this.Xi(B.properties.cadastre.api+"/parcelles","id_par",c,"veremes_cadastre_parcelle"));B.D.R.te(this.Ia[this.Ia.length-1])};Y.prototype.v.prototype.selectParcelleBySectionForm=Y.prototype.v.prototype.eD;
Y.prototype.v.prototype.cD=function(a,b,c){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectParcelleByAdresse");if(!n(a))return"selectCommune non renseign\u00e9";if(!n(b))return"selectSection non renseign\u00e9";if(!n(c))return"tableParcelle non renseign\u00e9";this.Pf=this.Ia.length=0;""!==$(a).val()&&(this.Ia.push("veremes_cadastre_commune"),void 0===B.D.R.Va("veremes_cadastre_commune")&&B.D.R.jb({Ta:"veremes_cadastre_commune",wb:"Commune",Na:["zoom",
"delete"]}),this.pf(B.properties.cadastre.api+"/communes","id_com",a,"veremes_cadastre_commune"));0<$(b).bootstrapTable("getAllSelections").length&&(this.Ia.push("veremes_cadastre_voie"),void 0===B.D.R.Va("veremes_cadastre_voie")&&B.D.R.jb({Ta:"veremes_cadastre_voie",wb:"Voie",Na:["delete"]}),this.Xi(B.properties.cadastre.api+"/voies","ID_RIVOLI",b,"veremes_cadastre_voie"));""!==$(c).val()&&(this.Ia.push("veremes_cadastre_adresse"),void 0===B.D.R.Va("veremes_cadastre_adresse")&&B.D.R.jb({Ta:"veremes_cadastre_adresse",
wb:"Adresse",Na:["delete"]}),this.pf(B.properties.cadastre.api+"/adresses","ID_PAR",c,"veremes_cadastre_adresse"));""!==$(c).val()?(this.Ia.push("veremes_cadastre_parcelle"),void 0===B.D.R.Va("veremes_cadastre_parcelle")&&B.D.R.jb({Ta:"veremes_cadastre_parcelle",wb:"Parcelle",Na:["zoom","delete"]}),this.pf(B.properties.cadastre.api+"/parcelles","id_par",c,"veremes_cadastre_parcelle")):0<$(b).bootstrapTable("getAllSelections").length&&0<this.aAdresses.length&&(this.Ia.push("veremes_cadastre_parcelle"),
void 0===B.D.R.Va("veremes_cadastre_parcelle")&&B.D.R.jb({Ta:"veremes_cadastre_parcelle",wb:"Parcelle",Na:["zoom","delete"]}),this.Ig(B.properties.cadastre.api+"/parcelles","id_par",this.aAdresses,"ID_PAR","veremes_cadastre_parcelle"));B.D.R.te(this.Ia[this.Ia.length-1])};Y.prototype.v.prototype.selectParcelleByAdresse=Y.prototype.v.prototype.cD;
Y.prototype.v.prototype.dD=function(a,b,c,d){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectParcelleByProprietaire");if(!n(a))return"selectCommune non renseign\u00e9";if(!n(b))return"tableProprietaires non renseign\u00e9";if(!n(c))return"tableComptes non renseign\u00e9";if(!n(d))return"tableParcelles non renseign\u00e9";this.Pf=this.Ia.length=0;""!==$(a).val()&&(this.Ia.push("veremes_cadastre_commune"),void 0===B.D.R.Va("veremes_cadastre_commune")&&B.D.R.jb({Ta:"veremes_cadastre_commune",
wb:"Commune",Na:["zoom","delete"]}),this.pf(B.properties.cadastre.api+"/communes","id_com",a,"veremes_cadastre_commune"));0<$(b).bootstrapTable("getAllSelections").length&&(this.Ia.push("veremes_cadastre_proprietaire"),void 0===B.D.R.Va("veremes_cadastre_proprietaire")&&B.D.R.jb({Ta:"veremes_cadastre_proprietaire",wb:"Propri\u00e9taire",Na:["delete"]}),a=$(b).bootstrapTable("getAllSelections")[0],this.nt(B.properties.cadastre.api+"/proprietaires","DDENOM",a.DDENOM,"ID_COM",a.ID_COM,"veremes_cadastre_proprietaire"));
if(0<$(c).bootstrapTable("getAllSelections").length){this.Ia.push("veremes_cadastre_compte");void 0===B.D.R.Va("veremes_cadastre_compte")&&B.D.R.jb({Ta:"veremes_cadastre_compte",wb:"Compte",Na:["delete"]});c=$(c).bootstrapTable("getAllSelections");"cadastre"===this.cadastreAPI_?(a="ID_COM",b="DNUPRO"):(a="id_com",b="dnupro");for(var e={relation:"OR",operators:[]},f=0;f<c.length;f++)e.operators.push({relation:"AND",operators:[{column:a,compare_operator:"=",value:c[f].ID_COM},{column:b,compare_operator:"=",
value:c[f].DNUPRO}]});this.Jg(B.properties.cadastre.api+"/proprietaires",e,"veremes_cadastre_compte")}0<$(d).bootstrapTable("getAllSelections").length&&(this.Ia.push("veremes_cadastre_parcelle"),void 0===B.D.R.Va("veremes_cadastre_parcelle")&&B.D.R.jb({Ta:"veremes_cadastre_parcelle",wb:"Parcelle",Na:["zoom","delete"]}),d=$(d).bootstrapTable("getAllSelections"),this.Ig(B.properties.cadastre.api+"/parcelles","id_par",d,"ID_PAR","veremes_cadastre_parcelle"));B.D.R.te(this.Ia[this.Ia.length-1])};
Y.prototype.v.prototype.selectParcelleByProprietaire=Y.prototype.v.prototype.dD;
Y.prototype.v.prototype.ZC=function(a,b,c,d,e){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectBatiByProprietaire");if(!n(a))return"selectCommune non renseign\u00e9";if(!n(b))return"tableProprietaires non renseign\u00e9";if(!n(c))return"tableComptes non renseign\u00e9";if(!n(d))return"tableInvariants non renseign\u00e9";if(!n(e))return"tableParcelles non renseign\u00e9";if("cadastre"===this.cadastreAPI_)var f="DDENOM",g="ID_COM";else f="ddenom",g="id_com";
this.Pf=this.Ia.length=0;""!==$(a).val()&&(this.Ia.push("veremes_cadastre_commune"),void 0===B.D.R.Va("veremes_cadastre_commune")&&B.D.R.jb({Ta:"veremes_cadastre_commune",wb:"Commune",Na:["zoom","delete"]}),this.pf(B.properties.cadastre.api+"/communes","id_com",a,"veremes_cadastre_commune"));0<$(b).bootstrapTable("getAllSelections").length&&(this.Ia.push("veremes_cadastre_proprietaire"),void 0===B.D.R.Va("veremes_cadastre_proprietaire")&&B.D.R.jb({Ta:"veremes_cadastre_proprietaire",wb:"Propri\u00e9taire",
Na:["delete"]}),a=$(b).bootstrapTable("getAllSelections")[0],this.nt(B.properties.cadastre.api+"/proprietaires",f,a.DDENOM,g,a.ID_COM,"veremes_cadastre_proprietaire"));if(0<$(c).bootstrapTable("getAllSelections").length){this.Ia.push("veremes_cadastre_compte");void 0===B.D.R.Va("veremes_cadastre_compte")&&B.D.R.jb({Ta:"veremes_cadastre_compte",wb:"Compte",Na:["delete"]});c=$(c).bootstrapTable("getAllSelections");if("cadastre"===this.cadastreAPI_)var f="ID_COM",g="DNUPRO",h="oid";else f="id_com",g=
"dnupro",h="id_local";a={relation:"OR",operators:[]};for(b=0;b<c.length;b++)a.operators.push({relation:"AND",operators:[{column:f,compare_operator:"=",value:c[b].ID_COM},{column:g,compare_operator:"=",value:c[b].DNUPRO}]});this.Jg(B.properties.cadastre.api+"/proprietaires",a,"veremes_cadastre_compte")}0<$(d).bootstrapTable("getAllSelections").length&&(this.Ia.push("veremes_cadastre_invariant"),void 0===B.D.R.Va("veremes_cadastre_invariant")&&B.D.R.jb({Ta:"veremes_cadastre_invariant",wb:"Invariant",
Na:["delete"]}),this.Xi(B.properties.cadastre.api+"/invariants",h,d,"veremes_cadastre_invariant"));0<$(e).bootstrapTable("getAllSelections").length&&(this.Ia.push("veremes_cadastre_parcelle"),void 0===B.D.R.Va("veremes_cadastre_parcelle")&&B.D.R.jb({Ta:"veremes_cadastre_parcelle",wb:"Parcelle",Na:["zoom","delete"]}),this.Xi(B.properties.cadastre.api+"/parcelles","id_par",e,"veremes_cadastre_parcelle"));B.D.R.te(this.Ia[this.Ia.length-1])};Y.prototype.v.prototype.selectBatiByProprietaire=Y.prototype.v.prototype.ZC;
function nA(){B.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.removeMapInteractions");B.g().Ce();B.g().za.hide()}B.module.directive("appCadastre",Y.prototype.TF);B.module.controller("AppcadastreController",Y.prototype.v);Ox.zQ={};function jd(){B.log("nsVmap.nsToolsManager.ToolsManager");this.at=uA();this.ub=new S;this.R=new V;this.OA()}qa("nsVmap.nsToolsManager.ToolsManager",jd);jd.prototype.OA=function(){B.log("nsVmap.nsToolsManager.ToolsManager.instanciateAvaliableModules");var a=Object.keys(Ox.Bn);B.log("avaliableModules: ",a);for(var b=0;b<a.length;b++)vA(this,a[b])};jd.prototype.instanciateAvaliableModules=jd.prototype.OA;
function vA(a,b){B.log("nsVmap.nsToolsManager.ToolsManager.instanciateModule");b=b.toLowerCase().replace(/\b[a-z]/g,function(a){return a.toUpperCase()});null!=Ox.Bn[b]?a[b]=new Ox.Bn[b]:console.error("tool ("+b+") does not exist")}
jd.prototype.AE=function(){B.log("nsVmap.nsToolsManager.BasicTools.prototype.vmapToolsDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang",infos:"=appInfos",currentAction:"=appAction"},controller:"AppVmaptoolsController",controllerAs:"ctrl",bindToController:!0,templateUrl:B.properties.vmap_folder+"/template/tools/tools.html"}};jd.prototype.vmapToolsDirective=jd.prototype.AE;
jd.prototype.yE=function(a){return function(b){b.oToolsTree=B.D.at;for(var c in b.oToolsTree){var d="",e='<div id="'+c+'-container" class="right-sidebar" ',e=e+("ng-class=\"ctrl.openedTool == '"+c+"' ? 'open' : ''\">"),f;for(f in b.oToolsTree[c])d+='<div id="'+f+'-tool" class="side-tool ng-isolate-scope app-'+f+'" ',d+='app-map="ctrl.map" app-lang="ctrl.lang" app-infos="ctrl.infos" app-action="ctrl.currentAction"></div>';angular.element($("tools-container")).append(a(e+d+"</div>")(b))}}};
jd.prototype.yE.$inject=["$compile"];jd.prototype.zE=function(){B.log("nsVmap.nsToolsManager.BasicTools.prototype.vmapToolsController");this.oToolsTree=B.D.at;this.openedTool="_"};jd.prototype.vmapToolsController=jd.prototype.zE;function uA(){var a={};A({method:"GET",url:B.properties.api_url+"/vmap/usermodules",async:!1,responseType:"",success:function(b){a=JSON.parse(b.data).usermodules}});return a}jd.prototype.zI=function(){return this.at};jd.prototype.getToolsTree=jd.prototype.zI;
jd.prototype.EH=function(){return this.ub};jd.prototype.getBasicTools=jd.prototype.EH;jd.prototype.OH=function(){return this.R};jd.prototype.getInfoContainer=jd.prototype.OH;jd.prototype.Hu=function(a){return this[a]};jd.prototype.getTool=jd.prototype.Hu;B.module.directive("appVmaptools",jd.prototype.AE);B.module.directive("toolsContainer",jd.prototype.yE);B.module.controller("AppVmaptoolsController",jd.prototype.zE);var wA={};qa("nsUtils",wA);wA.MF=!1;wA.log=function(a){null!=Z.da&&Z.da.debug_mode&&wA.MF&&console.log(a)};wA.log=wA.log;wA.hf=function(){wA.log("util.unselectAll");$("#treeView").treeview("unselectNode",[$("#treeView").treeview("getSelected"),{me:!0}]);$("#treeWithLines").treeview("unselectNode",[$("#treeWithLines").treeview("getSelected"),{me:!0}]);angular.element($("#studio_container")).scope().$broadcast("update element",{});angular.element($("#FormModal")).scope().ctrl.dw()};wA.unselectAll=wA.hf;
wA.reloadForm=function(a){wA.log("util.reloadForm");null!=a||(a="#studio_form_reader");var b=angular.element($(a).children()).scope();b.oFormValues[b.sFormDefinitionName]={};setTimeout(function(){b.compileTemplate();setTimeout(function(){b.ctrl.zs(!0);setTimeout(function(){b.ctrl.Mp()},100)},100)},100)};wA.reloadForm=wA.reloadForm;wA.clone=function(a){wA.log("util.clone");return a};wA.clone=wA.clone;wA.kk=function(a){wA.log("util.JsonStringifier");return JSON.stringify(a,null,2)};
wA.JsonStringifier=wA.kk;
wA.Ws=function(a){var b=a.insert;0==b.javascript&&delete b.javascript;0==b.style&&delete b.style;for(var c=0;c<b.rows.length;)if("object"!==typeof b.rows)console.error("error on rows integrity, this row who have been deleted :",b.rows),delete b.rows;else{if(Array.isArray(b.rows[c].fields))for(var d=0;d<b.rows[c].fields.length;)if("object"!==typeof b.rows[c].fields[d])console.error("error on fields integrity, this field who have been deleted in row "+c+", field "+d+" :",b.rows[c].fields[d]),delete b.rows[c].fields[d];
else{var e=b.rows[c].fields[d],f=[];if("undefined"==typeof e.type||"undefined"==e.name||"undefined"==e.id)return console.error("error on minimal containt of a field :",e),null;switch(e.type){case "title":case "label":if("undefined"==typeof e.label)return console.error(e.type+" without a label isn't a "+e.type+" :",e),null;f=["type","id","label","name"];break;case "hr":f=["type","id","name"];break;case "subtitle":if("undefined"==typeof e.label)return console.error("subtitle without a text isn't a subtitle :",
e),null;"undefined"==typeof e["class"]&&delete e["class"];f=["type","id","label","name","class"];break;case "checkbox":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.checked&&0!=e.checked||delete e.checked;f=["type","id","label","name","checked"];break;case "radio":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.checked&&0!=e.checked||delete e.checked;f="type id label name checked options".split(" ");break;
case "textarea":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.required&&0!=e.required||delete e.required;"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f="type id label name required nb_cols".split(" ");break;case "select":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.required&&0!=e.required||delete e.required;"undefined"!=typeof e.multiple&&0!=e.multiple||delete e.multiple;if(!q(e.options)&&!r(e.options))return console.error(e.type+
"'s options are always an array :",e),null;if("object"!=typeof e.web_service)delete e.web_service;else if("undefined"!=typeof e.web_service.parameter&&delete e.web_service.parameter,"string"!=typeof e.web_service.ressource_id||"string"!=typeof e.web_service.id_key||"string"!=typeof e.web_service.label_key)return null;"string"!=typeof e.child_select&&delete e.child_select;"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f="type id label name required nb_cols multiple options web_service child_select".split(" ");
break;case "double_select":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.required&&0!=e.required||delete e.required;if(!Array.isArray[e.options])return console.error(e.type+"'s options are always an array :",e),null;if("object"!=typeof e.web_service)delete e.web_service,console.error(e.type+"'s WS are always an object :",e);else if("undefined"!=typeof e.web_service.parameter&&delete e.web_service.parameter,"string"!=typeof e.web_service.ressource_id||
"string"!=typeof e.web_service.id_key||"string"!=typeof e.web_service.label_key)return console.error(e.type+"'s WS parameter are always strings :",e),null;"undefined"==typeof e.size&&(e.size=5);"string"!=typeof e.label_from&&delete e.label_from;"string"!=typeof e.label_to&&delete e.label_to;"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f="type id label name required nb_cols options web_service size label_from label_to name_from name_to".split(" ");break;case "date":case "datetime":case "upload":case "display_label":case "color_picker":"undefined"==
typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f=["type","id","label","name","nb_cols"];break;case "tinymce":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"==typeof e.nb_rows&&delete e.nb_rows;"object"!=typeof e.options&&delete e.options;f="type id label name nb_rows options".split(" ");break;case "CodeMirror":case "slider":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"object"!=
typeof e.options&&delete e.options;f=["type","id","label","name","options"];break;case "text":case "password":case "url":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.required&&0!=e.required||delete e.required;"undefined"!=typeof e.pattern&&""!=e.pattern||delete e.pattern;"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f="type id label name pattern required nb_cols".split(" ");break;case "number":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",
e);"undefined"==typeof e.min&&delete e.min;"undefined"==typeof e.max&&delete e.max;"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f="type id label name min max nb_cols".split(" ");break;case "map_osm":case "map_bing":case "map_vmap":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.required&&0!=e.required||delete e.required;if("object"!=typeof e.map_options)delete e.map_options;else if(f=e.map_options,"map_osm"==e.type){"OSM"!=f.type&&console.warn(e.name+
" problem with data type :",f);if("object"!=typeof f.center)return console.error(e.name+"have no center's parameter :",f),null;var g=f.center;if(Array.isArray(g.coord)||Array.isArray(g.extent)){if(2!=g.coord.length&&Array.isArray(g.coord))return console.error(e.name+" bad parameters for center :",f),null;if(4!=g.extent.length&&Array.isArray(g.extent))return console.error(e.name+" bad parameters for extent :",f),null}else return console.error(e.name+" have no correct coordinate :",f),null;if(Array.isArray(g.coord)&&
"undefined"==typeof g.zoom&&"undefined"==typeof g.scale)return console.error(e.name+" center parameter need a scale value :",f),null;"undefined"==typeof g.zoom&&"undefined"!=typeof g.scale?delete g.zoom:"undefined"!=typeof g.zoom&&"undefined"==typeof g.scale&&delete g.scale;if("object"!=typeof f.controls)return console.error(e.name+" have no control's parameter :",f),null;if(4!=Object.keys(f.controls).length)return console.error(e.name+" bad control's parameter :",f),null;Array.isArray(f.layers)?
0==f.layers.length&&delete f.layers:console.warn(e.name+" layers problem :",f);if("object"!=typeof f.interactions)return console.error(e.name+" have no interactions's parameter :",f),null;if(7!=Object.keys(f.interactions).length)return console.error(e.name+" bad interactions's parameter :",f),null;"undefined"==typeof f.draw_color&&delete f.draw_color;Array.isArray(f.features)?0==f.features.length&&delete f.features:console.warn(e.name+" bad type for features :",f);"undefined"==typeof f.coord_accuracy&&
(f.coord_accuracy=8)}else if("map_bing"==e.type){"bing"!=f.type&&console.warn(e.name+" preoblem with data type :",f);if("object"!=typeof f.center)return console.error(e.name+"have no center's parameter :",f),null;g=f.center;if(Array.isArray(g.coord)||Array.isArray(g.extent)){if(2!=g.coord.length&&Array.isArray(g.coord))return console.error(e.name+" bad parameters for center :",f),null;if(4!=g.extent.length&&Array.isArray(g.extent))return console.error(e.name+" bad parameters for extent :",f),null}else return console.error(e.name+
" have no correct coordinate :",f),null;if(Array.isArray(g.coord)&&"undefined"==typeof g.zoom&&"undefined"==typeof g.scale)return console.error(e.name+" center parameter need a scale value :",f),null;"undefined"==typeof g.zoom&&"undefined"!=typeof g.scale?delete g.zoom:"undefined"!=typeof g.zoom&&"undefined"==typeof g.scale&&delete g.scale;if("object"!=typeof f.controls)return console.error(e.name+" have no control's parameter :",f),null;if(4!=Object.keys(f.controls).length)return console.error(e.name+
" bad control's parameter :",f),null;Array.isArray(f.layers)?0==f.layers.length&&delete f.layers:console.warn(e.name+" layers undefined :",f);if("object"!=typeof f.interactions)return console.error(e.name+" have no interactions's parameter :",f),null;if(7!=Object.keys(f.interactions).length)return console.error(e.name+" bad interactions's parameter :",f),null;"undefined"==typeof f.draw_color&&delete f.draw_color;Array.isArray(f.features)?0==f.features.length&&delete f.features:console.warn(e.name+
" bad type for features :",f);"undefined"==typeof f.coord_accuracy&&(f.coord_accuracy=8);if("object"!=typeof f.source)return console.error(e.name+" have no source's parameter :",f),null;if(3!=Object.keys(f.source).length)return console.error(e.name+" bad source's parameter :",f),null}else if("map_vmap"==e.type){"vmap"!=f.type&&console.warn(e.name+" preoblem with data type :",f);if("object"!=typeof f.center)return console.error(e.name+"have no center's parameter :",f),null;g=f.center;if(Array.isArray(g.coord)||
Array.isArray(g.extent)){if(2!=g.coord.length&&Array.isArray(g.coord))return console.error(e.name+" bad parameters for center :",f),null;if(4!=g.extent.length&&Array.isArray(g.extent))return console.error(e.name+" bad parameters for extent :",f),null}else return console.error(e.name+" have no correct coordinate :",f),null;if(Array.isArray(g.coord)&&"undefined"==typeof g.zoom&&"undefined"==typeof g.scale)return console.error(e.name+" center parameter need a scale value :",f),null;"undefined"==typeof g.zoom&&
"undefined"!=typeof g.scale?delete g.zoom:"undefined"!=typeof g.zoom&&"undefined"==typeof g.scale&&delete g.scale;if("object"!=typeof f.controls)return console.error(e.name+" have no control's parameter :",f),null;if(4!=Object.keys(f.controls).length)return console.error(e.name+" bad control's parameter :",f),null;Array.isArray(f.layers)?0==f.layers.length&&delete f.layers:console.warn(e.name+" bad type for layers :",f);if("object"!=typeof f.interactions)return console.error(e.name+" have no interactions's parameter :",
f),null;if(7!=Object.keys(f.interactions).length)return console.error(e.name+" bad interactions's parameter :",f),null;"undefined"==typeof f.draw_color&&delete f.draw_color;Array.isArray(f.features)?0==f.features.length&&delete f.features:console.warn(e.name+" bad type for features :",f);"undefined"==typeof f.coord_accuracy&&(f.coord_accuracy=8);if("object"!=typeof f.tree)return console.error(e.name+" have no tree object :",f),null;if(0==Object.keys(f.tree).length)return console.error(e.name+" empty tree :",
f),null}"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f="type id label name required map_options nb_cols".split(" ")}for(var h in e)-1===f.indexOf(h)&&delete e[h];d++}else console.error("error on fields integrity, this fields who have been deleted in row "+c+" :",b.rows[c].fields),delete b.rows[c].fields;c++}return a};wA.JsonOptimizer=wA.Ws;
wA.jh=function(a,b){a=n(a)?a:"";if(b=n(b)?b:!1)return this.jh(a);a=a.replace(",",".");b=a.split(".");if(0===b.length)return NaN;if(1===b.length)return this.jh(a);if(2<=b.length){a=this.jh(b[0]);if(2===b.length)b=this.jh(b[1]);else{for(var c="",d=1;d<b.length;d++)c+=b[d];b=this.jh(c)}return parseFloat(a+"."+b)}return NaN};wA.jh=function(a){for(var b="",c=0;c<a.length;c++){var d=a.charAt(c);isNan(parseInt(d))||(b+=d)}return parseInt(b)};wA.numberParser=wA.jh;
wA.getElementsByName=function(a,b,c){var d=[];if(null==c||null==a[b]||null==a[b].rows)return d;for(var e=0;e<a[b].rows.length;e++)if(null!=a[b].rows[e].fields)for(var f=0;f<a[b].rows[e].fields.length;f++)a[b].rows[e].fields[f].name===c&&d.push(a[b].rows[e].fields[f]);return d};oProperties={mode:"dev",timeNotify:2500};function xA(){Z.log("nsVFB.JsonLoader");this.Vj=null;Z.module.directive("appJsonLoader",this.TA);Z.module.controller("AppJsonLoaderController",["$scope","$rootScope","$timeout",this.Ea])}qa("nsVFB.JsonLoader",xA);xA.prototype.TA=function(){Z.log("nsVFB.JsonLoader.jsonLoaderDirective");return{restrict:"A",replace:!0,controller:"AppJsonLoaderController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/JsonLoader.html"}};
xA.prototype.jsonLoaderDirective=xA.prototype.TA;
xA.prototype.Ea=function(a,b,c){Z.log("nsVFB.JsonLoader.jsonLoaderController");var d=this;this.b=a;this.G=b;this.WD={};this.buttonHide=!1;this.aSuggestedTableFields=[];this.applicationName=Z.Tg();a.collapsed=Z.Eh[0];a.iWorkspaceId=Z.mc();a.iWorkSpace=Z.mc();a["default"]="Default";a.FormSelected="Perso";a.token=Z.rA();b.selected_form_type=Z.config.default_form_type;b.$watch("selected_form_type",function(a){Z.log("jsonLoaderController selected_form_type");var c=Z.ea();null==c[a]&&(c[a]={name:"custom-form",
title:"",input_size:"xxs",nb_cols:12,javascript:!1,rows:[]},Z.ic(c));b.$broadcast("updateEvent",Z.ea());b.$broadcast("update element",{type:"undefined"})});Z.Sh().Vj=new Slider("#slider_Form",{formatter:function(a){return Math.round(100*a/12)+"%"}});Z.Sh().Vj.on("change",function(){var d=Z.ea();d[b.selected_form_type].nb_cols=Z.Sh().Vj.getValue();Z.ic(d);c(function(){b.$broadcast("updateJsonModel",Z.ea());b.$broadcast("updateForm",Z.ea());a.$apply()},1)});a.$watch("title",function(a){Z.log("jsonLoaderController title");
var c=Z.ea();c[b.selected_form_type]&&(c[b.selected_form_type].title=a);Z.ic(c);b.$broadcast("updateJsonModel",Z.ea());b.$broadcast("updateForm",Z.ea())});a.$watch("event",function(a){Z.log("jsonLoaderController event");var c=Z.ea();c[b.selected_form_type]&&(c[b.selected_form_type].event=a);Z.ic(c);b.$broadcast("updateJsonModel",Z.ea());b.$broadcast("updateForm",Z.ea())});a.$watch("token",function(a){Z.log("jsonLoaderController token");Z.setToken(a)});a.$watch("iWorkspaceId",function(a){Z.log("jsonLoaderController id");
Z.setId(a)});a.$watch("text",function(){Z.log("jsonLoaderController text");if("undefined"!==typeof a.text.Loader){d.text=a.text.Loader;var b=function(){null!=angular.element($("#FormModal")).scope()?(angular.element($("#load_Perso_button")).click(),"wab"==Z.Tg()&&(d.buttonHide=!0)):setTimeout(function(){b()},1E3)};c(function(){b()})}});a.state=!1};xA.prototype.jsonLoaderController=xA.prototype.Ea;
function yA(a,b){Z.log("nsVFB.JsonLoader.prototype.jsonLoaderController.requestToJson");var c={},d={};angular.element($("#FormModal")).scope().ctrl.Ip();a.b.iWorkSpace=a.b.iWorkspaceId;a.b["default"]=a.b.FormSelected;a.b.collapsed=Z.Eh[0];if("gtf"===a.applicationName)var e=Z.da.web_server_name+"/"+Z.da.services_alias+"/gtf/workspaces/"+Z.mc(),c={Accept:"application/json"},d={form:a.b.FormSelected};else"vmap"===a.applicationName?(e="Perso"===a.b.FormSelected?"custom":angular.lowercase(a.b.FormSelected),
e=Z.da.web_server_name+"/"+Z.da.services_alias+"/"+Z.config.get.api+"/"+Z.config.get.ressource+"/"+Z.mc()+"/forms/"+e+"/"):"wab"===a.applicationName&&(e=Z.da.web_server_name+"/"+Z.da.services_alias+"/"+Z.config.get.api+"/"+Z.config.get.ressource+"/"+Z.mc()+"/form");ed();A({method:"GET",url:e,headers:c,params:d,scope:a.b,success:function(c){fd();null!=c[0]||null!=c.data&&(c=c.data);if("gtf"===a.applicationName){if(null==c.workspaces&&null==c.data){var d;switch(a.b.FormSelected){case "Default":d="Default_Reset";
break;case "Published":d="Default_Published";break;case "Perso":d="Perso_Reset"}zA(a,d,void 0,function(b){if(null!=b.errorMessage)return bootbox.alert("<h4>"+b.errorMessage+"</h4>",function(){}),0;yA(a)},function(b,c){$.notify(a.b.text.Loader.Notify.GetJson_Error+c,{className:"error",autoHideDelay:Z.Gb})})}}else if(null==c[0]){if(null!=Z.config.get.no_result_function)a[Z.config.get.no_result_function](c,b);return 0}AA(a,c,b)},error:function(){fd();ga(void 0)&&a.b.$eval(void 0);$.notify(a.b.text.Loader.Notify.GetJson_Error+
status,{className:"error",autoHideDelay:Z.Gb})}})}
function AA(a,b,c){Z.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.useJson");"gtf"===a.applicationName&&(b=null!=b.workspaces?b.workspaces[0].json_form:b.data[0].json_form);if(null==b[0])console.error("data[0] not defined, data: ",b);else if(Z.kD(angular.copy(b[0])),Z.ic(angular.copy(b[0])),a.WD=angular.copy(b[0]),a.b.json_forms=null!=Z.config.avaliable_form_types?Z.config.avaliable_form_types:Object.keys(b[0]),-1!==a.b.json_forms.indexOf("datasources")&&a.b.json_forms.splice(a.b.json_forms.indexOf("datasources"),
1),n(b[1])&&!1!==b[1]?"gtf"===a.applicationName?A({method:"GET",url:b[1],scope:a.b,timeout:5E3,responseType:"text",success:function(a){null!=a.data&&Z.Pl(a.data.replace(/(?:\r\n|\r|\n)/g,"\r\n"))},error:function(){console.error("Problem on Loading javascript")}}):Z.Pl(Z.clone(b[1])):Z.Pl(""),a.G.$broadcast("updateJS",Z.Ug()),n(b[2])&&!1!==b[2]&&(Z.sw(Z.clone(b[2])),a.G.$broadcast("updateCSS",b[2])),null==b[0][a.G.selected_form_type])console.error("Result[0]["+a.G.selected_form_type+"] does not exist");
else{b=b[0][a.G.selected_form_type].nb_cols;var d=Z.ea()[a.G.selected_form_type].title,e=Z.ea()[a.G.selected_form_type].event,f=Z.ea()[a.G.selected_form_type].input_size;Z.Sh().Vj.setValue(b);a.b.title=d;a.b.event=e;a.b.input_size=f;a.G.$broadcast("updateEvent",Z.ea());a.G.$broadcast("updateInfos",Z.ea());a.G.$broadcast("update element",{type:"undefined"});ga(c)&&a.b.$eval(c);setTimeout(function(){Z.reloadForm();angular.element($("#studio_form_reader").children()).scope().ctrl.ti()},1)}}
xA.prototype.Ea.prototype.load=function(a){Z.log("load");"Perso"===a?this.hB(0,a):this.iB(a)};xA.prototype.Ea.prototype.load=xA.prototype.Ea.prototype.load;xA.prototype.Ea.prototype.TO=function(){var a=Z.ea()[this.G.selected_form_type].nb_cols;Z.Sh().Vj.setValue(a)};xA.prototype.Ea.prototype.updateSlider=xA.prototype.Ea.prototype.TO;
xA.prototype.Ea.prototype.hB=function(a,b){function c(){$("#up_element_button").prop("disabled",!1);$("#down_element_button").prop("disabled",!1);$("#add_line_button").prop("disabled",!1);$("#add_row_button").prop("disabled",!1);$("#rem_element_button").prop("disabled",!1);$("#formTools_datasoure_button").prop("disabled",!1);$("#Title_Form_input").prop("disabled",!1);$("#select_size_input").prop("disabled",!1);Z.Sh().Vj.enable();$("#boolean-JS-include").prop("disabled",!1);$("#boolean-CSS-include").prop("disabled",
!1);$("#Lock_Icon").removeClass("fa-lock");$(".selected-in-tree").removeClass("selected-in-tree")}Z.log("nsVFB.JsonLoader.jsonLoaderController.loadWithEdit");var d=this;Z.bq().empty||"Perso"!==d.b["default"]?"Perso"!==d.b["default"]?(d.b.FormSelected=b,yA(d),c()):(yA(d),d.b.FormSelected=b):bootbox.confirm("<h4>"+this.text.Confirmation.Lose+"</h4>",function(a){!0===a&&(angular.element($("#FormModal")).scope().ctrl.Ip(),d.b.FormSelected=b,yA(d),c())})};xA.prototype.Ea.prototype.loadWithEdit=xA.prototype.Ea.prototype.hB;
xA.prototype.Ea.prototype.iB=function(a){function b(){$("#up_element_button").prop("disabled",!0);$("#down_element_button").prop("disabled",!0);$("#add_line_button").prop("disabled",!0);$("#add_row_button").prop("disabled",!0);$("#rem_element_button").prop("disabled",!0);$("#formTools_datasoure_button").prop("disabled",!0);$("#Title_Form_input").prop("disabled",!0);$("#select_size_input").prop("disabled",!0);Z.Sh().Vj.disable();$("#boolean-JS-include").prop("disabled",!0);$("#boolean-CSS-include").prop("disabled",
!0);c.G.$broadcast("update element",{});$("#Lock_Icon").addClass("fa-lock");$(".selected-in-tree").removeClass("selected-in-tree")}Z.log("nsVFB.JsonLoader.jsonLoaderController.loadWithoutEdit");var c=this;Z.bq().empty||"Perso"!==c.b["default"]?"Perso"!==c.b["default"]&&(c.b.FormSelected=a,yA(c),b()):angular.equals(Z.bq(),c.WD)?(angular.element($("#FormModal")).scope().ctrl.Ip(),c.b.FormSelected=a,yA(c),b()):bootbox.UP({message:"<h4>"+c.text.Confirmation.Lose+"<br><br>"+c.text.Confirmation.SaveAndChange+
" ?</h4>",buttons:{success:{label:c.text.Confirmation.Yes,className:"btn-primary",Bb:function(){c.save(function(){c.b.FormSelected=a;yA(c);b()})}},SP:{label:c.text.Confirmation.No,className:"btn-danger",Bb:function(){c.b.FormSelected=a;yA(c);b()}},oQ:{label:c.text.Confirmation.Cancel,className:"btn-default",Bb:function(){}}}})};xA.prototype.Ea.prototype.loadWithoutEdit=xA.prototype.Ea.prototype.iB;
xA.prototype.Ea.prototype.resize=function(){this.b.collapsed=!this.b.collapsed;Z.Eh[0]=this.b.collapsed;Z.resize()};xA.prototype.Ea.prototype.resize=xA.prototype.Ea.prototype.resize;
xA.prototype.Ea.prototype.save=function(a,b){function c(a,c){ga(b)&&e.b.$eval(b);$.notify(e.b.text.Loader.Notify.SaveData_Error+c,{className:"error",autoHideDelay:Z.Gb})}function d(){yA(e,a);$.notify(e.b.text.Loader.Notify.SaveData,{className:"success",autoHideDelay:Z.Gb})}Z.log("nsVFB.JsonLoader.jsonLoaderController.save");var e=this,f=new FormData,g=Z.ea();Z.hf();g=Z.aG(g);"gtf"===this.applicationName&&(g[e.G.selected_form_type].name="WSubform",g.display=g[e.G.selected_form_type],g.update=g[e.G.selected_form_type]);
n(g.search)||(g.search={});f.append("Json",JSON.stringify(g));f.append("Js",Z.Ug());f.append("Css",Z.nj());Z.valid=BA(this,g);Z.valid&&null!==g?zA(e,"Perso_Save",f,d,c):$.notify(e.b.text.Loader.Notify.Validation_Error+": "+Z.mk,{className:"error",autoHideDelay:Z.Gb});Z.wc=!1};xA.prototype.Ea.prototype.save=xA.prototype.Ea.prototype.save;
xA.prototype.Ea.prototype.mM=function(){function a(a,b){$.notify(c.b.text.Loader.Notify.SaveData_Error+b,{className:"error",autoHideDelay:Z.Gb})}function b(){zA(c,c.b.FormSelected+"_Published","",function(){yA(c);$.notify(c.b.FormSelected+c.b.text.Loader.Notify.PublishAndSave,{className:"success",autoHideDelay:Z.Gb})},function(a,b){$.notify(c.b.text.Loader.Notify.Publish_Error+b,{className:"error",autoHideDelay:Z.Gb})})}Z.log("nsVFB.JsonLoader.prototype.jsonLoaderController.publish");Z.wc=!1;var c=
this,d=new FormData,e=Z.ea();Z.hf();"gtf"===this.applicationName&&(e[c.G.selected_form_type].name="WSubform",e.display=e[c.G.selected_form_type],e.update=e[c.G.selected_form_type]);d.append("Json",JSON.stringify(e));d.append("Js",Z.Ug());d.append("Css",Z.nj());Z.valid?"Default"!=c.b.FormSelected?zA(c,"Perso_Save",d,b,a):zA(c,"Default_Published",d,b,a):$.notify(c.b.text.Loader.Notify.Validation_Error,{className:"error",autoHideDelay:Z.Gb})};xA.prototype.Ea.prototype.publish=xA.prototype.Ea.prototype.mM;
function BA(a,b){Z.log("nsVFB.JsonLoader.jsonLoaderController.save");Pa(Z.mk);for(var c in b)if("datasources"!==c&&null!=b[c].rows)for(var d=0;d<b[c].rows.length;d++)for(var e=0;e<b[c].rows[d].fields.length;e++)null!==b[c].rows[d].fields[e].name.match(/\s/g)&&("gtf"===a.applicationName?Z.mk.push(b[c].rows[d].fields[e].name):1>Z.config.avaliable_form_types.length?Z.mk.push(b[c].rows[d].fields[e].name):Z.mk.push(c+"."+b[c].rows[d].fields[e].name));return 0<Z.mk.length?!1:!0}
xA.prototype.Ea.prototype.reset=function(){Z.log("nsVFB.JsonLoader.jsonLoaderController.reset");var a=this;bootbox.confirm("<h4>"+this.text.InfoBulle.Perso.Reset+" ?</h4><h4>"+this.text.Confirmation.Lose+"</h4>",function(b){if(!0===b)if("Default"===a.b.FormSelected&&"gtf"!==a.applicationName){if(null!=Z.config.reset_default_function)a[Z.config.reset_default_function]()}else zA(a,a.b.FormSelected+"_Reset","",function(){$.notify(a.b.FormSelected+a.b.text.Loader.Notify.Reset,{className:"success",autoHideDelay:Z.Gb});
"Perso"===a.b.FormSelected&&yA(a)},function(b,d){$.notify(a.b.text.Loader.Notify.Reset_Error+d,{className:"error",autoHideDelay:Z.Gb})})})};xA.prototype.Ea.prototype.reset=xA.prototype.Ea.prototype.reset;
function zA(a,b,c,d,e){Z.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.putRequest");var f="",g={};"gtf"===a.applicationName?(f=Z.da.web_server_name+"/"+Z.da.services_alias+"/gtf/workspaces/"+Z.mc(),g={cmd:b}):"vmap"===a.applicationName?(f="Perso"===a.b.FormSelected?"custom":angular.lowercase(a.b.FormSelected),f=Z.da.web_server_name+"/"+Z.da.services_alias+"/"+Z.config.get.api+"/"+Z.config.get.ressource+"/"+Z.mc()+"/forms/"+f,g={cmd:b}):"wab"===a.applicationName&&(f=Z.da.web_server_name+
"/"+Z.da.services_alias+"/"+Z.config.get.api+"/"+Z.config.get.ressource+"/"+Z.mc()+"/form");A({method:"PUT",url:f,headers:{"Content-Type":"undefined"},params:g,data:c,scope:a.b,success:d,error:e})}xA.prototype.Ea.prototype.ZN=function(){Z.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.suggestGenerateForm");var a=this;bootbox.confirm("<h4>"+this.b.text.Loader.Notify.generate_form+"</h4>",function(b){!0===b?a.MD():(a.aSuggestedTableFields=[],a.nu())})};
xA.prototype.Ea.prototype.suggestGenerateForm=xA.prototype.Ea.prototype.ZN;
xA.prototype.Ea.prototype.YO=function(a,b){Z.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.useEmptyForm");$.notify(this.b.text.Loader.Notify.no_form,"warning");var c=n(Z.config.avaliable_form_types)?Z.config.avaliable_form_types:["search","insert","update","display"],d={input_size:"xxs",javascript:!1,name:"custom-form",nb_cols:12,rows:[],title:""};a[0]={datasources:{}};for(var e=0;e<c.length;e++)a[0][c[e]]=d;AA(this,a,b)};xA.prototype.Ea.prototype.useEmptyForm=xA.prototype.Ea.prototype.YO;
xA.prototype.Ea.prototype.MD=function(){Z.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.suggestColumnsToGenerateForm");var a=Z.da.web_server_name+"/"+Z.da.services_alias+"/vmap/businessobjects/"+Z.mc()+"/fields/";"wab"===Z.Tg()&&(a=Z.da.web_server_name+"/"+Z.da.services_alias+"/wab/sections/"+Z.mc()+"/fields");var b=this;n(b.aSuggestedTableFields)&&Pa(b.aSuggestedTableFields);A({method:"GET",url:a,headers:{Accept:"application/x-vm-json"},scope:this.b,success:function(a){if(q(a.data)&&
0!==a.data.length)b.aSuggestedTableFields=a.data,$("#select-fields-modal").modal("show");else{var c=angular.element(v.f).scope();c.$root.modalWindow("confirm",b.b.text.Loader.Notify.generate_form_error,{className:"modal-danger",message:b.b.text.Loader.Notify.generate_form_error_description,buttons:{cancel:{label:'<i class="glyphicon glyphicon-remove"></i> Annuler',className:"btn-default"},confirm:{label:'<i class="glyphicon glyphicon-ok"></i> Poursuivre quand m\u00eame',className:"btn-danger"}},callback:function(a){!0===
a?(b.aSuggestedTableFields=[],b.nu()):c.setMode("search")}})}},error:function(){$.notify(b.b.text.Loader.Notify.CreateJson_Error+status,{className:"error",autoHideDelay:Z.Gb})}})};xA.prototype.Ea.prototype.suggestColumnsToGenerateForm=xA.prototype.Ea.prototype.MD;
xA.prototype.Ea.prototype.nu=function(){Z.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.generateFormByBusinessObject");var a=this,b="",b="Perso"===a.b.FormSelected?"custom":"Default"===a.b.FormSelected?"default":"published",b=Z.da.web_server_name+"/"+Z.da.services_alias+"/vmap/businessobjects/"+Z.mc()+"/forms/"+b+"/";"wab"===Z.Tg()&&(b=Z.da.web_server_name+"/"+Z.da.services_alias+"/wab/sections/"+Z.mc()+"/form");for(var c=[],d={},e=0;e<a.aSuggestedTableFields.length;e++)!0===a.aSuggestedTableFields[e].fields[0].bUseForGenerate&&
c.push(a.aSuggestedTableFields[e].fields[0].name),d[a.aSuggestedTableFields[e].fields[0].name]=a.aSuggestedTableFields[e].fields[0].label;c=c.toString().replace(/,/gi,"|");$("#select-fields-modal").modal("hide");"Default"===a.b.FormSelected?zA(a,a.b.FormSelected+"_Reset",{field:c,label:d},function(){$.notify(a.b.FormSelected+a.b.text.Loader.Notify.Reset,{className:"success",autoHideDelay:Z.Gb});"Default"===a.b.FormSelected&&yA(a)},function(b,c){$.notify(a.b.text.Loader.Notify.Reset_Error+c,{className:"error",
autoHideDelay:Z.Gb})}):A({method:"POST",url:b,data:{fields:c,label:d},scope:this.b,success:function(){yA(a)},error:function(){$.notify(a.b.text.Loader.Notify.CreateJson_Error+status,{className:"error",autoHideDelay:Z.Gb})}})};xA.prototype.Ea.prototype.generateFormByBusinessObject=xA.prototype.Ea.prototype.nu;
xA.prototype.Ea.prototype.XN=function(){Z.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.suggestColumnsSelectAllFields");for(var a=0;a<this.aSuggestedTableFields.length;a++)this.aSuggestedTableFields[a].fields[0].bUseForGenerate=!0};xA.prototype.Ea.prototype.suggestColumnsSelectAllFields=xA.prototype.Ea.prototype.XN;
xA.prototype.Ea.prototype.YN=function(){Z.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.suggestColumnsSelectAllFields");for(var a=0;a<this.aSuggestedTableFields.length;a++)this.aSuggestedTableFields[a].fields[0].bUseForGenerate=!1};xA.prototype.Ea.prototype.suggestColumnsUnselectAllFields=xA.prototype.Ea.prototype.YN;
xA.prototype.Ea.prototype.WN=function(){Z.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.suggestColumnsAreAllFieldsSelected");for(var a=!0,b=0;b<this.aSuggestedTableFields.length;b++)!0!==this.aSuggestedTableFields[b].fields[0].bUseForGenerate&&(a=!1);return a};xA.prototype.Ea.prototype.suggestColumnsAreAllFieldsSelected=xA.prototype.Ea.prototype.WN;function CA(){Z.log("nsVFB.FormTools");Z.module.directive("appFormTools",this.Yz);Z.module.controller("AppFormToolsController",["$scope","$rootScope","$timeout",this.Ra])}qa("nsVFB.FormTools",CA);CA.prototype.Yz=function(){Z.log("nsVFB.FormTools.FormToolsDirective");return{restrict:"A",replace:!0,controller:"AppFormToolsController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/FormTools.html"}};CA.prototype.formToolsDirective=CA.prototype.Yz;
CA.prototype.Ra=function(a,b,c){Z.log("nsVFB.FormTools.FormToolsController");var d=this;this.G=b;this.b=a;this.eu=0;this.applicationName=Z.Tg();this.bTreeWithLines_=!1;a.copyPasteContainer={};a.$watch("text",function(){Z.log("formtools text");n(a.text.FormTools)&&(d.text=a.text.FormTools)});a.colapse_tools=Z.Eh[2];d.bz=function(a){Z.log("nsVFB.FormTools.convertJson");var c=Z.ea(),d=[];if(null==c)return console.error("No JSON founded"),d;a=n(a)?a:!0;if(!hb(c[b.selected_form_type]))for(var e=0;e<c[b.selected_form_type].rows.length;e++){!0===
a&&null!=this.text&&d.push({text:this.text.Row+" "+e,state:{expanded:!0},tags:[0],nodes:[],row:e,draggable:!0});for(var f=0;f<c[b.selected_form_type].rows[e].fields.length;f++){var g;switch(c[b.selected_form_type].rows[e].fields[f].type){case "codemirror":g="icon-code";break;case "select":case "list":case "double_select":g="icon-format_list_bulleted";break;case "text":case "tinymce":g="icon-font";break;case "upload":g="icon-file";break;case "checkbox":g="icon-check-square";break;case "radio":g="icon-dot-circle-o";
break;case "date":case "datetime":g="icon-calendar-check-o";break;case "password":g="icon-key";break;case "email":g="icon-at";break;case "url":g="icon-chrome";break;case "integer":case "float":case "number":g="icon-calculator";break;case "color_picker":g="icon-paint";break;case "slider":g="icon-sliders";break;case "textarea":g="icon-paragraph";break;case "hr":g="icon-minus";break;case "label":g="icon-eye";break;case "email":g="icon-at";break;case "hidden":g="icon-user-secret";break;case "link":g=
"glyphicon glyphicon-link";break;case "image":g="glyphicon glyphicon-picture";break;case "map_bing":case "map_osm":case "map_vmap":g="icon-map";break;default:g="icon-point"}!0===a?null!=d[e]&&(d[e].tags[0]+=1,d[e].nodes.push({text:"  "+c[b.selected_form_type].rows[e].fields[f].name,type:c[b.selected_form_type].rows[e].fields[f].type,icon:g,row:e,field:f,draggable:!0})):d.push({text:"  "+c[b.selected_form_type].rows[e].fields[f].name,type:c[b.selected_form_type].rows[e].fields[f].type,icon:g,row:e,
field:f,draggable:!0})}}return d};a.$on("updateEvent",function(){var e=d.bz(!0),f=$("#treeWithLines").treeview("getCollapsed");if(!n(e))return console.error("No JSON converted founded"),0;if(!n(f))return console.error("collapsedNodes undefined"),0;for(var g=0;g<e.length;g++)e[g].collapsed=!1;for(g=0;g<f.length;g++)if(n(f[g].nodes))for(var p=0;p<e.length;p++)f[g].row===e[p].row&&(e[p].collapsed=!0);$("#treeWithLines").treeview({data:e,showTags:!0,showBorder:!1,expandIcon:"glyphicon glyphicon-menu-right",
collapseIcon:"glyphicon glyphicon-menu-down",onNodeSelected:function(a,e){n(e.field)?(c(function(){var a=$("#treeView").treeview("search",[e.text,{ignoreCase:!0,exactMatch:!0,revealResults:!1}]);$("#treeView").treeview("selectNode",[a[0].nodeId,{me:!0}]);$("#treeView").treeview("clearSearch")}),d.uw({type:"element",element_name:e.text.replace(/\s/g,"")}),b.$broadcast("update element",Z.ea()[b.selected_form_type].rows[e.row].fields[e.field])):d.uw({type:"row",row_id:parseInt(e.row)})},onNodeUnselected:function(){Z.hf()},
onNodeHoverIn:function(a){a=a.currentTarget;$(a)[0].childNodes[2].data?(a=$(a)[0].childNodes[2].data.split(" "),a={type:"row",row_id:parseInt(a[1])}):a={type:"element",element_name:$(a)[0].textContent.replace(/\s/g,"")};d.eo(a)},onNodeHoverOut:function(){d.eo({})},highlightSelected:!0,multiSelect:!1});$("#treeView").treeview({data:d.bz(!1),showTags:!1,showBorder:!1,levels:1,showIcon:!0,onNodeSelected:function(b,c){"undefined"!==typeof c.field&&(b=$("#treeWithLines").treeview("search",[c.text,{ignoreCase:!0,
exactMatch:!0,revealResults:!1}]),c=$("#treeWithLines").treeview("search",[a.$parent.text.FormTools.Row+" "+b[0].row,{ignoreCase:!0,exactMatch:!0,revealResults:!1}]),$("#treeWithLines").treeview("expandNode",[c[0].nodeId,{me:!0}]),$("#treeWithLines").treeview("selectNode",[b[0].nodeId,{me:!1}]),$("#treeWithLines").treeview("clearSearch"))},onNodeUnselected:function(){Z.hf()},onNodeHoverIn:function(a){d.eo({type:"element",element_name:$(a.currentTarget)[0].textContent.replace(/\s/g,"")})},onNodeHoverOut:function(){d.eo({})},
highlightSelected:!0,multiSelect:!1});e=$("#treeWithLines").treeview("getEnabled");for(g=0;g<e.length;g++)!0===e[g].collapsed&&$("#treeWithLines").treeview("collapseNode",e[g])});var e={},f={},g=!0;document.getElementById("treeWithLines").addEventListener("dragstart",function(a){$("#load_Perso_button").hasClass("active")&&(a.dataTransfer.setData("Text",a.target.id),a.target.style.opacity="0.5",a.dataTransfer.effectAllowed="move",e=a.target,Z.ho("FormTools"))});document.getElementById("treeWithLines").addEventListener("dragover",
function(a){a.preventDefault()});document.getElementById("treeWithLines").addEventListener("dragenter",function(a){$("#load_Perso_button").hasClass("active")&&(a=a.target,"FormTools"===Z.dn()&&($(a).trigger("mouseover"),a!==e&&"LI"===$(a)[0].tagName&&($(e).remove(),parseInt($(f).attr("data-nodeid"))<parseInt($(a).attr("data-nodeid"))?$(e).insertAfter(a):$(e).insertBefore(a),$(f).trigger("mouseout"),f=a)))});document.getElementById("treeWithLines").addEventListener("drop",function(){if($("#load_Perso_button").hasClass("active")){var c=
0,g=0,m=Z.ea(),p=0;if("FormTools"===Z.dn())if(e.style.opacity="1","indent"===e.childNodes[0].className){var t=g=0;if("indent"===f.childNodes[0].className){var g=parseInt($(e).attr("data-nodeid")),t=$("#treeWithLines").treeview("getNode",g).row,g=$("#treeWithLines").treeview("getNode",g).field,c=parseInt($(f).attr("data-nodeid")),u=$("#treeWithLines").treeview("getNode",c).row,c=$("#treeWithLines").treeview("getNode",c).field,p=m[b.selected_form_type].rows[t].fields[g];m[b.selected_form_type].rows[t].fields.splice(g,
1);m[b.selected_form_type].rows[u].fields.splice(c,0,p);t!==u&&(DA(m[b.selected_form_type].rows[t]),DA(m[b.selected_form_type].rows[u]))}else g=parseInt($(e).attr("data-nodeid")),t=$("#treeWithLines").treeview("getNode",g).row,g=$("#treeWithLines").treeview("getNode",g).field,c=parseInt(f.childNodes[2].data.split(" ")[1]),p=m[b.selected_form_type].rows[t].fields[g],m[b.selected_form_type].rows[t].fields.splice(g,1),m[b.selected_form_type].rows[c].fields.unshift(p),DA(m[b.selected_form_type].rows[t]),
DA(m[b.selected_form_type].rows[c]);0===m[b.selected_form_type].rows[t].fields.length&&m[b.selected_form_type].rows.splice(t,1)}else"indent"===f.childNodes[0].className?$.notify(d.text.Notify.Error_ElOnRow,{className:"error",autoHideDelay:Z.Gb}):(g=parseInt(e.childNodes[2].data.split(" ")[1]),c=parseInt(f.childNodes[2].data.split(" ")[1]),p=m[b.selected_form_type].rows[g],m[b.selected_form_type].rows.splice(g,1),m[b.selected_form_type].rows.splice(c,0,p));Z.ic(m);$(".hover-in-tree").each(function(a,
b){$(b).removeClass("hover-in-tree")});$(".selected-in-tree").removeClass("selected-in-tree");b.$broadcast("updateEvent",Z.ea());Z.ho("no tree");a.$apply()}});document.getElementById("treeView").addEventListener("dragstart",function(a){$("#load_Perso_button").hasClass("active")&&(a.dataTransfer.setData("Text",a.target.id),a.target.style.opacity="0.5",a.dataTransfer.effectAllowed="move",e=a.target,Z.ho("treeView"))});document.getElementById("treeView").addEventListener("dragover",function(a){a.preventDefault()});
document.getElementById("treeView").addEventListener("dragenter",function(a){$("#load_Perso_button").hasClass("active")&&(a=a.target,"treeView"===Z.dn()&&($(a).trigger("mouseover"),a!==e&&"LI"===$(a)[0].tagName&&(parseInt($(f).attr("data-nodeid"))<parseInt($(a).attr("data-nodeid"))?($(e).remove(),$(e).insertAfter(a),$(f).trigger("mouseout"),f=a,g=!1):($(e).remove(),$(e).insertBefore(a),$(f).trigger("mouseout"),f=a,g=!0))))});document.getElementById("treeView").addEventListener("drop",function(){if($("#load_Perso_button").hasClass("active")){var c=
0,d=0,m=Z.ea(),p=0;if("treeView"===Z.dn()){e.style.opacity="1";var d=parseInt($(e).attr("data-nodeid")),t=$("#treeView").treeview("getNode",d).row,d=$("#treeView").treeview("getNode",d).field,c=parseInt($(f).attr("data-nodeid")),u=$("#treeView").treeview("getNode",c).row,c=$("#treeView").treeview("getNode",c).field,p=m[b.selected_form_type].rows[t].fields[d];m[b.selected_form_type].rows[t].fields.splice(d,1);g||(c+=1);m[b.selected_form_type].rows[u].fields.splice(c,0,p);0===m[b.selected_form_type].rows[t].fields.length&&
m[b.selected_form_type].rows.splice(t,1)}Z.ic(m);$(".hover-in-tree").each(function(a,b){$(b).removeClass("hover-in-tree")});$(".selected-in-tree").removeClass("selected-in-tree");b.$broadcast("updateEvent",Z.ea());a.$apply();Z.ho("no tree")}});d.resize=function(){a.colapse_tools=!a.colapse_tools;Z.Eh[2]=a.colapse_tools;Z.resize()}};CA.prototype.formToolsController=CA.prototype.Ra;
CA.prototype.Ra.prototype.Wi=function(){Z.log("nsVFB.FormTools.prototype.formToolsController.prototype.addLine");var a=$("#treeWithLines").treeview("getSelected"),b=Z.ea();1!==a.length&&(a=[EA(this)]);n(a[0].field)&&(a=[$("#treeWithLines").treeview("getNode",a[0].parentId)]);1===a.length?n(a[0].field)||b[this.G.selected_form_type].rows.splice(a[0].row+1,0,{fields:[]}):$.notify(this.text.Notify.Forgotten,{className:"error",autoHideDelay:Z.Gb});$(".selected-in-tree").each(function(a,b){$(b).removeClass("selected-in-tree")});
Z.ic(b);this.G.$broadcast("updateEvent",Z.ea())};CA.prototype.Ra.prototype.addLine=CA.prototype.Ra.prototype.Wi;
CA.prototype.Ra.prototype.addElement=function(){Z.wc=!0;Z.log("nsVFB.FormTools.prototype.formToolsController.prototype.addElement");var a=this,b=$("#treeWithLines").treeview("getSelected"),c=Z.ea(),d=!1;if(1!==b.length){var e=EA(this);if(this.bTreeWithLines_||!n(e.nodes))this.Wi(),e=EA(this),d=!0;b=[e]}if(1===b.length){var f=function(b){for(var c=0;c<b.length;c++)if(n(b[c].fields))for(var d=0;d<b[c].fields.length;d++)if(b[c].fields[d].name==="Element_"+a.eu){a.eu++;f(b);return}},g=Z.ea()[this.G.selected_form_type].rows;
f(g);var g="Element_"+this.eu,e={type:"text",name:g,label:"",required:!1,pattern:"",nb_cols:12},h=b[0].nodeId;this.bTreeWithLines_?(c[this.G.selected_form_type].rows[b[0].row].fields.splice(b[0].field+1,0,e),h+=1):d?(c[this.G.selected_form_type].rows[b[0].row].fields.push(e),h+=2):(this.Wi(),c[this.G.selected_form_type].rows[b[0].row+1].fields.push(e),e=EA(this).nodeId+1,h=b[0].row+1===c[this.G.selected_form_type].rows.length-1?h+2+c[this.G.selected_form_type].rows[b[0].row].fields.length:h+1+c[this.G.selected_form_type].rows[b[0].row].fields.length);
DA(c[this.G.selected_form_type].rows[b[0].row]);null!=c[this.G.selected_form_type].tabs&&null!=c[this.G.selected_form_type].tabs.list&&null!=c[this.G.selected_form_type].tabs.list[0]&&q(c[this.G.selected_form_type].tabs.list[0].elements)&&c[this.G.selected_form_type].tabs.list[0].elements.push(g);Z.ic(c);this.G.$broadcast("updateEvent",Z.ea());$("#TreeView_Button_Group").confirmation("destroy");$("#treeWithLines").treeview("selectNode",[h,{me:!1}])}else $.notify(this.text.Notify.Forgotten,{className:"error",
autoHideDelay:Z.Gb})};CA.prototype.Ra.prototype.addElement=CA.prototype.Ra.prototype.addElement;
CA.prototype.Ra.prototype.BM=function(){Z.wc=!0;Z.log("nsVFB.FormTools.prototype.formToolsController.prototype.removeElement");var a=$("#treeWithLines").treeview("getSelected"),b=Z.ea(),c=this;if(0===a.length)return $.notify(this.text.Notify.Forgotten,{className:"error",autoHideDelay:Z.Gb}),0;if(n(a[0].nodes)){if(1<a[0].nodes.length)return $.notify(this.text.Notify.Multiple_elements,{className:"error",autoHideDelay:Z.Gb}),0;a=a[0].nodes}1===a.length?bootbox.confirm("<h4>"+this.text.Confirmation.Remove+
"</h4>",function(d){if(!0===d){d=b[c.G.selected_form_type].rows[a[0].row];var e=d.fields[a[0].field].name;if(null!=e&&null!=b[c.G.selected_form_type].tabs){var f=b[c.G.selected_form_type].tabs.list;if(q(f))for(var g=0;g<f.length;g++)q(f[g].elements)&&-1!==f[g].elements.indexOf(e)&&f[g].elements.splice(f[g].elements.indexOf(e),1)}if(null!=e&&(f=b[c.G.selected_form_type].wab,null!=f))for(var h in f)for(var k in f[h])null!=f[h][k][e]&&delete f[h][k][e];d.fields.splice(a[0].field,1);0===b[c.G.selected_form_type].rows[a[0].row].fields.length&&
b[c.G.selected_form_type].rows.splice(a[0].row,1);DA(d);$(".selected-in-tree").each(function(a,b){$(b).removeClass("selected-in-tree")});Z.hf();Z.ic(b);c.G.$broadcast("updateEvent",Z.ea());c.b.$apply();$("#Formtools_buttons").confirmation("destroy");$.notify(c.text.Notify.Remove,{className:"success",autoHideDelay:Z.Gb})}}):$.notify(this.text.Notify.Forgotten,{className:"error",autoHideDelay:Z.Gb})};CA.prototype.Ra.prototype.removeElement=CA.prototype.Ra.prototype.BM;
CA.prototype.Ra.prototype.km=function(){Z.wc=!0;Z.log("nsVFB.FormTools.prototype.formToolsController.prototype.up");var a=$("#treeWithLines").treeview("getSelected"),b=a[0].nodeId,c=Z.ea();if(1===a.length)if(n(a[0].field))if(0<=a[0].field-1)e=c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field-1],c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field-1]=c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field],c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field]=e,
b--;else{var d=c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field];if(0===a[0].row)this.Wi(),c[this.G.selected_form_type].rows[a[0].row+1].fields.push(d),c[this.G.selected_form_type].rows[a[0].row].fields.splice(a[0].field,1),d=c[this.G.selected_form_type].rows[a[0].row],c[this.G.selected_form_type].rows[a[0].row]=c[this.G.selected_form_type].rows[a[0].row+1],c[this.G.selected_form_type].rows[a[0].row+1]=d,DA(c[this.G.selected_form_type].rows[a[0].row]),DA(c[this.G.selected_form_type].rows[a[0].row+
1]),b=1,$("#treeWithLines").treeview("expandNode",FA(this,b));else if(this.bTreeWithLines_)c[this.G.selected_form_type].rows[a[0].row-1].fields.push(d),c[this.G.selected_form_type].rows[a[0].row].fields.splice(a[0].field,1),DA(c[this.G.selected_form_type].rows[a[0].row-1]),DA(c[this.G.selected_form_type].rows[a[0].row]),0===c[this.G.selected_form_type].rows[a[0].row].fields.length&&c[this.G.selected_form_type].rows.splice(a[0].row,1),b--,a=GA(b),$("#treeWithLines").treeview("expandNode",a);else{e=
GA(b);if(1===e.nodes.length)return $("#treeWithLines").treeview("selectNode",[e.nodeId,{me:!0}]),this.km(),0;this.Wi();c[this.G.selected_form_type].rows[a[0].row+1].fields.push(d);c[this.G.selected_form_type].rows[a[0].row].fields.splice(a[0].field,1);d=c[this.G.selected_form_type].rows[a[0].row];c[this.G.selected_form_type].rows[a[0].row]=c[this.G.selected_form_type].rows[a[0].row+1];c[this.G.selected_form_type].rows[a[0].row+1]=d;DA(c[this.G.selected_form_type].rows[a[0].row]);DA(c[this.G.selected_form_type].rows[a[0].row+
1])}}else{if(0<=a[0].row-1){var d=a[0].row,a=a[0],e=GA(b),f=$("#treeWithLines").treeview("getCollapsed");a.collapsed=gb(f,a);e.collapsed=gb(f,e);!0===e.collapsed?$("#treeWithLines").treeview("collapseNode",a.nodeId):$("#treeWithLines").treeview("expandNode",a.nodeId);!0===a.collapsed?$("#treeWithLines").treeview("collapseNode",e.nodeId):$("#treeWithLines").treeview("expandNode",e.nodeId);var e;a.collapsed=e.collapsed;e.collapsed=a.collapsed;e=c[this.G.selected_form_type].rows[d-1];c[this.G.selected_form_type].rows[d-
1]=c[this.G.selected_form_type].rows[d];c[this.G.selected_form_type].rows[d]=e}a=GA(b);b=a.nodeId;this.bTreeWithLines_||(b=a.nodes[0].nodeId)}else $.notify(this.text.Notify.Forgotten,{className:"error",autoHideDelay:Z.Gb});for(a=0;a<c[this.G.selected_form_type].rows.length;a++)0===c[this.G.selected_form_type].rows[a].fields.length&&c[this.G.selected_form_type].rows.splice(a,1);Z.ic(c);this.G.$broadcast("updateEvent",Z.ea());$("#treeWithLines").treeview("selectNode",[b,{me:!1}])};
CA.prototype.Ra.prototype.up=CA.prototype.Ra.prototype.km;
CA.prototype.Ra.prototype.Jk=function(){Z.wc=!0;Z.log("nsVFB.FormTools.prototype.formToolsController.prototype.down");var a=$("#treeWithLines").treeview("getSelected"),b=a[0].nodeId,c=Z.ea();if(1===a.length)if(n(a[0].field))if(a[0].field+1<c[this.G.selected_form_type].rows[a[0].row].fields.length)d=c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field+1],c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field+1]=c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field],c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field]=
d,b++;else{d=c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field];if(!this.bTreeWithLines_){if(1===$("#treeWithLines").treeview("getNode",a[0].parentId).nodes.length)return $("#treeWithLines").treeview("selectNode",[a[0].parentId,{me:!1}]),this.Jk(),0;n($("#treeWithLines").treeview("getNode",a[0].nodeId+1).nodes)&&this.Wi()}n(c[this.G.selected_form_type].rows[a[0].row+1])||this.Wi();c[this.G.selected_form_type].rows[a[0].row+1].fields.unshift(d);c[this.G.selected_form_type].rows[a[0].row].fields.splice(a[0].field,
1);DA(c[this.G.selected_form_type].rows[a[0].row+1]);DA(c[this.G.selected_form_type].rows[a[0].row]);$("#treeWithLines").treeview("expandNode",FA(this,b));0===c[this.G.selected_form_type].rows[a[0].row].fields.length?c[this.G.selected_form_type].rows.splice(a[0].row,1):b++}else{if(a[0].row+1<c[this.G.selected_form_type].rows.length){var d=a[0],e=FA(this,b),f=$("#treeWithLines").treeview("getCollapsed");d.collapsed=gb(f,d);e.collapsed=gb(f,e);!0===e.collapsed?$("#treeWithLines").treeview("collapseNode",
d.nodeId):$("#treeWithLines").treeview("expandNode",d.nodeId);!0===d.collapsed?$("#treeWithLines").treeview("collapseNode",e.nodeId):$("#treeWithLines").treeview("expandNode",e.nodeId);var d;d.collapsed=e.collapsed;e.collapsed=d.collapsed;d=c[this.G.selected_form_type].rows[a[0].row+1];c[this.G.selected_form_type].rows[a[0].row+1]=c[this.G.selected_form_type].rows[a[0].row];c[this.G.selected_form_type].rows[a[0].row]=d}else return this.bTreeWithLines_||$("#treeWithLines").treeview("selectNode",[b+
1,{me:!1}]),0;Z.ic(c);this.G.$broadcast("updateEvent",Z.ea());b=FA(this,b).nodeId;this.bTreeWithLines_||b++}else $.notify(this.text.Notify.Forgotten,{className:"error",autoHideDelay:Z.Gb});Z.ic(c);this.G.$broadcast("updateEvent",Z.ea());$("#treeWithLines").treeview("selectNode",[b,{me:!1}])};CA.prototype.Ra.prototype.down=CA.prototype.Ra.prototype.Jk;
function EA(a){Z.log("nsVFB.FormTools.prototype.formToolsController.prototype.getLastLine");for(var b=HA(a);0<=b;b--)if(a=$("#treeWithLines").treeview("getNode",b),!n(a.field))return a;return $("#treeWithLines").treeview("getNode",0)}
function FA(a,b){Z.log("nsVFB.FormTools.prototype.formToolsController.prototype.getNextLineAfterIndex");a=HA(a);n($("#treeWithLines").treeview("getNode",b).field)||b++;for(var c=b;c<a;c++)if(b=$("#treeWithLines").treeview("getNode",c),!n(b.field))return b;return $("#treeWithLines").treeview("getNode",0)}
function GA(a){Z.log("nsVFB.FormTools.prototype.formToolsController.prototype.getPreviousLineBeforeIndex");n($("#treeWithLines").treeview("getNode",a).field)||a--;for(var b=a-1;0<=b;b--)if(a=$("#treeWithLines").treeview("getNode",b),!n(a.field))return a;return $("#treeWithLines").treeview("getNode",0)}
function HA(a){Z.log("nsVFB.FormTools.prototype.formToolsController.prototype.getLastNodeIndex");for(var b=Z.ea(),c=0,d=0;d<b[a.G.selected_form_type].rows.length;d++){c++;for(var e=0;e<b[a.G.selected_form_type].rows[d].fields.length;e++)c++}return c-1}function DA(a){Z.log("nsVFB.FormTools.prototype.formToolsController.prototype.resizeElementsOnRow");for(var b=parseInt(12/a.fields.length),c=0;c<a.fields.length;c++)a.fields[c].nb_cols=b}
CA.prototype.Ra.prototype.uw=function(a){angular.element($("#FormModal")).scope().ctrl.nD(a,this.b.selected_form_type)};CA.prototype.Ra.prototype.setSelectedElemInFormReader=CA.prototype.Ra.prototype.uw;CA.prototype.Ra.prototype.eo=function(a){angular.element($("#FormModal")).scope().ctrl.jD(a,this.b.selected_form_type)};CA.prototype.Ra.prototype.setHoveredElemInFormReader=CA.prototype.Ra.prototype.eo;
CA.prototype.Ra.prototype.mG=function(){var a=Z.ea(),b=document.createElement("textarea");b.style.position="fixed";b.style.top=0;b.style.left=0;b.style.width="2em";b.style.height="2em";b.style.padding=0;b.style.border="none";b.style.outline="none";b.style.boxShadow="none";b.style.background="transparent";b.value=JSON.stringify(a);document.body.appendChild(b);b.focus();b.select();try{var c=document.execCommand("copy")?"successful":"unsuccessful";console.log("Copying text command was "+c)}catch(d){console.log("error during copy"+
d)}document.body.removeChild(b)};CA.prototype.Ra.prototype.copyToClipboard=CA.prototype.Ra.prototype.mG;CA.prototype.Ra.prototype.copy=function(){var a=Z.ea();Z.wc=!0;this.b.copyPasteContainer=angular.copy(a[this.G.selected_form_type])};CA.prototype.Ra.prototype.copy=CA.prototype.Ra.prototype.copy;CA.prototype.Ra.prototype.QL=function(){var a=Z.ea();Z.wc=!0;a[this.G.selected_form_type]=angular.copy(this.b.copyPasteContainer);Z.ic(a);this.G.$broadcast("updateEvent",Z.ea())};
CA.prototype.Ra.prototype.paste=CA.prototype.Ra.prototype.QL;CA.prototype.Ra.prototype.TJ=function(){Z.wc=!0;this.G.$broadcast("labelizeForm",null)};CA.prototype.Ra.prototype.labelizeForm=CA.prototype.Ra.prototype.TJ;
CA.prototype.Ra.prototype.FL=function(){var a=this.b,b=this;A({method:"POST",url:Z.da.web_server_name+"/"+Z.da.services_alias+"/wab/methods",headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},scope:a,data:{sort_order:"ASC",distinct:!0,filter:{relation:"AND",operators:[{column:"module_id",compare_operator:"=",value:a.module},{column:"bo_name",compare_operator:"=",value:a.object}]}},success:function(a){console.log(a);b.G.aBoMethods=a.data.data;for(a=0;a<b.G.aBoMethods.length;a++){b.G.aBoMethods[a].group=
b.G.aBoMethods[a].name+"_"+a;var c="",e=0,f=1;0===b.G.aBoMethods[a].name.indexOf("tr")&&(e=2,f=3);for(;f<b.G.aBoMethods[a].name.length;f++)b.G.aBoMethods[a].name[f]===b.G.aBoMethods[a].name[f].toUpperCase()&&b.G.aBoMethods[a].name[f-1]===b.G.aBoMethods[a].name[f-1].toLowerCase()&&(c+=b.G.aBoMethods[a].name.substring(e,f)+" ",e=f);c+=b.G.aBoMethods[a].name.substring(e);b.G.aBoMethods[a].label=c}$("#studio-wabmanager-method-modal").modal("show")}})};
CA.prototype.Ra.prototype.openModalMethodcreator=CA.prototype.Ra.prototype.FL;CA.prototype.Ra.prototype.GJ=function(){Z.wc=!0;var a=Z.ea(),b,c;for(c in a)if(b=a[c],null!=b.rows)for(var d=0;d<b.rows.length;d++)if(null!=b.rows[d].fields)for(var e=0;e<b.rows[d].fields.length;e++)b.rows[d].fields[e].id=b.rows[d].fields[e].name;Z.ic(a);this.G.$broadcast("updateEvent",Z.ea())};CA.prototype.Ra.prototype.idName=CA.prototype.Ra.prototype.GJ;function IA(){Z.log("nsVFB.nsVisualizerMode.FormMode");Z.module.directive("appVisualizermodeForm",this.wE);Z.module.directive("appSpecificParam",["$timeout","$rootScope","$q",this.FQ]);Z.module.controller("AppVisualizermodeFormController",["$scope",this.Nc])}qa("nsVFB.nsVisualizerMode.FormMode",IA);
IA.prototype.wE=function(){Z.log("nsVFB.VisualizerMode.FormMode.visualizerFormModeDirective");return{restrict:"A",replace:!0,controller:"AppVisualizermodeFormController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/VisualizerMode/FormMode.html"}};IA.prototype.visualizerFormModeDirective=IA.prototype.wE;
IA.prototype.Nc=function(a){Z.log("nsVFB.VisualizerMode.FormMode.visualizerFormModeController");this.b=a;a.sFormDefinitionName="";a.oFormValues={};a.oFormDefinition={};a.oFormScope={};a.oProperties=Z.da;a.sToken=sessionStorage.session_token;a.$on("updateEvent",function(b,c){Z.log("visualizerFormModeController updateEvent");a.$broadcast("updateForm",c)});a.$on("updateForm",function(b,c){Z.log("visualizerFormModeController updateForm");if(hb(c[a.selected_form_type]))Z.log("visualizerFormModeController. Load JSON form fail: "+
a.selected_form_type+" undefined in ",c);else{b=c[a.selected_form_type];if(!hb(b.rows))for(var d=0;d<b.rows.length;d++)for(var e=0;e<b.rows[d].fields.length;e++)b.rows[d].fields[e].id||(b.rows[d].fields[e].id=b.rows[d].fields[e].name+"_"+(d+1)+"_"+(e+1));a.oFormDefinition=c;a.sFormDefinitionName=a.selected_form_type;a.title=b.title;n(a.oFormValues)||(a.oFormValues={});n(a.oFormValues[a.sFormDefinitionName])||(a.oFormValues[a.sFormDefinitionName]={});angular.element($("#studio_form_reader").children()).scope().ctrl.ti()}});
a.$on("updateDefautValue",function(a,c){if("undefined"!=typeof c.default_value&&""!=c.default_value)switch(c.type){case "select":isNaN(c.default_value)||(c.default_value=Number(c.default_value));break;case "list":angular.element(v.X).injector().get(["$timeout"])(function(){var a=[],b=document.getElementById(c.id);if(null!==b){-1==String(c.default_value).indexOf("|")?a.push(c.default_value):a=String(c.default_value).split("|");for(var f=0;f<b.options.length;f++)b.options[f].selected=-1!=a.indexOf(b.options[f].value)?
!0:!1}})}angular.element($("#studio_form_reader").children()).scope().ctrl.zs(!0,c.name)})};IA.prototype.visualizerFormModeController=IA.prototype.Nc;
IA.prototype.Nc.prototype.nD=function(a,b){Z.log("nsVFB.nsVisualizerMode.FormMode.visualizerFormModeController.setSelectedElem");var c=this,d=this.b;setTimeout(function(){d.$evalAsync(function(){var e=d.oFormDefinition[b].rows;c.ew(b);"row"===a.type&&(e[a.row_id].selected=!0);if("element"===a.type)for(var f=0;f<e.length;f++)for(var g=0;g<e[f].fields.length;g++)e[f].fields[g].name===a.element_name&&(e[f].fields[g].selected=!0);angular.element($("#studio_form_reader").children()).scope().ctrl.ti()})})};
IA.prototype.Nc.prototype.setSelectedElem=IA.prototype.Nc.prototype.nD;IA.prototype.Nc.prototype.jD=function(a,b){var c=this,d=this.b;d.$evalAsync(function(){var e=d.oFormDefinition[b].rows;c.bw(b);"row"===a.type&&(e[a.row_id].hovered=!0);if("element"===a.type)for(var f=0;f<e.length;f++)for(var g=0;g<e[f].fields.length;g++)e[f].fields[g].name===a.element_name&&(e[f].fields[g].hovered=!0);angular.element($("#studio_form_reader").children()).scope().ctrl.ti()})};
IA.prototype.Nc.prototype.setHoveredElem=IA.prototype.Nc.prototype.jD;IA.prototype.Nc.prototype.ew=function(a){Z.log("nsVFB.nsVisualizerMode.FormMode.visualizerFormModeController.removeSelectedElem");var b=this.b;if(null==a){for(var c in b.oFormDefinition)this.ew(c);return 0}a=b.oFormDefinition[a].rows;if(null==a)return 0;for(b=0;b<a.length;b++)for(!0===a[b].selected&&delete a[b].selected,c=0;c<a[b].fields.length;c++)!0===a[b].fields[c].selected&&delete a[b].fields[c].selected};
IA.prototype.Nc.prototype.removeSelectedElem=IA.prototype.Nc.prototype.ew;IA.prototype.Nc.prototype.bw=function(a){var b=this.b;if(!n(a)){for(var c in b.oFormDefinition)this.bw(c);return 0}a=b.oFormDefinition[a].rows;if(!hb(a))for(b=0;b<a.length;b++)for(!0===a[b].hovered&&delete a[b].hovered,c=0;c<a[b].fields.length;c++)!0===a[b].fields[c].hovered&&delete a[b].fields[c].hovered};IA.prototype.Nc.prototype.removeHoveredElem=IA.prototype.Nc.prototype.bw;
IA.prototype.Nc.prototype.dw=function(a){var b=this.b;if(null==a){for(var c in b.oFormDefinition)this.dw(c);return 0}a=b.oFormDefinition[a].rows;if(null==a)return 0;for(b=0;b<a.length;b++)for(!0===a[b].selected&&delete a[b].selected,!0===a[b].hovered&&delete a[b].hovered,c=0;c<a[b].fields.length;c++)!0===a[b].fields[c].selected&&delete a[b].fields[c].selected,!0===a[b].fields[c].hovered&&delete a[b].fields[c].hovered};IA.prototype.Nc.prototype.removeSelectedAndHoveredElem=IA.prototype.Nc.prototype.dw;
IA.prototype.Nc.prototype.Ip=function(){Z.log("nsVFB.nsVisualizerMode.FormMode.visualizerFormModeController.emptyFormValues");var a=this.b;n(a.oFormValues)&&(a.oFormValues={})};IA.prototype.Nc.prototype.emptyFormValues=IA.prototype.Nc.prototype.Ip;function JA(){Z.log("nsVFB.nsVisualizerMode.JsonMode");Z.module.directive("appVisualizermodeJson",this.xE);Z.module.controller("AppVisualizermodeJsonController",["$scope","$timeout","$rootScope",this.Ho])}qa("nsVFB.nsVisualizerMode.JsonMode",JA);JA.prototype.xE=function(){Z.log("nsVFB.VisualizerMode.JsonMode.visualizerJsonModeDirective");return{restrict:"A",replace:!0,controller:"AppVisualizermodeJsonController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/VisualizerMode/JsonMode.html"}};
JA.prototype.visualizerJsonModeDirective=JA.prototype.xE;
JA.prototype.Ho=function(a,b,c){Z.log("nsVFB.VisualizerMode.JsonMode.visualizerJsonModeController");this.If=a;this.RM=c;this.Sw=b;a.QB=Date.now();a.WA=1E3;a.JsonModel=Z.kk(Z.ea());a.error_Json=!1;a.editorOptions={mode:{name:"javascript",json:!0},readOnly:!0,styleActiveLine:!0,lineNumbers:!0,lineSeparator:null,indentWithTabs:!0,tabSize:2,viewportMargin:50,theme:"Veremes",foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],autoCloseBrackets:!0,onLoad:function(c){a.$on("updateEvent",
function(){c.setOption("readOnly",$("#Lock_Icon").hasClass("fa-lock"));a.JsonModel=Z.kk(Z.ea())});a.$watch("JsonModel",function(b){Z.log("jsonmode model");var c=!1;try{JSON.parse(b)}catch(g){c=!0}finally{a.$parent.error_Json=c}});a.$on("updateJsonModel",function(){a.$parent.ctrl.json_&&(a.QB=Date.now(),b(function(){Date.now()-a.QB>=a.WA&&(a.JsonModel=Z.kk(Z.ea()))},a.WA))})}}};JA.prototype.visualizerJsonModeController=JA.prototype.Ho;
JA.prototype.Ho.prototype.WM=function(){Z.ic(JSON.parse(this.If.JsonModel));var a=$("#treeWithLines").treeview("getSelected"),b=$("#treeView").treeview("getSelected");this.RM.$broadcast("updateEvent",Z.ea());0!==a.length&&0!==b.length&&this.Sw(function(){$("#treeWithLines").treeview("selectNode",[a[0].nodeId,{me:!1}]);$("#treeView").treeview("selectNode",[b[0].nodeId,{me:!1}])},1)};JA.prototype.Ho.prototype.saveData=JA.prototype.Ho.prototype.WM;function KA(){Z.log("nsVFB.nsVisualizerMode.JsMode");Z.module.directive("appEditorJs",this.Dz);Z.module.controller("AppEditorJsController",["$scope",this.Cz])}qa("nsVFB.nsVisualizerMode.JsMode",KA);KA.prototype.Dz=function(){Z.log("nsVFB.VisualizerMode.JsMode.editorJsModeDirective");return{restrict:"A",replace:!0,controller:"AppEditorJsController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/VisualizerMode/JsMode.html"}};
KA.prototype.editorJsModeDirective=KA.prototype.Dz;
KA.prototype.Cz=function(a){Z.log("nsVFB.VisualizerMode.JsMode.editorJsModeController");a.JsModel=Z.Ug();a.editorOptions={mode:{name:"javascript",json:!1},readOnly:!1,styleActiveLine:!0,lineNumbers:!0,lineSeparator:null,indentWithTabs:!0,tabSize:2,viewportMargin:50,theme:"Veremes",foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],autoCloseBrackets:!0,extraKeys:{"Ctrl-Space":"autocomplete","Cmd-Space":"autocomplete","Cmd-/":"toggleComment","Ctrl-/":"toggleComment"},onLoad:function(){a.$watch("JsModel",
function(a){Z.log("jsmode model");Z.Pl(a)});a.$on("updateJS",function(){Z.log("Js");a.JsModel=Z.Ug()})}}};KA.prototype.editorJsModeController=KA.prototype.Cz;function LA(){Z.log("nsVFB.nsVisualizerMode.CssMode");Z.module.directive("appEditorCss",this.Bz);Z.module.controller("AppEditorCssController",["$scope",this.Az])}qa("nsVFB.nsVisualizerMode.CssMode",LA);LA.prototype.Bz=function(){Z.log("nsVFB.VisualizerMode.CssMode.editorCssModeDirective");return{restrict:"A",replace:!0,controller:"AppEditorCssController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/VisualizerMode/CssMode.html"}};
LA.prototype.editorCssModeDirective=LA.prototype.Bz;LA.prototype.Az=function(a){Z.log("nsVFB.VisualizerMode.CssMode.editorCssModeController");a.CssModel=Z.nj();a.editorOptions={mode:"css",readOnly:!1,styleActiveLine:!0,lineNumbers:!0,lineSeparator:"\r\n",indentWithTabs:!0,tabSize:2,viewportMargin:50,theme:"Veremes"};Z.resize();a.$watch("CssModel",function(a){Z.log("cssmode model");Z.sw(a)});a.$on("updateCSS",function(){Z.log(Z.nj());a.CssModel=Z.nj()})};LA.prototype.editorCssModeController=LA.prototype.Az;function MA(){Z.log("nsVFB.Visualizer");this.oL=new IA;this.sL=new JA;this.rL=new KA;this.mL=new LA;Z.module.directive("appVisualizer",this.vE);Z.module.controller("AppVisualizerController",["$scope","$timeout",this.Ch])}qa("nsVFB.Visualizer",MA);MA.prototype.vE=function(){Z.log("nsVFB.Visualizer.visualizerDirective");return{restrict:"A",replace:!0,controller:"AppVisualizerController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/Visualizer.html"}};
MA.prototype.visualizerDirective=MA.prototype.vE;
MA.prototype.Ch=function(a){Z.log("nsVFB.Visualizer.visualizerController");var b=this;this.b=a;b.form_=!0;b.css_=b.js_=b.json_=!1;b.JSPresent=!0;b.CSSPresent=!0;a.$watch("text",function(){Z.log("visualizer text");"undefined"!==typeof a.text.Visualizer&&(b.text=a.text.Visualizer,b.ModeSelected=b.text.FormMode)});b.verifyMode=function(){n(angular.element($("#boolean-JS-include"))[0])&&(b.JSPresent=!angular.element($("#boolean-JS-include"))[0].checked);n(angular.element($("#boolean-CSS-include"))[0])&&
(b.CSSPresent=!angular.element($("#boolean-CSS-include"))[0].checked)};b.form=function(){b.ModeSelected=b.text.FormMode;a.$broadcast("updateEvent",{});b.form_=!0;b.css_=b.js_=b.json_=!1};b.json=function(){b.ModeSelected=b.text.JsonMode;a.$broadcast("updateEvent",{});b.json_=!0;b.css_=b.js_=b.form_=!1};b.js=function(){b.ModeSelected=b.text.JsMode;b.js_=!0;b.css_=b.json_=b.form_=!1;a.$broadcast("updateJS",Z.Ug())};b.css=function(){b.ModeSelected=b.text.CssMode;a.$broadcast("updateCSS",Z.nj());b.css_=
!0;b.json_=b.js_=b.form_=!1}};MA.prototype.visualizerController=MA.prototype.Ch;MA.prototype.Ch.$inject=["$scope","$timeout"];
MA.prototype.Ch.prototype.sO=function(){Z.log("nsVFB.Visualizer.visualizerController.toggleFullScreen");if(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled){var a=$("#studio-full-screen-btn").get(0),b=$("#studio_container").get(0);document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?($(a).removeClass("icon-shrink"),document.exitFullscreen?document.exitFullscreen():
document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),setTimeout(function(){Z.resize()},100)):($(a).addClass("icon-shrink"),b.requestFullscreen?b.requestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen?b.webkitRequestFullscreen():b.msRequestFullscreen&&b.msRequestFullscreen(),setTimeout(function(){Z.resize(!0)},500))}else $.notify("Fonction non disponible pour votre navigateur",
"error")};MA.prototype.Ch.prototype.toggleFullScreen=MA.prototype.Ch.prototype.sO;
MA.prototype.Ch.prototype.ZJ=function(){Z.log("nsVFB.visualizerController.loadDefaultJavascript");var a=this.b,b=Z.Ug();n(b)&&""!==b&&bootbox.confirm("<h4>"+this.text.Confirmation.LoseJs+"</h4>",function(b){!0===b&&A({method:"GET",url:Z.da.web_server_name+"/"+Z.da.public_alias+"/studio/default.js",scope:this.b,timeout:5E3,success:function(b){null!=b.data&&(Z.Pl(b.data.replace(/(?:\r\n|\r|\n)/g,"\r\n")),a.$broadcast("updateJS",Z.Ug()))},error:function(){console.error("Problem on Loading default javascript")}})})};
MA.prototype.Ch.prototype.loadDefaultJavascript=MA.prototype.Ch.prototype.ZJ;MA.prototype.MH=function(){return MA.oL};MA.prototype.getFormMode=MA.prototype.MH;MA.prototype.SH=function(){return MA.sL};MA.prototype.getJsonMode=MA.prototype.SH;MA.prototype.RH=function(){return MA.rL};MA.prototype.getJsMode=MA.prototype.RH;MA.prototype.HH=function(){return MA.mL};MA.prototype.getCssMode=MA.prototype.HH;function NA(){Z.log("nsVFB.ElementForm");Z.module.directive("appElementForm",this.Ez);Z.module.directive("appParamElement",["$rootScope",this.Fz]);Z.module.directive("appParamMap",this.wB);Z.module.directive("appHelperIcon",this.BJ);Z.module.controller("AppElementFormController",["$scope","$rootScope","$timeout","$q",this.fu])}qa("nsVFB.ElementForm",NA);
NA.prototype.Ez=function(){Z.log("nsVFB.ElementForm.elementFormDirective");return{restrict:"A",replace:!0,controller:"AppElementFormController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/ElementForm.html"}};NA.prototype.elementFormDirective=NA.prototype.Ez;
NA.prototype.Fz=function(){Z.log("nsVFB.ElementForm.elementParamDirective");return{link:function(a,b){"map_vmap"===a.model.type&&($("#Vmap_Downloader_input").fileinput({mainClass:"input-group-sm"}),$("#Vmap_Downloader_input").on("change",function(b){if(b=b.target.files[0]){var c=new FileReader;c.onload=function(b){a.ctrl.UO(JSON.parse(b.target.result))};c.readAsText(b)}}),!0===a.locker&&$("#Vmap_Downloader_input").fileinput("disable"));switch(a.model.type){case "upload":case "text":case "label":case "email":case "double_select":case "select":case "list":case "date":case "datetime":case "password":case "url":case "color_picker":case "label_display":case "map":case "map_osm":case "map_bing":case "map_vmap":case "textarea":case "button":case "image":case "imageurl":case "image_wsdata":case "link":case "linkurl":case "file_wsdata":case "bo_grid":case "section_grid":case "codemirror":case "checkbox":case "radio":case "float":case "slider":"slider_Element_size"===
$(b).attr("id")?($(b).slider({formatter:function(a){return Math.round(100*a/12)+"%"},value:a.model.nb_cols}),$(b).slider("on","change",function(){a.model.nb_cols=$(b).slider("getValue");a.$apply()}),a.$watch("model.nb_cols",function(a){$(b).slider("setValue",a)})):"slider_Element_height"===$(b).attr("id")?(null!=a.model.style||(a.model.style={}),null!=a.model.style.height||(a.model.style.height=0),$(b).slider({formatter:function(a){return a+"px"},value:parseFloat(a.model.style.height)}),$(b).slider("on",
"change",function(){a.model.style.height=$(b).slider("getValue")+"px";a.$apply()}),a.$watch("model.style.height",function(a){$(b).slider("setValue",parseFloat(a))})):"slider_Element_width"===$(b).attr("id")?(null!=a.model.style||(a.model.style={}),null!=a.model.style.width||(a.model.style.width=0),$(b).slider({formatter:function(a){return a+"px"},value:parseFloat(a.model.width)}),$(b).slider("on","change",function(){a.model.width=$(b).slider("getValue")+"px";a.$apply()}),a.$watch("model.width",function(a){$(b).slider("setValue",
parseFloat(a))})):"slider_Tab_size"===$(b).attr("id")&&(null!=a.model.cm_options||(a.model.cm_options={}),null!=a.model.cm_options.tabSize||(a.model.cm_options.tabSize=2),$(b).slider({formatter:function(a){return a},value:parseFloat(a.model.cm_options.tabSize)}),$(b).slider("on","change",function(){a.model.cm_options.tabSize=$(b).slider("getValue");a.$apply()}),a.$watch("model.cm_options.tabSize",function(a){$(b).slider("setValue",parseFloat(a))})),!0===a.locker?$(b).slider("disable"):$(b).slider("enable")}if("list"===
a.model.type||"double_select"===a.model.type||"textarea"===a.model.type)$("#slider_Element_Row").slider({formatter:function(a){return a},min:3,max:20,step:1,value:5}),$("#slider_Element_Row").slider("on","change",function(){a.model.size=$("#slider_Element_Row").slider("getValue");a.$apply()}),a.$watch("model.size",function(a){$("#slider_Element_Row").slider("setValue",a)}),!0===a.locker&&$("#slider_Element_Row").slider("disable"),"double_select"===a.model.type&&a.$watch("model.name",function(b){a.model.name_to=
b;a.model.name_from=b+"_from"})}}};NA.prototype.elementParamDirective=NA.prototype.Fz;NA.prototype.BJ=function(){return{link:function(a,b,c){var d=c.$observe("appHelperIcon",function(){n(c.text)&&""!==c.text&&($(b).popover({trigger:"hover",container:"body",title:"HelperBox",content:function(){return c.text}}),a.$on("$destroy",function(){$(b).popover("destroy");d()}))})}}};NA.prototype.wB=function(){Z.log("nsVFB.ElementForm.mapParamDirective")};NA.prototype.mapParamDirective=NA.prototype.wB;
NA.prototype.fu=function(a,b,c,d){Z.log("nsVFB.ElementForm.elementFormController");var e=this;this.applicationName=Z.Tg();b.Utils={keys:Object.keys};a.model={};a.collapsed=Z.Eh[4];a.aWebServiceAttributs=[];a.aBusinessObjects=[];a.aBoAttributs=[];a.aFormAttributs=[];a.datasourcesArray=[];a.IQ={};var f={},g={};a.$on("labelizeForm",function(){console.log(e);for(var a=Z.ea(),c=a[b.selected_form_type],d="select list double_select date datetime color_picker text password url email integer float number".split(" "),
f=["map_osm","map_bing","map_vmap"],g=["checkbox","radio","textarea","slider"],u=0;u<c.rows.length;u++)for(var w=c.rows[u],x=0;x<w.fields.length;x++){var z=w.fields[x];-1<d.indexOf(z.type)?(e.vp(z,"label"),z.type="label"):-1<f.indexOf(z.type)?(z.map_options.interactions={multi_geometry:!1,full_screen:!0,RA:!1,RO:!1,ED:!1,DP:!1,DL:!1,DPol:!1,SE:!1},b.$broadcast("updateMap","interact")):-1<g.indexOf(z.type)?z.disabled=!0:"upload"===z.type?(e.vp(z,"link"),z.type="link"):"codemirror"===z.type&&(z.cm_options.readOnly=
!0)}a[b.selected_form_type]=c;Z.ic(a);b.$broadcast("updateEvent",Z.ea());b.$broadcast("updateJsonModel",Z.ea());b.$broadcast("updateForm",Z.ea())});a.$watch("text",function(){Z.log("text updated");if("undefined"!==typeof a.text.Element){e.text=a.text.Element;a.Component_list=[];for(var b=Z.config.avaliable_elems,c=0;c<b.length;c++)a.Component_list.push({alias:e.text.Select_Type[b[c]],value:b[c]})}});a.$watch("model.id",function(){Z.log("model.id changed");a.jsonOutput=Z.ea();n(a.jsonOutput.datasources)&&
ha(a.jsonOutput.datasources)&&!q(a.jsonOutput.datasources)||(a.jsonOutput.datasources={});a.datasources=a.jsonOutput.datasources;a.datasourcesArray=[];for(var b in a.datasources)a.datasources[b].id=b,a.datasourcesArray.push(a.datasources[b]);e.updateDatasourceInfos();if("select"===a.model.type||"list"===a.model.type||"double_select"===a.model.type)if(null!=a.model.datasource&&null!=a.model.datasource.parents)for(a.cascade=!0,a.aParents=[],b=0;b<a.model.datasource.parents.length;b++)a.aParents.push(a.model.datasource.parents[b].name);
else a.cascade=!1,a.aParents=[];Z.ic(a.jsonOutput)});a.$watch("model.datasource.datasource_id",function(){Z.log("model.datasource.datasource_id changed");if(null==a.model.datasource||null==a.model.datasource.datasource_id||null==a.datasources[a.model.datasource.datasource_id])return 0;"web_service"===a.datasources[a.model.datasource.datasource_id].type&&Pa(a.aWebServiceAttributs);e.updateDatasourceInfos()});a.$watch("model.default_value",function(){b.$broadcast("updateDefautValue",a.model)});a.$watch("model.name",
function(c,d){a.jsonOutput=Z.ea();1<Z.Bh.getElementsByName(a.jsonOutput,b.selected_form_type,c).length&&(a.model.name+="_2",$.notify(a.text.Element.SameNameWarning,"warning"));r(d)&&0<d.length&&null==a.model.name&&(a.model.name=d,$.notify(a.text.Element.EmptyNameWarning,"warning"))});a.$watch("model",function(d,k){b.$broadcast("update model",null);if(null!=d.type&&null!=d.id)if(d.type!==k.type&&d.id===k.id)Z.wc=!0,0<f.length&&(null!=f[0]&&(f[0].icon=e.vp(a.model,d.type)),null!=g[0]&&(g[0].icon=e.vp(a.model,
d.type))),"select"===d.type&&("Text"===e.optionsSelect?(n(d.web_service)&&jb(d,"web_service"),a.selectedRessource="",a.selectedValue="",a.selectedLabel=""):"TableValues"===e.optionsSelect?(n(d.options)&&jb(d,"options"),a.selectedRessource="",a.selectedValue="",a.selectedLabel=""):"WebService"===e.optionsSelect&&(n(d.options)&&jb(d,"options"),n(d.web_service.parameters)&&jb(d.web_service,"parameters")));else if(d.id===k.id&&d.name!==k.name)Z.wc=!0,n(f[0])&&n(g[0])&&(f[0].text=d.name,g[0].text=d.name),
Z.PO(d,k),Z.QO(d,k);else if(d.id===k.id){if("ui_grid"==d.type){k=angular.element("#"+a.model.id+"_grid .ui-grid-contents-wrapper").scope().grid.options;if(!0!==a.bListenUiGridEvent){k.columnDefs=a.model.options.columnDefs;k.appActions=a.model.options.appActions;a.bListenUiGridEvent=!0;k=angular.element("#"+a.model.id+"_grid .ui-grid-contents-wrapper").scope().grid.api;k.colMovable.on.columnPositionChanged(a,function(){for(var b=angular.element("#"+a.model.id+"_grid .ui-grid-header-cell-row").scope().iQ.Kh,
c=[],d=0;d<b.length;d++)"selectionRowHeaderCol"!=b[d].field&&c.push(b[d].colDef);a.model.options.columnDefs.length=0;a.model.options.columnDefs=angular.copy(c);c.length=0});var h=angular.element(v.X).injector().get(["uiGridConstants"]);k.core.on.sortChanged(a,function(b,c){b=c[0].sort.direction.toUpperCase();for(var d=0;d<a.model.options.columnDefs.length;d++)delete a.model.options.columnDefs[d].sort,a.model.options.columnDefs[d].field==c[0].field&&(a.model.options.columnDefs[d].sort={direction:h[b],
ignoreSort:!0,priority:0});"undefined"!=typeof a.model.datasource&&(a.model.datasource.order_by=c[0].field,a.model.datasource.sort_order=b)})}document.querySelector("#studio_form_reader .ui-grid-form-field-header-title > span").textContent=d.options.appGridTitle;document.getElementById(a.model.id+"_grid_header").style.display=a.model.options.appHeader?"":"none";document.getElementById(a.model.id+"_label").style.display=""==a.model.label?"none":"";if(!0===a.bEditColumn){a.bShowColumnParameters=!0;
for(d=0;d<a.model.options.columnDefs.length;d++)if(a.model.options.columnDefs[d].field==a.sSelectedColumn){a.columnDef=angular.copy(a.model.options.columnDefs[d]);break}a.bEditColumn=!1}else!0===a.bAddColumn&&(a.columnDef={displayName:"",field:"",width:""},a.bAddColumn=!1);if(!0===a.bSaveColumn&&(a.bSaveColumn=!1,d=Object.assign({name:a.columnDef.field,type:"string",enableSorting:!0,enableColumnMoving:!0,enableColumnResizing:!0},a.columnDef),isNaN(d.width)||(d.width=parseInt(d.width)),""!=d.displayName&&
""!=d.field&&""!=d.width))if("undefined"==typeof a.sSelectedColumn||""==a.sSelectedColumn)a.model.options.columnDefs.push(angular.copy(d)),a.sSelectedColumn=d.field;else for(d=0;d<a.model.options.columnDefs.length;d++)if(a.model.options.columnDefs[d].field==a.sSelectedColumn){a.model.options.columnDefs[d]=angular.copy(a.columnDef);break}if(!0===a.bDeleteColumn)for(a.bDeleteColumn=!1,d=0;d<a.model.options.columnDefs.length;d++)if(a.model.options.columnDefs[d].field==a.sSelectedColumn){a.model.options.columnDefs.splice(d,
1);a.sSelectedColumn="";break}if(!0===a.bEditButton){a.bShowButtonParameters=!0;for(d=0;d<a.model.options.appActions.length;d++)if(a.model.options.appActions[d].name==a.sSelectedButton){a.appAction=angular.copy(a.model.options.appActions[d]);break}a.bEditButton=!1}else!0===a.bAddButton&&(a.appAction={name:"",label:"",event:""},a.bAddButton=!1);if(!0===a.bSaveButton&&(a.bSaveButton=!1,""!=a.appAction.label&&""!=a.appAction.name))if("undefined"==typeof a.sSelectedButton||""==a.sSelectedButton)a.model.options.appActions.push(angular.copy(a.appAction)),
a.sSelectedButton=a.appAction.name;else for(d=0;d<a.model.options.appActions.length;d++)if(a.model.options.appActions[d].name==a.sSelectedButton){a.model.options.appActions[d]=angular.copy(a.appAction);break}if(!0===a.bDeleteButton)for(a.bDeleteButton=!1,d=0;d<a.model.options.appActions.length;d++)if(a.model.options.appActions[d].name==a.sSelectedButton){a.model.options.appActions.splice(d,1);a.sSelectedButton="";break}}else if("treeview"==d.type){var p=this;d={showBorder:!1,levels:0,showCheckbox:!0,
expandIcon:"glyphicon glyphicon-folder-close",collapseIcon:"glyphicon glyphicon-folder-open",highlightSelected:!1,multiSelect:!0};"undefined"==typeof this.getTreeviewData&&(this.getTreeviewData=function(a){var b=[];if(null!==document.getElementById(a)){a=$("#"+a).treeview(!0);a=a.getEnabled().concat(a.getDisabled());for(var c,d=0;d<a.length;d++)void 0===a[d].parentId&&(c=angular.copy(a[d]),b.push(c))}return b},this.cleanNode=function(a){for(var b=0;b<a.length;b++)delete a[b].parentId,delete a[b].nodeId,
"undefined"!=typeof a[b].nodes&&(0<a[b].nodes.length?a[b].nodes=p.cleanNode(a[b].nodes):delete a[b].nodes);return a},this.addTreeviewData=function(a,b,c){for(var d=0;d<a.length;d++)a[d].nodeId==c?(q(a[d].nodes)||(a[d].nodes=[]),a[d].nodes.push(b)):q(a[d].nodes)&&p.addTreeviewData(a[d].nodes,b,c);return a},this.deleteNode=function(a,b){for(var c=0;c<a.length;c++)a[c].nodeId==b?a.splice(c,1):q(a[c].nodes)&&p.deleteNode(a[c].nodes,b);return a});var t=$("#"+a.model.id+"_treeview").treeview(!0);!0!==a.bListenTreeviewEvent&&
($("#"+a.model.id+"_treeview").on("nodeSelected",function(b,c){a.node={text:c.text,value:c.value,selectable:c.selectable,state:angular.copy(c.state)};a.iSelectedNode=c.nodeId;void 0!=c.parentId?(b=t.getNode(c.parentId),a.sSelectedNodeParent=b.text):a.sSelectedNodeParent="";a.bShowNodeParameters=!0;a.bEditNode=!0;a.$applyAsync()}),a.bListenTreeviewEvent=!0);!0!==a.bAddNode||!0===a.bSaveNode&&"undefined"!=typeof a.bSaveNode||(a.node={text:"",value:"",selectable:!0,state:{checked:!1,disabled:!1,expanded:!0,
selected:!1}},"undefined"!=typeof a.iSelectedNode&&""!=String(a.iSelectedNode)&&(k=t.getNode(a.iSelectedNode),a.sSelectedNodeParent=k.text),a.$applyAsync());!0===a.bSaveNode&&(a.bSaveNode=!1,""!=a.node.text&&""!=a.node.value&&(!0===a.bAddNode?("undefined"==typeof a.iSelectedNode||""==String(a.iSelectedNode)?(a.model.options.data.push(angular.copy(a.node)),t.init(Object.assign(d,{data:a.model.options.data})),a.bListenTreeviewEvent=!1,a.bShowNodeParameters=!1):(k=this.addTreeviewData(p.getTreeviewData(a.model.id+
"_treeview"),a.node,a.iSelectedNode),a.iSelectedNode="",a.sSelectedNodeParent="",a.bShowNodeParameters=!1,a.model.options.data.length=0,a.model.options.data=angular.copy(p.cleanNode(k)),t.init(Object.assign(d,{data:a.model.options.data})),a.bListenTreeviewEvent=!1),a.bAddNode=!1,a.bShowNodeParameters=!1):!0===a.bEditNode&&(a.bEditNode=!1,k=t.getNode(a.iSelectedNode),k.text=a.node.text,k.value=a.node.value,k=p.getTreeviewData(a.model.id+"_treeview"),a.model.options.data.length=0,a.model.options.data=
angular.copy(p.cleanNode(k)),t.init(Object.assign(d,{data:a.model.options.data})),a.bListenTreeviewEvent=!1)),a.$applyAsync());!0===a.bDeleteNode&&(a.bDeleteNode=!1,a.bEditNode=!1,k=p.deleteNode(p.getTreeviewData(a.model.id+"_treeview"),a.iSelectedNode),a.iSelectedNode="",a.sSelectedNodeParent="",a.bShowNodeParameters=!1,a.model.options.data.length=0,a.model.options.data=angular.copy(p.cleanNode(k)),t.init(Object.assign(d,{data:a.model.options.data})),a.bListenTreeviewEvent=!1,a.$applyAsync())}delete a.model.bCallWatch}a.model.selected=
!0;c(function(){n(f[0])&&n(g[0])&&(null!=f[0]&&$("#treeWithLines").treeview("selectNode",[f[0].nodeId,{me:!1}]),null!=g[0]&&$("#treeView").treeview("selectNode",[g[0].nodeId,{me:!1}]))},10);b.$broadcast("updateJsonModel",Z.ea());b.$broadcast("updateForm",Z.ea())},!0);a.$on("update element",function(c,d){Z.log("update element");a.model=d;f=$("#treeWithLines").treeview("getSelected");g=$("#treeView").treeview("getSelected");n(a.PB)&&$("#select_element_to_add").val(a.PB.type);a.AllSelects=[];if(null!=
Z.ea()[b.selected_form_type]&&!hb(Z.ea()[b.selected_form_type].rows)){c=Z.ea()[b.selected_form_type].rows;for(var e=0;e<c.length;e++)for(var h=0;h<c[e].fields.length;h++)"select"!==c[e].fields[h].type&&"list"!==c[e].fields[h].type||c[e].fields[h].name===a.model.name||a.AllSelects.push(c[e].fields[h].name)}$("#load_Perso_button").hasClass("active")&&Z.valid&&"undefined"!==d.type?a.locker=!1:Z.valid&&(a.locker=!0,"map_vmap"===a.model.type&&$("#Vmap_Downloader_input").$P("disable"));a.$$phase||a.$digest()});
e.MQ=function(b){Z.log("elementFormController.updateWSInfos");"undefined"!==typeof b.selectedValue&&(a.model.web_service.id_key=b.selectedValue.replace(/\s/g,""));"undefined"!==typeof b.selectedLabel&&(a.model.web_service.label_key=b.selectedLabel.replace(/\s/g,""));a.model.web_service.optionsSelect=e.optionsSelect};e.updateDatasourceInfos=function(){Z.log("elementFormController.updateDatasourceInfos");if(null==a.model.datasource)return 0;a.model.datasource.sort_order=null!=a.model.datasource.sort_order?
a.model.datasource.sort_order:"ASC";a.model.datasource.distinct=null!=a.model.datasource.distinct?a.model.datasource.distinct:"true";null!=a.model.datasource.id_key&&(a.model.datasource.id_key=a.model.datasource.id_key.replace(/\s/g,""));null!=a.model.datasource.label_key&&(a.model.datasource.label_key=a.model.datasource.label_key.replace(/\s/g,""));null!=a.model.datasource.id_key&&null!=a.model.datasource.label_key&&(a.model.datasource.attributs=a.model.datasource.id_key+"|"+a.model.datasource.label_key);
null!=a.model.datasource.label_key&&(a.model.datasource.order_by=a.model.datasource.label_key)};e.updateWebServiceAttributs=function(b){Z.log("updateWebServiceAttributs");var c={limit:1};ha(b.parameters)&&mb(c,b.parameters);console.log(b.parameters);var e=d.defer();A({method:"GET",url:Z.da.web_server_name+"/"+Z.da.services_alias+"/"+b.ressource_id,headers:{Accept:"application/x-vm-json"},params:c,scope:a,timeout:5E3,abord:e.promise,success:function(c){if(null==c||null==c.data||null==c.data.data||
null==c.data.data[0])return 0;var d;if("businessObject"===b.dataType&&null!=b.businessObjectRequest){d=[];for(var e=0;e<c.data.data.length;e++)d.push(c.data.data[e]["bo_"+b.businessObjectRequest])}else d=c.data.data;a.aWebServiceAttributs=Object.keys(d[0])}})};e.updateCascadeField=function(){Z.log("elementFormController.updateCascadeField");if(null==a.aParents)return console.error("aParents not defined"),0;if(null==a.model.datasource)return console.error("datasource not defined"),0;!1===a.cascade&&
(a.aParents=[]);if(q(a.aParents)){if(0===a.aParents.length)return n(a.model.datasource.parents)&&delete a.model.datasource.parents,0;null!=a.model.datasource.parents||(a.model.datasource.parents=[]);q(a.model.datasource.parents)&&Pa(a.model.datasource.parents);for(var b=0;b<a.aParents.length;b++)a.model.datasource.parents.push({name:a.aParents[b],filter_attr:a.aParents[b],filter_equality:"=",wait_for_parent:!0})}};e.UO=function(c){Z.log("elementFormController.updateVmapData");if(c.children){for(var d=
0;d<c.children.length;d++)c.children[d].view&&(a.model.map_options.center.coord=c.children[d].view.center?c.children[d].view.center:[0,0],a.model.map_options.center.zoom=c.children[d].view.zoom?c.children[d].view.zoom:5,a.model.map_options.center.extent=c.children[d].view.extent?c.children[d].view.extent:[-2.002637639E7,-2.00489661E7,2.002637639E7,2.00489661E7],a.model.map_options.proj=c.children[d].view.projection?c.children[d].view.projection:"EPSG:3857",b.$broadcast("updateMap","view"));a.model.map_options.tree=
c;b.$broadcast("updateMap","tree")}};e.LQ=function(){Z.log("elementFormController.updateWS");b.$broadcast("updateOptions",{})};e.updateMap=function(c,d){Z.log("elementFormController.updateMap");switch(d){case "center":c=th(a.model.map_options.center.coord,a.model.map_options.proj,"EPSG:3857");lg([-2.002637639E7,-2.00489661E7,2.002637639E7,2.00489661E7],c)?b.$broadcast("updateMap",d):$.notify(e.text.Component.Map.Notify.OutRange,{className:"error",autoHideDelay:Z.Gb});break;case "zoom":0<a.model.map_options.center.scale&&
2E8>=a.model.map_options.center.scale?b.$broadcast("updateMap",d):$.notify(e.text.Component.Map.Notify.OutRange,{className:"error",autoHideDelay:Z.Gb});break;case "extent":c=a.PB.pQ.Oa.aa;if(c[0]<=c[2]&&-2.002637639E7<=c[0]&&2.002637639E7>=c[0]&&c[0]<=c[2]&&-2.002637639E7<=c[2]&&2.002637639E7>=c[2]&&c[1]<=c[3]&&-2.00489661E7<=c[1]&&2.00489661E7>=c[1]&&c[1]<=c[3]&&-2.00489661E7<=c[3]&&2.00489661E7>=c[3]){b.$broadcast("updateMap",d);break}$.notify(e.text.Component.Map.Notify.OutRange,{className:"error",
autoHideDelay:Z.Gb});break;case "multi_geom":break;default:b.$broadcast("updateMap",d)}};e.vp=function(a,b){Z.log("elementFormController.convert");var c,d="icon-point";if("undefined"!==a.type){switch(b){case "button":c="type id class name nb_cols buttons default_value".split(" ");break;case "title":case "label":c="type id label name default_value nb_cols".split(" ");"label"===b?d="icon-eye":d;break;case "hr":c=["type","id","name","default_value"];"hr"===b?d="icon-minus":d;break;case "hidden":c=["type",
"id","name","default_value","nb_cols"];"hidden"===b?d="icon-user-secret":d;break;case "subtitle":c="type id label name class default_value nb_cols".split(" ");break;case "checkbox":c="type id label name checked default_value nb_cols".split(" ");d="icon-check-square";break;case "radio":c="type id label name checked options nb_cols default_value".split(" ");d="icon-dot-circle-o";break;case "textarea":c="type id label name required nb_cols default_value".split(" ");d="icon-paragraph";break;case "select":c=
"type id label name required nb_cols multiple options web_service child_select default_value".split(" ");d="icon-format_list_bulleted";break;case "list":c="type id label name required nb_cols multiple options web_service child_select default_value size".split(" ");d="icon-format_list_bulleted";break;case "double_select":c="type id label name required nb_cols options web_service size label_from label_to name_from name_to default_value".split(" ");d="icon-format_list_bulleted";break;case "date":case "datetime":case "label_display":case "color_picker":c=
"type id label name nb_cols default_value".split(" ");"date"===b||"datetime"===b?d="icon-calendar-check-o":d;"label_display"===b?d="icon-eye":d;"color_picker"===b?d="icon-paint":d;break;case "upload":c="type id label name nb_cols default_value ext".split(" ");d="icon-file";break;case "tinymce":c="type id label name nb_rows options default_value nb_cols".split(" ");d="icon-font";break;case "slider":c="type id label name options default_value nb_cols".split(" ");d="icon-sliders";break;case "text":case "password":case "url":case "email":c=
"type id label name pattern required nb_cols default_value".split(" ");"text"===b?d="icon-font":d;"password"===b?d="icon-key":d;"url"===b?d="icon-chrome":d;"email"===b?d="icon-at":d;break;case "integer":case "float":case "number":c="type id label name min max nb_cols default_value".split(" ");d="icon-calculator";break;case "link":c="type id label name alias folder nb_cols target".split(" ");d="glyphicon glyphicon-link";break;case "image":c="type id label name alias folder nb_cols width".split(" ");
d="glyphicon glyphicon-picture";break;case "map_osm":case "map_bing":case "map_vmap":c="type id label name required map_options nb_cols style default_value".split(" ");d="icon-map";break;case "codemirror":c="type id label ui name cm_options nb_cols".split(" "),d="icon-code"}for(var e in a)null!=c&&-1===c.indexOf(e)&&delete a[e];switch(b){case "list":case "double_select":b={size:5};break;case "button":n(a["class"])?a["class"]:a["class"]="btn-ungroup btn-group-sm";n(a.buttons)?a.buttons:a.buttons=[];
b={type:"submit",name:"form_submit",label:"FORM_UPDATE","class":"btn-primary"};n(a.buttons[0])?a.buttons[0]:a.buttons[0]=b;break;case "radio":b={choices:[{label:"Oui",value:!0},{label:"Non",value:!1}]};n(a.options)?a.options:a.options=b;n(a.nb_cols)?a.nb_cols:a.nb_cols=12;break;case "slider":b={min:0,max:100,precision:1,step:1};n(a.options)?a.options:a.options=b;n(a.nb_cols)?a.nb_cols:a.nb_cols=12;break;case "map_osm":n(a.style)?a.style:a.style={height:"250px"};b={proj:"EPSG:3857",type:"OSM",output_format:"ewkt",
center:{coord:[3E5,6E6],zoom:5,scale:25E6,extent:[-2.002637639E7,-2.00489661E7,2.002637639E7,2.00489661E7]},controls:{MP:!0,ZO:!0,SL:!0,CP:!0},layers:[],interactions:{multi_geometry:!1,full_screen:!0,RA:!1,RO:!0,ED:!0,DP:!0,DL:!0,DPol:!0,SE:!0},draw_color:"rgba(54,184,255,0.6)",contour_color:"rgba(0,0,0,0.4)",contour_size:2,circle_radius:6,features:[],coord_accuracy:8};n(a.map_options)&&"OSM"===a.map_options.type?a.map_options:a.map_options=b;break;case "map_bing":n(a.style)?a.style:a.style={height:"250px"};
b={proj:"EPSG:3857",type:"bing",output_format:"ewkt",center:{coord:[3E5,6E6],zoom:5,scale:25E6,extent:[-2.002637639E7,-2.00489661E7,2.002637639E7,2.00489661E7]},controls:{MP:!0,ZO:!0,SL:!0,CP:!0},layers:[],interactions:{multi_geometry:!1,full_screen:!0,RA:!1,RO:!0,ED:!0,DP:!0,DL:!0,DPol:!0,SE:!0},draw_color:"rgba(54,184,255,0.6)",contour_color:"rgba(0,0,0,0.4)",contour_size:2,circle_radius:6,features:[],coord_accuracy:8,source:{culture:"fr-FR",key:"",style:"Aerial"}};n(a.map_options)&&"bing"===a.map_options.type?
a.map_options:a.map_options=b;break;case "map_vmap":n(a.style)?a.style:a.style={height:"250px"};b={proj:"EPSG:3857",type:"vmap",output_format:"ewkt",center:{coord:[3E5,6E6],zoom:5,scale:25E6,extent:[-2.002637639E7,-2.00489661E7,2.002637639E7,2.00489661E7]},controls:{MP:!0,ZO:!0,SL:!0,CP:!0},layers:[],interactions:{multi_geometry:!1,full_screen:!0,RA:!1,RO:!0,ED:!0,DP:!0,DL:!0,DPol:!0,SE:!0},draw_color:"rgba(54,184,255,0.6)",contour_color:"rgba(0,0,0,0.4)",contour_size:2,circle_radius:6,features:[],
coord_accuracy:8};n(a.map_options)&&"vmap"===a.map_options.type?a.map_options:a.map_options=b;break;case "codemirror":b={mode:"javascript",readOnly:!1,styleActiveLine:!0,lineNumbers:!0,lineSeparator:"\r\n",indentWithTabs:!0,tabSize:2,viewportMargin:50,theme:"Veremes"};n(a.cm_options)?a.cm_options:a.cm_options=b;n(a.nb_cols)?a.nb_cols:a.nb_cols=12;n(a.ui)?a.ui:a.ui=!0;break;case "bo_grid":b={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!1,enablePaginationControls:!1,enableColumnMenus:!1,
enableColumnResizing:!1,appHeader:!0,appHeaderTitleBar:!0,columnDefs:[],data:[]};n(a.options)?a.options:a.options=b;n(a.nb_cols)?a.nb_cols:a.nb_cols=12;setTimeout(function(){Z.reloadForm()});break;case "section_grid":b={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!1,enablePaginationControls:!1,enableColumnMenus:!1,enableColumnResizing:!1,appHeader:!0,appHeaderTitleBar:!0,columnDefs:[],data:[]};n(a.options)?a.options:a.options=b;n(a.nb_cols)?a.nb_cols:a.nb_cols=12;setTimeout(function(){Z.reloadForm()});
break;case "ui_grid":b={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!1,enablePaginationControls:!1,enableColumnMenus:!1,enableColumnResizing:!1,appHeader:!0,appHeaderTitleBar:!0,appGridTitle:"Titre",appEnableDragAndDrop:!1,columnDefs:[],data:[],appActions:[],datasource:{}};n(a.options)?a.options:a.options=b;n(a.nb_cols)?a.nb_cols:a.nb_cols=12;angular.element("#studio_form_reader > form").scope().gridOptions=a.options;setTimeout(function(){Z.reloadForm()});break;case "treeview":b={showBorder:!1,
levels:0,showCheckbox:!0,expandIcon:"glyphicon glyphicon-folder-close",collapseIcon:"glyphicon glyphicon-folder-open",highlightSelected:!1,multiSelect:!0,data:[],dataLoadingEvent:""};n(a.options)?a.options:a.options=b;n(a.nb_cols)?a.nb_cols:a.nb_cols=12;setTimeout(function(){Z.reloadForm()});break;default:a.nb_cols||(a.nb_cols=12)}return d}};e.resize=function(){a.collapsed=!a.collapsed;Z.Eh[4]=a.collapsed;Z.resize()};e.updateBoList=function(){a.aBusinessObjects=[];var b=d.defer();A({method:"GET",
url:Z.da.web_server_name+"/"+Z.da.services_alias+"/vmap/businessobjects",headers:{Accept:"application/x-vm-json"},scope:a,timeout:5E3,abord:b.promise,success:function(b){if(null==b||null==b.data||null==b.data.data||null==b.data.data[0])return 0;a.aBusinessObjects=b.data.data}})};e.updateBoLinkLists=function(c){if(null==c)return 0;var e=[],f=d.defer();A({method:"GET",url:Z.da.web_server_name+"/"+Z.da.services_alias+"/vmap/querys/"+c,headers:{Accept:"application/x-vm-json"},scope:a,timeout:5E3,abord:f.promise,
success:function(b){if(null==b||null==b.data||null==b.data.data||null==b.data.data[0]||null==b.data.data[0])return 0;b=Object.keys(b.data.data[0]);a.aBoAttributs=b}});if("undefined"!==typeof Z.ea()[b.selected_form_type])for(c=Z.ea()[b.selected_form_type].rows,f=0;f<c.length;f++)for(var g=0;g<c[f].fields.length;g++)e.push(c[f].fields[g].name);a.aFormAttributs=e};e.updateSectionList=function(){a.aBusinessObjects=[];var b=d.defer();A({method:"GET",url:Z.da.web_server_name+"/"+Z.da.services_alias+"/vitis/vitissections",
headers:{Accept:"application/x-vm-json"},params:{filter:{relation:"AND",operators:[{column:"template",compare_operator:"=",value:"workspaceListTpl.html"},{column:"lang",compare_operator:"=",value:Z.da.language}]}},scope:a,timeout:5E3,abord:b.promise,success:function(b){if(null==b||null==b.data||null==b.data.data||null==b.data.data[0])return 0;a.aSections=b.data.data}})};e.updateSectionLinkLists=function(c){a.aBusinessObjects=[];var e=d.defer();A({method:"GET",url:Z.da.web_server_name+"/"+Z.da.services_alias+
"/vitis/vitissections/"+c,headers:{Accept:"application/x-vm-json"},scope:a,timeout:5E3,abord:e.promise,success:function(b){if(null==b||null==b.data||null==b.data.data||null==b.data.data[0])return 0;b=b.data.data[0];null!=b.ressource_id&&A({method:"GET",url:Z.da.web_server_name+"/"+Z.da.services_alias+"/"+b.ressource_id,headers:{Accept:"application/x-vm-json"},scope:a,timeout:5E3,abord:e.promise,success:function(b){if(null==b||null==b.data||null==b.data.data||null==b.data.data[0])return 0;b=Object.keys(b.data.data[0]);
a.aSectionAttributs=b}})}});c=[];if("undefined"!==typeof Z.ea()[b.selected_form_type])for(var f=Z.ea()[b.selected_form_type].rows,g=0;g<f.length;g++)for(var h=0;h<f[g].fields.length;h++)c.push(f[g].fields[h].name);a.aFormAttributs=c}};NA.prototype.elementFormController=NA.prototype.fu;NA.prototype.fu.$inject=["$scope","$rootScope","$timeout","$q"];var OA={};qa("nsVitisComponent",OA);function PA(a){var b=a.target,c=a.options;this.tq=a.hiddenFieldId;this.zv=a.oFormValues;this.ow=a.sFormName;a=a.oProj;if(null==b)return console.error("nsVitisComponent.Map: target not defined"),null;if(null==c)return console.error("nsVitisComponent.Map: options not defined"),null;if(null==this.tq)return console.error("nsVitisComponent.Map: hiddenFieldId not defined"),null;if(null==this.zv)return console.error("nsVitisComponent.Map: oFormValues not defined"),null;if(null==this.ow)return console.error("nsVitisComponent.Map: sFormName not defined"),
null;if(null==a)return console.error("nsVitisComponent.Map: oProj not defined"),null;this.RE=angular.element(v.Wb).injector().get(["propertiesSrvc"]);this.gk=angular.element(v.Wb).injector().get(["$translate"]);this.K=angular.element(v.Wb).injector().get(["$log"]);var d=this;this.K.info("nsVitisComponent.Map");this.rf=$(".banner_line").css("background-color");n(this.rf)&&"a"!==this.rf.charAt(3)&&(this.rf=this.rf.split("("),this.rf=this.rf[1].split(")"),this.rf="rgba("+this.rf[0]+",0.58)");this.gk("COMPONENT_MAP_LAYERSTREE COMPONENT_MAP_FULLSCREEN COMPONENT_MAP_ZOOM_EXTENT COMPONENT_MAP_DELETE_FEATURE COMPONENT_MAP_DELETE_ALL COMPONENT_MAP_MODIFY_FEATURE COMPONENT_MAP_DRAW_POINT COMPONENT_MAP_DRAW_LINE COMPONENT_MAP_DRAW_POLYGON COMPONENT_MAP_ZOOM_EXTENT COMPONENT_MAP_OVERSIZED_EXTENT".split(" ")).then(function(a){d.Ff=
a});this.tm();var e,f;n(c.center.coord)&&(e=c.center.coord);n(c.center.extent)&&(f=c.center.extent);this.gd=c.proj;this.gp=null!=c.base_proj?c.base_proj:this.gd;this.vl=null!=c.output_format?c.output_format:"wkt";this.hP=new Mt({CD:!0});this.$z=new Ur({Pc:this.gp,Ic:this.gd});this.nf=c.center.coord?new yi({Oa:e,zoom:5,pa:ih(c.proj)}):new yi({Oa:[(f[0]+f[2])/2,(f[1]+f[3])/2],zoom:5,pa:ih(c.proj)});this.Ff={};this.bc=b;this.Qo=c.coord_accuracy;this.om=[];this.Si=[];this.lf=new he;this.wa="none";this.Config=
{};this.mr=a;this.ir=c.interactions.multi_geometry;this.Pr=null;this.bLayersTreeOpen=!0===c.bLayersTreeOpen?c.bLayersTreeOpen:!1;this.ij=[];this.Op=[];this.Np=[];this.Om=[];"OSM"===c.type?this.Si.push(new Xo({source:new Op})):"bing"===c.type&&this.Si.push(new Xo({source:new Rs({dj:c.source.culture,key:c.source.key,$u:c.source.style})}));this.element=document.createElement("DIV");$(this.element).addClass("ol-current-projection-studio ol-unselectable");c.controls.MP&&this.om.push(new Wx({wp:function(a){return[a[0].toPrecision(d.Qo),
a[1].toPrecision(d.Qo)]}}));c.controls.SL&&this.om.push(new ey);c.controls.CP&&this.om.push(new mj({element:d.element,La:function(){for(var a="",b=0;b<d.mr.projections.length;b++)d.gd===d.mr.projections[b].code&&(a=d.mr.projections[b].name);""!==a?$(".ol-current-projection-studio").html(a):$(".ol-current-projection-studio").html(d.gd)}}));c.controls.ZO&&setTimeout(function(){d.Ys=QA(d,d.bc)},500);setTimeout(function(){d.Vs=RA(d,d.bc,c.interactions)});Array.isArray(c.layers)&&0<c.layers.length&&this.Si.push(c.layers);
this.ca=new Wo({target:d.bc,vb:d.Si,view:d.nf,controls:d.om});null!=c.center.scale&&this.Ee(c.center.scale);null!=c.center.extent&&this.co(c.center.extent);this.aTree="vmap"===c.type&&c.tree?this.il(c.tree):[{service:c.type,layers:this.Si}];b=ih(c.proj).V();e=Ei(this.nf,this.ca.$a());SA(e,b)?this.Ax=Ei(this.nf,this.ca.$a()):(console.error("map extent oversized"),Ji(E(this.ca),b));$(".ol-mouse-position").css("bottom","8px");$(".ol-mouse-position").css("top","auto");$(".ol-mouse-position").css("background",
this.rf);$(".ol-mouse-position").css("color","#ffffff");$(".ol-mouse-position").css("border-radius","4px");$(".ol-scale-line").css("background",this.rf);$(".ol-current-projection-studio").css("background",this.rf);c.draw_color=n(c.draw_color)?c.draw_color:"rgba(54,184,255,0.6)";c.contour_color=n(c.contour_color)?c.contour_color:"rgba(0,0,0,0.4)";c.contour_size=n(c.contour_size)?c.contour_size:2;c.circle_radius=n(c.circle_radius)?c.circle_radius:7;b=new Tp({fill:new Sp({color:c.draw_color}),stroke:new Tn({color:c.contour_color,
width:c.contour_size}),kb:new Rp({cb:c.circle_radius,fill:new Sp({color:c.draw_color}),stroke:new Tn({color:c.contour_color,width:c.contour_size})})});this.Oc=new yq({style:b,Hi:!0,Ii:!0,source:new rq({features:d.lf})});setTimeout(function(){d.ca.Pb(d.Oc)},500);b=$("#"+this.tq).val();if(n(b)&&!/^[\s\xa0]*$/.test(b)&&"[object Object]"!==b){b=TA(d,b);for(e=0;e<b.length;e++)this.Oc.s().xb(b[e]);e=this.Oc.s().V();Ji(E(this.ca),e);1===b.length&&"Point"===b[0].j().F()&&E(this.ca).Tj(12)}this.lf.on("change",
function(){setTimeout(function(){UA(d);d.ca.dispatchEvent("moveend")})});return this}OA.Map=PA;
function UA(a){a.K.info("nsVitisComponent.Map.saveFeatures");var b;b=a.lf.P();a.K.info("nsVitisComponent.Map.getStringByFeatures");for(var c="",d=0;d<b.length;d++){var e=b[d].Fu();ce(b[d],{style:null!=e?e:null})}"ewkt"===a.vl?c=Ot(b,a.gd):"wkt"===a.vl?c=Pt(b,a.gd):"geojson"===a.vl&&(c=a.$z.mm(b,{xd:a.gp,Ic:a.gd}));b=c;n(a.tq)&&document.getElementById(a.tq).setAttribute("value",b);n(a.ow)&&n(a.zv)&&(a.zv[a.ow]=b);for(b=0;b<a.Op.length;b++)ga(a.Op[b])&&a.Op[b].call(a,a.lf.P())}
function TA(a,b){a.K.info("nsVitisComponent.Map.getFeaturesByString");var c=[];if("wkt"===a.vl||"ewkt"===a.vl)if(zd(b))c=Nt(b,a.gd);else{console.error("cannot read the geometry on format ewkt");try{c=a.hP.si(b,{xd:a.gp,Ic:a.gd})}catch(d){console.error("cannot read the geometry on format wkt")}}else if("geojson"===a.vl)try{for(c=a.$z.si(b,{xd:a.gp,Ic:a.gd}),a=0;a<c.length;a++)null!=c[a].get("style")&&c[a].vw(c[a].get("style"))}catch(d){console.error("cannot read the geometry on format geojson")}return c}
PA.prototype.tm=function(){var a=new Qg({code:"EPSG:2154",aa:[-378305.81,6093283.21,1212610.74,7186901.68],units:"m"});lh(a);oh("EPSG:4326","EPSG:2154",this.Xs,this.ev);oh("EPSG:3857","EPSG:2154",function(a){a=th(a,"EPSG:3857","EPSG:4326");return th(a,"EPSG:4326","EPSG:2154")},function(a){a=th(a,"EPSG:2154","EPSG:4326");return th(a,"EPSG:4326","EPSG:3857")})};
PA.prototype.Xs=function(a){var b=3/180*Math.PI,c=46.5/180*Math.PI,d=44/180*Math.PI,e=49/180*Math.PI,f=a[1]/180*Math.PI;a=a[0]/180*Math.PI;var g=6378137/Math.sqrt(1-.006694380025712785*Math.sin(d)*Math.sin(d)),h=Math.log(Math.tan(Math.PI/4+d/2)*Math.pow((1-.08181919106*Math.sin(d))/(1+.08181919106*Math.sin(d)),.04090959553)),f=Math.log(Math.tan(Math.PI/4+f/2)*Math.pow((1-.08181919106*Math.sin(f))/(1+.08181919106*Math.sin(f)),.04090959553)),e=Math.log(6378137/Math.sqrt(1-.006694380025712785*Math.sin(e)*
Math.sin(e))*Math.cos(e)/(g*Math.cos(d)))/(h-Math.log(Math.tan(Math.PI/4+e/2)*Math.pow((1-.08181919106*Math.sin(e))/(1+.08181919106*Math.sin(e)),.04090959553))),d=g*Math.cos(d)/e*Math.exp(e*h);return[7E5+d*Math.exp(-1*e*f)*Math.sin(e*(a-b)),66E5+d*Math.exp(-1*e*Math.log(Math.tan(Math.PI/4+c/2)*Math.pow((1-.08181919106*Math.sin(c))/(1+.08181919106*Math.sin(c)),.04090959553)))-d*Math.exp(-1*e*f)*Math.cos(e*(a-b))]};
PA.prototype.ev=function(a){Math.atanh=Math.atanh||function(a){return Math.log((1+a)/(1-a))/2};Math.tanh=Math.tanh||function(a){return Infinity===a?1:-Infinity===a?-1:(Math.exp(a)-Math.exp(-a))/(Math.exp(a)+Math.exp(-a))};var b=1/298.257222101,b=Math.sqrt(2*b-b*b),c=a[0].toFixed(10)-7E5;a=a[1].toFixed(10)-1.26556120499E7;var d=Math.log(1.1754255426096E7/Math.sqrt(c*c+a*a))/.725607765053267;return[(Math.atan(-c/a)/.725607765053267+3/180*Math.PI)/Math.PI*180,Math.asin(Math.tanh(d+b*Math.atanh(b*Math.tanh(d+
b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.sin(1))))))))))))))))/Math.PI*180]};
function QA(a,b){var c=document.createElement("BUTTON"),d=document.createElement("BUTTON"),e=document.createElement("BUTTON");c.innerHTML="<span class='fa fa-search-plus fa-x1' aria-hidden='true'></span>";d.innerHTML="<span class='fa fa-search-minus fa-x1' aria-hidden='true'></span>";e.innerHTML="<span class='glyphicon glyphicon-home' aria-hidden='true'></span>";c.className="btn btn-success Map-btn map-ZoomIn";d.className="btn btn-success Map-btn map-ZoomOut";e.className="btn btn-success Map-btn map-ZoomToExtent";
$(c).prop("type","button");$(d).prop("type","button");$(e).prop("type","button");$(e).prop("title",a.Ff.COMPONENT_MAP_ZOOM_EXTENT);$(c).on("click",function(){E(a.ca).animate({zoom:E(a.ca).zf()+1,duration:250})});$(d).on("click",function(){E(a.ca).animate({zoom:E(a.ca).zf()-1,duration:250})});$(e).on("click",function(){Ji(E(a.ca),a.Ax)});var f=document.createElement("DIV");f.className="btn-group-vertical btn-group-md form-map-Group-btn-zoom";f.appendChild(c);f.appendChild(d);f.appendChild(e);b.appendChild(f);
return f}
function RA(a,b,c){var d=[];if(c.full_screen&&(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)){var e=document.createElement("BUTTON");e.innerHTML="<span class='icon-enlarge' aria-hidden='true'></span>";e.className="btn btn-success Map-btn map-FullScreen";e.title=a.Ff.COMPONENT_MAP_FULLSCREEN;$(e).prop("type","button");$(e).on("click",function(){var b=a.bc;document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||
document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():b.requestFullscreen?b.requestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen&&b.webkitRequestFullscreen()});d.push(e)}c.layer_tree&&(e=document.createElement("BUTTON"),e.innerHTML="<span class='icon-layers2' aria-hidden='true'></span>",
e.className="btn btn-success Map-btn map-LayerTree",e.title=a.Ff.COMPONENT_MAP_LAYERSTREE,$(e).prop("type","button"),$(e).on("click",function(){a.bLayersTreeOpen=!a.bLayersTreeOpen;a.ca.dispatchEvent("moveend")}),d.push(e));c.select&&(e=document.createElement("BUTTON"),e.innerHTML="<span class='icon-hand-pointer' aria-hidden='true'></span>",e.className="btn btn-success Map-btn map-Select",e.title=a.Ff.COMPONENT_MAP_SELECT,$(e).prop("type","button"),$(e).on("click",function(){a.Vi("select")}),d.push(e));
if(c.RA||c.remove_all)e=document.createElement("BUTTON"),e.innerHTML="<span class='icon-trash' aria-hidden='true'></span>",e.className="btn btn-success Map-btn map-AllRemove",e.title=a.Ff.COMPONENT_MAP_DELETE_ALL,$(e).prop("type","button"),$(e).on("click",function(){"none"!==a.wa&&a.ca.hd(a.wa);a.Oc.s().Hb.clear();a.Oc.s().L();a.lf.L()}),d.push(e);if(c.RO||c.remove)e=document.createElement("BUTTON"),e.innerHTML="<span class='icon-eraser' aria-hidden='true'></span>",e.className="btn btn-success Map-btn map-Remove",
e.title=a.Ff.COMPONENT_MAP_DELETE_FEATURE,$(e).prop("type","button"),$(e).on("click",function(){a.Vi("remove")}),d.push(e);if(c.ED||c.modify)e=document.createElement("BUTTON"),e.innerHTML="<span class='icon-edit' aria-hidden='true'></span>",e.className="btn btn-success Map-btn map-Modify",e.title=a.Ff.COMPONENT_MAP_MODIFY_FEATURE,$(e).prop("type","button"),$(e).on("click",function(){a.Vi("modify")}),d.push(e);if(c.DP||c.point)e=document.createElement("BUTTON"),e.innerHTML="<span class='icon-point' aria-hidden='true'></span>",
e.className="btn btn-success Map-btn map-Point",e.title=a.Ff.COMPONENT_MAP_DRAW_POINT,$(e).prop("type","button"),$(e).on("click",function(){a.Vi("point")}),d.push(e);if(c.DL||c.line)e=document.createElement("BUTTON"),e.innerHTML="<span class='icon-line' aria-hidden='true'></span>",e.className="btn btn-success Map-btn map-Line",e.title=a.Ff.COMPONENT_MAP_DRAW_LINE,$(e).prop("type","button"),$(e).on("click",function(){a.Vi("line")}),d.push(e);if(c.DPol||c.polygon)c=document.createElement("BUTTON"),
c.innerHTML="<span class='icon-polygon' aria-hidden='true'></span>",c.className="btn btn-success Map-btn map-Polygon",c.title=a.Ff.COMPONENT_MAP_DRAW_POLYGON,$(c).prop("type","button"),$(c).on("click",function(){a.Vi("polygon")}),d.push(c);var f=document.createElement("DIV");f.className="btn-group-vertical btn-group-md form-map-Group-btn-interact";for(c=0;c<d.length;c++)f.appendChild(d[c]);b.appendChild(f);setTimeout(function(){var b=a.ca.Rc;b.on("change:length",function(){$(f).children().removeClass("active");
$(f).children().blur();b.forEach(function(a){$(a.get("binded-button")).addClass("active")})});b.on("remove",function(){null!=a.cf&&a.cf.setActive(!1);a.Pr=null;for(var b=0;b<a.ij.length;b++)ga(a.ij[b])&&a.ij[b].call(this,a.Pr)});$(document).keydown(function(c){27===c.keyCode&&b.forEach(function(b){n(b.get("binded-button"))&&a.ca.hd(b)})})},1E3);return f}
PA.prototype.hd=function(a){var b=null;switch(a){case "full_screen":b=$(this.bc).find(".map-FullScreen");break;case "layer_tree":b=$(this.bc).find(".map-LayerTree");break;case "select":b=$(this.bc).find(".map-Select");break;case "remove_all":case "RA":b=$(this.bc).find(".map-AllRemove");break;case "remove":case "RO":b=$(this.bc).find(".map-Remove");break;case "modify":case "ED":b=$(this.bc).find(".map-Modify");break;case "point":case "DP":b=$(this.bc).find(".map-Point");break;case "line":case "DL":b=
$(this.bc).find(".map-Line");break;case "polygon":case "DPol":b=$(this.bc).find(".map-Polygon")}null!=b&&$(b).remove()};PA.prototype.removeInteraction=PA.prototype.hd;function VA(a){null!=a.cf&&a.ca.hd(a.cf);a.cf=new Oy({source:a.Oc.s(),Xb:Gj});a.cf.on("select",function(b){a.bc.style.cursor="";q(b.selected)&&0<b.selected.length&&(a.bc.style.cursor="pointer")});a.ca.Ob(a.cf);a.cf.setActive(!0)}
PA.prototype.Vi=function(a,b){var c=this;switch(a){case "point":var d=$(this.bc).find(".map-Point");break;case "line":d=$(this.bc).find(".map-Line");break;case "polygon":d=$(this.bc).find(".map-Polygon");break;case "select":d=$(this.bc).find(".map-Select");break;case "remove":d=$(this.bc).find(".map-Remove");break;case "modify":d=$(this.bc).find(".map-Modify")}var e=$(d).hasClass("active");b&&(e=!1);if("none"!==this.wa&&(this.ca.hd(this.wa),e))return 0;switch(a){case "point":this.wa=new Cq({source:this.Oc.s(),
type:"Point"});this.wa.set("binded-button",d);this.wa.set("type","draw_point");this.ca.Ob(this.wa);this.wa.on("drawend",function(a){!0!==c.ir&&c.Oc.s().Hb.clear();a.ka.iz=NaN;c.lf.L();WA(c,a.ka)});break;case "line":this.wa=new Cq({source:this.Oc.s(),type:"LineString"});this.wa.set("binded-button",d);this.wa.set("type","draw_line");this.ca.Ob(this.wa);this.wa.on("drawend",function(a){!0!==c.ir&&c.Oc.s().Hb.clear();a.ka.iz=NaN;c.lf.L();WA(c,a.ka)});break;case "polygon":this.wa=new Cq({source:this.Oc.s(),
type:"Polygon"});this.wa.set("binded-button",d);this.wa.set("type","draw_polygon");this.ca.Ob(this.wa);this.wa.on("drawend",function(a){!0!==c.ir&&c.Oc.s().Hb.clear();a.ka.iz=NaN;c.lf.L();WA(c,a.ka)});break;case "select":d=$(this.bc).find(".map-Select");XA(this,d);break;case "remove":this.wa=new Oy({Xb:Ej,source:this.Oc.s()});VA(this);this.wa.set("binded-button",d);this.wa.set("type","remove");this.ca.Ob(this.wa);this.wa.Ca().on("add",function(){c.Jb(c.wa.Ca().P()[0])});break;case "modify":this.wa=
new ot({features:this.Oc.s().Hb}),this.wa.set("binded-button",d),this.wa.set("type","modify"),this.ca.Ob(this.wa),this.wa.on("modifyend",function(){c.lf.L()})}};PA.prototype.activeInteraction=PA.prototype.Vi;
function XA(a,b){a.wa=new Oy({Xb:Ej,source:a.Oc.s()});null!=b&&(a.wa.set("binded-button",b),a.wa.set("type","select"));a.ca.Ob(a.wa);a.wa.Ca().on("change:length",function(){var b=a.Oc.s().Ca(),d=a.wa.Ca().P()[0],b=b[b.indexOf(d)];a.Pr=null!=b?b:null;for(b=0;b<a.ij.length;b++)ga(a.ij[b])&&a.ij[b].call(this,a.Pr)});a.wa.Vt=function(){var b=a.wa.Ca().P()[0],d=new Sp({color:"rgba(255,255,255,0)"}),e=new Tn({color:"rgba(0,0,0,0.4)",width:2,sb:[10]}),d=new Tp({kb:new Rp({fill:d,stroke:e,cb:50}),fill:d,
stroke:e});if(null!=b){e=b.j().V();if("Point"===b.j().F())e=new vd({geometry:b.j()});else var b=e[0],f=e[1],g=e[2],e=e[3],e=new qi([[[b,f],[b,e],[g,e],[g,f]]]),e=new vd({geometry:e});e.le(d);a.wa.Ca().push(e)}};a.wa.on("select",function(){a.wa.Vt()});VA(a)}PA.prototype.Jb=function(a){this.Oc.s().Jb(a);this.wa.Ca().clear();null!=this.cf&&this.cf.Ca().clear();this.Oc.s().L();this.lf.L()};
PA.prototype.il=function(a){0<this.ca.getLayers().P().length&&this.ca.getLayers().clear();this.Si.length=0;var b,c=[],d=[256,256];a=angular.copy(a);var e=new Qt({properties:this.RE});b=e.jq(a,{size:this.ca.$a(),tileSize:d});d=e.vu(a,{size:this.ca.$a(),tileSize:d});this.ca.zi(b);for(e=0;e<d.length;e++)b={index:e,layer:d[e]},this.Si.push(b),this.ca.Pb(d[e]);for(e=0;e<a.children.length;e++)n(a.children[e].children)&&c.push({service:a.children[e].name,layers:a.children[e].children});return c};
PA.prototype.loadTree=PA.prototype.il;function SA(a,b){var c=!0;b[0]>a[0]&&(c=!1);b[1]>a[1]&&(c=!1);b[2]<a[2]&&(c=!1);b[3]<a[3]&&(c=!1);return c}PA.prototype.Za=function(){var a=new Mg(6378137),b=E(this.ca).J(),c=Ei(E(this.ca),[37.795275591,0]),d=th([c[0],c[1]],b,"EPSG:4326"),b=th([c[2],c[3]],b,"EPSG:4326");return 100*Ng(d,b,a.cb)};PA.prototype.getScale=PA.prototype.Za;PA.prototype.Ee=function(a){var b=this.getScale(),c=E(this.ca).Fa();a=a*c/b;Ki(E(this.ca),a);this.getScale()};
PA.prototype.setScale=PA.prototype.Ee;PA.prototype.co=function(a){this.Ax=a;Ji(E(this.ca),a,{Dj:!0})};PA.prototype.zf=function(){return E(this.ca).zf()};PA.prototype.getZoom=PA.prototype.zf;PA.prototype.Tj=function(a){E(this.ca).Tj(a)};PA.prototype.setZoom=PA.prototype.Tj;PA.prototype.tb=function(a){E(this.ca).tb(a)};PA.prototype.setCenter=PA.prototype.tb;
PA.prototype.hN=function(a){var b=this;this.ca.$f().clear();"undefined"!==this.Ys&&$(this.Ys).remove();a.ZO&&(this.Ys=QA(this,this.bc));a.MP&&(this.ca.ad(new Wx({wp:function(a){return[a[0].toPrecision(b.Qo),a[1].toPrecision(b.Qo)]}})),$(".ol-mouse-position").css("bottom","8px"),$(".ol-mouse-position").css("top","auto"),$(".ol-mouse-position").css("background","rgba(218, 94, 209, 0.58)"),$(".ol-mouse-position").css("color","#ffffff"),$(".ol-mouse-position").css("border-radius","4px"));a.SL&&(this.ca.ad(new ey),
$(".ol-scale-line").css("background","rgba(218, 94, 209, 0.58)"));a.CP&&this.ca.ad(new mj({element:b.element,render:function(){$(b.element).html(b.gd)}}))};PA.prototype.setControls=PA.prototype.hN;PA.prototype.pN=function(a){this.ca.Rc.clear();"undefined"!==this.Vs&&$(this.Vs).remove();this.Vs=RA(this,this.bc,a);Ak().forEach(function(a){this.ca.Ob(a)},this)};PA.prototype.setInteractions=PA.prototype.pN;
PA.prototype.gN=function(a){var b=this.ca.getLayers().P()[0];a=new Rs({dj:a.culture,key:a.key,$u:a.style});b.set("source",a)};PA.prototype.setBingSource=PA.prototype.gN;PA.prototype.GH=function(){this.Config.extent=Ei(this.nf,this.ca.$a());this.Config.coord=this.nf.Ka();this.Config.scale=Math.round(this.getScale());return this.Config};PA.prototype.getConfig=PA.prototype.GH;PA.prototype.g=function(){return this.ca};PA.prototype.getMap=PA.prototype.g;
PA.prototype.zi=function(a){this.gd=a.proj;var b,c;n(a.center.coord)&&(b=a.center.coord);n(a.center.extent)&&(c=a.center.extent);a.center.coord&&a.center.zoom?(this.nf=new yi({center:b,zoom:a.center.zoom,projection:ih(this.gd)}),this.ca.zi(this.nf)):(this.nf=new yi({center:[(c[0]+c[2])/2,(c[1]+c[3])/2],projection:ih(this.gd)}),this.ca.zi(this.nf),Ji(E(this.ca),c,{Dj:!0}));a="";for(b=0;b<this.mr.projections;b++)this.gd===this.zL.projections[b].code&&(a=this.zL.projections[b].name);""!==a?$(".ol-current-projection-studio").html(a):
$(".ol-current-projection-studio").html(this.gd)};PA.prototype.setView=PA.prototype.zi;PA.prototype.qN=function(a){this.il(a)};PA.prototype.setJsonTree=PA.prototype.qN;PA.prototype.Ca=function(){return this.lf.P()};PA.prototype.getFeatures=PA.prototype.Ca;PA.prototype.zu=function(){return this.gd};PA.prototype.getProj=PA.prototype.zu;PA.prototype.V=function(){return Ei(this.nf,this.ca.$a())};PA.prototype.getExtent=PA.prototype.V;PA.prototype.Ka=function(){return this.nf.Ka()};
PA.prototype.getCenter=PA.prototype.Ka;PA.prototype.DO=function(a,b,c){return th(a,b,c)};PA.prototype.transformer=PA.prototype.DO;PA.prototype.CO=function(a,b,c){return uh(a,b,c)};PA.prototype.transformExtent=PA.prototype.CO;PA.prototype.on=function(a,b,c){this.ca.on(a,b,c)};PA.prototype.on=PA.prototype.on;
PA.prototype.Nh=function(a,b){var c=this.g(),d=this,e=new vd({geometry:new ii([a,b])});c.getLayers().P().forEach(function(a){if(n(a.s().Ca)){var b=a.s().Hb;!0!==d.ir&&a.s().Hb.clear();b.push(e)}});this.tb([a,b])};function YA(a,b){a.ij.push(b)}function ZA(a,b){a.Op.push(b)}function $A(a,b){a.Np.push(b)}function aB(a,b){a.Om.push(b)}function WA(a,b){for(var c=0;c<a.Np.length;c++)ga(a.Np[c])&&a.Np[c].call(a,b);for(c=0;c<a.Om.length;c++)ga(a.Om[c])&&a.Om[c].call(a,b);Pa(a.Om)};var Z={};qa("oVFB",Z);Z.config={};Z.yj=function(a){console.log("oVFB.init: ",a);Z.config=a};Z.init=Z.yj;Z.resize=function(){};Z.resize=Z.resize;Z.tA=function(){return Z.wc};Z.getUpdate=Z.tA;Z.yN=function(a){Z.wc=a};Z.setUpdate=Z.yN;Z.IH=function(){return Z.nL};Z.getDevTools=Z.IH;Z.AI=function(){return Z.AL};Z.getTreeView=Z.AI;Z.NH=function(){return Z.VB};Z.getFormTools=Z.NH;Z.Sh=function(){return Z.WB};Z.getJsonLoader=Z.Sh;Z.JH=function(){return Z.UB};Z.getElementForm=Z.JH;Z.BI=function(){return Z.dC};
Z.getVisualizer=Z.BI;Z.bq=function(){return Z.XB};Z.getJson=Z.bq;Z.kD=function(a){Z.XB=a};Z.setJson=Z.kD;Z.Ug=function(){return Z.UC};Z.getJs=Z.Ug;Z.Pl=function(a){Z.UC=a};Z.setJs=Z.Pl;Z.nj=function(){return Z.SC};Z.getCss=Z.nj;Z.sw=function(a){Z.SC=a};Z.setCss=Z.sw;Z.ea=function(){n(Z.kr)||console.error("oVFB.oJsonOutput_ undefined");hb(Z.kr)&&console.error("oVFB.oJsonOutput_ is empty");return Z.kr};Z.getJsonOutput=Z.ea;Z.ic=function(a){Z.kr=a};Z.setJsonOutput=Z.ic;
Z.sA=function(a){var b,c;for(c in a)if(b=a[c],null!=b.rows)for(var d=0;d<b.rows.length;d++)if(null!=b.rows[d].fields)for(var e=0;e<b.rows[d].fields.length;e++)!0===b.rows[d].fields[e].selected&&delete b.rows[d].fields[e].selected;return a};
Z.aG=function(a){if("wab"!==Z.Tg())return a;var b,c;for(c in a)if(b=a[c],null!=b.rows)for(var d=0;d<b.rows.length;d++)if(null!=b.rows[d].fields)for(var e=0;e<b.rows[d].fields.length;e++)null!=b.rows[d].fields[e].selected&&delete b.rows[d].fields[e].selected,null!=b.rows[d].fields[e].disabled&&delete b.rows[d].fields[e].disabled,null!=b.rows[d].fields[e].visible&&delete b.rows[d].fields[e].visible;return a};
Z.iA=function(a){for(var b=[],c=[],d=0;d<a.rows.length;d++)if(null!=a.rows[d].fields)for(var e=0;e<a.rows[d].fields.length;e++)null!=a.rows[d].fields[e].name&&b.push(a.rows[d].fields[e].name),null!=a.rows[d].fields[e].buttons&&c.push(a.rows[d].fields[e].name);return{elems:b,buttons:c}};
Z.PO=function(a,b){b=b.name;a=a.name;var c=Z.ea(),d,e,f;for(f in c)if(d=c[f],null!=d.tabs&&null!=d.tabs.list)for(var g=0;g<d.tabs.list.length;g++)e=d.tabs.list[g],null!=e.elements&&-1!==e.elements.indexOf(b)&&e.elements.splice(e.elements.indexOf(b),1,a);Z.ic(c)};Z.QO=function(a,b){b=b.name;a=a.name;var c=Z.ea(),d,e,f;for(f in c)if(d=c[f],null!=d.wab)for(var g in d.wab)for(var h in d.wab[g])e=d.wab[g][h],null!=e[b]&&(e[a]=e[b],delete e[b]);Z.ic(c)};
Z.ZF=function(a,b){var c;if(null!=a.list)for(var d=0;d<a.list.length;d++)if(c=a.list[d],null!=c.elements)for(var e=c.elements.length-1;0<=e;e--)-1===b.indexOf(c.elements[e])&&(console.error("Element "+c.elements[e]+" is not in elements list"),c.elements.splice(e,1));return a};
Z.$F=function(a,b,c,d){for(var e=0;e<c.length;e++)null!=a[c[e]]||(a[c[e]]={});for(var f in a)if(-1===c.indexOf(f))delete a[f];else{for(e=0;e<d.length;e++)null!=a[f][d[e]]||(a[f][d[e]]={});for(var g in a[f])if(-1===d.indexOf(g))delete a[f][g];else{for(var h in a[f][g])-1===b.indexOf(h)&&delete a[f][g][h];for(e=0;e<b.length;e++)null!=a[f][g][b[e]]||(a[f][g][b[e]]="")}}return a};
Z.bG=function(a){var b;if(null!=a.list)for(var c=0;c<a.list.length;c++)b=a.list[c],null!=b.$$hashKey&&delete b.$$hashKey,null!=b.studio_mode&&delete b.studio_mode;return a};Z.dn=function(){return Z.bE};Z.getTreeDnD=Z.dn;Z.ho=function(a){Z.bE=a};Z.setTreeDnD=Z.ho;Z.rA=function(){return Z.XD};Z.getToken=Z.rA;Z.setToken=function(a){Z.XD=a};Z.mc=function(){return Z.id};Z.getId=Z.mc;Z.Tg=function(){return Z.zx};Z.setId=function(a){Z.id=a};Z.setContainer=function(a){Z.fH=a};
Z.setAppProperties=function(a){Z.da=a};Z.setApplication=function(a){Z.zx=a};Z.reset=function(){};Z.module=angular.module("vfb",["ui.codemirror","ui.grid","ui.grid.autoResize","formReader"]);Z.ID=function(){Z.log("nsVFB.MainDirective");null!=Z.config||console.error("oVFB['config'] not defined, please use oVFB.init(config)");return{restrict:"A",replace:!0,controller:"AppStudioMainController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/MainTemplate.html"}};
Z.studioMainDirective=Z.ID;Z.module.directive("appStudioMainDirective",Z.ID);
Z.H=function(a,b,c,d){Z.log("nsVFB.MainController");var e=this;this.b=a;this.G=d;this.va=b;this.$timeout_=c;this.Xu=0;this.text={};a.aCollapsed=Z.Eh;a.text={};a.jsonOutput={};a.datasources={};a.selectedDatasource={};a.webservices=[];a.businessObjects=[];a.ressources=[];a.aExternalDatabaseTables=[];a.schemas=[];a.databases=[];a.tables=[];a.selectedDatasource={};a.editedDatasource={};a.newSource={options:["Value one|1","Value two|2","Value three|3"],result_options:[{label:"Value one",value:"1"},{label:"Value two",
value:"2"},{label:"Value three",value:"3"}]};a.wabVisualizer=!1;a.editorOptions={mode:"schema",lineNumbers:!1,lineSeparator:"\n",theme:"Veremes",onLoad:function(){}};a.studioAddModalTestGridOptions={data:[],enableColumnMenus:!1,enableColumnResizing:!0,onRegisterApi:function(b){a.oo=b}};a.studioEditModalTestGridOptions={data:[],enableColumnMenus:!1,enableColumnResizing:!0,onRegisterApi:function(b){a.po=b}};a.studioDatasourcesGridOptions={data:[],columnDefs:[{field:"name",displayName:"Nom"}],enableColumnMenus:!1,
enableColumnResizing:!0,enableRowSelection:!0,multiSelect:!1,enableFullRowSelection:!0,onRegisterApi:function(b){a.datasourcesGridApi=b;b.selection.on.rowSelectionChanged(a,function(b){a.selectedDatasource=angular.copy(a.datasources[b.entity.id]);a.selectedDatasource.id=b.entity.id;e.hD(a.selectedDatasource)})}};a.tabs={};a.elems=[];a.sTestTabFormDefinitionName="";a.oTestTabFormValues={};a.oTestTabFormDefinition={};a.oTestTabFormScope={};a.sTestWabFormDefinitionName="";a.oTestWabFormValues={};a.oTestWabFormDefinition=
{};a.oTestWabFormScope={};a.oProperties=Z.da;a.sToken=sessionStorage.session_token;a.wab={};a.wabGroups=[];a.wabStates=[];a.module="";a.object="";a.wabSelectedGroup="";a.wabSelectedState="";a.applicationName=Z.Tg();A({method:"GET",url:"javascript/externs/studio/lang/lang-"+Z.da.language+".json",scope:this.b,success:function(b){a.text=b.data;e.text=b.data},error:function(){console.error("ERROR : (AJAX request : "+status+" ) On loading Language, contact Veremes please")}});A({method:"GET",url:Z.da.web_server_name+
"/"+Z.da.services_alias+"/vitis/webservices",headers:{Accept:"application/x-vm-json"},params:{attributs:"name"},scope:this.b,success:function(b){null!=b.data.data?a.webservices=b.data.data:console.error("response.data['data'] not defined")}});"vmap"===a.applicationName&&A({method:"GET",url:Z.da.web_server_name+"/"+Z.da.services_alias+"/vmap/businessobjects",headers:{Accept:"application/x-vm-json"},scope:this.b,params:{order_by:"title"},success:function(b){if(null!=b.data.data){b=b.data.data;for(var c=
0;c<b.length;c++)b[c].sql_form="SELECT * FROM "+b[c].schema+"."+b[c].table;a.businessObjects=[];for(c=0;c<b.length;c++)a.businessObjects.push({title:b[c].title,business_object_id:b[c].business_object_id,sql_form:b[c].sql_form,sql_summary:b[c].sql_summary,sql_list:b[c].sql_list})}else console.error("response.data['data'] not defined")}});$("#studio-datasource-modal").on("hide.bs.modal",function(){Z.hf();e.Wy();Z.reloadForm()});$("#studio-datasource-add-modal").on("hide.bs.modal",function(){a.aExternalDatabaseTables.length=
0;a.schemas.length=0;a.tables.length=0;e.pp()});$("#studio-datasource-edit-modal").on("hide.bs.modal",function(){a.aExternalDatabaseTables.length=0;a.schemas.length=0;a.tables.length=0;e.pp()});a.$on("updateForm",function(b,c){a.$applyAsync(function(){a.jsonOutput=c})});a.$on("updateTestTabForm",function(b,c){if(c[a.selected_form_type]){b=c[a.selected_form_type];for(var d=0;d<b.rows.length;d++)for(var e=0;e<b.rows[d].fields.length;e++)b.rows[d].fields[e].id||(b.rows[d].fields[e].id=b.rows[d].fields[e].name+
"_"+(d+1)+"_"+(e+1));a.oTestTabFormDefinition=c;a.sTestTabFormDefinitionName=a.selected_form_type;a.title=b.title;n(a.oTestTabFormValues)||(a.oTestTabFormValues={});n(a.oTestTabFormValues[a.sTestTabFormDefinitionName])||(a.oTestTabFormValues[a.sTestTabFormDefinitionName]={});angular.element($("#studio_test_tabs_form_reader").children()).scope().ctrl.ti()}else Z.log("visualizerFormModeController. Load JSON form fail: "+a.selected_form_type+" undefined in ",c)});a.$on("loadWABGroups",function(b,c){a.module=
c.module;a.object=c.object;bB(e,a.module)});a.$on("updateTestWabForm",function(b,c){if(c[a.selected_form_type]){b=c[a.selected_form_type];for(var d=0;d<b.rows.length;d++)for(var e=0;e<b.rows[d].fields.length;e++)b.rows[d].fields[e].id||(b.rows[d].fields[e].id=b.rows[d].fields[e].name+"_"+(d+1)+"_"+(e+1));a.oTestWabFormDefinition=c;a.sTestWabFormDefinitionName=a.selected_form_type;a.title=b.title;n(a.oTestWabFormValues)||(a.oTestWabFormValues={});n(a.oTestWabFormValues[a.sTestWabFormDefinitionName])||
(a.oTestWabFormValues[a.sTestWabFormDefinitionName]={});var f=angular.element($("#studio_test_wab_form_reader").children()).scope();null!=f&&f.$applyAsync(function(){f.wabState=a.wabSelectedState;f.wabGroup=a.wabSelectedGroup;f.ctrl.ti()})}else Z.log("visualizerFormModeController. Load JSON form fail: "+a.selected_form_type+" undefined in ",c)});a.$watch("tabs",function(){cB(e)},!0);a.$watch("wabSelectedGroup",function(){r(a.wabSelectedState)&&r(a.wabSelectedGroup)&&""!==a.wabSelectedGroup&&""!==
a.wabSelectedState&&dB(e)});a.$watch("wabSelectedState",function(){r(a.wabSelectedState)&&r(a.wabSelectedGroup)&&""!==a.wabSelectedGroup&&""!==a.wabSelectedState&&dB(e)})};Z.studioMainController=Z.H;Z.module.controller("AppStudioMainController",["$scope","$q",Z.H]);Z.module.filter("sortStates",function(){return function(a,b){var c=[],d;for(d in b)a[b[d]].name=b[d],c.push(a[b[d]]);return c}});
Z.H.prototype.IN=function(){Z.log("studioMainController.showTabsManagerModal");Z.wc=!0;var a=this.b,b=a.selected_form_type,c=Z.iA(a.jsonOutput[b]);Z.hf();a.jsonOutput=Z.ea();a.tabs=angular.copy(a.jsonOutput[b].tabs);a.elems=c.elems;a.buttons=c.buttons;a.tabs=Z.ZF(a.tabs,a.elems);cB(this);$("#studio-tabsmanager-modal").modal("show")};Z.H.prototype.showTabsManagerModal=Z.H.prototype.IN;Z.H.prototype.qO=function(a,b){-1!==b.elements.indexOf(a)?b.elements.splice(b.elements.indexOf(a),1):b.elements.push(a)};
Z.H.prototype.toggleElemOnTab=Z.H.prototype.qO;
function bB(a,b){var c=a.b;A({method:"POST",url:Z.da.web_server_name+"/"+Z.da.services_alias+"/wab/groups",headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},scope:c,data:{order_by:"name",distinct:!0,filter:{column:"module_id",compare_operator:"=",value:b}},success:function(b){if(null!=b.data.data){c.wabGroups=[];for(var d=0;d<b.data.data.length;d++)c.wabGroups.push(b.data.data[d].name);eB(a,c.module,c.object)}else console.error("response.data['data'] not defined")}})}
function eB(a,b,c){var d=a.b;A({method:"POST",url:Z.da.web_server_name+"/"+Z.da.services_alias+"/wab/states",headers:{Accept:"application/x-vm-json","X-HTTP-Method-Override":"GET"},scope:d,data:{order_by:"progress_lvl",sort_order:"ASC",distinct:!0,filter:{relation:"AND",operators:[{column:"module_id",compare_operator:"=",value:b},{column:"bo_name",compare_operator:"=",value:c}]}},success:function(b){if(null!=b.data.data){d.wabStates=[];for(var c=0;c<b.data.data.length;c++)d.wabStates.push(b.data.data[c].name);
a.dz()}else console.error("response.data['data'] not defined")}})}Z.H.prototype.dz=function(){for(var a=this.b,b=0;b<a.wabStates.length;b++){a.wab[a.wabStates[b]]={};for(var c=0;c<a.wabGroups.length;c++)a.wab[a.wabStates[b]][a.wabGroups[c]]={}}};Z.H.prototype.createEmptyWabObject=Z.H.prototype.dz;Z.H.prototype.jb=function(a){var b=this.b;null!=a||(a={label:b.text.Loader.Tab,elements:[]});b.$applyAsync(function(){b.tabs.list.push(a)})};Z.H.prototype.addTab=Z.H.prototype.jb;
Z.H.prototype.LF=function(a){var b=this;bootbox.confirm("<h4>"+this.b.text.Loader.AskRemoveTab+"</h4><br>"+a.label,function(c){c&&b.Hr(a)})};Z.H.prototype.askAndRemoveTab=Z.H.prototype.LF;Z.H.prototype.Hr=function(a){var b=this.b;-1!==b.tabs.list.indexOf(a)?b.$applyAsync(function(){b.tabs.list.splice(b.tabs.list.indexOf(a),1)}):console.error("Tab not founted in scope.tabs.list")};Z.H.prototype.removeTab=Z.H.prototype.Hr;
Z.H.prototype.ZK=function(a,b){var c=this.b,d=0;-1!==c.tabs.list.indexOf(a)?c.$applyAsync(function(){var e=c.tabs.list.indexOf(a);"left"===b&&(d=-1);"right"===b&&(d=1);0<=e+d&&e+d<c.tabs.list.length&&(c.tabs.list.splice(e,1),c.tabs.list.splice(e+d,0,a))}):console.error("Tab not founted in scope.tabs.list")};Z.H.prototype.moveTab=Z.H.prototype.ZK;Z.H.prototype.$M=function(a){var b=this.b;a.elements=[];for(var c=0;c<b.elems.length;c++)a.elements.push(b.elems[c])};Z.H.prototype.selectAllElems=Z.H.prototype.$M;
Z.H.prototype.XM=function(a){var b=this.b,c=b.selected_form_type;$("#studio-tabsmanager-modal").modal("hide");a=Z.bG(a);b.jsonOutput[c].tabs=a;Z.ea();b.$broadcast("updateForm",b.jsonOutput)};Z.H.prototype.saveTabs=Z.H.prototype.XM;function cB(a){a=a.b;var b=Z.sA(a.jsonOutput),c=a.selected_form_type;null!=b&&null!=b[c]&&null!=b[c].tabs&&(b[c].tabs=angular.copy(a.tabs),a.$broadcast("updateTestTabForm",b))}
Z.H.prototype.JN=function(){Z.log("studioMainController.showWabManagerModal");var a=this.b,b=a.selected_form_type,c=Z.iA(a.jsonOutput[b]);Z.hf();a.jsonOutput=Z.ea();null!=a.jsonOutput[b].wab&&(a.wab=angular.copy(a.jsonOutput[b].wab));a.elems=c.elems;a.buttons=c.buttons;a.wab=Z.$F(a.wab,a.elems,a.wabStates,a.wabGroups);$("#studio-wabmanager-modal").modal("show")};Z.H.prototype.showWabManagerModal=Z.H.prototype.JN;
Z.H.prototype.rO=function(a,b,c,d){if(null!=b&&null!=b[c]){var e;if(null!=b[c][a]){e=f;var f=b[c][a];"r"===d&&(e=""===f?"r":"");"rw"===d&&(e=""===f?"rw":"r"===f?"rw":"r");b[c][a]=e}else b[c][a]=d;dB(this)}};Z.H.prototype.toggleElemOnWab=Z.H.prototype.rO;
Z.H.prototype.YM=function(a){var b=this.b,c=b.selected_form_type,d={};$("#studio-wabmanager-modal").modal("hide");for(var e in a){d[e]={};for(var f in a[e])"name"!==f&&(d[e][f]=a[e][f])}console.log(d);b.jsonOutput[c].wab=d;Z.ic(b.jsonOutput);b.$broadcast("updateForm",b.jsonOutput)};Z.H.prototype.saveWab=Z.H.prototype.YM;function dB(a){a=a.b;var b=Z.sA(a.jsonOutput),c=a.selected_form_type;null!=b&&null!=b[c]&&(b[c].wab=angular.copy(a.wab),a.$broadcast("updateTestWabForm",b))}
Z.H.prototype.CN=function(){Z.wc=!0;Z.log("studioMainController.showDatasourcesModal");var a=this.b;a.jsonOutput=Z.ea();n(a.jsonOutput.datasources)&&ha(a.jsonOutput.datasources)&&!q(a.jsonOutput.datasources)||(a.jsonOutput.datasources={});a.datasources=a.jsonOutput.datasources;Z.hf();$("#studio-datasource-modal").modal("show");a.selectedDatasource={};this.th();angular.element(v.f).injector().get(["$timeout"])(function(){0<a.datasourcesGridApi.grid.rows.length&&0===a.datasourcesGridApi.selection.getSelectedRows().length&&
a.datasourcesGridApi.selection.selectRow(a.studioDatasourcesGridOptions.data[0])},1)};Z.H.prototype.showDatasourcesModal=Z.H.prototype.CN;Z.H.prototype.fM=function(a){var b=this;this.Xu++;var c=angular.copy(this.Xu);setTimeout(function(){c===b.Xu&&b.lD(a)},1500)};Z.H.prototype.preventLocalDatabaseChanged=Z.H.prototype.fM;
Z.H.prototype.rN=function(){Z.log("studioMainController.setLocalDatabases");var a=this.b,b=this;A({method:"GET",url:Z.da.web_server_name+"/"+Z.da.services_alias+"/vitis/genericquerys/databases",headers:{Accept:"application/x-vm-json"},scope:this.b,success:function(c){null!=c.data.data?a.databases=c.data.data:($.notify(b.text.Element.Component.Select.Database_List_Error,"error"),a.databases=[])}})};Z.H.prototype.setLocalDatabases=Z.H.prototype.rN;
Z.H.prototype.lD=function(a){Z.log("studioMainController.setLocalDatabaseSchemas");var b=this.b,c=this;null!=a||(a=Z.da.database);A({method:"GET",url:Z.da.web_server_name+"/"+Z.da.services_alias+"/vitis/genericquerys/"+a+"/schemas",headers:{Accept:"application/x-vm-json"},scope:this.b,success:function(a){null!=a.data.data?b.schemas=a.data.data:($.notify(c.text.Element.Component.Select.Schema_List_error,"error"),b.schemas=[])}})};Z.H.prototype.setLocalDatabaseSchemas=Z.H.prototype.lD;
Z.H.prototype.HC=function(a,b){Z.log("studioMainController.reloadTablesList");var c=this.b,d=this;A({method:"GET",url:Z.da.web_server_name+"/"+Z.da.services_alias+"/vitis/genericquerys",headers:{Accept:"application/x-vm-json"},params:{database:b,schema:a},scope:this.b,success:function(a){null!=a.data.data?c.tables=a.data.data:($.notify(d.text.Element.Component.Select.Table_List_error,"error"),c.tables=[])}})};Z.H.prototype.reloadTablesList=Z.H.prototype.HC;
Z.H.prototype.FN=function(){Z.log("studioMainController.showNewSourceModal");for(var a=this.b,b="datasource_1",c=1;n(a.datasources[b]);)b="datasource_"+c,c++;a.newSource={id:b,name:b,description:"",parameters:{},options:["Value one|1","Value two|2","Value three|3"],options_model:"Value one|1\nValue two|2\nValue three|3",result_options:[{label:"Value one",value:"1"},{label:"Value two",value:"2"},{label:"Value three",value:"3"}]};a.newSource=this.mv(a.newSource);a.aExternalDatabaseTables.length=0;a.schemas.length=
0;a.tables.length=0;$("#studio-datasource-add-modal").modal("show");a.aExternalDatabaseTablesSelected={};a.databaseSelected={};a.schemaSelected={};a.tableSelected={};$("#typeSourceTooltip").popover({trigger:"hover",container:"body",content:function(){return a.text.Element.Component.Select.TypeSourceContent},placement:function(b,c){return a.$root.workspaceTooltipPlacement(c)}})};Z.H.prototype.showNewSourceModal=Z.H.prototype.FN;
Z.H.prototype.DN=function(){Z.log("studioMainController.showEditSourceModal");var a=this.b;if(0<a.datasourcesGridApi.selection.getSelectedRows().length){if(0===Object.keys(a.selectedDatasource).length)return 0;a.editedDatasource=angular.copy(a.selectedDatasource);a.editedDatasource=this.mv(a.editedDatasource);a.schemas.length=0;a.tables.length=0;"web_service"===a.editedDatasource.type&&null!=a.editedDatasource.webservice&&null!=a.editedDatasource.webservice.name&&this.kE(a.editedDatasource.webservice);
$("#studio-datasource-edit-modal").modal("show");var b=angular.element(v.f).injector().get(["$timeout"]);b(function(){a.refresh=!0;b(function(){a.refresh=!1},100)},500);0==a.databases.length&&(a.databaseSelected=a.editedDatasource.parameters.database,this.setLocalDatabases(a.editedDatasource.parameters.database));for(var c=0;c<a.databases.length;c++)a.databases[c].database===a.editedDatasource.parameters.database&&(a.databaseSelected=a.databases[c]);for(c=0;c<a.schemas.length;c++)a.schemas[c].schema_name===
a.editedDatasource.parameters.schema&&(a.schemaSelected=a.schemas[c],this.HC(a.editedDatasource.parameters.schema));b(function(){for(var b=0;b<a.tables.length;b++)a.tables[b].table_name===a.editedDatasource.parameters.table&&(a.tableSelected=a.tables[b])},500)}else bootbox.alert(this.text.Element.Component.Select.Datasource_NothingSelected)};Z.H.prototype.showEditSourceModal=Z.H.prototype.DN;
Z.H.prototype.QA=function(a){Z.log("studioMainController.isEmptyFilter");if(null==a)return!0;if(r(a)){if(0===a.length)return!0}else if(ha(a)&&q(a.operators)){if(1<a.operators.length)return!1;if(0===a.operators.length||""===a.operators[0].column&&""===a.operators[0].value)return!0}return!1};Z.H.prototype.isEmptyFilter=Z.H.prototype.QA;
Z.H.prototype.mv=function(a){Z.log("studioMainController.loadDatasourceDefaultValues");null!=a.parameters||(a.parameters={});if(this.QA(a.parameters.filter)||!ha(a.parameters.filter))a.parameters.filter={relation:"AND",operators:[]};this.pp();return a};Z.H.prototype.loadDatasourceDefaultValues=Z.H.prototype.mv;
Z.H.prototype.kF=function(a){Z.log("studioMainController.addSource");var b=this.b;if("text"===a.dataType){b.refresh=!1;if(!n(a.id))return console.error("newSource.id not defined"),0;if(!n(a.name))return console.error("newSource.name not defined"),0;n(a.options)||(console.error("newSource.options not defined"),a.options=[]);if(n(b.datasources[a.id]))return bootbox.alert(this.text.Element.Component.Select.Datasource_Exists),0;a={id:a.id,type:"object",dataType:a.dataType,name:a.name,description:a.description,
options:a.options};$("#studio-datasource-add-modal").modal("hide");this.Kl(a);this.th()}else if("externalDatabase"===a.dataType){if(!n(a.id))return console.error("newSource.id not defined"),0;if(!n(a.name))return console.error("newSource.name not defined"),0;if(!n(a.parameters.server))return console.error("newSource.parameters.server not defined"),0;if(!n(a.parameters.port))return console.error("newSource.parameters.port not defined"),0;if(!n(a.parameters.sgbd))return console.error("newSource.parameters.sgbd not defined"),
0;if(!n(a.parameters.login))return console.error("newSource.parameters.login not defined"),0;if(!n(a.parameters.password))return console.error("newSource.parameters.password not defined"),0;if(!n(a.parameters.database))return console.error("newSource.parameters.database not defined"),0;if(!n(a.parameters.schema))return console.error("newSource.parameters.schema not defined"),0;if(!n(a.parameters.table))return console.error("newSource.parameters.table not defined"),0;if(n(b.datasources[a.id]))return bootbox.alert(this.text.Element.Component.Select.Datasource_Exists),
0;a={id:a.id,type:"web_service",dataType:a.dataType,name:a.name,description:a.description,parameters:a.parameters,ressource_id:"vitis/genericquerys/"+a.parameters.table};$("#studio-datasource-add-modal").modal("hide");this.Kl(a);this.th()}else if("tableValue"===a.dataType){if(null!=a.parameters)var c=angular.copy(a.parameters);if(!n(a.id))return console.error("newSource.id not defined"),0;if(!n(a.name))return console.error("newSource.name not defined"),0;if(!n(a.parameters.schema))return console.error("newSource.parameters.schema not defined"),
0;if(!n(a.parameters.table))return console.error("newSource.parameters.table not defined"),0;if(n(b.datasources[a.id]))return bootbox.alert(this.text.Element.Component.Select.Datasource_Exists),0;if(n(c.filter.operators))for(b=0;b<c.filter.operators.length;b++)""!=c.filter.operators[b].hG&&""!=c.filter.operators[b].gG&&""!=c.filter.operators[b].value||c.filter.operators.splice(b,1);a={id:a.id,type:"web_service",dataType:a.dataType,name:a.name,description:a.description,parameters:c,ressource_id:"vitis/genericquerys"};
$("#studio-datasource-add-modal").modal("hide");this.Kl(a);this.th()}else if("webService"===a.dataType){if(!n(a.id))return console.error("newSource.id not defined"),0;if(!n(a.name))return console.error("newSource.name not defined"),0;if(!n(a.webservice))return bootbox.alert(this.text.Element.Component.Select.WebService_undefined),console.error("newSource.webservice not defined"),0;if(!n(a.ressource))return bootbox.alert(this.text.Element.Component.Select.Ressource_undefined),console.error("newSource.ressource not defined"),
0;if(n(b.datasources[a.id]))return bootbox.alert(this.text.Element.Component.Select.Datasource_Exists),0;a={id:a.id,type:"web_service",dataType:a.dataType,name:a.name,description:a.description,webservice:a.webservice,ressource:a.ressource,ressource_id:a.webservice.name+"/"+a.ressource.name};$("#studio-datasource-add-modal").modal("hide");this.Kl(a);this.th()}else if("businessObject"===a.dataType){if(!n(a.id))return console.error("newSource.id not defined"),0;if(!n(a.name))return console.error("newSource.name not defined"),
0;if(!n(a.businessObject.business_object_id))return bootbox.alert(this.text.Element.Component.Select.BusinessObject_undefined),console.error("newSource.businessObject not defined"),0;if(n(b.datasources[a.id]))return bootbox.alert(this.text.Element.Component.Select.Datasource_Exists),0;a={id:a.id,type:"web_service",dataType:a.dataType,name:a.name,description:a.description,businessObject:a.businessObject,businessObjectRequest:a.businessObjectRequest,subObject:"bo_"+a.businessObjectRequest,ressource_id:"vmap/querys/"+
a.businessObject.business_object_id+"/"+a.businessObjectRequest};$("#studio-datasource-add-modal").modal("hide");this.Kl(a);this.th()}};Z.H.prototype.addSource=Z.H.prototype.kF;
Z.H.prototype.FM=function(){Z.log("studioMainController.removeSelectedSource");var a=this,b=this.b,c=b.selectedDatasource.id,d=[];if(null==c)return 0;for(var e in b.jsonOutput)if("datasources"!==e){var f=b.jsonOutput[e];if(null!=f.rows&&q(f.rows))for(var g=0;g<f.rows.length;g++)if(null!=f.rows[g].fields)for(var h=0;h<f.rows[g].fields.length;h++)null!=f.rows[g].fields[h].datasource&&f.rows[g].fields[h].datasource.datasource_id===c&&d.push({label:f.rows[g].fields[h].label,name:f.rows[g].fields[h].name,
aQ:e})}c=this.text.Element.Component.Select.Datasource_Delete;if(0<d.length){c=this.text.Element.Component.Select.Datasource_Delete_Used;c+="<br><br><ul>";for(g=0;g<d.length;g++)c+="<li>"+d[g].formName+": "+d[g].label+" ("+d[g].name+")</li>";c=c+"</ul><br>"+this.text.Element.Component.Select.Datasource_Delete}bootbox.confirm(c,function(c){!0===c&&(delete b.datasources[b.selectedDatasource.id],b.selectedDatasource={},setTimeout(function(){a.th()},500),Z.ic(b.jsonOutput))})};
Z.H.prototype.removeSelectedSource=Z.H.prototype.FM;
Z.H.prototype.Kl=function(a){Z.log("studioMainController.saveDatasource");var b=this.b;"object"===a.type?b.datasources[a.id]={type:a.type,dataType:a.dataType,name:a.name,description:a.description,options:a.options}:"web_service"===a.type&&(b.datasources[a.id]={type:a.type,dataType:a.dataType,name:a.name,description:a.description,parameters:a.parameters,ressource_id:a.ressource_id},null!=a.webservice&&(b.datasources[a.id].webservice=a.webservice),null!=a.ressource&&(b.datasources[a.id].ressource=a.ressource),
null!=a.businessObject&&(b.datasources[a.id].businessObject=a.businessObject),null!=a.subObject&&(b.datasources[a.id].subObject=a.subObject),null!=a.businessObjectRequest&&(b.datasources[a.id].businessObjectRequest=a.businessObjectRequest,b.datasources[a.id].subObject="bo_"+a.businessObjectRequest,b.datasources[a.id].ressource_id="vmap/querys/"+a.businessObject.business_object_id+"/"+a.businessObjectRequest));"externalDatabase"===a.dataType&&(b.datasources[a.id].ressource_id="vitis/genericquerys/"+
a.parameters.table);Z.ic(b.jsonOutput);this.th();$.notify(this.text.Element.Component.Select.Saved,{className:"success",autoHideDelay:Z.Gb});$("#studio-datasource-edit-modal").modal("hide");b.refresh=!1};Z.H.prototype.saveDatasource=Z.H.prototype.Kl;
Z.H.prototype.th=function(){Z.log("studioMainController.setStudioGridDatasources");var a=this.b;Pa(a.studioDatasourcesGridOptions.data);var b=angular.copy(a.datasources),c;for(c in a.datasources)b[c].id=c,a.studioDatasourcesGridOptions.data.push(b[c]);a.datasourcesGridApi.grid.refresh();ib(a.selectedDatasource)};Z.H.prototype.setStudioGridDatasources=Z.H.prototype.th;
Z.H.prototype.hD=function(a){Z.log("studioMainController.setDatasourceContent");if("object"===a.type){a.options_model="";a.result_options=[];if(q(a.options))for(var b=0;b<a.options.length;b++)0<b&&(a.options_model+="\n"),a.options_model+=a.options[b];this.iE(a)}};Z.H.prototype.setDatasourceContent=Z.H.prototype.hD;
Z.H.prototype.iE=function(a){Z.log("studioMainController.updateDatasourceTextContent");a.options=a.options_model.split("\n");Pa(a.result_options);for(var b,c=[],d=[],e=0;e<a.options.length;e++)b=a.options[e].split("|"),c.push(b[0]),d.push(b[1]);b=Object.keys(c);for(e=0;e<b.length;e++)a.result_options.push({label:c[b[e]],value:d[e]})};Z.H.prototype.updateDatasourceTextContent=Z.H.prototype.iE;
Z.H.prototype.kE=function(a){Z.log("studioMainController.updateRessources");var b=this.b;A({method:"GET",url:Z.da.web_server_name+"/"+Z.da.services_alias+"/vitis/webservices/"+a.name+"/ressources",headers:{Accept:"application/x-vm-json"},params:{attributs:"name"},scope:this.b,success:function(a){null!=a.data.data?b.ressources=a.data.data:console.error("response.data['data'] not defined")}})};Z.H.prototype.updateRessources=Z.H.prototype.kE;
Z.H.prototype.RD=function(a,b){Z.log("studioMainController.testTableValues");var c=this.b;if(null!=a.parameters)var d=angular.copy(a.parameters);if(null!=d.filter.operators)for(a=0;a<d.filter.operators.length;a++)""!=d.filter.operators[a].hG&&""!=d.filter.operators[a].gG&&""!=d.filter.operators[a].value||d.filter.operators.splice(a,1);null!=d.filter.operators&&0===d.filter.operators.length&&(delete d.filter.GL,delete d.filter.yQ,delete d.filter);a=Z.da.web_server_name+"/"+Z.da.services_alias+"/vitis/genericquerys";
var e={limit:10};null!=d&&mb(e,d);"studio-datasource-add-modal"===b?this.wh(a,e,c.studioAddModalTestGridOptions,c.oo):"studio-datasource-edit-modal"===b&&this.wh(a,e,c.studioEditModalTestGridOptions,c.po)};Z.H.prototype.testTableValues=Z.H.prototype.RD;
Z.H.prototype.QD=function(a,b){Z.log("studioMainController.testExternalDatabaseValues");var c=this.b;if(null==a.parameters.server)return bootbox.alert("server "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.port)return bootbox.alert("Port "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.sgbd)return bootbox.alert("SGBD "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.login)return bootbox.alert("Login "+this.text.Element.Component.Select.Undefined),
0;if(null==a.parameters.password)return bootbox.alert("Password "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.database)return bootbox.alert("Database "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.schema)return bootbox.alert("Schema "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.table)return bootbox.alert("Table "+this.text.Element.Component.Select.Undefined),0;var d=Z.da.web_server_name+"/"+Z.da.services_alias+"/vitis/genericquerys/"+
a.parameters.table;a={limit:10,login:a.parameters.login,password:a.parameters.password,server:a.parameters.server,port:a.parameters.port,sgbd:a.parameters.sgbd,database:a.parameters.database,schema:a.parameters.schema,filter:a.parameters.filter};"studio-datasource-add-modal"===b?this.wh(d,a,c.studioAddModalTestGridOptions,c.oo):"studio-datasource-edit-modal"===b&&this.wh(d,a,c.studioEditModalTestGridOptions,c.po)};Z.H.prototype.testExternalDatabaseValues=Z.H.prototype.QD;
Z.H.prototype.eO=function(a,b){"externalDatabase"===a.dataType?this.QD(a,b):"tableValue"===a.dataType?this.RD(a,b):"webService"===a.dataType?this.SD(a,b):"businessObject"===a.dataType&&this.PD(a,b)};Z.H.prototype.testDatasource=Z.H.prototype.eO;
Z.H.prototype.SD=function(a,b){Z.log("studioMainController.testWebService");var c=this.b;n(a.webservice)||bootbox.alert(this.text.Element.Component.Select.WebServiceUndefined);n(a.ressource)||bootbox.alert(this.text.Element.Component.Select.RessourceUndefined);a=Z.da.web_server_name+"/"+Z.da.services_alias+"/"+a.webservice.name+"/"+a.ressource.name;var d={limit:10};"studio-datasource-add-modal"===b?this.wh(a,d,c.studioAddModalTestGridOptions,c.oo):"studio-datasource-edit-modal"===b&&this.wh(a,d,c.studioEditModalTestGridOptions,
c.po)};Z.H.prototype.testWebService=Z.H.prototype.SD;
Z.H.prototype.PD=function(a,b){Z.log("studioMainController.testBusinessObject");var c=this.b;n(a.businessObject)||bootbox.alert(this.text.Element.Component.Select.BusinessObject_undefined);n(a.businessObjectRequest)||bootbox.alert(this.text.Element.Component.Select.BusinessObject_Request_undefined);var d=Z.da.web_server_name+"/"+Z.da.services_alias+"/vmap/querys/"+a.businessObject.business_object_id+"/"+a.businessObjectRequest,e={limit:10};null!=a.parameters&&mb(e,a.parameters);"studio-datasource-add-modal"===
b?this.wh(d,e,c.studioAddModalTestGridOptions,c.oo,"bo_"+a.businessObjectRequest):"studio-datasource-edit-modal"===b&&this.wh(d,e,c.studioEditModalTestGridOptions,c.po,"bo_"+a.businessObjectRequest)};Z.H.prototype.testBusinessObject=Z.H.prototype.PD;
Z.H.prototype.wh=function(a,b,c,d,e){Z.log("studioMainController.testRequestAPI");var f=this;if(!n(a))return console.error("url not defined"),0;if(!n(b))return console.error("params not defined"),0;A({method:"GET",url:a,headers:{Accept:"application/x-vm-json"},params:b,scope:this.b,success:function(a){if(!n(a.data.data))return bootbox.alert(f.text.Element.Component.Select.NoDataReturned),0;var b;if(null!=e){b=[];for(var g=0;g<a.data.data.length;g++)b.push(a.data.data[g][e])}else b=a.data.data;a=Object.keys(b[0]);
for(var m=[],g=0;g<a.length;g++)m.push({name:a[g],displayName:a[g],width:100});c.data=b;c.columnDefs=m;d.grid.refresh()}})};Z.H.prototype.testRequestAPI=Z.H.prototype.wh;Z.H.prototype.Wy=function(){Z.log("studioMainController.clearDatasourcesGrid");var a=this.b;a.studioDatasourcesGridOptions.data=[];a.datasourcesGridApi.grid.refresh()};Z.H.prototype.clearDatasourcesGrid=Z.H.prototype.Wy;
Z.H.prototype.pp=function(){Z.log("studioMainController.clearTestGrids");var a=this.b;a.studioAddModalTestGridOptions.data=[];a.studioAddModalTestGridOptions.columnDefs=[];a.oo.grid.refresh();a.studioEditModalTestGridOptions.data=[];a.studioEditModalTestGridOptions.columnDefs=[];a.po.grid.refresh()};Z.H.prototype.clearTestGrids=Z.H.prototype.pp;
Z.H.prototype.KH=function(a){Z.log("studioMainController.getExternalDatabaseTables");var b=this,c=this.b;if(null==a.parameters.server)return bootbox.alert("Server "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.port)return bootbox.alert("Port "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.sgbd)return bootbox.alert("SGBD "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.login)return bootbox.alert("Login "+this.text.Element.Component.Select.Undefined),
0;if(null==a.parameters.password)return bootbox.alert("Password "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.database)return bootbox.alert("Database "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.schema)return bootbox.alert("Schema "+this.text.Element.Component.Select.Undefined),0;var d=Z.da.web_server_name+"/"+Z.da.services_alias+"/vitis/genericquerys";a={login:a.parameters.login,password:a.parameters.password,server:a.parameters.server,port:a.parameters.port,
sgbd:a.parameters.sgbd,database:a.parameters.database,schema:a.parameters.schema,order_by:"table_name"};if(null==d)return console.error("url undefined"),0;if(null==a)return console.error("params undefined"),0;A({method:"GET",url:d,headers:{Accept:"application/x-vm-json"},params:a,scope:this.b,timeout:5E3,success:function(a){if(!n(a.data.data))return bootbox.alert(b.text.Element.Component.Select.NoDataReturned),0;q(c.aExternalDatabaseTables)?c.aExternalDatabaseTables.length=0:c.aExternalDatabaseTables=
[];for(var d=0;d<a.data.data.length;d++)c.aExternalDatabaseTables.push(a.data.data[d].table_name)}})};Z.H.prototype.getExternalDatabaseTables=Z.H.prototype.KH;
Z.H.prototype.gF=function(a){Z.log("studioMainController.addNewFilterOperator");n(a.parameters.filter)?n(a.parameters.filter.operators)?0<a.parameters.filter.operators.length?a.parameters.filter.operators.push({column:"",compare_operator:"=",value:""}):0===a.parameters.filter.operators.length&&(delete a.parameters.filter.GL,a.parameters.filter.operators=[{column:"",compare_operator:"=",value:""}]):a.parameters.filter.operators=[{column:"",compare_operator:"=",value:""}]:a.parameters.filter={relation:"AND",
operators:[{column:"",compare_operator:"=",value:""}]}};Z.H.prototype.addNewFilterOperator=Z.H.prototype.gF;Z.H.prototype.CM=function(a,b){Z.log("studioMainController.removeFilterOperator");if(null==b||null==a||null==a.parameters||null==a.parameters.filter||!q(a.parameters.filter.operators))return!1;b=a.parameters.filter.operators.indexOf(b);-1!==b&&a.parameters.filter.operators.splice(b,1)};Z.H.prototype.removeFilterOperator=Z.H.prototype.CM;Z.Bh=wA;"dev"===oProperties.mode&&(Z.Bh.NP=!0);Z.log=Z.Bh.log;
Z.hf=Z.Bh.hf;Z.reloadForm=Z.Bh.reloadForm;Z.removeWebServiceFromFields=Z.Bh.removeWebServiceFromFields;Z.kk=Z.Bh.kk;Z.Ws=Z.Bh.Ws;Z.clone=Z.Bh.clone;Z.wc=!1;Z.nL={};Z.WB={};Z.AL={};Z.VB={};Z.UB={};Z.sQ={};Z.dC={};Z.XB={empty:!0};Z.kr={};Z.UC="";Z.SC="";Z.Gb=oProperties.timeNotify;Z.Eh=[!1,!1,!1,!1,!1];Z.valid=!0;Z.mk=[];Z.XD="";Z.zx="";Z.id=0;Z.fH=null;Z.da=null;Z.bE="no tree";Z.WB=new xA;Z.VB=new CA;Z.UB=new NA;Z.dC=new MA;var fB={css:"css/lib/bootstrap/css/bootstrap.min.css css/lib/jquery/plugins/bootstrap-datepicker/bootstrap-datepicker3.min.css css/lib/jquery/plugins/bootstrap-fileinput/css/fileinput.min.css css/lib/ui-grid/ui-grid.min.css css/lib/jquery/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css css/lib/bootstrap-checkbox/build.css css/lib/bootstrap-checkbox/font-awesome.css css/lib/jquery/plugins/bootstrap-slider/bootstrap-slider.min.css css/lib/jquery/plugins/malihu-custom-scrollbar/jquery.mCustomScrollbar.min.css css/lib/ui-grid/plugins/draggable-rows.less less/main.less modules/vitis/less/main.less javascript/externs/studio/less/studio.less modules/vmap/css/lib/bootstrap-toggle/bootstrap-toggle.css modules/vmap/css/lib/colorpicker/css/bootstrap-colorpicker.css modules/vmap/css/lib/bootstrap-table/bootstrap-table.min.css modules/vmap/css/lib/jquery-sortable/jquery-sortable.css modules/vmap/css/ol.css modules/vmap/css/vmap.less modules/vm4ms/less/main.less css/lib/codemirror/codemirror.css css/lib/codemirror/codemirror_foldgutter.css css/lib/codemirror/map.css css/lib/codemirror/show-hint.css javascript/externs/studio/less/CodeMirror.less css/lib/jquery/plugins/bootstrap-treeview/bootstrap-treeview.min.css css/lib/jquery/plugins/bootstrap-tagsinput/bootstrap-tagsinput.css css/lib/jquery/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css css/lib/viewer/viewer.min.css".split(" "),
css_mobile:["less/mobile.less","modules/vmap/css/mobile.less"],js:{externs:"modules/vmap/javascript/externs/bootstrap-toggle/bootstrap-toggle.min.js modules/vmap/javascript/externs/bootstrap-table/bootstrap-table.js modules/vmap/javascript/externs/bootstrap-table/bootstrap-table-export.js modules/vmap/javascript/externs/bootstrap-table/tableExport.js modules/vmap/javascript/externs/jquery-sortable/jquery-sortable.js modules/vmap/javascript/externs/html2canvas/html2canvas.js modules/vmap/javascript/externs/jspdf/jspdf.debug.js javascript/externs/bootbox/bootbox.min.js javascript/externs/codemirror/codemirror.min.js javascript/externs/codemirror/htmlmixed.js javascript/externs/codemirror/css.js javascript/externs/codemirror/javascript.js javascript/externs/codemirror/clike.js javascript/externs/codemirror/php.js javascript/externs/codemirror/xml.js javascript/externs/codemirror/sql.js javascript/externs/codemirror/map.js javascript/externs/codemirror/show-hint.js javascript/externs/codemirror/addon/fold/foldcode.js javascript/externs/codemirror/addon/fold/foldgutter.js javascript/externs/codemirror/addon/fold/brace-fold.js javascript/externs/codemirror/addon/fold/xml-fold.js javascript/externs/angular/modules/ui-codemirror/ui-codemirror.min.js javascript/externs/tinymce/tinymce.min.js javascript/externs/angular/modules/ui-tinymce/tinymce.js javascript/externs/jquery/plugins/bootstrap-treeview/bootstrap-treeview.js javascript/externs/jquery/plugins/bootstrap-tagsinput/bootstrap-tagsinput.min.js javascript/externs/scripts_cryptage.js javascript/externs/moment/moment.min.js javascript/externs/moment/min/moment-with-locales.min.js javascript/externs/jquery/plugins/notify/notify.js javascript/externs/jquery/plugins/bootstrap-colorpicker/bootstrap-colorpicker.min.js javascript/externs/jquery/plugins/bootstrap-confirmation/bootstrap-confirmation.min.js javascript/externs/jquery/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js javascript/externs/viewer/viewer.min.js javascript/externs/alasql/alasql.min.js javascript/externs/alasql/xlsx.core.min.js".split(" ")},
vitisModuleDependencies:"vmap ui.codemirror ui.tinymce vfb ui.grid.draggable-rows ui.grid.exporter".split(" ")};sessionStorage.loading_counter=0;ed();dd(fB.css);null!=fB.css_mobile&&oClientProperties.is_mobile&&dd(fB.css_mobile);ad(fB.js.externs,{async:!1,scriptInBody:!0,callback:function(){if("true"==sessionStorage.debug)var a=setInterval(function(){"undefined"!=typeof v.$o&&"undefined"!=typeof v.st&&(clearInterval(a),angular.bootstrap(document,["vitisApp"]))},100);else angular.bootstrap(document,["vitisApp"])}});$(document).keydown(function(a){27===a.keyCode&&fd()});function gB(a,b,c){return{token:"",validity_date:"",duration:600,web_service:"vitis",web_service_controller:"privatetoken",application_modules:[],connect:function(){a.defaults.headers.common.token=this.token;c.sMainTemplateUrl="templates/mainTpl.html"},disconnect:function(){document.cookie.split(";").forEach(function(a){a=a.split("=");a[1]==sessionStorage.getItem("session_token")&&(document.cookie=a[0]+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;")});this.clearSessionStorage();var a=Object.keys(oUrlParams);
if(-1!==a.indexOf("login")&&-1!==a.indexOf("password")){delete oUrlParams.login;delete oUrlParams.password;var a=Object.keys(oUrlParams),c=[],f;a.forEach(function(a){f=a;"undefined"!=typeof oUrlParams[a]&&(f+=oUrlParams[a]);c.push(f)});b.location.search="?"+c.join("&")}else b.location.reload()},clearSessionStorage:function(){for(var a=["session_token","user_login","user_id","stats_per_date"],b=0;b<a.length;)sessionStorage.removeItem(a[b]),this.removeAppLocalStorageItem(a[b]),b++},saveSessionToLocalStorage:function(){for(var a=
["session_token","user_login","user_id"],b=0;b<a.length;)this.setAppLocalStorageItem(a[b],sessionStorage[a[b]]),b++},restoreSessionFromAppLocalStorage:function(){for(var a=["session_token","user_login","user_id"],b=0;b<a.length;)sessionStorage[a[b]]=this.getAppLocalStorageItem(a[b]),b++},getAppLocalStorageItem:function(a){return localStorage.getItem(sessionStorage.appEnv+"_"+a)},setAppLocalStorageItem:function(a,b){localStorage.setItem(sessionStorage.appEnv+"_"+a,b)},removeAppLocalStorageItem:function(a){localStorage.removeItem(sessionStorage.appEnv+
"_"+a)}}}gB.$inject=["$http","$window","envSrvc"];
function hB(a,b,c,d,e,f,g){return{sMode:"search",oSelectedMode:"",oSelectedObject:"",oSectionForm:{},sSelectedTemplate:"",sMainTemplateUrl:"",sId:"",sIdField:"",sLastSelectedMode:"",oLastSelectedObjectMode:{},oFormDefinition:{},sFormDefinitionName:"",oFormValues:{},oFormDefaultValues:{},oGridOptions:{},oGridOptionsCopy:{},oDefaultGridOptions:{},sTemplateFolder:"templates/",oWorkspaceList:{},oWorkspaceListRefreshTimer:{},sSelectedSectionName:"",sLoginTemplate:"templates/loginTpl.html",sLoginForm:"forms/login.json",
sForgottenPasswordForm:"forms/forgotten_password.json",sSignUpForm:"forms/sign_up.json",setMode:function(a,c){var d=this,e=b.get(["formSrvc"]).checkFormModifications(this.sFormDefinitionName);e.then(function(){d.sMode=a;if("insert"==a)d.sId="";else if("search"==a&&"undefined"!=typeof d.oSectionForm){var b=d.oSectionForm[d.oSelectedObject.name];"undefined"!=typeof b&&(b.iSelectedSectionIndex=0)}d.loadObjectTemplate({bForceTemplateCompilation:!0,sUrlTemplate:c})});return e},loadObjectTemplate:function(b){var c=
!0;this.oSelectedMode.reload||"undefined"==typeof this.oLastSelectedObjectMode[this.oSelectedMode.mode_id]||(c=!1);this.oLastSelectedObjectMode[this.oSelectedMode.mode_id]=this.oSelectedObject;this.oLastSelectedObjectMode[this.oSelectedMode.mode_id].lastMode=this.sMode;this.setFormDefinitionName();var d=this;c||b.bForceTemplateCompilation?"undefined"!=typeof b.sUrlTemplate?a.compileObjectTemplate(b.sUrlTemplate):("undefined"!=typeof this.oSelectedObject.event&&(a.$eval(this.oSelectedObject.event),
this.setFormDefinitionName(),!0===b.bFirstModeObject&&(this.oLastSelectedObjectMode[this.oSelectedMode.mode_id]=this.oSelectedObject,this.oLastSelectedObjectMode[this.oSelectedMode.mode_id].lastMode=this.sMode)),"undefined"==typeof d.oSelectedObject.sections?A({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/vitis/VitisSections",params:{order_by:"index",filter:{relation:"AND",operators:[{column:"tab_id",compare_operator:"=",value:this.oSelectedObject.tab_id},{column:"lang",compare_operator:"=",
value:f.language},{column:"module_name",compare_operator:"IN",value:sessionStorage.application_modules.split(",")}]}},scope:a,success:function(b){1==b.data.status&&(d.oSelectedObject.sections=b.data.vitissections,d.sSelectedTemplate=b.data.vitissections[0].template,b="search"!=d.sMode&&1<b.data.vitissections.length?d.sTemplateFolder+"sectionFormTpl.html":-1!=d.sSelectedTemplate.indexOf("/")?d.sSelectedTemplate:d.sTemplateFolder+d.sSelectedTemplate,d.setFormDefinitionName(),a.compileObjectTemplate(b),
a.$broadcast(a.sSelectedObjectName+"_form",{}))}}):(d.sSelectedTemplate=this.oSelectedObject.sections[0].template,a.compileObjectTemplate("search"!=d.sMode&&1<d.oSelectedObject.sections.length?d.sTemplateFolder+"sectionFormTpl.html":-1!=d.sSelectedTemplate.indexOf("/")?d.sSelectedTemplate:d.sTemplateFolder+d.sSelectedTemplate))):($("#data_column .container-mode").hide(),$("#container_mode_"+this.oSelectedMode.mode_id).show())},extractWebServiceData:function(a,b){var c=[];"undefined"!=typeof b[a]&&
(Array.isArray(b[a])?0<b[a].length&&(c=b[a]):c=b[a]);return c},addSectionForm:function(){this.setSectionForm("insert")},addDoubleForm:function(){this.sSelectedTemplate="doubleFormTpl.html";this.sId="";this.setMode("insert",this.sTemplateFolder+this.sSelectedTemplate)},setSectionForm:function(a,b){var c;this.sSelectedTemplate="simpleFormTpl.html";c=1<this.oSelectedObject.sections.length?"sectionFormTpl.html":"simpleFormTpl.html";"insert"!=a&&(this.sId=b);this.setMode(a,this.sTemplateFolder+c)},explodeWebServiceResourceId:function(a){var b=
[];"string"==typeof a&&(b=a.split("/"));return b},getSectionWebServiceResourceId:function(){var a=this.oSelectedObject.ressource_id;if("undefined"!=typeof this.oSectionForm[this.oSelectedObject.name]){var b=this.oSectionForm[this.oSelectedObject.name];"undefined"!=typeof b.sections&&null!=b.sections[b.iSelectedSectionIndex].ressource_id&&(a=b.sections[b.iSelectedSectionIndex].ressource_id)}return a},setFormDefinitionName:function(){if("undefined"==typeof this.oSelectedObject.sections)this.sFormDefinitionName=
this.oSelectedObject.name+"_"+this.sMode+"_form";else{var a=0;"undefined"!=typeof this.oSectionForm[this.oSelectedObject.name]&&"undefined"!=typeof this.oSectionForm[this.oSelectedObject.name].iSelectedSectionIndex&&(a=this.oSectionForm[this.oSelectedObject.name].iSelectedSectionIndex);this.sFormDefinitionName=1==this.oSelectedObject.sections.length||"search"==this.sMode?this.oSelectedObject.name+"_"+this.sMode+"_form":this.oSelectedObject.name+"_"+this.oSelectedObject.sections[a].name+"_"+this.sMode+
"_form"}},toGarbageCollection:function(a){if(null!=a){var b=this;Array.isArray(a)?a.length=0:"object"==typeof a&&Object.keys(a).forEach(function(c){Array.isArray(a[c])||"object"==typeof a[c]?b.toGarbageCollection(a[c]):delete a[c]})}},setModalSectionForm:function(f,k,m){var h=this,t=b.get(["modesSrvc"]),u="form_modal_"+h.oSelectedObject.name,w=a.$new();t.addScopeToObject(h.oSelectedObject.name,h.oSelectedMode.mode_id,w);var x={},x=null!=m?m:{sSelectedTemplate:h.sSelectedTemplate,sId:h.sId,sMode:h.sMode};
w.sParentMode=h.sMode;g.modalWindow("dialog","&nbsp;",{className:"dialog-modal-window dialog-modal-window-section-form",message:'<div id="'+u+'"></div>'}).then(function(b){$(b).on("shown.bs.modal",function(){h.sSelectedTemplate="simpleFormTpl.html";h.sId="insert"==f?"":k;h.sMode=f;var g=document.querySelector("body").clientHeight-50;b[0].querySelector(".modal-dialog").style.width=document.querySelector("body").clientWidth-50+"px";b[0].querySelector(".modal-dialog").style.height=g+"px";b[0].querySelector(".modal-header").style.height=
"56px";b[0].querySelector(".modal-body").style.height=g-56-4+"px";c(h.sTemplateFolder+h.sSelectedTemplate).then(function(c){d($("#"+u).html(c).contents())(w);var f=a.$on("formDefinitionLoaded",function(a,c){f();e(h.oFormDefinition[c].title,{sId:h.sId}).then(function(a){b[0].querySelector(".modal-title").textContent=a})}),g=a.$on("endFormNgRepeat",function(){g();b[0].querySelector(".simple-form-title").style.display="none"})})});$(b).on("hide.bs.modal",function(){var a=angular.element(v.f).scope();
h.sSelectedTemplate=x.sSelectedTemplate;h.sId=x.sId;h.sMode=x.sMode;null!=x.sFormDefinitionName&&(a.sFormDefinitionName=x.sFormDefinitionName,h.sFormDefinitionName=x.sFormDefinitionName);null!=x.ressource_id&&(h.oSelectedObject.ressource_id=x.ressource_id);null!=x.resetTemplateUrl&&1==x.resetTemplateUrl&&(a.oFormRequestParams=null)})})}}}hB.$inject="$rootScope $injector $templateRequest $compile $translate propertiesSrvc externFunctionSrvc".split(" ");v.$O=function(){return{id:"",login:""}};
function iB(a,b,c,d,e,f,g,h){return{modes:"",scope:"",getMode:function(a){for(var b=0;b<this.modes.length;){if(this.modes[b].mode_id==a)return this.modes[b];b++}return{}},getObject:function(a,b){for(var c=0;c<b.objects.length;){if(b.objects[c].name==a)return b.objects[c];c++}return{}},selectMode:function(a,b,g,t){t=null!=t?t:0;var k=this,m=c.defer(),p;try{1==Z.wc?(p=h.checkStudioFormModifications(f.sSelectedObjectName),Z.wc=!1):p=h.checkFormModifications(f.sFormDefinitionName)}catch(z){console.warn("this application doesn't need the studio"),
console.warn(z),p=h.checkFormModifications(f.sFormDefinitionName)}p.then(function(){var c;c=!0;"undefined"!=typeof f.oSelectedMode.mode_id&&(c=f.oSelectedMode.reload)&&(angular.element("#container_mode_"+f.oSelectedMode.mode_id).empty(),k.clearObjectData(f.oSelectedObject.name,f.oSelectedMode.mode_id),f.oLastSelectedObjectMode[f.oSelectedMode.mode_id]=null,"undefined"!=typeof f.oSectionForm[f.oSelectedObject.name]&&(f.oSectionForm[f.oSelectedObject.name]={}));var h=k.getMode(b);f.oSelectedMode=h;
var p=f.oLastSelectedObjectMode[f.oSelectedMode.mode_id];c||hb(p)||"undefined"==p.lastMode?(f.oSelectedObject=h.objects[t],k.scope=a,c=!0):(f.sMode=p.lastMode,f.oSelectedObject=p,c=!1);d.sSelectedObjectName=f.oSelectedObject.name;f.sSelectedSectionName="";a.objects=1<h.objects.length||null!==h.objects[t].label?h.objects:{};"undefined"!==typeof g?($("#mode_column > ul > li > a").removeClass("mode_selected"),$(g.target).addClass("mode_selected")):($("#mode_column > ul > li > a").removeClass("mode_selected"),
$("#mode_"+b).addClass("mode_selected"));f.loadObjectTemplate({bForceTemplateCompilation:!1,bFirstModeObject:c});e(function(){d.$broadcast(d.sSelectedObjectName,{})},300);m.resolve()});p=m.promise;"undefined"!=typeof Z&&(Z.wc=!1);return p},selectObject:function(a,b,c){var g=this;("undefined"!=typeof Z&&1==Z.wc?h.checkStudioFormModifications(f.sSelectedObjectName):h.checkFormModifications(f.sFormDefinitionName)).then(function(){"undefined"==typeof c&&(c="search");angular.element("#container_mode_"+
f.oSelectedMode.mode_id).empty();g.clearObjectData(f.oSelectedObject.name,f.oSelectedMode.mode_id);"undefined"!=typeof f.oSectionForm[b]&&(f.oSectionForm[b]={},f.oLastSelectedObjectMode[f.oSelectedMode.mode_id].sFormDefinitionName=null);f.sMode=c;f.oSelectedObject=g.getObject(b,f.oSelectedMode);d.sSelectedObjectName=f.oSelectedObject.name;f.sSelectedSectionName="";f.loadObjectTemplate({bForceTemplateCompilation:!0});e(function(){d.$broadcast(d.sSelectedObjectName,{})},1)});"undefined"!=typeof Z&&
(Z.wc=!1)},loadModes:function(){var e={filter:{column:"application_name",compare_operator:"=",value:sessionStorage.application},order_by:"index",distinct:"true"},f=this,h=c.defer();A({method:"GET",url:g.web_server_name+"/"+g.services_alias+"/vitis/modes",params:e,scope:d,headers:{Accept:"application/x-vm-json"},success:function(c){if(1==c.data.status){var d=c.data.data,e;c=0;for(var k;c<d.length;){e=d[c].data[0].data;n(e)||(console.error("Objets du mode "+d[c].mode_id+" non d\u00e9finis"),console.error(d[c]));
for(k=0;k<e.length;)e[k].name=e[k].mode_id+"_"+e[k].name,e[k].event=e[k].event.replace("javascript:",""),e[k].aScope=[],e[k].display_menu=!0,k++;d[c].objects=e;d[c].data=void 0;d[c].fullScreen=!1;d[c].ajaxLoader=!0;c++}f.modes=d;h.resolve("modes saved");e=[];for(c=0;c<d.length;)-1==e.indexOf(d[c].module_name)&&e.push(d[c].module_name),c++;sessionStorage.application_modules=e;for(c=0;c<e.length;)b.addPart("modules/"+e[c]+"/lang"),c++;a.refresh().then(function(){for(var b=0,c=0,e,f;b<d.length;)e="TITLE_MODE_"+
d[b].mode_id.toUpperCase(),f="TEXT_MODE_"+d[b].mode_id.toUpperCase(),a([e,f],{app_name:g.app_name}).then(function(a){var b=Object.keys(a);d[c].title=a[b[0]];d[c].text=a[b[1]];c++}),b++})}}});return h.promise},setModeReload:function(a,b){for(var c=0;c<this.modes.length;)this.modes[c].mode_id==a&&(this.modes[c].reload=b),c++},clearObjectData:function(a,b){a=this.getObject(a,this.getMode(b));null!=a.aScope&&(a.aScope.forEach(function(a){a.$destroy()}),a.aScope.length=0)},addScopeToObject:function(a,
b,c){a=this.getObject(a,this.getMode(b));"undefined"==typeof a.aScope&&(a.aScope=[]);a.aScope.push(c)}}}iB.$inject="$translate $translatePartialLoader $q $rootScope $timeout envSrvc propertiesSrvc formSrvc".split(" ");
v.Kp=function(a,b,c,d){return{resizeWin:function(){var b=document.getElementById("container").offsetHeight;null===document.getElementById("header_line")||""!==document.getElementById("header_line").style["margin-top"]&&"0px"!==document.getElementById("header_line").style["margin-top"]||(b-=document.getElementById("header_line").offsetHeight);null===document.getElementById("footer_line")||""!==document.getElementById("footer_line").style["margin-top"]&&"0px"!==document.getElementById("footer_line").style["margin-top"]||
(b-=document.getElementById("footer_line").offsetHeight);document.getElementById("works_line").style.height=b+"px";setTimeout(function(){for(var b=$(".workspacelist-grid"),c=0;c<b.length;){var d=b[c].offsetHeight,e=b[c].offsetWidth;null!=document.getElementById(b[c].id+"_header")&&(d-=document.getElementById(b[c].id+"_header").offsetHeight);null!=document.getElementById(b[c].id+"_footer")&&(d-=document.getElementById(b[c].id+"_footer").offsetHeight);document.getElementById(b[c].id+"_data").style.height=
d-2+"px";document.getElementById(b[c].id+"_data").style.width=e-2+"px";$(b[c]).find(".ui-grid-viewport").height($(b[c]).find(".ui-grid-render-container-body").height()-17);c++}b=angular.element(".workspacelist-grid").scope();null!=b&&(b=a.gridApi[b.sSelectedGridOptionsName],null!=b&&null!=b.core&&(b.core.handleWindowResize(),b.core.refreshRows()))},300)},clearLessCache:function(){for(var a=0;a<window.localStorage.length;){var b=window.localStorage.key(a);-1!=b.indexOf(".less")?window.localStorage.removeItem(b):
a++}},preg_replace:function(a,b,c){c=String(c);for(i=0;i<a.length;i++)c=c.replace(RegExp(a[i],"gi"),b[i]);return c},modalWindow:function(e,f,g){d.info("modalWindow");var h=c.defer(),k=h.promise;"undefined"==typeof g&&(g={});var m=[];"undefined"!=typeof f&&""!=f&&m.push(f);"undefined"!=typeof g.message&&""!=g.message?m.push(g.message):g.message="&nbsp;";var p={};"undefined"!=typeof g.translationData&&(p=g.translationData);b(m,p).then(function(b){var c,d=!1;"&nbsp;"!=g.message&&(g.message=b[g.message]);
if("undefined"!=typeof f&&""!=f){g.title=b[f];switch(g.className){case "modal-danger":c="exclamation-sign";d=!0;break;case "modal-success":c="ok-sign";d=!0;break;case "modal-warning":c="warning-sign"}"undefined"!=typeof c&&(g.title='<span class="glyphicon glyphicon-'+c+'" aria-hidden="true"></span>&nbsp;'+b[f])}d&&"dialog"==e&&(g.buttons={close:{label:"OK",className:"btn-default"}});var k=bootbox[e](g);h.resolve(k);"undefined"!=typeof g.appDuration?setTimeout(function(){k.modal("hide");"undefined"!=
typeof g.appCallback&&g.appCallback(a,k)},g.appDuration):"undefined"!=typeof g.appCallback&&g.appCallback(a,k)});return k}}};v.externFunctionSrvc=v.Kp;v.Kp.$inject=["$rootScope","$translate","$q","$log","$timeout"];
function jB(a,b){return{getFromServer:function(){var c=this,d=a.defer();A({method:"GET",url:c.web_server_name+"/"+c.services_alias+"/vitis/properties",scope:b,success:function(a){delete a.data.status;for(var b=0,e=Object.keys(a.data);b<e.length;)c[e[b]]=a.data[e[b]],b++;c.session_token=sessionStorage.session_token;v.zk("properties_loaded");d.resolve()}});return d.promise}}}jB.$inject=["$q","$rootScope"];function kB(a,b,c,d){return{getFormData:function(b,c,d){null!=d||(d={});var e=null!=d.oFormValues?d.oFormValues:a.oFormValues,f=null!=d.aParamsToSave?d.aParamsToSave:[],g,p,t,u=(null!=d.oFormDefinition?d.oFormDefinition:a.oFormDefinition)[b].rows,w=e[b],x,z,D=0;for(d={};D<u.length;){g=u[D].fields;for(z=0;z<g.length;){if("undefined"!=typeof g[z])switch(g[z].type){case "upload":case "file_wsdata":case "image_wsdata":null!=document.getElementById(g[z].id)&&(x=!0,p=document.getElementById(g[z].id).files,
null!=p?0<p.length?(d[g[z].name]=p[0],null!=g[z].width&&null!=g[z].height&&(d[g[z].name+"_width"]=g[z].width,d[g[z].name+"_height"]=g[z].height)):x=!1:x=!1,x||(x=w[g[z].name],null!=x&&null!=x.aFiles&&null!=x.aFiles[0]&&(d[g[z].name]=x.aFiles[0],null!=g[z].width&&null!=g[z].height&&(d[g[z].name+"_width"]=g[z].width,d[g[z].name+"_height"]=g[z].height))));break;case "double_select":p=w[g[z].name];if("undefined"!=typeof p&&(x=0,t=[],"undefined"!=typeof p.options)){for(;x<p.options.length;)t.push(p.options[x].value),
x++;d[g[z].name]=t.join("|")}break;case "select":case "editable_select":null!=w[g[z].name]&&"undefined"!=typeof w[g[z].name].selectedOption&&(x=w[g[z].name].selectedOption.value,"undefined"!=typeof x&&"?"!=x&&(d[g[z].name]=x));break;case "list":if(null!=w[g[z].name]&&(p=w[g[z].name].selectedOption,q(p))){t=[];for(x=0;x<p.length;x++)null!=p[x].value&&"?"!=p[x].value&&t.push(p[x].value);d[g[z].name]=t.join("|")}break;case "title":case "subtitle":case "label":case "button":break;default:"undefined"!=
typeof w&&null!=w[g[z].name]&&(d[g[z].name]=w[g[z].name])}z++}D++}if(!0===c)for(c=d,x=0;x<f.length;x++)null!=c[f[x]]||null!=e[b][f[x]]&&(c[f[x]]=e[b][f[x]]);else for(c=new FormData,b=Object.keys(d),x=0;x<b.length;)c.append(b[x],d[b[x]]),x++;return c},setWebServiceSelectOptions:function(e,f){d.setWebServiceSelectOptions(e,f,a.oFormValues,b,c.token)},setSelectOptions:function(b,c){d.setSelectOptions(b,c,a.oFormValues)},extractFormDefinitionInfos:function(){d.extractFormDefinitionInfos(a.oFormDefinition[a.sFormDefinitionName].name)},
clearFormData:function(){},reloadSelectField:function(b,c){d.reloadSelectField(b,c,a.oFormValues,a.oFormDefinition)},getFormElementDefinition:function(b,c){return d.getFormElementDefinition(b,c,a.oFormDefinition)},getAllFormElementDefinition:function(b){return d.getAllFormElementDefinition(b,a.oFormDefinition)},setWebServiceTags:function(b,c){d.setWebServiceTags(b,c,a.oFormValues)},checkFormModifications:function(a){return d.checkFormModifications(a)},checkStudioFormModifications:function(a){return d.checkStudioFormModifications(a)}}}
kB.$inject=["envSrvc","propertiesSrvc","sessionSrvc","formReaderService"];var lB="ui.grid ui.grid.selection ui.grid.pagination ui.grid.moveColumns ui.grid.resizeColumns ui.grid.exporter pascalprecht.translate angular.bind.notifier formReader ngSanitize".split(" "),lB=lB.concat(fB.vitisModuleDependencies);v.module=angular.module("vitisApp",lB);v.module.service("sessionSrvc",gB);v.module.service("envSrvc",hB);v.module.service("modesSrvc",iB);v.module.value("userSrvc",v.$O);v.module.service("externFunctionSrvc",v.Kp);v.module.service("propertiesSrvc",jB);
v.module.service("formSrvc",kB);
v.config=function(a,b,c,d,e,f,g){var h=!1;v.on("properties_loaded",function(){h=angular.element(v.Wb).injector().get(["propertiesSrvc"]).debug_mode});d.debugEnabled(!0);g.decorator("$log",["$delegate",function(a){return{error:function(b){a.error(b)},info:function(b){h&&a.info(b)},log:function(b){h&&a.log(b)},warn:function(b){a.warn(b)}}}]);b.useLoader("$translatePartialLoader",{urlTemplate:"{part}/lang-{lang}.json"});c.addPart("lang");b.preferredLanguage("fr");b.useSanitizeValueStrategy(null);v.compileProvider=
e;a.interceptors.push(function(){return{request:function(a){-1==a.url.indexOf("ui-grid/")&&("undefined"==typeof a.params?a.params={vitis_version:oClientProperties.build}:a.params.vitis_version=oClientProperties.build);"true"==sessionStorage.ajaxLoader&&ed();var b=parseInt(sessionStorage.loading_counter);b++;sessionStorage.loading_counter=b;return a},response:function(a){if(typeof("object"==a.data)&&"undefined"!=typeof a.data.errorCode){fd();var b=angular.element(v.Wb).injector().get(["sessionSrvc"]),
c=angular.element(v.Wb).injector().get(["externFunctionSrvc"]),d={className:"modal-danger",buttons:{ok:{label:"OK",className:"btn-default"}},callback:function(){b.disconnect()}},e="";switch(a.data.errorCode){case 15:d.message="EXPIRED_TOKEN_ERROR";e="EXPIRED_TOKEN_ERROR_TITLE";break;case 16:d.message="INVALID_TOKEN_ERROR",e="INVALID_TOKEN_ERROR_TITLE"}n(d.message)&&c.modalWindow("alert",e,d)}else c=parseInt(sessionStorage.loading_counter),0<c?c--:c=0,sessionStorage.loading_counter=c,0==c&&fd();return a},
requestError:function(a){console.error("requestError",a);return a},responseError:function(a){console.error("responseError",a);fd();return a}}});g.decorator("$exceptionHandler",["$delegate",function(a){return function(b,c){a(b,c);if("true"==sessionStorage.debug){var d=angular.element(v.Wb).injector().get(["envSrvc"]);c=angular.element(v.Wb).injector().get(["externFunctionSrvc"]);d={className:"modal-danger modal-error-log",message:"<div>"+("<b>Mode: "+d.oSelectedMode.title+" / Onglet: "+d.oSelectedObject.label+
"</b><br>")+b.stack.replace(/[\n\r]/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;")+"</div>",buttons:{ok:{label:"OK",className:"btn-default"}},callback:function(){}};c.modalWindow("alert",b.name+": "+b.message,d)}}}])};v.config.$inject="$httpProvider $translateProvider $translatePartialLoaderProvider $logProvider $compileProvider $controllerProvider $provide $injector".split(" ");v.module.config(v.config);function mB(){}qa("formReader",mB);mB.module=angular.module("formReader",["angular.bind.notifier"]);mB.module=mB.module;mB.controller={};mB.controller.bQ={};
function nB(a,b,c,d,e,f){c.info("formReader.formReaderController");var g=this;this.b=a;this.va=b;this.K=c;this.Us=f;this.yd=d;this.So=[];a.oFormValues=n(a.oFormValues)?a.oFormValues:{};a.oFormDefinition=n(a.oFormDefinition)?a.oFormDefinition:{};a.sFormDefinitionName=n(a.sFormDefinitionName)?a.sFormDefinitionName:"";this.xq();a.sFormUniqueName=Date.now();a.iDisplayedTab=0;a.$watch("iDisplayedTab",function(){g.EC()});"undefined"==typeof e.oFormPromises&&(e.oFormPromises={});e.oFormPromises[a.sFormDefinitionName]=
[];a=a.oFormDefinition[a.sFormDefinitionName];if("undefined"!=typeof a&&!0===a.formDefinitionLoaded)g.nv();else var h=e.$on("formDefinitionLoaded",function(){h();g.nv()})}mB.formReaderController=nB;nB.$inject="$scope $q $log formReaderService $rootScope $element".split(" ");mB.module.controller("AppFormReaderController",nB);
nB.prototype.xq=function(){if(null!=this.b.oFormDefinition&&null!=this.b.sFormDefinitionName&&null!=this.b.oFormDefinition[this.b.sFormDefinitionName]&&null==this.b.oFormDefinition[this.b.sFormDefinitionName].tabs){var a=this.b.oFormDefinition[this.b.sFormDefinitionName],b=[];if(null!=a.rows){for(var c=0;c<a.rows.length;c++)if(null!=a.rows[c].fields)for(var d=0;d<a.rows[c].fields.length;d++)if(null!=a.rows[c].fields[d].name)b.push(a.rows[c].fields[d].name);else if(null!=a.rows[c].fields[d].buttons)for(var e=
0;e<a.rows[c].fields[d].buttons.length;e++)null!=a.rows[c].fields[d].buttons[e].name&&b.push(a.rows[c].fields[d].buttons[e].name);this.b.oFormDefinition[this.b.sFormDefinitionName].tabs={position:"top",list:[{label:"Tab 0",elements:b}]}}}};nB.prototype.initFormTabs=nB.prototype.xq;
nB.prototype.nv=function(){var a=this;this.xq();this.zs(!1);setTimeout(function(){var b=a.b.oFormDefinition,c=a.b.sFormDefinitionName;if(null==b||null==c||null==b[c])return 0;var d=b[c].initEvent;setTimeout(function(){null!=b[c].initEvent&&a.yd.isFunctionCall(d)&&a.yd.callFunction(d);setTimeout(function(){a.Mp()})})});this.b.iDisplayedTab=0;this.b.$broadcast("loadForm")};nB.prototype.loadForm=nB.prototype.nv;nB.prototype.ti=function(){this.xq();this.b.$broadcast("$$rebind::refresh")};
nB.prototype.refreshForm=nB.prototype.ti;nB.prototype.lN=function(a){this.K.log("formReader.formReaderController.prototype.setFormDefinition");this.b.oFormDefinition=a;this.yd.oFormDefinition=a;this.ti();this.b.iDisplayedTab=0};nB.prototype.setFormDefinition=nB.prototype.lN;nB.prototype.mN=function(a){this.K.log("formReader.formReaderController.prototype.setFormValues");this.b.oFormValues=a;this.yd.oFormValues=a};nB.prototype.setFormValues=nB.prototype.mN;
nB.prototype.iN=function(a){this.K.log("formReader.formReaderController.prototype.setDefinitionName");this.b.sFormDefinitionName=a;this.yd.sFormDefinitionName=a};nB.prototype.setDefinitionName=nB.prototype.iN;nB.prototype.nO=function(){};nB.prototype.toTest=nB.prototype.nO;
nB.prototype.zs=function(a,b){this.K.log("formReader.formReaderController.prototype.useDefaultValues");var c=this.b,d=c.oFormValues,e=c.oFormDefinition,c=c.sFormDefinitionName;if(null==d||null==e||null==c||null==e[c])return 0;e=e[c].rows;if(null==e)return 0;for(var f=0;f<e.length;f++)if(null!=e[f].fields)for(var g=0;g<e[f].fields.length;g++)if("bo_grid"!==e[f].fields[g].type&&"ui_grid"!==e[f].fields[g].type&&"section_grid"!==e[f].fields[g].type){var h;try{h=angular.copy(e[f].fields[g])}catch(t){console.error("try angular.copy failed");
continue}if(null==b||h.name===b){null!=h.default_value&&""!==h.default_value&&this.yd.isFunctionCall(h.default_value)&&(h.default_value=this.yd.callFunction(h.default_value));if("select"===h.type||"editable_select"===h.type)null!=h.default_value&&""!==h.default_value&&(h.default_value={value:h.default_value});else if(("list"===h.type||"double_select"===h.type)&&null!=h.default_value&&""!==h.default_value){var k;k=r(h.default_value)?h.default_value.split("|"):h.default_value;for(var m=[],p=0;p<k.length;p++)m.push({value:k[p]});
h.default_value=m}this.nE(h,a)&&("select"===h.type||"editable_select"===h.type||"list"===h.type?(null!=d[c][h.name]||(d[c][h.name]={}),d[c][h.name].selectedOption=h.default_value):"double_select"===h.type?(null!=d[c][h.name]||(d[c][h.name_to]={}),d[c][h.name_to].selectedOption=h.default_value):"editable_double_select"===h.type?(null!=d[c][h.name]||(d[c][h.name_available_tags]={}),d[c][h.name_available_tags].selectedOption=h.default_value):d[c][h.name]=h.default_value);delete h}}};
nB.prototype.useDefaultValues=nB.prototype.zs;
nB.prototype.nE=function(a,b){this.K.log("formReader.formReaderController.prototype.useDefaultValue");var c=this.b,d=c.oFormValues,c=c.sFormDefinitionName;if(n(a.default_value)&&""!==a.default_value){if(!0===b)return!0;if("select"===a.type){if(null==d[c][a.name]||null==d[c][a.name].selectedOption||null==d[c][a.name].selectedOption.value||0===d[c][a.name].selectedOption.value.length)return!0}else if("editable_select"===a.type){if(null==d[c][a.name]||null==d[c][a.name].selectedOption||null==d[c][a.name].selectedOption.value||
0===d[c][a.name].selectedOption.value.length)return!0}else if("list"===a.type){if(null==d[c][a.name]||!q(d[c][a.name].selectedOption)||0===d[c][a.name].selectedOption.length||0===d[c][a.name].selectedOption[0].value.length)return!0}else if("double_select"===a.type){if(null==d[c][a.name_to]||!q(d[c][a.name_to].selectedOption)||0===d[c][a.name_to].selectedOption.length||0===d[c][a.name_to].selectedOption[0].value.length)return!0}else if("editable_double_select"===a.type){if(null==d[c][a.name_available_tags]||
!q(d[c][a.name_available_tags].selectedOption)||0===d[c][a.name_available_tags].selectedOption.length||0===d[c][a.name_available_tags].selectedOption[0].value.length)return!0}else if(null==d[c][a.name]||0===d[c][a.name].length)return!0}else return!1};nB.prototype.useDefaultValue=nB.prototype.nE;
nB.prototype.Mp=function(){this.K.log("formReader.formReaderController.prototype.extractFormDefinitionInfos");if(!n(this.b.oFormDefinition))return console.error("$scope['oFormDefinition'] not defined"),0;this.b.$broadcast("extractFormDefinitionInfos");this.b.bFormDefinitionInfosExtracted=!0;var a=this.b.oFormDefinition[this.b.sFormDefinitionName],b=this.b.oFormValues[this.b.sFormDefinitionName],c=this.b.oFormDefinition.datasources,d,e=this;null!=this.b.$root.oFormPromises[this.b.sFormDefinitionName]||
(this.b.$root.oFormPromises[this.b.sFormDefinitionName]=[]);var f=this.va.defer();this.b.$root.oFormPromises[this.b.sFormDefinitionName].push(f.promise);for(var g=0;g<e.So.length;g++)e.So[g]();e.So.length=0;if(n(a)&&n(a.rows))for(g=0;g<a.rows.length;g++)for(var h=0;h<a.rows[g].fields.length;h++){var k=a.rows[g].fields[h];d=b[k.name];"undefined"===typeof k.id&&"undefined"!==typeof k.name&&(k.id=this.b.sFormDefinitionName+"_"+k.name);switch(k.type){case "select":case "editable_select":case "list":case "double_select":k.id_from=
k.id+"_from";var m=null,p=null;n(k.datasource)&&n(k.datasource.datasource_id)&&n(c)&&n(c[k.datasource.datasource_id])&&("web_service"===c[k.datasource.datasource_id].type?m=oB(k,c):"object"===c[k.datasource.datasource_id].type&&(p=pB(k,c)));n(k.web_service)&&(m=angular.copy(k.web_service));if(null!=k.options)var t=k.options;null!=p&&(t=p);null!=m?(m=angular.copy(m),!1!==m.load_first_time?(n(m.parents)&&qB(this,k,m,b),rB(b,m.parents,!0)&&this.yd.setWebServiceSelectOptions(k,this.b.sFormDefinitionName,
this.b.oFormValues,m),delete m):"undefined"!==typeof m.callback&&e.yd.isFunctionCall(m.callback)&&e.yd.callFunction(m.callback)):n(t)?this.yd.setSelectOptions(k,this.b.sFormDefinitionName,this.b.oFormValues,t):"object"!==typeof d&&(b[k.name]="select"===k.type||"editable_select"===k.type?{selectedOption:{value:d},options:[]}:{selectedOption:[{value:d}],options:[]});break;case "editable_double_select":k.name_available_tags=k.name+"_available";k.id_available_tags=k.id+"_available";"undefined"!==typeof k.web_service&&
this.yd.setWebServiceTags(k,this.b.sFormDefinitionName,this.b.oFormValues);break;case "ui_grid":if("undefined"!=typeof k.datasource&&"web_service"===c[k.datasource.datasource_id].type){var m=oB(k,c),u=k;e.yd.getWebServiceData(m).then(function(a){angular.element("#"+u.id+"_grid .ui-grid-contents-wrapper").scope().grid.options.data=a})}}delete k}this.va.all(this.b.$root.oFormPromises[this.b.sFormDefinitionName]).then(function(){setTimeout(function(){e.b.$root.$emit("formExtracted",e.b.sFormDefinitionName)});
if(null!=a){var b=a.name,c=angular.element("form[name='"+b+"']");0<c.length&&(c=c.scope(),null!=c[b]&&c[b].$setPristine())}});f.resolve()};nB.prototype.extractFormDefinitionInfos=nB.prototype.Mp;
function qB(a,b,c,d){c.parameters.original_filter=null!=c.parameters.filter?c.parameters.filter:"";c.parameters.original_filter_copy=angular.copy(c.parameters.original_filter);for(var e=0;e<c.parents.length;e++){var f=c.parents[e].filter_attr,g=c.parents[e].filter_equality,h=n(c.parents[e].name_to)?c.parents[e].name_to:c.parents[e].name,k=angular.copy("oFormValues."+a.b.sFormDefinitionName+"."+h+".selectedOption"),m=d[h],p=!0;setTimeout(function(b){var c=angular.bind({du:b.du,Iv:b.Iv,Qz:b.Qz,Rz:b.Rz,
mx:b.mx},function(){var b=this.du,c=this.Iv,e=d[this.mx],f;if(!p&&ha(m)&&ha(e)&&null!=e.selectedOption&&null!=m.selectedOption&&null!=e.selectedOption.value&&null!=m.selectedOption.value&&e.selectedOption.value==m.selectedOption.value||null==e||null==e.selectedOption)return 0;if(q(e.selectedOption)){if(0===e.selectedOption.length)return 0}else if(null==e.selectedOption.value)return 0;var g=rB(d,c.parents);null!=a.b.oFormValues&&null!=a.b.oFormValues[a.b.sFormDefinitionName]&&null!=a.b.oFormValues[a.b.sFormDefinitionName][b.name]&&
null!=a.b.oFormValues[a.b.sFormDefinitionName][b.name].selectedOption&&(f=angular.copy(a.b.oFormValues[a.b.sFormDefinitionName][b.name].selectedOption));a.yd.emptySelectOptions(b,a.b.sFormDefinitionName,a.b.oFormValues);if(g){c.parameters.original_filter=angular.copy(c.parameters.original_filter_copy);var g=c.parameters,h=c.parents,k=c.parameters.original_filter,t={relation:"AND",operators:[]},h=null!=h?h:[];null!=k&&""!==String(k).trim()||(k={relation:"AND",operators:[]});for(var u=0;u<h.length;u++)if(n(d[h[u].name])&&
n(d[h[u].name].selectedOption)){if(!n(d[h[u].name].selectedOption.value)){if(!q(d[h[u].name].selectedOption))continue;if(1>d[h[u].name].selectedOption.length)continue}var U=[];!q(d[h[u].name].selectedOption)&&n(d[h[u].name].selectedOption.value)?U.push(d[h[u].name].selectedOption):U=d[h[u].name].selectedOption;for(var K=h[u].filter_attr,X=h[u].filter_equality,ma={relation:"OR",operators:[]},fa=0;fa<U.length;fa++){var ya=U[fa].value;null==ya||r(ya)&&0< !ya.length||(ma.operators.push({column:K,compare_operator:X,
value:ya}),delete ya)}0!==ma.operators.length&&(t.operators.push(ma),delete U,delete K,delete X,delete ma)}delete u;0<t.operators.length&&k.operators.push(t);g.filter=k;a.K.log({"filter: ":angular.copy(c.parameters.filter)});a.yd.setWebServiceSelectOptions(b,a.b.sFormDefinitionName,a.b.oFormValues,c,f)}m=angular.copy(e);p=!1},!0);c();a.So.push(a.b.$watch(b.VM,c))},1E3,{VM:k,du:b,Iv:c,Qz:f,Rz:g,mx:h});delete f;delete g;delete k}}
function oB(a,b){if(!("ui_grid"==a.type||n(a.datasource.id_key)&&n(a.datasource.label_key)))return null;b=angular.copy(b[a.datasource.datasource_id]);b.id_key=a.datasource.id_key;b.label_key=a.datasource.label_key;b.parameters=n(b.parameters)?b.parameters:{};n(a.datasource.parents)&&(b.parents=a.datasource.parents);n(a.datasource.filter)&&(b.parameters.filter=a.datasource.filter);n(a.datasource.distinct)&&(b.parameters.distinct=a.datasource.distinct);n(a.datasource.attributs)&&(b.parameters.attributs=
a.datasource.attributs);n(a.datasource.order_by)&&(b.parameters.order_by=a.datasource.order_by);n(a.datasource.sort_order)&&(b.parameters.sort_order=a.datasource.sort_order);return b}
function pB(a,b){var c=[];if(n(b[a.datasource.datasource_id].data)&&n(a.datasource.id_key)&&n(a.datasource.label_key)){var d=a.datasource.id_key,e=a.datasource.label_key,f=b[a.datasource.datasource_id].data;n(d)||console.error("id_key not defined (required in for data json source)");n(e)||console.error("label_key not defined (required in for data json source)");if(n(d)&&n(e))for(var g=0;g<f.length;g++)c.push(f[g][e]+"|"+f[g][d]);delete d;delete e;delete f}n(b[a.datasource.datasource_id].options)&&
(c=b[a.datasource.datasource_id].options);return c}
function rB(a,b,c){var d=!0;if(null==a)return console.error("formReader.formReaderController.prototype.areParentsReady: oFormValues not defined"),!1;if(null==b||q(b)&&0===b.length)return!0;for(var e=0;e<b.length;e++)if("false"!==b[e].wait_for_parent&&!1!==b[e].wait_for_parent){if(!0===c)return!1;if(null!=a[b[e].name])if(null!=a[b[e].name].selectedOption){if(q(a[b[e].name].selectedOption)){if(0===a[b[e].name].selectedOption.length){d=!1;continue}if(0===a[b[e].name].selectedOption[0].value.length){d=
!1;continue}}q(a[b[e].name].selectedOption)||(null!=a[b[e].name].selectedOption.value?0===a[b[e].name].selectedOption.value.length&&(d=!1):d=!1)}else d=!1;else d=!1}return d}
nB.prototype.jh=function(a,b){a=n(a)?a:"";if(b=n(b)?b:!1)return this.bi(a);a=a.replace(",",".");var c=a.split(".");if(0===c.length)return NaN;if(1===c.length)return"."===a.charAt(a.length-1)?this.bi(a)+".":this.bi(a);if(2<=c.length){b=this.bi(c[0]);if(2===c.length){if(""===c[1])return this.bi(a)+".";c=this.bi(c[1],!0)}else{a="";for(var d=1;d<c.length;d++)a+=c[d];c=this.bi(a)}return parseFloat(b+"."+c).toFixed(String(c).length)}return NaN};nB.prototype.numberParser=nB.prototype.jh;
nB.prototype.bi=function(a,b){var c="";"undefined"==typeof b&&(b=!1);for(var d=0;d<a.length;d++){var e=a.charAt(d);isNaN(parseInt(e))||(c+=e)}b||(c=parseInt(c));return c};nB.prototype.integerParser=nB.prototype.bi;nB.prototype.EC=function(){var a,b=$(this.Us).find("[data-app-subform-grid]");setTimeout(function(){for(var c=0;c<b.length;c++)a=angular.element(b[c]).scope(),null!=a&&null!=a.gridApi&&null!=a.gridApi.core&&null!=a.gridApi.core.handleWindowResize&&a.gridApi.core.handleWindowResize()})};
nB.prototype.refreshSubformGrids=nB.prototype.EC;OA.uP={};
OA.Dx=function(a){return{restrict:"A",controller:"AppMapWorkbenchController",controllerAs:"ctrl",templateUrl:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/"+sessionStorage.appEnv+"/javascript/externs/formReader/component/map_workbench/map_workbench.html",compile:function(){return{pre:function(a){var b=[{name:"map_workbench_index",visible:!1}];if(q(a.field.attributes_def))for(var d=0;d<a.field.attributes_def.length;d++)b.push({name:a.field.attributes_def[d].name,displayName:a.field.attributes_def[d].label});
a.gridOptions={enableSorting:!0,enableRowSelection:!0,enableSelectAll:!0,multiSelect:!1,columnDefs:b,data:[]};a.featureForm={draw:{symbol:"fa-home",color:"red",outline_color:"white",size:4,rotation:0,dash:20},text:{text:"",size:14,font:"Arial",color:"white",outline_color:"black",outline_size:1,offsetX:0,offsetY:10,rotation:0},attributes:{}};a.aIcons=[];a.olSelectedFeature=null;a.sSelectedFeatureType=null;a.bFormDisabled=!0;a.aFeatures=[];a.custom_form=null;a.oSubformScope=null;var e=Date.now(),f=
null;a.clearSelectedFeature=function(b){a.olSelectedFeature=null;null!=a.oMap.wa&&ga(a.oMap.wa.Ca)&&null!=a.oMap.wa.Ca()&&(a.oMap.wa.Ca().clear(),b&&a.oMap.ca.hd(a.oMap.wa));f=null;a.gridApi.selection.clearSelectedRows()};a.closeModal=function(a){$(a).modal("hide")};a.gridOptions.onRegisterApi=function(b){a.gridApi=b;a.gridApi.selection.on.rowSelectionChanged(a,function(b){if(e+100>Date.now())return null;e=Date.now();for(var c=null,d=0;d<a.aFeatures.length;d++)if(a.aFeatures[d].get("attributes").map_workbench_index===
b.entity.map_workbench_index){c=a.aFeatures[d];break}if(null!=f&&f===b.entity.map_workbench_index)return a.clearSelectedFeature(!0),null;f=b.entity.map_workbench_index;if(null!=a.oMap.wa&&ga(a.oMap.wa.get)&&"select"===a.oMap.wa.get("type")&&(d=a.oMap.wa.Ca().P(),q(d)&&0<d.length&&(d=d[0].get("attributes"),null!=d&&d.map_workbench_index===b.entity.map_workbench_index)))return null;a.oMap.activeInteraction("select",!0);a.oMap.wa.Ca().push(c);setTimeout(function(){a.oMap.wa.Vt()})})}},post:function(b,
c){function d(){b.oSubformScope=b.getSubFormScope();b.oSubformScope.loadSubForm({sFormDefinitionName:"update",oFormDefinition:b.field.custom_form.form,oFormValues:{update:{}},oProperties:b.oProperties});var a=angular.element(v.f).injector().get(["formSrvc"]);null!=b.oSubformScope&&null!=b.oSubformScope.oSubformValues&&b.$watch("oSubformScope.oSubformValues",function(c,d){c=a.getFormData("update",!0,{oFormDefinition:b.field.custom_form.form,oFormValues:kb(c)});d=a.getFormData("update",!0,{oFormDefinition:b.field.custom_form.form,
oFormValues:kb(d)});var e=b.field.custom_form.featureStructure.field,f=b.field.custom_form.featureStructure.types,g=c[e],e=d[e];if(null!=g&&e&&g!==e&&null!=f[g]&&f[e]&&f[g].geometryType!==f[e].geometryType)return $.notify("Ce type est incompatible avec la g\u00e9om\u00e9trie s\u00e9lectionn\u00e9e","error"),b.oSubformScope.setFormValues({update:d}),null;mb(b.featureForm.attributes,c);null!=b.olSelectedFeature&&sB(b.ctrl,b.olSelectedFeature)},!0)}function e(){n(b.oMap)&&(b.oMap.ca.yi(null),delete b.oMap);
null!=b.field.custom_form&&tB(b.ctrl);b.oMap=new PA({target:$(c).find(".form-map")[0],options:b.field.map_options,hiddenFieldId:b.field.id,oFormValues:b.oFormValues[b.sFormDefinitionName],sFormName:b.field.name,oProj:b.$root.proj});YA(b.oMap,function(a){b.$applyAsync(function(){b.olSelectedFeature=a})});ZA(b.oMap,function(a){if(!q(a))return null;b.aFeatures=a;a=b.ctrl;a.K.info("MapWorkbenchController.fillGridFromFeatures_");var c=a.b.aFeatures,d=[],e;if(q(c))for(var f=0;f<c.length;f++)e=null!=c[f].get("attributes")?
c[f].get("attributes"):{},e.map_workbench_index=angular.copy(f),c[f].set("attributes",e),d.push(e);a.b.gridOptions.data=d;a.b.gridApi.grid.refresh()});$A(b.oMap,function(a){setTimeout(function(){b.olSelectedFeature=a;b.oMap.activeInteraction("select");b.oMap.wa.Ca().push(a);setTimeout(function(){b.oMap.wa.Vt();tB(b.ctrl)})})});setTimeout(function(){UA(b.oMap)})}b.getSubFormScope=function(){return angular.element("#map_workbench_"+b.sFormUniqueName+"_subform").scope()};setTimeout(function(){e();b.$watch("field.nb_cols",
function(){a(function(){b.oMap.ca.Qd()})});b.$watch("field.style",function(){a(function(){b.oMap.ca.Qd()})},!0);b.$watch("oMap.bLayersTreeOpen",function(){a(function(){b.oMap.ca.Qd()})},!0);b.$on("studio resized",function(){b.oMap.ca.Qd()});b.$on("updateMap",function(a,c){switch(c){case "center":b.oMap.setCenter([b.field.map_options.center.coord[0],b.field.map_options.center.coord[1]]);break;case "zoom":b.oMap.setZoom(b.field.map_options.center.zoom);break;case "source":b.oMap.setBingSource(b.field.map_options.source);
break;case "extent":b.oMap.setExtent(b.field.map_options.center.extent);break;case "controls":b.oMap.setControls(b.field.map_options.controls);break;case "interact":b.oMap.setInteractions(b.field.map_options.interactions);break;case "proj":a=b.oMap.getExtent();c=b.oMap.getCenter();var d=b.oMap.getProj();b.field.map_options.center.extent=b.oMap.transformExtent(a,d,b.field.map_options.proj);b.field.map_options.center.coord=b.oMap.transformer(c,d,b.field.map_options.proj);e();break;default:e()}})});
setTimeout(function(){null!=b.field.custom_form&&null!=b.field.custom_form.form&&(mb(b.field.custom_form,b.oFormValues[b.sFormDefinitionName].custom_form),d())})}}}}};OA.Dx.$inject=["$timeout"];mB.module.directive("appMapWorkbench",OA.Dx);OA.uF=function(){return{scope:{model:"="},link:function(a,b){$(b).colorpicker({format:"hex"});var c;$(b).on("changeColor",function(){clearTimeout(c);c=setTimeout(function(){a.model=$(b).colorpicker("getValue");a.$parent.$apply()},100)})}}};
mB.module.directive("appColorpicker",OA.uF);
OA.mf=function(a,b){b.info("MapWorkbenchController");var c=this;this.K=b;this.b=a;var d=Date.now(),e=Date.now();a.$watch("featureForm",function(){if(d+50>Date.now())return null;d=Date.now();if(null==c.b.oMap||null==c.b.oMap.Oc||null==c.b.olSelectedFeature)return 0;uB(c);vB(c);setTimeout(function(){UA(c.b.oMap)})},!0);a.$watch("olSelectedFeature",function(){if(e+200>Date.now())return null;e=Date.now();a.bFormDisabled=null!=a.olSelectedFeature?!1:!0;if(null!=a.olSelectedFeature)switch(c.b.olSelectedFeature.j().F()){case "Point":case "MultiPoint":c.b.sSelectedFeatureType=
"Point";break;case "LineString":case "MultiLineString":c.b.sSelectedFeatureType="Line";break;case "Polygon":case "MultiPolygon":c.b.sSelectedFeatureType="Polygon";break;default:c.b.sSelectedFeatureType=null}if(null!=a.olSelectedFeature){var b=null!=a.olSelectedFeature.get("attributes")?a.olSelectedFeature.get("attributes"):{};a.featureForm.attributes=b;if(null!=a.oSubformScope){var d=a.field.custom_form.featureStructure.field,h=a.field.custom_form.featureStructure.types,k=angular.copy(a.field.custom_form.form);
if(null!=b[d]&&null!=h[b[d]]&&q(h[b[d]].disableAttrs))for(d=h[b[d]].disableAttrs,h=0;h<k.update.rows.length;h++)for(var m=0;m<k.update.rows[h].fields.length;m++)-1!==d.indexOf(k.update.rows[h].fields[m].name)&&(k.update.rows[h].fields[m].visible=!1);a.oSubformScope.loadSubForm({sFormDefinitionName:"update",oFormDefinition:k,oFormValues:{update:angular.copy(b)},oProperties:a.oProperties})}b=a.olSelectedFeature.Fu();null!=b.draw&&(a.featureForm.draw=b.draw);null!=b.text&&(a.featureForm.text=b.text)}else a.featureForm.attributes=
{},null!=a.oSubformScope&&a.oSubformScope.setFormValues({update:{}});null!=a.olSelectedFeature?(b=a.aFeatures.indexOf(a.olSelectedFeature),c.b.gridApi.selection.clearSelectedRows(),c.b.gridApi.selection.selectRowByVisibleIndex(b)):a.clearSelectedFeature(!1)});wB(this)};OA.mf.$inject=["$scope","$log"];mB.module.controller("AppMapWorkbenchController",OA.mf);
function wB(a){a.K.info("MapWorkbenchController.loadIconsList_");var b=it.prototype.Ng.Mu,c=it.prototype.Ng.fonts,d=[],e,f;for(f in b)null!=b[f].font&&null!=c[b[f].font]!=null&&(e="",null!=c[b[f].font].prefix!=null&&(e+=c[b[f].font].prefix,e+=" "),e+=f,d.push({def:f,"class":e}));a.b.$applyAsync(function(a){a.aIcons=d;a.sSelectedIcon=d[0]["class"];a.featureForm.draw.symbol=d[0].def})}
function uB(a){a.K.info("MapWorkbenchController.updateFeatureStyleFromForm_");a.b.olSelectedFeature.vw(a.b.featureForm)}function vB(a){a.K.info("MapWorkbenchController.updateFeatureAttributes_");a.b.olSelectedFeature.set("attributes",a.b.featureForm.attributes)}
OA.mf.prototype.BN=function(){this.K.info("MapWorkbenchController.showAddFeatureModal");for(var a=this,b=this.b.field.custom_form.featureStructure.field,c=angular.copy(this.b.field.custom_form.form),d=!1,e=0;e<c.update.rows.length;e++)for(var f=0;f<c.update.rows[e].fields.length;f++)c.update.rows[e].fields[f].name!==b&&(c.update.rows[e].fields[f].visible=!1,d=!0);if(!d)return console.error("Field "+b+" not present in the form"),null;angular.element("#map_workbench_"+this.b.sFormUniqueName+"_feature_type_modal_subform").scope().loadSubForm({sFormDefinitionName:"update",
oFormDefinition:c,oFormValues:{update:{}},oProperties:this.b.oProperties});this.b.clearSelectedFeature();setTimeout(function(){$("#map_workbench_"+a.b.sFormUniqueName+"_feature_type_modal").modal("show")})};OA.mf.prototype.showAddFeatureModal=OA.mf.prototype.BN;
OA.mf.prototype.xb=function(){this.K.info("MapWorkbenchController.addFeature");var a=this,b=angular.element(v.f).injector().get(["formSrvc"]),c=this.b.field.custom_form.featureStructure.field,d=this.b.field.custom_form.featureStructure.types,e=angular.copy(this.b.field.custom_form.form),f=angular.element("#map_workbench_"+this.b.sFormUniqueName+"_feature_type_modal_subform").scope(),g=b.getFormData("update",!0,{oFormDefinition:e,oFormValues:kb(f.oSubformValues)}),b=null;null!=g[c]&&null!=d[g[c]]&&
(b=null!=d[g[c]].geometryType?d[g[c]].geometryType:"all");aB(this.b.oMap,function(b){setTimeout(function(){var d=b.get("attributes"),d=ha(d)?d:{};d[c]=g[c];b.set("attributes",d);setTimeout(function(){sB(a,b)})})});tB(this);null!=b?(xB(this,b),$("#map_workbench_"+this.b.sFormUniqueName+"_feature_type_modal").modal("hide")):$.notify("Veuillez s\u00e9lectionner un type","error")};OA.mf.prototype.addFeature=OA.mf.prototype.xb;
OA.mf.prototype.DG=function(){this.K.info("MapWorkbenchController.deleteSelectedFeature");var a=this;if(null==this.b.olSelectedFeature)return $.notify("Aucune g\u00e9o\u00e9trie s\u00e9lectionn\u00e9e","error"),null;bootbox.confirm("Supprimer d\u00e9finitivement la g\u00e9om\u00e9trie ?",function(b){b&&(a.b.oMap.Jb(a.b.olSelectedFeature),a.b.olSelectedFeature=null,setTimeout(function(){UA(a.b.oMap)}))})};OA.mf.prototype.deleteSelectedFeature=OA.mf.prototype.DG;
function sB(a,b){a.K.info("MapWorkbenchController.setStyleFromType_");if(null!=b){var c=a.b.field.custom_form.featureStructure.field,d=a.b.field.custom_form.featureStructure.types;b=b.get("attributes");if(null!=b[c]&&null!=d[b[c]]&&null!=d[b[c]].style){var c=angular.copy(d[b[c]].style),e;for(e in c)for(var f in c[e])r(c[e][f])&&"{{"===c[e][f].substr(0,2)&&"}}"===c[e][f].substr(-2,2)&&(d=c[e][f].substr(2,c[e][f].length-4),c[e][f]=null!=b[d]?b[d]:"");a.b.featureForm.draw=c.draw;a.b.featureForm.text=
c.text}}}
function xB(a,b){a.K.info("MapWorkbenchController.activeDrawInteraction_");switch(b){case "all":a.b.field.map_options.interactions.point=!0;a.b.field.map_options.interactions.line=!0;a.b.field.map_options.interactions.polygon=!0;break;case "point":a.b.field.map_options.interactions.point=!0;break;case "line":a.b.field.map_options.interactions.line=!0;break;case "polygon":a.b.field.map_options.interactions.polygon=!0;break;default:console.error("Bad sGeometryType: ",b);return}a.b.oMap.setInteractions(a.b.field.map_options.interactions);"point"!==
b&&"line"!==b&&"polygon"!==b||a.b.oMap.activeInteraction(b)}function tB(a){a.K.info("MapWorkbenchController.unactiveDrawInteractions_");for(var b="point line polygon DP DL DPol RA remove_all RO remove".split(" "),c=0;c<b.length;c++)null!=a.b.oMap&&null!=a.b.oMap.removeInteraction&&a.b.oMap.removeInteraction(b[c]),null!=a.b.field.map_options.interactions[b[c]]&&(a.b.field.map_options.interactions[b[c]]=!1)};mB.directive={};mB.directive.cQ={};
function yB(a,b,c,d,e){return{restrict:"A",scope:{oProperties:"=?appProperties",oFormValues:"=?appFormValues",oFormDefinition:"=?appFormDefinition",sFormDefinitionName:"=?appFormDefinitionName",oFormEventsContainer:"=?appFormEventsContainer",wabState:"=?appWabState",wabGroup:"=?appWabGroup",showTabs:"=?appTabs"},controller:"AppFormReaderController",controllerAs:"ctrl",templateUrl:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/"+sessionStorage.appEnv+
"/javascript/externs/formReader/formReader.html",link:function(f,g){d.log("formReader.formReaderDirective.link");f.showTabs="false"===f.showTabs||!1===f.showTabs?f.showTabs=!1:f.showTabs=!0;f.wabState=null!=f.wabState&&""!==f.wabState?f.wabState:null;f.wabGroup=null!=f.wabGroup&&""!==f.wabGroup?f.wabGroup:null;f.submitButton=!1;f.oFormEventsContainer=n(f.oFormEventsContainer)?f.oFormEventsContainer:f;b.oProperties=f.oProperties;b.oFormValues=f.oFormValues;b.oFormDefinition=f.oFormDefinition;b.sFormDefinitionName=
f.sFormDefinitionName;b.oFormEventsContainer=f.oFormEventsContainer;var h=f.$root.$on("formDefinitionLoaded",function(a,b){h();null!=f.oFormDefinition&&null!=f.oFormDefinition[b]&&null!=f.oFormDefinition[b].wab&&(f.showTabs=!1,f.wabState=f.oFormValues[b].status_name,f.userGroups=[],A({method:"GET",url:c.web_server_name+"/"+c.services_alias+"/vitis/users/"+sessionStorage.user_id,scope:f,headers:{Accept:"application/x-vm-json"},success:function(a){f.userGroups=a.data.data[0].groups_label.split(",");
for(var c in f.oFormDefinition[b].wab[f.wabState])if(-1<f.userGroups.indexOf(c)){f.wabGroup=c;break}null!=f.wabGroup||console.warn("this user can't see this form");f.$root.$emit("wabGroupLoaded",f.wabGroup)}}),null!=f.wabGroup||console.warn("this user can't see this form"))});f.isFormTextElement=function(a){return-1!=="text password datetime datetime-local date month time week integer float number email url search tel color".split(" ").indexOf(a)?!0:!1};f.sendForm=function(){d.log("scope.sendForm");
if(!0===f[f.oFormDefinition[f.sFormDefinitionName].name].$valid){var c=a.defer(),e=c.promise,g=f.oFormDefinition[f.sFormDefinitionName].beforeEvent;"undefined"!==typeof g?r(g)?a.when(b.callFunction(g)).then(function(){c.resolve()}):ga(g)&&a.when(g(f.oFormValues)).then(function(){c.resolve()}):c.resolve();e.then(function(){c=a.defer();e=c.promise;var d=f.oFormDefinition[f.sFormDefinitionName].event;"undefined"!==typeof d?r(d)?a.when(b.callFunction(d)).then(function(){c.resolve()}):ga(d)&&a.when(d(f.oFormValues)).then(function(){c.resolve()}):
c.resolve();e.then(function(){var a=f.oFormDefinition[f.sFormDefinitionName].afterEvent;"undefined"!==typeof a&&(r(a)?b.callFunction(a):ga(a)&&a(f.oFormValues))})})}};f.testElementsValidityTab=function(a){d.log("scope.testElementsValidityTab");var c=f.oFormDefinition[f.sFormDefinitionName].name;if(!0===!f[c].$valid){for(var e=b.getAllFormElementDefinition(f.sFormDefinitionName,f.oFormDefinition),g=[],h=0;h<e.length;h++)null!=e[h].name&&null!=f[c][e[h].name]&&(f[c][e[h].name].$valid||g.push(e[h].name));
if(null!=g[0]&&null!=f.oFormDefinition[f.sFormDefinitionName].tabs&&null!=f.oFormDefinition[f.sFormDefinitionName].tabs.list)for(c=f.oFormDefinition[f.sFormDefinitionName].tabs.list,h=0;h<c.length;h++)if(-1!==c[h].elements.indexOf(g[0])){f.iDisplayedTab=h;break}}null!=a&&a.call()};f.executeButtonEvent=function(a,c){d.log("scope.executeButtonEvent");r(c)?b.callFunction(c):ga(c)&&c(f.oFormValues)};f.getValidationCssClass=function(a){if("undefined"!=typeof a){var b=f.oFormDefinition[f.sFormDefinitionName].name;
if("undefined"!=typeof f[b]&&"undefined"!=typeof f[b][a]&&f[b][a].$invalid&&f[b][a].$dirty)return"has-error"}};f.switchSelectedOptions=function(a,c,e,g){d.log("scope.switchSelectedOptions");e=f.oFormValues[a][e];f.oFromSelect=e;"undefined"!==typeof c.switch_event&&b.isFunctionCall(c.switch_event)&&(r(c.switch_event)?b.callFunction(c.switch_event):ga(c.switch_event)&&c.switch_event(f.oFormValues));if(0<e.selectedOption.length){a=f.oFormValues[a][g];for(c=0;c<e.selectedOption.length;)1!=e.selectedOption[c].disabled&&
a.options.unshift(e.options.splice(e.options.indexOf(e.selectedOption[c]),1)[0]),c++;e.selectedOption=[]}};f.reloadSelectField=function(a,c){b.reloadSelectField(a,c,f.oFormValues,f.oFormDefinition)};f.isStringNotEmpty=function(a){return null==a||!r(a)||0< !a.length?!1:!0};f.getLinkFileName=function(a){if(!r(a))return"";-1!==a.lastIndexOf("/")&&(a=a.substr(a.lastIndexOf("/")+1));-1!==a.lastIndexOf("?")&&(a=a.substr(0,a.lastIndexOf("?")));return a};f.isFieldPresent=function(a,b,c){var d=!0;if(!1===
a.visible||"false"===a.visible)d=!1;var e=!1;-1!==b.elements.indexOf(a.name)&&(e=!0);!0===a.visibleAllTabs&&(e=!0);null!=a.buttons&&!1===(null!=c?c:!1)&&(e=!0);f.showTabs||(e=!0);if(this.useWab()){var g=!1;b=this.getWabField(a);if("r"===b||"rw"===b)g=!0;null!=a.buttons&&(g=!0);"r"===b&&(a.disabled=!0)}return null!=g?d&&e&&g?!0:!1:d&&e?!0:!1};f.isButtonPresent=function(a,b,c){var d=!0;if(!1===a.visible||"false"===a.visible)d=!1;var e=!1;-1!==c.elements.indexOf(a.name)&&(e=!0);!0===a.visibleAllTabs&&
(e=!0);this.isFieldPresent(b,c,!0)&&(e=!0);if(this.useWab()){var f=!1;c=this.isFieldPresent(b,c,!0)?this.getWabField(b):this.getWabField(a);if("r"===c||"rw"===c)f=!0;"r"===c&&(a.disabled=!0);""==c&&(b.visible=!1)}return null!=f?d&&e&&f?!0:!1:d&&e?!0:!1};f.getWabField=function(a){if(null!=f.wabState&&null!=f.wabGroup&&null!=f.oFormDefinition&&null!=f.oFormDefinition[f.sFormDefinitionName]&&null!=f.oFormDefinition[f.sFormDefinitionName].wab&&null!=f.oFormDefinition[f.sFormDefinitionName].wab[f.wabState]&&
null!=f.oFormDefinition[f.sFormDefinitionName].wab[f.wabState][f.wabGroup]){var b=f.oFormDefinition[f.sFormDefinitionName].wab[f.wabState][f.wabGroup];if(null!=b[a.name])return b[a.name]}return null};f.useWab=function(){var a=!1;null!=f.wabState&&null!=f.wabGroup&&null!=f.oFormDefinition&&null!=f.oFormDefinition[f.sFormDefinitionName]&&null!=f.oFormDefinition[f.sFormDefinitionName].wab&&(a=!0);return a};f.compileTemplate=function(){A({method:"GET",url:c.web_server_name+"/"+sessionStorage.appEnv+"/javascript/externs/formReader/formReader.html",
scope:f,success:function(a){if(null==a.data)return console.error("template not founded"),0;a=e(a.data)(f);g.children().replaceWith(a)}})};f.resetFileInputs=function(){$(g).find(".file").each(function(){$(this).fileinput("clear")})};f.$on("$destroy",function(){f.$root.clearFormData(f.sFormDefinitionName,f)});f.$on("loadForm",function(){f.resetFileInputs()})}}}mB.formReaderDirective=yB;yB.$inject=["$q","formReaderService","propertiesSrvc","$log","$compile"];mB.module.directive("appFormReader",yB);
mB.Zx=function(a,b,c,d,e,f){return{link:function(b,h){e.log("formReader.appFormFieldSpecificParamsDrtv.link");if("undefined"!==typeof b.field.attributes)for(var g=0,m=Object.keys(b.field.attributes);g<m.length;)h[0].setAttribute(m[g],b.field.attributes[m[g]]),g++;!0===b.field.autofocus&&h[0].focus();switch(b.field.type){case "captcha":a(function(){grecaptcha.render(b.field.id,{sitekey:b.field.key,callback:function(a){b.oFormValues[b.sFormDefinitionName][b.field.name]=a}})},10);break;case "date":case "datetime":g=
{useCurrent:!1};mb(g,{date:{fr:{locale:"fr",format:"DD/MM/YYYY"},en:{format:"MM/DD/YYYY"}},datetime:{fr:{locale:"fr",format:"DD/MM/YYYY HH:mm"},en:{format:"MM/DD/YYYY HH:mm"}}}[b.field.type][c.language]);"undefined"!==typeof b.field.options&&mb(g,b.field.options);$(h).datetimepicker(g);$(h).on("dp.change",function(){b.oFormValues[b.sFormDefinitionName][h[0].name]=h[0].value});break;case "checkbox":"undefined"==typeof b.oFormValues[b.sFormDefinitionName][b.field.name]&&(b.oFormValues[b.sFormDefinitionName][b.field.name]=
"undefined"!=typeof b.field.default_value?b.field.default_value:!1);break;case "upload":h[0].addEventListener("change",function(){b.oFormValues[b.sFormDefinitionName][h[0].name]={aFiles:this.files}},!1);g={showPreview:!1,showRemove:!0,showUpload:!1};"undefined"!==typeof b.field.options&&mb(g,b.field.options);g.mainClass="input-file-"+b.oFormDefinition[b.sFormDefinitionName].input_size;"en"!=c.language&&(g.language=c.language);$(h).fileinput(g);break;case "file_wsdata":h[0].addEventListener("change",
function(){b.oFormValues[b.sFormDefinitionName][h[0].name]={aFiles:this.files}},!1);if(null!=b.field.extensions){var g=b.field.extensions.split("|"),p;for(p in g)g[p]="."+g[p];h[0].setAttribute("accept",g.join(","))}g={showPreview:!1,showRemove:!1,showUpload:!1};"undefined"!==typeof b.field.options&&mb(g,b.field.options);g.mainClass="input-file-"+b.oFormDefinition[b.sFormDefinitionName].input_size;"en"!=c.language&&(g.language=c.language);$(h).fileinput(g);break;case "image_wsdata":null!=b.field.display_width||
(b.field.display_width="100%");h[0].addEventListener("change",function(){var a={aFiles:this.files};null!=b.field.width&&null!=b.field.height&&(a.width=b.field.width,a.height=b.field.height);b.oFormValues[b.sFormDefinitionName][h[0].name]=a},!1);g={showPreview:!1,showRemove:!1,showUpload:!1,allowedFileTypes:["image"]};g.mainClass="input-file-"+b.oFormDefinition[b.sFormDefinitionName].input_size;"en"!=c.language&&(g.language=c.language);$(h).fileinput(g);break;case "email":b.field.pattern="^(([a-zA-Z]|[0-9])|([-]|[_]|[.]))+[@](([a-zA-Z]|[0-9])|([-]|[_]|[.])){2,63}[.](([a-zA-Z0-9]){2,63})+$";
var t=angular.copy(b.field.pattern);b.$watch("oFormValues."+b.sFormDefinitionName+'["'+b.field.name+'"]',function(){b.field.pattern=angular.copy(t);a(function(){if(-1!==h[0].className.indexOf("ng-invalid-pattern")){var a;a="fr"===b.oProperties.language?"ceci n'est pas une adresse mail":"this is not a mail adress";$(h).notify(a,{position:"top",className:"error",autoHide:!1,clickToHide:!1})}else{a=h[0].parentNode.children;for(var c=-1,d=0;d<a.length;d++)"notifyjs-wrapper"===a[d].className&&(c=d);-1<
c&&$(a[c]).remove()}},1)});break;case "url":b.field.pattern="^https?:\\/\\/.{1,}";t=angular.copy(b.field.pattern);b.$watch("oFormValues."+b.sFormDefinitionName+'["'+b.field.name+'"]',function(){b.field.pattern=angular.copy(t);a(function(){if(-1!==h[0].className.indexOf("ng-invalid-pattern")){var a;a="fr"===b.oProperties.language?"ce champ doit contenir une url qui commence\n par http:// ou https://":"this field must contain an url that begin\n by http:// or https://";$(h).notify(a,{position:"top",
className:"error",autoHide:!1,clickToHide:!1})}else{a=h[0].parentNode.children;for(var c=-1,d=0;d<a.length;d++)"notifyjs-wrapper"===a[d].className&&(c=d);-1<c&&$(a[c]).remove()}},1)});break;case "integer":"undefined"!==typeof b.field.min&&h[0].setAttribute("min",b.field.min);"undefined"!==typeof b.field.max&&h[0].setAttribute("max",b.field.max);"undefined"!==typeof b.field.max_length&&h[0].setAttribute("maxLength",b.field.max_length);b.$parent.valid=!0;b.numberUpdate=function(){var a=b.oFormValues[b.sFormDefinitionName][h[0].name];
!n(a)||"string"!==typeof a&&"number"!==typeof a?console.error("bad type argument"):"string"===typeof a?(a=b.ctrl.numberParser(a,!0),b.oFormValues[b.sFormDefinitionName][h[0].name]=isNaN(a)?"":a):b.oFormValues[b.sFormDefinitionName][h[0].name]=a};a(function(){b.oFormValues[b.sFormDefinitionName][h[0].name]+=" ";b.numberUpdate()},500);break;case "float":case "number":"undefined"!==typeof b.field.min&&h[0].setAttribute("min",b.field.min);"undefined"!==typeof b.field.max&&h[0].setAttribute("max",b.field.max);
"undefined"!==typeof b.field.max_length&&h[0].setAttribute("maxLength",b.field.max_length);b.$parent.valid=!0;b.numberUpdate=function(){var a=b.oFormValues[b.sFormDefinitionName][h[0].name];!n(a)||"string"!==typeof a&&"number"!==typeof a?console.error("bad type argument"):"string"===typeof a?(a=b.ctrl.numberParser(a,!1),b.oFormValues[b.sFormDefinitionName][h[0].name]=isNaN(a)&&"string"!==typeof a?"":a):b.oFormValues[b.sFormDefinitionName][h[0].name]=a};a(function(){b.oFormValues[b.sFormDefinitionName][h[0].name]+=
" ";b.numberUpdate()},500);break;case "image_wsdata":null!=b.field&&(null==b.field.width||0!=b.field.width&&"0px"!=b.field.width||(b.field.width=null),null==b.field.style||null==b.field.style.height||0!=b.field.style.height&&"0px"!=b.field.style.height||(b.field.style.height=null));break;case "image":null!=b.field&&(null==b.field.width||0!=b.field.width&&"0px"!=b.field.width||(b.field.width=null),null==b.field.style||null==b.field.style.height||0!=b.field.style.height&&"0px"!=b.field.style.height||
(b.field.style.height=null));g={inline:!1,button:!0,navbar:!1,title:2,toolbar:2,tooltip:!0,fullscreen:!1,url:function(){return b.oProperties.web_server_name+"/"+b.oProperties[b.field.alias]+"/"+b.field.folder+"/"+b.oFormValues[b.sFormDefinitionName][b.field.name]}};b.viewer=new Viewer(h[0],g);b.openViewer=function(){e.log("openViewer");b.viewer.show();angular.element(".viewer-prev").remove();angular.element(".viewer-next").remove()};break;case "imageurl":null!=b.field&&(null==b.field.width||0!=b.field.width&&
"0px"!=b.field.width||(b.field.width=null),null==b.field.style||null==b.field.style.height||0!=b.field.style.height&&"0px"!=b.field.style.height||(b.field.style.height=null));g={inline:!1,button:!0,navbar:!1,title:2,toolbar:2,tooltip:!0,fullscreen:!1,url:function(){return b.oFormValues[b.sFormDefinitionName][b.field.name]}};b.viewer=new Viewer(h[0],g);b.openViewer=function(){e.log("openViewer");b.viewer.show();angular.element(".viewer-prev").remove();angular.element(".viewer-next").remove()};break;
case "select":case "editable_select":var u=b.field,g=b.oFormValues[b.sFormDefinitionName][b.field.name];"string"!=typeof g||isNaN(g)||1!=g.length&&-1==g.search(/^[1-9][0-9]+$/)||(b.oFormValues[b.sFormDefinitionName][b.field.name]=Number(g));"undefined"!==typeof u.multiple&&!0===u.multiple&&h[0].setAttribute("multiple","");"undefined"!==typeof u.size&&(h[0].setAttribute("size",u.size),h[0].style.height="auto");if(r(u.options)){p=u.options.split(",");for(g=0;g<p.length;g++)m=p[g].split("|"),p[g]={label:m[0],
value:m[1]};b.oFormValues[b.sFormDefinitionName][u.name].options=p}"undefined"!=typeof b.field.child_select&&h[0].addEventListener("change",function(){b.reloadSelectField(b.field,b.sFormDefinitionName)},!1);null!=u.onchange&&h[0].addEventListener("change",function(){if(d.isFunctionCall(u.onchange))if(r(u.onchange))d.callFunction(u.onchange);else if(ga(u.onchange))u.onchange(b.oFormValues)},!1);break;case "map_bing":case "map_osm":case "map_vmap":var w=function(){n(b.oMap)&&(b.oMap.ca.yi(null),delete b.oMap);
b.oMap=new PA({target:h[0],options:b.field.map_options,hiddenFieldId:b.field.id,oFormValues:b.oFormValues[b.sFormDefinitionName],sFormName:b.field.name,oProj:b.$root.proj});"undefined"!=typeof b.field.style&&"undefined"!=typeof b.field.style.height&&"ratio"==b.field.style.height&&(b.field.style.height=parseInt(h[0].clientWidth/(window.innerWidth/window.innerHeight))+"px");b.$root.$emit("OpenLayersMapCreated",b.oMap);b.oMap.on("moveend",function(){b.field.map_options.center=b.oMap.getConfig();b.$apply()},
b.oMap)};setTimeout(function(){w();b.$watch("field.nb_cols",function(){a(function(){b.oMap.ca.Qd()})});b.$watch("field.style",function(){a(function(){b.oMap.ca.Qd()})},!0);b.$watch("oMap.bLayersTreeOpen",function(){a(function(){b.oMap.ca.Qd()})},!0);b.$on("studio resized",function(){b.oMap.ca.Qd()});b.$on("updateMap",function(a,c){switch(c){case "center":b.oMap.setCenter([b.field.map_options.center.coord[0],b.field.map_options.center.coord[1]]);break;case "zoom":b.oMap.setZoom(b.field.map_options.center.zoom);
break;case "source":b.oMap.setBingSource(b.field.map_options.source);break;case "extent":b.oMap.setExtent(b.field.map_options.center.extent);break;case "controls":b.oMap.setControls(b.field.map_options.controls);break;case "interact":b.oMap.setInteractions(b.field.map_options.interactions);break;case "proj":a=b.oMap.getExtent();c=b.oMap.getCenter();var d=b.oMap.getProj();b.field.map_options.center.extent=b.oMap.transformExtent(a,d,b.field.map_options.proj);b.field.map_options.center.coord=b.oMap.transformer(c,
d,b.field.map_options.proj);w();break;default:w()}})});break;case "slider":b.field.options.id=b.field.id+"_slider";$(h).slider(b.field.options);null!=b.oFormValues[b.sFormDefinitionName][b.field.name]||(b.oFormValues[b.sFormDefinitionName][b.field.name]=0);$(h).on("slide",function(){b.oFormValues[b.sFormDefinitionName][b.field.name]=$(h).slider("getValue")});b.$watch("oFormValues."+b.sFormDefinitionName+'["'+b.field.name+'"]',function(){setTimeout(function(){null!=$(h)&&null!=b.oFormValues&&null!=
b.oFormValues[b.sFormDefinitionName]&&null!=b.oFormValues[b.sFormDefinitionName][b.field.name]&&$(h).slider("setValue",parseFloat(b.oFormValues[b.sFormDefinitionName][b.field.name]))},10)});b.$watch("field.options",function(){setTimeout(function(){$(h).slider(b.field.options)},10)},!0);break;case "color_picker":$(h).colorpicker({format:"rgba"});$(h).on("changeColor",function(){b.oFormValues[b.sFormDefinitionName][b.field.name]=$(h).colorpicker("getValue")});b.$watch("oFormValues."+b.sFormDefinitionName+
'["'+b.field.name+'"]',function(){setTimeout(function(){null!=$(h)&&null!=b.oFormValues&&null!=b.oFormValues[b.sFormDefinitionName]&&null!=b.oFormValues[b.sFormDefinitionName][b.field.name]&&$(h).colorpicker("setValue",b.oFormValues[b.sFormDefinitionName][b.field.name])},10)});break;case "double_select":g=parseInt($(h).css("line-height"))-1;"undefined"!==typeof b.field.size&&(h[0].style.minHeight=g*b.field.size+"px");break;case "password":if("undefined"===typeof b.field.autocomplete||!1===b.field.autocomplete)if(h[0].readOnly=
!0,null===document.getElementById("FormBuilder"))var x=b.$root.$on("endFormNgRepeat",function(){a(function(){h[0].readOnly=!1},300);x()});else a(function(){h[0].readOnly=!1},300);break;case "text":"undefined"!==typeof b.field.max_length&&h[0].setAttribute("maxLength",b.field.max_length);break;case "treeview":var z=angular.copy(b.field.options);null!=z.dataLoadingEvent&&""!=z.dataLoadingEvent?(b.$root.waitForTreeviewDataLoaded=function(){var a=f.defer(),c=b.$root.$on(z.dataLoadingEvent,function(b,
d){c();a.resolve(d)});return a.promise},null!=z.data&&""!=z.data&&d.isFunctionCall(z.data)&&d.callFunction(z.data),z.data="waitForTreeviewDataLoaded()"):d.isFunctionCall(z.data)||(b.$root.getTreeviewData=function(){var a=f.defer();a.resolve(b.field.options.data);return a.promise},z.data="getTreeviewData()");null!=z.data&&""!=z.data&&d.callFunction(z.data).then(function(a){z.data=a;"undefined"!=typeof z.showCheckbox&&!0===z.showCheckbox&&(this.setTreeviewNodesState=function(a){for(var c in a)if("undefined"!=
typeof a[c].nodes)this.setTreeviewNodesState(a[c].nodes);else{"undefined"==typeof a[c].state&&(a[c].state={});var d=[],e=b.oFormValues[b.sFormDefinitionName][b.field.name];"string"==typeof e&&""!=e&&(d=e.split("|"));-1!=d.indexOf(String(a[c].value))&&(a[c].state.checked=!0)}},this.setTreeviewNodesState(z.data),z.onNodeChecked=function(a,c){if("undefined"!=typeof c.nodes)for(var d in c.nodes)$(h).treeview("checkNode",c.nodes[d].nodeId);else a=[],"undefined"!=typeof c.value&&(d=b.oFormValues[b.sFormDefinitionName][b.field.name],
"string"==typeof d&&""!=d&&(a=d.split("|")),a.push(c.value),b.oFormValues[b.sFormDefinitionName][b.field.name]=a.join("|"))},z.onNodeUnchecked=function(a,c){if("undefined"!=typeof c.nodes)for(var d in c.nodes)$(h).treeview("uncheckNode",c.nodes[d].nodeId);else a=[],"undefined"!=typeof c.value&&(d=b.oFormValues[b.sFormDefinitionName][b.field.name],"string"==typeof d&&""!=d&&(a=d.split("|")),a.splice(a.indexOf(c.value),1),b.oFormValues[b.sFormDefinitionName][b.field.name]=a.join("|"))});$(h).treeview(z)});
break;case "foldermanager":z=angular.copy(b.field.options);z.data=[];"undefined"!=typeof z.showCheckbox&&!0===z.showCheckbox&&(this.setTreeviewNodesState=function(a){for(var c in a)if("undefined"!=typeof a[c].nodes)this.setTreeviewNodesState(a[c].nodes);else{"undefined"==typeof a[c].state&&(a[c].state={});var d=[],e=b.oFormValues[b.sFormDefinitionName][b.field.name];"string"==typeof e&&""!=e&&(d=e.split("|"));-1!=d.indexOf(String(a[c].value))&&(a[c].state.checked=!0)}},this.setTreeviewNodesState(z.data),
null!=z.recursiveCheck||(z.recursiveCheck=!0),z.onNodeChecked=function(a,c){if("undefined"!=typeof c.nodes&&z.recursiveCheck)for(var d in c.nodes)$(h).treeview("checkNode",c.nodes[d].nodeId);else a=[],"undefined"!=typeof c.value&&(d=b.oFormValues[b.sFormDefinitionName][b.field.name],"string"==typeof d&&""!=d&&(a=d.split("|")),a.push(c.value),b.oFormValues[b.sFormDefinitionName][b.field.name]=a.join("|"))},z.onNodeUnchecked=function(a,c){console.log(c);if("undefined"!=typeof c.nodes&&z.recursiveCheck)for(var d in c.nodes)$(h).treeview("uncheckNode",
c.nodes[d].nodeId);else a=[],"undefined"!=typeof c.value&&(d=b.oFormValues[b.sFormDefinitionName][b.field.name],"string"==typeof d&&""!=d&&(a=d.split("|")),a.splice(a.indexOf(c.value),1),b.oFormValues[b.sFormDefinitionName][b.field.name]=a.join("|"))});$(h).treeview(z);var D=b.$on("update_data_treeview_"+b.field.id,function(a,b){null!=b&&(z.data=b,$(h).treeview(z))});b.$on("$destroy",function(){D()});null!=b.field.loadDataFunction&&d.callFunction(b.field.loadDataFunction)}"undefined"!=typeof b.field.read_only&&
1==b.field.read_only&&(h[0].readOnly=!0)}}};mB.Zx.$inject="$timeout $translate propertiesSrvc formReaderService $log $q".split(" ");mB.module.directive("appFormFieldSpecificParams",mB.Zx);
mB.$x=function(a,b,c,d){return{link:function(e,f){d.log("formReader.appFormRowNgRepeatDrtv.link");if("undefined"!=typeof e.row.tab){var g=!1,h=e.sFormDefinitionName+"_"+e.row.tab.parent+"_tab_container";if(null==document.getElementById(h)){var k=document.createElement("div");k.className="tab-content";k.id=h;f[0].parentNode.insertBefore(k,f[0]);g=!0}document.getElementById(h).appendChild(f[0]);f[0].id=e.sFormDefinitionName+"_"+e.row.tab.name+"_tab";f[0].setAttribute("role","tabpanel");a(function(){f[0].className+=
" tab-pane fade";g&&(f[0].className+=" in active")})}a(function(){e.$last&&b.$emit("endFormNgRepeat",c.oSelectedObject.name)})}}};mB.$x.$inject=["$timeout","$rootScope","envSrvc","$log"];mB.module.directive("appFormRowNgRepeat",mB.$x);
function zB(a,b,c,d,e){return{link:function(f,g){"string"==typeof f.field.default_value&&/^[A-Z0-9_]+$/.test(f.field.default_value)&&a([f.field.default_value]).then(function(a){f.oFormValues[f.sFormDefinitionName][f.field.name]==f.field.default_value&&(f.oFormValues[f.sFormDefinitionName][f.field.name]=a[f.field.default_value])});"undefined"!=typeof f.field.name&&-1!=f.field.name.indexOf(".")&&(f.oFormValues[f.sFormDefinitionName][f.field.name]=c.getFormValueFromObject(f.oFormValues[f.sFormDefinitionName],
f.field.name));"undefined"!==typeof f.field.visible&&c.isFunctionCall(f.field.visible)&&(f.field.visible=f.$eval(f.field.visible));if("editable_double_select"===f.field.type)var h=f.$root.$on("webServiceTagsloaded",function(a,c){h();1!=c.webServiceTagsloaded&&(c.webServiceTagsloaded=!0,b(function(){var a={};"undefined"!==typeof c.options&&(a=c.options);$("#"+c.id).tagsinput(a);$("#"+c.id_available_tags).tagsinput(a);$("#"+c.id).on("itemRemoved itemAdded",function(a){"itemRemoved"==a.type?($("#"+c.id_available_tags).tagsinput("add",
a.item),f.$root.setTagsInput([c.id_available_tags])):f.$root.setTagsInput([c.id])});$("#"+c.id_available_tags).on("itemRemoved itemAdded",function(a){"itemRemoved"==a.type?($("#"+c.id).tagsinput("add",a.item),f.$root.setTagsInput([c.id])):f.$root.setTagsInput([c.id_available_tags])});f.$root.setTagsInput([c.id_available_tags,c.id])}))});else if("ui_grid"==f.field.type||"bo_grid"==f.field.type||"section_grid"==f.field.type){null!=f.field.options||(f.field.options={enableRowSelection:!0,enableSelectAll:!0,
enablePagination:!1,enablePaginationControls:!1,enableColumnMenus:!1,enableColumnResizing:!1,appHeader:!0,appHeaderTitleBar:!0,columnDefs:[],data:[]});"undefined"!=typeof f.field.options.appDisableRowSelection&&!0===f.field.options.appDisableRowSelection&&(f.field.options.isRowSelectable=function(){return!1});f.gridOptions=angular.copy(f.field.options);var k=[],m=angular.copy(f.gridOptions.columnDefs);m.forEach(function(a){k.push(a.name)});a(k).then(function(a){k.forEach(function(b,c){m[c].name=a[b];
m[c].displayName=a[b]});f.gridOptions.columnDefs=angular.copy(m)});!0===f.gridOptions.appEnableDragAndDrop&&(f.gridOptions.rowTemplate='<div grid="grid" class="ui-grid-draggable-row" draggable="true"><div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader, \'custom\': true }" ui-grid-cell></div></div>');f.gridOptions.onRegisterApi=function(a){f.$root.$emit("registeredUiGridApi",a);
f.gridApi=a;b(function(){e.resizeWin();a.core.handleWindowResize()});f.gridOptions.gridApi=a;b(function(){if(f.gridOptions.enableRowSelection)$(a.grid.element).find(".ui-grid-render-container-body").on("click.selectRow",function(a){a=a.target;if($(a).hasClass("ui-grid-cell")||$(a).hasClass("ui-grid-cell-contents"))a=$(g).find(".ui-grid-render-container-body .ui-grid-canvas").children().index($(a).parents(".ui-grid-row")),$(g).find(".ui-grid-render-container-left .ui-grid-row").eq(a).find(".ui-grid-selection-row-header-buttons").click()})});
"undefined"!==typeof a.dragndrop&&(!0===f.gridOptions.appEnableDragAndDrop?(a.dragndrop.setDragDisabled=!1,a.draggableRows.on.rowDragged(f,function(){}),a.draggableRows.on.rowFinishDrag(f,function(){if("undefined"!==typeof f.gridOptions.appDragAndDropEvent&&"undefined"!==typeof f.gridOptions.appDragAndDropEvent.rowFinishDrag)if(ga(f.$root[f.gridOptions.appDragAndDropEvent.rowFinishDrag]))f.$root[f.gridOptions.appDragAndDropEvent.rowFinishDrag]();else console.error(f.gridOptions.appDragAndDropEvent.rowFinishDrag+
" is not a function of scope.$root")}),a.draggableRows.on.rowEnterRow(f,function(){}),a.draggableRows.on.beforeRowMove(f,function(){})):a.dragndrop.setDragDisabled=!0);g[0].querySelector(".ui-grid-render-container-body").style.height="100%";g[0].querySelector(".ui-grid-render-container-body .ui-grid-viewport").style.height="Calc(100% - 30px)"}}else"codemirror"==f.field.type&&("undefined"!=typeof f.field.codemirrorOptions&&(f.field.cm_options=f.field.codemirrorOptions),null!=f.field.cm_options&&(f.field.cm_options.onLoad=
function(a){"undefined"==typeof f.oCodeMirrorEditor&&(f.oCodeMirrorEditor={});f.oCodeMirrorEditor[a.options.appName]=a;a.on("change",function(){if("undefined"!=typeof a.options.appMaxHeight){var b=a.options.appMaxHeight,c=a.getDoc().lineCount(),d=a.defaultTextHeight();-1!=b.indexOf("%")?b=parseInt(window.innerHeight*parseInt(b)/100):-1!=b.indexOf("l")?b=parseInt(parseInt(b)*d):isNaN(b)||(b=parseInt(b));b<c*d&&a.setSize(null,b)}});if("undefined"!=typeof a.options.appHeight){var b=a.options.appHeight,
c=a.defaultTextHeight();"string"==typeof b&&(-1!=b.indexOf("%")?b=parseInt(window.innerHeight*parseInt(b)/100):-1!=b.indexOf("l")?b=parseInt(parseInt(b)*c):isNaN(b)||(b=parseInt(b)));"number"==typeof b&&a.setSize(null,b)}if("undefined"!=typeof f.field.cm_options.appHints)a.on("keyup",function(b,c){c.key==f.field.cm_options.appHints.key&&a.showHint({hint:function(){return{from:a.getDoc().getCursor(),to:a.getDoc().getCursor(),list:f.field.cm_options.appHints.hints}}})})}));b(function(){if("undefined"!==
typeof f.field.tooltip&&!1!==f.field.visible){"undefined"===typeof f.field.tooltip.trigger&&(f.field.tooltip.trigger="hover");var b=document.createElement("span");b.className="form-field-label-tooltip";b.id=f.field.id+"_tooltip";if("undefined"!=typeof f.field.tooltip.thumbnail){var c=f.oFormValues[f.sFormDefinitionName][f.field.tooltip.thumbnail];""!=c&&null!=c&&(c=d.web_server_name+"/"+d.public_alias+"/"+d.application+"/"+c,f.field.tooltip.html=!0,f.field.tooltip.content='<img src="'+c+'" class="popover-thumbnail-img">',
f.field.tooltip.template='<div class="popover popover-thumbnail" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>',g[0].querySelector("label").appendChild(b),$(g).find("label .form-field-label-tooltip").popover(f.field.tooltip))}else g[0].querySelector("label").appendChild(b),a([f.field.tooltip.title,f.field.tooltip.content]).then(function(a){f.field.tooltip.title=a[f.field.tooltip.title];f.field.tooltip.content=a[f.field.tooltip.content];
$(g).find("label .form-field-label-tooltip").popover(f.field.tooltip).on("inserted.bs.popover",function(){"undefined"!==typeof f.field.tooltip.width&&(g[0].querySelector(".popover").style.width=f.field.tooltip.width)})})}"undefined"!=typeof f.field.autocomplete&&(f.field.autocomplete?g[0].querySelector("[name='"+f.field.name+"']").setAttribute("autocomplete","on"):g[0].querySelector("[name='"+f.field.name+"']").setAttribute("autocomplete","off"))});"tinymce"==f.field.type&&("undefined"==typeof f.field.tinymceOptions&&
(f.field.tinymceOptions={}),"en"!=d.language&&(f.field.tinymceOptions.language=d.language+"_"+d.language.toUpperCase()))}}}zB.$inject="$translate $timeout formReaderService propertiesSrvc externFunctionSrvc $log".split(" ");mB.module.directive("appFormFieldNgRepeat",zB);mB.Wx=function(a,b){return{link:function(c,d){b.log("formReader.appButtonDrtv.link");"undefined"!==typeof c.button.tooltip&&a([c.button.tooltip.title]).then(function(a){c.button.tooltip.title=a[c.button.tooltip.title];$(d).tooltip(c.button.tooltip)})}}};
mB.Wx.$inject=["$translate","$log"];mB.module.directive("appButton",mB.Wx);
mB.zy=function(a,b,c,d,e){return{link:function(a,c){e.log("formReader.appSubformGridDrtv.link");var f=angular.element("#formreader_"+a.sFormUniqueName+"_grid_subform_modal").scope(),g=c.closest("form").parent();a.initBoSubformGrid=function(){e.log("formReader.appSubformGridDrtv.initBoSubformGrid");var c=a.field.bo_id,h="formreader_"+a.sFormUniqueName+"_grid_subform_modal",k={},u={},w=a.field.bo_filter_attr,x=a.field.form_filter_value,z=angular.element(v.f).injector().get(["envSrvc"]),D=angular.element(v.f).injector().get(["formSrvc"]),
H=angular.element("#"+("formreader_"+a.sFormUniqueName+"_grid_subform")).scope(),G=!1;f.closeModal=function(a){$(a).modal("hide")};$("#"+h).on("hidden.bs.modal",function(){setTimeout(function(){z.oFormValues=f.oFormValues;z.oFormDefinition=f.oFormDefinition;z.sFormDefinitionName=f.sFormDefinitionName})});a.haveInsertRights=!1;a.haveDeleteRights=!1;a.haveUpdateRights=!1;a.haveCardRights=!1;a.oListWebService={dataType:"businessObject",ressource_id:"vmap/querys/"+c+"/list",parameters:{filter:""}};d.getBusinessObjectDef(c).then(function(e){function m(){d.getWebServiceData(angular.copy(a.oListWebService)).then(function(h){if(null==
h)return null;if(null!=h[0]){a.gridOptions.columnDefs=[{name:"",field:"actions",cellTemplate:"<app-ui-grid-action></app-ui-grid-action>",width:60,enableSorting:!1,enableColumnMoving:!1,enableColumnResizing:!1}];for(var k=0;k<h[0].bo_list_attributs.length;k++)a.gridOptions.columnDefs.push({field:h[0].bo_list_attributs[k]});p(h);a.haveUpdateRights&&(a.gridApi.grid.appScope.edit_column="edit");a.haveCardRights&&(a.gridApi.grid.appScope.show_column="show");a.gridApi.grid.appScope.executeActionButtonEvent=
function(h,k){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,"error")}),0;var m=h.entity.bo_object_infos,t="edit"===k?"update":"display";d.getWebServiceData({dataType:"businessObject",ressource_id:"vmap/querys/"+c+"/form",parameters:{filter:{column:m.bo_id_field,compare_operator:"=",value:m.bo_id_value}}}).then(function(g){var h=g[0].bo_json_form,k={},u="formreader_"+a.sFormUniqueName+"_grid_subform_modal";"update"===t&&(h.update.event=function(e){d.updateBoElement(c,
m,h,t,e,function(){$("#"+u).modal("hide");setTimeout(function(){d.getWebServiceData(angular.copy(a.oListWebService)).then(function(a){p(a)})});b("LIST_EDIT_OK").then(function(a){$.notify(a,"success")})})});k[t]=g[0].bo_form;h[t].name="formreader_"+a.sFormUniqueName+"_grid_subform_form";G&&(h=d.disableFormElement(h,w,t));if(null==m)return console.error("oObject undefined"),0;if(null==H)return console.error("oSubformScope undefined"),0;if(null==h)return console.error("oSubformDefinition undefined"),
0;if(null==t)return console.error("sSubformDefinitionName undefined"),0;if(null==k)return console.error("oSubformValues undefined"),0;f.$applyAsync(function(){f.grid_subform_title=g[0].bo_title;f.grid_subform_definition_name=t;"update"===t&&(f.grid_subform_size=e.edit_form_size);"display"===t&&(f.grid_subform_size=e.display_form_size)});d.showModalSubform(u,H,h,t,k)})};a.gridApi.grid.refresh()}else p([])})}function p(b){for(var c=[],d=0;d<b.length;d++)b[d].bo_list.bo_object_infos={bo_id_value:b[d].bo_id_value,
bo_id_field:b[d].bo_id_field,bo_type:b[d].bo_type},c.push(b[d].bo_list);a.gridOptions.data=c}if(null==e.business_object_id)return console.error("error while loading business object ("+c+")"),0;if(null!=w&&""!==w&&null!=x&&""!==x&&null!=f.oFormValues&&null!=f.oFormValues[f.sFormDefinitionName]){var t=f.oFormValues[f.sFormDefinitionName][x];null!=t&&null!=t.selectedOption&&null!=t.selectedOption.value&&(t=t.selectedOption.value);null!=t&&null!=t.selectedOption&&null!=t.selectedOption[0]&&null!=t.selectedOption[0].value&&
(t=t.selectedOption[0].value);G=!0;k[w]=t;u[w]=t}t=d.parseFilter(k);a.oListWebService.parameters.filter=t;a.oListWebService.parameters.limit=100;-1!==e.user_rights.indexOf("INSERT")&&(a.haveInsertRights=!0);-1!==e.user_rights.indexOf("DELETE")&&(a.haveDeleteRights=!0);-1!==e.user_rights.indexOf("UPDATE")&&null!=e.json_form&&null!=e.json_form[0]&&null!=e.json_form[0].update&&(a.haveUpdateRights=!0);-1!==e.user_rights.indexOf("SELECT")&&null!=e.json_form&&null!=e.json_form[0]&&null!=e.json_form[0].display&&
(a.haveCardRights=!0);a.addObject=function(){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,"error")}),0;var h={insert:angular.copy(u)},k="formreader_"+a.sFormUniqueName+"_grid_subform_modal",p=e.json_form[0];G&&(p=d.disableFormElement(p,w,"insert"));f.$applyAsync(function(){f.grid_subform_title=e.title;f.grid_subform_size=e.add_form_size;f.grid_subform_definition_name="insert"});p.insert.name="formreader_"+a.sFormUniqueName+"_grid_subform_form";var t=
Date.now();p.insert.event=function(a){if(t>Date.now()-2E3)return!1;t=Date.now();d.insertBoElement(c,e,p,"insert",a,function(){$("#"+k).modal("hide");setTimeout(function(){m()});b("LIST_ADD_OK").then(function(a){$.notify(a,"success")})})};d.showModalSubform(k,H,p,"insert",h)};a.removeSelection=function(){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,"error")}),0;var e=[],f=a.gridApi.selection.getSelectedRows();0<f.length?b("LIST_DELETE_CONFIRM").then(function(g){bootbox.confirm(g,
function(g){if(!0===g){for(g=0;g<f.length;g++)e.push(f[g].bo_object_infos.bo_id_value);d.deleteBoElements(c,e,function(){setTimeout(function(){d.getWebServiceData(angular.copy(a.oListWebService)).then(function(a){p(a)})});b("LIST_DELETE_OK").then(function(a){$.notify(a,"success")})})}})}):b("LIST_NO_ELEMENT_SELECTED").then(function(a){$.notify(a,"warning")})};a.showFilterFormModal=function(){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,"error")}),0;var c=
e.json_form[0],m={search:k};G&&(c=d.disableFormElement(c,w,"search"));c.search.name="formreader_"+a.sFormUniqueName+"_grid_subform_form";c.search.event=function(e){z.oFormValues=e;z.oFormDefinition=c;z.sFormDefinitionName="search";e=D.getFormData("search",!0);e=d.parseFilter(e);a.oListWebService.parameters.filter=e;$("#"+h).modal("hide");d.getWebServiceData(angular.copy(a.oListWebService)).then(function(a){p(a)});b("LIST_SEARCH_OK").then(function(a){$.notify(a,"success")})};f.$applyAsync(function(){f.grid_subform_title=
e.title;f.grid_subform_definition_name="search"});H.loadSubForm({sFormDefinitionName:"search",oFormDefinition:c,oFormValues:m,oProperties:a.oProperties});$("#"+h).modal("show")};m()})};a.initSectionSubformGrid=function(){e.log("formReader.appSubformGridDrtv.initSectionSubformGrid");var c=a.field.section_id,h="formreader_"+a.sFormUniqueName+"_grid_subform",k="formreader_"+a.sFormUniqueName+"_grid_subform_modal",u=angular.element(v.f).injector().get(["envSrvc"]),w=angular.element(v.f).injector().get(["formSrvc"]),
x=angular.element("#"+h).scope(),z={},D={},H=a.field.section_filter_attr,h=a.field.form_filter_value,G=!1;a.haveInsertRights=!1;a.haveDeleteRights=!1;f.closeModal=function(a){$(a).modal("hide")};$("#"+k).on("hidden.bs.modal",function(){setTimeout(function(){u.oFormValues=f.oFormValues;u.oFormDefinition=f.oFormDefinition;u.sFormDefinitionName=f.sFormDefinitionName})});null!=H&&""!==H&&null!=h&&""!==h&&null!=f.oFormValues&&null!=f.oFormValues[f.sFormDefinitionName]&&null!=f.oFormValues[f.sFormDefinitionName][h]&&
(G=!0,z[H]=f.oFormValues[f.sFormDefinitionName][h],D[H]=f.oFormValues[f.sFormDefinitionName][h]);a.addObject=function(){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,"error")}),0;var c={insert:angular.copy(D)},e=a.oSubformDefinition,h=angular.element("#formreader_"+a.sFormUniqueName+"_grid_subform").scope();G&&(e=d.disableFormElement(e,H,"insert"));f.$applyAsync(function(){f.grid_subform_title=a.oRessourceTab.name;f.grid_subform_definition_name="insert"});
e.insert.name="formreader_"+a.sFormUniqueName+"_grid_subform_form";null!=e.insert.afterEvent&&delete e.insert.afterEvent;e.insert.event=function(c){d.insertSectionElement(a.oSection.ressource_id,a.sIdField,a.oSubformDefinition,"insert",c).then(function(){$("#"+k).modal("hide");setTimeout(function(){d.getSectionRessourceData(a.oSection.ressource_id).then(function(b){a.gridOptions.data=b})});b("LIST_ADD_OK").then(function(a){$.notify(a,"success")})})};d.showModalSubform(k,h,e,"insert",c)};a.removeSelection=
function(){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,"error")}),0;var c=[],e=a.gridApi.selection.getSelectedRows();0<e.length?b("LIST_DELETE_CONFIRM").then(function(f){bootbox.confirm(f,function(f){if(!0===f){for(f=0;f<e.length;f++)c.push(e[f][a.sIdField]);d.deleteSectionElements(a.oSection.ressource_id,c).then(function(){setTimeout(function(){d.getSectionRessourceData(a.oSection.ressource_id).then(function(b){a.gridOptions.data=b})});b("LIST_DELETE_OK").then(function(a){$.notify(a,
"success")})})}})}):b("LIST_NO_ELEMENT_SELECTED").then(function(a){$.notify(a,"warning")})};a.showFilterFormModal=function(){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,"error")}),0;var c=a.oSubformDefinition,e={search:z};G&&(c=d.disableFormElement(c,H,"search"));c.search.name="formreader_"+a.sFormUniqueName+"_grid_subform_form";c.search.event=function(e){u.oFormValues=e;u.oFormDefinition=c;u.sFormDefinitionName="search";e=w.getFormData("search",!0);
e=d.parseFilter(e);$("#"+k).modal("hide");d.getSectionRessourceData(a.oSection.ressource_id,e).then(function(b){a.gridOptions.data=b});b("LIST_SEARCH_OK").then(function(a){$.notify(a,"success")})};f.$applyAsync(function(){f.grid_subform_title=a.oRessourceTab.name;f.grid_subform_definition_name="search"});x.loadSubForm({sFormDefinitionName:"search",oFormDefinition:c,oFormValues:e,oProperties:a.oProperties});$("#"+k).modal("show")};d.getSectionDef(c).then(function(c){a.oSection=c;d.getSectionRessourceTab(a.oSection.ressource_id).then(function(c){a.oRessourceTab=
c;d.getSectionRessourceData(a.oSection.ressource_id).then(function(c){a.aRessourceData=c;d.getSectionForm(a.oSection,!0).then(function(c){a.oSubformDefinition=c;var e,h,m;c=a.oRessourceTab.ressource_id.substr(a.oRessourceTab.ressource_id.lastIndexOf("/")+1);for(var p=0;p<a.oRessourceTab[c].length;p++)null!=a.oRessourceTab[c][p].columns&&(e=a.oRessourceTab[c][p].columns),null!=a.oRessourceTab[c][p].actions&&(h=a.oRessourceTab[c][p].actions),null!=a.oRessourceTab[c][p].tabs&&(m=a.oRessourceTab[c][p].tabs[0]);
a.sIdField=angular.copy(e[0].name);"showSectionForm"===m.show_column&&(a.gridApi.grid.appScope.show_column="show");"editSectionForm"===m.edit_column&&(a.gridApi.grid.appScope.edit_column="edit");a.gridOptions.columnDefs=[{name:"",field:"actions",cellTemplate:"<app-ui-grid-action></app-ui-grid-action>",width:60,enableSorting:!1,enableColumnMoving:!1,enableColumnResizing:!1}];null!=e&&Xa(a.gridOptions.columnDefs,e);a.gridOptions.data=angular.copy(a.aRessourceData);for(p=0;p<h.length;p++)"AddSectionForm"===
h[p].event&&(a.haveInsertRights=!0),"DeleteSelection"===h[p].event&&(a.haveDeleteRights=!0);a.gridApi.grid.appScope.executeActionButtonEvent=function(c,e){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,"error")}),0;var h="edit"===e?"update":"display";e={};e[h]=angular.copy(c.entity);a.oSubformDefinition[h].name="formreader_"+a.sFormUniqueName+"_grid_subform_form";"update"===h&&(a.oSubformDefinition.update.event=function(c){d.updateSectionElement(a.oSection.ressource_id,
a.sIdField,a.oSubformDefinition,h,c).then(function(){$("#"+k).modal("hide");setTimeout(function(){d.getSectionRessourceData(a.oSection.ressource_id).then(function(b){a.gridOptions.data=b})});b("LIST_EDIT_OK").then(function(a){$.notify(a,"success")})})});G&&(a.oSubformDefinition=d.disableFormElement(a.oSubformDefinition,H,h));if(null==x)return console.error("oSubformScope undefined"),0;if(null==a.oSubformDefinition)return console.error("scope.oSubformDefinition undefined"),0;if(null==h)return console.error("sSubformDefinitionName undefined"),
0;if(null==e)return console.error("oSubformValues undefined"),0;f.$applyAsync(function(){f.grid_subform_title=a.oRessourceTab.name;f.grid_subform_definition_name=h});d.showModalSubform(k,x,a.oSubformDefinition,h,e)};a.gridApi.grid.refresh()})})})})};a.initSubformGrid=function(){e.log("initSubformGrid");"bo_grid"===a.field.type?a.initBoSubformGrid():"section_grid"===a.field.type&&a.initSectionSubformGrid();setTimeout(function(){null!=a.gridOptions&&null!=a.gridOptions.gridApi&&null!=a.gridOptions.gridApi.core&&
null!=a.gridOptions.gridApi.core.handleWindowResize&&(a.gridOptions.gridApi.core.handleWindowResize(),setTimeout(function(){a.gridOptions.gridApi.core.handleWindowResize()},500),setTimeout(function(){a.gridOptions.gridApi.core.handleWindowResize()},1E3),setTimeout(function(){a.gridOptions.gridApi.core.handleWindowResize()},2E3))})};null!=f.initSubformGridEvent&&(f["initSubformGridEvent_"+a.field.name](),f["initSubformGridEvent_"+a.field.name]=null);f.bFormDefinitionInfosExtracted?a.initSubformGrid():
f["initSubformGridEvent_"+a.field.name]=f.$on("extractFormDefinitionInfos",function(){a.initSubformGrid()})}}};mB.zy.$inject=["$timeout","$translate","propertiesSrvc","formReaderService","$log"];mB.module.directive("appSubformGrid",mB.zy);
mB.yy=function(a,b){return{link:function(c,d){b.log("formReader.appSubformDrtv.link");var e;c.oSubformValues=null;c.loadSubForm=function(f){b.log("formReader.loadSubForm");if(null==f.sFormDefinitionName)return console.error("opt_options['sFormDefinitionName'] undefined"),0;if(null==f.oFormDefinition)return console.error("opt_options['oFormDefinition'] undefined"),0;if(null==f.oFormValues)return console.error("opt_options['oFormValues'] undefined"),0;if(null==f.oProperties)return console.error("opt_options['oProperties'] undefined"),
0;c.oSubformValues=f.oFormValues;c.$applyAsync(function(){c.oProperties=f.oProperties;e=a('<div app-form-reader app-properties="oProperties"></div>')(c);d.html("");d.append(e);setTimeout(function(){c.oFormReaderScope=angular.element($(d).find("[app-form-reader]").children()).scope();c.oFormReaderScope.ctrl.setDefinitionName(f.sFormDefinitionName);c.oFormReaderScope.ctrl.setFormValues(c.oSubformValues);c.oFormReaderScope.ctrl.setFormDefinition(f.oFormDefinition);c.oFormReaderScope.ctrl.loadForm()})})};
c.setFormValues=function(a){b.log("formReader.setFormValues");c.oSubformValues=a;null!=c.oFormReaderScope&&null!=c.oFormReaderScope.ctrl&&(c.oFormReaderScope.ctrl.setFormValues(c.oSubformValues),c.oFormReaderScope.ctrl.loadForm())}}}};mB.yy.$inject=["$compile","$log"];mB.module.directive("appSubform",mB.yy);mB.service={};mB.service.dQ={};
function AB(a,b,c,d,e,f){return{reloadSelectField:function(a,b,c,d){d=this.getFormElementDefinition(a.child_select,b,d);if(n(d)){var e=d.web_service.parameters;n(e)||(e={filter:{}});r(e.filter)&&(e.filter={stringFilter:e.filter});n(e.filter)||(e.filter={});e.filter[a.name]=c[b][a.name].selectedOption.value;d.web_service.parameters=e;this.setWebServiceSelectOptions(d,b,c,d.web_service)}},getFormElementDefinition:function(a,b,c){c=c[b];b=0;for(var d,e;b<c.rows.length;){for(d=0;d<c.rows[b].fields.length;){if(c.rows[b].fields[d].name===
a)return c.rows[b].fields[d];if("undefined"!=typeof c.rows[b].fields[d].buttons)for(e=0;e<c.rows[b].fields[d].buttons.length;){if(c.rows[b].fields[d].buttons[e].name===a)return c.rows[b].fields[d].buttons[e];e++}d++}b++}},getAllFormElementDefinition:function(a,b){b=b[a];a=[];for(var c=0,d;c<b.rows.length;){for(d=0;d<b.rows[c].fields.length;)a.push(b.rows[c].fields[d]),d++;c++}return a},setWebServiceSelectOptions:function(d,e,k,m,p){var g=this;k=k[e];var h=c.defer(),w;b.oFormPromises[e].push(h.promise);
if(null==d)return console.error("oFormElementDefinition not defined"),0;if(null==e)return console.error("sFormDefinitionName not defined"),0;if(null==k)return console.error("oFormValues not defined"),0;if(null==m)return console.error("oWebService not defined"),0;n(k)||(console.error("oFormValues["+e+"] not defined"),k={});this.getWebServiceData(m).then(function(c){if(null==c)return null;var t,u,x,G="",L,N=m.label_key,T=m.id_key,U=[];L=k[d.name];if(ea(L))U[0]=String(L);else if(r(L)&&""!==L)U=L.split("|");
else if(ha(L)&&q(L.options))for(var K in L.options)U.push(L.options[K].value);t=0;u={selectedOption:[],options:[]};x={selectedOption:[],options:[]};"double_select"===d.type?(G=d.name_from,L=d.name_to):L=d.name;for(;t<c.length;)n(c[t][N])?n(c[t][T])?(w=Number(c[t][T]),isNaN(w)||!parseInt(w,10)!==w&&(parseInt(w,10)!==w||0==String(c[t][T]).substr(0,1))||(c[t][T]=w),-1!==U.indexOf(String(c[t][T]))||""===G?x.options.push({label:c[t][N],value:c[t][T]}):u.options.push({label:c[t][N],value:c[t][T]})):(console.error("result."+
T+" does not exist, check the id_key param on the JSON file"),c[t][T]=null):(console.error("result."+N+" does not exist, check the label_key param on the JSON file"),c[t][N]=null),t++;if(""===G){if(null!=p)x.selectedOption=p;else{if("select"===d.type||"editable_select"===d.type){c=angular.copy(k[d.name]);var X;null!==c&&ha(c)&&(c=c.selectedOption.value,X=k[d.name].selectedOption.label);"undefined"===typeof c&&"undefined"!==typeof d.default_value&&(c=d.default_value,r(c)&&g.isFunctionCall(c)&&(c=g.callFunction(c)));
c=n(c)?c:null;X=n(X)?X:"";x.selectedOption={value:c,label:X}}if("list"===d.type)if(c=angular.copy(k[d.name]),null!=c&&q(c.selectedOption)&&(c=c.selectedOption),null!=c&&"undefined"!==typeof d.default_value&&(c=d.default_value,r(c)&&g.isFunctionCall(c)&&(c=g.callFunction(c))),q(c)&&0<c.length)x.selectedOption=c;else for(X=[],r(c)&&(X=c.split("|")),ea(c)&&(X=[c]),x.selectedOption=[],K=0;K<X.length;K++)for(c=0;c<x.options.length;c++)x.options[c].value==X[K]&&(ea(x.options[c].value)&&r(X[K])&&(X[K]=parseFloat(X[K])),
x.selectedOption.push({value:X[K],label:x.options[c].label}))}if(null!=d.options){K=0;c=[];for(var ma=[];K<d.options.length;)X=d.options[K].split("|"),c.push(X[0]),ma.push(X[1]),K++;a(c).then(function(a){var b=Object.keys(a);for(K=0;K<b.length;)x.options.unshift({label:a[b[K]],value:ma[K]}),K++})}if(!0!==d.required&&"true"!==d.required){X=!1;for(K=0;K<x.options.length;K++)""===x.options[K].value&&(X=!0);X||x.options.unshift({label:"",value:""})}}else k[G]=u;k[L]=x;if("editable_select"!==d.type){X=
!1;for(K=0;K<k[L].options.length;K++)x.selectedOption.value==k[L].options[K].value&&(x.selectedOption.value=k[L].options[K].value,x.selectedOption.label=k[L].options[K].label,X=!0);X||(delete k[L].selectedOption.value,delete k[L].selectedOption.label)}null!=k[L]||(k[L]={});null!=k[L].selectedOption||(k[L].selectedOption={});null==k[L].selectedOption.value&&(k[L].selectedOption.value="",k[L].selectedOption.label="");"list"===d.type&&ha(k[L].selectedOption)&&!q(k[L].selectedOption)&&(k[L].selectedOption=
[k[L].selectedOption]);this.oFormValues=k;this.sFormDefinitionName=e;f.oFormDefaultValues[e]=g.copyFormValues(k);"undefined"!==typeof m.callback&&g.isFunctionCall(m.callback)&&g.callFunction(m.callback);b.$emit("webServiceSelectOptionsloaded");h.resolve()})},getWebServiceData:function(a){var d=this.oProperties,e={},f=c.defer();if(null==a)return console.error("oWebService not defined"),0;n(a.parameters)&&(e=a.parameters,"businessObject"===a.dataType&&null!=e.attributs&&delete e.attributs,n(a.parameters.filter)||
n(a.parameters.filter_extension))&&(a.parameters.filter=this.parseFilter(a.parameters.filter),""===a.parameters.filter&&delete a.parameters.filter);A({method:"POST",url:d.web_server_name+"/"+d.services_alias+"/"+a.ressource_id,data:e,scope:b,headers:{"X-HTTP-Method-Override":"GET",Accept:"application/x-vm-json"},success:function(b){null!=a.parameters&&(a.parameters.filter=a.parameters.original_filter);b=b.data;b.data=n(b.data)?b.data:[];if(1===b.status){var c;if(null!=a.subObject){c=[];for(var d=
0;d<b.data.length;d++)null!=b.data[d][a.subObject]&&c.push(b.data[d][a.subObject])}else c=n(b.data)?b.data:[]}f.resolve(c)}});return f.promise},emptySelectOptions:function(a,b,c){a="double_select"===a.type?a.name_to:a.name;null!=c[b]&&null!=c[b][a]&&null!=c[b][a].options&&(c[b][a]="");this.oFormValues=c;null!=f.oFormDefaultValues&&null!=f.oFormDefaultValues[b]&&(f.oFormDefaultValues[b]=this.copyFormValues(c))},callFunction:function(a){if(null==a)return console.error("callFunction: no function defined"),
0;if(0< !a.length)return console.error('callFunction: function === ""'),0;var c="",e=[];if(-1!==a.indexOf("(")){c=a.substr(a.indexOf("("));c=c.substr(1,c.length-2);0<c.length&&(e=c.split(","));for(var f=0;f<e.length;f++)r(e[f])&&(e[f]=e[f].trim())}for(f=0;f<e.length;f++)this.isFunctionCall(e[f])&&(e[f]="'"+this.callFunction(e[f])+"'");0<e.length&&(a=a.replace(c,e.join(",")));var c=a.substr(0,a.indexOf("(")),g;this.eventsContainer=this.oFormEventsContainer;this.rootScope_=b;if("function"==typeof eval("window."+
c))try{d.log(a),g=eval(a)}catch(t){!0===this.oProperties.debug_mode&&console.error(t)}else if("undefined"!=typeof this.eventsContainer&&"function"==typeof this.eventsContainer[c])try{d.log("eventsContainer."+a),g=eval("this.eventsContainer."+a)}catch(t){!0===this.oProperties.debug_mode&&console.error(t)}else if("function"==typeof this[c])try{d.log("this."+a),g=eval("this."+a)}catch(t){!0===this.oProperties.debug_mode&&console.error(t)}else if("undefined"!=typeof this.rootScope_&&"function"==typeof this.rootScope_[c])try{d.log("$rootScope."+
a),g=eval("this.rootScope_."+a)}catch(t){!0===this.oProperties.debug_mode&&console.error(t)}return g},isFunctionCall:function(a,c){"undefined"==typeof c&&(c=!0);var e=!1;"string"===typeof a&&(aMatchResult=a.match(/(.+)\((.*)\)/),null!==aMatchResult&&(c?(c=a.substr(0,a.indexOf("(")),"function"==typeof c?e=!0:"undefined"!=typeof this.oFormEventsContainer&&"function"==typeof this.oFormEventsContainer[c]?e=!0:"function"==typeof this[c]?e=!0:"function"==typeof b[c]&&(e=!0),e||d.warn("Function not found : "+
a)):e=!0));return e},selectFirstOption:function(a,b,c){b=n(b)?b:this.oFormValues;c=n(c)?c:this.sFormDefinitionName;b=b[c];0<b[a].options.length&&(b[a].selectedOption.value=b[a].options[0].value)},setSelectOptions:function(b,c,e,m){function g(a,b){var c=[];if(!q(a))return console.error("getFormatedOptions: aKeys is not an array",a),c;if(!q(b))return console.error("getFormatedOptions: aKeys is not an array",b),c;if(a.length!==b.length)return console.error("getFormatedOptions: aKeys.length !== aValues.length",
a,b),c;for(var d=0;d<a.length;d++)c.push({label:a[d],value:b[d]});return c}d.log("setSelectOptions");var h=0,k,w,x={selectedOption:{value:""},options:[]},z,D,H;m=n(m)?m:b.options;var G=[],L=[];for(r(m)&&(m=m.split(","));h<m.length;)w=m[h].split("|"),k=w[0],G.push(k),k=1<w.length?w[1]:k,L.push(k),h++;var N=e[c][b.name];if("list"===b.type&&r(N)&&(m=N.split("|"),0<m.length)){k=[];for(h=0;h<m.length;h++)k.push({label:"",value:m[h]});N={selectedOption:k}}"undefined"===typeof N&&"undefined"!==typeof b.default_value&&
(N=b.default_value,"string"===typeof N&&this.isFunctionCall(N)&&(N=this.callFunction(N)));null!=N&&(null!=N.selectedOption?(null!=N.selectedOption.value&&(x=N),q(N.selectedOption)&&(x=N)):x.selectedOption.value=String(N));a(G).then(function(a){for(var d=0;d<G.length;d++)isNaN(G[d])&&(G[d]=a[G[d]]);x.options=g(G,L);if("double_select"===b.type){D=b.name_from;H=b.name_to;var h=angular.copy(G),k=angular.copy(L);a=[];var m=[],p=[];null!=N&&(p=N.split("|"));for(d=0;d<p.length;d++){var t=k.indexOf(p[d]);
m.unshift(k[t]);a.unshift(h[t]);k.splice(t,1);h.splice(t,1)}d={options:g(h,k)};a={options:g(a,m)};e[c][D]=d;e[c][H]=a}else z=b.name,e[c][z]=x;"undefined"===typeof f.oFormDefaultValues[c]&&(f.oFormDefaultValues[c]={});"undefined"==typeof f.oFormDefaultValues[c][z]&&(f.oFormDefaultValues[c][z]=angular.copy(x))})},selectOptionAfterLoad:function(a,b,c,d,e){if("double_select"===b.type)console.log(e);else if("select"===b.type){b=a[c][d].options;for(var f=0;f<b.length;f++)if(b[f].value===e){a[c][d].CQ=b[f];
break}}else"list"!==b.type&&console.error("this element is not a select")},extractWebServiceData:function(a,b){var c=[];"undefined"!==typeof b[a]&&(Array.isArray(b[a])?0<b[a].length&&(c=b[a]):c=b[a]);return c},parseFilter:function(a){if(ha(a)){var b=!1;null!=a.operators&&null!=a.relation&&(b=!0);null!=a.column&&null!=a.compare_operator&&null!=a.value&&(b=!0);if(!b){var b=[],c,d;for(d in a)if("stringFilter"===d)b.push(a[d]);else if(c=a[d],""!==c&&(this.isFunctionCall(c)&&(c=this.callFunction(c)),null!=
c||(c="is null"),n(c))){var e="=";r(c)&&("not null"===c.toLowerCase().trim()&&(e="!=",c="NULL"),"is null"===c.toLowerCase().trim()&&(e="IS NULL",c=""),"is not null"===c.toLowerCase().trim()&&(e="IS NOT NULL",c=""));b.push({column:d,compare_operator:e,value:c})}if(0<b.length)for(a={relation:"AND",operators:[]},d=0;d<b.length;d++)a.operators.push(b[d]);else a=""}}return a},setWebServiceTags:function(a,c,d){var g=angular.copy(a.web_service),h=g.ressource_id.split("/");d=d[c];var k=this,u={};"undefined"!==
typeof g.parameters&&(u=g.parameters,"undefined"!==typeof g.parameters.filter&&(g.parameters.filter=this.parseFilter(g.parameters.filter),""===g.parameters.filter&&delete g.parameters.filter));A({method:"POST",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/"+g.ressource_id,headers:{"X-HTTP-Method-Override":"GET"},data:u,scope:b,success:function(m){m=m.data;if(1===m.status){m=k.extractWebServiceData(h[1],m);var p=[];"string"===typeof d[a.name]&&(p=d[a.name].split(","));
for(var t=g.id_key,u=0,w=[];u<m.length;)-1===p.indexOf(m[u][t])&&w.push(m[u][t]),u++;d[a[["name_available_tags"]]]=w.join(",");"undefined"==typeof f.oFormDefaultValues[c][a[["name_available_tags"]]]&&(f.oFormDefaultValues[c][a[["name_available_tags"]]]=angular.copy(d[a[["name_available_tags"]]]));e(function(){b.$emit("webServiceTagsloaded",a)})}}})},checkFormModifications:function(a){var b=c.defer(),d=b.promise;if("insert"!=f.sMode&&"update"!=f.sMode||"undefined"==typeof a)b.resolve();else if(a=f.oFormDefinition[a],
"undefined"!=typeof a&&"undefined"!=typeof a.event){a=a.name;var e=angular.element("form[name='"+a+"']");0<e.length?(e=e.scope(),e[a].$dirty&&!e[a].$submitted?e.$root.modalWindow("confirm","FORM_MODIFIED_WARNING_TITLE",{className:"modal-warning",message:"FORM_MODIFIED_WARNING",callback:function(a){a&&b.resolve()}}):b.resolve()):b.resolve()}else b.resolve();return d},checkStudioFormModifications:function(){var a=c.defer(),d=a.promise;"vmap"===Z.Tg()?!0===Z.tA()?b.modalWindow("confirm","FORM_MODIFIED_WARNING_TITLE",
{className:"modal-warning",message:"FORM_MODIFIED_WARNING",callback:function(b){b&&a.resolve()}}):a.resolve():a.resolve();return d},getFormValueFromObject:function(a,b){d.info("getFormValueFromObject");var c=this.copyFormValues(a);b.split(".").forEach(function(a){c=c[a]});return c},copyFormValues:function(a){d.info("copyFormValues");var b={};try{b=angular.copy(a)}catch(p){for(var c in a)try{b[c]=angular.copy(a[c])}catch(t){if(ha(a[c])){b[c]={};for(var e in a[c])try{b[c][e]=angular.copy(a[c][e])}catch(u){}}}}return b},
getFormValue:function(a){d.info("getFormValue");if(!r(a))return null;a=a.trim();var b=this.oFormValues[this.sFormDefinitionName];if(null==b)return null;a=b[a.trim()];null!=a.selectedOption&&null!=a.selectedOption.value&&(a=a.selectedOption.value);return a},concat:function(){d.info("concat");for(var a="",b=0;b<arguments.length;b++)r(arguments[b])&&(a+=arguments[b]);return a},getBusinessObjectDef:function(d){var e=c.defer();ed();A({method:"GET",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+
"/vmap/businessobjects/"+d,scope:b,headers:{Accept:"application/x-vm-json"},success:function(b){fd();if(!n(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(!n(b.data.data)||!n(b.data.data[0])||!n(b.data.data[0].business_object_id))return 0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;e.resolve(b.data.data[0])},error:function(a){fd();console.error(a);bootbox.alert(a)}});return e.promise},showModalSubform:function(a,b,c,d,e){var f=this.sToken,
g=this.oProperties;null!=b.loadSubForm&&(b.loadSubForm({sFormDefinitionName:d,oFormDefinition:c,oFormValues:e,oProperties:g,sToken:f}),$("#"+a).modal("show"))},updateBoElement:function(c,d,e,f,p,t){var g=angular.element(v.f).injector().get(["envSrvc"]),h=angular.element(v.f).injector().get(["formSrvc"]);d=[d.bo_id_field];g.oFormValues=p;g.oFormDefinition=e;g.sFormDefinitionName=f;e=h.getFormData(f,!0);for(g=0;g<d.length;g++)null!=p[f][d[g]]&&(e[d[g]]=p[f][d[g]]);f=new FormData;for(var k in e)null!=
e[k].aFiles?(f.append(k+"_attached_content",e[k].aFiles[0]),f.append(k,e[k].aFiles[0].name)):f.append(k,e[k]);A({method:"PUT",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/vmap/querys/"+c,data:f,scope:b,success:function(b){if(!n(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;if(n(b.status)&&500===b.status)return bootbox.alert(b.statusText),0;t.call()},error:function(a){bootbox.alert(a);
console.error(a)}})},insertBoElement:function(c,d,e,f,p,t){var g=angular.element(v.f).injector().get(["envSrvc"]),h=angular.element(v.f).injector().get(["formSrvc"]);d=[d.id_field];g.oFormValues=p;g.oFormDefinition=e;g.sFormDefinitionName=f;e=h.getFormData(f,!0);for(g=0;g<d.length;g++)null!=p[f][d[g]]&&(e[d[g]]=p[f][d[g]]);f=new FormData;for(var k in e)null!=e[k].aFiles?(f.append(k+"_attached_content",e[k].aFiles[0]),f.append(k,e[k].aFiles[0].name)):f.append(k,e[k]);A({method:"POST",url:this.oProperties.web_server_name+
"/"+this.oProperties.services_alias+"/vmap/querys/"+c,data:f,scope:b,success:function(b){if(!n(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;if(n(b.status)&&500===b.status)return bootbox.alert(b.statusText),0;t.call()},error:function(a){bootbox.alert(a);console.error(a)}})},deleteBoElements:function(c,d,e){A({method:"DELETE",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+
"/vmap/querys/"+c,params:{idList:d.join("|")},scope:b,success:function(b){if(!n(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;if(n(b.status)&&500===b.status)return bootbox.alert(b.statusText),0;e.call()},error:function(a){bootbox.alert(a);console.error(a)}})},getSectionDef:function(d){var e=c.defer();A({method:"GET",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/vitis/vitissections/"+
d,scope:b,success:function(b){if(!n(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(!n(b.data.data)||!n(b.data.data[0])||!n(b.data.data[0].ressource_id))return a("NO_SECTION_FOUNDED").then(function(a){bootbox.alert(a)}),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;e.resolve(b.data.data[0])},error:function(a){bootbox.alert(a);console.error(a)}});return e.promise},getSectionRessourceTab:function(d){var e=c.defer();A({method:"GET",url:this.oProperties.web_server_name+
"/"+this.oProperties.services_alias+"/vitis/ressources/"+d,headers:{Accept:"application/json"},scope:b,success:function(b){if(!n(b.data)||!n(b.data.ressources)||!n(b.data.ressources[0]))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;e.resolve(b.data.ressources[0])},error:function(a){bootbox.alert(a);console.error(a)}});return e.promise},getSectionRessourceData:function(d,e){var f=c.defer(),g={limit:100};null!=
e&&""!==e&&(g.filter=e);A({method:"GET",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/"+d,params:g,scope:b,success:function(b){if(!n(b.data)||!n(b.data.data)||!n(b.data.data[0]))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;f.resolve(b.data.data)},error:function(a){bootbox.alert(a);console.error(a)}});return f.promise},getSectionForm:function(d,e){e=null!=e?e:!1;var f=c.defer();
A({method:"GET",url:"modules/"+d.module_name+"/forms/"+d.mode_id+"/"+(1<d.index?d.mode_id+"_"+d.tab_name+"_"+d.name+".json":d.mode_id+"_"+d.tab_name+".json"),scope:b,success:function(b){if(!n(b.data))return a("NO_FORM_FOUNDED").then(function(a){bootbox.alert(a)}),0;b=b.data;if(e)for(var c in b)if(null!=b[c]&&null!=b[c].rows)for(var d=b[c].rows.length-1;0<=d;d--)if(null!=b[c].rows[d].fields)for(var g=b[c].rows[d].fields.length-1;0<=g;g--)"button"===b[c].rows[d].fields[g].type&&b[c].rows[d].fields.splice(g,
1);f.resolve(b)},error:function(a){bootbox.alert(a);console.error(a)}});return f.promise},updateSectionElement:function(d,e,f,m,p){var g=c.defer();e=p[m][e];var h=angular.element(v.f).injector().get(["envSrvc"]),k=angular.element(v.f).injector().get(["formSrvc"]);h.oFormValues=p;h.oFormDefinition=f;h.sFormDefinitionName=m;f=k.getFormData(h.sFormDefinitionName);A({method:"PUT",url:null!=e?this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/"+d+"/"+e:this.oProperties.web_server_name+
"/"+this.oProperties.services_alias+"/"+d,data:f,scope:b,success:function(b){if(!n(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;if(n(b.status)&&500===b.status)return bootbox.alert(b.statusText),0;g.resolve(b.data)},error:function(a){console.error(a);bootbox.alert(a)}});return g.promise},insertSectionElement:function(d,e,f,m,p){var g=c.defer();e=angular.element(v.f).injector().get(["envSrvc"]);var h=
angular.element(v.f).injector().get(["formSrvc"]);e.oFormValues=p;e.oFormDefinition=f;e.sFormDefinitionName=m;f=h.getFormData(e.sFormDefinitionName);A({method:"POST",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/"+d,data:f,scope:b,success:function(b){if(!n(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;if(n(b.status)&&500===b.status)return bootbox.alert(b.statusText),0;
g.resolve(b.data)},error:function(a){console.error(a);bootbox.alert(a)}});return g.promise},deleteSectionElements:function(d,e){var f=c.defer();A({method:"DELETE",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/"+d,params:{idList:e.join("|")},scope:b,success:function(b){if(!n(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(n(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;if(n(b.status)&&500===b.status)return bootbox.alert(b.statusText),
0;f.resolve(b.data)},error:function(a){console.error(a);bootbox.alert(a)}});return f.promise},disableFormElement:function(a,b,c){if(null==a)return console.error("oFormDefinition not defined"),null;if(null==b)return console.error("sElement not defined"),null;c=null!=c?[c]:Object.keys(a);for(var d=0;d<c.length;d++)if(null!=a[c[d]]&&q(a[c[d]].rows))for(var e=0;e<a[c[d]].rows.length;e++)if(null!=a[c[d]].rows[e].fields)for(var f=0;f<a[c[d]].rows[e].fields.length;f++)a[c[d]].rows[e].fields[f].name===b&&
(a[c[d]].rows[e].fields[f].disabled=!0);return a},extractFormDefinitionInfos:function(a){angular.element("form[name='"+a+"']").scope().ctrl.Mp()},getGPS:function(){return null!=v.oGeoLocation?v.oGeoLocation:null},getGPSPosition:function(){var a=v.oGeoLocation;if(null!=a)return a.Wg()},getGPSLat:function(){var a=v.oGeoLocation;if(null!=a){if(null!=a.Wg())return a.Wg()[1];console.error("GPS position undefined")}else console.error("GPS undefined")},getGPSLong:function(){var a=v.oGeoLocation;if(null!=
a){if(null!=a.Wg())return a.Wg()[0]}else console.error("GPS undefined")},getGPSAltitude:function(){var a=v.oGeoLocation;if(null!=a)return a.get("altitude");console.error("GPS undefined")},getGPSAccuracy:function(){var a=v.oGeoLocation;if(null!=a)return a.get("accuracy");console.error("GPS undefined")},getGPSHeading:function(){var a=v.oGeoLocation;if(null!=a)return a.get("heading");console.error("GPS undefined")}}}AB.$inject="$translate $rootScope $q $log $timeout envSrvc".split(" ");
mB.module.service("formReaderService",AB);v.LA=function(a,b,c,d,e,f,g,h){v.zk("appInitCtrlLoaded");a.getMainTemplateUrl=function(){return d.sMainTemplateUrl};a.disconnect=function(){e.disconnect()};a.$root.clearFormData=function(a,c){b.info("clearFormData");d.toGarbageCollection(d.oFormDefinition[a]);d.oFormDefinition[a]=null;d.oFormDefinition[a]={};d.toGarbageCollection(d.oFormValues[a]);d.oFormValues[a]=null;d.oFormValues[a]={};delete c.oFormDefinition;delete c.oFormValues;delete c.oProperties;delete c.oFormEventsContainer};a.$root.connectFromUrl=
function(c){b.info("connectFromUrl");A({method:"POST",url:oClientProperties.web_server_name+"/"+oClientProperties.services_alias+"/"+e.web_service+"/"+e.web_service_controller,scope:a,data:{user:c.login,password:c.password,duration:e.duration},success:function(a){1==a.data.status?(e.token=a.data.token,e.validity_date=a.data.validity_date,sessionStorage.session_token=e.token,g.login=c.login,g.id=parseInt(a.data.user_id),g.privileges=a.data.privileges,sessionStorage.user_login=c.login,sessionStorage.user_id=
g.id,sessionStorage.privileges=g.privileges,e.saveSessionToLocalStorage(),k.resolve()):e.disconnect()}})};h(["CONFIRM_OK","CONFIRM_CANCEL","CONFIRM_CONFIRM"]).then(function(a){bootbox.addLocale("fr",{OK:a.CONFIRM_OK,CANCEL:a.CONFIRM_CANCEL,CONFIRM:a.CONFIRM_CONFIRM})});var k=c.defer();c=k.promise;var m=Object.keys(oUrlParams);null===e.getAppLocalStorageItem("session_token")&&-1!==m.indexOf("login")&&-1!==m.indexOf("password")?a.$root.connectFromUrl(oUrlParams):k.resolve();c.then(function(){var b=
e.getAppLocalStorageItem("session_token");null!==b?(f=_.extendOwn(f,oClientProperties),"unstable"!=f.status?(sessionStorage.session_token=b,A({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/vitis/privatetoken",scope:a,success:function(a){1==a.data.status?f.getFromServer().then(function(){h.use(f.language);bootbox.setLocale(f.language);e.restoreSessionFromAppLocalStorage();e.token=b;g.login=sessionStorage.user_login;g.id=parseInt(sessionStorage.user_id);g.privileges=a.data.privileges;sessionStorage.privileges=
a.data.privileges;f.app_name=sessionStorage.application.toLowerCase().charAt(0).toUpperCase()+sessionStorage.application.slice(1);document.title=f.app_name.toUpperCase();null!=f.application_title&&""!=f.application_title&&(document.title=f.application_title);if(null!=f.use_favicon&&null!=f.favicon_path&&1==f.use_favicon){var c=document.createElement("link");c.id="dynamic-favicon";c.type="image/x-icon";c.rel="shortcut icon";c.href=window.location.protocol+"//"+window.location.host+"/"+window.location.pathname.split("/")[1]+
"/"+f.favicon_path+"?version="+f.build;document.getElementsByTagName("head")[0].appendChild(c)}"undefined"!=typeof sessionStorage.environment&&(f.environment=sessionStorage.environment);e.connect()}):e.disconnect()}})):e.disconnect()):(e.clearSessionStorage(),f=_.extendOwn(f,oClientProperties),f.getFromServer().then(function(){h.use(f.language);bootbox.setLocale(f.language);f.app_name=sessionStorage.application.toLowerCase().charAt(0).toUpperCase()+sessionStorage.application.slice(1);a.translationData=
{app_name:f.app_name};document.title=f.app_name.toUpperCase();null!=f.application_title&&""!=f.application_title&&(document.title=f.application_title);if(null!=f.use_favicon&&null!=f.favicon_path&&1==f.use_favicon){var b=document.createElement("link");b.type="image/x-icon";b.rel="icon";b.href=f.favicon_path;document.getElementsByTagName("head")[0].appendChild(b)}a.$evalAsync(function(){});d.sMainTemplateUrl=d.sLoginTemplate;d.sFormDefinitionName="login_form"}))})};v.LA.$inject="$scope $log $q envSrvc sessionSrvc propertiesSrvc userSrvc $translate".split(" ");
v.module.controller("initCtrl",v.LA);v.sB=function(a,b,c,d,e,f,g,h,k,m,p,t,u){e.oFormDefinition={};e.oFormValues={};e.oSectionForm=k.oSectionForm;e.gridOptions={};e.gridApi={};a.oProperties=t;a.aDropdownMenu=[{event:"selectMode('user')",label:"USER_INFOS"}];less.refresh();moment.locale(t.language);c(["USER"],{sUserLogin:p.login}).then(function(b){a.sUserLoginText=b.USER});m.loadModes().then(function(){a.modes=m.modes;e.sSelectedObjectName=k.oSelectedObject.name;k.sSelectedSectionName="";a.objects=m.modes[0].objects;null!=oUrlParams.mode_id?
setTimeout(function(){m.selectMode(a,oUrlParams.mode_id);setTimeout(function(){$(".mode_selected").removeClass("mode_selected");$("#mode_"+oUrlParams.mode_id).addClass("mode_selected")},500)}):m.selectMode(a,m.modes[0].mode_id)});a.editObjectElement=function(a,b,c){this.actionOnObjectElement(a,b,c,"editSectionForm")};a.executeEvent=function(b,c){a.$eval(c)};a.displayObjectElement=function(a,b,c){this.actionOnObjectElement(a,b,c,"showSectionForm")};a.actionOnObjectElement=function(a,c,d,f){m.scope.selectObject(c,
a);var g=e.$on(c,function(){null!=f&&null!=d&&b(function(){angular.element(v.X).scope().$root[f](d)},500);g()})};a.selectMode=function(c,d){m.selectMode(a,c,d).then(function(){b(function(){u.resizeWin();a.setFullScreen(k.oSelectedMode.fullScreen);sessionStorage.ajaxLoader=k.oSelectedMode.ajaxLoader;var b=a.$root.gridApi[a.sSelectedGridOptionsName];null!=b&&(b.core.handleWindowResize(),b.core.refreshRows())},100)})};a.selectObject=function(c,d,e){if(null!=d&&k.oSelectedMode.mode_id!==d){var f,g=m.getMode(d);
if(null==g.objects)return console.error(c+" is not object of "+d),0;for(var h=0;h<g.objects.length;h++)g.objects[h].name===c&&(f=angular.copy(h));if(null==f)return console.error(c+" is not object of "+d),0;m.selectMode(a,d,e,f).then(function(){b(function(){a.setFullScreen(k.oSelectedMode.fullScreen);sessionStorage.ajaxLoader=k.oSelectedMode.ajaxLoader},100);var c=a.$root.gridApi[a.sSelectedGridOptionsName];null!=c&&(c.core.handleWindowResize(),c.core.refreshRows())})}else m.selectObject(a,c,d,e)};
e.compileObjectTemplate=function(b){f(b).then(function(b){g($("#container_mode_"+k.oSelectedMode.mode_id).html(b).contents())(a);$("#data_column .container-mode").hide();$("#container_mode_"+k.oSelectedMode.mode_id).show()});h.info("compileObjectTemplate : "+b)};e.loadList=function(c,d){h.info("loadList");k.sMode="search";if("undefined"!==typeof d){""===d.lang&&(d.lang=t.language);var f={relation:"AND",operators:[]},g;for(g in d)f.operators.push({column:g,compare_operator:"=",value:d[g]});k.oSelectedObject.filter=
f}if(null!==c)var m=e.$on("workspaceListTplCompiled",function(){e.$eval(c);m()});b(function(){var b=a.$root.gridApi[a.sSelectedGridOptionsName];null!=b&&(b.core.handleWindowResize(),b.core.refreshRows())},10)};e.showModeScrollBoutton=function(){return document.getElementById("mode_column").scrollHeight>document.getElementById("mode_column").clientHeight};e.scrollMode=function(a){$("#mode_column").animate({scrollTop:$("#mode_column").scrollTop()+a},200)}};v.sB.$inject="$scope $timeout $translate $translatePartialLoader $rootScope $templateRequest $compile $log envSrvc modesSrvc userSrvc propertiesSrvc externFunctionSrvc".split(" ");
v.module.controller("mainCtrl",v.sB);v.HE=function(a,b,c,d,e){b.info("initWorkspaceList");a.$emit("initWorkspaceList",a);e.addScopeToObject(c.oSelectedObject.name,c.oSelectedMode.mode_id,a);a.edit_column=c.oSelectedObject.edit_column;a.show_column=c.oSelectedObject.show_column;var f;0===Object.keys(a.gridOptions).length&&(b.info("Init GridOptions"),a.gridOptions={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:d.rows_per_page,enableColumnMenus:!1,enableColumnResizing:!0,
paginationPageSizes:[5,10,20,50,100,200,500],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!0,appHeaderOptionBar:!1,appLoadGridData:!0,appGridTitle:c.oSelectedObject.label,appResizeGrid:!1,appFooter:!0,appShowPagination:!0,appEnableDragAndDrop:!1,appDragAndDropEvent:{},appActions:[],appShowActions:!0,appEnableCsvExport:!0,exporterCsvFilename:new String(c.oSelectedObject.label)});var g=c.oSelectedObject.name;a.sSelectedObjectName=g;a.sSelectedSectionName=c.sSelectedSectionName;c.sSelectedGridOptionsName=
g;""!=c.sSelectedSectionName&&(c.sSelectedGridOptionsName+="_"+c.sSelectedSectionName);a.sSelectedGridOptionsName=c.sSelectedGridOptionsName;c.oGridOptions[c.sSelectedGridOptionsName]=a.gridOptions;"undefined"===typeof c.oDefaultGridOptions[c.sSelectedGridOptionsName]&&(c.oDefaultGridOptions[c.sSelectedGridOptionsName]=angular.copy(a.gridOptions));"undefined"===typeof c.oWorkspaceList[c.sSelectedGridOptionsName]?c.oWorkspaceList[c.sSelectedGridOptionsName]={}:("undefined"!==typeof c.oWorkspaceList[c.sSelectedGridOptionsName].oFilter&&
(f=angular.copy(c.oWorkspaceList[c.sSelectedGridOptionsName].oFilter)),"undefined"!==typeof c.oWorkspaceList[c.sSelectedGridOptionsName].oFormValue&&(c.oFormValues[c.sFormDefinitionName]=angular.copy(c.oWorkspaceList[c.sSelectedGridOptionsName].oFormValue)));"undefined"!==typeof f&&(a.gridOptions.oFilter=f);"undefined"!==typeof c.oGridOptionsCopy[c.sSelectedGridOptionsName]&&(a.gridOptions.oUrlParams=angular.copy(c.oGridOptionsCopy[c.sSelectedGridOptionsName].oUrlParams));!0===a.gridOptions.appEnableDragAndDrop&&
(a.gridOptions.rowTemplate='<div grid="grid" class="ui-grid-draggable-row" draggable="true"><div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader, \'custom\': true }" ui-grid-cell></div></div>');var h=c.getSectionWebServiceResourceId(),k=0;"undefined"!==typeof c.oSectionForm&&"undefined"!==typeof c.oSectionForm[c.oSelectedObject.name]&&"undefined"!==typeof c.oSectionForm[c.oSelectedObject.name].iSelectedSectionIndex&&
(k=c.oSectionForm[c.oSelectedObject.name].iSelectedSectionIndex);0<k&&delete c.oSelectedObject.sections[0].columns;if(null!==h&&"undefined"===typeof a.gridOptions.columnDefs)if(null!=c.oSelectedObject.sections[k].columns){c.oGridOptions[c.sSelectedGridOptionsName].paginationCurrentPage=c.oWorkspaceList[c.sSelectedGridOptionsName].oldPaginationSave;a.gridOptions.columnDefs=c.oSelectedObject.sections[k].columns.slice(0);for(var m=0;m<a.gridOptions.columnDefs.length;m++)a.gridOptions.columnDefs[m].cellEditableCondition=
!1;"display"!=c.sMode&&(a.gridOptions.appActions=c.oSelectedObject.sections[k].actions.slice(0));a.$root.$emit("workspaceListHeaderActionsAdded",a.gridOptions);setTimeout(function(){a.$root.$emit("workspaceListColumnsAdded",a.gridOptions)})}else c.oWorkspaceList[c.oSelectedObject.name].oldPaginationSave=1,A({method:"GET",url:d.web_server_name+"/"+d.services_alias+"/vitis/ressources/"+h,scope:a,success:function(d){if(1===d.data.status){var e=c.explodeWebServiceResourceId(h),f=d.data.ressources[0][e[1]][0].columns;
if(0<f.length){f=a.$root.formatGridColumn(f,g);b.info(a.$root.formatGridColumn(f,g));c.oSelectedObject.sIdField=f[0].field;if("undefined"==typeof a.gridOptions.appShowActions||!1!==a.gridOptions.appShowActions)null===c.oSelectedObject.edit_column&&null===c.oSelectedObject.show_column||f.unshift({name:"",field:"actions",cellTemplate:"<app-ui-grid-action></app-ui-grid-action>",width:60,enableSorting:!1,enableColumnMoving:!1,enableColumnResizing:!1});c.oSelectedObject.sections[k].columns=f.slice(0);
a.gridOptions.columnDefs=c.oSelectedObject.sections[k].columns.slice(0);for(f=0;f<a.gridOptions.columnDefs.length;f++)a.gridOptions.columnDefs[f].cellEditableCondition=!1;d=d.data.ressources[0][e[1]][1].actions;c.oSelectedObject.sections[k].actions="undefined"!==typeof d?a.$root.formatGridAction(d,g):[];"display"!=c.sMode&&(a.gridOptions.appActions=c.oSelectedObject.sections[k].actions.slice(0));a.$root.$emit("workspaceListHeaderActionsAdded",a.gridOptions);a.$root.$emit("workspaceListColumnsAdded",
a.gridOptions)}}}});else setTimeout(function(){a.$root.$emit("workspaceListColumnsAdded",a.gridOptions)});a.showExportModal=function(){b.info("showExportModal");$("#ExportModal").modal("show");c.oGridOptions[c.sSelectedGridOptionsName].oUrlParams.limit=1E4;c.oGridOptions[c.sSelectedGridOptionsName].exporterCsvFilename=c.oSelectedObject.label;document.getElementById("ExportModal").querySelector("#SelectValue").options.selectedIndex=0};a.exportCSVFormat=function(){b.info("ExportCSVFormat");var e=c.getSectionWebServiceResourceId(),
f=c.explodeWebServiceResourceId(e),e=c.oGridOptions[c.sSelectedGridOptionsName].oUrlParams,g=document.getElementById("SelectValue"),h=g.options[g.selectedIndex].text,k=a.gridOptions.exporterCsvFilename+".xlsx",z=a.gridOptions.exporterCsvFilename+".csv",D=[],H=[];for(m=0;m<c.oSelectedObject.sections[0].columns.length;m++)""!==c.oSelectedObject.sections[0].columns[m].name&&D.push(c.oSelectedObject.sections[0].columns[m]);A({method:"GET",url:d.web_server_name+"/"+d.services_alias+"/"+f[0]+"/"+f[1],params:angular.copy(e),
scope:a,success:function(a){if(1===a.data.status){var b=a.data[f[1]];for(m=0;m<b.length;m++){var c=[],d={};angular.forEach(D,function(b){d=null!==a.data[f[1]][m][b.field]?a.data[f[1]][m][b.field]:"null";""===a.data[f[1]][m][b.field]&&(d="null");c[b.displayName]=d});H.push(c)}console.log("aExportData: ",H);".XLSX"===h&&alasql("SELECT * INTO XLSX('"+k+"' ,{headers:true}) FROM ? ",[H]);".CSV"===h&&alasql("SELECT * INTO CSV('"+z+"' ,{headers:true}) FROM ? ",[H])}}})}};v.HE.$inject="$scope $log envSrvc propertiesSrvc modesSrvc uiGridExporterService".split(" ");
v.module.controller("workspaceListCtrl",v.HE);v.uD=function(a,b,c,d,e,f){b.info("initSimpleForm");f.addScopeToObject(e.oSelectedObject.name,e.oSelectedMode.mode_id,a);a.bFormValidationMessage=!0;var g=c.$on("formDefinitionLoaded",function(){var a=e.oFormDefinition[e.sFormDefinitionName].title;d([a],e.oFormValues[e.sFormDefinitionName]).then(function(b){e.oFormDefinition[e.sFormDefinitionName].title=b[a]});g()})};v.uD.$inject="$scope $log $rootScope $translate envSrvc modesSrvc".split(" ");v.module.controller("simpleFormCtrl",v.uD);v.sz=function(a,b,c,d,e,f,g){d.info("initDoubleForm");g.addScopeToObject(f.oSelectedObject.name,f.oSelectedMode.mode_id,a);a.sSelectedObjectName=f.oSelectedObject.name;var h=e.$on("doubleFormCompiled",function(){var e="modules/"+f.oSelectedMode.module_name+"/"+f.sTemplateFolder,g=f.getSectionWebServiceResourceId();null!=g?(g=f.explodeWebServiceResourceId(g),e+=g[1]):e="undefined"!=typeof f.oSelectedObject.template_name?e+f.oSelectedObject.template_name:e+f.oSelectedMode.mode_id;g=e+"RightTpl.html";
b(g).then(function(b){c($("#double_form_right_section_"+f.oSelectedObject.name).html(b).contents())(a)});d.info("compileDoubleFormRightTemplate : "+g);e+="LeftTpl.html";b(e).then(function(b){c($("#double_form_left_section_"+f.oSelectedObject.name).html(b).contents())(a)});d.info("compileDoubleFormLeftTemplate : "+e);h()})};v.sz.$inject="$scope $templateRequest $compile $log $rootScope envSrvc modesSrvc".split(" ");v.module.controller("doubleFormCtrl",v.sz);v.YC=function(a,b,c,d,e,f,g,h,k,m,p,t){d.info("initSectionForm");p.addScopeToObject(h.oSelectedObject.name,h.oSelectedMode.mode_id,a);e.bLastSectionContainer=!1;a.bFormValidationMessage=!0;var u={};u.sections=h.oSelectedObject.sections;for(f=u.iSelectedSectionIndex=0;f<u.sections.length;)u.sections[f].bLoaded=!1,f++;var w="SECTION_"+h.sMode.toUpperCase()+"_TITLE_"+h.oSelectedObject.name.toUpperCase();g([w],{sId:h.sId}).then(function(a){u.title=a[w]});h.oSectionForm[h.oSelectedObject.name]=u;h.sFormDefinitionName=
h.oSelectedObject.name+"_"+u.sections[0].name+"_"+h.sMode+"_form";h.oSelectedObject.sFormDefinitionName=h.sFormDefinitionName;h.sSelectedSectionName=u.sections[0].name;var x=e.$watch(e.bLastSectionContainer,function(){a.loadObjectSectionTemplate();x()},!1);a.selectSection=function(b,c){"insert"!=h.sMode&&(h.oSectionForm[h.oSelectedObject.name].iSelectedSectionIndex=b,h.sSelectedSectionName=h.oSectionForm[h.oSelectedObject.name].sections[b].name,h.sFormDefinitionName=h.oSelectedObject.name+"_"+h.oSectionForm[h.oSelectedObject.name].sections[b].name+
"_"+h.sMode+"_form",h.oLastSelectedObjectMode[h.oSelectedMode.mode_id].sFormDefinitionName=h.sFormDefinitionName,$("#container_mode_"+h.oSelectedMode.mode_id+" .container-section").hide(),$("#container_section_"+h.oSelectedObject.name+"_"+c.name).show(),a.loadObjectSectionTemplate(),a.$root.$broadcast("updateStudio_"+h.oSelectedObject.name,{index:b,oSectionForm:c}),t.resizeWin())};a.loadObjectSectionTemplate=function(){var e=h.oSectionForm[h.oSelectedObject.name],f=e.iSelectedSectionIndex,g;g=0==
f?h.sSelectedTemplate:e.sections[f].template;-1==g.indexOf("/")&&(g=h.sTemplateFolder+g);d.info("loadObjectSectionTemplate : "+g);e.sections[f].bLoaded||(a.sSelectedObjectName=h.oSelectedObject.name,c(g).then(function(c){b($("#container_section_"+h.oSelectedObject.name+"_"+e.sections[f].name).html(c).contents())(a)}),d.info("loadObjectSectionTemplate (compilation) : "+g),g=h.oSelectedObject.sections[f].event,"undefined"!=typeof g&&""!=g&&(g=g.replace(/javascript:/i,""),-1==g.indexOf("(")&&(g+="()"),
a.$eval(g)));h.oSectionForm[h.oSelectedObject.name].sections[f].bLoaded=!0;$(".form-map").each(function(a,b){try{angular.element(b).scope().oMap.ca.Qd()}catch(N){}})}};v.YC.$inject="$scope $compile $templateRequest $log $rootScope $timeout $translate envSrvc sessionSrvc propertiesSrvc modesSrvc externFunctionSrvc".split(" ");v.module.controller("sectionFormCtrl",v.YC);v.oB=function(a,b,c,d,e,f,g,h,k,m,p,t){a.showErrorAlert=function(c){b([c]).then(function(b){a.sLoginErrorMessage=b[c];document.getElementById("login_error_alert").style.display="block"})};a.hideErrorAlert=function(){document.getElementById("login_error_alert").style.display="none"};c.oFormDefinition={};c.oFormValues={};g.oSelectedObject={name:"login",sections:[]};less.refresh();"unstable"==h.status&&a.showErrorAlert("FORM_APP_STATUS_ERROR");"UNSTABLE"==h.VM_STATUS&&a.showErrorAlert("FORM_VAS_STATUS_ERROR");
a.oFormRequestParams={sUrl:g.sLoginForm};var u=c.$on("formDefinitionLoaded",function(){u();var a=t.getFormElementDefinition("domain","login_form");"undefined"!=typeof h.domain&&(1<Object.keys(h.domain).length||""!=Object.keys(h.domain)[0])&&(a.visible=!0)}),w=c.$on("endFormNgRepeat",function(){w();if(t.getFormElementDefinition("domain","login_form").visible){for(var a=g.oFormValues[g.sFormDefinitionName],b=Object.keys(h.domain),c=[{label:b[d],value:""}],d=0;d<b.length;)""!=b[d]&&h.domain[b[d]]&&c.push({label:b[d],
value:h.domain[b[d]]}),d++;a.domain={options:c,selectedOption:{label:b[d],value:""}}}});$("#modal_forgotten_password").on("hidden.bs.modal",function(){a.sFormDefinitionName="login_form";a.oFormRequestParams={sUrl:g.sLoginForm};a.$digest()});$("#modal_sign_up").on("hidden.bs.modal",function(){a.sFormDefinitionName="login_form";a.oFormRequestParams={sUrl:g.sLoginForm};a.$digest()});a.showModalForgottenPassword=function(){$("#modal_forgotten_password").modal("show");a.sFormDefinitionName=g.oSelectedObject.name+
"_forgotten_password_form";a.oFormRequestParams={sUrl:g.sForgottenPasswordForm};a.$root.clearFormData(a.sFormDefinitionName,a);a.bLoadFormValues=!1;g.oFormValues[a.sFormDefinitionName]={};m("templates/formTpl.html").then(function(b){p($("#modal_forgotten_password_form_container").html(b).contents())(a)})};a.showModalSignUp=function(){$("#modal_sign_up").modal("show");a.sFormDefinitionName=g.oSelectedObject.name+"_sign_up_form";a.oFormRequestParams={sUrl:g.sSignUpForm};a.$root.clearFormData(a.sFormDefinitionName,
a);a.bLoadFormValues=!1;g.oFormValues[a.sFormDefinitionName]={};m("templates/formTpl.html").then(function(c){p($("#modal_sign_up_form_container").html(c).contents())(a);if(!0===h.sign_up_cgu)var d=a.$root.$on("formDefinitionLoaded",function(a,b){d();t.getFormElementDefinition("signupcgu",b).visible=!0}),e=a.$root.$on("formExtracted",function(a,c){e();var d=t.getFormElementDefinition("signupcgu",c);b(["ACCEPT_CGU"],h).then(function(a){d.label=a.ACCEPT_CGU;angular.element("#"+d.id).scope().$broadcast("$$rebind::refresh");
angular.element("#"+d.id).scope().$applyAsync()})})})};a.sendInscriptionRequest=function(){var c=a.sFormDefinitionName;if(null!=a.oFormValues[c].captcha){if(!0===h.sign_up_cgu){if(null==a.oFormValues[c].signupcgu){b("CHECKCGU").then(function(a){$.notify(a,"error")});return}if(!1===a.oFormValues[c].signupcgu){b("CHECKCGU").then(function(a){$.notify(a,"error")});return}}null!=a.oFormValues[c].signuppasswordconfirmation?a.oFormValues[c].signuppasswordconfirmation!==a.oFormValues[c].password?b("CONFIRMPASSWORD").then(function(a){$.notify(a,
"error")}):(ed(),A({method:"POST",url:h.web_server_name+"/"+h.services_alias+"/vitis/accounts/sign_up",params:t.getFormData(c,!0),success:function(d){fd();403===d.status?b("ACCOUNTSERVICENOTAVAILABLE").then(function(a){$.notify(a,"error")}):null!=d.data.status?5===d.data.status?(b("LOGINNOTAVAILABLE").then(function(a){$.notify(a,"error")}),grecaptcha.reset(),a.oFormValues[c].captcha=null):($("#modal_sign_up").modal("hide"),b("CHECKMAIL").then(function(a){$.notify(a,"success")})):""===d.data?(b("LOGINNOTAVAILABLE").then(function(a){$.notify(a,
"error")}),grecaptcha.reset(),a.oFormValues[c].captcha=null):($("#modal_sign_up").modal("hide"),b("CHECKMAIL").then(function(a){$.notify(a,"success")}))},error:function(){fd();console.error("ERROR")}})):b("CONFIRMPASSWORD").then(function(a){$.notify(a,"error")})}else b("NOCAPTCHA").then(function(a){$.notify(a,"error")})};a.sendFpwdRequest=function(){var c=a.sFormDefinitionName;ed();A({method:"POST",url:h.web_server_name+"/"+h.services_alias+"/vitis/accounts/fpwd",params:{username:a.oFormValues[c].fpwd_login,
mail:a.oFormValues[c].fpwdmail,company:a.oFormValues[c].fpwdporganization},success:function(a){fd();403===a.status?b("ACCOUNTSERVICENOTAVAILABLE").then(function(a){$.notify(a,"error")}):null!=a.data.status&&(7===a.data.status?b("LOGINNOTKNOWN").then(function(a){$.notify(a,"error")}):($("#modal_forgotten_password").modal("hide"),b("CHECKMAIL").then(function(a){$.notify(a,"success")})))},error:function(){fd();console.error("ERROR")}})};a.sendLoginForm=function(){var c=d.defer(),f=c.promise;if("unstable"==
h.status)c.reject();else{a.hideErrorAlert();var g=a.sFormDefinitionName,m=a.oFormValues[g].user_login,p=a.oFormValues[g].domain;"undefined"!=typeof p&&"undefined"!=typeof p.selectedOption&&""!=p.selectedOption.value&&"undefined"!=typeof p.selectedOption.value&&-1==m.indexOf("@")&&(m+="@"+p.selectedOption.value);A({method:"POST",url:h.web_server_name+"/"+h.services_alias+"/"+e.web_service+"/"+e.web_service_controller,scope:a,data:{user:m,password:a.oFormValues[g].user_password},success:function(d){if(1==
d.data.status)a.hideErrorAlert(),e.token=d.data.token,e.validity_date=d.data.validity_date,sessionStorage.session_token=e.token,k.login=m,k.id=parseInt(d.data.user_id),k.privileges=d.data.privileges,sessionStorage.user_login=m,sessionStorage.user_id=k.id,sessionStorage.privileges=k.privileges,h.getFromServer().then(function(){h.app_name=sessionStorage.application.toLowerCase().charAt(0).toUpperCase()+sessionStorage.application.slice(1);"undefined"!=typeof sessionStorage.environment&&(h.environment=
sessionStorage.environment);e.connect();c.resolve()}),!0===a.oFormValues[g].remember_me&&e.saveSessionToLocalStorage();else{var f;"undefined"==typeof d.data.errorCode&&(d.data.errorCode="");switch(d.data.errorCode){case 11:f="FORM_LOGIN_CONNECTION_ERROR_FORBIDDEN_IP";d=d.data.errorMessage;var p=d.substr(d.indexOf("'")+1,d.lastIndexOf("'")-d.indexOf("'")-1);b([f]).then(function(b){f=b[f];y;a.showErrorAlert(f.replace("[IPAddress]",p));c.reject()});break;default:f="FORM_LOGIN_CONNECTION_ERROR",a.showErrorAlert(f),
c.reject()}}}})}return f}};v.oB.$inject="$scope $translate $rootScope $q sessionSrvc externFunctionSrvc envSrvc propertiesSrvc userSrvc $templateRequest $compile formSrvc".split(" ");v.module.controller("loginCtrl",v.oB);v.EA=function(a,b,c,d,e,f,g,h){b.info("initHtmlForm");a.oFormScope=a;a.oProperties=f;a.sToken=g.token;"function"===typeof destructor_form&&destructor_form();"function"===typeof constructor_form&&(constructor_form=void 0);"undefined"==typeof a.sFormDefinitionName&&(a.sFormDefinitionName=e.sFormDefinitionName);var k=c.defer();c=k.promise;g=e.oSelectedObject.name;var m=e.getSectionWebServiceResourceId();if("undefined"!=typeof g){var p="";if(1<e.oSelectedObject.sections.length){var t=e.oSectionForm[g];
"undefined"==typeof t||hb(t)||0!=t.iSelectedSectionIndex&&(p=t.sections[t.iSelectedSectionIndex].name)}}"undefined"==typeof e.oFormValues[a.sFormDefinitionName]&&(e.oFormValues[a.sFormDefinitionName]={});"boolean"!=typeof a.bLoadFormValues&&(a.bLoadFormValues=!0);if(null==m||"update"!=e.sMode&&"display"!=e.sMode||!0!==a.bLoadFormValues)"insert"==e.sMode&&(e.oFormValues[a.sFormDefinitionName]={},e.oFormDefaultValues[a.sFormDefinitionName]={}),d(function(){k.resolve("load form. def.")});else{b.info("initHtmlForm : Form. values");
var u=e.explodeWebServiceResourceId(m);A({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/"+u[0]+"/"+u[1]+"/"+e.sId,scope:a,success:function(b){if(1==b.data.status)e.oFormValues[a.sFormDefinitionName]={},e.oFormValues[a.sFormDefinitionName]=e.extractWebServiceData(u[1],b.data)[0],e.oFormDefaultValues[a.sFormDefinitionName]=angular.copy(e.oFormValues[a.sFormDefinitionName]),k.resolve("load form. def.");else{var c={className:"modal-danger",buttons:{ok:{label:"OK",className:"btn-default"}}};
null!=b.data.errorMessage&&(c.message=b.data.errorMessage);h.modalWindow("alert","FORM_VALUES_LOADING_ERROR",c)}}})}if("undefined"!=typeof g){var w={};null!=a.oFormRequestParams?w=a.oFormRequestParams:(w.sUrl="modules/"+e.oSelectedMode.module_name+"/forms/"+e.oSelectedMode.mode_id+"/"+g,""!=p&&(w.sUrl+="_"+p),w.sUrl+=".json");var x={params:w.oParams};"undefined"!=typeof w.oHeaders&&(x.headers=w.oHeaders);b.info("initHtmlForm : Form. def. : "+w.sUrl);c.then(function(){A({method:"GET",url:w.sUrl,params:x.params,
headers:x.headers,scope:a,success:function(c){if(0!=c.data.status){e.oFormDefinition[a.sFormDefinitionName]={};var d="",f="",g;for(g in c.data)Array.isArray(c.data[g])&&(d=c.data[g][0].json_form[1],f=c.data[g][0].json_form[2]);"undefined"!=typeof w.sExtractData&&(w.oData=c.data,c.data=a.$eval(w.sExtractData));if(null!=c.data){if(n(c.data.datasources))var k=angular.copy(c.data.datasources);c.data=c.data[e.sMode];e.oFormDefinition[a.sFormDefinitionName]=c.data;e.oFormDefinition[a.sFormDefinitionName].JS_url=
d;e.oFormDefinition[a.sFormDefinitionName].CSS_url=f;""!=d&&!1!==c.data.javascript&&(c.data.javascript=!0);null!=k&&(e.oFormDefinition.datasources=k);a.$root.$emit("formDefinitionLoaded",a.sFormDefinitionName);e.oFormDefinition[a.sFormDefinitionName].formDefinitionLoaded=!0;if(!0===c.data.javascript){var m="",m=-1===w.sUrl.indexOf(".json")?d:w.sUrl.replace(/.json/g,".js");b.info("initHtmlForm : javascript assoc. to : "+w.sUrl);ad([m],{callback:function(){angular.element(v.Wb).ready();"function"==
typeof constructor_form&&constructor_form(a,m);var b=document.querySelector("script[src='"+m+"?version="+sessionStorage.build+"']");null!==b&&b.parentNode.removeChild(b)},async:!0,scriptInBody:!0})}}a.oFormRequestParams=null}else e.oFormDefinition[a.sFormDefinitionName]={},e.oFormValues[a.sFormDefinitionName]={},e.oFormDefaultValues[a.sFormDefinitionName]={},d={className:"modal-danger",buttons:{ok:{label:"OK",className:"btn-default"}}},null!=c.data.errorMessage&&(d.message=c.data.errorMessage),h.modalWindow("alert",
"FORM_DEFINITION_LOADING_ERROR",d)}})})}};v.EA.$inject="$scope $log $q $timeout envSrvc propertiesSrvc sessionSrvc externFunctionSrvc".split(" ");v.module.controller("htmlFormCtrl",v.EA);v.$o=function(a){a.clearLessCache();$.notify.defaults({autoHideDelay:3E3});return{restrict:"A",controller:"initCtrl",controllerAs:"ctrl"}};v.appInitDrtv=v.$o;v.$o.$inject=["externFunctionSrvc"];v.module.directive("appInit",v.$o);v.f=function(a,b){return{restrict:"A",controller:"mainCtrl",controllerAs:"ctrl",link:function(c){v.zk("appMainDrtvLoaded");a.onresize=function(){b.resizeWin()};c.$on("$destroy",function(){a.onresize=null})}}};v.appMainDrtv=v.f;v.f.$inject=["$window","externFunctionSrvc"];v.module.directive("appMain",v.f);v.qy=function(a){return{link:function(b,c){a(function(){$(c).children().popover({trigger:"hover"});$("#object_column").mCustomScrollbar({axis:"x",theme:"dark-thick"})});b.$on("$destroy",function(){$(c).children().popover("destroy")})}}};
v.qy.$inject=["$timeout"];v.module.directive("repeatMode",v.qy);v.X=function(a,b,c,d,e,f,g,h){return{restrict:"A",controller:"workspaceListCtrl",controllerAs:"ctrl",scope:!0,link:function(k,m){var p;k.gridOptions.onRegisterApi=function(a){k.$root.gridApi[h.sSelectedGridOptionsName]=a;h.oGridOptions[h.sSelectedGridOptionsName].oUrlParams=null!=k.gridOptions.oUrlParams?k.gridOptions.oUrlParams:{order_by:h.oSelectedObject.sorted_by,sort_order:h.oSelectedObject.sorted_dir};a.pagination.on.paginationChanged(k,function(b,c){!1!==a.grid.options.useExternalPagination?
"undefined"!==typeof h.oGridOptions[h.sSelectedGridOptionsName]&&"undefined"!==typeof k.$root.gridApi[h.sSelectedGridOptionsName]&&(h.oGridOptions[h.sSelectedGridOptionsName].oFilter=angular.copy(h.oGridOptions[h.sSelectedGridOptionsName].oFilter),k.setGridPage(b,c,h.oGridOptions[h.sSelectedGridOptionsName].oFilter,h.oGridOptions[h.sSelectedGridOptionsName].oUrlParams),g.rows_per_page=h.oGridOptions[h.sSelectedGridOptionsName].paginationPageSize):k.$root.setPaginationStatus()});a.core.on.sortChanged(k,
function(a,b){a={};0<b.length&&(a.order_by=b[0].field,a.sort_order=b[0].sort.direction.toUpperCase());h.oGridOptionsCopy[h.sSelectedGridOptionsName].oUrlParams.order_by=a.order_by;h.oGridOptionsCopy[h.sSelectedGridOptionsName].oUrlParams.sort_order=a.sort_order;b=0;"undefined"!=typeof h.oSectionForm&&"undefined"!=typeof h.oSectionForm[h.oSelectedObject.name]&&"undefined"!=typeof h.oSectionForm[h.oSelectedObject.name].iSelectedSectionIndex&&(b=h.oSectionForm[h.oSelectedObject.name].iSelectedSectionIndex);
if(Array.isArray(h.oSelectedObject.sections)){for(var c=h.oSelectedObject.sections[b].columns,d=0;d<c.length;)delete c[d].sort,c[d].field===a.order_by&&(c[d].sort={direction:e[a.sort_order],ignoreSort:!0,priority:0}),d++;h.oSelectedObject.sections[b].columns=c}h.oGridOptions[h.sSelectedGridOptionsName].oUrlParams=a;1===h.oGridOptions[h.sSelectedGridOptionsName].paginationCurrentPage?k.$root.gridApi[h.sSelectedGridOptionsName].pagination.raise.paginationChanged(1,h.oGridOptions[h.sSelectedGridOptionsName].paginationPageSize):
h.oGridOptions[h.sSelectedGridOptionsName].paginationCurrentPage=1});"undefined"!==typeof a.dragndrop&&(!0===k.gridOptions.appEnableDragAndDrop?(a.dragndrop.setDragDisabled=!1,a.draggableRows.on.rowDragged(k,function(){}),a.draggableRows.on.rowFinishDrag(k,function(){if("undefined"!==typeof k.gridOptions.appDragAndDropEvent&&"undefined"!==typeof k.gridOptions.appDragAndDropEvent.rowFinishDrag)k.$root[k.gridOptions.appDragAndDropEvent.rowFinishDrag]()}),a.draggableRows.on.rowEnterRow(k,function(){}),
a.draggableRows.on.beforeRowMove(k,function(){})):a.dragndrop.setDragDisabled=!0);h.oGridOptionsCopy[h.sSelectedGridOptionsName]=angular.copy(h.oGridOptions[h.sSelectedGridOptionsName]);if(h.oGridOptions[h.sSelectedGridOptionsName].appLoadGridData)var c=b.$on("workspaceListColumnsAdded",function(){var a=null!=h.oSelectedObject.iPageNumber?h.oSelectedObject.iPageNumber:1;!0===h.oGridOptions[h.sSelectedGridOptionsName].sectionGrid&&(a=null!=h.oGridOptions[h.sSelectedGridOptionsName].paginationCurrentPage?
h.oGridOptions[h.sSelectedGridOptionsName].paginationCurrentPage:1);k.setGridPage(a,h.oGridOptions[h.sSelectedGridOptionsName].paginationPageSize,h.oGridOptions[h.sSelectedGridOptionsName].oFilter,h.oGridOptions[h.sSelectedGridOptionsName].oUrlParams);c()});!0===h.oGridOptions[h.sSelectedGridOptionsName].appResizeGrid&&(k.$root.gridApi[h.sSelectedGridOptionsName].core.handleWindowResize(),k.$root.gridApi[h.sSelectedGridOptionsName].core.refreshRows());k.$root.setPaginationStatus()};a(function(){f.resizeWin();
k.$root.gridApi[h.sSelectedGridOptionsName].core.handleWindowResize();k.$root.gridApi[h.sSelectedGridOptionsName].core.refreshRows();$(m).find(".ui-grid-render-container-body").on("click.selectRow",function(a){a=a.target;if($(a).hasClass("ui-grid-cell")||$(a).hasClass("ui-grid-cell-contents"))a=$(m).find(".ui-grid-render-container-body .ui-grid-canvas").children().index($(a).parents(".ui-grid-row")),$(m).find(".ui-grid-render-container-left .ui-grid-row").eq(a).find(".ui-grid-selection-row-header-buttons").click()});
m[0].querySelector(".ui-grid-render-container-body").style.height="100%";m[0].querySelector(".ui-grid-render-container-body .ui-grid-viewport").style.height="Calc(100% - 30px)";b.$emit("workspaceListTplCompiled")},1);$(m).find(".workspacelist-grid-header-search-button-arrow-right").click(function(){k.searchFormCompiled||(c("templates/formTpl.html").then(function(a){d($("#"+h.oSelectedObject.name+"_"+h.sSelectedSectionName+"_grid_header_search_form").html(a).contents())(k);p=k.$root.$on("formExtracted",
function(a,b){b===h.sFormDefinitionName&&(p(),"undefined"==typeof h.oWorkspaceList[h.sSelectedGridOptionsName].oDefaultValues?(h.oWorkspaceList[h.sSelectedGridOptionsName].oDefaultValues=angular.copy(h.oFormValues[h.sFormDefinitionName]),h.oWorkspaceList[h.sSelectedGridOptionsName].oValues=angular.copy(h.oFormValues[h.sFormDefinitionName]),h.oWorkspaceList[h.sSelectedGridOptionsName].oFormDefinition=angular.copy(h.oFormDefinition[h.sFormDefinitionName])):(h.oFormValues[h.sFormDefinitionName]=angular.copy(h.oWorkspaceList[h.sSelectedGridOptionsName].oValues),
h.oFormDefinition[h.sFormDefinitionName]=angular.copy(h.oWorkspaceList[h.sSelectedGridOptionsName].oFormDefinition),k.$broadcast("$$rebind::refresh"),k.$apply()))})}),k.searchFormCompiled=!0);a(function(){$(this).parent().find(".workspacelist-grid-header-search-button-arrow-icon").toggleClass("icon-keyboard_arrow_right");$(this).parent().find(".workspacelist-grid-header-search-button-arrow-icon").toggleClass("icon-keyboard_arrow_down");$(m).find(".workspacelist-grid-header-search-form").slideToggle(400,
function(){f.resizeWin();k.$root.gridApi[h.sSelectedGridOptionsName].core.handleWindowResize();k.$root.gridApi[h.sSelectedGridOptionsName].core.refreshRows()})})});k.$on("$destroy",function(){$(m).find(".ui-grid-render-container-body").off("click.selectRow");var a=h.oGridOptions[h.sSelectedGridOptionsName];null!==a&&("columnDefs data appActions oFilter oUrlParams paginationPageSizes".split(" ").forEach(function(b){h.toGarbageCollection(a[b])}),a.onRegisterApi=null,h.oGridOptions[h.sSelectedGridOptionsName]=
null,k.gridOptions=null,b.gridApi[h.sSelectedGridOptionsName]=null,h.oGridOptions[h.sSelectedGridOptionsName]={});ga(p)&&p()})}}};v.appWorkspaceListDrtv=v.X;v.X.$inject="$timeout $rootScope $templateRequest $compile uiGridConstants externFunctionSrvc propertiesSrvc envSrvc".split(" ");v.module.directive("appWorkspaceList",v.X);v.FF=function(){return{replace:!0,templateUrl:"templates/uiGridActionTpl.html"}};v.module.directive("appUiGridAction",v.FF);v.GF=function(){return{templateUrl:"templates/uiGridPaginationTpl.html"}};
v.module.directive("appUiGridPagination",v.GF);v.CF=function(){return{replace:!0}};v.module.directive("appSearchForm",v.CF);v.wy=function(){return{restrict:"A",controller:"simpleFormCtrl",controllerAs:"ctrl",scope:!0}};v.appSimpleFormDrtv=v.wy;v.module.directive("appSimpleForm",v.wy);
v.xy=function(a,b,c,d,e,f,g){return{replace:!0,templateUrl:"templates/formTpl.html",link:function(h){a(function(){e.resizeWin()});h.$root.sendSimpleForm=function(a,e){var k=c.defer(),m=k.promise,u=d.sFormDefinitionName;null!=e||(e=g.getFormData(d.sFormDefinitionName));var w=d.getSectionWebServiceResourceId(),w=d.explodeWebServiceResourceId(w),x=d.oFormDefinition[d.sFormDefinitionName].name,z=angular.element("form[name='"+x+"']").scope();"undefined"==typeof z[x].appFormSubmitted&&(z[x].appFormSubmitted=
!1);if(z[x].$valid&&!z[x].appFormSubmitted){if(z[x].appFormSubmitted=!0,"update"==d.sMode||"insert"==d.sMode){var w=f.web_server_name+"/"+f.services_alias+"/"+w[0]+"/"+w[1],D;"update"==d.sMode?(D="PUT",w+="/"+d.sId):D="POST";A({method:D,url:w,data:e,scope:h,success:function(c){!0===a&&h.$root.clearFormData(u,h);if(1==c.data.status)h.bFormValidationMessage&&b("FORM_VALIDATION_OK").then(function(a){$.notify(a,"success")}),"insert"==d.sMode&&(d.sId=c.data[d.oSelectedObject.sIdField]),z[x].appFormSubmitted=
!1,k.resolve(!0);else{if(h.bFormValidationMessage){if("undefined"!=typeof c.data.errorMessage&&null!=c.data.errorMessage)var e=c.data.errorMessage;h.modalWindow("dialog","FORM_VALIDATION_ERROR",{className:"modal-danger",message:e,callback:function(){k.reject(!1)}})}z[x].appFormSubmitted=!1}}})}}else k.reject(!1);return m}}}};v.xy.$inject="$timeout $translate $q envSrvc externFunctionSrvc propertiesSrvc formSrvc".split(" ");v.module.directive("appSimpleFormFormular",v.xy);v.rt=function(a,b,c){return{restrict:"A",controller:"doubleFormCtrl",controllerAs:"ctrl",scope:!0,replace:!0,link:function(){a(function(){b.$emit("doubleFormCompiled");c.resizeWin()})}}};v.appDoubleFormDrtv=v.rt;v.rt.$inject=["$timeout","$rootScope","externFunctionSrvc"];v.module.directive("appDoubleForm",v.rt);v.ry=function(){return{restrict:"A",controller:"sectionFormCtrl",controllerAs:"ctrl",scope:!0}};v.appSectionFormDrtv=v.ry;v.module.directive("appSectionForm",v.ry);
v.sy=function(a){return{link:function(b,c){var d="col-xs-12",d="insert"==a.sMode?d+" section-form-section-insert":d+" section-form-section";b.$index==b.oSectionForm[b.sSelectedObjectName].iSelectedSectionIndex&&(d+=" section-form-section-selected");c[0].className=d;$(c).on("click.selectSection",function(){"insert"!=a.sMode&&($(this).parent().find(".section-form-section").removeClass("section-form-section-selected"),$(this).addClass("section-form-section-selected"))});b.$on("$destroy",function(){$(c).off("click.selectSection")})}}};
v.sy.$inject=["envSrvc"];v.module.directive("appSectionFormMenu",v.sy);v.ty=function(a,b){return{link:function(c,d){c.$index==b.oSectionForm[c.sSelectedObjectName].iSelectedSectionIndex?$(d).show():$(d).hide();c.$last&&(a.bLastSectionContainer=!0)}}};v.ty.$inject=["$rootScope","envSrvc"];v.module.directive("appSectionFormSection",v.ty);v.st=function(){return{restrict:"A",controller:"loginCtrl",controllerAs:"ctrl"}};v.appLoginDrtv=v.st;v.module.directive("appLogin",v.st);v.ey=function(a,b){return{replace:!0,templateUrl:"templates/formTpl.html",link:function(c){var d=c.$root.$on("formDefinitionLoaded",function(){a(function(){if("unstable"==String(b.status).toLowerCase()||"unstable"==String(b.VM_STATUS).toLowerCase())document.querySelector("button[type='submit']").disabled=!0;d()})})}}};v.ey.$inject=["$timeout","propertiesSrvc"];
v.module.directive("appLoginForm",v.ey);v.wF=function(){return{replace:!0,templateUrl:"templates/formTpl.html",link:function(){}}};v.module.directive("appFpwdForm",v.wF);v.Wb=function(a){return{restrict:"A",controller:"htmlFormCtrl",controllerAs:"ctrl",link:function(b){b.oFormDefinition=a.oFormDefinition;b.oFormValues=a.oFormValues;b.submitButton=!1}}};v.appHtmlFormDrtv=v.Wb;v.Wb.$inject=["envSrvc"];v.module.directive("appHtmlForm",v.Wb);function BB(a){var b=this;this.url=a;this.callbacks={};this.FO=!0;this.cv=!1;this.tM=5E3;this.iG=3E4;this.connect();CB(this);this.on("reconnectClient",function(){DB(b,"reconnectClient",sessionStorage.user_id)})}BB.prototype.on=function(a,b){this.callbacks[a]=this.callbacks[a]||[];this.callbacks[a].push(b);return this};BB.prototype.on=BB.prototype.on;function DB(a,b,c,d){a.wd.send(JSON.stringify(null!=d?{service:d,action:b,data:c}:{action:b,data:c}))}
BB.prototype.LD=function(a){function b(){DB(c,"subscribe",sessionStorage.user_id,a)}var c=this;this.wd.readyState===this.wd.OPEN&&(b(),this.on("connect",function(){b()}));if(this.wd.readyState===this.wd.CONNECTING)this.on("connect",function(){b()})};BB.prototype.subscribeService=BB.prototype.LD;BB.prototype.PA=function(){return this.wd.readyState===this.wd.OPEN};BB.prototype.isConnected=BB.prototype.PA;BB.prototype.sendMessage=function(a){DB(this,"echo",a)};BB.prototype.sendMessage=BB.prototype.sendMessage;
BB.prototype.eN=function(a){DB(this,"event",a)};BB.prototype.sendEvent=BB.prototype.eN;BB.prototype.gD=function(){DB(this,"ping","")};BB.prototype.sendPing=BB.prototype.gD;
BB.prototype.connect=function(){var a=this;this.wd="function"===typeof MozWebSocket?new MozWebSocket(this.url):new WebSocket(this.url);this.wd.onmessage=function(b){var c,d;try{c=JSON.parse(b.data)}catch(e){d=b.data}null!=c&&null!=c.action&&EB(a,c.action,c.data);null!=d&&EB(a,"message",d)};this.wd.onclose=function(){this.cv=!1;EB(a,"disconnect",null);a.FO&&setTimeout(function(){a.connect()},a.tM)};this.wd.onopen=function(){DB(a,"connect",sessionStorage.user_id)};this.on("connect",function(){this.cv=
!0})};BB.prototype.connect=BB.prototype.connect;BB.prototype.disconnect=function(){this.wd.close()};BB.prototype.disconnect=BB.prototype.disconnect;function EB(a,b,c){a=a.callbacks[b];if("undefined"!==typeof a)for(b=0;b<a.length;b++)a[b](c)}
function CB(a){function b(){setTimeout(function(){null!=a.wd.readyState&&null!=a.wd.OPEN&&a.wd.readyState===a.wd.OPEN&&(c=!1,a.gD(),setTimeout(function(){!1===c?(console.error("WebSocket connection broken"),a.disconnect()):a.cv=!0},1E3));b()},a.iG)}var c;a.on("ping",function(){c=!0});b()};v.on("appInitCtrlLoaded",function(){var a=angular.element(v.Wb).injector().get(["$q"]),b=angular.element(v.f).injector().get(["$log"]),c=angular.element(v.f).injector().get(["envSrvc"]),d=angular.element(v.X).injector().get(["formSrvc"]),e=angular.element(v.X).injector().get(["$timeout"]),f=angular.element(v.X).injector().get(["$compile"]),g=angular.element(v.f).injector().get(["modesSrvc"]),h=angular.element(v.f).injector().get(["$translate"]),k=angular.element(v.f).injector().get(["propertiesSrvc"]),
m=angular.element(v.X).injector().get(["uiGridConstants"]),p=angular.element(v.X).injector().get(["$templateRequest"]),t=angular.element(v.f).injector().get(["externFunctionSrvc"]);v.on("properties_loaded",function(){if(null!=k.websocket_alias){var a="wss://"+location.host+"/"+k.websocket_alias+"/";v.oWebsocket=new BB(a);v.oWebsocket.oGridRefreshEvents={};v.oWebsocket.on("connect",function(c){b.info("VitisWebsocket: Connected to "+a+" with "+c)});v.oWebsocket.on("disconnect",function(){b.info("VitisWebsocket: Disconnected")});
v.oWebsocket.on("subscribe",function(a){b.info("VitisWebsocket: Subscribed to "+a)});v.oWebsocket.on("echo",function(a){b.info("VitisWebsocket echo: "+a);$.notify("VitisWebsocket: "+a,"success")});v.oWebsocket.on("event",function(a){b.info("VitisWebsocket event: ",a)});setTimeout(function(){v.oWebsocket.PA()||(b.error("VitisWebsocket was not able to connect"),h(["INACCESSIBLE_WEBSOCKET"]).then(function(a){console.error(a.INACCESSIBLE_WEBSOCKET)}))},5E3)}});setTimeout(function(){py&&!0===k.geolocation_enabled&&
(v.oGeoLocation=new py({pa:"EPSG:4326",Yw:!0,Zw:{maximumAge:1E4,enableHighAccuracy:!0,timeout:3E5}}))},2E3);py&&"true"==window.oClientProperties.geolocation&&(v.oGeoLocation=new py({pa:"EPSG:4326",Yw:!0,Zw:{maximumAge:1E4,enableHighAccuracy:!0,timeout:3E5}}));angular.element(v.f).scope().is_mobile=oClientProperties.is_mobile;angular.element(v.f).scope().loadSimpleForm=function(){c.sMode="update";b.info("loadSimpleForm")};angular.element(v.f).scope().scopeEval=function(a,c){b.info(c);a.$eval(c)};angular.element(v.f).scope().selectMode=
function(d){b.info("appMainDrtv.selectMode");if(null==d)return console.error("sModeId not defined"),null;if(null==g.getMode(d).objects)return console.error("sModeId "+d+" is not valid"),null;var f=a.defer(),h=angular.element($("#mode_column")).scope();g.selectMode(h,d).then(function(){e(function(){t.resizeWin();h.setFullScreen(c.oSelectedMode.fullScreen);sessionStorage.ajaxLoader=c.oSelectedMode.ajaxLoader;var a=h.$root.gridApi[h.sSelectedGridOptionsName];null!=a&&(a.core.handleWindowResize(),a.core.refreshRows());
f.resolve()},100)});return f.promise};angular.element(v.f).scope().selectObject=function(d,f){b.info("appMainDrtv.selectObject");if(null==d)return console.error("sModeId not defined"),null;if(null==f)return console.error("sObjectId not defined"),null;var h,k=g.getMode(d);if(null==k.objects)return console.error("sModeId "+d+" is not valid"),null;for(var m=0;m<k.objects.length;m++)k.objects[m].name===f&&(h=angular.copy(m));var p=a.defer(),u=angular.element($("#mode_column")).scope();g.selectMode(u,
d,void 0,h).then(function(){e(function(){t.resizeWin();u.setFullScreen(c.oSelectedMode.fullScreen);sessionStorage.ajaxLoader=c.oSelectedMode.ajaxLoader;var a=u.$root.gridApi[u.sSelectedGridOptionsName];null!=a&&(a.core.handleWindowResize(),a.core.refreshRows());p.resolve()},100)});return p.promise};angular.element(v.f).scope().selectElement=function(a,c,d,e){b.info("appMainDrtv.selectElement");if(null==a)return console.error("sModeId not defined"),null;if(null==c)return console.error("sObjectId not defined"),
null;if(null==d)return console.error("sElemId not defined"),null;e=null!=e?e:"update";this.selectObject(a,c).then(function(){var a=angular.element(v.X).scope().$root.$on("workspaceListDataAdded",function(){setTimeout(function(){"update"===e?angular.element(v.X).scope().$root.editSectionForm(d):"display"===e&&angular.element(v.X).scope().$root.showSectionForm(d)});a()})})};angular.element(v.X).scope().AddDoubleForm=function(){c.addDoubleForm();b.info("AddDoubleForm")};angular.element(v.X).scope().AddSectionForm=
function(){b.info("AddSectionForm");var a="before"+Ia(c.oSelectedObject.name,"_").replace(/_/g,"")+"Edition";if("undefined"!=typeof this[a])this[a]();c.addSectionForm()};angular.element(v.f).scope().setMode=function(a){b.info("setMode: "+a);var d=c.oSelectedMode.mode_id,e=c.oSelectedObject.name;c.setMode(a).then(function(){angular.element("#container_mode_"+d).empty();g.clearObjectData(e,d)})};angular.element(v.f).scope().setFullScreen=function(a){b.info("setFullScreen",a);var c=$("#header_line").height();
null==a||!0===a?"0px"===$("#header_line").css("margin-top")&&($("#header_line").animate({"margin-top":-c+"px"}),$("#works_line").animate({height:c+$("#works_line").height()+"px"}),$(".popover").hide()):"0px"!==$("#header_line").css("margin-top")&&($("#header_line").animate({"margin-top":"0px"}),$("#works_line").animate({height:$("#works_line").height()-c+"px"}),e(function(){t.resizeWin()},500))};angular.element(v.f).scope().reloadSection=function(){b.info("reloadSection : "+c.sMode);c.setSectionForm(c.sMode,
c.sId)};angular.element(v.f).scope().getProperty=function(a,c){b.info("getProperty : "+a);var d;-1!=a.indexOf(".")?eval("sValue = propertiesSrvc."+a):d=k[a];"undefined"!=typeof c&&("undefined"!=typeof c.concatBefore&&(d=c.concatBefore+d),"undefined"!=typeof c.concatAfter&&(d+=c.concatAfter));return d};angular.element(v.f).scope().getPropertie=function(a){return angular.element(v.f).scope().getProperty(a)};v.compileProvider.directive("appSetBooleanIconColumn",function(){return{link:function(a,b,c){var d=
c.$observe("appSetBooleanIconColumn",function(){var d;a.row.entity[a.col.field]?d="true-icon":a.row.entity[a.col.field]||(d="false-icon");b[0].className="ui-grid-cell-contents "+d;null!=c.popup&&h([c.popup]).then(function(d){r(c.popup)&&0<c.popup.length&&$(b).popover({trigger:"hover",container:"body",content:function(){return d[c.popup]},placement:function(b,c){return a.$root.workspaceTooltipPlacement(c)},html:!0})})});a.$on("$destroy",function(){d()})}}});v.module.directive("appSetBooleanIconColumn",
v.JP);v.compileProvider.directive("appSetTrueIconColumn",function(){return{link:function(a,b,c){var d=c.$observe("appSetTrueIconColumn",function(){var c;a.row.entity[a.col.field]?c="true-icon":a.row.entity[a.col.field]||(c="");b[0].className="ui-grid-cell-contents "+c});a.$on("$destroy",function(){d()})}}});v.module.directive("appSetTrueIconColumn",v.KP);angular.element(v.f).scope().modalWindow=function(a,c,d){b.info("modalWindow");return t.modalWindow(a,c,d)};angular.element(v.f).scope().selectFirstOption=
function(a,d){b.info("selectFirstOption");oFormValues=c.oFormValues[c.sFormDefinitionName];"undefined"==typeof oFormValues[a]&&(oFormValues[a]={options:[]});0==oFormValues[a].options.length&&!0===d&&oFormValues[a].options.push({label:"",value:""});oFormValues[a].selectedOption=oFormValues[a].options[0]};angular.element(v.f).scope().loadSection=function(){b.info("loadSection")};angular.element(v.f).scope().reloadSectionForm=function(){b.info("reloadSectionForm")};angular.element(v.f).scope().refreshGridByEvent=
function(a,d,e){b.info("refreshGridByEvent");if(null==v.oWebsocket)return null;var f=null!=k.minimum_refresh_period?k.minimum_refresh_period:100;if(null==a||null==d||null!=v.oWebsocket.oGridRefreshEvents[a]&&null!=v.oWebsocket.oGridRefreshEvents[a].events[d])return null;null!=v.oWebsocket.oGridRefreshEvents[a]||(v.oWebsocket.oGridRefreshEvents[a]={events:[],lastUpdateDate:(new Date).getTime()});null!=v.oWebsocket.oGridRefreshEvents[a].events[d]||v.oWebsocket.oGridRefreshEvents[a].events.push(d);var g=
this;v.oWebsocket.on("event",function(b){if(b.event!==d||c.oSelectedObject.name!==a)return null;var h=(new Date).getTime();if(h-v.oWebsocket.oGridRefreshEvents[a].lastUpdateDate<f||null!=e&&!e.call(this,b))return null;v.oWebsocket.oGridRefreshEvents[a].lastUpdateDate=h;g.saveGridSelection(g.$root.gridApi[c.sSelectedGridOptionsName].grid.appScope,g.$root.gridApi[c.sSelectedGridOptionsName].grid.options);g.$root.refreshGrid(g.$root.gridApi[c.sSelectedGridOptionsName].grid.appScope,c.oGridOptions[c.sSelectedGridOptionsName])})};
angular.element(v.f).scope().resetForm=function(a){b.info("resetForm");a="undefined"==typeof a?c.oFormDefinition[c.sFormDefinitionName].name:c.oFormDefinition[a].name;angular.element("form[name='"+a+"']").scope()[a].$setPristine();document.querySelector("form[name='"+a+"']").reset()};angular.element(v.X).scope().editSectionForm=function(a){b.info("editSectionForm");var d="before"+Ia(c.oSelectedObject.name,"_").replace(/_/g,"")+"Edition";if("undefined"!=typeof this[d])this[d](a);"undefined"==typeof a&&
(a=c.sId);c.setSectionForm("update",a)};angular.element(v.X).scope().showSectionForm=function(a){b.info("showSectionForm");"undefined"==typeof a&&(a=c.sId);c.setSectionForm("display",a)};angular.element(v.X).scope().editDoubleForm=function(a){b.info("editDoubleForm");"undefined"==typeof a&&(a=c.sId);c.sSelectedTemplate="doubleFormTpl.html";c.sId=a;c.setMode("update",c.sTemplateFolder+c.sSelectedTemplate)};angular.element(v.X).scope().showDoubleForm=function(a){b.info("showDoubleForm");"undefined"==
typeof a&&(a=c.sId);c.sSelectedTemplate="doubleFormTpl.html";c.sId=a;c.setMode("display",c.sTemplateFolder+c.sSelectedTemplate)};angular.element(v.f).scope().showCredits=function(){b.info("showCredits");var a=this.$new();g.addScopeToObject(c.oSelectedObject.name,c.oSelectedMode.mode_id,a);A({method:"GET",url:"conf/credits.json",scope:a,success:function(c){"object"==typeof c.data&&(a.oCredits=c.data,a.modalWindow("dialog","CREDITS",{className:"dialog-modal-window",message:'<div id="login_credits" class="login-credits"></div>'}),
a.translationData={app_name:k.app_name,build:k.build,version:k.version,month_year:k.month_year},p("templates/creditsTpl.html").then(function(b){f($("#login_credits").html(b).contents())(a)}),b.info("compileObjectTemplate : templates/creditsTpl.html"))}})};angular.element(v.f).scope().showDocumentation=function(){b.info("showDocumentation");if(q(k.documentation)){var a=this.$new();a.aDocumentation=k.documentation;g.addScopeToObject(c.oSelectedObject.name,c.oSelectedMode.mode_id,a);a.modalWindow("dialog",
"DOCUMENTATION",{className:"dialog-modal-window",message:'<div id="client_documentation_modal" class="login-credits"></div>'});p("templates/clientDocumentationTpl.html").then(function(b){f($("#client_documentation_modal").html(b).contents())(a)});b.info("compileObjectTemplate : templates/clientDocumentationTpl.html")}else console.error("properties.documentation not an array")};angular.element(v.f).scope().setTagsInput=function(a){b.info("setTagsInput");var c,d;a.forEach(function(a){c=0;for(d=document.getElementById(a).parentNode.querySelectorAll(".tag");c<
d.length;)d[c].addEventListener("click",function(){this.querySelector("span[data-role='remove']").click()}),c++})};angular.element(v.X).scope().refreshGrid=function(a,d){b.info("refreshGrid");a.saveGridSelection(a,d);a.setGridPage(d.paginationCurrentPage,d.paginationPageSize,c.oGridOptions[c.sSelectedGridOptionsName].oFilter,c.oGridOptions[c.sSelectedGridOptionsName].oUrlParams)};angular.element(v.X).scope().saveGridSelection=function(a,d){b.info("saveGridSelection");a=d.appSelectedRows=a.$root.gridApi[c.sSelectedGridOptionsName].selection.getSelectedRows();
if(0<a.length)for(var e=0,f=[];e<a.length;)f.push(a[e][c.oSelectedObject.sIdField]),e++;d.appSelectedRows=f};angular.element(v.X).scope().setGridFilter=function(){b.info("setGridFilter");c.oWorkspaceList[c.sSelectedGridOptionsName].oValues=angular.copy(c.oFormValues[c.sFormDefinitionName]);for(var a,e,f={relation:"AND",operators:[]},g=d.getFormData(c.sFormDefinitionName,!0),h=Object.keys(g),k=0;k<h.length;){e=d.getFormElementDefinition(h[k],c.sFormDefinitionName);a=g[h[k]];if("date"===e.type||"datetime"===
e.type){var m=$("#"+e.id).data("DateTimePicker").date();null!==m&&(a="date"===e.type?m.format("YYYY-MM-DD"):m.format("YYYY-MM-DD HH:mm:ss"))}"undefined"!==typeof a&&""!==a.toString()&&(null!=e.comparator?(null!=e.comparator.formater&&(a=e.comparator.formater.replace(/<VALUE_TO_REPLACE>/g,a)),e.comparator.value=a,f.operators.push(e.comparator)):"text"==e.type?f.operators.push({column:h[k],compare_operator:"LIKE",compare_operator_options:{case_insensitive:!0},value:"%"+a+"%"}):"date"==e.type||"datetime"==
e.type?f.operators.push({column:h[k],compare_operator:">",value:a},{column:h[k],compare_operator:"<",value:moment(a).add(1,"days").format("YYYY-MM-DD")}):f.operators.push({column:h[k],compare_operator:"=",value:a}));k++}c.oGridOptions[c.sSelectedGridOptionsName].oFilter=angular.copy(f);"search"==c.sMode&&(c.oWorkspaceList[c.sSelectedGridOptionsName].oFilter=angular.copy(f));this.$root.$broadcast("oFilterLoaded_"+c.oSelectedObject.name,c.oGridOptions[c.sSelectedGridOptionsName].oFilter);1==c.oGridOptions[c.sSelectedGridOptionsName].paginationCurrentPage?
this.$root.gridApi[c.sSelectedGridOptionsName].pagination.raise.paginationChanged(1,c.oGridOptions[c.sSelectedGridOptionsName].paginationPageSize):c.oGridOptions[c.sSelectedGridOptionsName].paginationCurrentPage=1};angular.element(v.X).scope().resetGridFilter=function(){b.info("resetGridFilter");for(var a=d.getFormData(c.sFormDefinitionName,!0),f=Object.keys(a),a=0;a<f.length;){var g=d.getFormElementDefinition(f[a],c.sFormDefinitionName);"date"!==g.type&&"datetime"!==g.type||angular.element("#"+g.id).data("DateTimePicker").clear();
a++}c.oFormValues[c.sFormDefinitionName]=angular.copy(c.oWorkspaceList[c.sSelectedGridOptionsName].oDefaultValues);c.oGridOptionsCopy[c.sSelectedGridOptionsName].oFilter=c.oDefaultGridOptions[c.sSelectedGridOptionsName].oFilter;this.setGridFilter();e(function(){f.forEach(function(a){var b=d.getFormElementDefinition(a,c.sFormDefinitionName);"select"===b.type&&document.querySelectorAll("#"+b.id).forEach(function(b){"undefined"!=typeof b.options&&Array.from(b.options).forEach(function(b){var d=c.oFormValues[c.sFormDefinitionName][a];
b.selected=!1;"object"==typeof d&&"object"==typeof d.selectedOption&&b.value==d.selectedOption.value&&(b.selected=!0)})})})})};angular.element(v.X).scope().setPaginationStatus=function(){b.info("setPaginationStatus");var a=this,d;if(0<c.oGridOptions[c.sSelectedGridOptionsName].totalItems){d="PAGINATION_STATUS";var e={totalItems:c.oGridOptions[c.sSelectedGridOptionsName].totalItems,itemStart:(c.oGridOptions[c.sSelectedGridOptionsName].paginationCurrentPage-1)*c.oGridOptions[c.sSelectedGridOptionsName].paginationPageSize+
1};e.itemEnd=e.itemStart+c.oGridOptions[c.sSelectedGridOptionsName].paginationPageSize-1;e.itemEnd>e.totalItems&&(e.itemEnd=e.totalItems)}else d="PAGINATION_STATUS_NO_ITEMS";h([d],e).then(function(b){a.sPaginationStatus=b[d]})};angular.element(v.X).scope().setGridPage=function(a,d,e,f){b.info("setGridPage");var g=angular.element(v.X).scope();"number"!=typeof a&&(a=1);!0!==c.oGridOptions[c.sSelectedGridOptionsName].sectionGrid&&(c.oSelectedObject.iPageNumber=angular.copy(a));a--;a*=d;f="undefined"==
typeof f?{}:angular.copy(f);mb(f,{offset:a,limit:d});"undefined"==typeof e&&(e={relation:"AND",operators:[]});"undefined"!=typeof c.oSelectedObject.iPageNumber&&!0!==c.oGridOptions[c.sSelectedGridOptionsName].sectionGrid&&(c.oGridOptions[c.sSelectedGridOptionsName].paginationCurrentPage=c.oSelectedObject.iPageNumber);"undefined"!=typeof c.oSelectedObject.filter&&(e.operators=e.operators.concat(c.oSelectedObject.filter.operators));"undefined"!=typeof c.oSelectedObject.aModeFilter&&(e.operators=e.operators.concat(c.oSelectedObject.aModeFilter.operators));
0<e.operators.length?f.filter=angular.copy(e):delete f.filter;d=c.getSectionWebServiceResourceId();var h=c.explodeWebServiceResourceId(d);"undefined"!=typeof c.oGridOptions[c.sSelectedGridOptionsName].appBeforeEvent&&g.$root.$eval(c.oGridOptions[c.sSelectedGridOptionsName].appBeforeEvent);if(null!=c.oGridOptions[c.sSelectedGridOptionsName]&&q(c.oGridOptions[c.sSelectedGridOptionsName].columnDefs)){d=[];for(e=0;e<c.oGridOptions[c.sSelectedGridOptionsName].columnDefs.length;e++)null!=c.oGridOptions[c.sSelectedGridOptionsName].columnDefs[e].field&&
d.push(c.oGridOptions[c.sSelectedGridOptionsName].columnDefs[e].field);0<d.length&&(f.attributs=d.join("|"))}A({method:"GET",url:k.web_server_name+"/"+k.services_alias+"/"+h[0]+"/"+h[1],params:angular.copy(f),scope:g,success:function(a){if(1==parseInt(a.data.status)){var b=[];"undefined"!=typeof a.data[h[1]]&&(b=a.data[h[1]]);c.oGridOptions[c.sSelectedGridOptionsName].data=b;c.oGridOptions[c.sSelectedGridOptionsName].totalItems=a.data.total_row_number;g.$root.setPaginationStatus();"undefined"!=typeof c.oGridOptions[c.sSelectedGridOptionsName].appAfterEvent&&
g.$root.$eval(c.oGridOptions[c.sSelectedGridOptionsName].appAfterEvent);"undefined"!=typeof c.oGridOptions[c.sSelectedGridOptionsName].appSelectedRows&&(g.$root.gridApi[c.sSelectedGridOptionsName].grid.modifyRows(c.oGridOptions[c.sSelectedGridOptionsName].data),b.forEach(function(a,b){-1!=c.oGridOptions[c.sSelectedGridOptionsName].appSelectedRows.indexOf(a[c.oSelectedObject.sIdField])&&g.$root.gridApi[c.sSelectedGridOptionsName].selection.selectRow(c.oGridOptions[c.sSelectedGridOptionsName].data[b])}));
g.$root.$emit("workspaceListDataAdded")}}})};angular.element(v.X).scope().formatGridColumn=function(a,d){b.info("formatGridColumn");for(var e=[],f,g=0;g<a.length;)"number"!=typeof a[g].width&&(a[g].width="50"),f={name:a[g].field_label,displayName:a[g].field_label,field:a[g].name,width:parseInt(a[g].width)+15,enableSorting:a[g].sortable,enableColumnResizing:a[g].resizeable,headerCellClass:d+"_"+a[g].name,cellClass:"cell-align-"+a[g].align},null!=a[g].template&&(f.cellTemplate=a[g].template),f.field==
c.oSelectedObject.sorted_by&&(f.sort={direction:m[c.oSelectedObject.sorted_dir],ignoreSort:!0,priority:0}),e.push(f),g++;return e};angular.element(v.X).scope().formatGridAction=function(a,c){b.info("formatGridAction");for(var d=[],e=0;e<a.length;)"string"===typeof a[e].event&&-1===a[e].event.indexOf("(")&&(a[e].event+="()"),d.push({label:Ia(a[e].button_label,""),event:a[e].event,name:c+"_"+a[e].button_class}),e++;return d};angular.element(v.X).scope().executeActionButtonEvent=function(a,d,e){b.info("executeActionButtonEvent");
var f=angular.element(v.X).scope(),g=c.oSelectedObject.sIdField;"undefined"!=typeof e.appIdField&&(g=e.appIdField);f.$root[d](a.entity[g])};angular.element(v.X).scope().DeleteSelection=function(a){b.info("DeleteSelection");var d=angular.element(v.X).scope(),e=d.$root.gridApi[c.sSelectedGridOptionsName].selection.getSelectedRows();if(0<e.length){"undefined"==typeof a&&(a={});var f="LIST_DELETE_CONFIRM";"undefined"!=typeof a.sMessage&&(f=a.sMessage);d.$root.modalWindow("confirm","",{message:f,callback:function(b){if(b){var f=
0;b=[];var g;if("undefined"!=typeof a.aSelectedId)b=a.aSelectedId;else{var h=c.oSelectedObject.sIdField;for("undefined"!=typeof a&&"undefined"!=typeof a.sIdField&&(h=a.sIdField);f<e.length;)g=e[f][h],b.push(g),f++}0<b.length?(f=c.getSectionWebServiceResourceId(),f=c.explodeWebServiceResourceId(f),A({method:"DELETE",url:k.web_server_name+"/"+k.services_alias+"/"+f[0]+"/"+f[1],params:{idList:b.join("|")},scope:d,success:function(a){if(1==a.data.status){1==c.oGridOptions[c.sSelectedGridOptionsName].paginationCurrentPage?
d.$root.gridApi[c.sSelectedGridOptionsName].pagination.raise.paginationChanged(1,c.oGridOptions[c.sSelectedGridOptionsName].paginationPageSize):c.oGridOptions[c.sSelectedGridOptionsName].paginationCurrentPage=1;a="after"+Ia(c.oSelectedMode.mode_id,"_").replace(/_/g,"")+"Removal";if("undefined"!=typeof d.$root[a])d.$root[a]();d.$root.$emit("WorkspaceListSelectionRemoved",c.oSelectedObject.name)}else d.$root.modalWindow("dialog","LIST_DELETE_ERROR",{className:"modal-danger",message:a.data.errorMessage})}})):
(d.$root.gridApi[c.sSelectedGridOptionsName].selection.clearSelectedRows(),d.$root.gridApi[c.sSelectedGridOptionsName].core.refresh())}}})}else h(["LIST_DELETE_NO_SELECTION"]).then(function(a){d.$root.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:a.LIST_DELETE_NO_SELECTION})})};angular.element(v.f).scope().toGarbageCollection=function(a){c.toGarbageCollection(a)};angular.element(v.f).scope().concatSelectAttributes=function(a,d){b.info("concatSelectAttributes");"undefined"==
typeof d&&(d=" ");var e;a.split("|").forEach(function(a){e=c.oFormValues[c.sFormDefinitionName][a];hb(e)||hb(e.options)||e.options.forEach(function(a){""!=a.label&&""!=a.value&&(a.label=a.value+d+a.label)})})};angular.element(v.f).scope().workspaceTooltipPlacement=function(a){b.info("workspaceTooltipPlacement");return $(a).offset().left<window.innerWidth/2?"right":"left"};angular.element(v.f).scope().hideAllModalWindow=function(){b.info("hideAllModalWindow");bootbox.hideAll()};angular.element(v.f).scope().addSelectEmptyOption=
function(a){b.info("addSelectEmptyOption");oFormValues=c.oFormValues[c.sFormDefinitionName];"undefined"==typeof oFormValues[a]&&(oFormValues[a]={options:[]});oFormValues[a].options.unshift({label:"",value:""});if("undefined"==typeof oFormValues[a].selectedOption||"undefined"==typeof oFormValues[a].selectedOption.value)oFormValues[a].selectedOption=oFormValues[a].options[0]};v.compileProvider.directive("appFormatDateColumn",function(){return{link:function(a,b,c){var d=c.$observe("appFormatDateColumn",
function(){null!=c.format||(c.format="L LTS");b[0].className+=" ui-grid-cell-contents";if(null!=a.row.entity[a.col.field]){var d=moment(a.row.entity[a.col.field]);null!=c.offset&&(d=d.utcOffset(parseInt(c.offset),!1));b[0].innerHTML=d.format(c.format)}else b[0].innerHTML=""});a.$on("$destroy",function(){d()})}}});v.module.directive("appFormatDateColumn",v.HP);angular.element(v.f).scope().getBooleanTranslation=function(c){b.info("getBooleanTranslation");var d=a.defer(),e=d.promise;"boolean"==typeof c?
h(["FORM_YES","FORM_NO"]).then(function(a){d.resolve(c?a.FORM_YES:a.FORM_NO)}):d.resolve(c);return e};angular.element(v.f).scope().loadSectionList=function(a){b.info("loadSectionList");var d=this.$root.$on("initWorkspaceList",function(b,e){d();e.gridOptions={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:k.rows_per_page,enableColumnMenus:!1,enableColumnResizing:!0,paginationPageSizes:[10,20,50,100,200,500],appHeader:!1,
appHeaderTitleBar:!0,appHeaderSearchForm:!1,appHeaderOptionBar:!1,appLoadGridData:!0,appGridTitle:c.oSelectedObject.label,appResizeGrid:!1,appFooter:!0,appShowPagination:!0,appEnableDragAndDrop:!1,appDragAndDropEvent:{},appActions:[],oFilter:{relation:"AND",operators:[{column:c.oSelectedObject.sIdField,compare_operator:"=",value:c.sId}]},appShowActions:!1,paginationCurrentPage:1,sectionGrid:!0};"undefined"!=typeof a&&mb(e.gridOptions,a);e.bLoadFormValues=!1})};angular.element(v.f).scope().getTabIdFieldValue=
function(){b.info("getTabIdFieldValue");return c.sId};angular.element(v.f).scope().setRadioTranslation=function(a){b.info("setRadioTranslation");angular.element(v.f).scope().$root.getBooleanTranslation(c.oFormValues[c.sFormDefinitionName][a]).then(function(b){c.oFormValues[c.sFormDefinitionName][a]=b})};angular.element(v.f).scope().cloneSectionForm=function(a){b.info("cloneSectionForm");var d=this,e=angular.copy(c.oFormValues[c.sFormDefinitionName]);if("undefined"!=typeof a)for(var f=0;f<a.length;f++)delete e[a[f]];
this.AddSectionForm();var g=d.$root.$on("formExtracted",function(a,b){b===c.sFormDefinitionName&&(g(),c.oFormValues[c.sFormDefinitionName]=angular.copy(e),d.$broadcast("$$rebind::refresh"),d.$apply())})};angular.element(v.f).scope().copyFormElemContentToClipboard=function(a){b.info("copyFormElemContentToClipboard");var d=document.createElement("textarea");document.getElementsByTagName("body")[0].appendChild(d);d.innerHTML=c.oFormValues[c.sFormDefinitionName][a];d.select();document.execCommand("copy");
document.getElementsByTagName("body")[0].removeChild(d)};angular.element(v.f).scope().addModalSectionForm=function(){b.info("addModalSectionForm");c.setModalSectionForm("insert")};angular.element(v.f).scope().editModalSectionForm=function(a){b.info("editModalSectionForm");"undefined"==typeof a&&(a=c.sId);c.setModalSectionForm("update",a)};angular.element(v.f).scope().showModalSectionForm=function(a){b.info("showModalSectionForm");"undefined"==typeof a&&(a=c.sId);c.setModalSectionForm("display",a)};
angular.element(v.f).scope().closeModalSectionForm=function(a){var d=angular.element(v.f).injector().get(["$rootScope"]);b.info("closeModalSectionForm");!0===a&&d.refreshGrid(d.gridApi[c.sSelectedGridOptionsName].grid.appScope,c.oGridOptions[c.sSelectedGridOptionsName]);d.hideAllModalWindow()};angular.element(v.f).scope().setModeFilter=function(a){var d=angular.element(v.f).injector().get(["$rootScope"]);b.info("setModeFilter");var e=d.gridApi[c.sSelectedGridOptionsName].selection.getSelectedRows();
if(0<e.length){"undefined"==typeof a&&(a=[]);a.push(c.oSelectedObject.name);for(var f=0;f<c.oSelectedMode.objects.length;f++)-1==a.indexOf(c.oSelectedMode.objects[f].name)&&(c.oSelectedMode.objects[f].aModeFilter={relation:"AND",operators:[{column:c.oSelectedObject.sIdField,compare_operator:"=",value:e[0][c.oSelectedObject.sIdField]}]});a=c.oGridOptions[c.sSelectedGridOptionsName].appActions;for(f=0;f<a.length;f++)-1!=a[f].name.indexOf("_set_mode_filter")?a[f].disabled=!0:-1!=a[f].name.indexOf("_unset_mode_filter")&&
(a[f].disabled=!1);d=d.gridApi[c.sSelectedGridOptionsName].grid.appScope;d.$broadcast("$$rebind::refresh");d.$applyAsync()}};angular.element(v.f).scope().unsetModeFilter=function(){var a=angular.element(v.f).injector().get(["$rootScope"]);b.info("unsetModeFilter");for(var d=0;d<c.oSelectedMode.objects.length;d++)delete c.oSelectedMode.objects[d].aModeFilter;for(var e=c.oGridOptions[c.sSelectedGridOptionsName].appActions,d=0;d<e.length;d++)-1!=e[d].name.indexOf("set_mode_filter")&&(e[d].disabled=!1);
a=a.gridApi[c.sSelectedGridOptionsName].grid.appScope;a.$broadcast("$$rebind::refresh");a.$applyAsync()};v.compileProvider.directive("appHideColumn",function(){return{link:function(a){var b=a.$root.gridApi[c.sSelectedGridOptionsName],d=b.grid.appScope.gridOptions,e;for(e in d.columnDefs)if(d.columnDefs[e].name==a.col.name){d.columnDefs[e].visible=!1;break}b.core.refresh();a.$on("$destroy",function(){})}}});v.module.directive("appHideColumn",v.IP)});v.qB=function(a,b,c,d,e,f){b.info("initLogs");e.oFormValues[e.sFormDefinitionName]={min_days_files:5};e.oFormDefaultValues[e.sFormDefinitionName]=angular.copy(e.oFormValues[e.sFormDefinitionName]);a.getFileContent=function(b,d){if("undefined"!=typeof b){var e=f.log_size;isNaN(e)&&(e=1024);d<1024*e?A({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/vitis/logs/"+b.log_directory+"/file/"+b.name,params:{folder:b.folder},scope:c,success:function(d){1==d.data.status?(c.sLogContent=d.data.file,
a.sLogPath=b.path,"undefined"!=typeof c.sLogContent&&($("#logs-content-container").show(),c.resizeLogsContainer(),window.addEventListener("resize",c.resizeLogsContainer))):c.modalWindow("dialog","LOADING_FILE_ERROR_LOGS",{className:"modal-danger",message:d.data.errorMessage,appDuration:2E3})}}):(a.sLogPath=b.path,$("#logs-content-container").show(),c.sLogContent="",d=$("#logs-content-container").height()-document.getElementById("logs-content-container").children[0].offsetHeight,document.getElementById("logs-content-container").children[1].style.height=
d+"px",c.modalWindow("dialog","FILE_TOO_BIG_LOGS",{className:"dialog-modal-window",appDuration:2E3}))}};a.deleteFile=function(a){null!=a&&A({method:"DELETE",url:f.web_server_name+"/"+f.services_alias+"/vitis/logs/"+a.log_directory+"/file/"+a.name,params:{folder:a.folder},scope:c,success:function(a){var b={};1==a.data.status?(d("DELETE_FILE_SUCCESS_LOGS").then(function(a){$.notify(a,"success")}),setTimeout(function(){c.loadTreeview()})):(b.className="modal-danger",b.message=a.data.errorMessage,c.modalWindow("dialog",
"DELETE_FILE_ERROR_LOGS",b))}})};c.resizeLogsContainer=function(){b.info("resizeLogsContainer");if("logs"==e.oSelectedMode.mode_id){var a=$("#logs-content-container").height()-document.getElementById("logs-content-container").children[0].offsetHeight;document.getElementById("logs-content-container").children[1].style.height=a+"px"}}};v.qB.$inject="$rootScope $log $scope $translate envSrvc propertiesSrvc".split(" ");v.module.controller("logsCtrl",v.qB);v.Li=function(a,b,c,d){a.info("initWebsocketConfiguration");var e=this;this.$log=a;this.Eg=b;this.yx=c;this.propertiesSrvc=d;this.vt=this.Qy=!1;b.sWebSocketUrl="wss://"+location.host+"/"+d.websocket_alias+"/";b.oServerInfos=null;v.oWebsocket.on("serverInfo",function(a){e.Eg.$applyAsync(function(){e.vt=!1;e.Eg.oServerInfos=a;e.Qy&&c(["WEBSOCKET_INFOS_REFRESHED_CONFIGURATION"]).then(function(a){$.notify(a.WEBSOCKET_INFOS_REFRESHED_CONFIGURATION,"success")})})})};
v.Li.$inject=["$log","$scope","$translate","propertiesSrvc"];v.Li.prototype.IC=function(){this.$log.info("websocketConfigurationCtrl.reloadWebsocketStatus");var a=this;this.vt=this.Qy=!0;DB(v.oWebsocket,"serverInfo","","Status");setTimeout(function(){a.vt&&(a.yx(["WEBSOCKET_NO_SERVER_RESPONSE_CONFIGURATION"]).then(function(a){$.notify(a.WEBSOCKET_NO_SERVER_RESPONSE_CONFIGURATION,"error")}),a.Eg.$applyAsync(function(){a.Eg.oServerInfos=null}))},2E3)};v.Li.prototype.reloadWebsocketStatus=v.Li.prototype.IC;
v.Li.prototype.uM=function(){this.$log.info("websocketConfigurationCtrl.refreshClients");DB(v.oWebsocket,"refreshClients","refreshClients");var a=this,b=!1;v.oWebsocket.on("connect",function(){b||setTimeout(function(){a.yx(["WEBSOCKET_USERS_RECONNECTED_CONFIGURATION"]).then(function(a){$.notify(a.WEBSOCKET_USERS_RECONNECTED_CONFIGURATION,"success")});setTimeout(function(){a.IC()},1E3)},500);b=!0})};v.Li.prototype.refreshClients=v.Li.prototype.uM;v.module.controller("websocketConfigurationCtrl",v.Li);v.tE=function(a,b,c){a.info("initVersionConfiguration");b.getStateCssClass=function(a){return a?"install-state-ok":"install-state-error"};A({method:"GET",url:c.web_server_name+"/"+c.services_alias+"/vitis/Versions",params:{app:sessionStorage.application},scope:b,success:function(a){1==a.data.status&&(a.data.VM_VERSION=c.version,a.data.VM_BUILD=c.build,b.oVersion=a.data,b.oVersion.neededUpdate=!0,"trunk"===c.version?delete b.oVersion.appVersion:null===b.oVersion.appVersion?b.oVersion.update="ERROR_RETRIEVE_UPDATE_CONFIGURATION":
(a=angular.copy(c.version).replace(".",""),angular.copy(b.oVersion.appVersion).replace(".","")>a?b.oVersion.update="NEEDED_UPDATE_CONFIGURATION":(b.oVersion.neededUpdate=!1,b.oVersion.update="NO_NEEDED_UPDATE_CONFIGURATION")))}})};v.tE.$inject=["$log","$scope","propertiesSrvc"];v.module.controller("versionConfigurationCtrl",v.tE);v.Kx=function(a,b,c,d,e,f){a.info("initActiveDirectoryTree");b.aTreeviewActiveDirectoryTree={};b.gridOptions={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:10,enableColumnMenus:!1,enableColumnResizing:!0,paginationPageSizes:[10,20,50,100],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!1,appLoadGridData:!1,data:[],columnDefs:[]};d("NAME_SEARCH_ACTIVE_DIRECTORY_USERS_USER ACCOUNT_SEARCH_ACTIVE_DIRECTORY_USERS_USER EMAIL_SEARCH_ACTIVE_DIRECTORY_USERS_USER AGENCY_SEARCH_ACTIVE_DIRECTORY_USERS_USER DEPARTMENT_SEARCH_ACTIVE_DIRECTORY_USERS_USER GROUP_SEARCH_ACTIVE_DIRECTORY_USERS_USER".split(" ")).then(function(a){b.gridOptions.columnDefs=
"person"==b.oActiveDirectoryParameters.sObject?[{name:a.NAME_SEARCH_ACTIVE_DIRECTORY_USERS_USER,displayName:a.NAME_SEARCH_ACTIVE_DIRECTORY_USERS_USER,field:"displayname",width:200,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"active_directory_"+e.oSelectedObject.name+"_name"},{name:a.ACCOUNT_SEARCH_ACTIVE_DIRECTORY_USERS_USER,displayName:a.ACCOUNT_SEARCH_ACTIVE_DIRECTORY_USERS_USER,field:"userprincipalname",width:200,enableSorting:!0,type:"string",enableColumnMoving:!0,
enableColumnResizing:!0,headerCellClass:"active_directory_"+e.oSelectedObject.name+"_login"},{name:a.EMAIL_SEARCH_ACTIVE_DIRECTORY_USERS_USER,displayName:a.EMAIL_SEARCH_ACTIVE_DIRECTORY_USERS_USER,field:"email",width:300,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"active_directory_"+e.oSelectedObject.name+"_email"},{name:a.AGENCY_SEARCH_ACTIVE_DIRECTORY_USERS_USER,displayName:a.AGENCY_SEARCH_ACTIVE_DIRECTORY_USERS_USER,field:"company",width:200,enableSorting:!0,
type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"active_directory_"+e.oSelectedObject.name+"_company"},{name:a.DEPARTMENT_SEARCH_ACTIVE_DIRECTORY_USERS_USER,displayName:a.DEPARTMENT_SEARCH_ACTIVE_DIRECTORY_USERS_USER,field:"department",width:200,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"active_directory_"+e.oSelectedObject.name+"_company"}]:[{name:a.GROUP_SEARCH_ACTIVE_DIRECTORY_USERS_USER,displayName:a.GROUP_SEARCH_ACTIVE_DIRECTORY_USERS_USER,
field:"name",width:400,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"active_directory_"+e.oSelectedObject.name+"_name"}]});d("BTN_IMPORT_SELECTION_"+e.oSelectedObject.name.toUpperCase()).then(function(a){e.oSelectedObject.actions=[{label:a,name:b.sSelectedObjectName+"_import_btn",event:"importAdSelection()"}];b.gridOptions.appActions=e.oSelectedObject.actions});b.sFormDefinitionName=e.oSelectedObject.name+"_search_form";b.oFormRequestParams={sUrl:"modules/vitis/forms/users/search_active_directory_"+
b.oActiveDirectoryParameters.sObject+".json"};b.$root.clearFormData(b.sFormDefinitionName,b);e.oFormValues[b.sFormDefinitionName]={};b.bLoadFormValues=!1;b.convertAdTreeToBootstrapTreeview=function(a){for(var c=[],d,e=0;e<a.length;)d={text:a[e].id.split(",")[0],branch:a[e].id},0<a[e].items.length&&(d.nodes=b.convertAdTreeToBootstrapTreeview(a[e].items)),c.push(d),e++;return c};b.loadAdTreeBranch=function(a){A({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/vitis/ActiveDirectory/"+b.oActiveDirectoryParameters.sWebServicePath+
"/"+a,params:{domain_id:b.oLdap.sIdLdap,login:b.oLdap.sLoginLdap.split("@")[0],password:b.oLdap.sPwdLdap,object:b.oActiveDirectoryParameters.sObject},scope:b,success:function(a){1==a.data.status&&(b.gridOptions.data=e.extractWebServiceData("activedirectory",a.data)[0][b.oActiveDirectoryParameters.sWebServicePath.toLowerCase()])}})};b.importAdSelection=function(){var a=b.$root.gridApi[e.sSelectedGridOptionsName].selection.getSelectedRows();b.aSelection=angular.copy(a);for(var c=0,k={domain_id:b.oLdap.sIdLdap,
ldap_name:b.oLdap.sLdapName};c<a.length;)k.action="importFromAd","person"==b.oActiveDirectoryParameters.sObject?(k.company=a[c].company,k.department=a[c].department,k.email=a[c].email,k.name=a[c].displayname,k.login=a[c].userprincipalname):k.name=a[c].name,A({method:"POST",url:f.web_server_name+"/"+f.services_alias+"/vitis/"+b.oActiveDirectoryParameters.sWebServicePath.toLowerCase(),params:k,scope:b,success:function(a){if(1==a.data.status)b.aSelection.shift(),0==b.aSelection.length&&(d("SUCCESFULL_IMPORTATION_"+
e.oSelectedObject.name.toUpperCase()).then(function(a){$.notify(a,"success")}),b.$root.gridApi[e.sSelectedGridOptionsName].selection.clearSelectedRows());else{b.aSelection=[];var c={className:"modal-danger"};null!=a.data.errorMessage&&(c.message=a.data.errorMessage);b.modalWindow("alert","FORM_VALIDATION_ERROR",c)}}}),c++};b.searchAdTree=function(){for(var a=c.defer(),d=a.promise,k={domain_id:b.oLdap.sIdLdap,login:b.oLdap.sLoginLdap.split("@")[0],password:b.oLdap.sPwdLdap},m=e.oFormValues[b.sFormDefinitionName],
p=Object.keys(m),t=0;t<p.length;)""!=m[p[t]]&&(k[p[t]]=m[p[t]]),t++;A({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/vitis/ActiveDirectory/"+b.oActiveDirectoryParameters.sWebServicePath,params:k,scope:b,success:function(c){1==c.data.status&&(b.gridOptions.data=e.extractWebServiceData("activedirectory",c.data)[0][b.oActiveDirectoryParameters.sWebServicePath.toLowerCase()]);a.resolve()}});return d}};v.Kx.$inject="$log $scope $q $translate envSrvc propertiesSrvc".split(" ");
v.module.controller("activeDirectoryTreeCtrl",v.Kx);v.BE=function(a,b,c){a.info("initWebServiceHelp");b.sUrlWebServiceDoc=c.web_server_name+"/"+c.doc_alias+"/index.phtml"};v.BE.$inject=["$log","$scope","propertiesSrvc"];v.module.controller("webServiceHelpCtrl",v.BE);v.fy=function(a){return{restrict:"A",controller:"logsCtrl",controllerAs:"ctrl",link:function(b){a(["FORM_BTN_DELETE_FILE_LOGS"]).then(function(a){a={title:a.FORM_BTN_DELETE_FILE_LOGS,placement:"bottom",trigger:"hover",container:"body"};angular.element("#btn_delete_log_file").tooltip(a)});b.$on("$destroy",function(){angular.element("#btn_delete_log_file").tooltip("destroy");window.removeEventListener("resize",b.resizeLogsContainer)})}}};v.fy.$inject=["$translate"];v.module.directive("appLogs",v.fy);
v.yF=function(){return{replace:!0,templateUrl:"templates/formTpl.html"}};v.module.directive("appLogsForm",v.yF);
v.gy=function(a,b,c,d){return{link:function(e,f){e.loadTreeview=function(){$("#logs-content-container").hide();A({method:"GET",url:c.web_server_name+"/"+c.services_alias+"/vitis/Logs",params:{application_name:sessionStorage.application},scope:e,success:function(b){1==b.data.status&&a(function(){b.data=b.data.tree;e.oSelectedLogFile={};e.aTreeviewLogs=b.data;$(f).treeview({showBorder:!1,expandIcon:"glyphicon glyphicon-folder-close",collapseIcon:"glyphicon glyphicon-folder-open",onNodeSelected:function(a,
b){e.oSelectedLogFile=b;e.getFileContent(b,b.size)},onNodeUnselected:function(){e.oSelectedLogFile=[]},highlightSelected:!0,multiSelect:!1,data:e.aTreeviewLogs.data})})}})};e.deleteLogsHistory=function(){var a=d.oFormValues[d.sFormDefinitionName].min_days_files;b("DELETE_HISTORY_CONFIRM_LOGS",{min_days_files:a}).then(function(b){e.modalWindow("confirm","",{className:"modal-warning",message:b,callback:function(b){b&&A({method:"DELETE",url:c.web_server_name+"/"+c.services_alias+"/vitis/Logs",params:{min_days:a},
scope:e,success:function(){e.loadTreeview()}})}})})};e.deleteLogFile=function(a){e.modalWindow("confirm","",{className:"modal-warning",message:"DELETE_FILE_CONFIRM_LOGS",callback:function(b){b&&e.deleteFile(a)}})};e.loadTreeview();e.$on("$destroy",function(){$("#"+f[0].id).treeview("remove")})}}};v.gy.$inject=["$timeout","$translate","propertiesSrvc","envSrvc"];v.module.directive("appLogsTreeviewContainer",v.gy);v.Fy=function(){return{restrict:"A",controller:"websocketConfigurationCtrl",controllerAs:"ctrl"}};v.appWebsocketConfigurationDrtv=v.Fy;v.module.directive("appWebsocketConfiguration",v.Fy);v.Cy=function(){return{restrict:"A",controller:"versionConfigurationCtrl",controllerAs:"ctrl"}};v.appVersionConfigurationDrtv=v.Cy;v.module.directive("appVersionConfiguration",v.Cy);v.ny=function(a,b){return{link:function(c,d){a.info("initPhpInfoConfiguration");A({method:"GET",url:b.web_server_name+"/"+b.services_alias+"/vitis/Phpinfo",scope:c,success:function(a){if(1==a.data.status){var b=document.implementation.createHTMLDocument("phpinfo");b.documentElement.innerHTML=a.data.phpinfo;d[0].innerHTML=b.body.innerHTML}}})}}};v.ny.$inject=["$log","propertiesSrvc"];v.module.directive("appPhpInfo",v.ny);v.qF=function(){return{restrict:"A",controller:"activeDirectoryTreeCtrl",controllerAs:"ctrl",templateUrl:"templates/workspaceListTpl.html"}};v.module.directive("appActiveDirectoryFiles",v.qF);v.rF=function(){return{replace:!0,templateUrl:"templates/formTpl.html"}};v.module.directive("appActiveDirectoryTreeForm",v.rF);
v.Ux=function(a,b,c){return{link:function(d,e){e[0].id=d.sSelectedObjectName+"_treeview";a("TITLE_SECTION_"+c.oSelectedObject.name.toUpperCase()).then(function(a){document.querySelector("#container_mode_"+c.oSelectedMode.mode_id+" .double-form-title").textContent=a});A({method:"GET",url:b.web_server_name+"/"+b.services_alias+"/vitis/ActiveDirectory/Tree",params:{domain_id:d.oLdap.sIdLdap,login:d.oLdap.sLoginLdap.split("@")[0],password:d.oLdap.sPwdLdap,object:d.oActiveDirectoryParameters.sObject},
scope:d,success:function(a){1==a.data.status&&(a.data=c.extractWebServiceData("activedirectory",a.data)[0].tree,d.aTreeviewActiveDirectoryTree.data=d.convertAdTreeToBootstrapTreeview(a.data),d.oLdap.sDn=a.data[0].id.split(",").slice(1).join(","),$(e).treeview({showBorder:!1,expandIcon:"glyphicon glyphicon-plus",collapseIcon:"glyphicon glyphicon-minus",highlightSelected:!0,multiSelect:!1,levels:0,data:d.aTreeviewActiveDirectoryTree.data,onNodeSelected:function(a,b){d.loadAdTreeBranch(b.branch)}}))}});
d.$on("$destroy",function(){$("#"+e[0].id).treeview("remove")})}}};v.Ux.$inject=["$translate","propertiesSrvc","envSrvc"];v.module.directive("appActiveDirectoryTreeTreeviewContainer",v.Ux);v.Ey=function(){return{restrict:"A",controller:"webServiceHelpCtrl",controllerAs:"ctrl",link:function(a,b){ed();b[0].onload=function(){var a=b[0].contentDocument.querySelector("header");a.parentNode.removeChild(a);fd()}}}};v.appWebServiceHelpDrtv=v.Ey;v.module.directive("appWebServiceHelp",v.Ey);v.on("appMainDrtvLoaded",function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["envSrvc"]);angular.element(v.f).injector().get(["sessionSrvc"]);var c=angular.element(v.f).injector().get(["propertiesSrvc"]);angular.element(v.Wb).scope().preventUserPasswordChanged=function(a){var b=angular.element(v.Wb).injector().get(["$q"]),c=angular.element(v.f).injector().get(["$log"]),d=angular.element(v.f).injector().get(["envSrvc"]),h=angular.element(v.f).injector().get(["userSrvc"]);
c.info("preventUserPasswordChanged");var k=b.defer(),b=k.promise,c=document.querySelector("form[name='"+d.oFormDefinition[d.sFormDefinitionName].name+"'] input[name='password']"),m=document.querySelector("form[name='"+d.oFormDefinition[d.sFormDefinitionName].name+"'] input[name='password_confirm']");null==d.oFormValues[d.sFormDefinitionName].domain&&""!==c.value?c.value!==m.value?(a={className:"modal-danger",appCallback:function(){k.reject()}},this.modalWindow("dialog","ERROR_PASSWORD_CONFIRM_USER_USER",
a)):a||d.oFormValues[d.sFormDefinitionName].user_id===h.id?(a={className:"modal-warning",message:"UPDATE_PASSWORD_USER_USER",callback:function(a){a?k.resolve():k.reject()}},this.modalWindow("confirm","WARNING_PASSWORD_CHANGE_USER_USER",a)):k.resolve():k.resolve();return b};angular.element(v.Wb).scope().disconnectUserPasswordChanged=function(){var a=angular.element(v.f).injector().get(["envSrvc"]),b=angular.element(v.f).injector().get(["$log"]),c=angular.element(v.f).injector().get(["userSrvc"]);b.info("disconnectUserPasswordChanged");
if(null===a.oFormValues[a.sFormDefinitionName].domain){var b=document.querySelector("form[name='"+a.oFormDefinition[a.sFormDefinitionName].name+"'] input[name='password']"),g=document.querySelector("form[name='"+a.oFormDefinition[a.sFormDefinitionName].name+"'] input[name='password_confirm']");""!==b.value&&b.value===g.value&&a.oFormValues[a.sFormDefinitionName].user_id===c.id&&angular.element(v.Wb).injector().get(["sessionSrvc"]).disconnect()}};angular.element(v.f).scope().loadLogsJob=function(){var a=
angular.element(v.f).injector().get(["$log"]);angular.element(v.f).injector().get(["envSrvc"]).sMode="update";a.info("loadLogsJob")};angular.element(v.f).scope().loadConfiguration=function(){var a=angular.element(v.f).injector().get(["$log"]);angular.element(v.f).injector().get(["envSrvc"]).sMode="update";a.info("loadConfiguration")};angular.element(v.f).scope().setPropertiesFormValues=function(a){var b=angular.element(v.f).injector().get(["$log"]),c=angular.element(v.f).injector().get(["envSrvc"]),
d=angular.element(v.f).injector().get(["propertiesSrvc"]),h=angular.element(v.f).injector().get(["formSrvc"]);b.info("setPropertiesFormValues");if("undefined"===typeof c.oFormValues[c.sFormDefinitionName]||hb(c.oFormValues[c.sFormDefinitionName]))var k=this.$root.$on("formDefinitionLoaded",function(){k();var b=0,e,f=Object.keys(d);c.oFormValues[c.sFormDefinitionName]={log_directories:d.log_directories};Array.isArray(a)||(a=[]);for(a.forEach(function(a){c.oFormValues[c.sFormDefinitionName][a]=angular.copy(d[a])});b<
f.length;)e=h.getFormElementDefinition(f[b],c.sFormDefinitionName),"undefined"!==typeof e&&(c.oFormValues[c.sFormDefinitionName][f[b]]="select"===e.type?{selectedOption:{value:angular.copy(d[f[b]])}}:angular.copy(d[f[b]])),b++;b=parseInt(c.oFormValues[c.sFormDefinitionName].max_upload_file_size);"NaN"===b?b="":0<b&&(b=parseInt(b/1048576));c.oFormValues[c.sFormDefinitionName].max_upload_file_size=b;"undefined"!=typeof c.oFormValues[c.sFormDefinitionName].rows_per_page&&(c.oFormValues[c.sFormDefinitionName].rows_per_page.selectedOption.value=
String(c.oFormValues[c.sFormDefinitionName].rows_per_page.selectedOption.value));c.oFormDefaultValues[c.sFormDefinitionName]=angular.copy(c.oFormValues[c.sFormDefinitionName])})};angular.element(v.f).scope().unsubscribeAccount=function(){console.log("unsubscribe");var a=angular.element(v.f).injector().get(["propertiesSrvc"]);A({method:"PUT",url:a.web_server_name+"/"+a.services_alias+"/vitis/accounts/"+sessionStorage.user_id+"/unsubscribe",data:{login:sessionStorage.user_login},success:function(a){console.log(a);
1===a.data.status?angular.element(v.f).scope().disconnect():$.notify(a.data.message,"error")}})};angular.element(v.Wb).scope().testPublicConnection=function(){var c=angular.element(v.f).injector().get(["propertiesSrvc"]);a.info("testPublicConnection");var e=this.$new();A({method:"POST",url:c.web_server_name+"/"+c.services_alias+"/vitis/PrivateToken",data:{user:b.oFormValues[b.sFormDefinitionName].public_login.selectedOption.value,password:b.oFormValues[b.sFormDefinitionName].public_password},scope:e,
success:function(a){if(1===a.data.status){var b={className:"modal-success"};e.modalWindow("dialog","Connexion R\u00e9ussie",b)}else b={className:"modal-danger"},null!==a.data.errorMessage&&(b.message=a.data.errorMessage),e.modalWindow("alert","ERROR_BIND_ACTIVE_DIRECTORY_USERS_USER",b)}})};angular.element(v.f).scope().loadUser=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["envSrvc"]),c=angular.element(v.f).injector().get(["userSrvc"]);a.info("loadUser");
b.sId=c.id;a="before"+Ia(b.oSelectedObject.name,"_").replace(/_/g,"")+"Edition";this.$root[a]();angular.element(v.f).scope().loadSimpleForm()};v.By=function(a){return{link:function(b,c,d){var e=d.$observe("appUserRoleColumn",function(d){if(null===b.row.entity[b.col.field]||""===b.row.entity[b.col.field])c[0].className="";else{var e;"admin"===d?e="admin-role":"user"===d&&(e="user-role");c[0].className="ui-grid-cell-contents "+e;a(["USER_ROLE_TOOLTIP_TITLE_USERS_USER","USER_ROLE_ADMIN_TOOLTIP_CONTENT_USERS_USER",
"USER_ROLE_USER_TOOLTIP_CONTENT_USERS_USER"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:a.USER_ROLE_TOOLTIP_TITLE_USERS_USER,content:function(){var c="";"admin"===b.row.entity[b.col.field]?c=a.USER_ROLE_ADMIN_TOOLTIP_CONTENT_USERS_USER:"user"===b.row.entity[b.col.field]&&(c=a.USER_ROLE_USER_TOOLTIP_CONTENT_USERS_USER);return c},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)}})})}});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};v.By.$inject=
["$translate"];v.compileProvider.directive("appUserRoleColumn",v.By);angular.element(v.f).scope().hideExcludedUserPrivileges=function(a){var b=angular.element(v.f).injector().get(["$log"]),c=angular.element(v.f).injector().get(["$timeout"]),d=angular.element(v.f).injector().get(["envSrvc"]),h=angular.element(v.f).injector().get(["userSrvc"]),k=angular.element(v.f).injector().get(["formSrvc"]);b.info("hideExcludedUserPrivileges");d.sId===h.id&&c(function(){for(var b=["vitis_admin","vitis_user"],c=
k.getFormElementDefinition(a,d.sFormDefinitionName),e=d.oFormValues[d.sFormDefinitionName],f=[c.id,c.id_from],c=[a,c.name_from],g,h,z=0;z<f.length;){g=0;for(h=document.getElementById(f[z]);h.options.length>g;)h.options[g].style.display="",-1!==b.indexOf(h.options[g].text)&&(h.options[g].style.display="none",e[c[z]].options[g].disabled=!0),g++;z++}});null!=d.oFormValues[d.sFormDefinitionName].last_connection&&(d.oFormValues[d.sFormDefinitionName].last_connection_pretty=moment(d.oFormValues[d.sFormDefinitionName].last_connection).format("L LTS"))};
angular.element(v.f).scope().ImportFromAd=function(a){var b=angular.element(v.f).injector().get(["$log"]),c=angular.element(v.X).injector().get(["$compile"]),d=angular.element(v.X).injector().get(["$templateRequest"]),h=angular.element(v.f).injector().get(["envSrvc"]);angular.element(v.f).injector().get(["formSrvc"]);angular.element(v.f).injector().get(["modesSrvc"]);b.info("ImportFromAd");var k=this.$new();k.oActiveDirectoryParameters={sObject:a};k.oActiveDirectoryParameters.sWebServicePath="person"==
a?"Users":"Groups";var m="form_active_directory_connection_"+h.oSelectedObject.name;k.modalWindow("dialog","TITLE_ACTIVE_DIRECTORY_CONNECTION",{className:"dialog-modal-window dialog-modal-window-ad-connection",message:'<div id="'+m+'"></div>'});k.sFormDefinitionName=h.oSelectedObject.name+"_import_ad_form";h.sFormDefinitionName=k.sFormDefinitionName;k.oFormRequestParams={sUrl:"modules/vitis/forms/users/active_directory_connection.json"};k.$root.clearFormData(k.sFormDefinitionName,k);k.bLoadFormValues=
!1;h.oFormValues[k.sFormDefinitionName]={};d("templates/formTpl.html").then(function(a){c($("#"+m).html(a).contents())(k)});b.info("compileObjectTemplate : templates/formTpl.html");var p=k.$root.$on("endFormNgRepeat",function(){p();var a=document.createElement("span");a.id=h.sFormDefinitionName+"_login_domain";a.className="dialog-modal-window-login-domain";document.querySelector("form[name='"+h.oFormDefinition[h.sFormDefinitionName].name+"'] .row:nth-child(2)").appendChild(a);var b=k.$root.$on("webServiceSelectOptionsloaded",
function(){b();0==h.oFormValues[k.sFormDefinitionName].domain.options.length?document.querySelector("form[name='"+h.oFormDefinition[h.sFormDefinitionName].name+"'] select[name='domain']").options.length=0:a.innerHTML="@"+h.oFormValues[k.sFormDefinitionName].domain.selectedOption.value});document.querySelector("form[name='"+h.oFormDefinition[h.sFormDefinitionName].name+"'] select[name='domain']").addEventListener("change",function(){a.innerHTML="@"+this.selectedOptions[0].value})})};angular.element(v.f).scope().loadImportForm=
function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$q"]),c=angular.element(v.X).injector().get(["$compile"]),g=angular.element(v.X).injector().get(["$templateRequest"]),h=angular.element(v.f).injector().get(["envSrvc"]),k=angular.element(v.f).injector().get(["propertiesSrvc"]),m=angular.element(v.f).injector().get(["modesSrvc"]);a.info("loadImportForm");var p=this;m.addScopeToObject(h.oSelectedObject.name,h.oSelectedMode.mode_id,p);p=p.$new();m.addScopeToObject(h.oSelectedObject.name,
h.oSelectedMode.mode_id,p);var t=b.defer(),b=t.promise,u=h.oFormValues[p.sFormDefinitionName],w=des(u.login+"@"+u.domain.selectedOption.value,u.password,1,0),u={login:u.login,password:stringToHex(w),object:p.oActiveDirectoryParameters.sObject,domain:u.domain.selectedOption.value};A({method:"GET",url:k.web_server_name+"/"+k.services_alias+"/vitis/ActiveDirectory/Test",params:u,scope:p,success:function(b){if(1===b.data.status)bootbox.hideAll(),p.oLdap=h.extractWebServiceData("activedirectory",b.data)[0],
h.oSelectedObject={actions:[],columns:[],mode_id:h.oSelectedMode.mode_id,name:"active_directory_"+h.oSelectedObject.name,sections:"",template_name:"activeDirectoryTree",aScope:h.oSelectedObject.aScope},m.getMode(h.oSelectedMode.mode_id).objects.push(h.oSelectedObject),m.addScopeToObject(h.oSelectedObject.name,h.oSelectedMode.mode_id,p),g("templates/doubleFormTpl.html").then(function(a){c($("#container_mode_"+h.oSelectedMode.mode_id).html(a).contents())(p)}),a.info("compileObjectTemplate : templates/doubleFormTpl.html"),
t.resolve();else{p.aSelection=[];var d={className:"modal-danger"};null!==b.data.errorMessage&&(d.message=b.data.errorMessage);p.modalWindow("alert","ERROR_BIND_ACTIVE_DIRECTORY_USERS_USER",d)}}});return b};angular.element(v.f).scope().updateProperties=function(a){var b=angular.element(v.f).injector().get(["$log"]),c=angular.element(v.f).injector().get(["$translate"]),d=angular.element(v.f).injector().get(["$window"]),h=angular.element(v.f).injector().get(["envSrvc"]),k=angular.element(v.f).injector().get(["propertiesSrvc"]),
m=angular.element(v.f).injector().get(["formSrvc"]);b.info("updateProperties");var p=this,t={properties:m.getFormData(h.sFormDefinitionName,!0),module_name:a};A({method:"PUT",url:k.web_server_name+"/"+k.services_alias+"/vitis/Properties/"+a,data:t,scope:p,success:function(b){if(1===b.data.status){c("FORM_VALIDATION_OK").then(function(a){$.notify(a,"success")});if("vitis"===a&&k.language!==t.properties.language){var e={className:"modal-warning",message:"PAGE_RELOAD_CONFIRM_CONFIGURATION",callback:function(a){a&&
d.location.reload()}};p.modalWindow("confirm","",e)}k.getFromServer()}else e={className:"modal-danger"},null!==b.data.errorMessage&&(e.message=b.data.errorMessage),p.modalWindow("alert","FORM_VALIDATION_ERROR",e)}})};angular.element(v.f).scope().beforeUsersVitisUsersEdition=function(a){var b=angular.element(v.f).injector().get(["$log"]),c=angular.element(v.f).injector().get(["envSrvc"]),d=angular.element(v.f).injector().get(["formSrvc"]),h=angular.element(v.f).injector().get(["propertiesSrvc"]);b.info("beforeUsersVitisUsersEdition");
var k=this,m=k.$root.$on("formDefinitionLoaded",function(b,e){m();if(null!=c.oFormValues[e].domain){b=d.getAllFormElementDefinition(e);for(var f=0;f<b.length;){switch(b[f].name){case "name":case "email":case "company":case "department":b[f].type="label";break;case "new_password_title":case "password":case "password_confirm":b[f].visible=!1;break;case "groups":case "privileges":h.mixed_rights_management||(b[f].visible=!1);break;case "active_directory_groups":b[f].visible=!0;A({method:"GET",url:h.web_server_name+
"/"+h.services_alias+"/vitis/ActiveDirectory/UserGroups/"+a,scope:k,success:function(a){1===a.data.status&&(c.oFormValues[e].active_directory_groups=a.data.activedirectory[0].adGroups,c.oFormValues[e].all_groups=a.data.activedirectory[0].allGroups)}});break;case "all_groups":h.mixed_rights_management&&(b[f].visible=!0)}f++}}})};angular.element(v.f).scope().beforeUserVitisUserEdition=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["envSrvc"]),c=
angular.element(v.f).injector().get(["formSrvc"]);a.info("beforeUserVitisUserEdition");var g=this.$root.$on("formDefinitionLoaded",function(a,d){g();if(null!==b.oFormValues[d].domain)for(a=c.getAllFormElementDefinition(d),d=0;d<a.length;){switch(a[d].name){case "new_password_title":case "password":case "password_confirm":a[d].visible=!1}d++}})};angular.element(v.f).scope().beforeSendingDomainForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["envSrvc"]);
a.info("beforeSendingDomainForm");a=b.oFormValues[b.sFormDefinitionName];null!=a.login&&(-1===a.login.indexOf("@")&&(a.login+="@"+a.domain),null!=a.password&&"0x"!==a.password.substr(0,2)&&(b=des(a.login,a.password,1,0),a.password=stringToHex(b)))};angular.element(v.f).scope().getUsers2DomainFilter=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["propertiesSrvc"]);a.info("getUsers2DomainFilter");if(!b.mixed_rights_management)return"IS NULL"};angular.element(v.f).scope().isImgFile=
function(a){-1!==a.indexOf("?")&&(a=a.substr(0,a.indexOf("?")));a=a.split(".");return-1<["jpg","png","jpeg"].indexOf(a[a.length-1].toLowerCase())};v.vF=function(){return{replace:!0,template:'<div><img ng-if="responseHavePicture && !bFileIsPdf" class="miniature_picture ui-grid-cell-contents" width="50" height="50" ng-src="{{urlToPicture}}" ng-hide="true"></img><span ng-show="responseHavePicture && !bFileIsPdf" ng-click="openViewer()" class="glyphicon glyphicon-picture grid-column-glyph-icon"></span><a ng-show="responseHavePicture && bFileIsPdf" ng-href="{{urlToPicture}}" target="_blank"><span class="glyphicon glyphicon-link grid-column-glyph-icon"></span></a></div>',
link:function(a,b,c){var d=c.$observe("file",function(){null===c.file||""===c.file?(b[0].children[1].className="",a.responseHavePicture=!1):a.responseHavePicture=!0;if(null==c.path)console.error("Path attribute is not present on directive caller");else if(null==c.file)console.error("File attribute is not present on directive caller");else if(""!==c.file&&(null==c.alias&&(console.warn("alias attribute is not present on directive caller (set with default value : public_alias)"),c.alias="public_alias"),
null!=c.maxPopover?""===c.maxPopover?(console.warn("File attribute is an empty string (set with default value : 200)"),c.maxPopover=200):r(c.maxPopover)&&(c.maxPopover=parseInt(c.maxPopover)):(console.warn("maxPopover attribute is not present on directive caller (set with default value : 200)"),c.maxPopover=200),null!=c.imgClass?r(c.imgClass)||(c.imgClass=""):c.imgClass="",null!=c.popoverClass?r(c.popoverClass)||(c.popoverClass=""):c.popoverClass="",a.oProperties=angular.element("#works_line").scope().oProperties,
a.path=null!=a[c.path]?a[c.path]:c.path,a.urlToPicture=a.oProperties.web_server_name+"/"+a.oProperties[c.alias]+"/"+a.path+"/"+c.file,/^https?:\/\//.test(c.file)&&(a.urlToPicture=c.file),a.bFileIsPdf=!a.$root.isImgFile(c.file),a.bFileIsPdf=!a.$root.isImgFile(c.file),b[0].parentNode.style.textAlign="center",!a.bFileIsPdf))if(null===c.file||""===c.file)b[0].children[1].className="";else{var e=b.find("img");null!=e[0]&&(e[0].onerror=function(){console.error("Fail to load image",c.file)});e={inline:!1,
button:!0,navbar:!1,title:2,toolbar:2,tooltip:!0,fullscreen:!1,url:function(){return a.urlToPicture}};null!=a.viewer?a.viewer.update():a.viewer=new Viewer(b[0].children[0],e);a.openViewer=function(){a.viewer.show();angular.element(".viewer-prev").remove();angular.element(".viewer-next").remove()};$(b).children("span").popover({trigger:"hover",container:"body",title:"",content:function(){var b=document.createElement("img");b.src=a.urlToPicture;var d=c.maxPopover,e=b.naturalWidth,f=b.naturalHeight,
d=e<f?f/d:e/d;b.width=0<d?e/d:e;b.height=0<d?f/d:f;b.className=c.imgClass;return b.outerHTML},html:!0,template:'<div class="popover '+c.popoverClass+' " role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'});a.$on("$destroy",function(){$(b[0].children[1]).popover("destroy");a.viewer.destroy();d()})}})}}};v.compileProvider.directive("appDocumentViewer",v.vF);v.dy=function(){return{replace:!1,template:'<a href="#" ng-click="goToItem()">{{itemData}}</a>',
link:function(a,b,c){var d=angular.element(v.X).injector().get(["envSrvc"]),e=angular.element(v.f).scope(),f=c.$observe("itemData",function(){null==(c.itemData||""===c.itemData)&&(console.warn("No data display in column"),c.itemData="");null==(c.mode||""===c.mode)&&(console.warn("No mode selected (set to 'update' as default value)"),c.mode="update");null!=c.object?""===c.object?console.error("objet name is empty"):null!=c.fieldToSelect?""===c.fieldToSelect?console.error("fieldToSelect name is empty"):
(a.itemData=c.itemData,a.goToItem=function(){e.selectElement(null!=c.modeId?c.modeId:d.oSelectedMode.mode_id,c.object,c.fieldToSelect,null!=c.mode?c.mode:"update")},a.$on("$destroy",function(){f()})):console.error("No fieldToSelect define"):console.error("No object define")})}}};v.dy.$inject=["$timeout"];v.compileProvider.directive("appLinker",v.dy);angular.element(v.f).scope().setWorkObject=function(a,b){var c=angular.element(v.X).injector().get(["$log"]),d=angular.element(v.f).injector().get(["propertiesSrvc"]),
e=angular.element(v.X).scope(),k=angular.element(v.X).injector().get(["envSrvc"]);angular.element(v.f).scope();var m=angular.element(v.f).scope().oWorkObjects[a][b].config;if(-1===sessionStorage.application_modules.split(",").indexOf(a))return 0;c.info("setWorkObject for module : "+a+" on Object "+b);var p=e.$root.gridApi[k.sSelectedGridOptionsName].selection.getSelectedRows();if(!q(p))return console.error("aSelectedRows is not an array"),0;if(1!==p.length)return bootbox.alert("<h4>Veuillez s\u00e9lectionner un(e) unique "+
b+"</h4>"),0;c={user_id:sessionStorage.user_id};c[m.sFieldId]=p[0][m.sFieldId];A({method:"POST",url:d.web_server_name+"/"+d.services_alias+"/"+m.sWebService,params:c,success:function(c){n(c.data)||(bootbox.alert("<h4>Erreur lors de la d\u00e9finition du "+b+" de travail</h4>"),console.error("response: ",c));n(c.data.errorMessage)&&(bootbox.alert("<h4>Erreur lors de la d\u00e9finition du "+b+" de travail</h4><br>"+c.data.errorType+"<br>"+c.data.errorMessage),console.error("response: ",c));angular.element(v.X).scope().refreshGrid(e,
k.oGridOptions[k.sSelectedGridOptionsName]);angular.element("#"+m.sIdButtonLock).prop("disabled",!0);angular.element("#"+m.sIdButtonUnlock).prop("disabled",!1);angular.element(v.f).scope().oWorkObjects[a][b].value=p[0][m.sFieldId]},error:function(a){bootbox.alert("<h4>Erreur lors de la d\u00e9finition du "+b+" de travail:</h4><br>"+a.status);console.error("response: ",a.status)}})};v.Ay=function(){return{link:function(a,b,c){var d=c.$observe("text",function(){n(c.text)&&""!==c.text?(b[0].className=
null!=c.icon?"ui-grid-cell-contents "+c.icon:"ui-grid-cell-contents info-icon","html"===c.mode&&null!=c.splitter&&(c.text=c.text.split(c.splitter).join("<br/>")),$(b).popover({trigger:"hover",container:"body",title:c.title,content:function(){return c.text},html:"html"===c.mode,placement:function(b,c){return a.$root.workspaceTooltipPlacement(c)}})):b[0].className="";a.$on("$destroy",function(){$(b).popover("destroy");d()})})}}};v.Ay.$inject=["$translate"];v.compileProvider.directive("appTextPopoverDisplay",
v.Ay);v.my=function(){return{replace:!0,template:'<div class="progress" style="margin: 5px 10px 10px;position:relative"><div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width:{{row.entity[col.field]}}%"></div><div style="font-weight:700;position:absolute;width:100%;text-align:center;top:2px;">{{textValue}}</div></div>',link:function(a,b,c){a.HQ=null!=c.hidevalue?"":a.BQ.VP[a.QP.ZP]+"%";null!=c.mode&&(b[0].firstChild.className=b[0].firstChild.className+
" progress-bar-"+c.mode);null!=c.striped&&(b[0].firstChild.className+=" progress-bar-striped",null!=c.active&&(b[0].firstChild.className+=" active"))}}};v.my.$inject=["$translate"];v.compileProvider.directive("appNavbar",v.my);v.zz=function(){return{replace:!0,scope:{value:"=appDurationCalculator"},template:"<div> {{duration}} </div>",link:function(a){a.$watch("value",function(){var b=[0,0,0],c=[3600,60,1],d=0;a.duration="";if(null!=a.value)if(0<=a.value){for(b[0]=a.value;d<c.length;){var h=b[d]%
c[d],k=(b[d]-h)/c[d];b[d]=10>k?"0"+k:""+k;if(0===h)break;else b[d+1]=h;d++}a.duration=b.join(":")}else a.duration="NEG_VAL"})}}};v.zz.$inject=["$translate"];v.compileProvider.directive("appDurationCalculator",v.zz);angular.element(v.f).scope().clearWorkObject=function(a,b){var c=angular.element(v.X).injector().get(["$log"]),d=angular.element(v.f).injector().get(["propertiesSrvc"]),e=angular.element(v.X).scope(),k=angular.element(v.X).injector().get(["envSrvc"]);angular.element(v.f).scope();var m=
angular.element(v.f).scope().oWorkObjects[a][b].config;if(-1===sessionStorage.application_modules.split(",").indexOf(a))return 0;c.info("clearWorkPost for module : "+a+" on Object "+b);A({method:"DELETE",url:d.web_server_name+"/"+d.services_alias+"/"+m.sWebService+"/"+sessionStorage.user_id,success:function(c){n(c.data)||(bootbox.alert("<h4>Erreur lors de la lib\u00e9ration du "+b+" de travail</h4>"),console.error("response: ",c));n(c.data.errorMessage)&&(bootbox.alert("<h4>Erreur lors de la lib\u00e9ration du "+
b+" de travail</h4><br>"+c.data.errorType+"<br>"+c.data.errorMessage),console.error("response: ",c));angular.element(v.X).scope().refreshGrid(e,k.oGridOptions[k.sSelectedGridOptionsName]);angular.element("#"+m.sIdButtonLock).prop("disabled",!1);angular.element("#"+m.sIdButtonUnlock).prop("disabled",!0);angular.element(v.f).scope().oWorkObjects[a][b].value=!1},error:function(a){bootbox.alert("<h4>Erreur lors de la lib\u00e9ration du "+b+" de travail:</h4><br>"+a.status);console.error("response: ",
a.status)}})};angular.element(v.f).scope().initWorkObject=function(a,b,c){null!=angular.element(v.f).scope().oWorkObjects||(angular.element(v.f).scope().oWorkObjects={});angular.element(v.f).scope().oWorkObjects[a]={};angular.element(v.f).scope().oWorkObjects[a][b]={};angular.element(v.f).scope().oWorkObjects[a][b].value=!1;angular.element(v.f).scope().oWorkObjects[a][b].config=c};angular.element(v.f).scope().getWorkObject=function(a,b){return angular.element(v.f).scope().oWorkObjects[a][b].value};
angular.element(v.f).scope().lookWorkObjectIsAlreadyLock=function(a,b){var c=angular.element(v.f).injector().get(["propertiesSrvc"]),d=angular.element(v.f).scope().oWorkObjects[a][b].config;A({method:"GET",headers:{Accept:"application/x-vm-json"},url:c.web_server_name+"/"+c.services_alias+"/"+d.sWebService,params:{filter:{relation:"AND",operators:[{column:"user_id",compare_operator:"=",value:sessionStorage.user_id}]},distinct:!0},success:function(c){n(c.data)||(bootbox.alert("<h4>Erreur lors de la d\u00e9finition du "+
b+"</h4>"),console.error("response: ",c));n(c.data.errorMessage)&&(bootbox.alert("<h4>Erreur lors de la d\u00e9finition du "+b+"</h4><br>"+c.data.errorType+"<br>"+c.data.errorMessage),console.error("response: ",c));1===c.data.list_count?(angular.element(v.f).scope().oWorkObjects[a][b].value=c.data.data[0][d.sFieldId],angular.element("#"+d.sIdButtonLock).prop("disabled",!0),angular.element("#"+d.sIdButtonUnlock).prop("disabled",!1)):(angular.element("#"+d.sIdButtonLock).prop("disabled",!1),angular.element("#"+
d.sIdButtonUnlock).prop("disabled",!0))},error:function(a){bootbox.alert("<h4>Erreur lors de la r\u00e9cup\u00e9ration du "+b+":</h4><br>"+a.status);console.error("response: ",a.status)}})};angular.element(v.f).scope().loadHelp=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.X).injector().get(["envSrvc"]);a.info("loadHelp");b.sMode="update"};angular.element(v.f).scope().zu=function(){var a=angular.element(v.f).scope();A({method:"GET",url:"modules/vitis/data/proj.json",
scope:a,success:function(b){a.proj=b.data},error:function(a){console.error("ERROR : (AJAX request : "+a.status+" ) On loading Projections, contact Veremes please")}})};angular.element(v.f).scope().zu();angular.element(v.f).scope().deleteUsers=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$translate"]),c=angular.element(v.f).injector().get(["envSrvc"]),g=angular.element(v.f).injector().get(["userSrvc"]);a.info("deleteUsers");var h=angular.element(v.X).scope(),
k=!0;h.$root.gridApi[c.sSelectedGridOptionsName].selection.getSelectedRows().forEach(function(a){a.user_id==g.id&&(k=!1,h.$root.gridApi[c.sSelectedGridOptionsName].selection.unSelectRow(a),b(["ERROR_DELETING_OWN_USER"]).then(function(a){h.$root.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:a.ERROR_DELETING_OWN_USER})}))});k&&h.$root.DeleteSelection()};angular.element(v.f).scope().hideCurrentUserFromExcludedPrivileges=function(a){var b=angular.element(v.f).injector().get(["$log"]),
c=angular.element(v.f).injector().get(["$timeout"]),d=angular.element(v.f).injector().get(["envSrvc"]),h=angular.element(v.f).injector().get(["userSrvc"]),k=angular.element(v.f).injector().get(["formSrvc"]);b.info("hideCurrentUserFromExcludedPrivileges");-1!=["vitis_admin","vitis_user"].indexOf(d.sId)&&c(function(){for(var b=k.getFormElementDefinition(a,d.sFormDefinitionName),c=d.oFormValues[d.sFormDefinitionName],e=[b.id,b.id_from],b=[a,b.name_from],f,g,x=0;x<e.length;){f=0;for(g=document.getElementById(e[x]);g.options.length>
f;)g.options[f].style.display="",h.id==g.options[f].value&&(g.options[f].style.display="none",c[b[x]].options[f].disabled=!0),f++;x++}})};angular.element(v.f).scope().loadModes=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$translate"]),c=angular.element(v.X).injector().get(["envSrvc"]);a.info("loadModes");var g=this,a=document.getElementById("container_section_"+c.oSelectedObject.name+"_modes");a.className+=" section-container-workspace-list";
g.gridOptions={enableRowSelection:!0,enableSelectAll:!1,enablePagination:!1,enablePaginationControls:!1,multiSelect:!1,useExternalPagination:!0,paginationPageSize:999,enableColumnMenus:!1,enableColumnResizing:!1,appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!1,appHeaderOptionBar:!1,appLoadGridData:!0,appGridTitle:"LIST_TITLE_GRID_MODES",appFooter:!1,appShowPagination:!1,appEnableDragAndDrop:!0,appDragAndDropEvent:{rowFinishDrag:"updateModesSorting"},appActions:[],oUrlParams:{action:"getAll",
distinct:!0,order_by:"index",sort_order:"ASC"}};g.bLoadFormValues=!1;b(["LIST_MODE_ICONE_MODE_CONFIGURATION","LIST_MODE_ID_MODE_CONFIGURATION","LIST_MODE_INDEX_CONFIGURATION"]).then(function(a){g.gridOptions.columnDefs=[{name:a.LIST_MODE_INDEX_CONFIGURATION,displayName:a.LIST_MODE_INDEX_CONFIGURATION,field:"index",visible:!1,width:50,enableSorting:!1,type:"number",enableColumnMoving:!1,enableColumnResizing:!1,headerCellClass:"vitis_mode_"+c.oSelectedObject.name+"_index"},{name:a.LIST_MODE_ID_MODE_CONFIGURATION,
displayName:a.LIST_MODE_ID_MODE_CONFIGURATION,field:"mode_id",width:300,enableSorting:!1,type:"string",enableColumnMoving:!1,enableColumnResizing:!1,headerCellClass:"vitis_mode_"+c.oSelectedObject.name+"_mode_id"},{name:a.LIST_MODE_ICONE_MODE_CONFIGURATION,displayName:a.LIST_MODE_ICONE_MODE_CONFIGURATION,field:"mode_id",width:50,enableSorting:!1,type:"number",enableColumnMoving:!1,enableColumnResizing:!1,headerCellClass:"vitis_mode_"+c.oSelectedObject.name+"_index",cellClass:"cell-align-center",cellTemplate:'<div style="font-size:16px;color:#9a9a9a;margin-top:5px;vertical-align:middle" class="icon-{{row.entity[col.field]}}"></div>'}]})};
angular.element(v.f).scope().updateModesSorting=function(){a.info("updateMapLayerSorting");for(var d=this,e=b.oGridOptions[b.sSelectedGridOptionsName],f=0,g=[];f<e.data.length;)g.push(e.data[f].mode_id),f++;A({method:"PUT",url:c.web_server_name+"/"+c.services_alias+"/vitis/modes/sorting",data:{modes_id:g.join("|")},scope:d,success:function(a){0===a.data.status&&d.modalWindow("dialog","ERROR_ADD_MAP_LAYERS_VMAP_MAP_MAP_LAYERS",{className:"modal-danger",message:a.data.errorMessage})}})};angular.element(v.f).scope().reloadWebsocketStatus=
function(){function a(){if(!(10<b)){var c=angular.element($('[data-app-websocket-configuration=""]')).scope();null!=c?null!=c.ctrl?angular.element($('[data-app-websocket-configuration=""]')).scope().ctrl.reloadWebsocketStatus():setTimeout(function(){a()},500):setTimeout(function(){a()},500);b++}}var b=0;setTimeout(function(){a()})};angular.element(v.f).scope().callBoMethod=function(a){var b=angular.element(v.X).injector().get(["envSrvc"]),c=angular.element(v.f).injector().get(["propertiesSrvc"]);
A({method:"PUT",url:c.web_server_name+"/"+c.services_alias+"/"+b.getSectionWebServiceResourceId()+"/"+b.sId,params:{method:a},success:function(){angular.element(v.f).scope().setMode("search")}})}});function FB(){return{restrict:"A",controller:"AppImportVexController",controllerAs:"ctrl",bindToController:!0,templateUrl:window.oClientProperties.vmap_folder+"/template/vitis/importVex.html",link:function(a,b){$(b).find(".file").fileinput({showUpload:!1,showPreview:!1,mainClass:"input-group-sm"});a.refreshCodeMirror=function(){setTimeout(function(){$(b).find(".CodeMirror").each(function(a,b){b.CodeMirror.refresh()})},1E3)}}}}qa("nsVmap.importVexDrtv",FB);B.module.directive("appImportVex",FB);function GB(a,b,c,d){b.info("nsVmap.importVexCtrl");this.K=b;this.b=a;this.va=c;this.gk=d;this.tv=angular.element(v.f).scope();this.oProperties=angular.element(v.f).injector().get(["propertiesSrvc"]);this.sToken=sessionStorage.session_token;this.oTranslations={};a.displayedStep="";a.steps="import_vex_file config vmap_objects web_services import_sql execute_import finalize".split(" ");a.oSql=null;a.oVMapObjects=null;a.aWebServices=null;a.usedDatabase=null;a.usedSchema=null;a.usedSRID=null;a.usedUserRole=
null;a.usedAdminRole=null;a.aDatabases=[];a.aSchemas=[];a.aRoleGroups=[];a.aCoordsys=[];a.oPrivateConnection=null;a.selectedSteps={import_vex_file:!0,config:!0,vmap_objects:!0,import_sql:!0,web_services:!0,execute_import:!0,finalize:!0};a.sSQLModel="";a.sSQLData="";a.oImportSteps={vmap_objects:null,vmap_objects_maps:null,vmap_objects_services:null,vmap_objects_calques:null,vmap_objects_calque_themes:null,vmap_objects_vm4ms_layers:null,vmap_objects_business_objects:null,vmap_objects_events:null,vmap_objects_reports:null,
web_services:null,sql:null,sql_model:null,sql_data:null};a.bImportDone=!1;this.XA=0;this.pL=this.$s=this.Ue=this.Ll=null;this.av();this.Yg("import_vex_file")}qa("nsVmap.importVexCtrl",GB);GB.$inject=["$scope","$log","$q","$translate"];
GB.prototype.Ew=function(a){this.K.info("nsVmap.importVexCtrl.submitStep");var b=this;switch(a){case "import_vex_file":HB(this).then(function(){b.rc()});break;case "config":IB(this)&&b.rc();break;case "vmap_objects":if(ha(b.Ue)&&0<Object.keys(b.Ue).length){a=0;var c=b.oTranslations.CTRL_IMPORT_VEX_ERROR_EXISTING_VMAP_OBJETS,d;for(d in b.Ue)q(b.Ue[d])&&(a+=b.Ue[d].length);c=c.replace("[number]",a);bootbox.confirm("<h4>"+c+"</h4>",function(a){a&&b.b.$applyAsync(function(){b.rc()})});break}b.rc();break;
case "import_sql":bootbox.confirm("<h4>"+b.oTranslations.CTRL_IMPORT_VEX_WARNING_SQL+"</h4>",function(a){a&&b.b.$applyAsync(function(){b.rc()})});break;default:this.rc()}};GB.prototype.submitStep=GB.prototype.Ew;
GB.prototype.rc=function(){this.K.info("nsVmap.importVexCtrl.nextStep");var a=angular.copy(this.b.displayedStep),a=this.b.steps.indexOf(a);if(-1!==a)if(null!=this.b.steps[a+1])a=this.b.steps[a+1];else return console.error("next step doesn't exists"),null;else return console.error("this step doesn't exists"),null;this.Yg(a)};GB.prototype.nextStep=GB.prototype.rc;
GB.prototype.ph=function(){this.K.info("nsVmap.importVexCtrl.prevStep");var a=angular.copy(this.b.displayedStep),a=this.b.steps.indexOf(a);if(-1!==a)if(null!=this.b.steps[a-1])a=this.b.steps[a-1];else return console.error("previous step doesn't exists"),null;else return console.error("this step doesn't exists"),null;this.Yg(a)};GB.prototype.prevStep=GB.prototype.ph;
GB.prototype.Yg=function(a){this.K.info("nsVmap.importVexCtrl.goStep");var b=this,c=b.b.steps.indexOf(b.b.displayedStep),d=b.b.steps.indexOf(a);if(!(c>d))if(!1!==b.b.selectedSteps[a])switch(a){case "config":JB(this).then(function(){b.b.displayedStep=a});break;case "vmap_objects":this.Rq().then(function(){b.b.displayedStep=a},function(){b.b.displayedStep=a;b.rc()});break;case "import_sql":KB(this).then(function(){b.b.displayedStep=a},function(){b.b.displayedStep=a;b.rc()});break;case "web_services":this.Tq().then(function(){b.b.displayedStep=
a},function(){b.b.displayedStep=a;b.rc()});break;case "execute_import":b.b.oImportSteps.vmap_objects=null;b.b.oImportSteps.vmap_objects_maps=null;b.b.oImportSteps.vmap_objects_services=null;b.b.oImportSteps.vmap_objects_calques=null;b.b.oImportSteps.vmap_objects_calque_themes=null;b.b.oImportSteps.vmap_objects_vm4ms_layers=null;b.b.oImportSteps.vmap_objects_business_objects=null;b.b.oImportSteps.vmap_objects_events=null;b.b.oImportSteps.vmap_objects_reports=null;b.b.oImportSteps.web_services=null;
b.b.oImportSteps.sql=null;b.b.oImportSteps.sql_model=null;b.b.oImportSteps.sql_data=null;b.b.displayedStep=a;break;default:this.b.displayedStep=a}else switch(a){case "vmap_objects":b.b.oVMapObjects=null;this.b.displayedStep=a;this.rc();break;case "import_sql":b.b.oSql=null;b.b.sSQLModel="";b.b.sSQLData="";this.b.displayedStep=a;this.rc();break;case "web_services":b.b.aWebServices=null;this.b.displayedStep=a;this.rc();break;default:this.b.displayedStep=a,this.rc()}if(c>d)if(!1!==b.b.selectedSteps[a])switch(a){case "vmap_objects":this.b.displayedStep=
a;null===this.b.oVMapObjects&&b.ph();break;case "import_sql":this.b.displayedStep=a;null===this.b.oSql&&b.ph();break;case "web_services":this.b.displayedStep=a;null===this.b.aWebServices&&b.ph();break;default:this.b.displayedStep=a}else b.b.displayedStep=a,b.ph()};GB.prototype.goStep=GB.prototype.Yg;GB.prototype.dG=function(){this.K.info("nsVmap.importVexCtrl.closeImportModal");$(".bootbox.modal").each(function(){$(this).modal("hide")});this.tv.setMode("development")};
GB.prototype.closeImportModal=GB.prototype.dG;
GB.prototype.av=function(){for(var a=this,b=[],c=0;c<this.b.steps.length;c++)b.push("CTRL_IMPORT_VEX_STEP_"+this.b.steps[c]);b.push("CTRL_IMPORT_VEX_ERROR_SELECT_VEX_FILE");b.push("CTRL_IMPORT_VEX_ERROR_VEX_IMPORT_FAIL");b.push("CTRL_IMPORT_VEX_ERROR_REQUEST_GET_DATABASES");b.push("CTRL_IMPORT_VEX_ERROR_REQUEST_GET_SCHEMAS");b.push("CTRL_IMPORT_VEX_ERROR_REQUEST_GET_ROLEGROUPS");b.push("CTRL_IMPORT_VEX_ERROR_REQUEST_GET_COORDSYS");b.push("CTRL_IMPORT_VEX_ERROR_REQUEST_GET_PRIVATE_CONNECTION");b.push("CTRL_IMPORT_VEX_ERROR_PRIVATE_CONNECTION_DATABASE_DIFFERENT");
b.push("CTRL_IMPORT_VEX_ERROR_DATABASE_REQUIRED");b.push("CTRL_IMPORT_VEX_ERROR_SCHEMA_REQUIRED");b.push("CTRL_IMPORT_VEX_ERROR_COORDSYS_REQUIRED");b.push("CTRL_IMPORT_VEX_ERROR_EDIT_NAME_NOT_VALID");b.push("CTRL_IMPORT_VEX_ERROR_USER_ROLE_REQUIRED");b.push("CTRL_IMPORT_VEX_ERROR_ADMIN_ROLE_REQUIRED");b.push("CTRL_IMPORT_VEX_ERROR_EXISTING_VMAP_OBJETS");b.push("CTRL_IMPORT_VEX_WARNING_SQL");b.push("CTRL_IMPORT_VEX_ERROR_REQUEST_IMPORT_VMAP_OBJECTS");b.push("CTRL_IMPORT_VEX_ERROR_REQUEST_IMPORT_WEB_SERVICES");
b.push("CTRL_IMPORT_VEX_ERROR_REQUEST_IMPORT_SQL");this.gk(b).then(function(b){a.oTranslations=b})};
function HB(a){a.K.info("nsVmap.importVexCtrl.parseVexFile_");var b=a.va.defer(),c=$("#import-vex-file-input").prop("files");if(null==c[0])return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_SELECT_VEX_FILE,"error"),null;LB(a,c[0]).then(function(c){null!=c.sql&&(a.b.oSql=c.sql);null!=c.web_services&&(a.b.aWebServices=c.web_services);null!=c.vmap_objects&&(a.b.oVMapObjects=c.vmap_objects);b.resolve()});return b.promise}
function LB(a,b){a.K.info("nsVmap.importVexCtrl.getVexFileContent_");var c=a.va.defer(),d=new FormData;d.append("vex_file",b);A({method:"POST",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vmap/vex/parse_vex",headers:{Accept:"application/x-vm-json"},data:d,scope:a.b,success:function(b){if(null==b.data)return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_VEX_IMPORT_FAIL,"error"),null;if(null!=b.data&&null!=b.data.errorMessage)return angular.element(v.f).scope().modalWindow("dialog",
"Erreur serveur",{className:"modal-danger",message:b.data.errorMessage}),null;if(1!==b.data.status||null==b.data.vex)return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_VEX_IMPORT_FAIL,"error"),null;c.resolve(b.data.vex)},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_VEX_IMPORT_FAIL,"error");c.reject()}});return c.promise}
function JB(a){function b(){d++;3<=d&&c.resolve()}a.K.info("nsVmap.importVexCtrl.loadConfigObjects_");var c=a.va.defer(),d=0;MB(a).then(function(){if(null==a.b.oPrivateConnection||null==a.b.oPrivateConnection.database)return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_GET_PRIVATE_CONNECTION,"error"),null;NB(a,a.b.oPrivateConnection.database).then(function(){null!=a.Ll&&a.Ll();OB(a).then(b);PB(a).then(b);QB(a).then(b);a.Ll=a.b.$watch("usedDatabase",function(b,c){b!=c&&null!=a.b.oPrivateConnection&&
null!=a.b.oPrivateConnection.database&&(OB(a),PB(a),a.b.usedDatabase!==a.b.oPrivateConnection.database&&bootbox.alert("<h4>"+a.oTranslations.CTRL_IMPORT_VEX_ERROR_PRIVATE_CONNECTION_DATABASE_DIFFERENT+"</h4>"))})})});return c.promise}
function NB(a,b){a.K.info("nsVmap.importVexCtrl.loadDatabases_");var c=a.va.defer(),d=["postgres"];Pa(a.b.aDatabases);a.b.usedDatabase=null;A({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vitis/genericquerys/databases",headers:{Accept:"application/x-vm-json"},scope:a.b,success:function(e){if(null==e.data)return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_GET_DATABASES,"error"),null;if(null==e.data.data)return console.error("Aucun r\u00e9sultat: databases",
e),null;for(var f=0;f<e.data.data.length;f++)null!=e.data.data[f].database&&-1===d.indexOf(e.data.data[f].database)&&a.b.aDatabases.push(e.data.data[f].database);1!==a.b.aDatabases.indexOf(b)?a.b.usedDatabase=b:(bootbox.alert(a.oTranslations.CTRL_IMPORT_VEX_ERROR_PRIVATE_CONNECTION_DATABASE_DIFFERENT),a.b.usedDatabase=a.oProperties.database);c.resolve()},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_GET_DATABASES,"error")}});return c.promise}
function OB(a){a.K.info("nsVmap.importVexCtrl.loadSchemas_");var b=a.va.defer(),c=["pg_catalog","information_schema"];Pa(a.b.aSchemas);a.b.usedSchema=null;A({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vitis/genericquerys/"+a.b.usedDatabase+"/schemas",headers:{Accept:"application/x-vm-json"},scope:a.b,success:function(d){if(null==d.data)return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_GET_SCHEMAS,"error"),null;if(null==d.data.data)return console.error("Aucun r\u00e9sultat: schemas",
d),null;for(var e=0;e<d.data.data.length;e++)null!=d.data.data[e].schema_name&&-1===c.indexOf(d.data.data[e].schema_name)&&a.b.aSchemas.push(d.data.data[e].schema_name);b.resolve()},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_GET_SCHEMAS,"error")}});return b.promise}
function PB(a){a.K.info("nsVmap.importVexCtrl.loadRoleGroups_");var b=a.va.defer();Pa(a.b.aRoleGroups);a.b.usedSchema=null;A({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vitis/genericquerys/",headers:{Accept:"application/x-vm-json"},params:{database:a.b.usedDatabase,schema:"pg_catalog",table:"pg_group"},scope:a.b,success:function(c){if(null==c.data)return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_GET_ROLEGROUPS,"error"),null;if(null==c.data.data)return console.error("Aucun r\u00e9sultat",
c),null;for(var d=0;d<c.data.data.length;d++)null!=c.data.data[d].groname&&a.b.aRoleGroups.push(c.data.data[d].groname);b.resolve()},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_GET_ROLEGROUPS,"error")}});return b.promise}
function QB(a){a.K.info("nsVmap.importVexCtrl.loadCoordsys_");var b=a.va.defer();Pa(a.b.aCoordsys);a.b.usedSRID=null;A({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vm4ms/coordinatesystems",headers:{Accept:"application/x-vm-json"},params:{order_by:"coordsys_id"},scope:a.b,success:function(c){if(null==c.data)return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_GET_COORDSYS,"error"),null;if(null==c.data.data)return console.error("Aucun r\u00e9sultat: coordinatesystems",
c),null;a.b.aCoordsys=c.data.data;a.b.usedSRID=2154;b.resolve()},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_GET_COORDSYS,"error")}});return b.promise}
function MB(a){a.K.info("nsVmap.importVexCtrl.loadVm4msPrivateConnection_");var b=a.va.defer();A({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vm4ms/layerconnections",headers:{Accept:"application/x-vm-json"},params:{filter:'{"column":"private","compare_operator":"=","value":true}'},scope:a.b,success:function(c){if(null==c.data)return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_GET_PRIVATE_CONNECTION,"error"),null;if(null==c.data.data||null==c.data.data[0])return console.error("Aucun r\u00e9sultat: coordinatesystems",
c),null;a.b.oPrivateConnection=c.data.data[0];null!=a.b.oPrivateConnection.database||(a.b.oPrivateConnection.database=a.oProperties.database);b.resolve()},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_GET_PRIVATE_CONNECTION,"error")}});return b.promise}GB.prototype.zN=function(a){this.K.info("nsVmap.importVexCtrl.setUsedSchema");a?(this.b.selectedExistingSchema="",this.b.usedSchema=this.b.createdNewSchema):(this.b.createdNewSchema="",this.b.usedSchema=this.b.selectedExistingSchema)};
GB.prototype.setUsedSchema=GB.prototype.zN;
function IB(a){a.K.info("nsVmap.importVexCtrl.isConfigStateValid");return null==a.b.usedDatabase?($.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_DATABASE_REQUIRED,"error"),!1):null==a.b.usedSchema?($.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_SCHEMA_REQUIRED,"error"),!1):null==a.b.usedSRID?($.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_COORDSYS_REQUIRED,"error"),!1):null==a.b.usedUserRole?($.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_USER_ROLE_REQUIRED,"error"),!1):null==a.b.usedAdminRole?($.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_ADMIN_ROLE_REQUIRED,
"error"),!1):!0}l=GB.prototype;l.Rq=function(){this.K.info("nsVmap.importVexCtrl.loadVMapObjects_");var a=this,b=this.va.defer();this.Ue={};null!=this.b.oVMapObjects?RB(this).then(function(c){a.Ue=c;a.pv();setTimeout(function(){b.resolve()})}):setTimeout(function(){b.reject()});return b.promise};
function RB(a){a.K.info("nsVmap.importVexCtrl.getExistingVMapObjects_");var b=a.va.defer(),c=SB(a);A({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vmap/vex/existing_vmap_objects",headers:{Accept:"application/x-vm-json"},params:c,scope:a.b,success:function(c){if(null==c.data)return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_GET_EXISTING_VMAP_OBJETS,"error"),null;if(null!=c.data&&null!=c.data.errorMessage)return angular.element(v.f).scope().modalWindow("dialog",
"Erreur serveur",{className:"modal-danger",message:c.data.errorMessage}),null;if(1!==c.data.status||null==c.data.vmap_objects)return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_GET_EXISTING_VMAP_OBJETS,"error"),null;b.resolve(c.data.vmap_objects)},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_GET_EXISTING_VMAP_OBJETS,"error");b.reject()}});return b.promise}
function SB(a){var b=!0;a.K.info("nsVmap.importVexCtrl.getVMapObjectNames_");b=null!=b?b:!1;if(null!=a.b.oVMapObjects){var c=function(b,c){var d=[];if(q(a.b.oVMapObjects[b]))for(var e=0;e<a.b.oVMapObjects[b].length;e++)a.b.oVMapObjects[b][e][c]&&d.push(a.b.oVMapObjects[b][e][c]);return d},d={};if(null!=a.b.oVMapObjects){var e=c("maps","name");0<e.length&&(d.maps=b?e.join("|"):e);e=c("services","name");0<e.length&&(d.services=b?e.join("|"):e);e=c("calques","name");0<e.length&&(d.calques=b?e.join("|"):
e);e=c("calque_themes","name");0<e.length&&(d.calque_themes=b?e.join("|"):e);e=c("vm4ms_layers","name");0<e.length&&(d.vm4ms_layers=b?e.join("|"):e);e=c("business_objects","business_object_id");0<e.length&&(d.business_objects=b?e.join("|"):e);e=c("events","event_id");0<e.length&&(d.events=b?e.join("|"):e);c=c("reports","name");0<c.length&&(d.reports=b?c.join("|"):c)}return d}}
l.pv=function(){this.K.info("nsVmap.importVexCtrl.loadVMapObjectsTreeview_");var a=this;$("#import-vex-vmap-objects-treeview").treeview({data:this.Iu(),onNodeChecked:function(b,c){a.kh("nodeChecked",c)},onNodeCollapsed:function(b,c){a.kh("nodeCollapsed",c)},onNodeExpanded:function(b,c){a.kh("nodeExpanded",c)},onNodeUnchecked:function(b,c){a.kh("nodeUnchecked",c)},expandIcon:"",collapseIcon:"",showBorder:!1,showCheckbox:!1})};
l.Iu=function(){this.K.info("nsVmap.importVexCtrl.getTreeviewDataFromVMapObjects_");var a=[];null!=this.b.oVMapObjects&&(null!=this.b.oVMapObjects.maps&&a.push(TB(this,this.b.oVMapObjects.maps)),null!=this.b.oVMapObjects.services&&a.push(UB(this,this.b.oVMapObjects.services)),null!=this.b.oVMapObjects.calques&&a.push(VB(this,this.b.oVMapObjects.calques)),null!=this.b.oVMapObjects.calque_themes&&a.push(WB(this,this.b.oVMapObjects.calque_themes)),null!=this.b.oVMapObjects.vm4ms_layers&&a.push(XB(this,
this.b.oVMapObjects.vm4ms_layers)),null!=this.b.oVMapObjects.business_objects&&a.push(YB(this,this.b.oVMapObjects.business_objects)),null!=this.b.oVMapObjects.events&&a.push(ZB(this,this.b.oVMapObjects.events)),null!=this.b.oVMapObjects.reports&&a.push($B(this,this.b.oVMapObjects.reports)));return a};
function TB(a,b){a.K.info("nsVmap.importVexCtrl.getTreeviewMaps_");var c={text:"Cartes",icon:"icon-map",selectable:!1,state:{checked:!0,expanded:!0},nodes:[]},d;if(q(b))for(var e=0;e<b.length;e++)d=aC(a,"maps","name",b[e].name),c.nodes.push({text:"Carte: "+b[e].name+(d?' (D\u00e9j\u00e0 pr\u00e9sent sur l\'application) <span class="icon-draw"></span>':""),color:d?"#337ab7":"#333",icon:"icon-map",selectable:!1,state:{checked:!0,expanded:!0},type_:"map",properties_:b[e],isExisting_:d,nodes:[]});return c}
function UB(a,b){a.K.info("nsVmap.importVexCtrl.getTreeviewServices_");var c={text:"Services",icon:"icon-link-external",selectable:!1,state:{checked:!0,expanded:!0},nodes:[]},d;if(q(b))for(var e=0;e<b.length;e++)d=aC(a,"services","name",b[e].name),c.nodes.push({text:"Service: "+b[e].name+(d?' (D\u00e9j\u00e0 pr\u00e9sent sur l\'application) <span class="icon-draw"></span>':""),color:d?"#337ab7":"#333",icon:"icon-link-external",selectable:!1,state:{checked:!0,expanded:!0},type_:"service",properties_:b[e],
isExisting_:d,nodes:[]});return c}
function VB(a,b){a.K.info("nsVmap.importVexCtrl.getTreeviewCalques_");var c={text:"Calques",icon:"icon-layers",selectable:!1,state:{checked:!0,expanded:!0},nodes:[]},d;if(q(b))for(var e=0;e<b.length;e++)d=aC(a,"calques","name",b[e].name),c.nodes.push({text:"Calque: "+b[e].name+(d?' (D\u00e9j\u00e0 pr\u00e9sent sur l\'application) <span class="icon-draw"></span>':""),color:d?"#337ab7":"#333",icon:"icon-layers",selectable:!1,state:{checked:!0,expanded:!0},type_:"calque",properties_:b[e],isExisting_:d,
nodes:[]});return c}
function WB(a,b){a.K.info("nsVmap.importVexCtrl.getTreeviewCalqueThemes_");var c={text:"Th\u00e8mes des calques",icon:"icon-layers",selectable:!1,state:{checked:!0,expanded:!0},nodes:[]},d;if(q(b))for(var e=0;e<b.length;e++)d=aC(a,"calque_themes","name",b[e].name),c.nodes.push({text:"Th\u00e8me : "+b[e].name+(d?' (D\u00e9j\u00e0 pr\u00e9sent sur l\'application) <span class="icon-draw"></span>':""),color:d?"#337ab7":"#333",icon:"icon-layers",selectable:!1,state:{checked:!0,expanded:!0},type_:"calque_theme",
properties_:b[e],isExisting_:d,nodes:[]});return c}
function XB(a,b){a.K.info("nsVmap.importVexCtrl.getTreeviewVm4msLayers_");var c={text:"Couches Mapserver",icon:"icon-layers2",selectable:!1,state:{checked:!0,expanded:!0},nodes:[]},d;if(q(b))for(var e=0;e<b.length;e++)d=aC(a,"vm4ms_layers","name",b[e].name),c.nodes.push({text:"Couche Mapserver: "+b[e].name+(d?' (D\u00e9j\u00e0 pr\u00e9sent sur l\'application) <span class="icon-draw"></span>':""),color:d?"#337ab7":"#333",icon:"icon-layers2",selectable:!1,state:{checked:!0,expanded:!0},type_:"vm4ms_layer",
properties_:b[e],isExisting_:d,nodes:[]});return c}
function YB(a,b){a.K.info("nsVmap.importVexCtrl.getTreeviewBOs_");var c={text:"Objets m\u00e9tiers",icon:"icon-vmap_business_object",selectable:!1,state:{checked:!0,expanded:!0},nodes:[]},d;if(q(b))for(var e=0;e<b.length;e++)d=aC(a,"business_objects","business_object_id",b[e].business_object_id),c.nodes.push({text:"Objet m\u00e9tier: "+b[e].business_object_id+(d?' (D\u00e9j\u00e0 pr\u00e9sent sur l\'application) <span class="icon-draw"></span>':""),color:d?"#337ab7":"#333",icon:"icon-vmap_business_object",
selectable:!1,state:{checked:!0,expanded:!0},type_:"business_object",properties_:b[e],isExisting_:d,nodes:[]});return c}
function ZB(a,b){a.K.info("nsVmap.importVexCtrl.getTreeviewEvents_");var c={text:"Ev\u00e8nements",icon:"icon-vmap_business_object",selectable:!1,state:{checked:!0,expanded:!0},nodes:[]},d;if(q(b))for(var e=0;e<b.length;e++)d=aC(a,"events","event_id",b[e].event_id),c.nodes.push({text:"Ev\u00e8nement: "+b[e].event_id+(d?' (D\u00e9j\u00e0 pr\u00e9sent sur l\'application) <span class="icon-draw"></span>':""),color:d?"#337ab7":"#333",icon:"icon-vmap_business_object",selectable:!1,state:{checked:!0,expanded:!0},
type_:"event",properties_:b[e],isExisting_:d,nodes:[]});return c}
function $B(a,b){a.K.info("nsVmap.importVexCtrl.getTreeviewReports_");var c={text:"Rapports",icon:"icon-vmap_business_object",selectable:!1,state:{checked:!0,expanded:!0},nodes:[]},d;if(q(b))for(var e=0;e<b.length;e++)d=aC(a,"reports","name",b[e].name),c.nodes.push({text:"Rapport: "+b[e].name+(d?' (D\u00e9j\u00e0 pr\u00e9sent sur l\'application) <span class="icon-draw"></span>':""),color:d?"#337ab7":"#333",icon:"icon-vmap_business_object",selectable:!1,state:{checked:!0,expanded:!0},type_:"report",
properties_:b[e],isExisting_:d,nodes:[]});return c}function aC(a,b,c,d){a.K.info("nsVmap.importVexCtrl.isVMapObjectAlreadyPresent");if(null!=a.Ue&&q(a.Ue[b]))for(var e=0;e<a.Ue[b].length;e++)if(null!=a.Ue[b][e][c]&&a.Ue[b][e][c]===d)return!0;return!1}
l.kh=function(a,b){this.K.info("nsVmap.importVexCtrl.onVMapObjectsTreeviewUpdate_");"nodeCollapsed"===a&&$("#import-vex-vmap-objects-treeview").data("treeview").expandNode(b.nodeId,{silent:!0});"nodeUnchecked"===a&&$("#import-vex-vmap-objects-treeview").data("treeview").checkNode(b.nodeId,{silent:!0});if("nodeCollapsed"===a||"nodeExpanded"===a)null!=b.type_&&null!=b.properties_?this.XA+500<Date.now()&&bC(this,b.properties_,b.type_):this.XA=Date.now()};
function bC(a,b,c){a.K.info("nsVmap.importVexCtrl.editVMapObject_");var d;switch(c){case "map":case "service":case "calque":case "calque_theme":case "vm4ms_layer":case "report":d=b.name;break;case "business_object":d=b.business_object_id;break;case "event":d=b.event_id}bootbox.prompt({title:"Modifier le nom",inputType:"text",value:d,callback:function(d){null!=d&&cC(a,b,c,d)}})}
function cC(a,b,c,d){a.K.info("nsVmap.importVexCtrl.changeVMapObjectName_");var e,f,g,h,k=!1;switch(c){case "map":e="map_id";f="name";g="maps";break;case "service":e="service_id";f="name";g="services";break;case "calque":e="layer_id";f="name";g="calques";break;case "calque_theme":e="layertheme_id";f="name";g="calque_themes";break;case "vm4ms_layer":e="ms_layer_id";f="name";g="vm4ms_layers";h="^[A-Za-z0-9_]{1,32}$";break;case "business_object":f=e="business_object_id";g="business_objects";h="^[A-Za-z0-9_]{1,32}$";
break;case "report":e="printreport_id";f="name";g="reports";break;case "event":f=e="event_id",g="events",h="^[A-Za-z0-9_]{1,32}$"}if(null!=h&&!0!==RegExp(h).test(d))$.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_EDIT_NAME_NOT_VALID,"error");else{if(null!=e&&null!=f&&null!=g&&null!=b[e]&&null!=a.b.oVMapObjects[g])for(h=0;h<a.b.oVMapObjects[g].length;h++)a.b.oVMapObjects[g][h][e]===b[e]&&(a.b.oVMapObjects[g][h][f]=d,k=!0);k&&("business_object"===c&&(dC(a,"calques","bo_id_list",b[f],d),dC(a,"reports",
"business_object_id",b[f],d),eC(a,b[f],d)),"event"===c&&dC(a,"business_objects","event_id",b[f],d),"vm4ms_layer"===c&&dC(a,"calques","layer_list",b[f],d));setTimeout(function(){a.Rq()})}}
function dC(a,b,c,d,e){a.K.info("nsVmap.importVexCtrl.changeVMapObjectNameInDependencies_");d=new RegExp("\\b"+d+"\\b");if(null!=a.b.oVMapObjects[b])for(var f=0;f<a.b.oVMapObjects[b].length;f++)r(a.b.oVMapObjects[b][f][c])&&d.test(a.b.oVMapObjects[b][f][c])&&(a.b.oVMapObjects[b][f][c]=a.b.oVMapObjects[b][f][c].replace(d,e))}
function eC(a,b,c){a.K.info("nsVmap.importVexCtrl.changeBONameFormDependencies");null!=a.b.oVMapObjects&&null!=a.b.oVMapObjects.business_objects_forms&&null!=a.b.oVMapObjects.business_objects_forms[b]&&(a.b.oVMapObjects.business_objects_forms[c]=a.b.oVMapObjects.business_objects_forms[b],delete a.b.oVMapObjects.business_objects_forms[b])}
function KB(a){a.K.info("nsVmap.importVexCtrl.loadSql_");var b=a.va.defer();a.b.codemirrorSQLModelOptions={mode:"sql"};a.b.codemirrorSQLDataOptions={};a.b.sSQLModel="";a.b.sSQLData="";null!=a.b.oSql?(null!=a.b.oSql.export_model_sql&&(-1===a.b.aSchemas.indexOf(a.b.usedSchema)&&0<a.b.usedSchema.length&&(a.b.sSQLModel+="\n--",a.b.sSQLModel+="\n-- GENERATED BY VMAP",a.b.sSQLModel+="\n-- Creation Schema",a.b.sSQLModel+="\n--",a.b.sSQLModel+="\n",a.b.sSQLModel+="\nCREATE SCHEMA [SCHEMA_NAME] AUTHORIZATION u_vitis;",
a.b.sSQLModel+="\nGRANT ALL ON SCHEMA [SCHEMA_NAME] TO u_vitis;",a.b.sSQLModel+="\n",a.b.sSQLModel+="\n"),a.b.sSQLModel=fC(a,a.b.sSQLModel+=a.b.oSql.export_model_sql)),null!=a.b.oSql.export_data_sql&&(a.b.sSQLData=fC(a,a.b.sSQLData+=a.b.oSql.export_data_sql))):setTimeout(function(){b.reject()});a.b.refreshCodeMirror();setTimeout(function(){b.resolve()});return b.promise}
function fC(a,b){a.K.info("nsVmap.importVexCtrl.getReplacedSQL_");null!=a.b.usedDatabase&&(b=b.replace(/\[DATABASE_NAME\]/g,a.b.usedDatabase));null!=a.b.usedSchema&&(b=b.replace(/\[SCHEMA_NAME\]/g,a.b.usedSchema));null!=a.b.usedSRID&&(b=b.replace(/\[SRID\]/g,a.b.usedSRID));null!=a.b.usedUserRole&&(b=b.replace(/\[ROLE_USER\]/g,a.b.usedUserRole));null!=a.b.usedAdminRole&&(b=b.replace(/\[ROLE_ADMIN\]/g,a.b.usedAdminRole));return b}
l.Tq=function(){this.K.info("nsVmap.importVexCtrl.loadWebServices_");var a=this,b=this.va.defer();null!=this.b.aWebServices?gC(this).then(function(c){a.$s=c;a.Sq();setTimeout(function(){b.resolve()})}):setTimeout(function(){b.reject()});return b.promise};
function gC(a){a.K.info("nsVmap.importVexCtrl.getExistingWebServices_");var b=a.va.defer(),c=hC(a);A({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vmap/vex/existing_web_services",headers:{Accept:"application/x-vm-json"},params:{web_services:c},scope:a.b,success:function(c){if(null==c.data)return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_GET_EXISTING_WEB_SERVICES,"error"),null;if(null!=c.data&&null!=c.data.errorMessage)return angular.element(v.f).scope().modalWindow("dialog",
"Erreur serveur",{className:"modal-danger",message:c.data.errorMessage}),null;if(1!==c.data.status||null==c.data.web_services)return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_GET_EXISTING_WEB_SERVICES,"error"),null;b.resolve(c.data.web_services)},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_GET_EXISTING_WEB_SERVICES,"error");b.reject()}});return b.promise}
function hC(a){var b=!0;a.K.info("nsVmap.importVexCtrl.getWebServicesNames_");b=null!=b?b:!1;if(null!=a.b.aWebServices){for(var c=[],d=0;d<a.b.aWebServices.length;d++)null!=a.b.aWebServices[d].name&&c.push(a.b.aWebServices[d].name);return b?c.join("|"):c}}
l.Sq=function(){this.K.info("nsVmap.importVexCtrl.loadWebServicesTreeview_");var a=this;$("#import-vex-web-services-treeview").treeview({data:this.Ju(),onNodeChecked:function(b,c){a.lh("nodeChecked",c)},onNodeCollapsed:function(b,c){a.lh("nodeCollapsed",c)},onNodeExpanded:function(b,c){a.lh("nodeExpanded",c)},onNodeUnchecked:function(b,c){a.lh("nodeUnchecked",c)},expandIcon:"",collapseIcon:"",showBorder:!1,showCheckbox:!0})};
l.Ju=function(){this.K.info("nsVmap.importVexCtrl.getTreeviewDataFromWebServices_");var a=[],b;if(q(this.b.aWebServices))for(var c=0;c<this.b.aWebServices.length;c++)b=null!=this.$s&&-1!==this.$s.indexOf(this.b.aWebServices[c].name)?!0:!1,b={text:this.b.aWebServices[c].name+(b?" (D\u00e9j\u00e0 pr\u00e9sent sur l'application)":""),color:b?"#ff0700":"#333",icon:"glyphicon glyphicon-folder-open",selectable:!1,state:{checked:!0,expanded:!0},properties_:{type:"folder",name:this.b.aWebServices[c].name},
isExisting_:b,nodes:this.Ku(this.b.aWebServices[c])},a.push(b);else console.error("aWebServices undefined");return a};l.Ku=function(a){this.K.info("nsVmap.importVexCtrl.getTreeviewFilesFromWebService_");var b=[];if(q(a.files))for(var c in a.files)a={text:c,selectable:!1,state:{checked:!0,expanded:!0},properties_:{type:"file"}},b.push(a);return b};
l.lh=function(a,b){this.K.info("nsVmap.importVexCtrl.onWebServicesTreeviewUpdate_");"nodeCollapsed"===a&&$("#import-vex-web-services-treeview").data("treeview").expandNode(b.nodeId,{silent:!0});"nodeUnchecked"===a&&$("#import-vex-web-services-treeview").data("treeview").checkNode(b.nodeId,{silent:!0})};
l.jH=function(){this.K.info("nsVmap.importVexCtrl.executeImport");var a=this;a.b.bImportDone=!1;a.b.oImportSteps.vmap_objects=null;a.b.oImportSteps.vmap_objects_maps=null;a.b.oImportSteps.vmap_objects_services=null;a.b.oImportSteps.vmap_objects_calques=null;a.b.oImportSteps.vmap_objects_calque_themes=null;a.b.oImportSteps.vmap_objects_vm4ms_layers=null;a.b.oImportSteps.vmap_objects_business_objects=null;a.b.oImportSteps.vmap_objects_events=null;a.b.oImportSteps.vmap_objects_reports=null;a.b.oImportSteps.web_services=
null;a.b.oImportSteps.sql=null;a.b.oImportSteps.sql_model=null;a.b.oImportSteps.sql_data=null;iC(this).then(function(b){null!=b&&(a.pL=b);a.b.oImportSteps.vmap_objects=!0;a.b.oImportSteps.vmap_objects_maps=!0;a.b.oImportSteps.vmap_objects_services=!0;a.b.oImportSteps.vmap_objects_calques=!0;a.b.oImportSteps.vmap_objects_calque_themes=!0;a.b.oImportSteps.vmap_objects_vm4ms_layers=!0;a.b.oImportSteps.vmap_objects_business_objects=!0;a.b.oImportSteps.vmap_objects_events=!0;a.b.oImportSteps.vmap_objects_reports=
!0;jC(a).then(function(b){null!=b&&(a.uQ=b);a.b.oImportSteps.web_services=!0;kC(a).then(function(b){null!=b&&(a.tQ=b);!0===b&&(a.b.oImportSteps.sql=!0,a.b.oImportSteps.sql_model=!0,a.b.oImportSteps.sql_data=!0);a.b.bImportDone=!0},function(){a.b.oImportSteps.sql=!1;a.b.oImportSteps.sql_model=!1;a.b.oImportSteps.sql_data=!1})},function(){a.b.oImportSteps.web_services=!1})},function(){a.b.oImportSteps.vmap_objects=!1;a.b.oImportSteps.vmap_objects_maps=!1;a.b.oImportSteps.vmap_objects_services=!1;a.b.oImportSteps.vmap_objects_calques=
!1;a.b.oImportSteps.vmap_objects_calque_themes=!1;a.b.oImportSteps.vmap_objects_vm4ms_layers=!1;a.b.oImportSteps.vmap_objects_business_objects=!1;a.b.oImportSteps.vmap_objects_events=!1;a.b.oImportSteps.vmap_objects_reports=!1})};GB.prototype.executeImport=GB.prototype.jH;
function iC(a){a.K.info("nsVmap.importVexCtrl.importVMapObjects_");var b=a.va.defer();if(null==a.b.oVMapObjects||!1===a.b.selectedSteps.vmap_objects)return setTimeout(function(){b.resolve()}),b.promise;A({method:"POST",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vmap/vex/import/vmap_objects",headers:{Accept:"application/x-vm-json"},data:{vmap_objects:JSON.stringify(a.b.oVMapObjects),database:a.b.usedDatabase,schema:a.b.usedSchema,srid:a.b.usedSRID},scope:a.b,success:function(c){if(null==
c.data)return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_IMPORT_VMAP_OBJECTS,"error"),b.reject(),null;if(null!=c.data&&null!=c.data.errorMessage)return angular.element(v.f).scope().modalWindow("dialog","Erreur serveur",{className:"modal-danger",message:c.data.errorMessage}),b.reject(),null;if(1!==c.data.status||null==c.data.vmap_objects)return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_IMPORT_VMAP_OBJECTS,"error"),b.reject(),null;b.resolve(c.data.vmap_objects)},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_IMPORT_VMAP_OBJECTS,
"error");b.reject()}});return b.promise}
function jC(a){a.K.info("nsVmap.importVexCtrl.importWebServices_");var b=a.va.defer();if(null==a.b.aWebServices||!1===a.b.selectedSteps.web_services)return setTimeout(function(){b.resolve()}),b.promise;A({method:"POST",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vmap/vex/import/web_services",headers:{Accept:"application/x-vm-json"},data:{web_services:JSON.stringify(a.b.aWebServices)},scope:a.b,success:function(c){if(null==c.data)return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_IMPORT_WEB_SERVICES,"error"),
b.reject(),null;if(null!=c.data&&null!=c.data.errorMessage)return angular.element(v.f).scope().modalWindow("dialog","Erreur serveur",{className:"modal-danger",message:c.data.errorMessage}),b.reject(),null;if(1!==c.data.status||null==c.data.web_services)return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_IMPORT_WEB_SERVICES,"error"),b.reject(),null;b.resolve(c.data.web_services)},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_IMPORT_WEB_SERVICES,"error");b.reject()}});
return b.promise}
function kC(a){a.K.info("nsVmap.importVexCtrl.importSQL_");var b=a.va.defer();if(null==a.b.sSQLModel||!1===a.b.selectedSteps.import_sql)return setTimeout(function(){b.resolve()}),b.promise;A({method:"POST",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vmap/vex/import/sql",headers:{Accept:"application/x-vm-json"},data:{sql_model:a.b.sSQLModel,sql_data:a.b.sSQLData,database:a.b.usedDatabase,schema:a.b.usedSchema,srid:a.b.usedSRID},scope:a.b,success:function(c){if(null==c.data)return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_IMPORT_SQL,
"error"),b.reject(),null;if(null!=c.data&&null!=c.data.errorMessage)return angular.element(v.f).scope().modalWindow("dialog","Erreur serveur",{className:"modal-danger",message:c.data.errorMessage}),b.reject(),null;if(1!==c.data.status||null==c.data.sql)return $.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_IMPORT_SQL,"error"),b.reject(),null;b.resolve(c.data.sql)},error:function(){$.notify(a.oTranslations.CTRL_IMPORT_VEX_ERROR_REQUEST_IMPORT_SQL,"error");b.reject()}});return b.promise}
B.module.controller("AppImportVexController",GB);function lC(){return{restrict:"A",controller:"AppExportVexController",controllerAs:"ctrl",bindToController:!0,templateUrl:window.oClientProperties.vmap_folder+"/template/vitis/exportVex.html",link:function(){}}}qa("nsVmap.exportVexDrtv",lC);B.module.directive("appExportVex",lC);function mC(a,b,c,d){b.info("nsVmap.exportVexCtrl");this.K=b;this.b=a;this.va=c;this.gk=d;this.tv=angular.element(v.f).scope();this.oProperties=angular.element(v.f).injector().get(["propertiesSrvc"]);this.sToken=sessionStorage.session_token;this.oTranslations={};a.displayedStep="";a.steps=["select_vmap_objects","select_web_services","select_sql_objects","execute_export"];a.bExportOk=!1;a.oVmapObjects={maps:[],calques:[],vm4ms_layers:[],business_objects:[]};a.oSelectedVmapObjects={maps:[],calques:[],
vm4ms_layers:[],business_objects:[]};a.aWebServices=[];a.aSelectedWebServices=[];a.aAvaliableDatabases=[];a.sSelectedDatabase=null;a.aSQLObjects=null;a.aSelectedSQLObjects=[];this.av();this.Yg("select_vmap_objects")}qa("nsVmap.exportVexCtrl",mC);mC.$inject=["$scope","$log","$q","$translate"];
mC.prototype.Ew=function(a){this.K.info("nsVmap.exportVexCtrl.submitStep");var b=this;switch(a){case "select_vmap_objects":nC(this).then(function(){b.rc()});break;case "select_web_services":oC(this).then(function(){b.rc()});break;case "select_sql_objects":pC(this).then(function(){b.rc()});break;default:this.rc()}};mC.prototype.submitStep=mC.prototype.Ew;
mC.prototype.rc=function(){this.K.info("nsVmap.exportVexCtrl.nextStep");var a=angular.copy(this.b.displayedStep),a=this.b.steps.indexOf(a);if(-1!==a)if(null!=this.b.steps[a+1])a=this.b.steps[a+1];else return console.error("next step doesn't exists"),null;else return console.error("this step doesn't exists"),null;this.Yg(a)};mC.prototype.nextStep=mC.prototype.rc;
mC.prototype.ph=function(){this.K.info("nsVmap.exportVexCtrl.prevStep");var a=angular.copy(this.b.displayedStep),a=this.b.steps.indexOf(a);if(-1!==a)if(null!=this.b.steps[a-1])a=this.b.steps[a-1];else return console.error("previous step doesn't exists"),null;else return console.error("this step doesn't exists"),null;this.Yg(a)};mC.prototype.prevStep=mC.prototype.ph;
mC.prototype.Yg=function(a){this.K.info("nsVmap.exportVexCtrl.goStep");var b=this,c=b.b.steps.indexOf(b.b.displayedStep),d=b.b.steps.indexOf(a);if(!(c>d))switch(a){case "select_vmap_objects":this.Rq().then(function(){b.b.displayedStep=a;b.pv()});break;case "select_web_services":this.Tq().then(function(){b.b.displayedStep=a;b.Sq()},function(){if(-1!==c&&-1!==d){b.b.displayedStep=a;if(c<d)return b.rc(),!0;if(c>d)return b.ph(),!0}});break;case "select_sql_objects":qC(this).then(function(){b.b.displayedStep=
a});break;default:this.b.displayedStep=a}if(c>d)switch(a){case "select_web_services":this.Tq().then(function(){b.b.displayedStep=a;b.Sq()},function(){if(-1!==c&&-1!==d){b.b.displayedStep=a;if(c<d)return b.rc(),!0;if(c>d)return b.ph(),!0}});break;default:this.b.displayedStep=a}};mC.prototype.goStep=mC.prototype.Yg;mC.prototype.cG=function(){this.K.info("nsVmap.exportVexCtrl.closeExportModal");$(".bootbox.modal").each(function(){$(this).modal("hide")});this.tv.setMode("development")};
mC.prototype.closeExportModal=mC.prototype.cG;l=mC.prototype;
l.av=function(){for(var a=this,b=[],c=0;c<this.b.steps.length;c++)b.push("CTRL_EXPORT_VEX_STEP_"+this.b.steps[c]);b.push("CTRL_EXPORT_VEX_ERROR_REQUEST_GET_VMAP_OBJETS");b.push("CTRL_EXPORT_VEX_ERROR_REQUEST_GET_WEB_SERVICES");b.push("CTRL_EXPORT_VEX_NO_RESULT_REQUEST_GET_WEB_SERVICES");b.push("CTRL_EXPORT_VEX_ERROR_REQUEST_GET_SQL_DATABASES");b.push("CTRL_EXPORT_VEX_ERROR_REQUEST_GET_SQL_OBJECTS");b.push("CTRL_EXPORT_VEX_ERROR_REQUEST_EXPORT_VEX");b.push("CTRL_EXPORT_VEX_SELECT_DB");this.gk(b).then(function(b){a.oTranslations=
b})};
l.Rq=function(){this.K.info("nsVmap.exportVexCtrl.loadVMapObjects_");var a=this,b=this.va.defer();rC(this).then(function(c){for(var d=[],e=[],f=[],g=[],h=0;h<c.length;h++)if("map"===c[h].type&&(d.push({type:"map",map_id:c[h].map_id,name:c[h].name,properties_:c[h]}),q(c[h].calques)))for(var k=0;k<c[h].calques.length;k++){"calque"===c[h].calques[k].type&&e.push({type:"calque",map_id:c[h].map_id,layer_id:c[h].calques[k].layer_id,name:c[h].calques[k].name,properties_:c[h].calques[k]});if(q(c[h].calques[k].business_objects))for(var m=0;m<
c[h].calques[k].business_objects.length;m++)"business_object"===c[h].calques[k].business_objects[m].type&&f.push({type:"business_object",map_id:c[h].map_id,layer_id:c[h].calques[k].layer_id,business_object_id:c[h].calques[k].business_objects[m].name,properties_:c[h].calques[k].business_objects[m]});if(q(c[h].calques[k].vm4ms_layers))for(m=0;m<c[h].calques[k].vm4ms_layers.length;m++)"vm4ms_layer"===c[h].calques[k].vm4ms_layers[m].type&&g.push({type:"vm4ms_layer",map_id:c[h].map_id,layer_id:c[h].calques[k].layer_id,
name:c[h].calques[k].vm4ms_layers[m].name,properties_:c[h].calques[k].vm4ms_layers[m]})}a.b.oVmapObjects.maps=d;a.b.oVmapObjects.calques=e;a.b.oVmapObjects.business_objects=f;a.b.oVmapObjects.vm4ms_layers=g;b.resolve()});return b.promise};
function rC(a){a.K.info("nsVmap.exportVexCtrl.getVMapObjects_");var b=a.va.defer();A({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vmap/vex/vmap_objects",headers:{Accept:"application/json"},scope:a.b,success:function(c){if(null==c.data)return $.notify(a.oTranslations.CTRL_EXPORT_VEX_ERROR_REQUEST_GET_VMAP_OBJETS,"error"),b.reject(),null;if(null!=c.data&&null!=c.data.errorMessage)return angular.element(v.f).scope().modalWindow("dialog","Erreur serveur",{className:"modal-danger",
message:c.data.errorMessage}),null;if(1!==c.data.status||null==c.data.vmap_objects||null==c.data.vmap_objects[0])return $.notify(a.oTranslations.CTRL_EXPORT_VEX_ERROR_REQUEST_GET_VMAP_OBJETS,"error"),b.reject(),null;b.resolve(c.data.vmap_objects)},error:function(){$.notify(a.oTranslations.CTRL_EXPORT_VEX_ERROR_REQUEST_GET_VMAP_OBJETS,"error");b.reject()}});return b.promise}
l.pv=function(){this.K.info("nsVmap.exportVexCtrl.loadVMapObjectsTreeview_");var a=this;$("#export-vex-vmap-objects-treeview").treeview({data:this.Iu(),onNodeChecked:function(b,c){a.kh("nodeChecked",c)},onNodeCollapsed:function(b,c){a.kh("nodeCollapsed",c)},onNodeExpanded:function(b,c){a.kh("nodeExpanded",c)},onNodeUnchecked:function(b,c){a.kh("nodeUnchecked",c)},expandIcon:"",collapseIcon:"",showBorder:!1,showCheckbox:!0})};
l.Iu=function(){this.K.info("nsVmap.exportVexCtrl.getTreeviewDataFromVMapObjects_");var a=[],b;if(q(this.b.oVmapObjects.maps))for(var c=0;c<this.b.oVmapObjects.maps.length;c++){b="Carte: "+this.b.oVmapObjects.maps[c].name;var d=this.b.oVmapObjects.maps[c],e=this.b.oVmapObjects.maps[c];this.K.info("nsVmap.exportVexCtrl.getTreeviewCalqueFromMap_");for(var f=[],g,h=0;h<this.b.oVmapObjects.calques.length;h++)if(this.b.oVmapObjects.calques[h].map_id===e.map_id){g=this.b.oVmapObjects.calques[h];this.K.info("nsVmap.exportVexCtrl.getTreeviewVm4msLayersFromCalque_");
for(var k=[],m,p=0;p<this.b.oVmapObjects.vm4ms_layers.length;p++)this.b.oVmapObjects.vm4ms_layers[p].layer_id===g.layer_id&&this.b.oVmapObjects.vm4ms_layers[p].map_id===g.map_id&&(m={text:"Couche Mapserver: "+this.b.oVmapObjects.vm4ms_layers[p].name,icon:"icon-layers",selectable:!1,state:{checked:!1,expanded:!1},nodes:[],properties_:this.b.oVmapObjects.vm4ms_layers[p]},q(k)||(k=[]),k.push(m));g=k;k=this.b.oVmapObjects.calques[h];this.K.info("nsVmap.exportVexCtrl.getTreeviewBOsFromCalque_");m=[];for(var t=
0;t<this.b.oVmapObjects.business_objects.length;t++)this.b.oVmapObjects.business_objects[t].layer_id===k.layer_id&&this.b.oVmapObjects.business_objects[t].map_id===k.map_id&&(p={text:"Objet m\u00e9tier: "+this.b.oVmapObjects.business_objects[t].business_object_id,icon:"icon-vmap_business_object",selectable:!1,state:{checked:!1,expanded:!1},nodes:[],properties_:this.b.oVmapObjects.business_objects[t]},q(m)||(m=[]),m.push(p));g={text:"Calque: "+this.b.oVmapObjects.calques[h].name,icon:"icon-layers2",
selectable:!1,state:{checked:!1,expanded:!1},properties_:this.b.oVmapObjects.calques[h],nodes:Va(g,m)};q(f)||(f=[]);f.push(g)}b={text:b,icon:"icon-map",selectable:!1,state:{checked:!1,expanded:!1},properties_:d,nodes:f};a.push(b)}else console.error("oVmapObjects.maps undefined");return a};
l.kh=function(a,b){this.K.info("nsVmap.exportVexCtrl.onVMapObjectsTreeviewUpdate_");if("nodeCollapsed"===a||"nodeExpanded"===a){for(var c=$("#export-vex-vmap-objects-treeview").data("treeview").getExpanded(),d=0;d<c.length;d++)!1===c[d].state.checked&&$("#export-vex-vmap-objects-treeview").data("treeview").checkNode(c[d]);c=$("#export-vex-vmap-objects-treeview").data("treeview").getCollapsed();for(d=0;d<c.length;d++)!0===c[d].state.checked&&$("#export-vex-vmap-objects-treeview").data("treeview").uncheckNode(c[d])}if("nodeChecked"===
a||"nodeUnchecked"===a){c=$("#export-vex-vmap-objects-treeview").data("treeview").getChecked();for(d=0;d<c.length;d++)!1===c[d].state.expanded&&$("#export-vex-vmap-objects-treeview").data("treeview").expandNode(c[d]);c=$("#export-vex-vmap-objects-treeview").data("treeview").getUnchecked();for(d=0;d<c.length;d++)!0===c[d].state.expanded&&$("#export-vex-vmap-objects-treeview").data("treeview").collapseNode(c[d])}if("nodeExpanded"===a&&q(b.nodes))for(d=0;d<b.nodes.length;d++)!1===b.nodes[d].state.expanded&&
$("#export-vex-vmap-objects-treeview").data("treeview").expandNode(b.nodes[d].nodeId)};
function sC(a){a.K.info("nsVmap.exportVexCtrl.updateSelectedVMapObjectsFromTreeviewData_");Pa(a.b.oSelectedVmapObjects.maps);Pa(a.b.oSelectedVmapObjects.calques);Pa(a.b.oSelectedVmapObjects.vm4ms_layers);Pa(a.b.oSelectedVmapObjects.business_objects);for(var b=$("#export-vex-vmap-objects-treeview").data("treeview").getChecked(),c=0;c<b.length;c++)"map"===b[c].properties_.type&&(a.b.oSelectedVmapObjects.maps.push(b[c].properties_.map_id),Za(a.b.oSelectedVmapObjects.maps)),"calque"===b[c].properties_.type&&
(a.b.oSelectedVmapObjects.calques.push(b[c].properties_.layer_id),Za(a.b.oSelectedVmapObjects.calques)),"vm4ms_layer"===b[c].properties_.type&&(a.b.oSelectedVmapObjects.vm4ms_layers.push(b[c].properties_.name),Za(a.b.oSelectedVmapObjects.vm4ms_layers)),"business_object"===b[c].properties_.type&&(a.b.oSelectedVmapObjects.business_objects.push(b[c].properties_.business_object_id),Za(a.b.oSelectedVmapObjects.business_objects))}
function nC(a){a.K.info("nsVmap.exportVexCtrl.validateSelectedVMapObjects_");var b=a.va.defer();sC(a);console.log("this.$scope_['oSelectedVmapObjects']: ",a.b.oSelectedVmapObjects);setTimeout(function(){q(a.b.oSelectedVmapObjects.maps)&&q(a.b.oSelectedVmapObjects.calques)&&q(a.b.oSelectedVmapObjects.vm4ms_layers)&&q(a.b.oSelectedVmapObjects.business_objects)&&b.resolve()});return b.promise}
l.Tq=function(){this.K.info("nsVmap.exportVexCtrl.loadWebServices_");var a=this,b=this.va.defer();tC(this,this.b.oSelectedVmapObjects.business_objects).then(function(c){a.b.aWebServices=c;b.resolve()},function(){b.reject()});return b.promise};
function tC(a,b){a.K.info("nsVmap.exportVexCtrl.getBoWebServices_");var c=a.va.defer();setTimeout(function(){if(!q(b)||0< !b.length)return c.reject(),0;A({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vmap/vex/web_services",headers:{Accept:"application/json"},params:{business_objects:b.join("|")},scope:a.b,success:function(b){if(null==b.data)return $.notify(a.oTranslations.CTRL_EXPORT_VEX_ERROR_REQUEST_GET_WEB_SERVICES,"error"),c.reject(),null;if(null!=b.data&&
null!=b.data.errorMessage)return angular.element(v.f).scope().modalWindow("dialog","Erreur serveur",{className:"modal-danger",message:b.data.errorMessage}),c.reject(),null;if(1!==b.data.status||null==b.data.web_services)return $.notify(a.oTranslations.CTRL_EXPORT_VEX_ERROR_REQUEST_GET_WEB_SERVICES,"error"),c.reject(),null;if(null==b.data.web_services[0])return $.notify(a.oTranslations.CTRL_EXPORT_VEX_NO_RESULT_REQUEST_GET_WEB_SERVICES,"success"),c.reject(),null;c.resolve(b.data.web_services)},error:function(){$.notify(a.oTranslations.CTRL_EXPORT_VEX_ERROR_REQUEST_GET_WEB_SERVICES,
"error");c.reject()}})});return c.promise}l.Sq=function(){this.K.info("nsVmap.exportVexCtrl.loadWebServicesTreeview_");var a=this;$("#export-vex-web-services-treeview").treeview({data:this.Ju(),onNodeChecked:function(b,c){a.lh("nodeChecked",c)},onNodeCollapsed:function(b,c){a.lh("nodeCollapsed",c)},onNodeExpanded:function(b,c){a.lh("nodeExpanded",c)},onNodeUnchecked:function(b,c){a.lh("nodeUnchecked",c)},expandIcon:"",collapseIcon:"",showBorder:!1,showCheckbox:!0})};
l.Ju=function(){this.K.info("nsVmap.exportVexCtrl.getTreeviewDataFromWebServices_");var a=[],b;if(q(this.b.aWebServices))for(var c=0;c<this.b.aWebServices.length;c++)b={text:this.b.aWebServices[c].name,icon:"glyphicon glyphicon-folder-open",selectable:!1,state:{checked:!1,expanded:!1},properties_:{type:"folder",name:this.b.aWebServices[c].name},nodes:this.Ku(this.b.aWebServices[c])},a.push(b);else console.error("aWebServices undefined");return a};
l.Ku=function(a){this.K.info("nsVmap.exportVexCtrl.getTreeviewFilesFromWebService_");var b=[],c;if(q(a.files))for(var d=0;d<a.files.length;d++)c={text:a.files[d],selectable:!1,properties_:{type:"file"}},b.push(c);return b};
l.lh=function(a,b){this.K.info("nsVmap.exportVexCtrl.onWebServicesTreeviewUpdate_");if("file"===b.properties_.type)return"nodeUnchecked"===a&&$("#export-vex-web-services-treeview").data("treeview").checkNode(b.nodeId,{silent:!0}),0;"folder"===b.properties_.type&&("nodeChecked"===a&&$("#export-vex-web-services-treeview").data("treeview").expandNode(b.nodeId),"nodeUnchecked"===a&&$("#export-vex-web-services-treeview").data("treeview").collapseNode(b.nodeId));var c=$("#export-vex-web-services-treeview").data("treeview").getExpanded();
for(a=0;a<c.length;a++)if("folder"===c[a].properties_.type&&(!1===c[a].state.checked&&$("#export-vex-web-services-treeview").data("treeview").checkNode(c[a]),q(c[a].nodes)))for(b=0;b<c[a].nodes.length;b++)!1===c[a].nodes[b].state.checked&&$("#export-vex-web-services-treeview").data("treeview").checkNode(c[a].nodes[b].nodeId,{silent:!0});c=$("#export-vex-web-services-treeview").data("treeview").getCollapsed();for(a=0;a<c.length;a++)if("folder"===c[a].properties_.type&&(!0===c[a].state.checked&&$("#export-vex-web-services-treeview").data("treeview").uncheckNode(c[a]),
q(c[a].nodes)))for(b=0;b<c[a].nodes.length;b++)!0===c[a].nodes[b].state.checked&&$("#export-vex-web-services-treeview").data("treeview").uncheckNode(c[a].nodes[b].nodeId,{silent:!0})};
function uC(a){a.K.info("nsVmap.exportVexCtrl.updateSelectedWebServicesFromTreeviewData_");Pa(a.b.aSelectedWebServices);for(var b=$("#export-vex-web-services-treeview").data("treeview").getChecked(),c=0;c<b.length;c++)null!=b[c].properties_&&null!=b[c].properties_.type&&"folder"===b[c].properties_.type&&a.b.aSelectedWebServices.push(b[c].properties_.name)}
function oC(a){a.K.info("nsVmap.exportVexCtrl.validateSelectedWebServices_");var b=a.va.defer();uC(a);setTimeout(function(){console.log("this.$scope_['aSelectedWebServices']: ",a.b.aSelectedWebServices);b.resolve()});return b.promise}
function qC(a){a.K.info("nsVmap.exportVexCtrl.loadSQLObjects_");var b=a.va.defer();null!=a.Ll&&a.Ll();a.b.sSelectedDatabase=null;Pa(a.b.aAvaliableDatabases);null!=$("#export-vex-sql-objects-treeview").treeview&&$("#export-vex-sql-objects-treeview").treeview("remove");vC(a).then(function(c){for(var d=0;d<c.length;d++)a.b.aAvaliableDatabases.push(c[d].database);a.Ll=a.b.$watch("sSelectedDatabase",function(){null!=a.b.sSelectedDatabase&&wC(a,a.b.sSelectedDatabase).then(function(b){a.b.aSQLObjects=b;
a.K.info("nsVmap.exportVexCtrl.checkLayersDatabase_");b=a.b.sSelectedDatabase;var c=a.b.oVmapObjects.vm4ms_layers,d=a.b.oSelectedVmapObjects.vm4ms_layers;if(q(c)&&q(d))for(var e=0;e<c.length;e++)-1!==d.indexOf(c[e].name)&&null!=c[e].properties_&&c[e].properties_.database!==b&&$.notify("La couche "+c[e].name+" utilise une autre base de donn\u00e9es");a.K.info("nsVmap.exportVexCtrl.checkBOsDatabase_");b=a.b.sSelectedDatabase;c=a.b.oVmapObjects.business_objects;d=a.b.oSelectedVmapObjects.business_objects;
if(q(c)&&q(d))for(e=0;e<c.length;e++)-1!==d.indexOf(c[e].business_object_id)&&null!=c[e].properties_&&c[e].properties_.database!==b&&$.notify("L'objet m\u00e9tier "+c[e].business_object_id+" utilise une autre base de donn\u00e9es");xC(a)})});c=yC(a);null!=c&&(a.b.sSelectedDatabase=c);b.resolve()});return b.promise}
function vC(a){a.K.info("nsVmap.exportVexCtrl.geAvaliableDatabases_");var b=a.va.defer();A({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vitis/genericquerys/databases",headers:{Accept:"application/json"},scope:a.b,success:function(c){if(null==c.data)return $.notify(a.oTranslations.CTRL_EXPORT_VEX_ERROR_REQUEST_GET_SQL_DATABASES,"error"),b.reject(),null;if(null!=c.data&&null!=c.data.errorMessage)return angular.element(v.f).scope().modalWindow("dialog","Erreur serveur",
{className:"modal-danger",message:c.data.errorMessage}),b.reject(),null;if(null==c.data.genericquerys)return $.notify(a.oTranslations.CTRL_EXPORT_VEX_ERROR_REQUEST_GET_SQL_DATABASES,"error"),b.reject(),null;if(null==c.data.genericquerys[0])return $.notify(a.oTranslations.CTRL_EXPORT_VEX_ERROR_REQUEST_GET_SQL_DATABASES,"error"),console.error("error"),null;b.resolve(c.data.genericquerys)},error:function(){$.notify(a.oTranslations.CTRL_EXPORT_VEX_ERROR_REQUEST_GET_SQL_DATABASES,"error");b.reject()}});
return b.promise}
function wC(a,b){a.K.info("nsVmap.exportVexCtrl.getSQLObjects_");var c=a.va.defer();A({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vmap/vex/sql_objects",headers:{Accept:"application/json"},params:{database:b},scope:a.b,success:function(b){if(null==b.data)return $.notify(a.oTranslations.CTRL_EXPORT_VEX_ERROR_REQUEST_GET_SQL_OBJECTS,"error"),c.reject(),null;if(null!=b.data&&null!=b.data.errorMessage)return angular.element(v.f).scope().modalWindow("dialog","Erreur serveur",
{className:"modal-danger",message:b.data.errorMessage}),c.reject(),null;if(1!==b.data.status||null==b.data.sql_objects||null==b.data.sql_objects[0])return $.notify(a.oTranslations.CTRL_EXPORT_VEX_ERROR_REQUEST_GET_SQL_OBJECTS,"error"),c.reject(),null;c.resolve(b.data.sql_objects)},error:function(){$.notify(a.oTranslations.CTRL_EXPORT_VEX_ERROR_REQUEST_GET_SQL_OBJECTS,"error");c.reject()}});return c.promise}
function xC(a){a.K.info("nsVmap.exportVexCtrl.loadSQLObjectsTreeview_");$("#export-vex-sql-objects-treeview").treeview({data:zC(a),onNodeChecked:function(b,c){AC(a,"nodeChecked",c)},onNodeCollapsed:function(b,c){AC(a,"nodeCollapsed",c)},onNodeExpanded:function(b,c){AC(a,"nodeExpanded",c)},onNodeUnchecked:function(b,c){AC(a,"nodeUnchecked",c)},expandIcon:"",collapseIcon:"",showBorder:!1,showCheckbox:!0})}
function zC(a){a.K.info("nsVmap.exportVexCtrl.getTreeviewDataFromSQLObjects_");var b=[],c;if(q(a.b.aSQLObjects))for(var d=0;d<a.b.aSQLObjects.length;d++){c=a.b.aSQLObjects[d].name;var e={type:"schema",name:a.b.aSQLObjects[d].name},f=a.b.aSQLObjects[d];a.K.info("nsVmap.exportVexCtrl.getTreeviewTablesFromSchema_");var g=[],h;if(q(f.tables))for(var k=0;k<f.tables.length;k++)h={text:f.tables[k],icon:"icon-table",selectable:!1,state:{checked:!1,expanded:!1},nodes:[{text:"Mod\u00e8le",icon:"icon-code",
selectable:!1,state:{checked:!0,expanded:!1},nodes:[],properties_:{type:"model"}},{text:"Donn\u00e9es",icon:"icon-format_list_bulleted",selectable:!1,state:{checked:!1,expanded:!1},nodes:[],properties_:{type:"data"}}],properties_:{type:"table",name:f.tables[k]}},g.push(h);f=g;g=a.b.aSQLObjects[d];a.K.info("nsVmap.exportVexCtrl.getTreeviewViewsFromSchema_");h=[];if(q(g.views))for(var m=0;m<g.views.length;m++)k={text:"Vue: "+g.views[m],icon:"icon-code",selectable:!1,state:{checked:!1,expanded:!1},nodes:[],
properties_:{type:"view",name:g.views[m]}},h.push(k);g=h;h=a.b.aSQLObjects[d];a.K.info("nsVmap.exportVexCtrl.getTreeviewSequencesFromSchema_");k=[];if(q(h.sequences))for(var p=0;p<h.sequences.length;p++)m={text:"S\u00e9quence: "+h.sequences[p],icon:"icon-code",selectable:!1,state:{checked:!1,expanded:!1},nodes:[],properties_:{type:"sequence",name:h.sequences[p]}},k.push(m);c={text:c,icon:"icon-tree",selectable:!1,state:{checked:!1,expanded:!1},properties_:e,nodes:Ua(f,g,k)};b.push(c)}else console.error("aSQLObjects undefined");
a.K.info("nsVmap.exportVexCtrl.autoSelectVm4msLayersTables_");f=a.b.sSelectedDatabase;g=a.b.oVmapObjects.vm4ms_layers;h=a.b.oSelectedVmapObjects.vm4ms_layers;d=[];c=[];if(q(g)&&q(h))for(e=0;e<g.length;e++)-1!==h.indexOf(g[e].name)&&null!=g[e].properties_&&g[e].properties_.database===f&&(-1===d.indexOf(g[e].properties_.schema)&&d.push(g[e].properties_.schema),-1===c.indexOf(g[e].properties_.table)&&c.push(g[e].properties_.table));for(e=0;e<b.length;e++)if(null!=b[e].properties_&&"schema"===b[e].properties_.type&&
-1!==d.indexOf(b[e].properties_.name)&&(b[e].state.checked=!0,b[e].state.expanded=!0,q(b[e].nodes)))for(f=0;f<b[e].nodes.length;f++)null==b[e].nodes[f].properties_||"table"!==b[e].nodes[f].properties_.type&&"view"!==b[e].nodes[f].properties_.type||-1===c.indexOf(b[e].nodes[f].properties_.name)||(b[e].nodes[f].state.checked=!0,b[e].nodes[f].state.expanded=!0);a.K.info("nsVmap.exportVexCtrl.autoSelectBusinessObjectsTables_");d=a.b.sSelectedDatabase;c=a.b.oVmapObjects.business_objects;g=a.b.oSelectedVmapObjects.business_objects;
a=[];e=[];if(q(c)&&q(g))for(f=0;f<c.length;f++)-1!==g.indexOf(c[f].business_object_id)&&null!=c[f].properties_&&c[f].properties_.database===d&&(-1===a.indexOf(c[f].properties_.schema)&&a.push(c[f].properties_.schema),-1===e.indexOf(c[f].properties_.table)&&e.push(c[f].properties_.table));for(f=0;f<b.length;f++)if(null!=b[f].properties_&&"schema"===b[f].properties_.type&&-1!==a.indexOf(b[f].properties_.name)&&(b[f].state.checked=!0,b[f].state.expanded=!0,q(b[f].nodes)))for(d=0;d<b[f].nodes.length;d++)null==
b[f].nodes[d].properties_||"table"!==b[f].nodes[d].properties_.type&&"view"!==b[f].nodes[d].properties_.type||-1===e.indexOf(b[f].nodes[d].properties_.name)||(b[f].nodes[d].state.checked=!0,b[f].nodes[d].state.expanded=!0);return b}
function yC(a){a.K.info("nsVmap.exportVexCtrl.findDefaultDatabase_");var b=null,c=a.b.oVmapObjects.business_objects,d=a.b.oSelectedVmapObjects.business_objects,e=a.b.oVmapObjects.vm4ms_layers;a=a.b.oSelectedVmapObjects.vm4ms_layers;if(q(e)&&q(a))for(var f=0;f<e.length;f++)if(-1!==a.indexOf(e[f].name)&&null!=e[f].properties_)if(null==b)b=e[f].properties_.database;else if(e[f].properties_.database!==b)return null;if(q(c)&&q(d))for(f=0;f<c.length;f++)if(-1!==d.indexOf(c[f].business_object_id)&&null!=
c[f].properties_)if(null==b)b=c[f].properties_.database;else if(c[f].properties_.database!==b)return null;return b}
function AC(a,b,c){a.K.info("nsVmap.exportVexCtrl.onSQLObjcetsTreeviewUpdate_");if("nodeExpanded"===b&&"schema"===c.properties_.type)!1===c.state.checked&&$("#export-vex-sql-objects-treeview").data("treeview").checkNode(c.nodeId,{silent:!0});else if("nodeCollapsed"===b&&"schema"===c.properties_.type){if(!0===c.state.checked&&$("#export-vex-sql-objects-treeview").data("treeview").uncheckNode(c.nodeId,{silent:!0}),q(c.nodes))for(a=0;a<c.nodes.length;a++)!0===c.nodes[a].state.checked&&$("#export-vex-sql-objects-treeview").data("treeview").uncheckNode(c.nodes[a].nodeId,
{silent:!0})}else"nodeChecked"!==b||"schema"!==c.properties_.type&&"table"!==c.properties_.type?"nodeUnchecked"===b&&"table"===c.properties_.type?!0===c.state.expanded&&$("#export-vex-sql-objects-treeview").data("treeview").collapseNode(c.nodeId,{silent:!0}):"nodeUnchecked"===b&&"schema"===c.properties_.type?!0===c.state.expanded&&$("#export-vex-sql-objects-treeview").data("treeview").collapseNode(c.nodeId):"nodeUnchecked"!==b&&"nodeCollapsed"!==b||"model"!==c.properties_.type?"nodeExpanded"!==b||
"table"!==c.properties_.type&&"sequence"!==c.properties_.type&&"model"!==c.properties_.type&&"data"!==c.properties_.type?"nodeCollapsed"!==b||"table"!==c.properties_.type&&"sequence"!==c.properties_.type&&"data"!==c.properties_.type||!0!==c.state.checked||$("#export-vex-sql-objects-treeview").data("treeview").uncheckNode(c.nodeId,{silent:!0}):!1===c.state.checked&&$("#export-vex-sql-objects-treeview").data("treeview").checkNode(c.nodeId,{silent:!0}):(!1===c.state.expanded&&$("#export-vex-sql-objects-treeview").data("treeview").expandNode(c.nodeId,
{silent:!0}),!1===c.state.checked&&$("#export-vex-sql-objects-treeview").data("treeview").checkNode(c.nodeId,{silent:!0})):!1===c.state.expanded&&$("#export-vex-sql-objects-treeview").data("treeview").expandNode(c.nodeId,{silent:!0})}
function BC(a){a.K.info("nsVmap.exportVexCtrl.updateSelectedSQLObjectsFromTreeviewData_");Pa(a.b.aSelectedSQLObjects);if(null!=$("#export-vex-sql-objects-treeview").data("treeview"))for(var b=$("#export-vex-sql-objects-treeview").data("treeview").getChecked(),c,d=0;d<b.length;d++)if(null!=b[d].properties_&&null!=b[d].properties_.type&&"schema"===b[d].properties_.type){c=a;var e=b[d];c.K.info("nsVmap.exportVexCtrl.getSchemaFromTreeViewData_");var f=[],g=[],h=[],k=void 0,m;if(q(e.nodes))for(var p=0;p<
e.nodes.length;p++)if(null!=e.nodes[p].state&&!0===e.nodes[p].state.checked){if("table"===e.nodes[p].properties_.type){m=e.nodes[p];c.K.info("nsVmap.exportVexCtrl.getTableFromTreeViewData_");var t=void 0,u=!1,w=!1;if(q(m.nodes))for(var x=0;x<m.nodes.length;x++)null!=m.nodes[x].properties_&&("model"===m.nodes[x].properties_.type&&!0===m.nodes[x].state.checked&&(u=!0),"data"===m.nodes[x].properties_.type&&!0===m.nodes[x].state.checked&&(w=!0));u&&(t={type:"table",name:m.properties_.name,model:u,data:w});
m=t;null!=m&&f.push(m)}"view"===e.nodes[p].properties_.type&&(m=e.nodes[p],c.K.info("nsVmap.exportVexCtrl.getViewFromTreeViewData_"),m={type:"view",name:m.properties_.name},null!=m&&g.push(m));"sequence"===e.nodes[p].properties_.type&&(m=e.nodes[p],c.K.info("nsVmap.exportVexCtrl.getSequenceFromTreeViewData_"),m={type:"sequence",name:m.properties_.name},null!=m&&h.push(m))}0<f.length&&(k={type:"schema",name:e.properties_.name,tables:angular.copy(f),views:angular.copy(g),sequences:angular.copy(h)});
c=k;null!=c&&a.b.aSelectedSQLObjects.push(c)}}function pC(a){a.K.info("nsVmap.exportVexCtrl.validateSelectedSQLObjects_");var b=a.va.defer();BC(a);setTimeout(function(){console.log("this.$scope_['aSelectedSQLObjects']: ",a.b.aSelectedSQLObjects);b.resolve()});return b.promise}
l.iH=function(){this.K.info("nsVmap.exportVexCtrl.executeExport");var a=this,b=this.va.defer(),c={};null!=this.b.oSelectedVmapObjects&&(c.vmap_objects=JSON.stringify(this.b.oSelectedVmapObjects));null!=this.b.aSelectedWebServices&&(c.web_services=this.b.aSelectedWebServices);null!=this.b.sSelectedDatabase&&null!=this.b.aSelectedSQLObjects&&(c.sql_objects=JSON.stringify({type:"database",name:this.b.sSelectedDatabase,schemas:this.b.aSelectedSQLObjects}));A({method:"POST",url:this.oProperties.web_server_name+
"/"+this.oProperties.services_alias+"/vmap/vex/export_vex",headers:{Accept:"application/json"},data:c,scope:this.b,responseType:"blob",success:function(c){if(null==c.data||null==c.data.size||0< !c.data.size)return $.notify(a.oTranslations.CTRL_EXPORT_VEX_ERROR_REQUEST_EXPORT_VEX,"error"),b.reject(),null;if(null!=c.data&&null!=c.data.errorMessage)return angular.element(v.f).scope().modalWindow("dialog","Erreur serveur",{className:"modal-danger",message:c.data.errorMessage}),b.reject(),null;window.navigator.msSaveOrOpenBlob?
window.navigator.msSaveOrOpenBlob(c.data,"vmap_export.vex"):B.gj(c.data,"vmap_export.vex");a.b.bExportOk=!0},error:function(){$.notify(a.oTranslations.CTRL_EXPORT_VEX_ERROR_REQUEST_GET_SQL_DATABASES,"error");b.reject()}});return b.promise};mC.prototype.executeExport=mC.prototype.iH;B.module.controller("AppExportVexController",mC);v.rz=function(a,b,c){a.info("initDocumentationHelp");b.sUrlDocumentationHelp=c.trustAsResourceUrl("https://vmap.readthedocs.io/fr/latest/")};v.rz.$inject=["$log","$scope","$sce","propertiesSrvc"];v.module.controller("documentationHelpCtrl",v.rz);v.Yx=function(){return{restrict:"A",controller:"documentationHelpCtrl",controllerAs:"ctrl",link:function(){}}};v.appDocumentationHelpDrtv=v.Yx;v.module.directive("appDocumentationHelp",v.Yx);v.on("appMainDrtvLoaded",function(){var a=angular.element(v.f).injector().get(["$q"]),b=angular.element(v.f).injector().get(["$log"]),c=angular.element(v.f).injector().get(["$timeout"]),d=angular.element(v.f).injector().get(["$translate"]),e=angular.element(v.f).injector().get(["envSrvc"]),f=angular.element(v.f).injector().get(["formSrvc"]),g=angular.element(v.f).injector().get(["modesSrvc"]),h=angular.element(v.f).injector().get(["sessionSrvc"]),k=angular.element(v.f).injector().get(["propertiesSrvc"]),
m=new FormData;m.append("wmsservice_id",k.private_wms_service);m.append("type","prod");A({method:"POST",url:k.web_server_name+"/"+k.services_alias+"/vm4ms/WmsServices/MapFile",data:m});angular.element(v.Wb).scope().$on("updateStudio_vmap_business_object_vmap_business_object",function(a,b){1===b.index&&"modules/vmap/template/studio.html"===b.oSectionForm.template&&(Z.reset(),Z.setId(e.sId),Z.setApplication("vmap"),Z.setToken(h.token),Z.setContainer("#container_section_"+e.oSelectedObject.name+"_studio"),
Z.setAppProperties(k))},!0);angular.element(v.f).scope().loadVmap=function(){b.info("loadVmap");e.oSelectedMode.fullScreen=!0;g.setModeReload("vmap",!1);v.Kp().resizeWin();angular.element(v.f).scope().setFullScreen();g.getMode("vmap").ajaxLoader=!0;"vmap"===g.modes[0].mode_id&&(sessionStorage.ajaxLoader=!0);B.yj()};v.iy=function(a){return{link:function(b,c,d){var e=d.$observe("appMapDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className=
"ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};v.iy.$inject=["$translate"];v.compileProvider.directive("appMapDescriptionColumn",v.iy);v.ky=
function(){return{replace:!0,template:'<span class="glyphicon glyphicon-picture grid-column-glyph-icon"></span>',link:function(a,b,c){var d=c.$observe("appMapThumbnailColumn",function(){null==a.row.entity[a.col.field]||""==a.row.entity[a.col.field]?b[0].className="":(b[0].className="glyphicon glyphicon-picture grid-column-glyph-icon",b[0].parentNode.style.textAlign="center",$(b).popover({trigger:"hover",container:"body",title:"",content:function(){var c=document.createElement("img");c.onerror=function(){$(b).popover("destroy")};
c.src=a.row.entity[a.col.field];c.className="popover-thumbnail-img";return c.outerHTML},html:!0,placement:function(b,c){return a.$root.workspaceTooltipPlacement(c)},template:'<div class="popover popover-thumbnail" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}))});a.$on("$destroy",function(){$(b).popover("destroy");d()})}}};v.ky.$inject=["propertiesSrvc"];v.compileProvider.directive("appMapThumbnailColumn",v.ky);v.DF=function(){return{replace:!0,
template:'<a href="" target="_blank" class="glyphicon glyphicon-link grid-column-glyph-icon"></a>',link:function(a,b,c){var d=c.$observe("appServiceUrlColumn",function(){null==a.row.entity[a.col.field]||""==a.row.entity[a.col.field]?b[0].className="":(b[0].className="glyphicon glyphicon-link grid-column-glyph-icon",b[0].href=a.row.entity[a.col.field],b[0].alt=b[0].href,b[0].title=b[0].href,b[0].parentNode.style.textAlign="center")});a.$on("$destroy",function(){$(b).popover("destroy");d()})}}};v.compileProvider.directive("appServiceUrlColumn",
v.DF);v.uy=function(a){return{link:function(b,c,d){var e=d.$observe("appServiceDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_SERVICE"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_SERVICE},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},
html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};v.uy.$inject=["$translate"];v.compileProvider.directive("appServiceDescriptionColumn",v.uy);v.vy=function(){return{replace:!0,template:'<span class="glyphicon glyphicon-picture grid-column-glyph-icon"></span>',link:function(a,b,c){var d=c.$observe("appServiceThumbnailColumn",function(){null==a.row.entity[a.col.field]||""==a.row.entity[a.col.field]?b[0].className="":(b[0].className="glyphicon glyphicon-picture grid-column-glyph-icon",
b[0].parentNode.style.textAlign="center",$(b).popover({trigger:"hover",container:"body",title:"",content:function(){var c=document.createElement("img");c.onerror=function(){$(b).popover("destroy")};c.src=a.row.entity[a.col.field];c.className="popover-thumbnail-img";return c.outerHTML},html:!0,placement:function(b,c){return a.$root.workspaceTooltipPlacement(c)},template:'<div class="popover popover-thumbnail" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}))});
a.$on("$destroy",function(){$(b).popover("destroy");d()})}}};v.vy.$inject=["propertiesSrvc"];v.compileProvider.directive("appServiceThumbnailColumn",v.vy);v.ay=function(a){return{link:function(b,c,d){var e=d.$observe("appLayerDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_LAYER"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_LAYER},
content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};v.ay.$inject=["$translate"];v.compileProvider.directive("appLayerDescriptionColumn",v.ay);angular.element(v.f).scope().loadVmapGroup=function(){var a=angular.element(v.X).injector().get(["envSrvc"]);b.info("loadVmapGroup");var c=a.oSelectedObject.name;this.oFormRequestParams={sUrl:"modules/vmap/forms/"+
a.oSelectedMode.mode_id+"/"+c+"_"+a.oSectionForm[c].sections[a.oSectionForm[c].iSelectedSectionIndex].name+".json"}};v.Xx=function(a){return{link:function(b,c,d){var e=d.$observe("appCrsListDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["COORDINATE_SYSTEM_TOOLTIP_TITLE_VMAP_MAP_LAYER"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.COORDINATE_SYSTEM_TOOLTIP_TITLE_VMAP_MAP_LAYER},
content:function(){return b.row.entity[b.col.field].replace(/\|/g,"<br>")},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};v.Xx.$inject=["$translate"];v.compileProvider.directive("appCrsListDescriptionColumn",v.Xx);v.EF=function(){return{template:' <select class="form-control minus" ng-model="oLayerStyle" ng-options="oStyle.Title for oStyle in aStyles" ng-disabled="aStyles.length < 1"></select>',link:function(a){function b(){a.aStyles=
angular.copy(a.row.entity[a.col.field]);a.aStyles=null!=a.aStyles?a.aStyles:[{Title:"",Name:""}];if(null!=a.row.entity[a.col.field+"_selected"]){for(var b=0,c=0;c<a.aStyles.length;c++)a.aStyles[c].Name===a.row.entity[a.col.field+"_selected"].Name&&(b=angular.copy(c));a.oLayerStyle=a.aStyles[b]}else a.oLayerStyle=a.aStyles[0];a.$watch("oLayerStyle",function(){a.row.entity[a.col.field+"_selected"]=a.oLayerStyle;a.$root.$broadcast("layerStyleChanged",a.row.entity)})}a.$root.$on("addLayersToLayer",function(){a.row.grid.refresh();
setTimeout(function(){b()})});b()}}};v.compileProvider.directive("appStyleListColumn",v.EF);angular.element(v.f).scope().initVmapServiceForm=function(){b.info("initVmapServiceForm");var a=angular.element(v.f).scope();"insert"==e.sMode?document.querySelector("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"'] select[name='service_type_id']").addEventListener("change",function(){a.$root.setVmapServiceForm(this.value);angular.element("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+
"']").scope().$apply()}):(a.$root.setVmapServiceForm(e.oFormValues[e.sFormDefinitionName].service_type_id),angular.element("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"']").scope().$apply());if(null!=e.oFormValues[e.sFormDefinitionName].service_options){var c=e.oFormValues[e.sFormDefinitionName].service_options,c=null!=c?r(c)?JSON.parse(c):{}:{};null!=c.login&&null!=c.password&&(e.oFormValues[e.sFormDefinitionName].service_login=c.login,e.oFormValues[e.sFormDefinitionName].service_password=
c.password)}};angular.element(v.f).scope().setVmapServiceForm=function(a){b.info("setVmapServiceForm");var g={xyz:"name description url thumbnail form_submit return_list service_login service_password".split(" "),osm:"name description url thumbnail form_submit return_list".split(" "),bing:"name description key thumbnail lang imagery form_submit return_list".split(" "),imagewms:"name wms_service_type description url service_type_version wms_test_button wms_test_submit_button return_list service_login service_password service_options".split(" "),
tilewms:"name wms_service_type description url service_type_version wms_test_button wms_test_submit_button return_list service_login service_password service_options".split(" "),wmts:"name description url service_type_version service_type_type capabilities_url wmts_test_button wmts_test_submit_button return_list service_login service_password service_options".split(" ")};Object.keys(g).forEach(function(a){g[a].unshift("service_id","service_type_id")});var h=f.getAllFormElementDefinition(e.sFormDefinitionName);
"undefined"==typeof a&&(a=e.oFormValues[e.sFormDefinitionName].service_type_id);if("tilewms"===a||"imagewms"===a)e.oFormValues[e.sFormDefinitionName].wms_service_type=a;h.forEach(function(b){var f=!0;if("undefined"!=typeof g[a])if("button"!==b.type)-1==g[a].indexOf(b.name)&&(f=!1);else{var h=b.buttons;null!=h&&h.forEach(function(b){b.visible=-1===g[a].indexOf(b.name)?!1:!0})}"service_type_version"==b.name&&f&&c(function(){d(["FORM_SERVICE_TYPE_VERSION_TOOLTIP_VMAP_MAP_SERVICE"]).then(function(a){a=
{title:"",content:a.FORM_SERVICE_TYPE_VERSION_TOOLTIP_VMAP_MAP_SERVICE,container:"body",trigger:"hover"};if(null==document.getElementById(b.id+"_tooltip")){var c=document.createElement("span");c.className="form-field-label-tooltip";c.id=b.id+"_tooltip";null!=document.getElementById(b.id+"_label")&&document.getElementById(b.id+"_label").appendChild(c)}angular.element(c).popover(a)})});b.visible=f;!e.oFormValues[e.sFormDefinitionName].service_vm4ms||"name"!==b.name&&"url"!==b.name||(b.type="label")});
"tilewms"!==a&&"imagewms"!==a||"update"!==e.sMode?f.getFormElementDefinition("service_type_id",e.sFormDefinitionName,e.sFormDefinition).visible=!0:f.getFormElementDefinition("service_type_id",e.sFormDefinitionName,e.sFormDefinition).visible=!1;"wmts"===a&&c(function(){""!==e.oFormValues[e.sFormDefinitionName].service_type_version&&null!=e.oFormValues[e.sFormDefinitionName].service_type_version||(e.oFormValues[e.sFormDefinitionName].service_type_version="1.0.0")})};angular.element(v.f).scope().beforeVmapServiceForm=
function(){b.info("beforeVmapServiceForm");var a=e.oFormValues[e.sFormDefinitionName].service_type_id;"tilewms"!==a&&"imagewms"!==a||null==e.oFormValues[e.sFormDefinitionName].wms_service_type||null==e.oFormValues[e.sFormDefinitionName].wms_service_type.selectedOption||null==e.oFormValues[e.sFormDefinitionName].wms_service_type.selectedOption.value||(e.oFormValues[e.sFormDefinitionName].service_type_id=e.oFormValues[e.sFormDefinitionName].wms_service_type.selectedOption.value,f.getFormElementDefinition("service_type_id",
e.sFormDefinitionName,e.sFormDefinition).type="text")};angular.element(v.f).scope().afterVmapServiceForm=function(){b.info("afterVmapServiceForm");var a=e.oFormValues[e.sFormDefinitionName].service_type_id;if("tilewms"===a||"imagewms"===a)f.getFormElementDefinition("service_type_id",e.sFormDefinitionName,e.sFormDefinition).type="label";this.editSectionForm()};angular.element(v.f).scope().testWMTSCapabilities=function(a){b.info("testWMTSCapabilities");var d=angular.copy(e.oFormValues[e.sFormDefinitionName].url),
f=angular.copy(e.oFormValues[e.sFormDefinitionName].service_type_version),g=angular.copy(e.oFormValues[e.sFormDefinitionName].service_type_type),h=angular.copy(e.oFormValues[e.sFormDefinitionName].name);ha(g)&&null!=g.selectedOption&&null!=g.selectedOption.value&&(g=g.selectedOption.value);if(null==h||""===h)return $.notify("Nom non d\u00e9fini","error"),null;if(null==d||""===d)return $.notify("Lien non d\u00e9fini","error"),null;if(null==f||""===f)return $.notify("Version non d\u00e9finie","error"),
null;if(null==g||""===g)return $.notify("Type non d\u00e9fini","error"),null;if(0<d.toLowerCase().indexOf("service="))return $.notify('Veuillez ne pas utiliser le param\u00e8tre SERVICE dans le champ "Lien"',"error"),null;if(0<d.toLowerCase().indexOf("request="))return $.notify('Veuillez ne pas utiliser le param\u00e8tre REQUEST dans le champ "Lien"',"error"),null;if(0<d.toLowerCase().indexOf("version="))return $.notify('Veuillez ne pas utiliser le param\u00e8tre VERSION dans le champ "Lien"',"error"),
null;this.WMTSCapabilities({serviceUrl:d,serviceVersion:f,WMTSType:g},function(b){$.notify("Service valide","success");c(function(){var c=JSON.stringify(b);e.oFormValues[e.sFormDefinitionName].service_options=c;if(a){e.oFormValues[e.sFormDefinitionName].url=Zc(d);var c=e.oFormDefinition[e.sFormDefinitionName].name,f=angular.element("form[name='"+c+"']").scope();f[c].$setPristine();f.sendForm()}})})};angular.element(v.f).scope().WMTSCapabilities=function(a,c,d){function e(a){"string"==typeof a&&(a=
a.replace(/&gt;/ig,">"),a=a.replace(/&lt;/ig,"<"),a=a.replace(/&#039;/g,"'"),a=a.replace(/&quot;/ig,'"'),a=a.replace(/&amp;/ig,"&"));return a}var f=this;b.info("WMTSCapabilities");if(null==a.serviceUrl)return console.error("serviceUrl not defined"),null;if(null==a.serviceVersion)return console.error("serviceVersion not defined"),null;if(null==a.WMTSType)return console.error("WMTSType not defined"),null;null!=d||(d=function(a){f.$root.modalWindow("dialog","Service non valide",{className:"modal-danger",
message:a})});var g=a.serviceUrl,h=a.serviceVersion;a=a.WMTSType;var m,p=!0,g=Zc(g);"KVP"===a?m=-1===g.indexOf("?")?g+"?SERVICE=WMTS&VERSION="+h+"&REQUEST=GetCapabilities":g+"&SERVICE=WMTS&VERSION="+h+"&REQUEST=GetCapabilities":"REST"===a&&(m=g+"/"+h+"/WMTSCapabilities.xml");null!=m&&A({method:"GET",url:k.proxy_url+"?url="+encodeURIComponent(m),headers:{charset:"charset=utf-8"},responseType:"text",scope:f,success:function(a){var g=a.data;if(r(a.data)&&0<a.data.length){try{var h=(new Bs).read(e(g))}catch(U){h=
{}}b.info(h);null!=h.Contents&&q(h.Contents.Layer)&&null!=h.Contents.Layer[0]&&q(h.Contents.Layer[0].TileMatrixSetLink)&&null!=h.Contents.Layer[0].TileMatrixSetLink[0]&&r(h.Contents.Layer[0].TileMatrixSetLink[0].TileMatrixSet)&&(p=!1)}p?(a="Impossible de r\u00e9cup\u00e9rer les informations depuis "+m.replace(/</g,"&lt;").replace(/>/g,"&gt;"),500>g.length&&(a+="<br><br>"+g),null!=d&&d.call(f,a)):c.call(f,h)},error:function(a){null!=d&&d.call(f,"Impossible de r\u00e9cup\u00e9rer les informations depuis "+
m.replace(/</g,"&lt;").replace(/>/g,"&gt;"));console.error("error: ",a)}})};angular.element(v.f).scope().testWMSCapabilities=function(a){b.info("testWMSCapabilities");var d=this,f=angular.copy(e.oFormValues[e.sFormDefinitionName].url),g=angular.copy(e.oFormValues[e.sFormDefinitionName].name),h=angular.copy(e.oFormValues[e.sFormDefinitionName].service_type_version);if(null==f||""===f)return $.notify("Lien non d\u00e9fini","error"),null;if(null==g||""===g)return $.notify("Nom non d\u00e9fini","error"),
null;if(0<f.toLowerCase().indexOf("service="))return $.notify('Veuillez ne pas utiliser le param\u00e8tre SERVICE dans le champ "Lien"',"error"),null;if(0<f.toLowerCase().indexOf("request="))return $.notify('Veuillez ne pas utiliser le param\u00e8tre REQUEST dans le champ "Lien"',"error"),null;if(0<f.toLowerCase().indexOf("version="))return $.notify('Veuillez ne pas utiliser le param\u00e8tre VERSION dans le champ "Lien"',"error"),null;this.getCapabilities(f,{version:h}).then(function(b){null!=b?
null!=b.json?($.notify("Service valide","success"),c(function(){if(a){e.oFormValues[e.sFormDefinitionName].url=Zc(f);var c=e.oFormDefinition[e.sFormDefinitionName].name,g=angular.element("form[name='"+c+"']").scope();g[c].$setPristine();g.sendForm()}else d.showLayerModalWindow({capabilities:b,service_url:f,service_version:h})})):$.notify("Service non valide","error"):$.notify("Service non valide","error")})};angular.element(v.f).scope().cloneService=function(){b.info("cloneService")};angular.element(v.f).scope().initVmapLayerForm=
function(){b.info("initVmapLayerForm");this.showStudioIfLayerIsFiltered();var a=angular.element(v.f).scope();A({method:"GET",url:k.web_server_name+"/"+k.services_alias+"/vmap/services",scope:a,success:function(b){if(1==b.data.status&&0<b.data.list_count){var c={};b.data.services.forEach(function(a){c[a.service_id]=a});a.oServices=c;"update"==e.sMode&&a.$root.setVmapLayerForm()}}});var c=e.oFormValues[e.sFormDefinitionName].service_type_id;if(("tilewms"==c||"imagewms"==c)&&"update"==e.sMode){var c=
angular.element("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"'] .ui-grid-form-field-data").scope().$parent.gridOptions,d=e.oFormValues[e.sFormDefinitionName].layer_list,f=[],g=[];null!=d&&(f=d.split(","));f=a.cleanLayersArray(f);for(d=f.length-1;0<=d;d--)g.push({name:f[d]});c.data=g}"insert"==e.sMode?setTimeout(function(){document.querySelector("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"'] select[name='service_id']").addEventListener("change",function(){a.$root.setVmapLayerForm(this.value);
angular.element("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"']").scope().$apply()})}):a.$root.setVmapLayerForm(e.oFormValues[e.sFormDefinitionName].service_id)};angular.element(v.f).scope().setVmapLayerForm=function(a){b.info("setVmapLayerForm");var d=angular.element(v.f).scope(),g=this,h={xyz:"layer_id service_id service_name name layertheme_id theme_name bo_id bo_id_list form_submit return_list".split(" "),osm:"layer_id service_id service_name name layertheme_id theme_name bo_id bo_id_list form_submit return_list".split(" "),
bing:"layer_id service_id service_name name layertheme_id theme_name bo_id bo_id_list form_submit return_list".split(" "),tilewms:"layer_id service_id service_name name description layertheme_id theme_name layer_list layer_options bo_id bo_id_list is_dynamic is_filtered is_bo_filtered form_submit return_list".split(" "),imagewms:"layer_id service_id service_name name description layertheme_id theme_name layer_list layer_options bo_id bo_id_list is_dynamic is_filtered is_bo_filtered form_submit return_list".split(" "),
wmts:"layer_id service_id service_name name description layertheme_id theme_name wmts_layer matrix_set layer_style layer_format layer_options bo_id bo_id_list form_submit return_list".split(" ")},k,m=f.getAllFormElementDefinition(e.sFormDefinitionName);null==a&&(a=e.oFormValues[e.sFormDefinitionName].service_id,null!=a.selectedOption&&null!=a.selectedOption.value&&(a=a.selectedOption.value));"insert"===e.sMode?null!=d.oServices[a]&&(k=d.oServices[a].service_type_id,e.oFormValues[e.sFormDefinitionName].service_type_id=
k,null!=d.oServices[a].url&&(e.oFormValues[e.sFormDefinitionName].service_url=d.oServices[a].url),null!=d.oServices[a].service_type_version&&(e.oFormValues[e.sFormDefinitionName].service_type_version=d.oServices[a].service_type_version)):k=e.oFormValues[e.sFormDefinitionName].service_type_id;m.forEach(function(a){null!=h[k]&&("button"===a.type?(a=a.buttons,null!=a&&a.forEach(function(a){a.visible=-1===h[k].indexOf(a.name)?!1:!0})):a.visible=-1!==h[k].indexOf(a.name)?!0:!1)});if("wmts"===k){var p=
e.oFormValues[e.sFormDefinitionName].wmts_layer,H=e.oFormValues[e.sFormDefinitionName].matrix_set,G=e.oFormValues[e.sFormDefinitionName].layer_style,L=e.oFormValues[e.sFormDefinitionName].layer_format,p=null!=p?p:{options:[],selectedOption:{value:""}},H=null!=H?H:{options:[],selectedOption:{value:""}},G=null!=G?G:{options:[],selectedOption:{value:""}},L=null!=L?L:{options:[],selectedOption:{value:""}};c(function(){"update"===e.sMode?(p.selectedOption.value=e.oFormValues[e.sFormDefinitionName].layer_list,
q(p.options)&&0===p.options.length&&(p.options=[{label:p.selectedOption.value,value:p.selectedOption.value}]),q(H.options)&&0===H.options.length&&(H.options=[{label:H.selectedOption.value,value:H.selectedOption.value}]),q(G.options)&&0===G.options.length&&(G.options=[{label:G.selectedOption.value,value:G.selectedOption.value}]),q(L.options)&&0===L.options.length&&(L.options=[{label:L.selectedOption.value,value:L.selectedOption.value}])):"display"===e.sMode&&(e.oFormValues[e.sFormDefinitionName].wmts_layer=
e.oFormValues[e.sFormDefinitionName].layer_list)});var N=function(a){var b=[];if(null!=a.Contents&&q(a.Contents.Layer)){a=a.Contents.Layer;for(var c=0;c<a.length;c++)b.push({label:a[c].Title,value:a[c].Identifier})}return b},T=function(a,b){var c=[],d=[],e=[];if(null!=b&&null!=b.value&&(b=b.value,null!=a.Contents)){if(null!=a.Contents.Layer)for(var f=a.Contents.Layer,g=0;g<f.length;g++)if(f[g].Identifier===b&&null!=f[g].TileMatrixSetLink)for(var h=0;h<f[g].TileMatrixSetLink.length;h++)r(f[g].TileMatrixSetLink[h].TileMatrixSet)&&
e.push(f[g].TileMatrixSetLink[h].TileMatrixSet);if(null!=a.Contents.TileMatrixSet&&0<e.length)for(g=0;g<a.Contents.TileMatrixSet.length;g++)-1!==e.indexOf(a.Contents.TileMatrixSet[g].Identifier)&&d.push(a.Contents.TileMatrixSet[g]);if(0<d.length)for(g=0;g<d.length;g++)c.push({label:d[g].Identifier+" ("+d[g].SupportedCRS+")",value:d[g].Identifier})}return c},U=function(a,b){var c=[],d=[];if(null!=b&&null!=b.value&&(b=b.value,null!=a.Contents)){if(null!=a.Contents.Layer){a=a.Contents.Layer;for(var e=
0;e<a.length;e++)a[e].Identifier===b&&null!=a[e].Style&&(d=a[e].Style)}if(0<d.length)for(e=0;e<d.length;e++)c.push({label:d[e].Identifier,value:d[e].Identifier})}return c},K=function(a,b){var c=[],d=[];if(null!=b&&null!=b.value&&(b=b.value,null!=a.Contents)){if(null!=a.Contents.Layer){a=a.Contents.Layer;for(var e=0;e<a.length;e++)a[e].Identifier===b&&null!=a[e].Format&&(d=a[e].Format)}if(0<d.length)for(e=0;e<d.length;e++)c.push({label:d[e],value:d[e]})}return c},X=function(a){var d=N(a),f,h,k;c(function(){null!=
p&&(p.options=d)});g.wmtsLayerSelected=function(){b.info("wmtsLayerSelected");null!=p&&null!=p.selectedOption&&null!=p.selectedOption.value&&(f=T(a,p.selectedOption),h=U(a,p.selectedOption),k=K(a,p.selectedOption),c(function(){null!=H&&(H.options=f,e.oFormValues[e.sFormDefinitionName].matrix_set=H);null!=G&&(G.options=h,e.oFormValues[e.sFormDefinitionName].layer_style=G);null!=L&&(L.options=k,e.oFormValues[e.sFormDefinitionName].layer_format=L);e.oFormValues[e.sFormDefinitionName].layer_list=p.selectedOption.value}))};
null!=p&&null!=p.selectedOption&&null!=p.selectedOption.value&&0<p.selectedOption.value.length&&g.wmtsLayerSelected()};a=d.oServices[a];null!=a&&"display"!==e.sMode&&(null!=a.service_options?(a=JSON.parse(a.service_options),X(a)):this.WMTSCapabilities({serviceUrl:a.url,serviceVersion:a.service_type_version,WMTSType:a.service_type_type},function(a){X(a)}))}"insert"==e.sMode&&(a=document.querySelector("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"'] .ui-grid-form-field-data"),null!=a&&
(angular.element(a).scope().$parent.gridOptions.data.length=0))};angular.element(v.f).scope().loadVmapMapLayers=function(){var a=angular.element(v.X).injector().get(["envSrvc"]);b.info("loadVmapMapLayers");var c=this,e=a.oSelectedObject.sorted_by,f=a.oSelectedObject.sorted_dir;a.oSelectedObject.sorted_by="layer_index";a.oSelectedObject.sorted_dir="ASC";var g=document.getElementById("container_section_"+a.oSelectedObject.name+"_layers");g.className+=" section-container-workspace-list";c.gridOptions=
{enableRowSelection:!0,enableSelectAll:!0,enablePagination:!1,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:999,enableColumnMenus:!1,enableColumnResizing:!0,paginationPageSizes:[10,20,50,100],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!1,appHeaderOptionBar:!1,appLoadGridData:!0,oFilter:{relation:"AND",operators:[{column:"map_id",compare_operator:"=",value:a.sId}]},appGridTitle:"TITLE_GRID_MAP_LAYERS_VMAP_MAP_MAP_LAYERS",appFooter:!1,appShowPagination:!1,appEnableDragAndDrop:!0,
appDragAndDropEvent:{rowFinishDrag:"updateMapLayerSorting"},appActions:[],oUrlParams:{order_by:"layer_index",sort_order:"DESC"}};c.bLoadFormValues=!1;d(["FORM_MAP_ID_VMAP_MAP_MAP","FORM_NAME_VMAP_MAP_MAP","FORM_THEME_VMAP_MAP_MAP","FORM_VISIBLE_VMAP_MAP_MAP_LAYERS","FORM_OPACITY_VMAP_MAP_MAP_LAYERS"]).then(function(b){c.gridOptions.columnDefs=[{name:b.FORM_MAP_ID_VMAP_MAP_MAP,displayName:b.FORM_MAP_ID_VMAP_MAP_MAP,field:"layer_id",width:50,enableSorting:!1,type:"number",enableColumnMoving:!0,enableColumnResizing:!0,
headerCellClass:"vmap_map_layers_"+a.oSelectedObject.name+"_layer_id",cellClass:"cell-align-right"},{name:b.FORM_NAME_VMAP_MAP_MAP,displayName:b.FORM_NAME_VMAP_MAP_MAP,field:"name",width:250,enableSorting:!1,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+a.oSelectedObject.name+"_name"},{name:b.FORM_THEME_VMAP_MAP_MAP,displayName:b.FORM_THEME_VMAP_MAP_MAP,field:"theme_name",width:200,enableSorting:!1,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,
headerCellClass:"vmap_map_layers_"+a.oSelectedObject.name+"_theme_name"},{name:b.FORM_VISIBLE_VMAP_MAP_MAP_LAYERS,displayName:b.FORM_VISIBLE_VMAP_MAP_MAP_LAYERS,field:"layer_visible",width:60,enableSorting:!1,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,cellTemplate:'<div data-app-set-boolean-icon-column="{{row.entity[col.field]}}"></div>',headerCellClass:"vmap_map_layers_"+a.oSelectedObject.name+"_layer_visible"},{name:b.FORM_OPACITY_VMAP_MAP_MAP_LAYERS,displayName:b.FORM_OPACITY_VMAP_MAP_MAP_LAYERS,
field:"layer_opacity",width:65,enableSorting:!1,type:"number",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+a.oSelectedObject.name+"_layer_opacity",cellClass:"cell-align-right",cellTemplate:'<div data-app-map-layers-opacity-column="{{row.entity.layer_id}}" class="cell-input-type-text"><input type="number" class="form-control" min="0" max="100"></div>'}]});if("update"==a.sMode){d(["BTN_VISIBLE_VMAP_MAP_MAP_LAYERS","BTN_INVISIBLE_VMAP_MAP_MAP_LAYERS","BTN_ADD_LAYERS_VMAP_MAP_MAP_LAYERS",
"BTN_DELETE_LAYERS_VMAP_MAP_MAP_LAYERS"]).then(function(a){c.gridOptions.appActions=[{label:a.BTN_ADD_LAYERS_VMAP_MAP_MAP_LAYERS,name:c.sSelectedObjectName+"_add_layer_btn",event:"showAddLayersToMapModalWindow()"},{label:a.BTN_DELETE_LAYERS_VMAP_MAP_MAP_LAYERS,name:c.sSelectedObjectName+"_delete_layer_btn",event:"deleteMapLayers()"},{label:a.BTN_VISIBLE_VMAP_MAP_MAP_LAYERS,name:c.sSelectedObjectName+"_visible_btn",event:"setMapLayerVisibility(true)"},{label:a.BTN_INVISIBLE_VMAP_MAP_MAP_LAYERS,name:c.sSelectedObjectName+
"_invisible_btn",event:"setMapLayerVisibility(false)"}]});var h=c.$root.$on("workspaceListTplCompiled",function(){h();var b=document.querySelector("#"+a.oSelectedObject.name+"_"+a.sSelectedSectionName+"_grid .workspacelist-grid-data"),d=c.sSelectedObjectName+"_layer_up_btn",g=c.sSelectedObjectName+"_layer_down_btn";angular.element(b).append('<button type="button" id="'+d+'" class="btn btn-sm btn-primary map-layer-order-up" aria-label="Left Align"><span class="glyphicon glyphicon-chevron-up"></span></button>');
angular.element(b).append('<button type="button" id="'+g+'" class="btn btn-sm btn-primary map-layer-order-down" aria-label="Left Align"><span class="glyphicon glyphicon-chevron-down"></span></button>');document.getElementById(d).addEventListener("click",function(){c.$root.changeMapLayerSorting("up")});document.getElementById(g).addEventListener("click",function(){c.$root.changeMapLayerSorting("down")});a.oSelectedObject.sorted_by=e;a.oSelectedObject.sorted_dir=f})}};angular.element(v.f).scope().showAddLayersToMapModalWindow=
function(){var a=angular.element(v.X).injector().get(["$compile"]),c=angular.element(v.X).injector().get(["$templateRequest"]),d=angular.element(v.X).injector().get(["$translate"]),f=angular.element(v.X).injector().get(["uiGridConstants"]);b.info("showAddLayersToMapModalWindow");var h=this.$new();g.addScopeToObject(e.oSelectedObject.name,e.oSelectedMode.mode_id,h);var k=g.getObject(e.oSelectedObject.name,g.getMode(e.oSelectedMode.mode_id)),m=e.sMode,H=e.sSelectedGridOptionsName;e.oSelectedObject=
{actions:[],columns:[],mode_id:k.mode_id,name:k.name+"_available_layers",ressource_id:"vmap/layers",sections:"",template_name:"",order_by:"name",sort_order:"ASC"};e.sMode="search";h.sSelectedObjectName=e.oSelectedObject.name;h.gridOptions={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:100,enableColumnMenus:!1,enableColumnResizing:!0,paginationPageSizes:[10,20,50,100],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!0,
appHeaderOptionBar:!1,appLoadGridData:!0,appGridTitle:"TITLE_GRID_AVAILABLE_LAYERS_VMAP_MAP_MAP_LAYERS",appResizeGrid:!0,appFooter:!0,appShowPagination:!0,appActions:[],oUrlParams:{order_by:"name",sort_order:"ASC"}};d(["FORM_MAP_ID_VMAP_MAP_MAP","FORM_NAME_VMAP_MAP_MAP","FORM_THEME_VMAP_MAP_MAP","FORM_COORDINATE_SYSTEM_VMAP_MAP_LAYER","FORM_DESCRIPTION_VMAP_MAP_LAYER"]).then(function(a){h.gridOptions.columnDefs=[{name:a.FORM_MAP_ID_VMAP_MAP_MAP,displayName:a.FORM_MAP_ID_VMAP_MAP_MAP,field:"layer_id",
width:50,enableSorting:!0,type:"number",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+"_layer_id"},{name:a.FORM_NAME_VMAP_MAP_MAP,displayName:a.FORM_NAME_VMAP_MAP_MAP,field:"name",width:380,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+"_name",sort:{direction:f.ASC,ignoreSort:!0,priority:0}},{name:a.FORM_THEME_VMAP_MAP_MAP,displayName:a.FORM_THEME_VMAP_MAP_MAP,
field:"theme_name",width:200,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+"_theme_name"},{name:a.FORM_DESCRIPTION_VMAP_MAP_LAYER,displayName:a.FORM_DESCRIPTION_VMAP_MAP_LAYER,field:"description",width:150,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+"_crs_list",cellTemplate:'<div data-app-layer-description-column="{{row.entity[col.field]}}"></div>'}]});
"display"!=e.sMode&&d(["BTN_ADD_VMAP_MAP_MAP_LAYERS"]).then(function(a){h.gridOptions.appActions=[{label:a.BTN_ADD_VMAP_MAP_MAP_LAYERS,name:h.sSelectedObjectName+"_add_layer_btn",event:"addLayersToMap()"}]});d=e.oGridOptions[k.name+"_layers"].data;if(0<d.length){for(var G=[],L=0;L<d.length;L++)null!=d[L].layer_id&&G.push(d[L].layer_id);0<G.length&&(e.oSelectedObject.filter={relation:"AND",operators:[{column:"layer_id",compare_operator:"NOT IN",value:G}]})}var N="container_"+e.oSelectedObject.name+
"_available_layers";h.modalWindow("dialog",null,{className:"dialog-modal-window dialog-modal-window-workspace-list dialog-modal-window-available-layers",message:'<div id="'+N+'" class="col-xs-12"></div>'}).then(function(b){$(b).on("shown.bs.modal",function(){var b=document.querySelector(".dialog-modal-window-available-layers > .modal-dialog");b.className+=" modal-lg";c("templates/workspaceListTpl.html").then(function(b){a($("#"+N).html(b).contents())(h)})});$(b).on("hide.bs.modal",function(){e.oSelectedObject=
k;e.sMode=m;e.sSelectedGridOptionsName=H;h.$root.refreshGrid(h.$root.gridApi[e.sSelectedGridOptionsName].grid.appScope,e.oGridOptions[e.sSelectedGridOptionsName])})})};angular.element(v.f).scope().setMapLayerVisibility=function(a){b.info("setMapLayerVisibility");var c=this;a={visibility:""+a,map_id:e.sId};var f=c.$root.gridApi[e.sSelectedGridOptionsName].selection.getSelectedRows();if(0<f.length){for(var g=0,h=[];g<f.length;)h.push(f[g].layer_id),g++;a.map_layers=h.join("|");A({method:"PUT",url:k.web_server_name+
"/"+k.services_alias+"/vmap/maplayers/"+e.sId+"/visibility",data:a,scope:c,success:function(a){0==a.data.status?c.modalWindow("dialog","ERROR_MAP_LAYER_VISIBILITY_VMAP_MAP_MAP_LAYERS",{className:"modal-danger",message:a.data.errorMessage}):(c.$root.gridApi[e.sSelectedGridOptionsName].selection.clearSelectedRows(),c.refreshGrid(c,c.gridOptions),d("SUCCESSFUL_OPERATION").then(function(a){$.notify(a,"success")}))}})}};angular.element(v.f).scope().addLayersToMap=function(){b.info("addLayersToMap");var a=
this,c={map_id:e.sId},f=a.$root.gridApi[e.sSelectedGridOptionsName].selection.getSelectedRows();if(0<f.length){for(var g=0,h=[];g<f.length;)h.push(f[g].layer_id),g++;c.map_layers=h.join("|");A({method:"PUT",url:k.web_server_name+"/"+k.services_alias+"/vmap/maplayers/"+e.sId,data:c,scope:a,success:function(b){0==b.data.status?a.modalWindow("dialog","ERROR_ADD_MAP_LAYERS_VMAP_MAP_MAP_LAYERS",{className:"modal-danger",message:b.data.errorMessage}):(bootbox.hideAll(),d("SUCCESSFUL_OPERATION").then(function(a){$.notify(a,
"success")}))}})}};angular.element(v.f).scope().deleteMapLayers=function(){b.info("deleteMapLayers");var a=this,c={map_id:e.sId},f=a.$root.gridApi[e.sSelectedGridOptionsName].selection.getSelectedRows();if(0<f.length){for(var g=0,h=[];g<f.length;)h.push(f[g].layer_id),g++;c.idList=h.join("|");A({method:"DELETE",url:k.web_server_name+"/"+k.services_alias+"/vmap/maplayers/"+e.sId,params:c,scope:a,success:function(b){0==b.data.status?a.modalWindow("dialog","ERROR_DELETE_MAP_LAYER_VMAP_MAP_MAP_LAYERS",
{className:"modal-danger",message:b.data.errorMessage}):(a.$root.gridApi[e.sSelectedGridOptionsName].selection.clearSelectedRows(),a.refreshGrid(a,a.gridOptions),d("SUCCESSFUL_OPERATION").then(function(a){$.notify(a,"success")}))}})}};angular.element(v.f).scope().changeMapLayerSorting=function(a){b.info("changeMapLayerSorting");var c=e.oGridOptions[e.sSelectedGridOptionsName],d=this.$root.gridApi[e.sSelectedGridOptionsName].selection.getSelectedRows();if(0<d.length){for(var f=!1,g=0,h=[];g<d.length;)c.data.forEach(function(a,
b){a.$$hashKey==d[g].$$hashKey&&h.push(b)}),g++;"up"==a&&h.forEach(function(a,b){0<a&&a>b&&(b=c.data.splice(a,1),c.data.splice(a-1,0,b[0]),f=!0)});h.reverse();"down"==a&&h.forEach(function(a,b){a<c.data.length-1&&a<c.data.length-1-b&&(b=c.data.splice(a,1),c.data.splice(a+1,0,b[0]),f=!0)});g=0;for(a=[];g<c.data.length;)a.push(c.data[g].layer_id),g++;f&&this.$root.updateMapLayerSorting()}};angular.element(v.f).scope().updateMapLayerSorting=function(){b.info("updateMapLayerSorting");for(var a=this,c=
{map_id:e.sId},d=e.oGridOptions[e.sSelectedGridOptionsName],f=0,g=[],f=d.data.length-1;0<=f;f--)g.push(d.data[f].layer_id);c.map_layers=g.join("|");A({method:"PUT",url:k.web_server_name+"/"+k.services_alias+"/vmap/maplayers/"+e.sId+"/sorting",data:c,scope:a,success:function(b){0==b.data.status&&a.modalWindow("dialog","ERROR_ADD_MAP_LAYERS_VMAP_MAP_MAP_LAYERS",{className:"modal-danger",message:b.data.errorMessage})}})};v.by=function(a){return{link:function(b,c,d){var e=d.$observe("appLayerThemeDescriptionColumn",
function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_LAYER_THEME"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_LAYER_THEME},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");
e()})}}};v.by.$inject=["$translate"];v.compileProvider.directive("appLayerThemeDescriptionColumn",v.by);v.jy=function(a){return{link:function(b,c,d){var e=d.$observe("appMapThemeDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP_THEME"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP_THEME},
content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};v.jy.$inject=["$translate"];v.compileProvider.directive("appMapThemeDescriptionColumn",v.jy);v.ly=function(a){return{link:function(b,c,d){var e=d.$observe("appModuleDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",
a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};v.ly.$inject=["$translate"];v.compileProvider.directive("appModuleDescriptionColumn",v.ly);angular.element(v.f).scope().loadVmapUser=
function(){b.info("loadVmapUser");var a=e.oSelectedObject.name;this.oFormRequestParams={sUrl:"modules/vmap/forms/"+e.oSelectedMode.mode_id+"/"+a+"_"+e.oSectionForm[a].sections[e.oSectionForm[a].iSelectedSectionIndex].name+".json"}};angular.element(v.f).scope().beforeVmapAdminPrintVmapAdminTemplateEdition=function(){b.info("beforeVmapAdminPrintVmapAdminTemplateEdition")};angular.element(v.f).scope().beforeVmapAdminTemplateSubmit=function(){b.info("beforeVmapAdminTemplateSubmit")};v.py=function(a){return{link:function(b,
c,d){var e=d.$observe("appPrintParameterPlaceholderColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["PLACEHOLDER_TOOLTIP_TITLE_VMAP_PRINT_PARAMETER"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.PLACEHOLDER_TOOLTIP_TITLE_VMAP_PRINT_PARAMETER},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},
html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};v.py.$inject=["$translate"];v.compileProvider.directive("appPrintParameterPlaceholderColumn",v.py);v.oy=function(a){return{link:function(b,c,d){var e=d.$observe("appPrintParameterDefaultValueColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["PLACEHOLDER_TOOLTIP_TITLE_VMAP_PRINT_PARAMETER"]).then(function(a){$(c).popover({trigger:"hover",
container:"body",title:function(){return a.PLACEHOLDER_TOOLTIP_TITLE_VMAP_PRINT_PARAMETER},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};v.oy.$inject=["$translate"];v.compileProvider.directive("appPrintParameterDefaultValueColumn",v.oy);v.zF=function(){return{link:function(a,b,c){var d=c.$observe("appMapLayersOpacityColumn",function(){var c=b[0].querySelector("input[type='number']");
c.value=a.row.entity[a.col.field];c.setAttribute("data-layer-id",a.row.entity.layer_id)});b[0].querySelector("input[type='number']").addEventListener("change",a.$root.setMapLayerOpacity);a.$on("$destroy",function(){d();b[0].querySelector("input[type='number']").removeEventListener("change",a.$root.setMapLayerOpacity)})}}};v.compileProvider.directive("appMapLayersOpacityColumn",v.zF);angular.element(v.f).scope().setMapLayerOpacity=function(a){b.info("setMapLayerOpacity");var c=angular.element(v.f).scope(),
d=parseInt(a.target.value);0>d?d=0:100<d&&(d=100);a.target.value=d;a={map_id:e.sId,layer_id:a.target.getAttribute("data-layer-id"),layer_opacity:d};A({method:"PUT",url:k.web_server_name+"/"+k.services_alias+"/vmap/maplayers/"+e.sId+"/opacity",data:a,scope:c,success:function(a){0==a.data.status?c.modalWindow("dialog","ERROR_ADD_MAP_LAYERS_VMAP_MAP_MAP_LAYERS",{className:"modal-danger",message:a.data.errorMessage}):c.$root.refreshGrid(c.$root.gridApi[e.sSelectedGridOptionsName].grid.appScope,e.oGridOptions[e.sSelectedGridOptionsName])}})};
angular.element(v.f).scope().initOLMapExtent=function(){b.info("initOLMapExtent");setTimeout(function(){var a=angular.element($("#vmap_map_map_extent")).scope().oMap.ca;angular.element(v.f).scope().updateOLMapExtent();a.on("moveend",function(){(null==a.get("lastManualUpdate")||Date.now()>a.get("lastManualUpdate")+200)&&angular.element(v.f).scope().updateExtent()});document.querySelector("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"'] select[name='crs_id']").addEventListener("change",
function(){angular.element(v.f).scope().updateExtent()})},1E3)};angular.element(v.f).scope().updateExtent=function(){b.info("updateExtent");var a=[],c=angular.element($("#vmap_map_map_extent")).scope().oMap.ca,d=Ei(E(c),c.$a()),c=E(c).J().Z;uh(d,c,e.oFormValues[e.sFormDefinitionName].crs_id.selectedOption.value).forEach(function(b){a.push(b.toPrecision(10))});e.oFormValues[e.sFormDefinitionName].extent=a.join("|");d=angular.element($("[name=vmap_map_update_form]")).scope();c=angular.element($("[name=vmap_map_insert_form]")).scope();
null!=d&&d.$apply();null!=c&&c.$apply()};angular.element(v.f).scope().updateOLMapExtent=function(){b.info("updateOLMapExtent");if(null==e.oFormValues[e.sFormDefinitionName].extent)return angular.element(v.f).scope().updateExtent(),0;f.getFormElementDefinition("map_extent",e.sFormDefinitionName,e.oFormDefinition);for(var a=angular.element($("#vmap_map_map_extent")).scope().oMap.ca,c=e.oFormValues[e.sFormDefinitionName].extent.split("|"),d=0;d<c.length;d++)c[d]=parseFloat(c[d]);d=E(a).J().Z;c=uh(c,
e.oFormValues[e.sFormDefinitionName].crs_id.selectedOption.value,d);Ji(E(a),c,{kc:!1,Dj:!0});a.set("lastManualUpdate",Date.now())};angular.element(v.f).scope().showAddLayersToLayerModalWindow=function(){var a=angular.element(v.X).injector().get(["$translate"]);b.info("showAddLayersToLayerModalWindow");var c=this,d=e.sFormDefinitionName,f=this.$new();a(["BTN_ADD_LAYERS_VMAP_MAP_LAYER"]).then(function(a){var b=e.oFormValues[d].service_url,g=e.oFormValues[d].service_type_version,b=b.replace("[token]",
$c(h.token)),b=b.replace("[ms_cgi_url]",k.ms_cgi_url);c.showLayerModalWindow({service_url:b,service_version:g,buttons:[{label:a.BTN_ADD_LAYERS_VMAP_MAP_LAYER,name:f.sSelectedObjectName+"_add_layer_btn",event:"addLayersToLayer('"+d+"')"}]})})};angular.element(v.f).scope().showLayerModalWindow=function(a){function c(a){if(null!=a&&null!=a.json&&null!=a.xml){var b=[],c=[],g=function(a){if(void 0===a.Layer)c.push(a);else for(var b=0;b<a.Layer.length;b++)g(a.Layer[b])};if("undefined"!=typeof a){var h=
[],k=e.oFormValues[p].layer_list;null!=k&&(h=k.split(","));g(a.json.Capability.Layer);for(k=0;k<c.length;k++)-1==h.indexOf(c[k].Name)&&b.push({name:c[k].Name,description:c[k].Title,style:c[k].Style,crs_list:null!=c[k].CRS?c[k].CRS.join(","):[],oLayer:c[k]})}b.sort(function(a,b){return a.name.localeCompare(b.name)});N.gridOptions.data=b;N.gridOptions.totalItems=b.length;var m="container_"+e.oSelectedObject.name+"_wms_layers";N.modalWindow("dialog",null,{className:"dialog-modal-window dialog-modal-window-workspace-list dialog-modal-window-wms_layers",
message:'<div id="'+m+'" class="col-xs-12"></div>'}).then(function(g){$(g).on("shown.bs.modal",function(){var g=document.querySelector(".dialog-modal-window-wms_layers > .modal-dialog");g.className+=" modal-l";f("modules/vmap/template/vitis/serviceLayers.html").then(function(g){d($("#"+m).html(g).contents())(N);var h=angular.element($("#"+m)).scope();f("templates/workspaceListTpl.html").then(function(a){d($("#"+m).find("#service_layers_layers_list").html(a).contents())(N)});null!=h&&(h.$applyAsync(function(){h.xml=
a.xml;h.codemirror_options={lineWrapping:!0,lineNumbers:!0,readOnly:"nocursor",mode:"xml"}}),$("#"+m).find("#service_layers_capabilities_codemirror").find(".CodeMirror").css("height","100%"));var k=!1;h.showOlMap=function(){k||A({method:"GET",url:"modules/vmap/forms/vmap_admin_map/vmap_admin_map_vmap_layers_openlayers_test.json",scope:N,success:function(a){k=!0;a=a.data;for(var d=angular.element($("#"+m).find("#service_layers_layers_ol_formreader").children()).scope(),f=a.update.rows[0].fields[0],
g=[{extent:[-1901744.2199433097,4779520.942381757,2501744.2199433097,7220479.057618243],projection:"EPSG:3857"},{extent:[-2648.2345550218597,6231825.554877603,7024177.333740164,7024177.333740164],projection:"EPSG:2154"},{extent:[-4.6307373046875,42.802734375,51.0205078125,51.0205078125],projection:"EPSG:4326"}],h=0,t=0;t<g.length;t++){for(var u=!0,w=0;w<c.length;w++)-1===(q(c[w].CRS)?c[w].CRS:q(c[w].SRS)?c[w].CRS:[]).indexOf(g[t].projection)&&(u=!1);if(u){h=angular.copy(t);break}}f.map_options.proj=
g[h].projection;f.map_options.center={extent:g[h].extent};f.map_options.tree.children[0].view=g[h];g={name:"Service WMS",children:[]};for(t=0;t<c.length;t++){h="";for(w=0;w<b.length;w++)b[w].name===c[t].Name&&null!=b[w].style_selected&&null!=b[w].style_selected.Name&&(h=b[w].style_selected.Name);g.children.push({name:c[t].Name,layerType:"imagewms",visible:!1,select:!0,url:H,params:{LAYERS:c[t].Name,VERSION:"1.3.0",STYLES:h,TIMESTAMP:(new Date).getTime()},service_options:e.oFormValues[p].service_options,
service_login:e.oFormValues[p].service_login,service_password:e.oFormValues[p].service_password,index:t+1})}f.map_options.tree.children.push(g);f.style.height=$("#"+m).find("#service_layers_layers_ol").height()+"px";d.initOL3TestService=function(){setTimeout(function(){var a=angular.element($("#"+m).find("#service_layers_layers_ol_formreader").find("#layer_test_map")).scope();a.$applyAsync(function(){a.oMap.bLayersTreeOpen=!0});N.$root.$on("layerStyleChanged",function(b,c){b=a.oMap.aTree[1].layers;
for(var d=0;d<b.length;d++)if(b[d].name===c.name){b[d].params.STYLES=c.style_selected.Name;var e=b[d].olLayer.s().gc;e.STYLES=c.style_selected.Name;b[d].olLayer.s().updateParams(e)}})})};a.update.initEvent="initOL3TestService()";d.ctrl.setDefinitionName("update");d.ctrl.setFormValues({display:{},insert:{},update:{}});d.ctrl.setFormDefinition(a);d.ctrl.loadForm()}})}})});$(g).on("hide.bs.modal",function(){e.oSelectedObject=T;e.sMode=U;e.sFormDefinitionName=p;N.$destroy()})})}}var d=angular.element(v.X).injector().get(["$compile"]),
f=angular.element(v.X).injector().get(["$templateRequest"]),h=angular.element(v.X).injector().get(["$translate"]),m=angular.element(v.X).injector().get(["uiGridConstants"]),p=e.sFormDefinitionName;a=null!=a?a:{};var H=null!=a.service_url?a.service_url:e.oFormValues[p].service_url,G=null!=a.capabilities?a.capabilities:null,L=null!=a.buttons?a.buttons:[];b.info("showLayerModalWindow");var N=this.$new(),T=g.getObject(e.oSelectedObject.name,g.getMode(e.oSelectedMode.mode_id)),U=e.sMode;e.oSelectedObject=
{actions:[],columns:[],mode_id:T.mode_id,name:T.name+"_wms_layers",sections:"",template_name:""};e.sMode="search";N.sSelectedObjectName=e.oSelectedObject.name;N.sFormDefinitionName=e.oSelectedObject.name;e.sFormDefinitionName=N.sFormDefinitionName;N.gridOptions="vmap_admin_map_vmap_services_wms_layers"===e.oSelectedObject.name?{enableRowSelection:!1,enableSelectAll:!1,enableRowHeaderSelection:!1,enableFullRowSelection:!1,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:k.rows_per_page,
enableColumnMenus:!1,enableColumnResizing:!0,paginationPageSizes:[10,20,50,100],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!1,appHeaderOptionBar:!1,appLoadGridData:!1,appGridTitle:"TITLE_GRID_VMAP_MAP_LAYER_WMS_LAYERS",appResizeGrid:!0,appFooter:!1,appShowPagination:!1,appActions:[]}:{enableRowSelection:!0,enableSelectAll:!0,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!1,paginationPageSize:k.rows_per_page,enableColumnMenus:!1,enableColumnResizing:!0,paginationPageSizes:[10,
20,50,100],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!1,appHeaderOptionBar:!1,appLoadGridData:!1,appGridTitle:"TITLE_GRID_VMAP_MAP_LAYER_WMS_LAYERS",appResizeGrid:!0,appFooter:!0,appShowPagination:!0,appActions:[],appEnableCsvExport:!1};h(["FORM_NAME_VMAP_MAP_LAYER_WMS_LAYERS","FORM_CRS_VMAP_MAP_LAYER_WMS_LAYERS","FORM_DESCRIPTION_VMAP_MAP_LAYER_WMS_LAYERS"]).then(function(a){N.gridOptions.columnDefs=[{name:a.FORM_NAME_VMAP_MAP_LAYER_WMS_LAYERS,displayName:a.FORM_NAME_VMAP_MAP_LAYER_WMS_LAYERS,
field:"name",width:250,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+"_name",sort:{direction:m.ASC,ignoreSort:!0,priority:0}},{name:a.FORM_DESCRIPTION_VMAP_MAP_LAYER_WMS_LAYERS,displayName:a.FORM_DESCRIPTION_VMAP_MAP_LAYER_WMS_LAYERS,field:"description",width:350,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+"_crs_list"},
{name:"Style",displayName:"Style",field:"style",width:180,enableSorting:!1,type:"object",enableColumnMoving:!1,enableColumnResizing:!1,headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+"_style",cellTemplate:"<div data-app-style-list-column></div>"},{name:a.FORM_CRS_VMAP_MAP_LAYER_WMS_LAYERS,displayName:a.FORM_CRS_VMAP_MAP_LAYER_WMS_LAYERS,field:"crs_list",width:180,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+
"_crs_list",cellTemplate:'<div data-app-crs-list-description-column="{{row.entity[col.field]}}"></div>'},{name:"oLayer",visible:!1}]});h(["BTN_ADD_VMAP_MAP_MAP_LAYERS"]).then(function(){N.gridOptions.appActions=L});null!=G?c(G):null!=H&&N.$root.getCapabilities(H,{version:a.service_version}).then(function(a){G=a;null!=G?null!=G.xml&&null!=G.json&&c(a):e.sFormDefinitionName=p})};angular.element(v.f).scope().getCapabilities=function(c,d){function e(a){A({method:"GET",url:k.proxy_url,params:{url:a},scope:g,
responseType:"text",success:function(b){var c;if(""==b.data)d.showErrorMessage&&(b={className:"modal-danger",message:"ERROR_CONTENT_NO_DATA_VMAP_MAP_LAYER_WMS_LAYERS"},g.modalWindow("dialog","ERROR_TITLE_GET_CAPABILITIES_VMAP_MAP_LAYER_WMS_LAYERS",b));else{c={xml:f(b.data)};var e=(new DOMParser).parseFromString(f(b.data),"text/xml");if(null===e.querySelector("Service")){c=null;if(0==b.data.status&&null!=b.data.sMessage)var h='<a href="'+a+'" target="_blank">'+a+"</a><br><br>",h=h+b.data.sMessage;
null!=h||(h=null!=e.querySelector("BODY")?null!=e.querySelector("BODY").textContent?e.querySelector("BODY").textContent:$(e).find("body").html():$(e).find("body").html());d.showErrorMessage&&(b={className:"modal-danger",message:h},g.modalWindow("dialog","ERROR_TITLE_GET_CAPABILITIES_VMAP_MAP_LAYER_WMS_LAYERS",b))}else c.json=(new cu).read(f(b.data))}m.resolve(c)}})}function f(a){"string"==typeof a&&(a=a.replace(/&gt;/ig,">"),a=a.replace(/&lt;/ig,"<"),a=a.replace(/&#039;/g,"'"),a=a.replace(/&quot;/ig,
'"'),a=a.replace(/&amp;/ig,"&"));return a}b.info("getCapabilities");var g=this,m=a.defer(),p=m.promise,t={showErrorMessage:!0,version:"1.3.0"};"undefined"!=typeof d&&mb(t,d);d=t;null!=d.version||(d.version="1.3.0");null!=d.showErrorMessage||(d.showErrorMessage=!0);c=-1===c.indexOf("?")?c+"?":c+"&";c+="service=wms&version="+d.version+"&request=GetCapabilities&no_cache="+(new Date).getTime();(new RegExp(/\[token\]/)).test(c)?(c=c.replace(/\[token\]/,$c(h.token)),A({method:"GET",url:k.web_server_name+
"/"+k.services_alias+"/vm4ms/wmsservices/private/MapFile",params:{creation:!0,type:"prod"},scope:g,success:function(){e(c)}})):e(c);return p};angular.element(v.f).scope().addLayersToLayer=function(a){b.info("addLayersToLayer");var c=angular.element("form[name='"+e.oFormDefinition[a].name+"'] .ui-grid-form-field-data").scope().$parent.gridOptions,d=this.$root.gridApi[e.sSelectedGridOptionsName].selection.getSelectedRows();if(0<d.length){var f=0,g=e.oFormValues[a].layer_list,g="string"==typeof g?g.split(","):
[],h=e.oFormValues[a].layer_options;"string"===typeof h?h=JSON.parse(h):"object"!==typeof h?h={}:null!=h||(h={});var k={};null!=h&&null!=h.layer_style&&(k=h.layer_style);for(f=d.length-1;0<=f;f--)delete d[f].$$hashKey,-1===g.indexOf(d[f].name)?(null!=d[f].name&&g.unshift(d[f].name),k[d[f].name]=d[f].style_selected):($.notify("Calque d\u00e9j\u00e0 pr\u00e9sent: "+d[f].name,"warning"),d.splice(f,1));g=this.cleanLayersArray(g);h.layer_style=k;c.data=c.data.concat(d);c.totalItems=c.data.length;e.oFormValues[a].layer_list=
g.join(",");e.oFormValues[a].layer_options=JSON.stringify(h);var m=[];this.gridOptions.data.forEach(function(a){-1==d.indexOf(a)&&m.push(a)});this.$root.gridApi[e.sSelectedGridOptionsName].selection.clearSelectedRows();this.gridOptions.data=m}this.$root.$broadcast("addLayersToLayer")};angular.element(v.f).scope().cleanLayersArray=function(a){for(var b=a.length-1;0<=b;b--)r(a[b])?0===a[b].trim().length&&a.splice(b,1):a.splice(b,1);return a};angular.element(v.f).scope().updateLayerLayersSorting=function(){b.info("updateLayerLayersSorting");
var a=e.sFormDefinitionName;if(null==e.oFormValues[a])return 0;var c=angular.element("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"'] .ui-grid-form-field-data").scope().$parent.gridOptions.data;if(0<c.length){for(var d=[],f=c.length-1;0<=f;f--)null!=c[f].name&&d.push(c[f].name);d=this.cleanLayersArray(d);e.oFormValues[a].layer_list=d.join(",")}};angular.element(v.f).scope().removeLayersOfLayer=function(){b.info("removeLayersOfLayer");var a=angular.element("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+
"'] .ui-grid-form-field-data").scope().$parent.gridOptions,c=e.oFormValues[e.sFormDefinitionName].layer_options,c="string"===typeof c?JSON.parse(c):{},d={};null!=c&&null!=c.layer_style&&(d=c.layer_style);var f=a.gridApi.selection.getSelectedRows();if(0<f.length){var g=[],h=[];a.data.forEach(function(a){-1===f.indexOf(a)?(g.push(a),h.unshift(a.name)):null!=d[a.name]&&delete d[a.name]});c.layer_style=d;h=this.cleanLayersArray(h);e.oFormValues[e.sFormDefinitionName].layer_list=h.join(",");e.oFormValues[e.sFormDefinitionName].layer_options=
JSON.stringify(c);a.gridApi.selection.clearSelectedRows();a.data=g}};angular.element(v.f).scope().loadVmapConfig=function(){var a=angular.element(v.X).injector().get(["envSrvc"]);angular.element(v.X).injector().get(["propertiesSrvc"]);b.info("loadVmapConfig");angular.element(v.f).scope().setPropertiesFormValues("vmap popup print selection controls snapping".split(" "));var c=a.oSelectedObject.name;this.oFormRequestParams={sUrl:"modules/vmap/forms/"+a.oSelectedMode.mode_id+"/"+c+"_"+a.oSectionForm[c].sections[a.oSectionForm[c].iSelectedSectionIndex].name+
".json"}};angular.element(v.f).scope().loadStudioVmap=function(a){var c=angular.element(v.X).injector().get(["envSrvc"]),d=angular.element(v.X).injector().get(["propertiesSrvc"]);b.info("loadStudioVmap");var e="title subtitle label checkbox radio textarea select list double_select date datetime tinymce codemirror hidden text password email url integer float button color_picker slider hr map_osm map_bing map_vmap imageurl image_wsdata linkurl file_wsdata bo_grid section_grid".split(" ");if("business_object"===
a)var f={avaliable_elems:e,avaliable_form_types:["display","search","update","insert"],default_form_type:"update",get:{api:"vmap",ressource:"businessobjects",no_result_function:"suggestGenerateForm"},reset_default_function:"suggestColumnsToGenerateForm"};"layer_filter"===a&&(f={avaliable_elems:e,avaliable_form_types:["search"],default_form_type:"search",get:{api:"vmap",ressource:"layers",no_result_function:"useEmptyForm"}});Z.reset();Z.setId(c.sId);Z.setApplication("vmap");Z.setToken(h.token);Z.setContainer("#container_section_"+
c.oSelectedObject.name+"_studio");Z.setAppProperties(d);null!=f&&Z.yj(f)};angular.element(v.f).scope().showStudioIfLayerIsFiltered=function(){var a=angular.element(v.X).injector().get(["envSrvc"]);b.info("showStudioIfLayerIsFiltered");setTimeout(function(){null!=a.oFormValues.vmap_admin_map_vmap_layers_general_update_form&&(a.oFormValues.vmap_admin_map_vmap_layers_general_update_form.is_filtered?$("#container_mode_vmap_admin_map").find(".section-form-edit-first").find(".section-form-section").show():
$("#container_mode_vmap_admin_map").find(".section-form-edit-first").find(".section-form-section").hide());"insert"===a.sMode&&$("#container_mode_vmap_admin_map").find(".section-form-edit-first").find(".section-form-section-insert").hide()},500)};angular.element(v.f).scope().importVex=function(){var a=angular.element(v.X).injector().get(["$compile"]),b=this,c=!1,e=sessionStorage.privileges.split(",");q(e)&&-1!==e.indexOf("vitis_admin")&&-1!==e.indexOf("vmap_admin")&&-1!==e.indexOf("vm4ms_admin")&&
(c=!0);d(["CTRL_IMPORT_VEX_ERROR_INSUFFICIENT_PRIVILEGES","CTRL_IMPORT_VEX_ERROR_INSUFFICIENT_PRIVILEGES_DESCRIPTION","CTRL_IMPORT_VEX_IMPORT_TITLE","CTRL_IMPORT_VEX_LOADING"]).then(function(d){if(!c)return b.modalWindow("dialog",d.CTRL_IMPORT_VEX_ERROR_INSUFFICIENT_PRIVILEGES,{className:"modal-danger",message:d.CTRL_IMPORT_VEX_ERROR_INSUFFICIENT_PRIVILEGES_DESCRIPTION}),0;var e=bootbox.dialog({size:"large",title:d.CTRL_IMPORT_VEX_IMPORT_TITLE,message:'<div app-import-vex id="import-vex">'+d.CTRL_IMPORT_VEX_LOADING+
"</div>"});e.init(function(){setTimeout(function(){var c=e.find(".bootbox-body");a(c)(b)},1E3)})})};angular.element(v.f).scope().exportVex=function(){var a=angular.element(v.X).injector().get(["$compile"]),b=this,c=!1,e=sessionStorage.privileges.split(",");q(e)&&-1!==e.indexOf("vitis_admin")&&-1!==e.indexOf("vmap_admin")&&-1!==e.indexOf("vm4ms_admin")&&(c=!0);d(["CTRL_EXPORT_VEX_ERROR_INSUFFICIENT_PRIVILEGES","CTRL_EXPORT_VEX_ERROR_INSUFFICIENT_PRIVILEGES_DESCRIPTION","CTRL_EXPORT_VEX_EXPORT_TITLE",
"CTRL_EXPORT_VEX_LOADING"]).then(function(d){if(!c)return b.modalWindow("dialog",d.CTRL_EXPORT_VEX_ERROR_INSUFFICIENT_PRIVILEGES,{className:"modal-danger",message:d.CTRL_EXPORT_VEX_ERROR_INSUFFICIENT_PRIVILEGES_DESCRIPTION}),0;var e=bootbox.dialog({size:"large",title:d.CTRL_EXPORT_VEX_EXPORT_TITLE,message:'<div app-export-vex id="export-vex">'+d.CTRL_EXPORT_VEX_LOADING+"</div>"});e.init(function(){setTimeout(function(){var c=e.find(".bootbox-body");a(c)(b)},1E3)})})};angular.element(v.f).scope().checkBoSchema=
function(){var a=angular.element(v.Wb).injector().get(["$q"]);b.info("checkBoSchema");for(var c=this,f=a.defer(),g=e.oFormValues[e.sFormDefinitionName].schema,a=["s_vmap","s_vitis","s_vm4ms","s_majic","s_cadastre"],h=!1,k=0;k<a.length;k++)g===a[k]&&(h=!0,d(["CREATE_BO_ON_UNRECOMMENDED_SCHEMA1","CREATE_BO_ON_UNRECOMMENDED_SCHEMA2","CREATE_BO_ON_UNRECOMMENDED_SCHEMA3"]).then(function(a){c.modalWindow("confirm","",{className:"modal-warning",message:"<b>"+a.CREATE_BO_ON_UNRECOMMENDED_SCHEMA1+g+a.CREATE_BO_ON_UNRECOMMENDED_SCHEMA2+
"<br>"+a.CREATE_BO_ON_UNRECOMMENDED_SCHEMA3+"</b>",callback:function(a){a?f.resolve():f.reject()}})}));h||setTimeout(function(){f.resolve()});return f.promise};v.Vx=function(a){return{link:function(b,c,d){var e=d.$observe("appBusinessObjectEventDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["FORM_DESCRIPTION_VMAP_BUSINESS_OBJECT_EVENT"]).then(function(a){$(c).popover({trigger:"hover",
container:"body",title:function(){return a.FORM_DESCRIPTION_VMAP_BUSINESS_OBJECT_EVENT},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};v.Vx.$inject=["$translate"];v.compileProvider.directive("appBusinessObjectEventDescriptionColumn",v.Vx);angular.element(v.f).scope().checkVmapLayerWmsLayers=function(){var a=angular.element(v.X).injector().get(["$translate"]);
b.info("checkVmapLayerWmsLayers");var c=this,d=e.oFormValues[e.sFormDefinitionName].service_url,f=e.oFormValues[e.sFormDefinitionName].service_type_version,d=d.replace("[token]",$c(h.token)),d=d.replace("[ms_cgi_url]",k.ms_cgi_url);c.$root.getCapabilities(d,{version:f}).then(function(b){if(null!=b&&null!=b.xml&&null!=b.json){var d=[],f=function(a){if(void 0===a.Layer)d.push(a.Name);else for(var b=0;b<a.Layer.length;b++)f(a.Layer[b])};if("undefined"!=typeof b){var g=[],h=e.oFormValues[e.sFormDefinitionName].layer_list;
null!=h&&(g=h.split(","));var k=[];f(b.json.Capability.Layer);for(b=0;b<g.length;b++)-1==d.indexOf(g[b])&&k.push(g[b]);0==k.length?a("FORM_BTN_CHECK_LAYERS_SUCCESSFUL_VMAP_MAP_LAYER").then(function(a){$.notify(a,"success")}):a("FORM_BTN_CHECK_LAYERS_ERROR_MESSAGE_VMAP_MAP_LAYER").then(function(a){c.$root.modalWindow("dialog","FORM_BTN_CHECK_LAYERS_ERROR_TITLE_VMAP_MAP_LAYER",{className:"modal-danger",message:a+"<br>- "+k.join("<br>- "),html:!0})})}}})};angular.element(v.f).scope().deleteVmapBusinessObject=
function(){var a=angular.element(v.X).injector().get(["$rootScope"]);b.info("deleteVmapBusinessObject");a.DeleteSelection({sMessage:"LIST_DELETE_CONFIRM_VMAP_BUSINESS_OBJECT"})}});v.EE=function(a,b,c,d,e,f,g,h,k,m,p){a.info("initWmsServiceTests");b.aWmsServiceTestTabs={get_capabilities:{loaded:!1},openlayers_test:{loaded:!1},maplayer_test:{loaded:!1},mapserver_log:{loaded:!1,file_content:""},map_file:{loaded:!1}};p.addScopeToObject(h.oSelectedObject.name,h.oSelectedMode.mode_id,b);b.showWmsServiceGetCapabilities=function(c){a.info("showWmsServiceGetCapabilities");if(null!=g.ms_cgi_url&&""!=g.ms_cgi_url){if(!b.aWmsServiceTestTabs.get_capabilities.loaded||!0===c){c=new FormData;
c.append("wmsservice_id",h.sId);c.append("type","test");if("undefined"!=typeof h.oFormValues[h.sFormDefinitionName]){var d=h.oFormValues[h.sFormDefinitionName].wms_service_login,f=h.oFormValues[h.sFormDefinitionName].wms_service_password;null!=d&&null!=f&&(c.append("user_login",d),c.append("user_password",f))}A({method:"POST",url:g.web_server_name+"/"+g.services_alias+"/vm4ms/WmsServices/MapFile",data:c,scope:b,success:function(a){if(1==a.data.status){var c=h.extractWebServiceData("wmsservices",a.data)[0],
d=g.ms_cgi_url+"/test/"+c.map_file_hash;h.sId!=g.private_wms_service&&(d+="_"+c.wmsservice_id);b.aWmsServiceTestTabs.map_file_hash=c.map_file_hash;b.$root.getCapabilities(d,{showErrorMessage:!1}).then(function(a){null!=a?(b.aWmsServiceTestTabs.get_capabilities.oCodeMirrorEditor.setValue(a.xml),b.oGetCapabilities=a,b.oGetCapabilities.service_url=d,"undefined"!=typeof c.layers_sources&&(b.oGetCapabilities.layers_sources=c.layers_sources)):e(function(){document.querySelector(".wms-service-tests .nav-tabs > li:nth-child(1)").style.display=
"none";document.querySelector(".wms-service-tests .nav-tabs > li:nth-child(2)").style.display="none";document.querySelector(".wms-service-tests .nav-tabs > li:nth-child(3)").style.display="none";document.querySelector(".wms-service-tests .nav-tabs > li > a[aria-controls='wms_service_tests_wms_service_log']").click()})})}else{delete b.oGetCapabilities;b.clearWmsServiceTestsTabs();b.aWmsServiceTestTabs.get_capabilities.loaded=!1;b.aWmsServiceTestTabs.openlayers_test.loaded=!1;b.aWmsServiceTestTabs.maplayer_test.loaded=
!1;var f={className:"modal-danger"};null!=a.data.errorMessage&&(f.message=a.data.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",f)}}});b.aWmsServiceTestTabs.get_capabilities.loaded=!0}}else b.$root.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:"ERROR_MS_CGI_URL_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG"})};b.testWmsServiceWithOpenLayers=function(e){a.info("testWmsServiceWithOpenLayers");null!=g.ms_cgi_url&&""!=g.ms_cgi_url?b.aWmsServiceTestTabs.openlayers_test.loaded&&
!0!==e||"undefined"==typeof b.oGetCapabilities||"undefined"==typeof b.oGetCapabilities.json||(b.sFormDefinitionName=h.sFormDefinitionName+"_openlayers_test",b.oFormRequestParams={sUrl:"modules/"+h.oSelectedMode.module_name+"/forms/"+h.oSelectedMode.mode_id+"/vm4ms_vm4ms_web_service_openlayers_test.json"},$("#wms_service_tests_wms_service_ol_map").empty(),c("templates/formTpl.html").then(function(a){d($("#wms_service_tests_wms_service_ol_map").html(a).contents())(b);var c=b.$root.$on("formDefinitionLoaded",
function(){c();var a=b.$root.proj.projections[0].code;"undefined"!=typeof b.oGetCapabilities.json.Capability.Layer&&b.$root.proj.projections.forEach(function(c){c=b.oGetCapabilities.json.Capability.Layer.CRS.indexOf(c.code);-1!=c&&"undefined"==typeof a&&(a=b.oGetCapabilities.json.Capability.Layer.CRS[c])});var d=m.getFormElementDefinition("wms_service_test_map",b.sFormDefinitionName);d.map_options.bLayersTreeOpen=!0;d.map_options.proj=a;d.map_options.tree.children[0].view.projection=a;PA.prototype.tm();
if(null!=b.oGetCapabilities.json.Capability.Layer)d.map_options.center.extent=uh(b.oGetCapabilities.json.Capability.Layer.EX_GeographicBoundingBox,"EPSG:4326",a);else{var e={"EPSG:3857":[-1901744.2199433097,4779520.942381757,2501744.2199433097,7220479.057618243],"EPSG:2154":[-2648.2345550218597,6231825.554877603,7024177.333740164,7024177.333740164],"EPSG:4326":[-4.6307373046875,42.802734375,51.0205078125,51.0205078125]};null!=e[a]&&(d.map_options.center.extent=e[a])}d.map_options.tree.children[0].view.extent=
d.map_options.center.extent;if("undefined"!=typeof b.oGetCapabilities.json.Capability.Layer){var g={name:"Service",children:[]},e=angular.copy(b.oGetCapabilities.json.Capability.Layer.Layer);e.sort(function(a,b){return a.Name.localeCompare(b.Name)});e.forEach(function(a,c){c={name:a.Name,layerType:"imagewms",visible:!1,legend:"true",select:!0,url:b.oGetCapabilities.service_url,params:{LAYERS:a.Name,VERSION:"1.3.0",TIMESTAMP:(new Date).getTime()},index:c+1};"undefined"!=typeof b.oGetCapabilities.layers_sources[a.Name]&&
(c.attributions=[new zp({html:b.oGetCapabilities.layers_sources[a.Name]})]);g.children.push(c)});d.map_options.tree.children.push(g)}var h=b.$root.$on("OpenLayersMapCreated",function(a,c){h();c.ca.ad(new qj);b.aEventKey=[];c.ca.getLayers().P().forEach(function(a){a instanceof ht&&(b.aEventKey[b.aEventKey.length]=a.s().on(["imageloaderror","tileloaderror"],function(a){f.displayLayerLoadingError(a)}))})})})}),b.aWmsServiceTestTabs.openlayers_test.loaded=!0):b.$root.modalWindow("dialog","REQUEST_ERROR",
{className:"modal-danger",message:"ERROR_MS_CGI_URL_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG"})};b.testWmsServiceWithMapServer=function(c){a.info("testWmsServiceWithMapServer");null!=g.ms_cgi_url&&""!=g.ms_cgi_url?b.aWmsServiceTestTabs.maplayer_test.loaded&&!0!==c||"undefined"==typeof b.oGetCapabilities||"undefined"==typeof b.oGetCapabilities.json||"undefined"==typeof b.oGetCapabilities.json.Capability.Layer||(b.aMSTestLayers=[],$("#wms_service_tests_layer_select_modal").modal("show"),b.testWmsServiceSelectedLayersWithMapServer=
function(c){a.info("testWmsServiceSelectedLayersWithMapServer",c);$("#wms_service_tests_layer_select_modal").modal("hide");b.aWmsServiceTestTabs.map_file;var d=g.ms_cgi_url+"/test/"+b.aWmsServiceTestTabs.map_file_hash;h.sId!=g.private_wms_service&&(d+="_"+h.sId);c=d+"?ms_cgi_url="+g.ms_cgi_url+"&LAYERS="+c.join(" ")+"&no_cache="+(new Date).getTime();d=document.getElementById("wms_service_tests_wms_service_mapserver");null!==d&&(c+="&MAPSIZE="+(parseInt(.75*d.clientWidth)-23)+"+"+(d.clientHeight-83));
document.getElementById("wms_service_tests_wms_service_ms_iframe").contentWindow.location.href=c;b.aWmsServiceTestTabs.maplayer_test.loaded=!0;$("#wms_service_tests_wms_service_ms_iframe").load(function(){var a=this;$("link").each(function(){if("stylesheet"===this.rel&&"text/css"===this.type){var b=document.createElement("link");b.href=this.href;b.rel="stylesheet";b.type="text/css";a.contentWindow.document.body.appendChild(b)}});this.contentWindow.document.body.style.overflow="auto"})},b.testWmsServiceSelectAllLayers=
function(){b.aMSTestLayers=[];b.oGetCapabilities.json.Capability.Layer.Layer.forEach(function(a){b.aMSTestLayers.push(a.Name)})}):b.$root.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:"ERROR_MS_CGI_URL_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG"})};b.$root.refreshWmsServiceTestsTab=function(){a.info("refreshWmsServiceTestsTab");var c=h.oFormValues[h.sFormDefinitionName].wms_service_login,d=h.oFormValues[h.sFormDefinitionName].wms_service_password,e=angular.element("form[name='"+
h.oFormDefinition[h.sFormDefinitionName].name).scope(),f=!0;e[h.oFormDefinition[h.sFormDefinitionName].name].wms_service_login.$setValidity("wms_service_login",!0);e[h.oFormDefinition[h.sFormDefinitionName].name].wms_service_password.$setValidity("wms_service_password",!0);if(null!=c&&""!=c||null!=d&&""!=d){if(null==c||""==c)e[h.oFormDefinition[h.sFormDefinitionName].name].wms_service_login.$setValidity("wms_service_login",!1),e[h.oFormDefinition[h.sFormDefinitionName].name].wms_service_login.$setDirty(),
f=!1;if(null==d||""==d)e[h.oFormDefinition[h.sFormDefinitionName].name].wms_service_password.$setValidity("wms_service_password",!1),e[h.oFormDefinition[h.sFormDefinitionName].name].wms_service_password.$setDirty(),f=!1}f&&($(".wms-service-tests a[href='#wms_service_tests_get_capabilities']").tab("show"),b.showWmsServiceGetCapabilities(!0),b.aWmsServiceTestTabs.openlayers_test.loaded=!1,b.aWmsServiceTestTabs.maplayer_test.loaded=!1,b.aWmsServiceTestTabs.mapserver_log.loaded=!1,b.aWmsServiceTestTabs.map_file.loaded=
!1)};b.clearWmsServiceTestsTabs=function(){a.info("clearWmsServiceTestsTabs");b.aWmsServiceTestTabs.get_capabilities.oCodeMirrorEditor.setValue("");document.getElementById("wms_service_tests_wms_service_ms_iframe").contentWindow.location.href="about:blank";$("#wms_service_tests_wms_service_ol_map").empty()};b.loadWmsServiceMapServerLog=function(c){a.info("loadWmsServiceMapServerLog");b.aWmsServiceTestTabs.mapserver_log.loaded&&!0!==c||(A({method:"GET",url:g.web_server_name+"/"+g.services_alias+"/vm4ms/wmsservices/"+
h.sId+"/MapServerLog",scope:b,success:function(a){if(1==a.data.status)a=h.extractWebServiceData("wmsservices",a.data)[0],b.aWmsServiceTestTabs.mapserver_log.file_content=a.log_file_content;else{var c={className:"modal-danger"};null!=a.data.errorMessage&&(c.message=a.data.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",c)}}}),b.aWmsServiceTestTabs.mapserver_log.loaded=!0)};b.loadWmsServiceMapFile=function(c){a.info("loadWmsServiceMapFile");b.aWmsServiceTestTabs.map_file.loaded&&!0!==c||(A({method:"GET",
url:g.web_server_name+"/"+g.services_alias+"/vm4ms/wmsservices/"+h.sId+"/MapFile",params:{wmsservice_id:h.sId,type:"test"},scope:b,success:function(a){if(1==a.data.status)a=h.extractWebServiceData("wmsservices",a.data)[0],b.aWmsServiceTestTabs.map_file.oCodeMirrorEditor.setValue(a.map_file_content);else{var c={className:"modal-danger"};null!=a.data.errorMessage&&(c.message=a.data.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",c)}}}),b.aWmsServiceTestTabs.map_file.loaded=!0)}};
v.EE.$inject="$log $scope $templateRequest $compile $timeout $rootScope propertiesSrvc envSrvc sessionSrvc formSrvc modesSrvc".split(" ");v.module.controller("wmsServiceTestsCtrl",v.EE);v.$A=function(a,b,c,d,e,f,g,h,k,m){a.info("initLayerTests");b.aLayerTestTabs={get_capabilities:{},openlayers_test:{loaded:!1},maplayer_test:{loaded:!1},mapserver_log:{loaded:!1,file_content:""},map_file:{loaded:!1}};m.addScopeToObject(g.oSelectedObject.name,g.oSelectedMode.mode_id,b);b.testLayerWithOpenLayers=function(e){a.info("testLayerWithOpenLayers");null!=f.ms_cgi_url&&""!=f.ms_cgi_url?b.aLayerTestTabs.openlayers_test.loaded&&!0!==e||"undefined"==typeof b.oGetCapabilities||"undefined"==typeof b.oGetCapabilities.json||
(b.sFormDefinitionName=g.sFormDefinitionName+"_openlayers_test",b.oFormRequestParams={sUrl:"modules/"+g.oSelectedMode.module_name+"/forms/"+g.oSelectedMode.mode_id+"/vm4ms_vm4ms_layer_openlayers_test.json"},$("#layer_tests_layer_ol_map").empty(),c("templates/formTpl.html").then(function(a){d($("#layer_tests_layer_ol_map").html(a).contents())(b);var c=b.$root.$on("formDefinitionLoaded",function(){c();var a=b.$root.proj.projections[0].code;"undefined"!=typeof b.oGetCapabilities.json.Capability.Layer&&
b.$root.proj.projections.forEach(function(c){c=b.oGetCapabilities.json.Capability.Layer.CRS.indexOf(c.code);-1!=c&&"undefined"==typeof a&&(a=b.oGetCapabilities.json.Capability.Layer.CRS[c])});var d=k.getFormElementDefinition("layer_test_map",b.sFormDefinitionName);d.map_options.proj=a;d.map_options.tree.children[0].view.projection=a;PA.prototype.tm();"undefined"!=typeof b.oGetCapabilities.json.Capability.Layer&&(d.map_options.center.extent=uh(b.oGetCapabilities.json.Capability.Layer.EX_GeographicBoundingBox,
"EPSG:4326",a));d.map_options.tree.children[0].view.extent=d.map_options.center.extent;"undefined"!=typeof b.oGetCapabilities.json.Capability.Layer&&b.oGetCapabilities.json.Capability.Layer.Layer.forEach(function(a,c){c={name:a.Name,children:[{name:a.Name,layerType:"imagewms",visible:!0,select:!0,url:b.oGetCapabilities.service_url,params:{LAYERS:a.Name,VERSION:"1.3.0",TIMESTAMP:(new Date).getTime()},index:c+1}]};"undefined"!=typeof b.oGetCapabilities.layers_sources[a.Name]&&(c.children[0].attributions=
[new zp({html:b.oGetCapabilities.layers_sources[a.Name]})]);d.map_options.tree.children.push(c)});var e=b.$root.$on("OpenLayersMapCreated",function(a,c){e();c.ca.ad(new qj);b.aEventKey=[];c.ca.getLayers().P().forEach(function(a){a instanceof ht&&(b.aEventKey[b.aEventKey.length]=a.s().on(["imageloaderror","tileloaderror"],function(a){b.$root.displayLayerLoadingError(a)}))})})})}),b.aLayerTestTabs.openlayers_test.loaded=!0):b.$root.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:"ERROR_MS_CGI_URL_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG"})};
b.testLayerWithMapServer=function(c){a.info("testLayerWithMapServer");if(null!=f.ms_cgi_url&&""!=f.ms_cgi_url)if(b.aLayerTestTabs.maplayer_test.loaded&&!0!==c)document.getElementById("layer_tests_layer_ms_iframe").contentWindow.document.body.style.overflow="hidden",setTimeout(function(){document.getElementById("layer_tests_layer_ms_iframe").contentWindow.document.body.style.overflow="auto"},100);else{if("undefined"!=typeof b.oGetCapabilities&&"undefined"!=typeof b.oGetCapabilities.json){$("#layer_tests_layer_ms_iframe").load(function(){var a=
this;$("link").each(function(){if("stylesheet"===this.rel&&"text/css"===this.type){var b=document.createElement("link");b.href=this.href;b.rel="stylesheet";b.type="text/css";a.contentWindow.document.body.appendChild(b)}});this.contentWindow.document.body.style.overflow="auto"});var d=[];"undefined"!=typeof b.oGetCapabilities.json.Capability.Layer&&b.oGetCapabilities.json.Capability.Layer.Layer.forEach(function(a){d.push(a.Name)});c=b.oGetCapabilities.service_url+"?ms_cgi_url="+f.ms_cgi_url+"&LAYERS="+
d.join(" ")+"&no_cache="+(new Date).getTime();var e=document.getElementById("layer_tests_layer_mapserver");null!==e&&(c+="&MAPSIZE="+(parseInt(.75*e.clientWidth)-23)+"+"+(e.clientHeight-83));document.getElementById("layer_tests_layer_ms_iframe").contentWindow.location.href=c;b.aLayerTestTabs.maplayer_test.loaded=!0}}else b.$root.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:"ERROR_MS_CGI_URL_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG"})};b.clearLayerTestsTabs=function(){a.info("clearLayerTestsTabs");
document.getElementById("layer_tests_layer_ms_iframe").contentWindow.location.href="about:blank";$("#layer_tests_layer_ol_map").empty()};b.loadLayerMapServerLog=function(c){a.info("loadLayerMapServerLog");b.aLayerTestTabs.mapserver_log.loaded&&!0!==c||(A({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/vm4ms/layers/"+g.sId+"/MapServerLog",scope:b,success:function(a){if(1==a.data.status)a=g.extractWebServiceData("layers",a.data)[0],b.aLayerTestTabs.mapserver_log.file_content=a.log_file_content;
else{var c={className:"modal-danger"};null!=a.data.errorMessage&&(c.message=a.data.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",c)}}}),b.aLayerTestTabs.mapserver_log.loaded=!0)};b.loadLayerMapFile=function(c){a.info("loadLayerMapFile");b.aLayerTestTabs.map_file.loaded&&!0!==c||(A({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/vm4ms/Layers/"+ +g.sId+"/MapFile/",params:{ms_layer_id:g.sId,creation:!1},scope:b,success:function(a){if(1==a.data.status)a=g.extractWebServiceData("layers",
a.data)[0],b.oMapFileCodeMirrorEditor.setValue(a.map_file_content);else{var c={className:"modal-danger"};null!=a.data.errorMessage&&(c.message=a.data.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",c)}}}),b.aLayerTestTabs.map_file.loaded=!0)};h=new FormData;h.append("ms_layer_id",g.sId);if("undefined"!=typeof g.oFormValues[g.sFormDefinitionName]){m=g.oFormValues[g.sFormDefinitionName].layer_login;var p=g.oFormValues[g.sFormDefinitionName].layer_password;null!=m&&null!=p&&(h.append("user_login",
m),h.append("user_password",p))}A({method:"POST",url:f.web_server_name+"/"+f.services_alias+"/vm4ms/Layers/MapFile",data:h,scope:b,success:function(a){if(1==a.data.status){var c=g.extractWebServiceData("layers",a.data)[0],d=f.ms_cgi_url+"/test/"+c.map_file_hash+"_"+c.name;b.$root.getCapabilities(d,{showErrorMessage:!1}).then(function(a){null!=a?(b.oGetCapabilities=a,b.oGetCapabilities.service_url=d,"undefined"!=typeof c.layers_sources&&(b.oGetCapabilities.layers_sources=c.layers_sources),b.testLayerWithMapServer()):
e(function(){document.querySelector(".layer-tests .nav-tabs > li:nth-child(1)").style.display="none";document.querySelector(".layer-tests .nav-tabs > li:nth-child(2)").style.display="none";document.querySelector(".layer-tests .nav-tabs > li > a[aria-controls='layer_mapserver_log']").click()})})}else{delete b.oGetCapabilities;b.clearLayerTestsTabs();b.aLayerTestTabs.openlayers_test.loaded=!1;b.aLayerTestTabs.maplayer_test.loaded=!1;var h={className:"modal-danger"};null!=a.data.errorMessage&&(h.message=
a.data.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",h)}}})};v.$A.$inject="$log $scope $templateRequest $compile $timeout propertiesSrvc envSrvc sessionSrvc formSrvc modesSrvc".split(" ");v.module.controller("layerTestsCtrl",v.$A);v.HF=function(){return{restrict:"A",controller:"wmsServiceTestsCtrl",controllerAs:"ctrl",scope:!0,link:function(a,b){b[0].querySelector(".tab-content").style.height="calc(100% - 46px)";b=CodeMirror.fromTextArea(document.getElementById("wms_service_tests_get_capabilities_textarea"),{lineNumbers:!1,mode:"xml",readOnly:"true",indentUnit:4});a.aWmsServiceTestTabs.get_capabilities.oCodeMirrorEditor=b;b.setSize("100%","100%");a.showWmsServiceGetCapabilities();b=CodeMirror.fromTextArea(document.getElementById("wms_service_tests_wms_service_map_file_textarea"),
{lineNumbers:!0,mode:"map",indentUnit:4,readOnly:"true"});a.aWmsServiceTestTabs.map_file.oCodeMirrorEditor=b;b.setSize("100%","100%");a.$on("$destroy",function(){"undefined"!=typeof a.aEventKey&&0<a.aEventKey.length&&($d(a.aEventKey),a.aEventKey.length=0)})}}};v.module.directive("appWmsServiceTests",v.HF);
v.Hy=function(a,b,c,d){return{replace:!0,link:function(e,f){c.sId==d.private_wms_service&&a("templates/formTpl.html").then(function(a){b($(f).html(a).contents())(e);var c=e.$root.$on("formExtracted",function(){c();f[0].parentNode.parentNode.firstChild.style.height="Calc(100% - 60px)"})})}}};v.Hy.$inject=["$templateRequest","$compile","envSrvc","propertiesSrvc"];v.module.directive("appWmsServiceTestsConnectionForm",v.Hy);v.xF=function(){return{restrict:"A",controller:"layerTestsCtrl",controllerAs:"ctrl",scope:!0,link:function(a,b){document.querySelector(".layer-test-dialog-modal-window .bootbox-body").style.height="calc(100% - 3px)";b[0].querySelector(".tab-content").style.height="calc(100% - 46px)";a.oMapFileCodeMirrorEditor=CodeMirror.fromTextArea(document.getElementById("layer_map_file_textarea"),{lineNumbers:!0,mode:"map",indentUnit:4,readOnly:"true"});a.oMapFileCodeMirrorEditor.setSize("100%","100%");a.$on("$destroy",
function(){"undefined"!=typeof a.aEventKey&&0<a.aEventKey.length&&($d(a.aEventKey),a.aEventKey.length=0)})}}};v.module.directive("appLayerTests",v.xF);v.xB=function(a,b,c,d,e,f){a.info("initMapServerSymbols");b.loadMapServerSymbols=function(){a.info("loadMapServerSymbols");A({method:"GET",url:e.web_server_name+"/"+e.services_alias+"/vm4ms/mapserver/Symbols",scope:b,success:function(a){if(1==a.data.status){var c=f.extractWebServiceData("mapserver",a.data)[0],c=angular.copy(c.symbols_content);c.forEach(function(a,b){a.definition.forEach(function(a,d){c[b].definition[d]="<span>"+a.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;")+"</span>"})});
b.oMapServerSymbols=c}else{var d={className:"modal-danger"};null!=a.data.errorMessage&&(d.message=a.data.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",d)}}})};b.trustAsHtml=function(a){return d.trustAsHtml(a)};b.loadMapServerSymbols()};v.xB.$inject="$log $scope $timeout $sce propertiesSrvc envSrvc sessionSrvc".split(" ");v.module.controller("mapServerSymbolsCtrl",v.xB);v.BF=function(){return{restrict:"A",controller:"mapServerSymbolsCtrl",controllerAs:"ctrl",scope:!0}};v.module.directive("appMapServerSymbols",v.BF);v.AF=function(){return{replace:!0,link:function(a,b){a.$index&&$(b).parent().find(".collapse").collapse("hide")}}};v.module.directive("appMapServerSymbolsCollapse",v.AF);v.on("appMainDrtvLoaded",function(){v.Gy=function(a){return{link:function(b,c,d){var e=d.$observe("appWmsServiceDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP},content:function(){return b.row.entity[b.col.field]},
placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};v.Gy.$inject=["$translate"];v.compileProvider.directive("appWmsServiceDescriptionColumn",v.Gy);angular.element(v.f).scope().beforeSendingLayerForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.Wb).injector().get(["$q"]),c=angular.element(v.f).injector().get(["envSrvc"]),d=angular.element(v.f).injector().get(["propertiesSrvc"]);
a.info("beforeSendingLayerForm");var e=this,f=b.defer(),a=f.promise;A({method:"GET",url:d.web_server_name+"/"+d.services_alias+"/vm4ms/layerconnections/"+c.oFormValues[c.sFormDefinitionName].connection_id.selectedOption.value,scope:e,success:function(a){if(1==a.data.status)if(!1===c.oFormValues[c.sFormDefinitionName].private_connection&&!0===c.extractWebServiceData("layerconnections",a.data)[0]["private"]){var b={className:"modal-warning",message:"FORM_PRIVATE_CONNECTION_TOOLTIP_CONTENT_VM4MS_VM4MS_LAYER",
callback:function(a){a?f.resolve():f.reject()}};e.modalWindow("confirm","FORM_PRIVATE_CONNECTION_TOOLTIP_TITLE_VM4MS_VM4MS_LAYER",b)}else f.resolve();else b={className:"modal-danger",buttons:{ok:{label:"OK",className:"btn-default"}}},null!=a.data.errorMessage&&(b.message=a.data.errorMessage),e.modalWindow("alert","REQUEST_ERROR",b)}});return a};angular.element(v.f).scope().testVm4msLayer=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.X).injector().get(["$compile"]),
c=angular.element(v.X).injector().get(["$templateRequest"]),d=angular.element(v.f).injector().get(["envSrvc"]),e=angular.element(v.f).injector().get(["formSrvc"]),f=angular.element(v.f).injector().get(["propertiesSrvc"]);a.info("testVm4msLayer");var g=this;d.oFormValues[d.sFormDefinitionName].create_ws_map_file="false";d.oFormValues[d.sFormDefinitionName].test_layer=!0;var a=e.getFormData(d.sFormDefinitionName),h=d.oFormDefinition[d.sFormDefinitionName].name;angular.element("form[name='"+h+"']").scope()[h].appFormSubmitted=
!1;g.$root.sendSimpleForm(void 0,a).then(function(a){d.oFormValues[d.sFormDefinitionName].create_ws_map_file="true";d.oFormValues[d.sFormDefinitionName].test_layer=!1;if(a){var h;null!=f.test_wms_service&&""!=f.test_wms_service?null!=f.ms_cgi_url&&""!=f.ms_cgi_url||(h="ERROR_MS_CGI_URL_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG"):h="ERROR_TEST_WMS_SERVICE_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG";if("undefined"==typeof h){a=!0;h=d.oFormValues[d.sFormDefinitionName].layer_login;var k=d.oFormValues[d.sFormDefinitionName].layer_password,
t=d.oFormValues[d.sFormDefinitionName].private_connection,u=e.getFormElementDefinition("layer_login",d.sFormDefinitionName,d.oFormDefinition),w=e.getFormElementDefinition("layer_password",d.sFormDefinitionName,d.oFormDefinition);t&&(document.getElementById(u.id).parentNode.parentNode.parentNode.className="",document.getElementById(w.id).parentNode.parentNode.parentNode.className="",null!=h&&""!=h||null!=k&&""!=k)&&(null!=h&&""!=h||!t||(document.getElementById(u.id).parentNode.parentNode.parentNode.className=
"has-error",a=!1),null!=k&&""!=k||!t||(document.getElementById(w.id).parentNode.parentNode.parentNode.className="has-error",a=!1));a&&(a={className:"dialog-modal-window layer-test-dialog-modal-window",message:'<div id="layer_test_container" class="layer_test_container"></div>'},g.$root.modalWindow("dialog","FORM_MAP_SERVER_MODAL_TITLE_VM4MS_VM4MS_LAYER_DEFINITION",a).then(function(a){a[0].querySelector(".modal-title").innerHTML+=d.oFormValues[d.oSelectedObject.name+"_general_"+d.sMode+"_form"].name;
var e=document.querySelector("body").clientHeight-50;a[0].querySelector(".modal-dialog").style.width=document.querySelector("body").clientWidth-50+"px";a[0].querySelector(".modal-dialog").style.height=e+"px";a[0].querySelector(".modal-header").style.height="56px";a[0].querySelector(".modal-body").style.height=e-56-4+"px";c("modules/vm4ms/template/layerTestsTpl.html").then(function(a){b($("#layer_test_container").html(a).contents())(g)})}))}else a={className:"modal-danger",message:h},g.modalWindow("dialog",
"REQUEST_ERROR",a)}})};angular.element(v.f).scope().showAddLayersToWmsServiceModalWindow=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.X).injector().get(["$compile"]),c=angular.element(v.X).injector().get(["$templateRequest"]),d=angular.element(v.X).injector().get(["$translate"]),e=angular.element(v.f).injector().get(["envSrvc"]),f=angular.element(v.X).injector().get(["uiGridConstants"]),g=angular.element(v.f).injector().get(["modesSrvc"]),h=angular.element(v.f).injector().get(["propertiesSrvc"]);
a.info("showAddLayersToWmsServiceModalWindow");var k=this.$new();g.addScopeToObject(e.oSelectedObject.name,e.oSelectedMode.mode_id,k);var m=g.getObject(e.oSelectedObject.name,g.getMode(e.oSelectedMode.mode_id)),p=e.sMode,t=e.sSelectedGridOptionsName;e.oSelectedObject={actions:[],columns:[],mode_id:m.mode_id,name:m.name+"_available_layers",ressource_id:"vm4ms/publiclayers",sections:"",template_name:"",sorted_by:"name",sorted_dir:"ASC"};e.sMode="search";k.sSelectedObjectName=e.oSelectedObject.name;
k.gridOptions={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:h.rows_per_page,enableColumnMenus:!1,enableColumnResizing:!0,paginationPageSizes:[10,20,50,100],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!1,appHeaderOptionBar:!1,appLoadGridData:!0,appGridTitle:"TITLE_GRID_AVAILABLE_LAYERS_VM4MS_PUBLIC_WMS_SERVICE_LAYERS",appResizeGrid:!0,appFooter:!0,appShowPagination:!0,appActions:[]};d(["FORM_LAYER_ID_VM4MS_VM4MS_LAYER",
"FORM_LAYER_TITLE_VM4MS_VM4MS_LAYER","FORM_LAYER_NAME_VM4MS_VM4MS_LAYER"]).then(function(a){k.gridOptions.columnDefs=[{name:a.FORM_LAYER_ID_VM4MS_VM4MS_LAYER,displayName:a.FORM_LAYER_ID_VM4MS_VM4MS_LAYER,field:"ms_layer_id",width:40,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vm4ms_wms_service_layers_"+e.oSelectedObject.name+"_layer_id"},{name:a.FORM_LAYER_NAME_VM4MS_VM4MS_LAYER,displayName:a.FORM_LAYER_NAME_VM4MS_VM4MS_LAYER,field:"name",width:200,
enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vm4ms_wms_service_layers_"+e.oSelectedObject.name+"_name",sort:{direction:f.ASC,ignoreSort:!0,priority:0}},{name:a.FORM_LAYER_TITLE_VM4MS_VM4MS_LAYER,displayName:a.FORM_LAYER_TITLE_VM4MS_VM4MS_LAYER,field:"title",width:300,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vm4ms_wms_service_layers_"+e.oSelectedObject.name+"_title"}]});"display"!=e.sMode&&d(["BTN_ADD_LAYERS_VM4MS_PUBLIC_WMS_SERVICE_LAYERS"]).then(function(a){k.gridOptions.appActions=
[{label:a.BTN_ADD_LAYERS_VM4MS_PUBLIC_WMS_SERVICE_LAYERS,name:k.sSelectedObjectName+"_add_layer_btn",event:"addLayersToWmsService()"}]});a=e.oGridOptions[e.sSelectedGridOptionsName].data;if(0<a.length){d=0;for(g=[];d<a.length;)g.push(a[d].ms_layer_id),d++;e.oSelectedObject.filter={relation:"AND",operators:[{column:"ms_layer_id",compare_operator:"NOT IN",value:g}]}}var u="container_"+e.oSelectedObject.name+"_available_layers";k.modalWindow("dialog",null,{className:"dialog-modal-window dialog-modal-window-workspace-list dialog-modal-window-available-layers",
message:'<div id="'+u+'" class="col-xs-12"></div>'}).then(function(a){$(a).on("shown.bs.modal",function(){var a=document.querySelector(".dialog-modal-window-available-layers > .modal-dialog");a.className+=" modal-lg";c("templates/workspaceListTpl.html").then(function(a){b($("#"+u).html(a).contents())(k)})});$(a).on("hide.bs.modal",function(){e.oSelectedObject=m;e.sMode=p;e.sSelectedGridOptionsName=t;k.$root.refreshGrid(k.$root.gridApi[e.sSelectedGridOptionsName].grid.appScope,e.oGridOptions[e.sSelectedGridOptionsName])})})};
angular.element(v.f).scope().addLayersToWmsService=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$translate"]),c=angular.element(v.f).injector().get(["envSrvc"]),d=angular.element(v.f).injector().get(["propertiesSrvc"]);a.info("addLayersToWmsService");var e=this,a={wmsservice_id:c.sId},f=e.$root.gridApi[c.sSelectedGridOptionsName].selection.getSelectedRows();if(0<f.length){for(var g=0,h=[];g<f.length;)h.push(f[g].ms_layer_id),g++;a.wmsservice_ms_layers=
h.join("|");A({method:"PUT",url:d.web_server_name+"/"+d.services_alias+"/vm4ms/wmsservicelayers/"+c.sId,data:a,scope:e,success:function(a){0==a.data.status?e.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:a.data.errorMessage}):(bootbox.hideAll(),b("SUCCESSFUL_OPERATION").then(function(a){$.notify(a,"success")}),c.oSectionForm[c.oSelectedObject.name].sections.forEach(function(a){"tests"==a.name&&(a.bLoaded=!1)}))}})}};angular.element(v.f).scope().deleteWmsServiceLayers=function(){var a=
angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$translate"]),c=angular.element(v.f).injector().get(["envSrvc"]),d=angular.element(v.f).injector().get(["propertiesSrvc"]);a.info("deleteWmsServiceLayers");var e=this,a={wmsservice_id:c.sId},f=e.$root.gridApi[c.sSelectedGridOptionsName].selection.getSelectedRows();if(0<f.length){for(var g=0,h=[];g<f.length;)h.push(f[g].ms_layer_id),g++;a.idList=h.join("|");A({method:"DELETE",url:d.web_server_name+"/"+d.services_alias+
"/vm4ms/wmsservicelayers/"+c.sId,params:a,scope:e,success:function(a){0==a.data.status?e.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:a.data.errorMessage}):(e.$root.gridApi[c.sSelectedGridOptionsName].selection.clearSelectedRows(),e.refreshGrid(e,e.gridOptions),b("SUCCESSFUL_OPERATION").then(function(a){$.notify(a,"success")}),c.oSectionForm[c.oSelectedObject.name].sections.forEach(function(a){"tests"==a.name&&(a.bLoaded=!1)}))}})}};angular.element(v.f).scope().cloneVm4msLayer=
function(){var a=angular.element(v.X).injector().get(["$log"]),b=angular.element(v.X).injector().get(["envSrvc"]);a.info("cloneVm4msLayer");var c=angular.copy(b.oFormValues[b.sFormDefinitionName]);this.AddSectionForm();var d=this.$root.$on("formDefinitionLoaded",function(){d();c.name="";c.title="";b.oFormValues[b.sFormDefinitionName]=angular.copy(c)})};angular.element(v.f).scope().initVm4msLayerForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$rootScope"]),
c=angular.element(v.f).injector().get(["envSrvc"]),d=angular.element(v.f).injector().get(["formSrvc"]),e=angular.element(v.f).injector().get(["propertiesSrvc"]);a.info("initVm4msLayerForm");var f=this;"insert"==c.sMode&&(document.querySelector("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name+"'] input[name='name']").addEventListener("input",function(){var a=this.value,b={a:"\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5",A:"\u00c0\u00c1\u00c2\u00c3\u00c4\u00c5",e:"\u00e8\u00e9\u00ea\u00eb",E:"\u00c8\u00c9\u00ca\u00cb",
i:"\u00ec\u00ed\u00ee\u00ef",I:"\u00cc\u00cd\u00ce\u00cf",o:"\u00f2\u00f3\u00f4\u00f5\u00f6\u00f8",O:"\u00d2\u00d3\u00d4\u00d5\u00d6\u00d8",u:"\u00f9\u00fa\u00fb\u00fc",U:"\u00d9\u00da\u00db\u00dc",y:"\u00ff",Y:"\u0178",c:"\u00e7",C:"\u00c7",n:"\u00f1",N:"\u00d1"};Object.keys(b).forEach(function(c){a=a.replace(new RegExp("["+b[c]+"]","g"),c)});c.oFormValues[c.sFormDefinitionName].name=a.replace(/[^a-zA-Z0-9]/g,"_");angular.element("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name).scope().$apply()}),
a=c.oFormValues[c.sFormDefinitionName],null!=a.definition&&""!=a.definition||(a.definition='LAYER\r\tNAME "{LAYER_NAME}"\r\tTYPE {LAYER_TYPE}\r\tSTATUS ON\r\t{CONNECTION}\r\tDATA "geom from {TABLE_SCHEMA}.{TABLE_NAME} USING SRID={SRID} USING UNIQUE {TABLE_ID}"\r\tDEBUG 0\r\r\t{COORDSYS}\r\r\t{METADATA}\r\r\tCLASS\r\t\tNAME "{LAYER_NAME}"\r\t\tSTYLE\r\t\t\tSYMBOL "circle"\r\t\t\tSIZE 15\r\t\t\tOUTLINECOLOR 0 0 0\r\t\t\tCOLOR 204 204 204\r\t\t\tWIDTH 2\r\t\tEND\r\tEND\rEND'));var g=b.$on("formExtracted",
function(){function a(a){null!=a&&""!=a&&A({method:"GET",url:e.web_server_name+"/"+e.services_alias+"/vm4ms/layerconnections/"+a,scope:f,success:function(a){if(1==a.data.status){a=c.extractWebServiceData("layerconnections",a.data)[0];null!=a.server||(a.server=e.server);null!=a.port||(a.port=e.port);null!=a.database||(a.database=e.database);f.oLayerConnection=angular.copy(a);var d={server:a.server,port:a.port,database:a.database};null!=a.user&&(d.login=a.user);null!=a.password&&(d.password=a.password);
b.setOptionsFromWebService("tableschema","vitis/genericquerys/"+a.database+"/schemas",d)}}})}g();var k=c.oFormValues[c.sFormDefinitionName].connection_id.selectedOption.value;isNaN(k)||a(k);k=d.getFormElementDefinition("connection_id",c.sFormDefinitionName);document.getElementById(k.id).addEventListener("change",function(){a(this.value)});k=document.querySelector("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name+"']");k.className+=" form-vm4ms-layer-general";var k=document.querySelector(".form-row-layer-palette > div > div > div > div"),
m=document.createElement("div");m.id=c.sFormDefinitionName+"_palette";m.className="input-group colorpicker-component vm4ms-layer-palette";m.innerHTML='<input type="text" name="color" value="#00AABB" class="form-control"><span class="input-group-addon"><i></i></span>';k.appendChild(m);$(m).colorpicker({format:"hex"});var p=document.querySelector("#container_section_"+c.oSelectedObject.name+"_general > div");f.iCodeMirrorDefinitionHeight=parseInt(document.querySelector("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name+
"'] .CodeMirror").style.height);m=document.createElement("button");m.id=c.sFormDefinitionName+"layer_definition_full_screen_icon";m.className="btn btn-xs btn-primary layer-definition-full-screen-icon";m.type="button";m.innerHTML='<span class="glyphicon glyphicon-fullscreen"></span>';m.setAttribute("aria-label","Left Align");k.appendChild(m);f.bCodeMirrorDefinitionFullScreen=!1;m.addEventListener("click",function(){var a;f.bCodeMirrorDefinitionFullScreen?a=f.iCodeMirrorDefinitionHeight:(a=document.getElementById("container_section_"+
c.oSelectedObject.name+"_general").clientHeight,null!=document.querySelector(".form-row-layer-btn")&&(a-=parseInt(document.querySelector(".form-row-layer-btn").offsetHeight)),a-=parseInt(document.querySelector(".form-row-layer-palette").offsetHeight),a-=parseInt(document.querySelector(".form-row-layer-definition").offsetHeight),a=f.iCodeMirrorDefinitionHeight+(a-20));f.bCodeMirrorDefinitionFullScreen=!f.bCodeMirrorDefinitionFullScreen;var b=document.querySelector("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name+
"'] .CodeMirror");b.style.height=a+"px";p.scrollTop=p.scrollHeight-p.clientHeight;b.CodeMirror.refresh()},!1);k=c.oFormValues[c.sFormDefinitionName];!0===k.private_connection&&angular.element(document.getElementById("container_mode_"+c.oSelectedMode.mode_id).querySelectorAll(".section-form-section")[1]).off("click");if("update"==c.sMode){var m=d.getFormElementDefinition("layer_login",c.sFormDefinitionName),t=d.getFormElementDefinition("layer_password",c.sFormDefinitionName);!1===k.private_connection?
(m.visible=!1,t.visible=!1):(m.visible=!0,t.visible=!0,document.querySelector(".form-row-layer-palette > div:last-child").style.bottom="80px");k=angular.element("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name).scope();"undefined"==typeof c.oFormDefinition[c.sFormDefinitionName].tabs&&k.ctrl.initFormTabs();k.$broadcast("$$rebind::refresh");k.$apply()}})};angular.element(v.f).scope().displayMapServerSymbolsModal=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.X).injector().get(["$compile"]),
c=angular.element(v.X).injector().get(["$templateRequest"]);a.info("displayMapServerSymbolsModal");var d=this;d.$root.modalWindow("dialog","FORM_MAP_SERVER_SYMBOLS_MODAL_TITLE_VM4MS_VM4MS_LAYER",{className:"dialog-modal-window dialog-modal-window-mapserver-symbols",message:'<div id="mapserver_symbols_container" class="mapserver-symbols-container"></div>'}).then(function(a){var e=document.querySelector("body").clientHeight-50;a[0].querySelector(".modal-dialog").style.width=parseInt(document.querySelector("body").clientWidth/
2)+"px";a[0].querySelector(".modal-dialog").style.height=e+"px";a[0].querySelector(".modal-header").style.height="56px";a[0].querySelector(".modal-body").style.height=e-56-4+"px";c("modules/vm4ms/template/mapServerSymbolsTpl.html").then(function(a){b($("#mapserver_symbols_container").html(a).contents())(d)})})};angular.element(v.f).scope().displayMapServerFontsModal=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.X).injector().get(["$compile"]),c=angular.element(v.X).injector().get(["$templateRequest"]),
d=angular.element(v.f).injector().get(["propertiesSrvc"]),e=angular.element(v.f).injector().get(["envSrvc"]);a.info("displayMapServerFontsModal");var f=this;f.$root.modalWindow("dialog","FORM_MAP_SERVER_FONTS_MODAL_TITLE_VM4MS_VM4MS_LAYER",{className:"dialog-modal-window dialog-modal-window-mapserver-fonts",message:'<div id="mapserver_fonts_container" class="mapserver-fonts-container"></div>'}).then(function(a){var g=document.querySelector("body").clientHeight-50;a[0].querySelector(".modal-dialog").style.width=
parseInt(document.querySelector("body").clientWidth/2)+"px";a[0].querySelector(".modal-dialog").style.height=g+"px";a[0].querySelector(".modal-header").style.height="56px";a[0].querySelector(".modal-body").style.height=g-56-4+"px";A({method:"GET",url:d.web_server_name+"/"+d.services_alias+"/vm4ms/mapserver/Fonts",scope:f,success:function(a){if(1==a.data.status)f.oMapServerFonts=e.extractWebServiceData("mapserver",a.data)[0].fonts,c("modules/vm4ms/template/mapServerFontsTpl.html").then(function(a){b($("#mapserver_fonts_container").html(a).contents())(f)});
else{var d={className:"modal-danger"};null!=a.data.errorMessage&&(d.message=a.data.errorMessage);f.$root.modalWindow("alert","REQUEST_ERROR",d)}}})})};angular.element(v.f).scope().loadPrivateWmsServiceLayers=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["envSrvc"]),c=angular.element(v.X).injector().get(["$translate"]);a.info("loadPrivateWmsServiceLayers");var d=this,e=b.oSelectedObject.sorted_by,f=b.oSelectedObject.sorted_dir;b.oSelectedObject.sorted_by=
"name";b.oSelectedObject.sorted_dir="ASC";c("FORM_GRID_TITLE_VM4MS_PRIVATE_WMS_SERVICE_LAYERS").then(function(a){d.$root.loadSectionList({appHeader:!0,appHeaderSearchForm:!1,appGridTitle:a})});var g=d.$root.$on("workspaceListTplCompiled",function(){g();b.oSelectedObject.sorted_by=e;b.oSelectedObject.sorted_dir=f})};angular.element(v.f).scope().loadPublicWmsServiceLayers=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["envSrvc"]),c=angular.element(v.X).injector().get(["$translate"]);
a.info("loadPublicWmsServiceLayers");var d=this,e=b.oSelectedObject.sorted_by,f=b.oSelectedObject.sorted_dir;b.oSelectedObject.sorted_by="name";b.oSelectedObject.sorted_dir="ASC";c("FORM_GRID_TITLE_VM4MS_PUBLIC_WMS_SERVICE_LAYERS").then(function(a){d.$root.loadSectionList({appHeader:!0,appHeaderSearchForm:!1,appGridTitle:a,oFilter:{relation:"AND",operators:[{column:"wmsservice_id",compare_operator:"=",value:b.sId}]}})});var g=d.$root.$on("workspaceListTplCompiled",function(){g();b.oSelectedObject.sorted_by=
e;b.oSelectedObject.sorted_dir=f})};angular.element(v.f).scope().setOptionsFromWebService=function(a,b,c){var d=angular.element(v.f).injector().get(["$log"]),e=angular.element(v.Wb).injector().get(["$q"]),f=angular.element(v.f).injector().get(["envSrvc"]),g=angular.element(v.f).injector().get(["propertiesSrvc"]),h=angular.element("form[name='"+f.oFormDefinition[f.sFormDefinitionName].name).scope();d.info("setOptionsFromWebService");var k=this,m=e.defer(),d=m.promise,p=b.split("/");p.shift();A({method:"GET",
url:g.web_server_name+"/"+g.services_alias+"/"+b,params:c,scope:k,success:function(b){if(0!=b.data.status)null!=h.oFormValues[f.sFormDefinitionName][a]||(h.oFormValues[f.sFormDefinitionName][a]={}),h.oFormValues[f.sFormDefinitionName][a].options=[],f.extractWebServiceData(p[0],b.data).forEach(function(b){h.oFormValues[f.sFormDefinitionName][a].options.push({value:b[Object.keys(b)[0]],label:b[Object.keys(b)[0]]})}),m.resolve();else{h.oFormValues[f.sFormDefinitionName][a].options=[];var c={className:"modal-danger",
buttons:{ok:{label:"OK",className:"btn-default"}}};null!=b.data.errorMessage&&(c.message=b.data.errorMessage);k.modalWindow("alert","REQUEST_ERROR",c)}}});return d};angular.element(v.f).scope().loadVm4msConfig=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.X).injector().get(["envSrvc"]),c=angular.element(v.f).injector().get(["propertiesSrvc"]);a.info("loadVm4msConfig");"string"==typeof c.test_wms_service_default_content&&(c.test_wms_service_default_content=c.test_wms_service_default_content.replace(/\\+"/g,
'"'));angular.element(v.f).scope().setPropertiesFormValues(["mapserver_alias","test_wms_service"]);a=b.oSelectedObject.name;this.oFormRequestParams={sUrl:"modules/vm4ms/forms/"+b.oSelectedMode.mode_id+"/"+a+"_"+b.oSectionForm[a].sections[b.oSectionForm[a].iSelectedSectionIndex].name+".json"}};angular.element(v.f).scope().setLayerTableOptions=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["envSrvc"]);a.info("setLayerTableOptions");a=b.oFormValues[b.sFormDefinitionName].tableschema.selectedOption.value;
null!=a&&""!=a&&(a={order_by:"table_name",server:this.oLayerConnection.server,port:this.oLayerConnection.port,database:this.oLayerConnection.database,schema:a,sort_order:"ASC",attributs:"table_name",distinct:!0},null!=this.oLayerConnection.user&&(a.login=this.oLayerConnection.user),null!=this.oLayerConnection.password&&(a.password=this.oLayerConnection.password),this.$root.setOptionsFromWebService("tablename","vitis/genericquerys",a))};angular.element(v.f).scope().setLayerIdFieldOptions=function(){var a=
angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["envSrvc"]);a.info("setLayerIdFieldOptions");a=b.oFormValues[b.sFormDefinitionName].tablename.selectedOption.value;null!=a&&""!=a&&(b={order_by:"column_name",server:this.oLayerConnection.server,port:this.oLayerConnection.port,database:this.oLayerConnection.database,schema:b.oFormValues[b.sFormDefinitionName].tableschema.selectedOption.value,table:a,sort_order:"ASC",attributs:"column_name",distinct:!0},null!=this.oLayerConnection.user&&
(b.login=this.oLayerConnection.user),null!=this.oLayerConnection.password&&(b.password=this.oLayerConnection.password),this.$root.setOptionsFromWebService("tableidfield","vitis/genericquerys/workspace/columns",b))};angular.element(v.f).scope().afterSendingWmsServiceForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.X).injector().get(["envSrvc"]);a.info("afterSendingWmsServiceForm");b.oSectionForm[b.oSelectedObject.name].sections.forEach(function(a){"tests"==a.name&&
(a.bLoaded=!1)})};angular.element(v.f).scope().displayLayerLoadingError=function(a){function b(){d(["ERROR_LOAD_IMAGE_OPEN_LAYERS_M4MS_WMS_SERVICE_TESTS_MULTIPLE_INFO"]).then(function(a){a=a.ERROR_LOAD_IMAGE_OPEN_LAYERS_M4MS_WMS_SERVICE_TESTS_MULTIPLE_INFO;var b=0,c;for(c in f.oVM4MSLayerLoadingErrorLayers)a+='<div class="">',a+="<li>",a+='<a data-toggle="collapse" href="#ERROR_LOAD_IMAGE_OPEN_LAYERS_M4MS_WMS_SERVICE_TESTS_MULTIPLE_INFO_'+b+'">',a+=f.oVM4MSLayerLoadingErrorLayers[c].layer,a+="</a>",
a+="</li>",a+="</div>",a+='<div id="ERROR_LOAD_IMAGE_OPEN_LAYERS_M4MS_WMS_SERVICE_TESTS_MULTIPLE_INFO_'+b+'" class="collapse">',a+='<div class="">',a+=null!=f.oVM4MSLayerLoadingErrorLayers[c].errorMessage?f.oVM4MSLayerLoadingErrorLayers[c].errorMessage:"-",a+="</div>",a+="</div>",b++;f.VM4MSLayerLoadingErrorModal.find(".bootbox-body").html(a)})}var c=angular.element(v.f).injector().get(["$log"]),d=angular.element(v.f).injector().get(["$translate"]),e=angular.element(v.f).injector().get(["propertiesSrvc"]);
c.info("displayLayerLoadingError");var f=this;if("undefined"==typeof f.oVM4MSLayerLoadingErrorLayers||null==f.oVM4MSLayerLoadingErrorLayers)f.oVM4MSLayerLoadingErrorLayers={};if(ha(f.oVM4MSLayerLoadingErrorLayers)){var g=c=a.target.gc.LAYERS;"undefined"==typeof c&&(c="fr"==e.language?"Couche sans nom":"Unnamed layer",g=c+a.target.gC);null!=f.oVM4MSLayerLoadingErrorLayers[g]||(f.oVM4MSLayerLoadingErrorLayers[g]={layer:c,url:a.kb.ff,errorMessage:null})}else f.oVM4MSLayerLoadingErrorLayers={};null==
f.VM4MSLayerLoadingErrorModal&&(f.VM4MSLayerLoadingErrorModal={},d(["ERROR_LOAD_IMAGE_OPEN_LAYERS_M4MS_WMS_SERVICE_TESTS_MULTIPLE"]).then(function(a){angular.element(v.f).scope().$root.modalWindow("dialog",a.ERROR_LOAD_IMAGE_OPEN_LAYERS_M4MS_WMS_SERVICE_TESTS_MULTIPLE,{className:"modal-danger",message:"",appCallback:function(a,b){f.VM4MSLayerLoadingErrorModal=b;b[0].onblur=function(){f.oVM4MSLayerLoadingErrorLayers=null;f.VM4MSLayerLoadingErrorModal=null}}})}));setTimeout(function(){if(null!=f.VM4MSLayerLoadingErrorModal)for(var a in f.oVM4MSLayerLoadingErrorLayers)null!=
f.oVM4MSLayerLoadingErrorLayers[a].errorMessage||A({method:"GET",url:f.oVM4MSLayerLoadingErrorLayers[a].url,scope:f,responseType:"text",success:angular.bind(this,function(a,b,c){if(r(c.data)){var d="";(new DOMParser).parseFromString(c.data,"text/xml").querySelectorAll("ServiceException").forEach(function(a){d+=a.textContent});f.oVM4MSLayerLoadingErrorLayers[a].errorMessage=d;b()}},a,b)})})};v.appVm4msConnectionTypeColumn=function(){return{link:function(a,b,c){var d=c.$observe("appVm4msConnectionTypeColumn",
function(){var c;a.row.entity[a.col.field]?c="icon-lock":a.row.entity[a.col.field]||(c="icon-unlocked");b[0].className="ui-grid-cell-contents ui-grid-cell-svg-icon "+c});a.$on("$destroy",function(){d()})}}};v.compileProvider.directive("appVm4msConnectionTypeColumn",v.appVm4msConnectionTypeColumn);v.appTestWmsServiceColumn=function(a){return{link:function(b,c,d){var e=d.$observe("appTestWmsServiceColumn",function(){var d="";b.row.entity.wmsservice_id==a.test_wms_service&&(d="true-icon");c[0].className=
"ui-grid-cell-contents ui-grid-cell-svg-icon "+d});b.$on("$destroy",function(){e()})}}};v.appTestWmsServiceColumn.$inject=["propertiesSrvc"];v.compileProvider.directive("appTestWmsServiceColumn",v.appTestWmsServiceColumn);v.cy=function(a){return{link:function(b,c,d){var e=d.$observe("appLayerTitleColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["TOOLTIP_TITLE_TITLE_VM4MS_VM4MS_LAYER"]).then(function(a){$(c).popover({trigger:"hover",
container:"body",title:function(){return a.TOOLTIP_TITLE_TITLE_VM4MS_VM4MS_LAYER},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};v.cy.$inject=["$translate"];v.compileProvider.directive("appLayerTitleColumn",v.cy);angular.element(v.f).scope().initVm4msConnectionForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["envSrvc"]);
angular.element(v.f).injector().get(["$timeout"]);a.info("initVm4msConnectionForm");var c=this;document.querySelectorAll("form[name='"+b.oFormDefinition[b.sFormDefinitionName].name+"'] input[name='private']").forEach(function(a){a.addEventListener("click",function(){c.$root.setVm4msConnectionForm()})});"update"===b.sMode&&(a=b.oFormValues[b.sFormDefinitionName],a.private_database=a.database,a.public_database=a.database);this.setVm4msConnectionForm()};angular.element(v.f).scope().setVm4msConnectionForm=
function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["envSrvc"]),c=angular.element(v.f).injector().get(["formSrvc"]);angular.element(v.f).injector().get(["$translate"]);angular.element(v.f).injector().get(["$timeout"]);a.info("setVm4msConnectionForm");var a=angular.element("form[name='"+b.oFormDefinition[b.sFormDefinitionName].name).scope(),d=b.oFormValues[b.sFormDefinitionName],e=c.getFormElementDefinition("server",b.sFormDefinitionName),f=c.getFormElementDefinition("port",
b.sFormDefinitionName),g=c.getFormElementDefinition("user",b.sFormDefinitionName),h=c.getFormElementDefinition("password",b.sFormDefinitionName),k=c.getFormElementDefinition("public_database",b.sFormDefinitionName),b=c.getFormElementDefinition("private_database",b.sFormDefinitionName);!0===d["private"]?(null!=e&&(e.visible=!1),null!=f&&(f.visible=!1),null!=g&&(g.visible=!1),null!=h&&(h.visible=!1),null!=k&&(k.visible=!1),null!=b&&(b.visible=!0)):(null!=e&&(e.visible=!0),null!=f&&(f.visible=!0),null!=
g&&(g.visible=!0),null!=h&&(h.visible=!0),null!=k&&(k.visible=!0),null!=b&&(b.visible=!1));a.$apply()};angular.element(v.f).scope().beforeSendingVm4msConnectionForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["envSrvc"]);a.info("beforeSendingVm4msConnectionForm");a=b.oFormValues[b.sFormDefinitionName];!0===a["private"]?(a.database=a.private_database.selectedOption.value,a.server="",a.port="",a.user="",a.password=""):a.database=a.public_database};
angular.element(v.f).scope().updateVm4msProperties=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["$timeout"]),d=angular.element(v.f).injector().get(["envSrvc"]);a.info("updateVm4msProperties");var e=d.oFormValues[d.sFormDefinitionName],f=e.test_wms_service_default_content;b.updateProperties("vm4ms");c(function(){e.test_wms_service_default_content=f})};angular.element(v.f).scope().activateVm4msLayers=
function(a){var b=angular.element(v.f).injector().get(["$log"]),c=angular.element(v.f).injector().get(["$q"]),d=angular.element(v.f).injector().get(["envSrvc"]),e=angular.element(v.f).injector().get(["propertiesSrvc"]);b.info("activateVm4msLayers");"undefined"==typeof a&&(a=!0);var f=this,b=c.defer().promise,c={},g=f.$root.gridApi[f.sSelectedObjectName].selection.getSelectedRows();if(0<g.length){var h;a?(a="activate",h="ERROR_ACTIVATE_VM4MS_VM4MS_LAYER"):(a="desactivate",h="ERROR_DESACTIVATE_VM4MS_VM4MS_LAYER");
for(var k=0,m=[];k<g.length;)m.push(g[k][d.oSelectedObject.sIdField]),k++;c.idList=m.join("|");A({method:"PUT",url:e.web_server_name+"/"+e.services_alias+"/vm4ms/layers/"+a,data:c,scope:f,success:function(a){0==a.data.status?f.modalWindow("dialog",h,{className:"modal-danger",message:a.data.errorMessage}):(bootbox.hideAll(),f.$root.gridApi[f.sSelectedObjectName].pagination.raise.paginationChanged(null!=d.oSelectedObject.iPageNumber?d.oSelectedObject.iPageNumber:1,f.gridOptions.paginationPageSize))}})}else f.modalWindow("dialog",
"ERROR_NO_SELECTION_RESET_VM4MS_VM4MS_LAYER",{className:"modal-danger",appDuration:2E3});return b};angular.element(v.f).scope().desactivateVm4msLayers=function(){angular.element(v.f).injector().get(["$log"]).info("desactivateVm4msLayers");this.activateVm4msLayers(!1)}});v.on("appMainDrtvLoaded",function(){angular.element(v.f).scope().initAncControlForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["envSrvc"]),d=angular.element(v.f).injector().get(["formSrvc"]);a.info("initAncControlForm");var e=b.$on("formExtracted",function(){e();var a=["controle_type","num_dossier",c.sMode+"_button"],g,h=[];if("search"==c.sMode)g={"BON FONCTIONNEMENT":"controle_ss_type des_date_control des_interval_control des_refus_visite cl_avis cl_classe_cbf cl_date_avis cl_auteur_avis cl_date_prochain_controle cl_facture".split(" "),
CONCEPTION:"dep_date_depot dep_dossier_complet cl_avis cl_date_avis cl_auteur_avis cl_date_prochain_controle cl_facture".split(" "),REALISATION:"des_date_control des_interval_control cl_avis cl_date_avis cl_auteur_avis cl_date_prochain_controle cl_facture".split(" ")},b.displayFormFields(a);else if(g={"BON FONCTIONNEMENT":"id_controle id_installation controle_ss_type des_date_control des_interval_control des_pers_control des_agent_control des_refus_visite des_date_installation des_date_recommande des_numero_recommande des_reamenage_terrain des_reamenage_immeuble des_real_trvx des_anc_ss_accord des_collecte_ep des_sep_ep_eu des_eu_nb_sortie des_eu_tes_regards des_eu_pente_ecoul des_eu_regars_acces des_eu_alteration des_eu_ecoulement des_eu_depot_regard des_commentaire Element_0 Element_4 Element_5 Element_7 Element_8".split(" "),
CONCEPTION:"id_controle id_installation dep_date_depot des_date_control dep_liste_piece dep_dossier_complet dep_date_envoi_incomplet des_nature_projet des_concepteur car_surface_dispo_m2 car_permea car_valeur_permea car_hydromorphie car_prof_app car_nappe_fond car_terrain_innondable car_roche_sol car_dist_hab car_dist_lim_par car_dist_veget car_dist_puit des_collecte_ep des_sep_ep_eu Element_0 Element_2 Element_3 Element_5".split(" "),REALISATION:"id_controle id_installation des_date_control des_interval_control des_pers_control des_agent_control des_date_installation des_collecte_ep des_sep_ep_eu des_eu_nb_sortie des_eu_tes_regards des_eu_pente_ecoul Element_0 Element_5 Element_8 des_installateur element_7 des_commentaire".split(" ")},
"insert"==c.sMode){var k=c.oSelectedObject.aModeFilter;"object"==typeof k&&(c.oFormValues[c.sFormDefinitionName].id_installation.selectedOption.value=k.operators[0].value);b.displayFormFields(a)}else"update"==c.sMode?(k=c.oFormValues[c.sFormDefinitionName].controle_type,null!=c.oFormValues[c.sFormDefinitionName].controle_type.selectedOption&&null!=c.oFormValues[c.sFormDefinitionName].controle_type.selectedOption.value&&(k=c.oFormValues[c.sFormDefinitionName].controle_type.selectedOption.value),h=
g[k]):h=g[c.oFormValues[c.sFormDefinitionName].controle_type],b.displayFormFields(h.concat(a));k=d.getFormElementDefinition("controle_type",c.sFormDefinitionName,c.oFormDefinition);document.getElementById(k.id).addEventListener("change",function(){"undefined"!=typeof g[this.value]&&(h=g[this.value]);h=h.concat(a);b.displayFormFields(h)});k=c.oFormValues[c.sFormDefinitionName];null!=k.des_date_control&&(k.des_date_control=moment(k.des_date_control).format("L"));null!=k.des_date_installation&&(k.des_date_installation=
moment(k.des_date_installation).format("L"));null!=k.des_date_recommande&&(k.des_date_recommande=moment(k.des_date_recommande).format("L"));null!=k.dep_date_depot&&(k.dep_date_depot=moment(k.dep_date_depot).format("L"));null!=k.dep_date_envoi_incomplet&&(k.dep_date_envoi_incomplet=moment(k.dep_date_envoi_incomplet).format("L"))})};angular.element(v.f).scope().displayFormFields=function(a){var b=angular.element(v.f).injector().get(["$log"]),c=angular.element(v.f).injector().get(["envSrvc"]),d=angular.element(v.f).injector().get(["formSrvc"]),
e=angular.element(v.f).injector().get(["externFunctionSrvc"]);b.info("displayFormFields");b=d.getAllFormElementDefinition(c.sFormDefinitionName,c.oFormDefinition);if(Array.isArray(b)){for(d=0;d<b.length;d++)b[d].visible=-1==a.indexOf(b[d].name)?!1:!0;a=angular.element("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name).scope();a.$broadcast("$$rebind::refresh");a.$applyAsync();e.resizeWin()}};angular.element(v.f).scope().initAncInstallationForm=function(){var a=angular.element(v.f).injector().get(["$log"]),
b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["envSrvc"]),d=angular.element(v.f).injector().get(["formSrvc"]),e=angular.element(v.f).injector().get(["propertiesSrvc"]);a.info("initAncInstallationForm");var f=c.oFormValues[c.sFormDefinitionName];"insert"!=c.sMode&&(f.parcelle=f.id_parc);var g=b.$on("formExtracted",function(){g();var a=d.getFormElementDefinition("id_parc",c.sFormDefinitionName,c.oFormDefinition),k=angular.element("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name).scope();
document.getElementById(a.id).addEventListener("change",function(){var a=this.value;A({method:"GET",url:e.web_server_name+"/"+e.services_alias+"/cadastreV2/fichedescriptiveparcelle/"+a,scope:b,success:function(d){if(0!=d.data.status){f.parcelle=a;d=d.data.data;for(var g=Object.keys(d),h=0;h<g.length;h++)"string"==typeof d[g[h]]&&(d[g[h]]=d[g[h]].trim());f.parc_sup=d.sup_fiscale;f.parc_adresse=d.DVOILIB;f.parc_commune=null!=d.commune&&""!=d.commune?d.commune:f.id_com.selectedOption.label;if(null!=
e.anc.code_postal){g=e.anc.code_postal.schema;d=e.anc.code_postal.table;var k=e.anc.code_postal.column;null!=g&&""!=g&&null!=d&&""!=d&&null!=k&&""!=k&&(g={schema:g,table:d,filter:{relation:"AND",operators:[{column:"id_com",compare_operator:"=",value:f.id_com.selectedOption.value}]},attributs:k},A({method:"GET",url:e.web_server_name+"/"+e.services_alias+"/vitis/genericquerys/"+d,params:g,scope:b,success:function(a){0!=a.data.status&&(f.code_postal=c.extractWebServiceData("genericquerys",a.data)[0][k])}}))}g=
{schema:"s_majic",table:"v_vmap_parcelle_proprietaire",filter:{relation:"AND",operators:[{column:"id_par",compare_operator:"=",value:a}]},attributs:"prop_titre|prop_nom_prenom|prop_adresse|prop_code_postal|prop_commune"};A({method:"GET",url:e.web_server_name+"/"+e.services_alias+"/vitis/genericquerys/v_vmap_parcelle_proprietaire",params:g,scope:b,success:function(a){if(0!=a.data.status){if(a=c.extractWebServiceData("genericquerys",a.data)[0],"object"==typeof a){for(var d=Object.keys(a),e=0;e<d.length;e++)"string"==
typeof a[d[e]]&&(a[d[e]]=a[d[e]].trim());f.prop_titre=a.dqualp;f.prop_nom_prenom=a.ddenom;f.prop_adresse=a.dlign4;f.prop_code_postal=a.dlign6.substr(0,a.dlign6.indexOf(" "));f.prop_commune=a.dlign6.substr(a.dlign6.indexOf(" "))}}else d={className:"modal-danger"},null!=a.data.errorMessage&&(d.message=a.data.errorMessage),b.modalWindow("alert","REQUEST_ERROR",d)}})}else g={className:"modal-danger"},null!=d.data.errorMessage&&(g.message=d.data.errorMessage),b.modalWindow("alert","REQUEST_ERROR",g)}});
k.$apply()})})};angular.element(v.f).scope().initAncInstallationSuiviForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["envSrvc"]);a.info("initAncInstallationSuiviForm");var d=b.$on("formExtracted",function(){d();var a=c.oFormValues[c.sFormDefinitionName];a.create_date=moment(a.create_date).format("L");null!=a.maj_date&&(a.maj_date=moment(a.maj_date).format("L"));angular.element("form[name='"+
c.oFormDefinition[c.sFormDefinitionName].name).scope().$apply()})};angular.element(v.f).scope().initAncPretraitementForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["envSrvc"]),d=angular.element(v.f).injector().get(["formSrvc"]),e=angular.element(v.f).injector().get(["propertiesSrvc"]);a.info("initAncPretraitementForm");var f=b.$on("formExtracted",function(){f();var a=[c.sMode+"_button",
"id_pretraitement","id_installation","id_controle"],h,k=[];"search"!=c.sMode&&(h={"BON FONCTIONNEMENT":"tra_dist_hab ptr_im_puit ptr_adapte ptr_type_eau ptr_type ptr_volume ptr_marque ptr_materiau ptr_cloison ptr_commentaire ptr_im_distance ptr_im_acces ptr_et_degrad ptr_et_real ptr_vi_date ptr_vi_justi ptr_vi_entr ptr_vi_bord ptr_vi_dest ptr_vi_perc maj maj_date create create_date Element_0 Element_1 Element_2 Element_3 Element_4".split(" "),CONCEPTION:"ptr_type ptr_volume ptr_marque ptr_materiau ptr_commentaire ptr_im_distance maj maj_date create create_date Element_0 Element_1 Element_4".split(" "),
REALISATION:"ptr_type ptr_volume ptr_marque ptr_materiau ptr_commentaire ptr_im_distance ptr_im_hydrom maj maj_date create create_date Element_0 Element_4 ptr_pose ptr_adapte ptr_conforme_projet ptr_renforce ptr_verif_mise_en_eau ptr_type_eau ptr_im_dalle ptr_im_puit tra_dist_hab".split(" ")},"insert"==c.sMode?b.displayFormFields(a):(k=h[c.oFormValues[c.sFormDefinitionName].controle_type],b.displayFormFields(k.concat(a))));k=d.getFormElementDefinition("id_controle",c.sFormDefinitionName,c.oFormDefinition);
document.getElementById(k.id).addEventListener("change",function(){A({method:"GET",url:e.web_server_name+"/"+e.services_alias+"/anc/controles/"+this.value,scope:b,success:function(d){d=c.extractWebServiceData("controles",d.data)[0];b.displayFormFields(h[d.controle_type].concat(a))}})})}),a=c.oFormValues[c.sFormDefinitionName];null!=a.create_date&&(a.create_date=moment(a.create_date).format("L"));null!=a.maj_date&&(a.maj_date=moment(a.maj_date).format("L"));null!=a.ptr_vi_date&&(a.ptr_vi_date=moment(a.ptr_vi_date).format("L"))};
angular.element(v.f).scope().loadAncPretraitementsControl=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["$translate"]),d=angular.element(v.f).injector().get(["envSrvc"]);a.info("loadAncPretraitementsControl");var e=d.oSelectedObject.sorted_by,f=d.oSelectedObject.sorted_dir,g=d.oSelectedObject.edit_column,h=d.oSelectedObject.show_column;d.oSelectedObject.sIdField="id_controle";d.oSelectedObject.sorted_by=
"id_pretraitement";d.oSelectedObject.sorted_dir="ASC";d.oSelectedObject.edit_column="editModalSectionForm";d.oSelectedObject.show_column="showModalSectionForm";c(["GRID_TITLE_ANC_SAISIE_ANC_CONTROLE_CONTROLE_PRETRAITEMENT"]).then(function(a){b.loadSectionList({appHeader:!0,appHeaderSearchForm:!1,appGridTitle:a.GRID_TITLE_ANC_SAISIE_ANC_CONTROLE_CONTROLE_PRETRAITEMENT,appShowActions:!0,appIdField:"id_pretraitement"})});var k=b.$on("workspaceListHeaderActionsAdded",function(a,b){k();d.oSelectedObject.sorted_by=
e;d.oSelectedObject.sorted_dir=f;d.oSelectedObject.edit_column=g;d.oSelectedObject.show_column=h;for(a=0;a<b.appActions.length;a++)-1!=b.appActions[a].name.indexOf("_add")?b.appActions[a].event="addModalSectionForm()":-1!=b.appActions[a].name.indexOf("_delete")&&(b.appActions[a].event="DeleteSelection({'sIdField':'id_pretraitement'})")})};angular.element(v.f).scope().initAncControlDryToiletsForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$rootScope"]),
c=angular.element(v.f).injector().get(["envSrvc"]);a.info("initAncControlDryToiletsForm");var d=b.$on("formExtracted",function(){d();b.displayFormFields({"BON FONCTIONNEMENT":"ts_type_effluent ts_capacite_bac ts_nb_bac ts_coher_taille_util ts_aire_etanche ts_aire_abri ts_ventilation ts_cuve_etanche ts_val_comp ts_ruissel_ep ts_absence_nuisance ts_respect_regles ts_commentaires".split(" "),CONCEPTION:["ts_type_effluent","ts_capacite_bac","ts_nb_bac","ts_val_comp","ts_commentaires"],REALISATION:"ts_conforme ts_type_effluent ts_capacite_bac ts_nb_bac ts_aire_etanche ts_aire_abri ts_ventilation ts_cuve_etanche ts_val_comp ts_commentaires".split(" ")}[c.oFormValues[c.sFormDefinitionName].controle_type].concat([c.sMode+
"_button"]))})};angular.element(v.f).scope().initAncControlVentilationForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["envSrvc"]);a.info("initAncControlVentilationForm");var d=b.$on("formExtracted",function(){d();b.displayFormFields({"BON FONCTIONNEMENT":"vt_primaire vt_secondaire vt_prim_loc vt_prim_ht vt_prim_type_extract vt_second_loc vt_second_ht vt_prim_diam vt_second_diam vt_second_type_extract vt_prim_type_materiau vt_second_type_materiau Element_0 Element_1 Element_2 vt_commentaire".split(" "),
CONCEPTION:["vt_primaire","emplacement_vt_secondaire"],REALISATION:"vt_primaire vt_secondaire vt_prim_loc vt_prim_ht vt_prim_type_extract vt_second_loc vt_second_ht vt_prim_diam vt_second_diam vt_second_type_extract vt_prim_type_materiau vt_second_type_materiau Element_0 Element_1 Element_2 vt_commentaire".split(" ")}[c.oFormValues[c.sFormDefinitionName].controle_type].concat([c.sMode+"_button"]))})};angular.element(v.f).scope().loadAncTraitementsControl=function(){var a=angular.element(v.f).injector().get(["$log"]),
b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["$translate"]),d=angular.element(v.f).injector().get(["envSrvc"]);a.info("loadAncTraitementsControl");var e=d.oSelectedObject.sorted_by,f=d.oSelectedObject.sorted_dir,g=d.oSelectedObject.edit_column,h=d.oSelectedObject.show_column;d.oSelectedObject.sorted_by="id_traitement";d.oSelectedObject.sorted_dir="ASC";d.oSelectedObject.edit_column="editModalSectionForm";d.oSelectedObject.show_column="showModalSectionForm";
d.oSelectedObject.sIdField="id_controle";c(["GRID_TITLE_ANC_SAISIE_ANC_CONTROLE_CONTROLE_TRAITEMENT"]).then(function(a){b.loadSectionList({appHeader:!0,appHeaderSearchForm:!1,appGridTitle:a.GRID_TITLE_ANC_SAISIE_ANC_CONTROLE_CONTROLE_TRAITEMENT,appShowActions:!0,appIdField:"id_traitement"})});var k=b.$on("workspaceListHeaderActionsAdded",function(a,b){k();d.oSelectedObject.sorted_by=e;d.oSelectedObject.sorted_dir=f;d.oSelectedObject.edit_column=g;d.oSelectedObject.show_column=h;for(a=0;a<b.appActions.length;a++)-1!=
b.appActions[a].name.indexOf("_add")?b.appActions[a].event="addModalSectionForm()":-1!=b.appActions[a].name.indexOf("_delete")&&(b.appActions[a].event="DeleteSelection({'sIdField':'id_traitement'})")})};angular.element(v.f).scope().initAncTraitementForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["envSrvc"]),d=angular.element(v.f).injector().get(["formSrvc"]),e=angular.element(v.f).injector().get(["propertiesSrvc"]);
a.info("initAncTraitementForm");var f=b.$on("formExtracted",function(){f();var a=[c.sMode+"_button","id_traitement","id_controle","tra_type","id_installation"],h,k;if("search"!=c.sMode){h={"BON FONCTIONNEMENT":"tra_dist_hab tra_dist_lim_parc tra_dist_veget tra_dist_puit tra_regrep_mat tra_regrep_affl tra_regrep_equi tra_regbl_mat tra_regbl_affl tra_regcol_mat tra_regcol_affl maj maj_date create create_date Element_0 Element_1 Element_3 Element_4 Element_5 Element_6".split(" "),CONCEPTION:"maj maj_date create create_date Element_0 Element_6".split(" "),
REALISATION:"tra_dist_lim_parc tra_dist_veget tra_dist_puit tra_vm_grav_qual tra_vm_grav_ep tra_vm_geo_text tra_vm_bon_mat tra_regrep_mat tra_regrep_affl tra_regrep_equi tra_regrep_perf tra_regbl_mat tra_regbl_affl tra_regbl_hz tra_regbl_epand tra_regbl_perf tra_regcol_mat tra_regcol_affl tra_regcol_hz maj maj_date create create_date Element_0 Element_1 Element_2 Element_3 Element_4 Element_5 Element_6 tra_dist_hab tra_vm_racine tra_vm_humidite tra_vm_imper tra_vm_geogrille tra_vm_tuy_perf tra_vm_sab_qual tra_vm_sab_ep tra_vm_geomembrane".split(" ")};
var m=function(d){d="undefined"!=typeof d?d.target.value:c.oFormValues[c.sFormDefinitionName].tra_type.selectedOption.value;ha(d)&&null!=d.selectedOption&&null!=d.selectedOption.value&&(d=angular.copy(d.selectedOption.value));"undefined"!=typeof k&&""!=k&&("TRANCH\u00c9ES D'EPANDAGE"==d?b.displayFormFields(h[k].concat(["tra_nb","tra_longueur","tra_tot_lin","tra_profond","tra_largeur"]).concat(a)):b.displayFormFields(h[k].concat(["tra_long","tra_larg","tra_surf","tra_profondeur"]).concat(a)))},p=d.getFormElementDefinition("tra_type",
c.sFormDefinitionName,c.oFormDefinition);"insert"==c.sMode?b.displayFormFields(a):(k="string"==typeof c.oFormValues[c.sFormDefinitionName].controle_type?c.oFormValues[c.sFormDefinitionName].controle_type:c.oFormValues[c.sFormDefinitionName].controle_type.selectedOption.value,m())}var t=d.getFormElementDefinition("id_controle",c.sFormDefinitionName,c.oFormDefinition);document.getElementById(t.id).addEventListener("change",function(){A({method:"GET",url:e.web_server_name+"/"+e.services_alias+"/anc/controles/"+
this.value,scope:b,success:function(d){d=c.extractWebServiceData("controles",d.data)[0];k=d.controle_type;b.displayFormFields(h[d.controle_type].concat(a))}})});document.getElementById(p.id).addEventListener("change",m)}),a=c.oFormValues[c.sFormDefinitionName];null!=a.create_date&&(a.create_date=moment(a.create_date).format("L"));null!=a.maj_date&&(a.maj_date=moment(a.maj_date).format("L"))};angular.element(v.f).scope().initAncFilieresAgreeesForm=function(){var a=angular.element(v.f).injector().get(["$log"]),
b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["envSrvc"]),d=angular.element(v.f).injector().get(["formSrvc"]),e=angular.element(v.f).injector().get(["propertiesSrvc"]);a.info("initAncFilieresAgreeesForm");var f=b.$on("formExtracted",function(){f();var a=[c.sMode+"_button","id_fag","id_controle","id_installation"],h,k=[];"search"!=c.sMode&&(h={"BON FONCTIONNEMENT":"id_fag id_controle fag_type fag_agree fag_integerer fag_denom fag_fab fag_num_ag fag_cap_eh fag_nb_cuv fag_et_deg fag_et_od fag_et_dy fag_en_date fag_en_jus fag_en_entr fag_en_bord fag_en_dest fag_en_perc fag_en_contr fag_en_mainteger fag_dist_arb fag_dist_parc fag_dist_hab fag_dist_cap maj maj_date create create_date Element_6 Element_7 Element_8 fag_num fag_num_filt fag_mat_cuv fag_guide fag_contr fag_soc Element_0 fag_pres fag_tamp fag_ventil fag_mil_typ fag_mil_filt fag_pres_reg fag_pres_alar fag_commentaires".split(" "),
CONCEPTION:"id_fag id_controle fag_type fag_agree fag_integerer fag_denom fag_fab fag_num_ag fag_cap_eh fag_nb_cuv maj maj_date create create_date".split(" "),REALISATION:"id_fag id_controle fag_type fag_agree fag_integerer fag_denom fag_fab fag_num_ag fag_cap_eh fag_nb_cuv fag_surpr fag_surpr_ref fag_surpr_dist fag_surpr_elec fag_surpr_aer fag_reac_bull fag_broy fag_dec fag_type_eau fag_reg_mar fag_reg_mat fag_reg_affl fag_reg_hz fag_reg_van fag_fvl_nb fag_fvl_long fag_fvl_larg fag_fvl_prof fag_fvl_sep fag_fvl_pla fag_fvl_drain fag_fvl_resp fag_fhz_long fag_fhz_larg fag_fhz_prof fag_fhz_drain fag_fhz_resp fag_mat_qual fag_mat_epa fag_pres_veg fag_pres_pro maj maj_date create create_date Element_1 Element_2 Element_3 Element_5 fag_num fag_num_filt fag_mat_cuv fag_guide fag_contr fag_soc fag_soc fag_livret Element_0 fag_pres fag_plan fag_tamp fag_ancrage fag_ventil fag_mil_typ fag_mil_filt fag_mise_eau fag_pres_alar fag_pres_reg fag_pres fag_plan fag_tamp fag_rep fag_respect fag_att_conf Element_10 fag_commentaires".split(" ")},
"insert"==c.sMode?b.displayFormFields(a):(k=h[c.oFormValues[c.sFormDefinitionName].controle_type],b.displayFormFields(k.concat(a))));k=d.getFormElementDefinition("id_controle",c.sFormDefinitionName,c.oFormDefinition);document.getElementById(k.id).addEventListener("change",function(){A({method:"GET",url:e.web_server_name+"/"+e.services_alias+"/anc/controles/"+this.value,scope:b,success:function(d){d=c.extractWebServiceData("controles",d.data)[0];b.displayFormFields(h[d.controle_type].concat(a))}})});
var k=c.oFormValues[c.sFormDefinitionName],m=k.fag_en_date;null!=m&&""!=m&&(k.fag_en_date=moment(m).format("L"));null!=k.create_date&&(k.create_date=moment(k.create_date).format("L"));null!=k.maj_date&&(k.maj_date=moment(k.maj_date).format("L"))})};angular.element(v.f).scope().loadAncFilieresAgreeesControl=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["$translate"]),d=angular.element(v.f).injector().get(["envSrvc"]);
a.info("loadAncFilieresAgreeesControl");var e=d.oSelectedObject.sorted_by,f=d.oSelectedObject.sorted_dir,g=d.oSelectedObject.edit_column,h=d.oSelectedObject.show_column;d.oSelectedObject.sIdField="id_controle";d.oSelectedObject.sorted_by="id_fag";d.oSelectedObject.sorted_dir="ASC";d.oSelectedObject.edit_column="editModalSectionForm";d.oSelectedObject.show_column="showModalSectionForm";c(["GRID_TITLE_ANC_SAISIE_ANC_CONTROLE_CONTROLE_PRETRAITEMENT"]).then(function(a){b.loadSectionList({appHeader:!0,
appHeaderSearchForm:!1,appGridTitle:a.GRID_TITLE_ANC_SAISIE_ANC_CONTROLE_CONTROLE_PRETRAITEMENT,appShowActions:!0,appIdField:"id_fag"})});var k=b.$on("workspaceListHeaderActionsAdded",function(a,b){k();d.oSelectedObject.sorted_by=e;d.oSelectedObject.sorted_dir=f;d.oSelectedObject.edit_column=g;d.oSelectedObject.show_column=h;for(a=0;a<b.appActions.length;a++)-1!=b.appActions[a].name.indexOf("_add")?b.appActions[a].event="addModalSectionForm()":-1!=b.appActions[a].name.indexOf("_delete")&&(b.appActions[a].event=
"DeleteSelection({'sIdField':'id_fag'})")})};angular.element(v.f).scope().initAncControlDispositifsAnnexesForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["envSrvc"]);a.info("initAncControlDispositifsAnnexesForm");var d=b.$on("formExtracted",function(){d();b.displayFormFields({"BON FONCTIONNEMENT":"da_chasse_acces da_chasse_pr_nat_eau da_chasse_dysfonctionnement da_chasse_degradation da_chasse_entretien da_pr_loc_pompe da_pr_acces da_pr_clapet da_pr_etanche da_pr_dysfonctionnement da_pr_degradation da_pr_entretien da_commentaires da_pr_ventilatio".split(" "),
CONCEPTION:"da_chasse_auto da_chasse_pr_nat_eau da_pr_loc_pompe da_pr_nb_pompe da_pr_nat_eau da_commentaires".split(" "),REALISATION:"da_chasse_pr_nat_eau da_chasse_ok da_pr_loc_pompe da_pr_ok da_pr_clapet da_pr_etanche da_pr_branchement da_pr_ventilatio da_pr_alarme da_commentaires".split(" ")}[c.oFormValues[c.sFormDefinitionName].controle_type].concat([c.sMode+"_button","Element_1","Element_2"]))})};angular.element(v.f).scope().initAncControlConclusionForm=function(){var a=angular.element(v.f).injector().get(["$log"]),
b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["envSrvc"]),d=angular.element(v.f).injector().get(["formSrvc"]);a.info("initAncControlConclusionForm");var e="ABSENCE D'INSTALLATION;NON CONFORME - D\u00c9FAUT DE S\u00c9CURIT\u00c9 SANITAIRE;NON CONFORME - D\u00c9FAUT DE STRUCTURE OU DE FERMETURE;NON CONFORME - INSTALLATION IMPLANT\u00c9E \u00c0 MOINS DE 35M D'UN PUITS D\u00c9CLAR\u00c9 ET UTILIS\u00c9;NON CONFORME - INSTALLATION INCOMPL\u00c8TE;NON CONFORME - INSTALLATION SIGNIFICATIVEMENT SOUS DIMENSIONN\u00c9E;NON CONFORME - INSTALLATION PR\u00c9SENTANT DES DYSFONCTIONNEMENTS MAJEURS;INSTALLATION NECESSITANT DES RECOMMANDATIONS DE TRAVAUX".split(";");
if("update"==c.sMode){var a=d.getFormElementDefinition("cl_montant",c.sFormDefinitionName,c.oFormDefinition),a=c.oFormDefinition.datasources[a.datasource.datasource_id],f=c.oFormValues[c.oSelectedObject.name+"_"+c.oSectionForm[c.oSelectedObject.name].sections[0].name+"_"+c.sMode+"_form"];if(null!=f.des_date_control){var g=f.des_date_control.match(/[0-9]{4}/);null!==g&&(a.parameters.filter.annee_validite=g[0])}a.parameters.filter.controle_type=f.controle_type.selectedOption.value}var h=b.$on("formExtracted",
function(){h();var a=[c.sMode+"_button","Element_1","Element_2"],f={"BON FONCTIONNEMENT":"cl_classe_cbf cl_commentaires cl_date_avis cl_auteur_avis cl_montant cl_facture cl_facture_le cl_constat cl_travaux".split(" "),CONCEPTION:"cl_avis cl_commentaires cl_date_avis cl_auteur_avis cl_montant cl_facture cl_facture_le".split(" "),REALISATION:"cl_commentaires cl_date_avis cl_auteur_avis cl_montant cl_facture cl_facture_le cl_classe_cbf".split(" ")}[c.oFormValues[c.sFormDefinitionName].controle_type];
b.displayFormFields(f.concat(a));if("BON FONCTIONNEMENT"==c.oFormValues[c.sFormDefinitionName].controle_type){-1!=e.indexOf(c.oFormValues[c.sFormDefinitionName].cl_classe_cbf.selectedOption.value)?b.displayFormFields(f.concat(a).concat(["cl_classe_cbf_warning"])):b.displayFormFields(f.concat(a));var g=d.getFormElementDefinition("cl_classe_cbf",c.sFormDefinitionName,c.oFormDefinition);document.getElementById(g.id).addEventListener("change",function(){-1!=e.indexOf(this.value)?b.displayFormFields(f.concat(a).concat(["cl_classe_cbf_warning"])):
b.displayFormFields(f.concat(a))})}g=c.oFormValues[c.sFormDefinitionName].cl_date_avis;null!=g&&""!=g&&(c.oFormValues[c.sFormDefinitionName].cl_date_avis=moment(g).format("L"));g=c.oFormValues[c.sFormDefinitionName].cl_facture_le;null!=g&&""!=g&&(c.oFormValues[c.sFormDefinitionName].cl_facture_le=moment(g).format("L"))})};angular.element(v.f).scope().initAncEvacuationEauxForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["envSrvc"]),
d=angular.element(v.f).injector().get(["formSrvc"]),e=angular.element(v.f).injector().get(["propertiesSrvc"]);a.info("initAncEvacuationEauxForm");var f=b.$on("formExtracted",function(){f();var a=[c.sMode+"_button","id_eva","id_installation","id_controle"],h,k=[];h={"BON FONCTIONNEMENT":"evacuation_eaux.id_eva id_controle evac_type evac_is_long evac_is_larg evac_is_surface evac_is_profondeur evac_is_reg_rep evac_is_reb_bcl evac_is_veg evac_is_acc_reg evac_rp_grav evac_rp_tamp evac_rp_type_eff evac_rp_trap evac_hs_type evac_hs_gestionnaire evac_hs_gestionnaire_auth evac_commentaires maj maj_date create create_date Element_0 Element_1 Element_2 Element_4 evac_is_lin_total evac_rp_type evac_hs_intr evac_hs_type_eff evac_hs_ecoul".split(" "),
CONCEPTION:"evacuation_eaux.id_eva id_controle evac_type evac_is_long evac_is_larg evac_is_surface evac_is_profondeur evac_rp_etude_hydrogeol evac_rp_rejet evac_hs_type evac_hs_gestionnaire evac_hs_gestionnaire_auth evac_commentaires maj maj_date create create_date photos_f fiche_f schema_f documents_f plan_f Element_0 Element_1 Element_2 Element_3 Element_4 evac_is_inf_perm".split(" "),REALISATION:"evacuation_eaux.id_eva id_controle evac_type evac_is_long evac_is_larg evac_is_surface evac_is_profondeur evac_is_geotex evac_is_rac evac_is_hum evac_is_reg_rep evac_is_reb_bcl evac_is_veg evac_rp_grav evac_rp_tamp evac_hs_type evac_commentaires maj maj_date create create_date Element_0 Element_1 Element_2 Element_4 evac_is_lin_total evac_rp_bons_grav evac_hs_intr evac_hs_type_eff evac_hs_ecoul".split(" ")};
"insert"==c.sMode?b.displayFormFields(a):(k=h[c.oFormValues[c.sFormDefinitionName].controle_type],b.displayFormFields(k.concat(a)));"display"!=c.sMode&&(k=d.getFormElementDefinition("id_controle",c.sFormDefinitionName,c.oFormDefinition),document.getElementById(k.id).addEventListener("change",function(){A({method:"GET",url:e.web_server_name+"/"+e.services_alias+"/anc/controles/"+this.value,scope:b,success:function(d){d=c.extractWebServiceData("controles",d.data)[0];b.displayFormFields(h[d.controle_type].concat(a))}})}))}),
a=c.oFormValues[c.sFormDefinitionName];null!=a.create_date&&(a.create_date=moment(a.create_date).format("L"));null!=a.maj_date&&(a.maj_date=moment(a.maj_date).format("L"))};angular.element(v.f).scope().loadAncEvacuationEauxControl=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["$translate"]),d=angular.element(v.f).injector().get(["envSrvc"]);a.info("loadAncEvacuationEauxControl");var e=d.oSelectedObject.sorted_by,
f=d.oSelectedObject.sorted_dir,g=d.oSelectedObject.edit_column,h=d.oSelectedObject.show_column;d.oSelectedObject.sIdField="id_controle";d.oSelectedObject.sorted_by="id_eva";d.oSelectedObject.sorted_dir="ASC";d.oSelectedObject.edit_column="editModalSectionForm";d.oSelectedObject.show_column="showModalSectionForm";c(["GRID_TITLE_ANC_SAISIE_ANC_CONTROLE_CONTROLE_EVACUATION_EAUX"]).then(function(a){b.loadSectionList({appHeader:!0,appHeaderSearchForm:!1,appGridTitle:a.GRID_TITLE_ANC_SAISIE_ANC_CONTROLE_CONTROLE_EVACUATION_EAUX,
appShowActions:!0,appIdField:"id_eva"})});var k=b.$on("workspaceListHeaderActionsAdded",function(a,b){k();d.oSelectedObject.sorted_by=e;d.oSelectedObject.sorted_dir=f;d.oSelectedObject.edit_column=g;d.oSelectedObject.show_column=h;for(a=0;a<b.appActions.length;a++)-1!=b.appActions[a].name.indexOf("_add")?b.appActions[a].event="addModalSectionForm()":-1!=b.appActions[a].name.indexOf("_delete")&&(b.appActions[a].event="DeleteSelection({'sIdField':'id_eva'})")})};angular.element(v.f).scope().initAncControlPretraitementForm=
function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["$timeout"]),d=angular.element(v.f).injector().get(["envSrvc"]),e=angular.element(v.f).injector().get(["formSrvc"]),f=angular.element(v.f).injector().get(["propertiesSrvc"]);a.info("initAncControlPretraitementForm");var g=d.oFormValues[d.oSelectedObject.name+"_"+d.oSectionForm[d.oSelectedObject.name].sections[0].name+"_"+this.$parent.sParentMode+
"_form"],h=e.getFormElementDefinition("id_controle",d.sFormDefinitionName,d.oFormDefinition);"insert"==d.sMode&&(e.getFormElementDefinition("id_installation",d.sFormDefinitionName,d.oFormDefinition).default_value=g.id_installation.selectedOption.value,h.default_value=g.id_controle);var k=b.$on("formExtracted",function(){k();var a=[d.sMode+"_button","id_pretraitement","id_installation","id_controle"],e,t=[];e={"BON FONCTIONNEMENT":"ptr_im_puit ptr_adapte ptr_type_eau ptr_type ptr_volume ptr_marque ptr_materiau ptr_cloison ptr_commentaire ptr_im_distance ptr_im_acces ptr_et_degrad ptr_et_real ptr_vi_date ptr_vi_justi ptr_vi_entr ptr_vi_bord ptr_vi_dest ptr_vi_perc maj maj_date create create_date Element_0 Element_1 Element_3 Element_4".split(" "),
CONCEPTION:"ptr_type ptr_volume ptr_marque ptr_materiau ptr_commentaire ptr_im_distance maj maj_date create create_date Element_0 Element_1 Element_4".split(" "),REALISATION:"ptr_type ptr_volume ptr_marque ptr_materiau ptr_commentaire ptr_im_distance ptr_im_hydrom maj maj_date create create_date Element_0 Element_4 ptr_pose ptr_adapte ptr_conforme_projet ptr_renforce ptr_verif_mise_en_eau ptr_type_eau ptr_im_dalle ptr_im_puit".split(" ")};t=e["string"==typeof g.controle_type?g.controle_type:g.controle_type.selectedOption.value];
b.displayFormFields(t.concat(a));"display"!=d.sMode&&c(function(){document.getElementById(h.id).addEventListener("change",function(){A({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/anc/controles/"+this.value,scope:b,success:function(c){c=d.extractWebServiceData("controles",c.data)[0];b.displayFormFields(e[c.controle_type].concat(a))}})})})}),a=d.oFormValues[d.sFormDefinitionName];null!=a.create_date&&(a.create_date=moment(a.create_date).format("L"));null!=a.maj_date&&(a.maj_date=moment(a.maj_date).format("L"));
null!=a.ptr_vi_date&&(a.ptr_vi_date=moment(a.ptr_vi_date).format("L"))};angular.element(v.f).scope().initAncControlTraitementForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["$timeout"]),d=angular.element(v.f).injector().get(["envSrvc"]),e=angular.element(v.f).injector().get(["formSrvc"]),f=angular.element(v.f).injector().get(["propertiesSrvc"]);a.info("initAncControlTraitementForm");var g=
d.oFormValues[d.oSelectedObject.name+"_"+d.oSectionForm[d.oSelectedObject.name].sections[0].name+"_"+this.$parent.sParentMode+"_form"],h=e.getFormElementDefinition("id_controle",d.sFormDefinitionName,d.oFormDefinition);"insert"==d.sMode&&(e.getFormElementDefinition("id_installation",d.sFormDefinitionName,d.oFormDefinition).default_value=g.id_installation.selectedOption.value,h.default_value=g.id_controle);var k=b.$on("formExtracted",function(){function a(a){a="undefined"!=typeof a?a.target.value:
d.oFormValues[d.sFormDefinitionName].tra_type;ha(a)&&null!=a.selectedOption&&null!=a.selectedOption.value&&(a=angular.copy(a.selectedOption.value));"undefined"!=typeof w&&""!=w&&("TRANCH\u00c9ES D'EPANDAGE"==a?b.displayFormFields(t[w].concat(["tra_nb","tra_longueur","tra_tot_lin","tra_profond","tra_largeur"]).concat(p)):b.displayFormFields(t[w].concat(["tra_long","tra_larg","tra_surf","tra_profondeur"]).concat(p)))}k();var p=[d.sMode+"_button","id_traitement","id_controle","tra_type","id_installation"],
t,u=[];t={"BON FONCTIONNEMENT":"tra_dist_hab tra_dist_lim_parc tra_dist_veget tra_dist_puit tra_regrep_mat tra_regrep_affl tra_regrep_equi tra_regbl_mat tra_regbl_affl tra_regcol_mat tra_regcol_affl maj maj_date create create_date Element_0 Element_1 Element_3 Element_4 Element_5 Element_6".split(" "),CONCEPTION:"maj maj_date create create_date Element_0 Element_6".split(" "),REALISATION:["tra_dist_lim_parc","tra_dist_veget","tra_dist_puit","tra_vm_grav_qual","tra_vm_grav_ep","tra_vm_geo_text","tra_vm_bon_mat",
"tra_regrep_mat","tra_regrep_affl","tra_regrep_equi","tra_regrep_perf","tra_regbl_mat","tra_regbl_affl","tra_regbl_hz","tra_regbl_epand","tra_regbl_perf","tra_regcol_mat","tra_regcol_affl","tra_regcol_hz","maj","maj_date","create","create_date","Element_0","Element_1","Element_2","Element_3","Element_4","Element_5","Element_6",,"tra_vm_racine","tra_vm_humidite","tra_vm_imper","tra_vm_geogrille","tra_vm_tuy_perf","tra_vm_sab_qual","tra_vm_sab_ep","tra_vm_geomembrane"]};var w="string"==typeof g.controle_type?
g.controle_type:g.controle_type.selectedOption.value,u=t[w],x=e.getFormElementDefinition("tra_type",d.sFormDefinitionName,d.oFormDefinition);"insert"==d.sMode?b.displayFormFields(u.concat(p)):a();"display"!=d.sMode&&(document.getElementById(x.id).removeEventListener("change",a),c(function(){document.getElementById(h.id).addEventListener("change",function(){A({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/anc/controles/"+this.value,scope:b,success:function(a){a=d.extractWebServiceData("controles",
a.data)[0];w=a.controle_type;b.displayFormFields(t[a.controle_type].concat(p))}})});document.getElementById(x.id).addEventListener("change",a)}))})};angular.element(v.f).scope().initAncControlFilieresAgreeesForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["$timeout"]),d=angular.element(v.f).injector().get(["envSrvc"]),e=angular.element(v.f).injector().get(["formSrvc"]),f=angular.element(v.f).injector().get(["propertiesSrvc"]);
a.info("initAncControlFilieresAgreeesForm");var g=d.oFormValues[d.oSelectedObject.name+"_"+d.oSectionForm[d.oSelectedObject.name].sections[0].name+"_"+this.$parent.sParentMode+"_form"],h=e.getFormElementDefinition("id_controle",d.sFormDefinitionName,d.oFormDefinition);"insert"==d.sMode&&(e.getFormElementDefinition("id_installation",d.sFormDefinitionName,d.oFormDefinition).default_value=g.id_installation.selectedOption.value,h.default_value=g.id_controle);var k=b.$on("formExtracted",function(){k();
var a=[d.sMode+"_button","id_fag","id_controle","id_installation"],e,t=[];e={"BON FONCTIONNEMENT":"id_fag id_controle fag_type fag_agree fag_integerer fag_denom fag_fab fag_num_ag fag_cap_eh fag_nb_cuv fag_et_deg fag_et_od fag_et_dy fag_en_date fag_en_jus fag_en_entr fag_en_bord fag_en_dest fag_en_perc fag_en_contr fag_en_mainteger fag_dist_arb fag_dist_parc fag_dist_hab fag_dist_cap maj maj_date create create_date Element_6 Element_7 Element_8 fag_num fag_num_filt fag_mat_cuv fag_guide fag_contr fag_soc Element_0 fag_pres fag_tamp fag_ventil fag_mil_typ fag_mil_filt fag_pres_reg fag_pres_alar fag_commentaires".split(" "),
CONCEPTION:"id_fag id_controle fag_type fag_agree fag_integerer fag_denom fag_fab fag_num_ag fag_cap_eh fag_nb_cuv maj maj_date create create_date".split(" "),REALISATION:"id_fag id_controle fag_type fag_agree fag_integerer fag_denom fag_fab fag_num_ag fag_cap_eh fag_nb_cuv fag_surpr fag_surpr_ref fag_surpr_dist fag_surpr_elec fag_surpr_aer fag_reac_bull fag_broy fag_dec fag_type_eau fag_reg_mar fag_reg_mat fag_reg_affl fag_reg_hz fag_reg_van fag_fvl_nb fag_fvl_long fag_fvl_larg fag_fvl_prof fag_fvl_sep fag_fvl_pla fag_fvl_drain fag_fvl_resp fag_fhz_long fag_fhz_larg fag_fhz_prof fag_fhz_drain fag_fhz_resp fag_mat_qual fag_mat_epa fag_pres_veg fag_pres_pro maj maj_date create create_date Element_1 Element_2 Element_3 Element_5 fag_num fag_num_filt fag_mat_cuv fag_guide fag_contr fag_soc fag_soc fag_livret Element_0 fag_pres fag_plan fag_tamp fag_ancrage fag_ventil fag_mil_typ fag_mil_filt fag_mise_eau fag_pres_alar fag_pres_reg fag_pres fag_plan fag_tamp fag_rep fag_respect fag_att_conf Element_10 fag_commentaires".split(" ")};
t=e["string"==typeof g.controle_type?g.controle_type:g.controle_type.selectedOption.value];b.displayFormFields(t.concat(a));"display"!=d.sMode&&c(function(){document.getElementById(h.id).addEventListener("change",function(){A({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/anc/controles/"+this.value,scope:b,success:function(c){c=d.extractWebServiceData("controles",c.data)[0];b.displayFormFields(e[c.controle_type].concat(a))}})})})}),a=d.oFormValues[d.sFormDefinitionName],e=a.fag_en_date;
null!=e&&""!=e&&(a.fag_en_date=moment(e).format("L"));null!=a.create_date&&(a.create_date=moment(a.create_date).format("L"));null!=a.maj_date&&(a.maj_date=moment(a.maj_date).format("L"))};angular.element(v.f).scope().initAncControlEvacuationEauxForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["$rootScope"]),c=angular.element(v.f).injector().get(["$timeout"]),d=angular.element(v.f).injector().get(["envSrvc"]),e=angular.element(v.f).injector().get(["formSrvc"]),
f=angular.element(v.f).injector().get(["propertiesSrvc"]);a.info("initAncControlEvacuationEauxForm");var g=d.oFormValues[d.oSelectedObject.name+"_"+d.oSectionForm[d.oSelectedObject.name].sections[0].name+"_"+this.$parent.sParentMode+"_form"],h=e.getFormElementDefinition("id_controle",d.sFormDefinitionName,d.oFormDefinition);"insert"==d.sMode&&(e.getFormElementDefinition("id_installation",d.sFormDefinitionName,d.oFormDefinition).default_value=g.id_installation.selectedOption.value,h.default_value=
g.id_controle);var k=b.$on("formExtracted",function(){k();var a=[d.sMode+"_button","id_eva","id_installation","id_controle"],e,t=[];e={"BON FONCTIONNEMENT":"evacuation_eaux.id_eva id_controle evac_type evac_is_long evac_is_larg evac_is_surface evac_is_profondeur evac_is_reg_rep evac_is_reb_bcl evac_is_veg evac_is_acc_reg evac_rp_grav evac_rp_tamp evac_rp_type_eff evac_rp_trap evac_hs_type evac_hs_gestionnaire evac_hs_gestionnaire_auth evac_commentaires maj maj_date create create_date Element_0 Element_1 Element_2 Element_4 evac_is_lin_total evac_rp_type evac_hs_intr evac_hs_type_eff evac_hs_ecoul".split(" "),
CONCEPTION:"evacuation_eaux.id_eva id_controle evac_type evac_is_long evac_is_larg evac_is_surface evac_is_profondeur evac_rp_etude_hydrogeol evac_rp_rejet evac_hs_type evac_hs_gestionnaire evac_hs_gestionnaire_auth evac_commentaires maj maj_date create create_date photos_f fiche_f schema_f documents_f plan_f Element_0 Element_1 Element_2 Element_3 Element_4 evac_is_inf_perm".split(" "),REALISATION:"evacuation_eaux.id_eva id_controle evac_type evac_is_long evac_is_larg evac_is_surface evac_is_profondeur evac_is_geotex evac_is_rac evac_is_hum evac_is_reg_rep evac_is_reb_bcl evac_is_veg evac_rp_grav evac_rp_tamp evac_hs_type evac_commentaires maj maj_date create create_date Element_0 Element_1 Element_2 Element_4 evac_is_lin_total evac_rp_bons_grav evac_hs_intr evac_hs_type_eff evac_hs_ecoul".split(" ")};
t=e["string"==typeof g.controle_type?g.controle_type:g.controle_type.selectedOption.value];b.displayFormFields(t.concat(a));"display"!=d.sMode&&c(function(){document.getElementById(h.id).addEventListener("change",function(){A({method:"GET",url:f.web_server_name+"/"+f.services_alias+"/anc/controles/"+this.value,scope:b,success:function(c){c=d.extractWebServiceData("controles",c.data)[0];b.displayFormFields(e[c.controle_type].concat(a))}})})})}),a=d.oFormValues[d.sFormDefinitionName];null!=a.create_date&&
(a.create_date=moment(a.create_date).format("L"));null!=a.maj_date&&(a.maj_date=moment(a.maj_date).format("L"))};angular.element(v.f).scope().beforeSendingAncInstallationForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["envSrvc"]);a.info("beforeSendingAncInstallationForm");var a=["parc_commune","prop_adresse","prop_commune","prop_nom_prenom","prop_titre"],b=b.oFormValues[b.sFormDefinitionName],c;for(c in a)"string"==typeof b[a[c]]&&(b[a[c]]=
b[a[c]].toUpperCase())};angular.element(v.f).scope().initAncControleSuiviForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["envSrvc"]);a.info("initAncControleSuiviForm");a=b.oFormValues[b.sFormDefinitionName];null!=a.create_date&&(a.create_date=moment(a.create_date).format("L"));null!=a.maj_date&&(a.maj_date=moment(a.maj_date).format("L"))};v.sF=function(){return{link:function(a,b,c){var d=c.$observe("appAdminDescriptionColumn",function(){console.log(a.row.entity[a.col.field]);
null==a.row.entity[a.col.field]||""==a.row.entity[a.col.field]?b[0].className="":(b[0].className="ui-grid-cell-contents wk-params-icon",$(b).popover({trigger:"hover",container:"body",html:!0,title:function(){return"#"+a.row.entity.id_parametre_admin},placement:function(b,c){return a.$root.workspaceTooltipPlacement(c)},content:function(){return String(a.row.entity[a.col.field]).replace(/,/g,"<br>")}}))});a.$on("$destroy",function(){$(b).popover("destroy");d()})}}};v.compileProvider.directive("appAdminDescriptionColumn",
v.sF);v.tF=function(){return{link:function(a,b,c){var d=c.$observe("appAdminSignatureColumn",function(){console.log(a.row.entity[a.col.field]);null==a.row.entity[a.col.field]||""==a.row.entity[a.col.field]?b[0].className="":(b[0].className="ui-grid-cell-contents wk-params-icon",$(b).popover({trigger:"hover",container:"body",html:!0,title:function(){return"#"+a.row.entity.id_parametre_admin},placement:function(b,c){return a.$root.workspaceTooltipPlacement(c)},content:function(){return String(a.row.entity[a.col.field]).replace(/,/g,
"<br>")}}))});a.$on("$destroy",function(){$(b).popover("destroy");d()})}}};v.compileProvider.directive("appAdminSignatureColumn",v.tF);angular.element(v.f).scope().initAncParametrageEntrepriseForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["envSrvc"]);a.info("initAncParametrageEntrepriseForm");a=b.oFormValues[b.sFormDefinitionName];null!=a.create_date&&(a.create_date=moment(a.create_date).format("L"));null!=a.maj_date&&(a.maj_date=moment(a.maj_date).format("L"))};
angular.element(v.f).scope().initAncParametrageAdministrateurForm=function(){var a=angular.element(v.f).injector().get(["$log"]),b=angular.element(v.f).injector().get(["envSrvc"]);a.info("initAncParametrageAdministrateurForm");a=b.oFormValues[b.sFormDefinitionName];null!=a.date_fin_validite&&(a.date_fin_validite=moment(a.date_fin_validite).format("L"))}});
}).call(this)
//# sourceMappingURL=../javascript/vmap.min.js.map
