(function(){
var k,aa=this;function m(a){return void 0!==a}function ca(a){a.Fg=function(){return a.xw?a.xw:a.xw=new a}}
function ea(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function fa(a){return"array"==ea(a)}function ga(a){var b=ea(a);return"array"==b||"object"==b&&"number"==typeof a.length}function p(a){return"string"==typeof a}function ha(a){return"number"==typeof a}function ja(a){return"function"==ea(a)}function ka(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}function q(a){return a[la]||(a[la]=++ma)}var la="closure_uid_"+(1E9*Math.random()>>>0),ma=0;
function na(a,b,c){return a.call.apply(a.bind,arguments)}function pa(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function qa(a,b,c){qa=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?na:pa;return qa.apply(null,arguments)}
function ra(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}}var sa=Date.now||function(){return+new Date};function ta(a,b){a=a.split(".");var c=aa;a[0]in c||!c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)!a.length&&m(b)?c[d]=b:c=c[d]?c[d]:c[d]={}}
function u(a,b){function c(){}c.prototype=b.prototype;a.cb=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.nJ=function(a,c,f){for(var d=Array(arguments.length-2),e=2;e<arguments.length;e++)d[e-2]=arguments[e];return b.prototype[c].apply(a,d)}};function ua(){0!=va&&(wa[q(this)]=this);this.Xh=this.Xh;this.Ko=this.Ko}var va=0,wa={};ua.prototype.Xh=!1;ua.prototype.Id=function(){if(!this.Xh&&(this.Xh=!0,this.Ca(),0!=va)){var a=q(this);delete wa[a]}};ua.prototype.Ca=function(){if(this.Ko)for(;this.Ko.length;)this.Ko.shift()()};function xa(a){if(Error.captureStackTrace)Error.captureStackTrace(this,xa);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))}u(xa,Error);xa.prototype.name="CustomError";var ya;function za(a,b){for(var c=a.split("%s"),d="",e=Array.prototype.slice.call(arguments,1);e.length&&1<c.length;)d+=c.shift()+e.shift();return d+c.join("%s")}var Aa=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};
function Ba(a){if(!Ca.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(Ea,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(Fa,"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(Ga,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(Ha,"&quot;"));-1!=a.indexOf("'")&&(a=a.replace(Ia,"&#39;"));-1!=a.indexOf("\x00")&&(a=a.replace(Ja,"&#0;"));return a}var Ea=/&/g,Fa=/</g,Ga=/>/g,Ha=/"/g,Ia=/'/g,Ja=/\x00/g,Ca=/[\x00&<>"']/;function Ka(a,b){return a<b?-1:a>b?1:0}var La=2147483648*Math.random()|0;
function Ma(a,b){b=p(b)?String(b).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"):"\\s";return a.replace(new RegExp("(^"+(b?"|["+b+"]+":"")+")([a-z])","g"),function(a,b,e){return b+e.toUpperCase()})};function Na(a,b){b.unshift(a);xa.call(this,za.apply(null,b));b.shift()}u(Na,xa);Na.prototype.name="AssertionError";function Oa(a,b){throw new Na("Failure"+(a?": "+a:""),Array.prototype.slice.call(arguments,1));};function Pa(a){var b;b=b||0;return function(){return a.apply(this,Array.prototype.slice.call(arguments,0,b))}};var Qa=Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(p(a))return p(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},Ra=Array.prototype.forEach?function(a,b,c){Array.prototype.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=p(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)},Sa=Array.prototype.filter?function(a,b,c){return Array.prototype.filter.call(a,
b,c)}:function(a,b,c){for(var d=a.length,e=[],f=0,g=p(a)?a.split(""):a,h=0;h<d;h++)if(h in g){var l=g[h];b.call(c,l,h,a)&&(e[f++]=l)}return e};function Ta(a,b){return 0<=Qa(a,b)}function Ua(a){if(!fa(a))for(var b=a.length-1;0<=b;b--)delete a[b];a.length=0}function Va(a,b){Ta(a,b)||a.push(b)}function Wa(a,b){ra(Xa,a,-1,0).apply(null,b)}function Ya(a,b){b=Qa(a,b);var c;(c=0<=b)&&Za(a,b);return c}function Za(a,b){Array.prototype.splice.call(a,b,1)}
function $a(a){return Array.prototype.concat.apply(Array.prototype,arguments)}function ab(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]}function bb(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(ga(d)){var e=a.length||0,f=d.length||0;a.length=e+f;for(var g=0;g<f;g++)a[e+g]=d[g]}else a.push(d)}}function Xa(a,b,c,d){return Array.prototype.splice.apply(a,cb(arguments,1))}
function cb(a,b,c){return 2>=arguments.length?Array.prototype.slice.call(a,b):Array.prototype.slice.call(a,b,c)}function db(a){for(var b={},c=0,d=0;d<a.length;){var e=a[d++],f;f=e;f=ka(f)?"o"+q(f):(typeof f).charAt(0)+f;Object.prototype.hasOwnProperty.call(b,f)||(b[f]=!0,a[c++]=e)}a.length=c}function eb(a,b){a.sort(b||fb)}function gb(a,b){var c=fb;eb(a,function(a,e){return c(b(a),b(e))})}function fb(a,b){return a>b?1:a<b?-1:0}
function hb(a,b){var c;c=fb;for(var d=0,e=a.length,f;d<e;){var g=d+e>>1,h;h=c(b,a[g]);0<h?d=g+1:(e=g,f=!h)}c=f?d:~d;0>c&&Xa(a,-(c+1),0,b)};var ib;a:{var jb=aa.navigator;if(jb){var kb=jb.userAgent;if(kb){ib=kb;break a}}ib=""}function lb(a){return-1!=ib.indexOf(a)};function mb(a,b){for(var c in a)b.call(void 0,a[c],c,a)}function ob(a,b){for(var c in a)if(b.call(void 0,a[c],c,a))return!0;return!1}function pb(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b}function qb(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b}function rb(a,b){for(var c in a)if(a[c]==b)return!0;return!1}function sb(a){for(var b in a)return!1;return!0}function tb(a){for(var b in a)delete a[b]}function ub(a,b){b in a&&delete a[b]}function vb(a){var b={},c;for(c in a)b[c]=a[c];return b}
var wb="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function xb(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<wb.length;f++)c=wb[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};var yb;
function zb(){var a=aa.MessageChannel;"undefined"===typeof a&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&!lb("Presto")&&(a=function(){var a=document.createElement("IFRAME");a.style.display="none";a.src="";document.documentElement.appendChild(a);var b=a.contentWindow,a=b.document;a.open();a.write("");a.close();var c="callImmediate"+Math.random(),d="file:"==b.location.protocol?"*":b.location.protocol+"//"+b.location.host,a=qa(function(a){if(("*"==d||a.origin==d)&&a.data==
c)this.port1.onmessage()},this);b.addEventListener("message",a,!1);this.port1={};this.port2={postMessage:function(){b.postMessage(c,d)}}});if("undefined"!==typeof a&&!lb("Trident")&&!lb("MSIE")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(m(c.next)){c=c.next;var a=c.Qu;c.Qu=null;a()}};return function(a){d.next={Qu:a};d=d.next;b.port2.postMessage(0)}}return"undefined"!==typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(a){var b=document.createElement("SCRIPT");
b.onreadystatechange=function(){b.onreadystatechange=null;b.parentNode.removeChild(b);b=null;a();a=null};document.documentElement.appendChild(b)}:function(a){aa.setTimeout(a,0)}};function Ab(a){Ab[" "](a);return a}Ab[" "]=function(){};function Bb(a,b){var c=Cb;return Object.prototype.hasOwnProperty.call(c,a)?c[a]:c[a]=b(a)};var Db=lb("Opera"),Eb=lb("Trident")||lb("MSIE"),Fb=lb("Edge"),Gb=lb("Gecko")&&!(-1!=ib.toLowerCase().indexOf("webkit")&&!lb("Edge"))&&!(lb("Trident")||lb("MSIE"))&&!lb("Edge"),Hb=-1!=ib.toLowerCase().indexOf("webkit")&&!lb("Edge");function Ib(){var a=aa.document;return a?a.documentMode:void 0}var Jb;
a:{var Kb="",Lb=function(){var a=ib;if(Gb)return/rv\:([^\);]+)(\)|;)/.exec(a);if(Fb)return/Edge\/([\d\.]+)/.exec(a);if(Eb)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(Hb)return/WebKit\/(\S+)/.exec(a);if(Db)return/(?:Version)[ \/]?(\S+)/.exec(a)}();Lb&&(Kb=Lb?Lb[1]:"");if(Eb){var Mb=Ib();if(null!=Mb&&Mb>parseFloat(Kb)){Jb=String(Mb);break a}}Jb=Kb}var Cb={};
function Ob(a){return Bb(a,function(){for(var b=0,c=Aa(String(Jb)).split("."),d=Aa(String(a)).split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",h=d[f]||"";do{g=/(\d*)(\D*)(.*)/.exec(g)||["","","",""];h=/(\d*)(\D*)(.*)/.exec(h)||["","","",""];if(0==g[0].length&&0==h[0].length)break;b=Ka(0==g[1].length?0:parseInt(g[1],10),0==h[1].length?0:parseInt(h[1],10))||Ka(0==g[2].length,0==h[2].length)||Ka(g[2],h[2]);g=g[3];h=h[3]}while(0==b)}return 0<=b})}var Pb;var Qb=aa.document;
Pb=Qb&&Eb?Ib()||("CSS1Compat"==Qb.compatMode?parseInt(Jb,10):5):void 0;var Rb=!Eb||9<=Number(Pb),Sb=Eb&&!Ob("9");!Hb||Ob("528");Gb&&Ob("1.9b")||Eb&&Ob("8")||Db&&Ob("9.5")||Hb&&Ob("528");Gb&&!Ob("8")||Eb&&Ob("9");function Tb(a,b){this.type=a;this.currentTarget=this.target=b;this.defaultPrevented=this.ls=!1}Tb.prototype.stopPropagation=function(){this.ls=!0};Tb.prototype.preventDefault=function(){this.defaultPrevented=!0};function Ub(a,b){Tb.call(this,a?a.type:"");this.relatedTarget=this.currentTarget=this.target=null;this.charCode=this.keyCode=this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0;this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.Yk=this.state=null;a&&this.oi(a,b)}u(Ub,Tb);
Ub.prototype.oi=function(a,b){var c=this.type=a.type,d=a.changedTouches?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.currentTarget=b;if(b=a.relatedTarget){if(Gb){var e;a:{try{Ab(b.nodeName);e=!0;break a}catch(f){}e=!1}e||(b=null)}}else"mouseover"==c?b=a.fromElement:"mouseout"==c&&(b=a.toElement);this.relatedTarget=b;null===d?(this.offsetX=Hb||void 0!==a.offsetX?a.offsetX:a.layerX,this.offsetY=Hb||void 0!==a.offsetY?a.offsetY:a.layerY,this.clientX=void 0!==a.clientX?a.clientX:a.pageX,
this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0):(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0);this.button=a.button;this.keyCode=a.keyCode||0;this.charCode=a.charCode||("keypress"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.state=a.state;this.Yk=a;a.defaultPrevented&&this.preventDefault()};
Ub.prototype.stopPropagation=function(){Ub.cb.stopPropagation.call(this);this.Yk.stopPropagation?this.Yk.stopPropagation():this.Yk.cancelBubble=!0};Ub.prototype.preventDefault=function(){Ub.cb.preventDefault.call(this);var a=this.Yk;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,Sb)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var Vb="closure_listenable_"+(1E6*Math.random()|0),Wb=0;function Xb(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.cn=!!d;this.or=e;this.key=++Wb;this.cm=this.fj=!1}function Yb(a){a.cm=!0;a.listener=null;a.proxy=null;a.src=null;a.or=null};function Zb(a){this.src=a;this.wd={};this.Cm=0}Zb.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.wd[f];a||(a=this.wd[f]=[],this.Cm++);var g=$b(a,b,d,e);-1<g?(b=a[g],c||(b.fj=!1)):(b=new Xb(b,this.src,f,!!d,e),b.fj=c,a.push(b));return b};Zb.prototype.remove=function(a,b,c,d){a=a.toString();if(!(a in this.wd))return!1;var e=this.wd[a];b=$b(e,b,c,d);return-1<b?(Yb(e[b]),Za(e,b),0==e.length&&(delete this.wd[a],this.Cm--),!0):!1};
Zb.prototype.removeAll=function(a){a=a&&a.toString();var b=0,c;for(c in this.wd)if(!a||c==a){for(var d=this.wd[c],e=0;e<d.length;e++)++b,Yb(d[e]);delete this.wd[c];this.Cm--}return b};Zb.prototype.hasListener=function(a,b){var c=m(a),d=c?a.toString():"",e=m(b);return ob(this.wd,function(a){for(var f=0;f<a.length;++f)if(!(c&&a[f].type!=d||e&&a[f].cn!=b))return!0;return!1})};function $b(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.cm&&f.listener==b&&f.cn==!!c&&f.or==d)return e}return-1};var ac="closure_lm_"+(1E6*Math.random()|0),bc={},cc=0;function dc(a,b,c,d,e){if(fa(b)){for(var f=0;f<b.length;f++)dc(a,b[f],c,d,e);return null}c=ec(c);return a&&a[Vb]?a.FJ(b,c,d,e):fc(a,b,c,!1,d,e)}
function fc(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=!!e,h=gc(a);h||(a[ac]=h=new Zb(a));c=h.add(b,c,d,e,f);if(c.proxy)return c;d=hc();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)a.addEventListener(b.toString(),d,g);else if(a.attachEvent)a.attachEvent(ic(b.toString()),d);else throw Error("addEventListener and attachEvent are unavailable.");cc++;return c}
function hc(){var a=jc,b=Rb?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b}function kc(a,b,c,d,e){if(fa(b))for(var f=0;f<b.length;f++)kc(a,b[f],c,d,e);else c=ec(c),a&&a[Vb]?a.GJ(b,c,d,e):fc(a,b,c,!0,d,e)}
function mc(a){if(!ha(a)&&a&&!a.cm){var b=a.src;if(b&&b[Vb])b.aK(a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.cn):b.detachEvent&&b.detachEvent(ic(c),d);cc--;(c=gc(b))?(d=a.type,d in c.wd&&Ya(c.wd[d],a)&&(Yb(a),0==c.wd[d].length&&(delete c.wd[d],c.Cm--)),0==c.Cm&&(c.src=null,b[ac]=null)):Yb(a)}}}function ic(a){return a in bc?bc[a]:bc[a]="on"+a}
function nc(a,b,c,d){var e=!0;if(a=gc(a))if(b=a.wd[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.cn==c&&!f.cm&&(f=oc(f,d),e=e&&!1!==f)}return e}function oc(a,b){var c=a.listener,d=a.or||a.src;a.fj&&mc(a);return c.call(d,b)}
function jc(a,b){if(a.cm)return!0;if(!Rb){if(!b)a:{b=["window","event"];for(var c=aa,d;d=b.shift();)if(null!=c[d])c=c[d];else{b=null;break a}b=c}d=b;b=new Ub(d,this);c=!0;if(!(0>d.keyCode||void 0!=d.returnValue)){a:{var e=!1;if(0==d.keyCode)try{d.keyCode=-1;break a}catch(g){e=!0}if(e||void 0==d.returnValue)d.returnValue=!0}d=[];for(e=b.currentTarget;e;e=e.parentNode)d.push(e);a=a.type;for(e=d.length-1;!b.ls&&0<=e;e--){b.currentTarget=d[e];var f=nc(d[e],a,!0,b),c=c&&f}for(e=0;!b.ls&&e<d.length;e++)b.currentTarget=
d[e],f=nc(d[e],a,!1,b),c=c&&f}return c}return oc(a,new Ub(b,this))}function gc(a){a=a[ac];return a instanceof Zb?a:null}var pc="__closure_events_fn_"+(1E9*Math.random()>>>0);function ec(a){if(ja(a))return a;a[pc]||(a[pc]=function(b){return a.handleEvent(b)});return a[pc]};var qc=!Eb||9<=Number(Pb);!Gb&&!Eb||Eb&&9<=Number(Pb)||Gb&&Ob("1.9.1");Eb&&Ob("9");function rc(a,b){this.x=m(a)?a:0;this.y=m(b)?b:0}k=rc.prototype;k.clone=function(){return new rc(this.x,this.y)};k.toString=function(){return"("+this.x+", "+this.y+")"};k.equals=function(a){return a instanceof rc&&(this==a?!0:this&&a?this.x==a.x&&this.y==a.y:!1)};k.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this};k.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};k.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this};
k.translate=function(a,b){a instanceof rc?(this.x+=a.x,this.y+=a.y):(this.x+=Number(a),ha(b)&&(this.y+=b));return this};k.scale=function(a,b){b=ha(b)?b:a;this.x*=a;this.y*=b;return this};function sc(a,b){this.width=a;this.height=b}k=sc.prototype;k.clone=function(){return new sc(this.width,this.height)};k.toString=function(){return"("+this.width+" x "+this.height+")"};k.zA=function(){return this.width*this.height};k.fd=function(){return!this.zA()};k.ceil=function(){this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};k.floor=function(){this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};
k.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};k.scale=function(a,b){b=ha(b)?b:a;this.width*=a;this.height*=b;return this};function tc(a){return a?new uc(vc(a)):ya||(ya=new uc)}function wc(a,b){return p(b)?a.getElementById(b):b}function xc(a,b){mb(b,function(b,d){"style"==d?a.style.cssText=b:"class"==d?a.className=b:"for"==d?a.htmlFor=b:yc.hasOwnProperty(d)?a.setAttribute(yc[d],b):0==d.lastIndexOf("aria-",0)||0==d.lastIndexOf("data-",0)?a.setAttribute(d,b):a[d]=b})}
var yc={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};
function zc(a,b,c){var d=arguments,e=document,f=String(d[0]),g=d[1];if(!qc&&g&&(g.name||g.type)){f=["<",f];g.name&&f.push(' name="',Ba(g.name),'"');if(g.type){f.push(' type="',Ba(g.type),'"');var h={};xb(h,g);delete h.type;g=h}f.push(">");f=f.join("")}f=e.createElement(f);g&&(p(g)?f.className=g:fa(g)?f.className=g.join(" "):xc(f,g));2<d.length&&Ac(e,f,d,2);return f}
function Ac(a,b,c,d){function e(c){c&&b.appendChild(p(c)?a.createTextNode(c):c)}for(;d<c.length;d++){var f=c[d];!ga(f)||ka(f)&&0<f.nodeType?e(f):Ra(Bc(f)?ab(f):f,e)}}function Cc(a){for(var b;b=a.firstChild;)a.removeChild(b)}function Dc(a,b,c){a.insertBefore(b,a.childNodes[c]||null)}function Ec(a){return a&&a.parentNode?a.parentNode.removeChild(a):null}function Fc(a,b){var c=b.parentNode;c&&c.replaceChild(a,b)}
function Gc(a,b){if(!a||!b)return!1;if(a.contains&&1==b.nodeType)return a==b||a.contains(b);if("undefined"!=typeof a.compareDocumentPosition)return a==b||!!(a.compareDocumentPosition(b)&16);for(;b&&a!=b;)b=b.parentNode;return b==a}function vc(a){return 9==a.nodeType?a:a.ownerDocument||a.document}function Bc(a){if(a&&"number"==typeof a.length){if(ka(a))return"function"==typeof a.item||"string"==typeof a.item;if(ja(a))return"function"==typeof a.item}return!1}
function uc(a){this.Ze=a||aa.document||document}k=uc.prototype;k.ud=function(a){return wc(this.Ze,a)};k.$=uc.prototype.ud;k.getElementsByTagName=function(a,b){return(b||this.Ze).getElementsByTagName(String(a))};k.Ac=xc;k.createElement=function(a){return this.Ze.createElement(String(a))};k.createTextNode=function(a){return this.Ze.createTextNode(String(a))};k.appendChild=function(a,b){a.appendChild(b)};k.append=function(a,b){Ac(vc(a),a,arguments,1)};
k.canHaveChildren=function(a){if(1!=a.nodeType)return!1;switch(a.tagName){case "APPLET":case "AREA":case "BASE":case "BR":case "COL":case "COMMAND":case "EMBED":case "FRAME":case "HR":case "IMG":case "INPUT":case "IFRAME":case "ISINDEX":case "KEYGEN":case "LINK":case "NOFRAMES":case "NOSCRIPT":case "META":case "OBJECT":case "PARAM":case "SCRIPT":case "SOURCE":case "STYLE":case "TRACK":case "WBR":return!1}return!0};k.removeNode=Ec;k.isElement=function(a){return ka(a)&&1==a.nodeType};
k.isWindow=function(a){return ka(a)&&a.window==a};k.contains=Gc;function Hc(a,b,c){ua.call(this);this.Mc=null;this.kt=!1;this.eE=a;this.MD=c;this.zf=b||window;this.oq=qa(this.kv,this)}u(Hc,ua);k=Hc.prototype;k.start=function(){this.stop();this.kt=!1;var a=Ic(this),b=Jc(this);a&&!b&&this.zf.mozRequestAnimationFrame?(this.Mc=dc(this.zf,"MozBeforePaint",this.oq),this.zf.mozRequestAnimationFrame(null),this.kt=!0):this.Mc=a&&b?a.call(this.zf,this.oq):this.zf.setTimeout(Pa(this.oq),20)};
k.stop=function(){if(null!=this.Mc){var a=Ic(this),b=Jc(this);a&&!b&&this.zf.mozRequestAnimationFrame?mc(this.Mc):a&&b?b.call(this.zf,this.Mc):this.zf.clearTimeout(this.Mc)}this.Mc=null};k.fire=function(){this.stop();this.kv()};k.kv=function(){this.kt&&this.Mc&&mc(this.Mc);this.Mc=null;this.eE.call(this.MD,sa())};k.Ca=function(){this.stop();Hc.cb.Ca.call(this)};
function Ic(a){a=a.zf;return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||null}function Jc(a){a=a.zf;return a.cancelAnimationFrame||a.cancelRequestAnimationFrame||a.webkitCancelRequestAnimationFrame||a.mozCancelRequestAnimationFrame||a.oCancelRequestAnimationFrame||a.msCancelRequestAnimationFrame||null};function Kc(a){if(a.he&&"function"==typeof a.he)return a.he();if(p(a))return a.split("");if(ga(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}return pb(a)}
function Lc(a,b,c){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,c);else if(ga(a)||p(a))Ra(a,b,c);else{var d;if(a.Ld&&"function"==typeof a.Ld)d=a.Ld();else if(a.he&&"function"==typeof a.he)d=void 0;else if(ga(a)||p(a)){d=[];for(var e=a.length,f=0;f<e;f++)d.push(f)}else d=qb(a);for(var e=Kc(a),f=e.length,g=0;g<f;g++)b.call(c,e[g],d&&d[g],a)}};function Mc(a,b){this.H={};this.kc=[];this.Hm=this.Ta=0;var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else a&&this.addAll(a)}k=Mc.prototype;k.Eg=function(){return this.Ta};k.he=function(){Nc(this);for(var a=[],b=0;b<this.kc.length;b++)a.push(this.H[this.kc[b]]);return a};k.Ld=function(){Nc(this);return this.kc.concat()};k.qd=function(a){return Oc(this.H,a)};
k.equals=function(a,b){if(this===a)return!0;if(this.Ta!=a.Eg())return!1;b=b||Pc;Nc(this);for(var c,d=0;c=this.kc[d];d++)if(!b(this.get(c),a.get(c)))return!1;return!0};function Pc(a,b){return a===b}k.fd=function(){return 0==this.Ta};k.clear=function(){this.H={};this.Hm=this.Ta=this.kc.length=0};k.remove=function(a){return Oc(this.H,a)?(delete this.H[a],this.Ta--,this.Hm++,this.kc.length>2*this.Ta&&Nc(this),!0):!1};
function Nc(a){if(a.Ta!=a.kc.length){for(var b=0,c=0;b<a.kc.length;){var d=a.kc[b];Oc(a.H,d)&&(a.kc[c++]=d);b++}a.kc.length=c}if(a.Ta!=a.kc.length){for(var e={},c=b=0;b<a.kc.length;)d=a.kc[b],Oc(e,d)||(a.kc[c++]=d,e[d]=1),b++;a.kc.length=c}}k.get=function(a,b){return Oc(this.H,a)?this.H[a]:b};k.set=function(a,b){Oc(this.H,a)||(this.Ta++,this.kc.push(a),this.Hm++);this.H[a]=b};
k.addAll=function(a){var b;a instanceof Mc?(b=a.Ld(),a=a.he()):(b=qb(a),a=pb(a));for(var c=0;c<b.length;c++)this.set(b[c],a[c])};k.forEach=function(a,b){for(var c=this.Ld(),d=0;d<c.length;d++){var e=c[d],f=this.get(e);a.call(b,f,e,this)}};k.clone=function(){return new Mc(this)};function Oc(a,b){return Object.prototype.hasOwnProperty.call(a,b)};function Qc(){this.yg=-1};function Rc(){this.yg=64;this.Gc=Array(4);this.IA=Array(this.yg);this.xp=this.Ek=0;this.reset()}u(Rc,Qc);Rc.prototype.reset=function(){this.Gc[0]=1732584193;this.Gc[1]=4023233417;this.Gc[2]=2562383102;this.Gc[3]=271733878;this.xp=this.Ek=0};
function Sc(a,b,c){c||(c=0);var d=Array(16);if(p(b))for(var e=0;16>e;++e)d[e]=b.charCodeAt(c++)|b.charCodeAt(c++)<<8|b.charCodeAt(c++)<<16|b.charCodeAt(c++)<<24;else for(e=0;16>e;++e)d[e]=b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24;b=a.Gc[0];c=a.Gc[1];var e=a.Gc[2],f=a.Gc[3],g;g=b+(f^c&(e^f))+d[0]+3614090360&4294967295;b=c+(g<<7&4294967295|g>>>25);g=f+(e^b&(c^e))+d[1]+3905402710&4294967295;f=b+(g<<12&4294967295|g>>>20);g=e+(c^f&(b^c))+d[2]+606105819&4294967295;e=f+(g<<17&4294967295|g>>>15);g=c+(b^e&(f^
b))+d[3]+3250441966&4294967295;c=e+(g<<22&4294967295|g>>>10);g=b+(f^c&(e^f))+d[4]+4118548399&4294967295;b=c+(g<<7&4294967295|g>>>25);g=f+(e^b&(c^e))+d[5]+1200080426&4294967295;f=b+(g<<12&4294967295|g>>>20);g=e+(c^f&(b^c))+d[6]+2821735955&4294967295;e=f+(g<<17&4294967295|g>>>15);g=c+(b^e&(f^b))+d[7]+4249261313&4294967295;c=e+(g<<22&4294967295|g>>>10);g=b+(f^c&(e^f))+d[8]+1770035416&4294967295;b=c+(g<<7&4294967295|g>>>25);g=f+(e^b&(c^e))+d[9]+2336552879&4294967295;f=b+(g<<12&4294967295|g>>>20);g=e+
(c^f&(b^c))+d[10]+4294925233&4294967295;e=f+(g<<17&4294967295|g>>>15);g=c+(b^e&(f^b))+d[11]+2304563134&4294967295;c=e+(g<<22&4294967295|g>>>10);g=b+(f^c&(e^f))+d[12]+1804603682&4294967295;b=c+(g<<7&4294967295|g>>>25);g=f+(e^b&(c^e))+d[13]+4254626195&4294967295;f=b+(g<<12&4294967295|g>>>20);g=e+(c^f&(b^c))+d[14]+2792965006&4294967295;e=f+(g<<17&4294967295|g>>>15);g=c+(b^e&(f^b))+d[15]+1236535329&4294967295;c=e+(g<<22&4294967295|g>>>10);g=b+(e^f&(c^e))+d[1]+4129170786&4294967295;b=c+(g<<5&4294967295|
g>>>27);g=f+(c^e&(b^c))+d[6]+3225465664&4294967295;f=b+(g<<9&4294967295|g>>>23);g=e+(b^c&(f^b))+d[11]+643717713&4294967295;e=f+(g<<14&4294967295|g>>>18);g=c+(f^b&(e^f))+d[0]+3921069994&4294967295;c=e+(g<<20&4294967295|g>>>12);g=b+(e^f&(c^e))+d[5]+3593408605&4294967295;b=c+(g<<5&4294967295|g>>>27);g=f+(c^e&(b^c))+d[10]+38016083&4294967295;f=b+(g<<9&4294967295|g>>>23);g=e+(b^c&(f^b))+d[15]+3634488961&4294967295;e=f+(g<<14&4294967295|g>>>18);g=c+(f^b&(e^f))+d[4]+3889429448&4294967295;c=e+(g<<20&4294967295|
g>>>12);g=b+(e^f&(c^e))+d[9]+568446438&4294967295;b=c+(g<<5&4294967295|g>>>27);g=f+(c^e&(b^c))+d[14]+3275163606&4294967295;f=b+(g<<9&4294967295|g>>>23);g=e+(b^c&(f^b))+d[3]+4107603335&4294967295;e=f+(g<<14&4294967295|g>>>18);g=c+(f^b&(e^f))+d[8]+1163531501&4294967295;c=e+(g<<20&4294967295|g>>>12);g=b+(e^f&(c^e))+d[13]+2850285829&4294967295;b=c+(g<<5&4294967295|g>>>27);g=f+(c^e&(b^c))+d[2]+4243563512&4294967295;f=b+(g<<9&4294967295|g>>>23);g=e+(b^c&(f^b))+d[7]+1735328473&4294967295;e=f+(g<<14&4294967295|
g>>>18);g=c+(f^b&(e^f))+d[12]+2368359562&4294967295;c=e+(g<<20&4294967295|g>>>12);g=b+(c^e^f)+d[5]+4294588738&4294967295;b=c+(g<<4&4294967295|g>>>28);g=f+(b^c^e)+d[8]+2272392833&4294967295;f=b+(g<<11&4294967295|g>>>21);g=e+(f^b^c)+d[11]+1839030562&4294967295;e=f+(g<<16&4294967295|g>>>16);g=c+(e^f^b)+d[14]+4259657740&4294967295;c=e+(g<<23&4294967295|g>>>9);g=b+(c^e^f)+d[1]+2763975236&4294967295;b=c+(g<<4&4294967295|g>>>28);g=f+(b^c^e)+d[4]+1272893353&4294967295;f=b+(g<<11&4294967295|g>>>21);g=e+(f^
b^c)+d[7]+4139469664&4294967295;e=f+(g<<16&4294967295|g>>>16);g=c+(e^f^b)+d[10]+3200236656&4294967295;c=e+(g<<23&4294967295|g>>>9);g=b+(c^e^f)+d[13]+681279174&4294967295;b=c+(g<<4&4294967295|g>>>28);g=f+(b^c^e)+d[0]+3936430074&4294967295;f=b+(g<<11&4294967295|g>>>21);g=e+(f^b^c)+d[3]+3572445317&4294967295;e=f+(g<<16&4294967295|g>>>16);g=c+(e^f^b)+d[6]+76029189&4294967295;c=e+(g<<23&4294967295|g>>>9);g=b+(c^e^f)+d[9]+3654602809&4294967295;b=c+(g<<4&4294967295|g>>>28);g=f+(b^c^e)+d[12]+3873151461&4294967295;
f=b+(g<<11&4294967295|g>>>21);g=e+(f^b^c)+d[15]+530742520&4294967295;e=f+(g<<16&4294967295|g>>>16);g=c+(e^f^b)+d[2]+3299628645&4294967295;c=e+(g<<23&4294967295|g>>>9);g=b+(e^(c|~f))+d[0]+4096336452&4294967295;b=c+(g<<6&4294967295|g>>>26);g=f+(c^(b|~e))+d[7]+1126891415&4294967295;f=b+(g<<10&4294967295|g>>>22);g=e+(b^(f|~c))+d[14]+2878612391&4294967295;e=f+(g<<15&4294967295|g>>>17);g=c+(f^(e|~b))+d[5]+4237533241&4294967295;c=e+(g<<21&4294967295|g>>>11);g=b+(e^(c|~f))+d[12]+1700485571&4294967295;b=c+
(g<<6&4294967295|g>>>26);g=f+(c^(b|~e))+d[3]+2399980690&4294967295;f=b+(g<<10&4294967295|g>>>22);g=e+(b^(f|~c))+d[10]+4293915773&4294967295;e=f+(g<<15&4294967295|g>>>17);g=c+(f^(e|~b))+d[1]+2240044497&4294967295;c=e+(g<<21&4294967295|g>>>11);g=b+(e^(c|~f))+d[8]+1873313359&4294967295;b=c+(g<<6&4294967295|g>>>26);g=f+(c^(b|~e))+d[15]+4264355552&4294967295;f=b+(g<<10&4294967295|g>>>22);g=e+(b^(f|~c))+d[6]+2734768916&4294967295;e=f+(g<<15&4294967295|g>>>17);g=c+(f^(e|~b))+d[13]+1309151649&4294967295;
c=e+(g<<21&4294967295|g>>>11);g=b+(e^(c|~f))+d[4]+4149444226&4294967295;b=c+(g<<6&4294967295|g>>>26);g=f+(c^(b|~e))+d[11]+3174756917&4294967295;f=b+(g<<10&4294967295|g>>>22);g=e+(b^(f|~c))+d[2]+718787259&4294967295;e=f+(g<<15&4294967295|g>>>17);g=c+(f^(e|~b))+d[9]+3951481745&4294967295;a.Gc[0]=a.Gc[0]+b&4294967295;a.Gc[1]=a.Gc[1]+(e+(g<<21&4294967295|g>>>11))&4294967295;a.Gc[2]=a.Gc[2]+e&4294967295;a.Gc[3]=a.Gc[3]+f&4294967295}
Rc.prototype.update=function(a,b){m(b)||(b=a.length);for(var c=b-this.yg,d=this.IA,e=this.Ek,f=0;f<b;){if(0==e)for(;f<=c;)Sc(this,a,f),f+=this.yg;if(p(a))for(;f<b;){if(d[e++]=a.charCodeAt(f++),e==this.yg){Sc(this,d);e=0;break}}else for(;f<b;)if(d[e++]=a[f++],e==this.yg){Sc(this,d);e=0;break}}this.Ek=e;this.xp+=b};
Rc.prototype.digest=function(){var a=Array((56>this.Ek?this.yg:2*this.yg)-this.Ek);a[0]=128;for(var b=1;b<a.length-8;++b)a[b]=0;for(var c=8*this.xp,b=a.length-8;b<a.length;++b)a[b]=c&255,c/=256;this.update(a);a=Array(16);for(b=c=0;4>b;++b)for(var d=0;32>d;d+=8)a[c++]=this.Gc[b]>>>d&255;return a};function Tc(a,b,c,d){this.top=a;this.right=b;this.bottom=c;this.left=d}k=Tc.prototype;k.Nd=function(){return this.right-this.left};k.Ln=function(){return this.bottom-this.top};k.clone=function(){return new Tc(this.top,this.right,this.bottom,this.left)};k.toString=function(){return"("+this.top+"t, "+this.right+"r, "+this.bottom+"b, "+this.left+"l)"};
k.contains=function(a){return this&&a?a instanceof Tc?a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom<=this.bottom:a.x>=this.left&&a.x<=this.right&&a.y>=this.top&&a.y<=this.bottom:!1};k.expand=function(a,b,c,d){ka(a)?(this.top-=a.top,this.right+=a.right,this.bottom+=a.bottom,this.left-=a.left):(this.top-=a,this.right+=Number(b),this.bottom+=Number(c),this.left-=Number(d));return this};
k.ceil=function(){this.top=Math.ceil(this.top);this.right=Math.ceil(this.right);this.bottom=Math.ceil(this.bottom);this.left=Math.ceil(this.left);return this};k.floor=function(){this.top=Math.floor(this.top);this.right=Math.floor(this.right);this.bottom=Math.floor(this.bottom);this.left=Math.floor(this.left);return this};k.round=function(){this.top=Math.round(this.top);this.right=Math.round(this.right);this.bottom=Math.round(this.bottom);this.left=Math.round(this.left);return this};
k.translate=function(a,b){a instanceof rc?(this.left+=a.x,this.right+=a.x,this.top+=a.y,this.bottom+=a.y):(this.left+=a,this.right+=a,ha(b)&&(this.top+=b,this.bottom+=b));return this};k.scale=function(a,b){b=ha(b)?b:a;this.left*=a;this.right*=a;this.top*=b;this.bottom*=b;return this};function Uc(a,b){var c=vc(a);return c.defaultView&&c.defaultView.getComputedStyle&&(a=c.defaultView.getComputedStyle(a,null))?a[b]||a.getPropertyValue(b)||"":""}function Vc(a){var b;try{b=a.getBoundingClientRect()}catch(c){return{left:0,top:0,right:0,bottom:0}}Eb&&a.ownerDocument.body&&(a=a.ownerDocument,b.left-=a.documentElement.clientLeft+a.body.clientLeft,b.top-=a.documentElement.clientTop+a.body.clientTop);return b}
function Wc(a){var b=Xc;if("none"!=(Uc(a,"display")||(a.currentStyle?a.currentStyle.display:null)||a.style&&a.style.display))return b(a);var c=a.style,d=c.display,e=c.visibility,f=c.position;c.visibility="hidden";c.position="absolute";c.display="inline";a=b(a);c.display=d;c.position=f;c.visibility=e;return a}function Xc(a){var b=a.offsetWidth,c=a.offsetHeight,d=Hb&&!b&&!c;return m(b)&&!d||!a.getBoundingClientRect?new sc(b,c):(a=Vc(a),new sc(a.right-a.left,a.bottom-a.top))}
function Yc(a,b){a.style.display=b?"":"none"}function Zc(a,b,c,d){if(/^\d+px?$/.test(b))return parseInt(b,10);var e=a.style[c],f=a.runtimeStyle[c];a.runtimeStyle[c]=a.currentStyle[c];a.style[c]=b;b=a.style[d];a.style[c]=e;a.runtimeStyle[c]=f;return b}function $c(a,b){return(b=a.currentStyle?a.currentStyle[b]:null)?Zc(a,b,"left","pixelLeft"):0}
function ad(a,b){if(Eb){var c=$c(a,b+"Left"),d=$c(a,b+"Right"),e=$c(a,b+"Top");a=$c(a,b+"Bottom");return new Tc(e,d,a,c)}c=Uc(a,b+"Left");d=Uc(a,b+"Right");e=Uc(a,b+"Top");a=Uc(a,b+"Bottom");return new Tc(parseFloat(e),parseFloat(d),parseFloat(a),parseFloat(c))}var bd={thin:2,medium:4,thick:6};function cd(a,b){if("none"==(a.currentStyle?a.currentStyle[b+"Style"]:null))return 0;b=a.currentStyle?a.currentStyle[b+"Width"]:null;return b in bd?bd[b]:Zc(a,b,"left","pixelLeft")};var dd=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function ed(a,b){if(a){a=a.split("&");for(var c=0;c<a.length;c++){var d=a[c].indexOf("="),e,f=null;0<=d?(e=a[c].substring(0,d),f=a[c].substring(d+1)):e=a[c];b(e,f?decodeURIComponent(f.replace(/\+/g," ")):"")}}}
function fd(a){if(a[1]){var b=a[0],c=b.indexOf("#");0<=c&&(a.push(b.substr(c)),a[0]=b=b.substr(0,c));c=b.indexOf("?");0>c?a[1]="?":c==b.length-1&&(a[1]=void 0)}return a.join("")}function gd(a,b,c){if(fa(b))for(var d=0;d<b.length;d++)gd(a,String(b[d]),c);else null!=b&&c.push("&",a,""===b?"":"=",encodeURIComponent(String(b)))}function hd(a,b){for(var c in b)gd(c,b[c],a);return a};function id(a,b){this.Mf=this.Vi=this.hh="";this.Tj=null;this.$h=this.mf="";this.je=this.aE=!1;var c;a instanceof id?(this.je=m(b)?b:a.je,jd(this,a.hh),c=a.Vi,kd(this),this.Vi=c,c=a.Mf,kd(this),this.Mf=c,ld(this,a.Tj),c=a.mf,kd(this),this.mf=c,md(this,a.dg.clone()),a=a.$h,kd(this),this.$h=a):a&&(c=String(a).match(dd))?(this.je=!!b,jd(this,c[1]||"",!0),a=c[2]||"",kd(this),this.Vi=nd(a),a=c[3]||"",kd(this),this.Mf=nd(a,!0),ld(this,c[4]),a=c[5]||"",kd(this),this.mf=nd(a,!0),md(this,c[6]||"",!0),a=c[7]||
"",kd(this),this.$h=nd(a)):(this.je=!!b,this.dg=new od(null,0,this.je))}
id.prototype.toString=function(){var a=[],b=this.hh;b&&a.push(pd(b,qd,!0),":");var c=this.Mf;if(c||"file"==b)a.push("//"),(b=this.Vi)&&a.push(pd(b,qd,!0),"@"),a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c=this.Tj,null!=c&&a.push(":",String(c));if(c=this.mf)this.Mf&&"/"!=c.charAt(0)&&a.push("/"),a.push(pd(c,"/"==c.charAt(0)?sd:td,!0));(c=this.dg.toString())&&a.push("?",c);(c=this.$h)&&a.push("#",pd(c,ud));return a.join("")};
id.prototype.resolve=function(a){var b=this.clone(),c=!!a.hh;c?jd(b,a.hh):c=!!a.Vi;if(c){var d=a.Vi;kd(b);b.Vi=d}else c=!!a.Mf;c?(d=a.Mf,kd(b),b.Mf=d):c=null!=a.Tj;d=a.mf;if(c)ld(b,a.Tj);else if(c=!!a.mf){if("/"!=d.charAt(0))if(this.Mf&&!this.mf)d="/"+d;else{var e=b.mf.lastIndexOf("/");-1!=e&&(d=b.mf.substr(0,e+1)+d)}e=d;if(".."==e||"."==e)d="";else if(-1!=e.indexOf("./")||-1!=e.indexOf("/.")){for(var d=0==e.lastIndexOf("/",0),e=e.split("/"),f=[],g=0;g<e.length;){var h=e[g++];"."==h?d&&g==e.length&&
f.push(""):".."==h?((1<f.length||1==f.length&&""!=f[0])&&f.pop(),d&&g==e.length&&f.push("")):(f.push(h),d=!0)}d=f.join("/")}else d=e}c?(kd(b),b.mf=d):c=""!==a.dg.toString();c?md(b,nd(a.dg.toString())):c=!!a.$h;c&&(a=a.$h,kd(b),b.$h=a);return b};id.prototype.clone=function(){return new id(this)};function jd(a,b,c){kd(a);a.hh=c?nd(b,!0):b;a.hh&&(a.hh=a.hh.replace(/:$/,""))}function ld(a,b){kd(a);if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.Tj=b}else a.Tj=null}
function md(a,b,c){kd(a);b instanceof od?(a.dg=b,a.dg.Gs(a.je)):(c||(b=pd(b,vd)),a.dg=new od(b,0,a.je))}function kd(a){if(a.aE)throw Error("Tried to modify a read-only Uri");}id.prototype.Gs=function(a){this.je=a;this.dg&&this.dg.Gs(a);return this};function wd(a){return a instanceof id?a.clone():new id(a,void 0)}function xd(a,b){a instanceof id||(a=wd(a));b instanceof id||(b=wd(b));return a.resolve(b)}function nd(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}
function pd(a,b,c){return p(a)?(a=encodeURI(a).replace(b,yd),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function yd(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var qd=/[#\/\?@]/g,td=/[\#\?:]/g,sd=/[\#\?]/g,vd=/[\#\?@]/g,ud=/#/g;function od(a,b,c){this.Ta=this.Qb=null;this.Jd=a||null;this.je=!!c}function zd(a){a.Qb||(a.Qb=new Mc,a.Ta=0,a.Jd&&ed(a.Jd,function(b,c){a.add(decodeURIComponent(b.replace(/\+/g," ")),c)}))}k=od.prototype;k.Eg=function(){zd(this);return this.Ta};
k.add=function(a,b){zd(this);this.Jd=null;a=Ad(this,a);var c=this.Qb.get(a);c||this.Qb.set(a,c=[]);c.push(b);this.Ta+=1;return this};k.remove=function(a){zd(this);a=Ad(this,a);return this.Qb.qd(a)?(this.Jd=null,this.Ta-=this.Qb.get(a).length,this.Qb.remove(a)):!1};k.clear=function(){this.Qb=this.Jd=null;this.Ta=0};k.fd=function(){zd(this);return 0==this.Ta};k.qd=function(a){zd(this);a=Ad(this,a);return this.Qb.qd(a)};
k.Ld=function(){zd(this);for(var a=this.Qb.he(),b=this.Qb.Ld(),c=[],d=0;d<b.length;d++)for(var e=a[d],f=0;f<e.length;f++)c.push(b[d]);return c};k.he=function(a){zd(this);var b=[];if(p(a))this.qd(a)&&(b=$a(b,this.Qb.get(Ad(this,a))));else{a=this.Qb.he();for(var c=0;c<a.length;c++)b=$a(b,a[c])}return b};k.set=function(a,b){zd(this);this.Jd=null;a=Ad(this,a);this.qd(a)&&(this.Ta-=this.Qb.get(a).length);this.Qb.set(a,[b]);this.Ta+=1;return this};
k.get=function(a,b){a=a?this.he(a):[];return 0<a.length?String(a[0]):b};k.toString=function(){if(this.Jd)return this.Jd;if(!this.Qb)return"";for(var a=[],b=this.Qb.Ld(),c=0;c<b.length;c++)for(var d=b[c],e=encodeURIComponent(String(d)),d=this.he(d),f=0;f<d.length;f++){var g=e;""!==d[f]&&(g+="="+encodeURIComponent(String(d[f])));a.push(g)}return this.Jd=a.join("&")};k.clone=function(){var a=new od;a.Jd=this.Jd;this.Qb&&(a.Qb=this.Qb.clone(),a.Ta=this.Ta);return a};
function Ad(a,b){b=String(b);a.je&&(b=b.toLowerCase());return b}k.Gs=function(a){a&&!this.je&&(zd(this),this.Jd=null,this.Qb.forEach(function(a,c){var b=c.toLowerCase();c!=b&&(this.remove(c),this.remove(b),0<a.length&&(this.Jd=null,this.Qb.set(Ad(this,b),ab(a)),this.Ta+=a.length))},this));this.je=a};k.extend=function(a){for(var b=0;b<arguments.length;b++)Lc(arguments[b],function(a,b){this.add(b,a)},this)};var Bd=Hb?"webkitfullscreenchange":Gb?"mozfullscreenchange":Eb?"MSFullscreenChange":"fullscreenchange";function Cd(){var a=tc().Ze,b=a.body;return!!(b.webkitRequestFullscreen||b.mozRequestFullScreen&&a.mozFullScreenEnabled||b.msRequestFullscreen&&a.msFullscreenEnabled||b.requestFullscreen&&a.fullscreenEnabled)}
function Dd(a){a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.msRequestFullscreen?a.msRequestFullscreen():a.requestFullscreen&&a.requestFullscreen()}function Ed(){var a=tc().Ze;return!!(a.webkitIsFullScreen||a.mozFullScreen||a.msFullscreenElement||a.fullscreenElement)};function Fd(a){this.length=a.length||a;for(var b=0;b<this.length;b++)this[b]=a[b]||0}Fd.prototype.BYTES_PER_ELEMENT=4;Fd.prototype.set=function(a,b){b=b||0;for(var c=0;c<a.length&&b+c<this.length;c++)this[b+c]=a[c]};Fd.prototype.toString=Array.prototype.join;"undefined"==typeof Float32Array&&(Fd.BYTES_PER_ELEMENT=4,Fd.prototype.BYTES_PER_ELEMENT=Fd.prototype.BYTES_PER_ELEMENT,Fd.prototype.set=Fd.prototype.set,Fd.prototype.toString=Fd.prototype.toString,ta("Float32Array",Fd));function Gd(a){this.length=a.length||a;for(var b=0;b<this.length;b++)this[b]=a[b]||0}Gd.prototype.BYTES_PER_ELEMENT=8;Gd.prototype.set=function(a,b){b=b||0;for(var c=0;c<a.length&&b+c<this.length;c++)this[b+c]=a[c]};Gd.prototype.toString=Array.prototype.join;if("undefined"==typeof Float64Array){try{Gd.BYTES_PER_ELEMENT=8}catch(a){}Gd.prototype.BYTES_PER_ELEMENT=Gd.prototype.BYTES_PER_ELEMENT;Gd.prototype.set=Gd.prototype.set;Gd.prototype.toString=Gd.prototype.toString;ta("Float64Array",Gd)};function Hd(a,b,c,d,e){a[0]=b;a[1]=c;a[2]=d;a[3]=e};function Id(){var a=Array(16);Jd(a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return a}function Kd(){var a=Array(16);Jd(a,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return a}function Jd(a,b,c,d,e,f,g,h,l,n,r,t,v,x,y,B,E){a[0]=b;a[1]=c;a[2]=d;a[3]=e;a[4]=f;a[5]=g;a[6]=h;a[7]=l;a[8]=n;a[9]=r;a[10]=t;a[11]=v;a[12]=x;a[13]=y;a[14]=B;a[15]=E}
function Ld(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}function Md(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1}
function Nd(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],l=a[6],n=a[7],r=a[8],t=a[9],v=a[10],x=a[11],y=a[12],B=a[13],E=a[14];a=a[15];var I=c*h-d*g,w=c*l-e*g,A=c*n-f*g,G=d*l-e*h,O=d*n-f*h,K=e*n-f*l,N=r*B-t*y,ba=r*E-v*y,P=r*a-x*y,da=t*E-v*B,ia=t*a-x*B,oa=v*a-x*E,Z=I*oa-w*ia+A*da+G*P-O*ba+K*N;0!=Z&&(Z=1/Z,b[0]=(h*oa-l*ia+n*da)*Z,b[1]=(-d*oa+e*ia-f*da)*Z,b[2]=(B*K-E*O+a*G)*Z,b[3]=(-t*K+v*O-x*G)*Z,b[4]=(-g*oa+l*P-n*ba)*Z,b[5]=(c*oa-e*P+f*ba)*Z,b[6]=(-y*K+E*A-a*w)*Z,b[7]=(r*K-v*A+x*w)*Z,b[8]=(g*ia-
h*P+n*N)*Z,b[9]=(-c*ia+d*P-f*N)*Z,b[10]=(y*O-B*A+a*I)*Z,b[11]=(-r*O+t*A-x*I)*Z,b[12]=(-g*da+h*ba-l*N)*Z,b[13]=(c*da-d*ba+e*N)*Z,b[14]=(-y*G+B*w-E*I)*Z,b[15]=(r*G-t*w+v*I)*Z)}function Od(a,b,c){var d=a[1]*b+a[5]*c+0*a[9]+a[13],e=a[2]*b+a[6]*c+0*a[10]+a[14],f=a[3]*b+a[7]*c+0*a[11]+a[15];a[12]=a[0]*b+a[4]*c+0*a[8]+a[12];a[13]=d;a[14]=e;a[15]=f}function Pd(a,b,c){Jd(a,a[0]*b,a[1]*b,a[2]*b,a[3]*b,a[4]*c,a[5]*c,a[6]*c,a[7]*c,1*a[8],1*a[9],1*a[10],1*a[11],a[12],a[13],a[14],a[15])}
function Qd(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],l=a[6],n=a[7],r=Math.cos(b);b=Math.sin(b);a[0]=c*r+g*b;a[1]=d*r+h*b;a[2]=e*r+l*b;a[3]=f*r+n*b;a[4]=c*-b+g*r;a[5]=d*-b+h*r;a[6]=e*-b+l*r;a[7]=f*-b+n*r};function z(){}ta("vitisApp",z);z.Pj={};z.on=function(a,b){null!=z.Pj[a]?z.Pj[a].push(b):z.Pj[a]=[b]};z.Gk=function(a){if(null!=z.Pj[a])for(var b=0;b<z.Pj[a].length;b++)z.Pj[a][b].call()};z.htmlentities=function(a){var b="\u00e0\u00e2\u00e7\u00e8\u00e9\u00ea\u00ee\u00ef\u00f4\u00f9\u00fb".split("");return a.replace(/./gm,function(a){return-1!=b.indexOf(a)?"&#"+a.charCodeAt(0)+";":a})};
$(document).ready(function(){$(document).on("show.bs.modal",".modal",function(){$(this).parent().append('<div class="submodal-backdrop modal-backdrop fade in"></div>')});$(document).on("hide.bs.modal",".modal",function(){$(this).parent().find(".submodal-backdrop").remove()})});
function Rd(a){for(var b=[/[\300-\306]/g,/[\340-\346]/g,/[\310-\313]/g,/[\350-\353]/g,/[\314-\317]/g,/[\354-\357]/g,/[\322-\330]/g,/[\362-\370]/g,/[\331-\334]/g,/[\371-\374]/g,/[\321]/g,/[\361]/g,/[\307]/g,/[\347]/g],c="AaEeIiOoUuNnCc".split(""),d=0;d<b.length;d++)a=a.replace(b[d],c[d]);return a}
function Sd(a){for(var b=["request","service","version"],c,d,e=0;e<b.length;e++)c=a.toLowerCase().indexOf("&"+b[e]+"="),-1!==c?(d=a.toLowerCase().indexOf("&",c+1),a=0<d?a.replace(a.slice(c,d),""):a.replace(a.slice(c),"")):(c=a.toLowerCase().indexOf("?"+b[e]+"="),-1!==c&&(d=a.toLowerCase().indexOf("&",c+1),a=0<d?a.replace(a.slice(c,d+1),"?"):a.replace(a.slice(c),"")));return a};function Td(a,b){var c=Date.now();"undefined"!=typeof oClientProperties&&(c=oClientProperties.build);if("object"==typeof a&&null!=a){var d,e=!0,f=!1;"object"===typeof b&&(d=b.callback,"boolean"===typeof b.async&&(e=b.async),"boolean"===typeof b.scriptInBody&&(f=b.scriptInBody));b=document.getElementsByTagName("script");for(var g=[],h=0;h<b.length;)""!==b[h].src&&g.push(b[h].src),h++;for(var h=0,l=[];h<a.length;)a[h]=a[h]+"?version="+c,b=document.createElement("script"),b.setAttribute("src",a[h]),
-1===Ud(b.src,g)?l.push(a[h]):console.log(a[h]+" -> d\u00e9ja charg\u00e9"),h++;for(h=0;h<l.length;){b=document.createElement("script");b.setAttribute("src",l[h]);b.async=e;b.setAttribute("type","text/javascript");if("function"===typeof d){var n=function(){"undefined"===typeof d.sr&&(d.sr=0);d.sr++;d.sr===l.length&&(d(),this.onload=null)};void 0!==b.onload?b.onload=n:void 0!==b.onreadystatechange&&(b.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||n()})}f?document.getElementsByTagName("body")[0].appendChild(b):
document.getElementsByTagName("head")[0].appendChild(b);h++}0===l.length&&"function"===typeof d&&d()}}function Ud(a,b){var c=-1;if("undefined"!=typeof b.indexOf)c=b.indexOf(a);else for(var d=0;d<b;){if(-1!=b[d].indexOf(a)){c=d;break}d++}return c}
function Vd(){if(null===document.getElementById("ajax-modal")){var a=document.createElement("div");a.id="ajax-modal";a.className="modal-backdrop fade in";a.style.opacity="0.2";a.style["z-index"]="9999";document.getElementsByTagName("body")[0].appendChild(a)}if(null===document.getElementById("ajax-container")){var a=document.createElement("div"),b=document.createElement("span");a.id="ajax-container";a.className="ajax_loader_container";b.className="icon-refresh glyphicon-refresh-animate";a.appendChild(b);
document.getElementsByTagName("body")[0].appendChild(a)}}function Wd(){sessionStorage.loading_counter=0;var a=document.getElementById("ajax-modal");null!=a&&a.parentNode.removeChild(a);a=document.getElementById("ajax-container");null!=a&&a.parentNode.removeChild(a)};var C={};ta("oVmap",C);C.module=angular.module("vmap",["formReader"]);C.config=function(a){a.defaults.headers.get={Accept:"application/x-vm-json"};a.defaults.headers.post={Accept:"application/x-vm-json"}};C.config.$inject=["$httpProvider"];C.module.config(C.config);C.oF=function(){return function(a){var b=[],c;for(c in a)b.push(a[c]);return b}};C.module.filter("object2Array",C.oF);C.T=function(){return function(a){return typeof a}};C.module.filter("getType",C.T);
C.io=function(){return function(a){return null!=a}};C.module.filter("isDef",C.io);C.properties={};C.zx={};C.oa={};C.B={};C.log=function(a,b){null!=C.properties&&C.properties.debug_mode&&(m(b)?console.log(a,b):console.log(a))};C.log=C.log;
C.oi=function(){C.log("oVmap.init");z.Gk("vmapLoaded");if(null!=angular.element($("#app-vmap-loader")).scope())angular.element($("#app-vmap-loader")).scope().compileVmapTemplates();else z.on("vmapLoaderOk",function(){angular.element($("#app-vmap-loader")).scope().compileVmapTemplates()});var a=window.location.href;a.slice(0,a.lastIndexOf("/"));null!=sessionStorage.application||(sessionStorage.application=document.location.pathname.replace(/\//g,""));C.properties=window.oClientProperties;C.properties.api_url=
C.properties.web_server_name+"/"+C.properties.services_alias;C.log("sessionStorage[session_token] :");C.log(sessionStorage.session_token);C.properties.token=m(sessionStorage.session_token)?sessionStorage.session_token:C.Gv("token",window.location.href);null!=C.properties.token&&($.ajax({url:C.properties.api_url+"/vitis/properties?token="+C.properties.token,async:!1,dataType:"json",context:document.body}).done(function(a){xb(C.properties,a);C.log("properties: ",C.properties)}),$.ajax({url:C.properties.api_url+
"/vmap/crss?token="+C.properties.token,async:!0,dataType:"json",context:document.body}).done(function(a){a=a.crss;C.oProjections={};for(var b=0;b<a.length;b++)C.oProjections[a[b].crs_id]=a[b].name}));C.zx=new D;C.oa=new F;C.B=new Xd;C.ly();$(window).resize(C.ly);$('[data-toggle="tooltip"]').tooltip({animation:!1});C.ux=0;null!=z.oWebsocket&&z.oWebsocket.Vy("VmapEvents")};C.init=C.oi;
function Yd(){C.log("oVmap.vmapDirective");z.Gk("vmapDirectiveLoaded");return{restrict:"A",controller:"AppVmapController",controllerAs:"vmapCtrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/vmap.html"}}C.vmapDirective=Yd;
function Zd(a){C.log("oVmap.vmapController");this.V=a;this.lang=this.lang="fr";this.bottom_open=this.right_open=this.left_open=!1;this.map=this.map=C.g().F;this.xq=this.currentAction="";this.UF=this.proj=H(this.map).D().M;this.EJ=this.infos=[];C.scope=angular.element("#app-vmap").scope();C.ctrl=C.scope.vmapCtrl;C.scope.sizeOf=function(a){return Object.keys(a).length};C.scope.isDef=function(a){return null!=a};C.scope.$on("mapChanged",function(){C.scope.$applyAsync(function(){C.scope.ctrl.bottom_open=
!1;C.px()});C.My("tool-btn-active")})}C.vmapController=Zd;Zd.$inject=["$http"];C.g=function(){return this.zx};C.getMap=C.g;C.AC=function(){return this.oa};C.getMapManager=C.AC;C.TC=function(){return this.B};C.getToolsManager=C.TC;C.Gv=function(a,b){if(-1!==b.indexOf("?")&&(b=b.slice(b.indexOf("?")+1),-1!==b.indexOf(a+"=")))return b=b.slice(b.indexOf(a+"=")),-1!==b.indexOf("&")&&(a=b.indexOf("&"),b=b.slice(0,a)),a=b.indexOf("="),b=b.slice(a+1)};C.findInURL=C.Gv;C.Gw=function(){$("#current-projection").html(C.oProjections[H(C.g().F).D().M])};
C.LJ=function(a,b,c){if(c>=a.length)for(var d=c-a.length;d--+1;)a.push(void 0);a.splice(c,0,a.splice(b,1)[0]);return a};C.yt=function(a){a="object"!==typeof a?JSON.parse(a):a;var b="",c="";if($("#quote").is(":checked"))for(var d in a[0])var e=d+"",c=c+('"'+e.replace(/"/g,'""')+'",');else for(d in a[0])c+=d+",";for(var c=c.slice(0,-1),b=b+(c+"\r\n"),f=0;f<a.length;f++){c="";for(d in a[f])e=a[f][d]+"",c+='"'+e.replace(/"/g,'""')+'",';c=c.slice(0,-1);b+=c+"\r\n"}return b};
C.ph=function(a){C.log("simuleClick : "+a);if(null!=document.getElementById(a)){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);document.getElementById(a).dispatchEvent(b);b=document.createEvent("MouseEvents");b.initMouseEvent("mouseout",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);document.getElementById(a).dispatchEvent(b)}else console.error("target undefined: ",a)};C.simuleClick=C.ph;
C.My=function(a){C.log("simuleClickOnClass : "+a);var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);for(var c=document.getElementsByClassName(a),d=0;d<c.length;d++)c[d].dispatchEvent(b);b=document.createEvent("MouseEvents");b.initMouseEvent("mouseout",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);c=document.getElementsByClassName(a);for(d=0;d<c.length;d++)c[d].dispatchEvent(b)};C.simuleClickOnClass=C.My;
C.bz=function(){0<this.ux||(this.ux++,C.log(C.properties),m(C.properties.token)?$.get(C.properties.api_url+"/vitis/privatetoken?token="+C.properties.token,function(a){C.log(a);m(a.errorMessage)&&bootbox.confirm("<h4>Attention: "+a.errorMessage+"</h4>",function(){})}):bootbox.confirm("<h4>Attention: token non renseign\u00e9</h4>",function(){}))};
C.zB=function(a,b){$("#"+b).show();var c=document.getElementById(b),d=c.getElementsByTagName("*").length,e=zc("div",{id:b+"_"+d,"class":"alert alert-warning",role:"alert"},null);c.appendChild(e);c=zc("button",{"class":"close"},"x");c.onclick=function(){$("#"+b+"_"+d).hide()};e.appendChild(c);a=zc("strong",null,a);e.appendChild(a)};C.displaySucces=C.zB;
C.qB=function(a,b){$("#"+b).show();var c=document.getElementById(b),d=c.getElementsByTagName("*").length,e=zc("div",{id:b+"_"+d,"class":"alert alert-warning",role:"alert"},null);c.appendChild(e);c=zc("button",{"class":"close"},"x");c.onclick=function(){$("#"+b+"_"+d).hide()};e.appendChild(c);a=zc("strong",null,a);e.appendChild(a)};C.displayInfo=C.qB;
C.BB=function(a,b){$("#"+b).show();var c=document.getElementById(b),d=c.getElementsByTagName("*").length,e=zc("div",{id:b+"_"+d,"class":"alert alert-warning",role:"alert"},null);c.appendChild(e);c=zc("button",{"class":"close"},"x");c.onclick=function(){$("#"+b+"_"+d).hide()};e.appendChild(c);a=zc("strong",null,a);e.appendChild(a)};C.displayWarning=C.BB;
C.mB=function(a,b){a="Erreur: "+a;$("#"+b).show();var c=document.getElementById(b),d=c.getElementsByTagName("*").length,e=zc("div",{id:b+"_"+d,"class":"alert alert-warning",role:"alert"},null);c.appendChild(e);c=zc("button",{"class":"close"},"x");c.onclick=function(){$("#"+b+"_"+d).hide()};e.appendChild(c);a=zc("strong",null,a);e.appendChild(a)};C.displayError=C.mB;
C.jv=function(a,b){var c=0,d=0;m(a.target)&&$(a.target).animate({opacity:0},300,"linear").animate({opacity:1},300,"linear").animate({opacity:0},300,"linear").animate({opacity:1},300,"linear").animate({opacity:0},300,"linear").animate({opacity:1},300,"linear");if(m(a.target)){var e=$(a.target).offset();a.coordinates=[e.left,e.top]}if(!m(a.coordinates))return 0;a.type=m(a.type)?a.type:"top-right";var f=zc("div",{"class":"tooltip-error tooltip-error-"+a.type,role:"alert"},null);b=zc("strong",null,b);
document.body.appendChild(f);f.appendChild(b);"top-left"===a.type?(c=m(a.target)?0-f.offsetWidth+33:0-f.offsetWidth+13,d=0-f.offsetHeight-12):"top-right"===a.type?(c=$(a.target).width()-35,d=0-f.offsetHeight-12):"bottom-left"===a.type?(c=0-f.offsetWidth+33,d=$(a.target).height()+12):"bottom-right"===a.type&&(c=$(a.target).width()-35,d=$(a.target).height()+12);f.style.left=a.coordinates[0]+c+"px";f.style.top=a.coordinates[1]+d+"px";kc(document.body,"click",function(a){C.log("remove error tooltip");
a.target!==f&&document.body.removeChild(f)});return f};C.displayTooltipError=C.jv;
C.hm=function(a){function b(a){return"out"===$("#"+a).attr("collapse")?!0:!1}C.log("oVmap.resizeLayerTools: "+a);m(angular.element($("#olMap")).scope())&&angular.element($("#olMap")).scope().ctrl.rm();for(var c=["layertree","layersorder","maplegendcontainer"],d=0,e=c.length,f=0,f=$("#maplistlitle-container").height(),g=0;g<c.length;g++)f+=$("#"+c[g]+"-button").height(),!0===b(c[g])&&d++;for(var h=[],l=[],f=($("#left-sidebar").height()-f)/(e-d)-0,g=0;g<c.length;g++)h[g]=$("#"+c[g]).css("max-height"),
$("#"+c[g]).css({"max-height":""}),l[g]=$("#"+c[g]).height(),$("#"+c[g]).css({"max-height":h[g]}),!1===b(c[g])?h[g]=f:h[g]=0;(function(c,d,e){for(var f=[],g=[],h=[],l=0,n=0;n<c.length;n++)e[n]>=d[n]&&!1===b(c[n])?(f.push(c[n]),g.push(e[n]),h.push(d[n])):(d[n]>e[n]&&(l+=d[n]-e[n]),!0===a?$("#"+c[n]).animate({"max-height":d[n]}):$("#"+c[n]).css({"max-height":d[n]}));for(n=0;n<f.length;n++)c=l/f.length,!0===a?$("#"+f[n]).animate({"max-height":h[n]+c}):$("#"+f[n]).css({"max-height":h[n]+c})})(c,h,l)};
C.resizeLayerTools=C.hm;
C.SF=function(a){C.log("print: "+a);var b=this;a=$(a).html();this.nf=window.open("","Impression","height=400,width=600");this.nf.document.write("<html><head><title>Impression</title>");this.nf.document.write($("HEAD").html());this.nf.document.write("<style>.print-hidden{visibility: hidden !important;}</style>");this.nf.document.write("</head><body>");this.nf.document.write(a);this.nf.document.write("</body></html>");setTimeout(function(){b.nf.document.close();b.nf.focus();b.nf.print();b.nf.close()},
500)};C.printElem=C.SF;C.HE=function(){angular.element($("#olMap")).scope().ctrl.rm();$(".open-more-selection-info").toggleClass("reverse");$("#map-container").hasClass("open2")?($("#map-container").removeClass("open2"),$("#bottombar").removeClass("open2")):($("#map-container").addClass("open2"),$("#bottombar").addClass("open2"))};C.maxResizeBottomBar=C.HE;
C.px=function(){angular.element($("#olMap")).scope().ctrl.rm();$("#map-container").hasClass("open2")?($("#map-container").removeClass("open2"),$("#bottombar").removeClass("open2"),$(".open-more-selection-info").removeClass("reverse")):$("#map-container").hasClass("open")&&$("#map-container").addClass("minus")};C.minResizeBottomBar=C.px;C.ly=function(){C.hm(!1)};
C.hC=function(a,b){C.log("getEWKTFromWKT");return p(a)?p(b)?"SRID="+b.substr(5)+";"+a:(console.error("EPSGProj is not a string"),null):(console.error("WKTGeom is not a string"),null)};C.Of=function(a){var b;C.log("getEWKTFromWKT");if(null==a)return console.error("geom is not defined"),null;b=null!=b?b:H(C.g().F).D().M;if(!p(b))return console.error("proj is not a string"),null;a=(new $d).qt(a,{Ce:b,Fe:b});return"SRID="+b.substr(5)+";"+a};
C.ZD=function(a){C.log("isEWKTGeom");if("SRID="!==a.substr(0,5).toUpperCase())return!1;var b=new $d,c=a.substr(a.indexOf(";")+1);try{b.Yl(c)}catch(d){return console.error("readGeometry failed: ",a),!1}return!0};
C.vj=function(a,b){C.log("getGeomFromEWKT");if(!p(a))return console.error("EWKTGeom is not a string: ",a),null;b=null!=b?b:H(C.g().F).D().M;if(this.ZD(a)){var c=new $d,d=a.substr(a.indexOf(";")+1);a="EPSG:"+a.slice(5,a.indexOf(";"));return c.Yl(d,{Ce:a,Fe:b})}console.error("Geom is not an EWKT Geometry: ",a);return null};
C.bw=function(){var a=[];$('link[rel="stylesheet"]').each(function(){$.ajax({url:$(this).attr("href"),async:!1}).done(function(b){var c=document.createElement("style");c.type="text/css";c.styleSheet?c.styleSheet.cssText=b:c.appendChild(document.createTextNode(b));a.push(c)})});$("style").each(function(){var b=this.innerHTML,c=document.createElement("style");c.type="text/css";c.styleSheet?c.styleSheet.cssText=b:c.appendChild(document.createTextNode(b));a.push(c)});return a};C.getStyles=C.bw;
C.Fn=function(a){C.log("oVmap.generatePrintReport");if(null==a.printReportId)return console.error("generatePrintReport: opt_options.printReportId undefined"),0;if(null==a.ids)return console.error("generatePrintReport: opt_options.ids undefined"),0;var b=C.scope.vmapCtrl.V,c=a.printReportId;a=a.ids;for(var d="",e=0;e<a.length;e++)0<e&&(d+="|"),d+=a[e];var f=window.open("","_blank","height=400,width=600");if(null==f)return $.notify("Fen\u00eatre d'impression bloqu\u00e9e par le navigateur","error"),
0;f.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>');b({method:"POST",url:C.properties.api_url+"/vmap/printreportservices",params:{token:C.properties.token,printreport_id:c,ids:d}}).then(function(a){var b=!1;null!=a.data?null!=a.data.printreportservices?null!=a.data.printreportservices.fileurl?1!==a.data.status&&
(b=!0):b=!0:b=!0:b=!0;if(b)return $.notify("Une erreur est survenue lors de l'impression","error"),f.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">Une erreur est survenue lors de l\'impression</div>'),console.error("response: ",a),0;$.notify("Impression r\u00e9ussie","success");for(var b=C.bw(),c=0;c<b.length;c++)f.document.head.appendChild(b[c]);f.document.body.style.textAlign="center";f.document.body.innerHTML='<a href="'+a.data.printreportservices.fileurl+'" style="margin-top: calc(50vh - 46px);" class="btn btn-lg btn-primary btn-bs btn-outline" download>T\u00e9l\u00e9charger le rapport</a>'},
function(a){console.error(a);$.notify("Une erreur est survenue lors de l'impression","error");f.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">Une erreur est survenue lors de l\'impression</div>')})};C.generatePrintReport=C.Fn;
C.Au=function(a,b){return{link:function(c,d){b.log("formReader.appSubformDrtv.link");var e;c.compileVmapTemplates=function(){b.log("compileVmapTemplates");c.$applyAsync(function(){e=a('<div app-vmap id="app-vmap"></div>')(c);d.html("");d.append(e)})};z.Gk("vmapLoaderOk")}}};C.Au.$inject=["$compile","$log"];C.module.directive("appVmapLoader",C.Au);C.module.directive("appVmap",Yd);C.module.controller("AppVmapController",Zd);var ae;function be(){}var ce=Function("return this")();function de(a,b){this.type=a;this.target=b||null}de.prototype.preventDefault=de.prototype.stopPropagation=function(){this.WF=!0};function ee(a){a.stopPropagation()}function fe(a){a.preventDefault()};var ge="function"===typeof Object.assign?Object.assign:function(a,b){if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var c=Object(a),d=1,e=arguments.length;d<e;++d){var f=arguments[d];if(void 0!==f&&null!==f)for(var g in f)f.hasOwnProperty(g)&&(c[g]=f[g])}return c};function he(a){for(var b in a)delete a[b]}function ie(a){var b=[],c;for(c in a)b.push(a[c]);return b}function je(a){for(var b in a)return!1;return!b};var ke="olm_"+(1E4*Math.random()|0);function le(a){function b(b){var c=a.listener,e=a.Ju||a.target;a.fj&&me(a);return c.call(e,b)}return a.Mu=b}function ne(a,b,c,d){for(var e,f=0,g=a.length;f<g;++f)if(e=a[f],e.listener===b&&e.Ju===c)return d&&(e.deleteIndex=f),e}function oe(a,b){return(a=a[ke])?a[b]:void 0}function pe(a){var b=a[ke];b||(b=a[ke]={});return b}
function qe(a,b){var c=oe(a,b);if(c){for(var d=0,e=c.length;d<e;++d)a.removeEventListener(b,c[d].Mu),he(c[d]);c.length=0;if(c=a[ke])delete c[b],0===Object.keys(c).length&&delete a[ke]}}function J(a,b,c,d,e){var f=pe(a),g=f[b];g||(g=f[b]=[]);(f=ne(g,c,d,!1))?e||(f.fj=!1):(f={Ju:d,fj:!!e,listener:c,target:a,type:b},a.addEventListener(b,le(f)),g.push(f));return f}function re(a,b,c,d){return J(a,b,c,d,!0)}function se(a,b,c,d){(a=oe(a,b))&&(c=ne(a,c,d,!0))&&me(c)}
function me(a){if(a&&a.target){a.target.removeEventListener(a.type,a.Mu);var b=oe(a.target,a.type);if(b){var c="deleteIndex"in a?a.deleteIndex:b.indexOf(a);-1!==c&&b.splice(c,1);0===b.length&&qe(a.target,a.type)}he(a)}}function te(a){var b=pe(a),c;for(c in b)qe(a,c)};function ue(){}ue.prototype.Xh=!1;ue.prototype.Id=function(){this.Xh||(this.Xh=!0,this.Ca())};ue.prototype.Ca=be;function ve(){this.Vl={};this.kj={};this.xi={}}u(ve,ue);k=ve.prototype;k.addEventListener=function(a,b){var c=this.xi[a];c||(c=this.xi[a]=[]);-1===c.indexOf(b)&&c.push(b)};
k.dispatchEvent=function(a){var b="string"===typeof a?new de(a):a;a=b.type;b.target=this;var c=this.xi[a],d;if(c){a in this.kj||(this.kj[a]=0,this.Vl[a]=0);++this.kj[a];for(var e=0,f=c.length;e<f;++e)if(!1===c[e].call(this,b)||b.WF){d=!1;break}--this.kj[a];if(0===this.kj[a]){b=this.Vl[a];for(delete this.Vl[a];b--;)this.removeEventListener(a,be);delete this.kj[a]}return d}};k.Ca=function(){te(this)};k.hasListener=function(a){return a?a in this.xi:0<Object.keys(this.xi).length};
k.removeEventListener=function(a,b){var c=this.xi[a];c&&(b=c.indexOf(b),a in this.Vl?(c[b]=be,++this.Vl[a]):(c.splice(b,1),0===c.length&&delete this.xi[a]))};function we(){ve.call(this);this.bb=0}u(we,ve);function xe(a){if(Array.isArray(a))for(var b=0,c=a.length;b<c;++b)me(a[b]);else me(a)}we.prototype.R=function(){++this.bb;this.dispatchEvent("change")};we.prototype.on=function(a,b,c){if(Array.isArray(a)){for(var d=a.length,e=Array(d),f=0;f<d;++f)e[f]=J(this,a[f],b,c);return e}return J(this,a,b,c)};
function ye(a){var b=C.g().F;if(Array.isArray("postcompose"))for(var c=Array(11),d=0;11>d;++d)c[d]=re(b,"postcompose"[d],a,void 0);else re(b,"postcompose",a,void 0)}we.prototype.gt=xe;function ze(a,b,c){de.call(this,a);this.key=b;this.oldValue=c}u(ze,de);function Ae(a){we.call(this);q(this);this.xh={};void 0!==a&&this.Ac(a)}u(Ae,we);var Be={};function Ce(a){return Be.hasOwnProperty(a)?Be[a]:Be[a]="change:"+a}k=Ae.prototype;k.get=function(a){var b;this.xh.hasOwnProperty(a)&&(b=this.xh[a]);return b};k.Ld=function(){return Object.keys(this.xh)};function De(a){return ge({},a.xh)}
k.notify=function(a,b){var c;c=Ce(a);this.dispatchEvent(new ze(c,a,b));this.dispatchEvent(new ze("propertychange",a,b))};k.set=function(a,b,c){c?this.xh[a]=b:(c=this.xh[a],this.xh[a]=b,c!==b&&this.notify(a,c))};k.Ac=function(a,b){for(var c in a)this.set(c,a[c],b)};function Ee(a,b,c){de.call(this,a,c);this.element=b}u(Ee,de);function Fe(a){Ae.call(this);this.If=a?a:[];Ge(this)}u(Fe,Ae);k=Fe.prototype;k.clear=function(){for(;0<this.Lc();)this.pop()};k.extend=function(a){var b,c;b=0;for(c=a.length;b<c;++b)this.push(a[b]);return this};k.forEach=function(a,b){this.If.forEach(a,b)};k.L=function(){return this.If};k.item=function(a){return this.If[a]};k.Lc=function(){return this.get("length")};k.pop=function(){return He(this,this.Lc()-1)};
k.push=function(a){var b=this.If.length;this.If.splice(b,0,a);Ge(this);this.dispatchEvent(new Ee("add",a,this));return b};k.remove=function(a){var b=this.If,c,d;c=0;for(d=b.length;c<d;++c)if(b[c]===a)return He(this,c)};function He(a,b){var c=a.If[b];a.If.splice(b,1);Ge(a);a.dispatchEvent(new Ee("remove",c,a));return c}function Ge(a){a.set("length",a.If.length)};function Ie(){return!0}function Je(){return!1};function Ke(a){for(var b=Le(),c=0,d=a.length;c<d;++c)Me(b,a[c]);return b}function Ne(a,b,c){return c?(c[0]=a[0]-b,c[1]=a[1]-b,c[2]=a[2]+b,c[3]=a[3]+b,c):[a[0]-b,a[1]-b,a[2]+b,a[3]+b]}function Oe(a,b){return b?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b):a.slice()}function Pe(a,b){return a[0]<=b[0]&&b[2]<=a[2]&&a[1]<=b[1]&&b[3]<=a[3]}function Qe(a,b,c){return a[0]<=b&&b<=a[2]&&a[1]<=c&&c<=a[3]}function Le(){return[Infinity,Infinity,-Infinity,-Infinity]}
function Re(a,b,c,d,e){return e?(e[0]=a,e[1]=b,e[2]=c,e[3]=d,e):[a,b,c,d]}function Se(a){return Re(Infinity,Infinity,-Infinity,-Infinity,a)}function Te(a,b){var c=a[0];a=a[1];return Re(c,a,c,a,b)}function Ue(a,b){return a[0]==b[0]&&a[2]==b[2]&&a[1]==b[1]&&a[3]==b[3]}function Ve(a,b){b[0]<a[0]&&(a[0]=b[0]);b[2]>a[2]&&(a[2]=b[2]);b[1]<a[1]&&(a[1]=b[1]);b[3]>a[3]&&(a[3]=b[3])}function Me(a,b){b[0]<a[0]&&(a[0]=b[0]);b[0]>a[2]&&(a[2]=b[0]);b[1]<a[1]&&(a[1]=b[1]);b[1]>a[3]&&(a[3]=b[1])}
function We(a,b,c,d,e){for(;c<d;c+=e){var f=a,g=b[c],h=b[c+1];f[0]=Math.min(f[0],g);f[1]=Math.min(f[1],h);f[2]=Math.max(f[2],g);f[3]=Math.max(f[3],h)}return a}function Xe(a){var b=0;Ye(a)||(b=Ze(a)*$e(a));return b}function af(a){return[a[0],a[1]]}function bf(a){return[(a[0]+a[2])/2,(a[1]+a[3])/2]}
function cf(a,b,c,d,e){var f=b*d[0]/2;d=b*d[1]/2;b=Math.cos(c);var g=Math.sin(c);c=f*b;f*=g;b*=d;var h=d*g,l=a[0],n=a[1];a=l-c+h;d=l-c-h;g=l+c-h;c=l+c+h;var h=n-f-b,l=n-f+b,r=n+f+b,f=n+f-b;return Re(Math.min(a,d,g,c),Math.min(h,l,r,f),Math.max(a,d,g,c),Math.max(h,l,r,f),e)}function $e(a){return a[3]-a[1]}function df(a,b){var c=Le();ef(a,b)&&(c[0]=a[0]>b[0]?a[0]:b[0],c[1]=a[1]>b[1]?a[1]:b[1],c[2]=a[2]<b[2]?a[2]:b[2],c[3]=a[3]<b[3]?a[3]:b[3]);return c}function ff(a){return[a[0],a[3]]}
function Ze(a){return a[2]-a[0]}function ef(a,b){return a[0]<=b[2]&&a[2]>=b[0]&&a[1]<=b[3]&&a[3]>=b[1]}function Ye(a){return a[2]<a[0]||a[3]<a[1]}function gf(a,b){var c=(a[2]-a[0])/2*(b-1);b=(a[3]-a[1])/2*(b-1);a[0]-=c;a[2]+=c;a[1]-=b;a[3]+=b}function hf(a,b){a=[a[0],a[1],a[0],a[3],a[2],a[1],a[2],a[3]];b(a,a,2);var c=[a[0],a[2],a[4],a[6]],d=[a[1],a[3],a[5],a[7]];b=Math.min.apply(null,c);a=Math.min.apply(null,d);c=Math.max.apply(null,c);d=Math.max.apply(null,d);return Re(b,a,c,d,void 0)};function jf(a,b,c){return Math.min(Math.max(a,b),c)}var kf="cosh"in Math?Math.cosh:function(a){a=Math.exp(a);return(a+1/a)/2};function lf(a){return a*Math.PI/180}function mf(a,b){a%=b;return 0>a*b?a+b:a};/*

 Latitude/longitude spherical geodesy formulae taken from
 http://www.movable-type.co.uk/scripts/latlong.html
 Licensed under CC-BY-3.0.
*/
function nf(a){this.xc=a}function of(a,b){for(var c=0,d=b.length,e=b[d-1][0],f=b[d-1][1],g=0;g<d;g++)var h=b[g][0],l=b[g][1],c=c+lf(h-e)*(2+Math.sin(lf(f))+Math.sin(lf(l))),e=h,f=l;return c*a.xc*a.xc/2}function pf(a,b,c){var d=lf(b[1]),e=lf(c[1]),f=(e-d)/2;b=lf(c[0]-b[0])/2;d=Math.sin(f)*Math.sin(f)+Math.sin(b)*Math.sin(b)*Math.cos(d)*Math.cos(e);return 2*a.xc*Math.atan2(Math.sqrt(d),Math.sqrt(1-d))}
nf.prototype.offset=function(a,b,c){var d=lf(a[1]);b/=this.xc;var e=Math.asin(Math.sin(d)*Math.cos(b)+Math.cos(d)*Math.sin(b)*Math.cos(c));return[180*(lf(a[0])+Math.atan2(Math.sin(c)*Math.sin(b)*Math.cos(d),Math.cos(b)-Math.sin(d)*Math.sin(e)))/Math.PI,180*e/Math.PI]};var qf=new nf(6370997);var rf={};rf.degrees=2*Math.PI*qf.xc/360;rf.ft=.3048;rf.m=1;rf["us-ft"]=1200/3937;
function sf(a){this.M=a.code;this.ht=a.units;this.sc=void 0!==a.P?a.P:null;this.Vm=void 0!==a.iq?a.iq:"enu";this.rl=void 0!==a.global?a.global:!1;this.Ph=!(!this.rl||!this.sc);this.HC=void 0!==a.fi?a.fi:this.IC;this.ev=null;this.mx=a.lx;var b=tf,c=a.code,d=uf||ce.proj4;if("function"==typeof d&&void 0===b[c]){var e=d.fv(c);if(void 0!==e){void 0!==e.axis&&void 0===a.iq&&(this.Vm=e.axis);void 0===a.lx&&(this.mx=e.ZJ);void 0===a.units&&(this.ht=e.units);for(var f in b)b=d.fv(f),void 0!==b&&(a=vf(f),b===
e?wf([a,this]):(b=d(f,c),xf(a,this,b.forward,b.inverse)))}}}k=sf.prototype;k.Z=function(){return this.sc};k.ql=function(){return this.ht};function yf(a){return a.mx||rf[a.ht]}k.ep=function(a){this.sc=a;this.Ph=!(!this.rl||!a)};k.IC=function(a,b){if("degrees"==this.ql())return a;var c=zf(this,vf("EPSG:4326"));a=[b[0]-a/2,b[1],b[0]+a/2,b[1],b[0],b[1]-a/2,b[0],b[1]+a/2];a=c(a,a,2);c=pf(qf,a.slice(0,2),a.slice(2,4));a=pf(qf,a.slice(4,6),a.slice(6,8));c=(c+a)/2;a=yf(this);void 0!==a&&(c/=a);return c};
k.fi=function(a,b){return this.HC(a,b)};var tf={},Af={},uf=null;function wf(a){Bf(a);a.forEach(function(b){a.forEach(function(a){b!==a&&Cf(b,a,Df)})})}function Ef(a){tf[a.M]=a;Cf(a,a,Df)}function Bf(a){var b=[];a.forEach(function(a){b.push(Ef(a))})}function Ff(a){return a?"string"===typeof a?vf(a):a:vf("EPSG:3857")}function Cf(a,b,c){a=a.M;b=b.M;a in Af||(Af[a]={});Af[a][b]=c}function xf(a,b,c,d){a=vf(a);b=vf(b);Cf(a,b,Gf(c));Cf(b,a,Gf(d))}
function Gf(a){return function(b,c,d){var e=b.length;d=void 0!==d?d:2;c=void 0!==c?c:Array(e);var f,g;for(g=0;g<e;g+=d)for(f=a([b[g],b[g+1]]),c[g]=f[0],c[g+1]=f[1],f=d-1;2<=f;--f)c[g+f]=b[g+f];return c}}function vf(a){var b;if(a instanceof sf)b=a;else if("string"===typeof a){b=tf[a];var c=uf||ce.proj4;void 0===b&&"function"==typeof c&&void 0!==c.fv(a)&&(b=new sf({code:a}),Ef(b))}else b=null;return b}function Hf(a,b){if(a===b)return!0;var c=a.ql()===b.ql();return a.M===b.M?c:zf(a,b)===Df&&c}
function If(a,b){a=vf(a);b=vf(b);return zf(a,b)}function zf(a,b){a=a.M;b=b.M;var c;a in Af&&b in Af[a]&&(c=Af[a][b]);void 0===c&&(c=Jf);return c}function Jf(a,b){if(void 0!==b&&a!==b){Oa("This should not be used internally.");for(var c=0,d=a.length;c<d;++c)b[c]=a[c];a=b}return a}function Df(a,b){if(void 0!==b){for(var c=0,d=a.length;c<d;++c)b[c]=a[c];a=b}else a=a.slice();return a}function Kf(a,b,c){return If(b,c)(a,void 0,a.length)}function Lf(a,b,c){b=If(b,c);return hf(a,b)};function Mf(){Ae.call(this);this.sc=Le();this.Bv=-1;this.nh={};this.hp=this.oh=0}u(Mf,Ae);Mf.prototype.Xe=Je;Mf.prototype.Z=function(a){this.Bv!=this.bb&&(this.sc=this.hn(this.sc),this.Bv=this.bb);var b=this.sc;a?(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3]):a=b;return a};Mf.prototype.transform=function(a,b){this.Dk(If(a,b));return this};var Nf=/^#(?:[0-9a-f]{3}){1,2}$/i,Of=/^(?:rgb)?\((0|[1-9]\d{0,2}),\s?(0|[1-9]\d{0,2}),\s?(0|[1-9]\d{0,2})\)$/i,Pf=/^(?:rgba)?\((0|[1-9]\d{0,2}),\s?(0|[1-9]\d{0,2}),\s?(0|[1-9]\d{0,2}),\s?(0|1|0\.\d{0,10})\)$/i;function Qf(a){return Array.isArray(a)?a:Rf(a)}function Sf(a){if("string"!==typeof a){var b=a[0];b!=(b|0)&&(b=b+.5|0);var c=a[1];c!=(c|0)&&(c=c+.5|0);var d=a[2];d!=(d|0)&&(d=d+.5|0);a="rgba("+b+","+c+","+d+","+(void 0===a[3]?1:a[3])+")"}return a}
var Rf=function(){var a={},b=0;return function(c){var d;if(a.hasOwnProperty(c))d=a[c];else{if(1024<=b){d=0;for(var e in a)0===(d++&3)&&(delete a[e],--b)}var f,g;Nf.exec(c)?(g=3==c.length-1?1:2,d=parseInt(c.substr(1+0*g,g),16),e=parseInt(c.substr(1+1*g,g),16),f=parseInt(c.substr(1+2*g,g),16),1==g&&(d=(d<<4)+d,e=(e<<4)+e,f=(f<<4)+f),d=[d,e,f,1]):(g=Pf.exec(c))?(d=Number(g[1]),e=Number(g[2]),f=Number(g[3]),g=Number(g[4]),d=[d,e,f,g],d=Tf(d,d)):(g=Of.exec(c))?(d=Number(g[1]),e=Number(g[2]),f=Number(g[3]),
d=[d,e,f,1],d=Tf(d,d)):(Oa(c+" is not a valid color"),d=void 0);a[c]=d;++b}return d}}();function Tf(a,b){b=b||[];b[0]=jf(a[0]+.5|0,0,255);b[1]=jf(a[1]+.5|0,0,255);b[2]=jf(a[2]+.5|0,0,255);b[3]=jf(a[3],0,1);return b};function Uf(a){return"string"===typeof a||a instanceof CanvasPattern||a instanceof CanvasGradient?a:Sf(a)};function Vf(a,b){var c=document.createElement("CANVAS");a&&(c.width=a);b&&(c.height=b);return c.getContext("2d")}
var Wf=function(){var a;return function(){if(void 0===a){var b=document.createElement("P"),c,d={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.appendChild(b);for(var e in d)e in b.style&&(b.style[e]="translate(1px,1px)",c=ce.getComputedStyle(b).getPropertyValue(d[e]));document.body.removeChild(b);a=c&&"none"!==c}return a}}(),Xf=function(){var a;return function(){if(void 0===a){var b=document.createElement("P"),
c,d={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.appendChild(b);for(var e in d)e in b.style&&(b.style[e]="translate3d(1px,1px,1px)",c=ce.getComputedStyle(b).getPropertyValue(d[e]));document.body.removeChild(b);a=c&&"none"!==c}return a}}();
function Yf(a,b){var c=a.style;c.WebkitTransform=b;c.MozTransform=b;c.XI=b;c.msTransform=b;c.transform=b;Eb&&Ob("9.0")&&(a.style.transformOrigin="0 0")}function Zf(a,b){var c;if(Xf()){var d=Array(16);for(c=0;16>c;++c)d[c]=b[c].toFixed(6);Yf(a,"matrix3d("+d.join(",")+")")}else if(Wf()){b=[b[0],b[1],b[4],b[5],b[12],b[13]];d=Array(6);for(c=0;6>c;++c)d[c]=b[c].toFixed(6);Yf(a,"matrix("+d.join(",")+")")}else a.style.left=Math.round(b[12])+"px",a.style.top=Math.round(b[13])+"px"};var $f=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function ag(a,b){var c,d,e=$f.length;for(d=0;d<e;++d)try{if(c=a.getContext($f[d],b))return c}catch(f){}return null};var bg,cg="undefined"!==typeof navigator?navigator.userAgent.toLowerCase():"",dg=-1!==cg.indexOf("firefox"),eg=-1!==cg.indexOf("safari")&&-1===cg.indexOf("chrom"),fg=-1!==cg.indexOf("macintosh"),gg=ce.devicePixelRatio||1,hg=!1,ig=function(){if(!("HTMLCanvasElement"in ce))return!1;try{var a=Vf();return a?(void 0!==a.setLineDash&&(hg=!0),!0):!1}catch(b){return!1}}(),jg="geolocation"in ce.navigator,kg="ontouchstart"in ce,lg="PointerEvent"in ce,mg=!!ce.navigator.msPointerEnabled,ng=!1,og=[];
if("WebGLRenderingContext"in ce)try{var pg=ag(document.createElement("CANVAS"),{failIfMajorPerformanceCaveat:!0});pg&&(ng=!0,og=pg.getSupportedExtensions())}catch(a){}bg=ng;ae=og;var qg=[0,0,0,1],rg=[],sg=[0,0,0,1];function tg(a,b,c,d){0!==b&&(a.translate(c,d),a.rotate(b),a.translate(-c,-d))};function ug(a){a=a||{};this.nb=void 0!==a.color?a.color:null;this.Ag=void 0}ug.prototype.cl=function(){void 0===this.Ag&&(this.Ag=this.nb instanceof CanvasPattern||this.nb instanceof CanvasGradient?q(this.nb).toString():"f"+(this.nb?Sf(this.nb):"-"));return this.Ag};function vg(a){this.Ud=a.opacity;this.Bd=a.ap;this.pc=a.rotation;this.Zc=a.scale;this.jg=a.mk}k=vg.prototype;k.hl=function(){return this.Ud};k.Vb=function(){return this.pc};k.gb=function(){return this.Zc};k.Hs=function(a){this.Ud=a};k.mm=function(a){this.pc=a};k.rf=function(a){this.Zc=a};function wg(a){a=a||{};this.nb=void 0!==a.color?a.color:null;this.si=a.lineCap;this.ro=void 0!==a.Ea?a.Ea:null;this.ti=a.lineJoin;this.zi=a.miterLimit;this.Gd=a.width;this.Ag=void 0}wg.prototype.getLineDash=function(){return this.ro};wg.prototype.Nd=function(){return this.Gd};wg.prototype.setLineDash=function(a){this.ro=a;this.Ag=void 0};
wg.prototype.cl=function(){if(void 0===this.Ag){var a="s"+(this.nb?Sf(this.nb):"-")+","+(void 0!==this.si?this.si.toString():"-")+","+(this.ro?this.ro.toString():"-")+","+(void 0!==this.ti?this.ti:"-")+","+(void 0!==this.zi?this.zi.toString():"-")+","+(void 0!==this.Gd?this.Gd.toString():"-"),b=new Rc;b.update(a);a=b.digest();if(8192>=a.length)a=String.fromCharCode.apply(null,a);else{for(var b="",c=0;c<a.length;c+=8192)var d=cb(a,c,c+8192),b=b+String.fromCharCode.apply(null,d);a=b}this.Ag=a}return this.Ag};function xg(a){a=a||{};this.wl=this.ga=this.hj=null;this.Uc=void 0!==a.fill?a.fill:null;this.qc=void 0!==a.stroke?a.stroke:null;this.ah=a.xc;this.nc=[0,0];this.$n=this.Dj=this.Wd=this.Ec=null;this.Xo(a.kJ);vg.call(this,{opacity:1,ap:!1,rotation:0,scale:1,mk:void 0!==a.mk?a.mk:!0})}u(xg,vg);k=xg.prototype;k.bl=function(){return this.Ec};k.el=function(){return this.wl};k.xa=function(){return this.ga};k.wj=function(){return 2};k.fl=function(){return this.Dj};k.Yv=function(){return this.$n};k.ge=function(){return this.nc};
k.jl=function(){return this.ah};k.ja=function(){return this.Wd};k.Kw=be;k.load=be;k.lz=be;
k.Xo=function(a){var b=null,c,d=0;this.qc&&(c=Sf(this.qc.nb),d=this.qc.Nd(),void 0===d&&(d=1),b=this.qc.getLineDash(),hg||(b=null));var e=2*(this.ah+d)+1,b={strokeStyle:c,Sy:d,size:e,Ea:b};if(void 0===a){var f=Vf(e,e);this.ga=f.canvas;a=e=this.ga.width;this.ic(b,f,0,0);this.$n=[b.size,b.size];this.Uc?this.wl=this.ga:(f=Vf(b.size,b.size),this.wl=f.canvas,this.mv(b,f,0,0))}else e=Math.round(e),(c=!this.Uc)&&(f=this.mv.bind(this,b)),d=this.cl(),b=a.add(d,e,e,this.ic.bind(this,b),f),this.ga=b.Gb,this.nc=
[b.offsetX,b.offsetY],a=b.Gb.width,c?(this.wl=b.lw,this.$n=[b.lw.width,b.lw.height]):(this.wl=this.ga,this.$n=[a,a]);this.Ec=[e/2,e/2];this.Wd=[e,e];this.Dj=[a,a]};k.ic=function(a,b,c,d){b.setTransform(1,0,0,1,0,0);b.translate(c,d);b.beginPath();b.arc(a.size/2,a.size/2,this.ah,0,2*Math.PI,!0);this.Uc&&(b.fillStyle=Uf(this.Uc.nb),b.fill());this.qc&&(b.strokeStyle=a.strokeStyle,b.lineWidth=a.Sy,a.Ea&&b.setLineDash(a.Ea),b.stroke());b.closePath()};
k.mv=function(a,b,c,d){b.setTransform(1,0,0,1,0,0);b.translate(c,d);b.beginPath();b.arc(a.size/2,a.size/2,this.ah,0,2*Math.PI,!0);b.fillStyle=Sf(qg);b.fill();this.qc&&(b.strokeStyle=a.strokeStyle,b.lineWidth=a.Sy,a.Ea&&b.setLineDash(a.Ea),b.stroke());b.closePath()};k.cl=function(){var a=this.qc?this.qc.cl():"-",b=this.Uc?this.Uc.cl():"-";this.hj&&a==this.hj[1]&&b==this.hj[2]&&this.ah==this.hj[3]||(this.hj=["c"+a+b+(void 0!==this.ah?this.ah.toString():"-"),a,b,this.ah]);return this.hj[0]};function yg(a){a=a||{};this.bi=null;this.fe=zg;void 0!==a.geometry&&this.Rc(a.geometry);this.Uc=void 0!==a.fill?a.fill:null;this.aa=void 0!==a.Gb?a.Gb:null;this.qc=void 0!==a.stroke?a.stroke:null;this.La=void 0!==a.text?a.text:null;this.Rz=a.zIndex}k=yg.prototype;k.l=function(){return this.bi};k.xa=function(){return this.aa};k.Vc=function(){return this.Rz};
k.Rc=function(a){ja(a)?this.fe=a:"string"===typeof a?this.fe=function(b){return b.get(a)}:a?void 0!==a&&(this.fe=function(){return a}):this.fe=zg;this.bi=a};k.Ky=function(a){this.Rz=a};function Ag(a){if(!ja(a)){var b;b=Array.isArray(a)?a:[a];a=function(){return b}}return a}var Bg=null;function Cg(){if(!Bg){var a=new ug({color:"rgba(255,255,255,0.4)"}),b=new wg({color:"#3399CC",width:1.25});Bg=[new yg({Gb:new xg({fill:a,stroke:b,xc:5}),fill:a,stroke:b})]}return Bg}
function Dg(){var a={},b=[255,255,255,1],c=[0,153,255,1];a.Polygon=[new yg({fill:new ug({color:[255,255,255,.5]})})];a.MultiPolygon=a.Polygon;a.LineString=[new yg({stroke:new wg({color:b,width:5})}),new yg({stroke:new wg({color:c,width:3})})];a.MultiLineString=a.LineString;a.Circle=a.Polygon.concat(a.LineString);a.Point=[new yg({Gb:new xg({xc:6,fill:new ug({color:c}),stroke:new wg({color:b,width:1.5})}),zIndex:Infinity})];a.MultiPoint=a.Point;a.GeometryCollection=a.Polygon.concat(a.LineString,a.Point);
return a}function zg(a){return a.l()};function Eg(a){Ae.call(this);this.Mc=void 0;this.td="geometry";this.tf=null;this.kd=void 0;this.Gn=null;J(this,Ce(this.td),this.Tn,this);void 0!==a&&(a instanceof Mf||!a?this.Rc(a):this.Ac(a))}u(Eg,Ae);k=Eg.prototype;k.clone=function(){var a=new Eg(De(this));Fg(a,this.td);var b=this.l();b&&a.Rc(b.clone());(b=this.tf)&&a.Qe(b);return a};k.l=function(){return this.get(this.td)};k.Fb=function(){return this.Mc};k.hD=function(){this.R()};
k.Tn=function(){this.Gn&&(me(this.Gn),this.Gn=null);var a=this.l();a&&(this.Gn=J(a,"change",this.hD,this));this.R()};k.Rc=function(a){this.set(this.td,a)};k.Qe=function(a){this.kd=(this.tf=a)?Gg(a):void 0;this.R()};function Fg(a,b){se(a,Ce(a.td),a.Tn,a);a.td=b;J(a,Ce(a.td),a.Tn,a);a.Tn()}function Gg(a){if(!ja(a)){var b;b=Array.isArray(a)?a:[a];a=function(){return b}}return a};function Hg(a,b){return a>b?1:a<b?-1:0}function Ig(a,b,c){var d=a.length;if(a[0]<=b)return 0;if(!(b<=a[d-1])){if(0<c)for(c=1;c<d;++c){if(a[c]<b)return c-1}else if(0>c)for(c=1;c<d;++c){if(a[c]<=b)return c}else for(c=1;c<d;++c){if(a[c]==b)return c;if(a[c]<b)return a[c-1]-b<b-a[c]?c-1:c}Oa()}return d-1}function Jg(a,b){var c=ga(b)?b:[b],d=c.length;for(b=0;b<d;b++)a[a.length]=c[b]}function Kg(a,b){b=a.indexOf(b);var c=-1<b;c&&a.splice(b,1);return c}
function Lg(a,b){for(var c=a.length>>>0,d,e=0;e<c;e++)if(d=a[e],b(d,e,a))return d;return null}function Mg(a,b){var c=a.length;if(c!==b.length)return!1;for(var d=0;d<c;d++)if(a[d]!==b[d])return!1;return!0}function Ng(a){var b=Og,c=a.length,d=Array(a.length),e;for(e=0;e<c;e++)d[e]={index:e,value:a[e]};d.sort(function(a,c){return b(a.value,c.value)||a.index-c.index});for(e=0;e<a.length;e++)a[e]=d[e].value}function Pg(a,b){var c;return a.every(function(d,e){c=e;return!b(d,e,a)})?-1:c};function Qg(a,b){ve.call(this);this.yb=a;this.state=b;this.Wb=null;this.key=""}u(Qg,ve);Qg.prototype.R=function(){this.dispatchEvent("change")};Qg.prototype.getKey=function(){return q(this).toString()};Qg.prototype.Qa=function(){return this.state};var Rg=document.implementation.createDocument("","",null);function Sg(a){return Tg(a,!1,[]).join("")}function Tg(a,b,c){if(4==a.nodeType||3==a.nodeType)b?c.push(String(a.nodeValue).replace(/(\r\n|\r|\n)/g,"")):c.push(a.nodeValue);else for(a=a.firstChild;a;a=a.nextSibling)Tg(a,b,c);return c}function Ug(a){return(new DOMParser).parseFromString(a,"application/xml")}function Vg(a,b){return function(c,d){c=a.call(b,c,d);void 0!==c&&Jg(d[d.length-1],c)}}
function Wg(a,b){return function(c,d){c=a.call(void 0!==b?b:this,c,d);void 0!==c&&d[d.length-1].push(c)}}function Xg(a){return function(b,c){b=a.call(this,b,c);void 0!==b&&(c[c.length-1]=b)}}function Yg(a){return function(b,c){var d=a.call(this,b,c);void 0!==d&&(c=c[c.length-1],b=b.localName,(b in c?c[b]:c[b]=[]).push(d))}}function L(a,b){return function(c,d){var e=a.call(this,c,d);void 0!==e&&(d[d.length-1][void 0!==b?b:c.localName]=e)}}
function M(a){return function(b,c,d){a.call(this,b,c,d);d[d.length-1].node.appendChild(b)}}function Zg(a){var b,c;return function(d,e,f){if(void 0===b){b={};var g={};g[d.localName]=a;b[d.namespaceURI]=g;c=$g(d.localName)}ah(b,c,e,f)}}function $g(a){return function(b,c,d){b=c[c.length-1].node;c=a;void 0===c&&(c=d);return Rg.createElementNS(b.namespaceURI,c)}}var bh=$g();function ch(a,b){for(var c=b.length,d=Array(c),e=0;e<c;++e)d[e]=a[b[e]];return d}
function Q(a,b,c){c=void 0!==c?c:{};var d,e;d=0;for(e=a.length;d<e;++d)c[a[d]]=b;return c}function dh(a,b,c,d){for(b=b.firstElementChild;b;b=b.nextElementSibling){var e=a[b.namespaceURI];void 0!==e&&(e=e[b.localName],void 0!==e&&e.call(d,b,c))}}function R(a,b,c,d,e){d.push(a);dh(b,c,d,e);return d.pop()}function ah(a,b,c,d,e,f){for(var g=(void 0!==e?e:c).length,h,l,n=0;n<g;++n)h=c[n],void 0!==h&&(l=b.call(f,h,d,void 0!==e?e[n]:void 0),void 0!==l&&a[l.namespaceURI][l.localName].call(f,l,h,d))}
function eh(a,b,c,d,e,f,g){e.push(a);ah(b,c,d,e,f,g);e.pop()};function fh(a,b,c){return function(d,e,f){var g=new XMLHttpRequest;g.open("GET",ja(a)?a(d,e,f):a,!0);"arraybuffer"==b.T()&&(g.responseType="arraybuffer");g.onload=function(){if(200<=g.status&&300>g.status){var a=b.T(),d;"json"==a||"text"==a?d=g.responseText:"xml"==a?(d=g.responseXML)||(d=Ug(g.responseText)):"arraybuffer"==a?d=g.response:Oa("unexpected format type");d?c.call(this,b.Zj(d,{Fe:f}),b.Zl(d)):Oa("undefined or null source")}}.bind(this);g.send()}}
function gh(a,b){return fh(a,b,function(a){this.Hh(a)})};function hh(){return[[-Infinity,-Infinity,Infinity,Infinity]]};function ih(a,b,c,d){this.Yb=a;this.cc=b;this.lc=c;this.tc=d}k=ih.prototype;k.contains=function(a){return this.Xe(a[1],a[2])};k.Xe=function(a,b){return this.Yb<=a&&a<=this.cc&&this.lc<=b&&b<=this.tc};k.equals=function(a){return this.Yb==a.Yb&&this.lc==a.lc&&this.cc==a.cc&&this.tc==a.tc};k.extend=function(a){a.Yb<this.Yb&&(this.Yb=a.Yb);a.cc>this.cc&&(this.cc=a.cc);a.lc<this.lc&&(this.lc=a.lc);a.tc>this.tc&&(this.tc=a.tc)};k.Ln=function(){return this.tc-this.lc+1};
k.ja=function(){return[this.Nd(),this.Ln()]};k.Nd=function(){return this.cc-this.Yb+1};function jh(a,b){return a.Yb<=b.cc&&a.cc>=b.Yb&&a.lc<=b.tc&&a.tc>=b.lc};function kh(a){this.nw=a.html;this.pp=a.gz?a.gz:null};function lh(a){Ae.call(this);this.Xj=vf(a.ea);this.be=mh(a.Na);this.Ww=a.mb;this.ub=void 0!==a.state?a.state:"ready";this.Gp=void 0!==a.Sa?a.Sa:!1}u(lh,Ae);function mh(a){if("string"===typeof a)return[new kh({html:a})];if(a instanceof kh)return[a];if(Array.isArray(a)){for(var b=a.length,c=Array(b),d=0;d<b;d++){var e=a[d];c[d]="string"===typeof e?new kh({html:e}):e}return c}return null}lh.prototype.Ob=be;lh.prototype.D=function(){return this.Xj};lh.prototype.Qa=function(){return this.ub};
lh.prototype.refresh=function(){this.R()};var nh;
(function(){var a={Av:{}};(function(){function b(a,c){if(!(this instanceof b))return new b(a,c);this.Qp=Math.max(4,a||9);this.Dt=Math.max(2,Math.ceil(.4*this.Qp));c&&this.aA(c);this.clear()}function c(a,b){a.bbox=d(a,0,a.children.length,b)}function d(a,b,c,d){for(var f=[Infinity,Infinity,-Infinity,-Infinity],g;b<c;b++)g=a.children[b],e(f,a.Oc?d(g):g.bbox);return f}function e(a,b){a[0]=Math.min(a[0],b[0]);a[1]=Math.min(a[1],b[1]);a[2]=Math.max(a[2],b[2]);a[3]=Math.max(a[3],b[3])}function f(a,b){return a.bbox[0]-
b.bbox[0]}function g(a,b){return a.bbox[1]-b.bbox[1]}function h(a){return(a[2]-a[0])*(a[3]-a[1])}function l(a){return a[2]-a[0]+(a[3]-a[1])}function n(a,b){return a[0]<=b[0]&&a[1]<=b[1]&&b[2]<=a[2]&&b[3]<=a[3]}function r(a,b){return b[0]<=a[2]&&b[1]<=a[3]&&b[2]>=a[0]&&b[3]>=a[1]}function t(a,b,c,d,e){for(var f=[b,c],g;f.length;)c=f.pop(),b=f.pop(),c-b<=d||(g=b+Math.ceil((c-b)/d/2)*d,v(a,b,c,g,e),f.push(b,g,g,c))}function v(a,b,c,d,e){for(var f,g,h,l,n;c>b;){600<c-b&&(f=c-b+1,g=d-b+1,h=Math.log(f),
l=.5*Math.exp(2*h/3),n=.5*Math.sqrt(h*l*(f-l)/f)*(0>g-f/2?-1:1),h=Math.max(b,Math.floor(d-g*l/f+n)),g=Math.min(c,Math.floor(d+(f-g)*l/f+n)),v(a,h,g,d,e));f=a[d];g=b;l=c;x(a,b,d);for(0<e(a[c],f)&&x(a,b,c);g<l;){x(a,g,l);g++;for(l--;0>e(a[g],f);)g++;for(;0<e(a[l],f);)l--}0===e(a[b],f)?x(a,b,l):(l++,x(a,l,c));l<=d&&(b=l+1);d<=l&&(c=l-1)}}function x(a,b,c){var d=a[b];a[b]=a[c];a[c]=d}b.prototype={all:function(){return this.zt(this.data,[])},search:function(a){var b=this.data,c=[],d=this.$d;if(!r(a,b.bbox))return c;
for(var e=[],f,g,h,l;b;){f=0;for(g=b.children.length;f<g;f++)h=b.children[f],l=b.Oc?d(h):h.bbox,r(a,l)&&(b.Oc?c.push(h):n(a,l)?this.zt(h,c):e.push(h));b=e.pop()}return c},load:function(a){if(!a||!a.length)return this;if(a.length<this.Dt){for(var b=0,c=a.length;b<c;b++)this.Wc(a[b]);return this}a=this.Bt(a.slice(),0,a.length-1,0);this.data.children.length?this.data.height===a.height?this.Et(this.data,a):(this.data.height<a.height&&(b=this.data,this.data=a,a=b),this.Ct(a,this.data.height-a.height-1,
!0)):this.data=a;return this},Wc:function(a){a&&this.Ct(a,this.data.height-1);return this},clear:function(){this.data={children:[],height:1,bbox:[Infinity,Infinity,-Infinity,-Infinity],Oc:!0};return this},remove:function(a){if(!a)return this;for(var b=this.data,c=this.$d(a),d=[],e=[],f,g,h,l;b||d.length;){b||(b=d.pop(),g=d[d.length-1],f=e.pop(),l=!0);if(b.Oc&&(h=b.children.indexOf(a),-1!==h)){b.children.splice(h,1);d.push(b);this.$z(d);break}l||b.Oc||!n(b.bbox,c)?g?(f++,b=g.children[f],l=!1):b=null:
(d.push(b),e.push(f),f=0,g=b,b=b.children[0])}return this},$d:function(a){return a},tq:function(a,b){return a[0]-b[0]},uq:function(a,b){return a[1]-b[1]},toJSON:function(){return this.data},zt:function(a,b){for(var c=[];a;)a.Oc?b.push.apply(b,a.children):c.push.apply(c,a.children),a=c.pop();return b},Bt:function(a,b,d,e){var f=d-b+1,g=this.Qp,h;if(f<=g)return h={children:a.slice(b,d+1),height:1,bbox:null,Oc:!0},c(h,this.$d),h;e||(e=Math.ceil(Math.log(f)/Math.log(g)),g=Math.ceil(f/Math.pow(g,e-1)));
h={children:[],height:e,bbox:null,Oc:!1};var f=Math.ceil(f/g),g=f*Math.ceil(Math.sqrt(g)),l,n,r;for(t(a,b,d,g,this.tq);b<=d;b+=g)for(n=Math.min(b+g-1,d),t(a,b,n,f,this.uq),l=b;l<=n;l+=f)r=Math.min(l+f-1,n),h.children.push(this.Bt(a,l,r,e-1));c(h,this.$d);return h},Zz:function(a,b,c,d){for(var e,f,g,l,n,r,t,v;;){d.push(b);if(b.Oc||d.length-1===c)break;t=v=Infinity;e=0;for(f=b.children.length;e<f;e++)g=b.children[e],n=h(g.bbox),r=g.bbox,r=(Math.max(r[2],a[2])-Math.min(r[0],a[0]))*(Math.max(r[3],a[3])-
Math.min(r[1],a[1]))-n,r<v?(v=r,t=n<t?n:t,l=g):r===v&&n<t&&(t=n,l=g);b=l||b.children[0]}return b},Ct:function(a,b,c){var d=this.$d;c=c?a.bbox:d(a);var d=[],f=this.Zz(c,this.data,b,d);f.children.push(a);for(e(f.bbox,c);0<=b;)if(d[b].children.length>this.Qp)this.bA(d,b),b--;else break;this.Wz(c,d,b)},bA:function(a,b){var d=a[b],e=d.children.length,f=this.Dt;this.Xz(d,f,e);e=this.Yz(d,f,e);e={children:d.children.splice(e,d.children.length-e),height:d.height,bbox:null,Oc:!1};d.Oc&&(e.Oc=!0);c(d,this.$d);
c(e,this.$d);b?a[b-1].children.push(e):this.Et(d,e)},Et:function(a,b){this.data={children:[a,b],height:a.height+1,bbox:null,Oc:!1};c(this.data,this.$d)},Yz:function(a,b,c){var e,f,g,l,n,r,t;n=r=Infinity;for(e=b;e<=c-b;e++)f=d(a,0,e,this.$d),g=d(a,e,c,this.$d),l=Math.max(0,Math.min(f[2],g[2])-Math.max(f[0],g[0]))*Math.max(0,Math.min(f[3],g[3])-Math.max(f[1],g[1])),f=h(f)+h(g),l<n?(n=l,t=e,r=f<r?f:r):l===n&&f<r&&(r=f,t=e);return t},Xz:function(a,b,c){var d=a.Oc?this.tq:f,e=a.Oc?this.uq:g,h=this.At(a,
b,c,d);b=this.At(a,b,c,e);h<b&&a.children.sort(d)},At:function(a,b,c,f){a.children.sort(f);f=this.$d;var g=d(a,0,b,f),h=d(a,c-b,c,f),n=l(g)+l(h),r,t;for(r=b;r<c-b;r++)t=a.children[r],e(g,a.Oc?f(t):t.bbox),n+=l(g);for(r=c-b-1;r>=b;r--)t=a.children[r],e(h,a.Oc?f(t):t.bbox),n+=l(h);return n},Wz:function(a,b,c){for(;0<=c;c--)e(b[c].bbox,a)},$z:function(a){for(var b=a.length-1,d;0<=b;b--)0===a[b].children.length?0<b?(d=a[b-1].children,d.splice(d.indexOf(a[b]),1)):this.clear():c(a[b],this.$d)},aA:function(a){var b=
["return a"," - b",";"];this.tq=new Function("a","b",b.join(a[0]));this.uq=new Function("a","b",b.join(a[1]));this.$d=new Function("a","return [a"+a.join(", a")+"];")}};"undefined"!==typeof a?a.Av=b:"undefined"!==typeof self?self.aG=b:window.aG=b})();nh=a.Av})();function oh(a){this.Fi=nh(a);this.pi={};this.bh=0}k=oh.prototype;k.Wc=function(a,b){if(this.bh)throw Error("Can not insert value while reading");a=[a[0],a[1],a[2],a[3],b];this.Fi.Wc(a);this.pi[q(b)]=a};k.load=function(a,b){if(this.bh)throw Error("Can not insert values while reading");for(var c=Array(b.length),d=0,e=b.length;d<e;d++){var f=a[d],g=b[d],f=[f[0],f[1],f[2],f[3],g];c[d]=f;this.pi[q(g)]=f}this.Fi.load(c)};
k.remove=function(a){if(this.bh)throw Error("Can not remove value while reading");a=q(a);var b=this.pi[a];delete this.pi[a];return null!==this.Fi.remove(b)};k.update=function(a,b){var c=q(b);if(!Ue(this.pi[c].slice(0,4),a)){if(this.bh)throw Error("Can not update extent while reading");this.remove(b);this.Wc(a,b)}};k.getAll=function(){return this.Fi.all().map(function(a){return a[4]})};function ph(a,b){return a.Fi.search(b).map(function(a){return a[4]})}
k.forEach=function(a,b){++this.bh;try{return qh(this.getAll(),a,b)}finally{--this.bh}};function rh(a,b,c,d){++a.bh;try{return qh(ph(a,b),c,d)}finally{--a.bh}}function qh(a,b,c){for(var d,e=0,f=a.length;e<f&&!(d=b.call(c,a[e]));e++);return d}k.fd=function(){return je(this.pi)};k.clear=function(){this.Fi.clear();this.pi={}};k.Z=function(){return this.Fi.data.bbox};function sh(a){a=a||{};lh.call(this,{Na:a.Na,mb:a.mb,ea:void 0,state:"ready",Sa:void 0!==a.Sa?a.Sa:!0});this.Hl=be;this.Pq=a.format;this.Te=a.url;void 0!==a.oE?this.Hl=a.oE:void 0!==this.Te&&(this.Hl=gh(this.Te,this.Pq));this.xH=void 0!==a.wH?a.wH:hh;var b=void 0!==a.vh?a.vh:!0;this.Nb=b?new oh:null;this.Qw=new oh;this.yd={};this.gf={};this.Si={};this.pj={};this.ob=null;var c,d;a.features instanceof Fe?(c=a.features,d=c.L()):Array.isArray(a.features)&&(d=a.features);b||void 0!==c||(c=new Fe(d));void 0!==
d&&th(this,d);void 0!==c&&uh(this,c)}u(sh,lh);function vh(a,b){var c=q(b).toString();if(wh(a,c,b)){xh(a,c,b);var d=b.l();d?(c=d.Z(),a.Nb&&a.Nb.Wc(c,b)):a.yd[c]=b;a.dispatchEvent(new yh("addfeature",b))}a.R()}function xh(a,b,c){a.pj[b]=[J(c,"change",a.sl,a),J(c,"propertychange",a.sl,a)]}function wh(a,b,c){var d=!0,e=c.Fb();void 0!==e?e.toString()in a.gf?d=!1:a.gf[e.toString()]=c:a.Si[b]=c;return d}k=sh.prototype;k.Hh=function(a){th(this,a);this.R()};
function th(a,b){var c,d,e,f,g=[],h=[],l=[];d=0;for(e=b.length;d<e;d++)f=b[d],c=q(f).toString(),wh(a,c,f)&&h.push(f);d=0;for(e=h.length;d<e;d++)f=h[d],c=q(f).toString(),xh(a,c,f),(b=f.l())?(c=b.Z(),g.push(c),l.push(f)):a.yd[c]=f;a.Nb&&a.Nb.load(g,l);d=0;for(e=h.length;d<e;d++)a.dispatchEvent(new yh("addfeature",h[d]))}
function uh(a,b){var c=!1;J(a,"addfeature",function(a){c||(c=!0,b.push(a.wa),c=!1)});J(a,"removefeature",function(a){c||(c=!0,b.remove(a.wa),c=!1)});J(b,"add",function(a){c||(a=a.element,c=!0,vh(this,a),c=!1)},a);J(b,"remove",function(a){c||(a=a.element,c=!0,zh(this,a),c=!1)},a);a.ob=b}
k.clear=function(a){if(a){for(var b in this.pj)this.pj[b].forEach(me);this.ob||(this.pj={},this.gf={},this.Si={})}else if(this.Nb){this.Nb.forEach(this.os,this);for(var c in this.yd)this.os(this.yd[c])}this.ob&&this.ob.clear();this.Nb&&this.Nb.clear();this.Qw.clear();this.yd={};this.dispatchEvent(new yh("clear"));this.R()};function Ah(a,b,c,d){a.Nb?rh(a.Nb,b,c,d):a.ob&&a.ob.forEach(c,d)}k.Ka=function(){var a;this.ob?a=this.ob.L():this.Nb&&(a=this.Nb.getAll(),je(this.yd)||Jg(a,ie(this.yd)));return a};
k.Z=function(){return this.Nb.Z()};k.sl=function(a){a=a.target;var b=q(a).toString(),c=a.l();c?(c=c.Z(),b in this.yd?(delete this.yd[b],this.Nb&&this.Nb.Wc(c,a)):this.Nb&&this.Nb.update(c,a)):b in this.yd||(this.Nb&&this.Nb.remove(a),this.yd[b]=a);c=a.Fb();void 0!==c?(c=c.toString(),b in this.Si?(delete this.Si[b],this.gf[c]=a):this.gf[c]!==a&&(Bh(this,a),this.gf[c]=a)):b in this.Si||(Bh(this,a),this.Si[b]=a);this.R();this.dispatchEvent(new yh("changefeature",a))};
k.fd=function(){return this.Nb.fd()&&je(this.yd)};function Ch(a,b,c,d){var e=a.Qw;b=a.xH(b,c);var f,g;f=0;for(g=b.length;f<g;++f){var h=b[f];rh(e,h,function(a){return Pe(a.P,h)})||(a.Hl.call(a,h,c,d),e.Wc(h,{P:h.slice()}))}}function zh(a,b){var c=q(b).toString();c in a.yd?delete a.yd[c]:a.Nb&&a.Nb.remove(b);a.os(b);a.R()}
k.os=function(a){var b=q(a).toString();this.pj[b].forEach(me);delete this.pj[b];var c=a.Fb();void 0!==c?delete this.gf[c.toString()]:delete this.Si[b];this.dispatchEvent(new yh("removefeature",a))};function Bh(a,b){for(var c in a.gf)if(a.gf[c]===b){delete a.gf[c];break}}function yh(a,b){de.call(this,a);this.wa=b}u(yh,de);function Dh(a,b,c){de.call(this,a);this.map=b;this.He=void 0!==c?c:null}u(Dh,de);function Eh(a,b,c){de.call(this,a);this.originalEvent=b;a=c?c:{};this.buttons=Fh(a);this.pressure=a.pressure?a.pressure:this.buttons?.5:0;this.bubbles="bubbles"in a?a.bubbles:!1;this.cancelable="cancelable"in a?a.cancelable:!1;this.view="view"in a?a.view:null;this.detail="detail"in a?a.detail:null;this.screenX="screenX"in a?a.screenX:0;this.screenY="screenY"in a?a.screenY:0;this.clientX="clientX"in a?a.clientX:0;this.clientY="clientY"in a?a.clientY:0;this.ctrlKey="ctrlKey"in a?a.ctrlKey:!1;this.altKey=
"altKey"in a?a.altKey:!1;this.shiftKey="shiftKey"in a?a.shiftKey:!1;this.metaKey="metaKey"in a?a.metaKey:!1;this.button="button"in a?a.button:0;this.relatedTarget="relatedTarget"in a?a.relatedTarget:null;this.pointerId="pointerId"in a?a.pointerId:0;this.width="width"in a?a.width:0;this.height="height"in a?a.height:0;this.tiltX="tiltX"in a?a.tiltX:0;this.tiltY="tiltY"in a?a.tiltY:0;this.pointerType="pointerType"in a?a.pointerType:"";this.hwTimestamp="hwTimestamp"in a?a.hwTimestamp:0;this.isPrimary=
"isPrimary"in a?a.isPrimary:!1;b.preventDefault&&(this.preventDefault=function(){b.preventDefault()})}u(Eh,de);function Fh(a){if(a.buttons||Gh)a=a.buttons;else switch(a.which){case 1:a=1;break;case 2:a=4;break;case 3:a=2;break;default:a=0}return a}var Gh=!1;try{Gh=1===(new MouseEvent("click",{buttons:1})).buttons}catch(a){};function Hh(a,b){this.Oa=a;this.yo=b};function Ih(a){Hh.call(this,a,{mousedown:this.mousedown,mousemove:this.mousemove,mouseup:this.mouseup,mouseover:this.mouseover,mouseout:this.mouseout});this.Rb=a.Rb;this.Fw=[]}u(Ih,Hh);function Jh(a,b){a=a.Fw;var c=b.clientX;b=b.clientY;for(var d=0,e=a.length,f;d<e&&(f=a[d]);d++){var g=Math.abs(b-f[1]);if(25>=Math.abs(c-f[0])&&25>=g)return!0}return!1}
function Kh(a){var b=Lh(a,a),c=b.preventDefault;b.preventDefault=function(){a.preventDefault();c()};b.pointerId=1;b.isPrimary=!0;b.pointerType="mouse";return b}k=Ih.prototype;k.mousedown=function(a){if(!Jh(this,a)){(1).toString()in this.Rb&&this.cancel(a);var b=Kh(a);this.Rb[(1).toString()]=a;this.Oa.mj(b,a)}};k.mousemove=function(a){if(!Jh(this,a)){var b=Kh(a);this.Oa.move(b,a)}};
k.mouseup=function(a){if(!Jh(this,a)){var b=this.Rb[(1).toString()];b&&b.button===a.button&&(b=Kh(a),this.Oa.sk(b,a),delete this.Rb[(1).toString()])}};k.mouseover=function(a){if(!Jh(this,a)){var b=Kh(a);Mh(this.Oa,b,a)}};k.mouseout=function(a){if(!Jh(this,a)){var b=Kh(a);Nh(this.Oa,b,a)}};k.cancel=function(a){var b=Kh(a);this.Oa.cancel(b,a);delete this.Rb[(1).toString()]};function Oh(a){Hh.call(this,a,{MSPointerDown:this.VE,MSPointerMove:this.WE,MSPointerUp:this.ZE,MSPointerOut:this.XE,MSPointerOver:this.YE,MSPointerCancel:this.UE,MSGotPointerCapture:this.RE,MSLostPointerCapture:this.TE});this.Rb=a.Rb;this.Vz=["","unavailable","touch","pen","mouse"]}u(Oh,Hh);function Ph(a,b){var c=b;ha(b.pointerType)&&(c=Lh(b,b),c.pointerType=a.Vz[b.pointerType]);return c}k=Oh.prototype;k.VE=function(a){this.Rb[a.pointerId.toString()]=a;var b=Ph(this,a);this.Oa.mj(b,a)};
k.WE=function(a){var b=Ph(this,a);this.Oa.move(b,a)};k.ZE=function(a){var b=Ph(this,a);this.Oa.sk(b,a);delete this.Rb[a.pointerId.toString()]};k.XE=function(a){var b=Ph(this,a);Nh(this.Oa,b,a)};k.YE=function(a){var b=Ph(this,a);Mh(this.Oa,b,a)};k.UE=function(a){var b=Ph(this,a);this.Oa.cancel(b,a);delete this.Rb[a.pointerId.toString()]};k.TE=function(a){this.Oa.dispatchEvent(new Eh("lostpointercapture",a,a))};k.RE=function(a){this.Oa.dispatchEvent(new Eh("gotpointercapture",a,a))};function Qh(a){Hh.call(this,a,{pointerdown:this.HF,pointermove:this.IF,pointerup:this.LF,pointerout:this.JF,pointerover:this.KF,pointercancel:this.GF,gotpointercapture:this.ZC,lostpointercapture:this.vE})}u(Qh,Hh);k=Qh.prototype;k.HF=function(a){Rh(this.Oa,a)};k.IF=function(a){Rh(this.Oa,a)};k.LF=function(a){Rh(this.Oa,a)};k.JF=function(a){Rh(this.Oa,a)};k.KF=function(a){Rh(this.Oa,a)};k.GF=function(a){Rh(this.Oa,a)};k.vE=function(a){Rh(this.Oa,a)};k.ZC=function(a){Rh(this.Oa,a)};function Sh(a,b){Hh.call(this,a,{touchstart:this.bI,touchmove:this.aI,touchend:this.$H,touchcancel:this.ZH});this.Rb=a.Rb;this.NE=b;this.al=void 0;this.qq=0;this.gm=void 0}u(Sh,Hh);k=Sh.prototype;k.ky=function(){this.qq=0;this.gm=void 0};
function Th(a,b,c){b=Lh(b,c);b.pointerId=c.identifier+2;b.bubbles=!0;b.cancelable=!0;b.detail=a.qq;b.button=0;b.buttons=1;b.width=c.webkitRadiusX||c.radiusX||0;b.height=c.webkitRadiusY||c.radiusY||0;b.pressure=c.webkitForce||c.force||.5;b.isPrimary=a.al===c.identifier;b.pointerType="touch";b.clientX=c.clientX;b.clientY=c.clientY;b.screenX=c.screenX;b.screenY=c.screenY;return b}
function Uh(a,b,c){function d(){b.preventDefault()}var e=Array.prototype.slice.call(b.changedTouches),f=e.length,g,h;for(g=0;g<f;++g)h=Th(a,b,e[g]),h.preventDefault=d,c.call(a,b,h)}
k.bI=function(a){var b=a.touches,c=Object.keys(this.Rb),d=c.length;if(d>=b.length){var e=[],f,g,h;for(f=0;f<d;++f){g=c[f];h=this.Rb[g];var l;if(!(l=1==g))a:{l=b.length;for(var n,r=0;r<l;r++)if(n=b[r],n.identifier===g-2){l=!0;break a}l=!1}l||e.push(h.$f)}for(f=0;f<e.length;++f)this.pq(a,e[f])}b=a.changedTouches[0];c=Object.keys(this.Rb).length;if(0===c||1===c&&(1).toString()in this.Rb)this.al=b.identifier,void 0!==this.gm&&ce.clearTimeout(this.gm);Vh(this,a);this.qq++;Uh(this,a,this.uF)};
k.uF=function(a,b){this.Rb[b.pointerId]={target:b.target,$f:b,Jx:b.target};var c=this.Oa;b.bubbles=!0;c.fireEvent(Wh,b,a);this.Oa.enter(b,a);this.Oa.mj(b,a)};k.aI=function(a){a.preventDefault();Uh(this,a,this.PE)};k.PE=function(a,b){var c=this.Rb[b.pointerId];if(c){var d=c.$f,e=c.Jx;this.Oa.move(b,a);d&&e!==b.target&&(d.relatedTarget=b.target,b.relatedTarget=e,d.target=e,b.target?(Nh(this.Oa,d,a),Mh(this.Oa,b,a)):(b.target=e,b.relatedTarget=null,this.pq(a,b)));c.$f=b;c.Jx=b.target}};
k.$H=function(a){Vh(this,a);Uh(this,a,this.pI)};k.pI=function(a,b){this.Oa.sk(b,a);this.Oa.$f(b,a);this.Oa.leave(b,a);delete this.Rb[b.pointerId];b.isPrimary&&(this.al=void 0,this.gm=ce.setTimeout(this.ky.bind(this),200))};k.ZH=function(a){Uh(this,a,this.pq)};k.pq=function(a,b){this.Oa.cancel(b,a);this.Oa.$f(b,a);this.Oa.leave(b,a);delete this.Rb[b.pointerId];b.isPrimary&&(this.al=void 0,this.gm=ce.setTimeout(this.ky.bind(this),200))};
function Vh(a,b){var c=a.NE.Fw;b=b.changedTouches[0];if(a.al===b.identifier){var d=[b.clientX,b.clientY];c.push(d);ce.setTimeout(function(){Kg(c,d)},2500)}};function Xh(a){ve.call(this);this.kb=a;this.Rb={};this.zv={};this.Xk=[];lg?Yh(this,new Qh(this)):mg?Yh(this,new Oh(this)):(a=new Ih(this),Yh(this,a),kg&&Yh(this,new Sh(this,a)));a=this.Xk.length;for(var b,c=0;c<a;c++)b=this.Xk[c],Zh(this,Object.keys(b.yo))}u(Xh,ve);function Yh(a,b){var c=Object.keys(b.yo);c&&(c.forEach(function(a){var c=b.yo[a];c&&(this.zv[a]=c.bind(b))},a),a.Xk.push(b))}k=Xh.prototype;k.yv=function(a){var b=this.zv[a.type];b&&b(a)};
function Zh(a,b){b.forEach(function(a){J(this.kb,a,this.yv,this)},a)}function $h(a,b){b.forEach(function(a){se(this.kb,a,this.yv,this)},a)}function Lh(a,b){for(var c={},d,e=0,f=ai.length;e<f;e++)d=ai[e][0],c[d]=a[d]||b[d]||ai[e][1];return c}k.mj=function(a,b){this.fireEvent(bi,a,b)};k.move=function(a,b){this.fireEvent(ci,a,b)};k.sk=function(a,b){this.fireEvent(di,a,b)};k.enter=function(a,b){a.bubbles=!1;this.fireEvent(ei,a,b)};k.leave=function(a,b){a.bubbles=!1;this.fireEvent(fi,a,b)};
k.$f=function(a,b){a.bubbles=!0;this.fireEvent(gi,a,b)};k.cancel=function(a,b){this.fireEvent(hi,a,b)};function Nh(a,b,c){a.$f(b,c);var d=b.relatedTarget;d&&Gc(b.target,d)||a.leave(b,c)}function Mh(a,b,c){b.bubbles=!0;a.fireEvent(Wh,b,c);var d=b.relatedTarget;d&&Gc(b.target,d)||a.enter(b,c)}k.fireEvent=function(a,b,c){this.dispatchEvent(new Eh(a,c,b))};function Rh(a,b){a.dispatchEvent(new Eh(b.type,b,b))}
k.Ca=function(){for(var a=this.Xk.length,b,c=0;c<a;c++)b=this.Xk[c],$h(this,Object.keys(b.yo));Xh.cb.Ca.call(this)};
var ci="pointermove",bi="pointerdown",di="pointerup",Wh="pointerover",gi="pointerout",ei="pointerenter",fi="pointerleave",hi="pointercancel",ai=[["bubbles",!1],["cancelable",!1],["view",null],["detail",null],["screenX",0],["screenY",0],["clientX",0],["clientY",0],["ctrlKey",!1],["altKey",!1],["shiftKey",!1],["metaKey",!1],["button",0],["relatedTarget",null],["buttons",0],["pointerId",0],["width",0],["height",0],["pressure",0],["tiltX",0],["tiltY",0],["pointerType",""],["hwTimestamp",0],["isPrimary",
!1],["type",""],["target",null],["currentTarget",null],["which",0]];function ii(a,b,c,d,e){Dh.call(this,a,b,e);this.originalEvent=c;this.Yc=ji(b,c);this.zb=b.Kd(this.Yc)}u(ii,Dh);ii.prototype.preventDefault=function(){ii.cb.preventDefault.call(this);this.originalEvent.preventDefault()};ii.prototype.stopPropagation=function(){ii.cb.stopPropagation.call(this);this.originalEvent.stopPropagation()};function ki(a,b,c,d,e){ii.call(this,a,b,c.originalEvent,0,e);this.fs=c}u(ki,ii);
function li(a){ve.call(this);this.H=a;this.Kk=0;this.Cg=!1;this.Ee=[];this.Vk=null;a=this.H.Tb;this.Ht=0;this.bt={};this.Sj=new Xh(a);this.Bg=null;this.gs=J(this.Sj,bi,this.yD,this);this.ns=J(this.Sj,ci,this.hG,this)}u(li,ve);function mi(a,b){var c;c=new ki(ni,a.H,b);a.dispatchEvent(c);0!==a.Kk?(ce.clearTimeout(a.Kk),a.Kk=0,c=new ki(oi,a.H,b),a.dispatchEvent(c)):a.Kk=ce.setTimeout(function(){this.Kk=0;var a=new ki(pi,this.H,b);this.dispatchEvent(a)}.bind(a),250)}
function qi(a,b){b.type==ri||b.type==si?delete a.bt[b.pointerId]:b.type==ti&&(a.bt[b.pointerId]=!0);a.Ht=Object.keys(a.bt).length}k=li.prototype;k.jw=function(a){qi(this,a);var b=new ki(ri,this.H,a);this.dispatchEvent(b);!this.Cg&&0===a.button&&mi(this,this.Vk);0===this.Ht&&(this.Ee.forEach(me),this.Ee.length=0,this.Cg=!1,this.Vk=null,this.Bg.Id(),this.Bg=null)};
k.yD=function(a){qi(this,a);var b=new ki(ti,this.H,a);this.dispatchEvent(b);this.Vk=a;0===this.Ee.length&&(this.Bg=new Xh(document),this.Ee.push(J(this.Bg,ui,this.Bj,this),J(this.Bg,ri,this.jw,this),J(this.Sj,si,this.jw,this)))};k.Bj=function(a){if(a.clientX!=this.Vk.clientX||a.clientY!=this.Vk.clientY){this.Cg=!0;var b=new ki(vi,this.H,a);this.dispatchEvent(b)}a.preventDefault()};k.hG=function(a){this.dispatchEvent(new ki(a.type,this.H,a))};
k.Ca=function(){this.ns&&(me(this.ns),this.ns=null);this.gs&&(me(this.gs),this.gs=null);this.Ee.forEach(me);this.Ee.length=0;this.Bg&&(this.Bg.Id(),this.Bg=null);this.Sj&&(this.Sj.Id(),this.Sj=null);li.cb.Ca.call(this)};var pi="singleclick",ni="click",oi="dblclick",vi="pointerdrag",ui="pointermove",ti="pointerdown",ri="pointerup",si="pointercancel",wi={gJ:pi,VI:ni,WI:oi,$I:vi,cJ:ui,ZI:ti,fJ:ri,eJ:"pointerover",dJ:"pointerout",aJ:"pointerenter",bJ:"pointerleave",YI:si};function xi(a){Ae.call(this);var b=ge({},a);b.opacity=void 0!==a.opacity?a.opacity:1;b.visible=void 0!==a.visible?a.visible:!0;b.zIndex=void 0!==a.zIndex?a.zIndex:0;b.maxResolution=void 0!==a.Ke?a.Ke:Infinity;b.minResolution=void 0!==a.le?a.le:0;this.Ac(b)}u(xi,Ae);function yi(a){var b=a.hl(),c=a.cr(),d=a.getVisible(),e=a.Z(),f=a.Vc(),g=a.get("maxResolution"),h=a.get("minResolution");return{layer:a,opacity:jf(b,0,1),Ns:c,visible:d,Kl:!0,P:e,zIndex:f,Ke:g,le:Math.max(h,0)}}k=xi.prototype;k.Z=function(){return this.get("extent")};
k.hl=function(){return this.get("opacity")};k.getVisible=function(){return this.get("visible")};k.Vc=function(){return this.get("zIndex")};k.ep=function(a){this.set("extent",a)};k.Hs=function(a){this.set("opacity",a)};k.setVisible=function(a){this.set("visible",a)};k.Ky=function(a){this.set("zIndex",a)};function zi(){};function Ai(a,b,c,d,e){de.call(this,a,b);this.He=d;this.context=e}u(Ai,de);function Bi(a){var b=ge({},a);delete b.source;xi.call(this,b);this.jp=this.xo=this.wo=null;a.map&&this.Ua(a.map);J(this,Ce("source"),this.DD,this);this.set("source",a.source?a.source:null)}u(Bi,xi);function Ci(a,b){return a.visible&&b>=a.le&&b<a.Ke}k=Bi.prototype;k.Wq=function(a){a=a?a:[];a.push(yi(this));return a};k.v=function(){return this.get("source")||null};k.cr=function(){var a=this.v();return a?a.Qa():"undefined"};k.lr=function(){this.R()};
k.DD=function(){this.jp&&(me(this.jp),this.jp=null);var a=this.v();a&&(this.jp=J(a,"change",this.lr,this));this.R()};k.Ua=function(a){this.wo&&(me(this.wo),this.wo=null);a||this.R();this.xo&&(me(this.xo),this.xo=null);a&&(this.wo=J(a,"precompose",function(a){var b=yi(this);b.Kl=!1;b.zIndex=Infinity;a.He.ri.push(b);a.He.Fl[q(this)]=b},this),this.xo=J(this,"change",a.ka,a),this.R())};function Di(a,b,c,d,e){ve.call(this);this.be=e;this.P=a;this.Ad=c;this.ca=b;this.state=d}u(Di,ve);Di.prototype.R=function(){this.dispatchEvent("change")};Di.prototype.Z=function(){return this.P};Di.prototype.na=function(){return this.ca};Di.prototype.Qa=function(){return this.state};function Ei(){this.Ta=0;this.nj={};this.me=this.Td=null}k=Ei.prototype;k.clear=function(){this.Ta=0;this.nj={};this.me=this.Td=null};k.qd=function(a){return this.nj.hasOwnProperty(a)};k.forEach=function(a,b){for(var c=this.Td;c;)a.call(b,c.wh,c.Og,this),c=c.Le};k.get=function(a){a=this.nj[a];if(a===this.me)return a.wh;a===this.Td?(this.Td=this.Td.Le,this.Td.Yg=null):(a.Le.Yg=a.Yg,a.Yg.Le=a.Le);a.Le=null;a.Yg=this.me;this.me=this.me.Le=a;return a.wh};k.Eg=function(){return this.Ta};
k.Ld=function(){var a=Array(this.Ta),b=0,c;for(c=this.me;c;c=c.Yg)a[b++]=c.Og;return a};k.he=function(){var a=Array(this.Ta),b=0,c;for(c=this.me;c;c=c.Yg)a[b++]=c.wh;return a};k.pop=function(){var a=this.Td;delete this.nj[a.Og];a.Le&&(a.Le.Yg=null);this.Td=a.Le;this.Td||(this.me=null);--this.Ta;return a.wh};k.replace=function(a,b){this.get(a);this.nj[a].wh=b};k.set=function(a,b){b={Og:a,Le:null,Yg:this.me,wh:b};this.me?this.me.Le=b:this.Td=b;this.me=b;this.nj[a]=b;++this.Ta};function Fi(a,b,c,d){return void 0!==d?(d[0]=a,d[1]=b,d[2]=c,d):[a,b,c]}function Gi(a){var b=a[0],c=Array(b),d=1<<b-1,e,f;for(e=0;e<b;++e)f=48,a[1]&d&&(f+=1),a[2]&d&&(f+=2),c[e]=String.fromCharCode(f),d>>=1;return c.join("")};function Hi(a){Ei.call(this);this.OD=void 0!==a?a:2048}u(Hi,Ei);Hi.prototype.Oh=function(){return this.Eg()>this.OD};Hi.prototype.oj=function(a){for(var b,c;this.Oh()&&!(b=this.Td.wh,c=b.yb[0].toString(),c in a&&a[c].contains(b.yb));)this.pop().Id()};function Ii(a,b,c){void 0===c&&(c=[0,0]);c[0]=a[0]*b+.5|0;c[1]=a[1]*b+.5|0;return c}function Ji(a,b){if(Array.isArray(a))return a;void 0===b?b=[a,a]:(b[0]=a,b[1]=a);return b};function Ki(a){this.Rd=void 0!==a.Rd?a.Rd:0;this.ue=a.oc;this.Xb=this.ue.length-1;this.nc=void 0!==a.origin?a.origin:null;this.bs=null;void 0!==a.Lo&&(this.bs=a.Lo);var b=a.P;void 0===b||this.nc||this.bs||(this.nc=ff(b));this.Zs=null;void 0!==a.qp&&(this.Zs=a.qp);this.hz=void 0!==a.ng?a.ng:this.Zs?null:256;this.sc=void 0!==b?b:null;this.tj=null;this.Ri=[0,0];void 0!==a.sizes?this.tj=a.sizes.map(function(a){return new ih(Math.min(0,a[0]),Math.max(a[0]-1,-1),Math.min(0,a[1]),Math.max(a[1]-1,-1))},this):
b&&Li(this,b)}var Mi=[0,0,0];function Ni(a,b,c,d,e){e=Oi(a,b,e);for(b=b[0]-1;b>=a.Rd;){if(c.call(null,b,Pi(a,e,b,d)))return!0;--b}return!1}Ki.prototype.Z=function(){return this.sc};Ki.prototype.ge=function(a){return this.nc?this.nc:this.bs[a]};Ki.prototype.na=function(a){return this.ue[a]};Ki.prototype.kl=function(){return this.ue};function Qi(a,b,c,d){return b[0]<a.Xb?(d=Oi(a,b,d),Pi(a,d,b[0]+1,c)):null}
function Ri(a,b,c,d){Si(a,b[0],b[1],c,!1,Mi);var e=Mi[1],f=Mi[2];Si(a,b[2],b[3],c,!0,Mi);a=Mi[1];b=Mi[2];void 0!==d?(d.Yb=e,d.cc=a,d.lc=f,d.tc=b):d=new ih(e,a,f,b);return d}function Pi(a,b,c,d){c=a.na(c);return Ri(a,b,c,d)}function Ti(a,b){var c=a.ge(b[0]),d=a.na(b[0]);a=Ji(Ui(a,b[0]),a.Ri);return[c[0]+(b[1]+.5)*a[0]*d,c[1]+(b[2]+.5)*a[1]*d]}function Oi(a,b,c){var d=a.ge(b[0]),e=a.na(b[0]);a=Ji(Ui(a,b[0]),a.Ri);var f=d[0]+b[1]*a[0]*e;b=d[1]+b[2]*a[1]*e;return Re(f,b,f+a[0]*e,b+a[1]*e,c)}
function Si(a,b,c,d,e,f){var g=Vi(a,d),h=d/a.na(g),l=a.ge(g);a=Ji(Ui(a,g),a.Ri);b=h*Math.floor((b-l[0])/d+(e?.5:0))/a[0];c=h*Math.floor((c-l[1])/d+(e?0:.5))/a[1];e?(b=Math.ceil(b)-1,c=Math.ceil(c)-1):(b=Math.floor(b),c=Math.floor(c));return Fi(g,b,c,f)}function Wi(a,b,c,d){c=a.na(c);return Si(a,b[0],b[1],c,!1,d)}function Ui(a,b){return a.hz?a.hz:a.Zs[b]}function Vi(a,b,c){b=Ig(a.ue,b,c||0);return jf(b,a.Rd,a.Xb)}
function Li(a,b){for(var c=a.ue.length,d=Array(c),e=a.Rd;e<c;++e)d[e]=Pi(a,b,e);a.tj=d}function Xi(a){var b=a.ev;if(!b){var b=Yi(a),c=Zi(b,void 0,void 0),b=new Ki({P:b,origin:ff(b),oc:c,ng:void 0});a.ev=b}return b}function $i(a){var b={};ge(b,void 0!==a?a:{});void 0===b.P&&(b.P=vf("EPSG:3857").Z());b.oc=Zi(b.P,b.Xb,b.ng);delete b.Xb;return new Ki(b)}
function Zi(a,b,c){b=void 0!==b?b:42;var d=$e(a);a=Ze(a);c=Ji(void 0!==c?c:256);c=Math.max(a/c[0],d/c[1]);b+=1;d=Array(b);for(a=0;a<b;++a)d[a]=c/Math.pow(2,a);return d}function Yi(a){a=vf(a);var b=a.Z();b||(a=180*rf.degrees/yf(a),b=Re(-a,-a,a,a));return b};function aj(a){lh.call(this,{Na:a.Na,P:a.P,mb:a.mb,ea:a.ea,state:a.state,Sa:a.Sa});this.sF=void 0!==a.pe?a.pe:!1;this.KH=void 0!==a.mg?a.mg:1;this.Db=void 0!==a.Db?a.Db:null;this.Zd=new Hi(a.od);this.Am=[0,0];this.Og=""}u(aj,lh);k=aj.prototype;k.Oh=function(){return this.Zd.Oh()};k.oj=function(a,b){(a=this.ol(a))&&a.oj(b)};
function bj(a,b,c,d,e){b=a.ol(b);if(!b)return!1;for(var f=!0,g,h,l=d.Yb;l<=d.cc;++l)for(var n=d.lc;n<=d.tc;++n)g=a.xj(c,l,n),h=!1,b.qd(g)&&(g=b.get(g),(h=2===g.Qa())&&(h=!1!==e(g))),h||(f=!1);return f}k.Kn=function(){return 0};k.getKey=function(){return this.Og};function cj(a,b){a.Og!==b&&(a.Og=b,a.R())}k.xj=function(a,b,c){return a+"/"+b+"/"+c};k.Zq=function(){return this.sF};k.kl=function(){return this.Db.kl()};k.Ie=function(a){return this.Db?this.Db:Xi(a)};
k.ol=function(a){var b=this.D();return b&&!Hf(b,a)?null:this.Zd};k.er=function(){return this.KH};function dj(a,b,c,d){d=a.Ie(d);c=a.er(c);b=Ji(Ui(d,b),a.Am);return 1==c?b:Ii(b,c,a.Am)}function ej(a,b,c){var d=void 0!==c?c:a.D();c=a.Ie(d);if(a.Gp&&d.rl){var e=b;b=e[0];a=Ti(c,e);d=Yi(d);Qe(d,a[0],a[1])?b=e:(e=Ze(d),a[0]+=e*Math.ceil((d[0]-a[0])/e),b=Wi(c,a,b))}e=b[0];d=b[1];a=b[2];if(c.Rd>e||e>c.Xb)c=!1;else{var f=c.Z();c=(c=f?Pi(c,f,e):c.tj?c.tj[e]:null)?c.Xe(d,a):!0}return c?b:null}
k.refresh=function(){this.Zd.clear();this.R()};k.wz=be;function fj(a,b){de.call(this,a);this.tile=b}u(fj,de);function gj(a,b,c,d,e,f,g,h){Md(a);0===b&&0===c||Od(a,b,c);1==d&&1==e||Pd(a,d,e);0!==f&&Qd(a,f);0===g&&0===h||Od(a,g,h);return a}function hj(a,b){return a[0]==b[0]&&a[1]==b[1]&&a[4]==b[4]&&a[5]==b[5]&&a[12]==b[12]&&a[13]==b[13]}function ij(a,b,c){var d=a[1],e=a[5],f=a[13],g=b[0];b=b[1];c[0]=a[0]*g+a[4]*b+a[12];c[1]=d*g+e*b+f;return c};function jj(a){we.call(this);this.oo=a}u(jj,we);jj.prototype.Ob=be;jj.prototype.mn=function(a,b,c){return function(d,e){return bj(a,b,d,e,function(a){c[d]||(c[d]={});c[d][a.yb.toString()]=a})}};jj.prototype.xb=function(){return this.oo};jj.prototype.jr=function(a){2===a.target.Qa()&&kj(this)};function lj(a,b){var c=b.Qa();2!=c&&3!=c&&J(b,"change",a.jr,a);0==c&&(b.load(),c=b.Qa());return 2==c}function kj(a){var b=a.xb();b.getVisible()&&"ready"==b.cr()&&a.R()}
function mj(a,b){b.Oh()&&(b=function(a,b,e){b=q(a).toString();a.oj(e.ia.ea,e.Gm[b])}.bind(null,b),a.Oe.push(b))}function nj(a,b){if(b){var c,d,e;d=0;for(e=b.length;d<e;++d)c=b[d],a[q(c).toString()]=c}}function oj(a,b){b=b.Ww;void 0!==b&&("string"===typeof b?a.Lj[b]="":ka(b)&&(a.Lj[b.src]=b.href))}function pj(a,b,c,d){b=q(b).toString();c=c.toString();b in a?c in a[b]?a[b][c].extend(d):a[b][c]=d:(a[b]={},a[b][c]=d)}
function qj(a,b,c){return[b*(Math.round(a[0]/b)+c[0]%2/2),b*(Math.round(a[1]/b)+c[1]%2/2)]}function rj(a,b,c,d,e,f,g,h,l,n){var r=q(b).toString();r in a.Lm||(a.Lm[r]={});var t=a.Lm[r];a=a.LH;var v=c.Rd,x,y,B,E,I,w;for(w=g;w>=v;--w)for(y=Pi(c,f,w,y),B=c.na(w),E=y.Yb;E<=y.cc;++E)for(I=y.lc;I<=y.tc;++I)g-w<=h?(x=sj(b,w,E,I,d,e),0==x.Qa()&&(t[x.yb.toString()]=!0,x.getKey()in a.Yj||a.enqueue([x,r,Ti(c,x.yb),B])),void 0!==l&&l.call(n,x)):b.wz(w,E,I,e)};function tj(a){a=a||{};this.Ec=void 0!==a.anchor?a.anchor:[.5,.5];this.Fo=null;this.Ck=void 0!==a.Zp?a.Zp:"top-left";this.Ot=void 0!==a.$p?a.$p:"fraction";this.Pt=void 0!==a.aq?a.aq:"fraction";var b=void 0!==a.crossOrigin?a.crossOrigin:null,c=void 0!==a.RD?a.RD:null,d=void 0!==a.SD?a.SD:null,e=a.src;void 0!==e&&0!==e.length||!c||(e=c.src||q(c).toString());var f=void 0!==a.src?0:2,g=void 0!==a.color?Qf(a.color):null,h=uj.Fg(),l=h.get(e,b,g);l||(l=new vj(c,e,d,b,f,g),h.set(e,b,g,l));this.ff=l;this.rF=
void 0!==a.offset?a.offset:[0,0];this.Ql=void 0!==a.Ex?a.Ex:"top-left";this.nc=null;this.Wd=void 0!==a.size?a.size:null;vg.call(this,{opacity:void 0!==a.opacity?a.opacity:1,rotation:void 0!==a.rotation?a.rotation:0,scale:void 0!==a.scale?a.scale:1,mk:void 0!==a.mk?a.mk:!0,ap:void 0!==a.ap?a.ap:!1})}u(tj,vg);k=tj.prototype;
k.bl=function(){if(this.Fo)return this.Fo;var a=this.Ec,b=this.ja();if("fraction"==this.Ot||"fraction"==this.Pt){if(!b)return null;a=this.Ec.slice();"fraction"==this.Ot&&(a[0]*=b[0]);"fraction"==this.Pt&&(a[1]*=b[1])}if("top-left"!=this.Ck){if(!b)return null;a===this.Ec&&(a=this.Ec.slice());if("top-right"==this.Ck||"bottom-right"==this.Ck)a[0]=-a[0]+b[0];if("bottom-left"==this.Ck||"bottom-right"==this.Ck)a[1]=-a[1]+b[1]}return this.Fo=a};k.xa=function(a){return this.ff.xa(a)};k.fl=function(){return this.ff.ja()};
k.Yv=function(){return this.fl()};k.wj=function(){return this.ff.wj()};k.el=function(a){return this.ff.el(a)};k.ge=function(){if(this.nc)return this.nc;var a=this.rF;if("top-left"!=this.Ql){var b=this.ja(),c=this.ff.ja();if(!b||!c)return null;a=a.slice();if("top-right"==this.Ql||"bottom-right"==this.Ql)a[0]=c[0]-b[0]-a[0];if("bottom-left"==this.Ql||"bottom-right"==this.Ql)a[1]=c[1]-b[1]-a[1]}return this.nc=a};k.dr=function(){return this.ff.dr()};k.ja=function(){return this.Wd?this.Wd:this.ff.ja()};
k.Kw=function(a,b){return J(this.ff,"change",a,b)};k.load=function(){this.ff.load()};k.lz=function(a,b){se(this.ff,"change",a,b)};function vj(a,b,c,d,e,f){ve.call(this);this.Sf=null;this.aa=a?a:new Image;null!==d&&(this.aa.crossOrigin=d);this.ga=f?document.createElement("CANVAS"):null;this.nb=f;this.Je=null;this.Ej=e;this.Wd=c;this.xe=b;this.Ps=!1;2==this.Ej&&wj(this)}u(vj,ve);function wj(a){var b=Vf(1,1);try{b.drawImage(a.aa,0,0),b.getImageData(0,0,1,1)}catch(c){a.Ps=!0}}k=vj.prototype;
k.Aj=function(){this.Ej=3;this.qg();this.dispatchEvent("change")};
k.tl=function(){this.Ej=2;this.Wd&&(this.aa.width=this.Wd[0],this.aa.height=this.Wd[1]);this.Wd=[this.aa.width,this.aa.height];this.qg();wj(this);if(!this.Ps&&null!==this.nb){this.ga.width=this.aa.width;this.ga.height=this.aa.height;var a=this.ga.getContext("2d");a.drawImage(this.aa,0,0);for(var b=a.getImageData(0,0,this.aa.width,this.aa.height),c=b.data,d=this.nb[0]/255,e=this.nb[1]/255,f=this.nb[2]/255,g=0,h=c.length;g<h;g+=4)c[g]*=d,c[g+1]*=e,c[g+2]*=f;a.putImageData(b,0,0)}this.dispatchEvent("change")};
k.xa=function(){return this.ga?this.ga:this.aa};k.wj=function(){return this.Ej};k.el=function(){if(!this.Sf)if(this.Ps){var a=this.Wd[0],b=this.Wd[1],c=Vf(a,b);c.fillRect(0,0,a,b);this.Sf=c.canvas}else this.Sf=this.aa;return this.Sf};k.ja=function(){return this.Wd};k.dr=function(){return this.xe};k.load=function(){if(0==this.Ej){this.Ej=1;this.Je=[re(this.aa,"error",this.Aj,this),re(this.aa,"load",this.tl,this)];try{this.aa.src=this.xe}catch(a){this.Aj()}}};
k.qg=function(){this.Je.forEach(me);this.Je=null};function uj(){this.Nh={};this.Zm=0;this.FE=32}ca(uj);uj.prototype.clear=function(){this.Nh={};this.Zm=0};uj.prototype.get=function(a,b,c){a=b+":"+a+":"+(c?Sf(c):"null");return a in this.Nh?this.Nh[a]:null};uj.prototype.set=function(a,b,c,d){this.Nh[b+":"+a+":"+(c?Sf(c):"null")]=d;++this.Zm};function xj(a,b){this.H=b;this.ke={};this.Fr={}}u(xj,ue);function yj(a){var b=a.ia,c=a.jj;gj(c,a.size[0]/2,a.size[1]/2,1/b.ca,-1/b.ca,-b.rotation,-b.qa[0],-b.qa[1]);Nd(c,a.Lx)}k=xj.prototype;k.Ca=function(){for(var a in this.ke)this.ke[a].Id()};function zj(){var a=uj.Fg();if(a.Zm>a.FE){var b=0,c,d;for(c in a.Nh)d=a.Nh[c],0!==(b++&3)||d.hasListener()||(delete a.Nh[c],--a.Zm)}}
k.Ob=function(a,b,c,d,e,f){function g(a,e){var f=q(a).toString(),g=b.Fl[q(e)].Kl;if(!(f in b.Ni)||g)return c.call(d,a,g?e:null)}var h,l=b.ia,n=l.ca,r=l.ea,l=a;if(r.Ph){var r=r.Z(),t=Ze(r),v=a[0];if(v<r[0]||v>r[2])l=[v+t*Math.ceil((r[0]-v)/t),a[1]]}r=b.ri;for(t=r.length-1;0<=t;--t){var x=r[t],v=x.layer;if(Ci(x,n)&&e.call(f,v)&&(x=Aj(this,v),v.v()&&(h=x.Ob(v.v().Gp?l:a,b,g,d)),h))return h}};
function Aj(a,b){var c=q(b).toString();if(c in a.ke)return a.ke[c];b=a.wq(b);a.ke[c]=b;a.Fr[c]=J(b,"change",a.nD,a);return b}k.g=function(){return this.H};k.nD=function(){this.H.ka()};k.Wo=be;k.qG=function(a,b){for(var c in this.ke)if(!(b&&c in b.Fl)){a=c;var d=this.ke[a];delete this.ke[a];me(this.Fr[a]);delete this.Fr[a];d.Id()}};function Bj(a,b){for(var c in a.ke)if(!(c in b.Fl)){b.Oe.push(a.qG.bind(a));break}}function Og(a,b){return a.zIndex-b.zIndex};function Cj(a,b){this.Qx=a;this.yr=b;this.af=[];this.Vj=[];this.Yj={}}k=Cj.prototype;k.clear=function(){this.af.length=0;this.Vj.length=0;he(this.Yj)};k.dequeue=function(){var a=this.af,b=this.Vj,c=a[0];1==a.length?(a.length=0,b.length=0):(a[0]=a.pop(),b[0]=b.pop(),Dj(this,0));a=this.yr(c);delete this.Yj[a];return c};k.enqueue=function(a){var b=this.Qx(a);return Infinity!=b?(this.af.push(a),this.Vj.push(b),this.Yj[this.yr(a)]=!0,Ej(this,0,this.af.length-1),!0):!1};k.Eg=function(){return this.af.length};
k.fd=function(){return 0===this.af.length};function Dj(a,b){for(var c=a.af,d=a.Vj,e=c.length,f=c[b],g=d[b],h=b;b<e>>1;){var l=2*b+1,n=2*b+2,l=n<e&&d[n]<d[l]?n:l;c[b]=c[l];d[b]=d[l];b=l}c[b]=f;d[b]=g;Ej(a,h,b)}function Ej(a,b,c){var d=a.af;a=a.Vj;for(var e=d[c],f=a[c];c>b;){var g=c-1>>1;if(a[g]>f)d[c]=d[g],a[c]=a[g],c=g;else break}d[c]=e;a[c]=f}
function Fj(a){var b=a.Qx,c=a.af,d=a.Vj,e=0,f=c.length,g,h,l;for(h=0;h<f;++h)g=c[h],l=b(g),Infinity==l?delete a.Yj[a.yr(g)]:(d[e]=l,c[e++]=g);c.length=e;d.length=e;for(b=(a.af.length>>1)-1;0<=b;b--)Dj(a,b)};function Gj(a,b){Cj.call(this,function(b){return a.apply(null,b)},function(a){return a[0].getKey()});this.IH=b;this.sp=0;this.rp={}}u(Gj,Cj);Gj.prototype.enqueue=function(a){var b=Gj.cb.enqueue.call(this,a);b&&J(a[0],"change",this.Wn,this);return b};Gj.prototype.Wn=function(a){a=a.target;var b=a.Qa();if(2===b||3===b||4===b||5===b)se(a,"change",this.Wn,this),a=a.getKey(),a in this.rp&&(delete this.rp[a],--this.sp),this.IH()};function Hj(a){return function(b){if(b)return[jf(b[0],a[0],a[2]),jf(b[1],a[1],a[3])]}}function Ij(a){return a};function Jj(a,b,c){this.qa=a;this.ca=b;this.rotation=c};function Kj(a){return function(b,c,d){if(void 0!==b)return b=Ig(a,b,d),b=jf(b+c,0,a.length-1),a[b]}}function Lj(a,b,c){return function(d,e,f){if(void 0!==d)return d=Math.max(Math.floor(Math.log(b/d)/Math.log(a)+(0<f?0:0>f?1:.5))+e,0),void 0!==c&&(d=Math.min(d,c)),b/Math.pow(a,d)}};function Mj(a){if(void 0!==a)return 0}function Nj(a,b){if(void 0!==a)return a+b}function Oj(a){var b=2*Math.PI/a;return function(a,d){if(void 0!==a)return a=Math.floor((a+d)/b+.5)*b}}function Pj(){var a=lf(5);return function(b,c){if(void 0!==b)return Math.abs(b+c)<=a?0:b+c}};function Qj(a){a=""+a;var b=a.indexOf("."),b=-1===b?a.length:b;return 2<b?a:Array(3-b).join("0")+a}function Rj(a){a=(""+a).split(".");for(var b=["1","3"],c=0;c<Math.max(a.length,b.length);c++){var d=parseInt(a[c]||"0",10),e=parseInt(b[c]||"0",10);if(d>e)return 1;if(e>d)return-1}return 0};function Sj(a,b){a[0]+=b[0];a[1]+=b[1]}function Tj(a,b){var c=a[0];a=a[1];var d=b[0],e=b[1];b=d[0];var d=d[1],f=e[0],e=e[1],g=f-b,h=e-d,c=0===g&&0===h?0:(g*(c-b)+h*(a-d))/(g*g+h*h||0);0>=c?(a=b,c=d):1<=c?(a=f,c=e):(a=b+c*g,c=d+c*h);return[a,c]}function Uj(a,b){for(var c=!0,d=a.length-1;0<=d;--d)if(a[d]!=b[d]){c=!1;break}return c}function Vj(a,b){var c=Math.cos(b);b=Math.sin(b);var d=a[1]*c+a[0]*b;a[0]=a[0]*c-a[1]*b;a[1]=d}function Wj(a,b){var c=a[0]-b[0];a=a[1]-b[1];return c*c+a*a};function Xj(a,b,c,d,e,f){var g=e[0],h=e[1],l=e[4],n=e[5],r=e[12];e=e[13];for(var t=f?f:[],v=0;b<c;b+=d){var x=a[b],y=a[b+1];t[v++]=g*x+l*y+r;t[v++]=h*x+n*y+e}f&&t.length!=v&&(t.length=v);return t};function Yj(){Mf.call(this);this.Ha="XY";this.W=2;this.s=null}u(Yj,Mf);function Zj(a){if("XY"==a)return 2;if("XYZ"==a||"XYM"==a)return 3;if("XYZM"==a)return 4;Oa("unsupported layout: "+a)}k=Yj.prototype;k.Xe=Je;k.hn=function(a){var b=this.s,c=this.s.length,d=this.W;a=Se(a);return We(a,b,0,c,d)};function ak(a){return a.s.slice(0,a.W)}function bk(a){return a.s.slice(a.s.length-a.W)}
k.br=function(a){this.hp!=this.bb&&(he(this.nh),this.oh=0,this.hp=this.bb);if(0>a||0!==this.oh&&a<=this.oh)return this;var b=a.toString();if(this.nh.hasOwnProperty(b))return this.nh[b];var c=this.yj(a);if(c.s.length<this.s.length)return this.nh[b]=c;this.oh=a;return this};k.yj=function(){return this};function ck(a,b,c){a.W=Zj(b);a.Ha=b;a.s=c}
function dk(a,b,c,d){if(b)c=Zj(b);else{for(b=0;b<d;++b){if(0===c.length){a.Ha="XY";a.W=2;return}c=c[0]}c=c.length;2==c?b="XY":3==c?b="XYZ":4==c?b="XYZM":(Oa("unsupported stride: "+c),b=void 0)}a.Ha=b;a.W=c}k.Dk=function(a){this.s&&(a(this.s,this.s,this.W),this.R())};
k.rotate=function(a,b){var c=this.s;if(c){var d=c.length,e=this.W,f=c?c:[],g=Math.cos(a);a=Math.sin(a);var h=b[0];b=b[1];for(var l=0,n=0;n<d;n+=e){var r=c[n]-h,t=c[n+1]-b;f[l++]=h+r*g-t*a;f[l++]=b+r*a+t*g;for(r=n+2;r<n+e;++r)f[l++]=c[r]}c&&f.length!=l&&(f.length=l);this.R()}};k.translate=function(a,b){var c=this.s;if(c){var d=c.length,e=this.W,f=c?c:[],g=0,h,l;for(h=0;h<d;h+=e)for(f[g++]=c[h]+a,f[g++]=c[h+1]+b,l=h+2;l<h+e;++l)f[g++]=c[l];c&&f.length!=g&&(f.length=g);this.R()}};function ek(a,b,c,d){for(var e=0,f=a[c-d],g=a[c-d+1];b<c;b+=d)var h=a[b],l=a[b+1],e=e+(g*h-f*l),f=h,g=l;return e/2}function fk(a,b,c,d){var e=0,f,g;f=0;for(g=c.length;f<g;++f){var h=c[f],e=e+ek(a,b,h,d);b=h}return e};function gk(a,b){var c=0,d,e;d=0;for(e=b.length;d<e;++d)a[c++]=b[d];return c}function hk(a,b,c,d){var e,f;e=0;for(f=c.length;e<f;++e){var g=c[e],h;for(h=0;h<d;++h)a[b++]=g[h]}return b}function ik(a,b,c,d,e){e=e?e:[];var f=0,g,h;g=0;for(h=c.length;g<h;++g)b=hk(a,b,c[g],d),e[f++]=b;e.length=f;return e};function jk(a,b,c,d,e){e=void 0!==e?e:[];for(var f=0;b<c;b+=d)e[f++]=a.slice(b,b+d);e.length=f;return e}function kk(a,b,c,d,e){e=void 0!==e?e:[];var f=0,g,h;g=0;for(h=c.length;g<h;++g){var l=c[g];e[f++]=jk(a,b,l,d,e[f]);b=l}e.length=f;return e};function lk(a,b,c,d,e,f,g){var h=(c-b)/d;if(3>h){for(;b<c;b+=d)f[g++]=a[b],f[g++]=a[b+1];return g}var l=Array(h);l[0]=1;l[h-1]=1;c=[b,c-d];for(var n=0,r;0<c.length;){var t=c.pop(),v=c.pop(),x=0,y=a[v],B=a[v+1],E=a[t],I=a[t+1];for(r=v+d;r<t;r+=d){var w,A=a[r];w=a[r+1];var G=y,O=B,K=E-G,N=I-O;if(0!==K||0!==N){var ba=((A-G)*K+(w-O)*N)/(K*K+N*N);1<ba?(G=E,O=I):0<ba&&(G+=K*ba,O+=N*ba)}A=G-A;w=O-w;w=A*A+w*w;w>x&&(n=r,x=w)}x>e&&(l[(n-b)/d]=1,v+d<n&&c.push(v,n),n+d<t&&c.push(n,t))}for(r=0;r<h;++r)l[r]&&(f[g++]=
a[b+r*d],f[g++]=a[b+r*d+1]);return g}
function mk(a,b,c,d,e,f,g,h){var l,n;l=0;for(n=c.length;l<n;++l){var r=c[l];a:{var t=a,v=r,x=d,y=e,B=f;if(b!=v){var E=y*Math.round(t[b]/y),I=y*Math.round(t[b+1]/y);b+=x;B[g++]=E;B[g++]=I;var w,A;do if(w=y*Math.round(t[b]/y),A=y*Math.round(t[b+1]/y),b+=x,b==v){B[g++]=w;B[g++]=A;break a}while(w==E&&A==I);for(;b<v;){var G,O;G=y*Math.round(t[b]/y);O=y*Math.round(t[b+1]/y);b+=x;if(G!=w||O!=A){var K=w-E,N=A-I,ba=G-E,P=O-I;K*P==N*ba&&(0>K&&ba<K||K==ba||0<K&&ba>K)&&(0>N&&P<N||N==P||0<N&&P>N)||(B[g++]=w,B[g++]=
A,E=w,I=A);w=G;A=O}}B[g++]=w;B[g++]=A}}h.push(g);b=r}return g};function nk(a,b){Yj.call(this);this.tb(a,b)}u(nk,Yj);k=nk.prototype;k.clone=function(){var a=new nk(null);a.ma(this.Ha,this.s.slice());return a};k.uj=function(){return ek(this.s,0,this.s.length,this.W)};k.da=function(){return jk(this.s,0,this.s.length,this.W)};k.yj=function(a){var b=[];b.length=lk(this.s,0,this.s.length,this.W,a,b,0);a=new nk(null);a.ma("XY",b);return a};k.T=function(){return"LinearRing"};
k.tb=function(a,b){a?(dk(this,b,a,1),this.s||(this.s=[]),this.s.length=hk(this.s,0,a,this.W),this.R()):this.ma("XY",null)};k.ma=function(a,b){ck(this,a,b);this.R()};function ok(a,b){Yj.call(this);this.tb(a,b)}u(ok,Yj);k=ok.prototype;k.clone=function(){var a=new ok(null);a.ma(this.Ha,this.s.slice());return a};k.da=function(){return this.s?this.s.slice():[]};k.hn=function(a){return Te(this.s,a)};k.T=function(){return"Point"};k.tb=function(a,b){a?(dk(this,b,a,0),this.s||(this.s=[]),this.s.length=gk(this.s,a),this.R()):this.ma("XY",null)};k.ma=function(a,b){ck(this,a,b);this.R()};function pk(a,b,c,d,e,f){for(var g=!1,h=a[c-d],l=a[c-d+1];b<c;b+=d){var n=a[b],r=a[b+1];l>f!=r>f&&e<(n-h)*(f-l)/(r-l)+h&&(g=!g);h=n;l=r}return g}function qk(a,b,c,d,e,f){if(0===c.length||!pk(a,b,c[0],d,e,f))return!1;var g;b=1;for(g=c.length;b<g;++b)if(pk(a,c[b-1],c[b],d,e,f))return!1;return!0};function rk(a,b,c,d,e,f,g){var h,l,n,r,t,v=e[f+1],x=[],y=c[0];n=a[y-d];t=a[y-d+1];for(h=b;h<y;h+=d){r=a[h];l=a[h+1];if(v<=t&&l<=v||t<=v&&v<=l)n=(v-t)/(l-t)*(r-n)+n,x.push(n);n=r;t=l}y=NaN;t=-Infinity;x.sort(Hg);n=x[0];h=1;for(l=x.length;h<l;++h){r=x[h];var B=Math.abs(r-n);B>t&&(n=(n+r)/2,qk(a,b,c,d,n,v)&&(y=n,t=B));n=r}isNaN(y)&&(y=e[f]);return g?(g.push(y,v),g):[y,v]};function sk(a,b,c,d){for(var e=0,f=a[c-d],g=a[c-d+1];b<c;b+=d)var h=a[b],l=a[b+1],e=e+(h-f)*(l+g),f=h,g=l;return 0<e}function tk(a,b,c,d){var e=0;d=void 0!==d?d:!1;var f,g;f=0;for(g=b.length;f<g;++f){var h=b[f],e=sk(a,e,h,c);if(0===f){if(d&&e||!d&&!e)return!1}else if(d&&!e||!d&&e)return!1;e=h}return!0}
function uk(a,b,c,d,e){e=void 0!==e?e:!1;var f,g;f=0;for(g=c.length;f<g;++f){var h=c[f],l=sk(a,b,h,d);if(0===f?e&&l||!e&&!l:e&&!l||!e&&l)for(var l=a,n=h,r=d;b<n-r;){var t;for(t=0;t<r;++t){var v=l[b+t];l[b+t]=l[n-r+t];l[n-r+t]=v}b+=r;n-=r}b=h}return b}function vk(a,b,c,d){var e=0,f,g;f=0;for(g=b.length;f<g;++f)e=uk(a,e,b[f],c,d);return e};function wk(a,b){Yj.call(this);this.Pa=[];this.Hv=-1;this.Iv=null;this.Rl=-1;this.Ne=null;this.tb(a,b)}u(wk,Yj);function xk(a,b){a.s?Jg(a.s,b.s):a.s=b.s.slice();a.Pa.push(a.s.length);a.R()}k=wk.prototype;k.clone=function(){var a=new wk(null);a.ma(this.Ha,this.s.slice(),this.Pa.slice());return a};k.Xe=function(a,b){return qk(this.Md(),0,this.Pa,this.W,a,b)};k.uj=function(){return fk(this.Md(),0,this.Pa,this.W)};
k.da=function(a){var b;void 0!==a?(b=this.Md().slice(),uk(b,0,this.Pa,this.W,a)):b=this.s;return kk(b,0,this.Pa,this.W)};function yk(a){if(a.Hv!=a.bb){var b=bf(a.Z());a.Iv=rk(a.Md(),0,a.Pa,a.W,b,0);a.Hv=a.bb}return a.Iv}function zk(a){return new ok(yk(a))}function Ak(a){if(0>=a.Pa.length)return null;var b=new nk(null);b.ma(a.Ha,a.s.slice(0,a.Pa[0]));return b}
function Bk(a){var b=a.Ha,c=a.s;a=a.Pa;var d=[],e=0,f,g;f=0;for(g=a.length;f<g;++f){var h=a[f],l=new nk(null);l.ma(b,c.slice(e,h));d.push(l);e=h}return d}k.Md=function(){if(this.Rl!=this.bb){var a=this.s;tk(a,this.Pa,this.W)?this.Ne=a:(this.Ne=a.slice(),this.Ne.length=uk(this.Ne,0,this.Pa,this.W));this.Rl=this.bb}return this.Ne};k.yj=function(a){var b=[],c=[];b.length=mk(this.s,0,this.Pa,this.W,Math.sqrt(a),b,0,c);a=new wk(null);a.ma("XY",b,c);return a};k.T=function(){return"Polygon"};
k.tb=function(a,b){a?(dk(this,b,a,2),this.s||(this.s=[]),a=ik(this.s,0,a,this.W,this.Pa),this.s.length=0===a.length?0:a[a.length-1],this.R()):this.ma("XY",null,this.Pa)};k.ma=function(a,b,c){ck(this,a,b);this.Pa=c;this.R()};function Ck(a){var b=a[0],c=a[1],d=a[2];a=a[3];b=[b,c,b,a,d,a,d,c,b,c];c=new wk(null);c.ma("XY",b,[b.length]);return c}
function Dk(a){for(var b=a.W,c=a.Ha,d=new wk(null,c),b=33*b,e=Array(b),f=0;f<b;f++)e[f]=0;d.ma(c,e,[e.length]);c=a.Da();a=a.jl();for(var b=d.s,e=d.Ha,f=d.W,g=d.Pa,h=b.length/f-1,l,n,r=0;r<=h;++r)n=r*f,l=0+2*mf(r,h)*Math.PI/h,b[n]=c[0]+a*Math.cos(l),b[n+1]=c[1]+a*Math.sin(l);d.ma(e,b,g);return d};function Ek(a){var b;Ae.call(this);a=a||{};this.vl=[0,0];var c={};c.center=void 0!==a.qa?a.qa:null;this.Xj=Ff(a.ea);var d,e,f=void 0!==a.Rd?a.Rd:0;b=void 0!==a.Xb?a.Xb:28;var g=void 0!==a.Sz?a.Sz:2;if(void 0!==a.oc)b=a.oc,d=b[0],e=b[b.length-1],b=Kj(b);else{d=Ff(a.ea);e=d.Z();var h=(e?Math.max(Ze(e),$e(e)):360*rf.degrees/yf(d))/256/Math.pow(2,0),l=h/Math.pow(2,28);d=a.Ke;void 0!==d?f=0:d=h/Math.pow(g,f);e=a.le;void 0===e&&(e=void 0!==a.Xb?void 0!==a.Ke?d/Math.pow(g,b):h/Math.pow(g,b):l);b=f+Math.floor(Math.log(d/
e)/Math.log(g));e=d/Math.pow(g,b-f);b=Lj(g,d,b-f)}this.Nj=d;this.Mr=e;this.ue=a.oc;this.Eo=f;f=void 0!==a.P?Hj(a.P):Ij;d=Fk(a);this.Lk=new Jj(f,b,d);void 0!==a.ca?c.resolution=a.ca:void 0!==a.zoom&&(c.resolution=this.Hc(this.Nj,a.zoom-this.Eo));c.rotation=void 0!==a.rotation?a.rotation:0;this.Ac(c)}u(Ek,Ae);k=Ek.prototype;k.Hc=function(a,b,c){return this.Lk.ca(a,b||0,c||0)};k.jn=function(a,b){return this.Lk.rotation(a,b||0)};k.Da=function(){return this.get("center")};
function Gk(a,b){return void 0!==b?(b[0]=a.vl[0],b[1]=a.vl[1],b):a.vl.slice()}function Hk(a,b){var c=a.Da(),d=a.na();a=a.Vb();return cf(c,d,a,b)}k.D=function(){return this.Xj};k.na=function(){return this.get("resolution")};k.kl=function(){return this.ue};function Ik(a,b){return Math.max(Ze(a)/b[0],$e(a)/b[1])}function Jk(a){var b=a.Nj,c=Math.log(b/a.Mr)/Math.log(2);return function(a){return b/Math.pow(2,a*c)}}k.Vb=function(){return this.get("rotation")};
function Kk(a){var b=a.Nj,c=Math.log(b/a.Mr)/Math.log(2);return function(a){return Math.log(b/a)/Math.log(2)/c}}k.Qa=function(){var a=this.Da(),b=this.D(),c=this.na(),d=this.Vb();return{qa:[Math.round(a[0]/c)*c,Math.round(a[1]/c)*c],ea:void 0!==b?b:null,ca:c,rotation:d}};k.df=function(){var a,b=this.na();if(void 0!==b){var c,d=0;do{c=this.Hc(this.Nj,d);if(c==b){a=d;break}++d}while(c>this.Mr)}return void 0!==a?this.Eo+a:a};
function Lk(a,b,c,d){b instanceof Yj||(b=Ck(b));var e=d||{};d=void 0!==e.padding?e.padding:[0,0,0,0];var f=void 0!==e.Hc?e.Hc:!0,g=void 0!==e.Ai?e.Ai:!1,h;h=void 0!==e.le?e.le:void 0!==e.Xb?a.Hc(a.Nj,e.Xb-a.Eo,0):0;var l=b.s,n=a.Vb(),e=Math.cos(-n),n=Math.sin(-n),r=Infinity,t=Infinity,v=-Infinity,x=-Infinity;b=b.W;for(var y=0,B=l.length;y<B;y+=b)var E=l[y]*e-l[y+1]*n,I=l[y]*n+l[y+1]*e,r=Math.min(r,E),t=Math.min(t,I),v=Math.max(v,E),x=Math.max(x,I);c=Ik([r,t,v,x],[c[0]-d[1]-d[3],c[1]-d[0]-d[2]]);c=
isNaN(c)?h:Math.max(c,h);f&&(f=a.Hc(c,0,0),!g&&f<c&&(f=a.Hc(f,-1,0)),c=f);Mk(a,c);n=-n;g=(r+v)/2+(d[1]-d[3])/2*c;d=(t+x)/2+(d[0]-d[2])/2*c;a.ib([g*e-d*n,d*e+g*n])}k.io=function(){return!!this.Da()&&void 0!==this.na()};k.rotate=function(a,b){if(void 0!==b){var c,d=this.Da();void 0!==d&&(c=[d[0]-b[0],d[1]-b[1]],Vj(c,a-this.Vb()),Sj(c,b));this.ib(c)}this.mm(a)};k.ib=function(a){this.set("center",a)};function Nk(a,b){a.vl[1]+=b}function Mk(a,b){a.set("resolution",b)}
k.mm=function(a){this.set("rotation",a)};k.mh=function(a){a=this.Hc(this.Nj,a-this.Eo,0);Mk(this,a)};function Fk(a){if(void 0!==a.wv?a.wv:1){a=a.jn;if(void 0===a||!0===a)return Pj();if(!1===a)return Nj;if(ha(a))return Oj(a);Oa("illegal option for constrainRotation (%s)",a);return Nj}return Mj};function Ok(a){Ae.call(this);this.element=a.element?a.element:null;this.H=this.Ss=null;this.vi=[];this.ka=a.ka?a.ka:be;a.target&&this.om(a.target)}u(Ok,Ae);Ok.prototype.Ca=function(){Ec(this.element);Ok.cb.Ca.call(this)};Ok.prototype.g=function(){return this.H};
Ok.prototype.Ua=function(a){this.H&&Ec(this.element);for(var b=0,c=this.vi.length;b<c;++b)me(this.vi[b]);this.vi.length=0;if(this.H=a)(this.Ss?this.Ss:a.Sl).appendChild(this.element),this.ka!==be&&this.vi.push(J(a,"postrender",this.ka,this)),a.ka()};Ok.prototype.om=function(a){this.Ss=wc(document,a)};function Pk(a){a=a?a:{};this.yp=document.createElement("UL");this.Jl=document.createElement("LI");this.yp.appendChild(this.Jl);Yc(this.Jl,!1);this.pd=void 0!==a.collapsed?a.collapsed:!0;this.Jf=void 0!==a.sq?a.sq:!0;this.Jf||(this.pd=!1);var b=void 0!==a.className?a.className:"ol-attribution",c=void 0!==a.og?a.og:"Attributions",d=void 0!==a.rq?a.rq:"\u00bb";this.Rh="string"===typeof d?zc("SPAN",{},d):d;d=void 0!==a.label?a.label:"i";this.gd="string"===typeof d?zc("SPAN",{},d):d;c=zc("BUTTON",{type:"button",
title:c},this.Jf&&!this.pd?this.Rh:this.gd);J(c,"click",this.ie,this);b=zc("DIV",b+" ol-unselectable ol-control"+(this.pd&&this.Jf?" ol-collapsed":"")+(this.Jf?"":" ol-uncollapsible"),this.yp,c);Ok.call(this,{element:b,ka:a.ka?a.ka:Qk,target:a.target});this.ab=!0;this.Mh={};this.wg={};this.tE={}}u(Pk,Ok);function Qk(a){this.Ap(a.He)}
Pk.prototype.Ap=function(a){if(a){var b,c,d,e,f,g,h,l,n,r,t,v=a.ri,x=ge({},a.Na),y={},B=a.ia.ea;c=0;for(b=v.length;c<b;c++)if(g=v[c].layer.v())if(r=q(g).toString(),n=g.be)for(d=0,e=n.length;d<e;d++)if(h=n[d],l=q(h).toString(),!(l in x)){if(f=a.Gm[r]){var E=g.Ie(B);a:{t=h;var I=B;if(t.pp){var w,A,G,O=void 0;for(O in f)if(O in t.pp){G=f[O];var K;w=0;for(A=t.pp[O].length;w<A;++w){K=t.pp[O][w];if(jh(K,G)){t=!0;break a}var N=Pi(E,Yi(I),parseInt(O,10)),ba=N.Nd();if(G.Yb<N.Yb||G.cc>N.cc)if(jh(K,new ih(mf(G.Yb,
ba),mf(G.cc,ba),G.lc,G.tc))||G.Nd()>ba&&jh(K,N)){t=!0;break a}}}t=!1}else t=!0}}else t=!1;t?(l in y&&delete y[l],x[l]=h):y[l]=h}b=[x,y];c=b[0];b=b[1];for(var P in this.Mh)P in c?(this.wg[P]||(Yc(this.Mh[P],!0),this.wg[P]=!0),delete c[P]):P in b?(this.wg[P]&&(Yc(this.Mh[P],!1),delete this.wg[P]),delete b[P]):(Ec(this.Mh[P]),delete this.Mh[P],delete this.wg[P]);for(P in c)d=document.createElement("LI"),d.innerHTML=c[P].nw,this.yp.appendChild(d),this.Mh[P]=d,this.wg[P]=!0;for(P in b)d=document.createElement("LI"),
d.innerHTML=b[P].nw,Yc(d,!1),this.yp.appendChild(d),this.Mh[P]=d;P=!je(this.wg)||!je(a.Lj);this.ab!=P&&(Yc(this.element,P),this.ab=P);P&&je(this.wg)?this.element.classList.add("ol-logo-only"):this.element.classList.remove("ol-logo-only");var da;a=a.Lj;P=this.tE;for(da in P)da in a||(Ec(P[da]),delete P[da]);for(var ia in a)c=a[ia],c instanceof HTMLElement&&(this.Jl.appendChild(c),P[ia]=c),ia in P||(da=new Image,da.src=ia,""===c?c=da:(c=zc("A",{href:c}),c.appendChild(da)),this.Jl.appendChild(c),P[ia]=
c);Yc(this.Jl,!je(a))}else this.ab&&(Yc(this.element,!1),this.ab=!1)};Pk.prototype.ie=function(a){a.preventDefault();this.mr()};Pk.prototype.mr=function(){this.element.classList.toggle("ol-collapsed");this.pd?Fc(this.Rh,this.gd):Fc(this.gd,this.Rh);this.pd=!this.pd};function Rk(a){return 1-Math.pow(1-a,3)}function Sk(a){return 3*a*a-2*a*a*a}function Tk(a){return a};function Uk(a){var b=a.source,c=a.start?a.start:Date.now(),d=b[0],e=b[1],f=void 0!==a.duration?a.duration:1E3,g=a.Jc?a.Jc:Sk;return function(a,b){if(b.time<c)return b.animate=!0,b.qb[0]+=1,!0;if(b.time<c+f){a=1-g((b.time-c)/f);var h=d-b.ia.qa[0],l=e-b.ia.qa[1];b.animate=!0;b.ia.qa[0]+=a*h;b.ia.qa[1]+=a*l;b.qb[0]+=1;return!0}return!1}}
function Vk(a){var b=a.rotation?a.rotation:0,c=a.start?a.start:Date.now(),d=void 0!==a.duration?a.duration:1E3,e=a.Jc?a.Jc:Sk,f=a.anchor?a.anchor:null;return function(a,h){if(h.time<c)return h.animate=!0,h.qb[0]+=1,!0;if(h.time<c+d){a=1-e((h.time-c)/d);a*=b-h.ia.rotation;h.animate=!0;h.ia.rotation+=a;if(f){var g=h.ia.qa;g[0]-=f[0];g[1]-=f[1];Vj(g,a);Sj(g,f)}h.qb[0]+=1;return!0}return!1}}
function Wk(a){var b=a.ca,c=a.start?a.start:Date.now(),d=void 0!==a.duration?a.duration:1E3,e=a.Jc?a.Jc:Sk;return function(a,g){if(g.time<c)return g.animate=!0,g.qb[0]+=1,!0;if(g.time<c+d){a=1-e((g.time-c)/d);var f=b-g.ia.ca;g.animate=!0;g.ia.ca+=a*f;g.qb[0]+=1;return!0}return!1}};function Xk(a){a=a?a:{};var b=void 0!==a.className?a.className:"ol-rotate",c=void 0!==a.label?a.label:"\u21e7";this.gd=null;"string"===typeof c?this.gd=zc("SPAN","ol-compass",c):(this.gd=c,this.gd.classList.add("ol-compass"));c=zc("BUTTON",{"class":b+"-reset",type:"button",title:a.og?a.og:"Reset rotation"},this.gd);J(c,"click",Xk.prototype.ie,this);b=zc("DIV",b+" ol-unselectable ol-control",c);c=a.ka?a.ka:Yk;this.Ou=a.xG?a.xG:void 0;Ok.call(this,{element:b,ka:c,target:a.target});this.wb=void 0!==
a.duration?a.duration:250;this.Gu=void 0!==a.Fu?a.Fu:!0;this.pc=void 0;this.Gu&&this.element.classList.add("ol-hidden")}u(Xk,Ok);Xk.prototype.ie=function(a){a.preventDefault();if(void 0!==this.Ou)this.Ou();else{a=this.g();var b=H(a);if(b){var c=b.Vb();void 0!==c&&(0<this.wb&&(c%=2*Math.PI,c<-Math.PI&&(c+=2*Math.PI),c>Math.PI&&(c-=2*Math.PI),a.$c(Vk({rotation:c,duration:this.wb,Jc:Rk}))),b.mm(0))}}};
function Yk(a){if(a=a.He){a=a.ia.rotation;if(a!=this.pc){var b="rotate("+a+"rad)";if(this.Gu){var c=this.element.classList.contains("ol-hidden");c||0!==a?c&&0!==a&&this.element.classList.remove("ol-hidden"):this.element.classList.add("ol-hidden")}this.gd.style.msTransform=b;this.gd.style.webkitTransform=b;this.gd.style.transform=b}this.pc=a}};function Zk(a){a=a?a:{};var b=void 0!==a.className?a.className:"ol-zoom",c=void 0!==a.Wh?a.Wh:1,d=void 0!==a.RI?a.RI:"\u2212",e=void 0!==a.SI?a.SI:"Zoom out",f=zc("BUTTON",{"class":b+"-in",type:"button",title:void 0!==a.QI?a.QI:"Zoom in"},void 0!==a.OI?a.OI:"+");J(f,"click",Zk.prototype.ie.bind(this,c));d=zc("BUTTON",{"class":b+"-out",type:"button",title:e},d);J(d,"click",Zk.prototype.ie.bind(this,-c));b=zc("DIV",b+" ol-unselectable ol-control",f,d);Ok.call(this,{element:b,target:a.target});this.wb=
void 0!==a.duration?a.duration:250}u(Zk,Ok);Zk.prototype.ie=function(a,b){b.preventDefault();var c=this.g();if(b=H(c)){var d=b.na();d&&(0<this.wb&&c.$c(Wk({ca:d,duration:this.wb,Jc:Rk})),a=b.Hc(d,a),Mk(b,a))}};function $k(a,b,c){this.zq=a;this.Do=b;this.jB=c;this.qe=[];this.Fj=this.bq=0}$k.prototype.update=function(a,b){this.qe.push(a,b,Date.now())};$k.prototype.end=function(){if(6>this.qe.length)return!1;var a=Date.now()-this.jB,b=this.qe.length-3;if(this.qe[b+2]<a)return!1;for(var c=b-3;0<c&&this.qe[c+2]>a;)c-=3;var a=this.qe[b+2]-this.qe[c+2],d=this.qe[b]-this.qe[c],b=this.qe[b+1]-this.qe[c+1];this.bq=Math.atan2(b,d);this.Fj=Math.sqrt(d*d+b*b)/a;return this.Fj>this.Do};
$k.prototype.pan=function(a){var b=this.zq,c=this.Fj,d=this.Do-c,e=Math.log(this.Do/this.Fj)/this.zq;return Uk({source:a,duration:e,Jc:function(a){return c*(Math.exp(b*a*e)-1)/d}})};function al(a){Ae.call(this);this.H=null;this.setActive(!0);this.handleEvent=a.handleEvent}u(al,Ae);al.prototype.g=function(){return this.H};al.prototype.setActive=function(a){this.set("active",a)};al.prototype.Ua=function(a){this.H=a};function bl(a,b,c,d,e){if(void 0!==c){var f=b.Vb(),g=b.Da();void 0!==f&&g&&e&&0<e&&(a.$c(Vk({rotation:f,duration:e,Jc:Rk})),d&&a.$c(Uk({source:g,duration:e,Jc:Rk})));b.rotate(c,d)}}function cl(a,b,c,d,e){var f=b.na();c=b.Hc(f,c,0);dl(a,b,c,d,e)}
function dl(a,b,c,d,e){if(c){var f=b.na(),g=b.Da();void 0!==f&&g&&c!==f&&e&&0<e&&(a.$c(Wk({ca:f,duration:e,Jc:Rk})),d&&a.$c(Uk({source:g,duration:e,Jc:Rk})));if(d){var h;a=b.Da();e=b.na();void 0!==a&&void 0!==e&&(h=[d[0]-c*(d[0]-a[0])/e,d[1]-c*(d[1]-a[1])/e]);b.ib(h)}Mk(b,c)}};function el(a){a=a?a:{};this.Ye=a.Wh?a.Wh:1;al.call(this,{handleEvent:fl});this.wb=void 0!==a.duration?a.duration:250}u(el,al);function fl(a){var b=!1,c=a.originalEvent;if(a.type==oi){var b=a.map,d=a.zb,c=c.shiftKey?-this.Ye:this.Ye,e=H(b);cl(b,e,c,d,this.wb);a.preventDefault();b=!0}return!b};function gl(a){a=a.originalEvent;return a.altKey&&!(a.metaKey||a.ctrlKey)&&a.shiftKey}function hl(a){return a.type==ni}function il(a){a=a.originalEvent;return 0==a.button&&!(Hb&&fg&&a.ctrlKey)}function jl(a){return"pointermove"==a.type}function kl(a){return a.type==pi}function ll(a){a=a.originalEvent;return!a.altKey&&!(a.metaKey||a.ctrlKey)&&!a.shiftKey}function ml(a){a=a.originalEvent;return!a.altKey&&!(a.metaKey||a.ctrlKey)&&a.shiftKey}
function nl(a){a=a.originalEvent.target.tagName;return"INPUT"!==a&&"SELECT"!==a&&"TEXTAREA"!==a}function pl(a){return"mouse"==a.fs.pointerType}function ql(a){a=a.fs;return a.isPrimary&&0===a.button};function rl(a){a=a?a:{};al.call(this,{handleEvent:a.handleEvent?a.handleEvent:sl});this.aD=a.Qf?a.Qf:Je;this.bD=a.Jg?a.Jg:be;this.wD=a.iw?a.iw:be;this.JD=a.Rf?a.Rf:Je;this.ii=!1;this.Bm={};this.ld=[]}u(rl,al);function tl(a){for(var b=a.length,c=0,d=0,e=0;e<b;e++)c+=a[e].clientX,d+=a[e].clientY;return[c/b,d/b]}
function sl(a){if(!(a instanceof ki))return!0;var b=!1,c=a.type;if(c===ti||c===vi||c===ri)c=a.fs,a.type==ri?delete this.Bm[c.pointerId]:a.type==ti?this.Bm[c.pointerId]=c:c.pointerId in this.Bm&&(this.Bm[c.pointerId]=c),this.ld=ie(this.Bm);this.ii&&(a.type==vi?this.bD(a):a.type==ri&&(this.ii=this.JD(a)));a.type==ti?(this.ii=a=this.aD(a),b=this.jk(a)):a.type==ui&&this.wD(a);return!b}rl.prototype.jk=function(a){return a};function ul(a){rl.call(this,{Qf:vl,Jg:wl,Rf:xl});a=a?a:{};this.Uf=a.bE;this.Hj=this.Dl=null;this.ad=a.Mb?a.Mb:ll;this.tx=!1}u(ul,rl);function wl(a){var b=tl(this.ld);this.Uf&&this.Uf.update(b[0],b[1]);if(this.Hj){var c=this.Hj[0]-b[0],d=b[1]-this.Hj[1];a=a.map;var e=H(a),f=e.Qa(),d=c=[c,d],g=f.ca;d[0]*=g;d[1]*=g;Vj(c,f.rotation);Sj(c,f.qa);c=e.Lk.qa(c);a.ka();e.ib(c)}this.Hj=b}
function xl(a){a=a.map;var b=H(a);if(0===this.ld.length){if(!this.tx&&this.Uf&&this.Uf.end()){var c;c=this.Uf;c=(c.Do-c.Fj)/c.zq;var d=this.Uf.bq,e=b.Da();this.Dl=this.Uf.pan(e);a.$c(this.Dl);e=yl(a,e);c=a.Kd([e[0]-c*Math.cos(d),e[1]-c*Math.sin(d)]);c=b.Lk.qa(c);b.ib(c)}Nk(b,-1);a.ka();return!1}this.Hj=null;return!0}
function vl(a){if(0<this.ld.length&&this.ad(a)){var b=a.map,c=H(b);this.Hj=null;this.ii||Nk(c,1);b.ka();this.Dl&&Kg(b.Oo,this.Dl)&&(c.ib(a.He.ia.qa),this.Dl=null);this.Uf&&(a=this.Uf,a.qe.length=0,a.bq=0,a.Fj=0);this.tx=1<this.ld.length;return!0}return!1}ul.prototype.jk=Je;function zl(a){a=a?a:{};rl.call(this,{Qf:Al,Jg:Bl,Rf:Cl});this.ad=a.Mb?a.Mb:gl;this.Vf=void 0;this.wb=void 0!==a.duration?a.duration:250}u(zl,rl);function Bl(a){if(pl(a)){var b=a.map,c=b.ja();a=a.Yc;c=Math.atan2(c[1]/2-a[1],a[0]-c[0]/2);if(void 0!==this.Vf){a=c-this.Vf;var d=H(b),e=d.Vb();b.ka();bl(b,d,e-a)}this.Vf=c}}function Cl(a){if(!pl(a))return!0;a=a.map;var b=H(a);Nk(b,-1);var c=b.Vb(),d=this.wb,c=b.jn(c,0);bl(a,b,c,void 0,d);return!1}
function Al(a){return pl(a)&&il(a)&&this.ad(a)?(a=a.map,Nk(H(a),1),a.ka(),this.Vf=void 0,!0):!1}zl.prototype.jk=Je;function Dl(a){this.bi=null;this.kb=document.createElement("div");this.kb.style.position="absolute";this.kb.className="ol-box "+a;this.yn=this.sf=this.H=null}u(Dl,ue);Dl.prototype.Ca=function(){this.Ua(null)};Dl.prototype.Xo=function(){var a=this.sf,b=this.yn,c=this.kb.style;c.left=Math.min(a[0],b[0])+"px";c.top=Math.min(a[1],b[1])+"px";c.width=Math.abs(b[0]-a[0])+"px";c.height=Math.abs(b[1]-a[1])+"px"};
Dl.prototype.Ua=function(a){if(this.H){this.H.Tl.removeChild(this.kb);var b=this.kb.style;b.left=b.top=b.width=b.height="inherit"}(this.H=a)&&this.H.Tl.appendChild(this.kb)};function El(a){var b=a.sf,c=a.yn,b=[b,[b[0],c[1]],c,[c[0],b[1]]].map(a.H.Kd,a.H);b[4]=b[0].slice();a.bi?a.bi.tb([b]):a.bi=new wk([b])}Dl.prototype.l=function(){return this.bi};function Fl(a,b){de.call(this,a);this.zb=b}u(Fl,de);function Gl(a){rl.call(this,{Qf:Hl,Jg:Il,Rf:Jl});a=a?a:{};this.Fk=new Dl(a.className||"ol-dragbox");this.sf=null;this.ad=a.Mb?a.Mb:Ie;this.KA=a.JA?a.JA:Kl}u(Gl,rl);function Kl(a,b,c){a=c[0]-b[0];b=c[1]-b[1];return 64<=a*a+b*b}function Il(a){if(pl(a)){var b=this.Fk,c=a.Yc;b.sf=this.sf;b.yn=c;El(b);b.Xo();this.dispatchEvent(new Fl("boxdrag",a.zb))}}Gl.prototype.l=function(){return this.Fk.l()};Gl.prototype.Hx=be;
function Jl(a){if(!pl(a))return!0;this.Fk.Ua(null);this.KA(a,this.sf,a.Yc)&&(this.Hx(a),this.dispatchEvent(new Fl("boxend",a.zb)));return!1}function Hl(a){if(pl(a)&&il(a)&&this.ad(a)){this.sf=a.Yc;this.Fk.Ua(a.map);var b=this.Fk,c=this.sf;b.sf=this.sf;b.yn=c;El(b);b.Xo();this.dispatchEvent(new Fl("boxstart",a.zb));return!0}return!1};function Ll(a){a=a?a:{};var b=a.Mb?a.Mb:ml;this.wb=void 0!==a.duration?a.duration:200;this.tF=void 0!==a.$f?a.$f:!1;Gl.call(this,{Mb:b,className:a.className||"ol-dragzoom"})}u(Ll,Gl);
Ll.prototype.Hx=function(){var a=this.g(),b=H(a),c=a.ja(),d=this.l().Z();if(this.tF){var e=Hk(b,c),d=[yl(a,af(d)),yl(a,[d[2],d[3]])],f=Se(void 0),g,h;g=0;for(h=d.length;g<h;++g)Me(f,d[g]);gf(e,1/Ik(f,c));d=e}c=b.Hc(Ik(d,c));e=b.na();f=b.Da();a.$c(Wk({ca:e,duration:this.wb,Jc:Rk}));a.$c(Uk({source:f,duration:this.wb,Jc:Rk}));b.ib(bf(d));Mk(b,c)};function Ml(a){al.call(this,{handleEvent:Nl});a=a||{};this.fB=function(a){return ll(a)&&nl(a)};this.ad=void 0!==a.Mb?a.Mb:this.fB;this.wb=void 0!==a.duration?a.duration:100;this.DF=void 0!==a.CF?a.CF:128}u(Ml,al);
function Nl(a){var b=!1;if("keydown"==a.type){var c=a.originalEvent.keyCode;if(this.ad(a)&&(40==c||37==c||39==c||38==c)){var d=a.map,b=H(d),e=b.na()*this.DF,f=0,g=0;40==c?g=-e:37==c?f=-e:39==c?f=e:g=e;c=[f,g];Vj(c,b.Vb());e=this.wb;if(f=b.Da())e&&0<e&&d.$c(Uk({source:f,duration:e,Jc:Tk})),d=b.Lk.qa([f[0]+c[0],f[1]+c[1]]),b.ib(d);a.preventDefault();b=!0}}return!b};function Ol(a){al.call(this,{handleEvent:Pl});a=a?a:{};this.ad=a.Mb?a.Mb:nl;this.Ye=a.Wh?a.Wh:1;this.wb=void 0!==a.duration?a.duration:100}u(Ol,al);function Pl(a){var b=!1;if("keydown"==a.type||"keypress"==a.type){var c=a.originalEvent.charCode;if(this.ad(a)&&(43==c||45==c)){b=a.map;c=43==c?this.Ye:-this.Ye;b.ka();var d=H(b);cl(b,d,c,void 0,this.wb);a.preventDefault();b=!0}}return!b};function Ql(a){al.call(this,{handleEvent:Rl});a=a||{};this.Ye=0;this.wb=void 0!==a.duration?a.duration:250;this.xI=void 0!==a.wI?a.wI:!0;this.Br=null;this.$s=this.np=void 0}u(Ql,al);
function Rl(a){var b=!1;if("wheel"==a.type||"mousewheel"==a.type){var b=a.map,c=a.originalEvent;this.xI&&(this.Br=a.zb);var d;"wheel"==a.type?(d=c.deltaY,dg&&c.deltaMode===ce.WheelEvent.DOM_DELTA_PIXEL&&(d/=gg),c.deltaMode===ce.WheelEvent.DOM_DELTA_LINE&&(d*=40)):"mousewheel"==a.type&&(d=-c.wheelDeltaY,eg&&(d/=3));this.Ye+=d;void 0===this.np&&(this.np=Date.now());d=Math.max(80-(Date.now()-this.np),0);ce.clearTimeout(this.$s);this.$s=ce.setTimeout(this.CB.bind(this,b),d);a.preventDefault();b=!0}return!b}
Ql.prototype.CB=function(a){var b=jf(this.Ye,-1,1),c=H(a);a.ka();cl(a,c,-b,this.Br,this.wb);this.Ye=0;this.Br=null;this.$s=this.np=void 0};function Sl(a){rl.call(this,{Qf:Tl,Jg:Ul,Rf:Vl});a=a||{};this.Ec=null;this.Vf=void 0;this.im=!1;this.bp=0;this.HH=void 0!==a.threshold?a.threshold:.3;this.wb=void 0!==a.duration?a.duration:250}u(Sl,rl);
function Ul(a){var b=0,c=this.ld[0],d=this.ld[1],c=Math.atan2(d.clientY-c.clientY,d.clientX-c.clientX);void 0!==this.Vf&&(b=c-this.Vf,this.bp+=b,!this.im&&Math.abs(this.bp)>this.HH&&(this.im=!0));this.Vf=c;a=a.map;c=a.Tb.getBoundingClientRect();d=tl(this.ld);d[0]-=c.left;d[1]-=c.top;this.Ec=a.Kd(d);this.im&&(c=H(a),d=c.Vb(),a.ka(),bl(a,c,d+b,this.Ec))}
function Vl(a){if(2>this.ld.length){a=a.map;var b=H(a);Nk(b,-1);if(this.im){var c=b.Vb(),d=this.Ec,e=this.wb,c=b.jn(c,0);bl(a,b,c,d,e)}return!1}return!0}function Tl(a){return 2<=this.ld.length?(a=a.map,this.Ec=null,this.Vf=void 0,this.im=!1,this.bp=0,this.ii||Nk(H(a),1),a.ka(),!0):!1}Sl.prototype.jk=Je;function Wl(a){rl.call(this,{Qf:Xl,Jg:Yl,Rf:Zl});a=a?a:{};this.Ec=null;this.wb=void 0!==a.duration?a.duration:400;this.ko=void 0;this.Dr=1}u(Wl,rl);function Yl(a){var b=1,c=this.ld[0],d=this.ld[1],e=c.clientX-d.clientX,c=c.clientY-d.clientY,e=Math.sqrt(e*e+c*c);void 0!==this.ko&&(b=this.ko/e);this.ko=e;1!=b&&(this.Dr=b);a=a.map;var e=H(a),c=e.na(),d=a.Tb.getBoundingClientRect(),f=tl(this.ld);f[0]-=d.left;f[1]-=d.top;this.Ec=a.Kd(f);a.ka();dl(a,e,c*b,this.Ec)}
function Zl(a){if(2>this.ld.length){a=a.map;var b=H(a);Nk(b,-1);var c=b.na(),d=this.Ec,e=this.wb,c=b.Hc(c,0,this.Dr-1);dl(a,b,c,d,e);return!1}return!0}function Xl(a){return 2<=this.ld.length?(a=a.map,this.Ec=null,this.ko=void 0,this.Dr=1,this.ii||Nk(H(a),1),a.ka(),!0):!1}Wl.prototype.jk=Je;function $l(){var a={},b=new Fe,c=new $k(-.005,.05,100);(void 0!==a.kA?a.kA:1)&&b.push(new zl);(void 0!==a.DB?a.DB:1)&&b.push(new el({Wh:a.NI,duration:a.Jp}));(void 0!==a.FB?a.FB:1)&&b.push(new ul({bE:c}));(void 0!==a.AF?a.AF:1)&&b.push(new Sl);(void 0!==a.BF?a.BF:1)&&b.push(new Wl({duration:a.Jp}));if(void 0!==a.keyboard?a.keyboard:1)b.push(new Ml),b.push(new Ol({Wh:a.NI,duration:a.Jp}));(void 0!==a.OE?a.OE:1)&&b.push(new Ql({duration:a.Jp}));(void 0!==a.eH?a.eH:1)&&b.push(new Ll({duration:a.Jp}));
return b};function am(a){var b=a||{};a=ge({},b);delete a.$a;b=b.$a;xi.call(this,a);this.Hr=[];this.wi={};J(this,Ce("layers"),this.pD,this);b?Array.isArray(b)&&(b=new Fe(b.slice())):b=new Fe;this.set("layers",b)}u(am,xi);k=am.prototype;k.Un=function(){this.getVisible()&&this.R()};
k.pD=function(){this.Hr.forEach(me);this.Hr.length=0;var a=this.getLayers();this.Hr.push(J(a,"add",this.oD,this),J(a,"remove",this.qD,this));for(var b in this.wi)this.wi[b].forEach(me);he(this.wi);var a=a.L(),c,d;b=0;for(c=a.length;b<c;b++)d=a[b],this.wi[q(d).toString()]=[J(d,"propertychange",this.Un,this),J(d,"change",this.Un,this)];this.R()};k.oD=function(a){a=a.element;var b=q(a).toString();this.wi[b]=[J(a,"propertychange",this.Un,this),J(a,"change",this.Un,this)];this.R()};
k.qD=function(a){a=q(a.element).toString();this.wi[a].forEach(me);delete this.wi[a];this.R()};k.getLayers=function(){return this.get("layers")};k.Wq=function(a){var b=void 0!==a?a:[],c=b.length;this.getLayers().forEach(function(a){a.Wq(b)});a=yi(this);var d,e;for(d=b.length;c<d;c++)e=b[c],e.opacity*=a.opacity,e.visible=e.visible&&a.visible,e.Ke=Math.min(e.Ke,a.Ke),e.le=Math.max(e.le,a.le),void 0!==a.P&&(e.P=void 0!==e.P?df(e.P,a.P):a.P);return b};k.cr=function(){return"ready"};function bm(a){sf.call(this,{code:a,units:"m",P:cm,global:!0,DI:dm})}u(bm,sf);bm.prototype.fi=function(a,b){return a/kf(b[1]/6378137)};var em=6378137*Math.PI,cm=[-em,-em,em,em],dm=[-180,-85,180,85],fm="EPSG:3857 EPSG:102100 EPSG:102113 EPSG:900913 urn:ogc:def:crs:EPSG:6.18:3:3857 urn:ogc:def:crs:EPSG::3857 http://www.opengis.net/gml/srs/epsg.xml#3857".split(" ").map(function(a){return new bm(a)});
function gm(a,b,c){var d=a.length;c=1<c?c:2;void 0===b&&(b=2<c?a.slice():Array(d));for(var e=0;e<d;e+=c)b[e]=6378137*Math.PI*a[e]/180,b[e+1]=6378137*Math.log(Math.tan(Math.PI*(a[e+1]+90)/360));return b}function hm(a,b,c){var d=a.length;c=1<c?c:2;void 0===b&&(b=2<c?a.slice():Array(d));for(var e=0;e<d;e+=c)b[e]=180*a[e]/(6378137*Math.PI),b[e+1]=360*Math.atan(Math.exp(a[e+1]/6378137))/Math.PI-90;return b};var im=new nf(6378137);function jm(a,b){sf.call(this,{code:a,units:"degrees",P:km,iq:b,global:!0,lx:lm,DI:km})}u(jm,sf);jm.prototype.fi=function(a){return a};var km=[-180,-90,180,90],lm=Math.PI*im.xc/180,mm=[new jm("CRS:84"),new jm("EPSG:4326","neu"),new jm("urn:ogc:def:crs:EPSG::4326","neu"),new jm("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new jm("urn:ogc:def:crs:OGC:1.3:CRS84"),new jm("urn:ogc:def:crs:OGC:2:84"),new jm("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new jm("urn:x-ogc:def:crs:EPSG:4326","neu")];function nm(a){Bi.call(this,a?a:{})}u(nm,Bi);function om(a){a=a?a:{};var b=ge({},a);delete b.Nx;delete b.vz;Bi.call(this,b);this.set("preload",void 0!==a.Nx?a.Nx:0);this.set("useInterimTilesOnError",void 0!==a.vz?a.vz:!0)}u(om,Bi);function pm(a){return a.get("useInterimTilesOnError")};function qm(a){a=a?a:{};var b=ge({},a);delete b.style;delete b.by;delete b.Ti;delete b.Ui;Bi.call(this,b);this.se=void 0!==a.by?a.by:100;this.tf=null;this.kd=void 0;this.Qe(a.style);this.it=void 0!==a.Ti?a.Ti:!1;this.jt=void 0!==a.Ui?a.Ui:!1}u(qm,Bi);qm.prototype.Qe=function(a){this.tf=void 0!==a?a:Cg;this.kd=null===a?void 0:Ag(this.tf);this.R()};function rm(a,b,c,d,e){this.Xa=a;this.Ad=b;this.sc=c;this.Wa=d;this.CI=e;this.aa=this.Bc=this.rd=this.Yu=this.Xu=this.Wu=null;this.rw=this.qw=this.bo=this.li=this.ur=this.tr=0;this.sw=!1;this.Al=this.tw=0;this.uw=!1;this.mi=0;this.La="";this.th=this.Pi=this.vm=this.um=0;this.lg=this.Ed=this.Dd=null;this.Ci=[];this.tp=Id()}u(rm,zi);
function sm(a,b,c){if(a.aa){b=Xj(b,0,c,2,a.Wa,a.Ci);c=a.Xa;var d=a.tp,e=c.globalAlpha;1!=a.bo&&(c.globalAlpha=e*a.bo);var f=a.tw;a.sw&&(f+=a.CI);var g,h;g=0;for(h=b.length;g<h;g+=2){var l=b[g]-a.tr,n=b[g+1]-a.ur;a.uw&&(l=Math.round(l),n=Math.round(n));if(0!==f||1!=a.Al){var r=l+a.tr,t=n+a.ur;gj(d,r,t,a.Al,a.Al,f,-r,-t);c.setTransform(d[0],d[1],d[4],d[5],d[12],d[13])}c.drawImage(a.aa,a.qw,a.rw,a.mi,a.li,l,n,a.mi,a.li)}0===f&&1==a.Al||c.setTransform(1,0,0,1,0,0);1!=a.bo&&(c.globalAlpha=e)}}
function tm(a,b,c,d){var e=0;if(a.lg&&""!==a.La){a.Dd&&um(a,a.Dd);a.Ed&&vm(a,a.Ed);var f=a.lg,g=a.Xa,h=a.Yu;h?(h.font!=f.font&&(h.font=g.font=f.font),h.textAlign!=f.textAlign&&(h.textAlign=g.textAlign=f.textAlign),h.textBaseline!=f.textBaseline&&(h.textBaseline=g.textBaseline=f.textBaseline)):(g.font=f.font,g.textAlign=f.textAlign,g.textBaseline=f.textBaseline,a.Yu={font:f.font,textAlign:f.textAlign,textBaseline:f.textBaseline});b=Xj(b,e,c,d,a.Wa,a.Ci);for(f=a.Xa;e<c;e+=d){g=b[e]+a.um;h=b[e+1]+a.vm;
if(0!==a.Pi||1!=a.th){var l=gj(a.tp,g,h,a.th,a.th,a.Pi,-g,-h);f.setTransform(l[0],l[1],l[4],l[5],l[12],l[13])}a.Ed&&f.strokeText(a.La,g,h);a.Dd&&f.fillText(a.La,g,h)}0===a.Pi&&1==a.th||f.setTransform(1,0,0,1,0,0)}}function wm(a,b,c,d,e,f){var g=a.Xa;a=Xj(b,c,d,e,a.Wa,a.Ci);g.moveTo(a[0],a[1]);b=a.length;f&&(b-=2);for(c=2;c<b;c+=2)g.lineTo(a[c],a[c+1]);f&&g.closePath();return d}function xm(a,b,c,d,e){var f,g;f=0;for(g=d.length;f<g;++f)c=wm(a,b,c,d[f],e,!0);return c}k=rm.prototype;
k.tn=function(a){if(ef(this.sc,a.Z())){if(this.rd||this.Bc){this.rd&&um(this,this.rd);this.Bc&&vm(this,this.Bc);var b;b=this.Wa;var c=this.Ci,d=a.s;b=d?Xj(d,0,d.length,a.W,b,c):null;c=b[2]-b[0];d=b[3]-b[1];c=Math.sqrt(c*c+d*d);d=this.Xa;d.beginPath();d.arc(b[0],b[1],c,0,2*Math.PI);this.rd&&d.fill();this.Bc&&d.stroke()}""!==this.La&&tm(this,a.Da(),2,2)}};k.Qe=function(a){this.jh(a.Uc,a.qc);this.lm(a.xa());this.ig(a.La)};
k.Dg=function(a){var b=a.s;a=a.W;this.aa&&sm(this,b,b.length);""!==this.La&&tm(this,b,b.length,a)};k.Iq=function(a){var b=a.s;a=a.W;this.aa&&sm(this,b,b.length);""!==this.La&&tm(this,b,b.length,a)};k.nv=function(a){if(ef(this.sc,a.Z())){if(this.Bc){vm(this,this.Bc);var b=this.Xa,c=a.s;b.beginPath();wm(this,c,0,c.length,a.W,!1);b.stroke()}""!==this.La&&(a=ym(a),tm(this,a,2,2))}};
k.ov=function(a){var b=a.Z();if(ef(this.sc,b)){if(this.Bc){vm(this,this.Bc);var b=this.Xa,c=a.s,d=0,e=a.Pa,f=a.W;b.beginPath();var g,h;g=0;for(h=e.length;g<h;++g)d=wm(this,c,d,e[g],f,!1);b.stroke()}""!==this.La&&(a=zm(a),tm(this,a,a.length,2))}};k.un=function(a){if(ef(this.sc,a.Z())){if(this.Bc||this.rd){this.rd&&um(this,this.rd);this.Bc&&vm(this,this.Bc);var b=this.Xa;b.beginPath();xm(this,a.Md(),0,a.Pa,a.W);this.rd&&b.fill();this.Bc&&b.stroke()}""!==this.La&&(a=yk(a),tm(this,a,2,2))}};
k.pv=function(a){if(ef(this.sc,a.Z())){if(this.Bc||this.rd){this.rd&&um(this,this.rd);this.Bc&&vm(this,this.Bc);var b=this.Xa,c=a.Md(),d=0,e=a.jc,f=a.W,g,h;g=0;for(h=e.length;g<h;++g){var l=e[g];b.beginPath();d=xm(this,c,d,l,f);this.rd&&b.fill();this.Bc&&b.stroke()}}""!==this.La&&(a=Am(a),tm(this,a,a.length,2))}};function um(a,b){var c=a.Xa,d=a.Wu;d?d.fillStyle!=b.fillStyle&&(d.fillStyle=c.fillStyle=b.fillStyle):(c.fillStyle=b.fillStyle,a.Wu={fillStyle:b.fillStyle})}
function vm(a,b){var c=a.Xa,d=a.Xu;d?(d.lineCap!=b.lineCap&&(d.lineCap=c.lineCap=b.lineCap),hg&&!Mg(d.Ea,b.Ea)&&c.setLineDash(d.Ea=b.Ea),d.lineJoin!=b.lineJoin&&(d.lineJoin=c.lineJoin=b.lineJoin),d.lineWidth!=b.lineWidth&&(d.lineWidth=c.lineWidth=b.lineWidth),d.miterLimit!=b.miterLimit&&(d.miterLimit=c.miterLimit=b.miterLimit),d.strokeStyle!=b.strokeStyle&&(d.strokeStyle=c.strokeStyle=b.strokeStyle)):(c.lineCap=b.lineCap,hg&&c.setLineDash(b.Ea),c.lineJoin=b.lineJoin,c.lineWidth=b.lineWidth,c.miterLimit=
b.miterLimit,c.strokeStyle=b.strokeStyle,a.Xu={lineCap:b.lineCap,Ea:b.Ea,lineJoin:b.lineJoin,lineWidth:b.lineWidth,miterLimit:b.miterLimit,strokeStyle:b.strokeStyle})}k.jh=function(a,b){a?(a=a.nb,this.rd={fillStyle:Uf(a?a:qg)}):this.rd=null;if(b){a=b.nb;var c=b.si,d=b.getLineDash(),e=b.ti,f=b.Nd();b=b.zi;this.Bc={lineCap:void 0!==c?c:"round",Ea:d?d:rg,lineJoin:void 0!==e?e:"round",lineWidth:this.Ad*(void 0!==f?f:1),miterLimit:void 0!==b?b:10,strokeStyle:Sf(a?a:sg)}}else this.Bc=null};
k.lm=function(a){if(a){var b=a.bl(),c=a.xa(1),d=a.ge(),e=a.ja();this.tr=b[0];this.ur=b[1];this.li=e[1];this.aa=c;this.bo=a.hl();this.qw=d[0];this.rw=d[1];this.sw=a.Bd;this.tw=a.Vb();this.Al=a.gb();this.uw=a.jg;this.mi=e[0]}else this.aa=null};
k.ig=function(a){if(a){var b=a.Uc;b?(b=b.nb,this.Dd={fillStyle:Uf(b?b:qg)}):this.Dd=null;var c=a.qc;if(c){var b=c.nb,d=c.si,e=c.getLineDash(),f=c.ti,g=c.Nd(),c=c.zi;this.Ed={lineCap:void 0!==d?d:"round",Ea:e?e:rg,lineJoin:void 0!==f?f:"round",lineWidth:void 0!==g?g:1,miterLimit:void 0!==c?c:10,strokeStyle:Sf(b?b:sg)}}else this.Ed=null;var b=a.Mv,d=a.Yr,e=a.Zr,f=a.Vb(),g=a.gb(),c=a.La,h=a.Us;a=a.dz;this.lg={font:void 0!==b?b:"10px sans-serif",textAlign:void 0!==h?h:"center",textBaseline:void 0!==a?
a:"middle"};this.La=void 0!==c?c:"";this.um=void 0!==d?this.Ad*d:0;this.vm=void 0!==e?this.Ad*e:0;this.Pi=void 0!==f?f:0;this.th=this.Ad*(void 0!==g?g:1)}else this.La=""};function Bm(a){jj.call(this,a);this.Wa=Id()}u(Bm,jj);
Bm.prototype.Kf=function(a,b,c){this.$b("precompose",c,a,void 0);var d=this.xa();if(d){var e=b.P,f=void 0!==e;if(f){var g=a.hb,h=a.size[0]*g,l=a.size[1]*g,n=a.ia.rotation,r=ff(e),t=[e[2],e[3]],v=[e[2],e[1]],e=af(e);ij(a.jj,r,r);ij(a.jj,t,t);ij(a.jj,v,v);ij(a.jj,e,e);c.save();tg(c,-n,h/2,l/2);c.beginPath();c.moveTo(r[0]*g,r[1]*g);c.lineTo(t[0]*g,t[1]*g);c.lineTo(v[0]*g,v[1]*g);c.lineTo(e[0]*g,e[1]*g);c.clip();tg(c,n,h/2,l/2)}g=this.co;h=c.globalAlpha;c.globalAlpha=b.opacity;c.drawImage(d,0,0,+d.width,
+d.height,Math.round(g[12]),Math.round(g[13]),Math.round(d.width*g[0]),Math.round(d.height*g[5]));c.globalAlpha=h;f&&c.restore()}this.$b("postcompose",c,a,void 0)};Bm.prototype.$b=function(a,b,c,d){var e=this.xb();if(e.hasListener(a)){var f=c.size[0]*c.hb,g=c.size[1]*c.hb,h=c.ia.rotation;tg(b,-h,f/2,g/2);d=void 0!==d?d:this.Ig(c,0);new rm(b,c.hb,c.P,d,c.ia.rotation);e.dispatchEvent(new Ai(a,e,0,c,b));tg(b,h,f/2,g/2)}};
Bm.prototype.Ig=function(a,b){var c=a.ia,d=a.hb;return gj(this.Wa,d*a.size[0]/2,d*a.size[1]/2,d/c.ca,-d/c.ca,-c.rotation,-c.qa[0]+b,-c.qa[1])};var Cm=["Polygon","LineString","Image","Text"];function Dm(a,b,c){this.YH=a;this.Ol=b;this.ce=null;this.Tg=0;this.ca=c;this.Xm=this.Wm=null;this.Hb=[];this.coordinates=[];this.ey=Id();this.Ya=[];this.Ci=[];this.tp=Id();this.PH=Id()}u(Dm,zi);
function Em(a,b,c,d,e,f){var g=a.coordinates.length,h=a.Rq(),l=[b[c],b[c+1]],n=[NaN,NaN],r=!0,t,v,x;for(t=c+e;t<d;t+=e){n[0]=b[t];n[1]=b[t+1];x=h[1];var y=h[2],B=h[3],E=n[0],I=n[1],w=0;E<h[0]?w|=16:E>y&&(w|=4);I<x?w|=8:I>B&&(w|=2);0===w&&(w=1);x=w;x!==v?(r&&(a.coordinates[g++]=l[0],a.coordinates[g++]=l[1]),a.coordinates[g++]=n[0],a.coordinates[g++]=n[1],r=!1):1===x?(a.coordinates[g++]=n[0],a.coordinates[g++]=n[1],r=!1):r=!0;l[0]=n[0];l[1]=n[1];v=x}t===c+e&&(a.coordinates[g++]=l[0],a.coordinates[g++]=
l[1]);f&&(a.coordinates[g++]=b[c],a.coordinates[g++]=b[c+1]);return g}function Fm(a,b){a.Wm=[0,b,0];a.Hb.push(a.Wm);a.Xm=[0,b,0];a.Ya.push(a.Xm)}
function Gm(a,b,c,d,e,f,g,h,l){var n;hj(d,a.ey)?n=a.Ci:(n=Xj(a.coordinates,0,a.coordinates.length,2,d,a.Ci),Ld(a.ey,d));d=!je(f);var r=0,t=g.length,v,x,y=a.tp;a=a.PH;for(var B,E,I,w;r<t;){var A=g[r],G,O,K,N;switch(A[0]){case 0:v=A[1];d&&f[q(v).toString()]||!v.l()?r=A[2]:void 0===l||ef(l,v.l().Z())?++r:r=A[2];break;case 1:b.beginPath();++r;break;case 2:v=A[1];x=n[v];A=n[v+1];I=n[v+2]-x;v=n[v+3]-A;b.arc(x,A,Math.sqrt(I*I+v*v),0,2*Math.PI,!0);++r;break;case 3:b.closePath();++r;break;case 4:v=A[1];x=
A[2];G=A[3];K=A[4]*c;var ba=A[5]*c,P=A[6];O=A[7];var da=A[8],ia=A[9];I=A[11];w=A[12];var oa=A[13],Z=A[14];for(A[10]&&(I+=e);v<x;v+=2){A=n[v]-K;N=n[v+1]-ba;oa&&(A=Math.round(A),N=Math.round(N));if(1!=w||0!==I){var Da=A+K,nb=N+ba;gj(y,Da,nb,w,w,I,-Da,-nb);b.transform(y[0],y[1],y[4],y[5],y[12],y[13])}Da=b.globalAlpha;1!=O&&(b.globalAlpha=Da*O);var nb=Z+da>G.width?G.width-da:Z,Nb=P+ia>G.height?G.height-ia:P;b.drawImage(G,da,ia,nb,Nb,A,N,nb*c,Nb*c);1!=O&&(b.globalAlpha=Da);if(1!=w||0!==I)Nd(y,a),b.transform(a[0],
a[1],a[4],a[5],a[12],a[13])}++r;break;case 5:v=A[1];x=A[2];K=A[3];ba=A[4]*c;P=A[5]*c;I=A[6];w=A[7]*c;G=A[8];for(O=A[9];v<x;v+=2){A=n[v]+ba;N=n[v+1]+P;if(1!=w||0!==I)gj(y,A,N,w,w,I,-A,-N),b.transform(y[0],y[1],y[4],y[5],y[12],y[13]);da=K.split("\n");ia=da.length;1<ia?(oa=Math.round(1.5*b.measureText("M").width),N-=(ia-1)/2*oa):oa=0;for(Z=0;Z<ia;Z++)Da=da[Z],O&&b.strokeText(Da,A,N),G&&b.fillText(Da,A,N),N+=oa;if(1!=w||0!==I)Nd(y,a),b.transform(a[0],a[1],a[4],a[5],a[12],a[13])}++r;break;case 6:if(void 0!==
h&&(v=A[1],v=h(v)))return v;++r;break;case 7:b.fill();++r;break;case 8:v=A[1];x=A[2];A=n[v];N=n[v+1];I=A+.5|0;w=N+.5|0;if(I!==B||w!==E)b.moveTo(A,N),B=I,E=w;for(v+=2;v<x;v+=2)if(A=n[v],N=n[v+1],I=A+.5|0,w=N+.5|0,I!==B||w!==E)b.lineTo(A,N),B=I,E=w;++r;break;case 9:b.fillStyle=A[1];++r;break;case 10:B=void 0!==A[7]?A[7]:!0;E=A[2];b.strokeStyle=A[1];b.lineWidth=B?E*c:E;b.lineCap=A[3];b.lineJoin=A[4];b.miterLimit=A[5];hg&&b.setLineDash(A[6]);E=B=NaN;++r;break;case 11:b.font=A[1];b.textAlign=A[2];b.textBaseline=
A[3];++r;break;case 12:b.stroke();++r;break;default:Oa("Unknown canvas render instruction"),++r}}}Dm.prototype.te=function(a,b,c,d,e){Gm(this,a,b,c,d,e,this.Hb,void 0)};function Hm(a){var b=a.Ya;b.reverse();var c,d=b.length,e,f,g=-1;for(c=0;c<d;++c)if(e=b[c],f=e[0],6==f)g=c;else if(0==f){e[2]=c;e=a.Ya;for(f=c;g<f;){var h=e[g];e[g]=e[f];e[f]=h;++g;--f}g=-1}}function Im(a,b){a.Wm[2]=a.Hb.length;a.Wm=null;a.Xm[2]=a.Ya.length;a.Xm=null;b=[6,b];a.Hb.push(b);a.Ya.push(b)}Dm.prototype.finish=be;
Dm.prototype.Rq=function(){return this.Ol};function Jm(a,b,c){Dm.call(this,a,b,c);this.aa=this.Sf=null;this.Gd=this.jg=this.Zc=this.pc=this.Bd=this.lf=this.kf=this.Ud=this.ef=this.We=this.Ve=void 0}u(Jm,Dm);k=Jm.prototype;k.Wk=function(a,b,c,d){return Em(this,a,b,c,d,!1)};
k.Dg=function(a,b){if(this.aa){Fm(this,b);var c=a.s,d=this.coordinates.length;a=this.Wk(c,0,c.length,a.W);this.Hb.push([4,d,a,this.aa,this.Ve,this.We,this.ef,this.Ud,this.kf,this.lf,this.Bd,this.pc,this.Zc,this.jg,this.Gd]);this.Ya.push([4,d,a,this.Sf,this.Ve,this.We,this.ef,this.Ud,this.kf,this.lf,this.Bd,this.pc,this.Zc,this.jg,this.Gd]);Im(this,b)}};
k.Iq=function(a,b){if(this.aa){Fm(this,b);var c=a.s,d=this.coordinates.length;a=this.Wk(c,0,c.length,a.W);this.Hb.push([4,d,a,this.aa,this.Ve,this.We,this.ef,this.Ud,this.kf,this.lf,this.Bd,this.pc,this.Zc,this.jg,this.Gd]);this.Ya.push([4,d,a,this.Sf,this.Ve,this.We,this.ef,this.Ud,this.kf,this.lf,this.Bd,this.pc,this.Zc,this.jg,this.Gd]);Im(this,b)}};k.finish=function(){Hm(this);this.We=this.Ve=void 0;this.aa=this.Sf=null;this.Gd=this.jg=this.pc=this.Bd=this.lf=this.kf=this.Ud=this.Zc=this.ef=void 0};
k.lm=function(a){var b=a.bl(),c=a.ja(),d=a.el(1),e=a.xa(1),f=a.ge();this.Ve=b[0];this.We=b[1];this.Sf=d;this.aa=e;this.ef=c[1];this.Ud=a.hl();this.kf=f[0];this.lf=f[1];this.Bd=a.Bd;this.pc=a.Vb();this.Zc=a.gb();this.jg=a.jg;this.Gd=c[0]};function Km(a,b,c){Dm.call(this,a,b,c);this.ub={Sk:void 0,Nk:void 0,Ok:null,Pk:void 0,Qk:void 0,Rk:void 0,Er:0,strokeStyle:void 0,lineCap:void 0,Ea:null,lineJoin:void 0,lineWidth:void 0,miterLimit:void 0}}u(Km,Dm);
function Lm(a,b,c,d,e){var f=a.coordinates.length;b=Em(a,b,c,d,e,!1);f=[8,f,b];a.Hb.push(f);a.Ya.push(f);return d}k=Km.prototype;k.Rq=function(){this.ce||(this.ce=Oe(this.Ol),0<this.Tg&&Ne(this.ce,this.ca*(this.Tg+1)/2,this.ce));return this.ce};
function Mm(a){var b=a.ub,c=b.strokeStyle,d=b.lineCap,e=b.Ea,f=b.lineJoin,g=b.lineWidth,h=b.miterLimit;b.Sk==c&&b.Nk==d&&Mg(b.Ok,e)&&b.Pk==f&&b.Qk==g&&b.Rk==h||(b.Er!=a.coordinates.length&&(a.Hb.push([12]),b.Er=a.coordinates.length),a.Hb.push([10,c,g,d,f,h,e],[1]),b.Sk=c,b.Nk=d,b.Ok=e,b.Pk=f,b.Qk=g,b.Rk=h)}
k.nv=function(a,b){var c=this.ub,d=c.lineWidth;void 0!==c.strokeStyle&&void 0!==d&&(Mm(this),Fm(this,b),this.Ya.push([10,c.strokeStyle,c.lineWidth,c.lineCap,c.lineJoin,c.miterLimit,c.Ea],[1]),c=a.s,Lm(this,c,0,c.length,a.W),this.Ya.push([12]),Im(this,b))};
k.ov=function(a,b){var c=this.ub,d=c.lineWidth;if(void 0!==c.strokeStyle&&void 0!==d){Mm(this);Fm(this,b);this.Ya.push([10,c.strokeStyle,c.lineWidth,c.lineCap,c.lineJoin,c.miterLimit,c.Ea],[1]);c=a.Pa;d=a.s;a=a.W;var e=0,f,g;f=0;for(g=c.length;f<g;++f)e=Lm(this,d,e,c[f],a);this.Ya.push([12]);Im(this,b)}};k.finish=function(){this.ub.Er!=this.coordinates.length&&this.Hb.push([12]);Hm(this);this.ub=null};
k.jh=function(a,b){a=b.nb;this.ub.strokeStyle=Sf(a?a:sg);a=b.si;this.ub.lineCap=void 0!==a?a:"round";a=b.getLineDash();this.ub.Ea=a?a:rg;a=b.ti;this.ub.lineJoin=void 0!==a?a:"round";a=b.Nd();this.ub.lineWidth=void 0!==a?a:1;b=b.zi;this.ub.miterLimit=void 0!==b?b:10;this.ub.lineWidth>this.Tg&&(this.Tg=this.ub.lineWidth,this.ce=null)};
function Nm(a,b,c){Dm.call(this,a,b,c);this.ub={cv:void 0,Sk:void 0,Nk:void 0,Ok:null,Pk:void 0,Qk:void 0,Rk:void 0,fillStyle:void 0,strokeStyle:void 0,lineCap:void 0,Ea:null,lineJoin:void 0,lineWidth:void 0,miterLimit:void 0}}u(Nm,Dm);
function Om(a,b,c,d,e){var f=a.ub,g=[1];a.Hb.push(g);a.Ya.push(g);var h,g=0;for(h=d.length;g<h;++g){var l=d[g],n=a.coordinates.length;c=Em(a,b,c,l,e,!0);c=[8,n,c];n=[3];a.Hb.push(c,n);a.Ya.push(c,n);c=l}b=[7];a.Ya.push(b);void 0!==f.fillStyle&&a.Hb.push(b);void 0!==f.strokeStyle&&(f=[12],a.Hb.push(f),a.Ya.push(f));return c}k=Nm.prototype;
k.tn=function(a,b){var c=this.ub,d=c.strokeStyle;if(void 0!==c.fillStyle||void 0!==d){Pm(this);Fm(this,b);this.Ya.push([9,Sf(qg)]);void 0!==c.strokeStyle&&this.Ya.push([10,c.strokeStyle,c.lineWidth,c.lineCap,c.lineJoin,c.miterLimit,c.Ea]);var e=a.s,d=this.coordinates.length;Em(this,e,0,e.length,a.W,!1);a=[1];d=[2,d];this.Hb.push(a,d);this.Ya.push(a,d);a=[7];this.Ya.push(a);void 0!==c.fillStyle&&this.Hb.push(a);void 0!==c.strokeStyle&&(c=[12],this.Hb.push(c),this.Ya.push(c));Im(this,b)}};
k.un=function(a,b){var c=this.ub,d=c.strokeStyle;if(void 0!==c.fillStyle||void 0!==d)Pm(this),Fm(this,b),this.Ya.push([9,Sf(qg)]),void 0!==c.strokeStyle&&this.Ya.push([10,c.strokeStyle,c.lineWidth,c.lineCap,c.lineJoin,c.miterLimit,c.Ea]),c=a.Pa,d=a.Md(),Om(this,d,0,c,a.W),Im(this,b)};
k.pv=function(a,b){var c=this.ub,d=c.strokeStyle;if(void 0!==c.fillStyle||void 0!==d){Pm(this);Fm(this,b);this.Ya.push([9,Sf(qg)]);void 0!==c.strokeStyle&&this.Ya.push([10,c.strokeStyle,c.lineWidth,c.lineCap,c.lineJoin,c.miterLimit,c.Ea]);c=a.jc;d=a.Md();a=a.W;var e=0,f,g;f=0;for(g=c.length;f<g;++f)e=Om(this,d,e,c[f],a);Im(this,b)}};k.finish=function(){Hm(this);this.ub=null;var a=this.YH;if(0!==a){var b=this.coordinates,c,d;c=0;for(d=b.length;c<d;++c)b[c]=a*Math.round(b[c]/a)}};
k.Rq=function(){this.ce||(this.ce=Oe(this.Ol),0<this.Tg&&Ne(this.ce,this.ca*(this.Tg+1)/2,this.ce));return this.ce};
k.jh=function(a,b){var c=this.ub;a?(a=a.nb,c.fillStyle=Uf(a?a:qg)):c.fillStyle=void 0;b?(a=b.nb,c.strokeStyle=Sf(a?a:sg),a=b.si,c.lineCap=void 0!==a?a:"round",a=b.getLineDash(),c.Ea=a?a.slice():rg,a=b.ti,c.lineJoin=void 0!==a?a:"round",a=b.Nd(),c.lineWidth=void 0!==a?a:1,b=b.zi,c.miterLimit=void 0!==b?b:10,c.lineWidth>this.Tg&&(this.Tg=c.lineWidth,this.ce=null)):(c.strokeStyle=void 0,c.lineCap=void 0,c.Ea=null,c.lineJoin=void 0,c.lineWidth=void 0,c.miterLimit=void 0)};
function Pm(a){var b=a.ub,c=b.fillStyle,d=b.strokeStyle,e=b.lineCap,f=b.Ea,g=b.lineJoin,h=b.lineWidth,l=b.miterLimit;void 0!==c&&b.cv!=c&&(a.Hb.push([9,c]),b.cv=b.fillStyle);void 0===d||b.Sk==d&&b.Nk==e&&b.Ok==f&&b.Pk==g&&b.Qk==h&&b.Rk==l||(a.Hb.push([10,d,h,e,g,l,f]),b.Sk=d,b.Nk=e,b.Ok=f,b.Pk=g,b.Qk=h,b.Rk=l)}function Qm(a,b,c){Dm.call(this,a,b,c);this.iy=this.hy=this.gy=null;this.La="";this.th=this.Pi=this.vm=this.um=0;this.lg=this.Ed=this.Dd=null}u(Qm,Dm);
function Rm(a,b,c,d,e){if(""!==a.La&&a.lg&&(a.Dd||a.Ed)){if(a.Dd){var f=a.Dd,g=a.gy;if(!g||g.fillStyle!=f.fillStyle){var h=[9,f.fillStyle];a.Hb.push(h);a.Ya.push(h);g?g.fillStyle=f.fillStyle:a.gy={fillStyle:f.fillStyle}}}a.Ed&&(f=a.Ed,g=a.hy,g&&g.lineCap==f.lineCap&&g.Ea==f.Ea&&g.lineJoin==f.lineJoin&&g.lineWidth==f.lineWidth&&g.miterLimit==f.miterLimit&&g.strokeStyle==f.strokeStyle||(h=[10,f.strokeStyle,f.lineWidth,f.lineCap,f.lineJoin,f.miterLimit,f.Ea,!1],a.Hb.push(h),a.Ya.push(h),g?(g.lineCap=
f.lineCap,g.Ea=f.Ea,g.lineJoin=f.lineJoin,g.lineWidth=f.lineWidth,g.miterLimit=f.miterLimit,g.strokeStyle=f.strokeStyle):a.hy={lineCap:f.lineCap,Ea:f.Ea,lineJoin:f.lineJoin,lineWidth:f.lineWidth,miterLimit:f.miterLimit,strokeStyle:f.strokeStyle}));f=a.lg;g=a.iy;g&&g.font==f.font&&g.textAlign==f.textAlign&&g.textBaseline==f.textBaseline||(h=[11,f.font,f.textAlign,f.textBaseline],a.Hb.push(h),a.Ya.push(h),g?(g.font=f.font,g.textAlign=f.textAlign,g.textBaseline=f.textBaseline):a.iy={font:f.font,textAlign:f.textAlign,
textBaseline:f.textBaseline});Fm(a,e);f=a.coordinates.length;b=Em(a,b,0,c,d,!1);b=[5,f,b,a.La,a.um,a.vm,a.Pi,a.th,!!a.Dd,!!a.Ed];a.Hb.push(b);a.Ya.push(b);Im(a,e)}}
Qm.prototype.ig=function(a){if(a){var b=a.Uc;b?(b=b.nb,b=Uf(b?b:qg),this.Dd?this.Dd.fillStyle=b:this.Dd={fillStyle:b}):this.Dd=null;var c=a.qc;if(c){var b=c.nb,d=c.si,e=c.getLineDash(),f=c.ti,g=c.Nd(),c=c.zi,d=void 0!==d?d:"round",e=e?e.slice():rg,f=void 0!==f?f:"round",g=void 0!==g?g:1,c=void 0!==c?c:10,b=Sf(b?b:sg);if(this.Ed){var h=this.Ed;h.lineCap=d;h.Ea=e;h.lineJoin=f;h.lineWidth=g;h.miterLimit=c;h.strokeStyle=b}else this.Ed={lineCap:d,Ea:e,lineJoin:f,lineWidth:g,miterLimit:c,strokeStyle:b}}else this.Ed=
null;var l=a.Mv,b=a.Yr,d=a.Zr,e=a.Vb(),g=a.gb(),c=a.La,f=a.Us,h=a.dz;a=void 0!==l?l:"10px sans-serif";f=void 0!==f?f:"center";h=void 0!==h?h:"middle";this.lg?(l=this.lg,l.font=a,l.textAlign=f,l.textBaseline=h):this.lg={font:a,textAlign:f,textBaseline:h};this.La=void 0!==c?c:"";this.um=void 0!==b?b:0;this.vm=void 0!==d?d:0;this.Pi=void 0!==e?e:0;this.th=void 0!==g?g:1}else this.La=""};function Sm(a,b,c,d){this.at=a;this.Ao=b;this.As=c;this.se=d;this.eg={};this.PD=Vf(1,1);this.QD=Id()}k=Sm.prototype;
k.finish=function(){for(var a in this.eg){var b=this.eg[a],c;for(c in b)b[c].finish()}};k.Ob=function(a,b,c,d,e){var f=this.QD;gj(f,.5,.5,1/b,-1/b,-c,-a[0],-a[1]);var g=this.PD;g.clearRect(0,0,1,1);var h;void 0!==this.se&&(h=Le(),Me(h,a),Ne(h,b*this.se,h));return this.zs(g,f,c,d,function(a){if(0<g.getImageData(0,0,1,1).data[3]){if(a=e(a))return a;g.clearRect(0,0,1,1)}},h)};
k.dd=function(a,b){var c=void 0!==a?a.toString():"0";a=this.eg[c];void 0===a&&(a={},this.eg[c]=a);c=a[b];void 0===c&&(c=new Tm[b](this.at,this.Ao,this.As),a[b]=c);return c};k.fd=function(){return je(this.eg)};
k.te=function(a,b,c,d,e,f){var g=Object.keys(this.eg).map(Number);g.sort(Hg);var h=this.Ao,l=h[0],n=h[1],r=h[2],h=h[3],l=[l,n,l,h,r,h,r,n];Xj(l,0,8,2,c,l);a.save();a.beginPath();a.moveTo(l[0],l[1]);a.lineTo(l[2],l[3]);a.lineTo(l[4],l[5]);a.lineTo(l[6],l[7]);a.closePath();a.clip();f=f?f:Cm;for(var t,v,l=0,n=g.length;l<n;++l)for(t=this.eg[g[l].toString()],r=0,h=f.length;r<h;++r)v=t[f[r]],void 0!==v&&v.te(a,b,c,d,e);a.restore()};
k.zs=function(a,b,c,d,e,f){var g=Object.keys(this.eg).map(Number);g.sort(function(a,b){return b-a});var h,l,n,r,t;h=0;for(l=g.length;h<l;++h)for(r=this.eg[g[h].toString()],n=Cm.length-1;0<=n;--n)if(t=r[Cm[n]],void 0!==t&&(t=Gm(t,a,1,b,c,d,t.Ya,e,f)))return t};var Tm={Image:Jm,LineString:Km,Polygon:Nm,Text:Qm};function Um(a,b){return q(a)-q(b)}function Vm(a,b){a=.5*a/b;return a*a}function Wm(a,b,c,d,e,f){var g=!1,h,l;if(h=c.xa())l=h.wj(),2==l||3==l?h.lz(e,f):(0==l&&h.load(),h.Kw(e,f),g=!0);if(e=(0,c.fe)(b))d=e.br(d),(0,Xm[d.T()])(a,d,c,b);return g}
var Xm={Point:function(a,b,c,d){var e=c.xa();if(e){if(2!=e.wj())return;var f=a.dd(c.Vc(),"Image");f.lm(e);f.Dg(b,d)}if(e=c.La)a=a.dd(c.Vc(),"Text"),a.ig(e),Rm(a,b.s,2,2,d)},LineString:function(a,b,c,d){var e=c.qc;if(e){var f=a.dd(c.Vc(),"LineString");f.jh(null,e);f.nv(b,d)}if(e=c.La)a=a.dd(c.Vc(),"Text"),a.ig(e),Rm(a,ym(b),2,2,d)},Polygon:function(a,b,c,d){var e=c.Uc,f=c.qc;if(e||f){var g=a.dd(c.Vc(),"Polygon");g.jh(e,f);g.un(b,d)}if(e=c.La)a=a.dd(c.Vc(),"Text"),a.ig(e),Rm(a,yk(b),2,2,d)},MultiPoint:function(a,
b,c,d){var e=c.xa();if(e){if(2!=e.wj())return;var f=a.dd(c.Vc(),"Image");f.lm(e);f.Iq(b,d)}if(e=c.La)a=a.dd(c.Vc(),"Text"),a.ig(e),c=b.s,Rm(a,c,c.length,b.W,d)},MultiLineString:function(a,b,c,d){var e=c.qc;if(e){var f=a.dd(c.Vc(),"LineString");f.jh(null,e);f.ov(b,d)}if(e=c.La)a=a.dd(c.Vc(),"Text"),a.ig(e),b=zm(b),Rm(a,b,b.length,2,d)},MultiPolygon:function(a,b,c,d){var e=c.Uc,f=c.qc;if(f||e){var g=a.dd(c.Vc(),"Polygon");g.jh(e,f);g.pv(b,d)}if(e=c.La)a=a.dd(c.Vc(),"Text"),a.ig(e),b=Am(b),Rm(a,b,b.length,
2,d)},GeometryCollection:function(a,b,c,d){b=b.Pb;var e,f;e=0;for(f=b.length;e<f;++e)(0,Xm[b[e].T()])(a,b[e],c,d)},Circle:function(a,b,c,d){var e=c.Uc,f=c.qc;if(e||f){var g=a.dd(c.Vc(),"Polygon");g.jh(e,f);g.tn(b,d)}if(e=c.La)a=a.dd(c.Vc(),"Text"),a.ig(e),Rm(a,b.Da(),2,2,d)}};function Ym(a,b,c,d,e,f){this.Hl=void 0!==f?f:null;Di.call(this,a,b,c,void 0!==f?0:2,d);this.ga=e;this.xv=null}u(Ym,Di);Ym.prototype.getError=function(){return this.xv};Ym.prototype.rD=function(a){a?(this.xv=a,this.state=3):this.state=2;this.R()};Ym.prototype.load=function(){0==this.state&&(this.state=1,this.R(),this.Hl(this.rD.bind(this)))};Ym.prototype.xa=function(){return this.ga};var Zm,$m=aa.navigator,an=aa.chrome,bn=-1<$m.userAgent.indexOf("OPR"),cn=-1<$m.userAgent.indexOf("Edge");Zm=!(!$m.userAgent.match("CriOS")&&null!==an&&void 0!==an&&"Google Inc."===$m.vendor&&0==bn&&0==cn);function dn(a,b,c,d){var e=Kf(c,b,a);c=b.fi(d,c);b=yf(b);void 0!==b&&(c*=b);b=yf(a);void 0!==b&&(c/=b);a=a.fi(c,e)/c;isFinite(a)&&0<a&&(c/=a);return c}function en(a,b,c,d){a=c-a;b=d-b;var e=Math.sqrt(a*a+b*b);return[Math.round(c+a/e),Math.round(d+b/e)]}
function fn(a,b,c,d,e,f,g,h,l,n,r){var t=Vf(Math.round(c*a),Math.round(c*b));if(0===l.length)return t.canvas;t.scale(c,c);var v=Le();l.forEach(function(a){Ve(v,a.P)});var x=Vf(Math.round(c*Ze(v)/d),Math.round(c*$e(v)/d)),y=c/d;l.forEach(function(a){x.drawImage(a.Gb,n,n,a.Gb.width-2*n,a.Gb.height-2*n,(a.P[0]-v[0])*y,-(a.P[3]-v[3])*y,Ze(a.P)*y,$e(a.P)*y)});var B=ff(g);h.uh.forEach(function(a){var b=a.source,e=a.target,g=b[1][0],h=b[1][1],l=b[2][0],n=b[2][1];a=(e[0][0]-B[0])/f;var r=-(e[0][1]-B[1])/
f,E=(e[1][0]-B[0])/f,y=-(e[1][1]-B[1])/f,da=(e[2][0]-B[0])/f,ia=-(e[2][1]-B[1])/f,e=b[0][0],b=b[0][1],g=g-e,h=h-b,l=l-e,n=n-b;a:{g=[[g,h,0,0,E-a],[l,n,0,0,da-a],[0,0,g,h,y-r],[0,0,l,n,ia-r]];h=g.length;for(l=0;l<h;l++);for(l=0;l<h;l++){for(var n=l,oa=Math.abs(g[l][l]),Z=l+1;Z<h;Z++){var Da=Math.abs(g[Z][l]);Da>oa&&(oa=Da,n=Z)}if(0===oa){g=null;break a}oa=g[n];g[n]=g[l];g[l]=oa;for(n=l+1;n<h;n++)for(oa=-g[n][l]/g[l][l],Z=l;Z<h+1;Z++)g[n][Z]=l==Z?0:g[n][Z]+oa*g[l][Z]}l=Array(h);for(n=h-1;0<=n;n--)for(l[n]=
g[n][h]/g[n][n],oa=n-1;0<=oa;oa--)g[oa][h]-=g[oa][n]*l[n];g=l}g&&(t.save(),t.beginPath(),Zm?(l=(a+E+da)/3,n=(r+y+ia)/3,h=en(l,n,a,r),E=en(l,n,E,y),da=en(l,n,da,ia),t.moveTo(h[0],h[1]),t.lineTo(E[0],E[1]),t.lineTo(da[0],da[1])):(t.moveTo(a,r),t.lineTo(E,y),t.lineTo(da,ia)),t.closePath(),t.clip(),t.transform(g[0],g[2],g[1],g[3],a,r),t.translate(v[0]-e,v[3]-b),t.scale(d/c,-d/c),t.drawImage(x.canvas,0,0),t.restore())});r&&(t.save(),t.strokeStyle="black",t.lineWidth=1,h.uh.forEach(function(a){var b=a.target;
a=(b[0][0]-B[0])/f;var c=-(b[0][1]-B[1])/f,d=(b[1][0]-B[0])/f,e=-(b[1][1]-B[1])/f,g=(b[2][0]-B[0])/f,b=-(b[2][1]-B[1])/f;t.beginPath();t.moveTo(a,c);t.lineTo(d,e);t.lineTo(g,b);t.closePath();t.stroke()}),t.restore());return t.canvas};function gn(a,b,c,d,e){this.sh=a;this.qk=b;var f={},g=If(this.qk,this.sh);this.pg=function(a){var b=a[0]+"/"+a[1];f[b]||(f[b]=g(a));return f[b]};this.Bo=d;this.NB=e*e;this.uh=[];this.Nz=!1;this.NA=this.sh.Ph&&!!d&&!!this.sh.Z()&&Ze(d)==Ze(this.sh.Z());this.Yd=this.sh.Z()?Ze(this.sh.Z()):null;this.Xy=this.qk.Z()?Ze(this.qk.Z()):null;a=ff(c);b=[c[2],c[3]];d=[c[2],c[1]];c=af(c);e=this.pg(a);var h=this.pg(b),l=this.pg(d),n=this.pg(c);hn(this,a,b,d,c,e,h,l,n,10);if(this.Nz){var r=Infinity;this.uh.forEach(function(a){r=
Math.min(r,a.source[0][0],a.source[1][0],a.source[2][0])});this.uh.forEach(function(a){if(Math.max(a.source[0][0],a.source[1][0],a.source[2][0])-r>this.Yd/2){var b=[[a.source[0][0],a.source[0][1]],[a.source[1][0],a.source[1][1]],[a.source[2][0],a.source[2][1]]];b[0][0]-r>this.Yd/2&&(b[0][0]-=this.Yd);b[1][0]-r>this.Yd/2&&(b[1][0]-=this.Yd);b[2][0]-r>this.Yd/2&&(b[2][0]-=this.Yd);Math.max(b[0][0],b[1][0],b[2][0])-Math.min(b[0][0],b[1][0],b[2][0])<this.Yd/2&&(a.source=b)}},this)}f={}}
function hn(a,b,c,d,e,f,g,h,l,n){var r=Ke([f,g,h,l]),t=a.Yd?Ze(r)/a.Yd:null,v=a.sh.Ph&&.5<t&&1>t,x=!1;if(0<n){if(a.qk.rl&&a.Xy)var y=Ke([b,c,d,e]),x=x|.25<Ze(y)/a.Xy;!v&&a.sh.rl&&t&&(x|=.25<t)}if(x||!a.Bo||ef(r,a.Bo)){if(!(x||isFinite(f[0])&&isFinite(f[1])&&isFinite(g[0])&&isFinite(g[1])&&isFinite(h[0])&&isFinite(h[1])&&isFinite(l[0])&&isFinite(l[1])))if(0<n)x=!0;else return;if(0<n&&(x||(t=a.pg([(b[0]+d[0])/2,(b[1]+d[1])/2]),r=v?(mf(f[0],a.Yd)+mf(h[0],a.Yd))/2-mf(t[0],a.Yd):(f[0]+h[0])/2-t[0],t=(f[1]+
h[1])/2-t[1],x=r*r+t*t>a.NB),x)){Math.abs(b[0]-d[0])<=Math.abs(b[1]-d[1])?(v=[(c[0]+d[0])/2,(c[1]+d[1])/2],r=a.pg(v),t=[(e[0]+b[0])/2,(e[1]+b[1])/2],x=a.pg(t),hn(a,b,c,v,t,f,g,r,x,n-1),hn(a,t,v,d,e,x,r,h,l,n-1)):(v=[(b[0]+c[0])/2,(b[1]+c[1])/2],r=a.pg(v),t=[(d[0]+e[0])/2,(d[1]+e[1])/2],x=a.pg(t),hn(a,b,v,t,e,f,r,x,l,n-1),hn(a,v,c,d,t,r,g,h,x,n-1));return}if(v){if(!a.NA)return;a.Nz=!0}a.uh.push({source:[f,h,l],target:[b,d,e]});a.uh.push({source:[f,g,h],target:[b,c,d]})}}
function jn(a){var b=Le();a.uh.forEach(function(a){a=a.source;Me(b,a[0]);Me(b,a[1]);Me(b,a[2])});return b};function kn(a,b,c,d,e,f){this.qk=b;this.Bo=a.Z();var g=b.Z(),h=g?df(c,g):c,g=dn(a,b,bf(h),d);this.rk=new gn(a,b,h,this.Bo,.5*g);this.Rs=d;this.Qs=c;a=jn(this.rk);this.Qy=(this.we=f(a,g,e))?this.we.Ad:1;this.qm=this.ga=null;e=2;f=[];this.we&&(e=0,f=this.we.be);Di.call(this,c,d,this.Qy,e,f)}u(kn,Di);k=kn.prototype;k.Ca=function(){1==this.state&&(me(this.qm),this.qm=null);kn.cb.Ca.call(this)};k.xa=function(){return this.ga};k.D=function(){return this.qk};
k.em=function(){var a=this.we.Qa();2==a&&(this.ga=fn(Ze(this.Qs)/this.Rs,$e(this.Qs)/this.Rs,this.Qy,this.we.na(),0,this.Rs,this.Qs,this.rk,[{P:this.we.Z(),Gb:this.we.xa()}],0));this.state=a;this.R()};k.load=function(){if(0==this.state){this.state=1;this.R();var a=this.we.Qa();2==a||3==a?this.em():(this.qm=J(this.we,"change",function(){var a=this.we.Qa();if(2==a||3==a)me(this.qm),this.qm=null,this.em()},this),this.we.load())}};function ln(a){lh.call(this,{Na:a.Na,P:a.P,mb:a.mb,ea:a.ea,state:a.state});this.ue=void 0!==a.oc?a.oc:null;this.pf=null;this.jy=0}u(ln,lh);ln.prototype.kl=function(){return this.ue};function mn(a,b){a.ue&&(b=Ig(a.ue,b,0),b=a.ue[b]);return b}
ln.prototype.xa=function(a,b,c,d){var e=this.D();if(e&&d&&!Hf(e,d)){if(this.pf){if(this.jy==this.bb&&Hf(this.pf.D(),d)&&this.pf.na()==b&&this.pf.Ad==c&&Ue(this.pf.Z(),a))return this.pf;this.pf.Id();this.pf=null}this.pf=new kn(e,d,a,b,c,function(a,b,c){return this.Vq(a,b,c,e)}.bind(this));this.jy=this.bb;return this.pf}e&&(d=e);return this.Vq(a,b,c,d)};
ln.prototype.iD=function(a){a=a.target;switch(a.Qa()){case 1:this.dispatchEvent(new nn(on,a));break;case 2:this.dispatchEvent(new nn(pn,a));break;case 3:this.dispatchEvent(new nn(qn,a))}};function rn(a,b){a.xa().src=b}function nn(a,b){de.call(this,a);this.Gb=b}u(nn,de);var on="imageloadstart",pn="imageloadend",qn="imageloaderror";function sn(a){ln.call(this,{Na:a.Na,mb:a.mb,ea:a.ea,oc:a.oc,state:a.state});this.SA=a.PA;this.ga=null;this.Ib=0;this.Ei=void 0!==a.ratio?a.ratio:1.5}u(sn,ln);sn.prototype.Vq=function(a,b,c,d){b=mn(this,b);var e=this.ga;if(e&&this.Ib==this.bb&&e.na()==b&&e.Ad==c&&Pe(e.Z(),a))return e;a=a.slice();gf(a,this.Ei);(d=this.SA(a,b,c,[Ze(a)/b*c,$e(a)/b*c],d))&&(e=new Ym(a,b,c,this.be,d));this.ga=e;this.Ib=this.bb;return e};function tn(a){this.Sb=a.source;this.Wa=Id();this.Ik=Vf();this.bn=[0,0];this.Cb=null;sn.call(this,{Na:a.Na,PA:this.QA.bind(this),mb:a.mb,ea:a.ea,ratio:a.ratio,oc:a.oc,state:this.Sb.Qa()});this.tf=null;this.kd=void 0;this.Qe(a.style);J(this.Sb,"change",this.lr,this)}u(tn,sn);k=tn.prototype;
k.QA=function(a,b,c,d,e){var f=new Sm(.5*b/c,a,b);Ch(this.Sb,a,b,e);var g=!1;Ah(this.Sb,a,function(a){var d;if(!(d=g)){var e;(d=a.kd)?e=d.call(a,b):this.kd&&(e=this.kd(a,b));if(e){var h,t=!1;Array.isArray(e)||(e=[e]);d=0;for(h=e.length;d<h;++d)t=Wm(f,a,e[d],Vm(b,c),this.jr,this)||t;d=t}else d=!1}g=d},this);f.finish();if(g)return null;this.bn[0]!=d[0]||this.bn[1]!=d[1]?(this.Ik.canvas.width=d[0],this.Ik.canvas.height=d[1],this.bn[0]=d[0],this.bn[1]=d[1]):this.Ik.clearRect(0,0,d[0],d[1]);a=un(this,
bf(a),b,c,d);f.te(this.Ik,c,a,0,{});this.Cb=f;return this.Ik.canvas};k.Ob=function(a,b,c,d,e){if(this.Cb){var f={};return this.Cb.Ob(a,b,0,d,function(a){var b=q(a).toString();if(!(b in f))return f[b]=!0,e(a)})}};k.v=function(){return this.Sb};function un(a,b,c,d,e){return gj(a.Wa,e[0]/2,e[1]/2,d/c,-d/c,0,-b[0],-b[1])}k.jr=function(){this.R()};k.lr=function(){this.ub=this.Sb.Qa();this.R()};k.Qe=function(a){this.tf=void 0!==a?a:Cg;this.kd=a?Ag(this.tf):void 0;this.R()};function vn(a){Bm.call(this,a);this.aa=null;this.co=Id()}u(vn,Bm);vn.prototype.Ob=function(a,b,c,d){var e=this.xb();return e.v().Ob(a,b.ia.ca,b.ia.rotation,b.Ni,function(a){return c.call(d,a,e)})};vn.prototype.xa=function(){return this.aa?this.aa.xa():null};
vn.prototype.Pe=function(a,b){var c=a.hb,d=a.ia,e=d.qa,f=d.ca,g=this.xb().v(),h=a.qb,l=a.P;void 0!==b.P&&(l=df(l,b.P));h[0]||h[1]||Ye(l)||(b=g.xa(l,f,c,d.ea))&&lj(this,b)&&(this.aa=b);this.aa&&(b=this.aa,d=b.Z(),h=b.na(),l=b.Ad,f=c*h/(f*l),gj(this.co,c*a.size[0]/2,c*a.size[1]/2,f,f,0,l*(d[0]-e[0])/h,l*(e[1]-d[3])/h),nj(a.Na,b.be),oj(a,g));return!!this.aa};function wn(a){Bm.call(this,a);this.context=Vf();this.dy=null;this.NH=Le();this.QH=[0,0,0];this.co=Id();this.MI=0}u(wn,Bm);
wn.prototype.Kf=function(a,b,c){var d=this.Ig(a,0);this.$b("precompose",c,a,d);var e=a.hb,f=a.ia,g=f.qa,h=f.ea,l=f.ca,f=f.rotation,n=a.size,r=Math.round(e*n[0]/2),t=Math.round(e*n[1]/2),n=e/l,v=this.xb(),x=v.v(),y=x.Kn(h),B=x.Ie(h),v=v.hasListener("render"),E=c,I,w,A,G;if(f||v)E=this.context,I=E.canvas,G=Vi(B,l),A=dj(x,G,e,h),G=Ji(Ui(B,G)),A=A[0]/G[0],l=c.canvas.width*A,w=c.canvas.height*A,G=Math.round(Math.sqrt(l*l+w*w)),I.width!=G?I.width=I.height=G:E.clearRect(0,0,G,G),I=(G-l)/2/A,w=(G-w)/2/A,
n*=A,r=Math.round(A*(r+I)),t=Math.round(A*(t+w));l=E.globalAlpha;E.globalAlpha=b.opacity;var O=this.dy,K;b=x.Zq(h)&&1==b.opacity;b||(O.reverse(),K=[]);for(var N=0,ba=O.length;N<ba;++N){var P=O[N],da=P.yb,ia=Oi(B,da,this.NH),oa=da[0],Z=af(Oi(B,Wi(B,g,oa,this.QH))),da=Math.round(Ze(ia)*n),Da=Math.round($e(ia)*n),nb=Math.round((ia[0]-Z[0])*n/da)*da+r+Math.round((Z[0]-g[0])*n),ia=Math.round((Z[1]-ia[3])*n/Da)*Da+t+Math.round((g[1]-Z[1])*n);if(!b){Z=[nb,ia,nb+da,ia+Da];E.save();for(var Nb=0,Zt=K.length;Nb<
Zt;++Nb){var rd=K[Nb];ef(Z,rd)&&(E.beginPath(),E.moveTo(Z[0],Z[1]),E.lineTo(Z[0],Z[3]),E.lineTo(Z[2],Z[3]),E.lineTo(Z[2],Z[1]),E.moveTo(rd[0],rd[1]),E.lineTo(rd[2],rd[1]),E.lineTo(rd[2],rd[3]),E.lineTo(rd[0],rd[3]),E.closePath(),E.clip())}K.push(Z)}oa=dj(x,oa,e,h);E.drawImage(P.xa(),y,y,oa[0],oa[1],nb,ia,da,Da);b||E.restore()}v&&(e=I-r/A+r,h=w-t/A+t,g=gj(this.co,G/2-e,G/2-h,n,-n,-f,-g[0]+e/n,-g[1]-h/n),this.$b("render",E,a,g));(f||v)&&c.drawImage(E.canvas,-Math.round(I),-Math.round(w),G/A,G/A);E.globalAlpha=
l;this.$b("postcompose",c,a,d)};
wn.prototype.Pe=function(a,b){function c(a){a=a.Qa();return 2==a||4==a||3==a&&!x}var d=a.hb,e=a.ia,f=e.ea,g=this.xb(),h=g.v(),l=h.Ie(f),n=Vi(l,e.ca,this.MI),r=l.na(n),t=e.qa;r==e.ca?(t=qj(t,r,a.size),e=cf(t,r,e.rotation,a.size)):e=a.P;void 0!==b.P&&(e=df(e,b.P));if(Ye(e))return!1;b=Ri(l,e,r);r={};r[n]={};var v=this.mn(h,f,r),x=pm(g),y=Le(),B=new ih(0,0,0,0),E,I,w;for(I=b.Yb;I<=b.cc;++I)for(w=b.lc;w<=b.tc;++w)t=sj(h,n,I,w,d,f),!c(t)&&t.Wb&&(t=t.Wb),c(t)?r[n][t.yb.toString()]=t:(E=Ni(l,t.yb,v,B,y),
E||(t=Qi(l,t.yb,B,y))&&v(n+1,t));v=Object.keys(r).map(Number);v.sort(Hg);var y=[],A,B=0;for(I=v.length;B<I;++B)for(A in t=v[B],w=r[t],w)t=w[A],2==t.Qa()&&y.push(t);this.dy=y;pj(a.Gm,h,n,b);rj(a,h,l,d,f,e,n,g.get("preload"));mj(a,h);oj(a,h);return!0};function xn(a){Bm.call(this,a);this.Ic=!1;this.Ib=-1;this.gh=NaN;this.eh=Le();this.Cb=this.fh=null;this.Xa=Vf()}u(xn,Bm);k=xn.prototype;
k.Kf=function(a,b,c){var d=a.P,e=a.hb,f=b.Kl?a.Ni:{},g=a.ia,h=g.ea,g=g.rotation,l=h.Z(),n=this.xb().v(),r=this.Ig(a,0);this.$b("precompose",c,a,r);var t=this.Cb;if(t&&!t.fd()){var v;this.xb().hasListener("render")?(this.Xa.canvas.width=c.canvas.width,this.Xa.canvas.height=c.canvas.height,v=this.Xa):v=c;var x=v.globalAlpha;v.globalAlpha=b.opacity;b=a.size[0]*e;var y=a.size[1]*e;tg(v,-g,b/2,y/2);t.te(v,e,r,g,f);if(n.Gp&&h.Ph&&!Pe(l,d)){for(var h=d[0],n=Ze(l),B=0;h<l[0];)--B,r=n*B,r=this.Ig(a,r),t.te(v,
e,r,g,f),h+=n;B=0;for(h=d[2];h>l[2];)++B,r=n*B,r=this.Ig(a,r),t.te(v,e,r,g,f),h-=n;r=this.Ig(a,0)}tg(v,g,b/2,y/2);v!=c&&(this.$b("render",v,a,r),c.drawImage(v.canvas,0,0));v.globalAlpha=x}this.$b("postcompose",c,a,r)};k.Ob=function(a,b,c,d){if(this.Cb){var e=b.ia.ca;b=b.ia.rotation;var f=this.xb(),g={};return this.Cb.Ob(a,e,b,{},function(a){var b=q(a).toString();if(!(b in g))return g[b]=!0,c.call(d,a,f)})}};k.Lg=function(){kj(this)};
k.Pe=function(a){function b(a){var b,d=a.kd;d?b=d.call(a,n):(d=c.kd)&&(b=d(a,n));b&&(a=this.dm(a,n,r,b,v),this.Ic=this.Ic||a)}var c=this.xb(),d=c.v();nj(a.Na,d.be);oj(a,d);var e=a.qb[0],f=a.qb[1],g=c.it,h=c.jt;if(!this.Ic&&!g&&e||!h&&f)return!0;var l=a.P,h=a.ia,e=h.ea,n=h.ca,r=a.hb,f=c.bb,t=c.se,g=c.get("renderOrder");void 0===g&&(g=Um);l=Ne(l,t*n);t=h.ea.Z();d.Gp&&h.ea.Ph&&!Pe(t,a.P)&&(a=Math.max(Ze(l)/2,Ze(t)),l[0]=t[0]-a,l[2]=t[2]+a);if(!this.Ic&&this.gh==n&&this.Ib==f&&this.fh==g&&Pe(this.eh,
l))return!0;this.Cb=null;this.Ic=!1;var v=new Sm(.5*n/r,l,n,c.se);Ch(d,l,n,e);if(g){var x=[];Ah(d,l,function(a){x.push(a)},this);x.sort(g);x.forEach(b,this)}else Ah(d,l,b,this);v.finish();this.gh=n;this.Ib=f;this.fh=g;this.eh=l;this.Cb=v;return!0};k.dm=function(a,b,c,d,e){if(!d)return!1;var f=!1;if(Array.isArray(d))for(var g=0,h=d.length;g<h;++g)f=Wm(e,a,d[g],Vm(b,c),this.Lg,this)||f;else f=Wm(e,a,d,Vm(b,c),this.Lg,this)||f;return f};function yn(a,b){var c=/\{z\}/g,d=/\{x\}/g,e=/\{y\}/g,f=/\{-y\}/g;return function(g){if(g)return a.replace(c,g[0].toString()).replace(d,g[1].toString()).replace(e,function(){return(-g[2]-1).toString()}).replace(f,function(){return((b.tj?b.tj[g[0]]:null).Ln()+g[2]).toString()})}}function zn(a,b){for(var c=a.length,d=Array(c),e=0;e<c;++e)d[e]=yn(a[e],b);return An(d)}function An(a){return 1===a.length?a[0]:function(b,c,d){if(b)return a[mf((b[1]<<b[0])+b[2],a.length)](b,c,d)}}function Bn(){}
function Cn(a){var b=[],c=/\{(\d)-(\d)\}/.exec(a)||/\{([a-z])-([a-z])\}/.exec(a);if(c){var d=c[2].charCodeAt(0),e;for(e=c[1].charCodeAt(0);e<=d;++e)b.push(a.replace(c[0],String.fromCharCode(e)))}else b.push(a);return b};function Dn(a){aj.call(this,{Na:a.Na,od:a.od,P:a.P,mb:a.mb,pe:a.pe,ea:a.ea,state:a.state,Db:a.Db,mg:a.mg,Sa:a.Sa});this.Sc=a.Sc;this.uf=this.qj?this.qj.bind(this):Bn;this.Kb=null;if(a.Kb){var b=a.Kb;this.Kb=b;var c=b.join("\n");En(this,this.qj?this.qj.bind(this):zn(b,this.Db),c)}else a.url&&this.Jy(a.url);a.uf&&En(this,a.uf)}u(Dn,aj);
Dn.prototype.Wn=function(a){a=a.target;switch(a.Qa()){case 1:this.dispatchEvent(new fj("tileloadstart",a));break;case 2:this.dispatchEvent(new fj("tileloadend",a));break;case 3:this.dispatchEvent(new fj("tileloaderror",a))}};function En(a,b,c){a.uf=b;"undefined"!==typeof c?cj(a,c):a.R()}Dn.prototype.Jy=function(a){var b=this.Kb=Cn(a);En(this,this.qj?this.qj.bind(this):zn(b,this.Db),a)};Dn.prototype.wz=function(a,b,c){a=this.xj(a,b,c);this.Zd.qd(a)&&this.Zd.get(a)};function Fn(a,b){xj.call(this,0,b);this.Xa=Vf();this.ga=this.Xa.canvas;this.ga.style.width="100%";this.ga.style.height="100%";this.ga.className="ol-unselectable";Dc(a,this.ga,0);this.ab=!0;this.Wa=Id()}u(Fn,xj);k=Fn.prototype;k.wq=function(a){if(a instanceof nm)return new vn(a);if(a instanceof om)return new wn(a);if(a instanceof qm)return new xn(a);Oa("unexpected layer configuration");return null};
k.$b=function(a,b){var c=this.g(),d=this.Xa;if(c.hasListener(a)){var e=b.P,f=b.hb,g=b.ia.rotation,h=this.Ig(b);new rm(d,f,e,h,g);c.dispatchEvent(new Ai(a,c,0,b,d))}};k.Ig=function(a){var b=a.hb;a=a.ia;var c=a.ca;return gj(this.Wa,this.ga.width/2,this.ga.height/2,b/c,-b/c,-a.rotation,-a.qa[0],-a.qa[1])};k.T=function(){return"canvas"};
k.Wo=function(a){if(a){var b=this.Xa,c=a.hb,d=Math.round(a.size[0]*c),c=Math.round(a.size[1]*c);this.ga.width!=d||this.ga.height!=c?(this.ga.width=d,this.ga.height=c):b.clearRect(0,0,d,c);var e=a.ia.rotation;yj(a);this.$b("precompose",a);var f=a.ri;Ng(f);tg(b,e,d/2,c/2);var g=a.ia.ca,h,l,n,r;h=0;for(l=f.length;h<l;++h)r=f[h],n=r.layer,n=Aj(this,n),Ci(r,g)&&"ready"==r.Ns&&n.Pe(a,r)&&n.Kf(a,r,b);tg(b,-e,d/2,c/2);this.$b("postcompose",a);this.ab||(Yc(this.ga,!0),this.ab=!0);Bj(this,a);a.Oe.push(zj)}else this.ab&&
(Yc(this.ga,!1),this.ab=!1)};function Gn(a,b){jj.call(this,a);this.target=b}u(Gn,jj);Gn.prototype.dn=be;Gn.prototype.Kf=be;Gn.prototype.nl=function(){return this.target};function Hn(a){var b=document.createElement("DIV");b.style.position="absolute";Gn.call(this,a,b);this.aa=null;this.Wa=Kd()}u(Hn,Gn);Hn.prototype.Ob=function(a,b,c,d){var e=this.xb();return e.v().Ob(a,b.ia.ca,b.ia.rotation,b.Ni,function(a){return c.call(d,a,e)})};Hn.prototype.dn=function(){Cc(this.target);this.aa=null};
Hn.prototype.Pe=function(a,b){var c=a.ia,d=c.qa,e=c.ca,f=c.rotation,g=this.aa,h=this.xb().v(),l=a.qb,n=a.P;void 0!==b.P&&(n=df(n,b.P));l[0]||l[1]||Ye(n)||(b=h.xa(n,e,a.hb,c.ea))&&lj(this,b)&&(g=b);g&&(c=g.Z(),l=g.na(),b=Id(),gj(b,a.size[0]/2,a.size[1]/2,l/e,l/e,f,(c[0]-d[0])/l,(d[1]-c[3])/l),g!=this.aa&&(d=g.xa(this),d.style.maxWidth="none",d.style.position="absolute",Cc(this.target),this.target.appendChild(d),this.aa=g),hj(b,this.Wa)||(Zf(this.target,b),Ld(this.Wa,b)),nj(a.Na,g.be),oj(a,h));return!0};function In(a){var b=document.createElement("DIV");b.style.position="absolute";Gn.call(this,a,b);this.ab=!0;this.cy=1;this.Ib=0;this.Se={}}u(In,Gn);In.prototype.dn=function(){Cc(this.target);this.Ib=0};
In.prototype.Pe=function(a,b){if(!b.visible)return this.ab&&(Yc(this.target,!1),this.ab=!1),!0;var c=a.hb,d=a.ia,e=d.ea,f=this.xb(),g=f.v(),h=g.Ie(e),l=g.Kn(e),n=Vi(h,d.ca),r=h.na(n),t=d.qa,v;r==d.ca?(t=qj(t,r,a.size),v=cf(t,r,d.rotation,a.size)):v=a.P;void 0!==b.P&&(v=df(v,b.P));var r=Ri(h,v,r),x={};x[n]={};var y=this.mn(g,e,x),B=pm(f),E=Le(),I=new ih(0,0,0,0),w,A,G,O;for(G=r.Yb;G<=r.cc;++G)for(O=r.lc;O<=r.tc;++O)w=sj(g,n,G,O,c,e),A=w.Qa(),A=2==A||4==A||3==A&&!B,!A&&w.Wb&&(w=w.Wb),A=w.Qa(),2==A?
x[n][w.yb.toString()]=w:4==A||3==A&&!B||(A=Ni(h,w.yb,y,I,E),A||(w=Qi(h,w.yb,I,E))&&y(n+1,w));var K;if(this.Ib!=g.bb){for(K in this.Se)B=this.Se[+K],Ec(B.target);this.Se={};this.Ib=g.bb}E=Object.keys(x).map(Number);E.sort(Hg);var y={},N;G=0;for(O=E.length;G<O;++G){K=E[G];K in this.Se?B=this.Se[K]:(B=Wi(h,t,K),B=new Jn(h,B),y[K]=!0,this.Se[K]=B);K=x[K];for(N in K){w=B;A=K[N];var ba=l,P=A.yb,da=P[1],ia=P[2],oa=P.toString();if(!(oa in w.zm)){var P=Ji(Ui(w.ez,P[0]),w.Ri),Z=A.xa(w),Da=Z.style;Da.maxWidth=
"none";var nb,Nb;0<ba?(nb=document.createElement("DIV"),Nb=nb.style,Nb.overflow="hidden",Nb.width=P[0]+"px",Nb.height=P[1]+"px",Da.position="absolute",Da.left=-ba+"px",Da.top=-ba+"px",Da.width=P[0]+2*ba+"px",Da.height=P[1]+2*ba+"px",nb.appendChild(Z)):(Da.width=P[0]+"px",Da.height=P[1]+"px",nb=Z,Nb=Da);Nb.position="absolute";Nb.left=(da-w.Xs[1])*P[0]+"px";Nb.top=(w.Xs[2]-ia)*P[1]+"px";w.lj||(w.lj=document.createDocumentFragment());w.lj.appendChild(nb);w.zm[oa]=A}}B.lj&&(B.target.appendChild(B.lj),
B.lj=null)}l=Object.keys(this.Se).map(Number);l.sort(Hg);G=Id();N=0;for(E=l.length;N<E;++N)if(K=l[N],B=this.Se[K],K in x)if(w=B.na(),O=B.ge(),gj(G,a.size[0]/2,a.size[1]/2,w/d.ca,w/d.ca,d.rotation,(O[0]-t[0])/w,(t[1]-O[1])/w),B.setTransform(G),K in y){for(--K;0<=K;--K)if(K in this.Se){O=this.Se[K].target;O.parentNode&&O.parentNode.insertBefore(B.target,O.nextSibling);break}0>K&&Dc(this.target,B.target,0)}else{if(!a.qb[0]&&!a.qb[1]){A=Pi(B.ez,v,B.Xs[0],I);K=[];w=void 0;for(w in B.zm)O=B.zm[w],A.contains(O.yb)||
K.push(O);A=0;for(ba=K.length;A<ba;++A)O=K[A],w=O.yb.toString(),Ec(O.xa(B)),delete B.zm[w]}}else Ec(B.target),delete this.Se[K];b.opacity!=this.cy&&(this.cy=this.target.style.opacity=b.opacity);b.visible&&!this.ab&&(Yc(this.target,!0),this.ab=!0);pj(a.Gm,g,n,r);rj(a,g,h,c,e,v,n,f.get("preload"));mj(a,g);oj(a,g);return!0};
function Jn(a,b){this.target=document.createElement("DIV");this.target.style.position="absolute";this.target.style.width="100%";this.target.style.height="100%";this.ez=a;this.Xs=b;this.nc=ff(Oi(a,b));this.As=a.na(b[0]);this.zm={};this.lj=null;this.Wa=Kd();this.Ri=[0,0]}Jn.prototype.ge=function(){return this.nc};Jn.prototype.na=function(){return this.As};Jn.prototype.setTransform=function(a){hj(a,this.Wa)||(Zf(this.target,a),Ld(this.Wa,a))};function Kn(a){this.Xa=Vf();var b=this.Xa.canvas;b.style.maxWidth="none";b.style.position="absolute";Gn.call(this,a,b);this.Ic=!1;this.Ib=-1;this.gh=NaN;this.eh=Le();this.Cb=this.fh=null;this.Wa=Id();this.LB=Id()}u(Kn,Gn);k=Kn.prototype;k.dn=function(){var a=this.Xa.canvas;a.width=a.width;this.Ib=0};
k.Kf=function(a,b){this.xb();var c=a.ia,d=c.qa,e=c.rotation,f=c.ca,c=a.hb,g=a.size[0],h=a.size[1],l=g*c,n=h*c,d=gj(this.Wa,c*g/2,c*h/2,c/f,-c/f,-e,-d[0],-d[1]),f=this.Xa;f.canvas.width=l;f.canvas.height=n;g=gj(this.LB,0,0,1/c,1/c,0,-(l-g)/2*c,-(n-h)/2*c);Zf(f.canvas,g);Ln(this,"precompose",a,d);(g=this.Cb)&&!g.fd()&&(f.globalAlpha=b.opacity,g.te(f,c,d,e,b.Kl?a.Ni:{}),Ln(this,"render",a,d));Ln(this,"postcompose",a,d)};
function Ln(a,b,c,d){var e=a.Xa;a=a.xb();a.hasListener(b)&&(new rm(e,c.hb,c.P,d,c.ia.rotation),a.dispatchEvent(new Ai(b,a,0,c,e)))}k.Ob=function(a,b,c,d){if(this.Cb){var e=b.ia.ca;b=b.ia.rotation;var f=this.xb(),g={};return this.Cb.Ob(a,e,b,{},function(a){var b=q(a).toString();if(!(b in g))return g[b]=!0,c.call(d,a,f)})}};k.Lg=function(){kj(this)};
k.Pe=function(a){function b(a){var b,d=a.kd;d?b=d.call(a,l):(d=c.kd)&&(b=d(a,l));b&&(a=this.dm(a,l,n,b,r),this.Ic=this.Ic||a)}var c=this.xb(),d=c.v();nj(a.Na,d.be);oj(a,d);var e=a.qb[0],f=a.qb[1],g=c.it,h=c.jt;if(!this.Ic&&!g&&e||!h&&f)return!0;var f=a.P,g=a.ia,e=g.ea,l=g.ca,n=a.hb;a=c.bb;h=c.se;g=c.get("renderOrder");void 0===g&&(g=Um);f=Ne(f,h*l);if(!this.Ic&&this.gh==l&&this.Ib==a&&this.fh==g&&Pe(this.eh,f))return!0;this.Cb=null;this.Ic=!1;var r=new Sm(.5*l/n,f,l,c.se);Ch(d,f,l,e);if(g){var t=
[];Ah(d,f,function(a){t.push(a)},this);t.sort(g);t.forEach(b,this)}else Ah(d,f,b,this);r.finish();this.gh=l;this.Ib=a;this.fh=g;this.eh=f;this.Cb=r;return!0};k.dm=function(a,b,c,d,e){if(!d)return!1;var f=!1;if(Array.isArray(d))for(var g=0,h=d.length;g<h;++g)f=Wm(e,a,d[g],Vm(b,c),this.Lg,this)||f;else f=Wm(e,a,d,Vm(b,c),this.Lg,this)||f;return f};function Mn(a,b){xj.call(this,0,b);this.Xa=Vf();b=this.Xa.canvas;b.style.position="absolute";b.style.width="100%";b.style.height="100%";b.className="ol-unselectable";Dc(a,b,0);this.Wa=Id();this.Pg=document.createElement("DIV");this.Pg.className="ol-unselectable";b=this.Pg.style;b.position="absolute";b.width="100%";b.height="100%";J(this.Pg,"touchstart",fe);Dc(a,this.Pg,0);this.ab=!0}u(Mn,xj);k=Mn.prototype;k.Ca=function(){Ec(this.Pg);Mn.cb.Ca.call(this)};
k.wq=function(a){if(a instanceof nm)a=new Hn(a);else if(a instanceof om)a=new In(a);else if(a instanceof qm)a=new Kn(a);else return Oa("unexpected layer configuration"),null;return a};k.$b=function(a,b){var c=this.g();if(c.hasListener(a)){var d=b.P,e=b.hb,f=b.ia,g=f.rotation,h=this.Xa,l=h.canvas;gj(this.Wa,l.width/2,l.height/2,e/f.ca,-e/f.ca,-f.rotation,-f.qa[0],-f.qa[1]);new rm(h,e,d,this.Wa,g);c.dispatchEvent(new Ai(a,c,0,b,h))}};k.T=function(){return"dom"};
k.Wo=function(a){if(a){var b=this.g();if(b.hasListener("precompose")||b.hasListener("postcompose")){var b=this.Xa.canvas,c=a.hb;b.width=a.size[0]*c;b.height=a.size[1]*c}this.$b("precompose",a);b=a.ri;Ng(b);var c=a.ia.ca,d,e,f,g;d=0;for(e=b.length;d<e;++d)g=b[d],f=g.layer,f=Aj(this,f),Dc(this.Pg,f.nl(),d),Ci(g,c)&&"ready"==g.Ns?f.Pe(a,g)&&f.Kf(a,g):f.dn();var b=a.Fl,h;for(h in this.ke)h in b||(f=this.ke[h],Ec(f.nl()));this.ab||(Yc(this.Pg,!0),this.ab=!0);yj(a);Bj(this,a);a.Oe.push(zj);this.$b("postcompose",
a)}else this.ab&&(Yc(this.Pg,!1),this.ab=!1)};function Nn(a){this.Sb=a}Nn.prototype.v=function(){return this.Sb};function On(a){this.Sb=a}u(On,Nn);On.prototype.T=function(){return 35632};function Pn(a){this.Sb=a}u(Pn,Nn);Pn.prototype.T=function(){return 35633};function Qn(){this.Sb="precision mediump float;\nvarying vec2 v_texCoord;\nvarying float v_opacity;\n\nuniform float u_opacity;\nuniform sampler2D u_image;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_image, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  float alpha = texColor.a * v_opacity * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n"}u(Qn,On);ca(Qn);
function Rn(){this.Sb="varying vec2 v_texCoord;\nvarying float v_opacity;\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nattribute vec2 a_offsets;\nattribute float a_opacity;\nattribute float a_rotateWithView;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix;\n  if (a_rotateWithView == 1.0) {\n    offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  }\n  vec4 offsets = offsetMatrix * vec4(a_offsets, 0., 0.);\n  gl_Position = u_projectionMatrix * vec4(a_position, 0., 1.) + offsets;\n  v_texCoord = a_texCoord;\n  v_opacity = a_opacity;\n}\n\n\n"}
u(Rn,Pn);ca(Rn);function Sn(a,b){this.jI=a.getUniformLocation(b,"u_offsetRotateMatrix");this.kI=a.getUniformLocation(b,"u_offsetScaleMatrix");this.ct=a.getUniformLocation(b,"u_opacity");this.dt=a.getUniformLocation(b,"u_projectionMatrix");this.Sp=a.getAttribLocation(b,"a_offsets");this.Tp=a.getAttribLocation(b,"a_opacity");this.Df=a.getAttribLocation(b,"a_position");this.Up=a.getAttribLocation(b,"a_rotateWithView");this.Ef=a.getAttribLocation(b,"a_texCoord")};function Tn(a,b){this.AA=void 0!==a?a:[];this.vI=void 0!==b?b:35044}Tn.prototype.L=function(){return this.AA};function Un(a,b){this.ga=a;this.Ab=b;this.zg={};this.ik={};this.Wj={};this.pr=this.qr=this.xl=this.yq=null;(this.Cj=0<=ae.indexOf("OES_element_index_uint"))&&b.getExtension("OES_element_index_uint");J(this.ga,"webglcontextlost",this.hi,this);J(this.ga,"webglcontextrestored",this.nr,this)}u(Un,ue);k=Un.prototype;
k.bindBuffer=function(a,b){var c=this.Ab,d=b.L(),e=String(q(b));if(e in this.zg)c.bindBuffer(a,this.zg[e].buffer);else{var f=c.createBuffer();c.bindBuffer(a,f);var g;34962==a?g=new Float32Array(d):34963==a?g=this.Cj?new Uint32Array(d):new Uint16Array(d):Oa();c.bufferData(a,g,b.vI);this.zg[e]={oJ:b,buffer:f}}};k.deleteBuffer=function(a){var b=this.Ab;a=String(q(a));var c=this.zg[a];b.isContextLost()||b.deleteBuffer(c.buffer);delete this.zg[a]};
k.Ca=function(){te(this.ga);var a=this.Ab;if(!a.isContextLost()){for(var b in this.zg)a.deleteBuffer(this.zg[b].buffer);for(b in this.Wj)a.deleteProgram(this.Wj[b]);for(b in this.ik)a.deleteShader(this.ik[b]);a.deleteFramebuffer(this.xl);a.deleteRenderbuffer(this.pr);a.deleteTexture(this.qr)}};
function Vn(a){if(!a.xl){var b=a.Ab,c=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,c);var d=Wn(b,1,1),e=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,e);b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,1,1);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,d,0);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,e);b.bindTexture(b.TEXTURE_2D,null);b.bindRenderbuffer(b.RENDERBUFFER,null);b.bindFramebuffer(b.FRAMEBUFFER,null);a.xl=
c;a.qr=d;a.pr=e}return a.xl}function Xn(a,b){var c=String(q(b));if(c in a.ik)return a.ik[c];var d=a.Ab,e=d.createShader(b.T());d.shaderSource(e,b.v());d.compileShader(e);return a.ik[c]=e}function Yn(a,b,c){var d=q(b)+"/"+q(c);if(d in a.Wj)return a.Wj[d];var e=a.Ab,f=e.createProgram();e.attachShader(f,Xn(a,b));e.attachShader(f,Xn(a,c));e.linkProgram(f);return a.Wj[d]=f}k.hi=function(){he(this.zg);he(this.ik);he(this.Wj);this.pr=this.qr=this.xl=this.yq=null};k.nr=function(){};
k.useProgram=function(a){if(a==this.yq)return!1;this.Ab.useProgram(a);this.yq=a;return!0};function Zn(a,b,c){var d=a.createTexture();a.bindTexture(a.TEXTURE_2D,d);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);void 0!==b&&a.texParameteri(3553,10242,b);void 0!==c&&a.texParameteri(3553,10243,c);return d}function Wn(a,b,c){var d=Zn(a,void 0,void 0);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null);return d}
function $n(a,b){var c=Zn(a,33071,33071);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b);return c};function ao(a,b){this.We=this.Ve=void 0;this.nc=bf(b);this.ir=[];this.yl=[];this.ef=void 0;this.ni=[];this.ki=[];this.mi=this.li=void 0;this.ed=[];this.Vh=this.eo=null;this.Ud=void 0;this.pF=Kd();this.qF=Kd();this.lf=this.kf=void 0;this.VF=Kd();this.Zc=this.pc=this.Bd=void 0;this.Vs=[];this.zl=[];this.Ma=[];this.Cp=null;this.Re=[];this.mp=[];this.Gd=void 0}u(ao,zi);k=ao.prototype;
k.Hn=function(a){var b=this.Cp,c=this.eo,d=this.Vs,e=this.zl,f=a.Ab;return function(){if(!f.isContextLost()){var g,h;g=0;for(h=d.length;g<h;++g)f.deleteTexture(d[g]);g=0;for(h=e.length;g<h;++g)f.deleteTexture(e[g])}a.deleteBuffer(b);a.deleteBuffer(c)}};
k.Wk=function(a,b,c,d){for(var e=this.Ve,f=this.We,g=this.ef,h=this.li,l=this.mi,n=this.Ud,r=this.kf,t=this.lf,v=this.Bd?1:0,x=this.pc,y=this.Zc,B=this.Gd,E=Math.cos(x),x=Math.sin(x),I=this.ed.length,w=this.Ma.length,A,G,O,K,N;b<c;b+=d)K=a[b]-this.nc[0],N=a[b+1]-this.nc[1],A=w/8,G=-y*e,O=-y*(g-f),this.Ma[w++]=K,this.Ma[w++]=N,this.Ma[w++]=G*E-O*x,this.Ma[w++]=G*x+O*E,this.Ma[w++]=r/l,this.Ma[w++]=(t+g)/h,this.Ma[w++]=n,this.Ma[w++]=v,G=y*(B-e),O=-y*(g-f),this.Ma[w++]=K,this.Ma[w++]=N,this.Ma[w++]=
G*E-O*x,this.Ma[w++]=G*x+O*E,this.Ma[w++]=(r+B)/l,this.Ma[w++]=(t+g)/h,this.Ma[w++]=n,this.Ma[w++]=v,G=y*(B-e),O=y*f,this.Ma[w++]=K,this.Ma[w++]=N,this.Ma[w++]=G*E-O*x,this.Ma[w++]=G*x+O*E,this.Ma[w++]=(r+B)/l,this.Ma[w++]=t/h,this.Ma[w++]=n,this.Ma[w++]=v,G=-y*e,O=y*f,this.Ma[w++]=K,this.Ma[w++]=N,this.Ma[w++]=G*E-O*x,this.Ma[w++]=G*x+O*E,this.Ma[w++]=r/l,this.Ma[w++]=t/h,this.Ma[w++]=n,this.Ma[w++]=v,this.ed[I++]=A,this.ed[I++]=A+1,this.ed[I++]=A+2,this.ed[I++]=A,this.ed[I++]=A+2,this.ed[I++]=A+
3;return w};k.Iq=function(a,b){this.Re.push(this.ed.length);this.mp.push(b);b=a.s;this.Wk(b,0,b.length,a.W)};k.Dg=function(a,b){this.Re.push(this.ed.length);this.mp.push(b);b=a.s;this.Wk(b,0,b.length,a.W)};
k.finish=function(a){var b=a.Ab;this.ir.push(this.ed.length);this.yl.push(this.ed.length);this.Cp=new Tn(this.Ma);a.bindBuffer(34962,this.Cp);this.eo=new Tn(this.ed);a.bindBuffer(34963,this.eo);a={};bo(this.Vs,this.ni,a,b);bo(this.zl,this.ki,a,b);this.ef=this.We=this.Ve=void 0;this.ki=this.ni=null;this.mi=this.li=void 0;this.ed=null;this.Zc=this.pc=this.Bd=this.lf=this.kf=this.Ud=void 0;this.Ma=null;this.Gd=void 0};
function bo(a,b,c,d){var e,f,g,h=b.length;for(g=0;g<h;++g)e=b[g],f=q(e).toString(),f in c?e=c[f]:(e=$n(d,e),c[f]=e),a[g]=e}
k.te=function(a,b,c,d,e,f,g,h,l,n,r){f=a.Ab;a.bindBuffer(34962,this.Cp);a.bindBuffer(34963,this.eo);var t=Qn.Fg(),v=Rn.Fg(),v=Yn(a,t,v);this.Vh?t=this.Vh:this.Vh=t=new Sn(f,v);a.useProgram(v);f.enableVertexAttribArray(t.Df);f.vertexAttribPointer(t.Df,2,5126,!1,32,0);f.enableVertexAttribArray(t.Sp);f.vertexAttribPointer(t.Sp,2,5126,!1,32,8);f.enableVertexAttribArray(t.Ef);f.vertexAttribPointer(t.Ef,2,5126,!1,32,16);f.enableVertexAttribArray(t.Tp);f.vertexAttribPointer(t.Tp,1,5126,!1,32,24);f.enableVertexAttribArray(t.Up);
f.vertexAttribPointer(t.Up,1,5126,!1,32,28);v=this.VF;gj(v,0,0,2/(c*e[0]),2/(c*e[1]),-d,-(b[0]-this.nc[0]),-(b[1]-this.nc[1]));b=this.qF;c=2/e[0];e=2/e[1];Md(b);b[0]=c;b[5]=e;b[10]=1;b[15]=1;e=this.pF;Md(e);0!==d&&Qd(e,-d);f.uniformMatrix4fv(t.dt,!1,v);f.uniformMatrix4fv(t.kI,!1,b);f.uniformMatrix4fv(t.jI,!1,e);f.uniform1f(t.ct,g);var x;if(void 0===l)co(this,f,a,h,this.Vs,this.ir);else{if(n)a:{d=a.Cj?5125:5123;a=a.Cj?4:2;e=this.Re.length-1;for(g=this.zl.length-1;0<=g;--g)for(f.bindTexture(3553,this.zl[g]),
n=0<g?this.yl[g-1]:0,b=this.yl[g];0<=e&&this.Re[e]>=n;){x=this.Re[e];c=this.mp[e];v=q(c).toString();if(void 0===h[v]&&c.l()&&(void 0===r||ef(r,c.l().Z()))&&(f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT),f.drawElements(4,b-x,d,x*a),b=l(c))){h=b;break a}b=x;e--}h=void 0}else f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT),co(this,f,a,h,this.zl,this.yl),h=(h=l(null))?h:void 0;x=h}f.disableVertexAttribArray(t.Df);f.disableVertexAttribArray(t.Sp);f.disableVertexAttribArray(t.Ef);f.disableVertexAttribArray(t.Tp);
f.disableVertexAttribArray(t.Up);return x};
function co(a,b,c,d,e,f){var g=c.Cj?5125:5123;c=c.Cj?4:2;if(je(d)){var h;a=0;d=e.length;for(h=0;a<d;++a){b.bindTexture(3553,e[a]);var l=f[a];b.drawElements(4,l-h,g,h*c);h=l}}else{h=0;var n,l=0;for(n=e.length;l<n;++l){b.bindTexture(3553,e[l]);for(var r=0<l?f[l-1]:0,t=f[l],v=r;h<a.Re.length&&a.Re[h]<=t;){var x=q(a.mp[h]).toString();void 0!==d[x]?(v!==r&&b.drawElements(4,r-v,g,v*c),r=v=h===a.Re.length-1?t:a.Re[h+1]):r=h===a.Re.length-1?t:a.Re[h+1];h++}v!==r&&b.drawElements(4,r-v,g,v*c)}}}
k.lm=function(a){var b=a.bl(),c=a.xa(1),d=a.fl(),e=a.el(1);a.Yv();var f=a.hl(),g=a.ge(),h=a.Bd,l=a.Vb(),n=a.ja();a=a.gb();var r;0===this.ni.length?this.ni.push(c):(r=this.ni[this.ni.length-1],q(r)!=q(c)&&(this.ir.push(this.ed.length),this.ni.push(c)));0===this.ki.length?this.ki.push(e):(r=this.ki[this.ki.length-1],q(r)!=q(e)&&(this.yl.push(this.ed.length),this.ki.push(e)));this.Ve=b[0];this.We=b[1];this.ef=n[1];this.li=d[1];this.mi=d[0];this.Ud=f;this.kf=g[0];this.lf=g[1];this.pc=l;this.Bd=h;this.Zc=
a;this.Gd=n[0]};function eo(a,b,c){this.Ao=b;this.at=a;this.se=c;this.fg={}}k=eo.prototype;k.Hn=function(a){var b=[],c;for(c in this.fg)b.push(this.fg[c].Hn(a));return function(){for(var a=b.length,c,f=0;f<a;f++)c=b[f].apply(this,arguments);return c}};k.finish=function(a){for(var b in this.fg)this.fg[b].finish(a)};k.dd=function(a,b){a=this.fg[b];void 0===a&&(a=new fo[b](this.at,this.Ao),this.fg[b]=a);return a};k.fd=function(){return je(this.fg)};
k.te=function(a,b,c,d,e,f,g,h){var l,n,r;l=0;for(n=Cm.length;l<n;++l)r=this.fg[Cm[l]],void 0!==r&&r.te(a,b,c,d,e,f,g,h,void 0,!1)};k.zs=function(a,b,c,d,e,f,g,h,l,n,r){var t,v;for(t=Cm.length-1;0<=t;--t)if(v=this.fg[Cm[t]],void 0!==v&&(v=v.te(a,b,c,d,e,f,g,h,l,n,r)))return v};
k.Ob=function(a,b,c,d,e,f,g,h,l,n){var r=b.Ab;r.bindFramebuffer(r.FRAMEBUFFER,Vn(b));var t;void 0!==this.se&&(t=Ne(Te(a),d*this.se));return this.zs(b,a,d,e,go,g,h,l,function(a){var b=new Uint8Array(4);r.readPixels(0,0,1,1,r.RGBA,r.UNSIGNED_BYTE,b);if(0<b[3]&&(a=n(a)))return a},!0,t)};var fo={Image:ao},go=[1,1];function ho(){this.Sb="precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform float u_opacity;\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_texture, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  gl_FragColor.a = texColor.a * u_opacity;\n}\n"}u(ho,On);ca(ho);
function io(){this.Sb="varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform mat4 u_texCoordMatrix;\nuniform mat4 u_projectionMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0., 1.);\n  v_texCoord = (u_texCoordMatrix * vec4(a_texCoord, 0., 1.)).st;\n}\n\n\n"}u(io,Pn);ca(io);
function jo(a,b){this.ct=a.getUniformLocation(b,"u_opacity");this.dt=a.getUniformLocation(b,"u_projectionMatrix");this.lI=a.getUniformLocation(b,"u_texCoordMatrix");this.et=a.getUniformLocation(b,"u_texture");this.Df=a.getAttribLocation(b,"a_position");this.Ef=a.getAttribLocation(b,"a_texCoord")};function ko(a,b){jj.call(this,b);this.Yf=a;this.BA=new Tn([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);this.Dn=this.ye=null;this.En=void 0;this.Ts=Id();this.Rx=Kd();this.Vh=null}u(ko,jj);
ko.prototype.bindFramebuffer=function(a,b){var c=this.Yf.Ab;if(void 0===this.En||this.En!=b){var d=function(a,b,c){a.isContextLost()||(a.deleteFramebuffer(b),a.deleteTexture(c))}.bind(null,c,this.Dn,this.ye);a.Oe.push(d);a=Wn(c,b,b);d=c.createFramebuffer();c.bindFramebuffer(36160,d);c.framebufferTexture2D(36160,36064,3553,a,0);this.ye=a;this.Dn=d;this.En=b}else c.bindFramebuffer(36160,this.Dn)};
ko.prototype.Kf=function(a,b,c){this.$b("precompose",c,a);c.bindBuffer(34962,this.BA);var d=c.Ab,e=ho.Fg(),f=io.Fg(),e=Yn(c,e,f);this.Vh?f=this.Vh:this.Vh=f=new jo(d,e);c.useProgram(e)&&(d.enableVertexAttribArray(f.Df),d.vertexAttribPointer(f.Df,2,5126,!1,16,0),d.enableVertexAttribArray(f.Ef),d.vertexAttribPointer(f.Ef,2,5126,!1,16,8),d.uniform1i(f.et,0));d.uniformMatrix4fv(f.lI,!1,this.Ts);d.uniformMatrix4fv(f.dt,!1,this.Rx);d.uniform1f(f.ct,b.opacity);d.bindTexture(3553,this.ye);d.drawArrays(5,
0,4);this.$b("postcompose",c,a)};ko.prototype.$b=function(a,b,c){b=this.xb();b.hasListener(a)&&b.dispatchEvent(new Ai(a,b,0,c,null))};ko.prototype.hi=function(){this.Dn=this.ye=null;this.En=void 0};function lo(a,b){ko.call(this,a,b);this.aa=null}u(lo,ko);function mo(a,b){b=b.xa();return $n(a.Yf.Ab,b)}lo.prototype.Ob=function(a,b,c,d){var e=this.xb();return e.v().Ob(a,b.ia.ca,b.ia.rotation,b.Ni,function(a){return c.call(d,a,e)})};
lo.prototype.Pe=function(a,b){var c=this.Yf.Ab,d=a.hb,e=a.ia,f=e.qa,g=e.ca,h=e.rotation,l=this.aa,n=this.ye,r=this.xb().v(),t=a.qb,v=a.P;void 0!==b.P&&(v=df(v,b.P));t[0]||t[1]||Ye(v)||(b=r.xa(v,g,d,e.ea))&&lj(this,b)&&(l=b,n=mo(this,b),this.ye&&(c=function(a,b){a.isContextLost()||a.deleteTexture(b)}.bind(null,c,this.ye),a.Oe.push(c)));l&&(c=this.Yf.getContext().ga,no(this,c.width,c.height,d,f,g,h,l.Z()),d=this.Ts,Md(d),Pd(d,1,-1),Od(d,0,-1),this.aa=l,this.ye=n,nj(a.Na,l.be),oj(a,r));return!0};
function no(a,b,c,d,e,f,g,h){b*=f;c*=f;a=a.Rx;Md(a);Pd(a,2*d/b,2*d/c);Qd(a,-g);Od(a,h[0]-e[0],h[1]-e[1]);Pd(a,(h[2]-h[0])/2,(h[3]-h[1])/2);Od(a,1,1)};function oo(){this.Sb="precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  gl_FragColor = texture2D(u_texture, v_texCoord);\n}\n"}u(oo,On);ca(oo);function po(){this.Sb="varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nuniform vec4 u_tileOffset;\n\nvoid main(void) {\n  gl_Position = vec4(a_position * u_tileOffset.xy + u_tileOffset.zw, 0., 1.);\n  v_texCoord = a_texCoord;\n}\n\n\n"}u(po,Pn);ca(po);
function qo(a,b){this.et=a.getUniformLocation(b,"u_texture");this.mI=a.getUniformLocation(b,"u_tileOffset");this.Df=a.getAttribLocation(b,"a_position");this.Ef=a.getAttribLocation(b,"a_texCoord")};function ro(a,b){ko.call(this,a,b);this.VB=oo.Fg();this.BI=po.Fg();this.Xf=null;this.ay=new Tn([0,0,0,1,1,0,1,1,0,1,0,0,1,1,1,0]);this.ws=this.Yo=null;this.Ib=-1;this.Ri=[0,0]}u(ro,ko);ro.prototype.Ca=function(){this.Yf.getContext().deleteBuffer(this.ay);ro.cb.Ca.call(this)};ro.prototype.mn=function(a,b,c){var d=this.Yf;return function(e,f){return bj(a,b,e,f,function(a){var b=d.Fd.qd(a.getKey());b&&(c[e]||(c[e]={}),c[e][a.yb.toString()]=a);return b})}};
ro.prototype.hi=function(){ro.cb.hi.call(this);this.Xf=null};
ro.prototype.Pe=function(a,b,c){var d=this.Yf,e=c.Ab,f=a.ia,g=f.ea,h=this.xb(),l=h.v(),n=l.Ie(g),r=Vi(n,f.ca),t=n.na(r),v=dj(l,r,a.hb,g),x=v[0]/Ji(Ui(n,r),this.Ri)[0],y=t/x,B=l.Kn(g),E=f.qa,I;t==f.ca?(E=qj(E,t,a.size),I=cf(E,t,f.rotation,a.size)):I=a.P;t=Ri(n,I,t);if(this.Yo&&this.Yo.equals(t)&&this.Ib==l.bb)y=this.ws;else{var w=t.ja(),A=Math.pow(2,Math.ceil(Math.log(Math.max(w[0]*v[0],w[1]*v[1]))/Math.LN2)),w=y*A,G=n.ge(r),O=G[0]+t.Yb*v[0]*y,y=G[1]+t.lc*v[1]*y,y=[O,y,O+w,y+w];this.bindFramebuffer(a,
A);e.viewport(0,0,A,A);e.clearColor(0,0,0,0);e.clear(16384);e.disable(3042);A=Yn(c,this.VB,this.BI);c.useProgram(A);this.Xf||(this.Xf=new qo(e,A));c.bindBuffer(34962,this.ay);e.enableVertexAttribArray(this.Xf.Df);e.vertexAttribPointer(this.Xf.Df,2,5126,!1,16,0);e.enableVertexAttribArray(this.Xf.Ef);e.vertexAttribPointer(this.Xf.Ef,2,5126,!1,16,8);e.uniform1i(this.Xf.et,0);c={};c[r]={};var K=this.mn(l,g,c),N=pm(h),A=!0,O=Le(),ba=new ih(0,0,0,0),P,da,ia;for(da=t.Yb;da<=t.cc;++da)for(ia=t.lc;ia<=t.tc;++ia){G=
sj(l,r,da,ia,x,g);if(void 0!==b.P&&(P=Oi(n,G.yb,O),!ef(P,b.P)))continue;P=G.Qa();P=2==P||4==P||3==P&&!N;!P&&G.Wb&&(G=G.Wb);P=G.Qa();if(2==P){if(d.Fd.qd(G.getKey())){c[r][G.yb.toString()]=G;continue}}else if(4==P||3==P&&!N)continue;A=!1;P=Ni(n,G.yb,K,ba,O);P||(G=Qi(n,G.yb,ba,O))&&K(r+1,G)}b=Object.keys(c).map(Number);b.sort(Hg);for(var K=new Float32Array(4),oa,Z,Da,N=0,ba=b.length;N<ba;++N)for(oa in Z=c[b[N]],Z)G=Z[oa],P=Oi(n,G.yb,O),da=2*(P[2]-P[0])/w,ia=2*(P[3]-P[1])/w,Da=2*(P[0]-y[0])/w-1,P=2*(P[1]-
y[1])/w-1,Hd(K,da,ia,Da,P),e.uniform4fv(this.Xf.mI,K),so(d,G,v,B*x),e.drawArrays(5,0,4);A?(this.Yo=t,this.ws=y,this.Ib=l.bb):(this.ws=this.Yo=null,this.Ib=-1,a.animate=!0)}pj(a.Gm,l,r,t);var nb=d.ym;rj(a,l,n,x,g,I,r,h.get("preload"),function(a){var b;(b=2!=a.Qa()||d.Fd.qd(a.getKey()))||(b=a.getKey()in nb.Yj);b||nb.enqueue([a,Ti(n,a.yb),n.na(a.yb[0]),v,B*x])},this);mj(a,l);oj(a,l);e=this.Ts;Md(e);Od(e,(E[0]-y[0])/(y[2]-y[0]),(E[1]-y[1])/(y[3]-y[1]));0!==f.rotation&&Qd(e,f.rotation);Pd(e,a.size[0]*
f.ca/(y[2]-y[0]),a.size[1]*f.ca/(y[3]-y[1]));Od(e,-.5,-.5);return!0};function to(a,b){ko.call(this,a,b);this.Ic=!1;this.Ib=-1;this.gh=NaN;this.eh=Le();this.Gr=this.Cb=this.fh=null}u(to,ko);k=to.prototype;k.Kf=function(a,b,c){this.Gr=b;var d=a.ia,e=this.Cb;e&&!e.fd()&&e.te(c,d.qa,d.ca,d.rotation,a.size,a.hb,b.opacity,b.Kl?a.Ni:{})};k.Ca=function(){var a=this.Cb;if(a){var b=this.Yf.getContext();a.Hn(b)();this.Cb=null}to.cb.Ca.call(this)};
k.Ob=function(a,b,c,d){if(this.Cb&&this.Gr){var e=this.Yf.getContext(),f=b.ia,g=this.xb(),h={};return this.Cb.Ob(a,e,f.qa,f.ca,f.rotation,b.size,b.hb,this.Gr.opacity,{},function(a){var b=q(a).toString();if(!(b in h))return h[b]=!0,c.call(d,a,g)})}};k.Lg=function(){kj(this)};
k.Pe=function(a,b,c){function d(a){var b,c=a.kd;c?b=c.call(a,n):(c=e.kd)&&(b=c(a,n));b&&(a=this.dm(a,n,r,b,v),this.Ic=this.Ic||a)}var e=this.xb();b=e.v();nj(a.Na,b.be);oj(a,b);var f=a.qb[0],g=a.qb[1],h=e.it,l=e.jt;if(!this.Ic&&!h&&f||!l&&g)return!0;var g=a.P,h=a.ia,f=h.ea,n=h.ca,r=a.hb,h=e.bb,t=e.se,l=e.get("renderOrder");void 0===l&&(l=Um);g=Ne(g,t*n);if(!this.Ic&&this.gh==n&&this.Ib==h&&this.fh==l&&Pe(this.eh,g))return!0;this.Cb&&a.Oe.push(this.Cb.Hn(c));this.Ic=!1;var v=new eo(.5*n/r,g,e.se);Ch(b,
g,n,f);if(l){var x=[];Ah(b,g,function(a){x.push(a)},this);x.sort(l);x.forEach(d,this)}else Ah(b,g,d,this);v.finish(c);this.gh=n;this.Ib=h;this.fh=l;this.eh=g;this.Cb=v;return!0};k.dm=function(a,b,c,d,e){if(!d)return!1;var f=!1;if(Array.isArray(d))for(var g=0,h=d.length;g<h;++g)f=Wm(e,a,d[g],Vm(b,c),this.Lg,this)||f;else f=Wm(e,a,d,Vm(b,c),this.Lg,this)||f;return f};function uo(a,b){xj.call(this,0,b);this.ga=document.createElement("CANVAS");this.ga.style.width="100%";this.ga.style.height="100%";this.ga.className="ol-unselectable";Dc(a,this.ga,0);this.Tu=this.Uu=0;this.Vu=Vf();this.ab=!0;this.Ab=ag(this.ga,{antialias:!0,depth:!1,failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!1,stencil:!0});this.Xa=new Un(this.ga,this.Ab);J(this.ga,"webglcontextlost",this.hi,this);J(this.ga,"webglcontextrestored",this.nr,this);this.Fd=new Ei;this.Zh=null;this.ym=new Cj(function(a){var b=
a[1];a=a[2];var c=b[0]-this.Zh[0],b=b[1]-this.Zh[1];return 65536*Math.log(a)+Math.sqrt(c*c+b*b)/a}.bind(this),function(a){return a[0].getKey()});this.jE=function(){if(!this.ym.fd()){Fj(this.ym);var a=this.ym.dequeue();so(this,a[0],a[3],a[4])}return!1}.bind(this);this.wm=0;vo(this)}u(uo,xj);
function so(a,b,c,d){var e=a.Ab,f=b.getKey();if(a.Fd.qd(f))a=a.Fd.get(f),e.bindTexture(3553,a.ye),9729!=a.Yw&&(e.texParameteri(3553,10240,9729),a.Yw=9729),9729!=a.nx&&(e.texParameteri(3553,10240,9729),a.nx=9729);else{var g=e.createTexture();e.bindTexture(3553,g);if(0<d){var h=a.Vu.canvas,l=a.Vu;a.Uu!==c[0]||a.Tu!==c[1]?(h.width=c[0],h.height=c[1],a.Uu=c[0],a.Tu=c[1]):l.clearRect(0,0,c[0],c[1]);l.drawImage(b.xa(),d,d,c[0],c[1],0,0,c[0],c[1]);e.texImage2D(3553,0,6408,6408,5121,h)}else e.texImage2D(3553,
0,6408,6408,5121,b.xa());e.texParameteri(3553,10240,9729);e.texParameteri(3553,10241,9729);e.texParameteri(3553,10242,33071);e.texParameteri(3553,10243,33071);a.Fd.set(f,{ye:g,Yw:9729,nx:9729})}}k=uo.prototype;k.wq=function(a){if(a instanceof nm)return new lo(this,a);if(a instanceof om)return new ro(this,a);if(a instanceof qm)return new to(this,a);Oa("unexpected layer configuration");return null};k.$b=function(a,b){var c=this.g();c.hasListener(a)&&c.dispatchEvent(new Ai(a,c,0,b,null))};
k.Ca=function(){var a=this.Ab;a.isContextLost()||this.Fd.forEach(function(b){b&&a.deleteTexture(b.ye)});this.Xa.Id();uo.cb.Ca.call(this)};k.PB=function(a,b){a=this.Ab;for(var c;1024<this.Fd.Eg()-this.wm;){if(c=this.Fd.Td.wh)a.deleteTexture(c.ye);else if(+this.Fd.Td.Og==b.index)break;else--this.wm;this.Fd.pop()}};k.getContext=function(){return this.Xa};k.T=function(){return"webgl"};k.hi=function(a){a.preventDefault();this.Fd.clear();this.wm=0;a=this.ke;for(var b in a)a[b].hi()};
k.nr=function(){vo(this);this.g().ka()};function vo(a){a=a.Ab;a.activeTexture(33984);a.blendFuncSeparate(770,771,1,771);a.disable(2884);a.disable(2929);a.disable(3089);a.disable(2960)}
k.Wo=function(a){var b=this.getContext(),c=this.Ab;if(c.isContextLost())return!1;if(!a)return this.ab&&(Yc(this.ga,!1),this.ab=!1),!1;this.Zh=a.focus;this.Fd.set((-a.index).toString(),null);++this.wm;this.$b("precompose",a);var d=[],e=a.ri;Ng(e);var f=a.ia.ca,g,h,l,n;g=0;for(h=e.length;g<h;++g)n=e[g],Ci(n,f)&&"ready"==n.Ns&&(l=Aj(this,n.layer),l.Pe(a,n,b)&&d.push(n));e=a.size[0]*a.hb;f=a.size[1]*a.hb;if(this.ga.width!=e||this.ga.height!=f)this.ga.width=e,this.ga.height=f;c.bindFramebuffer(36160,null);
c.clearColor(0,0,0,0);c.clear(16384);c.enable(3042);c.viewport(0,0,this.ga.width,this.ga.height);g=0;for(h=d.length;g<h;++g)n=d[g],l=Aj(this,n.layer),l.Kf(a,n,b);this.ab||(Yc(this.ga,!0),this.ab=!0);yj(a);1024<this.Fd.Eg()-this.wm&&a.Oe.push(this.PB.bind(this));this.ym.fd()||(a.Oe.push(this.jE),a.animate=!0);this.$b("postcompose",a);Bj(this,a);a.Oe.push(zj)};
k.Ob=function(a,b,c,d,e,f){var g;if(this.Ab.isContextLost())return!1;var h=b.ia,l=b.ri,n;for(n=l.length-1;0<=n;--n){g=l[n];var r=g.layer;if(Ci(g,h.ca)&&e.call(f,r)&&(g=Aj(this,r).Ob(a,b,c,d)))return g}};var wo=["canvas","webgl","dom"];
function xo(a){Ae.call(this);var b=yo(a);this.lE=void 0!==a.kE?a.kE:!1;this.nE=void 0!==a.mE?a.mE:!1;this.Ad=void 0!==a.hb?a.hb:gg;this.uE=b.Lj;this.Qt=function(){this.Kh=void 0;this.sG.call(this,Date.now())}.bind(this);this.bB=Id();this.EF=Id();this.WB=0;this.Kc=null;this.Ox=Le();this.no=this.Dp=null;this.Tb=document.createElement("DIV");this.Tb.className="ol-viewport"+(kg?" ol-touch":"");this.Tb.style.position="relative";this.Tb.style.overflow="hidden";this.Tb.style.width="100%";this.Tb.style.height=
"100%";this.Tb.style.msTouchAction="none";this.Tb.style.$J="none";this.Tl=document.createElement("DIV");this.Tl.className="ol-overlaycontainer";this.Tb.appendChild(this.Tl);this.Sl=document.createElement("DIV");this.Sl.className="ol-overlaycontainer-stopevent";a=["click","dblclick","mousedown","touchstart","mspointerdown",ti,"mousewheel","wheel"];for(var c=0,d=a.length;c<d;++c)J(this.Sl,a[c],ee);this.Tb.appendChild(this.Sl);this.ax=new li(this);for(var e in wi)J(this.ax,wi[e],this.hw,this);this.Bw=
b.Cl;this.Bl=null;J(this.Tb,"wheel",this.zj,this);J(this.Tb,"mousewheel",this.zj,this);this.kn=b.controls;this.Nc=b.Gj;this.Pc=b.Ul;this.Kx={};this.xs=new b.uG(this.Tb,this);this.Zh=null;this.Oo=[];this.Mx=[];this.fz=new Gj(this.SC.bind(this),this.GD.bind(this));this.Ms={};J(this,Ce("layergroup"),this.kD,this);J(this,Ce("view"),this.KD,this);J(this,Ce("size"),this.CD,this);J(this,Ce("target"),this.FD,this);this.Ac(b.values);this.kn.forEach(function(a){a.Ua(this)},this);J(this.kn,"add",function(a){a.element.Ua(this)},
this);J(this.kn,"remove",function(a){a.element.Ua(null)},this);this.Nc.forEach(function(a){a.Ua(this)},this);J(this.Nc,"add",function(a){a.element.Ua(this)},this);J(this.Nc,"remove",function(a){a.element.Ua(null)},this);this.Pc.forEach(this.Mt,this);J(this.Pc,"add",function(a){this.Mt(a.element)},this);J(this.Pc,"remove",function(a){var b=a.element.Fb();void 0!==b&&delete this.Kx[b.toString()];a.element.Ua(null)},this)}u(xo,Ae);k=xo.prototype;k.Dc=function(a){this.cf().push(a)};k.Ub=function(a){this.Nc.push(a)};
k.rb=function(a){zo(this).getLayers().push(a)};k.Ff=function(a){this.Pc.push(a)};k.Mt=function(a){var b=a.Fb();void 0!==b&&(this.Kx[b.toString()]=a);a.Ua(this)};k.$c=function(a){this.ka();Array.prototype.push.apply(this.Oo,arguments)};k.Ca=function(){this.ax.Id();this.xs.Id();se(this.Tb,"wheel",this.zj,this);se(this.Tb,"mousewheel",this.zj,this);void 0!==this.Kg&&(ce.removeEventListener("resize",this.Kg,!1),this.Kg=void 0);this.Kh&&(ce.cancelAnimationFrame(this.Kh),this.Kh=void 0);this.om(null);xo.cb.Ca.call(this)};
function Ao(a,b,c,d,e){if(a.Kc)return b=a.Kd(b),a.xs.Ob(b,a.Kc,c,void 0!==d?d:null,void 0!==e?e:Ie,null)}function ji(a,b){a=a.Tb.getBoundingClientRect();b=b.changedTouches?b.changedTouches[0]:b;return[b.clientX-a.left,b.clientY-a.top]}k.nl=function(){return this.get("target")};function Bo(a){a=a.nl();return void 0!==a?wc(document,a):null}k.Kd=function(a){var b=this.Kc;return b?(a=a.slice(),ij(b.Lx,a,a)):null};k.cf=function(){return this.kn};function zo(a){return a.get("layergroup")}k.getLayers=function(){return zo(this).getLayers()};
function yl(a,b){return(a=a.Kc)?(b=b.slice(0,2),ij(a.jj,b,b)):null}k.ja=function(){return this.get("size")};function H(a){return a.get("view")}k.SC=function(a,b,c,d){var e=this.Kc;if(!(e&&b in e.Lm&&e.Lm[b][a.yb.toString()]))return Infinity;a=c[0]-e.focus[0];c=c[1]-e.focus[1];return 65536*Math.log(d)+Math.sqrt(a*a+c*c)/d};k.zj=function(a,b){a=new ii(b||a.type,this,a);this.hw(a)};
k.hw=function(a){if(this.Kc){this.Zh=a.zb;a.He=this.Kc;var b=this.Nc.L(),c;if(!1!==this.dispatchEvent(a))for(c=b.length-1;0<=c;c--){var d=b[c];if(d.get("active")&&!d.handleEvent(a))break}}};
k.BD=function(){var a=this.Kc,b=this.fz;if(!b.fd()){var c=16,d=c;if(a){var e=a.qb;e[0]&&(c=this.lE?8:0,d=2);e[1]&&(c=this.nE?8:0,d=2)}if(b.sp<c){Fj(b);for(var e=0,f,g;b.sp<c&&e<d&&0<b.Eg();)f=b.dequeue()[0],g=f.getKey(),0!==f.Qa()||g in b.rp||(b.rp[g]=!0,++b.sp,++e,f.load())}}b=this.Mx;c=0;for(d=b.length;c<d;++c)b[c](this,a);b.length=0};k.CD=function(){this.ka()};
k.FD=function(){var a;this.nl()&&(a=Bo(this));if(this.Bl){for(var b=0,c=this.Bl.length;b<c;++b)me(this.Bl[b]);this.Bl=null}a?(a.appendChild(this.Tb),a=this.Bw?this.Bw:a,this.Bl=[J(a,"keydown",this.zj,this),J(a,"keypress",this.zj,this)],this.Kg||(this.Kg=this.yf.bind(this),ce.addEventListener("resize",this.Kg,!1))):(Ec(this.Tb),void 0!==this.Kg&&(ce.removeEventListener("resize",this.Kg,!1),this.Kg=void 0));this.yf()};k.GD=function(){this.ka()};k.LD=function(){this.ka()};
k.KD=function(){this.Dp&&(me(this.Dp),this.Dp=null);var a=H(this);a&&(this.Dp=J(a,"propertychange",this.LD,this));this.ka()};k.lD=function(){this.ka()};k.mD=function(){this.ka()};k.kD=function(){this.no&&(this.no.forEach(me),this.no=null);var a=zo(this);a&&(this.no=[J(a,"propertychange",this.mD,this),J(a,"change",this.lD,this)]);this.ka()};k.ka=function(){void 0===this.Kh&&(this.Kh=ce.requestAnimationFrame(this.Qt))};k.ak=function(a){return zo(this).getLayers().remove(a)};
k.sG=function(a){var b,c,d,e=this.ja(),f=H(this),g=Le(),h=null;if(void 0!==e&&0<e[0]&&0<e[1]&&f&&f.io()){var h=Gk(f,this.Kc?this.Kc.qb:void 0),l=zo(this).Wq(),n={};b=0;for(c=l.length;b<c;++b)n[q(l[b].layer)]=l[b];d=f.Qa();h={animate:!1,Na:{},jj:this.bB,P:g,focus:this.Zh?this.Zh:d.qa,index:this.WB++,Fl:n,ri:l,Lj:ge({},this.uE),hb:this.Ad,Lx:this.EF,Oe:[],size:e,Ni:this.Ms,LH:this.fz,time:a,Gm:{},ia:d,qb:h,Lm:{}}}if(h){a=this.Oo;b=e=0;for(c=a.length;b<c;++b)f=a[b],f(this,h)&&(a[e++]=f);a.length=e;h.P=
cf(d.qa,d.ca,d.rotation,h.size,g)}this.Kc=h;this.xs.Wo(h);h&&(h.animate&&this.ka(),Array.prototype.push.apply(this.Mx,h.Oe),0!==this.Oo.length||h.qb[0]||h.qb[1]||Ue(h.P,this.Ox)||(this.dispatchEvent(new Dh("moveend",this,h)),Oe(h.P,this.Ox)));this.dispatchEvent(new Dh("postrender",this,h));c=b=this.BD;this&&(c=qa(b,this));!ja(aa.setImmediate)||aa.Window&&aa.Window.prototype&&!lb("Edge")&&aa.Window.prototype.setImmediate==aa.setImmediate?(yb||(yb=zb()),yb(c)):aa.setImmediate(c)};
k.nm=function(a){this.set("size",a)};k.om=function(a){this.set("target",a)};k.lh=function(a){this.set("view",a)};k.Ny=function(a){a=q(a).toString();this.Ms[a]=!0;this.ka()};
k.yf=function(){var a=Bo(this);if(a){var b=vc(a),c=Eb&&a.currentStyle;if(c&&"CSS1Compat"==tc(b).Ze.compatMode&&"auto"!=c.width&&"auto"!=c.height&&!c.boxSizing)b=Zc(a,c.width,"width","pixelWidth"),a=Zc(a,c.height,"height","pixelHeight"),a=new sc(b,a);else{c=new sc(a.offsetWidth,a.offsetHeight);b=ad(a,"padding");if(!Eb||9<=Number(Pb))d=Uc(a,"borderLeftWidth"),e=Uc(a,"borderRightWidth"),f=Uc(a,"borderTopWidth"),a=Uc(a,"borderBottomWidth"),a=new Tc(parseFloat(f),parseFloat(e),parseFloat(a),parseFloat(d));
else var d=cd(a,"borderLeft"),e=cd(a,"borderRight"),f=cd(a,"borderTop"),a=cd(a,"borderBottom"),a=new Tc(f,e,a,d);a=new sc(c.width-a.left-b.left-b.right-a.right,c.height-a.top-b.top-b.bottom-a.bottom)}this.nm([a.width,a.height])}else this.nm(void 0)};k.nz=function(a){a=q(a).toString();delete this.Ms[a];this.ka()};
function yo(a){var b=null;void 0!==a.Cl&&(b="string"===typeof a.Cl?document.getElementById(a.Cl):a.Cl);var c={},d={};if(void 0===a.mb||"boolean"===typeof a.mb&&a.mb)d["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAHGAAABxgEXwfpGAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAhNQTFRF////AP//AICAgP//AFVVQECA////K1VVSbbbYL/fJ05idsTYJFtbbcjbJllmZszWWMTOIFhoHlNiZszTa9DdUcHNHlNlV8XRIVdiasrUHlZjIVZjaMnVH1RlIFRkH1RkH1ZlasvYasvXVsPQH1VkacnVa8vWIVZjIFRjVMPQa8rXIVVkXsXRsNveIFVkIFZlIVVj3eDeh6GmbMvXH1ZkIFRka8rWbMvXIFVkIFVjIFVkbMvWH1VjbMvWIFVlbcvWIFVla8vVIFVkbMvWbMvVH1VkbMvWIFVlbcvWIFVkbcvVbMvWjNPbIFVkU8LPwMzNIFVkbczWIFVkbsvWbMvXIFVkRnB8bcvW2+TkW8XRIFVkIlZlJVloJlpoKlxrLl9tMmJwOWd0Omh1RXF8TneCT3iDUHiDU8LPVMLPVcLPVcPQVsPPVsPQV8PQWMTQWsTQW8TQXMXSXsXRX4SNX8bSYMfTYcfTYsfTY8jUZcfSZsnUaIqTacrVasrVa8jTa8rWbI2VbMvWbcvWdJObdcvUdszUd8vVeJaee87Yfc3WgJyjhqGnitDYjaarldPZnrK2oNbborW5o9bbo9fbpLa6q9ndrL3ArtndscDDutzfu8fJwN7gwt7gxc/QyuHhy+HizeHi0NfX0+Pj19zb1+Tj2uXk29/e3uLg3+Lh3+bl4uXj4ufl4+fl5Ofl5ufl5ujm5+jmySDnBAAAAFp0Uk5TAAECAgMEBAYHCA0NDg4UGRogIiMmKSssLzU7PkJJT1JTVFliY2hrdHZ3foSFhYeJjY2QkpugqbG1tre5w8zQ09XY3uXn6+zx8vT09vf4+Pj5+fr6/P39/f3+gz7SsAAAAVVJREFUOMtjYKA7EBDnwCPLrObS1BRiLoJLnte6CQy8FLHLCzs2QUG4FjZ5GbcmBDDjxJBXDWxCBrb8aM4zbkIDzpLYnAcE9VXlJSWlZRU13koIeW57mGx5XjoMZEUqwxWYQaQbSzLSkYGfKFSe0QMsX5WbjgY0YS4MBplemI4BdGBW+DQ11eZiymfqQuXZIjqwyadPNoSZ4L+0FVM6e+oGI6g8a9iKNT3o8kVzNkzRg5lgl7p4wyRUL9Yt2jAxVh6mQCogae6GmflI8p0r13VFWTHBQ0rWPW7ahgWVcPm+9cuLoyy4kCJDzCm6d8PSFoh0zvQNC5OjDJhQopPPJqph1doJBUD5tnkbZiUEqaCnB3bTqLTFG1bPn71kw4b+GFdpLElKIzRxxgYgWNYc5SCENVHKeUaltHdXx0dZ8uBI1hJ2UUDgq82CM2MwKeibqAvSO7MCABq0wXEPiqWEAAAAAElFTkSuQmCC"]="http://openlayers.org/";
else{var e=a.mb;"string"===typeof e?d[e]="":e instanceof HTMLElement?d[q(e).toString()]=e:ka(e)&&(d[e.src]=e.href)}e=a.$a instanceof am?a.$a:new am({$a:a.$a});c.layergroup=e;c.target=a.target;c.view=void 0!==a.view?a.view:new Ek;var e=xj,f;void 0!==a.Zo?Array.isArray(a.Zo)?f=a.Zo:"string"===typeof a.Zo?f=[a.Zo]:Oa("Incorrect format for renderer option"):f=wo;var g,h;g=0;for(h=f.length;g<h;++g){var l=f[g];if("canvas"==l){if(ig){e=Fn;break}}else if("dom"==l){e=Mn;break}else if("webgl"==l&&bg){e=uo;
break}}void 0!==a.controls?f=Array.isArray(a.controls)?new Fe(a.controls.slice()):a.controls:(f={},g=new Fe,(void 0!==f.zoom?f.zoom:1)&&g.push(new Zk(f.fK)),(void 0!==f.rotate?f.rotate:1)&&g.push(new Xk(f.SJ)),(void 0!==f.attribution?f.attribution:1)&&g.push(new Pk(f.lJ)),f=g);g=void 0!==a.Gj?Array.isArray(a.Gj)?new Fe(a.Gj.slice()):a.Gj:$l();a=void 0!==a.Ul?Array.isArray(a.Ul)?new Fe(a.Ul.slice()):a.Ul:new Fe;return{controls:f,Gj:g,Cl:b,Lj:d,Ul:a,uG:e,values:c}}wf(fm);wf(mm);
mm.forEach(function(a){fm.forEach(function(b){Cf(a,b,gm);Cf(b,a,hm)})});xo.prototype.jd=function(a){C.log("Map.refreshWithTimestamp",this);this.getLayers().forEach(function(b){b.v().jd(a)})};xo.prototype.refreshWithTimestamp=xo.prototype.jd;Bi.prototype.jd=function(a){C.log("layer.refreshWithTimestamp",this);this.v().jd(a)};Bi.prototype.refreshWithTimestamp=Bi.prototype.jd;lh.prototype.jd=function(a){C.log("source.refreshWithTimestamp",this);if(this instanceof Co||this instanceof Do){var b=this.wc;b.TIMESTAMP=Date.now();this.updateParams(b);!0!==a&&this.refresh()}};
lh.prototype.refreshWithTimestamp=lh.prototype.jd;function Eo(a,b){b=b.da()[0];for(var c=0;c<b.length;c++)if(!a.Xe(b[c][0],b[c][1]))return!1;return!0};function Fo(a,b,c,d,e){Qg.call(this,a,b);this.xe=c;this.aa=new Image;null!==d&&(this.aa.crossOrigin=d);this.Tf={};this.Je=null;this.JH=e}u(Fo,Qg);k=Fo.prototype;k.Ca=function(){1==this.state&&this.qg();this.Wb&&this.Wb.Id();this.state=5;this.R();Fo.cb.Ca.call(this)};k.xa=function(a){if(void 0!==a){var b=q(a);if(b in this.Tf)return this.Tf[b];a=je(this.Tf)?this.aa:this.aa.cloneNode(!1);return this.Tf[b]=a}return this.aa};k.getKey=function(){return this.xe};k.Aj=function(){this.state=3;this.qg();this.R()};
k.tl=function(){this.state=this.aa.naturalWidth&&this.aa.naturalHeight?2:4;this.qg();this.R()};k.load=function(){0==this.state&&(this.state=1,this.R(),this.Je=[re(this.aa,"error",this.Aj,this),re(this.aa,"load",this.tl,this)],this.JH(this,this.xe))};k.qg=function(){this.Je.forEach(me);this.Je=null};function Go(a,b,c,d,e,f,g,h,l,n,r){Qg.call(this,e,0);this.rG=void 0!==r?r:!1;this.Ad=g;this.Sn=h;this.ga=null;this.an={};this.kp=b;this.op=d;this.Hp=f?f:e;this.nk=[];this.pk=null;this.lp=0;f=Oi(d,this.Hp);h=this.op.Z();e=this.kp.Z();f=h?df(f,h):f;if(0===Xe(f))this.state=4;else if((h=a.Z())&&(e=e?df(e,h):h),d=d.na(this.Hp[0]),d=dn(a,c,bf(f),d),!isFinite(d)||0>=d)this.state=4;else if(this.rk=new gn(a,c,f,e,d*(void 0!==n?n:.5)),0===this.rk.uh.length)this.state=4;else if(this.lp=Vi(b,d),c=jn(this.rk),
e&&(a.Ph?(c[1]=jf(c[1],e[1],e[3]),c[3]=jf(c[3],e[1],e[3])):c=df(c,e)),Xe(c))if(a=Pi(b,c,this.lp),100>a.Nd()*a.Ln()){for(b=a.Yb;b<=a.cc;b++)for(c=a.lc;c<=a.tc;c++)(n=l(this.lp,b,c,g))&&this.nk.push(n);0===this.nk.length&&(this.state=4)}else this.state=3;else this.state=4}u(Go,Qg);Go.prototype.Ca=function(){1==this.state&&(this.pk.forEach(me),this.pk=null);Go.cb.Ca.call(this)};
Go.prototype.xa=function(a){if(void 0!==a){var b=q(a);if(b in this.an)return this.an[b];a=je(this.an)?this.ga:this.ga.cloneNode(!1);return this.an[b]=a}return this.ga};
Go.prototype.em=function(){var a=[];this.nk.forEach(function(b){b&&2==b.Qa()&&a.push({P:Oi(this.kp,b.yb),Gb:b.xa()})},this);this.nk.length=0;if(0===a.length)this.state=3;else{var b=this.Hp[0],c=Ui(this.op,b),d=ha(c)?c:c[0],c=ha(c)?c:c[1],b=this.op.na(b),e=this.kp.na(this.lp),f=Oi(this.op,this.Hp);this.ga=fn(d,c,this.Ad,e,this.kp.Z(),b,f,this.rk,a,this.Sn,this.rG);this.state=2}this.R()};
Go.prototype.load=function(){if(0==this.state){this.state=1;this.R();var a=0;this.pk=[];this.nk.forEach(function(b){var c=b.Qa();if(0==c||1==c){a++;var d;d=J(b,"change",function(){var c=b.Qa();if(2==c||3==c||4==c)me(d),a--,0===a&&(this.pk.forEach(me),this.pk=null,this.em())},this);this.pk.push(d)}},this);this.nk.forEach(function(a){0==a.Qa()&&a.load()});0===a&&ce.setTimeout(this.em.bind(this),0)}};function Ho(a){Dn.call(this,{Na:a.Na,od:a.od,P:a.P,mb:a.mb,pe:a.pe,ea:a.ea,state:a.state,Db:a.Db,Sc:a.Sc?a.Sc:Io,mg:a.mg,uf:a.uf,url:a.url,Kb:a.Kb,Sa:a.Sa});this.crossOrigin=void 0!==a.crossOrigin?a.crossOrigin:null;this.xm=void 0!==a.xm?a.xm:Fo;this.Qi={};this.Ys={};this.vG=a.qf;this.tG=!1}u(Ho,Dn);k=Ho.prototype;k.Oh=function(){if(this.Zd.Oh())return!0;for(var a in this.Qi)if(this.Qi[a].Oh())return!0;return!1};
k.oj=function(a,b){a=this.ol(a);this.Zd.oj(this.Zd==a?b:{});for(var c in this.Qi){var d=this.Qi[c];d.oj(d==a?b:{})}};k.Kn=function(a){return this.D()&&a&&!Hf(this.D(),a)?0:this.Uq()};k.Uq=function(){return 0};k.Zq=function(a){return this.D()&&a&&!Hf(this.D(),a)?!1:Ho.cb.Zq.call(this,a)};k.Ie=function(a){var b=this.D();return!this.Db||b&&!Hf(b,a)?(b=q(a).toString(),b in this.Ys||(this.Ys[b]=Xi(a)),this.Ys[b]):this.Db};
k.ol=function(a){var b=this.D();if(!b||Hf(b,a))return this.Zd;a=q(a).toString();a in this.Qi||(this.Qi[a]=new Hi);return this.Qi[a]};function Jo(a,b,c,d,e,f,g){b=[b,c,d];e=(c=ej(a,b,f))?a.uf(c,e,f):void 0;e=new a.xm(b,void 0!==e?0:4,void 0!==e?e:"",a.crossOrigin,a.Sc);e.key=g;J(e,"change",a.Wn,a);return e}
function sj(a,b,c,d,e,f){if(a.D()&&f&&!Hf(a.D(),f)){var g=a.ol(f);c=[b,c,d];b=a.xj.apply(a,c);if(g.qd(b))return g.get(b);var h=a.D();d=a.Ie(h);var l=a.Ie(f),n=ej(a,c,f);a=new Go(h,d,f,l,c,n,a.er(e),a.Uq(),function(a,b,c,d){return Ko(this,a,b,c,d,h)}.bind(a),a.vG,a.tG);g.set(b,a);return a}return Ko(a,b,c,d,e,f)}
function Ko(a,b,c,d,e,f){var g,h=a.xj(b,c,d),l=a.getKey();if(a.Zd.qd(h)){if(g=a.Zd.get(h),g.key!=l){var n=g;g.Wb&&g.Wb.key==l?(g=g.Wb,2==n.Qa()&&(g.Wb=n)):(g=Jo(a,b,c,d,e,f,l),2==n.Qa()?g.Wb=n:n.Wb&&2==n.Wb.Qa()&&(g.Wb=n.Wb,n.Wb=null));g.Wb&&(g.Wb.Wb=null);a.Zd.replace(h,g)}}else g=Jo(a,b,c,d,e,f,l),a.Zd.set(h,g);return g}function Io(a,b){a.xa().src=b};function Lo(a){a=a||{};var b=void 0!==a.ea?a.ea:"EPSG:3857",c=void 0!==a.Db?a.Db:$i({P:Yi(b),Xb:a.Xb,Rd:a.Rd,ng:a.ng});Ho.call(this,{Na:a.Na,od:a.od,crossOrigin:a.crossOrigin,mb:a.mb,pe:a.pe,ea:b,qf:a.qf,Db:c,Sc:a.Sc,mg:a.mg,uf:a.uf,url:a.url,Kb:a.Kb,Sa:void 0!==a.Sa?a.Sa:!0})}u(Lo,Ho);function Mo(a){a=a||{};Lo.call(this,{Na:void 0!==a.Na?a.Na:[No],od:a.od,crossOrigin:void 0!==a.crossOrigin?a.crossOrigin:"anonymous",pe:void 0!==a.pe?a.pe:!0,Xb:void 0!==a.Xb?a.Xb:19,qf:a.qf,Sc:a.Sc,url:void 0!==a.url?a.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",Sa:a.Sa})}u(Mo,Lo);var No=new kh({html:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.'});function D(){C.log("nsVmap.Map");this.Fx=[];this.as=new Ek({qa:[0,0],zoom:2});this.F=new xo({$a:this.Fx,view:this.as});this.Vr=new yg({fill:new ug({color:"rgba(255, 255, 255, 0.3)"}),stroke:new wg({color:"#d9534f",width:3}),Gb:new xg({xc:7,fill:new ug({color:"#d9534f"})})});this.Ur=new Fe;this.Sd=new qm({map:this.F,style:this.Vr,source:new sh({features:this.Ur,vh:!1}),Ti:!0,Ui:!0});this.Ax=new yg({fill:new ug({color:"rgba(255, 255, 255, 0.3)"}),stroke:new wg({color:"#337ab7",width:2}),Gb:new xg({xc:10,
stroke:new wg({color:"#337ab7",width:2}),fill:new ug({color:"rgba(255, 255, 255, 0.2)"})})});this.Xg=new Fe;this.Ho=new qm({map:this.F,style:this.Ax,source:new sh({features:this.Xg,vh:!1})});this.Bx=new Fe;this.Tr=new qm({map:this.F,style:this.Ax,source:new sh({features:this.Bx,vh:!1})});this.lt=[];this.Jm=[];this.mt=[];this.sa={};this.Km=new Fe;this.nt=new qm({map:this.F,source:new sh({features:this.Km})});this.Ak();for(var a=this.F.Nc.L(),b=0;b<a.length;b++)a[b]instanceof el&&this.F.Nc.remove(a[b]);
this.F.Tb.setAttribute("id","map1");$(document).keydown(function(a){27===a.keyCode&&C.g().$j()});this.Qg=[];this.Qg.push(this.Sd);this.Qg.push(this.Ho);this.Qg.push(this.Tr);this.Qg.push(this.nt)}ta("nsVmap.Map",D);
D.prototype.gb=function(a){C.log("nsVmap.Map.prototype.getScale");a=m(a)?a:{};a.pretty=m(a.pretty)?a.pretty:!1;var b=new nf(6378137),c=H(this.F).D(),d=Hk(H(C.g().F),[37.795275591,0]),e=Kf([d[0],d[1]],c,"EPSG:4326"),c=Kf([d[2],d[3]],c,"EPSG:4326"),b=100*pf(b,e,c);!0===a.pretty&&(b=Oo(0,b));return b};D.prototype.getScale=D.prototype.gb;function Oo(a,b){b=String(Math.round(b));a=1;for(var c=b.length-1;0<c;c--)0===a%3&&(b=b.slice(0,c)+","+b.slice(c+Math.abs(0))),a++;return"1:"+b}
D.prototype.rf=function(a){C.log("nsVmap.Map.prototype.setScale");var b=this.gb(),c=H(this.F).na();a=a*c/b;Mk(H(this.F),a);b=this.gb();C.log(b)};D.prototype.setScale=D.prototype.rf;
D.prototype.Ak=function(){var a=new sf({code:"EPSG:2154",P:[-378305.81,6093283.21,1212610.74,7186901.68],units:"m"});Ef(a);xf("EPSG:4326","EPSG:2154",this.Op,this.Ar);xf("EPSG:3857","EPSG:2154",function(a){a=Kf(a,"EPSG:3857","EPSG:4326");return Kf(a,"EPSG:4326","EPSG:2154")},function(a){a=Kf(a,"EPSG:2154","EPSG:4326");return Kf(a,"EPSG:4326","EPSG:3857")})};
D.prototype.Op=function(a){var b=a[0],c=a[1];lc=3/180*Math.PI;a=46.5/180*Math.PI;var d=44/180*Math.PI,e=49/180*Math.PI,f=c/180*Math.PI,b=b/180*Math.PI,c=6378137/Math.sqrt(1-.006694380025712785*Math.sin(d)*Math.sin(d)),g=Math.log(Math.tan(Math.PI/4+d/2)*Math.pow((1-.08181919106*Math.sin(d))/(1+.08181919106*Math.sin(d)),.04090959553)),f=Math.log(Math.tan(Math.PI/4+f/2)*Math.pow((1-.08181919106*Math.sin(f))/(1+.08181919106*Math.sin(f)),.04090959553)),e=Math.log(6378137/Math.sqrt(1-.006694380025712785*
Math.sin(e)*Math.sin(e))*Math.cos(e)/(c*Math.cos(d)))/(g-Math.log(Math.tan(Math.PI/4+e/2)*Math.pow((1-.08181919106*Math.sin(e))/(1+.08181919106*Math.sin(e)),.04090959553))),d=c*Math.cos(d)/e*Math.exp(e*g);return[7E5+d*Math.exp(-1*e*f)*Math.sin(e*(b-lc)),66E5+d*Math.exp(-1*e*Math.log(Math.tan(Math.PI/4+a/2)*Math.pow((1-.08181919106*Math.sin(a))/(1+.08181919106*Math.sin(a)),.04090959553)))-d*Math.exp(-1*e*f)*Math.cos(e*(b-lc))]};
D.prototype.Ar=function(a){Math.atanh=Math.atanh||function(a){return Math.log((1+a)/(1-a))/2};Math.tanh=Math.tanh||function(a){return Infinity===a?1:-Infinity===a?-1:(Math.exp(a)-Math.exp(-a))/(Math.exp(a)+Math.exp(-a))};var b=1/298.257222101,b=Math.sqrt(2*b-b*b),c=parseFloat(a[0]).toFixed(10)-7E5;a=parseFloat(a[1]).toFixed(10)-1.26556120499E7;var d=Math.log(1.1754255426096E7/Math.sqrt(c*c+a*a))/.725607765053267;return[(Math.atan(-c/a)/.725607765053267+3/180*Math.PI)/Math.PI*180,Math.asin(Math.tanh(d+
b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.sin(1))))))))))))))))/Math.PI*180]};D.prototype.gk=function(a,b,c,d){C.log("nsVmap.Map.prototype.setEventOnMap");if(!m(a))return console.error("setEventOnMap: type not defined"),0;if(!m(b))return console.error("setEventOnMap: listener not defined"),0;c=m(c)?c:"";this.re();a=this.Jt(a,b,c);m(d)&&this.ih(d);return a};
D.prototype.setEventOnMap=D.prototype.gk;D.prototype.Jt=function(a,b,c,d){if(!m(a))return console.error("setEventOnMap: type not defined"),0;if(!m(b))return console.error("setEventOnMap: listener not defined"),0;c=m(c)?c:"";a=this.F.on(a,b,c);this.lt.push(a);m(d)&&this.ih(d);return a};D.prototype.addEventOnMap=D.prototype.Jt;
D.prototype.gg=function(a,b){C.log("nsVmap.Map.prototype.setDrawInteraction");if(!m(a.type))return console.error("addDrawOnMap: opt_options.type not defined"),0;this.re();a=this.It(a);m(b)&&this.ih(b);return a};D.prototype.setDrawInteraction=D.prototype.gg;
D.prototype.It=function(a,b){if(!m(a.type))return console.error("addDrawOnMap: opt_options.type not defined"),0;a.style=m(a.style)?a.style:new yg({fill:new ug({color:"rgba(54,184,255,0.6)"}),stroke:new wg({color:"rgba(0, 0, 0, 0.5)",Ea:[10,10],width:2}),Gb:new xg({xc:5,stroke:new wg({color:"rgba(0, 0, 0, 0.7)"}),fill:new ug({color:"rgba(54,184,255,0.6)"})})});a=new Po(a);this.Ub(a);m(b)&&this.ih(b);return a};D.prototype.addDrawInteraction=D.prototype.It;
function Qo(a,b,c){C.log("nsVmap.Map.prototype.setInteraction");a.re();a.Ub(b);m(c)&&a.ih(c)}D.prototype.Ub=function(a,b){C.log("nsVmap.Map.prototype.addInteraction");this.F.Ub(a);this.Jm.push(a);m(b)&&this.ih(b);return a};D.prototype.re=function(){C.log("nsVmap.Map.prototype.removeActionsOnMap");for(var a=0;a<this.lt.length;a++)xe(this.lt[a]);for(a=0;a<this.Jm.length;a++)m(this.Jm[a].Ka)&&this.Jm[a].Ka().clear(),this.F.Nc.remove(this.Jm[a]);this.ih("")};D.prototype.removeActionsOnMap=D.prototype.re;
D.prototype.Ff=function(a){this.mt.push(a);this.F.Ff(a)};D.prototype.addOverlay=D.prototype.Ff;D.prototype.$j=function(){this.re();this.sa.hide();for(var a=0;a<this.mt.length;a++)this.mt[a].ud().style.display="none"};D.prototype.removeActionsAndTooltips=D.prototype.$j;D.prototype.cH=function(a,b){this.Km.clear();this.Tm(a,b)};D.prototype.setTextOverlayFeature=D.prototype.cH;
D.prototype.Tm=function(a,b){a=new yg({Gb:new xg({xc:3,stroke:new wg({color:"#fff"}),fill:new ug({color:"blue"})}),text:new Ro({text:a,fill:new ug({color:"blue"}),offsetY:-13})});b=new Eg({geometry:new ok(b)});b.Qe(a);vh(this.nt.v(),b)};D.prototype.addTextOverlayFeature=D.prototype.Tm;
function So(a,b){C.log("nsVmap.Map.prototype.addVectorLayer");var c=new qm({map:a.F,source:new sh({vh:!1}),Ti:!0,Ui:!0});m(b)&&(m(b.style)&&c.Qe(b.style),m(b.P)&&c.ep(b.P),m(b.le)&&c.set("minResolution",b.le),m(b.Ke)&&c.set("maxResolution",b.Ke),m(b.opacity)&&c.Hs(b.opacity),m(b.properties)&&c.Ac(b.properties),m(b.visible)&&c.setVisible(b.visible),m(b.zIndex)&&c.Ky(b.zIndex));a.Qg.push(c);return c}D.prototype.refresh=function(){C.log("nsVmap.Map.prototype.refresh");this.F.jd()};
D.prototype.refresh=D.prototype.refresh;D.prototype.xE=function(){C.log("nsVmap.Map.prototype.mapDirective");return{restrict:"E",scope:{map:"=appMap",proj:"=appProj",currentAction:"=appAction"},controller:"AppMapController",controllerAs:"ctrl",bindToController:!0,template:'<div id="olMap"></div>'}};
D.prototype.Ll=function(a,b,c,d){C.log("nsVmap.Map.prototype.mapController");var e=this;this.V=d;this.element=c;this.duration=1E3;this.map=this.map;this.UF=this.proj;this.Gl=[];this.map.om("olMap");this.cq=new Hc(function(){e.map.yf();var a=e.map;a.Kh&&ce.cancelAnimationFrame(a.Kh);a.Qt();sa()-start<e.duration&&e.cq.start()},b);a.$watchCollection(function(){return[e.element.children()[0].clientWidth,e.element.children()[0].clientHeight]},function(){e.rm()});C.g().sa=new To({id:"map-tooltip"});var f=
0;this.map.getLayers().on("change:length",function(){f++;var a=angular.copy(f);setTimeout(function(){f===a&&(C.log("oVmap event: layersChanged"),C.scope.$broadcast("layersChanged"))},500)});C.scope.$on("layersChanged",function(){C.log("nsVmap.Map.prototype.emptyLoadErrorsEvents");for(var a=0;a<e.Gl.length;a++)e.Gl[a].layer.v().gt(e.Gl[a].event);Uo(e)});C.scope.$on("mapChanged",function(){C.g().Sd.v().clear();C.g().Ho.v().clear()})};D.prototype.Ll.$inject=["$scope","$window","$element","$http"];
function Uo(a){C.log("nsVmap.Map.prototype.listenLoadErrors");a.map.getLayers().forEach(function(b){b.v()instanceof Do?a.Gl.push({event:b.v().on("tileloaderror",function(b){null!=b.tile?null!=b.tile.xe?Vo(a,b.tile.xe):console.error("tileloaderror: ",b.tile):console.error("tileloaderror: ",b)}),layer:b}):b.v()instanceof Co&&a.Gl.push({event:b.v().on("imageloaderror",function(b){null!=b.image?null!=b.image.xe?Vo(a,b.image.xe):console.error("imageloaderror: ",b.image):console.error("imageloaderror: ",
b)}),layer:b})})}function Vo(a,b){C.log("nsVmap.Map.prototype.mapController.prototype.displayLoadErrors");a.V({method:"GET",url:b}).then(function(a){var b=jQuery.parseXML(a.data);null!=b?console.error("Layer server error: ",b):null!=a.data&&""!==a.data?console.error("Layer server error: ",a.data):console.error("Layer server error: ",a)},function(a){console.error(a)})}
D.prototype.Ll.prototype.rm=function(){C.log("nsVmap.Map.prototype.mapController.prototype.startAnimation");start=sa();this.cq.stop();this.cq.start()};D.prototype.Ll.prototype.startAnimation=D.prototype.Ll.prototype.rm;D.prototype.EC=function(){return this.F.getLayers()};D.prototype.getOpenLayersLayers=D.prototype.EC;D.prototype.YG=function(a){this.Fx=a;this.F.set("layergroup",a)};D.prototype.setOpenLayersLayers=D.prototype.YG;D.prototype.FC=function(){return H(this.F)};
D.prototype.getOpenLayersView=D.prototype.FC;D.prototype.Fy=function(a){this.as=a;this.F.lh(this.as)};D.prototype.setOpenLayersView=D.prototype.Fy;D.prototype.DC=function(){return this.F};D.prototype.getOLMap=D.prototype.DC;D.prototype.ZG=function(a){this.F=a};D.prototype.setOpenLayersMap=D.prototype.ZG;D.prototype.NC=function(){return this.Sd};D.prototype.getSelectionOverlay=D.prototype.NC;D.prototype.OC=function(){return this.Ur};D.prototype.getSelectionOverlayFeatures=D.prototype.OC;
D.prototype.wC=function(){return this.Ho};D.prototype.getLocationOverlay=D.prototype.wC;D.prototype.Yq=function(){return this.Ho.v()};D.prototype.getLocationOverlaySource=D.prototype.Yq;D.prototype.xC=function(){return this.Xg};D.prototype.getLocationOverlayFeatures=D.prototype.xC;D.prototype.JC=function(){return this.Tr};D.prototype.getPopupOverlay=D.prototype.JC;D.prototype.il=function(){return this.Tr.v()};D.prototype.getPopupOverlaySource=D.prototype.il;D.prototype.KC=function(){return this.Bx};
D.prototype.getPopupOverlayFeatures=D.prototype.KC;D.prototype.PC=function(){return this.Vr};D.prototype.getSelectionStyle=D.prototype.PC;D.prototype.aH=function(a){this.Vr=a};D.prototype.setSelectionStyle=D.prototype.aH;D.prototype.Vv=function(){return angular.element($("#map1")).scope().ctrl.currentAction};D.prototype.getCurrentAction=D.prototype.Vv;D.prototype.ih=function(a){angular.element($("#map1")).scope().$evalAsync(function(b){b.ctrl.currentAction=a})};D.prototype.setCurrentAction=D.prototype.ih;
D.prototype.QC=function(){return this.nt};D.prototype.getTextOverlay=D.prototype.QC;D.prototype.RC=function(){return this.Km};D.prototype.getTextOverlayFeatures=D.prototype.RC;D.prototype.tC=function(){return this.Qg};D.prototype.getLayersToTransform=D.prototype.tC;D.prototype.rC=function(a){for(var b=this.F.getLayers().L(),c=0;c<b.length;c++)if(b[c].get("layer_id")===a)return b[c];return null};D.prototype.getLayerById=D.prototype.rC;C.module.directive("appMap",D.prototype.xE);
C.module.controller("AppMapController",D.prototype.Ll);function Wo(a){Ae.call(this);this.Mc=a.id;this.WD=void 0!==a.VD?a.VD:!0;this.vH=void 0!==a.uH?a.uH:!0;this.kb=document.createElement("DIV");this.kb.className="ol-overlay-container";this.kb.style.position="absolute";this.Um=void 0!==a.Um?a.Um:!1;this.hq=void 0!==a.Hu?a.Hu:{};this.EA=void 0!==a.DA?a.DA:20;this.yc={Ym:"",po:"",$o:"",wp:"",visible:!0};this.vo=null;J(this,Ce("element"),this.dD,this);J(this,Ce("map"),this.sD,this);J(this,Ce("offset"),this.xD,this);J(this,Ce("position"),this.zD,this);J(this,
Ce("positioning"),this.AD,this);void 0!==a.element&&this.set("element",a.element);Xo(this,void 0!==a.offset?a.offset:[0,0]);this.set("positioning",void 0!==a.Uj?a.Uj:"top-left");void 0!==a.position&&this.setPosition(a.position)}u(Wo,Ae);k=Wo.prototype;k.ud=function(){return this.get("element")};k.Fb=function(){return this.Mc};k.g=function(){return this.get("map")};k.Qn=function(){return this.get("position")};k.dD=function(){Cc(this.kb);var a=this.ud();a&&this.kb.appendChild(a)};
k.sD=function(){this.vo&&(Ec(this.kb),me(this.vo),this.vo=null);var a=this.g();a&&(this.vo=J(a,"postrender",this.ka,this),Yo(this),a=this.vH?a.Sl:a.Tl,this.WD?Dc(a,this.kb,0):a.appendChild(this.kb))};k.ka=function(){Yo(this)};k.xD=function(){Yo(this)};
k.zD=function(){Yo(this);if(void 0!==this.get("position")&&this.Um){var a=this.g();if(void 0!==a&&Bo(a)){var b=Zo(Bo(a),a.ja()),c=this.ud(),d=c.offsetWidth,e=c.currentStyle||ce.getComputedStyle(c),d=d+(parseInt(e.marginLeft,10)+parseInt(e.marginRight,10)),e=c.offsetHeight,f=c.currentStyle||ce.getComputedStyle(c),e=e+(parseInt(f.marginTop,10)+parseInt(f.marginBottom,10)),g=Zo(c,[d,e]),c=this.EA;Pe(b,g)||(d=g[0]-b[0],e=b[2]-g[2],f=g[1]-b[1],g=b[3]-g[3],b=[0,0],0>d?b[0]=d-c:0>e&&(b[0]=Math.abs(e)+c),
0>f?b[1]=f-c:0>g&&(b[1]=Math.abs(g)+c),0===b[0]&&0===b[1])||(c=H(a).Da(),d=yl(a,c),b=[d[0]+b[0],d[1]+b[1]],this.hq&&(this.hq.source=c,a.$c(Uk(this.hq))),H(a).ib(a.Kd(b)))}}};k.AD=function(){Yo(this)};k.Ua=function(a){this.set("map",a)};function Xo(a,b){a.set("offset",b)}k.setPosition=function(a){this.set("position",a)};
function Zo(a,b){var c=vc(a),d=new rc(0,0),e;e=c?vc(c):document;e=!Eb||9<=Number(Pb)||"CSS1Compat"==tc(e).Ze.compatMode?e.documentElement:e.body;a!=e&&(a=Vc(a),e=tc(c).Ze,c=e.scrollingElement?e.scrollingElement:Hb||"CSS1Compat"!=e.compatMode?e.body||e.documentElement:e.documentElement,e=e.parentWindow||e.defaultView,c=Eb&&Ob("10")&&e.pageYOffset!=c.scrollTop?new rc(c.scrollLeft,c.scrollTop):new rc(e.pageXOffset||c.scrollLeft,e.pageYOffset||c.scrollTop),d.x=a.left+c.x,d.y=a.top+c.y);return[d.x,d.y,
d.x+b[0],d.y+b[1]]}k.setVisible=function(a){this.yc.visible!==a&&(Yc(this.kb,a),this.yc.visible=a)};
function Yo(a){var b=a.g(),c=a.Qn();if(void 0!==b&&b.Kc&&void 0!==c){var c=yl(b,c),d=b.ja(),b=a.kb.style,e=a.get("offset"),f=a.get("positioning"),g=e[0],e=e[1];if("bottom-right"==f||"center-right"==f||"top-right"==f)""!==a.yc.po&&(a.yc.po=b.left=""),g=Math.round(d[0]-c[0]-g)+"px",a.yc.$o!=g&&(a.yc.$o=b.right=g);else{""!==a.yc.$o&&(a.yc.$o=b.right="");if("bottom-center"==f||"center-center"==f||"top-center"==f)g-=Wc(a.kb).width/2;g=Math.round(c[0]+g)+"px";a.yc.po!=g&&(a.yc.po=b.left=g)}if("bottom-left"==
f||"bottom-center"==f||"bottom-right"==f)""!==a.yc.wp&&(a.yc.wp=b.top=""),c=Math.round(d[1]-c[1]-e)+"px",a.yc.Ym!=c&&(a.yc.Ym=b.bottom=c);else{""!==a.yc.Ym&&(a.yc.Ym=b.bottom="");if("center-left"==f||"center-center"==f||"center-right"==f)e-=Wc(a.kb).height/2;c=Math.round(c[1]+e)+"px";a.yc.wp!=c&&(a.yc.wp=b.top=c)}a.setVisible(!0)}else a.setVisible(!1)};function To(a){C.log("nsVmap.Map.MapTooltip");if(!m(a.id))return 0;this.id=a.id;this.className=m(a.className)?a.className:"map-tooltip";this.map=C.g().F;this.ji=document.createElement("div");this.ji.id=this.id;this.ji.className=this.className;this.ji.style.display="none";this.Yn=new Wo({element:this.ji,offset:[15,15],Uj:"center-left"});this.map.Ff(this.Yn);this.map.on("pointermove",function(a){this.Yn.setPosition(a.zb)},this)}D.MapTooltip=To;
To.prototype.za=function(a){if(!m(a))return"message not defined";this.ji.innerHTML=a;this.ji.style.display="block";this.Yn.setPosition([0,0])};To.prototype.hide=function(){this.ji.style.display="none"};function $o(a,b){C.log("nsVmap.Map.MapPopup");var c=this;this.$r=a;this.H=C.g().F;this.Xj=H(this.H).D().M;this.ta=[];this.Jo={};Ta(C.g().il().Ka(),a)||vh(C.g().il(),a);this.vg=document.createElement("div");this.vg.className="ol-popup";this.Qm=document.createElement("div");this.vg.appendChild(this.Qm);this.Ah=document.createElement("div");this.Ah.style="height: 7px;";this.Qm.appendChild(this.Ah);if(null!=C.properties.popup&&null!=C.properties.popup.style&&p(C.properties.popup.style)){for(var d=C.properties.popup.style.replace(/<return>/g,
"").split(";"),e=0;e<d.length;e++){var f=d[e].split(":");null!=f[0]&&null!=f[1]&&(this.Jo[f[0]]=f[1]);delete f}for(var g in this.Jo)this.vg.style[g]=this.Jo[g]}this.Bh=document.createElement("a");this.Bh.href="#";this.Bh.className="ol-popup-closer";this.Ah.appendChild(this.Bh);this.Ch=document.createElement("div");this.Ch.classList.add("popup-content");this.Qm.appendChild(this.Ch);this.Mo=new Wo({element:this.vg,Um:!0,position:null!=b?ap(b):ap(a.l()),Hu:{duration:250}});this.Bh.onclick=function(){c.remove();
return!1};this.vg.onclick=function(){for(var a=C.g().F.Pc.L(),b=0;b<a.length;b++)$(a[b].ud()).hasClass("ol-popup")&&$(a[b].ud()).css("z-index",10);$(c.vg).css("z-index",11)};this.H.Ff(this.Mo);this.H.on("change:view",function(){var a=this.Xj,b=this.Mo.Qn();if(!m(b)||!m(a))return 0;var c=H(this.H).D().M,a=Kf(b,a,c);this.Mo.setPosition(a);this.Xj=c},this)}D.MapPopup=$o;
$o.prototype.za=function(a){C.log("nsVmap.Map.MapPopup.prototype.displayMessage");C.log("nsVmap.Map.MapPopup.prototype.removeMessages");this.Ch.innerHTML="";this.Lt(a)};$o.prototype.displayMessage=$o.prototype.za;$o.prototype.Lt=function(a){C.log("nsVmap.Map.MapPopup.prototype.displayMessage");if(!m(a))return console.error("MapPopup: message not defined"),0;this.Ch.innerHTML=a;return!0};$o.prototype.addMessage=$o.prototype.Lt;
$o.prototype.Nt=function(a){C.log("nsVmap.Map.MapPopup.prototype.addPhoto");if(!m(a))return console.error("MapPopup: addPhoto not defined"),0;var b=document.createElement("img");b.style.width="100px";b.src=a;null!=this.Jo["min-width"]&&"0px"!==$(this.vg).css("min-width")||$(this.vg).css("min-width","300px");m(this.Zi)||(this.Zi=document.createElement("div"),this.Zi.classList.add("popup-image-content"),this.Zi.style.position="relative",this.Zi.style["float"]="right",this.Ch.style["float"]="left",this.Ch.style.width=
"calc(100% - 100px)",this.Qm.appendChild(this.Zi));this.Zi.appendChild(b);return!0};$o.prototype.addPhoto=$o.prototype.Nt;
function bp(a,b){C.log("nsVmap.Map.MapPopup.prototype.addMessageTable");if(m(b)){var c=document.createElement("table"),d;for(d in b)if("feature"!==d){var e=document.createElement("tr"),f=document.createElement("td");f.className="padding-sides-5 map-popup-cell";e.appendChild(f);var g=document.createElement("td");g.className="padding-sides-5 map-popup-cell";e.appendChild(g);if(p(b[d])&&(b[d]=b[d].replace(/</g,"&lt;").replace(/>/g,"&gt;"),-1!==b[d].indexOf("[bo_link")&&-1!==b[d].indexOf("[/bo_link]"))){var h=
d,l;l=b[d];for(var n=l.substr(l.indexOf("[bo_link"),l.indexOf("[/bo_link]")-l.indexOf("[bo_link")+10),r,t=r=null,v,x="",y=0;y<n.length;y++)if(x+=n[y],'"'===n[y]&&null===r&&"\\"!==n[y-1])r=y;else if('"'===n[y]&&null===t&&null!==r&&"\\"!==n[y-1])t=y;else if(null!==r&&null===t?v=!0:(v=!1,null!==r&&null!==t&&(t=r=null)),!v&&"]"===n[y])break;r=x;for(var n=n.substr(n.indexOf(r)+r.length),n=n.substr(0,n.indexOf("[/bo_link]")),B=y=x=v=t=null,E=null,I,w={},A=0;A<r.length;A++)'"'===r[A]&&null===t&&"\\"!==r[A-
1]?t=A:'"'===r[A]&&null===v&&null!==t&&"\\"!==r[A-1]?v=A:(null!==t&&null===v?I=!0:(I=!1,null!==t&&null!==v&&(B=r.substr(t+1,v-t-1),v=t=null)),I||(" "===r[A]&&null===x&&(x=A),"="===r[A]&&null===y&&(y=A),null!==x&&null!==y&&(E=r.substr(x+1,y-x-1),y=x=null)),null!==B&&null!==E&&(w[E]=B,E=B=null));t=w;r=null!=t.href?t.href:null;t=null!=t.target?t.target:"_blank";n=0<n.length?n:r;null!=r?l='<a href="'+r+'" target="'+t+'">'+n+"</a>":console.error("cannot parse href");b[h]=l}f.innerHTML=d;g.innerHTML=b[d];
c.appendChild(e);delete e;delete f;delete g}a.Ch.appendChild(c)}else console.error("MapPopup: data not defined")}$o.prototype.zk=function(a){-1===this.ta.indexOf(a)&&(this.ta.push(a),this.vq())};$o.prototype.addAction=$o.prototype.zk;$o.prototype.jG=function(a){-1!==this.ta.indexOf(a)&&(this.ta.splice(this.ta.indexOf(a),1),this.vq())};$o.prototype.removeAction=$o.prototype.jG;
$o.prototype.vq=function(){C.log("nsVmap.Map.MapPopup.prototype.compileActions");var a=this;m(this.Dh)&&this.Ah.removeChild(this.Dh);this.Dh=document.createElement("div");this.Dh.className="dropup";this.Dh.style.position="inherit";this.xk=document.createElement("a");this.xk.href="#";this.xk.className="ol-popup-list icon-format_list_bulleted";this.xk.addEventListener("click",function(){$(a.Eh).toggleClass("block")});$("body").click(function(b){$(a.xk)[0]!==$(b.target)[0]&&$(a.Eh).removeClass("block")});
this.Eh=document.createElement("ul");this.Eh.style="right: 0;left: inherit;";this.Eh.className="dropdown-menu";for(var b=0;b<this.ta.length;b++)this.xt=document.createElement("li"),this.wk=document.createElement("a"),this.wk.href="#",this.wk.innerHTML=this.ta[b].content,this.wk.addEventListener("click",this.ta[b].event),this.wk.addEventListener("click",function(){$(a.Eh).removeClass("block")}),this.Eh.appendChild(this.xt),this.xt.appendChild(this.wk);this.Dh.appendChild(this.Eh);this.Dh.appendChild(this.xk);
this.Ah.appendChild(this.Dh)};$o.prototype.compileActions=$o.prototype.vq;$o.prototype.remove=function(a){C.log("nsVmap.Map.MapPopup.prototype.remove");a=m(a)?a:!0;this.Mo.setPosition(void 0);this.Bh.blur();m(this.$r)&&!1!==a&&Ta(C.g().il().Ka(),this.$r)&&zh(C.g().il(),this.$r);return!0};
function ap(a){C.log("nsVmap.Map.MapPopup.prototype.getGeometryCenter");if("Polygon"===a.T())a=bk(zk(a));else if("MultiPolygon"===a.T()){a=cp(a);for(var b=0,c=0,d=0;d<a.length;d++)b<a[d].uj()&&(b=a[d].uj(),c=d);a=bk(zk(a[c]))}else if("LineString"===a.T())b=Math.round(a.da().length/2),a=a.da()[b];else if("Circle"===a.T())a=a.Da();else if("Point"===a.T()||"MultiPoint"===a.T())a=bk(a);else return"GeometryCollection"===a.T()?0:bk(a);return a};function dp(){this.vb=null}function ep(a,b,c){var d;c&&(d={Ce:c.Ce?c.Ce:a.Zl(b),Fe:c.Fe});return fp(a,d)}function fp(a,b){var c;b&&(c={Fe:b.Fe,Ce:b.Ce?b.Ce:a.vb,Bs:b.Bs},b.pn&&(c.pn=b.pn));return c}
function gp(a,b,c){var d=c?vf(c.Fe):null,e=c?vf(c.Ce):null;a=d&&e&&!Hf(d,e)?a instanceof Mf?(b?a.clone():a).transform(b?d:e,b?e:d):Lf(b?a.slice():a,b?d:e,b?e:d):a;if(b&&c&&c.pn){var f=Math.pow(10,c.pn);b=function(a){for(var b=0,c=a.length;b<c;++b)a[b]=Math.round(a[b]*f)/f;return a};Array.isArray(a)?b(a):a.Dk(b)}return a};function hp(){this.vb=null}u(hp,dp);function ip(a){if(ka(a))return a;if("string"===typeof a)return(a=JSON.parse(a))?a:null;Oa();return null}k=hp.prototype;k.T=function(){return"json"};k.Zj=function(a,b){return this.Ux(ip(a),ep(this,a,b))};k.Yl=function(a,b){var c=ip(a);a=ep(this,a,b);return jp(c,a)};k.Zl=function(a){return kp(this,ip(a))};k.pt=function(a,b){return JSON.stringify(lp(this,a,b))};k.Ip=function(a,b){return JSON.stringify(mp(this,a,b))};
k.qt=function(a,b){return JSON.stringify(np(a,fp(this,b)))};function op(a){Mf.call(this);this.Pb=a?a:null;pp(this)}u(op,Mf);function qp(a){var b=[],c,d;c=0;for(d=a.length;c<d;++c)b.push(a[c].clone());return b}function rp(a){var b,c;if(a.Pb)for(b=0,c=a.Pb.length;b<c;++b)se(a.Pb[b],"change",a.R,a)}function pp(a){var b,c;if(a.Pb)for(b=0,c=a.Pb.length;b<c;++b)J(a.Pb[b],"change",a.R,a)}k=op.prototype;k.clone=function(){var a=new op(null),b=qp(this.Pb);rp(a);a.Pb=b;pp(a);a.R();return a};
k.Xe=function(a,b){var c=this.Pb,d,e;d=0;for(e=c.length;d<e;++d)if(c[d].Xe(a,b))return!0;return!1};k.hn=function(a){Se(a);for(var b=this.Pb,c=0,d=b.length;c<d;++c)Ve(a,b[c].Z());return a};
k.br=function(a){this.hp!=this.bb&&(he(this.nh),this.oh=0,this.hp=this.bb);if(0>a||0!==this.oh&&a<this.oh)return this;var b=a.toString();if(this.nh.hasOwnProperty(b))return this.nh[b];var c=[],d=this.Pb,e=!1,f,g;f=0;for(g=d.length;f<g;++f){var h=d[f],l=h.br(a);c.push(l);l!==h&&(e=!0)}if(e)return a=new op(null),rp(a),a.Pb=c,pp(a),a.R(),this.nh[b]=a;this.oh=a;return this};k.T=function(){return"GeometryCollection"};k.fd=function(){return 0===this.Pb.length};
k.rotate=function(a,b){for(var c=this.Pb,d=0,e=c.length;d<e;++d)c[d].rotate(a,b);this.R()};k.Dk=function(a){var b=this.Pb,c,d;c=0;for(d=b.length;c<d;++c)b[c].Dk(a);this.R()};k.translate=function(a,b){var c=this.Pb,d,e;d=0;for(e=c.length;d<e;++d)c[d].translate(a,b);this.R()};k.Ca=function(){rp(this);op.cb.Ca.call(this)};function sp(a,b,c,d,e){var f=NaN,g=NaN,h=(c-b)/d;if(0===h)Oa("n cannot be 0");else if(1==h)f=a[b],g=a[b+1];else if(2==h)f=.5*a[b]+.5*a[b+d],g=.5*a[b+1]+.5*a[b+d+1];else{var g=a[b],h=a[b+1],l=0,f=[0],n;for(n=b+d;n<c;n+=d){var r=a[n],t=a[n+1],l=l+Math.sqrt((r-g)*(r-g)+(t-h)*(t-h));f.push(l);g=r;h=t}c=.5*l;l=0;n=f.length;for(r=!1;l<n;)g=l+(n-l>>1),h=+Hg(f[g],c),0>h?l=g+1:(n=g,r=!h);g=r?l:~l;0>g?(c=(c-f[-g-2])/(f[-g-1]-f[-g-2]),b+=(-g-2)*d,f=a[b],f+=c*(a[b+d]-f),g=a[b+1],g+=c*(a[b+d+1]-g)):(f=a[b+g*d],
g=a[b+g*d+1])}return e?(e[0]=f,e[1]=g,e):[f,g]};function tp(a,b){Yj.call(this);this.Nq=null;this.Lv=-1;this.tb(a,b)}u(tp,Yj);k=tp.prototype;k.clone=function(){var a=new tp(null);a.ma(this.Ha,this.s.slice());return a};k.da=function(){return jk(this.s,0,this.s.length,this.W)};k.Lc=function(){var a=this.s,b=this.W,c=a[0],d=a[1],e=0,f;for(f=0+b;f<this.s.length;f+=b)var g=a[f],h=a[f+1],e=e+Math.sqrt((g-c)*(g-c)+(h-d)*(h-d)),c=g,d=h;return e};function ym(a){if(a.Lv!=a.bb){var b;b=sp(a.s,0,a.s.length,a.W,a.Nq);a.Nq=b;a.Lv=a.bb}return a.Nq}
k.yj=function(a){var b=[];b.length=lk(this.s,0,this.s.length,this.W,a,b,0);a=new tp(null);a.ma("XY",b);return a};k.T=function(){return"LineString"};k.tb=function(a,b){a?(dk(this,b,a,1),this.s||(this.s=[]),this.s.length=hk(this.s,0,a,this.W),this.R()):this.ma("XY",null)};k.ma=function(a,b){ck(this,a,b);this.R()};function up(a,b){Yj.call(this);this.Pa=[];this.tb(a,b)}u(up,Yj);function vp(a,b){a.s?Jg(a.s,b.s.slice()):a.s=b.s.slice();a.Pa.push(a.s.length);a.R()}k=up.prototype;k.clone=function(){var a=new up(null);a.ma(this.Ha,this.s.slice(),this.Pa.slice());return a};k.da=function(){return kk(this.s,0,this.Pa,this.W)};function wp(a){var b=a.s,c=a.Pa;a=a.Ha;var d=[],e=0,f,g;f=0;for(g=c.length;f<g;++f){var h=c[f],l=new tp(null);l.ma(a,b.slice(e,h));d.push(l);e=h}return d}
function zm(a){var b=[],c=a.s,d=0,e=a.Pa;a=a.W;var f,g;f=0;for(g=e.length;f<g;++f){var h=e[f],d=sp(c,d,h,a);Jg(b,d);d=h}return b}k.yj=function(a){var b=[],c=[],d=this.s,e=this.Pa,f=this.W,g=0,h=0,l,n;l=0;for(n=e.length;l<n;++l){var r=e[l],h=lk(d,g,r,f,a,b,h);c.push(h);g=r}b.length=h;a=new up(null);a.ma("XY",b,c);return a};k.T=function(){return"MultiLineString"};
k.tb=function(a,b){a?(dk(this,b,a,2),this.s||(this.s=[]),a=ik(this.s,0,a,this.W,this.Pa),this.s.length=0===a.length?0:a[a.length-1],this.R()):this.ma("XY",null,this.Pa)};k.ma=function(a,b,c){ck(this,a,b);this.Pa=c;this.R()};function xp(a,b){var c=a.Ha,d=[],e=[],f,g;f=0;for(g=b.length;f<g;++f){var h=b[f];0===f&&(c=h.Ha);Jg(d,h.s);e.push(d.length)}a.ma(c,d,e)};function yp(a,b){Yj.call(this);this.tb(a,b)}u(yp,Yj);function zp(a,b){a.s?Jg(a.s,b.s):a.s=b.s.slice();a.R()}k=yp.prototype;k.clone=function(){var a=new yp(null);a.ma(this.Ha,this.s.slice());return a};k.da=function(){return jk(this.s,0,this.s.length,this.W)};function Ap(a){if(0>=(a.s?a.s.length/a.W:0))return null;var b=new ok(null);b.ma(a.Ha,a.s.slice(0*a.W,1*a.W));return b}
function Bp(a){var b=a.s,c=a.Ha;a=a.W;var d=[],e,f;e=0;for(f=b.length;e<f;e+=a){var g=new ok(null);g.ma(c,b.slice(e,e+a));d.push(g)}return d}k.T=function(){return"MultiPoint"};k.tb=function(a,b){a?(dk(this,b,a,1),this.s||(this.s=[]),this.s.length=hk(this.s,0,a,this.W),this.R()):this.ma("XY",null)};k.ma=function(a,b){ck(this,a,b);this.R()};function Cp(a,b){Yj.call(this);this.jc=[];this.Jv=-1;this.Kv=null;this.Rl=-1;this.Ne=null;this.tb(a,b)}u(Cp,Yj);function Dp(a,b){if(a.s){var c=a.s.length;Jg(a.s,b.s);b=b.Pa.slice();var d,e;d=0;for(e=b.length;d<e;++d)b[d]+=c}else a.s=b.s.slice(),b=b.Pa.slice(),a.jc.push();a.jc.push(b);a.R()}k=Cp.prototype;k.clone=function(){for(var a=new Cp(null),b=this.jc.length,c=Array(b),d=0;d<b;++d)c[d]=this.jc[d].slice();a.ma(this.Ha,this.s.slice(),c);return a};
k.Xe=function(a,b){a:{var c=this.Md(),d=this.jc,e=0;if(0!==d.length){var f,g;f=0;for(g=d.length;f<g;++f){var h=d[f];if(qk(c,e,h,this.W,a,b)){a=!0;break a}e=h[h.length-1]}}a=!1}return a};k.uj=function(){var a=this.Md(),b=this.jc,c=0,d=0,e,f;e=0;for(f=b.length;e<f;++e)var g=b[e],d=d+fk(a,c,g,this.W),c=g[g.length-1];return d};
k.da=function(a){var b;void 0!==a?(b=this.Md().slice(),vk(b,this.jc,this.W,a)):b=this.s;a=b;b=this.jc;var c=this.W,d=0,e=[],f=0,g,h;g=0;for(h=b.length;g<h;++g){var l=b[g];e[f++]=kk(a,d,l,c,e[f]);d=l[l.length-1]}e.length=f;return e};
function Am(a){if(a.Jv!=a.bb){var b=a.s,c=a.jc,d=a.W,e=0,f=[],g,h,l;g=0;for(h=c.length;g<h;++g){var n=c[g];l=b;var r=n[0],t=d,v=Se(void 0);l=We(v,l,e,r,t);f.push((l[0]+l[2])/2,(l[1]+l[3])/2);e=n[n.length-1]}b=a.Md();c=a.jc;d=a.W;g=0;h=[];n=0;for(l=c.length;n<l;++n)e=c[n],h=rk(b,g,e,d,f,2*n,h),g=e[e.length-1];a.Kv=h;a.Jv=a.bb}return a.Kv}
k.Md=function(){if(this.Rl!=this.bb){var a=this.s,b;a:{b=this.jc;var c,d;c=0;for(d=b.length;c<d;++c)if(!tk(a,b[c],this.W,void 0)){b=!1;break a}b=!0}b?this.Ne=a:(this.Ne=a.slice(),this.Ne.length=vk(this.Ne,this.jc,this.W));this.Rl=this.bb}return this.Ne};k.yj=function(a){var b=[],c=[],d=this.s,e=this.jc,f=this.W;a=Math.sqrt(a);var g=0,h=0,l,n;l=0;for(n=e.length;l<n;++l){var r=e[l],t=[],h=mk(d,g,r,f,a,b,h,t);c.push(t);g=r[r.length-1]}b.length=h;d=new Cp(null);d.ma("XY",b,c);return d};
function cp(a){var b=a.Ha,c=a.s;a=a.jc;var d=[],e=0,f,g,h,l;f=0;for(g=a.length;f<g;++f){var n=a[f].slice(),r=n[n.length-1];if(0!==e)for(h=0,l=n.length;h<l;++h)n[h]-=e;h=new wk(null);h.ma(b,c.slice(e,r),n);d.push(h);e=r}return d}k.T=function(){return"MultiPolygon"};
k.tb=function(a,b){if(a){dk(this,b,a,3);this.s||(this.s=[]);b=this.s;var c=this.W,d=this.jc,e=0,d=d?d:[],f=0,g,h;g=0;for(h=a.length;g<h;++g)e=ik(b,e,a[g],c,d[f]),d[f++]=e,e=e[e.length-1];d.length=f;0===d.length?this.s.length=0:(a=d[d.length-1],this.s.length=0===a.length?0:a[a.length-1]);this.R()}else this.ma("XY",null,this.jc)};k.ma=function(a,b,c){ck(this,a,b);this.jc=c;this.R()};function Ep(a){a=a?a:{};this.vb=null;this.vb=vf(a.vb?a.vb:"EPSG:4326");this.td=a.ZB}u(Ep,hp);function jp(a,b){return a?gp((0,Fp[a.type])(a),!1,b):null}function np(a,b){return(0,Gp[a.T()])(gp(a,!0,b),b)}
var Fp={Point:function(a){return new ok(a.coordinates)},LineString:function(a){return new tp(a.coordinates)},Polygon:function(a){return new wk(a.coordinates)},MultiPoint:function(a){return new yp(a.coordinates)},MultiLineString:function(a){return new up(a.coordinates)},MultiPolygon:function(a){return new Cp(a.coordinates)},GeometryCollection:function(a,b){a=a.geometries.map(function(a){return jp(a,b)});return new op(a)}},Gp={Point:function(a){return{type:"Point",coordinates:a.da()}},LineString:function(a){return{type:"LineString",
coordinates:a.da()}},Polygon:function(a,b){var c;b&&(c=b.Bs);return{type:"Polygon",coordinates:a.da(c)}},MultiPoint:function(a){return{type:"MultiPoint",coordinates:a.da()}},MultiLineString:function(a){return{type:"MultiLineString",coordinates:a.da()}},MultiPolygon:function(a,b){var c;b&&(c=b.Bs);return{type:"MultiPolygon",coordinates:a.da(c)}},GeometryCollection:function(a,b){return{type:"GeometryCollection",geometries:a.Pb.map(function(a){var c=ge({},b);delete c.Fe;return np(a,c)})}},Circle:function(){return{type:"GeometryCollection",
geometries:[]}}};function Hp(a,b,c){c=jp(b.geometry,c);var d=new Eg;a.td&&Fg(d,a.td);d.Rc(c);void 0!==b.id&&(d.Mc=b.id,d.R());b.properties&&d.Ac(b.properties);return d}Ep.prototype.Ux=function(a,b){if("Feature"==a.type)return[Hp(this,a,b)];if("FeatureCollection"==a.type){var c=[];a=a.features;var d,e;d=0;for(e=a.length;d<e;++d)c.push(Hp(this,a[d],b));return c}Oa("Unknown geoJSONObject.type: "+a.type);return[]};
function kp(a,b){if(b=b.crs){if("name"==b.type)return vf(b.properties.name);if("EPSG"==b.type)return vf("EPSG:"+b.properties.code);Oa("Unknown crs.type: "+b.type);return null}return a.vb}function lp(a,b,c){c=fp(a,c);a={type:"Feature"};var d=b.Fb();void 0!==d&&(a.id=d);d=b.l();a.geometry=d?np(d,c):null;c=De(b);delete c[b.td];a.properties=je(c)?null:c;return a}function mp(a,b,c){c=fp(a,c);var d=[],e,f;e=0;for(f=b.length;e<f;++e)d.push(lp(a,b[e],c));return{type:"FeatureCollection",features:d}};function Ip(a){return a.getAttributeNS("http://www.w3.org/1999/xlink","href")};function Jp(){}Jp.prototype.read=function(a){if(a instanceof Document)return this.Ro(a);if(a instanceof Node)return this.Gi(a);if("string"===typeof a)return a=Ug(a),this.Ro(a);Oa();return null};function Kp(a){a=Sg(a);return Lp(a)}function Lp(a){if(a=/^\s*(true|1)|(false|0)\s*$/.exec(a))return void 0!==a[1]||!1}function Mp(a){a=Sg(a);if(a=/^\s*(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(Z|(?:([+\-])(\d{2})(?::(\d{2}))?))\s*$/.exec(a)){var b=Date.UTC(parseInt(a[1],10),parseInt(a[2],10)-1,parseInt(a[3],10),parseInt(a[4],10),parseInt(a[5],10),parseInt(a[6],10))/1E3;if("Z"!=a[7]){var c="-"==a[8]?-1:1,b=b+60*c*parseInt(a[9],10);void 0!==a[10]&&(b+=3600*c*parseInt(a[10],10))}return b}}
function Np(a){a=Sg(a);return Op(a)}function Op(a){if(a=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(a))return parseFloat(a[1])}function Pp(a){a=Sg(a);return Qp(a)}function Qp(a){if(a=/^\s*(\d+)\s*$/.exec(a))return parseInt(a[1],10)}function S(a){return Sg(a).trim()}function Rp(a,b){Sp(a,b?"1":"0")}function Tp(a,b){a.appendChild(Rg.createTextNode(b.toPrecision()))}function Up(a,b){a.appendChild(Rg.createTextNode(b.toString()))}function Sp(a,b){a.appendChild(Rg.createTextNode(b))};function Vp(){}u(Vp,Jp);Vp.prototype.Ro=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(1==a.nodeType)return this.Gi(a);return null};Vp.prototype.Gi=function(a){return(a=R({},Wp,a,[]))?a:null};
var Xp=[null,"http://www.opengis.net/ows/1.1"],Wp=Q(Xp,{ServiceIdentification:L(function(a,b){return R({},Yp,a,b)}),ServiceProvider:L(function(a,b){return R({},Zp,a,b)}),OperationsMetadata:L(function(a,b){return R({},$p,a,b)})}),aq=Q(Xp,{DeliveryPoint:L(S),City:L(S),AdministrativeArea:L(S),PostalCode:L(S),Country:L(S),ElectronicMailAddress:L(S)}),bq=Q(Xp,{Value:Yg(function(a){return S(a)})}),cq=Q(Xp,{AllowedValues:L(function(a,b){return R({},bq,a,b)})}),eq=Q(Xp,{Phone:L(function(a,b){return R({},
dq,a,b)}),Address:L(function(a,b){return R({},aq,a,b)})}),gq=Q(Xp,{HTTP:L(function(a,b){return R({},fq,a,b)})}),fq=Q(Xp,{Get:Yg(function(a,b){var c=Ip(a);if(c)return R({href:c},hq,a,b)}),Post:void 0}),iq=Q(Xp,{DCP:L(function(a,b){return R({},gq,a,b)})}),$p=Q(Xp,{Operation:function(a,b){var c=a.getAttribute("name");(a=R({},iq,a,b))&&(b[b.length-1][c]=a)}}),dq=Q(Xp,{Voice:L(S),Facsimile:L(S)}),hq=Q(Xp,{Constraint:Yg(function(a,b){var c=a.getAttribute("name");if(c)return R({name:c},cq,a,b)})}),jq=Q(Xp,
{IndividualName:L(S),PositionName:L(S),ContactInfo:L(function(a,b){return R({},eq,a,b)})}),Yp=Q(Xp,{Title:L(S),ServiceTypeVersion:L(S),ServiceType:L(S)}),Zp=Q(Xp,{ProviderName:L(S),ProviderSite:L(Ip),ServiceContact:L(function(a,b){return R({},jq,a,b)})});function kq(){this.wF=new Vp}u(kq,Jp);kq.prototype.Ro=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(1==a.nodeType)return this.Gi(a);return null};kq.prototype.Gi=function(a){var b=a.getAttribute("version").trim(),c=this.wF.Gi(a);if(!c)return null;c.version=b;return(c=R(c,lq,a,[]))?c:null};function mq(a){var b=S(a).split(" ");if(b&&2==b.length&&(a=+b[0],b=+b[1],!isNaN(a)&&!isNaN(b)))return[a,b]}
var nq=[null,"http://www.opengis.net/wmts/1.0"],oq=[null,"http://www.opengis.net/ows/1.1"],lq=Q(nq,{Contents:L(function(a,b){return R({},pq,a,b)})}),pq=Q(nq,{Layer:Yg(function(a,b){return R({},qq,a,b)}),TileMatrixSet:Yg(function(a,b){return R({},rq,a,b)})}),qq=Q(nq,{Style:Yg(function(a,b){if(b=R({},sq,a,b))return a="true"===a.getAttribute("isDefault"),b.isDefault=a,b}),Format:Yg(S),TileMatrixSetLink:Yg(function(a,b){return R({},tq,a,b)}),Dimension:Yg(function(a,b){return R({},uq,a,b)}),ResourceURL:Yg(function(a){var b=
a.getAttribute("format"),c=a.getAttribute("template");a=a.getAttribute("resourceType");var d={};b&&(d.format=b);c&&(d.template=c);a&&(d.resourceType=a);return d})},Q(oq,{Title:L(S),Abstract:L(S),WGS84BoundingBox:L(function(a,b){a=R([],vq,a,b);if(2==a.length)return Ke(a)}),Identifier:L(S)})),sq=Q(nq,{LegendURL:Yg(function(a){var b={};b.format=a.getAttribute("format");b.href=Ip(a);return b})},Q(oq,{Title:L(S),Identifier:L(S)})),tq=Q(nq,{TileMatrixSet:L(S)}),uq=Q(nq,{Default:L(S),Value:Yg(S)},Q(oq,{Identifier:L(S)})),
vq=Q(oq,{LowerCorner:Wg(mq),UpperCorner:Wg(mq)}),rq=Q(nq,{WellKnownScaleSet:L(S),TileMatrix:Yg(function(a,b){return R({},wq,a,b)})},Q(oq,{SupportedCRS:L(S),Identifier:L(S)})),wq=Q(nq,{TopLeftCorner:L(mq),ScaleDenominator:L(Np),TileWidth:L(Pp),TileHeight:L(Pp),MatrixWidth:L(Pp),MatrixHeight:L(Pp)},Q(oq,{Identifier:L(S)}));function xq(a,b){function c(){delete ce[e];d.parentNode.removeChild(d)}var d=ce.document.createElement("script"),e="olc_"+q(b);d.async=!0;d.src=a+(-1==a.indexOf("?")?"?":"&")+"jsonp="+e;var f=ce.setTimeout(function(){c()},1E4);ce[e]=function(a){ce.clearTimeout(f);c();b(a)};ce.document.getElementsByTagName("head")[0].appendChild(d)};function yq(a){Ho.call(this,{od:a.od,crossOrigin:"anonymous",pe:!0,ea:vf("EPSG:3857"),qf:a.qf,state:"loading",Sc:a.Sc,Sa:void 0!==a.Sa?a.Sa:!0});this.eB=void 0!==a.Th?a.Th:"en-us";this.ix=void 0!==a.Xb?a.Xb:-1;xq("https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+a.wr+"?uriScheme=https&include=ImageryProviders&key="+a.key,this.jD.bind(this))}u(yq,Ho);var zq=new kh({html:'<a class="ol-attribution-bing-tos" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a>'});
yq.prototype.jD=function(a){if(200!=a.statusCode||"OK"!=a.statusDescription||"ValidCredentials"!=a.authenticationResultCode||1!=a.resourceSets.length||1!=a.resourceSets[0].resources.length)this.ub="error";else{var b=a.brandLogoUri;-1==b.indexOf("https")&&(b=b.replace("http","https"));var c=a.resourceSets[0].resources[0],d=-1==this.ix?c.zoomMax:this.ix;a=this.D();a=Yi(a);var e=$i({P:a,Rd:c.zoomMin,Xb:d,ng:c.imageWidth==c.imageHeight?c.imageWidth:[c.imageWidth,c.imageHeight]});this.Db=e;var f=this.eB;
this.uf=An(c.imageUrlSubdomains.map(function(a){var b=[0,0,0],d=c.imageUrl.replace("{subdomain}",a).replace("{culture}",f);return function(a){if(a)return Fi(a[0],a[1],-a[2]-1,b),d.replace("{quadkey}",Gi(b))}}));if(c.imageryProviders){var g=zf(vf("EPSG:4326"),this.D());a=c.imageryProviders.map(function(a){var b=a.attribution,c={};a.coverageAreas.forEach(function(a){var b=a.zoomMin,f=Math.min(a.zoomMax,d);a=a.bbox;a=hf([a[1],a[0],a[3],a[2]],g);var h,l;for(h=b;h<=f;++h)l=h.toString(),b=Pi(e,a,h),l in
c?c[l].push(b):c[l]=[b]});return new kh({html:b,gz:c})});a.push(zq);this.be=mh(a);this.R()}this.Ww=b;this.ub="ready"}this.R()};function Do(a){a=a||{};var b=a.params||{};Ho.call(this,{Na:a.Na,od:a.od,crossOrigin:a.crossOrigin,mb:a.mb,pe:!("TRANSPARENT"in b?b.TRANSPARENT:1),ea:a.ea,qf:a.qf,Db:a.Db,Sc:a.Sc,url:a.url,Kb:a.Kb,Sa:void 0!==a.Sa?a.Sa:!0});this.Sn=void 0!==a.ew?a.ew:0;this.wc=b;this.Wi=!0;this.fk=a.Es;this.Zn=void 0!==a.ul?a.ul:!0;this.bv="";Aq(this);this.OH=Le();this.Em();cj(this,Bq(this))}u(Do,Ho);k=Do.prototype;k.Uq=function(){return this.Sn};k.xj=function(a,b,c){return this.bv+Do.cb.xj.call(this,a,b,c)};
k.ar=function(a,b,c,d,e,f){var g=this.Kb;if(g){f.WIDTH=b[0];f.HEIGHT=b[1];f[this.Wi?"CRS":"SRS"]=e.M;"STYLES"in this.wc||(f.STYLES="");if(1!=d)switch(this.fk){case "geoserver":b=90*d+.5|0;f.FORMAT_OPTIONS="FORMAT_OPTIONS"in f?f.FORMAT_OPTIONS+(";dpi:"+b):"dpi:"+b;break;case "mapserver":f.MAP_RESOLUTION=90*d;break;case "carmentaserver":case "qgis":f.DPI=90*d;break;default:Oa("unknown serverType configured")}e=e.Vm;this.Wi&&"ne"==e.substr(0,2)&&(e=c[0],c[0]=c[1],c[1]=e,e=c[2],c[2]=c[3],c[3]=e);f.BBOX=
c.join(",");return fd(hd([1==g.length?g[0]:g[mf((a[1]<<a[0])+a[2],g.length)]],f))}};k.er=function(a){return this.Zn&&void 0!==this.fk?a:1};function Aq(a){var b=0,c=[];if(a.Kb){var d,e;d=0;for(e=a.Kb.length;d<e;++d)c[b++]=a.Kb[d]}a.bv=c.join("#")}function Bq(a){var b=0,c=[],d;for(d in a.wc)c[b++]=d+"-"+a.wc[d];return c.join("/")}
k.qj=function(a,b,c){var d=this.Db;d||(d=this.Ie(c));if(!(d.kl().length<=a[0])){1==b||this.Zn&&void 0!==this.fk||(b=1);var e=d.na(a[0]),f=Oi(d,a,this.OH),g=Ji(Ui(d,a[0]),this.Am),d=this.Sn;if(0!==d){var h=this.Am;void 0===h&&(h=[0,0]);h[0]=g[0]+2*d;h[1]=g[1]+2*d;g=h;f=Ne(f,e*d,f)}1!=b&&(g=Ii(g,b,this.Am));e={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};ge(e,this.wc);return this.ar(a,g,f,b,c,e)}};
k.updateParams=function(a){ge(this.wc,a);Aq(this);this.Em();cj(this,Bq(this))};k.Em=function(){this.Wi=0<=Rj(this.wc.VERSION||"1.3.0")};function Cq(a,b,c,d,e,f,g){Di.call(this,a,b,c,0,d);this.xe=e;this.aa=new Image;null!==f&&(this.aa.crossOrigin=f);this.Tf={};this.Je=null;this.state=0;this.vr=g}u(Cq,Di);k=Cq.prototype;k.xa=function(a){if(void 0!==a){var b=q(a);if(b in this.Tf)return this.Tf[b];a=je(this.Tf)?this.aa:this.aa.cloneNode(!1);return this.Tf[b]=a}return this.aa};k.Aj=function(){this.state=3;this.qg();this.R()};k.tl=function(){void 0===this.ca&&(this.ca=$e(this.P)/this.aa.height);this.state=2;this.qg();this.R()};
k.load=function(){0==this.state&&(this.state=1,this.R(),this.Je=[re(this.aa,"error",this.Aj,this),re(this.aa,"load",this.tl,this)],this.vr(this,this.xe))};k.qg=function(){this.Je.forEach(me);this.Je=null};function Co(a){a=a||{};ln.call(this,{Na:a.Na,mb:a.mb,ea:a.ea,oc:a.oc});this.dB=void 0!==a.crossOrigin?a.crossOrigin:null;this.Te=a.url;this.vr=void 0!==a.pw?a.pw:rn;this.wc=a.params||{};this.Wi=!0;this.Em();this.fk=a.Es;this.Zn=void 0!==a.ul?a.ul:!0;this.aa=null;this.Dj=[0,0];this.Ib=0;this.Ei=void 0!==a.ratio?a.ratio:1.5}u(Co,ln);k=Co.prototype;
k.Vq=function(a,b,c,d){if(void 0===this.Te)return null;b=mn(this,b);1==c||this.Zn&&void 0!==this.fk||(c=1);a=a.slice();var e=(a[0]+a[2])/2,f=(a[1]+a[3])/2,g=b/c,h=Ze(a)/g,g=$e(a)/g,l=this.aa;if(l&&this.Ib==this.bb&&l.na()==b&&l.Ad==c&&Pe(l.Z(),a))return l;if(1!=this.Ei){var l=this.Ei*Ze(a)/2,n=this.Ei*$e(a)/2;a[0]=e-l;a[1]=f-n;a[2]=e+l;a[3]=f+n}e={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};ge(e,this.wc);this.Dj[0]=Math.ceil(h*this.Ei);this.Dj[1]=Math.ceil(g*
this.Ei);d=this.ar(a,this.Dj,c,d,e);this.aa=new Cq(a,b,c,this.be,d,this.dB,this.vr);this.Ib=this.bb;J(this.aa,"change",this.iD,this);return this.aa};
k.ar=function(a,b,c,d,e){e[this.Wi?"CRS":"SRS"]=d.M;"STYLES"in this.wc||(e.STYLES="");if(1!=c)switch(this.fk){case "geoserver":c=90*c+.5|0;e.FORMAT_OPTIONS="FORMAT_OPTIONS"in e?e.FORMAT_OPTIONS+(";dpi:"+c):"dpi:"+c;break;case "mapserver":e.MAP_RESOLUTION=90*c;break;case "carmentaserver":case "qgis":e.DPI=90*c;break;default:Oa("unknown serverType configured")}e.WIDTH=b[0];e.HEIGHT=b[1];b=d.Vm;e.BBOX=(this.Wi&&"ne"==b.substr(0,2)?[a[1],a[0],a[3],a[2]]:a).join(",");return fd(hd([this.Te],e))};
k.Jy=function(a){a!=this.Te&&(this.Te=a,this.aa=null,this.R())};k.updateParams=function(a){ge(this.wc,a);this.Em();this.aa=null;this.R()};k.Em=function(){this.Wi=0<=Rj(this.wc.VERSION||"1.3.0")};function Dq(a){this.DE=a.CE;Ki.call(this,{P:a.P,origin:a.origin,Lo:a.Lo,oc:a.oc,ng:a.ng,qp:a.qp,sizes:a.sizes})}u(Dq,Ki);
function Eq(a,b){var c=[],d=[],e=[],f=[],g=[],h;h=vf(a.SupportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"));var l=yf(h),n="ne"==h.Vm.substr(0,2);a.TileMatrix.sort(function(a,b){return b.ScaleDenominator-a.ScaleDenominator});a.TileMatrix.forEach(function(a){d.push(a.Identifier);var b=2.8E-4*a.ScaleDenominator/l,h=a.TileWidth,r=a.TileHeight;n?e.push([a.TopLeftCorner[1],a.TopLeftCorner[0]]):e.push(a.TopLeftCorner);c.push(b);f.push(h==r?h:[h,r]);g.push([a.MatrixWidth,-a.MatrixHeight])});
return new Dq({P:b,Lo:e,oc:c,CE:d,qp:f,sizes:g})};function Fq(a){function b(a){a="KVP"==d?fd(hd([a],f)):a.replace(/\{(\w+?)\}/g,function(a,b){return b.toLowerCase()in f?f[b.toLowerCase()]:a});return function(b){if(b){var c={TileMatrix:e.DE[b[0]],TileCol:b[1],TileRow:-b[2]-1};ge(c,g);b=a;return b="KVP"==d?fd(hd([b],c)):b.replace(/\{(\w+?)\}/g,function(a,b){return c[b]})}}}this.Hm=void 0!==a.version?a.version:"1.0.0";this.Pq=void 0!==a.format?a.format:"image/jpeg";this.Dq=void 0!==a.hv?a.hv:{};this.oo=a.layer;this.EE=a.zo;this.tf=a.style;var c=a.Kb;
void 0===c&&void 0!==a.url&&(c=Cn(a.url));var d=this.wG=void 0!==a.fm?a.fm:"KVP",e=a.Db,f={layer:this.oo,style:this.tf,tilematrixset:this.EE};"KVP"==d&&ge(f,{Service:"WMTS",Request:"GetTile",Version:this.Hm,Format:this.Pq});var g=this.Dq,h=c&&0<c.length?An(c.map(b)):Bn;Ho.call(this,{Na:a.Na,od:a.od,crossOrigin:a.crossOrigin,mb:a.mb,ea:a.ea,qf:a.qf,xm:a.xm,Db:e,Sc:a.Sc,mg:a.mg,uf:h,Kb:c,Sa:void 0!==a.Sa?a.Sa:!1});cj(this,Gq(this))}u(Fq,Ho);Fq.prototype.xb=function(){return this.oo};
function Gq(a){var b=0,c=[],d;for(d in a.Dq)c[b++]=d+"-"+a.Dq[d];return c.join("/")}
function Hq(a,b){var c=Lg(a.Contents.Layer,function(a){return a.Identifier==b.layer}),d=a.Contents.TileMatrixSet,e,f;e=1<c.TileMatrixSetLink.length?"projection"in b?Pg(c.TileMatrixSetLink,function(a){return Lg(d,function(b){return b.Identifier==a.TileMatrixSet}).SupportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3")==b.projection}):Pg(c.TileMatrixSetLink,function(a){return a.TileMatrixSet==b.matrixSet}):0;0>e&&(e=0);f=c.TileMatrixSetLink[e].TileMatrixSet;var g=c.Format[0];"format"in b&&
(g=b.format);e=Pg(c.Style,function(a){return"style"in b?a.Title==b.style:a.isDefault});0>e&&(e=0);e=c.Style[e].Identifier;var h={};"Dimension"in c&&c.Dimension.forEach(function(a){var b=a.Identifier,c=a.Default;void 0===c&&(c=a.Value[0]);h[b]=c});var l=Lg(a.Contents.TileMatrixSet,function(a){return a.Identifier==f}),n;n="projection"in b?vf(b.projection):vf(l.SupportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"));var r=c.WGS84BoundingBox,t,v;void 0!==r&&(v=vf("EPSG:4326").Z(),v=r[0]==
v[0]&&r[2]==v[2],t=Lf(r,"EPSG:4326",n),(r=n.Z())&&(Pe(r,t)||(t=void 0)));var l=Eq(l,t),x=[];t=b.requestEncoding;t=void 0!==t?t:"";if(a.hasOwnProperty("OperationsMetadata")&&a.OperationsMetadata.hasOwnProperty("GetTile")&&0!==t.indexOf("REST"))for(a=a.OperationsMetadata.GetTile.DCP.HTTP.Get,c=0,r=a.length;c<r;++c){var y=Lg(a[c].Constraint,function(a){return"GetEncoding"==a.name}).AllowedValues.Value;0<y.length&&0<=y.indexOf("KVP")&&(t="KVP",x.push(a[c].href))}else t="REST",c.ResourceURL.forEach(function(a){"tile"==
a.resourceType&&(g=a.format,x.push(a.template))});return{Kb:x,layer:b.layer,zo:f,format:g,ea:n,fm:t,Db:l,style:e,hv:h,Sa:v}};function Iq(a){if(null==a)return console.error("opt_options undefied"),0;if(null==a.properties)return console.error("opt_options.properties undefied"),0;this.properties=a.properties}
Iq.prototype.Rn=function(a,b){b=null!=b?b:{};if(null==a)return console.error("oMapDefinition is not defined: "+a),null;if(null==a.children)return console.error("oMapDefinition.children is not defined: "+a),null;if(null==a.children[0])return console.error("oMapDefinition.children[0] is not defined: "+a),null;if(null==a.children[0].view)return console.error("oMapDefinition.children[0].view is not defined: "+a),null;a=a.children[0].view;var c={};c.qa=null!=a.center?a.center:[0,0];c.zoom=null!=a.zoom?
a.zoom:0;c.jn=a.constrainRotation;c.wv=a.enableRotation;c.P=a.maxExtent;c.Ke=a.maxResolution;c.le=a.minResolution;c.Xb=a.maxZoom;c.Rd=a.minZoom;c.ea=a.projection;c.ca=a.resolution;c.oc=a.resolutions;c.rotation=a.rotation;c.Sz=a.zoomFactor;c=new Ek(c);null!=a.extent&&(null!=b.size?Lk(c,a.extent,b.size,{Ai:!0}):console.error("Cannot calc olView.extent if opt_options.size is not defined"));return c};Iq.prototype.getViewFromDef=Iq.prototype.Rn;
Iq.prototype.Xq=function(a,b){b=null!=b?b:{};if(null==a)return console.error("oMapDefinition is not defined: "+a),null;if(null==a.children)return console.error("oMapDefinition.children is not defined: "+a),null;if(null==b.size)return console.error("opt_options.size not defined"),null;if(null==b.tileSize)return console.error("opt_options.tileSize not defined"),null;var c,d;d=a.children;for(var e=[],f=1;f<d.length;f++)for(c=0;c<d[f].children.length;c++)e.push(d[f].children[c]);d=e=Jq(e);e=[];for(f=
0;f<d.length;f++)c=Kq(this,a,d[f],b),null!=c&&(c=Lq(d[f],c),null!=c&&e.push(c));return e};Iq.prototype.getLayersFromDef=Iq.prototype.Xq;
Iq.prototype.cw=function(a,b){b=null!=b?b:{};var c=this.Rn(a,b);if(null==c)return null;if(null==b.tileSize)return console.error("opt_options.tileSize not defined"),null;if(null==b.size)return console.error("opt_options.size not defined"),null;a=Hk(c,b.size);for(var c=c.D().Z(),d=Ze(c)/256,e=Array(22),f=0,g=e.length;f<g;++f)e[f]=d/Math.pow(2,f);return new Ki({origin:ff(a),P:c,oc:e,ng:b.tileSize})};Iq.prototype.getTileGridFromDef=Iq.prototype.cw;
function Jq(a){a.sort(function(a,c){return a.index<c.index?-1:a.index>c.index?1:0});return a}
function Kq(a,b,c,d){d=null!=d?d:{};if(null==d.tileSize)return console.error("opt_options.tileSize not defined"),null;if(null==d.size)return console.error("opt_options.size not defined"),null;var e=c.layerType;null!=c.params&&!0===c.is_dynamic&&(c.params.TIMESTAMP=Date.now());if("tilewms"===e||"imagewms"===e)null!=c.params.STYLES||null!=c.params.styles||(c.params.STYLES=""),null!=c.tileLoadFunction||(c.tileLoadFunction=function(a,b){b=b.replace("STYLES&","STYLES=&");a.xa().src=b});if("bing"===e)c=
new yq({key:c.key,Sa:c.wrapX,Th:c.culture,Xb:c.maxZoom,Sc:c.tileLoadFunction,wr:c.imagerySet});else if("tilewms"===e)c=new Do({url:a.properties.use_proxy_for_tiles&&null!=C?Mq(c.url):c.url,Kb:a.properties.use_proxy_for_tiles&&null!=C?Mq(c.urls):c.urls,mb:c.logo,ul:c.hidpi,Sa:c.wrapX,ew:c.gutter,Xb:c.maxZoom,Db:a.cw(b,d),ea:c.projection,Es:c.serverType,crossOrigin:c.crossOrigin,Sc:c.tileLoadFunction,params:c.params});else if("imagewms"===e)c=new Co({url:a.properties.use_proxy_for_tiles&&null!=C?Mq(c.url):
c.url,mb:c.logo,ul:c.hidpi,ratio:c.ratio,ea:c.projection,Es:c.serverType,oc:c.resolutions,crossOrigin:c.crossOrigin,Na:c.attributions,pw:c.imageLoadFunction,params:c.params});else if("imagevector"===e){if(c.features)a=new sh({features:c.features});else if(c.url)a=new sh({format:new Ep,url:a.properties.use_proxy_for_tiles&&null!=C?Mq(c.url):c.url});else{console.error("Error: veuillez renseinger une url ou une feature");return}c=new tn({style:null!=c.style?c.style:new yg({fill:new ug({color:"rgba(255, 255, 255, 0.6)"}),
stroke:new wg({color:"#319FD3",width:1})}),source:a})}else if("wmts"===e){var f;if(null==c.service_options)return console.error("oLayerDef.service_options undefined"),null;try{var g=JSON.parse(c.service_options);f=Hq(g,{layer:c.layer,matrixSet:c.matrixSet,requestEncoding:c.requestEncoding,style:c.style,format:c.format});null!=c.style&&(f.style=c.style)}catch(h){console.error("error while parsing options")}c=new Fq(f)}else"xyz"===e?c=new Lo({url:c.url}):"osm"===e?(null!=c.url&&""!==c.url||(c.url="https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png"),
c=new Mo({url:c.url})):(console.error("Error: layerType ("+e+") is not supported"),c=null);return c}
function Lq(a,b){var c=a.layerType;b="imagewms"===c||"imagevector"===c?new nm({source:b}):new om({source:b});b.set("type",c);b.set("name",a.name);b.set("legend",!0);b.set("queryable",!0);"imagewms"!==c&&"tilewms"!==c&&b.set("queryable",!1);a.select=!0;b.set("select",!0);!0===a.bo_queryable&&(b.set("bo_queryable",!0),null!=a.bo_user_rights&&b.set("bo_user_rights",a.bo_user_rights));b.set("layer_id",a.layer_id);null!=a.bo_id&&b.set("bo_id",a.bo_id);null!=a.bo_title&&b.set("bo_title",a.bo_title);null!=
a.bo_id_field&&b.set("bo_id_field",a.bo_id_field);null!=a.bo_search_field&&b.set("bo_search_field",a.bo_search_field);null!=a.bo_result_field&&b.set("bo_result_field",a.bo_result_field);null!=a.bo_search_use_strict&&b.set("bo_search_use_strict",a.bo_search_use_strict);null!=a.bo_geom_column&&b.set("bo_geom_column",a.bo_geom_column);null!=a.bo_geom_type&&b.set("bo_geom_type",a.bo_geom_type);null!=a.bo_index&&b.set("bo_index",a.bo_index);null!=a.events&&(db(a.events),b.set("events",a.events));null!=
a.is_dynamic&&b.set("is_dynamic",a.is_dynamic);null!=a.is_filtered&&null!=a.filter_form&&p(a.filter_form)&&0!==a.filter_form.length&&(a.filter_form=JSON.parse(a.filter_form),a.filter_values=Nq(a.filter_form),b.set("filter_form",a.filter_form),b.set("is_filtered",a.is_filtered),b.set("filter_values",a.filter_values),b.applyFilter=function(){if(null!=this.get("filter_values")&&null!=this.get("filter_values").search){var a;b:{var b=this.get("filter_values").search;try{a=vb(b)}catch(l){a={};break b}for(var c in a)if(ka(a[c])){if(null!=
a[c].selectedOption)if(null!=a[c].selectedOption.value)a[c]=a[c].selectedOption.value;else if(fa(a[c].selectedOption)){for(var b=[],g=0;g<a[c].selectedOption.length;g++)null!=a[c].selectedOption[g].value&&b.push(a[c].selectedOption[g].value);a[c]=angular.copy(b)}else delete a[c]}else null!=a[c]||delete a[c]}if(this.v()instanceof Co||this.v()instanceof Do){c=this.v().wc;for(var h in a)fa(a[h])?c[h]=a[h].join("|"):c[h]=a[h],null!=c[h]&&(fa(c[h])&&ka(c[h])?delete c[h]:p(c[h])&&""===c[h]&&delete c[h]);
this.v().updateParams(c);this.v().refresh()}}},b.applyFilter());a.visible="true"===a.visible||!0===a.visible?!0:!1;b.setVisible(a.visible);null!=a.opacity&&b.Hs(a.opacity);a.olLayer=b;b.values=b.xh;return b}
function Nq(a){var b={},c;for(c in a)if("datasources"!==c){b[c]={};for(var d=0;d<a[c].rows.length;d++)for(var e=0;e<a[c].rows[d].fields.length;e++){var f=a[c].rows[d].fields[e].name,g=a[c].rows[d].fields[e].default_value;null!=b[c][f]?null!=g&&""===b[c][f]&&(b[c][f]=g):(b[c][f]="",null!=g&&(b[c][f]=g))}}return b};function Oq(){C.log("nsVmap.nsMapManager.LayersTree")}ta("nsVmap.nsMapManager.LayersTree",Oq);Oq.prototype.dE=function(){C.log("nsVmap.nsMapManager.LayersTree.prototype.layertreeDirective");return{restrict:"A",scope:{map:"=appMap",proj:"=appProj",lang:"=appLang"},controller:"AppLayertreeController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/layers/layertree.html"}};
Oq.prototype.eb=function(a,b){C.log("nsVmap.nsMapManager.LayersTree.prototype.LayertreeController");var c=this;this.ek=a;this.ow=b;a.tree=C.oa.ei();this.properties=C.properties;this.token=C.properties.token;this.olFilteredLayer={};this.refreshLayersEvents=[];null!=C.properties.vmap&&(this.layers_collapsed=C.properties.vmap.layers_collapsed,this.layerstree_collapsed=C.properties.vmap.layerstree_collapsed);this.Ij();if(null!=z.oWebsocket)z.oWebsocket.on("event",function(a){for(var b=0;b<c.refreshLayersEvents.length;b++)c.refreshLayersEvents[b].event===
a&&C.bRefreshWebsockets&&null!=c.refreshLayersEvents[b].layer&&null!=c.refreshLayersEvents[b].layer.jd&&c.refreshLayersEvents[b].layer.jd(!0)})};Oq.prototype.LayertreeController=Oq.prototype.eb;Oq.prototype.eb.$inject=["$scope","$http"];Oq.prototype.eb.prototype.setVisible=function(a,b){C.log("nsVmap.nsMapManager.LayersTree.prototype.LayertreeController.prototype.setVisible",b);a.setVisible(b);this.map.ka()};Oq.prototype.eb.prototype.setVisible=Oq.prototype.eb.prototype.setVisible;
Oq.prototype.eb.prototype.UG=function(a){for(var b=0;b<a.children.length;b++)void 0!==a.children[b].olLayer.get("select")&&a.children[b].olLayer.set("select",a.selectable);this.jx(a)};Oq.prototype.eb.prototype.setGroupSelectable=Oq.prototype.eb.prototype.UG;Oq.prototype.eb.prototype.$D=function(a){for(var b=0,c=0;c<a.children.length;c++)!0===a.children[c].olLayer.getVisible(a.visible)&&b++;return b===a.children.length?!0:0===b?!1:null};Oq.prototype.eb.prototype.isGroupVisible=Oq.prototype.eb.prototype.$D;
Oq.prototype.eb.prototype.VG=function(a){for(var b=0;b<a.children.length;b++)a.children[b].olLayer.setVisible(a.visible);this.kx(a)};Oq.prototype.eb.prototype.setGroupVisible=Oq.prototype.eb.prototype.VG;Oq.prototype.eb.prototype.jx=function(a){if(void 0!==a){var b=a.children;void 0===a.cp&&(a.cp=[]);for(var c=a.cp.length=0;c<b.length;c++)!0===b[c].olLayer.get("select")&&a.cp.push(b[c].olLayer);a.selectable=0===a.cp.length?!1:!0}};Oq.prototype.eb.prototype.memoriseGroupSelectable=Oq.prototype.eb.prototype.jx;
Oq.prototype.eb.prototype.kx=function(a){if(void 0!==a){var b=a.children;void 0===a.Ep&&(a.Ep=[]);for(var c=a.Ep.length=0;c<b.length;c++)!0===b[c].olLayer.getVisible()&&a.Ep.push(b[c].olLayer);a.visible=0===a.Ep.length?!1:!0}};Oq.prototype.eb.prototype.memoriseGroupVisible=Oq.prototype.eb.prototype.kx;
Oq.prototype.eb.prototype.am=function(){C.log("nsVmap.nsMapManager.LayersTree.prototype.LayertreeController.prototype.reloadTree");var a=jQuery.extend(!0,{},C.oa.ei());C.oa.Mi(a);0<this.map.getLayers().L().length&&this.map.getLayers().clear();this.ek.tree=a;this.Ij();C.hm(!1)};Oq.prototype.eb.prototype.reloadTree=Oq.prototype.eb.prototype.am;
Oq.prototype.eb.prototype.Ij=function(){C.log("nsVmap.nsMapManager.LayersTree.prototype.LayertreeController.prototype.loadTree");0<this.map.getLayers().L().length&&this.map.getLayers().clear();C.log(this.ek.tree);var a=[C.properties.vmap.wmsTilesWidth,C.properties.vmap.wmsTilesHeight],b=new Iq({properties:C.properties}),c=b.Rn(this.ek.tree,{size:this.map.ja(),tileSize:a}),a=b.Xq(this.ek.tree,{size:this.map.ja(),tileSize:a});C.log("nsVmap.nsMapManager.LayersTree.prototype.LayertreeController.prototype.addView");
var d=Hk(H(this.map),this.map.ja()),b=H(this.map).D().M,e=c.D().M;c.set("homePosition",{qa:c.Da(),ca:c.na()});var f=H(this.map).get("homePosition");C.g().Fy(c);this.map.lh(c);this.proj=c.D().M;if(m(b)&&m(e)&&m(d)&&m(f))for(d=Lf(d,b,e),Lk(H(this.map),d,this.map.ja(),{Ai:!0}),d=C.g(),C.log("nsVmap.Map.prototype.reprojectFeatures"),f=0;f<d.Qg.length;f++)for(var g=d.Qg[f].v(),h=b,l=e,g=g.Ka(),n=0;n<g.length;n++)g[n].Rc(g[n].l().transform(h,l));b=C.B.vc.cf().Zv();void 0!==b&&b.Vd.lh(new Ek({ca:De(c).ca,
rotation:De(c).rotation,qa:De(c).qa,ea:c.D().M}));$("#current-projection").html(C.oProjections[H(this.map).D().M]);Ua(this.refreshLayersEvents);for(c=0;c<a.length;c++)if(b=a[c].get("events"),fa(b))for(db(b),e=0;e<b.length;e++)this.refreshLayersEvents.push({layer:a[c],event:b[e]});for(c=0;c<a.length;c++)this.rb(a[c])};Oq.prototype.eb.prototype.rb=function(a){C.log("nsVmap.nsMapManager.LayersTree.prototype.LayertreeController.prototype.addLayer");this.map.rb(a);C.Gw()};
Oq.prototype.eb.prototype.pB=function(a){C.log("nsVmap.nsMapManager.LayersTree.LayertreeController.displayFilterLayerModal");this.olFilteredLayer=a;null!=a.get("filter_form")||a.set("filter_form",{search:{}});null!=a.get("filter_values")||a.set("filter_values",{search:{}});var b=a.get("filter_form"),c=a.get("filter_values"),d={fields:[{type:"button","class":"btn-ungroup btn-group-sm hidden",nb_cols:12,buttons:[{visibleAllTabs:!0,id:"layerstree_filter_formreader_submit_btn",type:"submit",label:"FORM_UPDATE",
name:"form_submit","class":"btn-primary"}]}]};angular.equals(b.search.rows[b.search.rows.length-1],d)||b.search.rows.push(d);b.search.event=function(b){a.set("filter_values",b);a.applyFilter();$("#layerstree-filter-modal").modal("hide");$.notify("Op\u00e9ration r\u00e9alis\u00e9e avec succ\u00e8s, les couches de la carte se mettent \u00e0 jour","info")};var e=angular.element($("#layerstree_filter_formreader").children()).scope();e.$evalAsync(function(){e.ctrl.setDefinitionName("search");e.ctrl.setFormValues(c);
e.ctrl.setFormDefinition(b);e.ctrl.loadForm();$("#layerstree-filter-modal").modal("show")})};Oq.prototype.eb.prototype.displayFilterLayerModal=Oq.prototype.eb.prototype.pB;C.module.directive("appLayertree",Oq.prototype.dE);C.module.controller("AppLayertreeController",Oq.prototype.eb);function Pq(){C.log("nsVmap.nsMapManager.LayersOrder")}ta("nsVmap.nsMapManager.LayersOrder",Pq);Pq.prototype.Iw=function(){C.log("nsVmap.nsMapManager.LayersOrder.prototype.layersorderDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang"},controller:"AppLayersorderController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/layers/layersorder.html"}};Pq.prototype.layersorderDirective=Pq.prototype.Iw;
Pq.prototype.Wf=function(){C.log("nsVmap.nsMapManager.LayersOrder.prototype.layersorderController");var a=this;this.selectedLayers=this.map.getLayers().L().slice().reverse();null!=C.properties.vmap&&(this.layersorder_collapsed=C.properties.vmap.layersorder_collapsed);zo(C.g().F).on("change",function(){this.selectedLayers=this.map.getLayers().L().slice().reverse()},this);var b=$(".sortable-list").sortable({handle:".sortable-handle",onDrop:function(c,d){c.removeClass(d.group.options.draggedClass).removeAttr("style");
$("body").removeClass(d.group.options.bodyClass);data=b.sortable("serialize").get();c=data[0];d=a.selectedLayers;C.g().F.getLayers().clear();for(var e=c.length-1;0<=e;e--)for(var f=0;f<d.length;f++)d[f].$$hashKey===c[e].hashkey&&C.g().F.getLayers().push(d[f])},onDragStart:function(a,b,e){var c=a.offset(),d=b.rootGroup.pointer;adjustment={left:d.left-c.left,top:d.top-c.top};e(a,b)},onDrag:function(a,b){a.css({left:b.left-adjustment.left,top:b.top-adjustment.top})}})};
Pq.prototype.layersorderController=Pq.prototype.Wf;Pq.prototype.Wf.$inject=["$scope"];Pq.prototype.Wf.prototype.setVisible=function(a,b){C.log("nsVmap.nsMapManager.LayersOrder.prototype.layersorderController.prototype.setVisible",b);a.setVisible(b);this.map.ka()};Pq.prototype.Wf.prototype.setVisible=Pq.prototype.Wf.prototype.setVisible;
Pq.prototype.Wf.prototype.$G=function(a){var b=a.get("select"),c=C.oa.ei();a.set("select",!b);for(var d=0;d<c.children.length;d++)if(c.children[d].children){oService=c.children[d].children;for(var e=0;e<oService.length;e++)oService[e].olLayer.$$hashKey===a.$$hashKey&&(oService[e].select=!b)}};Pq.prototype.Wf.prototype.setSelectable=Pq.prototype.Wf.prototype.$G;C.module.directive("appLayersorder",Pq.prototype.Iw);C.module.controller("AppLayersorderController",Pq.prototype.Wf);function Qq(){C.log("nsVmap.nsMapManager.MapLegend")}ta("nsVmap.nsMapManager.MapLegend",Qq);Qq.prototype.ex=function(){C.log("nsVmap.nsMapManager.MapLegend.prototype.maplegendDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang"},controller:"AppMaplegendController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/layers/maplegend.html"}};Qq.prototype.maplegendDirective=Qq.prototype.ex;
Qq.prototype.gx=function(){C.log("nsVmap.nsMapManager.MapLegend.prototype.maplegendImageDirective");return{link:function(a,b){var c=0;$(b).mouseenter(function(){c++;var d=angular.copy(c);setTimeout(function(){if(d===c){var e;$("[app-maplegend]").popover({html:!0,content:'<img src="'+a.node.legendURL+'" class="img-responsive">',placement:function(a){e=a;return"right"}});$("[app-maplegend]").popover("show");setTimeout(function(){var a=$(b).offset().top,c=$(b).find("img").height(),a=a-c/2;$(e).css("top",
a+"px")})}},500)}).mouseleave(function(){c++;$("[app-maplegend]").popover("destroy")})}}};Qq.prototype.maplegendImageDirective=Qq.prototype.gx;Qq.prototype.Mj=function(){C.log("nsVmap.nsMapManager.MapLegend.prototype.maplegendController");var a=this;this.aUrls=[];null!=C.properties.vmap&&(this.legend_collapsed=C.properties.vmap.legend_collapsed);C.scope.$on("layersChanged",function(){a.Jr()});setTimeout(function(){a.Jr()})};Qq.prototype.maplegendController=Qq.prototype.Mj;
Qq.prototype.Mj.$inject=["$http","$scope"];
Qq.prototype.Mj.prototype.Jr=function(){C.log("nsVmap.nsMapManager.MapLegend.maplegendController.loadLegend");for(var a=C.g().F.getLayers().L(),b={},c=0;c<a.length;c++)if(!0===a[c].get("legend"))if("tilewms"===a[c].get("type")){var d=a[c].get("name");b[d]=[];for(var e=0;e<a[c].v().Kb.length;e++)for(var f=a[c].v().wc.LAYERS.split(","),g=0;g<f.length;g++){var h=-1!==a[c].v().Kb[e].indexOf("?")?"&":"?";b[d].push({layerId:c,collapsed:!1,url:a[c].v().Kb[e],layer:f[g],olLayer:a[c],layerName:a[c].get("name"),
legendURL:a[c].v().Kb[e]+h+"request=GetLegendGraphic&LAYER="+f[g]+"&FORMAT=image/png&VERSION=1.1.0&service=wms"})}}else if("imagewms"===a[c].get("type"))for(d=a[c].get("name"),f=a[c].v().wc.LAYERS.split(","),b[d]=[],g=0;g<f.length;g++)h=-1!==a[c].v().Te.indexOf("?")?"&":"?",b[d].push({layerId:c,collapsed:!1,url:a[c].v().Te,layer:f[g],olLayer:a[c],layerName:a[c].get("name"),legendURL:a[c].v().Te+h+"request=GetLegendGraphic&LAYER="+f[g]+"&FORMAT=image/png&VERSION=1.1.0&service=wms"});this.oUrls=b};
Qq.prototype.Mj.prototype.loadLegend=Qq.prototype.Mj.prototype.Jr;C.module.directive("appMaplegend",Qq.prototype.ex);C.module.directive("legendImageNode",Qq.prototype.gx);C.module.controller("AppMaplegendController",Qq.prototype.Mj);function Rq(){C.log("nsVmap.nsMapManager.nsMapModal.MapList")}ta("nsVmap.nsMapManager.nsMapModal.MapList",Rq);Rq.prototype.TA=function(a){C.log("nsVmap.nsMapManager.nsMapModal.MapList.prototype.changeFilePath");var b=$(a).val(),c=b.lastIndexOf("\\");-1!==c&&(b=b.slice(c+1));$("#upload-file-info").val(b);$("#upload-file-add-button").attr("url","");$("#upload-file-add-button").attr("file-container",a.id)};Rq.prototype.changeFilePath=Rq.prototype.TA;
Rq.prototype.yE=function(){C.log("nsVmap.nsMapManager.nsMapModal.MapList.prototype.maplistDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppMaplistController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/layers/mapmodal/maplist.html"}};
Rq.prototype.Sg=function(){C.log("nsVmap.nsMapManager.nsMapModal.MapList.prototype.maplistController");this.newMapUrl="";this.catalog=C.oa.ne.dc;this.projections=C.oProjections;this.mapForm={view:{}};var a=document.getElementById("maplist-file-drop-zone");a.addEventListener("dragover",function(a){this.className="upload-drop-zone drop";a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy";return!1},!1);a.addEventListener("dragleave",function(){this.className="upload-drop-zone";return!1},
!1);a.addEventListener("drop",function(a){a.stopPropagation();a.preventDefault();this.files=a=a.dataTransfer.files;$("#upload-file-info").val(a[0].name);$("#upload-file-add-button").attr("file-container",this.id);this.className="upload-drop-zone";return!1},!1)};Rq.prototype.maplistController=Rq.prototype.Sg;
Rq.prototype.Sg.prototype.TD=function(){C.log("nsVmap.nsMapManager.nsMapModal.MapList.prototype.initNewMapForm");this.mapForm.view={center:H(this.map).Da(),zoom:H(this.map).df(),maxZoom:28,minZoom:0,projection:H(this.map).D().M}};Rq.prototype.Sg.prototype.initNewMapForm=Rq.prototype.Sg.prototype.TD;
Rq.prototype.Sg.prototype.cB=function(){C.log("nsVmap.nsMapManager.nsMapModal.MapList.prototype.createNewMap");C.oa.Mi({name:"Tree",children:[{view:this.mapForm.view}]});C.oa.Ii();for(var a=C.oa.dc,b=0;b<a.maps.length;b++)a.maps[b].used=!1;C.Gw()};Rq.prototype.Sg.prototype.createNewMap=Rq.prototype.Sg.prototype.cB;C.module.directive("appMaplist",Rq.prototype.yE);C.module.controller("AppMaplistController",Rq.prototype.Sg);function Sq(){C.log("nsVmap.nsMapManager.nsMapModal.MapListLitle")}ta("nsVmap.nsMapManager.nsMapModal.MapListLitle",Sq);Sq.prototype.zE=function(){C.log("nsVmap.nsMapManager.nsMapModal.MapListLitle.prototype.maplistlitleDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppMaplistlitleController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/layers/mapmodal/maplistlitle.html"}};
Sq.prototype.Lr=function(a){C.log("nsVmap.nsMapManager.nsMapModal.MapListLitle.prototype.maplistlitleController");var b=this;this.catalog=C.oa.ne.dc;a.filter="";a.themes=Tq(this.catalog.maps);a.mapsByThemes=[];a.filterTheme="";a.$watchGroup(["filter","filterTheme"],function(){var c=Sa(b.catalog.maps,function(b){var c=Rd(String(a.filter).toLowerCase()),d=Rd(String(b.name).toLowerCase()),g=Rd(String(b.description).toLowerCase());b=Rd(String(b.theme_name).toLowerCase());b="null"===b?"autres":b;return-1!==
d.indexOf(c)||-1!==g.indexOf(c)||-1!==b.indexOf(c)?""===a.filterTheme||a.filterTheme.toLowerCase()===b?!0:!1:!1});a.mapsByThemes=Uq(c)});$("body").click(function(a){$.contains($("#maplistlitle-container")[0],$(a.target)[0])||$("#maplistlitle-container").removeClass("open")});$(".maplist-map").click(function(){$("#maplistlitle-container").removeClass("open")})};Sq.prototype.maplistlitleController=Sq.prototype.Lr;Sq.prototype.Lr.$inject=["$scope"];
function Uq(a){for(var b={},c=0;c<a.length;c++)m(b[a[c].theme_name])?b[a[c].theme_name].push(a[c]):b[a[c].theme_name]=[a[c]];return b}function Tq(a){for(var b=[],c,d=0;d<a.length;d++)c=null===a[d].theme_name?"Autres":a[d].theme_name,-1===b.indexOf(c)&&b.push(c);return b}C.module.directive("appMaplistlitle",Sq.prototype.zE);C.module.controller("AppMaplistlitleController",Sq.prototype.Lr);function Vq(){C.log("nsVmap.nsMapManager.nsMapModal.MyMap")}ta("nsVmap.nsMapManager.nsMapModal.MyMap",Vq);Vq.prototype.bF=function(){C.log("nsVmap.nsMapManager.nsMapModal.MyMap.prototype.mymapDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppMymapController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/layers/mapmodal/mymap.html"}};
Vq.prototype.xd=function(){C.log("nsVmap.nsMapManager.nsMapModal.MyMap.prototype.mymapController");this.mapFileHref="";this.oLayersTree={};this.view=this.view={};this.displayedView={};var a=!!document.documentMode,b=!a&&!!window.StyleMedia;this.isIE=!0===a||!0===b};Vq.prototype.mymapController=Vq.prototype.xd;
Vq.prototype.xd.prototype.am=function(){C.log("nsVmap.nsMapManager.nsMapModal.MyMap.prototype.mymapController.prototype.reloadTree");this.oLayersTree=C.oa.ei();this.view={zoom:H(C.g().F).df(),center:H(C.g().F).Da(),projection:H(C.g().F).D().M,extent:Hk(H(this.map),this.map.ja())};this.displayedView={zoom:this.view.zoom,center:this.view.center[0]+", "+this.view.center[1],projection:C.oProjections[this.view.projection],extent:this.view.extent[0]+", "+this.view.extent[1]+", "+this.view.extent[3]+", "+
this.view.extent[3]};this.Xx();$('[data-toggle="tooltip"]').tooltip()};Vq.prototype.xd.prototype.reloadTree=Vq.prototype.xd.prototype.am;Vq.prototype.xd.prototype.ak=function(a){C.log("nsVmap.nsMapManager.nsMapModal.MyMap.prototype.mymapController.prototype.removeLayer");C.oa.ak(a);this.am()};Vq.prototype.xd.prototype.removeLayer=Vq.prototype.xd.prototype.ak;
Vq.prototype.xd.prototype.Xx=function(){C.log("nsVmap.nsMapManager.nsMapModal.MyMap.prototype.mymapController.prototype.reloadMapFile");var a=C.oa.Nn();this.mapFileHref=a="data:text/json;charset=utf-8,"+encodeURIComponent(a);$("#exportMapButton").attr("href",a)};Vq.prototype.xd.prototype.reloadMapFile=Vq.prototype.xd.prototype.Xx;
Vq.prototype.xd.prototype.EB=function(){C.log("nsVmap.nsMapManager.nsMapModal.MyMap.prototype.mymapController.prototype.downloadBlob");var a=new Blob([C.oa.Nn()]);window.navigator.msSaveBlob(a,"map.json")};Vq.prototype.xd.prototype.downloadBlob=Vq.prototype.xd.prototype.EB;C.module.directive("appMymap",Vq.prototype.bF);C.module.controller("AppMymapController",Vq.prototype.xd);function Wq(){this.version=void 0}u(Wq,Jp);Wq.prototype.Ro=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(1==a.nodeType)return this.Gi(a);return null};Wq.prototype.Gi=function(a){this.version=a.getAttribute("version").trim();return(a=R({version:this.version},Xq,a,[]))?a:null};function Yq(a,b){return R({},Zq,a,b)}function $q(a,b){return R({},ar,a,b)}function br(a,b){if(b=Yq(a,b))return a=[Qp(a.getAttribute("width")),Qp(a.getAttribute("height"))],b.size=a,b}
function cr(a,b){return R([],dr,a,b)}
var er=[null,"http://www.opengis.net/wms"],Xq=Q(er,{Service:L(function(a,b){return R({},fr,a,b)}),Capability:L(function(a,b){return R({},gr,a,b)})}),gr=Q(er,{Request:L(function(a,b){return R({},hr,a,b)}),Exception:L(function(a,b){return R([],ir,a,b)}),Layer:L(function(a,b){return R({},jr,a,b)})}),fr=Q(er,{Name:L(S),Title:L(S),Abstract:L(S),KeywordList:L(cr),OnlineResource:L(Ip),ContactInformation:L(function(a,b){return R({},kr,a,b)}),Fees:L(S),AccessConstraints:L(S),LayerLimit:L(Pp),MaxWidth:L(Pp),
MaxHeight:L(Pp)}),kr=Q(er,{ContactPersonPrimary:L(function(a,b){return R({},lr,a,b)}),ContactPosition:L(S),ContactAddress:L(function(a,b){return R({},mr,a,b)}),ContactVoiceTelephone:L(S),ContactFacsimileTelephone:L(S),ContactElectronicMailAddress:L(S)}),lr=Q(er,{ContactPerson:L(S),ContactOrganization:L(S)}),mr=Q(er,{AddressType:L(S),Address:L(S),City:L(S),StateOrProvince:L(S),PostCode:L(S),Country:L(S)}),ir=Q(er,{Format:Wg(S)}),jr=Q(er,{Name:L(S),Title:L(S),Abstract:L(S),KeywordList:L(cr),CRS:Yg(S),
EX_GeographicBoundingBox:L(function(a,b){var c=R({},nr,a,b);if(c){a=c.westBoundLongitude;b=c.southBoundLatitude;var d=c.eastBoundLongitude,c=c.northBoundLatitude;if(void 0!==a&&void 0!==b&&void 0!==d&&void 0!==c)return[a,b,d,c]}}),BoundingBox:Yg(function(a){var b=[Op(a.getAttribute("minx")),Op(a.getAttribute("miny")),Op(a.getAttribute("maxx")),Op(a.getAttribute("maxy"))],c=[Op(a.getAttribute("resx")),Op(a.getAttribute("resy"))];return{crs:a.getAttribute("CRS"),extent:b,res:c}}),Dimension:Yg(function(a){return{name:a.getAttribute("name"),
units:a.getAttribute("units"),unitSymbol:a.getAttribute("unitSymbol"),"default":a.getAttribute("default"),multipleValues:Lp(a.getAttribute("multipleValues")),nearestValue:Lp(a.getAttribute("nearestValue")),current:Lp(a.getAttribute("current")),values:S(a)}}),Attribution:L(function(a,b){return R({},or,a,b)}),AuthorityURL:Yg(function(a,b){if(b=Yq(a,b))return b.name=a.getAttribute("name"),b}),Identifier:Yg(S),MetadataURL:Yg(function(a,b){if(b=Yq(a,b))return b.type=a.getAttribute("type"),b}),DataURL:Yg(Yq),
FeatureListURL:Yg(Yq),Style:Yg(function(a,b){return R({},pr,a,b)}),MinScaleDenominator:L(Np),MaxScaleDenominator:L(Np),Layer:Yg(function(a,b){var c=b[b.length-1],d=R({},jr,a,b);if(d)return b=Lp(a.getAttribute("queryable")),void 0===b&&(b=c.queryable),d.queryable=void 0!==b?b:!1,b=Qp(a.getAttribute("cascaded")),void 0===b&&(b=c.cascaded),d.cascaded=b,b=Lp(a.getAttribute("opaque")),void 0===b&&(b=c.opaque),d.opaque=void 0!==b?b:!1,b=Lp(a.getAttribute("noSubsets")),void 0===b&&(b=c.noSubsets),d.noSubsets=
void 0!==b?b:!1,(b=Op(a.getAttribute("fixedWidth")))||(b=c.fixedWidth),d.fixedWidth=b,(a=Op(a.getAttribute("fixedHeight")))||(a=c.fixedHeight),d.fixedHeight=a,["Style","CRS","AuthorityURL"].forEach(function(a){a in c&&(d[a]=(d[a]||[]).concat(c[a]))}),"EX_GeographicBoundingBox BoundingBox Dimension Attribution MinScaleDenominator MaxScaleDenominator".split(" ").forEach(function(a){a in d||(d[a]=c[a])}),d})}),or=Q(er,{Title:L(S),OnlineResource:L(Ip),LogoURL:L(br)}),nr=Q(er,{westBoundLongitude:L(Np),
eastBoundLongitude:L(Np),southBoundLatitude:L(Np),northBoundLatitude:L(Np)}),hr=Q(er,{GetCapabilities:L($q),GetMap:L($q),GetFeatureInfo:L($q)}),ar=Q(er,{Format:Yg(S),DCPType:Yg(function(a,b){return R({},qr,a,b)})}),qr=Q(er,{HTTP:L(function(a,b){return R({},rr,a,b)})}),rr=Q(er,{Get:L(Yq),Post:L(Yq)}),pr=Q(er,{Name:L(S),Title:L(S),Abstract:L(S),LegendURL:Yg(br),StyleSheetURL:L(Yq),StyleURL:L(Yq)}),Zq=Q(er,{Format:L(S),OnlineResource:L(Ip)}),dr=Q(er,{Keyword:Wg(S)});function sr(){C.log("nsVmap.nsMapManager.nsMapModal.WMSSuggestions")}ta("nsVmap.nsMapManager.nsMapModal.WMSSuggestions",sr);sr.prototype.Kz=function(){C.log("nsVmap.wmssuggestionsDirective");return{restrict:"E",scope:{map:"=appMap",proj:"=appProj",lang:"=appLang"},controller:"AppWmssuggestionsController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/layers/mapmodal/wmssuggestions.html"}};sr.prototype.wmssuggestionsDirective=sr.prototype.Kz;
sr.prototype.tg=function(a,b){C.log("nsVmap.wmssuggestionsController");var c=this;this.ow=a;this.catalog=C.oa.ne.dc;this.aLayers=[];this.Ds=this.sRequestUrl="";b.filter="";b.$watch("filter",function(){var a=Sa(c.aLayers,function(a){var c=Rd(String(b.filter).toLowerCase()),d=Rd(String(a.Name).toLowerCase()),e=Rd(String(a.Title).toLowerCase());a=Rd(String(a.projections).toLowerCase());return-1!==d.indexOf(c)||-1!==e.indexOf(c)||-1!==a.indexOf(c)?!0:!1});c.aLayersFiltered=a})};
sr.prototype.wmssuggestionsController=sr.prototype.tg;sr.prototype.tg.$inject=["$http","$scope"];
sr.prototype.tg.prototype.Sq=function(){C.log("getCapabilities");var a=angular.copy(Sd(this.sRequestUrl)),b=[];Ua(this.aLayers);Ua(this.aLayersFiltered);if(""===a)return $.notify("Veuillez renseigner une URL","error"),0;this.Ds=angular.copy(Sd(this.sRequestUrl));a=-1===a.indexOf("?")?a+"?":a+"&";a+="service=wms&version=1.3.0&request=GetCapabilities";$("#log-message").empty();$("#load-img-wms").show();this.ow({url:C.properties.proxy_url+"?url="+encodeURIComponent(a),headers:{charset:"charset=utf-8"}}).then(angular.bind(this,
function(a){function c(a){if(void 0===a.Layer)b.push(a);else for(var d=0;d<a.Layer.length;d++)c(a.Layer[d])}$("#load-img-wms").hide();if(""===a.data)return C.log("GetCapabilities sans r\u00e9sultat"),$.notify("Requ\u00eate GetCapabilities sans r\u00e9sultat, veuillez v\u00e9rifier l'URL du service","error"),0;C.log("GetCapabilities pass");var e=new Wq,f=a.data;try{f=e.read(f)}catch(h){return bootbox.alert(f),0}var g=[];H(C.g().F).D();e=f.Service.Title;c(f.Capability.Layer);b.serviceTitle=e;b.version=
f.version;$(a.data).find("Layer").each(function(){var a={zG:$(this).children("Name").text(),jm:""};if(0<$(this).children("CRS").length&&10>$(this).children("CRS").length)for(var b=0;b<$(this).children("CRS").length;b++)a.jm+=$(this).children("CRS")[b].innerHTML+" ";if(0<$(this).children("SRS").length&&10>$(this).children("SRS").length)for(b=0;b<$(this).children("SRS").length;b++)a.jm+=$(this).children("SRS")[b].innerHTML+" ";g.push(a)});for(a=0;a<b.length;a++)for(f=0;f<g.length;f++)g[f].zG===b[a].Name&&
(b[a].projections=g[f].jm);$("#wms-suggestions-list").show();this.aLayersFiltered=this.aLayers=b}));(function(a){$("#load-img-wms").hide();console.error(a);$.notify("Erreur lors du chargement (plus d'infos en console)","error")})};sr.prototype.tg.prototype.getCapabilities=sr.prototype.tg.prototype.Sq;
sr.prototype.tg.prototype.rb=function(a){C.log("nsVmap.nsMapManager.nsMapModal.WMSSuggestions.prototype.wmssuggestionsController.prototype.addLayer");var b=this.Ds,c=a.Name,d=a.Title;a=a.queryable;var e=this.aLayers.version;-1===b.indexOf("?")&&(b+="?service=wms");C.log("nsVmap.nsMapManager.nsMapModal.WMSSuggestions.prototype.wmssuggestionsController.prototype.getServiceTitle");for(var f,g=this.catalog.services.wms,h=0;h<g.length;h++)g[h].url===this.Ds&&(f=g[h].name);null!=f||(f=this.aLayers.serviceTitle);
g={};g.url=b;g.Qd="imagewms";g.zc=f;g.Pd=c;g.vd=d;g.$F=a;g.version=e;C.oa.rb(g)};sr.prototype.tg.prototype.addLayer=sr.prototype.tg.prototype.rb;C.module.directive("appWmssuggestions",sr.prototype.Kz);C.module.controller("AppWmssuggestionsController",sr.prototype.tg);function tr(){C.log("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions")}ta("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions",tr);tr.prototype.Lz=function(){C.log("nsVmap.wmtssuggestionsDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppWmtssuggestionsController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/layers/mapmodal/wmtssuggestions.html"}};tr.prototype.wmtssuggestionsDirective=tr.prototype.Lz;
tr.prototype.nd=function(a){C.log("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions.prototype.wmtssuggestionsController");var b=this;this.f=a;this.eu=angular.element(z.b).scope();this.catalog=C.oa.ne.dc;this.aLayers=[];a.filter="";this.oService;this.sRequestUrl="";this.sRequestType="KVP";this.sRequestVersion="1.0.0";this.oLayerToAdd;this.sLayerToAdd_name;this.sLayerToAdd_style_name;this.sLayerToAdd_matrix_name;this.oLayerToAdd_matrix_def={};this.oCapabilities;a.iServiceIndex;a.iSelectedStyleIndex;a.$watch("ctrl.sLayerToAdd_matrix_name",
function(a){tb(b.oLayerToAdd_matrix_def);if(null!=a&&""!==a&&null!=b.oCapabilities&&null!=b.oCapabilities.Contents&&null!=b.oCapabilities.Contents&&fa(b.oCapabilities.Contents.TileMatrixSet))for(var c=b.oCapabilities.Contents.TileMatrixSet,e=0;e<c.length;e++)c[e].Identifier===a&&(b.oLayerToAdd_matrix_def=angular.copy(c[e]))});a.$watch("filter",function(){var c=Sa(b.aLayers,function(b){var c=Rd(String(a.filter).toLowerCase()),d=Rd(String(b.Identifier).toLowerCase());b=Rd(String(b.Title).toLowerCase());
return-1!==d.indexOf(c)||-1!==b.indexOf(c)?!0:!1});b.aLayersFiltered=c})};tr.prototype.wmtssuggestionsController=tr.prototype.nd;tr.prototype.nd.$inject=["$scope"];
tr.prototype.nd.prototype.KG=function(a){C.log("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions.prototype.wmtssuggestionsController.prototype.selectService");this.oService=this.catalog.services.wmts[a];null!=this.oService?(this.sRequestUrl=null!=this.oService.url?this.oService.url:"",this.sRequestType=null!=this.oService.service_type_type?this.oService.service_type_type:"KVP",this.sRequestVersion=null!=this.oService.service_type_version?this.oService.service_type_version:"1.0.0"):(this.sRequestUrl=
"",this.sRequestType="KVP",this.sRequestVersion="1.0.0")};tr.prototype.nd.prototype.selectService=tr.prototype.nd.prototype.KG;
tr.prototype.nd.prototype.Sq=function(){C.log("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions.prototype.wmtssuggestionsController.prototype.getCapabilities");if(null==this.sRequestUrl||""===this.sRequestUrl)return $.notify("Informations insuffisantes: URL","error"),null;if(null==this.sRequestType||""===this.sRequestType)return $.notify("Informations insuffisantes: Type","error"),null;if(null==this.sRequestVersion||""===this.sRequestVersion)return $.notify("Informations insuffisantes: Version","error"),
null;var a=this;$("#load-img-wmts").show();$("#wmts-suggestions-list").hide();Ua(this.aLayers);Ua(this.aLayersFiltered);tb(a.oCapabilities);var b=angular.copy(Sd(this.sRequestUrl));this.eu.WMTSCapabilities({serviceUrl:b,serviceVersion:this.sRequestVersion,WMTSType:this.sRequestType},function(b){a.oCapabilities=b;$("#load-img-wmts").hide();$("#wmts-suggestions-list").show();b=!1;null!=a.oCapabilities&&null!=a.oCapabilities.Contents&&null!=a.oCapabilities.Contents.Layer&&(b=!0);if(b)a.aLayers=a.oCapabilities.Contents.Layer,
a.aLayersFiltered=a.oCapabilities.Contents.Layer;else return $.notify("Contenu du service incoh\u00e9rent","error"),null},function(b){$("#load-img-wmts").hide();a.eu.$root.modalWindow("dialog","Service non valide",{className:"modal-danger",message:b})})};tr.prototype.nd.prototype.getCapabilities=tr.prototype.nd.prototype.Sq;
tr.prototype.nd.prototype.rb=function(a){C.log("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions.prototype.wmtssuggestionsController.prototype.addLayer");this.sLayerToAdd_matrix_name=this.sLayerToAdd_format_name=this.sLayerToAdd_style_name=this.sLayerToAdd_name="";if(!fa(a.Style))return $.notify("Informations insuffisantes: Style","error"),null;if(!fa(a.TileMatrixSetLink))return $.notify("Informations insuffisantes: Matrice","error"),null;this.oLayerToAdd=a;this.sLayerToAdd_name=a.Identifier;this.sLayerToAdd_title=
a.Title;1===a.Style.length&&1===a.Format.length&&1===a.TileMatrixSetLink.length?(this.sLayerToAdd_style_name=this.oLayerToAdd.Style[0].Identifier,this.sLayerToAdd_format_name=this.oLayerToAdd.Format[0],this.sLayerToAdd_matrix_name=this.oLayerToAdd.TileMatrixSetLink[0].TileMatrixSet,this.Kt()):(this.f.iSelectedStyleIndex=0,this.sLayerToAdd_matrix_name=this.sLayerToAdd_format_name="?",$("#wmts-select-matrix-modal").modal("show"))};tr.prototype.nd.prototype.addLayer=tr.prototype.nd.prototype.rb;
tr.prototype.nd.prototype.Kt=function(){C.log("nsVmap.nsMapManager.nsMapModal.WMTSSuggestions.prototype.wmtssuggestionsController.prototype.addLayerToAdd");if(null==this.sLayerToAdd_name||""===this.sLayerToAdd_name)return $.notify("Informations insuffisantes: Nom de la couche","error"),null;if(null==this.sLayerToAdd_title||""===this.sLayerToAdd_title)return $.notify("Informations insuffisantes: Titre de la couche","error"),null;if(null==this.sLayerToAdd_style_name||"?"===this.sLayerToAdd_style_name)return $.notify("Informations insuffisantes: Style",
"error"),null;if(null==this.sLayerToAdd_matrix_name||"?"===this.sLayerToAdd_matrix_name)return $.notify("Informations insuffisantes: Matrice","error"),null;if(null==this.sLayerToAdd_format_name||"?"===this.sLayerToAdd_format_name)return $.notify("Informations insuffisantes Format","error"),null;var a=!1;null!=this.oCapabilities&&null!=this.oCapabilities.Contents&&null!=this.oCapabilities.Contents.Layer&&(a=!0);if(!a)return $.notify("Contenu du service incoh\u00e9rent","error"),null;$("#wmts-select-matrix-modal").modal("hide");
a={Qd:"wmts"};a.Pd=this.sLayerToAdd_name;a.vd=this.sLayerToAdd_title;a.style=this.sLayerToAdd_style_name;a.zo=this.sLayerToAdd_matrix_name;a.format=this.sLayerToAdd_format_name;a.fm=this.sRequestType;a.version=this.sRequestVersion;a.url=this.sRequestUrl;a.Ay=JSON.stringify(this.oCapabilities);null!=this.f.iServiceIndex&&null!=this.catalog&&null!=this.catalog.services&&null!=this.catalog.services.wmts&&null!=this.catalog.services.wmts[this.f.iServiceIndex]&&null!=this.catalog.services.wmts[this.f.iServiceIndex].name&&
(a.zc=this.catalog.services.wmts[this.f.iServiceIndex].name);null==a.zc&&null!=this.oCapabilities.ServiceProvider&&null!=this.oCapabilities.ServiceProvider.ProviderName&&(a.zc=this.oCapabilities.ServiceProvider.ProviderName);null==a.zc&&null!=this.oCapabilities.ServiceIdentification&&null!=this.oCapabilities.ServiceIdentification.Title&&(a.zc=this.oCapabilities.ServiceIdentification.Title);null==a.zc&&(a.zc="Service WMTS");C.oa.rb(a)};tr.prototype.nd.prototype.addLayerToAdd=tr.prototype.nd.prototype.Kt;
C.module.directive("appWmtssuggestions",tr.prototype.Lz);C.module.controller("AppWmtssuggestionsController",tr.prototype.nd);function ur(){C.log("nsVmap.nsMapManager.nsMapModal.XYZSuggestions")}ta("nsVmap.nsMapManager.nsMapModal.XYZSuggestions",ur);ur.prototype.Qz=function(){C.log("nsVmap.xyzsuggestionsDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppXyzsuggestionsController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/layers/mapmodal/xyzsuggestions.html"}};ur.prototype.xyzsuggestionsDirective=ur.prototype.Qz;
ur.prototype.zh=function(){C.log("nsVmap.nsMapManager.nsMapModal.XYZSuggestions.xyzsuggestionsController");this.properties=C.properties;this.catalog=C.oa.ne.dc;this.projection=H(C.g().F).D().M;this.oLayerToAdd={sService:"",sLayer:"",sUrl:""}};ur.prototype.xyzsuggestionsController=ur.prototype.zh;
ur.prototype.zh.prototype.rb=function(a){C.log("nsVmap.nsMapManager.nsMapModal.XYZSuggestions.prototype.xyzsuggestionsController.prototype.addLayer");var b,c;null!=a?(c=b=a.name,a=a.url):(b=this.oLayerToAdd.sService,c=this.oLayerToAdd.sLayer,a=this.oLayerToAdd.sUrl);if(null==b)return $.notify("Informations insuffisantes: Service","error"),null;if(null==c)return $.notify("Informations insuffisantes: sLayer","error"),null;if(null==a)return $.notify("Informations insuffisantes: sUrl","error"),null;C.oa.rb({url:a,
Qd:"xyz",zc:b,vd:c})};ur.prototype.zh.prototype.addLayer=ur.prototype.zh.prototype.rb;ur.prototype.zh.prototype.reload=function(){this.catalog=C.oa.ne.dc;this.projection=H(C.g().F).D().M};ur.prototype.zh.prototype.reload=ur.prototype.zh.prototype.reload;C.module.directive("appXyzsuggestions",ur.prototype.Qz);C.module.controller("AppXyzsuggestionsController",ur.prototype.zh);function vr(){C.log("nsVmap.nsMapManager.nsMapModal.LoadGeometry")}ta("nsVmap.nsMapManager.nsMapModal.LoadGeometry",vr);vr.prototype.Rw=function(){C.log("nsVmap.loadgeometryDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppLoadgeometryController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/layers/mapmodal/loadgeometry.html"}};vr.prototype.loadgeometryDirective=vr.prototype.Rw;
vr.prototype.Jj=function(a){C.log("nsVmap.loadgeometryController");var b=this;this.Af=a;a.oSelectedFile={};a.sFileName="";a.sServiceName="";a.sLayerTitle="";a.bIsUrl=!1;var c=document.getElementById("upload-geometry-file-drop-zone");document.getElementById("browse-geometry-button").addEventListener("change",function(){var c=this;b.oy=c.id;a.$applyAsync(function(){a.oSelectedFile=c.files[0];a.bIsUrl=!1;a.sFileName=null!=a.oSelectedFile?angular.copy(a.oSelectedFile.name):""})},!1);c.addEventListener("dragover",
function(a){this.className="upload-drop-zone drop";a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy";return!1},!1);c.addEventListener("dragleave",function(){this.className="upload-drop-zone";return!1},!1);c.addEventListener("drop",function(c){c.stopPropagation();c.preventDefault();var d=c.dataTransfer.files;this.files=d;b.oy=this.id;a.$applyAsync(function(){a.oSelectedFile=d[0];a.bIsUrl=!1;a.sFileName=null!=a.oSelectedFile?angular.copy(a.oSelectedFile.name):""});this.className=
"upload-drop-zone";return!1},!1)};vr.prototype.loadgeometryController=vr.prototype.Jj;vr.prototype.Jj.$inject=["$scope"];
vr.prototype.Jj.prototype.rb=function(){C.log("nsVmap.nsMapManager.nsMapModal.LoadGeometry.prototype.loadgeometryController.prototype.addLayer");var a=this.oy,b=this.Af.sFileName,c=this.Af.sServiceName,d=this.Af.sLayerTitle,c=""!==c?c:"Local",d=""!==d?d:"Local";""===c||""===d?$.notify("Veuillez renseigner les noms du service et de la couche","error"):this.Af.bIsUrl&&""!==b?"http"!==b.substr(0,4)?$.notify("URL incorrecte"):(Vd(),$.get(b).done(function(a){Wd();C.oa.Wp(a,c,d)&&C.ph("close-modal-button")}).error(function(){Wd();
$.notify("impossible de charger le contenu de l'URL")})):p(a)&&""!==a?(a=document.getElementById(a).files,a.length?(a=a[0],b=new FileReader,d="Local"!==d?d:a.name,b.onloadend=function(a){a.target.readyState===FileReader.DONE&&C.oa.Wp(a.target.result,c,d)&&C.ph("close-modal-button")},b.readAsText(a)):$.notify("Veuillez s\u00e9lectionner un fichier ou une url","error")):$.notify("Veuillez s\u00e9lectionner un fichier ou une URL","error")};vr.prototype.Jj.prototype.addLayer=vr.prototype.Jj.prototype.rb;
C.module.directive("appLoadgeometry",vr.prototype.Rw);C.module.controller("AppLoadgeometryController",vr.prototype.Jj);function wr(){C.log("nsVmap.nsMapManager.nsMapModal.OSMSuggestions")}ta("nsVmap.nsMapManager.nsMapModal.OSMSuggestions",wr);wr.prototype.Ix=function(){C.log("nsVmap.osmsuggestionsDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppOsmsuggestionsController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/layers/mapmodal/osmsuggestions.html"}};wr.prototype.osmsuggestionsDirective=wr.prototype.Ix;
wr.prototype.Zg=function(){C.log("nsVmap.nsMapManager.nsMapModal.OSMSuggestions.osmsuggestionsController");this.catalog=C.oa.ne.dc;this.ea=this.projection=H(C.g().F).D().M;this.properties=C.properties;this.sLayerUrl=this.sLayerName=""};wr.prototype.osmsuggestionsController=wr.prototype.Zg;
wr.prototype.Zg.prototype.rb=function(a){C.log("nsVmap.nsMapManager.nsMapModal.OSMSuggestions.prototype.osmsuggestionsController.prototype.addLayer");var b;null!=a?(b=a.name,a=a.url):(b=this.sLayerName,a=this.sLayerUrl);if(p(b)&&""!==b){var c={};c.url=a;c.Qd="osm";c.zc="Open Street Map";c.vd=b;C.oa.rb(c)}else $.notify("Informations manquantes: Nom","error")};wr.prototype.Zg.prototype.addLayer=wr.prototype.Zg.prototype.rb;
wr.prototype.Zg.prototype.reload=function(){this.catalog=C.oa.ne.dc;this.ea=this.projection=H(C.g().F).D().M};wr.prototype.Zg.prototype.reload=wr.prototype.Zg.prototype.reload;C.module.directive("appOsmsuggestions",wr.prototype.Ix);C.module.controller("AppOsmsuggestionsController",wr.prototype.Zg);function xr(){C.log("nsVmap.nsMapManager.nsMapModal.BingSuggestions")}ta("nsVmap.nsMapManager.nsMapModal.BingSuggestions",xr);xr.prototype.HA=function(){C.log("nsVmap.bingsuggestionsDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang"},controller:"AppBingsuggestionsController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/layers/mapmodal/bingsuggestions.html"}};
xr.prototype.xg=function(){C.log("nsVmap.bingsuggestionsController");this.catalog=C.oa.ne.dc;this.ea=this.projection=H(C.g().F).D().M;this.properties=C.properties};xr.prototype.bingsuggestionsController=xr.prototype.xg;
xr.prototype.xg.prototype.rb=function(a){C.log("nsVmap.nsMapManager.nsMapModal.BingSuggestions.prototype.bingsuggestionsController.prototype.addLayer");var b,c;null!=a?(b=a.key,c=a.imagerySet,a=a.culture):(b=this.sKey,c=this.sImagerySet,a=this.sCulture);if(null==b||""===b)return $.notify("Veuillez renseigner la cl\u00e9 Bing Maps","error"),0;if(null==c||""===c)return $.notify("Veuillez renseigner une couche \u00e0 utiliser","error"),0;if(null==a||""===a)return $.notify("Veuillez renseigner une langue \u00e0 utiliser",
"error"),0;var d={Qd:"bing",zc:"Bing Maps"};d.key=b;d.Pd=c;d.Th=a;C.oa.rb(d)};xr.prototype.xg.prototype.addLayer=xr.prototype.xg.prototype.rb;xr.prototype.xg.prototype.reload=function(){this.catalog=C.oa.ne.dc;this.ea=this.projection=H(C.g().F).D().M};xr.prototype.xg.prototype.reload=xr.prototype.xg.prototype.reload;C.module.directive("appBingsuggestions",xr.prototype.HA);C.module.controller("AppBingsuggestionsController",xr.prototype.xg);function yr(a){C.log("nsVmap.nsMapManager.nsMapModal.MapModalManager");this.dc=a;new Sq;this.kF=new Rq;new Vq;new sr;new tr;new vr;new wr;new ur;new xr}ta("nsVmap.nsMapManager.nsMapModal.MapModalManager",yr);yr.prototype.BE=function(){C.log("nsVmap.mapmodalDirective");return{restrict:"E",scope:{map:"=appMap",proj:"=appProj",lang:"=appLang"},controller:"AppMapmodalController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/layers/mapmodal/mapmodal.html"}};
yr.prototype.AE=function(){C.log("nsVmap.mapmodalController")};yr.prototype.zC=function(){return this.kF};yr.prototype.getMapListTool=yr.prototype.zC;C.module.directive("appMapmodal",yr.prototype.BE);C.module.controller("AppMapmodalController",yr.prototype.AE);function zr(){this.rt=new XMLSerializer;this.vb=null}u(zr,dp);k=zr.prototype;k.T=function(){return"xml"};k.Zj=function(a,b){if(a instanceof Document)return Ar(this,a,b);if(a instanceof Node)return this.Qo(a,b);if("string"===typeof a)return a=Ug(a),Ar(this,a,b);Oa("Unknown source type");return[]};function Ar(a,b,c){var d=[];for(b=b.firstChild;b;b=b.nextSibling)1==b.nodeType&&Jg(d,a.Qo(b,c));return d}
k.Yl=function(a,b){if(a instanceof Document)return this.bG(a,b);if(a instanceof Node)return this.PJ(a,b);if("string"===typeof a)return a=Ug(a),this.bG(a,b);Oa("Unknown source type");return null};k.Zl=function(a){if(a instanceof Document||a instanceof Node)return this.vb;if("string"===typeof a)return Ug(a),this.vb;Oa("Unknown source type");return null};k.pt=function(a,b){a=this.dK(a,b);return this.rt.serializeToString(a)};k.Ip=function(a,b){a=this.Oz(a,b);return this.rt.serializeToString(a)};
k.qt=function(a,b){a=this.eK(a,b);return this.rt.serializeToString(a)};function Br(a){a=a?a:{};zr.call(this);this.vb=vf("EPSG:4326");this.Sx=a.OJ}u(Br,zr);var Cr=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"];function Dr(a,b,c){a.push(parseFloat(b.getAttribute("lon")),parseFloat(b.getAttribute("lat")));"ele"in c?(a.push(c.ele),delete c.ele):a.push(0);"time"in c?(a.push(c.time),delete c.time):a.push(0);return a}function Er(a,b){var c=b[b.length-1],d=a.getAttribute("href");null!==d&&(c.link=d);dh(Fr,a,b)}
function Gr(a,b){b[b.length-1].extensionsNode_=a}
var Kr=Q(Cr,{rte:Wg(function(a,b){var c=b[0];if(a=R({flatCoordinates:[]},Hr,a,b)){b=a.flatCoordinates;delete a.flatCoordinates;var d=new tp(null);d.ma("XYZM",b);gp(d,!1,c);c=new Eg(d);c.Ac(a);return c}}),trk:Wg(function(a,b){var c=b[0];if(a=R({flatCoordinates:[],ends:[]},Ir,a,b)){b=a.flatCoordinates;delete a.flatCoordinates;var d=a.ends;delete a.ends;var e=new up(null);e.ma("XYZM",b,d);gp(e,!1,c);c=new Eg(e);c.Ac(a);return c}}),wpt:Wg(function(a,b){var c=b[0];if(b=R({},Jr,a,b))return a=Dr([],a,b),
a=new ok(a,"XYZM"),gp(a,!1,c),c=new Eg(a),c.Ac(b),c})}),Fr=Q(Cr,{text:L(S,"linkText"),type:L(S,"linkType")}),Hr=Q(Cr,{name:L(S),cmt:L(S),desc:L(S),src:L(S),link:Er,number:L(Pp),extensions:Gr,type:L(S),rtept:function(a,b){var c=R({},Lr,a,b);c&&Dr(b[b.length-1].flatCoordinates,a,c)}}),Lr=Q(Cr,{ele:L(Np),time:L(Mp)}),Ir=Q(Cr,{name:L(S),cmt:L(S),desc:L(S),src:L(S),link:Er,number:L(Pp),type:L(S),extensions:Gr,trkseg:function(a,b){var c=b[b.length-1];dh(Mr,a,b);c.ends.push(c.flatCoordinates.length)}}),
Mr=Q(Cr,{trkpt:function(a,b){var c=R({},Nr,a,b);c&&Dr(b[b.length-1].flatCoordinates,a,c)}}),Nr=Q(Cr,{ele:L(Np),time:L(Mp)}),Jr=Q(Cr,{ele:L(Np),time:L(Mp),magvar:L(Np),geoidheight:L(Np),name:L(S),cmt:L(S),desc:L(S),src:L(S),link:Er,sym:L(S),type:L(S),fix:L(S),sat:L(Pp),hdop:L(Np),vdop:L(Np),pdop:L(Np),ageofdgpsdata:L(Np),dgpsid:L(Pp),extensions:Gr});
Br.prototype.Qo=function(a,b){if(!(0<=Cr.indexOf(a.namespaceURI)))return[];if("gpx"==a.localName&&(a=R([],Kr,a,[ep(this,a,b)]))){(b=a)||(b=[]);for(var c=0,d=b.length;c<d;++c){var e=b[c];if(this.Sx){var f=e.get("extensionsNode_")||null;this.Sx(e,f)}e.set("extensionsNode_",void 0)}return a}return[]};function Or(a,b,c){a.setAttribute("href",b);b=c[c.length-1].properties;eh({node:a},Pr,bh,[b.linkText,b.linkType],c,Qr)}
function Rr(a,b,c){var d=c[c.length-1],e=d.node.namespaceURI,f=d.properties;a.setAttributeNS(null,"lat",b[1]);a.setAttributeNS(null,"lon",b[0]);switch(d.geometryLayout){case "XYZM":0!==b[3]&&(f.time=b[3]);case "XYZ":0!==b[2]&&(f.ele=b[2]);break;case "XYM":0!==b[2]&&(f.time=b[2])}b=Sr[e];d=ch(f,b);eh({node:a,properties:f},Tr,bh,d,c,b)}
var Qr=["text","type"],Pr=Q(Cr,{text:M(Sp),type:M(Sp)}),Ur=Q(Cr,"name cmt desc src link number type rtept".split(" ")),Vr=Q(Cr,{name:M(Sp),cmt:M(Sp),desc:M(Sp),src:M(Sp),link:M(Or),number:M(Up),type:M(Sp),rtept:Zg(M(Rr))}),Wr=Q(Cr,"name cmt desc src link number type trkseg".split(" ")),Zr=Q(Cr,{name:M(Sp),cmt:M(Sp),desc:M(Sp),src:M(Sp),link:M(Or),number:M(Up),type:M(Sp),trkseg:Zg(M(function(a,b,c){eh({node:a,geometryLayout:b.Ha,properties:{}},Xr,Yr,b.da(),c)}))}),Yr=$g("trkpt"),Xr=Q(Cr,{trkpt:M(Rr)}),
Sr=Q(Cr,"ele time magvar geoidheight name cmt desc src link sym type fix sat hdop vdop pdop ageofdgpsdata dgpsid".split(" ")),Tr=Q(Cr,{ele:M(Tp),time:M(function(a,b){b=new Date(1E3*b);a.appendChild(Rg.createTextNode(b.getUTCFullYear()+"-"+Qj(b.getUTCMonth()+1)+"-"+Qj(b.getUTCDate())+"T"+Qj(b.getUTCHours())+":"+Qj(b.getUTCMinutes())+":"+Qj(b.getUTCSeconds())+"Z"))}),magvar:M(Tp),geoidheight:M(Tp),name:M(Sp),cmt:M(Sp),desc:M(Sp),src:M(Sp),link:M(Or),sym:M(Sp),type:M(Sp),fix:M(Sp),sat:M(Up),hdop:M(Tp),
vdop:M(Tp),pdop:M(Tp),ageofdgpsdata:M(Tp),dgpsid:M(Up)}),$r={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function as(a,b){if(a=a.l())if(a=$r[a.T()])return Rg.createElementNS(b[b.length-1].node.namespaceURI,a)}
var bs=Q(Cr,{rte:M(function(a,b,c){var d=c[0],e=De(b);a={node:a,properties:e};if(b=b.l())b=gp(b,!0,d),a.geometryLayout=b.Ha,e.rtept=b.da();d=Ur[c[c.length-1].node.namespaceURI];e=ch(e,d);eh(a,Vr,bh,e,c,d)}),trk:M(function(a,b,c){var d=c[0],e=De(b);a={node:a,properties:e};if(b=b.l())b=gp(b,!0,d),e.trkseg=wp(b);d=Wr[c[c.length-1].node.namespaceURI];e=ch(e,d);eh(a,Zr,bh,e,c,d)}),wpt:M(function(a,b,c){var d=c[0],e=c[c.length-1];e.properties=De(b);if(b=b.l())b=gp(b,!0,d),e.geometryLayout=b.Ha,Rr(a,b.da(),
c)})});Br.prototype.Oz=function(a,b){b=fp(this,b);var c=Rg.createElementNS("http://www.topografix.com/GPX/1/1","gpx");eh({node:c},bs,as,a,[b]);return c};function cs(){this.vb=null}u(cs,dp);function ds(a){if("string"===typeof a)return a;Oa();return""}k=cs.prototype;k.T=function(){return"text"};k.Zj=function(a,b){return this.Vx(ds(a),fp(this,b))};k.Yl=function(a,b){return es(ds(a),fp(this,b))};k.Zl=function(a){ds(a);return this.vb};k.pt=function(a,b){return fs(a,fp(this,b))};k.Ip=function(a,b){b=fp(this,b);if(1==a.length)a=fs(a[0],b);else{for(var c=[],d=0,e=a.length;d<e;++d)c.push(a[d].l());a=new op(c);a=gs(gp(a,!0,b))}return a};
k.qt=function(a,b){return gs(gp(a,!0,fp(this,b)))};function hs(a){a=a?a:{};this.vb=null;this.vb=vf("EPSG:4326");this.mA=a.lA?a.lA:"none"}u(hs,cs);var is=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,js=/^H.([A-Z]{3}).*?:(.*)/,ks=/^HFDTE(\d{2})(\d{2})(\d{2})/,ls=/\r\n|\r|\n/;
hs.prototype.Tx=function(a,b){var c=this.mA,d=a.split(ls);a={};var e=[],f=2E3,g=0,h=1,l,n;l=0;for(n=d.length;l<n;++l){var r=d[l],t;if("B"==r.charAt(0)){if(t=is.exec(r)){var r=parseInt(t[1],10),v=parseInt(t[2],10),x=parseInt(t[3],10),y=parseInt(t[4],10)+parseInt(t[5],10)/6E4;"S"==t[6]&&(y=-y);var B=parseInt(t[7],10)+parseInt(t[8],10)/6E4;"W"==t[9]&&(B=-B);e.push(B,y);"none"!=c&&("gps"==c?t=parseInt(t[11],10):"barometric"==c?t=parseInt(t[12],10):(Oa(),t=0),e.push(t));e.push(Date.UTC(f,g,h,r,v,x)/1E3)}}else"H"==
r.charAt(0)&&((t=ks.exec(r))?(h=parseInt(t[1],10),g=parseInt(t[2],10)-1,f=2E3+parseInt(t[3],10)):(t=js.exec(r))&&(a[t[1]]=t[2].trim()))}if(0===e.length)return null;d=new tp(null);d.ma("none"==c?"XYM":"XYZM",e);b=new Eg(gp(d,!1,b));b.Ac(a);return b};hs.prototype.Vx=function(a,b){return(a=this.Tx(a,b))?[a]:[]};function Ro(a){a=a||{};this.Mv=a.font;this.pc=a.rotation;this.Zc=a.scale;this.La=a.text;this.Us=a.textAlign;this.dz=a.textBaseline;this.Uc=void 0!==a.fill?a.fill:new ug({color:"#333"});this.qc=void 0!==a.stroke?a.stroke:null;this.Yr=void 0!==a.offsetX?a.offsetX:0;this.Zr=void 0!==a.offsetY?a.offsetY:0}Ro.prototype.Vb=function(){return this.pc};Ro.prototype.gb=function(){return this.Zc};Ro.prototype.mm=function(a){this.pc=a};Ro.prototype.rf=function(a){this.Zc=a};function ms(a){a=a?a:{};zr.call(this);this.vb=vf("EPSG:4326");this.iB=a.hB?a.hB:ns;this.RB=void 0!==a.QB?a.QB:!0;this.LI=void 0!==a.KI?a.KI:!0;this.Ls={};this.kH=void 0!==a.jH?a.jH:!0}u(ms,zr);
var os=["http://www.google.com/kml/ext/2.2"],ps=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],qs=[255,255,255,1],rs=new ug({color:qs}),ss=[20,2],ts=[64,64],us=new tj({anchor:ss,Zp:"bottom-left",$p:"pixels",aq:"pixels",crossOrigin:"anonymous",rotation:0,scale:.5,size:ts,src:"https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png"}),vs=new wg({color:qs,width:1}),ws=new Ro({font:"bold 16px Helvetica",
fill:rs,stroke:new wg({color:[51,51,51,1],width:2}),scale:.8}),ns=[new yg({fill:rs,Gb:us,text:ws,stroke:vs,zIndex:0})],xs={fraction:"fraction",pixels:"pixels"};function ys(a,b){var c=[0,0],d="start";if(a.xa()){var e=a.xa().fl();e&&2==e.length&&(c[0]=a.xa().gb()*e[0]/2,c[1]=-a.xa().gb()*e[1]/2,d="left")}je(a.La)?a=new Ro({text:b,offsetX:c[0],offsetY:c[1],textAlign:d}):(a=vb(a.La),a.La=b,a.Us=d,a.Yr=c[0],a.Zr=c[1]);return new yg({text:a})}
function zs(a,b,c,d,e){return function(){var f=e,g="";f&&this.l()&&(f="Point"===this.l().T());f&&(g=this.get("name"),f=f&&g);if(a)return f?(f=ys(a[0],g),a.concat(f)):a;if(b){var h=As(b,c,d);return f?(f=ys(h[0],g),h.concat(f)):h}return f?(f=ys(c[0],g),c.concat(f)):c}}function As(a,b,c){return Array.isArray(a)?a:"string"===typeof a?(!(a in c)&&"#"+a in c&&(a="#"+a),As(c[a],b,c)):b}
function Bs(a){a=Sg(a);if(a=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(a))return a=a[1],[parseInt(a.substr(6,2),16),parseInt(a.substr(4,2),16),parseInt(a.substr(2,2),16),parseInt(a.substr(0,2),16)/255]}function Cs(a){a=Sg(a);for(var b=[],c=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?))?\s*/i,d;d=c.exec(a);)b.push(parseFloat(d[1]),parseFloat(d[2]),d[3]?parseFloat(d[3]):0),a=a.substr(d[0].length);if(""===a)return b}
function Ds(a){var b=Sg(a);return a.baseURI?xd(a.baseURI,b.trim()).toString():b.trim()}function Es(a){a=Np(a);if(void 0!==a)return Math.sqrt(a)}function Fs(a,b){return R(null,Gs,a,b)}function Hs(a,b){if(b=R({s:[],Iz:[]},Is,a,b)){a=b.s;b=b.Iz;var c,d;c=0;for(d=Math.min(a.length,b.length);c<d;++c)a[4*c+3]=b[c];b=new tp(null);b.ma("XYZM",a);return b}}function Js(a,b){var c=R({},Ks,a,b);if(a=R(null,Ls,a,b))return b=new tp(null),b.ma("XYZ",a),b.Ac(c),b}
function Ms(a,b){var c=R({},Ks,a,b);if(a=R(null,Ls,a,b))return b=new wk(null),b.ma("XYZ",a,[a.length]),b.Ac(c),b}
function Ns(a,b){a=R([],Os,a,b);if(!a)return null;if(0===a.length)return new op(a);var c=!0,d=a[0].T(),e,f;e=1;for(f=a.length;e<f;++e)if(b=a[e],b.T()!=d){c=!1;break}if(c){if("Point"==d){b=a[0];c=b.Ha;d=b.s;e=1;for(f=a.length;e<f;++e)b=a[e],Jg(d,b.s);b=new yp(null);b.ma(c,d);Ps(b,a);return b}if("LineString"==d)return b=new up(null),xp(b,a),Ps(b,a),b;if("Polygon"==d){b=new Cp(null);e=b.Ha;f=[];var c=[],g,h,d=0;for(g=a.length;d<g;++d){var l=a[d];0===d&&(e=l.Ha);var n=f.length;h=l.Pa;var r,t;r=0;for(t=
h.length;r<t;++r)h[r]+=n;Jg(f,l.s);c.push(h)}b.ma(e,f,c);Ps(b,a);return b}if("GeometryCollection"==d)return new op(a);Oa("Unexpected type: "+d);return null}return new op(a)}function Qs(a,b){var c=R({},Ks,a,b);if(a=R(null,Ls,a,b))return b=new ok(null),b.ma("XYZ",a),b.Ac(c),b}function Rs(a,b){var c=R({},Ks,a,b);if((a=R([null],Ss,a,b))&&a[0]){b=new wk(null);var d=a[0],e=[d.length],f,g;f=1;for(g=a.length;f<g;++f)Jg(d,a[f]),e.push(d.length);b.ma("XYZ",d,e);b.Ac(c);return b}}
function Ts(a,b){b=R({},Us,a,b);if(!b)return null;a="fillStyle"in b?b.fillStyle:rs;var c=b.fill;void 0===c||c||(a=null);var c="imageStyle"in b?b.imageStyle:us,d="textStyle"in b?b.textStyle:ws,e="strokeStyle"in b?b.strokeStyle:vs;b=b.outline;void 0===b||b||(e=null);return[new yg({fill:a,Gb:c,stroke:e,text:d,zIndex:void 0})]}
function Ps(a,b){var c=b.length,d=Array(b.length),e=Array(b.length),f,g,h,l;h=l=!1;for(g=0;g<c;++g)f=b[g],d[g]=f.get("extrude"),e[g]=f.get("altitudeMode"),h=h||void 0!==d[g],l=l||e[g];h&&a.set("extrude",d);l&&a.set("altitudeMode",e)}function Vs(a,b){dh(Ws,a,b)}
var Xs=Q(ps,{value:Xg(S)}),Ws=Q(ps,{Data:function(a,b){var c=a.getAttribute("name");null!==c&&(a=R(void 0,Xs,a,b))&&(b[b.length-1][c]=a)},SchemaData:function(a,b){dh(Ys,a,b)}}),Ks=Q(ps,{extrude:L(Kp),altitudeMode:L(S)}),Gs=Q(ps,{coordinates:Xg(Cs)}),Ss=Q(ps,{innerBoundaryIs:function(a,b){(a=R(void 0,Zs,a,b))&&b[b.length-1].push(a)},outerBoundaryIs:function(a,b){(a=R(void 0,$s,a,b))&&(b[b.length-1][0]=a)}}),Is=Q(ps,{when:function(a,b){b=b[b.length-1].Iz;a=Sg(a);if(a=/^\s*(\d{4})($|-(\d{2})($|-(\d{2})($|T(\d{2}):(\d{2}):(\d{2})(Z|(?:([+\-])(\d{2})(?::(\d{2}))?)))))\s*$/.exec(a)){var c=
Date.UTC(parseInt(a[1],10),a[3]?parseInt(a[3],10)-1:0,a[5]?parseInt(a[5],10):1,a[7]?parseInt(a[7],10):0,a[8]?parseInt(a[8],10):0,a[9]?parseInt(a[9],10):0);if(a[10]&&"Z"!=a[10]){var d="-"==a[11]?-1:1,c=c+60*d*parseInt(a[12],10);a[13]&&(c+=3600*d*parseInt(a[13],10))}b.push(c)}else b.push(0)}},Q(os,{coord:function(a,b){b=b[b.length-1].s;a=Sg(a);(a=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(a))?b.push(parseFloat(a[1]),
parseFloat(a[2]),parseFloat(a[3]),0):b.push(0,0,0,0)}})),Ls=Q(ps,{coordinates:Xg(Cs)}),at=Q(ps,{href:L(Ds)},Q(os,{x:L(Np),y:L(Np),w:L(Np),h:L(Np)})),bt=Q(ps,{Icon:L(function(a,b){return(a=R({},at,a,b))?a:null}),heading:L(Np),hotSpot:L(function(a){var b=a.getAttribute("xunits"),c=a.getAttribute("yunits");return{x:parseFloat(a.getAttribute("x")),st:xs[b],y:parseFloat(a.getAttribute("y")),tt:xs[c]}}),scale:L(Es)}),Zs=Q(ps,{LinearRing:Xg(Fs)}),ct=Q(ps,{color:L(Bs),scale:L(Es)}),dt=Q(ps,{color:L(Bs),width:L(Np)}),
Os=Q(ps,{LineString:Wg(Js),LinearRing:Wg(Ms),MultiGeometry:Wg(Ns),Point:Wg(Qs),Polygon:Wg(Rs)}),et=Q(os,{Track:Wg(Hs)});Q(ps,{ExtendedData:Vs,Link:function(a,b){dh(ft,a,b)},address:L(S),description:L(S),name:L(S),open:L(Kp),phoneNumber:L(S),visibility:L(Kp)});
var ft=Q(ps,{href:L(Ds)}),$s=Q(ps,{LinearRing:Xg(Fs)}),gt=Q(ps,{Style:L(Ts),key:L(S),styleUrl:L(function(a){var b=Sg(a).trim();return a.baseURI?xd(a.baseURI,b).toString():b})}),it=Q(ps,{ExtendedData:Vs,MultiGeometry:L(Ns,"geometry"),LineString:L(Js,"geometry"),LinearRing:L(Ms,"geometry"),Point:L(Qs,"geometry"),Polygon:L(Rs,"geometry"),Style:L(Ts),StyleMap:function(a,b){if(a=R(void 0,ht,a,b))b=b[b.length-1],Array.isArray(a)?b.Style=a:"string"===typeof a?b.styleUrl=a:Oa("styleMapValue has an unknown type")},
address:L(S),description:L(S),name:L(S),open:L(Kp),phoneNumber:L(S),styleUrl:L(Ds),visibility:L(Kp)},Q(os,{MultiTrack:L(function(a,b){if(a=R([],et,a,b))return b=new up(null),xp(b,a),b},"geometry"),Track:L(Hs,"geometry")})),jt=Q(ps,{color:L(Bs),fill:L(Kp),outline:L(Kp)}),Ys=Q(ps,{SimpleData:function(a,b){var c=a.getAttribute("name");null!==c&&(a=S(a),b[b.length-1][c]=a)}}),Us=Q(ps,{IconStyle:function(a,b){if(a=R({},bt,a,b)){b=b[b.length-1];var c="Icon"in a?a.Icon:{},d;d=(d=c.href)?d:"https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png";
var e,f,g,h=a.hotSpot;h?(e=[h.x,h.y],f=h.st,g=h.tt):"https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png"===d?(e=ss,g=f="pixels"):/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(d)&&(e=[.5,0],g=f="fraction");var l,h=c.x,n=c.y;void 0!==h&&void 0!==n&&(l=[h,n]);var r,h=c.w,c=c.h;void 0!==h&&void 0!==c&&(r=[h,c]);var t,c=a.heading;void 0!==c&&(t=lf(c));a=a.scale;"https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png"==d&&(r=ts,void 0===a&&(a=.5));e=new tj({anchor:e,Zp:"bottom-left",
$p:f,aq:g,crossOrigin:"anonymous",offset:l,Ex:"bottom-left",rotation:t,scale:a,size:r,src:d});b.imageStyle=e}},LabelStyle:function(a,b){(a=R({},ct,a,b))&&(b[b.length-1].textStyle=new Ro({fill:new ug({color:"color"in a?a.color:qs}),scale:a.scale}))},LineStyle:function(a,b){(a=R({},dt,a,b))&&(b[b.length-1].strokeStyle=new wg({color:"color"in a?a.color:qs,width:"width"in a?a.width:1}))},PolyStyle:function(a,b){if(a=R({},jt,a,b)){b=b[b.length-1];b.fillStyle=new ug({color:"color"in a?a.color:qs});var c=
a.fill;void 0!==c&&(b.fill=c);a=a.outline;void 0!==a&&(b.outline=a)}}}),ht=Q(ps,{Pair:function(a,b){if(a=R({},gt,a,b)){var c=a.key;c&&"normal"==c&&((c=a.styleUrl)&&(b[b.length-1]=c),(a=a.Style)&&(b[b.length-1]=a))}}});k=ms.prototype;k.ms=function(a,b){var c=Q(ps,{Document:Vg(this.ms,this),Folder:Vg(this.ms,this),Placemark:Wg(this.Wx,this),Style:this.dG.bind(this),StyleMap:this.cG.bind(this)});if(a=R([],c,a,b,this))return a};
k.Wx=function(a,b){var c=R({geometry:null},it,a,b);if(c){var d=new Eg;a=a.getAttribute("id");null!==a&&(d.Mc=a,d.R());b=b[0];(a=c.geometry)&&gp(a,!1,b);d.Rc(a);delete c.geometry;this.RB&&d.Qe(zs(c.Style,c.styleUrl,this.iB,this.Ls,this.kH));delete c.Style;d.Ac(c);return d}};k.dG=function(a,b){var c=a.getAttribute("id");null!==c&&(b=Ts(a,b))&&(a=a.baseURI?xd(a.baseURI,"#"+c).toString():"#"+c,this.Ls[a]=b)};
k.cG=function(a,b){var c=a.getAttribute("id");null!==c&&(b=R(void 0,ht,a,b))&&(a=a.baseURI?xd(a.baseURI,"#"+c).toString():"#"+c,this.Ls[a]=b)};k.Qo=function(a,b){if(!(0<=ps.indexOf(a.namespaceURI)))return[];var c;c=a.localName;if("Document"==c||"Folder"==c)return(c=this.ms(a,[ep(this,a,b)]))?c:[];if("Placemark"==c)return(b=this.Wx(a,[ep(this,a,b)]))?[b]:[];if("kml"==c){c=[];for(a=a.firstElementChild;a;a=a.nextElementSibling){var d=this.Qo(a,b);d&&Jg(c,d)}return c}return[]};
function kt(a,b){b=Qf(b);b=[255*(4==b.length?b[3]:1),b[2],b[1],b[0]];var c;for(c=0;4>c;++c){var d=parseInt(b[c],10).toString(16);b[c]=1==d.length?"0"+d:d}Sp(a,b.join(""))}function lt(a,b,c){a={node:a};var d=b.T(),e,f;"GeometryCollection"==d?(e=qp(b.Pb),f=mt):"MultiPoint"==d?(e=Bp(b),f=nt):"MultiLineString"==d?(e=wp(b),f=ot):"MultiPolygon"==d?(e=cp(b),f=pt):Oa("Unknown geometry type: "+d);eh(a,qt,f,e,c)}function rt(a,b,c){eh({node:a},st,tt,[b],c)}
function ut(a,b,c){var d={node:a};b.Fb()&&a.setAttribute("id",b.Fb());a=De(b);var e=b.kd;e&&(e=e.call(b,0))&&(e=Array.isArray(e)?e[0]:e,this.LI&&(a.Style=e),(e=e.La)&&(a.name=e.La));e=vt[c[c.length-1].node.namespaceURI];a=ch(a,e);eh(d,wt,bh,a,c,e);a=c[0];(b=b.l())&&(b=gp(b,!0,a));eh(d,wt,mt,[b],c)}function xt(a,b,c){var d=b.s;a={node:a};a.layout=b.Ha;a.stride=b.W;eh(a,yt,zt,[d],c)}function At(a,b,c){b=Bk(b);var d=b.shift();a={node:a};eh(a,Bt,Ct,b,c);eh(a,Bt,Dt,[d],c)}
function Et(a,b){Tp(a,Math.round(b*b*1E6)/1E6)}
var Ft=Q(ps,["Document","Placemark"]),It=Q(ps,{Document:M(function(a,b,c){eh({node:a},Gt,Ht,b,c,void 0,this)}),Placemark:M(ut)}),Gt=Q(ps,{Placemark:M(ut)}),Jt={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},Kt=Q(ps,["href"],Q(os,["x","y","w","h"])),Lt=Q(ps,{href:M(Sp)},Q(os,{x:M(Tp),y:M(Tp),w:M(Tp),h:M(Tp)})),Mt=Q(ps,["scale","heading","Icon",
"hotSpot"]),Ot=Q(ps,{Icon:M(function(a,b,c){a={node:a};var d=Kt[c[c.length-1].node.namespaceURI],e=ch(b,d);eh(a,Lt,bh,e,c,d);d=Kt[os[0]];e=ch(b,d);eh(a,Lt,Nt,e,c,d)}),heading:M(Tp),hotSpot:M(function(a,b){a.setAttribute("x",b.x);a.setAttribute("y",b.y);a.setAttribute("xunits",b.st);a.setAttribute("yunits",b.tt)}),scale:M(Et)}),Pt=Q(ps,["color","scale"]),Qt=Q(ps,{color:M(kt),scale:M(Et)}),Rt=Q(ps,["color","width"]),St=Q(ps,{color:M(kt),width:M(Tp)}),st=Q(ps,{LinearRing:M(xt)}),qt=Q(ps,{LineString:M(xt),
Point:M(xt),Polygon:M(At),GeometryCollection:M(lt)}),vt=Q(ps,"name open visibility address phoneNumber description styleUrl Style".split(" ")),wt=Q(ps,{MultiGeometry:M(lt),LineString:M(xt),LinearRing:M(xt),Point:M(xt),Polygon:M(At),Style:M(function(a,b,c){a={node:a};var d={},e=b.Uc,f=b.qc,g=b.xa();b=b.La;g instanceof tj&&(d.IconStyle=g);b&&(d.LabelStyle=b);f&&(d.LineStyle=f);e&&(d.PolyStyle=e);b=Tt[c[c.length-1].node.namespaceURI];d=ch(d,b);eh(a,Ut,bh,d,c,b)}),address:M(Sp),description:M(Sp),name:M(Sp),
open:M(Rp),phoneNumber:M(Sp),styleUrl:M(Sp),visibility:M(Rp)}),yt=Q(ps,{coordinates:M(function(a,b,c){c=c[c.length-1];var d=c.layout;c=c.stride;var e;"XY"==d||"XYM"==d?e=2:"XYZ"==d||"XYZM"==d?e=3:Oa("Unknown geometry layout");var f,g=b.length,h="";if(0<g){h+=b[0];for(d=1;d<e;++d)h+=","+b[d];for(f=c;f<g;f+=c)for(h+=" "+b[f],d=1;d<e;++d)h+=","+b[f+d]}Sp(a,h)})}),Bt=Q(ps,{outerBoundaryIs:M(rt),innerBoundaryIs:M(rt)}),Vt=Q(ps,{color:M(kt)}),Tt=Q(ps,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),
Ut=Q(ps,{IconStyle:M(function(a,b,c){a={node:a};var d={},e=b.dr(),f=b.ja(),g=b.fl(),e={href:e};if(f){e.w=f[0];e.h=f[1];var h=b.bl(),l=b.ge();l&&g&&0!==l[0]&&l[1]!==f[1]&&(e.x=l[0],e.y=g[1]-(l[1]+f[1]));h&&0!==h[0]&&h[1]!==f[1]&&(d.hotSpot={x:h[0],st:"pixels",y:f[1]-h[1],tt:"pixels"})}d.Icon=e;f=b.gb();1!==f&&(d.scale=f);b=b.Vb();0!==b&&(d.heading=b);b=Mt[c[c.length-1].node.namespaceURI];d=ch(d,b);eh(a,Ot,bh,d,c,b)}),LabelStyle:M(function(a,b,c){a={node:a};var d={},e=b.Uc;e&&(d.color=e.nb);(b=b.gb())&&
1!==b&&(d.scale=b);b=Pt[c[c.length-1].node.namespaceURI];d=ch(d,b);eh(a,Qt,bh,d,c,b)}),LineStyle:M(function(a,b,c){a={node:a};var d=Rt[c[c.length-1].node.namespaceURI];b=ch({color:b.nb,width:b.Nd()},d);eh(a,St,bh,b,c,d)}),PolyStyle:M(function(a,b,c){eh({node:a},Vt,Wt,[b.nb],c)})});function Nt(a,b,c){return Rg.createElementNS(os[0],"gx:"+c)}function Ht(a,b){return Rg.createElementNS(b[b.length-1].node.namespaceURI,"Placemark")}
function mt(a,b){if(a)return Rg.createElementNS(b[b.length-1].node.namespaceURI,Jt[a.T()])}var Wt=$g("color"),zt=$g("coordinates"),Ct=$g("innerBoundaryIs"),nt=$g("Point"),ot=$g("LineString"),tt=$g("LinearRing"),pt=$g("Polygon"),Dt=$g("outerBoundaryIs");
ms.prototype.Oz=function(a,b){b=fp(this,b);var c=Rg.createElementNS(ps[4],"kml");c.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:gx",os[0]);c.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance");c.setAttributeNS("http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation","http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd");var d={node:c},e={};1<a.length?e.Document=a:1==a.length&&(e.Placemark=a[0]);a=
Ft[c.namespaceURI];e=ch(e,a);eh(d,It,bh,e,[b],a,this);return c};function Xt(a){a=a?a:{};this.vb=null;this.vb=vf(a.vb?a.vb:"EPSG:4326")}u(Xt,hp);function Yt(a,b){var c=[],d,e,f;e=0;for(f=a.length;e<f;++e)d=a[e],0<e&&c.pop(),d=0<=d?b[d]:b[~d].slice().reverse(),c.push.apply(c,d);a=0;for(b=c.length;a<b;++a)c[a]=c[a].slice();return c}function $t(a,b,c,d,e){a=a.geometries;var f=[],g,h;g=0;for(h=a.length;g<h;++g)f[g]=au(a[g],b,c,d,e);return f}
function au(a,b,c,d,e){var f=a.type,g=bu[f];b="Point"===f||"MultiPoint"===f?g(a,c,d):g(a,b);c=new Eg;c.Rc(gp(b,!1,e));void 0!==a.id&&(c.Mc=a.id,c.R());a.properties&&c.Ac(a.properties);return c}
Xt.prototype.Ux=function(a,b){if("Topology"==a.type){var c,d=null,e=null;a.transform&&(c=a.transform,d=c.scale,e=c.translate);var f=a.Lh;if(c){c=d;var g=e,h,l;h=0;for(l=f.length;h<l;++h){var n=f[h],r=c,t=g,v=0,x=0,y,B,E;B=0;for(E=n.length;B<E;++B)y=n[B],v+=y[0],x+=y[1],y[0]=v,y[1]=x,cu(y,r,t)}}c=[];a=ie(a.NJ);g=0;for(h=a.length;g<h;++g)"GeometryCollection"===a[g].type?(l=a[g],c.push.apply(c,$t(l,f,d,e,b))):(l=a[g],c.push(au(l,f,d,e,b)));return c}return[]};
function cu(a,b,c){a[0]=a[0]*b[0]+c[0];a[1]=a[1]*b[1]+c[1]}Xt.prototype.Zl=function(){return this.vb};
var bu={Point:function(a,b,c){a=a.coordinates;b&&c&&cu(a,b,c);return new ok(a)},LineString:function(a,b){a=Yt(a.Lh,b);return new tp(a)},Polygon:function(a,b){var c=[],d,e;d=0;for(e=a.Lh.length;d<e;++d)c[d]=Yt(a.Lh[d],b);return new wk(c)},MultiPoint:function(a,b,c){a=a.coordinates;var d,e;if(b&&c)for(d=0,e=a.length;d<e;++d)cu(a[d],b,c);return new yp(a)},MultiLineString:function(a,b){var c=[],d,e;d=0;for(e=a.Lh.length;d<e;++d)c[d]=Yt(a.Lh[d],b);return new up(c)},MultiPolygon:function(a,b){var c=[],
d,e,f,g,h,l;h=0;for(l=a.Lh.length;h<l;++h){d=a.Lh[h];e=[];f=0;for(g=d.length;f<g;++f)e[f]=Yt(d[f],b);c[h]=e}return new Cp(c)}};function F(){C.log("nsVmap.nsMapManager.MapManager");this.dc=[];this.Bi={};this.ne={};this.Qr={};this.Pr={};this.Rr={};if(m(C.properties.token)){var a=this;$.ajax({url:C.properties.api_url+"/vmap/mapcatalog?token="+C.properties.token,async:!1,context:document.body}).done(function(b){m(b.mapcatalogs)&&(b=b.mapcatalogs[0]);a.so(b)}).fail(function(){a.so({maps:[],services:{wms:[],bing:[],osm:[]},usedMap:null})})}else this.so({maps:[],services:{},status:0})}ta("nsVmap.nsMapManager.MapManager",F);
F.prototype.so=function(a){C.log("nsVmap.nsMapManager.MapManager.loadMapTools");C.log("oMapCatalog: ",a);0===a.maps.length&&(a.maps.push({name:"Carte vide",description:"",thumbnail:"",projection:"EPSG:3857",url:null}),1===a.status&&null!=angular.element(z.b).injector()&&setTimeout(function(){"vmap"===angular.element(z.b).injector().get(["envSrvc"]).oSelectedMode.mode_id&&bootbox.alert("<h4>Acune carte n'est associ\u00e9e \u00e0 cet utilisateur, veuillez contacter l'administrateur de l'application</h4>")},
3E3));this.dc=a;var b=a.usedMap;if(null!=oUrlParams.map_id)for(var c=0;c<a.maps.length;c++)a.maps[c].map_id===parseFloat(oUrlParams.map_id)&&(b=angular.copy(c),a.usedMap=b);null!=b&&null!=a.maps[b].url?(du(this),this.Mw(a.maps[b].url)):(this.Bi={name:"Tree",children:[{view:{center:[225989.8114356043,6761426.974988975],zoom:11,projection:"EPSG:2154"}}]},this.Qr=new Oq,this.Pr=new Pq,this.Rr=new Qq);this.ne=new yr(a)};F.prototype.loadMapTools=F.prototype.so;
F.prototype.Mw=function(a){C.log("nsVmap.nsMapManager.MapManager.loadLayersTools");var b=this;null!=a&&$.ajax({url:a,async:!1,context:document.body}).done(function(a){m(a.mapjsons)&&(a=a.mapjsons[0]);C.log(a);b.Bi=a;b.Qr=new Oq;b.Pr=new Pq;b.Rr=new Qq})};F.prototype.loadLayersTools=F.prototype.Mw;
F.prototype.gE=function(a){C.log("nsVmap.nsMapManager.MapManager.loadMap");a=a.getAttribute("url");if(null==a||0===a.length)return 0;var b=eu(a);C.log("oTree: ",b);this.Mi(b);this.Ii();for(b=0;b<this.dc.maps.length;b++)this.dc.maps[b].url===a&&(this.dc.usedMap=b);du(this);C.log("oVmap.event: mapChanged");C.scope.$broadcast("mapChanged")};F.prototype.loadMap=F.prototype.gE;
function du(a){C.log("nsVmap.nsMapManager.MapManager.prototype.setUsedMap");for(var b=0;b<a.dc.maps.length;b++)a.dc.maps[b].used=!1;a.dc.maps[a.dc.usedMap].used=!0}
F.prototype.rb=function(a){C.log("nsVmap.nsMapManager.MapManager.prototype.addLayer");for(var b=!1,c=jQuery.extend(!0,{},C.oa.ei()),d=C.g().F.getLayers().L(),e=H(C.g().F).Da(),f=H(C.g().F).na(),g=H(C.g().F).df(),h=0;h<c.children.length;h++)c.children[h].name===a.zc&&(b=h);a.select=null;"true"===a.$F&&(a.select=!1);c.children[0].view.zoom=g;c.children[0].view.center=e;c.children[0].view.resolution=f;if("tilewms"===a.Qd||"imagewms"===a.Qd){e=[];for(h=0;h<d.length;h++){if("tilewms"===d[h].get("type"))for(f=
d[h].v().Kb,g=0;g<f.length;g++)e.push({url:f[g],$a:d[h].v().wc.LAYERS});"imagewms"===d[h].get("type")&&e.push({url:d[h].v().Te,$a:d[h].v().wc.LAYERS})}for(h=0;h<e.length;h++)if(e[h].url===C.properties.use_proxy_for_tiles?Mq(a.url):a.url&&e[h].$a===a.Pd)return $.notify("La couche est d\u00e9j\u00e0 pr\u00e9sente","wms-log-message"),null;!1===b?(a={name:a.zc,children:[{name:a.vd,index:1E6,layerType:"tilewms",visible:"true",legend:"true",select:a.select,url:a.url,params:{LAYERS:a.Pd,VERSION:a.version,
STYLES:null!=a.style?a.style:""}}]},c.children.push(a)):(a={name:a.vd,index:1E6,layerType:"tilewms",visible:"true",legend:"true",select:a.select,url:a.url,params:{LAYERS:a.Pd,VERSION:a.version,STYLES:null!=a.style?a.style:""}},c.children[b].children.push(a))}else if("osm"===a.Qd){for(h=0;h<c.children.length;h++)if(c.children[h].children)for(g=0;g<c.children[h].children.length;g++)if(c.children[h].children[g].url===a.url||""==a.url&&"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png"==c.children[h].children[g].url)return $.notify("La couche est d\u00e9j\u00e0 pr\u00e9sente",
"error"),0;!1===b?(a={name:a.zc,children:[{index:1E6,name:a.vd,visible:"true",layerType:"osm",url:a.url}]},c.children.push(a)):(a={name:a.vd,index:1E6,visible:"true",layerType:"osm",url:a.url},c.children[b].children.push(a))}else if("xyz"===a.Qd){for(h=0;h<c.children.length;h++)if(c.children[h].children)for(g=0;g<c.children[h].children.length;g++)if(c.children[h].children[g].url===a.url)return $.notify("La couche est d\u00e9j\u00e0 pr\u00e9sente","error"),0;!1===b?(a={name:a.zc,children:[{index:1E6,
name:a.vd,visible:"true",layerType:"xyz",url:a.url}]},c.children.push(a)):(a={name:a.vd,index:1E6,visible:"true",layerType:"xyz",url:a.url},c.children[b].children.push(a))}else if("bing"===a.Qd){for(h=0;h<c.children.length;h++)if(c.children[h].children)for(g=0;g<c.children[h].children.length;g++)if(c.children[h].children[g].imagerySet===a.Pd)return $.notify("La couche est d\u00e9j\u00e0 pr\u00e9sente","error"),0;!1===b?(a={name:a.zc,children:[{name:a.Pd,index:1E6,imagerySet:a.Pd,visible:"true",layerType:"bing",
key:a.key,culture:a.Th}]},c.children.push(a)):(a={name:a.Pd,index:1E6,imagerySet:a.Pd,visible:"true",layerType:"bing",key:a.key,culture:a.Th},c.children[b].children.push(a))}else if("wmts"===a.Qd){for(h=0;h<c.children.length;h++)if(c.children[h].children)for(g=0;g<c.children[h].children.length;g++)if(c.children[h].children[g].layer===a.Pd)return $.notify("La couche est d\u00e9j\u00e0 pr\u00e9sente","error"),0;!1===b?(a={name:a.zc,children:[{name:a.vd,index:1E6,layer:a.Pd,visible:"true",layerType:"wmts",
matrixSet:a.zo,style:a.style,format:a.format,requestEncoding:a.fm,service_options:a.Ay,version:a.version,url:a.url}]},c.children.push(a)):(a={name:a.vd,index:1E6,layer:a.Pd,visible:"true",layerType:"wmts",matrixSet:a.zo,style:a.style,format:a.format,requestEncoding:a.fm,service_options:a.Ay,version:a.version,url:a.url},c.children[b].children.push(a))}else if("imagevector"===a.Qd){for(h=0;h<c.children.length;h++)if(c.children[h].children)for(g=0;g<c.children[h].children.length;g++)if("imagevector"===
c.children[h].children[g].layerType&&void 0!==c.children[h].children[g].url&&(c.children[h].children[g].url===C.properties.use_proxy_for_tiles?Mq(a.url):a.url))return $.notify("La couche est d\u00e9j\u00e0 pr\u00e9sente","error"),0;!1===b?(a={name:a.zc,children:[{name:a.vd,index:1E6,visible:"true",layerType:"imagevector",url:a.url,features:a.features,style:a.style}]},c.children.push(a)):(a={name:a.vd,index:1E6,visible:"true",layerType:"imagevector",url:a.url,features:a.features,style:a.style},c.children[b].children.push(a))}else console.error('type :"'+
a.Qd+'" non pris en compte');C.oa.Mi(c);C.oa.Ii();C.hm(!1)};F.prototype.addLayer=F.prototype.rb;
F.prototype.ak=function(a){C.log("removeLayer");for(var b=this.Bi,c=H(C.g().F).na(),d=H(C.g().F).Da(),e=0;e<b.children.length;e++)if(b.children[e].children)for(var f=b.children[e].children,g=0;g<f.length;g++)f[g].olLayer.$$hashKey===a.$$hashKey&&f.splice(g,1);C.g().F.ak(a);for(e=0;e<b.children.length;e++)b.children[e].children&&0===b.children[e].children.length&&(C.g().F.getLayers().L().length=0,b.children.splice(e,1),this.Ii());Mk(H(C.g().F),c);H(C.g().F).ib(d)};F.prototype.removeLayer=F.prototype.ak;
F.prototype.Wp=function(a,b,c){C.log("nsVmap.nsMapManager.MapManager.addLayerFromVectorContent");var d;try{d=$.parseJSON(a)}catch(n){d=a}for(var e=[Br,Ep,hs,ms,Xt],f=0;f<e.length;f++){var g=new e[f];try{var h=g.Zj(d);if(0<h.length)var l=h,f=e.length}catch(n){}}if(null!=l)return a={Qd:"imagevector",zc:b,vd:c,features:l,style:new yg({fill:new ug({color:"rgba(255, 255, 255, 0.1)"}),stroke:new wg({color:"#319FD3",width:2})})},this.rb(a),!0;$.notify("Impossible de lire les g\u00e9om\u00e9tries","error");
console.error("Impossible de lire les g\u00e9om\u00e9tries: ",a);return!1};F.prototype.addLayerFromVectorContent=F.prototype.Wp;
F.prototype.hE=function(a){C.log("nsVmap.nsMapManager.MapManager.loadMapFromFile");var b=a.getAttribute("file-container");a=a.getAttribute("url");$("#maplist-log-message").empty();if(""!==a)if("htt"===a||"www"===a)oTree=eu(a),C.oa.Mi(oTree),C.oa.Ii();else{$.notify("Erreur lors du chargement du fichier: Pour de raisons de s\u00e9curit\u00e9, lors de l'utilisation d'un fichier local, vous devez utiliser le bouton \"Chercher\"","error");return}else if(""!==b){b=document.getElementById(b).files;if(!b.length){$.notify("Veuillez s\u00e9lectionner un fichier",
"error");return}b=b[0];a=new FileReader;a.onloadend=function(a){a.target.readyState===FileReader.DONE&&(a=$.parseJSON(a.target.result),C.oa.Mi(a),C.oa.Ii())};a.readAsText(b)}else{$.notify("Veuillez s\u00e9lectionner un fichier","error");return}C.ph("close-modal-button")};F.prototype.loadMapFromFile=F.prototype.hE;F.prototype.Ii=function(){C.log("nsVmap.nsMapManager.MapManager.reloadMap");angular.element($("#layertree")).scope().$evalAsync(function(a){a.ctrl.am()})};F.prototype.reloadMap=F.prototype.Ii;
function eu(a){var b;$.ajax({url:a,async:!1,context:document.body}).done(function(a){m(a.mapjsons)&&(a=a.mapjsons[0]);b=a});C.log(b);return b}
F.prototype.ZA=function(a){var b=a.getAttribute("collapse"),c=$(a.getAttribute("data-target"))[0];"in"===b?(a.setAttribute("collapse","out"),$(a).find(".list-group-icon2").removeClass("icon-keyboard_arrow_down"),$(a).find(".list-group-icon2").addClass("icon-keyboard_arrow_right")):"out"===b?(a.setAttribute("collapse","in"),$(a).find(".list-group-icon2").removeClass("icon-keyboard_arrow_right"),$(a).find(".list-group-icon2").addClass("icon-keyboard_arrow_down")):console.error("value 'collapse' of element is not allowed: "+
a);c.setAttribute("collapse",a.getAttribute("collapse"));C.hm(!0)};F.prototype.collapseElement=F.prototype.ZA;function Mq(a){if(m(a)){var b=C.properties.proxy_url;a=a.replace(/\?/g,"&");return b+"?url="+a}}
F.prototype.iG=function(a){var b=C.g().F.getLayers().L(),c=!0;null!=C.properties.controls&&null!=C.properties.controls.RefreshSocket&&null!=C.properties.controls.RefreshSocket.keep_loaded_tiles&&(c=C.properties.controls.RefreshSocket.keep_loaded_tiles);for(var d=0;d<b.length;d++){var e=b[d].get("events");null!=e&&-1!==e.indexOf(a)&&b[d].jd(c);delete e}};F.prototype.reloadEventLayers=F.prototype.iG;F.prototype.uC=function(){return this.Qr};F.prototype.getLayersTreeTool=F.prototype.uC;
F.prototype.sC=function(){return this.Pr};F.prototype.getLayersOrderTool=F.prototype.sC;F.prototype.yC=function(){return this.Rr};F.prototype.getMapLegendTool=F.prototype.yC;F.prototype.BC=function(){return this.ne};F.prototype.getMapModalTool=F.prototype.BC;
F.prototype.ei=function(){function a(c){if(m(c.children))for(var d=0;d<c.children.length;d++)a(c.children[d]);m(c.olLayer)&&(c.visible=c.olLayer.getVisible(),c.index=b.indexOf(c.olLayer))}for(var b=C.g().F.getLayers().L(),c=0;c<this.Bi.children.length;c++)a(this.Bi.children[c]);return this.Bi};F.prototype.getLayersTree=F.prototype.ei;
F.prototype.Nn=function(){function a(b){if(m(b.children))for(var d=0;d<b.children.length;d++)a(b.children[d]);m(b.olLayer)&&delete b.olLayer;m(b.$$hashKey)&&delete b.$$hashKey;m(b.visibleLayers)&&delete b.visibleLayers;m(b.view)&&(b.view.extent=Hk(H(c),c.ja()),b.view.projection=H(c).D().M);"imagevector"===b.layerType&&null!=b.features&&(delete b.features,b.features=[])}for(var b=jQuery.extend(!0,{},C.oa.ei()),c=C.g().F,d=0;d<b.children.length;d++)a(b.children[d]);return JSON.stringify(b)};
F.prototype.getJSONLayersTree=F.prototype.Nn;F.prototype.Mi=function(a){this.Bi=a};F.prototype.setLayersTree=F.prototype.Mi;F.prototype.aw=function(a){C.log("nsVmap.nsMapManager.MapManager.prototype.getQueryableLayers");a=m(a)?a:!1;for(var b=C.g().F.getLayers().L(),c=[],d=0;d<b.length;d++)!0===b[d].get("bo_queryable")&&m(b[d].get("layer_id"))&&(!1!==a&&!0!==b[d].values.select||c.push(b[d]));return c};F.prototype.getQueryableLayers=F.prototype.aw;
function fu(a){C.log("nsVmap.nsMapManager.MapManager.prototype.getBusinessObjectsFromLayers");for(var b={},c=0;c<a.length;c++){var d=a[c].get("bo_id");null!=b[d]?b[d].layers.push(a[c]):b[d]={bo_id:d,layers:[a[c]],bo_title:a[c].get("bo_title"),bo_id_field:a[c].get("bo_id_field"),bo_user_rights:a[c].get("bo_user_rights"),bo_search_field:a[c].get("bo_search_field"),bo_result_field:a[c].get("bo_result_field"),bo_search_use_strict:a[c].get("bo_search_use_strict"),bo_geom_column:a[c].get("bo_geom_column"),
bo_geom_type:a[c].get("bo_geom_type"),bo_index:null!=a[c].get("bo_index")?a[c].get("bo_index"):1E6}}return b}F.prototype.Hg=function(a){C.log("nsVmap.nsMapManager.MapManager.prototype.getQueryableBusinessObjects");a=this.aw(a);return fu(a)};F.prototype.getQueryableBusinessObjects=F.prototype.Hg;
F.prototype.gl=function(){C.log("nsVmap.nsMapManager.MapManager.prototype.getInsertableLayers");for(var a=C.g().F.getLayers().L(),b=[],c=0;c<a.length;c++)!0===a[c].get("bo_queryable")&&null!=a[c].get("bo_user_rights")&&m(a[c].get("layer_id"))&&-1!==a[c].get("bo_user_rights").indexOf("INSERT")&&b.push(a[c]);return b};F.prototype.getInsertableLayers=F.prototype.gl;F.prototype.Mn=function(){C.log("nsVmap.nsMapManager.MapManager.prototype.getInsertableBusinessObjects");var a=this.gl();return fu(a)};
F.prototype.getInsertableBusinessObjects=F.prototype.Mn;function gu(a){a=a?a:{};this.nn=void 0!==a.className?a.className:"ol-full-screen";var b=void 0!==a.label?a.label:"\u2922";this.zr="string"===typeof b?document.createTextNode(b):b;b=void 0!==a.cE?a.cE:"\u00d7";this.Cw="string"===typeof b?document.createTextNode(b):b;b=a.og?a.og:"Toggle full-screen";b=zc("BUTTON",{"class":this.nn+"-"+Ed(),type:"button",title:b},this.zr);J(b,"click",this.ie,this);var c=this.nn+" ol-unselectable ol-control "+(Cd()?"":"ol-unsupported"),b=zc("DIV",c,b);Ok.call(this,{element:b,
target:a.target});this.kc=void 0!==a.keys?a.keys:!1;this.Sb=a.source}u(gu,Ok);
gu.prototype.ie=function(a){a.preventDefault();Cd()&&(a=this.g())&&(Ed()?(a=tc().Ze,a.webkitCancelFullScreen?a.webkitCancelFullScreen():a.mozCancelFullScreen?a.mozCancelFullScreen():a.msExitFullscreen?a.msExitFullscreen():a.exitFullscreen&&a.exitFullscreen()):(a=this.Sb?wc(document,this.Sb):Bo(a),this.kc?a.mozRequestFullScreenWithKeys?a.mozRequestFullScreenWithKeys():a.webkitRequestFullscreen?a.webkitRequestFullscreen():Dd(a):Dd(a)))};
gu.prototype.gD=function(){var a=this.element.firstElementChild,b=this.g();Ed()?(a.className=this.nn+"-true",Fc(this.Cw,this.zr)):(a.className=this.nn+"-false",Fc(this.zr,this.Cw));b&&b.yf()};gu.prototype.Ua=function(a){gu.cb.Ua.call(this,a);a&&this.vi.push(J(ce.document,Bd,this.gD,this))};function hu(a){a=a?a:{};var b=document.createElement("DIV");b.className=void 0!==a.className?a.className:"ol-mouse-position";Ok.call(this,{element:b,ka:a.ka?a.ka:iu,target:a.target});J(this,Ce("projection"),this.kr,this);a.ln&&this.set("coordinateFormat",a.ln);a.ea&&this.Is(vf(a.ea));this.oI=void 0!==a.nI?a.nI:"";this.ck=b.innerHTML;this.lo=this.Wa=this.Ml=null}u(hu,Ok);function iu(a){a=a.He;a?this.Ml!=a.ia.ea&&(this.Ml=a.ia.ea,this.Wa=null):this.Ml=null;ju(this,this.lo)}k=hu.prototype;
k.kr=function(){this.Wa=null};k.D=function(){return this.get("projection")};k.uD=function(a){this.lo=ji(this.g(),a);ju(this,this.lo)};k.vD=function(){ju(this,null);this.lo=null};k.Ua=function(a){hu.cb.Ua.call(this,a);a&&(a=a.Tb,this.vi.push(J(a,"mousemove",this.uD,this),J(a,"mouseout",this.vD,this)))};k.Is=function(a){this.set("projection",a)};
function ju(a,b){var c=a.oI;if(b&&a.Ml){if(!a.Wa){var d=a.D();a.Wa=d?zf(a.Ml,d):Jf}if(b=a.g().Kd(b))a.Wa(b,b),c=(c=a.get("coordinateFormat"))?c(b):b.toString()}a.ck&&c==a.ck||(a.element.innerHTML=c,a.ck=c)};function ku(a){a=a?a:{};this.pd=void 0!==a.collapsed?a.collapsed:!0;this.Jf=void 0!==a.sq?a.sq:!0;this.Jf||(this.pd=!1);var b=void 0!==a.className?a.className:"ol-overviewmap",c=void 0!==a.og?a.og:"Overview map",d=void 0!==a.rq?a.rq:"\u00ab";this.Rh="string"===typeof d?zc("SPAN",{},d):d;d=void 0!==a.label?a.label:"\u00bb";this.gd="string"===typeof d?zc("SPAN",{},d):d;c=zc("BUTTON",{type:"button",title:c},this.Jf&&!this.pd?this.Rh:this.gd);J(c,"click",this.ie,this);d=document.createElement("DIV");
d.className="ol-overviewmap-map";var e=this.Vd=new xo({controls:new Fe,Gj:new Fe,target:d,view:a.view});a.$a&&a.$a.forEach(function(a){e.rb(a)},this);var f=document.createElement("DIV");f.className="ol-overviewmap-box";f.style.boxSizing="border-box";this.mq=new Wo({position:[0,0],Uj:"bottom-left",element:f});this.Vd.Ff(this.mq);b=zc("DIV",b+" ol-unselectable ol-control"+(this.pd&&this.Jf?" ol-collapsed":"")+(this.Jf?"":" ol-uncollapsible"),d,c);Ok.call(this,{element:b,ka:a.ka?a.ka:lu,target:a.target})}
u(ku,Ok);k=ku.prototype;k.Ua=function(a){var b=this.g();a!==b&&(b&&(b=H(b))&&se(b,Ce("rotation"),this.Vn,this),ku.cb.Ua.call(this,a),a&&(this.vi.push(J(a,"propertychange",this.tD,this)),0===this.Vd.getLayers().Lc()&&(b=zo(a),this.Vd.set("layergroup",b)),a=H(a)))&&(J(a,Ce("rotation"),this.Vn,this),a.io()&&(this.Vd.yf(),mu(this)))};k.tD=function(a){"view"===a.key&&((a=a.oldValue)&&se(a,Ce("rotation"),this.Vn,this),a=H(this.g()),J(a,Ce("rotation"),this.Vn,this))};k.Vn=function(){H(this.Vd).mm(H(this.g()).Vb())};
function lu(){var a=this.g(),b=this.Vd;if(a.Kc&&b.Kc){var c=a.ja(),a=Hk(H(a),c),d=b.ja(),c=Hk(H(b),d),e=yl(b,ff(a)),f=yl(b,[a[2],a[1]]),b=Math.abs(e[0]-f[0]),e=Math.abs(e[1]-f[1]),f=d[0],d=d[1];b<.1*f||e<.1*d||b>.75*f||e>.75*d?mu(this):Pe(c,a)||(c=this.g(),a=this.Vd,c=H(c),H(a).ib(c.Da()))}nu(this)}function mu(a){var b=a.g();a=a.Vd;var c=b.ja(),b=Hk(H(b),c),c=a.ja();a=H(a);gf(b,1/(.1*Math.pow(2,Math.log(7.5)/Math.LN2/2)));Lk(a,b,c)}
function nu(a){var b=a.g(),c=a.Vd;if(b.Kc&&c.Kc){var d=b.ja(),e=H(b),f=H(c);c.ja();var c=e.Vb(),b=a.mq,g=a.mq.ud(),e=Hk(e,d),d=f.na(),f=af(e),e=[e[2],e[3]],h;if(a=H(a.g()).Da())h=[f[0]-a[0],f[1]-a[1]],Vj(h,c),Sj(h,a);b.setPosition(h);g&&(g.style.width=Math.abs((f[0]-e[0])/d)+"px",g.style.height=Math.abs((e[1]-f[1])/d)+"px")}}k.ie=function(a){a.preventDefault();this.mr()};
k.mr=function(){this.element.classList.toggle("ol-collapsed");this.pd?Fc(this.Rh,this.gd):Fc(this.gd,this.Rh);this.pd=!this.pd;var a=this.Vd;this.pd||a.Kc||(a.yf(),mu(this),re(a,"postrender",function(){nu(this)},this))};k.Zv=function(){return this.Vd};function ou(a){a=a?a:{};var b=void 0!==a.className?a.className:"ol-scale-line";this.ho=document.createElement("DIV");this.ho.className=b+"-inner";this.kb=document.createElement("DIV");this.kb.className=b+" ol-unselectable";this.kb.appendChild(this.ho);this.Az=null;this.Nr=void 0!==a.minWidth?a.minWidth:64;this.ab=!1;this.fy=void 0;this.ck="";Ok.call(this,{element:this.kb,ka:a.ka?a.ka:pu,target:a.target});J(this,Ce("units"),this.ID,this);this.set("units",a.units||"metric")}u(ou,Ok);var qu=[1,2,5];
ou.prototype.ql=function(){return this.get("units")};function pu(a){this.Az=(a=a.He)?a.ia:null;this.Ap()}ou.prototype.ID=function(){this.Ap()};
ou.prototype.Ap=function(){var a=this.Az;if(a){var b=a.ea,c=yf(b),a=b.fi(a.ca,a.qa)*c,c=this.Nr*a,b="",d=this.ql();"degrees"==d?(b=rf.degrees,a/=b,c<b/60?(b="\u2033",a*=3600):c<b?(b="\u2032",a*=60):b="\u00b0"):"imperial"==d?.9144>c?(b="in",a/=.0254):1609.344>c?(b="ft",a/=.3048):(b="mi",a/=1609.344):"nautical"==d?(a/=1852,b="nm"):"metric"==d?1>c?(b="mm",a*=1E3):1E3>c?b="m":(b="km",a/=1E3):"us"==d?.9144>c?(b="in",a*=39.37):1609.344>c?(b="ft",a/=.30480061):(b="mi",a/=1609.3472):Oa("Scale line element cannot be updated");
for(var d=3*Math.floor(Math.log(this.Nr*a)/Math.log(10)),e;;){e=qu[(d%3+3)%3]*Math.pow(10,Math.floor(d/3));c=Math.round(e/a);if(isNaN(c)){Yc(this.kb,!1);this.ab=!1;return}if(c>=this.Nr)break;++d}a=e+" "+b;this.ck!=a&&(this.ck=this.ho.innerHTML=a);this.fy!=c&&(this.ho.style.width=c+"px",this.fy=c);this.ab||(Yc(this.kb,!0),this.ab=!0)}else this.ab&&(Yc(this.kb,!1),this.ab=!1)};function ru(a){a=a?a:{};this.Uh=void 0;this.Tk=su;this.Ee=[];this.Fp=this.Xn=0;this.Ws=null;this.Oy=!1;this.wb=void 0!==a.duration?a.duration:200;var b=void 0!==a.className?a.className:"ol-zoomslider",c=zc("BUTTON",{type:"button","class":b+"-thumb ol-unselectable"}),b=zc("DIV",[b,"ol-unselectable","ol-control"],c);this.sn=new Xh(b);J(this.sn,bi,this.cD,this);J(this.sn,ci,this.fw,this);J(this.sn,di,this.gw,this);J(b,"click",this.$C,this);J(c,"click",ee);Ok.call(this,{element:b,ka:a.ka?a.ka:tu})}
u(ru,Ok);ru.prototype.Ca=function(){this.sn.Id();ru.cb.Ca.call(this)};var su=0;k=ru.prototype;k.Ua=function(a){ru.cb.Ua.call(this,a);a&&a.ka()};function tu(a){if(a.He){if(!this.Oy){var b=this.element,c=Wc(b),d=b.firstElementChild,b=ad(d,"margin"),e=new sc(d.offsetWidth,d.offsetHeight),d=e.width+b.right+b.left,b=e.height+b.top+b.bottom;this.Ws=[d,b];c.width>c.height?(this.Tk=1,this.Fp=c.width-d):(this.Tk=su,this.Xn=c.height-b);this.Oy=!0}a=a.He.ia.ca;a!==this.Uh&&(this.Uh=a,uu(this,a))}}
k.$C=function(a){var b=this.g(),c=H(b),d=c.na();b.$c(Wk({ca:d,duration:this.wb,Jc:Rk}));a=vu(this,jf(1===this.Tk?(a.offsetX-this.Ws[0]/2)/this.Fp:(a.offsetY-this.Ws[1]/2)/this.Xn,0,1));Mk(c,c.Hc(a))};
k.cD=function(a){if(!this.Cg&&a.originalEvent.target===this.element.firstElementChild&&(Nk(H(this.g()),1),this.hs=a.clientX,this.ks=a.clientY,this.Cg=!0,0===this.Ee.length)){a=this.fw;var b=this.gw;this.Ee.push(J(document,"mousemove",a,this),J(document,"touchmove",a,this),J(document,ci,a,this),J(document,"mouseup",b,this),J(document,"touchend",b,this),J(document,di,b,this))}};
k.fw=function(a){if(this.Cg){var b=this.element.firstElementChild;this.Uh=vu(this,jf(1===this.Tk?(a.clientX-this.hs+parseInt(b.style.left,10))/this.Fp:(a.clientY-this.ks+parseInt(b.style.top,10))/this.Xn,0,1));Mk(H(this.g()),this.Uh);uu(this,this.Uh);this.hs=a.clientX;this.ks=a.clientY}};k.gw=function(){if(this.Cg){var a=this.g(),b=H(a);Nk(b,-1);a.$c(Wk({ca:this.Uh,duration:this.wb,Jc:Rk}));a=b.Hc(this.Uh);Mk(b,a);this.Cg=!1;this.ks=this.hs=void 0;this.Ee.forEach(me);this.Ee.length=0}};
function uu(a,b){b=1-Kk(H(a.g()))(b);var c=a.element.firstElementChild;1==a.Tk?c.style.left=a.Fp*b+"px":c.style.top=a.Xn*b+"px"}function vu(a,b){return Jk(H(a.g()))(1-b)};function wu(a){a=a?a:{};this.sc=a.P?a.P:null;var b=void 0!==a.className?a.className:"ol-zoom-extent",c=zc("BUTTON",{type:"button",title:void 0!==a.og?a.og:"Fit to extent"},void 0!==a.label?a.label:"E");J(c,"click",this.ie,this);b=zc("DIV",b+" ol-unselectable ol-control",c);Ok.call(this,{element:b,target:a.target})}u(wu,Ok);wu.prototype.ie=function(a){a.preventDefault();var b=this.g();a=H(b);var c=this.sc?this.sc:a.D().Z(),b=b.ja();Lk(a,c,b)};var xu={};
function yu(){C.log("nsVmap.nsToolsManager.Controls");this.Ft=[{id:"Attribution",title:"Attributions",description:"Affiche les attributions de la couche"},{id:"MousePosition",title:"Position de la souris",description:"Affiche la position de la souris"},{id:"CurrentProjection",title:"Projection en cours",description:"Affiche la projection de la carte en cours"},{id:"OverviewMap",title:"Carte de supervision",description:"Affiche la carte de supervision"},{id:"Scale",title:"\u00c9chelle num\u00e9rique",description:"Outil de changement d'\u00e9chelle"},
{id:"ScaleLine",title:"\u00c9chelle graphique",description:"Affiche la barre d'\u00e9chelle"},{id:"Zoom",title:"Zoom",description:"Affiche les boutons de zoom + et -"},{id:"ZoomSlider",title:"Slider de zoom",description:"Affiche le slider de zoom"},{id:"RefreshSocket",title:"Rafraichissement auto",description:"Rafraichit automatiquement les couches lorsque les donn\u00e9es sont modifi\u00e9es"}];this.H=C.g().F}ta("nsVmap.nsToolsManager.Controls",yu);xu.Controls=yu;
yu.prototype.Dc=function(a){C.log("nsVmap.nsToolsManager.Controls.prototype.addControl: "+a);switch(a){case "Attribution":var b=new Pk;b.set("type",a);this.H.Dc(b);break;case "FullScreen":b=new gu;b.set("type",a);this.H.Dc(b);break;case "MousePosition":b=new hu({ln:function(a){return[a[0].toPrecision(8),a[1].toPrecision(8)]}});b.set("type",a);this.H.Dc(b);break;case "OverviewMap":this.vF=b=new ku({view:new Ek({ea:H(this.H).D()})});b.set("type",a);this.H.Dc(b);break;case "Rotate":b=new Xk({Fu:!1});
b.set("type",a);this.H.Dc(b);break;case "ScaleLine":b=new ou({minWidth:80});b.set("type",a);this.H.Dc(b);break;case "Zoom":b=new Zk;b.set("type",a);this.H.Dc(b);break;case "ZoomSlider":b=new ru;b.set("type",a);this.H.Dc(b);break;case "ZoomToExtent":b=new wu;b.set("type",a);this.H.Dc(b);break;case "CurrentProjection":$("#olMap").children().children(".ol-overlaycontainer-stopevent").append('<div id="current-projection" class="ol-current-projection ol-unselectable ol-control"></div>');$("#current-projection").html(C.oProjections[H(C.g().F).D().M]);
break;case "Scale":a='<div class="dropup"> <button class="btn btn-sm btn-default dropdown-toggle padding-sides-10 set-scale-btn" style="width: auto" type="button" onclick="$(\'#scale-list\').toggle()"> <span id="current-scale">'+C.g().gb({pretty:!0})+'</span> <span class="caret"></span> </button> <ul id="scale-list" style="font-size: 12px" class="dropdown-menu" aria-labelledby="dropdownMenu2"> <li><a class="pointer" onclick="$(\'#scale-modal\').modal(\'show\')">Ajouter \u00e0 la liste</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(1000000)">1:1,000,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(500000)">1:500,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(250000)">1:250,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(100000)">1:100,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(50000)">1:50,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(25000)">1:25,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(10000)">1:10,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(5000)">1:5,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(1000)">1:1,000</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(250)">1:250</a></li> <li><a class="pointer" onclick="oVmap.getMap().setScale(100)">1:100</a></li> </ul> </div>';
$("#olMap").children().children(".ol-overlaycontainer-stopevent").append('<div id="current-scale-tool" class="ol-current-scale ol-unselectable ol-control"></div>');$("#current-scale-tool").html(a);this.H.on("click",function(){$("#scale-list").hide()},this);var c=0;this.H.on("moveend",function(){c++;var a=angular.copy(c);setTimeout(function(){c===a&&$("#current-scale").html(C.g().gb({pretty:!0}))},100)},this);break;case "RefreshSocket":C.bRefreshWebsockets=!0;break;default:return console.error("Warning : control ("+
a+") is not available"),!1}};yu.prototype.Iy=function(a,b){C.log("nsVmap.nsToolsManager.Controls.prototype.setToolActive: "+a,b);var c=C.g().F,d=c.cf().L();b=m(b)?b:!0;if(!0===b)this.Dc(a);else for(var e=0;e<d.length;e++)if(d[e].get("type")===a)return c.cf().remove(d[e]),0;"CurrentProjection"===a?!0===b?$("#current-projection").show():$("#current-projection").hide():"Scale"===a?!0===b?$("#current-scale-tool").show():$("#current-scale-tool").hide():"RefreshSocket"===a&&(C.bRefreshWebsockets=b)};
yu.prototype.setToolActive=yu.prototype.Iy;yu.prototype.aB=function(){C.log("nsVmap.nsToolsManager.Controls.prototype.controlsDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang"},controller:"AppControlsController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/tools/controls.html"}};
yu.prototype.Zu=function(){C.log("nsVmap.nsToolsManager.Controls.prototype.controlsController");this.vk=this.Controls=C.B.vc.cf();this.aAvaliableControls=this.Controls.Ft;this.cA=C.properties.controls.active_controls;for(var a=C.g().F,b=a.cf().L(),c=0;c<b.length;c++)a.cf().remove(b[c]);for(c=0;c<this.aAvaliableControls.length;c++)this.aAvaliableControls[c].active=-1!==this.cA.indexOf(this.aAvaliableControls[c].id)?!0:!1,this.Controls.Dc(this.aAvaliableControls[c].id),!1===this.aAvaliableControls[c].active&&
this.Controls.Iy(this.aAvaliableControls[c].id,this.aAvaliableControls[c].active);setTimeout(function(){$('[data-toggle="tooltip"]').tooltip({animation:!1})},500)};yu.prototype.$B=function(){return this.Ft};yu.prototype.getAvaliableControls=yu.prototype.$B;yu.prototype.Zv=function(){return this.vF};C.module.directive("appControls",yu.prototype.aB);C.module.controller("AppControlsController",yu.prototype.Zu);function zu(a){Ae.call(this);a=a||{};this.$g=null;this.Wa=Jf;this.Mm=void 0;J(this,Ce("projection"),this.kr,this);J(this,Ce("tracking"),this.HD,this);void 0!==a.ea&&this.Is(vf(a.ea));void 0!==a.dI&&this.set("trackingOptions",a.dI);Au(this,void 0!==a.cI?a.cI:!1)}u(zu,Ae);k=zu.prototype;k.Ca=function(){Au(this,!1);zu.cb.Ca.call(this)};k.kr=function(){var a=this.D();a&&(this.Wa=zf(vf("EPSG:4326"),a),this.$g&&this.set("position",this.Wa(this.$g)))};
k.HD=function(){if(jg){var a=this.get("tracking");a&&void 0===this.Mm?this.Mm=ce.navigator.geolocation.watchPosition(this.MF.bind(this),this.NF.bind(this),this.get("trackingOptions")):a||void 0===this.Mm||(ce.navigator.geolocation.clearWatch(this.Mm),this.Mm=void 0)}};
k.MF=function(a){var b=a.coords;this.set("accuracy",b.accuracy);this.set("altitude",null===b.altitude?void 0:b.altitude);this.set("altitudeAccuracy",null===b.altitudeAccuracy?void 0:b.altitudeAccuracy);this.set("heading",null===b.heading?void 0:lf(b.heading));this.$g?(this.$g[0]=b.longitude,this.$g[1]=b.latitude):this.$g=[b.longitude,b.latitude];a=this.Wa(this.$g);this.set("position",a);this.set("speed",null===b.speed?void 0:b.speed);a=this.$g;var c=b.accuracy,b=[],d;for(d=0;32>d;++d)Jg(b,im.offset(a,
c,2*Math.PI*d/32));b.push(b[0],b[1]);a=new wk(null);a.ma("XY",b,[b.length]);a.Dk(this.Wa);this.set("accuracyGeometry",a);this.R()};k.NF=function(a){a.type="error";Au(this,!1);this.dispatchEvent(a)};k.Qn=function(){return this.get("position")};k.D=function(){return this.get("projection")};k.Is=function(a){this.set("projection",a)};function Au(a,b){a.set("tracking",b)};function Bu(){C.log("nsVmap.nsToolsManager.Location")}ta("nsVmap.nsToolsManager.Location",Bu);Bu.prototype.sE=function(){C.log("nsVmap.nsToolsManager.Location.prototype.locationDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang"},controller:"ApplocationController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/tools/location.html"}};
Bu.prototype.Fa=function(a,b,c,d){C.log("nsVmap.nsToolsManager.Location.prototype.locationController");var e=this;this.f=a;this.$timeout_=d;this.V=b;this.ua=c;this.Fc=c.defer();this.H=this.map;H(this.H).Da();H(this.H).df();this.projections=C.oProjections;this.locationResults=[];this.locationSearch="";this.searching=!1;this.noResults="";this.locationService="osm";this.customLocationServicesProperties=[];this.scale=Math.round(C.g().gb());Cu(this);a.$watch("ctrl.locationSearch",function(){a.ctrl.qy(this.last)},
!0);a.sizeOf=function(a){return Object.keys(a).length};C.scope.$on("layersChanged",function(){e.f.$applyAsync(function(){e.HJ="";e.IJ="osm";Cu(e)})});C.scope.$on("mapChanged",function(){m(e.Il)&&e.Il.remove()})};Bu.prototype.locationController=Bu.prototype.Fa;Bu.prototype.Fa.$inject=["$scope","$http","$q","$timeout"];Bu.prototype.Fa.prototype.gG=function(){C.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.refreshMap");this.map.jd()};
Bu.prototype.Fa.prototype.refreshMap=Bu.prototype.Fa.prototype.gG;Bu.prototype.Fa.prototype.fA=function(){C.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.addScale");var a=$("#new-scale-input").val();$("#scale-list").append('<li><a class="pointer" onclick="oVmap.getMap().setScale('+a+')">'+function(a){for(var b=1,d=a.length-1;0<d;d--)0===b%3&&(a=a.slice(0,d)+","+a.slice(d+Math.abs(0))),b++;return"1:"+a}(a)+"</a></li>");$("#scale-modal").modal("hide")};
Bu.prototype.Fa.prototype.addScale=Bu.prototype.Fa.prototype.fA;function Cu(a){C.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.setAPILocationProperties");a.customLocationServicesProperties=C.oa.Hg()}Bu.prototype.Fa.prototype.Ol=function(){C.log("nsVmap.nsToolsManager.Location.prototype.locationController.maxExtent");var a=this.map,b=H(this.map),c=b.D().Z(),a=a.ja();Lk(b,c,a)};Bu.prototype.Fa.prototype.maxExtent=Bu.prototype.Fa.prototype.Ol;
Bu.prototype.Fa.prototype.XC=function(){C.log("nsVmap.nsToolsManager.Location.prototype.locationController.goHome");var a=H(C.g().F),b=a.get("homePosition");a.ib(b.qa);Mk(a,b.ca)};Bu.prototype.Fa.prototype.goHome=Bu.prototype.Fa.prototype.XC;
Bu.prototype.Fa.prototype.YC=function(a,b,c){C.log("nsVmap.nsToolsManager.Location.prototype.locationController.goTo");a=[parseFloat($("#"+a).val()),parseFloat($("#"+b).val())];c=$("#"+c).val();b=H(C.g().F).D();b=Kf(a,c,b);var d=new Eg(new ok(b));if(isNaN(b[0])||isNaN(b[1]))return bootbox.alert("<h4>Ces coordonn\u00e9es ne sont pas disponibles dans la projection saisie</h4>"),0;if("EPSG:4326"!==c)var e="X: "+a[0],e=e+("<br>Y: "+a[1]);else e="Lat: "+a[0],e+="<br>Long: "+a[1];e+="<br><i>"+C.oProjections[c]+
"</i>";Du(this,d,e);H(this.map).ib(b)};Bu.prototype.Fa.prototype.goTo=Bu.prototype.Fa.prototype.YC;Bu.prototype.Fa.prototype.YB=function(){C.log("nsVmap.nsToolsManager.Location.prototype.locationController.geolocateMe");var a=this,b=new zu({ea:"EPSG:4326"});Au(b,!0);b.on("change:position",function(){var c=H(C.g().F).D(),c=Kf(b.Qn(),"EPSG:4326",c),c=new Eg(new ok(c));Du(a,c,"Vous \u00eates ici");Au(b,!1)});b.on("error",function(){console.error("error")})};Bu.prototype.Fa.prototype.geolocateMe=Bu.prototype.Fa.prototype.YB;
Bu.prototype.Fa.prototype.qy=function(a,b){C.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.searchLocation");a=m(a)?a:this.locationSearch;b=m(b)?b:4;if(0===a.length)return 0;this.Fc.resolve();this.Fc=this.ua.defer();C.B.vc.vf();""!==a&&C.B.vc.gp("#location-search-form");this.searching=!0;var c=this.noResults="";if("osm"===this.locationService)c="https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&limit="+b+"&extratags=1&namedetails=1&polygon_geojson=1&countrycodes=fr&q="+
a;else var c=this.locationService,d=this.customLocationServicesProperties[c].bo_search_field,e=this.customLocationServicesProperties[c].bo_search_use_strict,d="true"===e||!0===e?'"'+d+"\"='"+a+"'":"left"===e?'LOWER("'+d+"\") LIKE LOWER('"+a+"%')":"right"===e?'LOWER("'+d+"\") LIKE LOWER('%"+a+"')":'LOWER("'+d+"\") LIKE LOWER('%"+a+"%')",c=C.properties.api_url+"/vmap/querys/"+this.customLocationServicesProperties[c].bo_id+"/summary";var f=this;this.V({method:"GET",url:c,params:{token:C.properties.token,
filter:d,limit:b},timeout:this.Fc.promise}).then(function(a){f.searching=!1;f.locationResults=[];f.noResults="";if(!m(a.data)||null===a.data)return f.noResults="Aucun r\u00e9sultat",console.error("Pas de donn\u00e9es \u00e0 afficher"),0;if(m(a.data.error)&&m(a.data.error.errorMessage))return console.error(a.data.error.errorMessage),f.noResults=a.data.error.uJ,a.data.error;"osm"===f.locationService?f.locationResults=a.data:m(a.data.data)&&(f.locationResults=a.data.data);if(!m(f.locationResults))return 0;
if(0===f.locationResults.length)return f.noResults="Aucun r\u00e9sultat",0})};Bu.prototype.Fa.prototype.searchLocation=Bu.prototype.Fa.prototype.qy;Bu.prototype.Fa.prototype.qE=function(a){C.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.locatePlace");if(!m(a))return"place not defined";var b=a.geojson,c=H(this.map).D();m(a.lon)&&m(a.lat)&&(c=Kf([parseFloat(a.lon),parseFloat(a.lat)],"EPSG:4326",c),H(this.map).ib(c));if(!m(b))return 0;this.Uw(b,"EPSG:4326",a.display_name)};
Bu.prototype.Fa.prototype.locatePlace=Bu.prototype.Fa.prototype.qE;
Bu.prototype.Fa.prototype.jA=function(a){C.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.addSelection");var b=this,c=C.properties.api_url+"/vmap/querys/"+a.bo_type+"/summary";a='"'+a.bo_id_field.replace(/\./g,'"."')+"\"='"+a.bo_id_value+"'";var d=H(this.map).D().M.substring(5);this.V({method:"GET",url:c,params:{token:C.properties.token,filter:a,get_geom:!0,result_proj:d,get_image:!0,limit:200}}).then(function(a){$("body").css({cursor:""});m(a.data.error)&&m(a.data.error.errorMessage)&&
console.error(a.data.error.errorMessage);if(m(a.data.data))var c=a.data.data;else console.error("Pas de donn\u00e9es \u00e0 afficher");if(0===c.length)return 0;var d=c[0];if(null==d.bo_intersect_geom)return $.notify("G\u00e9om\u00e9trie non disponible"),0;Eu(b,d.bo_intersect_geom);var e=angular.element($("#vmap-basicselect-tool")).scope();e.$evalAsync(function(){var a=e.ctrl,b=ab(a.aSelections);bb(a.bj,b);a.bk();a.ze({data:[d],dataType:"summary",sb:function(){Fu(a,a.bj);a.qn(a.aSelections)}})})},
function(a){console.error(a);$("body").css({cursor:""})})};Bu.prototype.Fa.prototype.addToSelection=Bu.prototype.Fa.prototype.jA;function Eu(a,b){C.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.centerGeom");b=C.vj(b);var c=H(a.map).na();"Point"===b.T()?(H(a.map).ib(b.da()),Mk(H(a.map),c)):"MultiPoint"===b.T()?(Lk(H(a.map),b.Z(),a.map.ja()),Mk(H(a.map),c)):Lk(H(a.map),b.Z(),a.map.ja())}
Bu.prototype.Fa.prototype.Uw=function(a,b,c){C.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.locateGeom");if(!m(a))return"geom not defined";"string"===typeof a&&(a=JSON.parse(a));var d=H(this.map).D();a=(new Ep({vb:d})).Yl(a,{Ce:b,Fe:d});a=new Eg({geometry:a});Du(this,a,c)};Bu.prototype.Fa.prototype.locateGeom=Bu.prototype.Fa.prototype.Uw;
function Du(a,b,c){C.log("nsVmap.nsToolsManager.Location.prototype.locationController.prototype.locateFeature");var d=b.l().Z(),e=H(a.map).na();"Point"===b.l().T()?H(a.map).ib(b.l().da()):"MultiPoint"===b.l().T()?(Lk(H(a.map),d,a.map.ja()),H(a.map).mh(e)):Lk(H(a.map),d,a.map.ja());m(a.Il)&&a.Il.remove();a.Il=new $o(b);a.Il.za(c)}Bu.prototype.Fa.prototype.nG=function(){C.B.vc.kw("#location-search-form")};Bu.prototype.Fa.prototype.removeLocation=Bu.prototype.Fa.prototype.nG;
C.module.directive("appLocation",Bu.prototype.sE);C.module.controller("ApplocationController",Bu.prototype.Fa);function Gu(a,b,c){Yj.call(this);Hu(this,a,b?b:0,c)}u(Gu,Yj);k=Gu.prototype;k.clone=function(){var a=new Gu(null);a.ma(this.Ha,this.s.slice());return a};k.Xe=function(a,b){var c=this.s;a-=c[0];b-=c[1];return a*a+b*b<=Iu(this)};k.Da=function(){return this.s.slice(0,this.W)};k.hn=function(a){var b=this.s,c=b[this.W]-b[0];return Re(b[0]-c,b[1]-c,b[0]+c,b[1]+c,a)};k.jl=function(){return Math.sqrt(Iu(this))};function Iu(a){var b=a.s[a.W]-a.s[0];a=a.s[a.W+1]-a.s[1];return b*b+a*a}k.T=function(){return"Circle"};
k.ib=function(a){var b=this.W,c=this.s[b]-this.s[0],d=a.slice();d[b]=d[0]+c;for(c=1;c<b;++c)d[b+c]=a[c];this.ma(this.Ha,d)};function Hu(a,b,c,d){if(b){dk(a,d,b,0);a.s||(a.s=[]);d=a.s;b=gk(d,b);d[b++]=d[0]+c;var e;c=1;for(e=a.W;c<e;++c)d[b++]=d[c];d.length=b;a.R()}else a.ma("XY",null)}k.ma=function(a,b){ck(this,a,b);this.R()};function Ju(a,b){de.call(this,a);this.wa=b}u(Ju,de);
function Po(a){rl.call(this,{Qf:Ku,handleEvent:Lu,Rf:Mu});this.Hq=null;this.sj=!1;this.Sb=a.source?a.source:null;this.bc=a.features?a.features:null;this.oH=a.nH?a.nH:12;this.Dm=a.type;this.uc=Nu(this.Dm);this.ox=a.ME?a.ME:this.uc===Ou?3:2;this.hx=a.GE?a.GE:Infinity;this.TB=a.SB?a.SB:Ie;var b=a.CJ;if(!b)if("Circle"===this.Dm)b=function(a,b){b=b?b:new Gu([NaN,NaN]);Hu(b,a[0],Math.sqrt(Wj(a[0],a[1])));return b};else{var c,b=this.uc;b===Pu?c=ok:b===Qu?c=tp:b===Ou&&(c=wk);b=function(a,b){b?b.tb(a):b=new c(a);
return b}}this.fe=b;this.lk=this.qh=this.Jb=this.rh=this.Xd=this.Ge=null;this.rH=a.Su?a.Su*a.Su:36;this.ag=new qm({source:new sh({vh:!1,Sa:a.Sa?a.Sa:!1}),style:a.style?a.style:Ru()});this.td=a.ZB;this.ad=a.Mb?a.Mb:ll;this.Pv=a.XB?a.XB:ml;J(this,Ce("active"),this.sz,this)}u(Po,rl);function Ru(){var a=Dg();return function(b){return a[b.l().T()]}}k=Po.prototype;k.Ua=function(a){Po.cb.Ua.call(this,a);this.sz()};
function Lu(a){this.uc!==Qu&&this.uc!==Ou||!this.Pv(a)||(this.sj=!0);var b=!this.sj;this.sj&&a.type===vi?(Su(this,a),b=!1):a.type===ui?b=this.Bj(a):a.type===oi&&(b=!1);return sl.call(this,a)&&b}function Ku(a){return this.ad(a)?(this.Hq=a.Yc,!0):this.sj?(this.Hq=a.Yc,this.Ge||Tu(this,a),!0):!1}
function Mu(a){this.sj=!1;var b=this.Hq,c=a.Yc,d=b[0]-c[0],b=b[1]-c[1],c=!0;d*d+b*b<=this.rH&&(this.Bj(a),this.Ge?this.uc===Uu?Vu(this):Wu(this,a)?this.TB(a)&&Vu(this):Su(this,a):(Tu(this,a),this.uc===Pu&&Vu(this)),c=!1);return c}
k.Bj=function(a){if(this.Ge){var b=a.zb,c=this.Xd.l(),d;this.uc===Pu?d=this.Jb:this.uc===Ou?(d=this.Jb[0],d=d[d.length-1],Wu(this,a)&&(b=this.Ge.slice())):(d=this.Jb,d=d[d.length-1]);d[0]=b[0];d[1]=b[1];this.fe(this.Jb,c);this.rh&&this.rh.l().tb(b);c instanceof wk&&this.uc!==Ou?(this.qh||(this.qh=new Eg(new tp(null))),b=Ak(c),a=this.qh.l(),a.ma(b.Ha,b.s)):this.lk&&(a=this.qh.l(),a.tb(this.lk));Xu(this)}else a=a.zb.slice(),this.rh?this.rh.l().tb(a):(this.rh=new Eg(new ok(a)),Xu(this));return!0};
function Wu(a,b){var c=!1;if(a.Xd){var d=!1,e=[a.Ge];a.uc===Qu?d=a.Jb.length>a.ox:a.uc===Ou&&(d=a.Jb[0].length>a.ox,e=[a.Jb[0][0],a.Jb[0][a.Jb[0].length-2]]);if(d)for(var d=b.map,f=0,g=e.length;f<g;f++){var h=e[f],l=yl(d,h),n=b.Yc,c=n[0]-l[0],l=n[1]-l[1],n=a.sj&&a.Pv(b)?1:a.oH;if(c=Math.sqrt(c*c+l*l)<=n){a.Ge=h;break}}}return c}
function Tu(a,b){b=b.zb;a.Ge=b;a.uc===Pu?a.Jb=b.slice():a.uc===Ou?(a.Jb=[[b.slice(),b.slice()]],a.lk=a.Jb[0]):(a.Jb=[b.slice(),b.slice()],a.uc===Uu&&(a.lk=a.Jb));a.lk&&(a.qh=new Eg(new tp(a.lk)));b=a.fe(a.Jb);a.Xd=new Eg;a.td&&Fg(a.Xd,a.td);a.Xd.Rc(b);Xu(a);a.dispatchEvent(new Ju("drawstart",a.Xd))}
function Su(a,b){b=b.zb;var c=a.Xd.l(),d,e;if(a.uc===Qu)a.Ge=b.slice(),e=a.Jb,e.push(b.slice()),d=e.length>a.hx,a.fe(e,c);else if(a.uc===Ou){e=a.Jb[0];e.push(b.slice());if(d=e.length>a.hx)a.Ge=e[0];a.fe(a.Jb,c)}Xu(a);d&&Vu(a)}
function Vu(a){var b=Yu(a),c=a.Jb,d=b.l();a.uc===Qu?(c.pop(),a.fe(c,d)):a.uc===Ou&&(c[0].pop(),c[0].push(c[0][0]),a.fe(c,d));"MultiPoint"===a.Dm?b.Rc(new yp([c])):"MultiLineString"===a.Dm?b.Rc(new up([c])):"MultiPolygon"===a.Dm&&b.Rc(new Cp([c]));a.dispatchEvent(new Ju("drawend",b));a.bc&&a.bc.push(b);a.Sb&&vh(a.Sb,b)}function Yu(a){a.Ge=null;var b=a.Xd;b&&(a.Xd=null,a.rh=null,a.qh=null,a.ag.v().clear(!0));return b}
k.extend=function(a){var b=a.l();this.Xd=a;this.Jb=b.da();a=this.Jb[this.Jb.length-1];this.Ge=a.slice();this.Jb.push(a.slice());Xu(this);this.dispatchEvent(new Ju("drawstart",this.Xd))};k.jk=Je;function Xu(a){var b=[];a.Xd&&b.push(a.Xd);a.qh&&b.push(a.qh);a.rh&&b.push(a.rh);a=a.ag.v();a.clear(!0);a.Hh(b)}k.sz=function(){var a=this.g(),b=this.get("active");a&&b||Yu(this);this.ag.Ua(b?a:null)};
function Nu(a){var b;"Point"===a||"MultiPoint"===a?b=Pu:"LineString"===a||"MultiLineString"===a?b=Qu:"Polygon"===a||"MultiPolygon"===a?b=Ou:"Circle"===a&&(b=Uu);return b}var Pu="Point",Qu="LineString",Ou="Polygon",Uu="Circle";function Zu(a,b){de.call(this,a);this.features=b}u(Zu,de);
function $u(a){rl.call(this,{Qf:av,Jg:bv,handleEvent:cv,Rf:dv});this.ad=a.Mb?a.Mb:ql;this.gB=function(a){return ll(a)&&kl(a)};this.lB=a.kB?a.kB:this.gB;this.zz=this.md=null;this.Ew=[0,0];this.Oj=this.ao=!1;this.hd=new oh;this.Rj=void 0!==a.FF?a.FF:10;this.Qh=this.Py=!1;this.$e=[];this.ag=new qm({source:new sh({vh:!1,Sa:!!a.Sa}),style:a.style?a.style:ev(),Ti:!0,Ui:!0});this.Np={Point:this.II,LineString:this.Pz,LinearRing:this.Pz,Polygon:this.JI,MultiPoint:this.GI,MultiLineString:this.FI,MultiPolygon:this.HI,
GeometryCollection:this.EI};this.bc=a.features;this.bc.forEach(this.Bk,this);J(this.bc,"add",this.eD,this);J(this.bc,"remove",this.fD,this);this.Cr=null}u($u,rl);k=$u.prototype;k.Bk=function(a){var b=a.l();b.T()in this.Np&&this.Np[b.T()].call(this,a,b);(b=this.g())&&fv(this,this.Ew,b);J(a,"change",this.sl,this)};function gv(a){a.Oj||(a.Oj=!0,a.dispatchEvent(new Zu("modifystart",a.bc)))}
k.So=function(a){hv(this,a);this.md&&0===this.bc.Lc()&&(zh(this.ag.v(),this.md),this.md=null);se(a,"change",this.sl,this)};function hv(a,b){a=a.hd;var c=[];a.forEach(function(a){b===a.wa&&c.push(a)});for(var d=c.length-1;0<=d;--d)a.remove(c[d])}k.Ua=function(a){this.ag.Ua(a);$u.cb.Ua.call(this,a)};k.eD=function(a){this.Bk(a.element)};k.sl=function(a){this.Qh||(a=a.target,this.So(a),this.Bk(a))};k.fD=function(a){this.So(a.element)};
k.II=function(a,b){var c=b.da();a={wa:a,geometry:b,Zb:[c,c]};this.hd.Wc(b.Z(),a)};k.GI=function(a,b){var c=b.da(),d,e,f;e=0;for(f=c.length;e<f;++e)d=c[e],d={wa:a,geometry:b,depth:[e],index:e,Zb:[d,d]},this.hd.Wc(b.Z(),d)};k.Pz=function(a,b){var c=b.da(),d,e,f,g;d=0;for(e=c.length-1;d<e;++d)f=c.slice(d,d+2),g={wa:a,geometry:b,index:d,Zb:f},this.hd.Wc(Ke(f),g)};
k.FI=function(a,b){var c=b.da(),d,e,f,g,h,l,n;g=0;for(h=c.length;g<h;++g)for(d=c[g],e=0,f=d.length-1;e<f;++e)l=d.slice(e,e+2),n={wa:a,geometry:b,depth:[g],index:e,Zb:l},this.hd.Wc(Ke(l),n)};k.JI=function(a,b){var c=b.da(),d,e,f,g,h,l,n;g=0;for(h=c.length;g<h;++g)for(d=c[g],e=0,f=d.length-1;e<f;++e)l=d.slice(e,e+2),n={wa:a,geometry:b,depth:[g],index:e,Zb:l},this.hd.Wc(Ke(l),n)};
k.HI=function(a,b){var c=b.da(),d,e,f,g,h,l,n,r,t,v;l=0;for(n=c.length;l<n;++l)for(r=c[l],g=0,h=r.length;g<h;++g)for(d=r[g],e=0,f=d.length-1;e<f;++e)t=d.slice(e,e+2),v={wa:a,geometry:b,depth:[g,l],index:e,Zb:t},this.hd.Wc(Ke(t),v)};k.EI=function(a,b){var c=b.Pb;for(b=0;b<c.length;++b)this.Np[c[b].T()].call(this,a,c[b])};function iv(a,b){var c=a.md;c?c.l().tb(b):(c=new Eg(new ok(b)),a.md=c,vh(a.ag.v(),c))}function jv(a,b){return a.index-b.index}
function av(a){if(!this.ad(a))return!1;fv(this,a.Yc,a.map);this.$e.length=0;this.Oj=!1;var b=this.md;if(b){a=[];var b=b.l().da(),c=Ke([b]),c=ph(this.hd,c),d={};c.sort(jv);for(var e=0,f=c.length;e<f;++e){var g=c[e],h=g.Zb,l=q(g.wa),n=g.depth;n&&(l+="-"+n.join("-"));d[l]||(d[l]=Array(2));if(Uj(h[0],b)&&!d[l][0])this.$e.push([g,0]),d[l][0]=g;else if(Uj(h[1],b)&&!d[l][1]){if("LineString"!==g.geometry.T()&&"MultiLineString"!==g.geometry.T()||!d[l][0]||0!==d[l][0].index)this.$e.push([g,1]),d[l][1]=g}else q(h)in
this.zz&&!d[l][0]&&!d[l][1]&&a.push([g,b])}a.length&&gv(this);for(b=a.length-1;0<=b;--b)this.XD.apply(this,a[b])}return!!this.md}
function bv(a){this.ao=!1;gv(this);a=a.zb;for(var b=0,c=this.$e.length;b<c;++b){for(var d=this.$e[b],e=d[0],f=e.depth,g=e.geometry,h=g.da(),l=e.Zb,d=d[1];a.length<g.W;)a.push(0);switch(g.T()){case "Point":h=a;l[0]=l[1]=a;break;case "MultiPoint":h[e.index]=a;l[0]=l[1]=a;break;case "LineString":h[e.index+d]=a;l[d]=a;break;case "MultiLineString":h[f[0]][e.index+d]=a;l[d]=a;break;case "Polygon":h[f[0]][e.index+d]=a;l[d]=a;break;case "MultiPolygon":h[f[1]][f[0]][e.index+d]=a,l[d]=a}e=g;this.Qh=!0;e.tb(h);
this.Qh=!1}iv(this,a)}function dv(){for(var a,b=this.$e.length-1;0<=b;--b)a=this.$e[b][0],this.hd.update(Ke(a.Zb),a);this.Oj&&(this.dispatchEvent(new Zu("modifyend",this.bc)),this.Oj=!1);return!1}
function cv(a){if(!(a instanceof ki))return!0;this.Cr=a;var b;Gk(H(a.map))[1]||a.type!=ui||this.ii||this.Bj(a);if(this.md&&this.lB(a))if(a.type==pi&&this.ao)b=!0;else if(this.md.l(),b=!1,this.Cr&&this.Cr.type!=vi){gv(this);var c=this.$e;b={};var d,e,f,g,h,l,n,r,t;for(g=c.length-1;0<=g;--g)f=c[g],n=f[0],r=q(n.wa),n.depth&&(r+="-"+n.depth.join("-")),r in b||(b[r]={}),0===f[1]?(b[r].right=n,b[r].index=n.index):1==f[1]&&(b[r].left=n,b[r].index=n.index+1);for(r in b){l=b[r].right;g=b[r].left;f=b[r].index;
h=f-1;n=void 0!==g?g:l;0>h&&(h=0);c=n.geometry;d=e=c.da();t=!1;switch(c.T()){case "MultiLineString":2<e[n.depth[0]].length&&(e[n.depth[0]].splice(f,1),t=!0);break;case "LineString":2<e.length&&(e.splice(f,1),t=!0);break;case "MultiPolygon":d=d[n.depth[1]];case "Polygon":d=d[n.depth[0]],4<d.length&&(f==d.length-1&&(f=0),d.splice(f,1),t=!0,0===f&&(d.pop(),d.push(d[0]),h=d.length-1))}t&&(d=c,this.Qh=!0,d.tb(e),this.Qh=!1,e=[],void 0!==g&&(this.hd.remove(g),e.push(g.Zb[0])),void 0!==l&&(this.hd.remove(l),
e.push(l.Zb[1])),void 0!==g&&void 0!==l&&(g={depth:n.depth,wa:n.wa,geometry:n.geometry,index:h,Zb:e},this.hd.Wc(Ke(g.Zb),g)),kv(this,c,f,n.depth,-1),this.md&&(zh(this.ag.v(),this.md),this.md=null))}b=!0;this.dispatchEvent(new Zu("modifyend",this.bc));this.Oj=!1}a.type==pi&&(this.ao=!1);return sl.call(this,a)&&!b}k.Bj=function(a){this.Ew=a.Yc;fv(this,a.Yc,a.map)};
function fv(a,b,c){function d(a,b){return Wj(e,Tj(e,a.Zb))-Wj(e,Tj(e,b.Zb))}var e=c.Kd(b),f=c.Kd([b[0]-a.Rj,b[1]+a.Rj]),g=c.Kd([b[0]+a.Rj,b[1]-a.Rj]),f=Ke([f,g]),f=ph(a.hd,f);if(0<f.length){f.sort(d);var g=f[0].Zb,h=Tj(e,g),l=yl(c,h);if(Math.sqrt(Wj(b,l))<=a.Rj){b=yl(c,g[0]);c=yl(c,g[1]);b=Wj(l,b);c=Wj(l,c);a.Py=Math.sqrt(Math.min(b,c))<=a.Rj;a.Py&&(h=b>c?g[1]:g[0]);iv(a,h);c={};c[q(g)]=!0;b=1;for(l=f.length;b<l;++b)if(h=f[b].Zb,Uj(g[0],h[0])&&Uj(g[1],h[1])||Uj(g[0],h[1])&&Uj(g[1],h[0]))c[q(h)]=!0;
else break;a.zz=c;return}}a.md&&(zh(a.ag.v(),a.md),a.md=null)}
k.XD=function(a,b){for(var c=a.Zb,d=a.wa,e=a.geometry,f=a.depth,g=a.index,h;b.length<e.W;)b.push(0);switch(e.T()){case "MultiLineString":h=e.da();h[f[0]].splice(g+1,0,b);break;case "Polygon":h=e.da();h[f[0]].splice(g+1,0,b);break;case "MultiPolygon":h=e.da();h[f[1]][f[0]].splice(g+1,0,b);break;case "LineString":h=e.da();h.splice(g+1,0,b);break;default:return}this.Qh=!0;e.tb(h);this.Qh=!1;h=this.hd;h.remove(a);kv(this,e,g,f,1);a={Zb:[c[0],b],wa:d,geometry:e,depth:f,index:g};h.Wc(Ke(a.Zb),a);this.$e.push([a,
1]);b={Zb:[b,c[1]],wa:d,geometry:e,depth:f,index:g+1};h.Wc(Ke(b.Zb),b);this.$e.push([b,0]);this.ao=!0};function kv(a,b,c,d,e){rh(a.hd,b.Z(),function(a){a.geometry===b&&(void 0===d||void 0===a.depth||Mg(a.depth,d))&&a.index>c&&(a.index+=e)})}function ev(){var a=Dg();return function(){return a.Point}};function lv(a,b){de.call(this,a);this.selected=b}u(lv,de);
function mv(a){al.call(this,{handleEvent:nv});var b=a?a:{};this.ad=b.Mb?b.Mb:kl;this.eA=b.dA?b.dA:Je;this.lG=b.kG?b.kG:Je;this.TH=b.SH?b.SH:ml;this.sx=b.$E?b.$E:!1;this.Dv=b.filter?b.filter:Ie;this.$k=new qm({source:new sh({vh:!1,features:b.features,Sa:b.Sa}),style:b.style?b.style:ov(),Ti:!0,Ui:!0});if(b.$a)if(ja(b.$a))a=function(a){return b.$a(a)};else{var c=b.$a;a=function(a){return 0<=c.indexOf(a)}}else a=Ie;this.mo=a;this.Zk={};a=this.$k.v().ob;J(a,"add",this.Bk,this);J(a,"remove",this.So,this)}
u(mv,al);k=mv.prototype;k.Ka=function(){return this.$k.v().ob};k.xb=function(a){a=q(a);return this.Zk[a]};
function nv(a){if(!this.ad(a))return!0;var b=this.eA(a),c=this.lG(a),d=this.TH(a),e=!b&&!c&&!d,f=a.map,g=this.$k.v().ob,h=[],l=[],n=!1;if(e)he(this.Zk),Ao(f,a.Yc,function(a,b){if(this.Dv(a,b))return l.push(a),a=q(a),this.Zk[a]=b,!this.sx},this,this.mo),0<l.length&&1==g.Lc()&&g.item(0)==l[0]||(n=!0,0!==g.Lc()&&(h=Array.prototype.concat(g.L()),g.clear()),g.extend(l));else{Ao(f,a.Yc,function(a,e){if(this.Dv(a,e))return!b&&!d||0<=g.L().indexOf(a)?(c||d)&&0<=g.L().indexOf(a)&&(h.push(a),e=q(a),delete this.Zk[e]):
(l.push(a),a=q(a),this.Zk[a]=e),!this.sx},this,this.mo);for(e=h.length-1;0<=e;--e)g.remove(h[e]);g.extend(l);if(0<l.length||0<h.length)n=!0}n&&this.dispatchEvent(new lv("select",l));return jl(a)}k.Ua=function(a){var b=this.g(),c=this.$k.v().ob;b&&c.forEach(b.nz,b);mv.cb.Ua.call(this,a);this.$k.Ua(a);a&&c.forEach(a.Ny,a)};function ov(){var a=Dg();Jg(a.Polygon,a.LineString);Jg(a.GeometryCollection,a.LineString);return function(b){return a[b.l().T()]}}k.Bk=function(a){a=a.element;var b=this.g();b&&b.Ny(a)};
k.So=function(a){a=a.element;var b=this.g();b&&b.nz(a)};function pv(){C.log("nsVmap.nsToolsManager.Measure")}ta("nsVmap.nsToolsManager.Measure",pv);xu.Measure=pv;pv.prototype.JE=function(){C.log("nsVmap.nsToolsManager.Measure.prototype.measureDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppmeasureController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/tools/measure.html"}};
pv.prototype.Ia=function(){C.log("nsVmap.nsToolsManager.Measure.prototype.measureController");var a=this;this.Nm=new nf(6378137);this.H=C.g().F;var b=new yg({fill:new ug({color:"rgba(255, 255, 255, 0.2)"}),stroke:new wg({color:"#ffcc33",width:2}),Gb:new xg({xc:7,fill:new ug({color:"#ffcc33"}),stroke:new wg({color:"#FFFFFF"})})});this.Sr=So(C.g(),{style:b});this.Qj=this.Sr.v().ob;this.Yn=new To({id:"measure-tooltip"});this.Vg=new $u({features:this.Qj});this.Ki=new mv({$a:[this.Sr],Mb:jl});this.rc=
new mv({$a:[this.Sr]});this.projection=H(this.map).D().M;this.oProjections=C.oProjections;this.transform=Kf;this.map.on("change:view",function(){a.projection=H(a.map).D().M});this.rc.on("select",function(){for(var a=this.rc.Ka().L(),b,e,f=a.length-1;0<=f;f--){b=C.g().F.Pc.L();e=[];for(var g=b.length-1;0<=g;g--)b[g].get("feature")!==a[f]&&"info"!==b[g].get("feature")||e.push(b[g]);for(g=e.length-1;0<=g;g--)C.g().F.Pc.remove(e[g]);this.Qj.remove(a[f])}this.rc.Ka().clear();this.Ki.Ka().clear()},this);
this.ai=document.getElementById("geodesic")};pv.prototype.measureController=pv.prototype.Ia;function qv(a,b){a.Xc&&a.Xc.parentNode.removeChild(a.Xc);a.Xc=document.createElement("div");a.Xc.className="measure-tooltip measure-tooltip-measure";a.yi=new Wo({element:a.Xc,offset:[0,-15],Uj:"bottom-center"});a.yi.set("type","measure");void 0!==b&&a.yi.set("feature",b);a.H.Ff(a.yi)}
function rv(a,b){a.Ug&&a.Ug.parentNode.removeChild(a.Ug);a.Ug=document.createElement("div");a.Ug.className="measure-tooltip measure-tooltip-measure";a.Co=new Wo({element:a.Ug,offset:[0,-15],Uj:"bottom-center"});a.Co.set("type","measure");void 0!==b&&a.Co.set("feature",b);C.g().Ff(a.Co)}k=pv.prototype.Ia.prototype;
k.Ub=function(a){C.log("addInteraction");var b=this;this.ic=C.g().gg({type:a,features:this.Qj},"basicTools-measure"+a);qv(this,"info");this.ic.on("drawstart",function(a){rv(this,a.wa);this.ip=a.wa;var c=a.zb;b.listener=this.ip.l().on("change",function(a){a=a.target;var d;a instanceof wk?(d=b.Cn(a),c=zk(a).da()):a instanceof tp?(d=b.bf(a),c=bk(a)):a instanceof Gu&&(d=b.rj(a),c=bk(a));b.Ug.innerHTML=d;b.Co.setPosition(c)})},this);this.ic.on("drawend",function(a){qv(this,a.wa);this.Li(a.wa);this.Xc.innerHTML=
b.Ug.innerHTML;this.Ug.style.display="none";this.Xc.className="measure-tooltip measure-tooltip-static";Xo(this.yi,[.8,-13]);this.yi.setPosition(this.gi(a.wa.l()));this.Xc=this.ip=null;this.kk();sv(this,a.wa);this.Xc&&(this.Xc.className="measure-tooltip measure-tooltip-static",this.Xc.remove(),Xo(this.yi,[0,-7]),this.Xc=this.ip=null);a.wa.on("change",function(){sv(this,a.wa)},this);xe(b.listener)},this)};
function sv(a,b,c){C.log("nsVmap.nsToolsManager.Measure.prototype.measureController.prototype.updateTooltip");(m(c)?c:1)&&a.Li(b);c=C.g().F.Pc;for(var d=c.L().length-1;0<=d;d--)if(c.L()[d].get("feature")===b)if(c.L()[d].setPosition(a.gi(b.l())),"Ligne"===b.get("Type"))c.L()[d].ud().innerHTML=b.get("Longueur");else if("Polygone"===b.get("Type"))c.L()[d].ud().innerHTML=b.get("Superficie");else if("Cercle"===b.get("Type"))c.L()[d].ud().innerHTML=b.get("Perim\u00e8tre");else if("Point"===b.get("Type")){var e=
Kf(b.get("Coordonn\u00e9es"),a.projection,b.get("Projection")),f,g=document.createElement("select"),h;for(h in a.oProjections)f=document.createElement("option"),f.value=h,f.innerHTML=C.oProjections[h],g.appendChild(f);g.value=b.get("Projection");f=document.createElement("div");f.innerHTML="X = "+parseFloat(e[0]).toPrecision(9);f.innerHTML+="<br>";f.innerHTML+="Y = "+parseFloat(e[1]).toPrecision(9);var l=a;g.onchange=function(){b.set("Projection",this.value);sv(l,b,!1)};$(c.L()[d].ud()).empty();c.L()[d].ud().appendChild(g);
c.L()[d].ud().appendChild(f)}}
k.Li=function(a){if(a.l()instanceof ok)a.set("Type","Point"),a.set("Coordonn\u00e9es",this.Ov(a.l())),a.set("Projection",H(this.map).D().M);else if(a.l()instanceof tp)a.set("Type","Ligne"),a.set("Longueur",this.bf(a.l())),a.set("Projection",H(this.map).D().M);else if(a.l()instanceof wk)a.set("Type","Polygone"),a.set("Perim\u00e8tre",this.Oq(a.l())),a.set("Superficie",this.Cn(a.l())),a.set("Projection",H(this.map).D().M);else if(a.l()instanceof Gu){var b=parseFloat(this.rj(a.l())),c=this.rj(a.l()).replace(b,
""),d=2*b,e=Math.PI*b*2,f=Math.PI*Math.pow(b,2);a.set("Type","Cercle");a.set("Rayon",b+c);a.set("Diam\u00e8tre",d.toFixed(4)+c);a.set("Perim\u00e8tre",e.toFixed(4)+c);a.set("Superficie",f.toFixed(4)+c+"\u00b2");a.set("Centre",[a.l().Da()[0].toFixed(4),a.l().Da()[1].toFixed(4)]);a.set("Projection",H(this.map).D().M)}else a.set("Type","undefined");b=this.Qj.Lc()-1;a.set("Id",b);a.set("Keys",a.Ld())};
k.gi=function(a){if("Polygon"===a.T())a=bk(zk(a));else if("LineString"===a.T())a=bk(a);else if("Circle"===a.T())a=a.Da();else if("Point"===a.T())a=bk(a);else return bk(a);return a};k.bf=function(a){this.ai.checked&&"EPSG:3857"===H(this.H).D().M||"EPSG:4326"===H(this.H).D().M?(a=a.da(),a=this.Hk(a)):a=a.Lc();return 1E3<a?Math.round(a/1E3*100)/100+" km":Math.round(100*a)/100+" m"};
k.Hk=function(a){length=0;for(var b=H(this.H).D(),c=0,d=a.length-1;c<d;++c){var e=Kf(a[c],b,"EPSG:4326"),f=Kf(a[c+1],b,"EPSG:4326");length+=pf(this.Nm,e,f)}return length};k.Ov=function(a){return[a.da()[0].toPrecision(9),a.da()[1].toPrecision(9)]};k.rj=function(a){this.ai.checked&&"EPSG:3857"===H(this.H).D().M||"EPSG:4326"===H(this.H).D().M?(a=[ak(a),bk(a)],a=this.Hk(a)):a=Math.round(100*a.jl())/100;return 1E3<a?Math.round(a/1E3*100)/100+" km":Math.round(100*a)/100+" m"};
k.Oq=function(a){a=new tp(a.da()[0],a.Ha);return this.bf(a)};k.Cn=function(a){if(this.ai.checked&&"EPSG:3857"===H(this.H).D().M||"EPSG:4326"===H(this.H).D().M){var b=H(this.H).D();a=Ak(a.clone().transform(b,"EPSG:4326")).da();a=Math.abs(of(this.Nm,a))}else a=a.uj();return 1E6<a?Math.round(a/1E6*100)/100+" km\u00b2":Math.round(100*a)/100+" m\u00b2"};
k.Om=function(a){C.log("nsVmap.nsToolsManager.Measure.prototype.measureController.zoomToFeature");"Point"===a.get("Type")?H(this.H).ib(a.l().da()):"Cercle"===a.get("Type")?(Lk(H(this.H),a.l(),[400,400],{padding:[0,0,0,0]}),H(this.H).ib(a.l().Da())):Lk(H(this.H),a.l(),[800,800],{padding:[0,0,0,0]})};pv.prototype.Ia.prototype.zoomToFeature=pv.prototype.Ia.prototype.Om;
pv.prototype.Ia.prototype.kk=function(){C.log("nsVmap.nsToolsManager.Measure.prototype.measureController.showHideAnotations");document.getElementById("measure-anotations").checked?$(".measure-tooltip-static").show():$(".measure-tooltip-static").hide()};pv.prototype.Ia.prototype.showHideAnotations=pv.prototype.Ia.prototype.kk;
pv.prototype.Ia.prototype.Dg=function(a){C.log("nsVmap.nsToolsManager.Measure.prototype.measureController.drawPoint");this.dh();a||(C.g().sa.za("Cliquer pour mesurer l'emplacement d'un point"),this.Ub("Point"))};pv.prototype.Ia.prototype.drawPoint=pv.prototype.Ia.prototype.Dg;pv.prototype.Ia.prototype.KE=function(a){C.log("nsVmap.nsToolsManager.Measure.prototype.measureController.measureLine");this.dh();a||(C.g().sa.za("Cliquer pour commencer \u00e0 mesurer"),this.Ub("LineString"))};
pv.prototype.Ia.prototype.measureLine=pv.prototype.Ia.prototype.KE;pv.prototype.Ia.prototype.LE=function(a){C.log("nsVmap.nsToolsManager.Measure.prototype.measureController.measurePolygon");this.dh();a||(C.g().sa.za("Cliquer pour commencer \u00e0 mesurer"),this.Ub("Polygon"))};pv.prototype.Ia.prototype.measurePolygon=pv.prototype.Ia.prototype.LE;
pv.prototype.Ia.prototype.IE=function(a){C.log("nsVmap.nsToolsManager.Measure.prototype.measureController.measureCircle");this.dh();a||(C.g().sa.za("Cliquer pour commencer \u00e0 mesurer"),this.Ub("Circle"))};pv.prototype.Ia.prototype.measureCircle=pv.prototype.Ia.prototype.IE;pv.prototype.Ia.prototype.Or=function(a){C.log("nsVmap.nsToolsManager.Measure.prototype.measureController.modifyFeature");this.dh();a||(C.g().sa.za("Cliquer sur une mesure pour la modifier"),Qo(C.g(),this.Vg,"basicTools-modifyMeasure"))};
pv.prototype.Ia.prototype.modifyFeature=pv.prototype.Ia.prototype.Or;pv.prototype.Ia.prototype.Bq=function(a){C.log("nsVmap.nsToolsManager.Measure.prototype.measureController.deleteFeature");this.dh();a||(Qo(C.g(),this.rc,"basicTools-deleteMeasure"),C.g().sa.za("Cliquer sur une mesure pour la supprimer"))};pv.prototype.Ia.prototype.deleteFeature=pv.prototype.Ia.prototype.Bq;
pv.prototype.Ia.prototype.Aq=function(){C.log("nsVmap.nsToolsManager.Measure.prototype.measureController.deleteAllFeatures");this.dh();this.Qj.clear();for(var a=C.g().F.Pc.L(),b=[],c=a.length-1;0<=c;c--)"measure"===a[c].get("type")&&b.push(a[c]);for(c=b.length-1;0<=c;c--)C.g().F.Pc.remove(b[c])};pv.prototype.Ia.prototype.deleteAllFeatures=pv.prototype.Ia.prototype.Aq;
pv.prototype.Ia.prototype.dh=function(){C.log("nsVmap.nsToolsManager.Measure.prototype.measureController.removeMeasuresInteractions");this.Xc&&(this.Xc.className="measure-tooltip measure-tooltip-static",this.Xc.remove(),Xo(this.yi,[0,-7]),this.Xc=this.ip=null);C.g().sa.hide();C.g().re()};pv.prototype.Ia.prototype.removeMeasuresInteractions=pv.prototype.Ia.prototype.dh;
pv.prototype.Ia.prototype.nB=function(){C.log("nsVmap.nsToolsManager.Measure.prototype.measureController.displayFeatures");this.sketches=this.Qj.L();for(var a="",b,c=0;c<this.sketches.length;c++){b=this.sketches[c];var d=this.sketches[c],e=[];if("Ligne"===d.get("Type")||"Polygone"===d.get("Type")){e=[];e.keys="Points Coordonn\u00e9es Longueur-segment Longueur-totale Delta-x Delta-y Angle/Nord".split(" ");for(var f="Polygone"===d.get("Type")?d.l().da()[0]:d.l().da(),g=0,h=0,l=0,n=0,r=0,t=[],v=0;v<
f.length;v++)e[v]={},e[v].Points=v+1,e[v]["Coordonn\u00e9es"]=f[v],t.push(f[v]),0!==v&&(n=new tp([f[v-1],f[v]],d.l().Ha),g=this.bf(n),n=new tp(t,d.l().Ha),h=this.bf(n),n=new tp([[f[v-1][0],0],[f[v][0],0]],d.l().Ha),l=this.bf(n),f[v][0]<f[v-1][0]&&(l="-"+l),n=new tp([[0,f[v-1][1]],[0,f[v][1]]],d.l().Ha),n=this.bf(n),f[v][1]<f[v-1][1]&&(n="-"+n),r=180/Math.PI*Math.atan2(f[v][1]-f[v-1][1],f[v][0]-f[v-1][0]),r=90-r,0>r&&(r=360- -1*r),r=r.toFixed(2)+"\u00b0"),e[v]["Longueur-segment"]=g,e[v]["Longueur-totale"]=
h,e[v]["Delta-x"]=l,e[v]["Delta-y"]=n,e[v]["Angle/Nord"]=r}b.Points=e;b=this.sketches[c].Ld();d={};for(e=0;e<b.length;e++)"geometry"!==b[e]&&"Keys"!==b[e]&&(d[b[e]]=this.sketches[c].get(b[e]));d=[d];b=JSON.stringify(d);b=C.yt(b);a+=b+"\n";b=JSON.stringify(this.sketches[c].Points);b=C.yt(b);a+=b+"\n\n"}a="data:text/csv;charset=utf-8,"+encodeURIComponent(a);$("#export-csv-button").attr("href",a)};pv.prototype.Ia.prototype.displayFeatures=pv.prototype.Ia.prototype.nB;
C.module.directive("appMeasure",pv.prototype.JE);C.module.controller("AppmeasureController",pv.prototype.Ia);function tv(){C.log("nsVmap.nsToolsManager.BasicSelect")}ta("nsVmap.nsToolsManager.BasicSelect",tv);tv.prototype.GA=function(){C.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppBasicselectController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/tools/basicselect.html"}};
tv.prototype.fb=function(a,b,c,d){function e(){f.f.$applyAsync(function(){f.oQueryableBOs=C.oa.Hg();f.aBusinessObjectsList=Object.keys(f.oQueryableBOs);if(null==f.oQueryableBOs[f.sSelectedBo]){var a=1E6,b="",c;for(c in f.oQueryableBOs)f.oQueryableBOs[c].bo_index<a&&(a=f.oQueryableBOs[c].bo_index,b=f.oQueryableBOs[c].bo_id);f.sSelectedBo=b}})}C.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController");var f=this;b.vmapScope=C.scope;this.V=a;this.f=b;this.$timeout_=c;this.ua=d;this.Fc=
d.defer();this.mc=C.B.vc.Wr;this.properties=C.properties;this.token=C.properties.token;this.Ir=C.properties.selection.limit_popup;this.limitList_=C.properties.selection.limit_list;this.allQueryables_=!1;this.aSelections=[];this.bj=[];this.tableSelection={};this.sSelectedBo="";this.oQueryableBOs={};this.aBusinessObjectsList=[];C.scope.$on("layersChanged",function(){e()});setTimeout(function(){e()});this.map.on("click",function(a){if(""===C.g().Vv()){a=new ok(a.zb);var b=C.Of(a);C.B.vc.vf();this.cg(b,
a)}},this);C.scope.$on("toggleOutTools",function(){f.Fc.resolve()});$(document).keydown(function(a){27===a.keyCode&&f.Fc.resolve()});C.scope.$on("mapChanged",function(){f.Uo()})};tv.prototype.basicSelectController=tv.prototype.fb;tv.prototype.fb.$inject=["$http","$scope","$timeout","$q"];
tv.prototype.fb.prototype.cg=function(a,b,c){C.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.queryByEWKTGeom");var d=this;this.Bf=a;this.Gx=b;$("body").css({cursor:"wait"});this.Fc.resolve();this.Fc=this.ua.defer();c=null!=c?c:this.sSelectedBo;this.mc.cg({kq:c,Bf:a,$m:this.Fc,Fm:!1,sb:function(a){$("body").css({cursor:""});d.ys(a,b)}})};
tv.prototype.fb.prototype.ze=function(a){C.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.addQueryResult");var b=this,c=m(a.sb)?a.sb:function(){return 0};this.mc.ze({data:m(a.data)?a.data:[],selection:this.aSelections,dataType:m(a.dataType)?a.dataType:null,sb:function(a){b.aSelections=a;c.call()}})};
tv.prototype.fb.prototype.ys=function(a,b){C.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.replaceSelectionPopup");for(var c=this,d=a.length-1;0<=d;d--){var e=!1;null!=a[d].bo_intersect_geom||null!=a[d].olFeature||(e=!0);null==a[d].olFeature||null==a[d].olFeature.l()&&(e=!0);e&&($.notify("L'objet s\u00e9lectionn\u00e9 ("+a[d].bo_id_field+" = "+a[d].bo_id_value+") n'a pas de g\u00e9om\u00e9trie"),a.splice(d,1))}0!==a.length&&(d=ab(this.aSelections),bb(this.bj,d),
this.Uo(),c.ze({data:a,dataType:"summary",sb:function(){Fu(c,c.bj);c.qn(c.aSelections,b)}}))};tv.prototype.fb.prototype.replaceSelectionPopup=tv.prototype.fb.prototype.ys;
tv.prototype.fb.prototype.qn=function(a,b){C.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.displaySelectionPopup");for(var c=this.f,d=0;d<a.length;d++){m(a[d].mapPopup)&&a[d].mapPopup.remove(!1);a[d].mapPopup=new $o(a[d].olFeature,b);a[d].mapPopup.Bh.selection=a[d];a[d].mapPopup.Bh.addEventListener("click",function(){this.selection.locked=!1},!0);if("true"===a[d].have_update_rights||!0===a[d].have_update_rights)a[d].mapPopup.Yi=document.createElement("a"),a[d].mapPopup.Yi.href=
"#",a[d].mapPopup.Yi.className="ol-popup-edit icon-draw",a[d].mapPopup.Ah.appendChild(a[d].mapPopup.Yi),a[d].mapPopup.Yi.scope=this.f,a[d].mapPopup.Yi.selection=a[d],a[d].mapPopup.Yi.addEventListener("click",function(){var a=this.selection;c.$apply(function(){c.ctrl.cd(a)})},!0);if("true"===a[d].have_card_rights||!0===a[d].have_card_rights)a[d].mapPopup.Xi=document.createElement("a"),a[d].mapPopup.Xi.href="#",a[d].mapPopup.Xi.className="ol-popup-card glyphicon glyphicon-file",a[d].mapPopup.Ah.appendChild(a[d].mapPopup.Xi),
a[d].mapPopup.Xi.scope=this.f,a[d].mapPopup.Xi.selection=a[d],a[d].mapPopup.Xi.addEventListener("click",function(){var a=this.selection;c.$apply(function(){c.ctrl.ee(a)})},!0);a[d].mapPopup.za("<b>"+a[d].bo_title+":</b>");bp(a[d].mapPopup,a[d].bo_summary);m(a[d].bo_image_path)&&a[d].mapPopup.Nt(a[d].bo_image_path);"true"!==a[d].have_update_rights&&!0!==a[d].have_update_rights||a[d].mapPopup.zk({content:'<span class="icon-polygon"></span> Modifier la g\u00e9om\u00e9trie',event:function(){c.$apply(function(){c.ctrl.Nf(c.ctrl.aSelections[0])})}});
"true"!==a[d].have_delete_rights&&!0!==a[d].have_delete_rights||a[d].mapPopup.zk({content:'<span class="icon-trash"></span> Supprimer l\'objet',event:function(){c.$apply(function(){c.ctrl.de(c.ctrl.aSelections[0])})}});a[d].mapPopup.zk({content:'<span class="icon-shopping_basket"></span> Ajouter au panier',event:function(){c.$apply(function(){c.ctrl.ae(c.ctrl.aSelections[0])})}});if(!1!==C.properties.selection.street_view){var e=ak(a[d].olFeature.l()),f=H(this.map).D().M,e=Kf(e,f,"EPSG:4326"),g="http://maps.google.com/maps?q=&layer=c&cbll="+
e[1]+","+e[0]+"";a[d].mapPopup.zk({content:'<span class="icon-street-view"></span> Google Street View',event:function(){window.open(g,"_blank").focus()}})}}Wa(this.aSelections,a);this.aSelections=this.mc.bm(this.aSelections)};tv.prototype.fb.prototype.ee=function(a){C.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.displayObjectCard");this.mc.ee(a)};tv.prototype.fb.prototype.displayObjectCard=tv.prototype.fb.prototype.ee;
tv.prototype.fb.prototype.cd=function(a){C.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.displayEditFrom");var b=this,c=angular.copy(a.bo_type);this.mc.cd(a,function(){b.cg(b.Bf,b.Gx,c)})};tv.prototype.fb.prototype.displayEditFrom=tv.prototype.fb.prototype.cd;tv.prototype.fb.prototype.Nf=function(a){C.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.editFeature");Fu(this);this.mc.Nf(a)};tv.prototype.fb.prototype.editFeature=tv.prototype.fb.prototype.Nf;
tv.prototype.fb.prototype.de=function(a){C.log("nsVmap.nsToolsManager.BasicSelect.basicSelectController.deleteObject");var b=this;this.mc.de(a,function(){Fu(b);b.qs(a)})};tv.prototype.fb.prototype.deleteObject=tv.prototype.fb.prototype.de;tv.prototype.fb.prototype.Uo=function(){C.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.removePopups");Fu(this);this.bk()};tv.prototype.fb.prototype.removePopups=tv.prototype.fb.prototype.Uo;
tv.prototype.fb.prototype.bk=function(a){C.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.removeSelections");for(var b=this.aSelections.length-1;0<=b;b--)null!=a?this.aSelections[b].bo_type===a&&Za(this.aSelections,b):Za(this.aSelections,b)};tv.prototype.fb.prototype.qs=function(a){for(var b=this.aSelections.length-1;0<=b;b--)angular.equals(this.aSelections[b],a)&&this.aSelections.splice(b,1)};
function Fu(a,b){C.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.closeSelectionPopup");b=null!=b?b:a.aSelections;for(a=0;a<b.length;a++)m(b[a].mapPopup)&&b[a].mapPopup.remove()}tv.prototype.fb.prototype.ae=function(a){C.log("nsVmap.nsToolsManager.BasicSelect.prototype.basicSelectController.prototype.tableAddToCard");this.mc.ae([a])};tv.prototype.fb.prototype.addToCard=tv.prototype.fb.prototype.ae;C.module.directive("appBasicselect",tv.prototype.GA);
C.module.controller("AppBasicselectController",tv.prototype.fb);function $d(a){a=a?a:{};this.vb=null;this.qH=void 0!==a.pH?a.pH:!1}u($d,cs);function uv(a){a=a.da();return 0===a.length?"":a[0]+" "+a[1]}function vv(a){a=a.da();for(var b=[],c=0,d=a.length;c<d;++c)b.push(a[c][0]+" "+a[c][1]);return b.join(",")}function wv(a){var b=[];a=Bk(a);for(var c=0,d=a.length;c<d;++c)b.push("("+vv(a[c])+")");return b.join(",")}function gs(a){var b=a.T();a=(0,xv[b])(a);b=b.toUpperCase();return 0===a.length?b+" EMPTY":b+"("+a+")"}
var xv={Point:uv,LineString:vv,Polygon:wv,MultiPoint:function(a){var b=[];a=Bp(a);for(var c=0,d=a.length;c<d;++c)b.push("("+uv(a[c])+")");return b.join(",")},MultiLineString:function(a){var b=[];a=wp(a);for(var c=0,d=a.length;c<d;++c)b.push("("+vv(a[c])+")");return b.join(",")},MultiPolygon:function(a){var b=[];a=cp(a);for(var c=0,d=a.length;c<d;++c)b.push("("+wv(a[c])+")");return b.join(",")},GeometryCollection:function(a){var b=[];a=qp(a.Pb);for(var c=0,d=a.length;c<d;++c)b.push(gs(a[c]));return b.join(",")}};
$d.prototype.Tx=function(a,b){return(a=es(a,b))?(b=new Eg,b.Rc(a),b):null};$d.prototype.Vx=function(a,b){a=es(a,b);a=this.qH&&"GeometryCollection"==a.T()?a.Pb:[a];for(var c=[],d=0,e=a.length;d<e;++d)b=new Eg,b.Rc(a[d]),c.push(b);return c};function es(a,b){return(a=(new yv(new zv(a))).parse())?gp(a,!1,b):null}function fs(a,b){return(a=a.l())?gs(gp(a,!0,b)):""}function zv(a){this.tk=a;this.Mg=-1}
function Av(a){var b=a.tk.charAt(++a.Mg),c={position:a.Mg,value:b};if("("==b)c.type=2;else if(","==b)c.type=5;else if(")"==b)c.type=3;else if("0"<=b&&"9">=b||"."==b||"-"==b){c.type=4;var d,b=a.Mg,e=!1,f=!1;do{if("."==d)e=!0;else if("e"==d||"E"==d)f=!0;d=a.tk.charAt(++a.Mg)}while("0"<=d&&"9">=d||"."==d&&(void 0===e||!e)||!f&&("e"==d||"E"==d)||f&&("-"==d||"+"==d));a=parseFloat(a.tk.substring(b,a.Mg--));c.value=a}else if("a"<=b&&"z">=b||"A"<=b&&"Z">=b){c.type=1;b=a.Mg;do d=a.tk.charAt(++a.Mg);while("a"<=
d&&"z">=d||"A"<=d&&"Z">=d);a=a.tk.substring(b,a.Mg--).toUpperCase();c.value=a}else{if(" "==b||"\t"==b||"\r"==b||"\n"==b)return Av(a);if(""===b)c.type=6;else throw Error("Unexpected character: "+b);}return c}function yv(a){this.qo=a;this.gv=2}k=yv.prototype;k.match=function(a){if(a=this.wf.type==a)this.wf=Av(this.qo);return a};k.parse=function(){this.wf=Av(this.qo);return Bv(this)};
function Bv(a){var b=a.wf;if(a.match(1)){var c=b.value;if("GEOMETRYCOLLECTION"==c){a:{if(a.match(2)){b=[];do b.push(Bv(a));while(a.match(5));if(a.match(3)){a=b;break a}}else if(Cv(a)){a=[];break a}throw Error(Dv(a));}return new op(a)}var d=Ev[c],b=Fv[c];if(!d||!b)throw Error("Invalid geometry type: "+c);a=d.call(a);return new b(a)}throw Error(Dv(a));}k.ds=function(){if(this.match(2)){var a=Gv(this);if(this.match(3))return a}else if(Cv(this))return null;throw Error(Dv(this));};
k.cs=function(){if(this.match(2)){var a=Hv(this);if(this.match(3))return a}else if(Cv(this))return[];throw Error(Dv(this));};k.es=function(){if(this.match(2)){var a=Iv(this);if(this.match(3))return a}else if(Cv(this))return[];throw Error(Dv(this));};k.yF=function(){if(this.match(2)){var a;if(2==this.wf.type)for(a=[this.ds()];this.match(5);)a.push(this.ds());else a=Hv(this);if(this.match(3))return a}else if(Cv(this))return[];throw Error(Dv(this));};
k.xF=function(){if(this.match(2)){var a=Iv(this);if(this.match(3))return a}else if(Cv(this))return[];throw Error(Dv(this));};k.zF=function(){if(this.match(2)){for(var a=[this.es()];this.match(5);)a.push(this.es());if(this.match(3))return a}else if(Cv(this))return[];throw Error(Dv(this));};function Gv(a){for(var b=[],c=0;c<a.gv;++c){var d=a.wf;if(a.match(4))b.push(d.value);else break}if(b.length==a.gv)return b;throw Error(Dv(a));}
function Hv(a){for(var b=[Gv(a)];a.match(5);)b.push(Gv(a));return b}function Iv(a){for(var b=[a.cs()];a.match(5);)b.push(a.cs());return b}function Cv(a){var b=1==a.wf.type&&"EMPTY"==a.wf.value;b&&(a.wf=Av(a.qo));return b}function Dv(a){return"Unexpected `"+a.wf.value+"` at position "+a.wf.position+" in `"+a.qo.tk+"`"}
var Fv={POINT:ok,LINESTRING:tp,POLYGON:wk,MULTIPOINT:yp,MULTILINESTRING:up,MULTIPOLYGON:Cp},Ev={POINT:yv.prototype.ds,LINESTRING:yv.prototype.cs,POLYGON:yv.prototype.es,MULTIPOINT:yv.prototype.yF,MULTILINESTRING:yv.prototype.xF,MULTIPOLYGON:yv.prototype.zF};function Jv(){C.log("nsVmap.nsToolsManager.AdvancedSelect")}ta("nsVmap.nsToolsManager.AdvancedSelect",Jv);Jv.prototype.Uz=function(){C.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppAdvancedselectController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/tools/advancedselect.html"}};
Jv.prototype.Ja=function(a,b,c,d){C.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController");var e=this;b.vmapScope=C.scope;this.V=a;this.f=b;this.$timeout_=c;this.ua=d;this.Fc=d.defer();this.mc=C.B.vc.Wr;this.properties=C.properties;this.token=C.properties.token;this.selectGeomType="Polygon";this.Ir=C.properties.selection.limit_popup;this.limitList_=C.properties.selection.limit_list;this.nq=C.properties.selection.buffer;this.Nl=C.properties.selection.max_buffer;this.allQueryables_=
!1;this.aSelections=[];this.bj=[];this.tableSelection={};this.oQueryableBOs=C.oa.Hg();this.aBusinessObjectsList=[];this.oBusinessObjects={};this.vp={};C.scope.$on("layersChanged",function(){e.f.$applyAsync(function(){e.oQueryableBOs=C.oa.Hg();Ua(e.aBusinessObjectsList);for(var a in e.oQueryableBOs)e.aBusinessObjectsList.push(a)})});Ua(e.aBusinessObjectsList);for(var f in e.oQueryableBOs)e.aBusinessObjectsList.push(f);$(document).keydown(function(a){27===a.keyCode&&e.Fc.resolve()});C.scope.$on("mapChanged",
function(){e.bk()})};Jv.prototype.AdvancedSelectController=Jv.prototype.Ja;Jv.prototype.Ja.$inject=["$http","$scope","$timeout","$q"];
Jv.prototype.Ja.prototype.tH=function(a,b){C.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.startSelection");C.g().re();C.g().sa.hide();if(!0===b)return 0;if("Point"===a)b="Cliquez sur un point pour effectuer la s\u00e9lection",C.g().sa.za(b),Kv(this,a);else if("LineString"===a)b="Dessinez une ligne pour effectuer la s\u00e9lection",C.g().sa.za(b),Kv(this,a);else if("Polygon"===a)b="Dessinez un polygone pour effectuer la s\u00e9lection",C.g().sa.za(b),Kv(this,
a);else if("Circle"===a)b="Dessinez un cercle pour effectuer la s\u00e9lection",C.g().sa.za(b),Kv(this,a);else return console.error("startSelection: type ("+a+") not allowed"),0};Jv.prototype.Ja.prototype.startSelection=Jv.prototype.Ja.prototype.tH;Jv.prototype.Ja.prototype.OA=function(){C.g().re();C.g().sa.hide()};Jv.prototype.Ja.prototype.cancelSelection=Jv.prototype.Ja.prototype.OA;
function Kv(a,b){C.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.queryByDrawing");a.Cs=H(a.map).D().M;new Ep({vb:a.Cs});a.ic=C.g().gg({type:b},"basicTools-selectBy"+b);a.ic.on("drawend",function(a){a=a.wa;"Circle"===b&&(a=a.l(),a=new Dk(a),a=new Eg({geometry:a}));a=C.Of(a.l());this.cg(a,!0,!0)},a)}
Jv.prototype.Ja.prototype.cg=function(a){C.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.queryByEWKTGeom");var b=this;this.Bf=a;var c=C.oa.Hg();this.Qc=Object.keys(c).length;0<this.Qc&&$("body").css({cursor:"wait"});var d=ab(this.aSelections);bb(this.bj,d);this.bk();this.Fc.resolve();this.Fc=this.ua.defer();for(var e in c)this.mc.cg({kq:e,Bf:a,$m:this.Fc,Fm:!0,sb:function(a){b.Qc--;0===b.Qc&&$("body").css({cursor:""});b.vp={};b.ze({data:a,dataType:"list",sb:function(){0===
b.Qc&&b.rn(b.aSelections)}},function(a){console.error(a);$("body").css({cursor:""});b.Qc--;b.ze({data:[],dataType:"list",sb:function(){0===b.Qc&&b.rn(b.aSelections)}})})}})};
Jv.prototype.Ja.prototype.ze=function(a){C.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.addQueryResult");var b=m(a.data)?a.data:[];a=m(a.sb)?a.sb:function(){return 0};for(var c=[],d=0;d<b.length;d++)c.push(b[d]),m(b[d].bo_intersect_geom)&&(c[d].olFeature=this.mc.An(b[d]));Wa(this.aSelections,c);this.aSelections=this.mc.bm(this.aSelections);a.call()};
Jv.prototype.Ja.prototype.qn=function(a){C.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.displaySelectionPopup");a=[a];var b=angular.element($("#vmap-basicselect-tool")).scope();this.mc.ll(a,function(a){if(null==a[0].olFeature||null==a[0].olFeature.l())return $.notify("L'objet n'a pas de g\u00e9om\u00e9trie"),0;if(null!=a[0]&&null!=a[0].olFeature){var c=a[0].olFeature.l(),e=C.Of(c);b.ctrl.Bf=e;b.ctrl.Gx=c}c=b.ctrl;e=a[0];C.log("nsVmap.nsToolsManager.BasicSelect.basicSelectController.centerMapOnPopup");
null!=e.olFeature?(e=e.olFeature.l(),null!=e?"Point"===e.T()?H(c.map).ib(e.da()):"MultiPoint"===e.T()?1===Bp(e).length?H(c.map).ib(Ap(e).da()):Lk(H(c.map),e,c.map.ja()):Lk(H(c.map),e,c.map.ja()):console.error("selection['olFeature'].getGeometry() not defined")):console.error("selection['olFeature'] undefined:",e.olFeature);b.ctrl.ys(a);$("#select-list-modal").modal("hide")})};
Jv.prototype.Ja.prototype.rn=function(a,b){C.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.displaySelectionTable");var c=this;Lv(c,this.aBusinessObjectsList,function(){C.log("nsVmap.nsToolsManager.AdvancedSelect.AdvancedSelectController.setBoInfos finished");$(".select_modal_table").bootstrapTable("destroy");setTimeout(function(){for(var a=0;a<c.aBusinessObjectsList.length;a++)Mv(c,c.aBusinessObjectsList[a]);for(a=0;a<c.aBusinessObjectsList.length;a++)$("#select_table_"+
c.aBusinessObjectsList[a]).bootstrapTable({data:[]}),$("#select_table_"+c.aBusinessObjectsList[a]).parent().height($("body").height()/2)},100);c.mc.Pn(a,function(){tb(c.tableSelection);c.tableSelection=Nv(a);C.log("tableSelection: ",c.tableSelection);setTimeout(function(){for(var a in c.tableSelection)$("#select_table_"+a).bootstrapTable("load",c.tableSelection[a])},100)});C.B.vc.gp($("#basic-tools-dropdown-select-btn"));setTimeout(function(){$("#select-list-modal").modal("show");null!=b&&$("#select_modal_tab_"+
b).tab("show")},100)})};Jv.prototype.Ja.prototype.displaySelectionTable=Jv.prototype.Ja.prototype.rn;
function Lv(a,b,c){C.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.setBoInfos");var d,e=0;b=m(b)?b:[];c=m(c)?c:angular.noop;for(d in a.oBusinessObjects)-1===b.indexOf(d)&&delete a.oBusinessObjects[d];for(var f=0;f<b.length;f++)d=b[f],null!=a.oBusinessObjects[d]?(e++,e===b.length&&c.call()):a.V({method:"GET",url:C.properties.api_url+"/vmap/businessobjects/"+d,params:{token:C.properties.token}}).then(function(d){e++;if(!m(d.data))return bootbox.alert("response['data'] undefined"),
0;if(m(d.data.errorMessage))return bootbox.alert(d.data.errorType+": "+d.data.errorMessage),0;if(null==d.data.data)return console.error("Aucune valeur retourn\u00e9e"),0;a.oBusinessObjects[d.data.data[0].business_object_id]=d.data.data[0];e===b.length&&c.call()},function(a){e++;e===b.length&&c.call();console.error(a)})}
function Nv(a){C.log("nsVmap.nsToolsManager.AdvancedSelect.AdvancedSelectController.formatTableSelection");if(null==a)return{};for(var b={},c={},d=0;d<a.length;d++)null!==b&&a[d].bo_type in b||(b[a[d].bo_type]=[]),null!=a[d].bo_list&&(c=vb(a[d].bo_list)),c.selection=a[d],null!=c&&b[a[d].bo_type].push(c);for(var e in b)for(d=0;d<b[e].length;d++)for(var f in b[e][d])p(b[e][d][f])&&(b[e][d][f]=b[e][d][f].replace(/</g,"&lt;").replace(/>/g,"&gt;"));return b}
function Mv(a,b){C.log("nsVmap.nsToolsManager.AdvancedSelect.AdvancedSelectController.setSearchForm");null!=a.oBusinessObjects[b].json_form||(a.oBusinessObjects[b].json_form={});null!=a.oBusinessObjects[b].json_form[0]||(a.oBusinessObjects[b].json_form[0]={});null!=a.oBusinessObjects[b].json_form[0].search||(a.oBusinessObjects[b].json_form[0].search={name:"search-form",title:b,input_size:"xxs",nb_cols:12,javascript:!1,rows:[]});null!=a.oBusinessObjects[b].json_form[0].search.name||(a.oBusinessObjects[b].json_form[0].search.name=
"search-form");null!=a.oBusinessObjects[b].json_form[0].search.title||(a.oBusinessObjects[b].json_form[0].search.title=b);null!=a.oBusinessObjects[b].json_form[0].search.input_size||(a.oBusinessObjects[b].json_form[0].search.title="xxs");null!=a.oBusinessObjects[b].json_form[0].search.nb_cols||(a.oBusinessObjects[b].json_form[0].search.title=12);null!=a.oBusinessObjects[b].json_form[0].search.javascript||(a.oBusinessObjects[b].json_form[0].search.javascript=!1);null!=a.oBusinessObjects[b].json_form[0].search.rows||
(a.oBusinessObjects[b].json_form[0].search.rows=[]);var c=a.oBusinessObjects[b].json_form[0],d={search:{}},e=a.oBusinessObjects[b].geom_column,e=null!=e?e:"geom";null!=a.vp[b]?d.search=a.vp[b]:d.search[e]=a.Bf;var f={fields:[{type:"button","class":"btn-ungroup btn-group-xs",nb_cols:12,buttons:[{visibleAllTabs:!0,id:"select_search_form_reader_"+b+"_submit_buton",type:"submit",label:"Rechercher",name:"form_submit","class":"btn-primary right"}]}]};angular.equals(c.search.rows[c.search.rows.length-1],
f)||c.search.rows.push(f);f={fields:[{visibleAllTabs:!0,type:"text",name:e,label:"G\u00e9om\u00e9trie",disabled:!1,required:!1,nb_cols:12}]};angular.equals(c.search.rows[0],f)||c.search.rows.unshift(f);c.search.event=function(d){d=a.mc.In(d,c,"search");a.rz(angular.copy(b),d,angular.copy(e))};setTimeout(function(){var a=angular.element($("#select_search_form_reader_"+b).children()).scope();null!=a&&a.$apply(function(){a.ctrl.setDefinitionName("search");a.ctrl.setFormValues(angular.copy(d));a.ctrl.setFormDefinition(angular.copy(c));
a.ctrl.loadForm()})},500)}
Jv.prototype.Ja.prototype.rz=function(a,b,c){function d(){setTimeout(function(){!1===v&&bootbox.confirm("Annuler la requ\u00eate ?",function(a){!0===a?(x.resolve(),Wd(),f.selectedLayerId=""):d()})},5E3)}C.log("nsVmap.nsToolsManager.AdvancedSelect.AdvancedSelectController.updateSelectionTable");if(null==a)return console.error("bo_id not defined or null"),0;var e=this,f=this.f,g=this.V,h=this.ua;b=null!=b?b:{};var l="",n=0,r;for(r in b)r!==c&&""!==b[r]&&(l=0===n?"":l+" AND ",l+=r+"='"+b[r]+"'",n++);
this.vp[a]=b;r=.01;n=C.g().gb();r=this.nq*n/1E3;r>this.Nl&&(r=this.Nl);var n=C.properties.api_url+"/vmap/querys/"+a+"/list",t=H(this.map).D().M.substring(5);b={token:C.properties.token,filter:l,intersect_geom:b[c],result_srid:t,get_geom:!1,get_image:!1,intersect_buffer:r,limit:this.limitList_};Vd();var v=!1,x=h.defer();g({method:"GET",url:n,params:b,timeout:x.promise}).then(function(b){v=!0;Wd();if(!m(b.data))return bootbox.alert("response['data'] undefined"),f.selectedLayerId="",0;if(m(b.data.errorMessage))return bootbox.alert(b.data.errorType+
": "+b.data.errorMessage),f.selectedLayerId="",0;null==b.data.data&&($.notify("Aucune valeur retourn\u00e9e","warn"),b.data.data=[]);e.tableSelection[a]=Nv(b.data.data)[a];null!=e.tableSelection[a]||(e.tableSelection[a]=[]);for(var c in e.tableSelection)$("#select_table_"+c).bootstrapTable("load",e.tableSelection[c]);e.bk(a);e.ze({data:b.data.data,dataType:"list"});b.data.data.length===e.limitList_&&$.notify("Limite d'objets \u00e0 afficher atteinte","warn")},function(a){Wd();console.error(a)});d()};
Jv.prototype.Ja.prototype.updateSelectionTable=Jv.prototype.Ja.prototype.rz;Jv.prototype.Ja.prototype.BH=function(a,b){C.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.tableAddToCard");a=$(a).bootstrapTable("getSelections");for(var c=[],d=0;d<a.length;d++)c.push(a[d].selection);this.mc.ae(c,b)};Jv.prototype.Ja.prototype.tableAddToCard=Jv.prototype.Ja.prototype.BH;
Jv.prototype.Ja.prototype.DH=function(a){C.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.tableRemoveSelection");for(var b=$(a).bootstrapTable("getSelections"),c=[],d=0;d<b.length;d++)c.push(b[d].selection);this.QJ(c);c=$(a).bootstrapTable("getData");for(d=0;d<b.length;d++)Ya(c,b[d]);$(a).bootstrapTable("load",c)};Jv.prototype.Ja.prototype.tableRemoveSelection=Jv.prototype.Ja.prototype.DH;
Jv.selectTableFormatter=function(a,b){a=b.selection.have_card_rights;var c=b.selection.have_update_rights;b=b.selection.have_delete_rights;var d=20;"true"===a&&(d+=20);"true"===c&&(d+=20);"true"===b&&(d+=20);d=['<div style="width: '+d+'px">','<a class="selection-table-popup" href="javascript:void(0)" title="Popup">','<i class="icon-comment padding-sides-5"></i>',"</a>"];"true"===a&&(d.push('<a class="selection-table-card" href="javascript:void(0)" title="Fiche descriptive">'),d.push('<i class="glyphicon glyphicon-file padding-sides-5"></i>'),
d.push("</a>"));"true"===c&&(d.push('<a class="selection-table-edit" href="javascript:void(0)" title="Editer">'),d.push('<i class="icon-draw padding-sides-5"></i>'),d.push("</a>"));"true"===b&&(d.push('<a class="selection-table-delete" href="javascript:void(0)" title="Supprimer">'),d.push('<i class="icon-trash padding-sides-5"></i>'),d.push("</a>"));d.push("</div>");return d.join("")};
window.selectTableEvents={"click .selection-table-popup":function(a,b,c){var d=angular.element($("#select-list-modal")).scope();d.$evalAsync(function(){d.ctrl.qn(c.selection)})},"click .selection-table-card":function(a,b,c){var d=angular.element($("#select-list-modal")).scope();d.$evalAsync(function(){d.ctrl.ee(c.selection)})},"click .selection-table-edit":function(a,b,c){var d=angular.element($("#select-list-modal")).scope();d.$evalAsync(function(){d.ctrl.cd(c.selection)})},"click .selection-table-delete":function(a,
b,c){var d=angular.element($("#select-list-modal")).scope();d.$evalAsync(function(){d.ctrl.de(c.selection)})}};Jv.prototype.Ja.prototype.ee=function(a){C.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.displayObjectCard");this.mc.ee(a)};Jv.prototype.Ja.prototype.displayObjectCard=Jv.prototype.Ja.prototype.ee;
Jv.prototype.Ja.prototype.cd=function(a){C.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.displayEditFrom");this.mc.cd(a,function(){setTimeout(function(){$("#select-list-modal").modal("show");var b=a.bo_type;C.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.updateSelectionTable");C.ph("select_search_form_reader_"+b+"_submit_buton")})})};Jv.prototype.Ja.prototype.displayEditFrom=Jv.prototype.Ja.prototype.cd;
Jv.prototype.Ja.prototype.de=function(a){C.log("nsVmap.nsToolsManager.AdvancedSelect.AdvancedSelectController.deleteObject");var b=this;this.mc.de(a,function(){b.qs(a);$("#select-list-modal").hasClass("in")&&b.rn(b.aSelections)})};Jv.prototype.Ja.prototype.deleteObject=Jv.prototype.Ja.prototype.de;
Jv.prototype.Ja.prototype.bk=function(a){C.log("nsVmap.nsToolsManager.AdvancedSelect.prototype.AdvancedSelectController.prototype.removeSelections");for(var b=this.aSelections.length-1;0<=b;b--)null!=a?this.aSelections[b].bo_type===a&&Za(this.aSelections,b):Za(this.aSelections,b)};Jv.prototype.Ja.prototype.qs=function(a){for(var b=this.aSelections.length-1;0<=b;b--)angular.equals(this.aSelections[b],a)&&this.aSelections.splice(b,1)};C.module.directive("appAdvancedselect",Jv.prototype.Uz);
C.module.controller("AppAdvancedselectController",Jv.prototype.Ja);function T(){new Jv;new tv}ta("nsVmap.nsToolsManager.Select",T);T.prototype.cg=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.cg(a)};T.prototype.An=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.An(a)};T.prototype.ee=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.ee(a)};T.prototype.displayObjectCard=T.prototype.ee;T.prototype.cd=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.cd(a,b)};
T.prototype.displayEditFrom=T.prototype.cd;k=T.prototype;k.bm=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.bm(a)};k.ze=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.ze(a)};k.ll=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.ll(a,b)};k.Pn=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.Pn(a,b)};k.Jn=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.Jn(a,b)};
k.zp=function(a,b,c,d){return angular.element($("#vmap-select-tool")).scope().ctrl.zp(a,b,c,d)};k.In=function(a,b,c,d){return angular.element($("#vmap-select-tool")).scope().ctrl.In(a,b,c,d)};k.de=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.de(a,b)};T.prototype.deleteObject=T.prototype.de;T.prototype.ae=function(a,b){return angular.element($("#vmap-select-tool")).scope().ctrl.ae(a,b)};T.prototype.addToCard=T.prototype.ae;T.prototype.Nf=function(a){return angular.element($("#vmap-select-tool")).scope().ctrl.Nf(a)};
T.prototype.editFeature=T.prototype.Nf;T.prototype.IG=function(){C.log("nsVmap.nsToolsManager.Select.prototype.selectDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppSelectController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/tools/select.html"}};
T.prototype.ra=function(a,b,c,d){C.log("nsVmap.nsToolsManager.Select.prototype.selectController");var e=this;this.V=a;this.f=b;this.$timeout_=c;this.ua=d;this.Fc=d.defer();this.properties=C.properties;this.token=C.properties.token;this.addPartGeomType="";this.Ir=C.properties.selection.limit_popup;this.Jw=C.properties.selection.limit_list;this.nq=C.properties.selection.buffer;this.Nl=C.properties.selection.max_buffer;this.ec=So(C.g(),{style:new yg({fill:new ug({color:"rgba(255, 255, 255, 0.6)"}),stroke:new wg({color:"#319FD3",
width:2}),Gb:new xg({xc:7,fill:new ug({color:"#319FD3"})})})});this.Bb=this.ec.v().ob;this.oe=So(C.g(),{style:new yg({fill:new ug({color:"rgba(0, 0, 0, 0.2)"})})});this.Vg=new $u({features:this.Bb});this.Vg.on("modifyend",function(){setTimeout(function(){Ov(e,e.Bb.L())})});this.rc=new mv({$a:[this.ec]});this.rc.on("select",function(){for(var a=this.rc.Ka().L(),b=0;b<a.length;b++)zh(this.ec.v(),a[b]);this.rc.Ka().clear();setTimeout(function(){Ov(e,e.Bb.L())})},this);this.Lf=new mv({$a:[this.oe]});
this.Lf.on("select",this.Cq,this);C.scope.$on("toggleOutTools",function(){e.ij();e.Fc.resolve()});p(oUrlParams.bo_id)&&p(oUrlParams.ids)&&0<oUrlParams.bo_id.length&&0<oUrlParams.ids.length&&setTimeout(function(){var a=C.oa.Hg();if(null!=a[oUrlParams.bo_id]){for(var b=[],c=oUrlParams.ids.split("|"),d=0;d<c.length;d++)b.push({bo_type:oUrlParams.bo_id,bo_id_value:c[d],bo_id_field:a[oUrlParams.bo_id].bo_id_field,bo_title:a[oUrlParams.bo_id].bo_title});0<b.length&&e.ae(b,!0)}})};
T.prototype.selectController=T.prototype.ra;T.prototype.ra.$inject=["$http","$scope","$timeout","$q"];
T.prototype.ra.prototype.cg=function(a){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.queryByEWKTGeom");var b=this;if(null!=a)if(null!=a.Fm)if(null!=a.Bf)if(null!=a.kq)if(null!=a.$m)if(null!=a.sb){var c=!a.Fm,d=!0===a.Fm?"list":"summary",e=H(this.map).D().M.substring(5),f=C.vj(a.Bf).T(),g=.01;if("Point"===f||"LineString"===f)f=C.g().gb(),g=this.nq*f/1E3,g>this.Nl&&(g=this.Nl);this.V({method:"GET",url:C.properties.api_url+"/vmap/querys/"+a.kq+"/"+d,params:{token:C.properties.token,
intersect_geom:a.Bf,intersect_buffer:g,get_geom:c,get_image:c,result_srid:e,limit:!0===a.Fm?this.Jw:this.Ir,d:Date.now()},timeout:a.$m.promise}).then(function(c){if(1===a.$m.promise.$$state.status)return 0;var d=[];null!=c.data.error&&null!=c.data.error.errorMessage&&bootbox.alert(c.data.error.errorMessage);null!=c.data?null!=c.data.data?d=c.data.data:C.log("Pas de donn\u00e9es \u00e0 afficher"):C.log("Pas de donn\u00e9es \u00e0 afficher");d.length===b.Jw&&$.notify("Limite d'objets \u00e0 afficher atteinte",
"warn");a.sb.call(this,d)})}else console.error("opt_options.callback not defined");else console.error("opt_options.canceler not defined");else console.error("opt_options.bo_id not defined");else console.error("opt_options.EWKTGeometry not defined");else console.error("opt_options.useTableFormat not defined")};T.prototype.ra.prototype.An=function(a){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.extractFeatureFromData");a=C.vj(a.bo_intersect_geom);return new Eg({geometry:a})};
T.prototype.ra.prototype.dl=function(){return angular.element($("#select_edit_form_reader").children()).scope()};
T.prototype.ra.prototype.ee=function(a){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.displayObjectCard");if(0===a.bo_title.length)return 0;this.editSelection={bo_title:a.bo_title,display_form_size:a.display_form_size};this.Jn([a],function(b){a=b[0];var c=a.bo_json_form,d={update:vb(a.bo_form),display:vb(a.bo_form)};C.log("oFormValues: ",d);C.log("oFormDefinition: ",c);var e=angular.element($("#select_display_form_reader").children()).scope();e.$evalAsync(function(){e.ctrl.setDefinitionName("display");
e.ctrl.setFormValues(d);e.ctrl.setFormDefinition(c);e.ctrl.loadForm();$("#select-card-modal").modal("show")})})};T.prototype.ra.prototype.displayObjectCard=T.prototype.ra.prototype.ee;
T.prototype.ra.prototype.cd=function(a,b){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.displayEditFrom");var c=this;if(0===a.bo_title.length)return 0;this.editSelection=a;c.ll([a],function(d){c.Jn(d,function(d){a=d[0];var e=a.bo_json_form,g={update:vb(a.bo_form),display:vb(a.bo_form)};d={fields:[{type:"button","class":"btn-ungroup btn-group-sm",nb_cols:12,buttons:[{visibleAllTabs:!0,type:"submit",label:"FORM_UPDATE",name:"form_submit","class":"btn-primary hidden",id:"basictools-select-form-reader-submit-btn"}]}]};
angular.equals(e.update.rows[e.update.rows.length-1],d)||e.update.rows.push(d);e.update.event=function(d){$("#select_edit_form_reader").find("button").attr("disabled",!0);Vd();var f=[a.bo_id_field];null!=c.editableSelection&&null!=c.editableSelection.geom_column&&f.push(c.editableSelection.geom_column);var g=c.In(d,e,"update",f);a.bo_form=g;c.zp(a.bo_type,g,function(){$("#select-edit-modal").modal("hide");$("#select_edit_form_reader").find("button").attr("disabled",!1);c.ij();null!=b&&b.call(this,
g)},function(){$("#select-edit-modal").modal("hide");$("#select_edit_form_reader").find("button").attr("disabled",!1);c.ij();null!=b&&b.call(this,g)})};var h=c.dl();h.$evalAsync(function(){function b(){h.ctrl.setDefinitionName("update");h.ctrl.setFormValues(g);h.ctrl.setFormDefinition(e);h.$applyAsync(function(){h.ctrl.loadForm();$("#select-edit-modal").modal("show")})}try{m(destructor_form)&&destructor_form()}catch(r){C.log("destructor_form does not exist")}if(null!=a.bo_json_form_js){var c=a.bo_json_form_js;
C.log("initHtmlForm : javascript assoc. to : "+c);Td([c],{callback:function(){b();try{m(constructor_form)&&constructor_form(h,c)}catch(r){C.log("constructor_form does not exist")}},async:!0,scriptInBody:!0})}else b()})})})};T.prototype.ra.prototype.displayEditFrom=T.prototype.ra.prototype.cd;k=T.prototype.ra.prototype;k.ll=function(a,b){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.getSummaryInfos");Pv(this,{Gh:a,dataType:"summary",sb:b})};
k.Pn=function(a,b){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.getListInfos");Pv(this,{Gh:a,dataType:"list",sb:b})};k.Jn=function(a,b){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.getFormInfos");Pv(this,{Gh:a,dataType:"form",sb:b})};
function Pv(a,b){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.complementDataOnSelection");var c=m(b.Gh)?b.Gh:[],d=m(b.dataType)?b.dataType:null,e=m(b.gn)?b.gn:{};b=m(b.sb)?b.sb:function(){return 0};for(var f=[],g=0;g<c.length;g++)hb(f,c[g].bo_type);a.Qc=ha(a.Qc)?a.Qc:0;a.Qc+=f.length;0<f.length&&Vd();for(var h=[],g=0;g<f.length;g++){Ua(h);for(var l=0;l<c.length;l++)c[l].bo_type===f[g]&&h.push(c[l]);Qv(a,{Gh:ab(h),Ku:f[g],dataType:d,gn:e,sb:b})}}
function Qv(a,b){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.complementDataOnSelection2_");for(var c=m(b.Gh)?b.Gh:[],d=m(b.dataType)?b.dataType:null,e=m(b.gn)?b.gn:{},f=m(b.sb)?b.sb:function(){return 0},g="",h=0;h<c.length;h++)m(c[h]["bo_"+d])||(0<g.length&&(g+=" OR "),g+='("'+c[h].bo_id_field.replace(/\./g,'"."')+"\"='"+c[h].bo_id_value+"')");h=H(a.map).D().M.substring(5);m(b.Ku)?(b=C.properties.api_url+"/vmap/querys/"+b.Ku+"/"+d,h={token:C.properties.token,filter:g,
result_srid:h,limit:200},"summary"===d&&(h.get_geom=!0,h.get_image=!0),xb(h,e),0<g.length?a.V({method:"GET",url:b,params:h}).then(function(b){var e=[];a.Qc--;0===a.Qc&&($("body").css({cursor:""}),Wd());m(b.data)&&m(b.data.errorMessage)&&bootbox.alert(b.data.errorMessage);m(b.data.data)?e=b.data.data:C.log("Pas de donn\u00e9es \u00e0 afficher");199<e.length&&bootbox.alert("<h4>Attention, vous avez atteint la limite d'objects affichables sur la carte</h4>");a.ze({data:e,selection:c,dataType:d,sb:f})},
function(b){console.error(b);a.Qc--;0===a.Qc&&($("body").css({cursor:""}),Wd(),f.call(this,c))}):(a.Qc--,0===a.Qc&&($("body").css({cursor:""}),Wd(),f.call(a,c)))):console.error("opt_options.bo_type not defined")}
k.ze=function(a){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.addQueryResult");var b=m(a.data)?a.data:[],c=m(a.selection)?a.selection:[];a=m(a.sb)?a.sb:function(){return 0};for(var d=[],e=0;e<b.length;e++)d.push(b[e]),m(b[e].bo_intersect_geom)&&(d[e].olFeature=this.An(b[e]));Wa(c,d);c=this.bm(c);a.call(this,c)};
k.bm=function(a){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.removeDuplicateSelections");for(var b=[],c=0;c<a.length;c++){Ua(b);for(var d=c+1;d<a.length;d++)if(a[c].bo_id_field==a[d].bo_id_field&&a[c].bo_type==a[d].bo_type&&a[c].bo_id_value==a[d].bo_id_value){b.push(d);!0===a[d].locked&&(a[c].locked=!0);for(var e="olFeature mapPopup bo_image_path bo_summary bo_summary_attributs bo_list bo_list_attributs bo_form bo_form_attributs bo_json_form bo_json_form_js bo_json_form_css".split(" "),
f=0;f<e.length;f++)m(a[d][e[f]])&&!m(a[c][e[f]])&&(a[c][e[f]]=a[d][e[f]]),m(a[c][e[f]])&&!m(a[d][e[f]])&&(a[d][e[f]]=a[c][e[f]])}for(d=0;d<b.length;d++)Za(a,b[d])}return a};
k.zp=function(a,b,c,d){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.updateBOValues");if(!m(a))return 0;b=m(b)?b:{};c=m(c)?c:angular.noop;d=m(d)?d:angular.noop;b=this.Tq(b);var e=this.map.getLayers().L();this.V({method:"PUT",url:C.properties.api_url+"/vmap/querys/"+a,data:b,params:{token:C.properties.token}}).then(function(b){$("body").css({cursor:""});Wd();if(!m(b.data))return bootbox.alert("Aucune valeur retourn\u00e9e"),d.call(),0;if(m(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),
d.call(),0;for(b=0;b<e.length;b++)De(e[b]).bo_id===a&&e[b].jd();$.notify("Op\u00e9ration r\u00e9alis\u00e9e avec succ\u00e8s, les couches de la carte se mettent \u00e0 jour","info");c.call()},function(a){d.call();console.error(a);$("body").css({cursor:""});Wd()})};
k.In=function(a,b,c,d){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.getFormData");if(null==a)return console.error("oFormValues is undefined or null"),null;if(null==b)return console.error("oFormDefinition is undefined or null"),null;if(null==c)return console.error("sFormDefinitionName is undefined or null"),null;null!=d||(d=[]);var e=angular.element(z.b).injector().get(["envSrvc"]),f=angular.element(z.b).injector().get(["formSrvc"]);e.oFormValues=a;e.oFormDefinition=b;e.sFormDefinitionName=
c;b=f.getFormData(c,!0);for(e=0;e<d.length;e++)null!=a[c][d[e]]&&(b[d[e]]=a[c][d[e]]);return b};k.Tq=function(a){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.getFormDataFromValues");var b=new FormData,c;for(c in a)null!=a[c].aFiles?(b.append(c+"_attached_content",a[c].aFiles[0]),b.append(c,a[c].aFiles[0].name)):b.append(c,a[c]);return b};
k.de=function(a,b){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.deleteObject");var c=this;bootbox.confirm("<h4>Supprimer d\u00e9finitivement cet objet de la base de donn\u00e9es ?</h4>",function(d){!0===d&&Rv(c,a,b)})};T.prototype.ra.prototype.deleteObject=T.prototype.ra.prototype.de;
function Rv(a,b,c){function d(){setTimeout(function(){!1===h&&bootbox.confirm("Annuler la requ\u00eate ?",function(a){!0===a?(canceler.resolve(),Wd()):d()})},5E3)}C.log("nsVmap.nsToolsManager.Select.prototype.selectController.submitDeleteObject");var e=a.V,f=b.bo_type;b=b.bo_id_value;var g=a.map.getLayers().L(),h=!1;e({method:"DELETE",url:C.properties.api_url+"/vmap/querys/"+f,params:{token:C.properties.token,idList:b}}).then(function(a){h=!0;Wd();if(!m(a.data))return bootbox.alert("response['data'] undefined"),
0;if(m(a.data.errorMessage))return bootbox.alert(a.data.errorType+": "+a.data.errorMessage),0;for(a=0;a<g.length;a++)De(g[a]).bo_id===f&&g[a].jd();$.notify("Op\u00e9ration r\u00e9alis\u00e9e avec succ\u00e8s, les couches de la carte se mettent \u00e0 jour","info");c.call()},function(a){Wd();bootbox.alert(a)});d()}
T.prototype.ra.prototype.ae=function(a,b){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.addToCard");b&&C.B.K.removeAll();var c=this;setTimeout(function(){c.ll(a,function(a){c.Pn(a,function(a){if(!m(a)||0>=a.length)return console.error("aSelection empty or inexistent"),0;for(var b=[],c=a[0].bo_type,d=a[0].bo_title,e={Od:["selection","state"]},n=0;n<a.length;n++)null!=a[n].bo_list?null!=a[n].olFeature?(b.push(a[n].bo_list),b[n].feature=a[n].olFeature,null==b[n][a[n].bo_id_field]&&
(b[n][a[n].bo_id_field]=a[n].bo_id_value,e.Od.push(a[n].bo_id_field))):console.error("Selection[i]['olFeature'] undefined"):console.error("Selection[i]['bo_list'] undefined");void 0===C.B.K.ya(c)&&C.B.K.Ga({va:c,Va:d,ta:["zoom","delete"]});a={va:c};e.data=b;C.B.K.Xp(a,e);$("#select-list-modal").modal("hide");C.B.K.ve();C.B.K.De(c);setTimeout(function(){C.B.K.uk(c)},500)})})})};T.prototype.ra.prototype.addToCard=T.prototype.ra.prototype.ae;
T.prototype.ra.prototype.IB=function(a){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.editFormFeature");$("#select-edit-modal").modal("hide");angular.element($("#vmap-basicselect-tool")).scope().ctrl.Uo();$("#select-list-modal").modal("hide");this.Nf(a,!0)};T.prototype.ra.prototype.editFormFeature=T.prototype.ra.prototype.IB;
T.prototype.ra.prototype.Nf=function(a,b){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.editFeature");var c=this,d=C.oa.Hg();if(null==a.bo_type)return console.error("selection['bo_type'] not defined"),0;if(null==d[a.bo_type])return console.error("oBusinessObjects[selection['bo_type']] not defined"),0;if(null==d[a.bo_type].bo_geom_type)return console.error("oBusinessObjects[selection['bo_type']]['bo_geom_type'] not defined"),0;this.editableSelection=a;this.editableFeatureType=d[a.bo_type].bo_geom_type;
if("GEOMETRYCOLLECTION"===this.editableFeatureType)this.addPartGeomType="";else if("POLYGON"===this.editableFeatureType||"MULTIPOLYGON"===this.editableFeatureType)this.addPartGeomType="Polygon";else if("LINESTRING"===this.editableFeatureType||"MULTILINESTRING"===this.editableFeatureType)this.addPartGeomType="LineString";else if("POINT"===this.editableFeatureType||"MULTIPOINT"===this.editableFeatureType)this.addPartGeomType="Point";this.editGeometryFromForm=b?!0:!1;$("#basictools-select-modify-palette").show();
setTimeout(function(){null!=c.editableSelection.olFeature&&Sv(c);setTimeout(function(){0<c.ec.v().ob.Lc()&&c.Ry("editFeature","basicTools-select-editFeature"===c.xq)},100)},500)};T.prototype.ra.prototype.editFeature=T.prototype.ra.prototype.Nf;
T.prototype.ra.prototype.Ry=function(a,b){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.startEdition");var c=this;this.Pu();if(!0===b)return 0;if("insert"===a.substr(0,6))C.g().sa.za("Cliquez pour commencer \u00e0 dessiner"),this.Os(a.substr(6));else if("editFeature"===a)C.g().sa.za("Cliquez sur la g\u00e9om\u00e9trie pour la modifier"),Qo(C.g(),this.Vg,"basicTools-select-"+a);else if("deleteFeature"===a)C.g().sa.za("Cliquez sur la g\u00e9om\u00e9trie pour la supprimer"),Qo(C.g(),
this.rc,"basicTools-select-"+a);else if("addHole"===a){C.g().sa.za("Dessinez un polygone \u00e0 l'int\u00e9rieur d'un autre pour cr\u00e9er un trou");this.ic=C.g().gg({type:"Polygon"},"basicTools-select-"+a);var d=ab(this.Bb.L());this.ic.on("drawend",function(a){a=a.wa;for(var b=Ak(a.l()),e=!1,h=0;h<d.length;h++)Eo(d[h].l(),a.l())&&(xk(d[h].l(),b),e=!0);e?setTimeout(function(){Ov(c,c.Bb.L())}):bootbox.alert("<h4>Trou non valide: il doit \u00eatre contenu dans un polygone dessin\u00e9</h4>")},this)}else if("deleteHole"===
a)C.g().sa.za("Cliquez dans un trou pour le supprimer"),this.Vp(),Qo(C.g(),this.Lf,"basicTools-select-"+a);else return console.error("startEdition: type ("+a+") not allowed"),0};T.prototype.ra.prototype.startEdition=T.prototype.ra.prototype.Ry;T.prototype.ra.prototype.Pu=function(){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.cancelEdition");C.g().re();C.g().sa.hide();this.oe.v().clear()};T.prototype.ra.prototype.cancelEdition=T.prototype.ra.prototype.Pu;
T.prototype.ra.prototype.Vp=function(){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.addHolesIntoHolesLayer");var a=this.Bb.L();this.oe.v().clear();for(var b=0;b<a.length;b++){var c=Bk(a[b].l());if(1<c.length)for(var d=1;d<c.length;d++){var e=new wk;e.tb([c[d].da()]);vh(this.oe.v(),new Eg({geometry:e}))}}};
T.prototype.ra.prototype.Cq=function(){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.deleteHole");var a=this,b=this.Lf.Ka().L();if(0<b.length){for(var c=0;c<b.length;c++){for(var d=b[c].l(),e=!1,f=this.Bb.L(),g=0;g<f.length;g++){for(var h=f[g].l().da(),l=h.length-1;0<=l;l--)angular.equals(d.da()[0],h[l])&&(h.splice(l,1),e=!0);f[g].l().tb(h)}e&&zh(this.oe.v(),b[c])}this.Lf.Ka().clear();setTimeout(function(){Ov(a,a.Bb.L())})}};
T.prototype.ra.prototype.Os=function(a){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.startDrawing");var b=this;this.ic=C.g().gg({type:a,features:this.Bb},"basicTools-select-insert"+a);this.ic.on("drawend",function(c){var d=c.wa;setTimeout(function(){if("Circle"===a){var c=d.l(),c=new Dk(c);zh(b.ec.v(),d);d=new Eg({geometry:c});vh(b.ec.v(),d)}Ov(b,b.Bb.L())})},this)};
function Ov(a,b){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.putFeaturesOnTheElement");if(null==b)console.error("aFeatures undefined");else if(fa(b))if("MULTI"!==a.editableFeatureType.substr(0,5)&&"GEOMETRYCOLLECTION"!==a.editableFeatureType){a.editableSelection.olFeature=b[b.length-1];for(var c=0;c<b.length-1;c++)zh(a.ec.v(),b[c])}else{if("MULTIPOLYGON"===a.editableFeatureType){for(var d=new Cp,c=0;c<b.length;c++)"Polygon"===b[c].l().T()&&Dp(d,b[c].l());a.editableSelection.olFeature=
new Eg({geometry:d})}if("MULTILINESTRING"===a.editableFeatureType){d=new up;for(c=0;c<b.length;c++)"LineString"===b[c].l().T()&&vp(d,b[c].l());a.editableSelection.olFeature=new Eg({geometry:d})}if("MULTIPOINT"===a.editableFeatureType){d=new yp;for(c=0;c<b.length;c++)"Point"===b[c].l().T()&&zp(d,b[c].l());a.editableSelection.olFeature=new Eg({geometry:d})}}else console.error("aFeatures is not an array")}
function Sv(a){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.putElementFeatureOnOverlay");if(null==a.editableSelection.olFeature)console.error("this['editableSelection']['olFeature'] not defined");else if(null==a.editableSelection.olFeature.l())console.error("this['editableSelection']['olFeature'].getGeometry() not defined");else if("MULTI"!==a.editableFeatureType.substr(0,5)&&"GEOMETRYCOLLECTION"!==a.editableFeatureType)a.ec.v().clear,vh(a.ec.v(),a.editableSelection.olFeature);else{var b=
[],c=[];"MULTIPOINT"===a.editableFeatureType&&(c=ab(Bp(a.editableSelection.olFeature.l())));"MULTILINESTRING"===a.editableFeatureType&&(c=ab(wp(a.editableSelection.olFeature.l())));"MULTIPOLYGON"===a.editableFeatureType&&(c=ab(cp(a.editableSelection.olFeature.l())));for(var d=0;d<c.length;d++)b.push(new Eg({geometry:c[d]}));a.ec.v().clear;a.ec.v().Hh(b)}}
T.prototype.ra.prototype.yH=function(){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.submitGeomEdition");var a={};a[this.editableSelection.bo_id_field]=this.editableSelection.bo_id_value;a[this.editableSelection.geom_column]=null!=this.editableSelection.olFeature?C.Of(this.editableSelection.olFeature.l()):"";this.zp(this.editableSelection.bo_type,a,function(){C.B.vc.vf()},function(){C.B.vc.vf()})};T.prototype.ra.prototype.submitGeomEdition=T.prototype.ra.prototype.yH;
T.prototype.ra.prototype.AI=function(){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.prototype.validateGeomAndDisplayEditForm");var a=this,b=this.dl();b.$evalAsync(function(){null!=a.editableSelection.olFeature?null!=a.editableSelection.olFeature.l()?b.oFormValues.update[a.editableSelection.geom_column]=C.Of(a.editableSelection.olFeature.l()):b.oFormValues.update[a.editableSelection.geom_column]="":b.oFormValues.update[a.editableSelection.geom_column]="";$("#basictools-select-modify-palette").hide();
C.g().$j();$("#select-edit-modal").modal("show");a.ij()})};T.prototype.ra.prototype.validateGeomAndDisplayEditForm=T.prototype.ra.prototype.AI;T.prototype.ra.prototype.ij=function(){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.clearOverlays");0<this.ec.v().ob.Lc()&&this.ec.v().clear();0<this.oe.v().ob.Lc()&&this.oe.v().clear()};T.prototype.ra.prototype.clearOverlays=T.prototype.ra.prototype.ij;
T.prototype.ra.prototype.UB=function(){C.log("nsVmap.nsToolsManager.Select.prototype.selectController.finishEdition");this.ij();C.g().sa.hide();C.B.vc.vf()};T.prototype.ra.prototype.finishEdition=T.prototype.ra.prototype.UB;C.module.directive("appSelect",T.prototype.IG);C.module.controller("AppSelectController",T.prototype.ra);function Tv(){C.log("nsVmap.nsToolsManager.Insert")}ta("nsVmap.nsToolsManager.Insert",Tv);Tv.prototype.YD=function(){C.log("nsVmap.nsToolsManager.Insert.prototype.inserttoolDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppInsertController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/tools/insert.html"}};
Tv.prototype.Za=function(a,b,c,d){C.log("nsVmap.nsToolsManager.Insert.prototype.inserttoolController");b.vmapScope=C.scope;var e=this;this.V=a;this.f=b;this.G=c;this.ua=d;this.Fc=d.defer();this.Cs=H(this.map).D().M;new Ep({vb:this.Cs});this.ec=So(C.g());this.Bb=this.ec.v().ob;this.oe=So(C.g(),{style:new yg({fill:new ug({color:"rgba(0, 0, 0, 0)"})})});this.Vg=new $u({features:this.Bb});this.rc=new mv({$a:[this.ec]});this.properties=C.properties;this.token=C.properties.token;this.addPartGeomType="";
b.selectedBoId;b.aInsertableBOs=C.oa.Mn();b.oInsertObject={sFormDefinitionName:"insert",business_object_id:null,oResult:{},sGeomColumn:null,sGeomType:null,oFormDefinition:{},add_form_size:1,oFormValues:{insert:{}}};b.featuresLength=0;C.scope.$on("layersChanged",function(){e.f.$applyAsync(function(){b.aInsertableBOs=C.oa.Mn()})});setTimeout(function(){e.f.$applyAsync(function(){b.aInsertableBOs=C.oa.Mn()})});this.rc.on("select",function(){for(var a=this.rc.Ka().L(),b=0;b<a.length;b++)zh(this.ec.v(),
a[b]);this.rc.Ka().clear()},this);this.Lf=new mv({$a:[this.oe]});this.Lf.on("select",this.Cq,this);var f=0;this.ec.v().on("change",function(){var a=b.oInsertObject.sGeomType;if(null!=a&&"MULTI"!==a.substr(0,5)&&"GEOMETRYCOLLECTION"!==a&&1<this.Bb.Lc())for(;1<this.Bb.Lc();)He(this.Bb,0);f++;var c=angular.copy(f);setTimeout(function(){if(f===c){C.log("nsVmap.nsToolsManager.Insert.inserttoolController.updateInsertObjectFeature");for(var a=e.f,b=ab(e.Bb.L()),d=a.oInsertObject.sGeomType,g=0;g<b.length;g++)if(b[g].l()instanceof
Gu){var h=b[g].l(),h=new Dk(h);b[g]=new Eg({geometry:h})}h=new $d;g="";if(0<b.length){if("MULTIPOINT"===d){d=new yp;for(g=0;g<b.length;g++)"Point"===b[g].l().T()&&zp(d,b[g].l());b=new Eg({geometry:d})}else if("MULTILINESTRING"===d){d=new up;for(g=0;g<b.length;g++)"LineString"===b[g].l().T()&&vp(d,b[g].l());b=new Eg({geometry:d})}else if("MULTIPOLYGON"===d){d=new Cp;for(g=0;g<b.length;g++)"Polygon"===b[g].l().T()&&Dp(d,b[g].l());b=new Eg({geometry:d})}else b=b[0];g=h.pt(b,{Ce:H(e.map).D().M,Fe:H(e.map).D().M})}""===
g?console.error("WKTGeometry is empty"):(b=C.hC(g,H(e.map).D().M),a.oInsertObject.oFormValues.insert[a.oInsertObject.sGeomColumn]=b,a.oInsertObject.oResult[a.oInsertObject.sGeomColumn]=b)}},500)},this);$("#basictools-insert-form-reader-modal").on("shown.bs.modal",function(){$("#basictools-insert-form-reader").parent().scrollTop(0)});C.scope.$on("toggleOutTools",function(){b.oInsertObject.oResult={};b.oInsertObject.oFormValues.insert={};b.selectedBoId=null;e.Bb.clear()});this.Bb.on("change:length",
function(){b.$applyAsync(function(){b.featuresLength=e.Bb.Lc()})},this)};Tv.prototype.inserttoolController=Tv.prototype.Za;Tv.prototype.Za.$inject=["$http","$scope","$rootScope","$q"];Tv.prototype.Za.prototype.gl=function(){C.log("nsVmap.nsToolsManager.Insert.inserttoolController.getInsertableLayers");return C.oa.gl()};Tv.prototype.Za.prototype.getInsertableLayers=Tv.prototype.Za.prototype.gl;
Tv.prototype.Za.prototype.cd=function(){C.log("nsVmap.nsToolsManager.Insert.inserttoolController.displayEditFrom");var a=this.f;C.B.vc.gp($("#basic-tools-dropdown-insert-btn"));$("#basictools-insert-form-reader-modal").modal("show");var b=this.dl();b.$evalAsync(function(){try{m(destructor_form)&&destructor_form()}catch(d){C.log("destructor_form does not exist")}if(null!=a.oInsertObject.oFormDefinition_js){var c=a.oInsertObject.oFormDefinition_js;C.log("initHtmlForm : javascript assoc. to : "+c);Td([c],
{callback:function(){try{m(constructor_form)&&constructor_form(b,c)}catch(d){C.log("constructor_form does not exist")}},async:!0,scriptInBody:!0})}b.ctrl.loadForm()})};Tv.prototype.Za.prototype.displayEditFrom=Tv.prototype.Za.prototype.cd;
Tv.prototype.Za.prototype.xz=function(){C.log("nsVmap.nsToolsManager.Insert.inserttoolController.validateForm");var a=this,b=this.f;b.jo=!1;setTimeout(function(){C.ph("basictools-insert-form-reader-submit-btn");setTimeout(function(){if(b.jo){var c=b.oInsertObject,d=b.oInsertObject.oFormValues;C.log("nsVmap.nsToolsManager.Insert.inserttoolController.getBOValuesFromFormValues");var e=a.f,f=angular.element(z.b).injector().get(["formSrvc"]),d=vb(d),d=f.getFormData("insert",!0,{oFormDefinition:e.oInsertObject.oFormDefinition,
oFormValues:d,aParamsToSave:["geom"]});c.oResult=d;$("#basictools-insert-form-reader-modal").modal("hide")}})})};Tv.prototype.Za.prototype.validateForm=Tv.prototype.Za.prototype.xz;Tv.prototype.Za.prototype.iI=function(){C.log("nsVmap.nsToolsManager.Insert.inserttoolController.trySubmitInsertion");var a=this,b=this.f;b.jo=!1;this.xz();setTimeout(function(){b.jo&&a.Uy()},500)};Tv.prototype.Za.prototype.trySubmitInsertion=Tv.prototype.Za.prototype.iI;
function Uv(a,b){C.log("nsVmap.nsToolsManager.Insert.inserttoolController.isResultValid");if(null==a)return console.error("oResult not defined"),!1;if(null==b)return console.error("oFormDefinition not defined"),!1;var c=[];b=b.insert.rows;for(var d=0;d<b.length;d++)for(var e=0;e<b[d].fields.length;e++)!0===b[d].fields[e].required&&(null!=a[b[d].fields[e].name]&&""!==a[b[d].fields[e].name]||(p(b[d].fields[e].label)&&""!==b[d].fields[e].label?c.push(b[d].fields[e].label+"("+b[d].fields[e].name+")"):
c.push(b[d].fields[e].name)));return 0===c.length?!0:c}
Tv.prototype.Za.prototype.pz=function(){function a(){setTimeout(function(){!1===h&&bootbox.confirm("Annuler la requ\u00eate ?",function(b){!0===b?(l.resolve(),Wd(),c.selectedBoId=""):a()})},5E3)}C.log("nsVmap.nsToolsManager.Insert.inserttoolController.updateInsertForm");var b=this,c=this.f,d=this.V,e=this.ua,f=this.dl(),g=c.selectedBoId;Vd();c.oInsertObject.oResult={};c.oInsertObject.sGeomColumn=null;c.oInsertObject.sGeomType=null;c.oInsertObject.business_object_id=null;c.oInsertObject.oFormDefinition=
{};c.oInsertObject.oFormValues.insert={};this.Bb.clear();null!=f&&f.ctrl.refreshForm();var h=!1,l=e.defer();d({method:"GET",url:C.properties.api_url+"/vmap/businessobjects/"+g,params:{token:C.properties.token},timeout:l.promise}).then(function(a){h=!0;Wd();if(!m(a.data))return bootbox.alert("response['data'] undefined"),c.selectedBoId="",0;if(m(a.data.errorMessage))return bootbox.alert(a.data.errorType+": "+a.data.errorMessage),c.selectedBoId="",0;if(null==a.data.data)return bootbox.alert("Aucune valeur retourn\u00e9e, impossible de charger le formulaire correspondant \u00e0 la couche"),
c.selectedBoId="",0;if(null==a.data.data[0].json_form[0])return bootbox.alert("Impossible de charger le formulaire correspondant \u00e0 la couche"),c.selectedBoId="",0;c.oInsertObject.oFormDefinition=a.data.data[0].json_form[0];c.oInsertObject.oFormDefinition_js=a.data.data[0].json_form_js;c.oInsertObject.add_form_size=a.data.data[0].add_form_size;c.oInsertObject.sBusinessObjectID=g;m(a.data.data[0].geom_column)&&(c.oInsertObject.sGeomColumn=a.data.data[0].geom_column);m(a.data.data[0].geom_type)&&
(c.oInsertObject.sGeomType=a.data.data[0].geom_type);if("GEOMETRYCOLLECTION"===c.oInsertObject.sGeomType)b.addPartGeomType="";else if("POLYGON"===c.oInsertObject.sGeomType||"MULTIPOLYGON"===c.oInsertObject.sGeomType)b.addPartGeomType="Polygon";else if("LINESTRING"===c.oInsertObject.sGeomType||"MULTILINESTRING"===c.oInsertObject.sGeomType)b.addPartGeomType="LineString";else if("POINT"===c.oInsertObject.sGeomType||"MULTIPOINT"===c.oInsertObject.sGeomType)b.addPartGeomType="Point";c.oInsertObject.oFormDefinition.insert.rows.push({fields:[{type:"button",
"class":"btn-ungroup btn-group-sm",nb_cols:12,buttons:[{visibleAllTabs:!0,type:"submit",label:"Sauvegarder",name:"form_submit","class":"btn-primary hidden",id:"basictools-insert-form-reader-submit-btn"}]}]});c.oInsertObject.oFormDefinition.insert.event=function(){c.jo=!0};f.ctrl.refreshForm()},function(a){Wd();c.selectedBoId="";bootbox.alert(a)});a()};Tv.prototype.Za.prototype.updateInsertForm=Tv.prototype.Za.prototype.pz;Tv.prototype.Za.prototype.dl=function(){return angular.element($("#basictools-insert-form-reader").children()).scope()};
Tv.prototype.Za.prototype.sH=function(a,b){C.log("nsVmap.nsToolsManager.Insert.inserttoolControlle.startInsertion");C.g().re();C.g().sa.hide();if(!0===b)return 0;if("insert"===a.substr(0,6))C.g().sa.za("Cliquez pour commencer \u00e0 dessiner"),this.Os(a.substr(6));else if("editFeature"===a)C.g().sa.za("Cliquez sur un dessin pour le modifier"),Qo(C.g(),this.Vg,"basicTools-insert-"+a);else if("deleteFeature"===a)C.g().sa.za("Cliquez sur un dessin pour le supprimer"),Qo(C.g(),this.rc,"basicTools-insert-"+
a);else if("addHole"===a){C.g().sa.za("Dessinez un polygone \u00e0 l'int\u00e9rieur d'un autre pour cr\u00e9er un trou");this.ic=C.g().gg({type:"Polygon"},"basicTools-insert-"+a);a=ab(this.Bb.L());var c=[];for(b=0;b<a.length;b++)if("Polygon"===a[b].l().T())c.push(a[b]);else if("MultiPolygon"===a[b].l().T())for(var d=ab(cp(a[b].l())),e=0;e<d.length;e++)c.push(new Eg({geometry:d[e]}));this.ic.on("drawend",function(a){a=a.wa;for(var b=Ak(a.l()),d=!1,e=0;e<c.length;e++)Eo(c[e].l(),a.l())&&(xk(c[e].l(),
b),d=!0);d?(this.ec.v().clear(),this.ec.v().Hh(c)):bootbox.alert("Trou non valide: il doit \u00eatre contenu dans un polygone dessin\u00e9")},this)}else if("deleteHole"===a)C.g().sa.za("Cliquez dans un trou pour le supprimer"),this.Vp(),Qo(C.g(),this.Lf,"basicTools-insert-"+a);else return console.error("startSelection: type ("+a+") not allowed"),0};Tv.prototype.Za.prototype.startInsertion=Tv.prototype.Za.prototype.sH;
Tv.prototype.Za.prototype.Vp=function(){C.log("nsVmap.nsToolsManager.Insert.inserttoolController.addHolesIntoHolesLayer");var a=this.Bb.L();this.oe.v().clear();for(var b=0;b<a.length;b++){var c=Bk(a[b].l());if(1<c.length)for(var d=1;d<c.length;d++){var e=new wk;e.tb([c[d].da()]);vh(this.oe.v(),new Eg({geometry:e}))}}};
Tv.prototype.Za.prototype.Cq=function(){C.log("nsVmap.nsToolsManager.Insert.inserttoolController.deleteHole");var a=this.Lf.Ka().L();if(0<a.length){for(var b=0;b<a.length;b++){for(var c=a[b].l(),d=!1,e=this.Bb.L(),f=0;f<e.length;f++){for(var g=e[f].l().da(),h=g.length-1;0<=h;h--)angular.equals(c.da()[0],g[h])&&(g.splice(h,1),d=!0);e[f].l().tb(g)}d&&zh(this.oe.v(),a[b])}this.Lf.Ka().clear()}};
Tv.prototype.Za.prototype.Os=function(a){C.log("nsVmap.nsToolsManager.Insert.inserttoolController.startDrawing");this.ic=C.g().gg({type:a,features:this.Bb},"basicTools-insert-insert"+a)};
Tv.prototype.Za.prototype.Uy=function(){C.log("nsVmap.nsToolsManager.Insert.inserttoolController.submitInsertion");var a=this,b=this.f,c=b.oInsertObject.oResult,d=b.oInsertObject.sBusinessObjectID,b=Uv(c,b.oInsertObject.oFormDefinition);if(!0===b)Vv(this,c,d);else{if(fa(b))for(c="Votre requ\u00eate n'a pas pu aboutir, les attributs suivants sont obligatoires: <br>",d=0;d<b.length;d++)c=0===d?c:c+", ",c+=b[d];else c="Votre requ\u00eate n'a pas pu aboutir, certains attributs obligatoires n'ont pas \u00e9t\u00e9s renseign\u00e9s";
bootbox.dialog({message:c,buttons:{cancel:{label:"Annuler",className:"btn-default"},editAttr:{label:"\u00c9diter les attributs",className:"btn-primary",callback:function(){a.cd()}}}})}};Tv.prototype.Za.prototype.submitInsertion=Tv.prototype.Za.prototype.Uy;
function Vv(a,b,c){C.log("nsVmap.nsToolsManager.Insert.inserttoolController.sendInsertRequest");if(null==b)console.error("oResult not defined");else if(null==c)console.error("sBusinessObjectID not defined");else{var d=a.V;b=a.Tq(b);d({method:"POST",url:C.properties.api_url+"/vmap/querys/"+c,data:b,params:{token:C.properties.token}}).then(function(b){bRequestOk=!0;Wd();if(!m(b.data))return bootbox.alert("response['data'] undefined"),0;if(200!==b.status)return 500===b.status?$.notify("Erreur interne du serveur",
"error"):null!=b.statusText?$.notify(b.statusText,"error"):$.notify("Erreur "+b.status,"error"),0;if(m(b.data.errorMessage))return bootbox.alert(b.data.errorType+": "+b.data.errorMessage),0;if(1===b.data.status){$.notify("Op\u00e9ration r\u00e9alis\u00e9e avec succ\u00e8s, les couches de la carte se mettent \u00e0 jour","info");a.pz();C.log("nsVmap.nsToolsManager.Insert.inserttoolController.reloadImpactedLayer");b=a.map.getLayers().L();for(var d=0;d<b.length;d++)b[d].get("bo_id")===c&&b[d].jd();C.B.vc.vf()}},
function(a){Wd();bootbox.alert(a)})}}Tv.prototype.Za.prototype.Tq=function(a){C.log("nsVmap.nsToolsManager.Insert.prototype.inserttoolController.prototype.getFormDataFromValues");var b=new FormData,c;for(c in a)null!=a[c].aFiles?(b.append(c+"_attached_content",a[c].aFiles[0]),b.append(c,a[c].aFiles[0].name)):b.append(c,a[c]);return b};C.module.directive("appInsert",Tv.prototype.YD);C.module.controller("AppInsertController",Tv.prototype.Za);function Wv(a,b,c){de.call(this,a);this.features=b;this.zb=c}u(Wv,de);function Xv(a){rl.call(this,{Qf:Yv,Jg:Zv,iw:$v,Rf:aw});this.Po=void 0;this.hf=null;this.bc=void 0!==a.features?a.features:null;var b;if(a.$a)if(ja(a.$a))b=function(b){return a.$a(b)};else{var c=a.$a;b=function(a){return 0<=c.indexOf(a)}}else b=Ie;this.mo=b;this.El=null}u(Xv,rl);
function Yv(a){this.El=bw(this,a.Yc,a.map);return!this.hf&&this.El?(this.hf=a.zb,$v.call(this,a),this.dispatchEvent(new Wv("translatestart",this.bc,a.zb)),!0):!1}function aw(a){return this.hf?(this.hf=null,$v.call(this,a),this.dispatchEvent(new Wv("translateend",this.bc,a.zb)),!0):!1}
function Zv(a){if(this.hf){a=a.zb;var b=a[0]-this.hf[0],c=a[1]-this.hf[1];if(this.bc)this.bc.forEach(function(a){var d=a.l();d.translate(b,c);a.Rc(d)});else if(this.El){var d=this.El.l();d.translate(b,c);this.El.Rc(d)}this.hf=a;this.dispatchEvent(new Wv("translating",this.bc,a))}}
function $v(a){var b=Bo(a.map);if(a=Ao(a.map,a.Yc,function(a){return a})){var c=!1;this.bc&&0<=this.bc.L().indexOf(a)&&(c=!0);this.Po=b.style.cursor;b.style.cursor=this.hf?"-webkit-grabbing":c?"-webkit-grab":"pointer";b.style.cursor=this.hf?c?"grab":"pointer":"grabbing"}else b.style.cursor=void 0!==this.Po?this.Po:"",this.Po=void 0}function bw(a,b,c){var d=null;b=Ao(c,b,function(a){return a},a,a.mo);a.bc&&0<=a.bc.L().indexOf(b)&&(d=b);return d};function cw(a){C.log("nsVmap.nsToolsManager.PrintBox");this.H=C.g().F;a=null!=a?a:{};this.Xl=a.size;this.Me=So(C.g());this.zd=this.Me.v().ob;this.gI=new Xv({features:this.zd})}ta("nsVmap.nsToolsManager.PrintBox",cw);xu.Print=dw;cw.prototype.show=function(a){null!=a||(a=!0);this.Jq();a&&ew(this)};cw.prototype.show=cw.prototype.show;cw.prototype.hide=function(){this.H.gt(this.Px);this.zd.clear()};cw.prototype.hide=cw.prototype.hide;
cw.prototype.$w=function(a){C.log("nsVmap.nsToolsManager.PrintBox.managePrintBox");a=null!=a?a:"modifyPrintZone";this.H.gt(this.Px);Qo(C.g(),this.gI,a)};cw.prototype.managePrintBox=cw.prototype.$w;cw.prototype.mz=function(){C.log("nsVmap.nsToolsManager.PrintBox.unmanagePrintBox");C.g().$j();this.Jq();ew(this)};cw.prototype.unmanagePrintBox=cw.prototype.mz;
cw.prototype.gb=function(){var a=this,b=H(this.H).na(),c=H(this.H).Da();this.Z();Lk(H(this.H),this.Z(),this.H.ja(),{Hc:!1,Ai:!0});var d=C.g().gb();setTimeout(function(){Mk(H(a.H),b);H(a.H).ib(c)});return d};cw.prototype.getScale=cw.prototype.gb;cw.prototype.rf=function(a){var b=this.gb(),b=a/b,c=this.Z();a=(c[2]-c[0])*b;b*=c[3]-c[1];c=zk(this.Wl.l()).da();a=Ck([c[0]-a/2,c[1]-b/2,c[0]+a/2,c[1]+b/2]);this.Wl=new Eg({geometry:a});this.zd.clear();vh(this.Me.v(),this.Wl)};cw.prototype.setScale=cw.prototype.rf;
cw.prototype.ja=function(){return this.Xl};cw.prototype.getSize=cw.prototype.ja;cw.prototype.nm=function(a){this.Xl=a};cw.prototype.setSize=cw.prototype.nm;cw.prototype.Z=function(){return this.Wl.l().Z()};cw.prototype.getExtent=cw.prototype.Z;function ew(a){a.Px=C.g().gk("precompose",a.Jq,a)}
cw.prototype.Jq=function(){if(null==this.Xl)return console.error("Print box size undefined"),0;if(null==this.Xl)return console.error("Print box feature undefined"),0;this.zd.clear();var a=this.Xl,b=a[0],c=a[1],a=$("#map1").width()/2-b/2,b=$("#map1").width()/2+b/2,d=$("#map1").height()/2-c/2,c=$("#map1").height()/2+c/2,e=[b,d],f=this.H.Kd([a,c]),e=this.H.Kd(e),f=Ck([f[0],e[1],e[0],f[1]]),f=new Eg({geometry:f});f.set("pixelExtent",[a,d,b,c]);this.Wl=f;vh(this.Me.v(),this.Wl)};function dw(){C.log("nsVmap.nsToolsManager.Print")}ta("nsVmap.nsToolsManager.Print",dw);xu.Print=dw;dw.prototype.print=function(a){C.log("nsVmap.nsToolsManager.Print.prototype.print");angular.element($("#select-print-format")).scope().$evalAsync(function(b){b.ctrl.print(a)})};dw.prototype.print=dw.prototype.print;
dw.prototype.RF=function(){C.log("nsVmap.nsToolsManager.Print.prototype.printDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppprintController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/tools/print.html"}};
dw.prototype.fc=function(a,b,c,d){C.log("nsVmap.nsToolsManager.Print.prototype.printController");var e=this;this.$timeout_=a;this.V=b;this.f=d;d.modelIndex=0;this.properties;this.model;this.resolution=2;this.dpi=1;this.scale="auto";this.currentScale=C.g().gb({pretty:!0});this.Di=new cw;fw(this);gw(this);$("#print-select-btn").click(function(){$("#print-select-btn").hasClass("active")&&e.Nw(d.modelIndex)});C.scope.$on("toggleOutTools",function(){$("#print-select-btn").hasClass("active")||e.Di.hide()})};
dw.prototype.printController=dw.prototype.fc;dw.prototype.fc.$inject=["$timeout","$http","$compile","$scope"];function fw(a){C.log("nsVmap.nsToolsManager.Print.printController.loadPrintProperties");Vd();a.V({method:"GET",url:C.properties.api_url+"/vmap/userprinttemplates?distinct=true&token="+C.properties.token}).then(function(b){Wd();null!=b.data&&fa(b.data.userprinttemplates)&&0<b.data.userprinttemplates.length&&(a.properties={models:b.data.userprinttemplates})},function(a){console.error(a)})}
function gw(a){C.log("nsVmap.nsToolsManager.Print.printController.listenScaleChanges");var b=0;a.map.on("moveend",function(){b++;var c=angular.copy(b);setTimeout(function(){b===c&&"print-modifyPrintZone"!==a.currentAction&&(a.scale="auto",a.currentScale=Oo(C.g(),C.g().gb()/a.Ji),a.f.$apply())},100)})}
dw.prototype.fc.prototype.Nw=function(a){C.log("nsVmap.nsToolsManager.Print.printController.loadModelParmas");a=this.model=this.properties.models[a];var b=this.iE;C.log("nsVmap.nsToolsManager.Print.printController.setTemplate");null!=a.definition||null!=a.url||bootbox.alert("<h4>Aucune d\u00e9finition pr\u00e9sente dans le mod\u00e8le d'impression</h4>");if(null!=a.definition){var c=document.createElement("div");c.innerHTML=a.definition;this.FH=c;b.call(this,[c])}};
dw.prototype.fc.prototype.loadModelParmas=dw.prototype.fc.prototype.Nw;
dw.prototype.fc.prototype.iE=function(){C.log("nsVmap.nsToolsManager.Print.printController.loadModelParmas2");var a=this.FH;C.log("nsVmap.nsToolsManager.Print.printController.setPrintedMapSize");var b=$(a).find("#map_image");if(m(b.get(0))){$(a).addClass("print_template");$("body").append(a);var c=b.height(),b=b.width();$(a).remove();this.Ji=1;for(var a=angular.copy(b),d=angular.copy(c);b>$("#map1").width()||c>$("#map1").height();)this.Ji++,b=a/this.Ji,c=d/this.Ji;this.TF=[b,c]}else console.error("Aucune balise #map_image trouv\u00e9e dans le template");
this.resolution=this.Ji;this.currentScale=Oo(C.g(),C.g().gb()/this.Ji);this.Di.nm(this.TF);this.Di.show()};dw.prototype.fc.prototype.UA=function(a){C.log("nsVmap.nsToolsManager.Print.prototype.printController.prototype.changeScale");if("auto"===a)return 0;if("print-modifyPrintZone"===this.currentAction)return this.Di.rf(a),0;a*=this.Ji;C.g().rf(a)};dw.prototype.fc.prototype.changeScale=dw.prototype.fc.prototype.UA;
dw.prototype.fc.prototype.wE=function(){C.log("nsVmap.nsToolsManager.Print.prototype.printController.prototype.managePrintZone");"print-modifyPrintZone"===this.currentAction?this.Di.mz():this.Di.$w("print-modifyPrintZone")};dw.prototype.fc.prototype.managePrintZone=dw.prototype.fc.prototype.wE;
dw.prototype.fc.prototype.OF=function(){C.log("nsVmap.nsToolsManager.Print.prototype.printController.prototype.prepareAndLaunchPrint");C.g().gb({pretty:!0});for(var a={},b=0;b<this.model.variables.length;b++)a[this.model.variables[b].name]=this.model.variables[b].value;b=this.Di.Z();1===this.print({scope:a,P:b,Yy:this.model.printtemplate_id,my:this.dpi})&&C.B.vc.vf()};dw.prototype.fc.prototype.prepareAndLaunchPrint=dw.prototype.fc.prototype.OF;
dw.prototype.fc.prototype.print=function(a){C.log("nsVmap.nsToolsManager.Print.prototype.printController.prototype.print");var b=this;if(null==a)return console.error("opt_options.templateId not defined"),0;var c=null!=a.my?a.my:1,d=a.Yy,e=JSON.stringify([{target:"#map_legend",html:hw()}]),f=JSON.stringify(null!=a.scope?a.scope:{}),g,h;null!=a.bx?g=a.bx:h=C.oa.Nn();for(var l=null!=a.features?a.features:[],n="",r=0;r<l.length;r++)0<r&&(n+="|"),n+=C.Of(l[r].l());for(var l=null!=a.P?a.P:[],t="",v=[l[0]-
(l[2]-l[0]),l[1]-(l[3]-l[1]),l[2]+(l[2]-l[0]),l[3]+(l[3]-l[1])],x="",r=0;r<l.length;r++)0<r&&(t+="|",x+="|"),t+=l[r],x+=v[r];var y=100;null!=a.Cv?y=a.Cv:null!=C.properties.print.features_zoom&&(y=C.properties.print.features_zoom);var B=window.open("","_blank","height=400,width=600");if(null==B)return $.notify("Fen\u00eatre d'impression bloqu\u00e9e par le navigateur","error"),0;B.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>');
this.V({method:"GET",url:C.properties.api_url+"/vmap/printtemplates/"+d+"?token="+C.properties.token}).then(function(a){var l=!1;null!=a.data?null!=a.data.data?null!=a.data.data[0]?null!=a.data.data[0].definition?null!=a.data.data[0].rt_format_id?null!=a.data.data[0].rt_orientation_id||(l=!0):l=!0:l=!0:l=!0:l=!0:l=!0;if(l)return $.notify("Erreur lors du chargement des donn\u00e9es du template "+d,"error"),console.error("response: ",a),0;var l=a.data.data[0].rt_format_id,r=a.data.data[0].rt_orientation_id,
v=document.createElement("div");v.innerHTML=a.data.data[0].definition;a=iw(v,"#map_image");v=iw(v,"#map_overview");if(null!=a)var E={token:C.properties.token,map_id:g,map_json:h,image_size:a[0]*c+"|"+a[1]*c,resolution_coeff:c,extent:t,features:n,features_zoom:y};if(null!=v)var O={token:C.properties.token,map_id:g,map_json:h,image_size:v[0]*c+"|"+v[1]*c,resolution_coeff:c,extent:x,features:n,features_zoom:400};a=[];null!=E&&a.push({target:"#map_image",map_definition:E});null!=O&&a.push({target:"#map_overview",
map_definition:O});E=JSON.stringify(a);b.V({method:"POST",url:C.properties.api_url+"/vmap/printtemplateservices",data:{token:C.properties.token,printtemplate_id:d,format:l,orientation:r,includes_json:e,maps_json:E,scope_json:f}}).then(function(a){var b=!1;null!=a.data?null!=a.data.printtemplateservices?null!=a.data.printtemplateservices.image?1!==a.data.status&&(b=!0):b=!0:b=!0:b=!0;if(b)return $.notify("Une erreur est survenue lors de l'impression","error"),B.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">Une erreur est survenue lors de l\'impression</div>'),
console.error("response: ",a),0;$.notify("Impression r\u00e9ussie","success");B.location.href=a.data.printtemplateservices.image},function(a){console.error(a);$.notify("Une erreur est survenue lors de l'impression","error");B.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">Une erreur est survenue lors de l\'impression</div>')})},function(a){console.error(a);$.notify("Une erreur est survenue lors de l'impression","error");B.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">Une erreur est survenue lors de l\'impression</div>')});
return 1};dw.prototype.fc.prototype.print=dw.prototype.fc.prototype.print;function iw(a,b){var c=$(a).find(b);if(m(c.get(0)))return $("body").append(a),b=c.height(),c=c.width(),$(a).remove(),[c,b];C.log("Aucune balise "+b+" trouv\u00e9e dans le template")}
function hw(){var a=$("#maplegend").clone();a.find("img").each(function(){try{var a=document.createElement("canvas"),c=a.getContext("2d");a.width=this.width;a.height=this.height;c.drawImage(this,0,0,this.width,this.height);var d=a.toDataURL("image/png");$(this).attr("src",d);$(this).removeAttr("ng-src")}catch(e){}});a=a.html();a=a.replace(/&amp;/g,"&");return a=a.replace(/"/g,'\\"')}C.module.directive("appPrint",dw.prototype.RF);C.module.controller("AppprintController",dw.prototype.fc);function jw(){C.log("nsVmap.nsToolsManager.BasicTools");this.jF=new Bu;this.lF=new pv;this.Wr=new T;this.gF=new Tv;this.Cx=new dw;this.cF=new yu}ta("nsVmap.nsToolsManager.BasicTools",jw);jw.prototype.XH=function(a){var b=$(a).hasClass("active");this.vf();!1===b&&($(a).addClass("active"),$(a).parent().children(".dropdown-menu").show())};jw.prototype.toggleTool=jw.prototype.XH;jw.prototype.gp=function(a){$(a).addClass("active");$(a).parent().children(".dropdown-menu").show()};
jw.prototype.showTool=jw.prototype.gp;jw.prototype.kw=function(a){$(a).removeClass("active");$(a).parent().children(".dropdown-menu").hide()};jw.prototype.hideTool=jw.prototype.kw;jw.prototype.vf=function(){C.log("nsVmap.nsToolsManager.BasicTools.prototype.toggleOutTools");$(".basic-tools-element").removeClass("active");$(".basic-tools-dropdown-element").hide();C.g().$j();C.log("oVmap event: toggleOutTools");C.scope.$broadcast("toggleOutTools")};jw.prototype.toggleOutTools=jw.prototype.vf;
jw.prototype.Iu=function(){C.log("nsVmap.nsToolsManager.BasicTools.prototype.basictoolsDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppBasictoolsController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/tools/basictools.html"}};jw.prototype.basictoolsDirective=jw.prototype.Iu;
jw.prototype.jq=function(a,b){C.log("nsVmap.nsToolsManager.BasicTools.prototype.basictoolsController");a.$oLocation;a.$oMeasure;a.$oSelect;a.$oInsert;a.$oPrint;a.$oControls;b(function(){for(var b=a.TI;b;b=b.UI)b.Mk.constructor===Bu.prototype.Fa&&(a.$oLocation=b),b.Mk.constructor===pv.prototype.Ia&&(a.$oMeasure=b),b.Mk.constructor===T.prototype.VJ&&(a.$oSelect=b),b.Mk.constructor===Tv.prototype.Za&&(a.$oInsert=b),b.Mk.constructor===dw.prototype.fc&&(a.$oPrint=b),b.Mk.constructor===yu.prototype.Zu&&
(a.$oControls=b)});C.scope.$on("mapChanged",function(){C.B.vc.vf()})};jw.prototype.basictoolsController=jw.prototype.jq;jw.prototype.jq.$inject=["$scope","$timeout"];jw.prototype.MC=function(){return this.Wr};jw.prototype.getSelect=jw.prototype.MC;jw.prototype.oC=function(){return this.gF};jw.prototype.getInsert=jw.prototype.oC;jw.prototype.vC=function(){return this.jF};jw.prototype.getLocation=jw.prototype.vC;jw.prototype.CC=function(){return this.lF};jw.prototype.getMeasure=jw.prototype.CC;
jw.prototype.LC=function(){return this.Cx};jw.prototype.getPrint=jw.prototype.LC;jw.prototype.cf=function(){return this.cF};jw.prototype.getControls=jw.prototype.cf;C.module.directive("appBasictools",jw.prototype.Iu);C.module.controller("AppBasictoolsController",jw.prototype.jq);function U(){C.log("nsVmap.nsToolsManager.InfoContainer")}ta("nsVmap.nsToolsManager.InfoContainer",U);U.prototype.ve=function(){C.log("nsVmap.nsToolsManager.InfoContainer.showBar");ye(function(){angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(a){a.ctrl.ve()})})};U.prototype.showBar=U.prototype.ve;
U.prototype.Ga=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.addTab");if(!m(a))return"opt_options not defined";if(!m(a.va))return"opt_options.tabCode not defined";if(!m(a.Va))return"opt_options.tabName not defined";angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){var c=new kw(a);b.ctrl.Ga(c)})};U.prototype.addTab=U.prototype.Ga;
U.prototype.bH=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.setTab");if(!m(a))return"opt_options not defined";if(!m(a.va))return"opt_options.tabCode not defined";if(!m(a.Va))return"opt_options.tabName not defined";var b=angular.element($("#infocontainer-info-container")).scope();if(void 0!==b.ctrl.infos)for(var c=b.ctrl.infos.length-1;0<=c;c--)b.ctrl.infos.splice(c,1);b.$evalAsync(function(b){var c=new kw(a);b.ctrl.Ga(c)})};U.prototype.setTab=U.prototype.bH;
U.prototype.Sm=function(a,b){C.log("nsVmap.nsToolsManager.InfoContainer.addRow");if(void 0===a.va&&void 0===a.tabIndex)return"bad tab_options";if(void 0===b.data)return"row_options.data undefined";angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(c){c.ctrl.Sm(a,b);c.ctrl.$l()});return!0};U.prototype.addRow=U.prototype.Sm;
U.prototype.Xp=function(a,b){C.log("nsVmap.nsToolsManager.InfoContainer.addMultipleRows");if(void 0===a.va&&void 0===a.tabIndex)return"bad tab_options";if(void 0===b.data)return"row_options.data undefined";angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(c){for(var d,e=0;e<b.data.length;e++)d={data:b.data[e],Sh:b.Sh,Od:b.Od},c.ctrl.Sm(a,d);c.ctrl.$l()});return!0};U.prototype.addMultipleRows=U.prototype.Xp;
U.prototype.$l=function(){C.log("nsVmap.nsToolsManager.InfoContainer.refreshTabs");angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(a){a.ctrl.$l()});return!0};U.prototype.refreshTabs=U.prototype.$l;U.prototype.Hd=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.displayTabByCode");angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){b.ctrl.Hd(a)})};U.prototype.displayTabByCode=U.prototype.Hd;
U.prototype.Uk=function(a){console.log("1");C.log("nsVmap.nsToolsManager.InfoContainer.displayTabByIndex");angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){b.ctrl.Uk(a)})};U.prototype.displayTabByIndex=U.prototype.Uk;U.prototype.rB=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.displayInfos");this.ve();this.kh(a)};U.prototype.displayInfos=U.prototype.rB;
U.prototype.ya=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.getTabByCode");a=angular.element($("#infocontainer-info-container")).scope().ctrl.ya(a);if(void 0!==a)return jQuery.extend(!0,{},a)};U.prototype.getTabByCode=U.prototype.ya;U.prototype.ml=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.getTabTable");return angular.element($("#infocontainer-info-container")).scope().ctrl.ml(a)};U.prototype.getTabTable=U.prototype.ml;
U.prototype.nC=function(){C.log("nsVmap.nsToolsManager.InfoContainer.getInfos");var a=angular.element($("#infocontainer-info-container")).scope().ctrl.infos;return jQuery.extend(!0,[],a)};U.prototype.getInfos=U.prototype.nC;U.prototype.kh=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.setInfos");C.log(a);angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){b.ctrl.kh(a)})};U.prototype.setInfos=U.prototype.kh;
U.prototype.dj=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.addInfos");C.log(a);angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){b.ctrl.dj(a)})};U.prototype.addInfos=U.prototype.dj;U.prototype.vs=function(a){var b=angular.element($("#infocontainer-info-container")).scope(),c=b.ctrl.infos;if(void 0===a||void 0===c)return 0;for(var d=c.length-1;0<=d;d--)c[d].tabCode===a&&c.splice(d,1);b.$evalAsync(function(a){lw(a.ctrl)})};U.prototype.removeTabByCode=U.prototype.vs;
U.prototype.removeAll=function(){C.log("nsVmap.nsToolsManager.InfoContainer.removeAll");C.g().Ur.clear();var a=angular.element($("#infocontainer-info-container")).scope(),b=a.ctrl.infos;if(void 0===b)return 0;for(var c=b.length-1;0<=c;c--)b.splice(c,1);a.$evalAsync(function(a){lw(a.ctrl)})};U.prototype.removeAll=U.prototype.removeAll;
U.prototype.Vo=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.removeTabRows");if(void 0===a)return 0;angular.element($("#infocontainer-info-container")).scope();var b=this.ya(a);this.ml(b);for(b=b.tableParams.data.length-1;0<=b;b--)this.ss(a,b)};U.prototype.removeTabRows=U.prototype.Vo;
U.prototype.ss=function(a,b){C.log("nsVmap.nsToolsManager.InfoContainer.removeRow");var c=angular.element($("#infocontainer-info-container")).scope(),d=c.ctrl.infos;if(void 0===a||void 0===d||void 0===b)return 0;var e=this.ya(a),e=this.ml(e).bootstrapTable("getData")[b];m(e.feature)&&zh(C.g().Sd.v(),e.feature);for(e=d.length-1;0<=e;e--)d[e].tabCode===a&&d[e].tableParams.data.splice(b,1);c.$evalAsync(function(a){lw(a.ctrl)})};U.prototype.removeRow=U.prototype.ss;
U.prototype.uk=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.zoomOnTabFeatures");if(!m(a))return"tabCode not defined";angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){b.ctrl.uk(a)})};U.prototype.zoomOnTabFeatures=U.prototype.uk;U.prototype.De=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.displayTabFeatures");if(!m(a))return"tabCode not defined";angular.element($("#infocontainer-info-container")).scope().$evalAsync(function(b){b.ctrl.De(a)})};
U.prototype.displayTabFeatures=U.prototype.De;
function kw(a){C.log("nsVmap.nsToolsManager.InfoContainer.Tab");if(!m(a)||!m(a.va)||!m(a.Va))return 0;var b=[],c=[],d={},e="";a.data=m(a.data)?a.data:[];a.ta=m(a.ta)?a.ta:[];a.Od=m(a.Od)?function(){var b=a.Od;Ta(b,"feature")||b.push("feature");return b}():["feature"];for(var f=0;f<a.ta.length;f++)"delete"===a.ta[f]?(e="info-container-goog_"+La++ +"-remove-feature",c.push('<a class="'+e+'" href="javascript:void(0)" title="Enlever du panier">'),c.push('<i class="glyphicon glyphicon-remove padding-sides-5"></i>'),c.push("</a>"),
d["click ."+e]=function(b,c,d,e){C.B.K.ss(a.va,e)}):"zoom"===a.ta[f]&&(e="info-container-goog_"+La++ +"-zoom-feature",c.push('<a class="'+e+'" href="javascript:void(0)" title="Zoom sur la g\u00e9om\u00e9trie">'),c.push('<i class="glyphicon glyphicon-globe padding-sides-5"></i>'),c.push("</a>"),d["click ."+e]=function(a,b,c){if(!m(c.feature))return console.error('Aucune g\u00e9om\u00e9trie renseign\u00e9e dans la colone "feature"'),0;a=H(C.g().F);b=C.g().F.ja();var d=c.feature.l().Z(),e=a.na();C.g().Xg.clear();
vh(C.g().Yq(),c.feature);Lk(a,d,b,{padding:[50,50,50,50]});("Point"===c.feature.l().T()||"MultiPoint"===c.feature.l().T()&&1>=Bp(c.feature.l()).length)&&Mk(a,e)});b.push({checkbox:!0,clickToSelect:!0,"class":"info-container-checkbox-column"});b.push({formatter:function(){return c.join("")},"class":"info-container-list-events-column",events:d});a.Sh=m(a.Sh)?a.Sh:function(){for(var c in a.data[0])b.push({field:c,title:c,sortable:!0,visible:!Ta(a.Od,c)});return b}();d={search:!0,checkboxHeader:!0,data:a.data,
columns:a.Sh};this.tabCode=a.va;this.tabName=a.Va;this.tableParams=d}U.Tab=kw;U.prototype.vw=function(){C.log("nsVmap.nsToolsManager.InfoContainer.prototype.infocontainerDirective");return{restrict:"A",scope:{map:"=appMap",lang:"=appLang",infos:"=appInfos"},controller:"AppInfocontainerController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/tools/infocontainer.html"}};U.prototype.infocontainerDirective=U.prototype.vw;
U.prototype.lb=function(a,b,c){C.log("nsVmap.nsToolsManager.InfoContainer.prototype.infocontainerController");this.$timeout=a;this.V=c;this.infos=[];this.selectedTabIndex=0;this.avaliablePrintReports=[];C.scope.$on("mapChanged",function(){C.B.K.removeAll()})};U.prototype.infocontainerController=U.prototype.lb;U.prototype.lb.$inject=["$timeout","$scope","$http"];
U.prototype.lb.prototype.ve=function(){C.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.showBar");"hidden"===$("#opener-bottombar").css("visibility")&&$("#opener-bottombar").css("visibility","visible");$("#map-container").addClass("minus");this.$timeout(function(){!1===$("#map-container").hasClass("open")&&!1===$("#map-container").hasClass("open2")&&C.ph("opener-bottombar-1")})};
U.prototype.lb.prototype.Uk=function(a){console.log("2");C.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.displayTabByIndex");this.selectedTabIndex=a};U.prototype.lb.prototype.displayTabByIndex=U.prototype.lb.prototype.Uk;U.prototype.lb.prototype.Hd=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.displayTabByCode");for(var b=0;b<this.infos.length;b++)if(this.infos[b].tabCode===a)var c=b;this.Uk(c)};U.prototype.lb.prototype.displayTabByCode=U.prototype.lb.prototype.Hd;
k=U.prototype.lb.prototype;k.ya=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.getTabByCode");for(var b=0;b<this.infos.length;b++)if(this.infos[b].tabCode===a)return this.infos[b]};k.ml=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.getTabTable");return void 0===a?0:$("#infocontainer-table-"+a.index)};
k.Ga=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.addTab");for(var b=0;b<this.infos.length;b++)if(this.infos[b].tabCode===a.tabCode){var c=!0;C.log('onglet "'+this.infos[b].tabCode+'"" d\u00e9j\u00e0 pr\u00e9sent');this.infos[b]=a}void 0===c&&this.infos.push(a);var d=this;this.$timeout(function(){lw(d)})};
k.Sm=function(a,b){C.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.addRow");if(void 0===a.va&&void 0===a.tabIndex)return"bad tab_options";if(void 0===b.data)return"row_options.data undefined";b.Od=m(b.Od)?function(){var a=b.Od;Ta(a,"feature")||a.push("feature");return a}():["feature"];var c=m(a.va)?this.ya(a.va):this.infos[a.tabIndex];if(null==c)return cosnole.error("impossible de trouver la tab, tab_options:",a),0;a=m(b.Sh)?b.Sh:function(){var a=[],c;for(c in b.data)a.push({field:c,
title:c,sortable:!0,visible:!Ta(b.Od,c)});return a}();for(var d=0;d<c.tableParams.data.length;d++){bRowExists=!0;for(var e=0;e<a.length;e++)"feature"!==a[e].field&&!1===rb(c.tableParams.data[d],b.data[a[e].field])&&(bRowExists=!1);if(!0===bRowExists)return C.log("ligne d\u00e9j\u00e0 existante"),"ligne d\u00e9j\u00e0 existante"}for(d=0;d<a.length;d++){for(var f=!1,e=0;e<c.tableParams.columns.length;e++)c.tableParams.columns[e].field===a[d].field&&(f=!0);!1===f&&Va(c.tableParams.columns,a[d])}Va(c.tableParams.data,
b.data);return!0};k.$l=function(){var a=this;this.$timeout(function(){lw(a)})};k.dj=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.addInfos");if(void 0===a)return 0;if(0===this.infos.length)return this.kh(a);for(var b=0;b<a.length;b++){for(var c=!1,d=0;d<this.infos.length;d++)if(this.infos[d].tabCode===a[b].tabCode)for(var c=!0,e=0;e<a[b].tableParams.data.length;e++)Va(this.infos[d].tableParams.data,a[b].tableParams.data[e]);!1===c&&Va(this.infos,a[b])}var f=this;this.$timeout(function(){lw(f)})};
k.kh=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.setInfos");if(void 0===a)return 0;this.infos=a;var b=this;this.$timeout(function(){lw(b)})};
k.Vo=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.removeTabRows");if(void 0===a)return 0;$("body").css({cursor:"wait"});a=this.ya(a);for(var b={},c=a.tableParams.data.length-1;0<=c;c--)b=a.tableParams.data[c],Ta(C.g().Sd.v().Ka(),b.feature)&&zh(C.g().Sd.v(),b.feature),a.tableParams.data.splice(c,1);$("body").css({cursor:""});var d=this;this.$timeout(function(){lw(d)})};U.prototype.lb.prototype.removeTabRows=U.prototype.lb.prototype.Vo;
U.prototype.lb.prototype.vs=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.removeTabByNam");for(var b=this.infos,c=b.length-1;0<=c;c--)b[c].tabCode===a&&(this.Vo(a),b.splice(c,1))};U.prototype.lb.prototype.removeTabByCode=U.prototype.lb.prototype.vs;
U.prototype.lb.prototype.uk=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.zoomOnTabFeatures");if(!m(a))return"tabCode not defined";var b=[],c=[],d=this.ya(a).tableParams.data;for(a=d.length-1;0<=a;a--)m(d[a].feature)&&Va(b,d[a].feature);if(0===b.length)return 0;c=jQuery.extend(!0,[],b[0].l().Z());for(a=b.length-1;0<=a;a--)d=b[a].l().Z(),d[0]<c[0]&&(c[0]=d[0]),d[1]<c[1]&&(c[1]=d[1]),d[2]>c[2]&&(c[2]=d[2]),d[3]>c[3]&&(c[3]=d[3]),delete d;c[0]===c[2]&&(c[0]-=1E-4*c[0],
c[2]+=1E-4*c[2]);c[1]===c[3]&&(c[1]-=1E-4*c[1],c[3]+=1E-4*c[3]);setTimeout(function(){Lk(H(C.g().F),c,C.g().F.ja(),{padding:[50,50,50,50]});for(var a=b.length-1;0<=a;a--)Ta(C.g().Sd.v().Ka(),b[a])&&zh(C.g().Sd.v(),b[a]),vh(C.g().Sd.v(),b[a])})};U.prototype.lb.prototype.zoomOnTabFeatures=U.prototype.lb.prototype.uk;
U.prototype.lb.prototype.De=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.displayTabFeatures");if(!m(a))return"tabCode not defined";var b=[];a=this.ya(a).tableParams.data;for(var c=a.length-1;0<=c;c--)m(a[c].feature)&&Va(b,a[c].feature);if(0===b.length)return 0;for(c=b.length-1;0<=c;c--)Ta(C.g().Sd.v().Ka(),b[c])&&zh(C.g().Sd.v(),b[c]),vh(C.g().Sd.v(),b[c])};U.prototype.lb.prototype.displayTabFeatures=U.prototype.lb.prototype.De;
function lw(a){C.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.loadTables");for(var b=a.infos.length-1;0<=b;b--)$("#infocontainer-table-"+b).bootstrapTable("destroy"),$("#infocontainer-table-"+b).bootstrapTable(a.infos[b].tableParams),$("#infocontainer-table-"+b).bootstrapTable("load",a.infos[b].tableParams),$("#infocontainer-table-"+b).bootstrapTable("resetView",a.infos[b].tableParams),$("#infocontainer-table-"+b).bootstrapTable("resetWidth")}
U.prototype.lb.prototype.MG=function(a){C.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.setReports");var b=this;fa(this.avaliablePrintReports)?this.avaliablePrintReports.length=0:this.avaliablePrintReports=[];if(null==a)return $.notify("Aucun rapport disponible","warning"),0;Vd();this.V({method:"GET",url:C.properties.api_url+"/vmap/printreports",params:{token:C.properties.token,attributs:"name|printreport_id|business_object_id|business_object_id_field|multiobject",filter:"business_object_id='"+
a+"'"}}).then(function(c){Wd();if(null==c.data)return console.error("response.data undefined: ",c),$("#infocontainer-dropdown-reports").dropdown("toggle"),0;if(null==c.data.data)return $.notify("Aucun rapport disponible pour "+a,"warning"),$("#infocontainer-dropdown-reports").dropdown("toggle"),0;b.avaliablePrintReports=c.data.data},function(a){Wd();$.notify("Impossible de r\u00e9cup\u00e8rer les rapports li\u00e9s \u00e0 l'objet m\u00e9tier");console.error(a)})};
U.prototype.lb.prototype.setAvaliablePrintReports=U.prototype.lb.prototype.MG;
U.prototype.lb.prototype.Fn=function(a,b){C.log("nsVmap.nsToolsManager.InfoContainer.infocontainerController.generatePrintReport");b=$("#infocontainer-table-"+b).bootstrapTable("getSelections");if(!fa(b))return $.notify("Impossible de r\u00e9cup\u00e9rer la s\u00e9lection du tableau"),0;if(0>=b.length)return $.notify("Aucun \u00e9l\u00e9ment s\u00e9lectionn\u00e9"),0;for(var c=[],d=0;d<b.length;d++)null!=b[d][a.business_object_id_field]&&c.push(b[d][a.business_object_id_field]);if(0< !c.length)return $.notify("G\u00e9n\u00e9ration du document impossible"),
console.error("generated aIds is empty"),0;C.Fn({printReportId:a.printreport_id,ids:c})};U.prototype.lb.prototype.generatePrintReport=U.prototype.lb.prototype.Fn;C.module.directive("appInfocontainer",U.prototype.vw);C.module.controller("AppInfocontainerController",U.prototype.lb);xu.Pl={};
function V(a){C.log("nsVmap.nsToolsManager.nsModules.Draw");a=m(a)?a:{};this.fields_=[{name:"Nom",id:"Nom",type:"text",required:"true",value:""},{name:"Th\u00e8me / Projet",id:"theme",type:"text",required:"false",value:""},{name:"Commentaire",id:"commentaire",type:"text",required:"false",value:""},{name:"Afficher l'\u00e9tiquette",id:"ShowName",type:"boolean",required:"",value:""},{name:"Afficher la partie vectorielle",id:"ShowVector",type:"boolean",required:"",value:""},{name:"Couleur de fond",id:"Fill",
type:"color",required:"false",value:"rgba(54,184,255,0.6)"},{name:"Couleur du contour",id:"Stroke",type:"color",required:"false",value:"rgba(0,0,0,0.4)"},{name:"Taille du contour",id:"StrokeSize",type:"number",required:"false",value:"2"},{name:"Couleur du texte",id:"Text",type:"color",required:"false",value:"rgba(0,0,0,1)"},{name:"Fond du texte",id:"TextBackground",type:"color",required:"false",value:"rgba(48,183,255,1)"},{name:"Taille du texte",id:"TextSize",type:"number",required:"false",value:"12"}];
this.features_=a.features}ta("nsVmap.nsToolsManager.nsModules.Draw",V);xu.Pl.Draw=V;V.prototype.GB=function(){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawDirective");return{restrict:"C",scope:{map:"=appMap",lang:"=appLang",currentAction:"=appAction"},controller:"AppdrawController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/modules/draw.html"}};
V.prototype.ba=function(){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController");C.bz();this.fields_=C.B.gr("Draw").Wv();this.features_=C.B.gr("Draw").Ka();this.exportFormats_=["GeoJSON"];this.exportFormatsConstructors_=[Ep];this.Nm=new nf(6378137);this.H=C.g().F;this.Me=So(C.g());this.zd=this.Me.v().ob;this.Vg=new $u({features:this.zd});this.wn=new mv({$a:[this.Me]});this.wn.on("select",function(){var a=this.wn.Ka().L();this.vn(a[0]);this.wn.Ka().clear()},this);this.fp=new mv({$a:[this.Me]});
this.fp.on("select",function(){var a=this.fp.Ka().L();this.Eq(a[0]);this.fp.Ka().clear()},this);this.Ki=new mv({$a:[this.Me],Mb:jl});this.rc=new mv({$a:[this.Me]});this.rc.on("select",function(){var a=this.rc.Ka().L();this.To(a)},this);this.ai=document.getElementById("geodesic");void 0!==this.features_&&this.Hh(this.features_)};V.prototype.drawController=V.prototype.ba;
function mw(a,b){a.ac&&a.ac.parentNode.removeChild(a.ac);a.ac=document.createElement("div");a.ac.className="draw-tooltip draw-tooltip-draw";a.Yh=new Wo({element:a.ac,offset:[0,-15],Uj:"bottom-center"});a.Yh.set("type","draw");void 0!==b&&a.Yh.set("feature",b);a.H.Ff(a.Yh)}
function nw(a,b){if(void 0!==b.get("infoValues")){var c=0;mw(a,b);for(key in b.get("infoValues"))0==c&&(a.ac.innerHTML=b.get("infoValues")[key]),c++;a.Yh.setPosition(a.gi(b.l()));a.ac.className="draw-tooltip draw-tooltip-static";Xo(a.Yh,[0,-7]);a.ac.style.color=b.get("infoValues").Text;a.ac.style.backgroundColor=b.get("infoValues").TextBackground;a.ac.style.fontSize=b.get("infoValues").TextSize;"false"===b.get("infoValues").ShowName&&(a.ac.style.opacity=0);"false"===b.get("infoValues").ShowVector&&
(a.ac.style.opacity=0);a.ac=null;mw(a,b);a.kk();ow()}}V.prototype.ba.prototype.gi=function(a){if("Polygon"===a.T())a=bk(zk(a));else if("MultiPolygon"===a.T()){var b=new yp(null);b.ma("XY",Am(a).slice());a=bk(b)}else if("LineString"===a.T())b=Math.round(a.da().length/2),a=a.da()[b];else if("Circle"===a.T())a=a.Da();else if("Point"===a.T()||"MultiPoint"===a.T())a=bk(a);else return"GeometryCollection"===a.T()?0:bk(a);return a};
V.prototype.ba.prototype.Ub=function(a){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.prototype.addInteraction");C.g().sa.za("Cliquer pour commencer \u00e0 dessiner");this.ic=C.g().gg({type:a,features:this.zd},"draw-draw"+a);this.ic.on("drawstart",function(){"Point"===a||"Circle"===a?C.g().sa.za("Cliquez pour terminer le dessin"):"LineString"!==a&&"Polygon"!==a||C.g().sa.za("Double-cliquez pour terminer le dessin")},this);this.ic.on("drawend",function(a){$("#draw-edit-modal-header").addClass("hidden");
this.Li(a.wa);this.vn(a.wa);C.g().sa.hide();a.wa.on("change",function(){aOverlays=C.g().F.Pc;for(var b=aOverlays.L().length-1;0<=b;b--)aOverlays.L()[b].get("feature")===a.wa&&aOverlays.L()[b].setPosition(this.gi(a.wa.l()));this.Li(a.wa)},this)},this)};
V.prototype.ba.prototype.Hh=function(a){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.prototype.addFeatures");for(var b=[Br,Ep,hs,ms,Xt],c=[],d=0;d<b.length;d++){var e=new b[d];try{var f=e.Zj(a);0<f.length&&(c=f,d=b.length)}catch(h){}}for(d=0;d<c.length;d++){"Cercle"===c[d].get("Type")&&(a=c[d].get("Coordinates")[0],b=c[d].get("Coordinates")[1],e=new Gu([NaN,NaN]),Hu(e,a,b,"XY"),c[d].Rc(e));vh(this.Me.v(),c[d]);nw(this,c[d]);pw(c[d]);var g=this;c[d].on("change",function(){aOverlays=
C.g().F.Pc;for(var a=aOverlays.L().length-1;0<=a;a--)aOverlays.L()[a].get("feature")===this&&aOverlays.L()[a].setPosition(g.gi(this.l()));g.Li(this)},c[d])}};V.prototype.ba.prototype.addFeatures=V.prototype.ba.prototype.Hh;
V.prototype.ba.prototype.ps=function(a){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.prototype.removeFeatures");for(var b=a.length-1;0<=b;b--){aOverlays=C.g().F.Pc.L();aDrawsToDelete=[];for(var c=aOverlays.length-1;0<=c;c--)aOverlays[c].get("feature")!==a[b]&&"info"!==aOverlays[c].get("feature")||aDrawsToDelete.push(aOverlays[c]);for(c=aDrawsToDelete.length-1;0<=c;c--)C.g().F.Pc.remove(aDrawsToDelete[c]);zh(this.Me.v(),a[b]);ow()}a=this.zd.L();for(b=0;b<a.length;b++)a[b].set("Id",
b)};V.prototype.ba.prototype.removeFeatures=V.prototype.ba.prototype.ps;
V.prototype.ba.prototype.To=function(a){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.prototype.removeFeaturesWithControl");var b=0,c=[],d=[],e=this,f="",g=H(this.H).Da(),h=H(this.H).df();1===a.length&&this.Om(a[0]);for(var l=0;l<a.length;l++)for(key in b=0,d.push(a[l].get("Id")),a[l].get("infoValues"))0===b&&c.push(a[l].get("infoValues")[key]),b++;b="";if(1===c.length)b="<h4>Etes-vous certain de vouloir supprimer le dessin: <br><br> Id: "+d[0]+", Nom: "+c[0]+" ?</h4>";else if(1<
c.length){for(l=0;l<c.length;l++)f+="<br> Id: "+d[l]+", Nom: "+c[l]+"";b="<h4>Etes-vous certain de vouloir supprimer les dessins ci-dessous ? <br>"+f+" </h4>"}else return;bootbox.confirm(b,function(b){!0===b&&e.ps(a);H(e.H).ib(g);H(e.H).mh(h)})};V.prototype.ba.prototype.removeFeaturesWithControl=V.prototype.ba.prototype.To;
V.prototype.ba.prototype.oG=function(){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.removeSelectedFeatures");for(var a=$.map($("#draw-features-list-table").bootstrapTable("getSelections"),function(a){return a.column1}),b=[],c=this.zd.L(),d=0;d<a.length;d++)b.push(c[a[d]]);this.To(b)};V.prototype.ba.prototype.removeSelectedFeatures=V.prototype.ba.prototype.oG;
V.prototype.ba.prototype.MA=function(a){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.prototype.calcelEditFeature");void 0===a.get("infoValues")&&this.ps([a]);ow()};V.prototype.ba.prototype.calcelEditFeature=V.prototype.ba.prototype.MA;
function pw(a){if(void 0!==a.get("infoValues")){var b=a.get("infoValues").Fill,c=a.get("infoValues").Stroke,d=a.get("infoValues").StrokeSize,e;"false"===a.get("infoValues").ShowVector&&(c=b="rgba(255, 255, 255, 0)");""===b||void 0===b?(b="rgba(54,184,255,0.6)",e="rgba(255,255,255,1)"):e=b;if(""===c||void 0===c)c="rgba(255,255,255,1)";if(""===d||void 0===d)d=2;a.Qe(new yg({fill:new ug({color:b}),stroke:new wg({color:c,width:d}),Gb:new xg({xc:7,fill:new ug({color:e}),stroke:new wg({color:c,width:d})})}))}}
V.prototype.ba.prototype.Li=function(a){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.setInfosToFeature");if(void 0===a.get("Id")){var b=this.zd.Lc();a.set("Id",b)}a.set(this.fields_[0].name,"");if(a.l()instanceof ok)a.set("Type","Point"),a.set("P\u00e9rim\u00e8tre/longueur","-"),a.set("Superficie","-"),a.set("Coordinates",a.l().da());else if(a.l()instanceof tp)a.set("Type","Ligne"),a.set("P\u00e9rim\u00e8tre/longueur",this.bf(a.l())),a.set("Superficie","-"),a.set("Coordinates",
a.l().da());else if(a.l()instanceof wk)a.set("Type","Polygone"),a.set("P\u00e9rim\u00e8tre/longueur",this.Oq(a.l())),a.set("Superficie",this.Cn(a.l())),a.set("Coordinates",a.l().da());else if(a.l()instanceof Gu){var c=parseFloat(this.rj(a.l())),b=this.rj(a.l()).replace(c,""),d=Math.PI*c*2,c=Math.PI*Math.pow(c,2);a.set("Type","Cercle");a.set("P\u00e9rim\u00e8tre/longueur",d.toFixed(4)+b);a.set("Superficie",c.toFixed(4)+b+"\u00b2");a.set("Coordinates",[a.l().Da(),a.l().jl()])}else a.set("Type","undefined"),
a.set("P\u00e9rim\u00e8tre/longueur","-"),a.set("Superficie","-")};V.prototype.ba.prototype.setInfosToFeature=V.prototype.ba.prototype.Li;
V.prototype.ba.prototype.sI=function(a,b){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.prototype.updateFeatureInfos");$(".modal").modal("hide");for(var c={},d=C.g().F.Pc,e,f,g,h,l,n,r,t,v=0;v<this.fields_.length;v++)"Fill"===this.fields_[v].id?e=$("#print-"+b[v].id+"-input").val():"Stroke"===this.fields_[v].id?f=$("#print-"+b[v].id+"-input").val():"Text"===this.fields_[v].id?g=$("#print-"+b[v].id+"-input").val():"TextBackground"===this.fields_[v].id?h=$("#print-"+b[v].id+"-input").val():
"TextSize"===this.fields_[v].id?l=$("#print-"+b[v].id+"-input").val():"StrokeSize"===this.fields_[v].id?n=$("#print-"+b[v].id+"-input").val():"ShowName"===this.fields_[v].id?(r=$("#print-"+b[v].id+"-input")[0].checked,$("#print-"+b[v].id+"-input").val(r)):"ShowVector"===this.fields_[v].id&&(t=$("#print-"+b[v].id+"-input")[0].checked,$("#print-"+b[v].id+"-input").val(t));!1===t&&(f=e="rgba(255, 255, 255, 0)",r=!1);""===e?(e="rgba(54,184,255,0.6)",t="rgba(255,255,255,1)"):t=e;""===f&&(f="rgba(255,255,255,1)");
""===n&&(n=2);a.Qe(new yg({fill:new ug({color:e}),stroke:new wg({color:f,width:parseFloat(n)}),Gb:new xg({xc:7,fill:new ug({color:t}),stroke:new wg({color:f,width:parseFloat(n)})})}));for(v=d.L().length-1;0<=v;v--)d.L()[v].get("feature")===a&&d.remove(d.L()[v]);mw(this,a);for(v=0;v<b.length;v++)0===v&&(this.ac.innerHTML=$("#print-"+b[v].id+"-input").val(),a.set(b[v].name,$("#print-"+b[v].id+"-input").val())),c[b[v].id]=$("#print-"+b[v].id+"-input").val();a.set("infoValues",c);this.Yh.setPosition(this.gi(a.l()));
this.ac.className="draw-tooltip draw-tooltip-static";Xo(this.Yh,[0,-7]);this.ac.style.color=g;this.ac.style.backgroundColor=h;this.ac.style.fontSize=l;!1===r&&(this.ac.style.opacity=0);this.ac=null;mw(this,a);this.kk();ow();C.log("updateFeatureInfos done")};V.prototype.ba.prototype.updateFeatureInfos=V.prototype.ba.prototype.sI;k=V.prototype.ba.prototype;
k.bf=function(a){this.ai.checked&&"EPSG:3857"==H(this.H).D().M||"EPSG:4326"==H(this.H).D().M?(a=a.da(),a=this.Hk(a)):a=a.Lc();return 1E3<a?Math.round(a/1E3*100)/100+" km":Math.round(100*a)/100+" m"};k.Hk=function(a){length=0;for(var b=H(this.H).D(),c=0,d=a.length-1;c<d;++c){var e=Kf(a[c],b,"EPSG:4326"),f=Kf(a[c+1],b,"EPSG:4326");length+=pf(this.Nm,e,f)}return length};k.Ov=function(a){return output=[a.da()[0].toFixed(4),a.da()[1].toFixed(4)]};
k.rj=function(a){this.ai.checked&&"EPSG:3857"==H(this.H).D().M||"EPSG:4326"==H(this.H).D().M?(a=[ak(a),bk(a)],a=this.Hk(a)):a=Math.round(100*a.jl())/100;return 1E3<a?Math.round(a/1E3*100)/100+" km":Math.round(100*a)/100+" m"};k.Oq=function(a){a=new tp(a.da()[0],a.Ha);return output=this.bf(a)};
k.Cn=function(a){if(this.ai.checked&&"EPSG:3857"==H(this.H).D().M||"EPSG:4326"==H(this.H).D().M){var b=H(this.H).D();a=Ak(a.clone().transform(b,"EPSG:4326")).da();a=Math.abs(of(this.Nm,a))}else a=a.uj();return 1E6<a?Math.round(a/1E6*100)/100+" km\u00b2":Math.round(100*a)/100+" m\u00b2"};
k.Om=function(a){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.zoomToFeature");"Point"===a.get("Type")?H(this.H).ib(a.l().da()):"Cercle"===a.get("Type")?(Lk(H(this.H),a.l(),[400,400],{padding:[0,0,0,0]}),H(this.H).ib(a.l().Da())):Lk(H(this.H),a.l(),[800,800],{padding:[0,0,0,0]})};V.prototype.ba.prototype.zoomToFeature=V.prototype.ba.prototype.Om;
function qw(a){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.initExportFeatureButtons");var b=a.zd.L(),c=a.exportFormats_;a=a.exportFormatsConstructors_;for(var d=H(C.g().F).D().M,e="",f=0;f<c.length;f++)for(f=0;f<a.length;f++){var g=new a[f];try{e=g.Ip(b,{Ce:d,Fe:d});e=e.replace(/{/g,"{\n");e=e.replace(/}/g,"\n}");if(0==$("#draw-export-"+c[f]+"-button").length){var h=document.createElement("li"),l=document.createElement("a");l.setAttribute("id","draw-export-"+c[f]+"-button");
l.setAttribute("download","Features.json");h.appendChild(l);l.appendChild(document.createTextNode(c[f]));$("#draw-features-list-table").parents(".bootstrap-table").find(".export").find("ul")[0].appendChild(h)}$("#draw-export-"+c[f]+"-button").attr("href","data:text/csv;charset=utf-8,"+encodeURIComponent(e))}catch(n){}}}
V.prototype.ba.prototype.Eq=function(a){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.displayFeatureInfos");this.selectedFeature=a;for(var b=[],c=0;c<this.fields_.length;c++)b.push({field:this.fields_[c].name,result:a.get("infoValues")[this.fields_[c].id]});$("#draw-feature-description-table").bootstrapTable({columns:[{field:"field",title:"",sortable:!0,cellStyle:function(){return{classes:"active bold"}}},{field:"result",title:"",sortable:!0}],data:b,search:!0,showHeader:!1,
showExport:"true",height:.6*$("#feature-description-modal").height(),rowStyle:function(){return{classes:["active","success"]}}});$("#draw-feature-description-table").bootstrapTable("load",b);$(".modal").modal("hide");$("#feature-description-modal").modal("show")};V.prototype.ba.prototype.displayFeatureInfos=V.prototype.ba.prototype.Eq;
V.prototype.ba.prototype.vn=function(a){function b(a){$("#print-"+c.fields_[a].id+"-input").colorpicker({format:"rgba",color:$("#print-"+c.fields_[a].id+"-input").val()}).on("changeColor",function(){$(this).parent().find(".color-span2").css("background-color",$(this).val())});$("#print-"+c.fields_[a].id+"-input").parent().find(".color-span2").css("background-color",$("#print-"+c.fields_[a].id+"-input").val())}C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.editFeatureInfos");
for(var c=this,d=0;d<this.fields_.length;d++)void 0!=a.get("infoValues")?($("#print-"+this.fields_[d].id+"-input").val(a.get("infoValues")[this.fields_[d].id]),"color"==this.fields_[d].type?b(d):"boolean"==this.fields_[d].type&&("false"==a.get("infoValues")[this.fields_[d].id]?$("#print-"+this.fields_[d].id+"-input").bootstrapToggle("off"):$("#print-"+this.fields_[d].id+"-input").bootstrapToggle("on"))):void 0!=this.fields_[d].value?($("#print-"+this.fields_[d].id+"-input").val(this.fields_[d].value),
"color"==this.fields_[d].type?b(d):"boolean"==this.fields_[d].type&&("false"==[this.fields_[d].value]?$("#print-"+this.fields_[d].id+"-input").bootstrapToggle("off"):$("#print-"+this.fields_[d].id+"-input").bootstrapToggle("on"))):($("#print-"+this.fields_[d].id+"-input").val(""),"boolean"==this.fields_[d].type&&$("#print-"+this.fields_[d].id+"-input").bootstrapToggle("on"),$(".colorpicker").colorpicker({format:"rgba"}).on("changeColor",function(){$(this).parent().find(".color-span2").css("background-color",
$(this).val())}));this.selectedFeature=a;$(".modal").modal("hide");$("#feature-edit-modal").modal("show");$(".bootstrap-toggle").bootstrapToggle()};V.prototype.ba.prototype.editFeatureInfos=V.prototype.ba.prototype.vn;
V.prototype.ba.prototype.oB=function(){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.displayFeaturesList");var a=this,b=this.zd.L(),c=[];this.sketchesLenght=b.length;if(0===b.length)$(".modal").modal("hide"),$("#draw-features-list-modal").modal("show"),$("#draw-features-list-table").bootstrapTable("load",[]);else{for(var d=b[0].Ld(),e=[{field:"state",checkbox:!0},{field:"action",formatter:function(){return'<a class="show-feature margin-sides-5" href="javascript:void(0)" title="Voir"><i class="glyphicon glyphicon-search"></i></a><a class="edit-feature margin-sides-5" href="javascript:void(0)" title="Editer"><i class="glyphicon glyphicon-edit"></i></a><a class="zoom-to-feature margin-sides-5" href="javascript:void(0)" title="Voir sur la carte"><i class="glyphicon glyphicon-globe"></i></a><a class="remove-feature margin-sides-5" href="javascript:void(0)" title="Supprimer"><i class="glyphicon glyphicon-trash"></i></a>'},
events:{"click .show-feature":function(c,d,e){a.Eq(b[e.column1])},"click .edit-feature":function(c,d,e){a.vn(b[e.column1])},"click .zoom-to-feature":function(c,d,e){$(".modal").modal("hide");a.Om(b[e.column1])},"click .remove-feature":function(c,d,e){$(".modal").modal("hide");a.To([b[e.column1]])}},"class":"draw-features-list-button-column"}],c=[],f=0;f<b.length;f++){for(var g={},h=0;h<d.length;h++)"geometry"!==d[h]&&"infoValues"!==d[h]&&"tooltip"!==d[h]&&"infoKeys"!==d[h]&&(0===f&&("Coordinates"!==
d[h]?e.push({field:"column"+h,title:d[h],sortable:!0}):e.push({field:"column"+h,title:d[h],sortable:!0,visible:!1})),g["column"+h]=b[f].get(d[h]));c.push(g);delete g}$("#draw-features-list-table").bootstrapTable({columns:e,data:c,search:!0,showColumns:!0,showExport:"true",height:.6*$("#feature-description-modal").height(),rowStyle:function(){return{classes:["active","success"]}}});$("#draw-features-list-table").bootstrapTable("load",c);$(".modal").modal("hide");$("#draw-features-list-modal").modal("show");
qw(this)}};V.prototype.ba.prototype.displayFeaturesList=V.prototype.ba.prototype.oB;V.prototype.ba.prototype.kk=function(){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.showHideAnotations");document.getElementById("draw-anotations").checked?$(".draw-tooltip-static").show():$(".draw-tooltip-static").hide()};V.prototype.ba.prototype.showHideAnotations=V.prototype.ba.prototype.kk;
V.prototype.ba.prototype.Dg=function(a){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.drawPoint");ow();a||this.Ub("Point")};V.prototype.ba.prototype.drawPoint=V.prototype.ba.prototype.Dg;V.prototype.ba.prototype.HB=function(a){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.drawLine");ow();a||this.Ub("LineString")};V.prototype.ba.prototype.drawLine=V.prototype.ba.prototype.HB;
V.prototype.ba.prototype.un=function(a){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.drawPolygon");ow();a||this.Ub("Polygon")};V.prototype.ba.prototype.drawPolygon=V.prototype.ba.prototype.un;V.prototype.ba.prototype.tn=function(a){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.drawCircle");ow();a||this.Ub("Circle")};V.prototype.ba.prototype.drawCircle=V.prototype.ba.prototype.tn;
V.prototype.ba.prototype.Or=function(a){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.modifyFeature");ow();a||(C.g().sa.za("Cliquez sur un dessin pour le modifier"),Qo(C.g(),this.Vg,"draw-modifyFeature"))};V.prototype.ba.prototype.modifyFeature=V.prototype.ba.prototype.Or;
V.prototype.ba.prototype.JB=function(a){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.modifyFeature");ow();a||(C.g().sa.za("Cliquez sur un dessin pour \u00e9diter les infos"),Qo(C.g(),this.wn,"draw-editInfosFeature"))};V.prototype.ba.prototype.editInfosClick=V.prototype.ba.prototype.JB;
V.prototype.ba.prototype.hH=function(a){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.showInfosClick");ow();a||(C.g().sa.za("Cliquez sur un dessin pour voir les infos"),Qo(C.g(),this.fp,"showInfosFeature"))};V.prototype.ba.prototype.showInfosClick=V.prototype.ba.prototype.hH;
V.prototype.ba.prototype.Bq=function(a){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.deleteFeature");ow();a||(C.g().sa.za("Cliquez sur un dessin pour le supprimer"),Qo(C.g(),this.rc,"draw-deleteFeature"))};V.prototype.ba.prototype.deleteFeature=V.prototype.ba.prototype.Bq;
V.prototype.ba.prototype.Aq=function(){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.deleteAllFeatures");ow();this.zd.clear();for(var a=C.g().F.Pc.L(),b=[],c=a.length-1;0<=c;c--)"draw"===a[c].get("type")&&b.push(a[c]);for(c=b.length-1;0<=c;c--)C.g().F.Pc.remove(b[c]);aFeatures=this.zd.L();for(c=0;c<aFeatures.length;c++)aFeatures[c].set("Id",c)};V.prototype.ba.prototype.deleteAllFeatures=V.prototype.ba.prototype.Aq;
function ow(){C.log("nsVmap.nsToolsManager.nsModules.Draw.prototype.drawController.removeDrawsInteractions");C.g().sa.hide();C.g().re()}C.module.directive("appDraw",V.prototype.GB);C.module.controller("AppdrawController",V.prototype.ba);V.prototype.Wv=function(){return this.fields_};V.prototype.getFields=V.prototype.Wv;V.prototype.RG=function(a){this.fields_=a};V.prototype.setFields=V.prototype.RG;V.prototype.Ka=function(){return this.features_};V.prototype.getFeatures=V.prototype.Ka;
V.prototype.QG=function(a){this.features_=a};V.prototype.setFeatures=V.prototype.QG;function W(){C.log("nsVmap.nsToolsManager.nsModules.Cadastre")}ta("nsVmap.nsToolsManager.nsModules.Cadastre",W);xu.Pl.Cadastre=W;W.prototype.CH=function(a){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.tableCheckAll");$(a).bootstrapTable("checkAll");$(a).bootstrapTable("toggleView");$(a).bootstrapTable("toggleView")};W.prototype.tableCheckAll=W.prototype.CH;
W.prototype.EH=function(a){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.tableCheckAll");$(a).bootstrapTable("uncheckAll");$(a).bootstrapTable("toggleView");$(a).bootstrapTable("toggleView")};W.prototype.tableUncheckAll=W.prototype.EH;
W.prototype.LA=function(){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreDirective");return{restrict:"C",scope:{map:"=appMap",lang:"=appLang",selection:"=appInfos",currentAction:"=appAction"},controller:"AppcadastreController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/modules/cadastre.html"}};
W.prototype.j=function(a,b){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController");C.bz();this.Rg=100;null!=C.properties.cadastre&&null!=C.properties.cadastre.selection_limit&&(this.Rg=C.properties.cadastre.selection_limit);this.tmpID_DNUPRO=this.tmpID_PAR=this.searchOnMapCurrentDrawMode=this.searchOnMapCurrentMode=this.currentParcelleMode=this.currentMode="";this.V=a;this.f=b;this.oParcelleInfos={};this.aCommunes=[];this.aSections=[];this.aAdresses=[];this.locationMultiple=
!1;this.pa=[];this.Ue=0;this.Nu=C.properties.cadastre.database_projection;this.cadastreAPI_=C.properties.cadastre.api;this.Qv(C.properties.cadastre.api+"/communes","aCommunes","","nom");$("#Section-table-section").bootstrapTable({data:{}});$("#Lieu-dit-table-lieu-dit").bootstrapTable({data:{}});$("#Parcelle-table-parcelle").bootstrapTable({data:{}});$("#Parcelle-par-proprietaire-table-comptes").bootstrapTable({data:{}});$("#Parcelle-par-proprietaire-table-parcelles").bootstrapTable({data:{}});$("#Bati-par-proprietaire-table-comptes").bootstrapTable({data:{}});
$("#Bati-par-proprietaire-table-invariants").bootstrapTable({data:{}});$("#Bati-par-proprietaire-table-parcelles").bootstrapTable({data:{}});$(".dropdown-menu-auto li a").click(function(){var a=$(this).text();$(this).parents(".btn-group").find(".dropdown-toggle").find("div").html(a);$(".inactive").removeClass("active")});b.parseFloat=function(a){return parseFloat(a)};b.trim=function(a){return a.trim()}};W.prototype.cadastreController=W.prototype.j;W.prototype.j.$inject=["$http","$scope"];
W.prototype.j.prototype.ae=function(a){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addToCard");C.log("addToCard: "+a);$("body").css({cursor:"wait"});var b=this;setTimeout(function(){"commune"===a?b.ty("#Commune-select-commune"):"section"===a?b.yy("#Section-select-commune","#Section-table-section"):"lieuDit"===a?b.uy("#Lieu-dit-select-commune","#Lieu-dit-table-lieu-dit"):"parcelle"===a?(C.log("addToCard: "+b.currentParcelleMode),"section"===b.currentParcelleMode?
b.xy("#Parcelle-select-commune","#Parcelle-select-section","#Parcelle-table-parcelle"):"adresse"===b.currentParcelleMode?b.vy("#Parcelle-par-adresse-DGFiP-select-commune","#Parcelle-par-adresse-DGFiP-table-voie","#Parcelle-par-adresse-DGFiP-select-adresse"):"proprietaire"===b.currentParcelleMode&&b.wy("#Parcelle-par-proprietaire-select-commune","#Parcelle-par-proprietaire-table-proprietaire","#Parcelle-par-proprietaire-table-comptes","#Parcelle-par-proprietaire-table-parcelles")):"bati"===a&&b.sy("#Bati-par-proprietaire-select-commune",
"#Bati-par-proprietaire-table-proprietaire","#Bati-par-proprietaire-table-comptes","#Bati-par-proprietaire-table-invariants","#Bati-par-proprietaire-table-parcelles")},100)};W.prototype.j.prototype.addToCard=W.prototype.j.prototype.ae;
W.prototype.j.prototype.rE=function(a){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.locateSelection");"commune"===a?this.Kr(C.properties.cadastre.api+"/communes","id_com","#Commune-select-commune"):"section"===a?this.Kj(C.properties.cadastre.api+"/sections","id_sec","#Section-table-section"):"lieuDit"===a?this.Kj(C.properties.cadastre.api+"/lieudits","oid","#Lieu-dit-table-lieu-dit"):"parcelle"===a?(C.log(this.currentParcelleMode),"section"===this.currentParcelleMode?
this.Kj(C.properties.cadastre.api+"/parcelles","id_par","#Parcelle-table-parcelle"):"adresse"===this.currentParcelleMode?(C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.localiseParcelleByAdresse"),""!==$("#Parcelle-par-adresse-DGFiP-select-adresse").val()?this.Kr(C.properties.cadastre.api+"/parcelles","id_par","#Parcelle-par-adresse-DGFiP-select-adresse"):0<$("#Parcelle-par-adresse-DGFiP-table-voie").bootstrapTable("getAllSelections").length&&this.Sw(C.properties.cadastre.api+
"/parcelles","id_par",this.aAdresses,"ID_PAR")):"proprietaire"===this.currentParcelleMode&&this.Kj(C.properties.cadastre.api+"/parcelles","id_par","#Parcelle-par-proprietaire-table-parcelles","ID_PAR")):"bati"===a&&this.Kj(C.properties.cadastre.api+"/parcelles","id_par","#Bati-par-proprietaire-table-parcelles")};W.prototype.j.prototype.locateSelection=W.prototype.j.prototype.rE;
W.prototype.j.prototype.JG=function(){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectLocation");for(var a=C.g().Xg.L(),b="",c={commune:[],section:[],lieuDit:[],parcelle:[],bati:[]},d=0;d<a.length;d++)b=a[d].get("type"),c[b].push(a[d]);for(var e in c)if(0<c[e].length){for(d=0;d<c[e].length;d++)c[e][d]=c[e][d].get("infos");"commune"===e?(void 0===C.B.K.ya("veremes_cadastre_commune")&&C.B.K.Ga({va:"veremes_cadastre_commune",Va:"Commune",ta:["zoom","delete"]}),
this.Gf(C.properties.cadastre.api+"/communes","id_com",c[e],"id_com","veremes_cadastre_commune",function(){C.B.K.ve();C.B.K.De("veremes_cadastre_commune")})):"section"===e?(void 0===C.B.K.ya("veremes_cadastre_section")&&C.B.K.Ga({va:"veremes_cadastre_section",Va:"Section",ta:["zoom","delete"]}),this.Gf(C.properties.cadastre.api+"/sections","id_sec",c[e],"id_sec","veremes_cadastre_section",function(){C.B.K.ve();C.B.K.De("veremes_cadastre_section")})):"lieuDit"===e?(void 0===C.B.K.ya("veremes_cadastre_lieu_dit")&&
C.B.K.Ga({va:"veremes_cadastre_lieu_dit",Va:"Lieu-dit",ta:["zoom","delete"]}),this.Gf(C.properties.cadastre.api+"/lieudits","oid",c[e],"oid","veremes_cadastre_lieu_dit",function(){C.B.K.ve();C.B.K.De("veremes_cadastre_lieu_dit")})):"parcelle"===e?(void 0===C.B.K.ya("veremes_cadastre_parcelle")&&C.B.K.Ga({va:"veremes_cadastre_parcelle",Va:"Parcelle",ta:["zoom","delete"]}),this.Gf(C.properties.cadastre.api+"/parcelles","id_par",c[e],"id_par","veremes_cadastre_parcelle",function(){C.B.K.ve();C.B.K.De("veremes_cadastre_parcelle")})):
"bati"===e&&(void 0===C.B.K.ya("veremes_cadastre_parcelle")&&C.B.K.Ga({va:"veremes_cadastre_parcelle",Va:"Parcelle",ta:["zoom","delete"]}),void 0===C.B.K.ya("veremes_cadastre_invariant")&&C.B.K.Ga({va:"veremes_cadastre_invariant",Va:"Invariant",ta:["delete"]}),this.Gf(C.properties.cadastre.api+"/invariants","ID_PAR",c[e],"id_par","veremes_cadastre_invariant",function(){C.B.K.ve();C.B.K.De("veremes_cadastre_invariant");C.B.K.Hd("veremes_cadastre_invariant")}),this.Gf(C.properties.cadastre.api+"/parcelles",
"id_par",c[e],"id_par","veremes_cadastre_parcelle",function(){C.B.K.ve();C.B.K.De("veremes_cadastre_parcelle");C.B.K.Hd("veremes_cadastre_invariant")}))}};W.prototype.j.prototype.selectLocation=W.prototype.j.prototype.JG;
W.prototype.j.prototype.Tw=function(a,b){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.locateCadastreOnMap");rw();if(b||""===this.searchOnMapCurrentMode)return 0;"Point"===a?(C.g().sa.za("Cliquer sur un point pour s\u00e9lectionner"),C.g().gk("singleclick",this.pE,this,"cadastre-selectBy"+a)):"LineString"===a?(C.g().sa.za("Dessiner une ligne pour s\u00e9lectionner"),sw(this,"LineString")):"Polygon"===a?(C.g().sa.za("Dessiner un polygone pour s\u00e9lectionner"),
sw(this,"Polygon")):"Circle"===a&&(C.g().sa.za("Dessiner un cercle pour s\u00e9lectionner"),sw(this,"Circle"))};W.prototype.j.prototype.locateCadastreOnMap=W.prototype.j.prototype.Tw;
W.prototype.j.prototype.HG=function(a,b){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectCadastreOnMap");rw();if(b)return 0;"FicheDescriptive"===a&&(this.searchOnMapCurrentMode="FicheDescriptive",C.g().sa.za("Cliquer sur un point pour g\u00e9n\u00e9rer la fiche descriptive"),C.g().gk("singleclick",function(a){$("body").css({cursor:"wait"});tw(this,a,"ficheDescriptive")},this,"cadastre-"+a));"ReleveDePropriete"===a&&(this.searchOnMapCurrentMode="ReleveDePropriete",
C.g().sa.za("Cliquer sur un point pour g\u00e9n\u00e9rer le relev\u00e9 de propri\u00e9t\u00e9"),C.g().gk("singleclick",function(a){$("body").css({cursor:"wait"});tw(this,a,"releveDePropriete")},this,"cadastre-"+a));"FicheUrbanisme"===a&&(this.searchOnMapCurrentMode="FicheUrbanisme",C.g().sa.za("Cliquer sur un point pour g\u00e9n\u00e9rer la fiche d'urbanisme"),C.g().gk("singleclick",function(a){$("body").css({cursor:"wait"});tw(this,a,"ficheUrbanisme")},this,"cadastre-"+a))};
W.prototype.j.prototype.selectCadastreOnMap=W.prototype.j.prototype.HG;
function tw(a,b,c){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectRapportOnMap");$("body").css({cursor:"wait"});var d=new ok(b.zb),d=C.Of(d);a.tmpID_PAR="";a.tmpID_DNUPRO="";a.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:C.properties.api_url+"/"+C.properties.cadastre.api+"/parcelles",params:{token:C.properties.token,filter:"ST_Intersects(ST_Transform(ST_GeomFromEWKT('"+d+"'), "+a.Nu.substring(5)+"), geom)",limit:a.Rg,result_srid:H(C.g().F).D().M.substring(5)}}).then(function(d){$("body").css({cursor:""});
if(m(d.data.errorMessage))return console.error(d.data.errorMessage),0;if(500===d.status)return $.notify("Une erreur est survenue au sein du serveur","error"),0;C.g().Km.clear();if(!m(d.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),C.g().Tm("Pas de donn\u00e9es \u00e0 afficher",b.zb),0;d=d.data.data;d.length>=a.Rg&&bootbox.alert("<h4>Attention, vous avez atteint la limite d'objects affichables sur la carte</h4>");var e=d[0].id_par;a.tmpID_PAR=e;!1===a.locationMultiple&&C.g().Xg.clear();
a.ej(d,"parcelle",!1);"ficheDescriptive"===c&&a.Fq(e);"releveDePropriete"===c&&$("#releve-propriete-modal-menu").modal("show");"ficheUrbanisme"===c&&a.Gq(e);a.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:C.properties.api_url+"/"+C.properties.cadastre.api+"/descriptionparcelles",params:{token:C.properties.token,filter:'"'+("cadastre"===a.cadastreAPI_?"ID_PAR":"id_par")+"\"='"+e+"'",limit:a.Rg,result_srid:H(C.g().F).D().M.substring(5)}}).then(function(b){$("body").css({cursor:""});
if(m(b.data.errorMessage))return console.error(b.data.errorMessage),0;if(500===b.status)return $.notify("Une erreur est survenue au sein du serveur","error"),0;if(!m(b.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;b=b.data.data;b.length>=a.Rg&&$.notify("Attention, vous avez atteint la limite d'objects affichables sur la carte","warn");a.tmpID_DNUPRO=b[0].ID_DNUPRO},function(a){console.error(a);$("body").css({cursor:""})})},function(a){$("body").css({cursor:""});console.error(a)})}
function uw(a,b,c,d){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.locateByWKTGeom");$("body").css({cursor:"wait"});var e="";a.pa.length=0;a.Ue=0;b="ST_Intersects(ST_Transform(ST_GeomFromEWKT('"+b+"'), "+a.Nu.substring(5)+"), geom)";if("commune"===c)e="communes";else if("section"===c)e="sections";else if("lieuDit"===c)e="lieudits";else if("parcelle"===c)e="parcelles";else if("bati"===c)e="parcelles";else return;a.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},
url:C.properties.api_url+"/"+C.properties.cadastre.api+"/"+e,params:{token:C.properties.token,filter:b,limit:a.Rg,result_srid:H(C.g().F).D().M.substring(5)}}).then(function(b){$("body").css({cursor:""});if(m(b.data.errorMessage))return console.error(b.data.errorMessage),0;if(500===b.status)return $.notify("Une erreur est survenue au sein du serveur","error"),0;C.g().Km.clear();if(!m(b.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),C.g().Tm("Pas de donn\u00e9es \u00e0 afficher",
d),0;b=b.data.data;b.length>=a.Rg&&$.notify("Attention, vous avez atteint la limite d'objects affichables sur la carte","warn");!1===a.locationMultiple&&C.g().Xg.clear();a.ej(b,c,!1)},function(a){$("body").css({cursor:""});console.error(a)})}W.prototype.j.prototype.pE=function(a){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.locateByPoint");var b=new ok(a.zb),b=C.Of(b);uw(this,b,this.searchOnMapCurrentMode,a.zb)};
function sw(a,b){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.locateByDrawing");a.ic=C.g().gg({type:b},"cadastre-selectBy"+b);a.ic.on("drawend",function(a){var b=C.Of(a.wa.l());uw(this,b,this.searchOnMapCurrentMode,bk(a.wa.l()))},a)}
W.prototype.j.prototype.FG=function(a){if(this.searchOnMapCurrentMode===a)return this.searchOnMapCurrentMode="","cadastre-selectByPoint"!==this.currentAction&&"cadastre-selectByLineString"===this.currentAction&&"cadastre-selectByPolygon"===this.currentAction||C.g().$j(),0;this.searchOnMapCurrentMode=a;"cadastre-selectByLineString"!==this.currentAction&&"cadastre-selectByPolygon"!==this.currentAction&&"cadastre-selectByPoint"!==this.xq&&this.Tw("Point","cadastre-selectByPoint"===this.xq)};
W.prototype.j.prototype.searchOnMapInit=W.prototype.j.prototype.FG;
W.prototype.j.prototype.UD=function(a){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.initRapportsBootstrapTables");void 0===$("#Cadastre-rapports-table-parcelle").bootstrapTable("getOptions").dataType&&$(a).find('[data-toggle="table"]').bootstrapTable({});$(a).find('[data-toggle="table"]').bootstrapTable("load",[]);if(0===this.selection.length)return kc(document.body,"click",function(){C.jv({target:"#cadastre-btn-container-actions-map-replace-card",type:"top-left"},
"Ajoutez d'abord des donn\u00e9es au panier")}),0;this.show_veremes_cadastre_compte=this.show_veremes_cadastre_parcelle=!1;for(var b=0;b<this.selection.length;b++)"veremes_cadastre_parcelle"===this.selection[b].tabCode&&(C.log(this.selection[b].tableParams.data),this.show_veremes_cadastre_parcelle=!0,$(a).find("#Cadastre-rapports-table-parcelle").bootstrapTable("load",this.selection[b].tableParams.data)),"veremes_cadastre_compte"===this.selection[b].tabCode&&(this.show_veremes_cadastre_compte=!0,
$(a).find("#Cadastre-rapports-table-comptes").bootstrapTable("load",this.selection[b].tableParams.data));this.show_veremes_cadastre_parcelle||this.show_veremes_cadastre_compte?$("#rapports-modal").modal("show"):$.notify("Aucun rapport disponible pour cette s\u00e9lection")};W.prototype.j.prototype.initRapportsBootstrapTables=W.prototype.j.prototype.UD;
W.prototype.j.prototype.tB=function(a){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayParcelleDescriptiveSheetByTable");a=$(a).bootstrapTable("getAllSelections");if(1!==a.length)return $.notify("Veuillez s\u00e9lectionner une unique parcelle","info"),0;this.Fq(a[0].id_par)};W.prototype.j.prototype.displayParcelleDescriptiveSheetByTable=W.prototype.j.prototype.tB;
W.prototype.j.prototype.Fq=function(a){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayParcelleDescriptiveSheet");$("body").css({cursor:"wait"});var b=this;a=C.properties.api_url+"/"+C.properties.cadastre.api+"/fichedescriptiveparcelle/"+a;var c={token:C.properties.token,result_srid:H(C.g().F).D().M.substring(5)};this.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:a,params:c}).then(function(a){if(m(a.data.errorMessage))return console.error(a.data.errorMessage),
0;if(500===a.status)return $.notify("Une erreur est survenue au sein du serveur","error"),0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;b.oParcelleInfos=a.data.data;b.iv()},function(a){console.error(a)})};W.prototype.j.prototype.displayParcelleDescriptiveSheet=W.prototype.j.prototype.Fq;
W.prototype.j.prototype.iv=function(){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayParcelleDescriptiveSheet2");$("body").css({cursor:""});var a=this.oParcelleInfos;a.sup_fiscale&&(a.sup_fiscale=parseFloat(a.sup_fiscale)+" m\u00b2");a.DCNTPA&&(a.DCNTPA=parseFloat(a.DCNTPA)+" m\u00b2");a.GPARBAT=""===a.GPARBAT||" "===a.GPARBAT||0===a.GPARBAT||null===a.GPARBAT?"N":"O";a.GURBPA="U"!==a.GURBPA?"N":"O";if(a.aProprietaires)for(var b=0;b<a.aProprietaires.length;b++)if(a.aProprietaires[b].accordSexe=
"(e)",a.aProprietaires[b].DQUALP=null!=a.aProprietaires[b].DQUALP?a.aProprietaires[b].DQUALP:"",a.aProprietaires[b].DQUALP&&(a.aProprietaires[b].DQUALP=a.aProprietaires[b].DQUALP.trim(),"M"===a.aProprietaires[b].DQUALP&&(a.aProprietaires[b].accordSexe=""),"MLE"===a.aProprietaires[b].DQUALP||"MME"===a.aProprietaires[b].DQUALP))a.aProprietaires[b].accordSexe="e";a.aSubdivisionFiscale&&(a.aSubdivisionFiscale.totalDcntsf=0);a.aSubdivisionFiscale.totalDrcsuba=0;for(b=a.aSubdivisionFiscale.totalDrcsub=
0;b<a.aSubdivisionFiscale.length;b++)null!=a.aSubdivisionFiscale[b].DCNTSF&&(a.aSubdivisionFiscale[b].DCNTSF=parseFloat(a.aSubdivisionFiscale[b].DCNTSF)+" m\u00b2"),null!=a.aSubdivisionFiscale[b].DRCSUBA&&(a.aSubdivisionFiscale[b].DRCSUBA=Math.pow(10,-2)*parseFloat(a.aSubdivisionFiscale[b].DRCSUBA)+" \u20ac"),null!=a.aSubdivisionFiscale[b].DRCSUB&&(a.aSubdivisionFiscale[b].DRCSUB=Math.pow(10,-2)*parseFloat(a.aSubdivisionFiscale[b].DRCSUB)+" \u20ac"),null!=a.aSubdivisionFiscale[b].DCNTSF&&(a.aSubdivisionFiscale.totalDcntsf+=
parseFloat(a.aSubdivisionFiscale[b].DCNTSF)),null!=a.aSubdivisionFiscale[b].DRCSUBA&&(a.aSubdivisionFiscale.totalDrcsuba+=parseFloat(a.aSubdivisionFiscale[b].DRCSUBA)),null!=a.aSubdivisionFiscale[b].DRCSUB&&(a.aSubdivisionFiscale.totalDrcsub+=parseFloat(a.aSubdivisionFiscale[b].DRCSUB));null!=a.aSubdivisionFiscale.totalDcntsf&&(a.aSubdivisionFiscale.totalDcntsf=parseFloat(a.aSubdivisionFiscale.totalDcntsf)+" m\u00b2");null!=a.aSubdivisionFiscale.totalDrcsuba&&(a.aSubdivisionFiscale.totalDrcsuba=parseFloat(a.aSubdivisionFiscale.totalDrcsuba)+
" \u20ac");null!=a.aSubdivisionFiscale.totalDrcsub&&(a.aSubdivisionFiscale.totalDrcsub=parseFloat(a.aSubdivisionFiscale.totalDrcsub)+" \u20ac");this.oParcelleInfos=a;$("#descriptive-parcelle-sheet-modal").modal("show")};W.prototype.j.prototype.displayParcelleDescriptiveSheet2=W.prototype.j.prototype.iv;
W.prototype.j.prototype.AB=function(a){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayUrbanismeSheetByTable");a=$(a).bootstrapTable("getAllSelections");if(1!==a.length)return $.notify("Veuillez s\u00e9lectionner une unique parcelle","info"),0;this.Gq(a[0].id_par)};W.prototype.j.prototype.displayUrbanismeSheetByTable=W.prototype.j.prototype.AB;
W.prototype.j.prototype.Gq=function(a){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayUrbanismeSheet");if(!m(a))return 0;var b=this;a=C.properties.api_url+"/"+C.properties.cadastre.api+"/ficheurbanisme/"+a;var c={token:C.properties.token,result_srid:H(C.g().F).D().M.substring(5)};this.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:a,params:c}).then(function(a){if(m(a.data.errorMessage))return console.error(a.data.errorMessage),0;if(500===
a.status)return $.notify("Une erreur est survenue au sein du serveur","error"),0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayUrbanismeSheet2");for(var c=[],d=0;m(a[d]);)a[d].CCOSEC=null!=a[d].CCOSEC?a[d].CCOSEC:"",a[d].DCNTPA=null!=a[d].DCNTPA?a[d].DCNTPA:"",a[d].DDENOM=null!=a[d].DDENOM?a[d].DDENOM:"",a[d].DLIGN3=null!=a[d].DLIGN3?a[d].DLIGN3:"",a[d].DLIGN4=
null!=a[d].DLIGN4?a[d].DLIGN4:"",a[d].DLIGN6=null!=a[d].DLIGN6?a[d].DLIGN6:"",a[d].DNUPLA=null!=a[d].DNUPLA?a[d].DNUPLA:"",a[d].ID_PAR=null!=a[d].ID_PAR?a[d].ID_PAR:"",a[d].LIBCOM=null!=a[d].LIBCOM?a[d].LIBCOM:"",a[d].LIBDEP=null!=a[d].LIBDEP?a[d].LIBDEP:"",a[d].ADRESSE=null!=a[d].ADRESSE?a[d].ADRESSE:"",a[d].NATURE=null!=a[d].DSGRPF?a[d].DSGRPF:"",c.push({nom:a[d].DDENOM.trim(),adresse:a[d].DLIGN3.trim()+a[d].DLIGN4.trim(),ville:a[d].DLIGN6.trim()}),d++;delete d;0===c.length&&($.notify("Pas d'information sur les propri\u00e9taires",
"error"),console.error("Pas d'information sur les propri\u00e9taires"));var g=new Date,d=g.getDate(),h=g.getMonth()+1,g=g.getFullYear();m(C.properties.cadastre.fiche_urb)||(C.properties.cadastre.fiche_urb={});c={logo:m(C.properties.cadastre.fiche_urb.logo)?C.properties.cadastre.fiche_urb.logo:"",company:m(C.properties.cadastre.fiche_urb.company)?C.properties.cadastre.fiche_urb.company:"",departement:m(a[0])?a[0].LIBDEP.trim():"",commune:m(a[0])?a[0].LIBCOM.trim():"",parcelle:m(a[0])?parseFloat(a[0].DNUPLA):
"",section:m(a[0])?a[0].CCOSEC.trim():"",contenance:m(a[0])?parseFloat(a[0].DCNTPA):"",adresse:m(a[0])?a[0].ADRESSE.trim():"",date:d+"/"+h+"/"+g,nature:m(a[0])?a[0].NATURE.trim():"",proprietaires:c,aIntersections:a.aIntersections,aIntersectionsArray:a.aIntersectionsArray};d=H(b.map).D().M;a=C.vj(a.geometry.geom,d);a=new Eg({geometry:a});null!=C.properties.cadastre.fiche_urb.printtemplate_id?null!=C.properties.cadastre.fiche_urb.map_id?C.B.vc.Cx.print({scope:c,Yy:C.properties.cadastre.fiche_urb.printtemplate_id,
bx:C.properties.cadastre.fiche_urb.map_id,features:[a],Cv:C.properties.cadastre.fiche_urb.features_zoom}):$.notify("properties.cadastre.fiche_urb.map_id undefined","error"):$.notify("properties.cadastre.fiche_urb.printtemplate_id undefined","error")},function(a){console.error(a)})};W.prototype.j.prototype.displayUrbanismeSheet=W.prototype.j.prototype.Gq;
W.prototype.j.prototype.sB=function(a){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayInvariantDescriptiveSheet");if(!m(a))return"id_bat undefined";$("body").css({cursor:"wait"});var b=this;a=C.properties.api_url+"/"+C.properties.cadastre.api+"/fichedescriptiveinvariant/"+a;var c={token:C.properties.token,jsonformat:"anonymous",result_srid:H(C.g().F).D().M.substring(5)};this.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:a,params:c}).then(function(a){if(m(a.data.errorMessage))return console.error(a.data.errorMessage),
0;if(500===a.status)return $.notify("Une erreur est survenue au sein du serveur","error"),0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;b.oInvariant=a.data.data;m(b.oInvariant)||console.error("oInvariant non d\u00e9fini");m(b.oInvariant.PEV)||console.error("oInvariant.PEV non d\u00e9fini");m(b.oInvariant.habitations)||console.error("oInvariant.habitations non d\u00e9fini");m(b.oInvariant.locauxPros)||console.error("oInvariant.locauxPros non d\u00e9fini");m(b.oInvariant.dependances)||
console.error("oInvariant.dependances non d\u00e9fini");m(b.oInvariant.proprietaires)||console.error("oInvariant.proprietaires non d\u00e9fini");m(b.oInvariant.lots)||console.error("oInvariant.lots non d\u00e9fini");$("body").css({cursor:""});for(a=0;a<b.oInvariant.proprietaires.length;a++){b.oInvariant.proprietaires[a].DLIGN4=null!=b.oInvariant.proprietaires[a].DLIGN4?b.oInvariant.proprietaires[a].DLIGN4:"";for(var c=b.oInvariant.proprietaires[a].DLIGN4.trim(),d=0;d<c.length;d++)"0"!==c.charAt(d)&&
(c=c.substring(d),d=c.length);b.oInvariant.proprietaires[a].DLIGN4=c}$("#descriptive-invariant-sheet-modal").modal("show")},function(a){console.error(a)})};W.prototype.j.prototype.displayInvariantDescriptiveSheet=W.prototype.j.prototype.sB;
function vw(a,b,c,d){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayReleveDeProprieteSheet");b={token:C.properties.token,type:b,result_srid:H(C.g().F).D().M.substring(5)};var e=C.properties.api_url+"/"+C.properties.cadastre.api+"/relevedepropriete";m(d)&&(b.ID_PAR=d);m(c)&&(b.IDDNUPRO=c);a.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:e,params:b}).then(function(b){$("body").css({cursor:""});if(m(b.data.error)&&m(b.data.error.errorMessage))return console.error(b.data.error.errorMessage),
$.notify(b.data.error.errorMessage,"error"),m(a.Ba)&&a.Ba.close(),a.Ba=window.open("","Relev\u00e9 de propri\u00e9t\u00e9 ","height=400,width=600"),a.Ba.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">'+b.data.error.errorMessage+"</div>"),0;if(500===b.status)return $.notify("Une erreur est survenue au sein du serveur","error"),m(a.Ba)&&a.Ba.close(),0;if(!m(b.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),m(a.Ba)&&a.Ba.close(),a.Ba=window.open("",
"Relev\u00e9 de propri\u00e9t\u00e9 ","height=400,width=600"),a.Ba.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">Pas de donn\u00e9es \u00e0 afficher</div>'),0;a.Ba.location.href=b.data.data.releveDePropriete+"&token="+C.properties.token},function(b){console.error(b);$.notify("Une erreur est survenue lors de la g\u00e9n\u00e9ration du rapport","error");m(a.Ba)&&a.Ba.close();$("body").css({cursor:""})})}
W.prototype.j.prototype.wB=function(a){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayReleveDeProprieteSheetTiers");a=$(a).bootstrapTable("getAllSelections");if(1!==a.length)return $.notify("Veuillez s\u00e9lectionner une unique parcelle","info"),0;m(this.Ba)&&this.Ba.close();this.Ba=window.open("","Relev\u00e9 de propri\u00e9t\u00e9 ","height=400,width=600");this.Ba.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>');
$("body").css({cursor:"wait"});vw(this,"parcelle","",a[0].id_par)};W.prototype.j.prototype.displayReleveDeProprieteSheetParcelle=W.prototype.j.prototype.wB;
W.prototype.j.prototype.xB=function(a){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayReleveDeProprieteSheetStandard");a=$(a).bootstrapTable("getAllSelections");if(1!==a.length)return $.notify("Veuillez s\u00e9lectionner un unique compte","info"),0;m(this.Ba)&&this.Ba.close();this.Ba=window.open("","Relev\u00e9 de propri\u00e9t\u00e9 ","height=400,width=600");this.Ba.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>');
$("body").css({cursor:"wait"});vw(this,"standard",a[0].ID_COM+a[0].DNUPRO)};W.prototype.j.prototype.displayReleveDeProprieteSheetStandard=W.prototype.j.prototype.xB;
W.prototype.j.prototype.yB=function(a){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayReleveDeProprieteSheetTiers");a=$(a).bootstrapTable("getAllSelections");if(1!==a.length)return $.notify("Veuillez s\u00e9lectionner un unique compte","info"),0;m(this.Ba)&&this.Ba.close();this.Ba=window.open("","Relev\u00e9 de propri\u00e9t\u00e9 ","height=400,width=600");this.Ba.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>');
$("body").css({cursor:"wait"});vw(this,"tiers",a[0].ID_COM+a[0].DNUPRO)};W.prototype.j.prototype.displayReleveDeProprieteSheetTiers=W.prototype.j.prototype.yB;
W.prototype.j.prototype.vB=function(a,b,c){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayReleveDeProprieteSheetOnMap");m(this.Ba)&&this.Ba.close();this.Ba=window.open("","Relev\u00e9 de propri\u00e9t\u00e9 ","height=400,width=600");this.Ba.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>');vw(this,
a,b,c)};W.prototype.j.prototype.displayReleveDeProprieteSheetOnMap=W.prototype.j.prototype.vB;
W.prototype.j.prototype.uB=function(a,b,c){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.displayRapportParcelle");a=$(a).bootstrapTable("getAllSelections");c=m(c)?c:!0;if(0===a.length)return $.notify("Veuillez s\u00e9lectionner une unique parcelle","info"),0;for(var d="",e=0;e<a.length;e++)0<e&&(d+="|"),d+=a[e].id_par;a={token:C.properties.token,rapport_type:b,parcelles:d,result_srid:H(C.g().F).D().M.substring(5)};var d=C.properties.api_url+"/"+C.properties.cadastre.api+
"/rapportscadastreparcelle",f=this;m(this.Ba)&&this.Ba.close();c?(this.Ba=window.open("","Rapport parcellaire","height=400,width=600"),this.Ba.document.write('<div style="width: 100%; text-align: center; margin-top: 80px"><img src="images/ajax-big-loader.GIF" alt="Load img" style="width: 200px;height: 170px;"><br><br><i style="color: gray">Construction de la fiche en cours..</i></div>')):bootbox.alert('<h4>Rapport en cours de cr\u00e9ation...</h4><br><div class="progress"><div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%"><span class="sr-only">45% Complete</span><span class="sr-only">45% Complete</span></div></div>');
$("body").css({cursor:"wait"});this.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:d,params:a}).then(function(a){$("body").css({cursor:""});if(m(a.data.error)&&m(a.data.error.errorMessage))return console.error(a.data.error.errorMessage),$.notify(a.data.error.errorMessage,"error"),c?f.Ba.document.write('<div style="width: 100%; text-align: center; margin-top: 80px">'+a.data.error.errorMessage+"</div>"):$(".bootbox-alert").modal("hide"),0;if(500===a.status)return $.notify("Une erreur est survenue au sein du serveur",
"error"),c?f.Ba.close():$(".bootbox-alert").modal("hide"),0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),$.notify("Pas de donn\u00e9es \u00e0 afficher","warn"),c?f.Ba.close():$(".bootbox-alert").modal("hide"),0;a=a.data.data;var d=a.rapport+"&token="+C.properties.token;c?f.Ba.location.href=d:($("#cadastre-download-file").attr("href",d),$("#cadastre-download-file").attr("download",b+"."+a.format),C.ph("cadastre-download-file"),$(".bootbox-alert").modal("hide"))},function(a){console.error(a);
$.notify("Une erreur est survenue lors de la g\u00e9n\u00e9ration du rapport","error");m(f.Ba)&&f.Ba.close();$("body").css({cursor:""})})};W.prototype.j.prototype.displayRapportParcelle=W.prototype.j.prototype.uB;
W.prototype.j.prototype.ej=function(a,b,c){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addLocationGeometries");$("body").css({cursor:""});c=m(c)?c:!0;b=m(b)?b:"";var d=H(this.map),e=[],f=[];!1===this.locationMultiple&&C.g().Xg.clear();for(var g=a.length-1;0<=g;g--){var h=C.vj(a[g].geom),l=new Eg({geometry:h});f.push(h.Z());e=h.Z();vh(C.g().Yq(),l);l.set("type",b);var n={},r;for(r in a[g])"geom"!==r&&(n[r]=a[g][r]);l.set("infos",n);delete h;delete l}for(g=
0;g<f.length;g++)f[g][0]<e[0]&&(e[0]=f[g][0]),f[g][1]<e[1]&&(e[1]=f[g][1]),f[g][2]>e[2]&&(e[2]=f[g][2]),f[g][3]>e[3]&&(e[3]=f[g][3]);!0===c&&setTimeout(function(){Lk(d,e,C.g().F.ja())})};W.prototype.j.prototype.addLocationGeometries=W.prototype.j.prototype.ej;
W.prototype.j.prototype.Hy=function(a){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.setSelectionGeometries");$("body").css({cursor:""});for(var b=a.length-1;0<=b;b--)if(void 0!==a[b].geom){var c=C.vj(a[b].geom),d=new Eg({geometry:c});a[b].feature=d;delete c;delete d}return a};W.prototype.j.prototype.setSelectionGeometries=W.prototype.j.prototype.Hy;
W.prototype.j.prototype.dj=function(a,b){if(!m(a))return"data is not defined";if(!m(b))return"tabCode is not defined";void 0===C.B.K.ya(b)?angular.element($("#cadastre-tools")).scope().$evalAsync(function(c){c.ctrl.kh(a,b)}):C.B.K.Xp({va:b},{data:a,Od:["geom"]})};W.prototype.j.prototype.addInfos=W.prototype.j.prototype.dj;
W.prototype.j.prototype.kh=function(a,b){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.setInfos");if(!m(a))return"data is not defined";b=m(b)?b:"Cadastre";a={va:b,data:a,rJ:!0,Od:["geom"],ta:m(a[0].geom)?["zoom","delete"]:["delete"],layer:C.g().Sd};C.B.K.Ga(a)};W.prototype.j.prototype.setInfos=W.prototype.j.prototype.kh;
W.prototype.j.prototype.Hf=function(a,b,c,d){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFromFilter");C.log("filter: "+b);var e=this;a=C.properties.api_url+"/"+a;c=m(c)?c:"Cadastre";d=m(d)?d:function(){return 0};$("body").css({cursor:"wait"});this.V({method:"POST",url:a,headers:{"X-HTTP-Method-Override":"GET"},data:{token:C.properties.token,filter:b,result_srid:H(C.g().F).D().M.substring(5)}}).then(function(a){$("body").css({cursor:""});if(m(a.data.errorMessage))return console.error(a.data.errorMessage),
0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;C.g().Xg.clear();a=e.Hy(a);e.dj(a,c);C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.zoomOnLastTabFeatures");angular.element($("#cadastre-tools")).scope().ctrl.Ue++;a=angular.element($("#cadastre-tools")).scope().ctrl.Ue;var b=angular.element($("#cadastre-tools")).scope().ctrl.pa,f=b[b.length-1];b.length===a&&($("body").css({cursor:""}),C.B.K.uk(f),C.B.K.ve());d(c)},
function(a){$("body").css({cursor:""});console.error(a)})};W.prototype.j.prototype.addSelectionFromFilter=W.prototype.j.prototype.Hf;W.prototype.j.prototype.hA=function(a,b,c,d,e){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFromValue");this.Hf(a,'"'+("cadastre"==this.cadastreAPI_?b:b.toLowerCase())+"\"='"+c+"'",d,e)};W.prototype.j.prototype.addSelectionFromValue=W.prototype.j.prototype.hA;
W.prototype.j.prototype.Yp=function(a,b,c,d,e,f,g){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFrom2Values");"cadastre"!==this.cadastreAPI_&&(b=b.toLowerCase(),d=d.toLowerCase());this.Hf(a,'"'+b+"\"='"+c+"' AND \""+d+"\"='"+e+"'",f,g)};W.prototype.j.prototype.addSelectionFrom2Values=W.prototype.j.prototype.Yp;
W.prototype.j.prototype.Gf=function(a,b,c,d,e,f){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFromTable");var g="";b="cadastre"===this.cadastreAPI_?b:b.toLowerCase();for(var h=0;h<c.length;h++)g=0!==h?g+(' OR "'+b+"\"='"+c[h][d]+"'"):g+('"'+b+"\"='"+c[h][d]+"'");this.Hf(a,g,e,f)};W.prototype.j.prototype.addSelectionFromArray=W.prototype.j.prototype.Gf;
W.prototype.j.prototype.Ae=function(a,b,c,d,e){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFromSelect");b='"'+("cadastre"===this.cadastreAPI_?b:b.toLowerCase())+"\"='"+$(c).val()+"'";this.Hf(a,b,d,e)};W.prototype.j.prototype.addSelectionFromSelect=W.prototype.j.prototype.Ae;
W.prototype.j.prototype.gA=function(a,b,c,d,e,f,g){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFromSelect");"cadastre"!==this.cadastreAPI_&&(b=b.toLowerCase(),d=d.toLowerCase());c=$(c).val();e=$(e).val();this.Hf(a,'"'+b+"\"='"+c+"' AND \""+d+"\"='"+e+"'",f,g)};W.prototype.j.prototype.addSelectionFrom2Select=W.prototype.j.prototype.gA;
W.prototype.j.prototype.Jh=function(a,b,c,d,e){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.addSelectionFromTable");var f="";c=$(c).bootstrapTable("getAllSelections");for(var g="cadastre"===this.cadastreAPI_?b:b.toLowerCase(),h=0;h<c.length;h++)f=0!==h?f+(' OR "'+g+"\"='"+c[h][b]+"'"):f+('"'+g+"\"='"+c[h][b]+"'");this.Hf(a,f,d,e)};W.prototype.j.prototype.addSelectionFromTable=W.prototype.j.prototype.Jh;
W.prototype.j.prototype.MB=function(){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.emptySelection");C.B.K.removeAll()};W.prototype.j.prototype.emptySelection=W.prototype.j.prototype.MB;
W.prototype.j.prototype.Kr=function(a,b,c){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.localiseFromSelect");c=$(c).val();a=C.properties.api_url+"/"+a;var d=this;""!==c?this.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:a,params:{token:C.properties.token,attributs:"geom|proj",filter:'"'+b+"\"='"+c+"'",result_srid:H(C.g().F).D().M.substring(5)}}).then(function(a){if(m(a.data.errorMessage))return console.error(a.data.errorMessage),0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
0;d.ej(a.data.data)},function(a){console.error(a)}):$.notify("Veuillez s\u00e9lectionner au moins un objet spatial","info")};W.prototype.j.prototype.localiseFromSelect=W.prototype.j.prototype.Kr;
W.prototype.j.prototype.Sw=function(a,b,c,d){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.localiseFromTable");$("body").css({cursor:"wait"});var e=this;a=C.properties.api_url+"/"+a;for(var f="",g=0;g<c.length;g++)f=0!==g?f+(' OR "'+b+"\"='"+c[g][d]+"'"):f+('"'+b+"\"='"+c[g][d]+"'");e.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:a,params:{token:C.properties.token,attributs:"geom|proj",filter:f,result_srid:H(C.g().F).D().M.substring(5)}}).then(function(a){if(m(a.data.errorMessage))return console.error(a.data.errorMessage),
0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;e.ej(a.data.data)},function(a){console.error(a)})};W.prototype.j.prototype.localiseFromArray=W.prototype.j.prototype.Sw;
W.prototype.j.prototype.Kj=function(a,b,c,d){function e(){$("body").css({cursor:"wait"});for(var a=0;a<g.length;a++)l=0!==a?l+(' OR "'+b+"\"='"+g[a][d]+"'"):l+('"'+b+"\"='"+g[a][d]+"'");f.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:h,data:{token:C.properties.token,attributs:"geom|proj",filter:l,result_srid:H(C.g().F).D().M.substring(5)}}).then(function(a){if(m(a.data.errorMessage))return console.error(a.data.errorMessage),0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
0;f.ej(a.data.data)},function(a){console.error(a)})}C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.localiseFromTable");d=m(d)?d:b;var f=this,g=$(c).bootstrapTable("getAllSelections"),h=C.properties.api_url+"/"+a,l="";g.length>this.Rg?bootbox.confirm("<h4>Attention, vous allez afficher "+g.length+" objets, cela peut ralentir l'application<br>voulez-vous continuer ?</h4>",function(a){!0===a&&e()}):0!==g.length?e():($("body").css({cursor:""}),$.notify("Veuillez s\u00e9lectionner au moins un objet de la liste",
"info"))};W.prototype.j.prototype.localiseFromTable=W.prototype.j.prototype.Kj;
W.prototype.j.prototype.Qv=function(a,b,c,d){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBaseElem");c=m(c)?c:"";d=m(d)?d:"";var e=this;a=C.properties.api_url+"/"+a;var f={token:C.properties.token,attributs:"-geom|proj",result_srid:H(C.g().F).D().M.substring(5)};""!==c&&(f.filter=c);""!==d&&(f.order_by=d);this[b].length=0;this.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:a,params:f}).then(function(a){if(m(a.data.errorMessage))return console.error(a.data.errorMessage),
0;if(500===a.status)return $.notify("Une erreur est survenue au sein du serveur","error"),0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;e[b]=a.data.data},function(a){console.error(a)})};W.prototype.j.prototype.getBaseElem=W.prototype.j.prototype.Qv;
W.prototype.j.prototype.aC=function(a,b,c,d,e){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBaseElemBySelect");$("body").css("cursor","wait");e=m(e)?e:"";this[d].length=0;var f=this;a=C.properties.api_url+"/"+a;c=$(c).val();b={token:C.properties.token,attributs:"-geom|proj",filter:'"'+b+"\"='"+c+"'",jsonformat:"anonymous",result_srid:H(C.g().F).D().M.substring(5)};""!==e&&(b.order_by=e);this.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:a,
params:b}).then(function(a){$("body").css("cursor","");if(m(a.data.errorMessage))return console.error(a.data.errorMessage),$.notify(a.data.errorMessage,"error"),0;if(500===a.status)return $.notify("Une erreur est survenue au sein du serveur","error"),0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;f[d]=a.data.data},function(a){console.error(a)})};W.prototype.j.prototype.getBaseElemBySelect=W.prototype.j.prototype.aC;
function ww(a,b,c,d,e){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.putBaseElemOnTable");$(d).bootstrapTable("showLoading");$("body").css("cursor","wait");e=m(e)?e:"";c={token:C.properties.token,filter:c,jsonformat:"anonymous",result_srid:H(C.g().F).D().M.substring(5)};""!==e&&(c.order_by=e);a.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:C.properties.api_url+"/"+b,params:c}).then(function(a){$("body").css("cursor","");$(d).bootstrapTable("hideLoading");
if(m(a.data.errorMessage))return console.error(a.data.errorMessage),0;if(500===a.status)return $.notify("Une erreur est survenue au sein du serveur","error"),0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(d).bootstrapTable("load",a);$(d+"-toolbar").show();1===a.length&&$(d).bootstrapTable("check",0)})}
W.prototype.j.prototype.ZF=function(a,b,c,d,e){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.putBaseElemBySelectOnTable");e=m(e)?e:"";c=$(c).val();ww(this,a,'"'+b+"\"='"+c+"'",d,e)};W.prototype.j.prototype.putBaseElemBySelectOnTable=W.prototype.j.prototype.ZF;
W.prototype.j.prototype.YF=function(a,b,c,d,e,f,g){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.putBaseElemBy2SelectOnTable");g=m(g)?g:"";c=$(c).val();e=$(e).val();ww(this,a,'"'+b+"\"='"+c+"' AND \""+d+"\"='"+e+"'",f,g)};W.prototype.j.prototype.putBaseElemBy2SelectOnTable=W.prototype.j.prototype.YF;
W.prototype.j.prototype.bC=function(a,b,c,d){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBaseVoiesOnTable");c=$(c).val();a=C.properties.api_url+"/"+a;var e=this;$("body").css("cursor","wait");$(d).bootstrapTable({data:{}});var f="cadastre"===e.cadastreAPI_?"DVOILIB":"dvoilib";$(d).bootstrapTable("showLoading");this.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:a,params:{token:C.properties.token,order_by:f,filter:'"'+b+"\"='"+c+"'",jsonformat:"anonymous",
result_srid:H(C.g().F).D().M.substring(5)}}).then(function(a){$("body").css("cursor","");$(d).bootstrapTable("hideLoading");if(m(a.data.errorMessage))return console.error(a.data.errorMessage),0;if(500===a.status)return $.notify("Une erreur est survenue au sein du serveur","error"),0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(d).bootstrapTable("load",a);$(d).off("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table");$(d).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",
function(a,b){$("body").css("cursor","wait");$("#Parcelle-par-adresse-DGFiP-select-adresse").prop("disabled",!0);xw(e,{path:C.properties.cadastre.api+"/adresses",variableName:"aAdresses",param:"cadastre"===e.cadastreAPI_?"ID_RIVOLI":"id_voie",value:b.ID_RIVOLI,order_by:"DNVOIRI",callback:function(){$("#Parcelle-par-adresse-DGFiP-select-adresse").prop("disabled",!1);$("body").css("cursor","")}})});1===a.length&&$(d).bootstrapTable("check",0)},function(a){console.error(a);$("body").css({cursor:""});
$(d).bootstrapTable("hideLoading")})};W.prototype.j.prototype.getBaseVoiesOnTable=W.prototype.j.prototype.bC;
function xw(a,b){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBaseElemByValue");var c=b.path,d=b.variableName,e=b.param,f=b.value,g=b.callback;b=b.order_by;g=m(g)?g:function(){return 0};c=C.properties.api_url+"/"+c;a[d].length=0;a.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:c,params:{token:C.properties.token,attributs:"-geom|proj",filter:'"'+e+"\"='"+f+"'",result_srid:H(C.g().F).D().M.substring(5),order_by:null!=b?b:""}}).then(function(b){$("body").css("cursor",
"");if(m(b.data.errorMessage))return console.error(b.data.errorMessage),0;if(500===b.status)return $.notify("Une erreur est survenue au sein du serveur","error"),0;if(!m(b.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a[d]=b.data.data;g()},function(a){console.error(a);$("body").css({cursor:""})})}
W.prototype.j.prototype.GC=function(a,b,c,d,e){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getParcelleBaseProprietairesOnTable");var f=this;a=$(a).val();b=$(b).val().toUpperCase();var g=C.properties.api_url+"/"+C.properties.cadastre.api+"/proprietaires";$(c).bootstrapTable({data:{}});$(c).bootstrapTable("showLoading");$("body").css("cursor","wait");$(d).bootstrapTable("removeAll");$(e).bootstrapTable("removeAll");if("cadastre"===this.cadastreAPI_)var h="ID_COM",
l="DDENOM";else h="id_com",l="ddenom";b=b.replace(/'/g,"''");this.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:g,params:{token:C.properties.token,filter:'"'+h+"\"='"+a+"' AND \""+l+"\" LIKE '%"+b+"%'",limit:500,attributs:l+"|"+h,distinct:!0,order_by:l,result_srid:H(C.g().F).D().M.substring(5)}}).then(function(a){$("body").css("cursor","default");$(c).bootstrapTable("hideLoading");if(m(a.data.errorMessage))return console.error(a.data.errorMessage),0;if(500===a.status)return $.notify("Une erreur est survenue au sein du serveur",
"error"),0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;500<=a.length&&$.notify("Attention: limite d'occurrences atteinte, veuillez affiner votre recherche","info");$(c).bootstrapTable("load",a);$(c+"-toolbar").show();""!==d&&($(c).off("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table"),$(c).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",function(a,b){$(d).bootstrapTable("removeAll");$(e).bootstrapTable("removeAll");
f.$v(b,d,e)}));1===a.length&&$(c).bootstrapTable("check",0)},function(a){console.error(a);$("body").css({cursor:""});$(c).bootstrapTable("hideLoading")})};W.prototype.j.prototype.getParcelleBaseProprietairesOnTable=W.prototype.j.prototype.GC;
W.prototype.j.prototype.$v=function(a,b,c){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getParcelleBaseComptesOnTable");var d=this,e=C.properties.api_url+"/"+C.properties.cadastre.api+"/proprietaires";$(b).bootstrapTable("showLoading");if("cadastre"===this.cadastreAPI_)var f="ID_COM",g="DDENOM",h="DNUPRO";else f="id_com",g="ddenom",h="dnupro";this.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:e,params:{token:C.properties.token,filter:'"'+f+
"\" = '"+a.ID_COM+"' AND \""+g+"\" = '"+a.DDENOM.replace(/'/g,"''")+"'",attributs:f+"|"+h,order_by:h,result_srid:H(C.g().F).D().M.substring(5)}}).then(function(a){$(b).bootstrapTable("hideLoading");if(m(a.data.errorMessage))return console.error(a.data.errorMessage),0;if(500===a.status)return $.notify("Une erreur est survenue au sein du serveur","error"),0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(b).bootstrapTable("load",a);$(b+"-toolbar").show();
$(b).off("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table");$(b).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",function(a,e){$(c).bootstrapTable("removeAll");d.Rv(e.ID_COM,$(b).bootstrapTable("getAllSelections"),c)});1===a.length&&$(b).bootstrapTable("check",0)},function(a){console.error(a);$(b).bootstrapTable("hideLoading")})};W.prototype.j.prototype.getParcelleBaseComptesOnTable=W.prototype.j.prototype.$v;
W.prototype.j.prototype.Rv=function(a,b,c){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBaseParcellesByProprietaireOnTable");if(0!==b.length){var d=C.properties.api_url+"/"+C.properties.cadastre.api+"/descriptionparcelles";$(c).bootstrapTable("showLoading");if("cadastre"===this.cadastreAPI_){a="ID_COM";var e="DNUPRO",f="ID_PAR"}else a="id_com",e="dnupro",f="id_par";for(var g="",h=0;h<b.length;h++)g=0===h?g+('( "'+a+"\"='"+b[h].ID_COM+"' AND \""+e+"\"='"+
b[h].DNUPRO+"' )"):g+(' OR ( "'+a+"\"='"+b[h].ID_COM+"' AND \""+e+"\"='"+b[h].DNUPRO+"' )");C.log(g);this.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:d,params:{token:C.properties.token,attributs:f,filter:g,order_by:f,result_srid:H(C.g().F).D().M.substring(5)}}).then(function(a){$(c).bootstrapTable("hideLoading");if(m(a.data.errorMessage))return console.error(a.data.errorMessage),0;if(500===a.status)return $.notify("Une erreur est survenue au sein du serveur","error"),0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),
0;a=a.data.data;$(c).bootstrapTable("load",a);$(c+"-toolbar").show();1===a.length&&$(c).bootstrapTable("check",0)},function(a){console.error(a);$(c).bootstrapTable("hideLoading")})}};W.prototype.j.prototype.getBaseParcellesByProprietaireOnTable=W.prototype.j.prototype.Rv;
W.prototype.j.prototype.dC=function(a,b,c,d,e,f){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBatiBaseProprietairesOnTable");var g=this;a=$(a).val();b=$(b).val().toUpperCase().replace(/'/g,"''");var h=C.properties.api_url+"/"+C.properties.cadastre.api+"/proprietaires";$("body").css("cursor","wait");$(c).bootstrapTable({data:{}});$(c).bootstrapTable("showLoading");$(d).bootstrapTable("removeAll");$(e).bootstrapTable("removeAll");$(f).bootstrapTable("removeAll");
if("cadastre"===this.cadastreAPI_)var l="ID_COM",n="DDENOM";else l="id_com",n="ddenom";this.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:h,params:{token:C.properties.token,filter:'"'+l+"\"='"+a+"' AND \""+n+"\" LIKE '%"+b+"%'",limit:"50",attributs:n+"|"+l,distinct:!0,order_by:n,result_srid:H(C.g().F).D().M.substring(5)}}).then(function(a){$("body").css("cursor","default");$(c).bootstrapTable("hideLoading");if(m(a.data.errorMessage))return console.error(a.data.errorMessage),0;if(500===
a.status)return $.notify("Une erreur est survenue au sein du serveur","error"),0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(c).bootstrapTable("load",a);$(c+"-toolbar").show();""!==d&&($(c).off("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table"),$(c).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",function(a,b){$(d).bootstrapTable("removeAll");$(e).bootstrapTable("removeAll");$(f).bootstrapTable("removeAll");
g.Sv(b,d,e,f)}));1===a.length&&$(c).bootstrapTable("check",0)},function(a){console.error(a);$("body").css({cursor:""});$(c).bootstrapTable("hideLoading")})};W.prototype.j.prototype.getBatiBaseProprietairesOnTable=W.prototype.j.prototype.dC;
W.prototype.j.prototype.Sv=function(a,b,c,d){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBatiBaseComptesOnTable");var e=this,f=C.properties.api_url+"/"+C.properties.cadastre.api+"/proprietaires";$(b).bootstrapTable("showLoading");if("cadastre"===this.cadastreAPI_)var g="ID_COM",h="DDENOM",l="DNUPRO";else g="id_com",h="ddenom",l="dnupro";this.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:f,params:{token:C.properties.token,filter:'"'+g+"\" = '"+
a.ID_COM+"' AND \""+h+"\" = '"+a.DDENOM.replace(/'/g,"''")+"'",attributs:l+"|"+g,order_by:l,result_srid:H(C.g().F).D().M.substring(5)}}).then(function(a){$(b).bootstrapTable("hideLoading");if(m(a.data.errorMessage))return console.error(a.data.errorMessage),0;if(500===a.status)return $.notify("Une erreur est survenue au sein du serveur","error"),0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(b).bootstrapTable("load",a);$(b+"-toolbar").show();$(b).off("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table");
$(b).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",function(){$(c).bootstrapTable("removeAll");$(d).bootstrapTable("removeAll");e.Tv($(b).bootstrapTable("getAllSelections"),c,d)});1===a.length&&$(b).bootstrapTable("check",0)},function(a){console.error(a);$(b).bootstrapTable("hideLoading")})};W.prototype.j.prototype.getBatiBaseComptesOnTable=W.prototype.j.prototype.Sv;
W.prototype.j.prototype.Tv=function(a,b,c){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBatiBaseInvariantsOnTable");if(0!==a.length){var d=this,e=C.properties.api_url+"/"+C.properties.cadastre.api+"/invariants",f="";if("cadastre"===this.cadastreAPI_)var g="ID_COM",h="DNUPRO",l="INVAR|ID_PAR|oid";else g="id_com",h="dnupro",l="INVAR|ID_PAR|id_local";for(var n=0;n<a.length;n++)f=0===n?f+('("'+h+"\"='"+a[n].DNUPRO+"' AND \""+g+"\"='"+a[n].ID_COM+"')"):f+(' OR ("'+
h+"\"='"+a[n].DNUPRO+"' AND \""+g+"\"='"+a[n].ID_COM+"')");C.log(f);$(b).bootstrapTable("showLoading");this.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:e,params:{token:C.properties.token,filter:f,attributs:l,jsonformat:"anonymous",order_by:"INVAR",result_srid:H(C.g().F).D().M.substring(5)}}).then(function(a){$(b).bootstrapTable("hideLoading");if(m(a.data.errorMessage))return console.error(a.data.errorMessage),0;if(500===a.status)return $.notify("Une erreur est survenue au sein du serveur",
"error"),0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(b).bootstrapTable("load",a);$(b+"-toolbar").show();$(b).off("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table");$(b).on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",function(){$(c).bootstrapTable("removeAll");d.Uv($(b).bootstrapTable("getAllSelections"),c)});1===a.length&&$(b).bootstrapTable("check",0)},function(a){console.error(a);$(b).bootstrapTable("hideLoading")})}};
W.prototype.j.prototype.getBatiBaseInvariantsOnTable=W.prototype.j.prototype.Tv;
W.prototype.j.prototype.Uv=function(a,b){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.getBatiBaseParcellesOnTable");if(0!==a.length){$(b).bootstrapTable("showLoading");for(var c=C.properties.api_url+"/"+C.properties.cadastre.api+"/parcelles",d="",e=0;e<a.length;e++)d=0===e?d+('"id_par"=\''+a[e].ID_PAR+"'"):d+(' OR "id_par"=\''+a[e].ID_PAR+"'");C.log(d);this.V({method:"POST",headers:{"X-HTTP-Method-Override":"GET"},url:c,params:{token:C.properties.token,filter:d,
attributs:"id_par",order_by:"parcelle",result_srid:H(C.g().F).D().M.substring(5)}}).then(function(a){$(b).bootstrapTable("hideLoading");if(m(a.data.errorMessage))return console.error(a.data.errorMessage),0;if(500===a.status)return $.notify("Une erreur est survenue au sein du serveur","error"),0;if(!m(a.data.data))return console.error("Pas de donn\u00e9es \u00e0 afficher"),0;a=a.data.data;$(b).bootstrapTable("load",a);$(b+"-toolbar").show();1===a.length&&$(b).bootstrapTable("check",0)},function(a){console.error(a);
$(b).bootstrapTable("hideLoading")})}};W.prototype.j.prototype.getBatiBaseParcellesOnTable=W.prototype.j.prototype.Uv;
W.prototype.j.prototype.ty=function(a){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectCommuneForm");if(!m(a))return"selectCommune non renseign\u00e9";this.Ue=this.pa.length=0;""!==$(a).val()&&(this.pa.push("veremes_cadastre_commune"),void 0===C.B.K.ya("veremes_cadastre_commune")&&C.B.K.Ga({va:"veremes_cadastre_commune",Va:"Commune",ta:["zoom","delete"]}),this.Ae(C.properties.cadastre.api+"/communes","id_com",a,"veremes_cadastre_commune"));C.B.K.Hd(this.pa[this.pa.length-
1])};W.prototype.j.prototype.selectCommuneForm=W.prototype.j.prototype.ty;
W.prototype.j.prototype.yy=function(a,b){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectSectionForm");if(!m(a))return"selectCommune non renseign\u00e9";if(!m(b))return"tableSection non renseign\u00e9";this.Ue=this.pa.length=0;""!==$(a).val()&&(this.pa.push("veremes_cadastre_commune"),void 0===C.B.K.ya("veremes_cadastre_commune")&&C.B.K.Ga({va:"veremes_cadastre_commune",Va:"Commune",ta:["zoom","delete"]}),this.Ae(C.properties.cadastre.api+"/communes","id_com",
a,"veremes_cadastre_commune"));0<$(b).bootstrapTable("getAllSelections").length&&(this.pa.push("veremes_cadastre_section"),void 0===C.B.K.ya("veremes_cadastre_section")&&C.B.K.Ga({va:"veremes_cadastre_section",Va:"Section",ta:["zoom","delete"]}),this.Jh(C.properties.cadastre.api+"/sections","id_sec",b,"veremes_cadastre_section"));C.B.K.Hd(this.pa[this.pa.length-1])};W.prototype.j.prototype.selectSectionForm=W.prototype.j.prototype.yy;
W.prototype.j.prototype.uy=function(a,b){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectSectionForm");if(!m(a))return"selectCommune non renseign\u00e9";if(!m(b))return"tableLieuDit non renseign\u00e9";this.Ue=this.pa.length=0;""!==$(a).val()&&(this.pa.push("veremes_cadastre_commune"),void 0===C.B.K.ya("veremes_cadastre_commune")&&C.B.K.Ga({va:"veremes_cadastre_commune",Va:"Commune",ta:["zoom","delete"]}),this.Ae(C.properties.cadastre.api+"/communes","id_com",
a,"veremes_cadastre_commune"));0<$(b).bootstrapTable("getAllSelections").length&&(this.pa.push("veremes_cadastre_lieu_dit"),void 0===C.B.K.ya("veremes_cadastre_lieu_dit")&&C.B.K.Ga({va:"veremes_cadastre_lieu_dit",Va:"Lieu-dit",ta:["zoom","delete"]}),this.Jh(C.properties.cadastre.api+"/lieudits","oid",b,"veremes_cadastre_lieu_dit"));C.B.K.Hd(this.pa[this.pa.length-1])};W.prototype.j.prototype.selectLieuDitForm=W.prototype.j.prototype.uy;
W.prototype.j.prototype.xy=function(a,b,c){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectSectionForm");if(!m(a))return"selectCommune non renseign\u00e9";if(!m(b))return"selectSection non renseign\u00e9";if(!m(c))return"tableParcelle non renseign\u00e9";this.Ue=this.pa.length=0;""!==$(a).val()&&(this.pa.push("veremes_cadastre_commune"),void 0===C.B.K.ya("veremes_cadastre_commune")&&C.B.K.Ga({va:"veremes_cadastre_commune",Va:"Commune",ta:["zoom","delete"]}),
this.Ae(C.properties.cadastre.api+"/communes","id_com",a,"veremes_cadastre_commune"));""!==$(b).val()&&(this.pa.push("veremes_cadastre_section"),void 0===C.B.K.ya("veremes_cadastre_section")&&C.B.K.Ga({va:"veremes_cadastre_section",Va:"Section",ta:["zoom","delete"]}),this.Ae(C.properties.cadastre.api+"/sections","id_sec",b,"veremes_cadastre_section"));0<$(c).bootstrapTable("getAllSelections").length&&(this.pa.push("veremes_cadastre_parcelle"),void 0===C.B.K.ya("veremes_cadastre_parcelle")&&C.B.K.Ga({va:"veremes_cadastre_parcelle",
Va:"Parcelle",ta:["zoom","delete"]}),this.Jh(C.properties.cadastre.api+"/parcelles","id_par",c,"veremes_cadastre_parcelle"));C.B.K.Hd(this.pa[this.pa.length-1])};W.prototype.j.prototype.selectParcelleBySectionForm=W.prototype.j.prototype.xy;
W.prototype.j.prototype.vy=function(a,b,c){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectParcelleByAdresse");if(!m(a))return"selectCommune non renseign\u00e9";if(!m(b))return"selectSection non renseign\u00e9";if(!m(c))return"tableParcelle non renseign\u00e9";this.Ue=this.pa.length=0;""!==$(a).val()&&(this.pa.push("veremes_cadastre_commune"),void 0===C.B.K.ya("veremes_cadastre_commune")&&C.B.K.Ga({va:"veremes_cadastre_commune",Va:"Commune",ta:["zoom",
"delete"]}),this.Ae(C.properties.cadastre.api+"/communes","id_com",a,"veremes_cadastre_commune"));0<$(b).bootstrapTable("getAllSelections").length&&(this.pa.push("veremes_cadastre_voie"),void 0===C.B.K.ya("veremes_cadastre_voie")&&C.B.K.Ga({va:"veremes_cadastre_voie",Va:"Voie",ta:["delete"]}),this.Jh(C.properties.cadastre.api+"/voies","ID_RIVOLI",b,"veremes_cadastre_voie"));""!==$(c).val()&&(this.pa.push("veremes_cadastre_adresse"),void 0===C.B.K.ya("veremes_cadastre_adresse")&&C.B.K.Ga({va:"veremes_cadastre_adresse",
Va:"Adresse",ta:["delete"]}),this.Ae(C.properties.cadastre.api+"/adresses","ID_PAR",c,"veremes_cadastre_adresse"));""!==$(c).val()?(this.pa.push("veremes_cadastre_parcelle"),void 0===C.B.K.ya("veremes_cadastre_parcelle")&&C.B.K.Ga({va:"veremes_cadastre_parcelle",Va:"Parcelle",ta:["zoom","delete"]}),this.Ae(C.properties.cadastre.api+"/parcelles","id_par",c,"veremes_cadastre_parcelle")):0<$(b).bootstrapTable("getAllSelections").length&&0<this.aAdresses.length&&(this.pa.push("veremes_cadastre_parcelle"),
void 0===C.B.K.ya("veremes_cadastre_parcelle")&&C.B.K.Ga({va:"veremes_cadastre_parcelle",Va:"Parcelle",ta:["zoom","delete"]}),this.Gf(C.properties.cadastre.api+"/parcelles","id_par",this.aAdresses,"ID_PAR","veremes_cadastre_parcelle"));C.B.K.Hd(this.pa[this.pa.length-1])};W.prototype.j.prototype.selectParcelleByAdresse=W.prototype.j.prototype.vy;
W.prototype.j.prototype.wy=function(a,b,c,d){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectParcelleByProprietaire");if(!m(a))return"selectCommune non renseign\u00e9";if(!m(b))return"tableProprietaires non renseign\u00e9";if(!m(c))return"tableComptes non renseign\u00e9";if(!m(d))return"tableParcelles non renseign\u00e9";this.Ue=this.pa.length=0;""!==$(a).val()&&(this.pa.push("veremes_cadastre_commune"),void 0===C.B.K.ya("veremes_cadastre_commune")&&C.B.K.Ga({va:"veremes_cadastre_commune",
Va:"Commune",ta:["zoom","delete"]}),this.Ae(C.properties.cadastre.api+"/communes","id_com",a,"veremes_cadastre_commune"));0<$(b).bootstrapTable("getAllSelections").length&&(this.pa.push("veremes_cadastre_proprietaire"),void 0===C.B.K.ya("veremes_cadastre_proprietaire")&&C.B.K.Ga({va:"veremes_cadastre_proprietaire",Va:"Propri\u00e9taire",ta:["delete"]}),a=$(b).bootstrapTable("getAllSelections")[0],this.Yp(C.properties.cadastre.api+"/proprietaires","DDENOM",a.DDENOM.replace(/'/g,"''"),"ID_COM",a.ID_COM,
"veremes_cadastre_proprietaire"));if(0<$(c).bootstrapTable("getAllSelections").length){this.pa.push("veremes_cadastre_compte");void 0===C.B.K.ya("veremes_cadastre_compte")&&C.B.K.Ga({va:"veremes_cadastre_compte",Va:"Compte",ta:["delete"]});c=$(c).bootstrapTable("getAllSelections");"cadastre"===this.cadastreAPI_?(a="ID_COM",b="DNUPRO"):(a="id_com",b="dnupro");for(var e="",f=0;f<c.length;f++)e=0!==f?e+('OR ("'+a+"\"='"+c[f].ID_COM+"' AND \""+b+"\"='"+c[f].DNUPRO+"')"):e+('("'+a+"\"='"+c[f].ID_COM+"' AND \""+
b+"\"='"+c[f].DNUPRO+"')");this.Hf(C.properties.cadastre.api+"/proprietaires",e,"veremes_cadastre_compte")}0<$(d).bootstrapTable("getAllSelections").length&&(this.pa.push("veremes_cadastre_parcelle"),void 0===C.B.K.ya("veremes_cadastre_parcelle")&&C.B.K.Ga({va:"veremes_cadastre_parcelle",Va:"Parcelle",ta:["zoom","delete"]}),d=$(d).bootstrapTable("getAllSelections"),this.Gf(C.properties.cadastre.api+"/parcelles","id_par",d,"ID_PAR","veremes_cadastre_parcelle"));C.B.K.Hd(this.pa[this.pa.length-1])};
W.prototype.j.prototype.selectParcelleByProprietaire=W.prototype.j.prototype.wy;
W.prototype.j.prototype.sy=function(a,b,c,d,e){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.selectBatiByProprietaire");if(!m(a))return"selectCommune non renseign\u00e9";if(!m(b))return"tableProprietaires non renseign\u00e9";if(!m(c))return"tableComptes non renseign\u00e9";if(!m(d))return"tableInvariants non renseign\u00e9";if(!m(e))return"tableParcelles non renseign\u00e9";if("cadastre"===this.cadastreAPI_)var f="DDENOM",g="ID_COM";else f="ddenom",g="id_com";
$("body").css({cursor:"wait"});this.Ue=this.pa.length=0;""!==$(a).val()&&(this.pa.push("veremes_cadastre_commune"),void 0===C.B.K.ya("veremes_cadastre_commune")&&C.B.K.Ga({va:"veremes_cadastre_commune",Va:"Commune",ta:["zoom","delete"]}),this.Ae(C.properties.cadastre.api+"/communes","id_com",a,"veremes_cadastre_commune"));0<$(b).bootstrapTable("getAllSelections").length&&(this.pa.push("veremes_cadastre_proprietaire"),void 0===C.B.K.ya("veremes_cadastre_proprietaire")&&C.B.K.Ga({va:"veremes_cadastre_proprietaire",
Va:"Propri\u00e9taire",ta:["delete"]}),a=$(b).bootstrapTable("getAllSelections")[0],this.Yp(C.properties.cadastre.api+"/proprietaires",f,a.DDENOM.replace(/'/g,"''"),g,a.ID_COM,"veremes_cadastre_proprietaire"));if(0<$(c).bootstrapTable("getAllSelections").length){this.pa.push("veremes_cadastre_compte");void 0===C.B.K.ya("veremes_cadastre_compte")&&C.B.K.Ga({va:"veremes_cadastre_compte",Va:"Compte",ta:["delete"]});c=$(c).bootstrapTable("getAllSelections");f="";if("cadastre"===this.cadastreAPI_){g="ID_COM";
a="DNUPRO";var h="oid"}else g="id_com",a="dnupro",h="id_local";for(b=0;b<c.length;b++)f=0!==b?f+('OR ("'+g+"\"='"+c[b].ID_COM+"' AND \""+a+"\"='"+c[b].DNUPRO+"')"):f+('("'+g+"\"='"+c[b].ID_COM+"' AND \""+a+"\"='"+c[b].DNUPRO+"')");this.Hf(C.properties.cadastre.api+"/proprietaires",f,"veremes_cadastre_compte")}0<$(d).bootstrapTable("getAllSelections").length&&(this.pa.push("veremes_cadastre_invariant"),void 0===C.B.K.ya("veremes_cadastre_invariant")&&C.B.K.Ga({va:"veremes_cadastre_invariant",Va:"Invariant",
ta:["delete"]}),this.Jh(C.properties.cadastre.api+"/invariants",h,d,"veremes_cadastre_invariant"));0<$(e).bootstrapTable("getAllSelections").length&&(this.pa.push("veremes_cadastre_parcelle"),void 0===C.B.K.ya("veremes_cadastre_parcelle")&&C.B.K.Ga({va:"veremes_cadastre_parcelle",Va:"Parcelle",ta:["zoom","delete"]}),this.Jh(C.properties.cadastre.api+"/parcelles","id_par",e,"veremes_cadastre_parcelle"));C.B.K.Hd(this.pa[this.pa.length-1])};W.prototype.j.prototype.selectBatiByProprietaire=W.prototype.j.prototype.sy;
function rw(){C.log("nsVmap.nsToolsManager.nsModules.Cadastre.prototype.cadastreController.prototype.removeMapInteractions");C.g().re();C.g().sa.hide()}C.module.directive("appCadastre",W.prototype.LA);C.module.controller("AppcadastreController",W.prototype.j);xu.RJ={};function Xd(){C.log("nsVmap.nsToolsManager.ToolsManager");this.Rp=yw();this.vc=new jw;this.K=new U;this.yw()}ta("nsVmap.nsToolsManager.ToolsManager",Xd);Xd.prototype.yw=function(){C.log("nsVmap.nsToolsManager.ToolsManager.instanciateAvaliableModules");var a=Object.keys(xu.Pl);C.log("avaliableModules: ",a);for(var b=0;b<a.length;b++)zw(this,a[b])};Xd.prototype.instanciateAvaliableModules=Xd.prototype.yw;
function zw(a,b){C.log("nsVmap.nsToolsManager.ToolsManager.instanciateModule");b=b.toLowerCase().replace(/\b[a-z]/g,function(a){return a.toUpperCase()});null!=xu.Pl[b]?a[b]=new xu.Pl[b]:console.error("tool ("+b+") does not exist")}
Xd.prototype.Gz=function(){C.log("nsVmap.nsToolsManager.BasicTools.prototype.vmapToolsDirective");return{restrict:"E",scope:{map:"=appMap",lang:"=appLang",infos:"=appInfos",currentAction:"=appAction"},controller:"AppVmaptoolsController",controllerAs:"ctrl",bindToController:!0,templateUrl:C.properties.vmap_folder+"/template/tools/tools.html"}};Xd.prototype.vmapToolsDirective=Xd.prototype.Gz;
Xd.prototype.Ez=function(a){return function(b){b.oToolsTree=C.B.Rp;for(var c in b.oToolsTree){var d="",e='<div id="'+c+'-container" class="right-sidebar" ',e=e+("ng-class=\"ctrl.openedTool == '"+c+"' ? 'open' : ''\">"),f;for(f in b.oToolsTree[c])d+='<div id="'+f+'-tool" class="side-tool ng-isolate-scope app-'+f+'" ',d+='app-map="ctrl.map" app-lang="ctrl.lang" app-infos="ctrl.infos" app-action="ctrl.currentAction"></div>';angular.element($("tools-container")).append(a(e+d+"</div>")(b))}}};
Xd.prototype.Ez.$inject=["$compile"];Xd.prototype.Fz=function(){C.log("nsVmap.nsToolsManager.BasicTools.prototype.vmapToolsController");this.oToolsTree=C.B.Rp;this.openedTool="_"};Xd.prototype.vmapToolsController=Xd.prototype.Fz;function yw(){var a={};$.ajax({url:C.properties.api_url+"/vmap/usermodules?token="+C.properties.token,async:!1}).done(function(b){a=b.usermodules}).fail(function(){});return a}Xd.prototype.UC=function(){return this.Rp};Xd.prototype.getToolsTree=Xd.prototype.UC;
Xd.prototype.cC=function(){return this.vc};Xd.prototype.getBasicTools=Xd.prototype.cC;Xd.prototype.mC=function(){return this.K};Xd.prototype.getInfoContainer=Xd.prototype.mC;Xd.prototype.gr=function(a){return this[a]};Xd.prototype.getTool=Xd.prototype.gr;C.module.directive("appVmaptools",Xd.prototype.Gz);C.module.directive("toolsContainer",Xd.prototype.Ez);C.module.controller("AppVmaptoolsController",Xd.prototype.Fz);var Aw={};ta("nsUtils",Aw);Aw.FA=!1;Aw.log=function(a){null!=X.fa&&X.fa.debug_mode&&Aw.FA&&console.log(a)};Aw.log=Aw.log;Aw.xf=function(){Aw.log("util.unselectAll");$("#treeView").treeview("unselectNode",[$("#treeView").treeview("getSelected"),{Cd:!0}]);$("#treeWithLines").treeview("unselectNode",[$("#treeWithLines").treeview("getSelected"),{Cd:!0}]);angular.element($("#studio_container")).scope().$broadcast("update element",{});angular.element($("#FormModal")).scope().ctrl.ts()};Aw.unselectAll=Aw.xf;
Aw.reloadForm=function(a){Aw.log("util.reloadForm");null!=a||(a="#studio_form_reader");var b=angular.element($(a).children()).scope();b.oFormValues[b.sFormDefinitionName]={};setTimeout(function(){b.compileTemplate();setTimeout(function(){b.ctrl.Bp(!0);setTimeout(function(){b.ctrl.Bn()},100)},100)},100)};Aw.reloadForm=Aw.reloadForm;Aw.clone=function(a){Aw.log("util.clone");return a};Aw.clone=Aw.clone;Aw.$i=function(a){Aw.log("util.JsonStringifier");return JSON.stringify(a,null,2)};
Aw.JsonStringifier=Aw.$i;
Aw.Mp=function(a){var b=a.insert;0==b.javascript&&delete b.javascript;0==b.style&&delete b.style;for(var c=0;c<b.rows.length;)if("object"!==typeof b.rows)console.error("error on rows integrity, this row who have been deleted :",b.rows),delete b.rows;else{if(Array.isArray(b.rows[c].fields))for(var d=0;d<b.rows[c].fields.length;)if("object"!==typeof b.rows[c].fields[d])console.error("error on fields integrity, this field who have been deleted in row "+c+", field "+d+" :",b.rows[c].fields[d]),delete b.rows[c].fields[d];
else{var e=b.rows[c].fields[d],f=[];if("undefined"==typeof e.type||"undefined"==e.name||"undefined"==e.id)return console.error("error on minimal containt of a field :",e),null;switch(e.type){case "title":case "label":if("undefined"==typeof e.label)return console.error(e.type+" without a label isn't a "+e.type+" :",e),null;f=["type","id","label","name"];break;case "hr":f=["type","id","name"];break;case "subtitle":if("undefined"==typeof e.label)return console.error("subtitle without a text isn't a subtitle :",
e),null;"undefined"==typeof e["class"]&&delete e["class"];f=["type","id","label","name","class"];break;case "checkbox":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.checked&&0!=e.checked||delete e.checked;f=["type","id","label","name","checked"];break;case "radio":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.checked&&0!=e.checked||delete e.checked;f="type id label name checked options".split(" ");break;
case "textarea":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.required&&0!=e.required||delete e.required;"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f="type id label name required nb_cols".split(" ");break;case "select":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.required&&0!=e.required||delete e.required;"undefined"!=typeof e.multiple&&0!=e.multiple||delete e.multiple;if(!fa(e.options)&&!p(e.options))return console.error(e.type+
"'s options are always an array :",e),null;if("object"!=typeof e.web_service)delete e.web_service;else if("undefined"!=typeof e.web_service.parameter&&delete e.web_service.parameter,"string"!=typeof e.web_service.ressource_id||"string"!=typeof e.web_service.id_key||"string"!=typeof e.web_service.label_key)return null;"string"!=typeof e.child_select&&delete e.child_select;"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f="type id label name required nb_cols multiple options web_service child_select".split(" ");
break;case "double_select":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.required&&0!=e.required||delete e.required;if(!Array.isArray[e.options])return console.error(e.type+"'s options are always an array :",e),null;if("object"!=typeof e.web_service)delete e.web_service,console.error(e.type+"'s WS are always an object :",e);else if("undefined"!=typeof e.web_service.parameter&&delete e.web_service.parameter,"string"!=typeof e.web_service.ressource_id||
"string"!=typeof e.web_service.id_key||"string"!=typeof e.web_service.label_key)return console.error(e.type+"'s WS parameter are always strings :",e),null;"undefined"==typeof e.size&&(e.size=5);"string"!=typeof e.label_from&&delete e.label_from;"string"!=typeof e.label_to&&delete e.label_to;"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f="type id label name required nb_cols options web_service size label_from label_to name_from name_to".split(" ");break;case "date":case "datetime":case "upload":case "display_label":case "color_picker":"undefined"==
typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f=["type","id","label","name","nb_cols"];break;case "tinymce":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"==typeof e.nb_rows&&delete e.nb_rows;"object"!=typeof e.options&&delete e.options;f="type id label name nb_rows options".split(" ");break;case "CodeMirror":case "slider":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"object"!=
typeof e.options&&delete e.options;f=["type","id","label","name","options"];break;case "text":case "password":case "url":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.required&&0!=e.required||delete e.required;"undefined"!=typeof e.pattern&&""!=e.pattern||delete e.pattern;"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f="type id label name pattern required nb_cols".split(" ");break;case "number":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",
e);"undefined"==typeof e.min&&delete e.min;"undefined"==typeof e.max&&delete e.max;"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f="type id label name min max nb_cols".split(" ");break;case "map_osm":case "map_bing":case "map_vmap":"undefined"==typeof e.label&&console.warn(e.type+" without a label :",e);"undefined"!=typeof e.required&&0!=e.required||delete e.required;if("object"!=typeof e.map_options)delete e.map_options;else if(f=e.map_options,"map_osm"==e.type){"OSM"!=f.type&&console.warn(e.name+
" problem with data type :",f);if("object"!=typeof f.center)return console.error(e.name+"have no center's parameter :",f),null;var g=f.center;if(Array.isArray(g.coord)||Array.isArray(g.extent)){if(2!=g.coord.length&&Array.isArray(g.coord))return console.error(e.name+" bad parameters for center :",f),null;if(4!=g.extent.length&&Array.isArray(g.extent))return console.error(e.name+" bad parameters for extent :",f),null}else return console.error(e.name+" have no correct coordinate :",f),null;if(Array.isArray(g.coord)&&
"undefined"==typeof g.zoom&&"undefined"==typeof g.scale)return console.error(e.name+" center parameter need a scale value :",f),null;"undefined"==typeof g.zoom&&"undefined"!=typeof g.scale?delete g.zoom:"undefined"!=typeof g.zoom&&"undefined"==typeof g.scale&&delete g.scale;if("object"!=typeof f.controls)return console.error(e.name+" have no control's parameter :",f),null;if(4!=Object.keys(f.controls).length)return console.error(e.name+" bad control's parameter :",f),null;Array.isArray(f.layers)?
0==f.layers.length&&delete f.layers:console.warn(e.name+" layers problem :",f);if("object"!=typeof f.interactions)return console.error(e.name+" have no interactions's parameter :",f),null;if(7!=Object.keys(f.interactions).length)return console.error(e.name+" bad interactions's parameter :",f),null;"undefined"==typeof f.draw_color&&delete f.draw_color;Array.isArray(f.features)?0==f.features.length&&delete f.features:console.warn(e.name+" bad type for features :",f);"undefined"==typeof f.coord_accuracy&&
(f.coord_accuracy=8)}else if("map_bing"==e.type){"bing"!=f.type&&console.warn(e.name+" preoblem with data type :",f);if("object"!=typeof f.center)return console.error(e.name+"have no center's parameter :",f),null;g=f.center;if(Array.isArray(g.coord)||Array.isArray(g.extent)){if(2!=g.coord.length&&Array.isArray(g.coord))return console.error(e.name+" bad parameters for center :",f),null;if(4!=g.extent.length&&Array.isArray(g.extent))return console.error(e.name+" bad parameters for extent :",f),null}else return console.error(e.name+
" have no correct coordinate :",f),null;if(Array.isArray(g.coord)&&"undefined"==typeof g.zoom&&"undefined"==typeof g.scale)return console.error(e.name+" center parameter need a scale value :",f),null;"undefined"==typeof g.zoom&&"undefined"!=typeof g.scale?delete g.zoom:"undefined"!=typeof g.zoom&&"undefined"==typeof g.scale&&delete g.scale;if("object"!=typeof f.controls)return console.error(e.name+" have no control's parameter :",f),null;if(4!=Object.keys(f.controls).length)return console.error(e.name+
" bad control's parameter :",f),null;Array.isArray(f.layers)?0==f.layers.length&&delete f.layers:console.warn(e.name+" layers undefined :",f);if("object"!=typeof f.interactions)return console.error(e.name+" have no interactions's parameter :",f),null;if(7!=Object.keys(f.interactions).length)return console.error(e.name+" bad interactions's parameter :",f),null;"undefined"==typeof f.draw_color&&delete f.draw_color;Array.isArray(f.features)?0==f.features.length&&delete f.features:console.warn(e.name+
" bad type for features :",f);"undefined"==typeof f.coord_accuracy&&(f.coord_accuracy=8);if("object"!=typeof f.source)return console.error(e.name+" have no source's parameter :",f),null;if(3!=Object.keys(f.source).length)return console.error(e.name+" bad source's parameter :",f),null}else if("map_vmap"==e.type){"vmap"!=f.type&&console.warn(e.name+" preoblem with data type :",f);if("object"!=typeof f.center)return console.error(e.name+"have no center's parameter :",f),null;g=f.center;if(Array.isArray(g.coord)||
Array.isArray(g.extent)){if(2!=g.coord.length&&Array.isArray(g.coord))return console.error(e.name+" bad parameters for center :",f),null;if(4!=g.extent.length&&Array.isArray(g.extent))return console.error(e.name+" bad parameters for extent :",f),null}else return console.error(e.name+" have no correct coordinate :",f),null;if(Array.isArray(g.coord)&&"undefined"==typeof g.zoom&&"undefined"==typeof g.scale)return console.error(e.name+" center parameter need a scale value :",f),null;"undefined"==typeof g.zoom&&
"undefined"!=typeof g.scale?delete g.zoom:"undefined"!=typeof g.zoom&&"undefined"==typeof g.scale&&delete g.scale;if("object"!=typeof f.controls)return console.error(e.name+" have no control's parameter :",f),null;if(4!=Object.keys(f.controls).length)return console.error(e.name+" bad control's parameter :",f),null;Array.isArray(f.layers)?0==f.layers.length&&delete f.layers:console.warn(e.name+" bad type for layers :",f);if("object"!=typeof f.interactions)return console.error(e.name+" have no interactions's parameter :",
f),null;if(7!=Object.keys(f.interactions).length)return console.error(e.name+" bad interactions's parameter :",f),null;"undefined"==typeof f.draw_color&&delete f.draw_color;Array.isArray(f.features)?0==f.features.length&&delete f.features:console.warn(e.name+" bad type for features :",f);"undefined"==typeof f.coord_accuracy&&(f.coord_accuracy=8);if("object"!=typeof f.tree)return console.error(e.name+" have no tree object :",f),null;if(0==Object.keys(f.tree).length)return console.error(e.name+" empty tree :",
f),null}"undefined"==typeof e.nb_cols&&(e.nb_cols=12);f="type id label name required map_options nb_cols".split(" ")}for(var h in e)-1===f.indexOf(h)&&delete e[h];d++}else console.error("error on fields integrity, this fields who have been deleted in row "+c+" :",b.rows[c].fields),delete b.rows[c].fields;c++}return a};Aw.JsonOptimizer=Aw.Mp;
Aw.Zf=function(a,b){a=m(a)?a:"";if(b=m(b)?b:!1)return this.Zf(a);a=a.replace(",",".");b=a.split(".");if(0===b.length)return NaN;if(1===b.length)return this.Zf(a);if(2<=b.length){a=this.Zf(b[0]);if(2===b.length)b=this.Zf(b[1]);else{for(var c="",d=1;d<b.length;d++)c+=b[d];b=this.Zf(c)}return parseFloat(a+"."+b)}return NaN};Aw.Zf=function(a){for(var b="",c=0;c<a.length;c++){var d=a.charAt(c);isNan(parseInt(d))||(b+=d)}return parseInt(b)};Aw.numberParser=Aw.Zf;
Aw.getElementsByName=function(a,b,c){var d=[];if(null==c||null==a[b]||null==a[b].rows)return d;for(var e=0;e<a[b].rows.length;e++)if(null!=a[b].rows[e].fields)for(var f=0;f<a[b].rows[e].fields.length;f++)a[b].rows[e].fields[f].name===c&&d.push(a[b].rows[e].fields[f]);return d};oProperties={mode:"dev",timeNotify:2500};function Bw(){X.log("nsVFB.JsonLoader");this.Oi=null;X.module.directive("appJsonLoader",this.Aw);X.module.controller("AppJsonLoaderController",["$http","$scope","$rootScope","$timeout",this.Aa])}ta("nsVFB.JsonLoader",Bw);Bw.prototype.Aw=function(){X.log("nsVFB.JsonLoader.jsonLoaderDirective");return{restrict:"A",replace:!0,controller:"AppJsonLoaderController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/JsonLoader.html"}};
Bw.prototype.jsonLoaderDirective=Bw.prototype.Aw;
Bw.prototype.Aa=function(a,b,c,d){X.log("nsVFB.JsonLoader.jsonLoaderController");var e=this;this.V=a;this.f=b;this.G=c;this.iz={};this.buttonHide=!1;this.applicationName=X.ci();b.collapsed=X.ug[0];b.iWorkspaceId=X.Fb();b.iWorkSpace=X.Fb();b["default"]="Default";b.FormSelected="Perso";b.token=X.pb();c.selected_form_type=X.config.default_form_type;c.$watch("selected_form_type",function(a){X.log("jsonLoaderController selected_form_type");var b=X.ha();null==b[a]&&(b[a]={name:"custom-form",title:"",input_size:"xxs",
nb_cols:12,javascript:!1,rows:[]},X.gc(b));c.$broadcast("updateEvent",X.ha());c.$broadcast("update element",{type:"undefined"})});X.Gg().Oi=new Slider("#slider_Form",{formatter:function(a){return Math.round(100*a/12)+"%"}});X.Gg().Oi.on("change",function(){var a=X.ha();a[c.selected_form_type].nb_cols=X.Gg().Oi.getValue();X.gc(a);d(function(){c.$broadcast("updateJsonModel",X.ha());c.$broadcast("updateForm",X.ha());b.$apply()},1)});b.$watch("title",function(a){X.log("jsonLoaderController title");var b=
X.ha();b[c.selected_form_type]&&(b[c.selected_form_type].title=a);X.gc(b);c.$broadcast("updateJsonModel",X.ha());c.$broadcast("updateForm",X.ha())});b.$watch("event",function(a){X.log("jsonLoaderController event");var b=X.ha();b[c.selected_form_type]&&(b[c.selected_form_type].event=a);X.gc(b);c.$broadcast("updateJsonModel",X.ha());c.$broadcast("updateForm",X.ha())});b.$watch("token",function(a){X.log("jsonLoaderController token");X.setToken(a)});b.$watch("iWorkspaceId",function(a){X.log("jsonLoaderController id");
X.setId(a)});b.$watch("text",function(){X.log("jsonLoaderController text");"undefined"!==typeof b.text.Loader&&(e.text=b.text.Loader,d(function(){angular.element($("#load_Perso_button")).click();"wab"==X.ci()&&(e.buttonHide=!0)},500))});b.state=!1};Bw.prototype.jsonLoaderController=Bw.prototype.Aa;
function Cw(a,b){X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.requestToJson");var c=a.V,d;angular.element($("#FormModal")).scope().ctrl.xn();a.f.iWorkSpace=a.f.iWorkspaceId;a.f["default"]=a.f.FormSelected;a.f.collapsed=X.ug[0];if("gtf"===a.applicationName){var e=X.fa.web_server_name+"/"+X.fa.services_alias+"/gtf/workspaces/"+X.Fb()+"?token="+X.pb()+"&form="+a.f.FormSelected;d={Accept:"application/json"}}else"vmap"===a.applicationName?(e="Perso"===a.f.FormSelected?"custom":angular.lowercase(a.f.FormSelected),
e=X.fa.web_server_name+"/"+X.fa.services_alias+"/"+X.config.get.api+"/"+X.config.get.ressource+"/"+X.Fb()+"/forms/"+e+"/?token="+X.pb()):"wab"===a.applicationName&&(e=X.fa.web_server_name+"/"+X.fa.services_alias+"/"+X.config.get.api+"/"+X.config.get.ressource+"/"+X.Fb()+"/form?token="+X.pb());Vd();c({method:"GET",url:e,headers:d}).success(function(c){Wd();null!=c[0]||null!=c.data&&(c=c.data);if("gtf"===a.applicationName){if(null==c.workspaces&&null==c.data){var d;switch(a.f.FormSelected){case "Default":d=
"Default_Reset";break;case "Published":d="Default_Published";break;case "Perso":d="Perso_Reset"}Dw(a,d,void 0,function(b){if(null!=b.errorMessage)return bootbox.alert("<h4>"+b.errorMessage+"</h4>",function(){}),0;Cw(a)},function(b,c){$.notify(a.f.text.Loader.Notify.GetJson_Error+c,{className:"error",autoHideDelay:X.jb})})}}else if(null==c[0]){if(null!=X.config.get.no_result_function)a[X.config.get.no_result_function](c,b);return 0}Ew(a,c,b)}).error(function(b,c){Wd();ja(void 0)&&a.f.$eval(void 0);
$.notify(a.f.text.Loader.Notify.GetJson_Error+c,{className:"error",autoHideDelay:X.jb})})}
function Ew(a,b,c){X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.useJson");var d=a.V;"gtf"===a.applicationName&&(b=null!=b.workspaces?b.workspaces[0].json_form:b.data[0].json_form);if(null==b[0])console.error("data[0] not defined, data: ",b);else if(X.Dy(angular.copy(b[0])),X.gc(angular.copy(b[0])),a.iz=angular.copy(b[0]),a.f.json_forms=null!=X.config.avaliable_form_types?X.config.avaliable_form_types:Object.keys(b[0]),-1!==a.f.json_forms.indexOf("datasources")&&a.f.json_forms.splice(a.f.json_forms.indexOf("datasources"),
1),m(b[1])&&!1!==b[1]?"gtf"===a.applicationName?d({method:"GET",url:b[1]}).then(function(a){null!=a.data&&X.hk(a.data.replace(/(?:\r\n|\r|\n)/g,"\r\n"))},function(a){console.error("Problem on Loading javascript");console.error(a)}):X.hk(X.clone(b[1])):X.hk(""),a.G.$broadcast("updateJS",X.Pf()),m(b[2])&&!1!==b[2]&&(X.Fs(X.clone(b[2])),a.G.$broadcast("updateCSS",b[2])),null==b[0][a.G.selected_form_type])console.error("Result[0]["+a.G.selected_form_type+"] does not exist");else{b=b[0][a.G.selected_form_type].nb_cols;
var d=X.ha()[a.G.selected_form_type].title,e=X.ha()[a.G.selected_form_type].event,f=X.ha()[a.G.selected_form_type].input_size;X.Gg().Oi.setValue(b);a.f.title=d;a.f.event=e;a.f.input_size=f;a.G.$broadcast("updateEvent",X.ha());a.G.$broadcast("updateInfos",X.ha());a.G.$broadcast("update element",{type:"undefined"});ja(c)&&a.f.$eval(c);setTimeout(function(){X.reloadForm()})}}Bw.prototype.Aa.prototype.load=function(a){X.log("load");"Perso"===a?this.Ow(0,a):this.Pw(a)};Bw.prototype.Aa.prototype.load=Bw.prototype.Aa.prototype.load;
Bw.prototype.Aa.prototype.tI=function(){var a=X.ha()[this.G.selected_form_type].nb_cols;X.Gg().Oi.setValue(a)};Bw.prototype.Aa.prototype.updateSlider=Bw.prototype.Aa.prototype.tI;
Bw.prototype.Aa.prototype.Ow=function(a,b){function c(){$("#up_element_button").prop("disabled",!1);$("#down_element_button").prop("disabled",!1);$("#add_line_button").prop("disabled",!1);$("#add_row_button").prop("disabled",!1);$("#rem_element_button").prop("disabled",!1);$("#formTools_datasoure_button").prop("disabled",!1);$("#Title_Form_input").prop("disabled",!1);$("#select_size_input").prop("disabled",!1);X.Gg().Oi.enable();$("#boolean-JS-include").prop("disabled",!1);$("#boolean-CSS-include").prop("disabled",
!1);$("#Lock_Icon").removeClass("fa-lock");$(".selected-in-tree").removeClass("selected-in-tree")}X.log("nsVFB.JsonLoader.jsonLoaderController.loadWithEdit");var d=this;X.On().empty||"Perso"!==d.f["default"]?"Perso"!==d.f["default"]?(d.f.FormSelected=b,Cw(d),c()):(Cw(d),d.f.FormSelected=b):bootbox.confirm("<h4>"+this.text.Confirmation.Lose+"</h4>",function(a){!0===a&&(angular.element($("#FormModal")).scope().ctrl.xn(),d.f.FormSelected=b,Cw(d),c())})};Bw.prototype.Aa.prototype.loadWithEdit=Bw.prototype.Aa.prototype.Ow;
Bw.prototype.Aa.prototype.Pw=function(a){function b(){$("#up_element_button").prop("disabled",!0);$("#down_element_button").prop("disabled",!0);$("#add_line_button").prop("disabled",!0);$("#add_row_button").prop("disabled",!0);$("#rem_element_button").prop("disabled",!0);$("#formTools_datasoure_button").prop("disabled",!0);$("#Title_Form_input").prop("disabled",!0);$("#select_size_input").prop("disabled",!0);X.Gg().Oi.disable();$("#boolean-JS-include").prop("disabled",!0);$("#boolean-CSS-include").prop("disabled",
!0);c.G.$broadcast("update element",{});$("#Lock_Icon").addClass("fa-lock");$(".selected-in-tree").removeClass("selected-in-tree")}X.log("nsVFB.JsonLoader.jsonLoaderController.loadWithoutEdit");var c=this;X.On().empty||"Perso"!==c.f["default"]?"Perso"!==c.f["default"]&&(c.f.FormSelected=a,Cw(c),b()):angular.equals(X.On(),c.iz)?(angular.element($("#FormModal")).scope().ctrl.xn(),c.f.FormSelected=a,Cw(c),b()):bootbox.sJ({message:"<h4>"+c.text.Confirmation.Lose+"<br><br>"+c.text.Confirmation.SaveAndChange+
" ?</h4>",buttons:{success:{label:c.text.Confirmation.Yes,className:"btn-primary",sb:function(){c.save(function(){c.f.FormSelected=a;Cw(c);b()})}},qJ:{label:c.text.Confirmation.No,className:"btn-danger",sb:function(){c.f.FormSelected=a;Cw(c);b()}},JJ:{label:c.text.Confirmation.Cancel,className:"btn-default",sb:function(){}}}})};Bw.prototype.Aa.prototype.loadWithoutEdit=Bw.prototype.Aa.prototype.Pw;
Bw.prototype.Aa.prototype.resize=function(){this.f.collapsed=!this.f.collapsed;X.ug[0]=this.f.collapsed;X.resize()};Bw.prototype.Aa.prototype.resize=Bw.prototype.Aa.prototype.resize;
Bw.prototype.Aa.prototype.save=function(a,b){function c(a,c){ja(b)&&e.f.$eval(b);$.notify(e.f.text.Loader.Notify.SaveData_Error+c,{className:"error",autoHideDelay:X.jb})}function d(){Cw(e,a);$.notify(e.f.text.Loader.Notify.SaveData,{className:"success",autoHideDelay:X.jb})}X.log("nsVFB.JsonLoader.jsonLoaderController.save");var e=this,f=new FormData,g=X.ha();X.xf();"gtf"===this.applicationName&&(g[e.G.selected_form_type].name="WSubform",g.display=g[e.G.selected_form_type],g.update=g[e.G.selected_form_type]);
m(g.search)||(g.search={});f.append("Json",JSON.stringify(g));f.append("Js",X.Pf());f.append("Css",X.di());X.valid=Fw(this,g);X.valid&&null!==g?Dw(e,"Perso_Save",f,d,c):$.notify(e.f.text.Loader.Notify.Validation_Error+": "+X.cj,{className:"error",autoHideDelay:X.jb})};Bw.prototype.Aa.prototype.save=Bw.prototype.Aa.prototype.save;
Bw.prototype.Aa.prototype.XF=function(){function a(a,b){$.notify(c.f.text.Loader.Notify.SaveData_Error+b,{className:"error",autoHideDelay:X.jb})}function b(){Dw(c,c.f.FormSelected+"_Published","",function(){Cw(c);$.notify(c.f.FormSelected+c.f.text.Loader.Notify.PublishAndSave,{className:"success",autoHideDelay:X.jb})},function(a,b){$.notify(c.f.text.Loader.Notify.Publish_Error+b,{className:"error",autoHideDelay:X.jb})})}X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.publish");var c=this,d=
new FormData,e=X.ha();X.xf();"gtf"===this.applicationName&&(e[c.G.selected_form_type].name="WSubform",e.display=e[c.G.selected_form_type],e.update=e[c.G.selected_form_type]);d.append("Json",JSON.stringify(e));d.append("Js",X.Pf());d.append("Css",X.di());X.valid?"Default"!=c.f.FormSelected?Dw(c,"Perso_Save",d,b,a):Dw(c,"Default_Published",d,b,a):$.notify(c.f.text.Loader.Notify.Validation_Error,{className:"error",autoHideDelay:X.jb})};Bw.prototype.Aa.prototype.publish=Bw.prototype.Aa.prototype.XF;
function Fw(a,b){X.log("nsVFB.JsonLoader.jsonLoaderController.save");Ua(X.cj);for(var c in b)if("datasources"!==c&&null!=b[c].rows)for(var d=0;d<b[c].rows.length;d++)for(var e=0;e<b[c].rows[d].fields.length;e++)null!==b[c].rows[d].fields[e].name.match(/\s/g)&&("gtf"===a.applicationName?X.cj.push(b[c].rows[d].fields[e].name):1>X.config.avaliable_form_types.length?X.cj.push(b[c].rows[d].fields[e].name):X.cj.push(c+"."+b[c].rows[d].fields[e].name));return 0<X.cj.length?!1:!0}
Bw.prototype.Aa.prototype.reset=function(){X.log("nsVFB.JsonLoader.jsonLoaderController.reset");var a=this;bootbox.confirm("<h4>"+this.text.Confirmation.Lose+"</h4>",function(b){if(!0===b)if("Default"===a.f.FormSelected&&"gtf"!==a.applicationName){if(null!=X.config.reset_default_function)a[X.config.reset_default_function]()}else Dw(a,a.f.FormSelected+"_Reset","",function(){$.notify(a.f.FormSelected+a.f.text.Loader.Notify.Reset,{className:"success",autoHideDelay:X.jb});"Perso"===a.f.FormSelected&&
Cw(a)},function(b,d){$.notify(a.f.text.Loader.Notify.Reset_Error+d,{className:"error",autoHideDelay:X.jb})})})};Bw.prototype.Aa.prototype.reset=Bw.prototype.Aa.prototype.reset;
function Dw(a,b,c,d,e){X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.putRequest");var f="";"gtf"===a.applicationName?f=X.fa.web_server_name+"/"+X.fa.services_alias+"/gtf/workspaces/"+X.Fb()+"?token="+X.pb()+"&cmd="+b:"vmap"===a.applicationName?(f="Perso"===a.f.FormSelected?"custom":angular.lowercase(a.f.FormSelected),f=X.fa.web_server_name+"/"+X.fa.services_alias+"/"+X.config.get.api+"/"+X.config.get.ressource+"/"+X.Fb()+"/forms/"+f+"/?token="+X.pb()+"&cmd="+b):"wab"===a.applicationName&&
(f=X.fa.web_server_name+"/"+X.fa.services_alias+"/"+X.config.get.api+"/"+X.config.get.ressource+"/"+X.Fb()+"/form?token="+X.pb());a.V({url:f,method:"PUT",data:c,headers:{"Content-Type":"undefined"}}).success(d).error(e)}Bw.prototype.Aa.prototype.AH=function(){X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.suggestGenerateForm");var a=this;bootbox.confirm("<h4>"+this.f.text.Loader.Notify.generate_form+"</h4>",function(b){!0===b?a.Wy():(a.aSuggestedTableFields=[],a.Qq())})};
Bw.prototype.Aa.prototype.suggestGenerateForm=Bw.prototype.Aa.prototype.AH;
Bw.prototype.Aa.prototype.yI=function(a,b){X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.useEmptyForm");$.notify(this.f.text.Loader.Notify.no_form,"warning");var c=m(X.config.avaliable_form_types)?X.config.avaliable_form_types:["search","insert","update","display"],d={input_size:"xxs",javascript:!1,name:"custom-form",nb_cols:12,rows:[],title:""};a[0]={datasources:{}};for(var e=0;e<c.length;e++)a[0][c[e]]=d;Ew(this,a,b)};Bw.prototype.Aa.prototype.useEmptyForm=Bw.prototype.Aa.prototype.yI;
Bw.prototype.Aa.prototype.Wy=function(){X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.suggestColumnsToGenerateForm");var a=X.fa.web_server_name+"/"+X.fa.services_alias+"/vmap/businessobjects/"+X.Fb()+"/fields/?token="+X.pb();"wab"===X.ci()&&(a=X.fa.web_server_name+"/"+X.fa.services_alias+"/wab/sections/"+X.Fb()+"/fields?token="+X.pb());var b=this;m(b.aSuggestedTableFields)&&Ua(b.aSuggestedTableFields);this.V({url:a,method:"GET"}).success(function(a){if(fa(a)&&0!==a.length)b.aSuggestedTableFields=
a,$("#select-fields-modal").modal("show");else{var c=angular.element(z.b).scope();c.$root.modalWindow("confirm",b.f.text.Loader.Notify.generate_form_error,{className:"modal-danger",message:b.f.text.Loader.Notify.generate_form_error_description,buttons:{cancel:{label:'<i class="glyphicon glyphicon-remove"></i> Annuler',className:"btn-default"},confirm:{label:'<i class="glyphicon glyphicon-ok"></i> Poursuivre quand m\u00eame',className:"btn-danger"}},callback:function(a){!0===a?(b.aSuggestedTableFields=
[],b.Qq()):c.setMode("search")}})}}).error(function(){$.notify(b.f.text.Loader.Notify.CreateJson_Error+status,{className:"error",autoHideDelay:X.jb})})};Bw.prototype.Aa.prototype.suggestColumnsToGenerateForm=Bw.prototype.Aa.prototype.Wy;
Bw.prototype.Aa.prototype.Qq=function(){X.log("nsVFB.JsonLoader.prototype.jsonLoaderController.prototype.generateFormByBusinessObject");var a=this,b="",b="Perso"===a.f.FormSelected?"custom":"Default"===a.f.FormSelected?"default":"published",b=X.fa.web_server_name+"/"+X.fa.services_alias+"/vmap/businessobjects/"+X.Fb()+"/forms/"+b+"/?token="+X.pb();"wab"===X.ci()&&(b=X.fa.web_server_name+"/"+X.fa.services_alias+"/wab/sections/"+X.Fb()+"/form?token="+X.pb());for(var c=[],d={},e=0;e<a.aSuggestedTableFields.length;e++)!0===
a.aSuggestedTableFields[e].fields[0].bUseForGenerate&&c.push(a.aSuggestedTableFields[e].fields[0].name),d[a.aSuggestedTableFields[e].fields[0].name]=a.aSuggestedTableFields[e].fields[0].label;c=c.toString().replace(/,/gi,"|");$("#select-fields-modal").modal("hide");"Default"===a.f.FormSelected?Dw(a,a.f.FormSelected+"_Reset",{field:c,label:d},function(){$.notify(a.f.FormSelected+a.f.text.Loader.Notify.Reset,{className:"success",autoHideDelay:X.jb});"Default"===a.f.FormSelected&&Cw(a)},function(b,c){$.notify(a.f.text.Loader.Notify.Reset_Error+
c,{className:"error",autoHideDelay:X.jb})}):this.V({url:b,method:"POST",data:{fields:c,label:d}}).success(function(){Cw(a)}).error(function(){$.notify(a.f.text.Loader.Notify.CreateJson_Error+status,{className:"error",autoHideDelay:X.jb})})};Bw.prototype.Aa.prototype.generateFormByBusinessObject=Bw.prototype.Aa.prototype.Qq;function Gw(){X.log("nsVFB.FormTools");X.module.directive("appFormTools",this.Nv);X.module.controller("AppFormToolsController",["$scope","$rootScope","$timeout",this.Eb])}ta("nsVFB.FormTools",Gw);Gw.prototype.Nv=function(){X.log("nsVFB.FormTools.FormToolsDirective");return{restrict:"A",replace:!0,controller:"AppFormToolsController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/FormTools.html"}};Gw.prototype.formToolsDirective=Gw.prototype.Nv;
Gw.prototype.Eb=function(a,b,c){X.log("nsVFB.FormTools.FormToolsController");var d=this;this.G=b;this.f=a;this.Lq=0;this.applicationName=X.ci();this.bTreeWithLines_=!1;a.$watch("text",function(){X.log("formtools text");m(a.text.FormTools)&&(d.text=a.text.FormTools)});a.colapse_tools=X.ug[2];d.av=function(a){X.log("nsVFB.FormTools.convertJson");var c=X.ha(),d=[];if(!m(c))return console.error("No JSON founded"),d;a=m(a)?a:!0;if(c[b.selected_form_type]){for(var e=0;e<c[b.selected_form_type].rows.length;e++){!0===
a&&null!=this.text&&d.push({text:this.text.Row+" "+e,state:{expanded:!0},tags:[0],nodes:[],row:e,draggable:!0});for(var f=0;f<c[b.selected_form_type].rows[e].fields.length;f++){var g;switch(c[b.selected_form_type].rows[e].fields[f].type){case "codemirror":g="icon-code";break;case "select":case "list":case "double_select":g="icon-format_list_bulleted";break;case "text":case "tinymce":g="icon-font";break;case "upload":g="icon-file";break;case "checkbox":g="icon-check-square";break;case "radio":g="icon-dot-circle-o";
break;case "date":case "datetime":g="icon-calendar-check-o";break;case "password":g="icon-key";break;case "email":g="icon-at";break;case "url":g="icon-chrome";break;case "integer":case "float":case "number":g="icon-calculator";break;case "color_picker":g="icon-paint";break;case "slider":g="icon-sliders";break;case "textarea":g="icon-paragraph";break;case "hr":g="icon-minus";break;case "label":g="icon-eye";break;case "email":g="icon-at";break;case "hidden":g="icon-user-secret";break;case "link":g=
"glyphicon glyphicon-link";break;case "image":g="glyphicon glyphicon-picture";break;case "map_bing":case "map_osm":case "map_vmap":g="icon-map";break;default:g="icon-point"}!0===a?null!=d[e]&&(d[e].tags[0]+=1,d[e].nodes.push({text:"  "+c[b.selected_form_type].rows[e].fields[f].name,type:c[b.selected_form_type].rows[e].fields[f].type,icon:g,row:e,field:f,draggable:!0})):d.push({text:"  "+c[b.selected_form_type].rows[e].fields[f].name,type:c[b.selected_form_type].rows[e].fields[f].type,icon:g,row:e,
field:f,draggable:!0})}}return d}};a.$on("updateEvent",function(){var e=d.av(!0),f=$("#treeWithLines").treeview("getCollapsed");if(!m(e))return console.error("No JSON converted founded"),0;if(!m(f))return console.error("collapsedNodes undefined"),0;for(var g=0;g<e.length;g++)e[g].collapsed=!1;for(g=0;g<f.length;g++)if(m(f[g].nodes))for(var r=0;r<e.length;r++)f[g].row===e[r].row&&(e[r].collapsed=!0);$("#treeWithLines").treeview({data:e,showTags:!0,showBorder:!1,expandIcon:"glyphicon glyphicon-menu-right",
collapseIcon:"glyphicon glyphicon-menu-down",onNodeSelected:function(a,e){m(e.field)?(c(function(){var a=$("#treeView").treeview("search",[e.text,{ignoreCase:!0,exactMatch:!0,revealResults:!1}]);$("#treeView").treeview("selectNode",[a[0].nodeId,{Cd:!0}]);$("#treeView").treeview("clearSearch")}),d.Ks({type:"element",element_name:e.text.replace(/\s/g,"")}),b.$broadcast("update element",X.ha()[b.selected_form_type].rows[e.row].fields[e.field])):d.Ks({type:"row",row_id:parseInt(e.row)})},onNodeUnselected:function(){X.xf()},
onNodeHoverIn:function(a){a=a.currentTarget;$(a)[0].childNodes[2].data?(a=$(a)[0].childNodes[2].data.split(" "),a={type:"row",row_id:parseInt(a[1])}):a={type:"element",element_name:$(a)[0].textContent.replace(/\s/g,"")};d.km(a)},onNodeHoverOut:function(){d.km({})},highlightSelected:!0,multiSelect:!1});$("#treeView").treeview({data:d.av(!1),showTags:!1,showBorder:!1,levels:1,showIcon:!0,onNodeSelected:function(b,c){"undefined"!==typeof c.field&&(b=$("#treeWithLines").treeview("search",[c.text,{ignoreCase:!0,
exactMatch:!0,revealResults:!1}]),c=$("#treeWithLines").treeview("search",[a.$parent.text.FormTools.Row+" "+b[0].row,{ignoreCase:!0,exactMatch:!0,revealResults:!1}]),$("#treeWithLines").treeview("expandNode",[c[0].nodeId,{Cd:!0}]),$("#treeWithLines").treeview("selectNode",[b[0].nodeId,{Cd:!1}]),$("#treeWithLines").treeview("clearSearch"))},onNodeUnselected:function(){X.xf()},onNodeHoverIn:function(a){d.km({type:"element",element_name:$(a.currentTarget)[0].textContent.replace(/\s/g,"")})},onNodeHoverOut:function(){d.km({})},
highlightSelected:!0,multiSelect:!1});e=$("#treeWithLines").treeview("getEnabled");for(g=0;g<e.length;g++)!0===e[g].collapsed&&$("#treeWithLines").treeview("collapseNode",e[g])});var e={},f={},g=!0;document.getElementById("treeWithLines").addEventListener("dragstart",function(a){$("#load_Perso_button").hasClass("active")&&(a.dataTransfer.setData("Text",a.target.id),a.target.style.opacity="0.5",a.dataTransfer.effectAllowed="move",e=a.target,X.pm("FormTools"))});document.getElementById("treeWithLines").addEventListener("dragover",
function(a){a.preventDefault()});document.getElementById("treeWithLines").addEventListener("dragenter",function(a){$("#load_Perso_button").hasClass("active")&&(a=a.target,"FormTools"===X.pl()&&($(a).trigger("mouseover"),a!==e&&"LI"===$(a)[0].tagName&&($(e).remove(),parseInt($(f).attr("data-nodeid"))<parseInt($(a).attr("data-nodeid"))?$(e).insertAfter(a):$(e).insertBefore(a),$(f).trigger("mouseout"),f=a)))});document.getElementById("treeWithLines").addEventListener("drop",function(){if($("#load_Perso_button").hasClass("active")){var c=
0,g=0,n=X.ha(),r=0;if("FormTools"===X.pl())if(e.style.opacity="1","indent"===e.childNodes[0].className){var t=g=0;if("indent"===f.childNodes[0].className){var g=parseInt($(e).attr("data-nodeid")),t=$("#treeWithLines").treeview("getNode",g).row,g=$("#treeWithLines").treeview("getNode",g).field,c=parseInt($(f).attr("data-nodeid")),v=$("#treeWithLines").treeview("getNode",c).row,c=$("#treeWithLines").treeview("getNode",c).field,r=n[b.selected_form_type].rows[t].fields[g];n[b.selected_form_type].rows[t].fields.splice(g,
1);n[b.selected_form_type].rows[v].fields.splice(c,0,r);t!==v&&(Hw(n[b.selected_form_type].rows[t]),Hw(n[b.selected_form_type].rows[v]))}else g=parseInt($(e).attr("data-nodeid")),t=$("#treeWithLines").treeview("getNode",g).row,g=$("#treeWithLines").treeview("getNode",g).field,c=parseInt(f.childNodes[2].data.split(" ")[1]),r=n[b.selected_form_type].rows[t].fields[g],n[b.selected_form_type].rows[t].fields.splice(g,1),n[b.selected_form_type].rows[c].fields.unshift(r),Hw(n[b.selected_form_type].rows[t]),
Hw(n[b.selected_form_type].rows[c]);0===n[b.selected_form_type].rows[t].fields.length&&n[b.selected_form_type].rows.splice(t,1)}else"indent"===f.childNodes[0].className?$.notify(d.text.Notify.Error_ElOnRow,{className:"error",autoHideDelay:X.jb}):(g=parseInt(e.childNodes[2].data.split(" ")[1]),c=parseInt(f.childNodes[2].data.split(" ")[1]),r=n[b.selected_form_type].rows[g],n[b.selected_form_type].rows.splice(g,1),n[b.selected_form_type].rows.splice(c,0,r));X.gc(n);$(".hover-in-tree").each(function(a,
b){$(b).removeClass("hover-in-tree")});$(".selected-in-tree").removeClass("selected-in-tree");b.$broadcast("updateEvent",X.ha());X.pm("no tree");a.$apply()}});document.getElementById("treeView").addEventListener("dragstart",function(a){$("#load_Perso_button").hasClass("active")&&(a.dataTransfer.setData("Text",a.target.id),a.target.style.opacity="0.5",a.dataTransfer.effectAllowed="move",e=a.target,X.pm("treeView"))});document.getElementById("treeView").addEventListener("dragover",function(a){a.preventDefault()});
document.getElementById("treeView").addEventListener("dragenter",function(a){$("#load_Perso_button").hasClass("active")&&(a=a.target,"treeView"===X.pl()&&($(a).trigger("mouseover"),a!==e&&"LI"===$(a)[0].tagName&&(parseInt($(f).attr("data-nodeid"))<parseInt($(a).attr("data-nodeid"))?($(e).remove(),$(e).insertAfter(a),$(f).trigger("mouseout"),f=a,g=!1):($(e).remove(),$(e).insertBefore(a),$(f).trigger("mouseout"),f=a,g=!0))))});document.getElementById("treeView").addEventListener("drop",function(){if($("#load_Perso_button").hasClass("active")){var c=
0,d=0,n=X.ha(),r=0;if("treeView"===X.pl()){e.style.opacity="1";var d=parseInt($(e).attr("data-nodeid")),t=$("#treeView").treeview("getNode",d).row,d=$("#treeView").treeview("getNode",d).field,c=parseInt($(f).attr("data-nodeid")),v=$("#treeView").treeview("getNode",c).row,c=$("#treeView").treeview("getNode",c).field,r=n[b.selected_form_type].rows[t].fields[d];n[b.selected_form_type].rows[t].fields.splice(d,1);g||(c+=1);n[b.selected_form_type].rows[v].fields.splice(c,0,r);0===n[b.selected_form_type].rows[t].fields.length&&
n[b.selected_form_type].rows.splice(t,1)}X.gc(n);$(".hover-in-tree").each(function(a,b){$(b).removeClass("hover-in-tree")});$(".selected-in-tree").removeClass("selected-in-tree");b.$broadcast("updateEvent",X.ha());a.$apply();X.pm("no tree")}});d.resize=function(){a.colapse_tools=!a.colapse_tools;X.ug[2]=a.colapse_tools;X.resize()}};Gw.prototype.formToolsController=Gw.prototype.Eb;
Gw.prototype.Eb.prototype.Ih=function(){X.log("nsVFB.FormTools.prototype.formToolsController.prototype.addLine");var a=$("#treeWithLines").treeview("getSelected"),b=X.ha();1!==a.length&&(a=[Iw(this)]);m(a[0].field)&&(a=[$("#treeWithLines").treeview("getNode",a[0].parentId)]);1===a.length?m(a[0].field)||b[this.G.selected_form_type].rows.splice(a[0].row+1,0,{fields:[]}):$.notify(this.text.Notify.Forgotten,{className:"error",autoHideDelay:X.jb});$(".selected-in-tree").each(function(a,b){$(b).removeClass("selected-in-tree")});
X.gc(b);this.G.$broadcast("updateEvent",X.ha())};Gw.prototype.Eb.prototype.addLine=Gw.prototype.Eb.prototype.Ih;
Gw.prototype.Eb.prototype.addElement=function(){X.log("nsVFB.FormTools.prototype.formToolsController.prototype.addElement");var a=this,b=$("#treeWithLines").treeview("getSelected"),c=X.ha(),d=!1;if(1!==b.length){var e=Iw(this);if(this.bTreeWithLines_||!m(e.nodes))this.Ih(),e=Iw(this),d=!0;b=[e]}if(1===b.length){var f=function(b){for(var c=0;c<b.length;c++)if(m(b[c].fields))for(var d=0;d<b[c].fields.length;d++)if(b[c].fields[d].name==="Element_"+a.Lq){a.Lq++;f(b);return}},g=X.ha()[this.G.selected_form_type].rows;
f(g);var g="Element_"+this.Lq,e={type:"text",name:g,label:"",required:!1,pattern:"",nb_cols:12},h=b[0].nodeId;this.bTreeWithLines_?(c[this.G.selected_form_type].rows[b[0].row].fields.splice(b[0].field+1,0,e),h+=1):d?(c[this.G.selected_form_type].rows[b[0].row].fields.push(e),h+=2):(this.Ih(),c[this.G.selected_form_type].rows[b[0].row+1].fields.push(e),e=Iw(this).nodeId+1,h=b[0].row+1===c[this.G.selected_form_type].rows.length-1?h+2+c[this.G.selected_form_type].rows[b[0].row].fields.length:h+1+c[this.G.selected_form_type].rows[b[0].row].fields.length);
Hw(c[this.G.selected_form_type].rows[b[0].row]);null!=c[this.G.selected_form_type].tabs&&null!=c[this.G.selected_form_type].tabs.list&&null!=c[this.G.selected_form_type].tabs.list[0]&&fa(c[this.G.selected_form_type].tabs.list[0].elements)&&c[this.G.selected_form_type].tabs.list[0].elements.push(g);X.gc(c);this.G.$broadcast("updateEvent",X.ha());$("#TreeView_Button_Group").confirmation("destroy");$("#treeWithLines").treeview("selectNode",[h,{Cd:!1}])}else $.notify(this.text.Notify.Forgotten,{className:"error",
autoHideDelay:X.jb})};Gw.prototype.Eb.prototype.addElement=Gw.prototype.Eb.prototype.addElement;
Gw.prototype.Eb.prototype.mG=function(){X.log("nsVFB.FormTools.prototype.formToolsController.prototype.removeElement");var a=$("#treeWithLines").treeview("getSelected"),b=X.ha(),c=this;if(0===a.length)return $.notify(this.text.Notify.Forgotten,{className:"error",autoHideDelay:X.jb}),0;if(m(a[0].nodes)&&1<a[0].nodes.length)return $.notify(this.text.Notify.Multiple_elements,{className:"error",autoHideDelay:X.jb}),0;1===a.length?bootbox.confirm("<h4>"+this.text.Confirmation.Remove+"</h4>",function(d){if(!0===
d){d=b[c.G.selected_form_type].rows[a[0].row];var e=d.fields[a[0].field].name;if(null!=e&&null!=b[c.G.selected_form_type].tabs){var f=b[c.G.selected_form_type].tabs.list;if(fa(f))for(var g=0;g<f.length;g++)fa(f[g].elements)&&-1!==f[g].elements.indexOf(e)&&f[g].elements.splice(f[g].elements.indexOf(e),1)}if(null!=e&&(f=b[c.G.selected_form_type].wab,null!=f))for(var h in f)for(var l in f[h])null!=f[h][l][e]&&delete f[h][l][e];d.fields.splice(a[0].field,1);0===b[c.G.selected_form_type].rows[a[0].row].fields.length&&
b[c.G.selected_form_type].rows.splice(a[0].row,1);Hw(d);$(".selected-in-tree").each(function(a,b){$(b).removeClass("selected-in-tree")});X.xf();X.gc(b);c.G.$broadcast("updateEvent",X.ha());c.f.$apply();$("#Formtools_buttons").confirmation("destroy");$.notify(c.text.Notify.Remove,{className:"success",autoHideDelay:X.jb})}}):$.notify(this.text.Notify.Forgotten,{className:"error",autoHideDelay:X.jb})};Gw.prototype.Eb.prototype.removeElement=Gw.prototype.Eb.prototype.mG;
Gw.prototype.Eb.prototype.sk=function(){X.log("nsVFB.FormTools.prototype.formToolsController.prototype.up");var a=$("#treeWithLines").treeview("getSelected"),b=a[0].nodeId,c=X.ha();if(1===a.length)if(m(a[0].field))if(0<=a[0].field-1)e=c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field-1],c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field-1]=c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field],c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field]=e,b--;else{var d=
c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field];if(0===a[0].row)this.Ih(),c[this.G.selected_form_type].rows[a[0].row+1].fields.push(d),c[this.G.selected_form_type].rows[a[0].row].fields.splice(a[0].field,1),d=c[this.G.selected_form_type].rows[a[0].row],c[this.G.selected_form_type].rows[a[0].row]=c[this.G.selected_form_type].rows[a[0].row+1],c[this.G.selected_form_type].rows[a[0].row+1]=d,Hw(c[this.G.selected_form_type].rows[a[0].row]),Hw(c[this.G.selected_form_type].rows[a[0].row+1]),
b=1,$("#treeWithLines").treeview("expandNode",Jw(this,b));else if(this.bTreeWithLines_)c[this.G.selected_form_type].rows[a[0].row-1].fields.push(d),c[this.G.selected_form_type].rows[a[0].row].fields.splice(a[0].field,1),Hw(c[this.G.selected_form_type].rows[a[0].row-1]),Hw(c[this.G.selected_form_type].rows[a[0].row]),0===c[this.G.selected_form_type].rows[a[0].row].fields.length&&c[this.G.selected_form_type].rows.splice(a[0].row,1),b--,a=Kw(b),$("#treeWithLines").treeview("expandNode",a);else{e=Kw(b);
if(1===e.nodes.length)return $("#treeWithLines").treeview("selectNode",[e.nodeId,{Cd:!0}]),this.sk(),0;this.Ih();c[this.G.selected_form_type].rows[a[0].row+1].fields.push(d);c[this.G.selected_form_type].rows[a[0].row].fields.splice(a[0].field,1);d=c[this.G.selected_form_type].rows[a[0].row];c[this.G.selected_form_type].rows[a[0].row]=c[this.G.selected_form_type].rows[a[0].row+1];c[this.G.selected_form_type].rows[a[0].row+1]=d;Hw(c[this.G.selected_form_type].rows[a[0].row]);Hw(c[this.G.selected_form_type].rows[a[0].row+
1])}}else{if(0<=a[0].row-1){var d=a[0].row,a=a[0],e=Kw(b),f=$("#treeWithLines").treeview("getCollapsed");a.collapsed=rb(f,a);e.collapsed=rb(f,e);!0===e.collapsed?$("#treeWithLines").treeview("collapseNode",a.nodeId):$("#treeWithLines").treeview("expandNode",a.nodeId);!0===a.collapsed?$("#treeWithLines").treeview("collapseNode",e.nodeId):$("#treeWithLines").treeview("expandNode",e.nodeId);var e;a.collapsed=e.collapsed;e.collapsed=a.collapsed;e=c[this.G.selected_form_type].rows[d-1];c[this.G.selected_form_type].rows[d-
1]=c[this.G.selected_form_type].rows[d];c[this.G.selected_form_type].rows[d]=e}a=Kw(b);b=a.nodeId;this.bTreeWithLines_||(b=a.nodes[0].nodeId)}else $.notify(this.text.Notify.Forgotten,{className:"error",autoHideDelay:X.jb});for(a=0;a<c[this.G.selected_form_type].rows.length;a++)0===c[this.G.selected_form_type].rows[a].fields.length&&c[this.G.selected_form_type].rows.splice(a,1);X.gc(c);this.G.$broadcast("updateEvent",X.ha());$("#treeWithLines").treeview("selectNode",[b,{Cd:!1}])};
Gw.prototype.Eb.prototype.up=Gw.prototype.Eb.prototype.sk;
Gw.prototype.Eb.prototype.mj=function(){X.log("nsVFB.FormTools.prototype.formToolsController.prototype.down");var a=$("#treeWithLines").treeview("getSelected"),b=a[0].nodeId,c=X.ha();if(1===a.length)if(m(a[0].field))if(a[0].field+1<c[this.G.selected_form_type].rows[a[0].row].fields.length)d=c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field+1],c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field+1]=c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field],c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field]=
d,b++;else{d=c[this.G.selected_form_type].rows[a[0].row].fields[a[0].field];if(!this.bTreeWithLines_){if(1===$("#treeWithLines").treeview("getNode",a[0].parentId).nodes.length)return $("#treeWithLines").treeview("selectNode",[a[0].parentId,{Cd:!1}]),this.mj(),0;m($("#treeWithLines").treeview("getNode",a[0].nodeId+1).nodes)&&this.Ih()}m(c[this.G.selected_form_type].rows[a[0].row+1])||this.Ih();c[this.G.selected_form_type].rows[a[0].row+1].fields.unshift(d);c[this.G.selected_form_type].rows[a[0].row].fields.splice(a[0].field,
1);Hw(c[this.G.selected_form_type].rows[a[0].row+1]);Hw(c[this.G.selected_form_type].rows[a[0].row]);$("#treeWithLines").treeview("expandNode",Jw(this,b));0===c[this.G.selected_form_type].rows[a[0].row].fields.length?c[this.G.selected_form_type].rows.splice(a[0].row,1):b++}else{if(a[0].row+1<c[this.G.selected_form_type].rows.length){var d=a[0],e=Jw(this,b),f=$("#treeWithLines").treeview("getCollapsed");d.collapsed=rb(f,d);e.collapsed=rb(f,e);!0===e.collapsed?$("#treeWithLines").treeview("collapseNode",
d.nodeId):$("#treeWithLines").treeview("expandNode",d.nodeId);!0===d.collapsed?$("#treeWithLines").treeview("collapseNode",e.nodeId):$("#treeWithLines").treeview("expandNode",e.nodeId);var d;d.collapsed=e.collapsed;e.collapsed=d.collapsed;d=c[this.G.selected_form_type].rows[a[0].row+1];c[this.G.selected_form_type].rows[a[0].row+1]=c[this.G.selected_form_type].rows[a[0].row];c[this.G.selected_form_type].rows[a[0].row]=d}else return this.bTreeWithLines_||$("#treeWithLines").treeview("selectNode",[b+
1,{Cd:!1}]),0;X.gc(c);this.G.$broadcast("updateEvent",X.ha());b=Jw(this,b).nodeId;this.bTreeWithLines_||b++}else $.notify(this.text.Notify.Forgotten,{className:"error",autoHideDelay:X.jb});X.gc(c);this.G.$broadcast("updateEvent",X.ha());$("#treeWithLines").treeview("selectNode",[b,{Cd:!1}])};Gw.prototype.Eb.prototype.down=Gw.prototype.Eb.prototype.mj;
function Iw(a){X.log("nsVFB.FormTools.prototype.formToolsController.prototype.getLastLine");for(var b=Lw(a);0<=b;b--)if(a=$("#treeWithLines").treeview("getNode",b),!m(a.field))return a;return $("#treeWithLines").treeview("getNode",0)}
function Jw(a,b){X.log("nsVFB.FormTools.prototype.formToolsController.prototype.getNextLineAfterIndex");a=Lw(a);m($("#treeWithLines").treeview("getNode",b).field)||b++;for(var c=b;c<a;c++)if(b=$("#treeWithLines").treeview("getNode",c),!m(b.field))return b;return $("#treeWithLines").treeview("getNode",0)}
function Kw(a){X.log("nsVFB.FormTools.prototype.formToolsController.prototype.getPreviousLineBeforeIndex");m($("#treeWithLines").treeview("getNode",a).field)||a--;for(var b=a-1;0<=b;b--)if(a=$("#treeWithLines").treeview("getNode",b),!m(a.field))return a;return $("#treeWithLines").treeview("getNode",0)}
function Lw(a){X.log("nsVFB.FormTools.prototype.formToolsController.prototype.getLastNodeIndex");for(var b=X.ha(),c=0,d=0;d<b[a.G.selected_form_type].rows.length;d++){c++;for(var e=0;e<b[a.G.selected_form_type].rows[d].fields.length;e++)c++}return c-1}function Hw(a){X.log("nsVFB.FormTools.prototype.formToolsController.prototype.resizeElementsOnRow");for(var b=parseInt(12/a.fields.length),c=0;c<a.fields.length;c++)a.fields[c].nb_cols=b}
Gw.prototype.Eb.prototype.Ks=function(a){angular.element($("#FormModal")).scope().ctrl.Gy(a,this.f.selected_form_type)};Gw.prototype.Eb.prototype.setSelectedElemInFormReader=Gw.prototype.Eb.prototype.Ks;Gw.prototype.Eb.prototype.km=function(a){angular.element($("#FormModal")).scope().ctrl.Cy(a,this.f.selected_form_type)};Gw.prototype.Eb.prototype.setHoveredElemInFormReader=Gw.prototype.Eb.prototype.km;function Mw(){X.log("nsVFB.nsVisualizerMode.FormMode");X.module.directive("appVisualizermodeForm",this.Cz);X.module.directive("appSpecificParam",["$timeout","$rootScope","$http","$q",this.WJ]);X.module.controller("AppVisualizermodeFormController",["$scope",this.hc])}ta("nsVFB.nsVisualizerMode.FormMode",Mw);
Mw.prototype.Cz=function(){X.log("nsVFB.VisualizerMode.FormMode.visualizerFormModeDirective");return{restrict:"A",replace:!0,controller:"AppVisualizermodeFormController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/VisualizerMode/FormMode.html"}};Mw.prototype.visualizerFormModeDirective=Mw.prototype.Cz;
Mw.prototype.hc=function(a){X.log("nsVFB.VisualizerMode.FormMode.visualizerFormModeController");this.f=a;a.sFormDefinitionName="";a.oFormValues={};a.oFormDefinition={};a.oFormScope={};a.oProperties=X.fa;a.sToken=sessionStorage.session_token;a.$on("updateEvent",function(b,c){X.log("visualizerFormModeController updateEvent");a.$broadcast("updateForm",c)});a.$on("updateForm",function(b,c){X.log("visualizerFormModeController updateForm");if(c[a.selected_form_type]){b=c[a.selected_form_type];for(var d=
0;d<b.rows.length;d++)for(var e=0;e<b.rows[d].fields.length;e++)b.rows[d].fields[e].id||(b.rows[d].fields[e].id=b.rows[d].fields[e].name+"_"+(d+1)+"_"+(e+1));a.oFormDefinition=c;a.sFormDefinitionName=a.selected_form_type;a.title=b.title;m(a.oFormValues)||(a.oFormValues={});m(a.oFormValues[a.sFormDefinitionName])||(a.oFormValues[a.sFormDefinitionName]={});angular.element($("#studio_form_reader").children()).scope().ctrl.Hi()}else X.log("visualizerFormModeController. Load JSON form fail: "+a.selected_form_type+
" undefined in ",c)});a.$on("updateDefautValue",function(a,c){angular.element($("#studio_form_reader").children()).scope().ctrl.Bp(!0,c.name)})};Mw.prototype.visualizerFormModeController=Mw.prototype.hc;
Mw.prototype.hc.prototype.Gy=function(a,b){X.log("nsVFB.nsVisualizerMode.FormMode.visualizerFormModeController.setSelectedElem");var c=this,d=this.f;setTimeout(function(){d.$evalAsync(function(){var e=d.oFormDefinition[b].rows;c.us(b);"row"===a.type&&(e[a.row_id].selected=!0);if("element"===a.type)for(var f=0;f<e.length;f++)for(var g=0;g<e[f].fields.length;g++)e[f].fields[g].name===a.element_name&&(e[f].fields[g].selected=!0);angular.element($("#studio_form_reader").children()).scope().ctrl.Hi()})})};
Mw.prototype.hc.prototype.setSelectedElem=Mw.prototype.hc.prototype.Gy;Mw.prototype.hc.prototype.Cy=function(a,b){var c=this,d=this.f;d.$evalAsync(function(){var e=d.oFormDefinition[b].rows;c.rs(b);"row"===a.type&&(e[a.row_id].hovered=!0);if("element"===a.type)for(var f=0;f<e.length;f++)for(var g=0;g<e[f].fields.length;g++)e[f].fields[g].name===a.element_name&&(e[f].fields[g].hovered=!0);angular.element($("#studio_form_reader").children()).scope().ctrl.Hi()})};
Mw.prototype.hc.prototype.setHoveredElem=Mw.prototype.hc.prototype.Cy;Mw.prototype.hc.prototype.us=function(a){X.log("nsVFB.nsVisualizerMode.FormMode.visualizerFormModeController.removeSelectedElem");var b=this.f;if(null==a){for(var c in b.oFormDefinition)this.us(c);return 0}a=b.oFormDefinition[a].rows;if(null==a)return 0;for(b=0;b<a.length;b++)for(!0===a[b].selected&&delete a[b].selected,c=0;c<a[b].fields.length;c++)!0===a[b].fields[c].selected&&delete a[b].fields[c].selected};
Mw.prototype.hc.prototype.removeSelectedElem=Mw.prototype.hc.prototype.us;Mw.prototype.hc.prototype.rs=function(a){var b=this.f;if(!m(a)){for(var c in b.oFormDefinition)this.rs(c);return 0}a=b.oFormDefinition[a].rows;for(b=0;b<a.length;b++)for(!0===a[b].hovered&&delete a[b].hovered,c=0;c<a[b].fields.length;c++)!0===a[b].fields[c].hovered&&delete a[b].fields[c].hovered};Mw.prototype.hc.prototype.removeHoveredElem=Mw.prototype.hc.prototype.rs;
Mw.prototype.hc.prototype.ts=function(a){var b=this.f;if(null==a){for(var c in b.oFormDefinition)this.ts(c);return 0}a=b.oFormDefinition[a].rows;if(null==a)return 0;for(b=0;b<a.length;b++)for(!0===a[b].selected&&delete a[b].selected,!0===a[b].hovered&&delete a[b].hovered,c=0;c<a[b].fields.length;c++)!0===a[b].fields[c].selected&&delete a[b].fields[c].selected,!0===a[b].fields[c].hovered&&delete a[b].fields[c].hovered};Mw.prototype.hc.prototype.removeSelectedAndHoveredElem=Mw.prototype.hc.prototype.ts;
Mw.prototype.hc.prototype.xn=function(){X.log("nsVFB.nsVisualizerMode.FormMode.visualizerFormModeController.emptyFormValues");var a=this.f;m(a.oFormValues)&&(a.oFormValues={})};Mw.prototype.hc.prototype.emptyFormValues=Mw.prototype.hc.prototype.xn;function Nw(){X.log("nsVFB.nsVisualizerMode.JsonMode");X.module.directive("appVisualizermodeJson",this.Dz);X.module.controller("AppVisualizermodeJsonController",["$scope","$timeout","$rootScope",this.Im])}ta("nsVFB.nsVisualizerMode.JsonMode",Nw);Nw.prototype.Dz=function(){X.log("nsVFB.VisualizerMode.JsonMode.visualizerJsonModeDirective");return{restrict:"A",replace:!0,controller:"AppVisualizermodeJsonController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/VisualizerMode/JsonMode.html"}};
Nw.prototype.visualizerJsonModeDirective=Nw.prototype.Dz;
Nw.prototype.Im=function(a,b,c){X.log("nsVFB.VisualizerMode.JsonMode.visualizerJsonModeController");this.ek=a;this.yG=c;this.MH=b;a.rx=Date.now();a.Dw=1E3;a.JsonModel=X.$i(X.ha());a.error_Json=!1;a.editorOptions={mode:{name:"javascript",json:!0},readOnly:!0,styleActiveLine:!0,lineNumbers:!0,lineSeparator:"\n",indentWithTabs:!0,tabSize:2,viewportMargin:50,theme:"Veremes",xJ:!0,DJ:["CodeMirror-linenumbers","CodeMirror-foldgutter"],onLoad:function(c){a.$on("updateEvent",function(){c.setOption("readOnly",
$("#Lock_Icon").hasClass("fa-lock"));a.JsonModel=X.$i(X.ha())});a.$watch("JsonModel",function(b){X.log("jsonmode model");var c=!1;try{JSON.parse(b)}catch(g){c=!0}finally{a.$parent.error_Json=c}});a.$on("updateJsonModel",function(){a.$parent.ctrl.json_&&(a.rx=Date.now(),b(function(){Date.now()-a.rx>=a.Dw&&(a.JsonModel=X.$i(X.ha()))},a.Dw))})}}};Nw.prototype.visualizerJsonModeController=Nw.prototype.Im;
Nw.prototype.Im.prototype.BG=function(){X.gc(JSON.parse(this.ek.JsonModel));var a=$("#treeWithLines").treeview("getSelected"),b=$("#treeView").treeview("getSelected");this.yG.$broadcast("updateEvent",X.ha());0!==a.length&&0!==b.length&&this.MH(function(){$("#treeWithLines").treeview("selectNode",[a[0].nodeId,{Cd:!1}]);$("#treeView").treeview("selectNode",[b[0].nodeId,{Cd:!1}])},1)};Nw.prototype.Im.prototype.saveData=Nw.prototype.Im.prototype.BG;function Ow(){X.log("nsVFB.nsVisualizerMode.JsMode");X.module.directive("appEditorJs",this.tv);X.module.controller("AppEditorJsController",["$scope",this.sv])}ta("nsVFB.nsVisualizerMode.JsMode",Ow);Ow.prototype.tv=function(){X.log("nsVFB.VisualizerMode.JsMode.editorJsModeDirective");return{restrict:"A",replace:!0,controller:"AppEditorJsController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/VisualizerMode/JsMode.html"}};
Ow.prototype.editorJsModeDirective=Ow.prototype.tv;Ow.prototype.sv=function(a){X.log("nsVFB.VisualizerMode.JsMode.editorJsModeController");a.JsModel=X.Pf();a.editorOptions={mode:{name:"javascript",json:!1},readOnly:!1,styleActiveLine:!0,lineNumbers:!0,lineSeparator:"\r\n",indentWithTabs:!0,tabSize:2,viewportMargin:50,theme:"Veremes",onLoad:function(){a.$watch("JsModel",function(a){X.log("jsmode model");X.hk(a)});a.$on("updateJS",function(){X.log("Js");a.JsModel=X.Pf()})}}};
Ow.prototype.editorJsModeController=Ow.prototype.sv;function Pw(){X.log("nsVFB.nsVisualizerMode.CssMode");X.module.directive("appEditorCss",this.rv);X.module.controller("AppEditorCssController",["$scope",this.qv])}ta("nsVFB.nsVisualizerMode.CssMode",Pw);Pw.prototype.rv=function(){X.log("nsVFB.VisualizerMode.CssMode.editorCssModeDirective");return{restrict:"A",replace:!0,controller:"AppEditorCssController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/VisualizerMode/CssMode.html"}};
Pw.prototype.editorCssModeDirective=Pw.prototype.rv;Pw.prototype.qv=function(a){X.log("nsVFB.VisualizerMode.CssMode.editorCssModeController");a.CssModel=X.di();a.editorOptions={mode:"css",readOnly:!1,styleActiveLine:!0,lineNumbers:!0,lineSeparator:"\r\n",indentWithTabs:!0,tabSize:2,viewportMargin:50,theme:"Veremes"};X.resize();a.$watch("CssModel",function(a){X.log("cssmode model");X.Fs(a)});a.$on("updateCSS",function(){X.log(X.di());a.CssModel=X.di()})};Pw.prototype.editorCssModeController=Pw.prototype.qv;function Qw(){X.log("nsVFB.Visualizer");this.fF=new Mw;this.iF=new Nw;this.hF=new Ow;this.dF=new Pw;X.module.directive("appVisualizer",this.Bz);X.module.controller("AppVisualizerController",["$scope","$timeout",this.sg])}ta("nsVFB.Visualizer",Qw);Qw.prototype.Bz=function(){X.log("nsVFB.Visualizer.visualizerDirective");return{restrict:"A",replace:!0,controller:"AppVisualizerController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/Visualizer.html"}};
Qw.prototype.visualizerDirective=Qw.prototype.Bz;
Qw.prototype.sg=function(a){X.log("nsVFB.Visualizer.visualizerController");var b=this;this.f=a;b.form_=!0;b.css_=b.js_=b.json_=!1;b.JSPresent=!0;b.CSSPresent=!0;a.$watch("text",function(){X.log("visualizer text");"undefined"!==typeof a.text.Visualizer&&(b.text=a.text.Visualizer,b.ModeSelected=b.text.FormMode)});b.verifyMode=function(){m(angular.element($("#boolean-JS-include"))[0])&&(b.JSPresent=!angular.element($("#boolean-JS-include"))[0].checked);m(angular.element($("#boolean-CSS-include"))[0])&&
(b.CSSPresent=!angular.element($("#boolean-CSS-include"))[0].checked)};b.form=function(){b.ModeSelected=b.text.FormMode;a.$broadcast("updateEvent",{});b.form_=!0;b.css_=b.js_=b.json_=!1};b.json=function(){b.ModeSelected=b.text.JsonMode;a.$broadcast("updateEvent",{});b.json_=!0;b.css_=b.js_=b.form_=!1};b.js=function(){b.ModeSelected=b.text.JsMode;b.js_=!0;b.css_=b.json_=b.form_=!1;a.$broadcast("updateJS",X.Pf())};b.css=function(){b.ModeSelected=b.text.CssMode;a.$broadcast("updateCSS",X.di());b.css_=
!0;b.json_=b.js_=b.form_=!1}};Qw.prototype.visualizerController=Qw.prototype.sg;Qw.prototype.sg.$inject=["$scope","$timeout","$http"];
Qw.prototype.sg.prototype.WH=function(){X.log("nsVFB.Visualizer.visualizerController.toggleFullScreen");if(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled){var a=$("#studio-full-screen-btn").get(0),b=$("#studio_container").get(0);document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?($(a).removeClass("icon-shrink"),document.exitFullscreen?document.exitFullscreen():
document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),setTimeout(function(){X.resize()},100)):($(a).addClass("icon-shrink"),b.requestFullscreen?b.requestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen?b.webkitRequestFullscreen():b.msRequestFullscreen&&b.msRequestFullscreen(),setTimeout(function(){X.resize(!0)},500))}else $.notify("Fonction non disponible pour votre navigateur",
"error")};Qw.prototype.sg.prototype.toggleFullScreen=Qw.prototype.sg.prototype.WH;
Qw.prototype.sg.prototype.fE=function(){X.log("nsVFB.visualizerController.loadDefaultJavascript");var a=this.f,b=X.Pf();m(b)&&""!==b&&bootbox.confirm("<h4>"+this.text.Confirmation.LoseJs+"</h4>",function(b){!0===b&&angular.element(z.b).injector().get(["$http"])({method:"GET",url:X.fa.web_server_name+"/"+X.fa.public_alias+"/studio/default.js"}).then(function(b){console.log(b);null!=b.data&&(X.hk(b.data.replace(/(?:\r\n|\r|\n)/g,"\r\n")),a.$broadcast("updateJS",X.Pf()))},function(a){console.error("Problem on Loading default javascript");
console.error(a)})})};Qw.prototype.sg.prototype.loadDefaultJavascript=Qw.prototype.sg.prototype.fE;Qw.prototype.kC=function(){return Qw.fF};Qw.prototype.getFormMode=Qw.prototype.kC;Qw.prototype.qC=function(){return Qw.iF};Qw.prototype.getJsonMode=Qw.prototype.qC;Qw.prototype.pC=function(){return Qw.hF};Qw.prototype.getJsMode=Qw.prototype.pC;Qw.prototype.fC=function(){return Qw.dF};Qw.prototype.getCssMode=Qw.prototype.fC;function Rw(){X.log("nsVFB.ElementForm");X.module.directive("appElementForm",this.uv);X.module.directive("appParamElement",["$rootScope",this.vv]);X.module.directive("appParamMap",this.cx);X.module.directive("appHelperIcon",this.ND);X.module.controller("AppElementFormController",["$scope","$rootScope","$timeout","$http","$q",this.Mq])}ta("nsVFB.ElementForm",Rw);
Rw.prototype.uv=function(){X.log("nsVFB.ElementForm.elementFormDirective");return{restrict:"A",replace:!0,controller:"AppElementFormController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/ElementForm.html"}};Rw.prototype.elementFormDirective=Rw.prototype.uv;
Rw.prototype.vv=function(){X.log("nsVFB.ElementForm.elementParamDirective");return{link:function(a,b){"map_vmap"===a.model.type&&($("#Vmap_Downloader_input").fileinput({mainClass:"input-group-sm"}),$("#Vmap_Downloader_input").on("change",function(b){if(b=b.target.files[0]){var c=new FileReader;c.onload=function(b){a.ctrl.uI(JSON.parse(b.target.result))};c.readAsText(b)}}),!0===a.locker&&$("#Vmap_Downloader_input").fileinput("disable"));switch(a.model.type){case "upload":case "text":case "label":case "email":case "double_select":case "select":case "list":case "date":case "datetime":case "password":case "url":case "color_picker":case "label_display":case "map":case "map_osm":case "map_bing":case "map_vmap":case "textarea":case "button":case "image":case "imageurl":case "image_wsdata":case "link":case "linkurl":case "file_wsdata":case "bo_grid":case "section_grid":case "codemirror":case "checkbox":case "radio":case "float":case "slider":"slider_Element_size"===
$(b).attr("id")?($(b).slider({formatter:function(a){return Math.round(100*a/12)+"%"},value:a.model.nb_cols}),$(b).slider("on","change",function(){a.model.nb_cols=$(b).slider("getValue");a.$apply()}),a.$watch("model.nb_cols",function(a){$(b).slider("setValue",a)})):"slider_Element_height"===$(b).attr("id")?(null!=a.model.style||(a.model.style={}),null!=a.model.style.height||(a.model.style.height=0),$(b).slider({formatter:function(a){return a+"px"},value:parseFloat(a.model.style.height)}),$(b).slider("on",
"change",function(){a.model.style.height=$(b).slider("getValue")+"px";a.$apply()}),a.$watch("model.style.height",function(a){$(b).slider("setValue",parseFloat(a))})):"slider_Element_width"===$(b).attr("id")?(null!=a.model.style||(a.model.style={}),null!=a.model.style.width||(a.model.style.width=0),$(b).slider({formatter:function(a){return a+"px"},value:parseFloat(a.model.width)}),$(b).slider("on","change",function(){a.model.width=$(b).slider("getValue")+"px";a.$apply()}),a.$watch("model.width",function(a){$(b).slider("setValue",
parseFloat(a))})):"slider_Tab_size"===$(b).attr("id")&&(null!=a.model.cm_options||(a.model.cm_options={}),null!=a.model.cm_options.tabSize||(a.model.cm_options.tabSize=2),$(b).slider({formatter:function(a){return a},value:parseFloat(a.model.cm_options.tabSize)}),$(b).slider("on","change",function(){a.model.cm_options.tabSize=$(b).slider("getValue");a.$apply()}),a.$watch("model.cm_options.tabSize",function(a){$(b).slider("setValue",parseFloat(a))})),!0===a.locker?$(b).slider("disable"):$(b).slider("enable")}if("list"===
a.model.type||"double_select"===a.model.type||"textarea"===a.model.type)$("#slider_Element_Row").slider({formatter:function(a){return a},min:3,max:20,step:1,value:5}),$("#slider_Element_Row").slider("on","change",function(){a.model.size=$("#slider_Element_Row").slider("getValue");a.$apply()}),a.$watch("model.size",function(a){$("#slider_Element_Row").slider("setValue",a)}),!0===a.locker&&$("#slider_Element_Row").slider("disable"),"double_select"===a.model.type&&a.$watch("model.name",function(b){a.model.name_to=
b;a.model.name_from=b+"_from"})}}};Rw.prototype.elementParamDirective=Rw.prototype.vv;Rw.prototype.ND=function(){return{link:function(a,b,c){var d=c.$observe("appHelperIcon",function(){m(c.text)&&""!==c.text&&($(b).popover({trigger:"hover",container:"body",title:"HelperBox",content:function(){return c.text}}),a.$on("$destroy",function(){$(b).popover("destroy");d()}))})}}};Rw.prototype.cx=function(){X.log("nsVFB.ElementForm.mapParamDirective")};Rw.prototype.mapParamDirective=Rw.prototype.cx;
Rw.prototype.Mq=function(a,b,c,d,e){X.log("nsVFB.ElementForm.elementFormController");var f=this;this.applicationName=X.ci();b.Utils={keys:Object.keys};a.model={};a.collapsed=X.ug[4];a.aWebServiceAttributs=[];a.aBusinessObjects=[];a.aBoAttributs=[];a.aFormAttributs=[];a.datasourcesArray=[];a.YJ={};var g={},h={};a.$watch("text",function(){X.log("text updated");if("undefined"!==typeof a.text.Element){f.text=a.text.Element;a.Component_list=[];for(var b=X.config.avaliable_elems,c=0;c<b.length;c++)a.Component_list.push({alias:f.text.Select_Type[b[c]],
value:b[c]})}});a.$watch("model.id",function(){X.log("model.id changed");a.jsonOutput=X.ha();m(a.jsonOutput.datasources)&&ka(a.jsonOutput.datasources)&&!fa(a.jsonOutput.datasources)||(a.jsonOutput.datasources={});a.datasources=a.jsonOutput.datasources;a.datasourcesArray=[];for(var b in a.datasources)a.datasources[b].id=b,a.datasourcesArray.push(a.datasources[b]);f.updateDatasourceInfos();if("select"===a.model.type||"list"===a.model.type||"double_select"===a.model.type)if(null!=a.model.datasource.parents)for(a.cascade=
!0,a.aParents=[],b=0;b<a.model.datasource.parents.length;b++)a.aParents.push(a.model.datasource.parents[b].name);else a.cascade=!1,a.aParents=[];X.gc(a.jsonOutput)});a.$watch("model.datasource.datasource_id",function(){X.log("model.datasource.datasource_id changed");if(null==a.model.datasource||null==a.model.datasource.datasource_id||null==a.datasources[a.model.datasource.datasource_id])return 0;"web_service"===a.datasources[a.model.datasource.datasource_id].type&&Ua(a.aWebServiceAttributs);f.updateDatasourceInfos()});
a.$watch("model.default_value",function(){b.$broadcast("updateDefautValue",a.model)});a.$watch("model.name",function(c){a.jsonOutput=X.ha();1<X.rg.getElementsByName(a.jsonOutput,b.selected_form_type,c).length&&(a.model.name+="_2",$.notify(a.text.Element.SameNameWarning,"warning"))});a.$watch("model",function(d,e){b.$broadcast("update model",null);"undefined"!==e.type&&(d.type!==e.type&&d.id===e.id?(0<g.length&&(null!=g[0]&&(g[0].icon=f.$u(a.model,d.type)),null!=h[0]&&(h[0].icon=f.$u(a.model,d.type))),
"select"===d.type&&("Text"===f.optionsSelect?(m(d.web_service)&&ub(d,"web_service"),a.selectedRessource="",a.selectedValue="",a.selectedLabel=""):"TableValues"===f.optionsSelect?(m(d.options)&&ub(d,"options"),a.selectedRessource="",a.selectedValue="",a.selectedLabel=""):"WebService"===f.optionsSelect&&(m(d.options)&&ub(d,"options"),m(d.web_service.parameters)&&ub(d.web_service,"parameters")))):d.id===e.id&&d.name!==e.name&&(m(g[0])&&m(h[0])&&(g[0].text=d.name,h[0].text=d.name,null!==d.name.match(/\s/g)?
angular.element($("#Element_Form_name_input")).addClass("invalid_input"):angular.element($("#Element_Form_name_input")).removeClass("invalid_input")),X.qI(d,e),X.rI(d,e)));a.model.selected=!0;c(function(){m(g[0])&&m(h[0])&&(null!=g[0]&&$("#treeWithLines").treeview("selectNode",[g[0].nodeId,{Cd:!1}]),null!=h[0]&&$("#treeView").treeview("selectNode",[h[0].nodeId,{Cd:!1}]))},10);b.$broadcast("updateJsonModel",X.ha());b.$broadcast("updateForm",X.ha())},!0);a.$on("update element",function(c,d){X.log("update element");
a.model=d;g=$("#treeWithLines").treeview("getSelected");h=$("#treeView").treeview("getSelected");m(a.qx)&&$("#select_element_to_add").val(a.qx.type);a.AllSelects=[];if("undefined"!==typeof X.ha()[b.selected_form_type]){c=X.ha()[b.selected_form_type].rows;for(var e=0;e<c.length;e++)for(var f=0;f<c[e].fields.length;f++)"select"!==c[e].fields[f].type&&"list"!==c[e].fields[f].type||c[e].fields[f].name===a.model.name||a.AllSelects.push(c[e].fields[f].name)}$("#load_Perso_button").hasClass("active")&&X.valid&&
"undefined"!==d.type?a.locker=!1:X.valid&&(a.locker=!0,"map_vmap"===a.model.type&&$("#Vmap_Downloader_input").wJ("disable"));a.$$phase||a.$digest()});f.cK=function(b){X.log("elementFormController.updateWSInfos");"undefined"!==typeof b.selectedValue&&(a.model.web_service.id_key=b.selectedValue.replace(/\s/g,""));"undefined"!==typeof b.selectedLabel&&(a.model.web_service.label_key=b.selectedLabel.replace(/\s/g,""));a.model.web_service.optionsSelect=f.optionsSelect};f.updateDatasourceInfos=function(){X.log("elementFormController.updateDatasourceInfos");
if(null==a.model.datasource)return 0;a.model.datasource.sort_order=null!=a.model.datasource.sort_order?a.model.datasource.sort_order:"ASC";a.model.datasource.distinct=null!=a.model.datasource.distinct?a.model.datasource.distinct:"true";null!=a.model.datasource.id_key&&(a.model.datasource.id_key=a.model.datasource.id_key.replace(/\s/g,""));null!=a.model.datasource.label_key&&(a.model.datasource.label_key=a.model.datasource.label_key.replace(/\s/g,""));null!=a.model.datasource.id_key&&null!=a.model.datasource.label_key&&
(a.model.datasource.attributs=a.model.datasource.id_key+"|"+a.model.datasource.label_key);null!=a.model.datasource.label_key&&(a.model.datasource.order_by=a.model.datasource.label_key)};f.updateWebServiceAttributs=function(b){function c(){setTimeout(function(){!1===h&&bootbox.confirm(f.text.Component.Select.Cancel,function(a){!0===a?l.resolve():c()})},5E3)}X.log("updateWebServiceAttributs");var g={token:X.pb(),limit:1};ka(b.parameters)&&xb(g,b.parameters);var h=!1,l=e.defer();d({method:"GET",url:X.fa.web_server_name+
"/"+X.fa.services_alias+"/"+b.ressource_id,params:g,timeout:l.promise,headers:{Accept:"application/x-vm-json"}}).then(function(c){h=!0;if(null==c||null==c.data||null==c.data.data||null==c.data.data[0])return 0;var d;if("businessObject"===b.dataType&&null!=b.businessObjectRequest){d=[];for(var e=0;e<c.data.data.length;e++)d.push(c.data.data[e]["bo_"+b.businessObjectRequest])}else d=c.data.data;a.aWebServiceAttributs=Object.keys(d[0])},function(a){h=!0;console.error(a)});c()};f.updateCascadeField=function(){X.log("elementFormController.updateCascadeField");
if(null==a.aParents)return console.error("aParents not defined"),0;if(null==a.model.datasource)return console.error("datasource not defined"),0;!1===a.cascade&&(a.aParents=[]);if(fa(a.aParents)){if(0===a.aParents.length)return m(a.model.datasource.parents)&&delete a.model.datasource.parents,0;null!=a.model.datasource.parents||(a.model.datasource.parents=[]);fa(a.model.datasource.parents)&&Ua(a.model.datasource.parents);for(var b=0;b<a.aParents.length;b++)a.model.datasource.parents.push({name:a.aParents[b],
filter_attr:a.aParents[b],filter_equality:"=",wait_for_parent:!0})}};f.uI=function(c){X.log("elementFormController.updateVmapData");if(c.children){for(var d=0;d<c.children.length;d++)c.children[d].view&&(a.model.map_options.center.coord=c.children[d].view.center?c.children[d].view.center:[0,0],a.model.map_options.center.zoom=c.children[d].view.zoom?c.children[d].view.zoom:5,a.model.map_options.center.extent=c.children[d].view.extent?c.children[d].view.extent:[-2.002637639E7,-2.00489661E7,2.002637639E7,
2.00489661E7],a.model.map_options.proj=c.children[d].view.projection?c.children[d].view.projection:"EPSG:3857",b.$broadcast("updateMap","view"));a.model.map_options.tree=c;b.$broadcast("updateMap","tree")}};f.bK=function(){X.log("elementFormController.updateWS");b.$broadcast("updateOptions",{})};f.updateMap=function(c,d){X.log("elementFormController.updateMap");switch(d){case "center":c=Kf(a.model.map_options.center.coord,a.model.map_options.proj,"EPSG:3857");Qe([-2.002637639E7,-2.00489661E7,2.002637639E7,
2.00489661E7],c[0],c[1])?b.$broadcast("updateMap",d):$.notify(f.text.Component.Map.Notify.OutRange,{className:"error",autoHideDelay:X.jb});break;case "zoom":0<a.model.map_options.center.scale&&2E8>=a.model.map_options.center.scale?b.$broadcast("updateMap",d):$.notify(f.text.Component.Map.Notify.OutRange,{className:"error",autoHideDelay:X.jb});break;case "extent":c=a.qx.KJ.qa.P;if(c[0]<=c[2]&&-2.002637639E7<=c[0]&&2.002637639E7>=c[0]&&c[0]<=c[2]&&-2.002637639E7<=c[2]&&2.002637639E7>=c[2]&&c[1]<=c[3]&&
-2.00489661E7<=c[1]&&2.00489661E7>=c[1]&&c[1]<=c[3]&&-2.00489661E7<=c[3]&&2.00489661E7>=c[3]){b.$broadcast("updateMap",d);break}$.notify(f.text.Component.Map.Notify.OutRange,{className:"error",autoHideDelay:X.jb});break;case "multi_geom":break;default:b.$broadcast("updateMap",d)}};f.$u=function(a,b){X.log("elementFormController.convert");var c,d="icon-point";if("undefined"!==a.type){switch(b){case "button":c="type id class name nb_cols buttons default_value".split(" ");break;case "title":case "label":c=
"type id label name default_value nb_cols".split(" ");"label"===b?d="icon-eye":d;break;case "hr":c=["type","id","name","default_value"];"hr"===b?d="icon-minus":d;break;case "hidden":c=["type","id","name","default_value","nb_cols"];"hidden"===b?d="icon-user-secret":d;break;case "subtitle":c="type id label name class default_value nb_cols".split(" ");break;case "checkbox":c="type id label name checked default_value nb_cols".split(" ");d="icon-check-square";break;case "radio":c="type id label name checked options nb_cols default_value".split(" ");
d="icon-dot-circle-o";break;case "textarea":c="type id label name required nb_cols default_value".split(" ");d="icon-paragraph";break;case "select":c="type id label name required nb_cols multiple options web_service child_select default_value".split(" ");d="icon-format_list_bulleted";break;case "list":c="type id label name required nb_cols multiple options web_service child_select default_value size".split(" ");d="icon-format_list_bulleted";break;case "double_select":c="type id label name required nb_cols options web_service size label_from label_to name_from name_to default_value".split(" ");
d="icon-format_list_bulleted";break;case "date":case "datetime":case "label_display":case "color_picker":c="type id label name nb_cols default_value".split(" ");"date"===b||"datetime"===b?d="icon-calendar-check-o":d;"label_display"===b?d="icon-eye":d;"color_picker"===b?d="icon-paint":d;break;case "upload":c="type id label name nb_cols default_value ext".split(" ");d="icon-file";break;case "tinymce":c="type id label name nb_rows options default_value nb_cols".split(" ");d="icon-font";break;case "slider":c=
"type id label name options default_value nb_cols".split(" ");d="icon-sliders";break;case "text":case "password":case "url":case "email":c="type id label name pattern required nb_cols default_value".split(" ");"text"===b?d="icon-font":d;"password"===b?d="icon-key":d;"url"===b?d="icon-chrome":d;"email"===b?d="icon-at":d;break;case "integer":case "float":case "number":c="type id label name min max nb_cols default_value".split(" ");d="icon-calculator";break;case "link":c="type id label name alias folder nb_cols target".split(" ");
d="glyphicon glyphicon-link";break;case "image":c="type id label name alias folder nb_cols width".split(" ");d="glyphicon glyphicon-picture";break;case "map_osm":case "map_bing":case "map_vmap":c="type id label name required map_options nb_cols style default_value".split(" ");d="icon-map";break;case "codemirror":c="type id label ui name cm_options nb_cols".split(" "),d="icon-code"}for(var e in a)null!=c&&-1===c.indexOf(e)&&delete a[e];switch(b){case "list":case "double_select":b={size:5};break;case "button":m(a["class"])?
a["class"]:a["class"]="btn-ungroup btn-group-sm";m(a.buttons)?a.buttons:a.buttons=[];b={type:"submit",name:"form_submit",label:"FORM_UPDATE","class":"btn-primary"};m(a.buttons[0])?a.buttons[0]:a.buttons[0]=b;break;case "radio":b={choices:[{label:"Oui",value:!0},{label:"Non",value:!1}]};m(a.options)?a.options:a.options=b;m(a.nb_cols)?a.nb_cols:a.nb_cols=12;break;case "slider":b={min:0,max:100,precision:1,step:1};m(a.options)?a.options:a.options=b;m(a.nb_cols)?a.nb_cols:a.nb_cols=12;break;case "map_osm":m(a.style)?
a.style:a.style={height:"250px"};b={proj:"EPSG:3857",type:"OSM",center:{coord:[3E5,6E6],zoom:5,scale:25E6,extent:[-2.002637639E7,-2.00489661E7,2.002637639E7,2.00489661E7]},controls:{MP:!0,ZO:!0,SL:!0,CP:!0},layers:[],interactions:{multi_geometry:!1,full_screen:!0,RA:!1,RO:!0,ED:!0,DP:!0,DL:!0,DPol:!0,SE:!0},draw_color:"rgba(54,184,255,0.6)",contour_color:"rgba(0,0,0,0.4)",contour_size:2,circle_radius:6,features:[],coord_accuracy:8};m(a.map_options)&&"OSM"===a.map_options.type?a.map_options:a.map_options=
b;break;case "map_bing":m(a.style)?a.style:a.style={height:"250px"};b={proj:"EPSG:3857",type:"bing",center:{coord:[3E5,6E6],zoom:5,scale:25E6,extent:[-2.002637639E7,-2.00489661E7,2.002637639E7,2.00489661E7]},controls:{MP:!0,ZO:!0,SL:!0,CP:!0},layers:[],interactions:{multi_geometry:!1,full_screen:!0,RA:!1,RO:!0,ED:!0,DP:!0,DL:!0,DPol:!0,SE:!0},draw_color:"rgba(54,184,255,0.6)",contour_color:"rgba(0,0,0,0.4)",contour_size:2,circle_radius:6,features:[],coord_accuracy:8,source:{culture:"fr-FR",key:"",
style:"Aerial"}};m(a.map_options)&&"bing"===a.map_options.type?a.map_options:a.map_options=b;break;case "map_vmap":m(a.style)?a.style:a.style={height:"250px"};b={proj:"EPSG:3857",type:"vmap",center:{coord:[3E5,6E6],zoom:5,scale:25E6,extent:[-2.002637639E7,-2.00489661E7,2.002637639E7,2.00489661E7]},controls:{MP:!0,ZO:!0,SL:!0,CP:!0},layers:[],interactions:{multi_geometry:!1,full_screen:!0,RA:!1,RO:!0,ED:!0,DP:!0,DL:!0,DPol:!0,SE:!0},draw_color:"rgba(54,184,255,0.6)",contour_color:"rgba(0,0,0,0.4)",
contour_size:2,circle_radius:6,features:[],coord_accuracy:8};m(a.map_options)&&"vmap"===a.map_options.type?a.map_options:a.map_options=b;break;case "codemirror":b={mode:"javascript",readOnly:!1,styleActiveLine:!0,lineNumbers:!0,lineSeparator:"\r\n",indentWithTabs:!0,tabSize:2,viewportMargin:50,theme:"Veremes"};m(a.cm_options)?a.cm_options:a.cm_options=b;m(a.nb_cols)?a.nb_cols:a.nb_cols=12;m(a.ui)?a.ui:a.ui=!0;break;case "bo_grid":b={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!1,enablePaginationControls:!1,
enableColumnMenus:!1,enableColumnResizing:!1,appHeader:!0,appHeaderTitleBar:!0,columnDefs:[],data:[]};m(a.options)?a.options:a.options=b;m(a.nb_cols)?a.nb_cols:a.nb_cols=12;setTimeout(function(){X.reloadForm()});break;case "section_grid":b={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!1,enablePaginationControls:!1,enableColumnMenus:!1,enableColumnResizing:!1,appHeader:!0,appHeaderTitleBar:!0,columnDefs:[],data:[]};m(a.options)?a.options:a.options=b;m(a.nb_cols)?a.nb_cols:a.nb_cols=12;
setTimeout(function(){X.reloadForm()});break;default:a.nb_cols||(a.nb_cols=12)}return d}};f.resize=function(){a.collapsed=!a.collapsed;X.ug[4]=a.collapsed;X.resize()};f.updateBoList=function(){function b(){setTimeout(function(){!1===g&&bootbox.confirm(f.text.Component.Select.Cancel,function(a){!0===a?h.resolve():b()})},5E3)}a.aBusinessObjects=[];var c={token:X.pb()},g=!1,h=e.defer();d({method:"GET",url:X.fa.web_server_name+"/"+X.fa.services_alias+"/vmap/businessobjects",params:c,timeout:h.promise,
headers:{Accept:"application/x-vm-json"}}).then(function(b){g=!0;if(null==b||null==b.data||null==b.data.data||null==b.data.data[0])return 0;a.aBusinessObjects=b.data.data},function(a){g=!0;console.error(a)});b()};f.updateBoLinkLists=function(c){function g(){setTimeout(function(){!1===v&&bootbox.confirm(f.text.Component.Select.Cancel,function(a){!0===a?x.resolve():g()})},5E3)}if(null==c)return 0;var h=[],l={token:X.pb()},v=!1,x=e.defer();d({method:"GET",url:X.fa.web_server_name+"/"+X.fa.services_alias+
"/vmap/querys/"+c,params:l,timeout:x.promise,headers:{Accept:"application/x-vm-json"}}).then(function(b){v=!0;if(null==b||null==b.data||null==b.data.data||null==b.data.data[0]||null==b.data.data[0])return 0;b=Object.keys(b.data.data[0]);a.aBoAttributs=b},function(a){v=!0;console.error(a)});g();if("undefined"!==typeof X.ha()[b.selected_form_type])for(c=X.ha()[b.selected_form_type].rows,l=0;l<c.length;l++)for(var y=0;y<c[l].fields.length;y++)h.push(c[l].fields[y].name);a.aFormAttributs=h};f.updateSectionList=
function(){function b(){setTimeout(function(){!1===g&&bootbox.confirm(f.text.Component.Select.Cancel,function(a){!0===a?h.resolve():b()})},5E3)}a.aBusinessObjects=[];var c={token:X.pb(),filter:'"template"=\'workspaceListTpl.html\' AND "lang"=\''+X.fa.language+"'"},g=!1,h=e.defer();d({method:"GET",url:X.fa.web_server_name+"/"+X.fa.services_alias+"/vitis/vitissections",params:c,timeout:h.promise,headers:{Accept:"application/x-vm-json"}}).then(function(b){g=!0;if(null==b||null==b.data||null==b.data.data||
null==b.data.data[0])return 0;a.aSections=b.data.data},function(a){g=!0;console.error(a)});b()};f.updateSectionLinkLists=function(c){function g(){setTimeout(function(){!1===l&&bootbox.confirm(f.text.Component.Select.Cancel,function(a){!0===a?v.resolve():g()})},5E3)}a.aBusinessObjects=[];var h={token:X.pb()},l=!1,v=e.defer();d({method:"GET",url:X.fa.web_server_name+"/"+X.fa.services_alias+"/vitis/vitissections/"+c,params:h,timeout:v.promise,headers:{Accept:"application/x-vm-json"}}).then(function(b){l=
!0;if(null==b||null==b.data||null==b.data.data||null==b.data.data[0])return 0;b=b.data.data[0];null!=b.ressource_id&&(d({method:"GET",url:X.fa.web_server_name+"/"+X.fa.services_alias+"/"+b.ressource_id,params:h,timeout:v.promise,headers:{Accept:"application/x-vm-json"}}).then(function(b){l=!0;if(null==b||null==b.data||null==b.data.data||null==b.data.data[0])return 0;b=Object.keys(b.data.data[0]);a.aSectionAttributs=b},function(a){l=!0;console.error(a)}),g())},function(a){l=!0;console.error(a)});g();
c=[];if("undefined"!==typeof X.ha()[b.selected_form_type])for(var x=X.ha()[b.selected_form_type].rows,y=0;y<x.length;y++)for(var B=0;B<x[y].fields.length;B++)c.push(x[y].fields[B].name);a.aFormAttributs=c}};Rw.prototype.elementFormController=Rw.prototype.Mq;Rw.prototype.Mq.$inject=["$scope","$rootScope","$timeout","$http","$q"];var Sw={};ta("nsVitisComponent",Sw);function Y(a){var b=a.target,c=a.options,d=a.hiddenFieldId,e=a.oFormValues,f=a.sFormName;a=a.oProj;if(null==b)return console.error("nsVitisComponent.Map: target not defined"),null;if(null==c)return console.error("nsVitisComponent.Map: options not defined"),null;if(null==d)return console.error("nsVitisComponent.Map: hiddenFieldId not defined"),null;if(null==e)return console.error("nsVitisComponent.Map: oFormValues not defined"),null;if(null==f)return console.error("nsVitisComponent.Map: sFormName not defined"),
null;if(null==a)return console.error("nsVitisComponent.Map: oProj not defined"),null;this.Tz=angular.element(z.Lb).injector().get(["propertiesSrvc"]);this.Kp=angular.element(z.Lb).injector().get(["$translate"]);this.la=angular.element(z.Lb).injector().get(["$log"]);var g=this;this.la.log("nsVitisComponent.Map");this.Be=$(".banner_line").css("background-color");m(this.Be)&&"a"!==this.Be.charAt(3)&&(this.Be=this.Be.split("("),this.Be=this.Be[1].split(")"),this.Be="rgba("+this.Be[0]+",0.58)");this.Kp("COMPONENT_MAP_LAYERSTREE COMPONENT_MAP_FULLSCREEN COMPONENT_MAP_ZOOM_EXTENT COMPONENT_MAP_DELETE_FEATURE COMPONENT_MAP_DELETE_ALL COMPONENT_MAP_MODIFY_FEATURE COMPONENT_MAP_DRAW_POINT COMPONENT_MAP_DRAW_LINE COMPONENT_MAP_DRAW_POLYGON COMPONENT_MAP_ZOOM_EXTENT COMPONENT_MAP_OVERSIZED_EXTENT".split(" ")).then(function(a){g.jf=
a});this.Ak();var h,l;m(c.center.coord)&&(h=c.center.coord);m(c.center.extent)&&(l=c.center.extent);this.bg=c.proj;this.Cc=c.center.coord?new Ek({qa:h,zoom:5,ea:vf(c.proj)}):new Ek({qa:[(l[0]+l[2])/2,(l[1]+l[3])/2],zoom:5,ea:vf(c.proj)});this.jf={};this.aj=b;this.Pm=c.coord_accuracy;this.vk=[];this.Fh=[];this.Cf=new Fe;this.Ra="none";this.Config={};this.Io=a;this.aF=c.interactions.multi_geometry;this.bLayersTreeOpen=!1;"OSM"===c.type?this.Fh.push(new om({source:new Mo})):"bing"===c.type&&this.Fh.push(new om({source:new yq({Th:c.source.culture,
key:c.source.key,wr:c.source.style})}));this.element=document.createElement("DIV");$(this.element).addClass("ol-current-projection-studio ol-unselectable");c.controls.MP&&this.vk.push(new hu({ln:function(a){return[a[0].toPrecision(g.Pm),a[1].toPrecision(g.Pm)]}}));c.controls.SL&&this.vk.push(new ou);c.controls.CP&&this.vk.push(new Ok({element:g.element,ka:function(){for(var a="",b=0;b<g.Io.projections.length;b++)g.bg===g.Io.projections[b].code&&(a=g.Io.projections[b].name);""!==a?$(".ol-current-projection-studio").html(a):
$(".ol-current-projection-studio").html(g.bg)}}));c.controls.ZO&&setTimeout(function(){g.Pp=Tw(g,g.aj)},500);setTimeout(function(){g.Lp=Uw(g,g.aj,c.interactions)});Array.isArray(c.layers)&&0<c.layers.length&&this.Fh.push(c.layers);this.X=new xo({target:g.aj,$a:g.Fh,view:g.Cc,controls:g.vk});null!=c.center.scale&&this.rf(c.center.scale);null!=c.center.extent&&this.ep(c.center.extent);this.aTree="vmap"===c.type&&c.tree?this.Ij(c.tree):[{service:c.type,layers:this.Fh}];b=vf(c.proj).Z();h=Hk(this.Cc,
this.X.ja());Vw(h,b)?this.wt=Hk(this.Cc,this.X.ja()):(console.error("map extent oversized"),Lk(H(this.X),b,this.X.ja()));$(".ol-mouse-position").css("bottom","8px");$(".ol-mouse-position").css("top","auto");$(".ol-mouse-position").css("background",this.Be);$(".ol-mouse-position").css("color","#ffffff");$(".ol-mouse-position").css("border-radius","4px");$(".ol-scale-line").css("background",this.Be);$(".ol-current-projection-studio").css("background",this.Be);c.draw_color=m(c.draw_color)?c.draw_color:
"rgba(54,184,255,0.6)";c.contour_color=m(c.contour_color)?c.contour_color:"rgba(0,0,0,0.4)";c.contour_size=m(c.contour_size)?c.contour_size:2;c.circle_radius=m(c.circle_radius)?c.circle_radius:7;b=new yg({fill:new ug({color:c.draw_color}),stroke:new wg({color:c.contour_color,width:c.contour_size}),Gb:new xg({xc:c.circle_radius,fill:new ug({color:c.draw_color}),stroke:new wg({color:c.contour_color,width:c.contour_size})})});this.Tc=new qm({style:b,Ti:!0,Ui:!0,source:new sh({features:g.Cf})});setTimeout(function(){g.X.rb(g.Tc)},
500);this.Ki=new mv({source:this.Tc.v(),Mb:jl});this.X.Ub(this.Ki);var n=new $d,b=$("#"+d).val();if(m(b)&&!/^[\s\xa0]*$/.test(b)&&"[object Object]"!==b){b=n.Zj(b);for(h=0;h<b.length;h++)vh(this.Tc.v(),b[h]);h=this.Tc.v().Z();Lk(H(this.X),h,this.X.ja());1===b.length&&"Point"===b[0].l().T()&&H(this.X).mh(12)}this.Cf.on("change",function(){var a=this;setTimeout(function(){var b=n.Ip(a.L());m(d)&&document.getElementById(d).setAttribute("value",b);m(f)&&m(e)&&(e[f]=b);a.X.dispatchEvent("moveend")},1)});
return this}Sw.Map=Y;Y.prototype.Ak=function(){var a=new sf({code:"EPSG:2154",P:[-378305.81,6093283.21,1212610.74,7186901.68],units:"m"});Ef(a);xf("EPSG:4326","EPSG:2154",this.Op,this.Ar);xf("EPSG:3857","EPSG:2154",function(a){a=Kf(a,"EPSG:3857","EPSG:4326");return Kf(a,"EPSG:4326","EPSG:2154")},function(a){a=Kf(a,"EPSG:2154","EPSG:4326");return Kf(a,"EPSG:4326","EPSG:3857")})};
Y.prototype.Op=function(a){var b=3/180*Math.PI,c=46.5/180*Math.PI,d=44/180*Math.PI,e=49/180*Math.PI,f=a[1]/180*Math.PI;a=a[0]/180*Math.PI;var g=6378137/Math.sqrt(1-.006694380025712785*Math.sin(d)*Math.sin(d)),h=Math.log(Math.tan(Math.PI/4+d/2)*Math.pow((1-.08181919106*Math.sin(d))/(1+.08181919106*Math.sin(d)),.04090959553)),f=Math.log(Math.tan(Math.PI/4+f/2)*Math.pow((1-.08181919106*Math.sin(f))/(1+.08181919106*Math.sin(f)),.04090959553)),e=Math.log(6378137/Math.sqrt(1-.006694380025712785*Math.sin(e)*
Math.sin(e))*Math.cos(e)/(g*Math.cos(d)))/(h-Math.log(Math.tan(Math.PI/4+e/2)*Math.pow((1-.08181919106*Math.sin(e))/(1+.08181919106*Math.sin(e)),.04090959553))),d=g*Math.cos(d)/e*Math.exp(e*h);return[7E5+d*Math.exp(-1*e*f)*Math.sin(e*(a-b)),66E5+d*Math.exp(-1*e*Math.log(Math.tan(Math.PI/4+c/2)*Math.pow((1-.08181919106*Math.sin(c))/(1+.08181919106*Math.sin(c)),.04090959553)))-d*Math.exp(-1*e*f)*Math.cos(e*(a-b))]};
Y.prototype.Ar=function(a){Math.atanh=Math.atanh||function(a){return Math.log((1+a)/(1-a))/2};Math.tanh=Math.tanh||function(a){return Infinity===a?1:-Infinity===a?-1:(Math.exp(a)-Math.exp(-a))/(Math.exp(a)+Math.exp(-a))};var b=1/298.257222101,b=Math.sqrt(2*b-b*b),c=a[0].toFixed(10)-7E5;a=a[1].toFixed(10)-1.26556120499E7;var d=Math.log(1.1754255426096E7/Math.sqrt(c*c+a*a))/.725607765053267;return[(Math.atan(-c/a)/.725607765053267+3/180*Math.PI)/Math.PI*180,Math.asin(Math.tanh(d+b*Math.atanh(b*Math.tanh(d+
b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.tanh(d+b*Math.atanh(b*Math.sin(1))))))))))))))))/Math.PI*180]};
function Tw(a,b){var c=document.createElement("BUTTON"),d=document.createElement("BUTTON"),e=document.createElement("BUTTON");c.innerHTML="<span class='fa fa-search-plus fa-x1' aria-hidden='true'></span>";d.innerHTML="<span class='fa fa-search-minus fa-x1' aria-hidden='true'></span>";e.innerHTML="<span class='glyphicon glyphicon-home' aria-hidden='true'></span>";c.className="btn btn-success Map-btn map-ZoomIn";d.className="btn btn-success Map-btn map-ZoomOut";e.className="btn btn-success Map-btn map-ZoomToExtent";
$(c).prop("type","button");$(d).prop("type","button");$(e).prop("type","button");$(e).prop("title",a.jf.COMPONENT_MAP_ZOOM_EXTENT);$(c).on("click",function(){var b=a.Cc.na();a.X.$c(Wk({resolution:b,duration:250,easing:Rk}));b=a.Cc.Hc(b,1);Mk(a.Cc,b);b=H(a.X).df();H(a.X).mh(b+1)});$(d).on("click",function(){var b=a.Cc.na();a.X.$c(Wk({resolution:b,duration:250,easing:Rk}));b=a.Cc.Hc(b,-1);Mk(a.Cc,b);b=H(a.X).df();H(a.X).mh(b-1)});$(e).on("click",function(){Lk(H(a.X),a.wt,a.X.ja())});var f=document.createElement("DIV");
f.className="btn-group-vertical btn-group-md form-map-Group-btn-zoom";f.appendChild(c);f.appendChild(d);f.appendChild(e);b.appendChild(f);return f}
function Uw(a,b,c){var d=[];if(c.full_screen&&(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)){var e=document.createElement("BUTTON");e.innerHTML="<span class='icon-enlarge' aria-hidden='true'></span>";e.className="btn btn-success Map-btn map-FullScreen";e.title=a.jf.COMPONENT_MAP_FULLSCREEN;$(e).prop("type","button");$(e).on("click",function(){var b=a.aj;document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||
document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():b.requestFullscreen?b.requestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen&&b.webkitRequestFullscreen()});d.push(e)}c.layer_tree&&(e=document.createElement("BUTTON"),e.innerHTML="<span class='icon-layers2' aria-hidden='true'></span>",
e.className="btn btn-success Map-btn map-LayerTree",e.title=a.jf.COMPONENT_MAP_LAYERSTREE,$(e).prop("type","button"),$(e).on("click",function(){a.bLayersTreeOpen=!a.bLayersTreeOpen;a.X.dispatchEvent("moveend")}),d.push(e));c.RA&&(e=document.createElement("BUTTON"),e.innerHTML="<span class='icon-trash' aria-hidden='true'></span>",e.className="btn btn-success Map-btn map-AllRemove",e.title=a.jf.COMPONENT_MAP_DELETE_ALL,$(e).prop("type","button"),$(e).on("click",function(){"none"!==a.Ra&&a.X.Nc.remove(a.Ra);
a.Tc.v().ob.clear();a.Tc.v().R();a.Cf.R()}),d.push(e));if(c.RO){var f=document.createElement("BUTTON");f.innerHTML="<span class='icon-eraser' aria-hidden='true'></span>";f.className="btn btn-success Map-btn map-Remove";f.title=a.jf.COMPONENT_MAP_DELETE_FEATURE;$(f).prop("type","button");$(f).on("click",function(){var b=$(f).hasClass("active");if("none"!==a.Ra&&(a.X.Nc.remove(a.Ra),b))return 0;a.Ra=new mv({Mb:hl,source:a.Tc.v()});a.Ki.setActive(!0);a.Ra.set("binded-button",f);a.X.Ub(a.Ra);a.Ra.Ka().on("add",
function(){zh(a.Tc.v(),a.Ra.Ka().L()[0]);a.Ra.Ka().clear();a.Ki.Ka().clear();a.Tc.v().R();a.Cf.R()})});d.push(f)}if(c.ED){var g=document.createElement("BUTTON");g.innerHTML="<span class='icon-edit' aria-hidden='true'></span>";g.className="btn btn-success Map-btn map-Modify";g.title=a.jf.COMPONENT_MAP_MODIFY_FEATURE;$(g).prop("type","button");$(g).on("click",function(){var b=$(g).hasClass("active");if("none"!==a.Ra&&(a.X.Nc.remove(a.Ra),b))return 0;a.Ra=new $u({features:a.Tc.v().ob});a.Ra.set("binded-button",
g);a.X.Ub(a.Ra);a.Ra.on("modifyend",function(){a.Cf.R()})});d.push(g)}if(c.DP){var h=document.createElement("BUTTON");h.innerHTML="<span class='icon-point' aria-hidden='true'></span>";h.className="btn btn-success Map-btn map-Point";h.title=a.jf.COMPONENT_MAP_DRAW_POINT;$(h).prop("type","button");$(h).on("click",function(){var b=$(h).hasClass("active");if("none"!==a.Ra&&(a.X.Nc.remove(a.Ra),b))return 0;a.Ra=new Po({source:a.Tc.v(),type:"Point"});a.Ra.set("binded-button",h);a.X.Ub(a.Ra);a.Ra.on("drawend",
function(b){!0!==c.multi_geometry&&a.Tc.v().ob.clear();b.wa.dv=NaN;a.Cf.dispatchEvent("change")})});d.push(h)}if(c.DL){var l=document.createElement("BUTTON");l.innerHTML="<span class='icon-line' aria-hidden='true'></span>";l.className="btn btn-success Map-btn map-Line";l.title=a.jf.COMPONENT_MAP_DRAW_LINE;$(l).prop("type","button");$(l).on("click",function(){var b=$(l).hasClass("active");if("none"!==a.Ra&&(a.X.Nc.remove(a.Ra),b))return 0;a.Ra=new Po({source:a.Tc.v(),type:"LineString"});a.Ra.set("binded-button",
l);a.X.Ub(a.Ra);a.Ra.on("drawend",function(b){!0!==c.multi_geometry&&a.Tc.v().ob.clear();b.wa.dv=NaN;a.Cf.R()})});d.push(l)}if(c.DPol){var n=document.createElement("BUTTON");n.innerHTML="<span class='icon-polygon' aria-hidden='true'></span>";n.className="btn btn-success Map-btn map-Polygon";n.title=a.jf.COMPONENT_MAP_DRAW_POLYGON;$(n).prop("type","button");$(n).on("click",function(){var b=$(n).hasClass("active");if("none"!==a.Ra&&(a.X.Nc.remove(a.Ra),b))return 0;a.Ra=new Po({source:a.Tc.v(),type:"Polygon"});
a.Ra.set("binded-button",n);a.X.Ub(a.Ra);a.Ra.on("drawend",function(b){!0!==c.multi_geometry&&a.Tc.v().ob.clear();b.wa.dv=NaN;a.Cf.R()})});d.push(n)}var r=document.createElement("DIV");r.className="btn-group-vertical btn-group-md form-map-Group-btn-interact";for(e=0;e<d.length;e++)r.appendChild(d[e]);b.appendChild(r);setTimeout(function(){var b=a.X.Nc;b.on("change:length",function(){$(r).children().removeClass("active");$(r).children().blur();b.forEach(function(a){$(a.get("binded-button")).addClass("active")})});
b.on("remove",function(){a.Ki.setActive(!1)});$(document).keydown(function(c){27===c.keyCode&&b.forEach(function(b){m(b.get("binded-button"))&&a.X.Nc.remove(b)})})},1E3);return r}
Y.prototype.Ij=function(a){0<this.X.getLayers().L().length&&this.X.getLayers().clear();this.Fh.length=0;var b,c=[],d=[256,256];a=angular.copy(a);var e=new Iq({properties:this.Tz});b=e.Rn(a,{size:this.X.ja(),tileSize:d});d=e.Xq(a,{size:this.X.ja(),tileSize:d});this.X.lh(b);for(e=0;e<d.length;e++)b={index:e,layer:d[e]},this.Fh.push(b),this.X.rb(d[e]);for(e=0;e<a.children.length;e++)m(a.children[e].children)&&c.push({service:a.children[e].name,layers:a.children[e].children});return c};
Y.prototype.loadTree=Y.prototype.Ij;function Vw(a,b){var c=!0;b[0]>a[0]&&(c=!1);b[1]>a[1]&&(c=!1);b[2]<a[2]&&(c=!1);b[3]<a[3]&&(c=!1);return c}Y.prototype.gb=function(){var a=new nf(6378137),b=H(this.X).D(),c=Hk(H(this.X),[37.795275591,0]),d=Kf([c[0],c[1]],b,"EPSG:4326"),b=Kf([c[2],c[3]],b,"EPSG:4326");return 100*pf(a,d,b)};Y.prototype.getScale=Y.prototype.gb;Y.prototype.rf=function(a){var b=this.getScale(),c=H(this.X).na();a=a*c/b;Mk(H(this.X),a);this.getScale()};Y.prototype.setScale=Y.prototype.rf;
Y.prototype.ep=function(a){this.wt=a;Lk(H(this.X),a,this.X.ja(),{Ai:!0})};Y.prototype.df=function(){return H(this.X).df()};Y.prototype.getZoom=Y.prototype.df;Y.prototype.mh=function(a){H(this.X).mh(a)};Y.prototype.setZoom=Y.prototype.mh;Y.prototype.ib=function(a){H(this.X).ib(a)};Y.prototype.setCenter=Y.prototype.ib;
Y.prototype.OG=function(a){var b=this;this.X.cf().clear();"undefined"!==this.Pp&&$(this.Pp).remove();a.ZO&&(this.Pp=Tw(this,this.aj));a.MP&&(this.X.Dc(new hu({ln:function(a){return[a[0].toPrecision(b.Pm),a[1].toPrecision(b.Pm)]}})),$(".ol-mouse-position").css("bottom","8px"),$(".ol-mouse-position").css("top","auto"),$(".ol-mouse-position").css("background","rgba(218, 94, 209, 0.58)"),$(".ol-mouse-position").css("color","#ffffff"),$(".ol-mouse-position").css("border-radius","4px"));a.SL&&(this.X.Dc(new ou),
$(".ol-scale-line").css("background","rgba(218, 94, 209, 0.58)"));a.CP&&this.X.Dc(new Ok({element:b.element,render:function(){$(b.element).html(b.bg)}}))};Y.prototype.setControls=Y.prototype.OG;Y.prototype.WG=function(a){this.X.Nc.clear();"undefined"!==this.Lp&&$(this.Lp).remove();this.Lp=Uw(this,this.aj,a);$l().forEach(function(a){this.X.Ub(a)},this)};Y.prototype.setInteractions=Y.prototype.WG;
Y.prototype.NG=function(a){var b=this.X.getLayers().L()[0];a=new yq({Th:a.culture,key:a.key,wr:a.style});b.set("source",a)};Y.prototype.setBingSource=Y.prototype.NG;Y.prototype.eC=function(){this.Config.extent=Hk(this.Cc,this.X.ja());this.Config.coord=this.Cc.Da();this.Config.scale=Math.round(this.getScale());return this.Config};Y.prototype.getConfig=Y.prototype.eC;Y.prototype.g=function(){return this.X};Y.prototype.getMap=Y.prototype.g;
Y.prototype.lh=function(a){this.bg=a.proj;var b,c;m(a.center.coord)&&(b=a.center.coord);m(a.center.extent)&&(c=a.center.extent);a.center.coord&&a.center.zoom?(this.Cc=new Ek({center:b,zoom:a.center.zoom,projection:vf(this.bg)}),this.X.lh(this.Cc)):(this.Cc=new Ek({center:[(c[0]+c[2])/2,(c[1]+c[3])/2],projection:vf(this.bg)}),this.X.lh(this.Cc),Lk(H(this.X),c,this.X.ja(),{Ai:!0}));a="";for(b=0;b<this.Io.projections;b++)this.bg===this.mF.projections[b].code&&(a=this.mF.projections[b].name);""!==a?$(".ol-current-projection-studio").html(a):
$(".ol-current-projection-studio").html(this.bg)};Y.prototype.setView=Y.prototype.lh;Y.prototype.XG=function(a){this.Ij(a)};Y.prototype.setJsonTree=Y.prototype.XG;Y.prototype.Ka=function(){return this.Cf.L()};Y.prototype.getFeatures=Y.prototype.Ka;Y.prototype.$q=function(){return this.bg};Y.prototype.getProj=Y.prototype.$q;Y.prototype.Z=function(){return Hk(this.Cc,this.X.ja())};Y.prototype.getExtent=Y.prototype.Z;Y.prototype.Da=function(){return this.Cc.Da()};Y.prototype.getCenter=Y.prototype.Da;
Y.prototype.fI=function(a,b,c){return Kf(a,b,c)};Y.prototype.transformer=Y.prototype.fI;Y.prototype.eI=function(a,b,c){return Lf(a,b,c)};Y.prototype.transformExtent=Y.prototype.eI;Y.prototype.on=function(a,b,c){this.X.on(a,b,c)};Y.prototype.on=Y.prototype.on;Y.prototype.Dg=function(a,b){var c=this.g(),d=this,e=new Eg({geometry:new ok([a,b])});c.getLayers().L().forEach(function(a){if(m(a.v().Ka)){var b=a.v().ob;!0!==d.aF&&a.v().ob.clear();b.push(e)}});this.ib([a,b])};var X={};ta("oVFB",X);X.config={};X.oi=function(a){console.log("oVFB.init: ",a);X.config=a};X.init=X.oi;X.resize=function(){};X.resize=X.resize;X.gC=function(){return X.eF};X.getDevTools=X.gC;X.VC=function(){return X.nF};X.getTreeView=X.VC;X.lC=function(){return X.wx};X.getFormTools=X.lC;X.Gg=function(){return X.xx};X.getJsonLoader=X.Gg;X.iC=function(){return X.vx};X.getElementForm=X.iC;X.WC=function(){return X.Dx};X.getVisualizer=X.WC;X.On=function(){return X.yx};X.getJson=X.On;
X.Dy=function(a){X.yx=a};X.setJson=X.Dy;X.Pf=function(){return X.py};X.getJs=X.Pf;X.hk=function(a){X.py=a};X.setJs=X.hk;X.di=function(){return X.ny};X.getCss=X.di;X.Fs=function(a){X.ny=a};X.setCss=X.Fs;X.ha=function(){m(X.Go)||console.error("oVFB.oJsonOutput_ undefined");sb(X.Go)&&console.error("oVFB.oJsonOutput_ is empty");return X.Go};X.getJsonOutput=X.ha;X.gc=function(a){X.Go=a};X.setJsonOutput=X.gc;
X.dw=function(a){var b,c;for(c in a)if(b=a[c],null!=b.rows)for(var d=0;d<b.rows.length;d++)if(null!=b.rows[d].fields)for(var e=0;e<b.rows[d].fields.length;e++)!0===b.rows[d].fields[e].selected&&delete b.rows[d].fields[e].selected;return a};
X.Xv=function(a){for(var b=[],c=[],d=0;d<a.rows.length;d++)if(null!=a.rows[d].fields)for(var e=0;e<a.rows[d].fields.length;e++)null!=a.rows[d].fields[e].name&&b.push(a.rows[d].fields[e].name),null!=a.rows[d].fields[e].buttons&&c.push(a.rows[d].fields[e].name);return{elems:b,buttons:c}};
X.qI=function(a,b){b=b.name;a=a.name;var c=X.ha(),d,e,f;for(f in c)if(d=c[f],null!=d.tabs&&null!=d.tabs.list)for(var g=0;g<d.tabs.list.length;g++)e=d.tabs.list[g],null!=e.elements&&-1!==e.elements.indexOf(b)&&e.elements.splice(e.elements.indexOf(b),1,a);X.gc(c)};X.rI=function(a,b){b=b.name;a=a.name;var c=X.ha(),d,e,f;for(f in c)if(d=c[f],null!=d.wab)for(var g in d.wab)for(var h in d.wab[g])e=d.wab[g][h],null!=e[b]&&(e[a]=e[b],delete e[b]);X.gc(c)};
X.VA=function(a,b){var c;if(null!=a.list)for(var d=0;d<a.list.length;d++)if(c=a.list[d],null!=c.elements)for(var e=c.elements.length-1;0<=e;e--)-1===b.indexOf(c.elements[e])&&(console.error("Element "+c.elements[e]+" is not in elements list"),c.elements.splice(e,1));return a};
X.WA=function(a,b){for(var c in a)for(var d in a[c]){for(var e in a[c][d])-1===b.indexOf(e)&&(console.error("Element "+e+" is not in elements list"),delete a[c][d][e]);for(var f=0;f<b.length;f++)null!=a[c][d][b[f]]||(a[c][d][b[f]]="")}return a};X.XA=function(a){var b;if(null!=a.list)for(var c=0;c<a.list.length;c++)b=a.list[c],null!=b.$$hashKey&&delete b.$$hashKey,null!=b.studio_mode&&delete b.studio_mode;return a};X.pl=function(){return X.kz};X.getTreeDnD=X.pl;X.pm=function(a){X.kz=a};
X.setTreeDnD=X.pm;X.pb=function(){return X.jz};X.getToken=X.pb;X.setToken=function(a){X.jz=a};X.Fb=function(){return X.id};X.getId=X.Fb;X.ci=function(){return X.vt};X.setId=function(a){X.id=a};X.setContainer=function(a){X.KB=a};X.setAppProperties=function(a){X.fa=a};X.setApplication=function(a){X.vt=a};X.reset=function(){};X.module=angular.module("vfb",["ui.codemirror","ui.grid","ui.grid.autoResize","formReader"]);
X.Ty=function(){X.log("nsVFB.MainDirective");null!=X.config||console.error("oVFB['config'] not defined, please use oVFB.init(config)");return{restrict:"A",replace:!0,controller:"AppStudioMainController",controllerAs:"ctrl",scope:!0,bindToController:!0,templateUrl:"javascript/externs/studio/templates/MainTemplate.html"}};X.studioMainDirective=X.Ty;X.module.directive("appStudioMainDirective",X.Ty);
X.J=function(a,b,c,d,e){X.log("nsVFB.MainController");var f=this;this.f=a;this.G=e;this.V=b;this.ua=c;this.$timeout_=d;this.rr=0;this.text={};a.aCollapsed=X.ug;a.text={};a.jsonOutput={};a.datasources={};a.selectedDatasource={};a.webservices=[];a.businessObjects=[];a.ressources=[];a.aExternalDatabaseTables=[];a.schemas=[];a.tables=[];a.selectedDatasource={};a.editedDatasource={};a.newSource={options:["Value one|1","Value two|2","Value three|3"],result_options:[{label:"Value one",value:"1"},{label:"Value two",
value:"2"},{label:"Value three",value:"3"}]};a.editorOptions={mode:"schema",lineNumbers:!1,lineSeparator:"\n",theme:"Veremes",onLoad:function(){}};a.studioAddModalTestGridOptions={data:[],enableColumnMenus:!1,enableColumnResizing:!0,onRegisterApi:function(b){a.sm=b}};a.studioEditModalTestGridOptions={data:[],enableColumnMenus:!1,enableColumnResizing:!0,onRegisterApi:function(b){a.tm=b}};a.studioDatasourcesGridOptions={data:[],columnDefs:[{field:"name",displayName:"Nom"}],enableColumnMenus:!1,enableColumnResizing:!0,
enableRowSelection:!0,multiSelect:!1,enableFullRowSelection:!0,onRegisterApi:function(b){a.datasourcesGridApi=b;b.selection.on.rowSelectionChanged(a,function(b){a.selectedDatasource=angular.copy(a.datasources[b.entity.id]);a.selectedDatasource.id=b.entity.id;f.By(a.selectedDatasource)})}};a.tabs={};a.elems=[];a.sTestTabFormDefinitionName="";a.oTestTabFormValues={};a.oTestTabFormDefinition={};a.oTestTabFormScope={};a.sTestWabFormDefinitionName="";a.oTestWabFormValues={};a.oTestWabFormDefinition={};
a.oTestWabFormScope={};a.oProperties=X.fa;a.sToken=sessionStorage.session_token;a.wab={};a.wabGroups=[];a.wabSelectedGroup="";a.wabSelectedState="";a.applicationName=X.ci();b.get("javascript/externs/studio/lang/lang-"+X.fa.language+".json").success(function(b){a.text=b;f.text=b}).error(function(a,b){console.error("ERROR : (AJAX request : "+b+" ) On loading Language, contact Veremes please")});b({method:"GET",url:X.fa.web_server_name+"/"+X.fa.services_alias+"/vitis/webservices",params:{token:X.pb(),
attributs:"name"},headers:{Accept:"application/x-vm-json"}}).then(function(b){null!=b.data.data?a.webservices=b.data.data:console.error("response.data['data'] not defined")},function(a){console.error("Problem with vitis/webservices contact support");console.error(a)});b({method:"GET",url:X.fa.web_server_name+"/"+X.fa.services_alias+"/vmap/businessobjects",params:{token:X.pb()},headers:{Accept:"application/x-vm-json"}}).then(function(b){if(null!=b.data.data){b=b.data.data;for(var c=0;c<b.length;c++)b[c].sql_form=
"SELECT * FROM "+b[c].schema+"."+b[c].table;a.businessObjects=[];for(c=0;c<b.length;c++)a.businessObjects.push({title:b[c].title,business_object_id:b[c].business_object_id,sql_form:b[c].sql_form,sql_summary:b[c].sql_summary,sql_list:b[c].sql_list})}else console.error("response.data['data'] not defined")},function(a){console.error("Problem with vitis/webservices contact support");console.error(a)});$("#studio-datasource-modal").on("hide.bs.modal",function(){f.Ru();X.reloadForm()});$("#studio-datasource-add-modal").on("hide.bs.modal",
function(){a.aExternalDatabaseTables.length=0;a.schemas.length=0;a.tables.length=0;f.Jk()});$("#studio-datasource-edit-modal").on("hide.bs.modal",function(){a.aExternalDatabaseTables.length=0;a.schemas.length=0;a.tables.length=0;f.Jk()});a.$on("updateForm",function(b,c){a.$applyAsync(function(){a.jsonOutput=c})});a.$on("updateTestTabForm",function(b,c){if(c[a.selected_form_type]){b=c[a.selected_form_type];for(var d=0;d<b.rows.length;d++)for(var e=0;e<b.rows[d].fields.length;e++)b.rows[d].fields[e].id||
(b.rows[d].fields[e].id=b.rows[d].fields[e].name+"_"+(d+1)+"_"+(e+1));a.oTestTabFormDefinition=c;a.sTestTabFormDefinitionName=a.selected_form_type;a.title=b.title;m(a.oTestTabFormValues)||(a.oTestTabFormValues={});m(a.oTestTabFormValues[a.sTestTabFormDefinitionName])||(a.oTestTabFormValues[a.sTestTabFormDefinitionName]={});angular.element($("#studio_test_tabs_form_reader").children()).scope().ctrl.Hi()}else X.log("visualizerFormModeController. Load JSON form fail: "+a.selected_form_type+" undefined in ",
c)});a.$on("updateTestWabForm",function(b,c){if(c[a.selected_form_type]){b=c[a.selected_form_type];for(var d=0;d<b.rows.length;d++)for(var e=0;e<b.rows[d].fields.length;e++)b.rows[d].fields[e].id||(b.rows[d].fields[e].id=b.rows[d].fields[e].name+"_"+(d+1)+"_"+(e+1));a.oTestWabFormDefinition=c;a.sTestWabFormDefinitionName=a.selected_form_type;a.title=b.title;m(a.oTestWabFormValues)||(a.oTestWabFormValues={});m(a.oTestWabFormValues[a.sTestWabFormDefinitionName])||(a.oTestWabFormValues[a.sTestWabFormDefinitionName]=
{});var f=angular.element($("#studio_test_wab_form_reader").children()).scope();null!=f&&f.$applyAsync(function(){f.wabState=a.wabSelectedState;f.wabGroup=a.wabSelectedGroup;f.ctrl.Hi()})}else X.log("visualizerFormModeController. Load JSON form fail: "+a.selected_form_type+" undefined in ",c)});a.$watch("tabs",function(){Ww(f)},!0);a.$watch("wabSelectedGroup",function(){p(a.wabSelectedState)&&p(a.wabSelectedGroup)&&""!==a.wabSelectedGroup&&""!==a.wabSelectedState&&Xw(f)});a.$watch("wabSelectedState",
function(){p(a.wabSelectedState)&&p(a.wabSelectedGroup)&&""!==a.wabSelectedGroup&&""!==a.wabSelectedState&&Xw(f)})};X.studioMainController=X.J;X.module.controller("AppStudioMainController",["$scope","$http","$q",X.J]);X.J.prototype.lH=function(){X.log("studioMainController.showTabsManagerModal");var a=this.f,b=a.selected_form_type,c=X.Xv(a.jsonOutput[b]);X.xf();a.jsonOutput=X.ha();a.tabs=angular.copy(a.jsonOutput[b].tabs);a.elems=c.elems;a.buttons=c.buttons;a.tabs=X.VA(a.tabs,a.elems);Ww(this);$("#studio-tabsmanager-modal").modal("show")};
X.J.prototype.showTabsManagerModal=X.J.prototype.lH;X.J.prototype.UH=function(a,b){-1!==b.elements.indexOf(a)?b.elements.splice(b.elements.indexOf(a),1):b.elements.push(a)};X.J.prototype.toggleElemOnTab=X.J.prototype.UH;X.J.prototype.Ga=function(a){var b=this.f;null!=a||(a={label:b.text.Loader.Tab,elements:[]});b.$applyAsync(function(){b.tabs.list.push(a)})};X.J.prototype.addTab=X.J.prototype.Ga;
X.J.prototype.CA=function(a){var b=this;bootbox.confirm("<h4>"+this.f.text.Loader.AskRemoveTab+"</h4><br>"+a.label,function(c){c&&b.$x(a)})};X.J.prototype.askAndRemoveTab=X.J.prototype.CA;X.J.prototype.$x=function(a){var b=this.f;-1!==b.tabs.list.indexOf(a)?b.$applyAsync(function(){b.tabs.list.splice(b.tabs.list.indexOf(a),1)}):console.error("Tab not founted in scope.tabs.list")};X.J.prototype.removeTab=X.J.prototype.$x;
X.J.prototype.QE=function(a,b){var c=this.f,d=0;-1!==c.tabs.list.indexOf(a)?c.$applyAsync(function(){var e=c.tabs.list.indexOf(a);"left"===b&&(d=-1);"right"===b&&(d=1);0<=e+d&&e+d<c.tabs.list.length&&(c.tabs.list.splice(e,1),c.tabs.list.splice(e+d,0,a))}):console.error("Tab not founted in scope.tabs.list")};X.J.prototype.moveTab=X.J.prototype.QE;X.J.prototype.GG=function(a){var b=this.f;a.elements=[];for(var c=0;c<b.elems.length;c++)a.elements.push(b.elems[c])};X.J.prototype.selectAllElems=X.J.prototype.GG;
X.J.prototype.CG=function(a){var b=this.f,c=b.selected_form_type;$("#studio-tabsmanager-modal").modal("hide");a=X.XA(a);b.jsonOutput[c].tabs=a;X.ha();b.$broadcast("updateForm",b.jsonOutput)};X.J.prototype.saveTabs=X.J.prototype.CG;function Ww(a){a=a.f;var b=X.dw(a.jsonOutput),c=a.selected_form_type;null!=b&&null!=b[c]&&null!=b[c].tabs&&(b[c].tabs=angular.copy(a.tabs),a.$broadcast("updateTestTabForm",b))}
X.J.prototype.mH=function(){X.log("studioMainController.showWabManagerModal");var a=this.f,b=a.selected_form_type,c=X.Xv(a.jsonOutput[b]);X.xf();a.jsonOutput=X.ha();a.wab=angular.copy(a.jsonOutput[b].wab);a.wabGroups=[];a.elems=c.elems;a.buttons=c.buttons;for(var d in a.wab)for(var e in a.wab[d])-1===a.wabGroups.indexOf(e)&&a.wabGroups.push(e);a.wab=X.WA(a.wab,a.elems);$("#studio-wabmanager-modal").modal("show")};X.J.prototype.showWabManagerModal=X.J.prototype.mH;
X.J.prototype.VH=function(a,b,c,d){if(null!=b&&null!=b[c]){var e;if(null!=b[c][a]){e=f;var f=b[c][a];"r"===d&&(e=""===f?"r":"");"rw"===d&&(e=""===f?"rw":"r"===f?"rw":"r");b[c][a]=e}else b[c][a]=d;Xw(this)}};X.J.prototype.toggleElemOnWab=X.J.prototype.VH;X.J.prototype.DG=function(a){var b=this.f,c=b.selected_form_type;$("#studio-wabmanager-modal").modal("hide");b.jsonOutput[c].wab=a;X.ha();b.$broadcast("updateForm",b.jsonOutput)};X.J.prototype.saveWab=X.J.prototype.DG;
function Xw(a){a=a.f;var b=X.dw(a.jsonOutput),c=a.selected_form_type;null!=b&&null!=b[c]&&null!=b[c].wab&&(b[c].wab=angular.copy(a.wab),a.$broadcast("updateTestWabForm",b))}
X.J.prototype.fH=function(){X.log("studioMainController.showDatasourcesModal");var a=this.f;a.jsonOutput=X.ha();m(a.jsonOutput.datasources)&&ka(a.jsonOutput.datasources)&&!fa(a.jsonOutput.datasources)||(a.jsonOutput.datasources={});a.datasources=a.jsonOutput.datasources;$("#studio-datasource-modal").modal("show");a.selectedDatasource={};this.hg();angular.element(z.b).injector().get(["$timeout"])(function(){0<a.datasourcesGridApi.grid.rows.length&&0===a.datasourcesGridApi.selection.getSelectedRows().length&&
a.datasourcesGridApi.selection.selectRow(a.studioDatasourcesGridOptions.data[0])},1)};X.J.prototype.showDatasourcesModal=X.J.prototype.fH;X.J.prototype.QF=function(a){var b=this;this.rr++;var c=angular.copy(this.rr);setTimeout(function(){c===b.rr&&b.Ey(a)},1500)};X.J.prototype.preventLocalDatabaseChanged=X.J.prototype.QF;
X.J.prototype.Ey=function(a){X.log("studioMainController.setLocalDatabaseSchemas");var b=this.V,c=this.f,d=this;b({method:"GET",url:X.fa.web_server_name+"/"+X.fa.services_alias+"/vitis/genericquerys",params:{token:X.pb(),database:a,schema:"pg_catalog",table:"pg_tables",sort_order:"ASC",attributs:"schemaname",distinct:!0},headers:{Accept:"application/x-vm-json"}}).then(function(a){null!=a.data.errorMessage?($.notify(a.data.errorMessage,"error"),c.schemas=[]):null!=a.data.data?c.schemas=a.data.data:
($.notify(d.text.Element.Component.Select.Schema_List_error,"error"),c.schemas=[])},function(a){console.error("Problem with vitis/genericquerys contact support");console.error(a)})};X.J.prototype.setLocalDatabaseSchemas=X.J.prototype.Ey;
X.J.prototype.Yx=function(a,b){X.log("studioMainController.reloadTablesList");var c=this.f,d=this;this.V({method:"GET",url:X.fa.web_server_name+"/"+X.fa.services_alias+"/vitis/genericquerys",params:{token:X.pb(),database:b,schema:a},headers:{Accept:"application/x-vm-json"}}).then(function(a){null!=a.data.errorMessage?($.notify(a.data.errorMessage,"error"),c.tables=[]):null!=a.data.data?c.tables=a.data.data:($.notify(d.text.Element.Component.Select.Table_List_error,"error"),c.tables=[])},function(a){console.error("Problem with vitis/genericquerys contact support");
console.error(a)})};X.J.prototype.reloadTablesList=X.J.prototype.Yx;
X.J.prototype.iH=function(){X.log("studioMainController.showNewSourceModal");for(var a=this.f,b="datasource_1",c=1;m(a.datasources[b]);)b="datasource_"+c,c++;a.newSource={id:b,name:b,description:"",parameters:{},options:["Value one|1","Value two|2","Value three|3"],options_model:"Value one|1\nValue two|2\nValue three|3",result_options:[{label:"Value one",value:"1"},{label:"Value two",value:"2"},{label:"Value three",value:"3"}]};this.Jk();a.aExternalDatabaseTables.length=0;a.schemas.length=0;a.tables.length=
0;$("#studio-datasource-add-modal").modal("show");a.schemaSelected={};a.tableSelected={}};X.J.prototype.showNewSourceModal=X.J.prototype.iH;
X.J.prototype.gH=function(){X.log("studioMainController.showEditSourceModal");var a=this.f;if(0<a.datasourcesGridApi.selection.getSelectedRows().length){if(0===Object.keys(a.selectedDatasource).length)return 0;a.editedDatasource=angular.copy(a.selectedDatasource);this.Jk();a.aExternalDatabaseTables.length=0;a.schemas.length=0;a.tables.length=0;"web_service"===a.editedDatasource.type&&null!=a.editedDatasource.webservice&&null!=a.editedDatasource.webservice.name&&this.qz(a.editedDatasource.webservice);
$("#studio-datasource-edit-modal").modal("show");var b=angular.element(z.b).injector().get(["$timeout"]);b(function(){a.refresh=!0;b(function(){a.refresh=!1},100)},500);for(var c=0;c<a.schemas.length;c++)a.schemas[c].schemaname===a.editedDatasource.parameters.schema&&(a.schemaSelected=a.schemas[c],this.Yx(a.editedDatasource.parameters.schema));b(function(){for(var b=0;b<a.tables.length;b++)a.tables[b].table_name===a.editedDatasource.parameters.table&&(a.tableSelected=a.tables[b])},500)}else bootbox.alert(this.text.Element.Component.Select.Datasource_NothingSelected)};
X.J.prototype.showEditSourceModal=X.J.prototype.gH;
X.J.prototype.iA=function(a){X.log("studioMainController.addSource");var b=this.f;if("text"===a.dataType){b.refresh=!1;if(!m(a.id))return console.error("newSource.id not defined"),0;if(!m(a.name))return console.error("newSource.name not defined"),0;m(a.options)||(console.error("newSource.options not defined"),a.options=[]);if(m(b.datasources[a.id]))return bootbox.alert(this.text.Element.Component.Select.Datasource_Exists),0;a={id:a.id,type:"object",dataType:a.dataType,name:a.name,description:a.description,
options:a.options};$("#studio-datasource-add-modal").modal("hide");this.dk(a);this.hg()}else if("externalDatabase"===a.dataType){if(!m(a.id))return console.error("newSource.id not defined"),0;if(!m(a.name))return console.error("newSource.name not defined"),0;if(!m(a.parameters.server))return console.error("newSource.parameters.server not defined"),0;if(!m(a.parameters.port))return console.error("newSource.parameters.port not defined"),0;if(!m(a.parameters.sgbd))return console.error("newSource.parameters.sgbd not defined"),
0;if(!m(a.parameters.login))return console.error("newSource.parameters.login not defined"),0;if(!m(a.parameters.password))return console.error("newSource.parameters.password not defined"),0;if(!m(a.parameters.database))return console.error("newSource.parameters.database not defined"),0;if(!m(a.parameters.schema))return console.error("newSource.parameters.schema not defined"),0;if(!m(a.parameters.table))return console.error("newSource.parameters.table not defined"),0;if(m(b.datasources[a.id]))return bootbox.alert(this.text.Element.Component.Select.Datasource_Exists),
0;a={id:a.id,type:"web_service",dataType:a.dataType,name:a.name,description:a.description,parameters:a.parameters,ressource_id:"vitis/genericquerys/"+a.parameters.table};$("#studio-datasource-add-modal").modal("hide");this.dk(a);this.hg()}else if("tableValue"===a.dataType){if(!m(a.id))return console.error("newSource.id not defined"),0;if(!m(a.name))return console.error("newSource.name not defined"),0;if(!m(a.parameters.schema))return console.error("newSource.parameters.schema not defined"),0;if(!m(a.parameters.table))return console.error("newSource.parameters.table not defined"),
0;if(m(b.datasources[a.id]))return bootbox.alert(this.text.Element.Component.Select.Datasource_Exists),0;a={id:a.id,type:"web_service",dataType:a.dataType,name:a.name,description:a.description,parameters:a.parameters,ressource_id:"vitis/genericquerys"};$("#studio-datasource-add-modal").modal("hide");this.dk(a);this.hg()}else if("webService"===a.dataType){if(!m(a.id))return console.error("newSource.id not defined"),0;if(!m(a.name))return console.error("newSource.name not defined"),0;if(!m(a.webservice))return bootbox.alert(this.text.Element.Component.Select.WebService_undefined),
console.error("newSource.webservice not defined"),0;if(!m(a.ressource))return bootbox.alert(this.text.Element.Component.Select.Ressource_undefined),console.error("newSource.ressource not defined"),0;if(m(b.datasources[a.id]))return bootbox.alert(this.text.Element.Component.Select.Datasource_Exists),0;a={id:a.id,type:"web_service",dataType:a.dataType,name:a.name,description:a.description,webservice:a.webservice,ressource:a.ressource,ressource_id:a.webservice.name+"/"+a.ressource.name};$("#studio-datasource-add-modal").modal("hide");
this.dk(a);this.hg()}else if("businessObject"===a.dataType){if(!m(a.id))return console.error("newSource.id not defined"),0;if(!m(a.name))return console.error("newSource.name not defined"),0;if(!m(a.businessObject.business_object_id))return bootbox.alert(this.text.Element.Component.Select.BusinessObject_undefined),console.error("newSource.businessObject not defined"),0;if(m(b.datasources[a.id]))return bootbox.alert(this.text.Element.Component.Select.Datasource_Exists),0;a={id:a.id,type:"web_service",
dataType:a.dataType,name:a.name,description:a.description,businessObject:a.businessObject,businessObjectRequest:a.businessObjectRequest,subObject:"bo_"+a.businessObjectRequest,ressource_id:"vmap/querys/"+a.businessObject.business_object_id+"/"+a.businessObjectRequest};$("#studio-datasource-add-modal").modal("hide");this.dk(a);this.hg()}};X.J.prototype.addSource=X.J.prototype.iA;
X.J.prototype.pG=function(){X.log("studioMainController.removeSelectedSource");var a=this,b=this.f,c=b.selectedDatasource.id,d=[];if(null==c)return 0;for(var e in b.jsonOutput)if("datasources"!==e){var f=b.jsonOutput[e];if(null!=f.rows&&fa(f.rows))for(var g=0;g<f.rows.length;g++)if(null!=f.rows[g].fields)for(var h=0;h<f.rows[g].fields.length;h++)null!=f.rows[g].fields[h].datasource&&f.rows[g].fields[h].datasource.datasource_id===c&&d.push({label:f.rows[g].fields[h].label,name:f.rows[g].fields[h].name,
yJ:e})}c=this.text.Element.Component.Select.Datasource_Delete;if(0<d.length){c=this.text.Element.Component.Select.Datasource_Delete_Used;c+="<br><br><ul>";for(g=0;g<d.length;g++)c+="<li>"+d[g].formName+": "+d[g].label+" ("+d[g].name+")</li>";c=c+"</ul><br>"+this.text.Element.Component.Select.Datasource_Delete}bootbox.confirm(c,function(c){!0===c&&(delete b.datasources[b.selectedDatasource.id],b.selectedDatasource={},setTimeout(function(){a.hg()},500),X.gc(b.jsonOutput))})};
X.J.prototype.removeSelectedSource=X.J.prototype.pG;
X.J.prototype.dk=function(a){X.log("studioMainController.saveDatasource");var b=this.f;"object"===a.type?b.datasources[a.id]={type:a.type,dataType:a.dataType,name:a.name,description:a.description,options:a.options}:"web_service"===a.type&&(b.datasources[a.id]={type:a.type,dataType:a.dataType,name:a.name,description:a.description,parameters:a.parameters,ressource_id:a.ressource_id},null!=a.webservice&&(b.datasources[a.id].webservice=a.webservice),null!=a.ressource&&(b.datasources[a.id].ressource=a.ressource),
null!=a.businessObject&&(b.datasources[a.id].businessObject=a.businessObject),null!=a.subObject&&(b.datasources[a.id].subObject=a.subObject),null!=a.businessObjectRequest&&(b.datasources[a.id].businessObjectRequest=a.businessObjectRequest,b.datasources[a.id].subObject="bo_"+a.businessObjectRequest,b.datasources[a.id].ressource_id="vmap/querys/"+a.businessObject.business_object_id+"/"+a.businessObjectRequest));"externalDatabase"===a.dataType&&(b.datasources[a.id].ressource_id="vitis/genericquerys/"+
a.parameters.table);X.gc(b.jsonOutput);this.hg();$.notify(this.text.Element.Component.Select.Saved,{className:"success",autoHideDelay:X.jb});$("#studio-datasource-edit-modal").modal("hide");b.refresh=!1};X.J.prototype.saveDatasource=X.J.prototype.dk;
X.J.prototype.hg=function(){X.log("studioMainController.setStudioGridDatasources");var a=this.f;Ua(a.studioDatasourcesGridOptions.data);var b=angular.copy(a.datasources),c;for(c in a.datasources)b[c].id=c,a.studioDatasourcesGridOptions.data.push(b[c]);a.datasourcesGridApi.grid.refresh();tb(a.selectedDatasource)};X.J.prototype.setStudioGridDatasources=X.J.prototype.hg;
X.J.prototype.By=function(a){X.log("studioMainController.setDatasourceContent");if("object"===a.type){a.options_model="";a.result_options=[];if(fa(a.options))for(var b=0;b<a.options.length;b++)0<b&&(a.options_model+="\n"),a.options_model+=a.options[b];this.oz(a)}};X.J.prototype.setDatasourceContent=X.J.prototype.By;
X.J.prototype.oz=function(a){X.log("studioMainController.updateDatasourceTextContent");a.options=a.options_model.split("\n");Ua(a.result_options);for(var b,c=[],d=[],e=0;e<a.options.length;e++)b=a.options[e].split("|"),c.push(b[0]),d.push(b[1]);b=Object.keys(c);for(e=0;e<b.length;e++)a.result_options.push({label:c[b[e]],value:d[e]})};X.J.prototype.updateDatasourceTextContent=X.J.prototype.oz;
X.J.prototype.qz=function(a){X.log("studioMainController.updateRessources");var b=this.f,c=this.V;c({method:"GET",url:X.fa.web_server_name+"/"+X.fa.services_alias+"/vitis/webservices/"+a.name+"/ressources",params:{token:X.pb(),attributs:"name"},headers:{Accept:"application/x-vm-json"}}).then(function(a){null!=a.data.data?b.ressources=a.data.data:console.error("response.data['data'] not defined")},function(a){console.error("Problem with vitis/webservices contact support");console.error(a)})};
X.J.prototype.updateRessources=X.J.prototype.qz;X.J.prototype.az=function(a,b){X.log("studioMainController.testTableValues");var c=this.f,d=X.fa.web_server_name+"/"+X.fa.services_alias+"/vitis/genericquerys",e={token:X.pb(),limit:10};null!=a.parameters&&xb(e,a.parameters);"studio-datasource-add-modal"===b?this.kg(d,e,c.studioAddModalTestGridOptions,c.sm):"studio-datasource-edit-modal"===b&&this.kg(d,e,c.studioEditModalTestGridOptions,c.tm)};X.J.prototype.testTableValues=X.J.prototype.az;
X.J.prototype.$y=function(a,b){X.log("studioMainController.testExternalDatabaseValues");var c=this.f;if(null==a.parameters.server)return bootbox.alert("server "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.port)return bootbox.alert("Port "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.sgbd)return bootbox.alert("SGBD "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.login)return bootbox.alert("Login "+this.text.Element.Component.Select.Undefined),
0;if(null==a.parameters.password)return bootbox.alert("Password "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.database)return bootbox.alert("Database "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.schema)return bootbox.alert("Schema "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.table)return bootbox.alert("Table "+this.text.Element.Component.Select.Undefined),0;var d=X.fa.web_server_name+"/"+X.fa.services_alias+"/vitis/genericquerys/"+
a.parameters.table;a={token:X.pb(),limit:10,login:a.parameters.login,password:a.parameters.password,server:a.parameters.server,port:a.parameters.port,sgbd:a.parameters.sgbd,database:a.parameters.database,schema:a.parameters.schema,filter:""==a.parameters.filter?void 0:a.parameters.filter};"studio-datasource-add-modal"===b?this.kg(d,a,c.studioAddModalTestGridOptions,c.sm):"studio-datasource-edit-modal"===b&&this.kg(d,a,c.studioEditModalTestGridOptions,c.tm)};
X.J.prototype.testExternalDatabaseValues=X.J.prototype.$y;X.J.prototype.GH=function(a,b){"externalDatabase"===a.dataType?this.$y(a,b):"tableValue"===a.dataType?this.az(a,b):"webService"===a.dataType?this.cz(a,b):"businessObject"===a.dataType&&this.Zy(a,b)};X.J.prototype.testDatasource=X.J.prototype.GH;
X.J.prototype.cz=function(a,b){X.log("studioMainController.testWebService");var c=this.f;m(a.webservice)||bootbox.alert(this.text.Element.Component.Select.WebServiceUndefined);m(a.ressource)||bootbox.alert(this.text.Element.Component.Select.RessourceUndefined);a=X.fa.web_server_name+"/"+X.fa.services_alias+"/"+a.webservice.name+"/"+a.ressource.name;var d={token:X.pb(),limit:10};"studio-datasource-add-modal"===b?this.kg(a,d,c.studioAddModalTestGridOptions,c.sm):"studio-datasource-edit-modal"===b&&
this.kg(a,d,c.studioEditModalTestGridOptions,c.tm)};X.J.prototype.testWebService=X.J.prototype.cz;
X.J.prototype.Zy=function(a,b){X.log("studioMainController.testBusinessObject");var c=this.f;m(a.businessObject)||bootbox.alert(this.text.Element.Component.Select.BusinessObject_undefined);m(a.businessObjectRequest)||bootbox.alert(this.text.Element.Component.Select.BusinessObject_Request_undefined);var d=X.fa.web_server_name+"/"+X.fa.services_alias+"/vmap/querys/"+a.businessObject.business_object_id+"/"+a.businessObjectRequest,e={token:X.pb(),limit:10};null!=a.parameters&&xb(e,a.parameters);"studio-datasource-add-modal"===
b?this.kg(d,e,c.studioAddModalTestGridOptions,c.sm,"bo_"+a.businessObjectRequest):"studio-datasource-edit-modal"===b&&this.kg(d,e,c.studioEditModalTestGridOptions,c.tm,"bo_"+a.businessObjectRequest)};X.J.prototype.testBusinessObject=X.J.prototype.Zy;
X.J.prototype.kg=function(a,b,c,d,e){function f(){setTimeout(function(){!1===n&&bootbox.confirm(g.text.Element.Component.Select.Cancel,function(a){!0===a?r.resolve():f()})},5E3)}X.log("studioMainController.testRequestAPI");var g=this,h=this.V,l=this.ua;if(!m(a))return console.error("url not defined"),0;if(!m(b))return console.error("params not defined"),0;var n=!1,r=l.defer();h({method:"GET",url:a,params:b,timeout:r.promise,headers:{Accept:"application/x-vm-json"}}).then(function(a){n=!0;if(!m(a.data))return bootbox.alert("response['data'] undefined"),
0;if(m(a.data.errorMessage))return bootbox.alert(a.data.errorType+": "+a.data.errorMessage),0;if(!m(a.data.data))return bootbox.alert(g.text.Element.Component.Select.NoDataReturned),0;var b;if(null!=e){b=[];for(var f=0;f<a.data.data.length;f++)b.push(a.data.data[f][e])}else b=a.data.data;a=Object.keys(b[0]);for(var h=[],f=0;f<a.length;f++)h.push({name:a[f],displayName:a[f],width:100});c.data=b;c.columnDefs=h;d.grid.refresh()},function(a){n=!0;bootbox.alert(a)});f()};X.J.prototype.testRequestAPI=X.J.prototype.kg;
X.J.prototype.Ru=function(){X.log("studioMainController.clearDatasourcesGrid");var a=this.f;a.studioDatasourcesGridOptions.data=[];a.datasourcesGridApi.grid.refresh()};X.J.prototype.clearDatasourcesGrid=X.J.prototype.Ru;X.J.prototype.Jk=function(){X.log("studioMainController.clearTestGrids");var a=this.f;a.studioAddModalTestGridOptions.data=[];a.studioAddModalTestGridOptions.columnDefs=[];a.sm.grid.refresh();a.studioEditModalTestGridOptions.data=[];a.studioEditModalTestGridOptions.columnDefs=[];a.tm.grid.refresh()};
X.J.prototype.clearTestGrids=X.J.prototype.Jk;
X.J.prototype.jC=function(a){function b(){setTimeout(function(){!1===h&&bootbox.confirm(c.text.Element.Component.Select.Cancel,function(a){!0===a?l.resolve():b()})},5E3)}X.log("studioMainController.getExternalDatabaseTables");var c=this,d=this.V,e=this.f,f=this.ua;if(null==a.parameters.server)return bootbox.alert("Server "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.port)return bootbox.alert("Port "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.sgbd)return bootbox.alert("SGBD "+
this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.login)return bootbox.alert("Login "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.password)return bootbox.alert("Password "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.database)return bootbox.alert("Database "+this.text.Element.Component.Select.Undefined),0;if(null==a.parameters.schema)return bootbox.alert("Schema "+this.text.Element.Component.Select.Undefined),0;var g=X.fa.web_server_name+
"/"+X.fa.services_alias+"/vitis/genericquerys";a={token:X.pb(),limit:50,login:a.parameters.login,password:a.parameters.password,server:a.parameters.server,port:a.parameters.port,sgbd:a.parameters.sgbd,database:a.parameters.database,schema:a.parameters.schema};if(null==g)return console.error("url undefined"),0;if(null==a)return console.error("params undefined"),0;var h=!1,l=f.defer();d({method:"GET",url:g,params:a,timeout:l.promise,headers:{Accept:"application/x-vm-json"}}).then(function(a){h=!0;if(!m(a.data))return bootbox.alert("response['data'] undefined"),
0;if(m(a.data.errorMessage))return bootbox.alert(a.data.errorType+": "+a.data.errorMessage),0;if(!m(a.data.data))return bootbox.alert(c.text.Element.Component.Select.NoDataReturned),0;fa(e.aExternalDatabaseTables)?e.aExternalDatabaseTables.length=0:e.aExternalDatabaseTables=[];for(var b=0;b<a.data.data.length;b++)e.aExternalDatabaseTables.push(a.data.data[b].table_name)},function(a){bootbox.alert(a)});b()};X.J.prototype.getExternalDatabaseTables=X.J.prototype.jC;X.rg=Aw;
"dev"===oProperties.mode&&(X.rg.mJ=!0);X.log=X.rg.log;X.xf=X.rg.xf;X.reloadForm=X.rg.reloadForm;X.removeWebServiceFromFields=X.rg.removeWebServiceFromFields;X.$i=X.rg.$i;X.Mp=X.rg.Mp;X.clone=X.rg.clone;X.eF={};X.xx={};X.nF={};X.wx={};X.vx={};X.MJ={};X.Dx={};X.yx={empty:!0};X.Go={};X.py="";X.ny="";X.jb=oProperties.timeNotify;X.ug=[!1,!1,!1,!1,!1];X.valid=!0;X.cj=[];X.jz="";X.vt="";X.id=0;X.KB=null;X.fa=null;X.kz="no tree";X.xx=new Bw;X.wx=new Gw;X.vx=new Rw;X.Dx=new Qw;var Yw={css:"css/lib/bootstrap/css/bootstrap.min.css css/lib/jquery/plugins/bootstrap-datepicker/bootstrap-datepicker3.min.css css/lib/jquery/plugins/bootstrap-fileinput/css/fileinput.min.css css/lib/ui-grid/ui-grid.min.css css/lib/jquery/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css css/lib/bootstrap-checkbox/build.css css/lib/bootstrap-checkbox/font-awesome.css css/lib/jquery/plugins/bootstrap-slider/bootstrap-slider.min.css css/lib/jquery/plugins/malihu-custom-scrollbar/jquery.mCustomScrollbar.min.css css/lib/ui-grid/plugins/draggable-rows.less less/main.less modules/vitis/less/main.less javascript/externs/studio/less/studio.less modules/vmap/css/lib/bootstrap-toggle/bootstrap-toggle.css modules/vmap/css/lib/colorpicker/css/bootstrap-colorpicker.css modules/vmap/css/lib/bootstrap-table/bootstrap-table.min.css modules/vmap/css/lib/jquery-sortable/jquery-sortable.css modules/vmap/css/ol.css modules/vmap/css/vmap.less modules/vm4ms/less/main.less css/lib/codemirror/codemirror.css css/lib/codemirror/codemirror_foldgutter.css css/lib/codemirror/map.css css/lib/codemirror/show-hint.css javascript/externs/studio/less/CodeMirror.less css/lib/jquery/plugins/bootstrap-treeview/bootstrap-treeview.min.css css/lib/jquery/plugins/bootstrap-tagsinput/bootstrap-tagsinput.css css/lib/jquery/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css css/lib/viewer/viewer.min.css".split(" "),
js:{externs:"modules/vmap/javascript/externs/bootstrap-toggle/bootstrap-toggle.min.js modules/vmap/javascript/externs/bootstrap-table/bootstrap-table.js modules/vmap/javascript/externs/bootstrap-table/bootstrap-table-export.js modules/vmap/javascript/externs/bootstrap-table/tableExport.js modules/vmap/javascript/externs/jquery-sortable/jquery-sortable.js modules/vmap/javascript/externs/html2canvas/html2canvas.js modules/vmap/javascript/externs/jspdf/jspdf.debug.js javascript/externs/bootbox/bootbox.min.js javascript/externs/codemirror/codemirror.min.js javascript/externs/codemirror/htmlmixed.js javascript/externs/codemirror/css.js javascript/externs/codemirror/javascript.js javascript/externs/codemirror/clike.js javascript/externs/codemirror/php.js javascript/externs/codemirror/xml.js javascript/externs/codemirror/sql.js javascript/externs/codemirror/map.js javascript/externs/codemirror/show-hint.js javascript/externs/codemirror/addon/fold/foldcode.js javascript/externs/codemirror/addon/fold/foldgutter.js javascript/externs/codemirror/addon/fold/brace-fold.js javascript/externs/codemirror/addon/fold/xml-fold.js javascript/externs/angular/modules/ui-codemirror/ui-codemirror.min.js javascript/externs/tinymce/tinymce.min.js javascript/externs/angular/modules/ui-tinymce/tinymce.js javascript/externs/jquery/plugins/bootstrap-treeview/bootstrap-treeview.js javascript/externs/jquery/plugins/bootstrap-tagsinput/bootstrap-tagsinput.min.js javascript/externs/scripts_cryptage.js javascript/externs/moment/moment.min.js javascript/externs/moment/min/moment-with-locales.min.js javascript/externs/jquery/plugins/notify/notify.js javascript/externs/jquery/plugins/bootstrap-colorpicker/bootstrap-colorpicker.min.js javascript/externs/jquery/plugins/bootstrap-confirmation/bootstrap-confirmation.min.js javascript/externs/jquery/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js javascript/externs/viewer/viewer.min.js".split(" ")},
vitisModuleDependencies:["vmap","ui.codemirror","ui.tinymce","vfb","ui.grid.draggable-rows"]};sessionStorage.loading_counter=0;Vd();var Zw=Yw.css;
if("object"==typeof Zw&&null!=Zw){var $w=Date.now();"undefined"!=typeof oClientProperties&&($w=oClientProperties.build);for(var ax=document.getElementsByTagName("link"),bx=[],cx=0;cx<ax.length;)""!=ax[cx].href&&bx.push(ax[cx].href),cx++;for(var cx=0,dx=!1;cx<Zw.length;)Zw[cx]=Zw[cx]+"?version="+$w,ax=document.createElement("link"),ax.setAttribute("href",Zw[cx]),-1==Ud(ax.href,bx)?(ax.setAttribute("type","text/css"),-1==Zw[cx].indexOf(".less")?(ax.setAttribute("rel","stylesheet"),document.getElementsByTagName("head")[0].appendChild(ax)):
(ax.setAttribute("rel","stylesheet/less"),less.sheets.push(ax),dx=!0)):console.log(Zw[cx]+" -> d\u00e9ja charg\u00e9"),cx++;dx&&less.refresh()}Td(Yw.js.externs,{async:!1,scriptInBody:!0,callback:function(){angular.bootstrap(document,["vitisApp"])}});$(document).keydown(function(a){27===a.keyCode&&Wd()});function ex(a,b,c){return{token:"",validity_date:"",duration:600,web_service:"vitis",web_service_controller:"privatetoken",application_modules:[],connect:function(){a.defaults.headers.common["Session-token"]=this.token;c.sMainTemplateUrl="templates/mainTpl.html"},disconnect:function(){document.cookie.split(";").forEach(function(a){aCookie=a.split("=");aCookie[1]==sessionStorage.getItem("session_token")&&(document.cookie=aCookie[0]+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;")});this.clearSessionStorage();
var a=Object.keys(oUrlParams);if(-1!==a.indexOf("login")&&-1!==a.indexOf("password")){delete oUrlParams.login;delete oUrlParams.password;var a=Object.keys(oUrlParams),c=[],f;a.forEach(function(a){f=a;"undefined"!=typeof oUrlParams[a]&&(f+=oUrlParams[a]);c.push(f)});b.location.search="?"+c.join("&")}else b.location.reload()},clearSessionStorage:function(){for(var a=["session_token","user_login","user_id","stats_per_date"],b=0;b<a.length;)sessionStorage.removeItem(a[b]),this.removeAppLocalStorageItem(a[b]),
b++},saveSessionToLocalStorage:function(){for(var a=["session_token","user_login","user_id"],b=0;b<a.length;)this.setAppLocalStorageItem(a[b],sessionStorage[a[b]]),b++},restoreSessionFromAppLocalStorage:function(){for(var a=["session_token","user_login","user_id"],b=0;b<a.length;)sessionStorage[a[b]]=this.getAppLocalStorageItem(a[b]),b++},getAppLocalStorageItem:function(a){return localStorage.getItem(sessionStorage.appEnv+"_"+a)},setAppLocalStorageItem:function(a,b){localStorage.setItem(sessionStorage.appEnv+
"_"+a,b)},removeAppLocalStorageItem:function(a){localStorage.removeItem(sessionStorage.appEnv+"_"+a)}}}ex.$inject=["$http","$window","envSrvc"];
function fx(a,b,c,d){return{sMode:"search",oSelectedMode:"",oSelectedObject:"",oSectionForm:{},sSelectedTemplate:"",sMainTemplateUrl:"",sId:"",sIdField:"",sLastSelectedMode:"",oLastSelectedObjectMode:{},oFormDefinition:{},sFormDefinitionName:"",oFormValues:{},oFormDefaultValues:{},oGridOptions:{},oGridOptionsCopy:{},oDefaultGridOptions:{},sTemplateFolder:"templates/",oWorkspaceList:{},oWorkspaceListRefreshTimer:{},setMode:function(a,c){var d=this,e=b.get(["formSrvc"]).checkFormModifications(this.sFormDefinitionName);
e.then(function(){d.sMode=a;if("insert"==a)d.sId="";else if("search"==a&&"undefined"!=typeof d.oSectionForm){var b=d.oSectionForm[d.oSelectedObject.name];"undefined"!=typeof b&&(b.iSelectedSectionIndex=0)}d.loadObjectTemplate({bForceTemplateCompilation:!0,sUrlTemplate:c})});return e},loadObjectTemplate:function(b){var e=!0;this.oSelectedMode.reload||"undefined"==typeof this.oLastSelectedObjectMode[this.oSelectedMode.mode_id]||(e=!1);this.oLastSelectedObjectMode[this.oSelectedMode.mode_id]=this.oSelectedObject;
this.oLastSelectedObjectMode[this.oSelectedMode.mode_id].lastMode=this.sMode;this.setFormDefinitionName();var g=this;e||b.bForceTemplateCompilation?"undefined"!=typeof b.sUrlTemplate?a.compileObjectTemplate(b.sUrlTemplate):("undefined"!=typeof this.oSelectedObject.event&&(a.$eval(this.oSelectedObject.event),this.setFormDefinitionName(),!0===b.bFirstModeObject&&(this.oLastSelectedObjectMode[this.oSelectedMode.mode_id]=this.oSelectedObject,this.oLastSelectedObjectMode[this.oSelectedMode.mode_id].lastMode=
this.sMode)),"undefined"==typeof g.oSelectedObject.sections?(b=c.one(d.services_alias+"/vitis"),e=sessionStorage.application_modules.split(",").map(function(a){return"'"+a+"'"}).join(","),b.customGET("VitisSections",{token:sessionStorage.session_token,order_by:"index",filter:"tab_id="+this.oSelectedObject.tab_id+" AND lang='"+d.language+"' AND module_name IN("+e+")"}).then(function(b){1==b.status&&(g.oSelectedObject.sections=b.vitissections,g.sSelectedTemplate=b.vitissections[0].template,b="search"!=
g.sMode&&1<b.vitissections.length?g.sTemplateFolder+"sectionFormTpl.html":-1!=g.sSelectedTemplate.indexOf("/")?g.sSelectedTemplate:g.sTemplateFolder+g.sSelectedTemplate,g.setFormDefinitionName(),a.compileObjectTemplate(b),a.$broadcast(a.sSelectedObjectName+"_form",{}))})):(g.sSelectedTemplate=this.oSelectedObject.sections[0].template,a.compileObjectTemplate("search"!=g.sMode&&1<g.oSelectedObject.sections.length?g.sTemplateFolder+"sectionFormTpl.html":-1!=g.sSelectedTemplate.indexOf("/")?g.sSelectedTemplate:
g.sTemplateFolder+g.sSelectedTemplate))):($("#data_column .container-mode").hide(),$("#container_mode_"+this.oSelectedMode.mode_id).show())},extractWebServiceData:function(a,b){var c=[];"undefined"!=typeof b[a]&&(Array.isArray(b[a])?0<b[a].length&&(c=b[a]):c=b[a]);return c},addSectionForm:function(){this.setSectionForm("insert")},addDoubleForm:function(){this.sSelectedTemplate="doubleFormTpl.html";this.sId="";this.setMode("insert",this.sTemplateFolder+this.sSelectedTemplate)},setSectionForm:function(a,
b){var c;this.sSelectedTemplate="simpleFormTpl.html";c=1<this.oSelectedObject.sections.length?"sectionFormTpl.html":"simpleFormTpl.html";"insert"!=a&&(this.sId=b);this.setMode(a,this.sTemplateFolder+c)},explodeWebServiceResourceId:function(a){var b=[];"string"==typeof a&&(b=a.split("/"));return b},getSectionWebServiceResourceId:function(){var a=this.oSelectedObject.ressource_id;if("undefined"!=typeof this.oSectionForm[this.oSelectedObject.name]){var b=this.oSectionForm[this.oSelectedObject.name];
"undefined"!=typeof b.sections&&null!=b.sections[b.iSelectedSectionIndex].ressource_id&&(a=b.sections[b.iSelectedSectionIndex].ressource_id)}return a},setFormDefinitionName:function(){if("undefined"==typeof this.oSelectedObject.sections)this.sFormDefinitionName=this.oSelectedObject.name+"_"+this.sMode+"_form";else{var a=0;"undefined"!=typeof this.oSectionForm[this.oSelectedObject.name]&&"undefined"!=typeof this.oSectionForm[this.oSelectedObject.name].iSelectedSectionIndex&&(a=this.oSectionForm[this.oSelectedObject.name].iSelectedSectionIndex);
this.sFormDefinitionName=1==this.oSelectedObject.sections.length||"search"==this.sMode?this.oSelectedObject.name+"_"+this.sMode+"_form":this.oSelectedObject.name+"_"+this.oSelectedObject.sections[a].name+"_"+this.sMode+"_form"}},toGarbageCollection:function(a){if(null!=a){var b=this;Array.isArray(a)?a.length=0:"object"==typeof a&&Object.keys(a).forEach(function(c){Array.isArray(a[c])||"object"==typeof a[c]?b.toGarbageCollection(a[c]):delete a[c]})}}}}
fx.$inject=["$rootScope","$injector","Restangular","propertiesSrvc"];z.zI=function(){return{id:"",login:""}};
function gx(a,b,c,d,e,f,g,h,l,n){return{modes:"",scope:"",getMode:function(a){for(var b=0;b<this.modes.length;){if(this.modes[b].mode_id==a)return this.modes[b];b++}return{}},getObject:function(a,b){for(var c=0;c<b.objects.length;){if(b.objects[c].name==a)return b.objects[c];c++}return{}},selectMode:function(a,b,f,h){h=null!=h?h:0;var l=this,r=c.defer();n.checkFormModifications(g.sFormDefinitionName).then(function(){var c;c=!0;"undefined"!=typeof g.oSelectedMode.mode_id&&(c=g.oSelectedMode.reload)&&
(angular.element("#container_mode_"+g.oSelectedMode.mode_id).empty(),l.clearObjectData(g.oSelectedObject.name,g.oSelectedMode.mode_id),g.oLastSelectedObjectMode[g.oSelectedMode.mode_id]=null,"undefined"!=typeof g.oSectionForm[g.oSelectedObject.name]&&(g.oSectionForm[g.oSelectedObject.name]={}));var n=l.getMode(b);g.oSelectedMode=n;var t=g.oLastSelectedObjectMode[g.oSelectedMode.mode_id];c||sb(t)||"undefined"==t.lastMode?(g.oSelectedObject=n.objects[h],l.scope=a,c=!0):(g.sMode=t.lastMode,g.oSelectedObject=
t,c=!1);d.sSelectedObjectName=g.oSelectedObject.name;a.objects=1<n.objects.length||null!==n.objects[h].label?n.objects:{};"undefined"!==typeof f?($("#mode_column > ul > li > a").removeClass("mode_selected"),$(f.target).addClass("mode_selected")):($("#mode_column > ul > li > a").removeClass("mode_selected"),$("#mode_"+b).addClass("mode_selected"));g.loadObjectTemplate({bForceTemplateCompilation:!1,bFirstModeObject:c});e(function(){d.$broadcast(d.sSelectedObjectName,{})},300);r.resolve()});return r.promise},
selectObject:function(a,b,c){var f=this;n.checkFormModifications(g.sFormDefinitionName).then(function(){"undefined"==typeof c&&(c="search");angular.element("#container_mode_"+g.oSelectedMode.mode_id).empty();f.clearObjectData(g.oSelectedObject.name,g.oSelectedMode.mode_id);"undefined"!=typeof g.oSectionForm[b]&&(g.oSectionForm[b]={},g.oLastSelectedObjectMode[g.oSelectedMode.mode_id].sFormDefinitionName=null);g.sMode=c;g.oSelectedObject=f.getObject(b,g.oSelectedMode);d.sSelectedObjectName=g.oSelectedObject.name;
g.loadObjectTemplate({bForceTemplateCompilation:!0});e(function(){d.$broadcast(d.sSelectedObjectName,{})},1)})},loadModes:function(){var d=f.one(l.services_alias+"/vitis"),e={token:h.token,filter:"application_name='"+sessionStorage.application+"'",order_by:"index",distinct:"true"},g=this,n=c.defer();d.customGET("modes",e,{Accept:"application/x-vm-json"}).then(function(c){if(1==c.status){var d=c.data,e;c=0;for(var f;c<d.length;){e=d[c].data[0].data;m(e)||(console.error("Objets du mode "+d[c].mode_id+
" non d\u00e9finis"),console.error(d[c]));for(f=0;f<e.length;)e[f].name=e[f].mode_id+"_"+e[f].name,e[f].event=e[f].event.replace("javascript:",""),e[f].aScope=[],e[f].display_menu=!0,f++;d[c].objects=e;d[c].data=void 0;d[c].fullScreen=!1;d[c].ajaxLoader=!0;c++}g.modes=d;n.resolve("modes saved");e=[];for(c=0;c<d.length;)-1==e.indexOf(d[c].module_name)&&e.push(d[c].module_name),c++;sessionStorage.application_modules=e;for(c=0;c<e.length;)b.addPart("modules/"+e[c]+"/lang"),c++;a.refresh().then(function(){for(var b=
0,c=0,e,f;b<d.length;)e="TITLE_MODE_"+d[b].mode_id.toUpperCase(),f="TEXT_MODE_"+d[b].mode_id.toUpperCase(),a([e,f],{app_name:l.app_name}).then(function(a){var b=Object.keys(a);d[c].title=a[b[0]];d[c].text=a[b[1]];c++}),b++})}});return n.promise},setModeReload:function(a,b){for(var c=0;c<this.modes.length;)this.modes[c].mode_id==a&&(this.modes[c].reload=b),c++},clearObjectData:function(a,b){a=this.getObject(a,this.getMode(b));null!=a.aScope&&(a.aScope.forEach(function(a){a.$destroy()}),a.aScope.length=
0)},addScopeToObject:function(a,b,c){oObject=this.getObject(a,this.getMode(b));"undefined"==typeof oObject.aScope&&(oObject.aScope=[]);oObject.aScope.push(c)}}}gx.$inject="$translate $translatePartialLoader $q $rootScope $timeout Restangular envSrvc sessionSrvc propertiesSrvc formSrvc".split(" ");
z.zn=function(a,b,c,d){return{resizeWin:function(){var a=document.getElementById("container").offsetHeight;null==document.getElementById("header_line")||""!==document.getElementById("header_line").style["margin-top"]&&"0px"!==document.getElementById("header_line").style["margin-top"]||(a-=document.getElementById("header_line").offsetHeight);null==document.getElementById("footer_line")||""!==document.getElementById("footer_line").style["margin-top"]&&"0px"!==document.getElementById("footer_line").style["margin-top"]||
(a-=document.getElementById("footer_line").offsetHeight);document.getElementById("works_line").style.height=a+"px";for(var a=$(".workspacelist-grid"),b=0;b<a.length;){var c=a[b].offsetHeight,d=a[b].offsetWidth;null!=document.getElementById(a[b].id+"_header")&&(c-=document.getElementById(a[b].id+"_header").offsetHeight);null!=document.getElementById(a[b].id+"_footer")&&(c-=document.getElementById(a[b].id+"_footer").offsetHeight);document.getElementById(a[b].id+"_data").style.height=c-2+"px";document.getElementById(a[b].id+
"_data").style.width=d-2+"px";b++}},clearLessCache:function(){for(var a=0;a<window.localStorage.length;){var b=window.localStorage.key(a);-1!=b.indexOf(".less")?window.localStorage.removeItem(b):a++}},preg_replace:function(a,b,c){c=String(c);for(i=0;i<a.length;i++)c=c.replace(RegExp(a[i],"gi"),b[i]);return c},modalWindow:function(e,f,g){d.info("modalWindow");var h=c.defer(),l=h.promise;"undefined"==typeof g&&(g={});var n=[];"undefined"!=typeof f&&""!=f&&n.push(f);"undefined"!=typeof g.message&&""!=
g.message?n.push(g.message):g.message="&nbsp;";b(n).then(function(b){var c,d=!1;"&nbsp;"!=g.message&&(g.message=b[g.message]);if("undefined"!=typeof f&&""!=f){g.title=b[f];switch(g.className){case "modal-danger":c="exclamation-sign";d=!0;break;case "modal-success":c="ok-sign";d=!0;break;case "modal-warning":c="warning-sign"}"undefined"!=typeof c&&(g.title='<span class="glyphicon glyphicon-'+c+'" aria-hidden="true"></span>&nbsp;'+b[f])}d&&"dialog"==e&&(g.buttons={close:{label:"OK",className:"btn-default"}});
oDialog=bootbox[e](g);h.resolve(oDialog);"undefined"!=typeof g.appDuration?setTimeout(function(){oDialog.modal("hide");"undefined"!=typeof g.appCallback&&g.appCallback(a,oDialog)},g.appDuration):"undefined"!=typeof g.appCallback&&g.appCallback(a,oDialog)});return l}}};z.externFunctionSrvc=z.zn;z.zn.$inject=["$rootScope","$translate","$q","$log"];
function hx(a,b){return{getFromServer:function(){var b=a.one(this.services_alias+"/vitis"),d=this,e={};"undefined"!=typeof sessionStorage.session_token&&(e={token:sessionStorage.session_token});return b.customGET("properties",e).then(function(a){delete a.status;for(var b=0,c=Object.keys(a);b<c.length;)d[c[b]]=a[c[b]],b++;d.session_token=sessionStorage.session_token;z.Gk("properties_loaded")})},getFromClient:function(){var a=this;return b.get("conf/properties.json").success(function(b){for(var c=0,
d=Object.keys(b);c<d.length;)a[d[c]]=b[d[c]],c++;a.session_token=sessionStorage.session_token})}}}hx.$inject=["Restangular","$http"];function ix(a,b,c,d,e,f,g,h){return{getFormData:function(a,b,c){null!=c||(c={});var e=null!=c.oFormValues?c.oFormValues:d.oFormValues,f=null!=c.aParamsToSave?c.aParamsToSave:[],g,h,l,n=(null!=c.oFormDefinition?c.oFormDefinition:d.oFormDefinition)[a].rows,r=e[a],w,A,G=0;for(c={};G<n.length;){g=n[G].fields;for(A=0;A<g.length;){if("undefined"!=typeof g[A])switch(g[A].type){case "upload":case "file_wsdata":case "image_wsdata":null!=document.getElementById(g[A].id)&&(w=!0,h=document.getElementById(g[A].id).files,
null!=h?0<h.length?c[g[A].name]=h[0]:w=!1:w=!1,w||(w=r[g[A].name],null!=w&&null!=w.aFiles&&null!=w.aFiles[0]&&(c[g[A].name]=w.aFiles[0])));break;case "double_select":h=r[g[A].name];if("undefined"!=typeof h){w=0;for(l=[];w<h.options.length;)l.push(h.options[w].value),w++;c[g[A].name]=l.join("|")}break;case "select":case "editable_select":null!=r[g[A].name]&&(w=r[g[A].name].selectedOption.value,"undefined"!=typeof w&&"?"!=w&&(c[g[A].name]=w));break;case "list":if(null!=r[g[A].name]&&(h=r[g[A].name].selectedOption,
fa(h))){l=[];for(w=0;w<h.length;w++)null!=h[w].value&&"?"!=h[w].value&&l.push(h[w].value);c[g[A].name]=l.join("|")}break;case "title":case "subtitle":case "label":case "button":break;default:"undefined"!=typeof r&&null!=r[g[A].name]&&(c[g[A].name]=r[g[A].name])}A++}G++}if(!0===b)for(b=c,w=0;w<f.length;w++)null!=b[f[w]]||null!=e[a][f[w]]&&(b[f[w]]=e[a][f[w]]);else for(b=new FormData,a=Object.keys(c),w=0;w<a.length;)b.append(a[w],c[a[w]]),w++;return b},setWebServiceSelectOptions:function(a,b){h.setWebServiceSelectOptions(a,
b,d.oFormValues,e,f.token)},setSelectOptions:function(a,b){h.setSelectOptions(a,b,d.oFormValues)},extractFormDefinitionInfos:function(){h.extractFormDefinitionInfos(d.oFormDefinition[d.sFormDefinitionName].name)},clearFormData:function(){},reloadSelectField:function(a,b){h.reloadSelectField(a,b,d.oFormValues,d.oFormDefinition)},getFormElementDefinition:function(a,b){return h.getFormElementDefinition(a,b,d.oFormDefinition)},getAllFormElementDefinition:function(a){return h.getAllFormElementDefinition(a,
d.oFormDefinition)},setWebServiceTags:function(a,b){h.setWebServiceTags(a,b,d.oFormValues)},checkFormModifications:function(a){return h.checkFormModifications(a)}}}ix.$inject="$translate $rootScope Restangular envSrvc propertiesSrvc sessionSrvc externFunctionSrvc formReaderService".split(" ");var jx="ui.grid ui.grid.selection ui.grid.pagination ui.grid.moveColumns ui.grid.resizeColumns pascalprecht.translate restangular angular.bind.notifier formReader".split(" "),jx=jx.concat(Yw.vitisModuleDependencies);z.module=angular.module("vitisApp",jx);z.module.service("sessionSrvc",ex);z.module.service("envSrvc",fx);z.module.service("modesSrvc",gx);z.module.value("userSrvc",z.zI);z.module.service("externFunctionSrvc",z.zn);z.module.service("propertiesSrvc",hx);z.module.service("formSrvc",ix);
z.config=function(a,b,c,d,e,f,g,h,l){var n=!1;z.on("properties_loaded",function(){n=angular.element(z.Lb).injector().get(["propertiesSrvc"]).debug_mode});d.debugEnabled(!0);g.decorator("$log",["$delegate",function(a){return{error:function(b){a.error(b)},info:function(b){n&&a.info(b)},log:function(b){n&&a.log(b)},warn:function(b){a.warn(b)}}}]);b.useLoader("$translatePartialLoader",{urlTemplate:"{part}/lang-{lang}.json"});c.addPart("lang");b.preferredLanguage("fr");l.setDefaultHeaders({Accept:"application/json"});
z.RestangularProvider=l;z.compileProvider=e;a.interceptors.push(function(){return{request:function(a){-1==a.url.indexOf("ui-grid/")&&("undefined"==typeof a.params?a.params={vitis_version:oClientProperties.build}:a.params.vitis_version=oClientProperties.build);"true"==sessionStorage.ajaxLoader&&Vd();var b=parseInt(sessionStorage.loading_counter);b++;sessionStorage.loading_counter=b;return a},response:function(a){if(typeof("object"==a.data)&&"undefined"!=typeof a.data.errorCode){Wd();var b=angular.element(z.Lb).injector().get(["sessionSrvc"]),
c=angular.element(z.Lb).injector().get(["externFunctionSrvc"]),d={className:"modal-danger",buttons:{ok:{label:"OK",className:"btn-default"}},callback:function(){b.disconnect()}},e="";switch(a.data.errorCode){case 15:d.message="EXPIRED_TOKEN_ERROR";e="EXPIRED_TOKEN_ERROR_TITLE";break;case 16:d.message="INVALID_TOKEN_ERROR",e="INVALID_TOKEN_ERROR_TITLE"}m(d.message)&&c.modalWindow("alert",e,d)}else c=parseInt(sessionStorage.loading_counter),0<c?c--:c=0,sessionStorage.loading_counter=c,0==c&&Wd();return a},
requestError:function(a){console.error("requestError",a);return a},responseError:function(a){console.error("responseError",a);Wd();return a}}});"true"==sessionStorage.debug&&g.decorator("$exceptionHandler",["$delegate",function(a){return function(b,c){a(b,c);var d=angular.element(z.Lb).injector().get(["envSrvc"]);c=angular.element(z.Lb).injector().get(["externFunctionSrvc"]);d={className:"modal-danger modal-error-log",message:"<div>"+("<b>Mode: "+d.oSelectedMode.title+" / Onglet: "+d.oSelectedObject.label+
"</b><br>")+b.stack.replace(/[\n\r]/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;")+"</div>",buttons:{ok:{label:"OK",className:"btn-default"}},callback:function(){}};c.modalWindow("alert",b.name+": "+b.message,d)}}])};z.config.$inject="$httpProvider $translateProvider $translatePartialLoaderProvider $logProvider $compileProvider $controllerProvider $provide $injector RestangularProvider".split(" ");z.module.config(z.config);function kx(){}ta("formReader",kx);kx.module=angular.module("formReader",["angular.bind.notifier"]);kx.module=kx.module;kx.controller={};kx.controller.zJ={};
function lx(a,b,c,d,e,f){d.info("formReader.formReaderController");var g=this;this.V=b;this.f=a;this.ua=c;this.la=d;this.sd=e;this.Rm=[];a.oFormValues=m(a.oFormValues)?a.oFormValues:{};a.oFormDefinition=m(a.oFormDefinition)?a.oFormDefinition:{};a.sFormDefinitionName=m(a.sFormDefinitionName)?a.sFormDefinitionName:"";this.fo();a.sFormUniqueName=Date.now();a.iDisplayedTab=0;"undefined"==typeof f.oFormPromises&&(f.oFormPromises={});f.oFormPromises[a.sFormDefinitionName]=[];var h=f.$on("formDefinitionLoaded",
function(){g.Lw();h()})}kx.formReaderController=lx;lx.$inject="$scope $http $q $log formReaderService $rootScope".split(" ");kx.module.controller("AppFormReaderController",lx);
lx.prototype.fo=function(){if(null!=this.f.oFormDefinition&&null!=this.f.sFormDefinitionName&&null!=this.f.oFormDefinition[this.f.sFormDefinitionName]&&null==this.f.oFormDefinition[this.f.sFormDefinitionName].tabs){var a=this.f.oFormDefinition[this.f.sFormDefinitionName],b=[];if(null!=a.rows){for(var c=0;c<a.rows.length;c++)if(null!=a.rows[c].fields)for(var d=0;d<a.rows[c].fields.length;d++)if(null!=a.rows[c].fields[d].name)b.push(a.rows[c].fields[d].name);else if(null!=a.rows[c].fields[d].buttons)for(var e=
0;e<a.rows[c].fields[d].buttons.length;e++)null!=a.rows[c].fields[d].buttons[e].name&&b.push(a.rows[c].fields[d].buttons[e].name);this.f.oFormDefinition[this.f.sFormDefinitionName].tabs={position:"top",list:[{label:"Tab 0",elements:b}]}}}};lx.prototype.initFormTabs=lx.prototype.fo;
lx.prototype.Lw=function(){var a=this;this.fo();this.Bp(!1);setTimeout(function(){var b=a.f.oFormDefinition,c=a.f.sFormDefinitionName;if(null==b||null==c||null==b[c])return 0;var d=b[c].initEvent;setTimeout(function(){null!=b[c].initEvent&&a.sd.isFunctionCall(d)&&a.sd.callFunction(d);setTimeout(function(){a.Bn()})})});this.f.$broadcast("loadForm")};lx.prototype.loadForm=lx.prototype.Lw;lx.prototype.Hi=function(){this.fo();this.f.$broadcast("$$rebind::refresh")};lx.prototype.refreshForm=lx.prototype.Hi;
lx.prototype.SG=function(a){this.la.log("formReader.formReaderController.prototype.setFormDefinition");this.f.oFormDefinition=a;this.sd.oFormDefinition=a;this.Hi()};lx.prototype.setFormDefinition=lx.prototype.SG;lx.prototype.TG=function(a){this.la.log("formReader.formReaderController.prototype.setFormValues");this.f.oFormValues=a;this.sd.oFormValues=a};lx.prototype.setFormValues=lx.prototype.TG;
lx.prototype.PG=function(a){this.la.log("formReader.formReaderController.prototype.setDefinitionName");this.f.sFormDefinitionName=a;this.sd.sFormDefinitionName=a};lx.prototype.setDefinitionName=lx.prototype.PG;lx.prototype.RH=function(a){console.log(a)};lx.prototype.toTest=lx.prototype.RH;
lx.prototype.Bp=function(a,b){this.la.log("formReader.formReaderController.prototype.useDefaultValues");var c=this.f,d=c.oFormValues,e=c.oFormDefinition,c=c.sFormDefinitionName;if(null==d||null==e||null==c||null==e[c])return 0;e=e[c].rows;if(null==e)return 0;for(var f=0;f<e.length;f++)if(null!=e[f].fields)for(var g=0;g<e[f].fields.length;g++)if("bo_grid"!==e[f].fields[g].type&&"ui_grid"!==e[f].fields[g].type&&"section_grid"!==e[f].fields[g].type){var h;try{h=angular.copy(e[f].fields[g])}catch(t){console.error("try angular.copy failed");
continue}if(null==b||h.name===b){null!=h.default_value&&""!==h.default_value&&this.sd.isFunctionCall(h.default_value)&&(h.default_value=this.sd.callFunction(h.default_value));if("select"===h.type||"editable_select"===h.type)null!=h.default_value&&""!==h.default_value&&(h.default_value={value:h.default_value});else if(("list"===h.type||"double_select"===h.type)&&null!=h.default_value&&""!==h.default_value){for(var l=h.default_value.split("|"),n=[],r=0;r<l.length;r++)n.push({value:l[r]});h.default_value=
n}this.uz(h,a)&&("select"===h.type||"editable_select"===h.type||"list"===h.type?(null!=d[c][h.name]||(d[c][h.name]={}),d[c][h.name].selectedOption=h.default_value):"double_select"===h.type?(null!=d[c][h.name]||(d[c][h.name_to]={}),d[c][h.name_to].selectedOption=h.default_value):"editable_double_select"===h.type?(null!=d[c][h.name]||(d[c][h.name_available_tags]={}),d[c][h.name_available_tags].selectedOption=h.default_value):d[c][h.name]=h.default_value);delete h}}};lx.prototype.useDefaultValues=lx.prototype.Bp;
lx.prototype.uz=function(a,b){this.la.log("formReader.formReaderController.prototype.useDefaultValue");var c=this.f,d=c.oFormValues,c=c.sFormDefinitionName;if(m(a.default_value)&&""!==a.default_value){if(!0===b)return!0;if("select"===a.type){if(null==d[c][a.name]||null==d[c][a.name].selectedOption||null==d[c][a.name].selectedOption.value||0===d[c][a.name].selectedOption.value.length)return!0}else if("editable_select"===a.type){if(null==d[c][a.name]||null==d[c][a.name].selectedOption||null==d[c][a.name].selectedOption.value||
0===d[c][a.name].selectedOption.value.length)return!0}else if("list"===a.type){if(null==d[c][a.name]||!fa(d[c][a.name].selectedOption)||0===d[c][a.name].selectedOption.length||0===d[c][a.name].selectedOption[0].value.length)return!0}else if("double_select"===a.type){if(null==d[c][a.name_to]||!fa(d[c][a.name_to].selectedOption)||0===d[c][a.name_to].selectedOption.length||0===d[c][a.name_to].selectedOption[0].value.length)return!0}else if("editable_double_select"===a.type){if(null==d[c][a.name_available_tags]||
!fa(d[c][a.name_available_tags].selectedOption)||0===d[c][a.name_available_tags].selectedOption.length||0===d[c][a.name_available_tags].selectedOption[0].value.length)return!0}else if(null==d[c][a.name]||0===d[c][a.name].length)return!0}else return!1};lx.prototype.useDefaultValue=lx.prototype.uz;
lx.prototype.Bn=function(){this.la.log("formReader.formReaderController.prototype.extractFormDefinitionInfos");if(!m(this.f.oFormDefinition))return console.error("$scope['oFormDefinition'] not defined"),0;this.f.$broadcast("extractFormDefinitionInfos");var a=this.f.oFormDefinition[this.f.sFormDefinitionName],b=this.f.oFormValues[this.f.sFormDefinitionName],c=this.f.oFormDefinition.datasources,d,e=this;null!=this.f.$root.oFormPromises[this.f.sFormDefinitionName]||(this.f.$root.oFormPromises[this.f.sFormDefinitionName]=
[]);var f=this.ua.defer();this.f.$root.oFormPromises[this.f.sFormDefinitionName].push(f.promise);for(var g=0;g<e.Rm.length;g++)e.Rm[g]();e.Rm.length=0;if(m(a)&&m(a.rows))for(g=0;g<a.rows.length;g++)for(var h=0;h<a.rows[g].fields.length;h++){var l=a.rows[g].fields[h];d=b[l.name];"undefined"===typeof l.id&&"undefined"!==typeof l.name&&(l.id=this.f.sFormDefinitionName+"_"+l.name);switch(l.type){case "select":case "editable_select":case "list":case "double_select":l.id_from=l.id+"_from";var n=null,r=
null;m(l.datasource)&&m(l.datasource.datasource_id)&&m(c)&&m(c[l.datasource.datasource_id])&&("web_service"===c[l.datasource.datasource_id].type?n=mx(l,c):"object"===c[l.datasource.datasource_id].type&&(r=nx(l,c)));m(l.web_service)&&(n=angular.copy(l.web_service));if(null!=l.options)var t=l.options;null!=r&&(t=r);null!=n?(n=angular.copy(n),!1!==n.load_first_time?(m(n.parents)&&ox(this,l,n,b),px(b,n.parents,!0)&&this.sd.setWebServiceSelectOptions(l,this.f.sFormDefinitionName,this.f.oFormValues,n),
delete n):"undefined"!==typeof n.callback&&e.sd.isFunctionCall(n.callback)&&e.sd.callFunction(n.callback)):m(t)?this.sd.setSelectOptions(l,this.f.sFormDefinitionName,this.f.oFormValues,t):"object"!==typeof d&&(b[l.name]="select"===l.type||"editable_select"===l.type?{selectedOption:{value:d},options:[]}:{selectedOption:[{value:d}],options:[]});break;case "editable_double_select":l.name_available_tags=l.name+"_available",l.id_available_tags=l.id+"_available","undefined"!==typeof l.web_service&&this.sd.setWebServiceTags(l,
this.f.sFormDefinitionName,this.f.oFormValues)}delete l}this.ua.all(this.f.$root.oFormPromises[this.f.sFormDefinitionName]).then(function(){setTimeout(function(){e.f.$root.$emit("formExtracted",e.f.sFormDefinitionName)});if(null!=a){var b=a.name,c=angular.element("form[name='"+b+"']");0<c.length&&(c=c.scope(),null!=c[b]&&c[b].$setPristine())}});f.resolve()};lx.prototype.extractFormDefinitionInfos=lx.prototype.Bn;
function ox(a,b,c,d){c.parameters.original_filter=null!=c.parameters.filter?c.parameters.filter:"";for(var e=0;e<c.parents.length;e++){var f=c.parents[e].filter_attr,g=c.parents[e].filter_equality,h=m(c.parents[e].name_to)?c.parents[e].name_to:c.parents[e].name,l=angular.copy("oFormValues."+a.f.sFormDefinitionName+"."+h+".selectedOption");setTimeout(function(b){var c=angular.bind({Kq:b.Kq,Xr:b.Xr,Ev:b.Ev,Fv:b.Fv,ot:b.ot},function(){var b=this.Kq,c=this.Xr,e=d[this.ot],f;if(null==e||null==e.selectedOption)return 0;
if(fa(e.selectedOption)){if(0===e.selectedOption.length)return 0}else if(null==e.selectedOption.value)return 0;e=px(d,c.parents);null!=a.f.oFormValues&&null!=a.f.oFormValues[a.f.sFormDefinitionName]&&null!=a.f.oFormValues[a.f.sFormDefinitionName][b.name]&&null!=a.f.oFormValues[a.f.sFormDefinitionName][b.name].selectedOption&&(f=angular.copy(a.f.oFormValues[a.f.sFormDefinitionName][b.name].selectedOption));a.sd.emptySelectOptions(b,a.f.sFormDefinitionName,a.f.oFormValues);if(e){for(var e=c.parameters,
g=c.parents,h=c.parameters.original_filter,l="",g=null!=g?g:[],h=null!=h?h:"",n=0;n<g.length;n++)if(m(d[g[n].name])&&m(d[g[n].name].selectedOption)){if(!m(d[g[n].name].selectedOption.value)){if(!fa(d[g[n].name].selectedOption))continue;if(1>d[g[n].name].selectedOption.length)continue}var r=[];!fa(d[g[n].name].selectedOption)&&m(d[g[n].name].selectedOption.value)?r.push(d[g[n].name].selectedOption):r=d[g[n].name].selectedOption;for(var G=g[n].filter_attr,O=g[n].filter_equality,K="",N=0;N<r.length;N++){var ba=
r[N].value;if(null!=ba&&!(p(ba)&&0< !ba.length)){var P='"'+G+'"'+O+"'"+ba+"'",K=1<K.length?K+(" OR "+P):P;delete ba;delete P}}0!==K.length&&(l=1<l.length?l+(" AND ("+K+")"):"("+K+")",delete r,delete G,delete O,delete K)}delete n;1<l.length&&(h=1<h.length?h+(" AND "+l):l);e.filter=h;a.la.log({"filter: ":angular.copy(c.parameters.filter)});a.sd.setWebServiceSelectOptions(b,a.f.sFormDefinitionName,a.f.oFormValues,c,f)}},!0);c();a.Rm.push(a.f.$watch(b.AG,c))},1E3,{AG:l,Kq:b,Xr:c,Ev:f,Fv:g,ot:h});delete f;
delete g;delete l}}
function mx(a,b){if(!m(a.datasource.id_key)||!m(a.datasource.label_key))return null;b=angular.copy(b[a.datasource.datasource_id]);b.id_key=a.datasource.id_key;b.label_key=a.datasource.label_key;b.parameters=m(b.parameters)?b.parameters:{};m(a.datasource.parents)&&(b.parents=a.datasource.parents);m(a.datasource.filter)&&(b.parameters.filter=a.datasource.filter);m(a.datasource.distinct)&&(b.parameters.distinct=a.datasource.distinct);m(a.datasource.attributs)&&(b.parameters.attributs=a.datasource.attributs);
m(a.datasource.order_by)&&(b.parameters.order_by=a.datasource.order_by);m(a.datasource.sort_order)&&(b.parameters.sort_order=a.datasource.sort_order);return b}
function nx(a,b){var c=[];if(m(b[a.datasource.datasource_id].data)&&m(a.datasource.id_key)&&m(a.datasource.label_key)){var d=a.datasource.id_key,e=a.datasource.label_key,f=b[a.datasource.datasource_id].data;m(d)||console.error("id_key not defined (required in for data json source)");m(e)||console.error("label_key not defined (required in for data json source)");if(m(d)&&m(e))for(var g=0;g<f.length;g++)c.push(f[g][e]+"|"+f[g][d]);delete d;delete e;delete f}m(b[a.datasource.datasource_id].options)&&
(c=b[a.datasource.datasource_id].options);return c}
function px(a,b,c){var d=!0;if(null==a)return console.error("formReader.formReaderController.prototype.areParentsReady: oFormValues not defined"),!1;if(null==b||fa(b)&&0===b.length)return!0;for(var e=0;e<b.length;e++)if("false"!==b[e].wait_for_parent&&!1!==b[e].wait_for_parent){if(!0===c)return!1;if(null!=a[b[e].name])if(null!=a[b[e].name].selectedOption){if(fa(a[b[e].name].selectedOption)){if(0===a[b[e].name].selectedOption.length){d=!1;continue}if(0===a[b[e].name].selectedOption[0].value.length){d=
!1;continue}}fa(a[b[e].name].selectedOption)||(null!=a[b[e].name].selectedOption.value?0===a[b[e].name].selectedOption.value.length&&(d=!1):d=!1)}else d=!1;else d=!1}return d}
lx.prototype.Zf=function(a,b){a=m(a)?a:"";if(b=m(b)?b:!1)return this.Ng(a);a=a.replace(",",".");var c=a.split(".");if(0===c.length)return NaN;if(1===c.length)return"."===a.charAt(a.length-1)?this.Ng(a)+".":this.Ng(a);if(2<=c.length){b=this.Ng(c[0]);if(2===c.length){if(""===c[1])return this.Ng(a)+".";c=this.Ng(c[1])}else{a="";for(var d=1;d<c.length;d++)a+=c[d];c=this.Ng(a)}return parseFloat(b+"."+c)}return NaN};lx.prototype.numberParser=lx.prototype.Zf;
lx.prototype.Ng=function(a){for(var b="",c=0;c<a.length;c++){var d=a.charAt(c);isNaN(parseInt(d))||(b+=d)}return parseInt(b)};lx.prototype.integerParser=lx.prototype.Ng;kx.directive={};kx.directive.AJ={};
function qx(a,b,c,d,e,f){return{restrict:"A",scope:{oProperties:"=?appProperties",sToken:"=?appToken",oFormValues:"=?appFormValues",oFormDefinition:"=?appFormDefinition",sFormDefinitionName:"=?appFormDefinitionName",oFormEventsContainer:"=?appFormEventsContainer",wabState:"=?appWabState",wabGroup:"=?appWabGroup",showTabs:"=?appTabs"},controller:"AppFormReaderController",controllerAs:"ctrl",templateUrl:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:
"")+"/"+sessionStorage.appEnv+"/javascript/externs/formReader/formReader.html",link:function(g,h){d.log("formReader.formReaderDirective.link");g.showTabs="false"===g.showTabs||!1===g.showTabs?g.showTabs=!1:g.showTabs=!0;g.wabState=null!=g.wabState&&""!==g.wabState?g.wabState:null;g.wabGroup=null!=g.wabGroup&&""!==g.wabGroup?g.wabGroup:null;g.submitButton=!1;g.oFormEventsContainer=m(g.oFormEventsContainer)?g.oFormEventsContainer:g;b.oProperties=g.oProperties;b.sToken=g.sToken;b.oFormValues=g.oFormValues;
b.oFormDefinition=g.oFormDefinition;b.sFormDefinitionName=g.sFormDefinitionName;b.oFormEventsContainer=g.oFormEventsContainer;g.isFormTextElement=function(a){return-1!=="text password datetime datetime-local date month time week integer float number email url search tel color".split(" ").indexOf(a)?!0:!1};g.sendForm=function(){d.log("scope.sendForm");if(!0===g[g.oFormDefinition[g.sFormDefinitionName].name].$valid){var c=a.defer(),e=c.promise,f=g.oFormDefinition[g.sFormDefinitionName].beforeEvent;
"undefined"!==typeof f?p(f)?a.when(b.callFunction(f)).then(function(){c.resolve()}):ja(f)&&a.when(f(g.oFormValues)).then(function(){c.resolve()}):c.resolve();e.then(function(){c=a.defer();e=c.promise;var d=g.oFormDefinition[g.sFormDefinitionName].event;"undefined"!==typeof d?p(d)?a.when(b.callFunction(d)).then(function(){c.resolve()}):ja(d)&&a.when(d(g.oFormValues)).then(function(){c.resolve()}):c.resolve();e.then(function(){var a=g.oFormDefinition[g.sFormDefinitionName].afterEvent;"undefined"!==
typeof a&&(p(a)?b.callFunction(a):ja(a)&&a(g.oFormValues))})})}};g.testElementsValidityTab=function(a){d.log("scope.testElementsValidityTab");var c=g.oFormDefinition[g.sFormDefinitionName].name;if(!0===!g[c].$valid){for(var e=b.getAllFormElementDefinition(g.sFormDefinitionName,g.oFormDefinition),f=[],h=0;h<e.length;h++)null!=e[h].name&&null!=g[c][e[h].name]&&(g[c][e[h].name].$valid||f.push(e[h].name));if(null!=f[0]&&null!=g.oFormDefinition[g.sFormDefinitionName].tabs&&null!=g.oFormDefinition[g.sFormDefinitionName].tabs.list)for(c=
g.oFormDefinition[g.sFormDefinitionName].tabs.list,h=0;h<c.length;h++)if(-1!==c[h].elements.indexOf(f[0])){g.iDisplayedTab=h;break}}null!=a&&a.call()};g.executeButtonEvent=function(a,c){d.log("scope.executeButtonEvent");p(c)?b.callFunction(c):ja(c)&&c(g.oFormValues)};g.getValidationCssClass=function(a){if("undefined"!=typeof a){var b=g.oFormDefinition[g.sFormDefinitionName].name;if("undefined"!=typeof g[b]&&"undefined"!=typeof g[b][a]&&g[b][a].$invalid&&g[b][a].$dirty)return"has-error"}};g.switchSelectedOptions=
function(a,c,e,f){d.log("scope.switchSelectedOptions");e=g.oFormValues[a][e];g.oFromSelect=e;"undefined"!==typeof c.switch_event&&b.isFunctionCall(c.switch_event)&&(p(c.switch_event)?b.callFunction(c.switch_event):ja(c.switch_event)&&c.switch_event(g.oFormValues));if(0<e.selectedOption.length){a=g.oFormValues[a][f];for(c=0;c<e.selectedOption.length;)1!=e.selectedOption[c].disabled&&a.options.unshift(e.options.splice(e.options.indexOf(e.selectedOption[c]),1)[0]),c++;e.selectedOption=[]}};g.reloadSelectField=
function(a,c){b.reloadSelectField(a,c,g.oFormValues,g.oFormDefinition)};g.isStringNotEmpty=function(a){return null==a||!p(a)||0< !a.length?!1:!0};g.getLinkFileName=function(a){if(!p(a))return"";-1!==a.lastIndexOf("/")&&(a=a.substr(a.lastIndexOf("/")+1));-1!==a.lastIndexOf("?")&&(a=a.substr(0,a.lastIndexOf("?")));return a};g.isFieldPresent=function(a,b,c){var d=!0;if(!1===a.visible||"false"===a.visible)d=!1;var e=!1;-1!==b.elements.indexOf(a.name)&&(e=!0);!0===a.visibleAllTabs&&(e=!0);null!=a.buttons&&
!1===(null!=c?c:!1)&&(e=!0);g.showTabs||(e=!0);if(this.useWab()){var f=!1;b=this.getWabField(a);if("r"===b||"rw"===b)f=!0;null!=a.buttons&&(f=!0);"r"===b&&(a.disabled=!0)}return null!=f?d&&e&&f?!0:!1:d&&e?!0:!1};g.isButtonPresent=function(a,b,c){var d=!0;if(!1===a.visible||"false"===a.visible)d=!1;var e=!1;-1!==c.elements.indexOf(a.name)&&(e=!0);!0===a.visibleAllTabs&&(e=!0);this.isFieldPresent(b,c,!0)&&(e=!0);if(this.useWab()){var f=!1;b=this.isFieldPresent(b,c,!0)?this.getWabField(b):this.getWabField(a);
if("r"===b||"rw"===b)f=!0;"r"===b&&(a.disabled=!0)}return null!=f?d&&e&&f?!0:!1:d&&e?!0:!1};g.getWabField=function(a){if(null!=g.wabState&&null!=g.wabGroup&&null!=g.oFormDefinition&&null!=g.oFormDefinition[g.sFormDefinitionName]&&null!=g.oFormDefinition[g.sFormDefinitionName].wab&&null!=g.oFormDefinition[g.sFormDefinitionName].wab[g.wabState]&&null!=g.oFormDefinition[g.sFormDefinitionName].wab[g.wabState][g.wabGroup]){var b=g.oFormDefinition[g.sFormDefinitionName].wab[g.wabState][g.wabGroup];if(null!=
b[a.name])return b[a.name]}return null};g.useWab=function(){var a=!1;null!=g.wabState&&null!=g.wabGroup&&null!=g.oFormDefinition&&null!=g.oFormDefinition[g.sFormDefinitionName]&&null!=g.oFormDefinition[g.sFormDefinitionName].wab&&(a=!0);return a};g.compileTemplate=function(){e({method:"GET",url:c.web_server_name+"/"+sessionStorage.appEnv+"/javascript/externs/formReader/formReader.html"}).then(function(a){if(null==a.data)return console.error("template not founded"),0;a=f(a.data)(g);h.children().replaceWith(a)},
function(){})};g.resetFileInputs=function(){$(h).find(".file").each(function(){$(this).fileinput("clear")})};g.$on("$destroy",function(){g.$root.clearFormData(g.sFormDefinitionName,g)});g.$on("loadForm",function(){g.resetFileInputs()})}}}kx.formReaderDirective=qx;qx.$inject="$q formReaderService propertiesSrvc $log $http $compile".split(" ");kx.module.directive("appFormReader",qx);
kx.Vt=function(a,b,c,d,e){return{link:function(b,g){e.log("formReader.appFormFieldSpecificParamsDrtv.link");if("undefined"!==typeof b.field.attributes)for(var f=0,l=Object.keys(b.field.attributes);f<l.length;)g[0].setAttribute(l[f],b.field.attributes[l[f]]),f++;!0===b.field.autofocus&&g[0].focus();switch(b.field.type){case "date":case "datetime":f={useCurrent:!1};xb(f,{date:{fr:{locale:"fr",format:"DD/MM/YYYY"},en:{format:"MM/DD/YYYY"}},datetime:{fr:{locale:"fr",format:"DD/MM/YYYY HH:mm"},en:{format:"MM/DD/YYYY HH:mm"}}}[b.field.type][c.language]);
"undefined"!==typeof b.field.options&&xb(f,b.field.options);$(g).datetimepicker(f);$(g).on("dp.change",function(){b.oFormValues[b.sFormDefinitionName][g[0].name]=g[0].value});break;case "checkbox":"undefined"==typeof b.oFormValues[b.sFormDefinitionName][b.field.name]&&(b.oFormValues[b.sFormDefinitionName][b.field.name]="undefined"!=typeof b.field.default_value?b.field.default_value:!1);break;case "upload":g[0].addEventListener("change",function(){b.oFormValues[b.sFormDefinitionName][g[0].name]={aFiles:this.files}},
!1);f={showPreview:!1,showRemove:!0,showUpload:!1};"undefined"!==typeof b.field.options&&xb(f,b.field.options);f.mainClass="input-file-"+b.oFormDefinition[b.sFormDefinitionName].input_size;"en"!=c.language&&(f.language=c.language);$(g).fileinput(f);break;case "file_wsdata":g[0].addEventListener("change",function(){b.oFormValues[b.sFormDefinitionName][g[0].name]={aFiles:this.files}},!1);f=[];null!=b.field.formats&&(f=b.field.formats.split("|"));f={showPreview:!1,showRemove:!1,showUpload:!1,allowedFileExtensions:f};
"undefined"!==typeof b.field.options&&xb(f,b.field.options);f.mainClass="input-file-"+b.oFormDefinition[b.sFormDefinitionName].input_size;"en"!=c.language&&(f.language=c.language);$(g).fileinput(f);break;case "image_wsdata":g[0].addEventListener("change",function(){b.oFormValues[b.sFormDefinitionName][g[0].name]={aFiles:this.files}},!1);f={showPreview:!1,showRemove:!1,showUpload:!1,allowedFileTypes:["image"]};f.mainClass="input-file-"+b.oFormDefinition[b.sFormDefinitionName].input_size;"en"!=c.language&&
(f.language=c.language);$(g).fileinput(f);break;case "email":b.field.pattern="^(([a-zA-Z]|[0-9])|([-]|[_]|[.]))+[@](([a-zA-Z0-9])|([-])){2,63}[.](([a-zA-Z0-9]){2,63})+$";var n=angular.copy(b.field.pattern);b.$watch("oFormValues."+b.sFormDefinitionName+'["'+b.field.name+'"]',function(){b.field.pattern=angular.copy(n);a(function(){if(-1!==g[0].className.indexOf("ng-invalid-pattern")){var a;a="fr"===b.oProperties.language?"ceci n'est pas une adresse mail":"this is not a mail adress";$(g).notify(a,{position:"top",
className:"error",autoHide:!1,clickToHide:!1})}else{a=g[0].parentNode.children;for(var c=-1,d=0;d<a.length;d++)"notifyjs-wrapper"===a[d].className&&(c=d);-1<c&&$(a[c]).remove()}},1)});break;case "url":b.field.pattern="^https?:\\/\\/.{1,}";n=angular.copy(b.field.pattern);b.$watch("oFormValues."+b.sFormDefinitionName+'["'+b.field.name+'"]',function(){b.field.pattern=angular.copy(n);a(function(){if(-1!==g[0].className.indexOf("ng-invalid-pattern")){var a;a="fr"===b.oProperties.language?"ce champ doit contenir une url commancent\n par http:// ou https://":
"this field must contain an url that begin\n by http:// or https://";$(g).notify(a,{position:"top",className:"error",autoHide:!1,clickToHide:!1})}else{a=g[0].parentNode.children;for(var c=-1,d=0;d<a.length;d++)"notifyjs-wrapper"===a[d].className&&(c=d);-1<c&&$(a[c]).remove()}},1)});break;case "integer":"undefined"!==typeof b.field.min&&g[0].setAttribute("min",b.field.min);"undefined"!==typeof b.field.max&&g[0].setAttribute("max",b.field.max);b.$parent.valid=!0;b.numberUpdate=function(){var a=b.oFormValues[b.sFormDefinitionName][g[0].name];
!m(a)||"string"!==typeof a&&"number"!==typeof a?console.error("bad type argument"):"string"===typeof a?(a=b.ctrl.numberParser(a,!0),b.oFormValues[b.sFormDefinitionName][g[0].name]=isNaN(a)?"":a):b.oFormValues[b.sFormDefinitionName][g[0].name]=a};a(function(){b.oFormValues[b.sFormDefinitionName][g[0].name]+=" ";b.numberUpdate()},500);break;case "float":case "number":"undefined"!==typeof b.field.min&&g[0].setAttribute("min",b.field.min);"undefined"!==typeof b.field.max&&g[0].setAttribute("max",b.field.max);
b.$parent.valid=!0;b.numberUpdate=function(){var a=b.oFormValues[b.sFormDefinitionName][g[0].name];!m(a)||"string"!==typeof a&&"number"!==typeof a?console.error("bad type argument"):"string"===typeof a?(a=b.ctrl.numberParser(a,!1),b.oFormValues[b.sFormDefinitionName][g[0].name]=isNaN(a)&&"string"!==typeof a?"":a):b.oFormValues[b.sFormDefinitionName][g[0].name]=a};a(function(){b.oFormValues[b.sFormDefinitionName][g[0].name]+=" ";b.numberUpdate()},500);break;case "image":case "imageurl":case "image_wsdata":null!=
b.field&&(null==b.field.width||0!=b.field.width&&"0px"!=b.field.width||(b.field.width=null),null==b.field.style||null==b.field.style.height||0!=b.field.style.height&&"0px"!=b.field.style.height||(b.field.style.height=null));break;case "image":f={inline:!1,button:!0,navbar:!1,title:2,toolbar:2,tooltip:!0,fullscreen:!1,url:function(){return b.oProperties.web_server_name+"/"+b.oProperties[b.field.alias]+"/"+b.field.folder+"/"+b.oFormValues[b.sFormDefinitionName][b.field.name]}};b.viewer=new Viewer(g[0],
f);b.openViewer=function(){e.log("openViewer");b.viewer.show();angular.element(".viewer-prev").remove();angular.element(".viewer-next").remove()};break;case "imageurl":f={inline:!1,button:!0,navbar:!1,title:2,toolbar:2,tooltip:!0,fullscreen:!1,url:function(){return b.oFormValues[b.sFormDefinitionName][b.field.name]}};b.viewer=new Viewer(g[0],f);b.openViewer=function(){e.log("openViewer");b.viewer.show();angular.element(".viewer-prev").remove();angular.element(".viewer-next").remove()};break;case "select":case "editable_select":var r=
b.field;"undefined"!==typeof r.multiple&&!0===r.multiple&&g[0].setAttribute("multiple","");"undefined"!==typeof r.size&&(g[0].setAttribute("size",r.size),g[0].style.height="auto");if(p(r.options)){for(var l=r.options.split(","),t,f=0;f<l.length;f++)t=l[f].split("|"),l[f]={label:t[0],value:t[1]};b.oFormValues[b.sFormDefinitionName][r.name].options=l}"undefined"!=typeof b.field.child_select&&g[0].addEventListener("change",function(){b.reloadSelectField(b.field,b.sFormDefinitionName)},!1);null!=r.onchange&&
g[0].addEventListener("change",function(){if(d.isFunctionCall(r.onchange))if(p(r.onchange))d.callFunction(r.onchange);else if(ja(r.onchange))r.onchange(b.oFormValues)},!1);break;case "map_bing":case "map_osm":case "map_vmap":var v=function(){m(b.oMap)&&(b.oMap.X.om(null),delete b.oMap);b.oMap=new Y({target:g[0],options:b.field.map_options,hiddenFieldId:b.field.id,oFormValues:b.oFormValues[b.sFormDefinitionName],sFormName:b.field.name,oProj:b.$root.proj});"undefined"!=typeof b.field.style&&"undefined"!=
typeof b.field.style.height&&"ratio"==b.field.style.height&&(b.field.style.height=parseInt(g[0].clientWidth/(window.innerWidth/window.innerHeight))+"px");b.$root.$emit("OpenLayersMapCreated",b.oMap);b.oMap.on("moveend",function(){b.field.map_options.center=b.oMap.getConfig();b.$apply()},b.oMap)};setTimeout(function(){v();b.$watch("field.nb_cols",function(){a(function(){b.oMap.X.yf()})});b.$watch("field.style",function(){a(function(){b.oMap.X.yf()})},!0);b.$watch("oMap.bLayersTreeOpen",function(){a(function(){b.oMap.X.yf()})},
!0);b.$on("studio resized",function(){b.oMap.X.yf()});b.$on("updateMap",function(a,c){switch(c){case "center":b.oMap.setCenter([b.field.map_options.center.coord[0],b.field.map_options.center.coord[1]]);break;case "zoom":b.oMap.setZoom(b.field.map_options.center.zoom);break;case "source":b.oMap.setBingSource(b.field.map_options.source);break;case "extent":b.oMap.setExtent(b.field.map_options.center.extent);break;case "controls":b.oMap.setControls(b.field.map_options.controls);break;case "interact":b.oMap.setInteractions(b.field.map_options.interactions);
break;case "proj":a=b.oMap.getExtent();c=b.oMap.getCenter();var d=b.oMap.getProj();b.field.map_options.center.extent=b.oMap.transformExtent(a,d,b.field.map_options.proj);b.field.map_options.center.coord=b.oMap.transformer(c,d,b.field.map_options.proj);v();break;default:v()}})});break;case "slider":b.field.options.id=b.field.id+"_slider";$(g).slider(b.field.options);null!=b.oFormValues[b.sFormDefinitionName][b.field.name]||(b.oFormValues[b.sFormDefinitionName][b.field.name]=0);$(g).on("slide",function(){b.oFormValues[b.sFormDefinitionName][b.field.name]=
$(g).slider("getValue")});b.$watch("oFormValues."+b.sFormDefinitionName+'["'+b.field.name+'"]',function(){setTimeout(function(){null!=$(g)&&null!=b.oFormValues&&null!=b.oFormValues[b.sFormDefinitionName]&&null!=b.oFormValues[b.sFormDefinitionName][b.field.name]&&$(g).slider("setValue",parseFloat(b.oFormValues[b.sFormDefinitionName][b.field.name]))},10)});b.$watch("field.options",function(){setTimeout(function(){$(g).slider(b.field.options)},10)},!0);break;case "color_picker":$(g).colorpicker({format:"rgba"});
$(g).on("changeColor",function(){b.oFormValues[b.sFormDefinitionName][b.field.name]=$(g).colorpicker("getValue")});b.$watch("oFormValues."+b.sFormDefinitionName+'["'+b.field.name+'"]',function(){setTimeout(function(){null!=$(g)&&null!=b.oFormValues&&null!=b.oFormValues[b.sFormDefinitionName]&&null!=b.oFormValues[b.sFormDefinitionName][b.field.name]&&$(g).colorpicker("setValue",b.oFormValues[b.sFormDefinitionName][b.field.name])},10)});break;case "double_select":f=parseInt($(g).css("line-height"))-
1;"undefined"!==typeof b.field.size&&(g[0].style.minHeight=f*b.field.size+"px");break;case "password":if("undefined"===typeof b.field.autocomplete||!1===b.field.autocomplete){g[0].readOnly=!0;var x=b.$root.$on("endFormNgRepeat",function(){a(function(){g[0].readOnly=!1},300);x()})}}"undefined"!=typeof b.field.read_only&&1==b.field.read_only&&(g[0].readOnly=!0)}}};kx.Vt.$inject=["$timeout","$translate","propertiesSrvc","formReaderService","$log"];kx.module.directive("appFormFieldSpecificParams",kx.Vt);
kx.Wt=function(a,b,c,d){return{link:function(e,f){d.log("formReader.appFormRowNgRepeatDrtv.link");if("undefined"!=typeof e.row.tab){var g=!1,h=e.sFormDefinitionName+"_"+e.row.tab.parent+"_tab_container";if(null==document.getElementById(h)){var l=document.createElement("div");l.className="tab-content";l.id=h;f[0].parentNode.insertBefore(l,f[0]);g=!0}document.getElementById(h).appendChild(f[0]);f[0].id=e.sFormDefinitionName+"_"+e.row.tab.name+"_tab";f[0].setAttribute("role","tabpanel");a(function(){f[0].className+=
" tab-pane fade";g&&(f[0].className+=" in active")})}a(function(){e.$last&&b.$emit("endFormNgRepeat",c.oSelectedObject.name)})}}};kx.Wt.$inject=["$timeout","$rootScope","envSrvc","$log"];kx.module.directive("appFormRowNgRepeat",kx.Wt);
function rx(a,b,c,d,e){return{link:function(f,g){"string"==typeof f.field.default_value&&/^[A-Z0-9_]+$/.test(f.field.default_value)&&a([f.field.default_value]).then(function(a){f.oFormValues[f.sFormDefinitionName][f.field.name]==f.field.default_value&&(f.oFormValues[f.sFormDefinitionName][f.field.name]=a[f.field.default_value])});"undefined"!=typeof f.field.name&&-1!=f.field.name.indexOf(".")&&(f.oFormValues[f.sFormDefinitionName][f.field.name]=c.getFormValueFromObject(f.oFormValues[f.sFormDefinitionName],
f.field.name));"undefined"!==typeof f.field.visible&&c.isFunctionCall(f.field.visible)&&(f.field.visible=f.$eval(f.field.visible));if("editable_double_select"===f.field.type)var h=f.$root.$on("webServiceTagsloaded",function(a,c){b(function(){var a={};"undefined"!==typeof c.options&&(a=c.options);$("#"+c.id).tagsinput(a);$("#"+c.id_available_tags).tagsinput(a);$("#"+c.id).on("itemRemoved itemAdded",function(a){"itemRemoved"==a.type?($("#"+c.id_available_tags).tagsinput("add",a.item),f.$root.setTagsInput([c.id_available_tags])):
f.$root.setTagsInput([c.id])});$("#"+c.id_available_tags).on("itemRemoved itemAdded",function(a){"itemRemoved"==a.type?($("#"+c.id).tagsinput("add",a.item),f.$root.setTagsInput([c.id])):f.$root.setTagsInput([c.id_available_tags])});f.$root.setTagsInput([c.id_available_tags,c.id])});h()});else if("ui_grid"==f.field.type||"bo_grid"==f.field.type||"section_grid"==f.field.type){null!=f.field.options||(f.field.options={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!1,enablePaginationControls:!1,
enableColumnMenus:!1,enableColumnResizing:!1,appHeader:!0,appHeaderTitleBar:!0,columnDefs:[],data:[]});f.gridOptions=angular.copy(f.field.options);var l=[],n=angular.copy(f.gridOptions.columnDefs);n.forEach(function(a){l.push(a.name)});a(l).then(function(a){l.forEach(function(b,c){n[c].name=a[b];n[c].displayName=a[b]});f.gridOptions.columnDefs=angular.copy(n)});!0===f.gridOptions.appEnableDragAndDrop&&(f.gridOptions.rowTemplate='<div grid="grid" class="ui-grid-draggable-row" draggable="true"><div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader, \'custom\': true }" ui-grid-cell></div></div>');
f.gridOptions.onRegisterApi=function(a){f.$root.$emit("registeredUiGridApi",a);f.gridApi=a;b(function(){e.resizeWin();a.core.handleWindowResize()});f.gridOptions.gridApi=a;b(function(){$(a.grid.element).find(".ui-grid-render-container-body").on("click.selectRow",function(a){a=a.target;if($(a).hasClass("ui-grid-cell")||$(a).hasClass("ui-grid-cell-contents"))a=$(g).find(".ui-grid-render-container-body .ui-grid-canvas").children().index($(a).parents(".ui-grid-row")),$(g).find(".ui-grid-render-container-left .ui-grid-row").eq(a).find(".ui-grid-selection-row-header-buttons").click()})});
"undefined"!==typeof a.dragndrop&&(!0===f.gridOptions.appEnableDragAndDrop?(a.dragndrop.setDragDisabled=!1,a.draggableRows.on.rowDragged(f,function(){}),a.draggableRows.on.rowFinishDrag(f,function(){if("undefined"!==typeof f.gridOptions.appDragAndDropEvent&&"undefined"!==typeof f.gridOptions.appDragAndDropEvent.rowFinishDrag)if(ja(f.$root[f.gridOptions.appDragAndDropEvent.rowFinishDrag]))f.$root[f.gridOptions.appDragAndDropEvent.rowFinishDrag]();else console.error(f.gridOptions.appDragAndDropEvent.rowFinishDrag+
" is not a function of scope.$root")}),a.draggableRows.on.rowEnterRow(f,function(){}),a.draggableRows.on.beforeRowMove(f,function(){})):a.dragndrop.setDragDisabled=!0);g[0].querySelector(".ui-grid-render-container-body").style.height="100%";g[0].querySelector(".ui-grid-render-container-body .ui-grid-viewport").style.height="Calc(100% - 30px)"}}else"codemirror"==f.field.type?("undefined"!=typeof f.field.codemirrorOptions&&(f.field.cm_options=f.field.codemirrorOptions),null!=f.field.cm_options&&(f.field.cm_options.onLoad=
function(a){"undefined"==typeof f.oCodeMirrorEditor&&(f.oCodeMirrorEditor={});f.oCodeMirrorEditor[a.options.appName]=a;if("undefined"!=typeof a.options.appHeight){var b=a.options.appHeight;"string"==typeof b&&(-1!=b.indexOf("%")?b=parseInt(window.innerHeight*parseInt(b)/100):isNaN(b)||(b=parseInt(b)));"number"==typeof b&&a.setSize(null,b)}if("undefined"!=typeof f.field.cm_options.appHints)a.on("keyup",function(b,c){c.key==f.field.cm_options.appHints.key&&a.showHint({hint:function(){return{from:a.getDoc().getCursor(),
to:a.getDoc().getCursor(),list:f.field.cm_options.appHints.hints}}})})})):"codemirror"==f.field.type&&("undefined"!=typeof f.field.codemirrorOptions&&(f.field.cm_options=f.field.codemirrorOptions),f.field.cm_options.onLoad=function(a){"undefined"==typeof f.oCodeMirrorEditor&&(f.oCodeMirrorEditor={});f.oCodeMirrorEditor[a.options.appName]=a;if("undefined"!=typeof a.options.appHeight){var b=a.options.appHeight;"string"==typeof b&&(-1!=b.indexOf("%")?b=parseInt(window.innerHeight*parseInt(b)/100):isNaN(b)||
(b=parseInt(b)));"number"==typeof b&&a.setSize(null,b)}if("undefined"!=typeof f.field.cm_options.appHints)a.on("keyup",function(b,c){c.key==f.field.cm_options.appHints.key&&a.showHint({hint:function(){return{from:a.getDoc().getCursor(),to:a.getDoc().getCursor(),list:f.field.cm_options.appHints.hints}}})})});b(function(){if("undefined"!==typeof f.field.tooltip&&!1!==f.field.visible){"undefined"===typeof f.field.tooltip.trigger&&(f.field.tooltip.trigger="hover");var b=document.createElement("span");
b.className="form-field-label-tooltip";b.id=f.field.id+"_tooltip";if("undefined"!=typeof f.field.tooltip.thumbnail){var c=f.oFormValues[f.sFormDefinitionName][f.field.tooltip.thumbnail];""!=c&&null!=c&&(c=d.web_server_name+"/"+d.public_alias+"/"+d.application+"/"+c,f.field.tooltip.html=!0,f.field.tooltip.content='<img src="'+c+'" class="popover-thumbnail-img">',f.field.tooltip.template='<div class="popover popover-thumbnail" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>',
g[0].querySelector("label").appendChild(b),$(g).find("label .form-field-label-tooltip").popover(f.field.tooltip))}else g[0].querySelector("label").appendChild(b),a([f.field.tooltip.title,f.field.tooltip.content]).then(function(a){f.field.tooltip.title=a[f.field.tooltip.title];f.field.tooltip.content=a[f.field.tooltip.content];$(g).find("label .form-field-label-tooltip").popover(f.field.tooltip).on("inserted.bs.popover",function(){"undefined"!==typeof f.field.tooltip.width&&(g[0].querySelector(".popover").style.width=
f.field.tooltip.width)})})}"undefined"!=typeof f.field.autocomplete&&(f.field.autocomplete?g[0].querySelector("[name='"+f.field.name+"']").setAttribute("autocomplete","on"):g[0].querySelector("[name='"+f.field.name+"']").setAttribute("autocomplete","off"))});"tinymce"==f.field.type&&"en"!=d.language&&(f.field.tinymceOptions.language=d.language+"_"+d.language.toUpperCase())}}}rx.$inject="$translate $timeout formReaderService propertiesSrvc externFunctionSrvc $log".split(" ");
kx.module.directive("appFormFieldNgRepeat",rx);kx.Tt=function(a,b){return{link:function(c,d){b.log("formReader.appButtonDrtv.link");"undefined"!==typeof c.button.tooltip&&a([c.button.tooltip.title]).then(function(a){c.button.tooltip.title=a[c.button.tooltip.title];$(d).tooltip(c.button.tooltip)})}}};kx.Tt.$inject=["$translate","$log"];kx.module.directive("appButton",kx.Tt);
kx.wu=function(a,b,c,d,e){return{link:function(a,c){e.log("formReader.appSubformGridDrtv.link");var f=angular.element("#formreader_"+a.sFormUniqueName+"_grid_subform_modal").scope(),g=c.closest("form").parent();a.initBoSubformGrid=function(){e.log("formReader.appSubformGridDrtv.initBoSubformGrid");var c=a.field.bo_id,h="formreader_"+a.sFormUniqueName+"_grid_subform_modal",l={},v={},x=a.field.bo_filter_attr,y=a.field.form_filter_value,B=angular.element(z.b).injector().get(["envSrvc"]),E=angular.element(z.b).injector().get(["formSrvc"]),
I=angular.element("#"+("formreader_"+a.sFormUniqueName+"_grid_subform")).scope(),w=!1;f.closeModal=function(a){$(a).modal("hide")};$("#"+h).on("hidden.bs.modal",function(){setTimeout(function(){B.oFormValues=f.oFormValues;B.oFormDefinition=f.oFormDefinition;B.sFormDefinitionName=f.sFormDefinitionName})});a.haveInsertRights=!1;a.haveDeleteRights=!1;a.oListWebService={dataType:"businessObject",ressource_id:"vmap/querys/"+c+"/list",parameters:{filter:""}};d.getBusinessObjectDef(c).then(function(e){function n(b){for(var c=
[],d=0;d<b.length;d++)b[d].bo_list.bo_object_infos={bo_id_value:b[d].bo_id_value,bo_id_field:b[d].bo_id_field,bo_type:b[d].bo_type},c.push(b[d].bo_list);a.gridOptions.data=c}if(null==e.business_object_id)return console.error("error while loading business object ("+c+")"),0;null!=x&&""!==x&&null!=y&&""!==y&&null!=f.oFormValues&&null!=f.oFormValues[f.sFormDefinitionName]&&null!=f.oFormValues[f.sFormDefinitionName][y]&&(w=!0,l[x]=f.oFormValues[f.sFormDefinitionName][y],v[x]=f.oFormValues[f.sFormDefinitionName][y]);
var r=d.parseFilter(l);a.oListWebService.parameters.filter=r;a.oListWebService.parameters.limit=100;a.addObject=function(){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,"error")}),0;var h={insert:angular.copy(v)},l="formreader_"+a.sFormUniqueName+"_grid_subform_modal",r=e.json_form[0];w&&(r=d.disableFormElement(r,x,"insert"));f.$applyAsync(function(){f.grid_subform_title=e.title;f.grid_subform_size=e.add_form_size;f.grid_subform_definition_name="insert"});
r.insert.name="formreader_"+a.sFormUniqueName+"_grid_subform_form";r.insert.event=function(f){d.insertBoElement(c,e,r,"insert",f,function(){$("#"+l).modal("hide");setTimeout(function(){d.getWebServiceData(angular.copy(a.oListWebService)).then(function(a){n(a)})});b("LIST_ADD_OK").then(function(a){$.notify(a,"success")})})};d.showModalSubform(l,I,r,"insert",h)};a.removeSelection=function(){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,"error")}),0;var e=
[],f=a.gridApi.selection.getSelectedRows();0<f.length?b("LIST_DELETE_CONFIRM").then(function(g){bootbox.confirm(g,function(g){if(!0===g){for(g=0;g<f.length;g++)e.push(f[g].bo_object_infos.bo_id_value);d.deleteBoElements(c,e,function(){setTimeout(function(){d.getWebServiceData(angular.copy(a.oListWebService)).then(function(a){n(a)})});b("LIST_DELETE_OK").then(function(a){$.notify(a,"success")})})}})}):b("LIST_NO_ELEMENT_SELECTED").then(function(a){$.notify(a,"warning")})};a.showFilterFormModal=function(){if("studio_form_reader"===
g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,"error")}),0;var c=e.json_form[0],r={search:l};w&&(c=d.disableFormElement(c,x,"search"));c.search.name="formreader_"+a.sFormUniqueName+"_grid_subform_form";c.search.event=function(e){B.oFormValues=e;B.oFormDefinition=c;B.sFormDefinitionName="search";e=E.getFormData("search",!0);e=d.parseFilter(e);a.oListWebService.parameters.filter=e;$("#"+h).modal("hide");d.getWebServiceData(angular.copy(a.oListWebService)).then(function(a){n(a)});
b("LIST_SEARCH_OK").then(function(a){$.notify(a,"success")})};f.$applyAsync(function(){f.grid_subform_title=e.title;f.grid_subform_definition_name="search"});I.loadSubForm({sFormDefinitionName:"search",oFormDefinition:c,oFormValues:r,oProperties:a.oProperties,sToken:a.sToken});$("#"+h).modal("show")};d.getWebServiceData(angular.copy(a.oListWebService)).then(function(h){if(null==h)return null;if(null!=h[0]){a.gridOptions.columnDefs=[{name:"",field:"actions",cellTemplate:"<app-ui-grid-action></app-ui-grid-action>",
width:60,enableSorting:!1,enableColumnMoving:!1,enableColumnResizing:!1}];for(var l=0;l<h[0].bo_list_attributs.length;l++)a.gridOptions.columnDefs.push({field:h[0].bo_list_attributs[l]});n(h);if("true"===h[0].have_insert_rights||!0===h[0].have_update_rights)a.haveInsertRights=!0;if("true"===h[0].have_delete_rights||!0===h[0].have_update_rights)a.haveDeleteRights=!0;if("true"===h[0].have_update_rights||!0===h[0].have_update_rights)a.gridApi.grid.appScope.edit_column="edit";if("true"===h[0].have_card_rights||
!0===h[0].have_card_rights)a.gridApi.grid.appScope.show_column="show";a.gridApi.grid.appScope.executeActionButtonEvent=function(h,l){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,"error")}),0;var r=h.entity.bo_object_infos,t="edit"===l?"update":"display";d.getWebServiceData({dataType:"businessObject",ressource_id:"vmap/querys/"+c+"/form",parameters:{filter:r.bo_id_field+"="+r.bo_id_value}}).then(function(g){var h=g[0].bo_json_form,l={},v="formreader_"+
a.sFormUniqueName+"_grid_subform_modal";"update"===t&&(h.update.event=function(e){d.updateBoElement(c,r,h,t,e,function(){$("#"+v).modal("hide");setTimeout(function(){d.getWebServiceData(angular.copy(a.oListWebService)).then(function(a){n(a)})});b("LIST_EDIT_OK").then(function(a){$.notify(a,"success")})})});l[t]=g[0].bo_form;h[t].name="formreader_"+a.sFormUniqueName+"_grid_subform_form";w&&(h=d.disableFormElement(h,x,t));if(null==r)return console.error("oObject undefined"),0;if(null==I)return console.error("oSubformScope undefined"),
0;if(null==h)return console.error("oSubformDefinition undefined"),0;if(null==t)return console.error("sSubformDefinitionName undefined"),0;if(null==l)return console.error("oSubformValues undefined"),0;f.$applyAsync(function(){f.grid_subform_title=g[0].bo_title;f.grid_subform_definition_name=t;"update"===t&&(f.grid_subform_size=e.edit_form_size);"display"===t&&(f.grid_subform_size=e.display_form_size)});d.showModalSubform(v,I,h,t,l)})};a.gridApi.grid.refresh()}else n([])})})};a.initSectionSubformGrid=
function(){e.log("formReader.appSubformGridDrtv.initSectionSubformGrid");var c=a.field.section_id,h="formreader_"+a.sFormUniqueName+"_grid_subform",l="formreader_"+a.sFormUniqueName+"_grid_subform_modal",v=angular.element(z.b).injector().get(["envSrvc"]),x=angular.element(z.b).injector().get(["formSrvc"]),y=angular.element("#"+h).scope(),B={},E={},I=a.field.section_filter_attr,h=a.field.form_filter_value,w=!1;a.haveInsertRights=!1;a.haveDeleteRights=!1;f.closeModal=function(a){$(a).modal("hide")};
$("#"+l).on("hidden.bs.modal",function(){setTimeout(function(){v.oFormValues=f.oFormValues;v.oFormDefinition=f.oFormDefinition;v.sFormDefinitionName=f.sFormDefinitionName})});null!=I&&""!==I&&null!=h&&""!==h&&null!=f.oFormValues&&null!=f.oFormValues[f.sFormDefinitionName]&&null!=f.oFormValues[f.sFormDefinitionName][h]&&(w=!0,B[I]=f.oFormValues[f.sFormDefinitionName][h],E[I]=f.oFormValues[f.sFormDefinitionName][h]);a.addObject=function(){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,
"error")}),0;var c={insert:angular.copy(E)},e=a.oSubformDefinition,h=angular.element("#formreader_"+a.sFormUniqueName+"_grid_subform").scope();w&&(e=d.disableFormElement(e,I,"insert"));f.$applyAsync(function(){f.grid_subform_title=a.oRessourceTab.name;f.grid_subform_definition_name="insert"});e.insert.name="formreader_"+a.sFormUniqueName+"_grid_subform_form";null!=e.insert.afterEvent&&delete e.insert.afterEvent;e.insert.event=function(c){d.insertSectionElement(a.oSection.ressource_id,a.sIdField,a.oSubformDefinition,
"insert",c).then(function(){$("#"+l).modal("hide");setTimeout(function(){d.getSectionRessourceData(a.oSection.ressource_id).then(function(b){a.gridOptions.data=b})});b("LIST_ADD_OK").then(function(a){$.notify(a,"success")})})};d.showModalSubform(l,h,e,"insert",c)};a.removeSelection=function(){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,"error")}),0;var c=[],e=a.gridApi.selection.getSelectedRows();0<e.length?b("LIST_DELETE_CONFIRM").then(function(f){bootbox.confirm(f,
function(f){if(!0===f){for(f=0;f<e.length;f++)c.push(e[f][a.sIdField]);d.deleteSectionElements(a.oSection.ressource_id,c).then(function(){setTimeout(function(){d.getSectionRessourceData(a.oSection.ressource_id).then(function(b){a.gridOptions.data=b})});b("LIST_DELETE_OK").then(function(a){$.notify(a,"success")})})}})}):b("LIST_NO_ELEMENT_SELECTED").then(function(a){$.notify(a,"warning")})};a.showFilterFormModal=function(){if("studio_form_reader"===g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,
"error")}),0;var c=a.oSubformDefinition,e={search:B};w&&(c=d.disableFormElement(c,I,"search"));c.search.name="formreader_"+a.sFormUniqueName+"_grid_subform_form";c.search.event=function(e){v.oFormValues=e;v.oFormDefinition=c;v.sFormDefinitionName="search";e=x.getFormData("search",!0);e=d.parseFilter(e);$("#"+l).modal("hide");d.getSectionRessourceData(a.oSection.ressource_id,e).then(function(b){a.gridOptions.data=b});b("LIST_SEARCH_OK").then(function(a){$.notify(a,"success")})};f.$applyAsync(function(){f.grid_subform_title=
a.oRessourceTab.name;f.grid_subform_definition_name="search"});y.loadSubForm({sFormDefinitionName:"search",oFormDefinition:c,oFormValues:e,oProperties:a.oProperties,sToken:a.sToken});$("#"+l).modal("show")};d.getSectionDef(c).then(function(c){a.oSection=c;d.getSectionRessourceTab(a.oSection.ressource_id).then(function(c){a.oRessourceTab=c;d.getSectionRessourceData(a.oSection.ressource_id).then(function(c){a.aRessourceData=c;d.getSectionForm(a.oSection,!0).then(function(c){a.oSubformDefinition=c;var e,
h,n;c=a.oRessourceTab.ressource_id.substr(a.oRessourceTab.ressource_id.lastIndexOf("/")+1);for(var r=0;r<a.oRessourceTab[c].length;r++)null!=a.oRessourceTab[c][r].columns&&(e=a.oRessourceTab[c][r].columns),null!=a.oRessourceTab[c][r].actions&&(h=a.oRessourceTab[c][r].actions),null!=a.oRessourceTab[c][r].tabs&&(n=a.oRessourceTab[c][r].tabs[0]);a.sIdField=angular.copy(e[0].name);"showSectionForm"===n.show_column&&(a.gridApi.grid.appScope.show_column="show");"editSectionForm"===n.edit_column&&(a.gridApi.grid.appScope.edit_column=
"edit");a.gridOptions.columnDefs=[{name:"",field:"actions",cellTemplate:"<app-ui-grid-action></app-ui-grid-action>",width:60,enableSorting:!1,enableColumnMoving:!1,enableColumnResizing:!1}];null!=e&&bb(a.gridOptions.columnDefs,e);a.gridOptions.data=angular.copy(a.aRessourceData);for(r=0;r<h.length;r++)"AddSectionForm"===h[r].event&&(a.haveInsertRights=!0),"DeleteSelection"===h[r].event&&(a.haveDeleteRights=!0);a.gridApi.grid.appScope.executeActionButtonEvent=function(c,e){if("studio_form_reader"===
g.attr("id"))return b("NO_IN_STUDIO").then(function(a){$.notify(a,"error")}),0;var h="edit"===e?"update":"display";e={};e[h]=angular.copy(c.entity);a.oSubformDefinition[h].name="formreader_"+a.sFormUniqueName+"_grid_subform_form";"update"===h&&(a.oSubformDefinition.update.event=function(c){d.updateSectionElement(a.oSection.ressource_id,a.sIdField,a.oSubformDefinition,h,c).then(function(){$("#"+l).modal("hide");setTimeout(function(){d.getSectionRessourceData(a.oSection.ressource_id).then(function(b){a.gridOptions.data=
b})});b("LIST_EDIT_OK").then(function(a){$.notify(a,"success")})})});w&&(a.oSubformDefinition=d.disableFormElement(a.oSubformDefinition,I,h));if(null==y)return console.error("oSubformScope undefined"),0;if(null==a.oSubformDefinition)return console.error("scope.oSubformDefinition undefined"),0;if(null==h)return console.error("sSubformDefinitionName undefined"),0;if(null==e)return console.error("oSubformValues undefined"),0;f.$applyAsync(function(){f.grid_subform_title=a.oRessourceTab.name;f.grid_subform_definition_name=
h});d.showModalSubform(l,y,a.oSubformDefinition,h,e)};a.gridApi.grid.refresh()})})})})};a.initSubformGrid=function(){e.log("initSubformGrid");"bo_grid"===a.field.type?a.initBoSubformGrid():"section_grid"===a.field.type&&a.initSectionSubformGrid()};null!=f.initSubformGridEvent_counter||(f.initSubformGridEvent_counter=0);null!=f.initSubformGridEvent&&(f["initSubformGridEvent_"+a.field.name](),f["initSubformGridEvent_"+a.field.name]=null);f["initSubformGridEvent_"+a.field.name]=f.$on("extractFormDefinitionInfos",
function(){f.initSubformGridEvent_counter++;var b=angular.copy(f.initSubformGridEvent_counter);setTimeout(function(){b===f.initSubformGridEvent_counter&&a.initSubformGrid()},500)})}}};kx.wu.$inject=["$timeout","$translate","propertiesSrvc","formReaderService","$log"];kx.module.directive("appSubformGrid",kx.wu);
kx.vu=function(a,b){return{link:function(c,d){b.log("formReader.appSubformDrtv.link");var e,f="<div app-form-reader ",f=f+'app-properties="oProperties"',f=f+'app-token="sToken"></div>';c.loadSubForm=function(g){b.log("formReader.loadSubForm");if(null==g.sFormDefinitionName)return console.error("opt_options['sFormDefinitionName'] undefined"),0;if(null==g.oFormDefinition)return console.error("opt_options['oFormDefinition'] undefined"),0;if(null==g.oFormValues)return console.error("opt_options['oFormValues'] undefined"),
0;if(null==g.oProperties)return console.error("opt_options['oProperties'] undefined"),0;if(null==g.sToken)return console.error("opt_options['sToken'] undefined"),0;c.$applyAsync(function(){c.oProperties=g.oProperties;c.sToken=g.sToken;e=a(f)(c);d.html("");d.append(e);setTimeout(function(){var a=angular.element($(d).find("[app-form-reader]").children()).scope();a.ctrl.setDefinitionName(g.sFormDefinitionName);a.ctrl.setFormValues(g.oFormValues);a.ctrl.setFormDefinition(g.oFormDefinition);a.ctrl.loadForm()})})}}}};
kx.vu.$inject=["$compile","$log"];kx.module.directive("appSubform",kx.vu);kx.service={};kx.service.BJ={};
function sx(a,b,c,d,e,f){return{reloadSelectField:function(a,b,c,d){d=this.getFormElementDefinition(a.child_select,b,d);if(m(d)){var e=d.web_service.parameters;m(e)||(e={filter:{}});p(e.filter)&&(e.filter={stringFilter:e.filter});m(e.filter)||(e.filter={});e.filter[a.name]=c[b][a.name].selectedOption.value;d.web_service.parameters=e;this.setWebServiceSelectOptions(d,b,c,d.web_service)}},getFormElementDefinition:function(a,b,c){c=c[b];b=0;for(var d,e;b<c.rows.length;){for(d=0;d<c.rows[b].fields.length;){if(c.rows[b].fields[d].name===
a)return c.rows[b].fields[d];if("undefined"!=typeof c.rows[b].fields[d].buttons)for(e=0;e<c.rows[b].fields[d].buttons.length;){if(c.rows[b].fields[d].buttons[e].name===a)return c.rows[b].fields[d].buttons[e];e++}d++}b++}},getAllFormElementDefinition:function(a,b){b=b[a];a=[];for(var c=0,d;c<b.rows.length;){for(d=0;d<b.rows[c].fields.length;)a.push(b.rows[c].fields[d]),d++;c++}return a},setWebServiceSelectOptions:function(c,e,l,n,r){var g=this;l=l[e];var h=d.defer();b.oFormPromises[e].push(h.promise);
if(null==c)return console.error("oFormElementDefinition not defined"),0;if(null==e)return console.error("sFormDefinitionName not defined"),0;if(null==l)return console.error("oFormValues not defined"),0;if(null==n)return console.error("oWebService not defined"),0;m(l)||(console.error("oFormValues["+e+"] not defined"),l={});this.getWebServiceData(n).then(function(d){if(null==d)return null;var t,v,E,x="",w,A=n.label_key,G=n.id_key,O=[];w=l[c.name];ha(w)?O[0]=String(w):p(w)&&""!==w&&(O=w.split("|"));
t=0;v={selectedOption:[],options:[]};E={selectedOption:[],options:[]};"double_select"===c.type?(x=c.name_from,w=c.name_to):w=c.name;for(;t<d.length;)m(d[t][A])?m(d[t][G])?-1!==O.indexOf(String(d[t][G]))||""===x?E.options.push({label:d[t][A],value:d[t][G]}):v.options.push({label:d[t][A],value:d[t][G]}):(console.error("result."+G+" does not exist, check the id_key param on the JSON file"),d[t][G]=null):(console.error("result."+A+" does not exist, check the label_key param on the JSON file"),d[t][A]=
null),t++;if(""!==x)l[x]=v;else{if(null!=r)E.selectedOption=r;else{if("select"===c.type||"editable_select"===c.type){d=angular.copy(l[c.name]);var K;null!==d&&ka(d)&&(d=d.selectedOption.value,K=l[c.name].selectedOption.label);"undefined"===typeof d&&"undefined"!==typeof c.default_value&&(d=c.default_value,p(d)&&g.isFunctionCall(d)&&(d=g.callFunction(d)));d=m(d)?d:null;K=m(K)?K:"";E.selectedOption={value:d,label:K}}if("list"===c.type)if(d=angular.copy(l[c.name]),null!=d&&fa(d.selectedOption)&&(d=d.selectedOption),
null!=d&&"undefined"!==typeof c.default_value&&(d=c.default_value,p(d)&&g.isFunctionCall(d)&&(d=g.callFunction(d))),fa(d)&&0<d.length)E.selectedOption=d;else{K=[];p(d)&&(K=d.split("|"));ha(d)&&(K=[d]);E.selectedOption=[];for(var N=0;N<K.length;N++)for(d=0;d<E.options.length;d++)E.options[d].value==K[N]&&(ha(E.options[d].value)&&p(K[N])&&(K[N]=parseFloat(K[N])),E.selectedOption.push({value:K[N],label:E.options[d].label}))}}if(null!=c.options){N=0;d=[];for(var ba=[];N<c.options.length;)K=c.options[N].split("|"),
d.push(K[0]),ba.push(K[1]),N++;a(d).then(function(a){var b=Object.keys(a);for(N=0;N<b.length;)E.options.unshift({label:a[b[N]],value:ba[N]}),N++})}if(!0!==c.required&&"true"!==c.required){K=!1;for(N=0;N<E.options.length;N++)""===E.options[N].value&&(K=!0);K||E.options.unshift({label:"",value:""})}}l[w]=E;if("editable_select"!==c.type){K=!1;for(N=0;N<l[w].options.length;N++)E.selectedOption.value===l[w].options[N].value&&(E.selectedOption.label=l[w].options[N].label,K=!0);K||(delete l[w].selectedOption.value,
delete l[w].selectedOption.label)}null!=l[w]||(l[w]={});null!=l[w].selectedOption||(l[w].selectedOption={});null==l[w].selectedOption.value&&(l[w].selectedOption.value="",l[w].selectedOption.label="");"list"===c.type&&ka(l[w].selectedOption)&&!fa(l[w].selectedOption)&&(l[w].selectedOption=[l[w].selectedOption]);this.oFormValues=l;this.sFormDefinitionName=e;f.oFormDefaultValues[e]=g.copyFormValues(l);"undefined"!==typeof n.callback&&g.isFunctionCall(n.callback)&&g.callFunction(n.callback);b.$emit("webServiceSelectOptionsloaded");
h.resolve()})},getWebServiceData:function(a){var b=this.sToken,e=this.oProperties,f={},g=d.defer();if(null==a)return console.error("oWebService not defined"),0;m(a.parameters)&&(f=a.parameters,"businessObject"===a.dataType&&null!=f.attributs&&delete f.attributs,m(a.parameters.filter)||m(a.parameters.filter_extension))&&(ka(a.parameters.filter)&&(a.parameters.filter=this.parseFilter(a.parameters.filter)),""===a.parameters.filter&&delete a.parameters.filter);f.token=b;c({method:"POST",url:e.web_server_name+
"/"+e.services_alias+"/"+a.ressource_id,headers:{"X-HTTP-Method-Override":"GET",Accept:"application/x-vm-json"},data:f}).then(function(b){null!=a.parameters&&(a.parameters.filter=a.parameters.original_filter);b=b.data;b.data=m(b.data)?b.data:[];if(1===b.status){var c;if(null!=a.subObject){c=[];for(var d=0;d<b.data.length;d++)null!=b.data[d][a.subObject]&&c.push(b.data[d][a.subObject])}else c=m(b.data)?b.data:[]}g.resolve(c)});return g.promise},emptySelectOptions:function(a,b,c){a="double_select"===
a.type?a.name_to:a.name;null!=c[b]&&null!=c[b][a]&&null!=c[b][a].options&&(c[b][a]="");this.oFormValues=c;null!=f.oFormDefaultValues&&null!=f.oFormDefaultValues[b]&&(f.oFormDefaultValues[b]=this.copyFormValues(c))},callFunction:function(a){if(null==a)return console.error("callFunction: no function defined"),0;if(0< !a.length)return console.error('callFunction: function === ""'),0;var c="",d=[];if(-1!==a.indexOf("(")){c=a.substr(a.indexOf("("));c=c.substr(1,c.length-2);0<c.length&&(d=c.split(","));
for(var f=0;f<d.length;f++)p(d[f])&&(d[f]=d[f].trim())}for(f=0;f<d.length;f++)this.isFunctionCall(d[f])&&(d[f]="'"+this.callFunction(d[f])+"'");0<d.length&&(a=a.replace(c,d.join(",")));var c=a.substr(0,a.indexOf("(")),g;this.eventsContainer=this.oFormEventsContainer;this.rootScope_=b;if("function"==typeof eval("window."+c))try{e.log(a),g=eval(a)}catch(t){}else if("undefined"!=typeof this.eventsContainer&&"function"==typeof this.eventsContainer[c])try{e.log("eventsContainer."+a),g=eval("this.eventsContainer."+
a)}catch(t){}else if("function"==typeof this[c])try{e.log("this."+a),g=eval("this."+a)}catch(t){}else if("undefined"!=typeof this.rootScope_&&"function"==typeof this.rootScope_[c])try{e.log("$rootScope."+a),g=eval("this.rootScope_."+a)}catch(t){}return g},isFunctionCall:function(a,c){"undefined"==typeof c&&(c=!0);var d=!1;"string"===typeof a&&(aMatchResult=a.match(/(.+)\((.*)\)/),null!==aMatchResult&&(c?(c=a.substr(0,a.indexOf("(")),"function"==typeof c?d=!0:"undefined"!=typeof this.oFormEventsContainer&&
"function"==typeof this.oFormEventsContainer[c]?d=!0:"function"==typeof this[c]?d=!0:"function"==typeof b[c]&&(d=!0),d||e.warn("Function not found : "+a)):d=!0));return d},selectFirstOption:function(a,b,c){b=m(b)?b:this.oFormValues;c=m(c)?c:this.sFormDefinitionName;b=b[c];0<b[a].options.length&&(b[a].selectedOption.value=b[a].options[0].value)},setSelectOptions:function(b,c,d,n){function g(a,b){var c=[];if(!fa(a))return console.error("getFormatedOptions: aKeys is not an array",a),c;if(!fa(b))return console.error("getFormatedOptions: aKeys is not an array",
b),c;if(a.length!==b.length)return console.error("getFormatedOptions: aKeys.length !== aValues.length",a,b),c;for(var d=0;d<a.length;d++)c.push({label:a[d],value:b[d]});return c}e.log("setSelectOptions");var h=0,l,x,y={selectedOption:{value:""},options:[]},B,E,I;n=m(n)?n:b.options;var w=[],A=[];for(p(n)&&(n=n.split(","));h<n.length;)x=n[h].split("|"),l=x[0],w.push(l),l=1<x.length?x[1]:l,A.push(l),h++;h=d[c][b.name];if("list"===b.type&&p(h)&&(n=h.split("|"),0<n.length)){l=[];for(h=0;h<n.length;h++)l.push({label:"",
value:n[h]});h={selectedOption:l}}"undefined"===typeof h&&"undefined"!==typeof b.default_value&&(h=b.default_value,"string"===typeof h&&this.isFunctionCall(h)&&(h=this.callFunction(h)));null!=h&&(null!=h.selectedOption?(null!=h.selectedOption.value&&(y=h),fa(h.selectedOption)&&(y=h)):y.selectedOption.value=String(h));a(w).then(function(a){for(var e=0;e<w.length;e++)w[e]=a[w[e]];y.options=g(w,A);if("double_select"===b.type){E=b.name_from;I=b.name_to;var h=angular.copy(w),l=angular.copy(A);a=[];for(var n=
[],e=l.length-1;0<=e;e--)n.unshift(l[e]),a.unshift(h[e]),l.splice(e,1),h.splice(e,1);e={options:g(h,l)};a={options:g(a,n)};d[c][E]=e;d[c][I]=a}else B=b.name,d[c][B]=y;"undefined"===typeof f.oFormDefaultValues[c]&&(f.oFormDefaultValues[c]={});"undefined"==typeof f.oFormDefaultValues[c][B]&&(f.oFormDefaultValues[c][B]=angular.copy(y))})},selectOptionAfterLoad:function(a,b,c,d,e){if("double_select"!==b.type)if("select"===b.type){b=a[c][d].options;for(var f=0;f<b.length;f++)if(b[f].value===e){a[c][d].UJ=
b[f];break}}else"list"!==b.type&&console.error("this element is not a select")},extractWebServiceData:function(a,b){var c=[];"undefined"!==typeof b[a]&&(Array.isArray(b[a])?0<b[a].length&&(c=b[a]):c=b[a]);return c},parseFilter:function(a){if(ka(a)){var b=[],c=Object.keys(a),d,e;for(e=0;e<c.length;e++)"stringFilter"===c[e]?b.push(a[c[e]]):(d=a[c[e]],""!==d&&(this.isFunctionCall(d)&&(d=this.callFunction(d)),"undefined"!=typeof d&&(p(d)?-1!=d.toLowerCase().indexOf("null")?b.push(c[e]+" "+d):b.push(c[e]+
"='"+d+"'"):b.push(c[e]+"="+d))));a=0<b.length?b.join(" AND "):""}return a},setWebServiceTags:function(a,d,e){var g=angular.copy(a.web_service),h=g.ressource_id.split("/");e=e[d];var l=this,v={};"undefined"!==typeof g.parameters&&(v=g.parameters,"undefined"!==typeof g.parameters.filter&&(g.parameters.filter=this.parseFilter(g.parameters.filter),""===g.parameters.filter&&delete g.parameters.filter));v.token=this.sToken;c({method:"POST",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+
"/"+g.ressource_id,headers:{"X-HTTP-Method-Override":"GET"},data:v}).then(function(c){c=c.data;if(1===c.status){c=l.extractWebServiceData(h[1],c);var n=[];"string"===typeof e[a.name]&&(n=e[a.name].split(","));for(var r=g.id_key,t=0,v=[];t<c.length;)-1===n.indexOf(c[t][r])&&v.push(c[t][r]),t++;e[a[["name_available_tags"]]]=v.join(",");"undefined"==typeof f.oFormDefaultValues[d][a[["name_available_tags"]]]&&(f.oFormDefaultValues[d][a[["name_available_tags"]]]=angular.copy(e[a[["name_available_tags"]]]));
b.$emit("webServiceTagsloaded",a)}})},checkFormModifications:function(a){var b=d.defer(),c=b.promise;if("insert"!=f.sMode&&"update"!=f.sMode||"undefined"==typeof a)b.resolve();else if(a=f.oFormDefinition[a],"undefined"!=typeof a&&"undefined"!=typeof a.event){a=a.name;var e=angular.element("form[name='"+a+"']");0<e.length?(e=e.scope(),e[a].$dirty&&!e[a].$submitted?e.$root.modalWindow("confirm","FORM_MODIFIED_WARNING_TITLE",{className:"modal-warning",message:"FORM_MODIFIED_WARNING",callback:function(a){a&&
b.resolve()}}):b.resolve()):b.resolve()}else b.resolve();return c},getFormValueFromObject:function(a,b){e.info("getFormValueFromObject");var c=this.copyFormValues(a);b.split(".").forEach(function(a){c=c[a]});return c},copyFormValues:function(a){e.info("copyFormValues");var b={};try{b=angular.copy(a)}catch(r){for(var c in a)try{b[c]=angular.copy(a[c])}catch(t){if(ka(a[c])){b[c]={};for(var d in a[c])try{b[c][d]=angular.copy(a[c][d])}catch(v){}}}}return b},getFormValue:function(a){e.info("getFormValue");
if(!p(a))return null;a=a.trim();a=this.oFormValues[this.sFormDefinitionName][a.trim()];null!=a.selectedOption&&null!=a.selectedOption.value&&(a=a.selectedOption.value);return a},concat:function(){e.info("concat");for(var a="",b=0;b<arguments.length;b++)p(arguments[b])&&(a+=arguments[b]);return a},getBusinessObjectDef:function(b){var e=this.sToken,f=d.defer();c({method:"GET",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/vmap/businessobjects/"+b,params:{token:e}}).then(function(b){if(!m(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),
0;if(!m(b.data.data)||!m(b.data.data[0])||!m(b.data.data[0].business_object_id))return a("NO_BUSINESS_OBJECT_FOUNDED").then(function(a){bootbox.alert(a)}),0;if(m(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;f.resolve(b.data.data[0])},function(a){console.error(a);bootbox.alert(a)});return f.promise},showModalSubform:function(a,b,c,d,e){var f=this.sToken,g=this.oProperties;null!=b.loadSubForm&&(b.loadSubForm({sFormDefinitionName:d,oFormDefinition:c,oFormValues:e,oProperties:g,sToken:f}),
$("#"+a).modal("show"))},updateBoElement:function(b,d,e,f,r,t){var g=this.sToken,h=angular.element(z.b).injector().get(["envSrvc"]),l=angular.element(z.b).injector().get(["formSrvc"]);d=[d.bo_id_field];h.oFormValues=r;h.oFormDefinition=e;h.sFormDefinitionName=f;e=l.getFormData(f,!0);for(h=0;h<d.length;h++)null!=r[f][d[h]]&&(e[d[h]]=r[f][d[h]]);f=new FormData;for(var n in e)null!=e[n].aFiles?(f.append(n+"_attached_content",e[n].aFiles[0]),f.append(n,e[n].aFiles[0].name)):f.append(n,e[n]);c({method:"PUT",
url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/vmap/querys/"+b,data:f,params:{token:g}}).then(function(b){if(!m(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(m(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;if(m(b.status)&&500===b.status)return bootbox.alert(b.statusText),0;t.call()},function(a){bootbox.alert(a);console.error(a)})},insertBoElement:function(b,d,e,f,r,t){var g=this.sToken,h=angular.element(z.b).injector().get(["envSrvc"]),
l=angular.element(z.b).injector().get(["formSrvc"]);d=[d.id_field];h.oFormValues=r;h.oFormDefinition=e;h.sFormDefinitionName=f;e=l.getFormData(f,!0);for(h=0;h<d.length;h++)null!=r[f][d[h]]&&(e[d[h]]=r[f][d[h]]);f=new FormData;for(var n in e)null!=e[n].aFiles?(f.append(n+"_attached_content",e[n].aFiles[0]),f.append(n,e[n].aFiles[0].name)):f.append(n,e[n]);c({method:"POST",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/vmap/querys/"+b,data:f,params:{token:g}}).then(function(b){if(!m(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),
0;if(m(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;if(m(b.status)&&500===b.status)return bootbox.alert(b.statusText),0;t.call()},function(a){bootbox.alert(a);console.error(a)})},deleteBoElements:function(b,d,e){c({method:"DELETE",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/vmap/querys/"+b,params:{token:this.sToken,idList:d.join("|")}}).then(function(b){if(!m(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(m(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),
0;if(m(b.status)&&500===b.status)return bootbox.alert(b.statusText),0;e.call()},function(a){bootbox.alert(a);console.error(a)})},getSectionDef:function(b){var e=this.sToken,f=d.defer();c({method:"GET",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/vitis/vitissections/"+b,params:{token:e}}).then(function(b){if(!m(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(!m(b.data.data)||!m(b.data.data[0])||!m(b.data.data[0].ressource_id))return a("NO_SECTION_FOUNDED").then(function(a){bootbox.alert(a)}),
0;if(m(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;f.resolve(b.data.data[0])},function(a){bootbox.alert(a);console.error(a)});return f.promise},getSectionRessourceTab:function(b){var e=this.sToken,f=d.defer();c({method:"GET",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/vitis/ressources/"+b,headers:{Accept:"application/json"},params:{token:e}}).then(function(b){if(!m(b.data)||!m(b.data.ressources)||!m(b.data.ressources[0]))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),
0;if(m(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;f.resolve(b.data.ressources[0])},function(a){bootbox.alert(a);console.error(a)});return f.promise},getSectionRessourceData:function(b,e){var f=this.sToken,g=d.defer(),f={token:f,limit:100};null!=e&&""!==e&&(f.filter=e);c({method:"GET",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/"+b,params:f}).then(function(b){if(!m(b.data)||!m(b.data.data)||!m(b.data.data[0]))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),
0;if(m(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;g.resolve(b.data.data)},function(a){bootbox.alert(a);console.error(a)});return g.promise},getSectionForm:function(b,e){e=null!=e?e:!1;var f=d.defer();c({method:"GET",url:"modules/"+b.module_name+"/forms/"+b.mode_id+"/"+(1<b.index?b.mode_id+"_"+b.tab_name+"_"+b.name+".json":b.mode_id+"_"+b.tab_name+".json")}).then(function(b){if(!m(b.data))return a("NO_FORM_FOUNDED").then(function(a){bootbox.alert(a)}),0;b=b.data;if(e)for(var c in b)if(null!=
b[c]&&null!=b[c].rows)for(var d=b[c].rows.length-1;0<=d;d--)if(null!=b[c].rows[d].fields)for(var g=b[c].rows[d].fields.length-1;0<=g;g--)"button"===b[c].rows[d].fields[g].type&&b[c].rows[d].fields.splice(g,1);f.resolve(b)},function(a){bootbox.alert(a);console.error(a)});return f.promise},updateSectionElement:function(b,e,f,n,r){var g=d.defer(),h=this.sToken;e=r[n][e];var l=angular.element(z.b).injector().get(["envSrvc"]),y=angular.element(z.b).injector().get(["formSrvc"]);l.oFormValues=r;l.oFormDefinition=
f;l.sFormDefinitionName=n;f=y.getFormData(l.sFormDefinitionName);c({method:"PUT",url:null!=e?this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/"+b+"/"+e:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/"+b,data:f,params:{token:h}}).then(function(b){if(!m(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),0;if(m(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;if(m(b.status)&&500===b.status)return bootbox.alert(b.statusText),
0;g.resolve(b.data)},function(a){console.error(a);bootbox.alert(a)});return g.promise},insertSectionElement:function(b,e,f,n,r){var g=d.defer();e=this.sToken;var h=angular.element(z.b).injector().get(["envSrvc"]),l=angular.element(z.b).injector().get(["formSrvc"]);h.oFormValues=r;h.oFormDefinition=f;h.sFormDefinitionName=n;f=l.getFormData(h.sFormDefinitionName);c({method:"POST",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/"+b,data:f,params:{token:e}}).then(function(b){if(!m(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),
0;if(m(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;if(m(b.status)&&500===b.status)return bootbox.alert(b.statusText),0;g.resolve(b.data)},function(a){console.error(a);bootbox.alert(a)});return g.promise},deleteSectionElements:function(b,e){var f=d.defer();c({method:"DELETE",url:this.oProperties.web_server_name+"/"+this.oProperties.services_alias+"/"+b,params:{token:this.sToken,idList:e.join("|")}}).then(function(b){if(!m(b.data))return a("NO_VALUES_RETURNED").then(function(a){bootbox.alert(a)}),
0;if(m(b.data.errorMessage))return bootbox.alert(b.data.errorMessage),0;if(m(b.status)&&500===b.status)return bootbox.alert(b.statusText),0;f.resolve(b.data)},function(a){console.error(a);bootbox.alert(a)});return f.promise},disableFormElement:function(a,b,c){if(null==a)return console.error("oFormDefinition not defined"),null;if(null==b)return console.error("sElement not defined"),null;c=null!=c?[c]:Object.keys(a);for(var d=0;d<c.length;d++)if(null!=a[c[d]]&&fa(a[c[d]].rows))for(var e=0;e<a[c[d]].rows.length;e++)if(null!=
a[c[d]].rows[e].fields)for(var f=0;f<a[c[d]].rows[e].fields.length;f++)a[c[d]].rows[e].fields[f].name===b&&(a[c[d]].rows[e].fields[f].disabled=!0);return a},extractFormDefinitionInfos:function(a){angular.element("form[name='"+a+"']").scope().ctrl.Bn()}}}sx.$inject="$translate $rootScope $http $q $log envSrvc".split(" ");kx.module.service("formReaderService",sx);z.ww=function(a,b,c,d,e,f,g,h,l){a.getMainTemplateUrl=function(){return d.sMainTemplateUrl};a.disconnect=function(){e.disconnect()};a.$root.clearFormData=function(a,c){b.info("clearFormData");d.toGarbageCollection(d.oFormDefinition[a]);d.oFormDefinition[a]=null;d.oFormDefinition[a]={};d.toGarbageCollection(d.oFormValues[a]);d.oFormValues[a]=null;d.oFormValues[a]={};delete c.oFormDefinition;delete c.oFormValues;delete c.oProperties;delete c.oFormEventsContainer};a.$root.connectFromUrl=function(a){b.info("connectFromUrl");
var c=l.one(oClientProperties.services_alias+"/"+e.web_service,e.web_service_controller),d={token:e.token};c.customPOST(JSON.stringify({user:a.login,password:a.password,duration:e.duration}),"",d).then(function(b){1==b.status?(e.token=b.token,e.validity_date=b.validity_date,sessionStorage.session_token=e.token,g.login=a.login,g.id=parseInt(b.user_id),g.privileges=b.privileges,sessionStorage.user_login=a.login,sessionStorage.user_id=g.id,sessionStorage.privileges=g.privileges,e.saveSessionToLocalStorage(),
n.resolve()):e.disconnect()})};h(["CONFIRM_OK","CONFIRM_CANCEL","CONFIRM_CONFIRM"]).then(function(a){bootbox.addLocale("fr",{OK:a.CONFIRM_OK,CANCEL:a.CONFIRM_CANCEL,CONFIRM:a.CONFIRM_CONFIRM})});var n=c.defer();c=n.promise;var r=Object.keys(oUrlParams);null===e.getAppLocalStorageItem("session_token")&&-1!==r.indexOf("login")&&-1!==r.indexOf("password")?a.$root.connectFromUrl(oUrlParams):n.resolve();c.then(function(){var a=e.getAppLocalStorageItem("session_token");null!==a?(f=_.extendOwn(f,oClientProperties),
"unstable"!=f.status?l.one(f.services_alias+"/vitis/privatetoken").customGET("",{token:a}).then(function(b){1==b.status?(sessionStorage.session_token=a,z.RestangularProvider.setBaseUrl(f.web_server_name),f.getFromServer().then(function(){h.use(f.language);bootbox.setLocale(f.language);e.restoreSessionFromAppLocalStorage();e.token=a;g.login=sessionStorage.user_login;g.id=parseInt(sessionStorage.user_id);g.privileges=b.privileges;sessionStorage.privileges=b.privileges;f.app_name=sessionStorage.application.toLowerCase().charAt(0).toUpperCase()+
sessionStorage.application.slice(1);document.title=f.app_name.toUpperCase();"undefined"!=typeof sessionStorage.environment&&(f.environment=sessionStorage.environment);e.connect()})):e.disconnect()}):e.disconnect()):(e.clearSessionStorage(),d.sMainTemplateUrl="templates/loginTpl.html",d.sFormDefinitionName="login_form")})};z.ww.$inject="$scope $log $q envSrvc sessionSrvc propertiesSrvc userSrvc $translate Restangular".split(" ");z.module.controller("initCtrl",z.ww);z.Zw=function(a,b,c,d,e,f,g,h,l,n,r,t,v){f.oFormDefinition={};f.oFormValues={};f.oSectionForm=n.oSectionForm;f.gridOptions={};f.gridApi={};a.oProperties=v;less.refresh();moment.locale(v.language);d(["USER"],{sUserLogin:t.login}).then(function(b){a.sUserLoginText=b.USER});r.loadModes().then(function(){a.modes=r.modes;f.sSelectedObjectName=n.oSelectedObject.name;a.objects=r.modes[0].objects;null!=oUrlParams.mode_id?setTimeout(function(){r.selectMode(a,oUrlParams.mode_id);setTimeout(function(){$(".mode_selected").removeClass("mode_selected");
$("#mode_"+oUrlParams.mode_id).addClass("mode_selected")},500)}):r.selectMode(a,r.modes[0].mode_id);null!=oUrlParams.object_id&&null!=oUrlParams.mode_id&&(r.selectObject(a,oUrlParams.object_id,oUrlParams.mode_id),f.$on(oUrlParams.object_id+"_form",function(){if(null!=oUrlParams.action&&null!=oUrlParams.ids){var a=oUrlParams.ids.split("|")[0];setTimeout(function(){angular.element(z.S).scope().$root[oUrlParams.action](a)},1E3)}}))});a.editObjectElement=function(a,b,c){this.actionOnObjectElement(a,b,
c,"editSectionForm")};a.displayObjectElement=function(a,b,c){this.actionOnObjectElement(a,b,c,"showSectionForm")};a.actionOnObjectElement=function(a,b,d,e){r.scope.selectObject(b,a);var g=f.$on(b,function(){null!=e&&null!=d&&c(function(){angular.element(z.S).scope().$root[e](d)},500);g()})};a.selectMode=function(b,d){r.selectMode(a,b,d).then(function(){c(function(){a.setFullScreen(n.oSelectedMode.fullScreen);sessionStorage.ajaxLoader=n.oSelectedMode.ajaxLoader},100);var b=a.$root.gridApi[a.sSelectedObjectName];
null!=b&&b.core.handleWindowResize()})};a.selectObject=function(b,d,e){if(null!=d&&n.oSelectedMode.mode_id!==d){var f,g=r.getMode(d);if(null==g.objects)return console.error(b+" is not object of "+d),0;for(var h=0;h<g.objects.length;h++)g.objects[h].name===b&&(f=angular.copy(h));if(null==f)return console.error(b+" is not object of "+d),0;r.selectMode(a,d,e,f).then(function(){c(function(){a.setFullScreen(n.oSelectedMode.fullScreen);sessionStorage.ajaxLoader=n.oSelectedMode.ajaxLoader},100);var b=a.$root.gridApi[a.sSelectedObjectName];
null!=b&&b.core.handleWindowResize()})}else r.selectObject(a,b,d,e)};f.compileObjectTemplate=function(b){g(b).then(function(b){h($("#container_mode_"+n.oSelectedMode.mode_id).html(b).contents())(a);$("#data_column .container-mode").hide();$("#container_mode_"+n.oSelectedMode.mode_id).show()});l.info("compileObjectTemplate : "+b)};f.loadList=function(a,b){l.info("loadList");n.sMode="search";if("undefined"!==typeof b){for(var c=[],d=Object.keys(b),e=0;e<d.length;)""===b.lang&&(b.lang="'"+v.language+
"'"),c.push(d+"="+b[d[e]]),e++;n.oSelectedObject.filter=c}if(null!==a)var g=f.$on("workspaceListTplCompiled",function(){f.$eval(a);g()})};f.showModeScrollBoutton=function(){return document.getElementById("mode_column").scrollHeight>document.getElementById("mode_column").clientHeight};f.scrollMode=function(a){$("#mode_column").animate({scrollTop:$("#mode_column").scrollTop()+a},200)}};z.Zw.$inject="$scope $http $timeout $translate $translatePartialLoader $rootScope $templateRequest $compile $log envSrvc modesSrvc userSrvc propertiesSrvc".split(" ");
z.module.controller("mainCtrl",z.Zw);z.Mz=function(a,b,c,d,e,f,g,h){b.info("initWorkspaceList");a.$emit("initWorkspaceList",a);h.addScopeToObject(d.oSelectedObject.name,d.oSelectedMode.mode_id,a);a.edit_column=d.oSelectedObject.edit_column;a.show_column=d.oSelectedObject.show_column;var l;0===Object.keys(a.gridOptions).length&&(a.gridOptions={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:f.rows_per_page,enableColumnMenus:!1,enableColumnResizing:!0,
paginationPageSizes:[10,20,50,100,200,500],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!0,appHeaderOptionBar:!1,appLoadGridData:!0,appGridTitle:d.oSelectedObject.label,appResizeGrid:!1,appFooter:!0,appShowPagination:!0,appEnableDragAndDrop:!1,appDragAndDropEvent:{},appActions:[],appShowActions:!0});"undefined"==typeof d.oDefaultGridOptions[d.oSelectedObject.name]&&(d.oDefaultGridOptions[d.oSelectedObject.name]=angular.copy(a.gridOptions));"undefined"==typeof d.oWorkspaceList[d.oSelectedObject.name]?
d.oWorkspaceList[d.oSelectedObject.name]={}:("undefined"!=typeof d.oWorkspaceList[d.oSelectedObject.name].aFilter&&(l=angular.copy(d.oWorkspaceList[d.oSelectedObject.name].aFilter)),"undefined"!=typeof d.oWorkspaceList[d.oSelectedObject.name].oFormValue&&(d.oFormValues[d.sFormDefinitionName]=angular.copy(d.oWorkspaceList[d.oSelectedObject.name].oFormValue)));"undefined"!==typeof l&&(a.gridOptions.aFilter=l);"undefined"!=typeof d.oGridOptionsCopy[d.oSelectedObject.name]&&(a.gridOptions.oUrlParams=
angular.copy(d.oGridOptionsCopy[d.oSelectedObject.name].oUrlParams));!0===a.gridOptions.appEnableDragAndDrop&&(a.gridOptions.rowTemplate='<div grid="grid" class="ui-grid-draggable-row" draggable="true"><div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader, \'custom\': true }" ui-grid-cell></div></div>');var n=d.oSelectedObject.name;a.sSelectedObjectName=n;d.oGridOptions[n]=a.gridOptions;
var r=d.getSectionWebServiceResourceId(),t=0;"undefined"!=typeof d.oSectionForm&&"undefined"!=typeof d.oSectionForm[d.oSelectedObject.name]&&"undefined"!=typeof d.oSectionForm[d.oSelectedObject.name].iSelectedSectionIndex&&(t=d.oSectionForm[d.oSelectedObject.name].iSelectedSectionIndex);0<t&&delete d.oSelectedObject.sections[0].columns;null!==r&&"undefined"===typeof a.gridOptions.columnDefs&&("undefined"===typeof d.oSelectedObject.sections[t].columns?c.one(f.services_alias+"/vitis").customGET("ressources/"+
r,{token:e.token}).then(function(b){if(1===b.status){var c=d.explodeWebServiceResourceId(r),e=b.ressources[0][c[1]][0].columns;if(0<e.length){e=a.$root.formatGridColumn(e,n);d.oSelectedObject.sIdField=e[0].field;if("undefined"==typeof a.gridOptions.appShowActions||!1!==a.gridOptions.appShowActions)null===d.oSelectedObject.edit_column&&null===d.oSelectedObject.show_column||e.unshift({name:"",field:"actions",cellTemplate:"<app-ui-grid-action></app-ui-grid-action>",width:60,enableSorting:!1,enableColumnMoving:!1,
enableColumnResizing:!1});d.oSelectedObject.sections[t].columns=e.slice(0);a.gridOptions.columnDefs=d.oSelectedObject.sections[t].columns.slice(0);b=b.ressources[0][c[1]][1].actions;d.oSelectedObject.sections[t].actions="undefined"!==typeof b?a.$root.formatGridAction(b,n):[];"display"!=d.sMode&&(a.gridOptions.appActions=d.oSelectedObject.sections[t].actions.slice(0))}}}):(a.gridOptions.columnDefs=d.oSelectedObject.sections[t].columns.slice(0),"display"!=d.sMode&&(a.gridOptions.appActions=d.oSelectedObject.sections[t].actions.slice(0))))};
z.Mz.$inject="$scope $log Restangular envSrvc sessionSrvc propertiesSrvc formSrvc modesSrvc".split(" ");z.module.controller("workspaceListCtrl",z.Mz);z.Ly=function(a,b,c,d,e,f){b.info("initSimpleForm");f.addScopeToObject(e.oSelectedObject.name,e.oSelectedMode.mode_id,a);a.bFormValidationMessage=!0;var g=c.$on("formDefinitionLoaded",function(){var a=e.oFormDefinition[e.sFormDefinitionName].title;d([a],e.oFormValues[e.sFormDefinitionName]).then(function(b){e.oFormDefinition[e.sFormDefinitionName].title=b[a]});g()})};z.Ly.$inject="$scope $log $rootScope $translate envSrvc modesSrvc".split(" ");z.module.controller("simpleFormCtrl",z.Ly);z.lv=function(a,b,c,d,e,f,g){d.info("initDoubleForm");g.addScopeToObject(f.oSelectedObject.name,f.oSelectedMode.mode_id,a);a.sSelectedObjectName=f.oSelectedObject.name;var h=e.$on("doubleFormCompiled",function(){var e="modules/"+f.oSelectedMode.module_name+"/"+f.sTemplateFolder,g=f.getSectionWebServiceResourceId();null!=g?(g=f.explodeWebServiceResourceId(g),e+=g[1]):e="undefined"!=typeof f.oSelectedObject.template_name?e+f.oSelectedObject.template_name:e+f.oSelectedMode.mode_id;g=e+"RightTpl.html";
b(g).then(function(b){c($("#double_form_right_section_"+f.oSelectedObject.name).html(b).contents())(a)});d.info("compileDoubleFormRightTemplate : "+g);e+="LeftTpl.html";b(e).then(function(b){c($("#double_form_left_section_"+f.oSelectedObject.name).html(b).contents())(a)});d.info("compileDoubleFormLeftTemplate : "+e);h()})};z.lv.$inject="$scope $templateRequest $compile $log $rootScope envSrvc modesSrvc".split(" ");z.module.controller("doubleFormCtrl",z.lv);z.ry=function(a,b,c,d,e,f,g,h,l,n,r){d.info("initSectionForm");r.addScopeToObject(h.oSelectedObject.name,h.oSelectedMode.mode_id,a);e.bLastSectionContainer=!1;a.bFormValidationMessage=!0;var t={};t.sections=h.oSelectedObject.sections;for(f=t.iSelectedSectionIndex=0;f<t.sections.length;)t.sections[f].bLoaded=!1,f++;var v="SECTION_"+h.sMode.toUpperCase()+"_TITLE_"+h.oSelectedObject.name.toUpperCase();g([v],{sId:h.sId}).then(function(a){t.title=a[v]});h.oSectionForm[h.oSelectedObject.name]=t;h.sFormDefinitionName=
h.oSelectedObject.name+"_"+t.sections[0].name+"_"+h.sMode+"_form";h.oSelectedObject.sFormDefinitionName=h.sFormDefinitionName;var x=e.$watch(e.bLastSectionContainer,function(){a.loadObjectSectionTemplate();x()},!1);a.selectSection=function(b,c){"insert"!=h.sMode&&(h.oSectionForm[h.oSelectedObject.name].iSelectedSectionIndex=b,h.sFormDefinitionName=h.oSelectedObject.name+"_"+h.oSectionForm[h.oSelectedObject.name].sections[b].name+"_"+h.sMode+"_form",h.oLastSelectedObjectMode[h.oSelectedMode.mode_id].sFormDefinitionName=
h.sFormDefinitionName,$("#container_mode_"+h.oSelectedMode.mode_id+" .container-section").hide(),$("#container_section_"+h.oSelectedObject.name+"_"+c.name).show(),a.loadObjectSectionTemplate(),a.$root.$broadcast("updateStudio_"+h.oSelectedObject.name,{index:b,oSectionForm:c}))};a.loadObjectSectionTemplate=function(){var e=h.oSectionForm[h.oSelectedObject.name],f=e.iSelectedSectionIndex,g;g=0==f?h.sSelectedTemplate:e.sections[f].template;-1==g.indexOf("/")&&(g=h.sTemplateFolder+g);d.info("loadObjectSectionTemplate : "+
g);e.sections[f].bLoaded||(a.sSelectedObjectName=h.oSelectedObject.name,c(g).then(function(c){b($("#container_section_"+h.oSelectedObject.name+"_"+e.sections[f].name).html(c).contents())(a)}),d.info("loadObjectSectionTemplate (compilation) : "+g),g=h.oSelectedObject.sections[f].event,"undefined"!=typeof g&&""!=g&&(g=g.replace(/javascript:/i,""),-1==g.indexOf("(")&&(g+="()"),a.$eval(g)));h.oSectionForm[h.oSelectedObject.name].sections[f].bLoaded=!0}};z.ry.$inject="$scope $compile $templateRequest $log $rootScope $timeout $translate envSrvc sessionSrvc propertiesSrvc modesSrvc".split(" ");
z.module.controller("sectionFormCtrl",z.ry);z.Vw=function(a,b,c,d,e,f,g,h,l,n){a.showErrorAlert=function(c){b([c]).then(function(b){a.sLoginErrorMessage=b[c];document.getElementById("login_error_alert").style.display="block"})};a.hideErrorAlert=function(){document.getElementById("login_error_alert").style.display="none"};c.oFormDefinition={};c.oFormValues={};h.oSelectedObject={name:"login",sections:[]};less.refresh();l=_.extendOwn(l,oClientProperties);"unstable"==l.status&&a.showErrorAlert("FORM_APP_STATUS_ERROR");z.RestangularProvider.setBaseUrl(l.web_server_name);
l.getFromServer().then(function(){"UNSTABLE"==l.VM_STATUS&&a.showErrorAlert("FORM_VAS_STATUS_ERROR");b.use(l.language);bootbox.setLocale(l.language);l.app_name=sessionStorage.application.toLowerCase().charAt(0).toUpperCase()+sessionStorage.application.slice(1);a.translationData={app_name:l.app_name};document.title=l.app_name.toUpperCase();a.$evalAsync(function(){});if(null!=l.domain){"undefined"==typeof h.oFormValues.login_form.domain&&(h.oFormValues.login_form.domain={});for(var c=0,d=[{label:"",
value:""}],e=Object.keys(l.domain);c<e.length;)""!=e[c]&&l.domain[e[c]]&&d.push({label:e[c],value:l.domain[e[c]]}),c++;h.oFormValues.login_form.domain.options=d;h.oFormValues.login_form.domain.selectedOption=d[0]}});a.oFormRequestParams={sUrl:"forms/login.json"};a.sendLoginForm=function(){var b=d.defer(),c=b.promise;if("unstable"==l.status)b.reject();else{a.hideErrorAlert();var g=a.sFormDefinitionName,h=a.oFormValues[g].user_login;""!=a.oFormValues[g].domain.selectedOption.value&&void 0!=a.oFormValues[g].domain.selectedOption.value&&
-1==h.indexOf("@")&&(h+="@"+a.oFormValues[g].domain.selectedOption.value);var y=e.one(l.services_alias+"/"+f.web_service,f.web_service_controller),B={token:f.token};y.customPOST(JSON.stringify({user:h,password:a.oFormValues[g].user_password}),"",B).then(function(c){1==c.status?(a.hideErrorAlert(),f.token=c.token,f.validity_date=c.validity_date,sessionStorage.session_token=f.token,n.login=h,n.id=parseInt(c.user_id),n.privileges=c.privileges,sessionStorage.user_login=h,sessionStorage.user_id=n.id,sessionStorage.privileges=
n.privileges,l.getFromServer().then(function(){l.app_name=sessionStorage.application.toLowerCase().charAt(0).toUpperCase()+sessionStorage.application.slice(1);"undefined"!=typeof sessionStorage.environment&&(l.environment=sessionStorage.environment);f.connect();b.resolve()}),!0===a.oFormValues[g].remember_me&&f.saveSessionToLocalStorage()):(a.showErrorAlert("FORM_LOGIN_CONNECTION_ERROR"),b.reject())})}return c}};z.Vw.$inject="$scope $translate $rootScope $q Restangular sessionSrvc externFunctionSrvc envSrvc propertiesSrvc userSrvc".split(" ");
z.module.controller("loginCtrl",z.Vw);z.mw=function(a,b,c,d,e,f,g,h,l,n){c.info("initHtmlForm");a.oFormScope=a;a.oProperties=h;a.sToken=l.token;"function"===typeof destructor_form&&destructor_form();"undefined"==typeof a.sFormDefinitionName&&(a.sFormDefinitionName=g.sFormDefinitionName);var r=d.defer();d=r.promise;var t=g.oSelectedObject.name,v=g.getSectionWebServiceResourceId();if("undefined"!=typeof t){var x="";if(1<g.oSelectedObject.sections.length){var y=g.oSectionForm[t];"undefined"==typeof y||sb(y)||0!=y.iSelectedSectionIndex&&
(x=y.sections[y.iSelectedSectionIndex].name)}}"undefined"==typeof g.oFormValues[a.sFormDefinitionName]&&(g.oFormValues[a.sFormDefinitionName]={});"boolean"!=typeof a.bLoadFormValues&&(a.bLoadFormValues=!0);if(null==v||"update"!=g.sMode&&"display"!=g.sMode||!0!==a.bLoadFormValues)"insert"==g.sMode&&(g.oFormValues[a.sFormDefinitionName]={},g.oFormDefaultValues[a.sFormDefinitionName]={}),e(function(){r.resolve("load form. def.")});else{c.info("initHtmlForm : Form. values");var B=g.explodeWebServiceResourceId(v);
f.one(h.services_alias+"/"+B[0],B[1]).customGET(g.sId,{token:l.token}).then(function(b){if(1==b.status)g.oFormValues[a.sFormDefinitionName]={},g.oFormValues[a.sFormDefinitionName]=g.extractWebServiceData(B[1],b)[0],g.oFormDefaultValues[a.sFormDefinitionName]=angular.copy(g.oFormValues[a.sFormDefinitionName]),r.resolve("load form. def.");else{var c={className:"modal-danger",buttons:{ok:{label:"OK",className:"btn-default"}}};null!=b.errorMessage&&(c.message=b.errorMessage);n.modalWindow("alert","FORM_VALUES_LOADING_ERROR",
c)}})}if("undefined"!=typeof t){var E={};null!=a.oFormRequestParams?E=a.oFormRequestParams:(E.sUrl="modules/"+g.oSelectedMode.module_name+"/forms/"+g.oSelectedMode.mode_id+"/"+t,""!=x&&(E.sUrl+="_"+x),E.sUrl+=".json");var I={params:E.oParams};"undefined"!=typeof E.oHeaders&&(I.headers=E.oHeaders);c.info("initHtmlForm : Form. def. : "+E.sUrl);d.then(function(){b.get(E.sUrl,I).success(function(b){if(0!=b.status){g.oFormDefinition[a.sFormDefinitionName]={};var d="",e="",f;for(f in b)Array.isArray(b[f])&&
(d=b[f][0].json_form[1],e=b[f][0].json_form[2]);"undefined"!=typeof E.sExtractData&&(E.oData=b,b=a.$eval(E.sExtractData));if(null!=b){if(m(b.datasources))var h=angular.copy(b.datasources);b=b[g.sMode];g.oFormDefinition[a.sFormDefinitionName]=b;g.oFormDefinition[a.sFormDefinitionName].JS_url=d;g.oFormDefinition[a.sFormDefinitionName].CSS_url=e;null!=h&&(g.oFormDefinition.datasources=h);a.$root.$emit("formDefinitionLoaded",a.sFormDefinitionName);if(!0===b.javascript){var l="",l=-1===E.sUrl.indexOf(".json")?
d:E.sUrl.replace(/.json/g,".js");c.info("initHtmlForm : javascript assoc. to : "+E.sUrl);Td([l],{callback:function(){angular.element(z.Lb).ready();constructor_form(a,l)},async:!0,scriptInBody:!0})}}a.oFormRequestParams=null}else g.oFormDefinition[a.sFormDefinitionName]={},g.oFormValues[a.sFormDefinitionName]={},g.oFormDefaultValues[a.sFormDefinitionName]={},d={className:"modal-danger",buttons:{ok:{label:"OK",className:"btn-default"}}},null!=b.errorMessage&&(d.message=b.errorMessage),n.modalWindow("alert",
"FORM_DEFINITION_LOADING_ERROR",d)}).error(function(){})})}};z.mw.$inject="$scope $http $log $q $timeout Restangular envSrvc propertiesSrvc sessionSrvc externFunctionSrvc".split(" ");z.module.controller("htmlFormCtrl",z.mw);z.gq=function(a){a.clearLessCache();$.notify.defaults({autoHideDelay:3E3});return{restrict:"A",controller:"initCtrl",controllerAs:"ctrl"}};z.appInitDrtv=z.gq;z.gq.$inject=["externFunctionSrvc"];z.module.directive("appInit",z.gq);z.b=function(a,b){return{restrict:"A",controller:"mainCtrl",controllerAs:"ctrl",link:function(c){z.Gk("appMainDrtvLoaded");a.onresize=function(){b.resizeWin()};c.$on("$destroy",function(){a.onresize=null})}}};z.appMainDrtv=z.b;z.b.$inject=["$window","externFunctionSrvc"];z.module.directive("appMain",z.b);z.nu=function(a){return{link:function(b,c){a(function(){$(c).children().popover({trigger:"hover"});$("#object_column").mCustomScrollbar({axis:"x",theme:"dark-thick"})});b.$on("$destroy",function(){$(c).children().popover("destroy")})}}};
z.nu.$inject=["$timeout"];z.module.directive("repeatMode",z.nu);z.S=function(a,b,c,d,e,f,g,h){return{restrict:"A",controller:"workspaceListCtrl",controllerAs:"ctrl",scope:!0,link:function(l,n){var r,t;l.gridOptions.onRegisterApi=function(a){r=h.oSelectedObject.name;l.$root.gridApi[h.oSelectedObject.name]=a;h.oGridOptions[h.oSelectedObject.name].oUrlParams=null!=l.gridOptions.oUrlParams?l.gridOptions.oUrlParams:{order_by:h.oSelectedObject.sorted_by,sort_order:h.oSelectedObject.sorted_dir};a.pagination.on.paginationChanged(l,function(a,b){"undefined"!==typeof h.oGridOptions[h.oSelectedObject.name]&&
"undefined"!==typeof l.$root.gridApi[h.oSelectedObject.name]&&(h.oGridOptions[h.oSelectedObject.name].aFilter=angular.copy(h.oGridOptions[h.oSelectedObject.name].aFilter),l.setGridPage(a,b,h.oGridOptions[h.oSelectedObject.name].aFilter,h.oGridOptions[h.oSelectedObject.name].oUrlParams),g.rows_per_page=h.oGridOptions[h.oSelectedObject.name].paginationPageSize)});a.core.on.sortChanged(l,function(a,b){a={};0<b.length&&(a.order_by=b[0].field,a.sort_order=b[0].sort.direction.toUpperCase());h.oGridOptionsCopy[h.oSelectedObject.name].oUrlParams.order_by=
a.order_by;h.oGridOptionsCopy[h.oSelectedObject.name].oUrlParams.sort_order=a.sort_order;b=0;"undefined"!=typeof h.oSectionForm&&"undefined"!=typeof h.oSectionForm[h.oSelectedObject.name]&&"undefined"!=typeof h.oSectionForm[h.oSelectedObject.name].iSelectedSectionIndex&&(b=h.oSectionForm[h.oSelectedObject.name].iSelectedSectionIndex);for(var c=h.oSelectedObject.sections[b].columns,d=0;d<c.length;)delete c[d].sort,c[d].field===a.order_by&&(c[d].sort={direction:e[a.sort_order],ignoreSort:!0,priority:0}),
d++;h.oSelectedObject.sections[b].columns=c;h.oGridOptions[h.oSelectedObject.name].oUrlParams=a;1===h.oGridOptions[h.oSelectedObject.name].paginationCurrentPage?l.$root.gridApi[h.oSelectedObject.name].pagination.raise.paginationChanged(1,h.oGridOptions[h.oSelectedObject.name].paginationPageSize):h.oGridOptions[h.oSelectedObject.name].paginationCurrentPage=1});"undefined"!==typeof a.dragndrop&&(!0===l.gridOptions.appEnableDragAndDrop?(a.dragndrop.setDragDisabled=!1,a.draggableRows.on.rowDragged(l,
function(){}),a.draggableRows.on.rowFinishDrag(l,function(){if("undefined"!==typeof l.gridOptions.appDragAndDropEvent&&"undefined"!==typeof l.gridOptions.appDragAndDropEvent.rowFinishDrag)l.$root[l.gridOptions.appDragAndDropEvent.rowFinishDrag]()}),a.draggableRows.on.rowEnterRow(l,function(){}),a.draggableRows.on.beforeRowMove(l,function(){})):a.dragndrop.setDragDisabled=!0);h.oGridOptionsCopy[h.oSelectedObject.name]=angular.copy(h.oGridOptions[h.oSelectedObject.name]);h.oGridOptions[h.oSelectedObject.name].appLoadGridData&&
l.setGridPage(1,h.oGridOptions[h.oSelectedObject.name].paginationPageSize,h.oGridOptions[h.oSelectedObject.name].aFilter,h.oGridOptions[h.oSelectedObject.name].oUrlParams);!0===h.oGridOptions[h.oSelectedObject.name].appResizeGrid&&l.$root.gridApi[h.oSelectedObject.name].core.handleWindowResize()};a(function(){f.resizeWin();l.$root.gridApi[h.oSelectedObject.name].core.handleWindowResize();$(n).find(".ui-grid-render-container-body").on("click.selectRow",function(a){a=a.target;if($(a).hasClass("ui-grid-cell")||
$(a).hasClass("ui-grid-cell-contents"))a=$(n).find(".ui-grid-render-container-body .ui-grid-canvas").children().index($(a).parents(".ui-grid-row")),$(n).find(".ui-grid-render-container-left .ui-grid-row").eq(a).find(".ui-grid-selection-row-header-buttons").click()});n[0].querySelector(".ui-grid-render-container-body").style.height="100%";n[0].querySelector(".ui-grid-render-container-body .ui-grid-viewport").style.height="Calc(100% - 30px)";b.$emit("workspaceListTplCompiled")});$(n).find(".workspacelist-grid-header-search-button-arrow-right").click(function(){l.searchFormCompiled||
(c("templates/formTpl.html").then(function(a){d($("#"+h.oSelectedObject.name+"_grid_header_search_form").html(a).contents())(l);t=l.$root.$on("formExtracted",function(a,b){b===h.sFormDefinitionName&&(t(),"undefined"==typeof h.oWorkspaceList[h.oSelectedObject.name].oDefaultValues?(h.oWorkspaceList[h.oSelectedObject.name].oDefaultValues=angular.copy(h.oFormValues[h.sFormDefinitionName]),h.oWorkspaceList[h.oSelectedObject.name].oValues=angular.copy(h.oFormValues[h.sFormDefinitionName])):h.oFormValues[h.sFormDefinitionName]=
angular.copy(h.oWorkspaceList[h.oSelectedObject.name].oValues))})}),l.searchFormCompiled=!0);a(function(){$(this).parent().find(".workspacelist-grid-header-search-button-arrow-icon").toggleClass("icon-keyboard_arrow_right");$(this).parent().find(".workspacelist-grid-header-search-button-arrow-icon").toggleClass("icon-keyboard_arrow_down");$(n).find(".workspacelist-grid-header-search-form").slideToggle(400,function(){f.resizeWin();l.$root.gridApi[h.oSelectedObject.name].core.handleWindowResize()})})});
l.$on("$destroy",function(){$(n).find(".ui-grid-render-container-body").off("click.selectRow");var a=h.oGridOptions[r];null!==a&&("columnDefs data appActions aFilter oUrlParams paginationPageSizes".split(" ").forEach(function(b){h.toGarbageCollection(a[b])}),a.onRegisterApi=null,h.oGridOptions[r]=null,l.gridOptions=null,b.gridApi[r]=null,h.oGridOptions[r]={});ja(t)&&t()})}}};z.appWorkspaceListDrtv=z.S;z.S.$inject="$timeout $rootScope $templateRequest $compile uiGridConstants externFunctionSrvc propertiesSrvc envSrvc".split(" ");
z.module.directive("appWorkspaceList",z.S);z.wA=function(){return{replace:!0,templateUrl:"templates/uiGridActionTpl.html"}};z.module.directive("appUiGridAction",z.wA);z.xA=function(){return{templateUrl:"templates/uiGridPaginationTpl.html"}};z.module.directive("appUiGridPagination",z.xA);z.uA=function(){return{replace:!0}};z.module.directive("appSearchForm",z.uA);z.tu=function(){return{restrict:"A",controller:"simpleFormCtrl",controllerAs:"ctrl",scope:!0}};z.appSimpleFormDrtv=z.tu;z.module.directive("appSimpleForm",z.tu);
z.uu=function(a,b,c,d,e,f,g,h,l){return{replace:!0,templateUrl:"templates/formTpl.html",link:function(n){a(function(){f.resizeWin()});n.$root.sendSimpleForm=function(a,f){var r=c.defer(),t=r.promise,y=e.sFormDefinitionName;null!=f||(f=l.getFormData(e.sFormDefinitionName));var B=e.getSectionWebServiceResourceId(),B=e.explodeWebServiceResourceId(B),B=d.one(g.services_alias+"/"+B[0],B[1]),E="",I,w={token:h.token},A={"Content-Type":void 0},G=e.oFormDefinition[e.sFormDefinitionName].name,O=angular.element("form[name='"+
G+"']").scope();"undefined"==typeof O[G].appFormSubmitted&&(O[G].appFormSubmitted=!1);if(O[G].$valid&&!O[G].appFormSubmitted){if(O[G].appFormSubmitted=!0,"update"==e.sMode||"insert"==e.sMode)"update"==e.sMode?(E=e.sId,I="customPUT"):I="customPOST",B[I](f,E,w,A).then(function(c){!0===a&&n.$root.clearFormData(y,n);if(1==c.status)n.bFormValidationMessage&&b("FORM_VALIDATION_OK").then(function(a){$.notify(a,"success")}),"insert"==e.sMode&&(e.sId=c[e.oSelectedObject.sIdField]),O[G].appFormSubmitted=!1,
r.resolve(!0);else{if(n.bFormValidationMessage){if("undefined"!=typeof c.errorMessage&&null!=c.errorMessage)var d=c.errorMessage;n.modalWindow("dialog","FORM_VALIDATION_ERROR",{className:"modal-danger",message:d,callback:function(){r.reject(!1)}})}O[G].appFormSubmitted=!1;r.resolve(!1)}})}else r.reject(!1);return t}}}};z.uu.$inject="$timeout $translate $q Restangular envSrvc externFunctionSrvc propertiesSrvc sessionSrvc formSrvc".split(" ");z.module.directive("appSimpleFormFormular",z.uu);z.fq=function(a,b,c){return{restrict:"A",controller:"doubleFormCtrl",controllerAs:"ctrl",scope:!0,replace:!0,link:function(){a(function(){b.$emit("doubleFormCompiled");c.resizeWin()})}}};z.appDoubleFormDrtv=z.fq;z.fq.$inject=["$timeout","$rootScope","externFunctionSrvc"];z.module.directive("appDoubleForm",z.fq);z.ou=function(){return{restrict:"A",controller:"sectionFormCtrl",controllerAs:"ctrl",scope:!0}};z.appSectionFormDrtv=z.ou;z.module.directive("appSectionForm",z.ou);
z.pu=function(a){return{link:function(b,c){var d="col-xs-12",d="insert"==a.sMode?d+" section-form-section-insert":d+" section-form-section";b.$index==b.oSectionForm[b.sSelectedObjectName].iSelectedSectionIndex&&(d+=" section-form-section-selected");c[0].className=d;$(c).on("click.selectSection",function(){"insert"!=a.sMode&&($(this).parent().find(".section-form-section").removeClass("section-form-section-selected"),$(this).addClass("section-form-section-selected"))});b.$on("$destroy",function(){$(c).off("click.selectSection")})}}};
z.pu.$inject=["envSrvc"];z.module.directive("appSectionFormMenu",z.pu);z.qu=function(a,b){return{link:function(c,d){c.$index==b.oSectionForm[c.sSelectedObjectName].iSelectedSectionIndex?$(d).show():$(d).hide();c.$last&&(a.bLastSectionContainer=!0)}}};z.qu.$inject=["$rootScope","envSrvc"];z.module.directive("appSectionFormSection",z.qu);z.au=function(){return{restrict:"A",controller:"loginCtrl",controllerAs:"ctrl"}};z.appLoginDrtv=z.au;z.module.directive("appLogin",z.au);z.bu=function(a,b){return{replace:!0,templateUrl:"templates/formTpl.html",link:function(c){var d=c.$root.$on("formDefinitionLoaded",function(){a(function(){"unstable"==b.status&&(document.querySelector("button[type='submit']").disabled=!0);d()})})}}};z.bu.$inject=["$timeout","propertiesSrvc"];z.module.directive("appLoginForm",z.bu);z.Lb=function(a){return{restrict:"A",controller:"htmlFormCtrl",controllerAs:"ctrl",link:function(b){b.oFormDefinition=a.oFormDefinition;b.oFormValues=a.oFormValues;b.submitButton=!1}}};z.appHtmlFormDrtv=z.Lb;z.Lb.$inject=["envSrvc"];z.module.directive("appHtmlForm",z.Lb);function tx(a){var b=this;this.url=a;this.callbacks={};this.hI=!0;this.xr=!1;this.eG=5E3;this.$A=3E4;this.connect();ux(this);this.on("reconnectClient",function(){vx(b,"reconnectClient",sessionStorage.user_id)})}tx.prototype.on=function(a,b){this.callbacks[a]=this.callbacks[a]||[];this.callbacks[a].push(b);return this};tx.prototype.on=tx.prototype.on;function vx(a,b,c,d){a.bd.send(JSON.stringify(null!=d?{service:d,action:b,data:c}:{action:b,data:c}))}
tx.prototype.Vy=function(a){function b(){vx(c,"subscribe",sessionStorage.user_id,a)}var c=this;this.bd.readyState===this.bd.OPEN&&(b(),this.on("connect",function(){b()}));if(this.bd.readyState===this.bd.CONNECTING)this.on("connect",function(){b()})};tx.prototype.subscribeService=tx.prototype.Vy;tx.prototype.zw=function(){return this.bd.readyState===this.bd.OPEN};tx.prototype.isConnected=tx.prototype.zw;tx.prototype.sendMessage=function(a){vx(this,"echo",a)};tx.prototype.sendMessage=tx.prototype.sendMessage;
tx.prototype.LG=function(a){vx(this,"event",a)};tx.prototype.sendEvent=tx.prototype.LG;tx.prototype.zy=function(){vx(this,"ping","")};tx.prototype.sendPing=tx.prototype.zy;
tx.prototype.connect=function(){var a=this;this.bd="function"===typeof MozWebSocket?new MozWebSocket(this.url):new WebSocket(this.url);this.bd.onmessage=function(b){var c,d;try{c=JSON.parse(b.data)}catch(e){d=b.data}null!=c&&null!=c.action&&wx(a,c.action,c.data);null!=d&&wx(a,"message",d)};this.bd.onclose=function(){this.xr=!1;wx(a,"disconnect",null);a.hI&&setTimeout(function(){a.connect()},a.eG)};this.bd.onopen=function(){vx(a,"connect",sessionStorage.user_id)};this.on("connect",function(){this.xr=
!0})};tx.prototype.connect=tx.prototype.connect;tx.prototype.disconnect=function(){this.bd.close()};tx.prototype.disconnect=tx.prototype.disconnect;function wx(a,b,c){a=a.callbacks[b];if("undefined"!==typeof a)for(b=0;b<a.length;b++)a[b](c)}
function ux(a){function b(){setTimeout(function(){null!=a.bd.readyState&&null!=a.bd.OPEN&&a.bd.readyState===a.bd.OPEN&&(c=!1,a.zy(),setTimeout(function(){!1===c?(console.error("WebSocket connection broken"),a.disconnect()):a.xr=!0},1E3));b()},a.$A)}var c;a.on("ping",function(){c=!0});b()};z.on("appMainDrtvLoaded",function(){var a=angular.element(z.Lb).injector().get(["$q"]),b=angular.element(z.b).injector().get(["$log"]),c=angular.element(z.S).injector().get(["$http"]),d=angular.element(z.b).injector().get(["envSrvc"]),e=angular.element(z.S).injector().get(["formSrvc"]),f=angular.element(z.S).injector().get(["$timeout"]),g=angular.element(z.S).injector().get(["$compile"]),h=angular.element(z.b).injector().get(["modesSrvc"]),l=angular.element(z.b).injector().get(["$translate"]),n=angular.element(z.b).injector().get(["sessionSrvc"]),
r=angular.element(z.b).injector().get(["Restangular"]),t=angular.element(z.b).injector().get(["propertiesSrvc"]),v=angular.element(z.S).injector().get(["uiGridConstants"]),x=angular.element(z.S).injector().get(["$templateRequest"]),y=angular.element(z.b).injector().get(["externFunctionSrvc"]);if(null!=t.websocket_alias){var B="wss://"+location.host+"/"+t.websocket_alias+"/";z.oWebsocket=new tx(B);z.oWebsocket.oGridRefreshEvents={};z.oWebsocket.on("connect",function(a){b.info("VitisWebsocket: Connected to "+
B+" with "+a)});z.oWebsocket.on("disconnect",function(){b.info("VitisWebsocket: Disconnected")});z.oWebsocket.on("subscribe",function(a){b.info("VitisWebsocket: Subscribed to "+a)});z.oWebsocket.on("echo",function(a){b.info("VitisWebsocket echo: "+a);$.notify("VitisWebsocket: "+a,"success")});z.oWebsocket.on("event",function(a){b.info("VitisWebsocket event: ",a)});setTimeout(function(){z.oWebsocket.zw()||(b.error("VitisWebsocket was not able to connect"),l(["INACCESSIBLE_WEBSOCKET"]).then(function(a){$.notify(a.INACCESSIBLE_WEBSOCKET,
"error")}))},5E3)}angular.element(z.b).scope().loadSimpleForm=function(){d.sMode="update";b.info("loadSimpleForm")};angular.element(z.b).scope().scopeEval=function(a,c){b.info(c);a.$eval(c)};angular.element(z.S).scope().AddDoubleForm=function(){d.addDoubleForm();b.info("AddDoubleForm")};angular.element(z.S).scope().AddSectionForm=function(){b.info("AddSectionForm");var a="before"+Ma(d.oSelectedObject.name,"_").replace(/_/g,"")+"Edition";if("undefined"!=typeof this[a])this[a]();d.addSectionForm()};
angular.element(z.b).scope().setMode=function(a){b.info("setMode: "+a);var c=d.oSelectedMode.mode_id,e=d.oSelectedObject.name;d.setMode(a).then(function(){angular.element("#container_mode_"+c).empty();h.clearObjectData(e,c)})};angular.element(z.b).scope().setFullScreen=function(a){b.info("setFullScreen",a);var c=$("#header_line").height();null==a||!0===a?"0px"===$("#header_line").css("margin-top")&&($("#header_line").animate({"margin-top":-c+"px"}),$("#works_line").animate({height:c+$("#works_line").height()+
"px"}),$(".popover").hide()):"0px"!==$("#header_line").css("margin-top")&&($("#header_line").animate({"margin-top":"0px"}),$("#works_line").animate({height:$("#works_line").height()-c+"px"}))};angular.element(z.b).scope().reloadSection=function(){b.info("reloadSection : "+d.sMode);d.setSectionForm(d.sMode,d.sId)};angular.element(z.b).scope().getProperty=function(a,c){b.info("getProperty : "+a);var d;-1!=a.indexOf(".")?eval("sValue = propertiesSrvc."+a):d=t[a];"undefined"!=typeof c&&("undefined"!=
typeof c.concatBefore&&(d=c.concatBefore+d),"undefined"!=typeof c.concatAfter&&(d+=c.concatAfter));return d};angular.element(z.b).scope().getPropertie=function(a){return angular.element(z.b).scope().getProperty(a)};z.compileProvider.directive("appSetBooleanIconColumn",function(){return{link:function(a,b,c){var d=c.$observe("appSetBooleanIconColumn",function(){var c;a.row.entity[a.col.field]?c="true-icon":a.row.entity[a.col.field]||(c="false-icon");b[0].className="ui-grid-cell-contents "+c});a.$on("$destroy",
function(){d()})}}});z.module.directive("appSetBooleanIconColumn",z.iJ);z.compileProvider.directive("appSetTrueIconColumn",function(){return{link:function(a,b,c){var d=c.$observe("appSetTrueIconColumn",function(){var c;a.row.entity[a.col.field]?c="true-icon":a.row.entity[a.col.field]||(c="");b[0].className="ui-grid-cell-contents "+c});a.$on("$destroy",function(){d()})}}});z.module.directive("appSetTrueIconColumn",z.jJ);angular.element(z.b).scope().modalWindow=function(a,c,d){b.info("modalWindow");
return y.modalWindow(a,c,d)};angular.element(z.b).scope().selectFirstOption=function(a,c){b.info("selectFirstOption");oFormValues=d.oFormValues[d.sFormDefinitionName];"undefined"==typeof oFormValues[a]&&(oFormValues[a]={options:[]});0==oFormValues[a].options.length&&!0===c&&oFormValues[a].options.push({label:"",value:""});oFormValues[a].selectedOption=oFormValues[a].options[0]};angular.element(z.b).scope().loadSection=function(){b.info("loadSection")};angular.element(z.b).scope().reloadSectionForm=
function(){b.info("reloadSectionForm")};angular.element(z.b).scope().refreshGridByEvent=function(a,c,e){b.info("refreshGridByEvent");if(null==z.oWebsocket)return null;var f=null!=t.minimum_refresh_period?1E3*t.minimum_refresh_period:1E4;if(null==a||null==c||null!=z.oWebsocket.oGridRefreshEvents[a]&&null!=z.oWebsocket.oGridRefreshEvents[a].events[c])return null;null!=z.oWebsocket.oGridRefreshEvents[a]||(z.oWebsocket.oGridRefreshEvents[a]={events:[],lastUpdateDate:(new Date).getTime()});null!=z.oWebsocket.oGridRefreshEvents[a].events[c]||
z.oWebsocket.oGridRefreshEvents[a].events.push(c);var g=this;z.oWebsocket.on("event",function(b){if(b.event!==c||d.oSelectedObject.name!==a)return null;var h=(new Date).getTime();if(h-z.oWebsocket.oGridRefreshEvents[a].lastUpdateDate<f)return null;if(null!=e){if(!e.call(this,b))return console.log("not loaded"),null;console.log("loaded")}z.oWebsocket.oGridRefreshEvents[a].lastUpdateDate=h;g.saveGridSelection(g.$root.gridApi[d.oSelectedObject.name].grid.appScope,g.$root.gridApi[d.oSelectedObject.name].grid.options);
g.$root.refreshGrid(g.$root.gridApi[d.oSelectedObject.name].grid.appScope,d.oGridOptions[d.oSelectedObject.name])})};angular.element(z.b).scope().resetForm=function(a){b.info("resetForm");a="undefined"==typeof a?d.oFormDefinition[d.sFormDefinitionName].name:d.oFormDefinition[a].name;angular.element("form[name='"+a+"']").scope()[a].$setPristine();document.querySelector("form[name='"+a+"']").reset()};angular.element(z.S).scope().editSectionForm=function(a){b.info("editSectionForm");var c="before"+Ma(d.oSelectedObject.name,
"_").replace(/_/g,"")+"Edition";if("undefined"!=typeof this[c])this[c](a);"undefined"==typeof a&&(a=d.sId);d.setSectionForm("update",a)};angular.element(z.S).scope().showSectionForm=function(a){b.info("showSectionForm");"undefined"==typeof a&&(a=d.sId);d.setSectionForm("display",a)};angular.element(z.S).scope().editDoubleForm=function(a){b.info("editDoubleForm");"undefined"==typeof a&&(a=d.sId);d.sSelectedTemplate="doubleFormTpl.html";d.sId=a;d.setMode("update",d.sTemplateFolder+d.sSelectedTemplate)};
angular.element(z.S).scope().showDoubleForm=function(a){b.info("showDoubleForm");"undefined"==typeof a&&(a=d.sId);d.sSelectedTemplate="doubleFormTpl.html";d.sId=a;d.setMode("display",d.sTemplateFolder+d.sSelectedTemplate)};angular.element(z.b).scope().showCredits=function(){b.info("showCredits");var a=this.$new();h.addScopeToObject(d.oSelectedObject.name,d.oSelectedMode.mode_id,a);c.get("conf/credits.json").success(function(c){"object"==typeof c&&(a.oCredits=c,a.modalWindow("dialog","CREDITS",{className:"dialog-modal-window",
message:'<div id="login_credits" class="login-credits"></div>'}),a.translationData={app_name:t.app_name,build:t.build,version:t.version,month_year:t.month_year},x("templates/creditsTpl.html").then(function(b){g($("#login_credits").html(b).contents())(a)}),b.info("compileObjectTemplate : templates/creditsTpl.html"))}).error(function(){})};angular.element(z.b).scope().setTagsInput=function(a){b.info("setTagsInput");var c,d;a.forEach(function(a){c=0;for(d=document.getElementById(a).parentNode.querySelectorAll(".tag");c<
d.length;)d[c].addEventListener("click",function(){this.querySelector("span[data-role='remove']").click()}),c++})};angular.element(z.S).scope().refreshGrid=function(a,c){b.info("refreshGrid");a.saveGridSelection(a,c);a.setGridPage(c.paginationCurrentPage,c.paginationPageSize,d.oGridOptions[d.oSelectedObject.name].aFilter,d.oGridOptions[d.oSelectedObject.name].oUrlParams)};angular.element(z.S).scope().saveGridSelection=function(a,c){b.info("saveGridSelection");a=c.appSelectedRows=a.$root.gridApi[a.sSelectedObjectName].selection.getSelectedRows();
if(0<a.length)for(var e=0,f=[];e<a.length;)f.push(a[e][d.oSelectedObject.sIdField]),e++;c.appSelectedRows=f};angular.element(z.S).scope().setGridFilter=function(){b.info("setGridFilter");d.oWorkspaceList[d.oSelectedObject.name].oValues=angular.copy(d.oFormValues[d.sFormDefinitionName]);for(var a,c=[],f,g=e.getFormData(d.sFormDefinitionName,!0),h=Object.keys(g),l=0;l<h.length;){f=e.getFormElementDefinition(h[l],d.sFormDefinitionName);a=g[h[l]];if("date"===f.type||"datetime"===f.type){var n=$("#"+f.id).data("DateTimePicker").date();
null!==n&&(a="date"===f.type?n.format("YYYY-MM-DD"):n.format("YYYY-MM-DD HH:mm:ss"))}if("undefined"!==typeof a&&""!==a.toString())if(p(a)&&-1!==a.indexOf("'")&&(a=a.replace(/'/g,"''")),null!=f.comparator)for(n=0;n<f.comparator.length;n++){var r="",r=null!=f.attrToCompare?null!=f.attrToCompare[n]?f.attrToCompare[n]:f.name:f.name,t=!0,t=null!=f.NaNForced?null!=f.NaNForced[n]?f.NaNForced[n]:isNaN(a):isNaN(a);switch(f.comparator[n]){case "LIKE":c.push('lower("'+r+"\") LIKE lower('%"+a+"%')");break;case "SQL":c.push(r.replace(/<VALUE_TO_REPLACE>/g,
a));break;default:t&&(a="'"+a+"'"),c.push(r+f.comparator[n]+a)}}else"text"==f.type?c.push('lower("'+h[l]+"\") LIKE lower('%"+a+"%')"):"date"==f.type||"datetime"==f.type?c.push(h[l]+"::text LIKE'%"+a+"%'"):("boolean"!=typeof a&&(a="'"+a+"'"),c.push(h[l]+"="+a));l++}var v={};"undefined"!=typeof d.oGridOptionsCopy[d.oSelectedObject.name].aFilter&&d.oGridOptionsCopy[d.oSelectedObject.name].aFilter.forEach(function(a){var b=a.split("="),c=!0;-1==h.indexOf(b[0])?h.forEach(function(a){-1!=b[0].indexOf("lower("+
a+")")&&(c=!1)}):c=!1;c&&(v[b[0]]=b[1])});c.forEach(function(a){a=a.split("=");"undefined"==typeof v[a[0]]&&(v[a[0]]=a[1])});var x=[];Object.keys(v).forEach(function(a){"undefined"==typeof v[a]?x.push(a):x.push(a+"="+v[a])});d.oGridOptions[d.oSelectedObject.name].aFilter=angular.copy(x);"search"==d.sMode&&(d.oWorkspaceList[d.oSelectedObject.name].aFilter=angular.copy(x));this.$root.$broadcast("aFilterLoaded_"+d.oSelectedObject.name,d.oGridOptions[d.oSelectedObject.name].aFilter);1==d.oGridOptions[d.oSelectedObject.name].paginationCurrentPage?
this.$root.gridApi[d.oSelectedObject.name].pagination.raise.paginationChanged(1,d.oGridOptions[d.oSelectedObject.name].paginationPageSize):d.oGridOptions[d.oSelectedObject.name].paginationCurrentPage=1};angular.element(z.S).scope().resetGridFilter=function(){b.info("resetGridFilter");for(var a=e.getFormData(d.sFormDefinitionName,!0),c=Object.keys(a),a=0;a<c.length;){var g=e.getFormElementDefinition(c[a],d.sFormDefinitionName);"date"!==g.type&&"datetime"!==g.type||angular.element("#"+g.id).data("DateTimePicker").clear();
a++}d.oFormValues[d.sFormDefinitionName]=angular.copy(d.oWorkspaceList[d.oSelectedObject.name].oDefaultValues);d.oGridOptionsCopy[d.oSelectedObject.name].aFilter=d.oDefaultGridOptions[d.oSelectedObject.name].aFilter;this.setGridFilter();f(function(){c.forEach(function(a){var b=e.getFormElementDefinition(a,d.sFormDefinitionName);"select"===b.type&&document.querySelectorAll("#"+b.id).forEach(function(b){"undefined"!=typeof b.options&&Array.from(b.options).forEach(function(b){var c=d.oFormValues[d.sFormDefinitionName][a];
b.selected=!1;"object"==typeof c&&"object"==typeof c.selectedOption&&b.value==c.selectedOption.value&&(b.selected=!0)})})})})};angular.element(z.S).scope().setPaginationStatus=function(){b.info("setPaginationStatus");var a=this,c;if(0<d.oGridOptions[d.oSelectedObject.name].totalItems){c="PAGINATION_STATUS";var e={totalItems:d.oGridOptions[d.oSelectedObject.name].totalItems,itemStart:(d.oGridOptions[d.oSelectedObject.name].paginationCurrentPage-1)*d.oGridOptions[d.oSelectedObject.name].paginationPageSize+
1};e.itemEnd=e.itemStart+d.oGridOptions[d.oSelectedObject.name].paginationPageSize-1;e.itemEnd>e.totalItems&&(e.itemEnd=e.totalItems)}else c="PAGINATION_STATUS_NO_ITEMS";l([c],e).then(function(b){a.sPaginationStatus=b[c]})};angular.element(z.S).scope().setGridPage=function(a,b,c,e){"number"!=typeof a&&(a=1);var f=angular.element(z.S).scope();a--;"undefined"==typeof e&&(e={});xb(e,{token:n.token,offset:a*b,limit:b});"undefined"==typeof c&&(c=[]);"undefined"!=typeof d.oSelectedObject.filter&&Array.prototype.push.apply(c,
d.oSelectedObject.filter);c=c.filter(function(a,b,c){return c.indexOf(a)==b});0<c.length?e.filter=c.join(" AND "):delete e.filter;a=d.getSectionWebServiceResourceId();var g=d.explodeWebServiceResourceId(a);a=r.all(t.services_alias+"/"+g[0]);"undefined"!=typeof d.oGridOptions[d.oSelectedObject.name].appBeforeEvent&&f.$root.$eval(d.oGridOptions[d.oSelectedObject.name].appBeforeEvent);a.customGET(g[1],e).then(function(a){if(1==parseInt(a.status)){var b=[];"undefined"!=typeof a[g[1]]&&(b=a[g[1]]);d.oGridOptions[d.oSelectedObject.name].data=
b;d.oGridOptions[d.oSelectedObject.name].totalItems=a.total_row_number;f.$root.setPaginationStatus();"undefined"!=typeof d.oGridOptions[d.oSelectedObject.name].appAfterEvent&&f.$root.$eval(d.oGridOptions[d.oSelectedObject.name].appAfterEvent);"undefined"!=typeof d.oGridOptions[d.oSelectedObject.name].appSelectedRows&&(f.$root.gridApi[d.oSelectedObject.name].grid.modifyRows(d.oGridOptions[d.oSelectedObject.name].data),b.forEach(function(a,b){-1!=d.oGridOptions[d.oSelectedObject.name].appSelectedRows.indexOf(a[d.oSelectedObject.sIdField])&&
f.$root.gridApi[d.oSelectedObject.name].selection.selectRow(d.oGridOptions[d.oSelectedObject.name].data[b])}))}})};angular.element(z.S).scope().formatGridColumn=function(a,c){b.info("formatGridColumn");for(var e=[],f,g=0;g<a.length;)"number"!=typeof a[g].width&&(a[g].width="50"),f={name:a[g].field_label,displayName:a[g].field_label,field:a[g].name,width:parseInt(a[g].width)+15,enableSorting:a[g].sortable,enableColumnResizing:a[g].resizeable,headerCellClass:c+"_"+a[g].name,cellClass:"cell-align-"+
a[g].align},null!=a[g].template&&(f.cellTemplate=a[g].template),f.field==d.oSelectedObject.sorted_by&&(f.sort={direction:v[d.oSelectedObject.sorted_dir],ignoreSort:!0,priority:0}),e.push(f),g++;return e};angular.element(z.S).scope().formatGridAction=function(a,c){b.info("formatGridAction");for(var d=[],e=0;e<a.length;)"string"===typeof a[e].event&&-1===a[e].event.indexOf("(")&&(a[e].event+="()"),d.push({label:Ma(a[e].button_label,""),event:a[e].event,name:c+"_"+a[e].button_class}),e++;return d};angular.element(z.S).scope().executeActionButtonEvent=
function(a,c){b.info("executeActionButtonEvent");angular.element(z.S).scope().$root[c](a.entity[d.oSelectedObject.sIdField])};angular.element(z.S).scope().DeleteSelection=function(a){b.info("DeleteSelection");var c=angular.element(z.S).scope(),e=c.$root.gridApi[d.oSelectedObject.name].selection.getSelectedRows();if(0<e.length){"undefined"==typeof a&&(a={});var f="LIST_DELETE_CONFIRM";"undefined"!=typeof a.sMessage&&(f=a.sMessage);c.$root.modalWindow("confirm","",{message:f,callback:function(b){if(b){var f=
0;b=[];var g;if("undefined"!=typeof a.aSelectedId)b=a.aSelectedId;else for(;f<e.length;)g=e[f][d.oSelectedObject.sIdField],isNaN(g)&&(g="'"+g+"'"),b.push(g),f++;0<b.length?(f=d.getSectionWebServiceResourceId(),f=d.explodeWebServiceResourceId(f),r.one(t.services_alias+"/"+f[0],f[1]).customDELETE("",{token:n.token,idList:b.join("|")}).then(function(a){if(1==a.status){if(1==d.oGridOptions[d.oSelectedObject.name].paginationCurrentPage?c.$root.gridApi[d.oSelectedObject.name].pagination.raise.paginationChanged(1,
d.oGridOptions[d.oSelectedObject.name].paginationPageSize):d.oGridOptions[d.oSelectedObject.name].paginationCurrentPage=1,a="after"+Ma(d.oSelectedMode.mode_id,"_").replace(/_/g,"")+"Removal","undefined"!=typeof c.$root[a])c.$root[a]()}else c.$root.modalWindow("dialog","LIST_DELETE_ERROR",{className:"modal-danger",message:a.errorMessage})})):(c.$root.gridApi[d.oSelectedObject.name].selection.clearSelectedRows(),c.$root.gridApi[d.oSelectedObject.name].core.refresh())}}})}};angular.element(z.b).scope().toGarbageCollection=
function(a){d.toGarbageCollection(a)};angular.element(z.b).scope().concatSelectAttributes=function(a,c){b.info("concatSelectAttributes");"undefined"==typeof c&&(c=" ");var e;a.split("|").forEach(function(a){e=d.oFormValues[d.sFormDefinitionName][a];sb(e)||sb(e.options)||e.options.forEach(function(a){""!=a.label&&""!=a.value&&(a.label=a.value+c+a.label)})})};angular.element(z.b).scope().workspaceTooltipPlacement=function(a){b.info("workspaceTooltipPlacement");return $(a).offset().left<window.innerWidth/
2?"right":"left"};angular.element(z.b).scope().hideAllModalWindow=function(){b.info("hideAllModalWindow");bootbox.hideAll()};angular.element(z.b).scope().addSelectEmptyOption=function(a){b.info("addSelectEmptyOption");oFormValues=d.oFormValues[d.sFormDefinitionName];"undefined"==typeof oFormValues[a]&&(oFormValues[a]={options:[]});oFormValues[a].options.unshift({label:"",value:""});if("undefined"==typeof oFormValues[a].selectedOption||"undefined"==typeof oFormValues[a].selectedOption.value)oFormValues[a].selectedOption=
oFormValues[a].options[0]};z.compileProvider.directive("appFormatDateColumn",function(){return{link:function(a,b,c){var d=c.$observe("appFormatDateColumn",function(){b[0].className+=" ui-grid-cell-contents";null!=a.row.entity[a.col.field]&&(b[0].innerHTML=moment(a.row.entity[a.col.field]).format("L LTS"))});a.$on("$destroy",function(){d()})}}});z.module.directive("appFormatDateColumn",z.hJ);angular.element(z.b).scope().getBooleanTranslation=function(c){b.info("getBooleanTranslation");var d=a.defer(),
e=d.promise;"boolean"==typeof c?l(["FORM_YES","FORM_NO"]).then(function(a){sTranslation=c?a.FORM_YES:a.FORM_NO;d.resolve(sTranslation)}):d.resolve(c);return e};angular.element(z.b).scope().loadSectionList=function(a){b.info("loadSectionList");var c=this.$root.$on("initWorkspaceList",function(b,e){c();b=d.sId;isNaN(b)&&(b="'"+b+"'");e.gridOptions={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:t.rows_per_page,enableColumnMenus:!1,
enableColumnResizing:!0,paginationPageSizes:[10,20,50,100,200,500],appHeader:!1,appHeaderTitleBar:!0,appHeaderSearchForm:!1,appHeaderOptionBar:!1,appLoadGridData:!0,appGridTitle:d.oSelectedObject.label,appResizeGrid:!1,appFooter:!0,appShowPagination:!0,appEnableDragAndDrop:!1,appDragAndDropEvent:{},appActions:[],aFilter:[d.oSelectedObject.sIdField+"="+b],appShowActions:!1};"undefined"!=typeof a&&xb(e.gridOptions,a);e.bLoadFormValues=!1})};angular.element(z.b).scope().getTabIdFieldValue=function(){b.info("getTabIdFieldValue");
return d.sId};angular.element(z.b).scope().setRadioTranslation=function(a){b.info("setRadioTranslation");angular.element(z.b).scope().$root.getBooleanTranslation(d.oFormValues[d.sFormDefinitionName][a]).then(function(b){d.oFormValues[d.sFormDefinitionName][a]=b})};angular.element(z.b).scope().cloneSectionForm=function(a){b.info("cloneSectionForm");var c=angular.copy(d.oFormValues[d.sFormDefinitionName]);if("undefined"!=typeof a)for(var e=0;e<a.length;e++)delete c[a[e]];this.AddSectionForm();var f=
this.$root.$on("formExtracted",function(a,b){b===d.sFormDefinitionName&&(f(),d.oFormValues[d.sFormDefinitionName]=angular.copy(c))})};angular.element(z.b).scope().copyFormElemContentToClipboard=function(a){b.info("copyFormElemContentToClipboard");var c=document.createElement("textarea");document.getElementsByTagName("body")[0].appendChild(c);c.innerHTML=d.oFormValues[d.sFormDefinitionName][a];c.select();document.execCommand("copy");document.getElementsByTagName("body")[0].removeChild(c)}});z.Xw=function(a,b,c,d,e,f,g,h){b.info("initLogs");f.oFormValues[f.sFormDefinitionName]={min_days_files:5};f.oFormDefaultValues[f.sFormDefinitionName]=angular.copy(f.oFormValues[f.sFormDefinitionName]);a.getFileContent=function(b,d){if("undefined"!=typeof b){var f=h.log_size;isNaN(f)&&(f=1024);d<1024*f?e.one(h.services_alias+"/vitis","logs").customGET(b.log_directory+"/file/"+b.name,{token:g.token,folder:b.folder}).then(function(d){1==d.status?(c.sLogContent=d.file,a.sLogPath=b.path,"undefined"!=typeof c.sLogContent&&
($("#logs-content-container").show(),c.resizeLogsContainer(),window.addEventListener("resize",c.resizeLogsContainer))):c.modalWindow("dialog","LOADING_FILE_ERROR_LOGS",{className:"modal-danger",message:d.errorMessage,appDuration:2E3})}):(a.sLogPath=b.path,$("#logs-content-container").show(),c.sLogContent="",d=$("#logs-content-container").height()-document.getElementById("logs-content-container").children[0].offsetHeight,document.getElementById("logs-content-container").children[1].style.height=d+
"px",c.modalWindow("dialog","FILE_TOO_BIG_LOGS",{className:"dialog-modal-window",appDuration:2E3}))}};a.deleteFile=function(a){null!=a&&e.one(h.services_alias+"/vitis","logs").customDELETE(a.log_directory+"/file/"+a.name,{token:g.token,folder:a.folder}).then(function(a){var b={};1==a.status?(d("DELETE_FILE_SUCCESS_LOGS").then(function(a){$.notify(a,"success")}),setTimeout(function(){c.loadTreeview()})):(b.className="modal-danger",b.message=a.errorMessage,c.modalWindow("dialog","DELETE_FILE_ERROR_LOGS",
b))})};c.resizeLogsContainer=function(){b.info("resizeLogsContainer");if("logs"==f.oSelectedMode.mode_id){var a=$("#logs-content-container").height()-document.getElementById("logs-content-container").children[0].offsetHeight;document.getElementById("logs-content-container").children[1].style.height=a+"px"}}};z.Xw.$inject="$rootScope $log $scope $translate Restangular envSrvc sessionSrvc propertiesSrvc".split(" ");z.module.controller("logsCtrl",z.Xw);z.yh=function(a,b,c,d){a.info("initWebsocketConfiguration");var e=this;this.$log=a;this.Af=b;this.ut=c;this.propertiesSrvc=d;this.lq=this.Lu=!1;b.sWebSocketUrl="wss://"+location.host+"/"+d.websocket_alias+"/";b.oServerInfos=null;z.oWebsocket.on("serverInfo",function(a){e.Af.$applyAsync(function(){e.lq=!1;e.Af.oServerInfos=a;e.Lu&&c(["WEBSOCKET_INFOS_REFRESHED_CONFIGURATION"]).then(function(a){$.notify(a.WEBSOCKET_INFOS_REFRESHED_CONFIGURATION,"success")})})})};
z.yh.$inject=["$log","$scope","$translate","propertiesSrvc"];z.yh.prototype.Zx=function(){this.$log.info("websocketConfigurationCtrl.reloadWebsocketStatus");var a=this;this.lq=this.Lu=!0;vx(z.oWebsocket,"serverInfo","","Status");setTimeout(function(){a.lq&&(a.ut(["WEBSOCKET_NO_SERVER_RESPONSE_CONFIGURATION"]).then(function(a){$.notify(a.WEBSOCKET_NO_SERVER_RESPONSE_CONFIGURATION,"error")}),a.Af.$applyAsync(function(){a.Af.oServerInfos=null}))},2E3)};z.yh.prototype.reloadWebsocketStatus=z.yh.prototype.Zx;
z.yh.prototype.fG=function(){this.$log.info("websocketConfigurationCtrl.refreshClients");vx(z.oWebsocket,"refreshClients","refreshClients");var a=this,b=!1;z.oWebsocket.on("connect",function(){b||setTimeout(function(){a.ut(["WEBSOCKET_USERS_RECONNECTED_CONFIGURATION"]).then(function(a){$.notify(a.WEBSOCKET_USERS_RECONNECTED_CONFIGURATION,"success")});setTimeout(function(){a.Zx()},1E3)},500);b=!0})};z.yh.prototype.refreshClients=z.yh.prototype.fG;z.module.controller("websocketConfigurationCtrl",z.yh);z.yz=function(a,b,c,d){a.info("initVersionConfiguration");b.getStateCssClass=function(a){return a?"install-state-ok":"install-state-error"};c.one(d.services_alias+"/vitis").customGET("Versions",{token:sessionStorage.session_token,app:sessionStorage.application}).then(function(a){1==a.status&&(a.VM_VERSION=d.version,a.VM_BUILD=d.build,b.oVersion=a,b.oVersion.neededUpdate=!0,"trunk"===d.version?delete b.oVersion.appVersion:null===b.oVersion.appVersion?b.oVersion.update="ERROR_RETRIEVE_UPDATE_CONFIGURATION":
(version=angular.copy(d.version).replace(".",""),versionUpdate=angular.copy(b.oVersion.appVersion).replace(".",""),versionUpdate>version?b.oVersion.update="NEEDED_UPDATE_CONFIGURATION":(b.oVersion.neededUpdate=!1,b.oVersion.update="NO_NEEDED_UPDATE_CONFIGURATION")))})};z.yz.$inject=["$log","$scope","Restangular","propertiesSrvc"];z.module.controller("versionConfigurationCtrl",z.yz);z.Gt=function(a,b,c,d,e,f,g,h){a.info("initActiveDirectoryTree");b.aTreeviewActiveDirectoryTree={};b.gridOptions={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:10,enableColumnMenus:!1,enableColumnResizing:!0,paginationPageSizes:[10,20,50,100],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!1,appLoadGridData:!1,data:[],columnDefs:[]};d("NAME_SEARCH_ACTIVE_DIRECTORY_USERS_USER ACCOUNT_SEARCH_ACTIVE_DIRECTORY_USERS_USER EMAIL_SEARCH_ACTIVE_DIRECTORY_USERS_USER AGENCY_SEARCH_ACTIVE_DIRECTORY_USERS_USER DEPARTMENT_SEARCH_ACTIVE_DIRECTORY_USERS_USER GROUP_SEARCH_ACTIVE_DIRECTORY_USERS_USER".split(" ")).then(function(a){b.gridOptions.columnDefs=
"person"==b.oActiveDirectoryParameters.sObject?[{name:a.NAME_SEARCH_ACTIVE_DIRECTORY_USERS_USER,displayName:a.NAME_SEARCH_ACTIVE_DIRECTORY_USERS_USER,field:"displayname",width:200,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"active_directory_"+f.oSelectedObject.name+"_name"},{name:a.ACCOUNT_SEARCH_ACTIVE_DIRECTORY_USERS_USER,displayName:a.ACCOUNT_SEARCH_ACTIVE_DIRECTORY_USERS_USER,field:"userprincipalname",width:200,enableSorting:!0,type:"string",enableColumnMoving:!0,
enableColumnResizing:!0,headerCellClass:"active_directory_"+f.oSelectedObject.name+"_login"},{name:a.EMAIL_SEARCH_ACTIVE_DIRECTORY_USERS_USER,displayName:a.EMAIL_SEARCH_ACTIVE_DIRECTORY_USERS_USER,field:"email",width:300,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"active_directory_"+f.oSelectedObject.name+"_email"},{name:a.AGENCY_SEARCH_ACTIVE_DIRECTORY_USERS_USER,displayName:a.AGENCY_SEARCH_ACTIVE_DIRECTORY_USERS_USER,field:"company",width:200,enableSorting:!0,
type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"active_directory_"+f.oSelectedObject.name+"_company"},{name:a.DEPARTMENT_SEARCH_ACTIVE_DIRECTORY_USERS_USER,displayName:a.DEPARTMENT_SEARCH_ACTIVE_DIRECTORY_USERS_USER,field:"department",width:200,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"active_directory_"+f.oSelectedObject.name+"_company"}]:[{name:a.GROUP_SEARCH_ACTIVE_DIRECTORY_USERS_USER,displayName:a.GROUP_SEARCH_ACTIVE_DIRECTORY_USERS_USER,
field:"name",width:400,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"active_directory_"+f.oSelectedObject.name+"_name"}]});d("BTN_IMPORT_SELECTION_"+f.oSelectedObject.name.toUpperCase()).then(function(a){f.oSelectedObject.actions=[{label:a,name:b.sSelectedObjectName+"_import_btn",event:"importAdSelection()"}];b.gridOptions.appActions=f.oSelectedObject.actions});b.sFormDefinitionName=f.oSelectedObject.name+"_search_form";b.oFormRequestParams={sUrl:"modules/vitis/forms/users/search_active_directory_"+
b.oActiveDirectoryParameters.sObject+".json"};b.$root.clearFormData(b.sFormDefinitionName,b);f.oFormValues[b.sFormDefinitionName]={};b.bLoadFormValues=!1;b.convertAdTreeToBootstrapTreeview=function(a){for(var c=[],d,e=0;e<a.length;)d={text:a[e].id.split(",")[0],branch:a[e].id},0<a[e].items.length&&(d.nodes=b.convertAdTreeToBootstrapTreeview(a[e].items)),c.push(d),e++;return c};b.loadAdTreeBranch=function(a){e.one(g.services_alias+"/vitis","ActiveDirectory").customGET(b.oActiveDirectoryParameters.sWebServicePath+
"/"+a,{domain_id:b.oLdap.sIdLdap,login:b.oLdap.sLoginLdap.split("@")[0],password:b.oLdap.sPwdLdap,token:h.token,object:b.oActiveDirectoryParameters.sObject}).then(function(a){1==a.status&&(b.gridOptions.data=f.extractWebServiceData("activedirectory",a)[0][b.oActiveDirectoryParameters.sWebServicePath.toLowerCase()])})};b.importAdSelection=function(){var a=b.$root.gridApi[b.sSelectedObjectName].selection.getSelectedRows();b.aSelection=angular.copy(a);for(var c=0,r=e.one(g.services_alias+"/vitis",b.oActiveDirectoryParameters.sWebServicePath.toLowerCase()),
t={token:h.token,domain_id:b.oLdap.sIdLdap,ldap_name:b.oLdap.sLdapName},v={"Content-Type":void 0};c<a.length;)t.action="importFromAd","person"==b.oActiveDirectoryParameters.sObject?(t.company=a[c].company,t.department=a[c].department,t.email=a[c].email,t.name=a[c].displayname,t.login=a[c].userprincipalname):t.name=a[c].name,r.customPOST(r,"",t,v).then(function(a){if(1==a.status)b.aSelection.shift(),0==b.aSelection.length&&(d("SUCCESFULL_IMPORTATION_"+f.oSelectedObject.name.toUpperCase()).then(function(a){$.notify(a,
"success")}),b.$root.gridApi[b.sSelectedObjectName].selection.clearSelectedRows());else{b.aSelection=[];var c={className:"modal-danger"};null!=a.errorMessage&&(c.message=a.errorMessage);b.modalWindow("alert","FORM_VALIDATION_ERROR",c)}}),c++};b.searchAdTree=function(){for(var a=c.defer(),d=a.promise,r=e.one(g.services_alias+"/vitis","ActiveDirectory"),t={domain_id:b.oLdap.sIdLdap,login:b.oLdap.sLoginLdap.split("@")[0],password:b.oLdap.sPwdLdap,token:h.token},v=f.oFormValues[b.sFormDefinitionName],
x=Object.keys(v),y=0;y<x.length;)""!=v[x[y]]&&(t[x[y]]=v[x[y]]),y++;r.customGET(b.oActiveDirectoryParameters.sWebServicePath,t).then(function(c){1==c.status&&(b.gridOptions.data=f.extractWebServiceData("activedirectory",c)[0][b.oActiveDirectoryParameters.sWebServicePath.toLowerCase()]);a.resolve()});return d}};z.Gt.$inject="$log $scope $q $translate Restangular envSrvc propertiesSrvc sessionSrvc formSrvc".split(" ");z.module.controller("activeDirectoryTreeCtrl",z.Gt);z.Hz=function(a,b,c){a.info("initWebServiceHelp");b.sUrlWebServiceDoc=c.web_server_name+"/"+c.doc_alias+"/index.phtml"};z.Hz.$inject=["$log","$scope","propertiesSrvc"];z.module.controller("webServiceHelpCtrl",z.Hz);z.cu=function(a){return{restrict:"A",controller:"logsCtrl",controllerAs:"ctrl",link:function(b){a(["FORM_BTN_DELETE_FILE_LOGS"]).then(function(a){a={title:a.FORM_BTN_DELETE_FILE_LOGS,placement:"bottom",trigger:"hover",container:"body"};angular.element("#btn_delete_log_file").tooltip(a)});b.$on("$destroy",function(){angular.element("#btn_delete_log_file").tooltip("destroy");window.removeEventListener("resize",b.resizeLogsContainer)})}}};z.cu.$inject=["$translate"];z.module.directive("appLogs",z.cu);
z.rA=function(){return{replace:!0,templateUrl:"templates/formTpl.html"}};z.module.directive("appLogsForm",z.rA);
z.du=function(a,b,c,d,e,f){return{link:function(g,h){g.loadTreeview=function(){$("#logs-content-container").hide();c.one(d.services_alias+"/vitis","Logs").customGET("",{token:f.token,application_name:sessionStorage.application}).then(function(b){1==b.status&&a(function(){b=b.tree;g.oSelectedLogFile={};g.aTreeviewLogs=b;$(h).treeview({showBorder:!1,expandIcon:"glyphicon glyphicon-folder-close",collapseIcon:"glyphicon glyphicon-folder-open",onNodeSelected:function(a,b){g.oSelectedLogFile=b;g.getFileContent(b,
b.size)},onNodeUnselected:function(){g.oSelectedLogFile=[]},highlightSelected:!0,multiSelect:!1,data:g.aTreeviewLogs.data})})})};g.deleteLogsHistory=function(){var a=e.oFormValues[e.sFormDefinitionName].min_days_files;b("DELETE_HISTORY_CONFIRM_LOGS",{min_days_files:a}).then(function(b){g.modalWindow("confirm","",{className:"modal-warning",message:b,callback:function(b){b&&c.one(d.services_alias+"/vitis","Logs").customDELETE("",{token:f.token,min_days:a}).then(function(){g.loadTreeview()})}})})};g.deleteLogFile=
function(a){g.modalWindow("confirm","",{className:"modal-warning",message:"DELETE_FILE_CONFIRM_LOGS",callback:function(b){b&&g.deleteFile(a)}})};g.loadTreeview();g.$on("$destroy",function(){$("#"+h[0].id).treeview("remove")})}}};z.du.$inject="$timeout $translate Restangular propertiesSrvc envSrvc sessionSrvc".split(" ");z.module.directive("appLogsTreeviewContainer",z.du);z.Cu=function(){return{restrict:"A",controller:"websocketConfigurationCtrl",controllerAs:"ctrl"}};z.appWebsocketConfigurationDrtv=z.Cu;z.module.directive("appWebsocketConfiguration",z.Cu);z.zu=function(){return{restrict:"A",controller:"versionConfigurationCtrl",controllerAs:"ctrl"}};z.appVersionConfigurationDrtv=z.zu;z.module.directive("appVersionConfiguration",z.zu);z.ku=function(a,b,c){return{link:function(d,e){a.info("initPhpInfoConfiguration");b.one(c.services_alias+"/vitis").customGET("Phpinfo",{token:sessionStorage.session_token}).then(function(a){if(1==a.status){var b=document.implementation.createHTMLDocument("phpinfo");b.documentElement.innerHTML=a.phpinfo;e[0].innerHTML=b.body.innerHTML}})}}};z.ku.$inject=["$log","Restangular","propertiesSrvc"];z.module.directive("appPhpInfo",z.ku);z.nA=function(){return{restrict:"A",controller:"activeDirectoryTreeCtrl",controllerAs:"ctrl",templateUrl:"templates/workspaceListTpl.html"}};z.module.directive("appActiveDirectoryFiles",z.nA);z.oA=function(){return{replace:!0,templateUrl:"templates/formTpl.html"}};z.module.directive("appActiveDirectoryTreeForm",z.oA);
z.Rt=function(a,b,c,d,e){return{link:function(f,g){g[0].id=f.sSelectedObjectName+"_treeview";a("TITLE_SECTION_"+d.oSelectedObject.name.toUpperCase()).then(function(a){document.querySelector("#container_mode_"+d.oSelectedMode.mode_id+" .double-form-title").textContent=a});b.one(c.services_alias+"/vitis","ActiveDirectory").customGET("Tree",{domain_id:f.oLdap.sIdLdap,login:f.oLdap.sLoginLdap.split("@")[0],password:f.oLdap.sPwdLdap,token:e.token,object:f.oActiveDirectoryParameters.sObject}).then(function(a){1==
a.status&&(a=d.extractWebServiceData("activedirectory",a)[0].tree,f.aTreeviewActiveDirectoryTree.data=f.convertAdTreeToBootstrapTreeview(a),f.oLdap.sDn=a[0].id.split(",").slice(1).join(","),$(g).treeview({showBorder:!1,expandIcon:"glyphicon glyphicon-plus",collapseIcon:"glyphicon glyphicon-minus",highlightSelected:!0,multiSelect:!1,levels:0,data:f.aTreeviewActiveDirectoryTree.data,onNodeSelected:function(a,b){f.loadAdTreeBranch(b.branch)}}))});f.$on("$destroy",function(){$("#"+g[0].id).treeview("remove")})}}};
z.Rt.$inject=["$translate","Restangular","propertiesSrvc","envSrvc","sessionSrvc"];z.module.directive("appActiveDirectoryTreeTreeviewContainer",z.Rt);z.Bu=function(){return{restrict:"A",controller:"webServiceHelpCtrl",controllerAs:"ctrl",link:function(a,b){Vd();b[0].onload=function(){var a=b[0].contentDocument.querySelector("header");a.parentNode.removeChild(a);Wd()}}}};z.appWebServiceHelpDrtv=z.Bu;z.module.directive("appWebServiceHelp",z.Bu);z.on("appMainDrtvLoaded",function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["Restangular"]),c=angular.element(z.b).injector().get(["envSrvc"]),d=angular.element(z.b).injector().get(["sessionSrvc"]),e=angular.element(z.b).injector().get(["propertiesSrvc"]);angular.element(z.Lb).scope().preventUserPasswordChanged=function(a){var b=angular.element(z.Lb).injector().get(["$q"]),c=angular.element(z.b).injector().get(["$log"]),d=angular.element(z.b).injector().get(["envSrvc"]),
e=angular.element(z.b).injector().get(["userSrvc"]);c.info("preventUserPasswordChanged");var f=b.defer(),b=f.promise,c=document.querySelector("form[name='"+d.oFormDefinition[d.sFormDefinitionName].name+"'] input[name='password']"),t=document.querySelector("form[name='"+d.oFormDefinition[d.sFormDefinitionName].name+"'] input[name='password_confirm']");null==d.oFormValues[d.sFormDefinitionName].domain&&""!==c.value?c.value!==t.value?(a={className:"modal-danger",appCallback:function(){f.reject()}},this.modalWindow("dialog",
"ERROR_PASSWORD_CONFIRM_USER_USER",a)):a||d.oFormValues[d.sFormDefinitionName].user_id===e.id?(a={className:"modal-warning",message:"UPDATE_PASSWORD_USER_USER",callback:function(a){a?f.resolve():f.reject()}},this.modalWindow("confirm","WARNING_PASSWORD_CHANGE_USER_USER",a)):f.resolve():f.resolve();return b};angular.element(z.Lb).scope().disconnectUserPasswordChanged=function(){var a=angular.element(z.b).injector().get(["envSrvc"]),b=angular.element(z.b).injector().get(["$log"]),c=angular.element(z.b).injector().get(["userSrvc"]);
b.info("disconnectUserPasswordChanged");if(null===a.oFormValues[a.sFormDefinitionName].domain){var b=document.querySelector("form[name='"+a.oFormDefinition[a.sFormDefinitionName].name+"'] input[name='password']"),d=document.querySelector("form[name='"+a.oFormDefinition[a.sFormDefinitionName].name+"'] input[name='password_confirm']");""!==b.value&&b.value===d.value&&a.oFormValues[a.sFormDefinitionName].user_id===c.id&&angular.element(z.Lb).injector().get(["sessionSrvc"]).disconnect()}};angular.element(z.b).scope().loadLogsJob=
function(){var a=angular.element(z.b).injector().get(["$log"]);angular.element(z.b).injector().get(["envSrvc"]).sMode="update";a.info("loadLogsJob")};angular.element(z.b).scope().loadConfiguration=function(){var a=angular.element(z.b).injector().get(["$log"]);angular.element(z.b).injector().get(["envSrvc"]).sMode="update";a.info("loadConfiguration")};angular.element(z.b).scope().setPropertiesFormValues=function(a){var b=angular.element(z.b).injector().get(["$log"]),c=angular.element(z.b).injector().get(["envSrvc"]),
d=angular.element(z.b).injector().get(["propertiesSrvc"]),e=angular.element(z.b).injector().get(["formSrvc"]);b.info("setPropertiesFormValues");if("undefined"===typeof c.oFormValues[c.sFormDefinitionName]||sb(c.oFormValues[c.sFormDefinitionName]))var f=this.$root.$on("formDefinitionLoaded",function(){f();var b=0,g,h=Object.keys(d);c.oFormValues[c.sFormDefinitionName]={log_directories:d.log_directories};Array.isArray(a)||(a=[]);for(a.forEach(function(a){c.oFormValues[c.sFormDefinitionName][a]=angular.copy(d[a])});b<
h.length;)g=e.getFormElementDefinition(h[b],c.sFormDefinitionName),"undefined"!==typeof g&&(c.oFormValues[c.sFormDefinitionName][h[b]]="select"===g.type?{selectedOption:{value:angular.copy(d[h[b]])}}:angular.copy(d[h[b]])),b++;b=parseInt(c.oFormValues[c.sFormDefinitionName].max_upload_file_size);"NaN"===b?b="":0<b&&(b=parseInt(b/1048576));c.oFormValues[c.sFormDefinitionName].max_upload_file_size=b;"undefined"!=typeof c.oFormValues[c.sFormDefinitionName].rows_per_page&&(c.oFormValues[c.sFormDefinitionName].rows_per_page.selectedOption.value=
String(c.oFormValues[c.sFormDefinitionName].rows_per_page.selectedOption.value));c.oFormDefaultValues[c.sFormDefinitionName]=angular.copy(c.oFormValues[c.sFormDefinitionName])})};angular.element(z.Lb).scope().testPublicConnection=function(){var a=this.$new(),b=angular.element(z.b).injector().get(["Restangular"]);angular.element(z.b).injector().get(["envSrvc"]);var c=angular.element(z.b).injector().get(["propertiesSrvc"]);angular.element(z.b).injector().get(["sessionSrvc"]);b.one(c.services_alias+
"/vitis","PrivateToken").customPOST(JSON.stringify({user:document.getElementById("configuration_vitis_configuration_general_update_form_public_login").value,password:document.getElementById("configuration_vitis_configuration_general_update_form_public_password").value}),"",{}).then(function(b){if(1===b.status){var c={className:"modal-success"};a.modalWindow("dialog","Connexion R\u00e9ussie",c)}else c={className:"modal-danger"},null!==b.errorMessage&&(c.message=b.errorMessage),a.modalWindow("alert",
"ERROR_BIND_ACTIVE_DIRECTORY_USERS_USER",c)})};angular.element(z.b).scope().loadUser=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["envSrvc"]),c=angular.element(z.b).injector().get(["userSrvc"]);a.info("loadUser");b.sId=c.id;a="before"+Ma(b.oSelectedObject.name,"_").replace(/_/g,"")+"Edition";this.$root[a]();angular.element(z.b).scope().loadSimpleForm()};z.yu=function(a){return{link:function(b,c,d){var e=d.$observe("appUserRoleColumn",function(d){if(null===
b.row.entity[b.col.field]||""===b.row.entity[b.col.field])c[0].className="";else{var e;"admin"===d?e="admin-role":"user"===d&&(e="user-role");c[0].className="ui-grid-cell-contents "+e;a(["USER_ROLE_TOOLTIP_TITLE_USERS_USER","USER_ROLE_ADMIN_TOOLTIP_CONTENT_USERS_USER","USER_ROLE_USER_TOOLTIP_CONTENT_USERS_USER"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:a.USER_ROLE_TOOLTIP_TITLE_USERS_USER,content:function(){var c="";"admin"===b.row.entity[b.col.field]?c=a.USER_ROLE_ADMIN_TOOLTIP_CONTENT_USERS_USER:
"user"===b.row.entity[b.col.field]&&(c=a.USER_ROLE_USER_TOOLTIP_CONTENT_USERS_USER);return c},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)}})})}});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};z.yu.$inject=["$translate"];z.compileProvider.directive("appUserRoleColumn",z.yu);angular.element(z.b).scope().hideExcludedUserPrivileges=function(a){var b=angular.element(z.b).injector().get(["$log"]),c=angular.element(z.b).injector().get(["$timeout"]),d=angular.element(z.b).injector().get(["envSrvc"]),
e=angular.element(z.b).injector().get(["userSrvc"]),f=angular.element(z.b).injector().get(["formSrvc"]);b.info("hideExcludedUserPrivileges");d.sId===e.id&&c(function(){for(var b=["vitis_admin","vitis_user"],c=f.getFormElementDefinition(a,d.sFormDefinitionName),e=d.oFormValues[d.sFormDefinitionName],g=[c.id,c.id_from],c=[a,c.name_from],h,l,n=0;n<g.length;){h=0;for(l=document.getElementById(g[n]);l.options.length>h;)l.options[h].style.display="",-1!==b.indexOf(l.options[h].text)&&(l.options[h].style.display=
"none",e[c[n]].options[h].disabled=!0),h++;n++}});null!=d.oFormValues[d.sFormDefinitionName].last_connection&&(d.oFormValues[d.sFormDefinitionName].last_connection=moment(d.oFormValues[d.sFormDefinitionName].last_connection).format("L LTS"))};angular.element(z.b).scope().ImportFromAd=function(a){var b=angular.element(z.b).injector().get(["$log"]),c=angular.element(z.S).injector().get(["$compile"]),d=angular.element(z.S).injector().get(["$templateRequest"]),e=angular.element(z.b).injector().get(["envSrvc"]);
angular.element(z.b).injector().get(["formSrvc"]);angular.element(z.b).injector().get(["modesSrvc"]);b.info("ImportFromAd");var f=this.$new();f.oActiveDirectoryParameters={sObject:a};f.oActiveDirectoryParameters.sWebServicePath="person"==a?"Users":"Groups";var t="form_active_directory_connection_"+e.oSelectedObject.name;f.modalWindow("dialog","TITLE_ACTIVE_DIRECTORY_CONNECTION",{className:"dialog-modal-window dialog-modal-window-ad-connection",message:'<div id="'+t+'"></div>'});f.sFormDefinitionName=
e.oSelectedObject.name+"_import_ad_form";e.sFormDefinitionName=f.sFormDefinitionName;f.oFormRequestParams={sUrl:"modules/vitis/forms/users/active_directory_connection.json"};f.$root.clearFormData(f.sFormDefinitionName,f);f.bLoadFormValues=!1;e.oFormValues[f.sFormDefinitionName]={};d("templates/formTpl.html").then(function(a){c($("#"+t).html(a).contents())(f)});b.info("compileObjectTemplate : templates/formTpl.html");var v=f.$root.$on("endFormNgRepeat",function(){v();var a=document.createElement("span");
a.id=e.sFormDefinitionName+"_login_domain";a.className="dialog-modal-window-login-domain";document.querySelector("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"'] .row:nth-child(2)").appendChild(a);var b=f.$root.$on("webServiceSelectOptionsloaded",function(){b();0==e.oFormValues[f.sFormDefinitionName].domain.options.length?document.querySelector("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"'] select[name='domain']").options.length=0:a.innerHTML="@"+e.oFormValues[f.sFormDefinitionName].domain.selectedOption.label});
document.querySelector("form[name='"+e.oFormDefinition[e.sFormDefinitionName].name+"'] select[name='domain']").addEventListener("change",function(){a.innerHTML="@"+this.selectedOptions[0].text})})};angular.element(z.b).scope().loadImportForm=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["$q"]),c=angular.element(z.S).injector().get(["$compile"]),d=angular.element(z.S).injector().get(["$templateRequest"]),e=angular.element(z.b).injector().get(["Restangular"]),
r=angular.element(z.b).injector().get(["envSrvc"]),t=angular.element(z.b).injector().get(["propertiesSrvc"]),v=angular.element(z.b).injector().get(["sessionSrvc"]),x=angular.element(z.b).injector().get(["modesSrvc"]);a.info("loadImportForm");var y=this;x.addScopeToObject(r.oSelectedObject.name,r.oSelectedMode.mode_id,y);y=y.$new();x.addScopeToObject(r.oSelectedObject.name,r.oSelectedMode.mode_id,y);var B=b.defer(),b=B.promise,E=r.oFormValues[y.sFormDefinitionName],I=des(E.login+"@"+E.domain.selectedOption.label,
E.password,1,0),e=e.one(t.services_alias+"/vitis","ActiveDirectory"),v={login:E.login,password:stringToHex(I),object:y.oActiveDirectoryParameters.sObject,token:v.token,domain_id:E.domain.selectedOption.value};e.customGET("Test",v).then(function(b){if(1===b.status)bootbox.hideAll(),y.oLdap=r.extractWebServiceData("activedirectory",b)[0],r.oSelectedObject={actions:[],columns:[],mode_id:r.oSelectedMode.mode_id,name:"active_directory_"+r.oSelectedObject.name,sections:"",template_name:"activeDirectoryTree",
aScope:r.oSelectedObject.aScope},x.getMode(r.oSelectedMode.mode_id).objects.push(r.oSelectedObject),x.addScopeToObject(r.oSelectedObject.name,r.oSelectedMode.mode_id,y),d("templates/doubleFormTpl.html").then(function(a){c($("#container_mode_"+r.oSelectedMode.mode_id).html(a).contents())(y)}),a.info("compileObjectTemplate : templates/doubleFormTpl.html"),B.resolve();else{y.aSelection=[];var e={className:"modal-danger"};null!==b.errorMessage&&(e.message=b.errorMessage);y.modalWindow("alert","ERROR_BIND_ACTIVE_DIRECTORY_USERS_USER",
e)}});return b};angular.element(z.b).scope().updateProperties=function(a){var b=angular.element(z.b).injector().get(["$log"]),c=angular.element(z.b).injector().get(["$translate"]),d=angular.element(z.b).injector().get(["$window"]),e=angular.element(z.b).injector().get(["Restangular"]),f=angular.element(z.b).injector().get(["envSrvc"]),t=angular.element(z.b).injector().get(["propertiesSrvc"]),v=angular.element(z.b).injector().get(["sessionSrvc"]),x=angular.element(z.b).injector().get(["formSrvc"]);
b.info("updateProperties");var y=this,b=e.one(t.services_alias+"/vitis/Properties",a),B={properties:x.getFormData(f.sFormDefinitionName,!0),module_name:a};b.customPUT(B,"",{token:v.token}).then(function(b){if(1===b.status){c("FORM_VALIDATION_OK").then(function(a){$.notify(a,"success")});if("vitis"===a&&t.language!==B.properties.language){var e={className:"modal-warning",message:"PAGE_RELOAD_CONFIRM_CONFIGURATION",callback:function(a){a&&d.location.reload()}};y.modalWindow("confirm","",e)}t.getFromServer()}else e=
{className:"modal-danger"},null!==b.errorMessage&&(e.message=b.errorMessage),y.modalWindow("alert","FORM_VALIDATION_ERROR",e)})};angular.element(z.b).scope().beforeUsersVitisUsersEdition=function(a){var b=angular.element(z.b).injector().get(["$log"]),c=angular.element(z.b).injector().get(["Restangular"]),d=angular.element(z.b).injector().get(["envSrvc"]),e=angular.element(z.b).injector().get(["formSrvc"]),f=angular.element(z.b).injector().get(["propertiesSrvc"]),t=angular.element(z.b).injector().get(["sessionSrvc"]);
b.info("beforeUsersVitisUsersEdition");var v=this.$root.$on("formDefinitionLoaded",function(b,g){v();if(null!=d.oFormValues[g].domain){b=e.getAllFormElementDefinition(g);for(var h=0;h<b.length;){switch(b[h].name){case "name":case "email":case "company":case "department":b[h].type="label";break;case "new_password_title":case "password":case "password_confirm":b[h].visible=!1;break;case "groups":case "privileges":f.mixed_rights_management||(b[h].visible=!1);break;case "active_directory_groups":b[h].visible=
!0;var l={token:t.token};c.one(f.services_alias+"/vitis","ActiveDirectory").customGET("UserGroups/"+a,l).then(function(a){1===a.status&&(d.oFormValues[g].active_directory_groups=a.activedirectory[0].adGroups,d.oFormValues[g].all_groups=a.activedirectory[0].allGroups)});break;case "all_groups":f.mixed_rights_management&&(b[h].visible=!0)}h++}}})};angular.element(z.b).scope().beforeUserVitisUserEdition=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["envSrvc"]),
c=angular.element(z.b).injector().get(["formSrvc"]);a.info("beforeUserVitisUserEdition");var d=this.$root.$on("formDefinitionLoaded",function(a,e){d();if(null!==b.oFormValues[e].domain)for(a=c.getAllFormElementDefinition(e),e=0;e<a.length;){switch(a[e].name){case "new_password_title":case "password":case "password_confirm":a[e].visible=!1}e++}})};angular.element(z.b).scope().beforeSendingDomainForm=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["envSrvc"]);
a.info("beforeSendingDomainForm");a=b.oFormValues[b.sFormDefinitionName];null!=a.login&&(-1===a.login.indexOf("@")&&(a.login+="@"+a.domain),null!=a.password&&"0x"!==a.password.substr(0,2)&&(b=des(a.login,a.password,1,0),a.password=stringToHex(b)))};angular.element(z.b).scope().getUsers2DomainFilter=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["propertiesSrvc"]);a.info("getUsers2DomainFilter");if(!b.mixed_rights_management)return"IS NULL"};angular.element(z.b).scope().isImgFile=
function(a){-1!==a.indexOf("?")&&(a=a.substr(0,a.indexOf("?")));a=a.split(".");return-1<["jpg","png","jpeg"].indexOf(a[a.length-1].toLowerCase())};z.pA=function(){return{replace:!0,template:'<div><img class="miniature_picture ui-grid-cell-contents" width="50" height="50" ng-src="{{urlToPicture}}" ng-hide="true"></img><span ng-show="responseHavePicture && !bFileIsPdf" ng-click="openViewer()" class="glyphicon glyphicon-picture grid-column-glyph-icon"></span><a ng-show="responseHavePicture && bFileIsPdf" ng-href="{{urlToPicture}}" target="_blank"><span class="glyphicon glyphicon-link grid-column-glyph-icon"></span></a></div>',
link:function(a,b,c){var d=c.$observe("file",function(){if(null===c.file||""===c.file)b[0].children[1].className="";if(null==c.path)console.error("Path attribute is not present on directive caller");else if(null==c.file)console.error("File attribute is not present on directive caller");else if(""!==c.file){null!=c.maxPopover?""===c.maxPopover?(console.warn("File attribute is an empty string (set with default value : 200)"),c.maxPopover=200):p(c.maxPopover)&&(c.maxPopover=parseInt(c.maxPopover)):(console.warn("maxPopover attribute is not present on directive caller (set with default value : 200)"),
c.maxPopover=200);null!=c.imgClass?p(c.imgClass)||(c.imgClass=""):c.imgClass="";null!=c.popoverClass?p(c.popoverClass)||(c.popoverClass=""):c.popoverClass="";a.oProperties=angular.element("#works_line").scope().oProperties;a.path=null!=a[c.path]?a[c.path]:c.path;a.urlToPicture=a.oProperties.web_server_name+"/"+a.oProperties.public_alias+"/"+a.path+"/"+c.file;/^https?:\/\//.test(c.file)&&(a.urlToPicture=c.file);var e=b.find("img");e[0].onerror=function(){console.error("Fail to load image",c.file)};
e[0].onload=function(){a.$applyAsync(function(){a.responseHavePicture=!0})};a.bFileIsPdf=!a.$root.isImgFile(c.file);b[0].parentNode.style.textAlign="center";a.bFileIsPdf||(null===c.file||""===c.file?b[0].children[1].className="":(e={inline:!1,button:!0,navbar:!1,title:2,toolbar:2,tooltip:!0,fullscreen:!1,url:function(){return a.urlToPicture}},null!=a.viewer?a.viewer.update():a.viewer=new Viewer(b[0].children[0],e),a.openViewer=function(){a.viewer.show();angular.element(".viewer-prev").remove();angular.element(".viewer-next").remove()},
$(b[0].children[1]).popover({trigger:"hover",container:"body",title:"",content:function(){var b=document.createElement("img");b.src=a.urlToPicture;var d=c.maxPopover,e=b.naturalWidth,f=b.naturalHeight,d=e<f?f/d:e/d;b.width=0<d?e/d:e;b.height=0<d?f/d:f;b.className=c.imgClass;return b.outerHTML},html:!0,template:'<div class="popover '+c.popoverClass+' " role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),a.$on("$destroy",function(){$(b[0].children[1]).popover("destroy");
a.viewer.destroy();d()})))}})}}};z.compileProvider.directive("appDocumentViewer",z.pA);z.$t=function(a){return{replace:!1,template:'<a ng-click="goToItem()">{{itemData}}</a>',link:function(b,c,d){var e=angular.element(z.S).injector().get(["envSrvc"]),f=d.$observe("itemData",function(){null==(d.itemData||""===d.itemData)&&(console.warn("No data display in column"),d.itemData="");null==(d.mode||""===d.mode)&&(console.warn("No mode selected (set to 'update' as default value)"),d.mode="update");null!=
d.object?""===d.object?console.error("objet name is empty"):null!=d.fieldToSelect?""===d.fieldToSelect?console.error("fieldToSelect name is empty"):(console.log(d),b.itemData=d.itemData,b.goToItem=function(){angular.element("#object_column").scope().selectObject(d.object,void 0,{});a(function(){e.setSectionForm(d.mode,d.fieldToSelect)},800)},b.$on("$destroy",function(){f()})):console.error("No fieldToSelect define"):console.error("No object define")})}}};z.$t.$inject=["$timeout"];z.compileProvider.directive("appLinker",
z.$t);angular.element(z.b).scope().setWorkObject=function(a,b){var c=angular.element(z.S).injector().get(["$log"]),d=angular.element(z.S).injector().get(["$http"]),e=angular.element(z.b).injector().get(["propertiesSrvc"]),f=angular.element(z.S).scope(),g=angular.element(z.S).injector().get(["envSrvc"]);angular.element(z.b).scope();var v=angular.element(z.b).scope().oWorkObjects[a][b].config;if(-1===sessionStorage.application_modules.split(",").indexOf(a))return 0;c.info("setWorkObject for module : "+
a+" on Object "+b);var x=f.$root.gridApi[g.oSelectedObject.name].selection.getSelectedRows();if(!fa(x))return console.error("aSelectedRows is not an array"),0;if(1!==x.length)return bootbox.alert("<h4>Veuillez s\u00e9lectionner un(e) unique "+b+"</h4>"),0;c={token:sessionStorage.session_token,user_id:sessionStorage.user_id};c[v.sFieldId]=x[0][v.sFieldId];d({method:"POST",url:e.web_server_name+"/"+e.services_alias+"/"+v.sWebService,params:c}).then(function(c){m(c.data)||(bootbox.alert("<h4>Erreur lors de la d\u00e9finition du "+
b+" de travail</h4>"),console.error("response: ",c));m(c.data.errorMessage)&&(bootbox.alert("<h4>Erreur lors de la d\u00e9finition du "+b+" de travail</h4><br>"+c.data.errorType+"<br>"+c.data.errorMessage),console.error("response: ",c));angular.element(z.S).scope().refreshGrid(f,g.oGridOptions[g.oSelectedObject.name]);angular.element("#"+v.sIdButtonLock).prop("disabled",!0);angular.element("#"+v.sIdButtonUnlock).prop("disabled",!1);angular.element(z.b).scope().oWorkObjects[a][b].value=x[0][v.sFieldId]},
function(a){bootbox.alert("<h4>Erreur lors de la d\u00e9finition du "+b+" de travail:</h4><br>"+a);console.error("response: ",a)})};z.xu=function(){return{link:function(a,b,c){var d=c.$observe("text",function(){m(c.text)&&""!==c.text?(b[0].className="ui-grid-cell-contents info-icon",$(b).popover({trigger:"hover",container:"body",title:c.title,content:function(){return c.text},html:"html"===c.mode,placement:function(b,c){return a.$root.workspaceTooltipPlacement(c)}})):b[0].className="";a.$on("$destroy",
function(){$(b).popover("destroy");d()})})}}};z.xu.$inject=["$translate"];z.compileProvider.directive("appTextPopoverDisplay",z.xu);z.ju=function(){return{replace:!0,template:'<div class="progress" style="margin: 5px 10px 10px;"><div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width:{{row.entity[col.field]}}%">{{textValue}}</div></div>',link:function(a,b,c){a.XJ=null!=c.hidevalue?"":a.TJ.tJ[a.pJ.vJ]+"%";null!=c.mode&&(b[0].firstChild.className=
b[0].firstChild.className+" progress-bar-"+c.mode);null!=c.striped&&(b[0].firstChild.className+=" progress-bar-striped",null!=c.active&&(b[0].firstChild.className+=" active"))}}};z.ju.$inject=["$translate"];z.compileProvider.directive("appNavbar",z.ju);angular.element(z.b).scope().clearWorkObject=function(a,b){var c=angular.element(z.S).injector().get(["$log"]),d=angular.element(z.S).injector().get(["$http"]),e=angular.element(z.b).injector().get(["propertiesSrvc"]),f=angular.element(z.S).scope(),
g=angular.element(z.S).injector().get(["envSrvc"]);angular.element(z.b).scope();var v=angular.element(z.b).scope().oWorkObjects[a][b].config;if(-1===sessionStorage.application_modules.split(",").indexOf(a))return 0;c.info("clearWorkPost for module : "+a+" on Object "+b);d({method:"DELETE",url:e.web_server_name+"/"+e.services_alias+"/"+v.sWebService+"/"+sessionStorage.user_id,params:{token:sessionStorage.session_token}}).then(function(c){m(c.data)||(bootbox.alert("<h4>Erreur lors de la lib\u00e9ration du "+
b+" de travail</h4>"),console.error("response: ",c));m(c.data.errorMessage)&&(bootbox.alert("<h4>Erreur lors de la lib\u00e9ration du "+b+" de travail</h4><br>"+c.data.errorType+"<br>"+c.data.errorMessage),console.error("response: ",c));angular.element(z.S).scope().refreshGrid(f,g.oGridOptions[g.oSelectedObject.name]);angular.element("#"+v.sIdButtonLock).prop("disabled",!1);angular.element("#"+v.sIdButtonUnlock).prop("disabled",!0);angular.element(z.b).scope().oWorkObjects[a][b].value=!1},function(a){bootbox.alert("<h4>Erreur lors de la lib\u00e9ration du "+
b+" de travail:</h4><br>"+a);console.error("response: ",a)})};angular.element(z.b).scope().initWorkObject=function(a,b,c){null!=angular.element(z.b).scope().oWorkObjects||(angular.element(z.b).scope().oWorkObjects={});angular.element(z.b).scope().oWorkObjects[a]={};angular.element(z.b).scope().oWorkObjects[a][b]={};angular.element(z.b).scope().oWorkObjects[a][b].value=!1;angular.element(z.b).scope().oWorkObjects[a][b].config=c};angular.element(z.b).scope().getWorkObject=function(a,b){return angular.element(z.b).scope().oWorkObjects[a][b].value};
angular.element(z.b).scope().lookWorkObjectIsAlreadyLock=function(a,b){var c=angular.element(z.S).injector().get(["$http"]),d=angular.element(z.b).injector().get(["propertiesSrvc"]),e=angular.element(z.b).scope().oWorkObjects[a][b].config;c({method:"GET",url:d.web_server_name+"/"+d.services_alias+"/"+e.sWebService,params:{token:sessionStorage.session_token,filter:"user_id="+sessionStorage.user_id,distinct:!0}}).then(function(c){m(c.data)||(bootbox.alert("<h4>Erreur lors de la d\u00e9finition du "+
b+"</h4>"),console.error("response: ",c));m(c.data.errorMessage)&&(bootbox.alert("<h4>Erreur lors de la d\u00e9finition du "+b+"</h4><br>"+c.data.errorType+"<br>"+c.data.errorMessage),console.error("response: ",c));1===c.data.list_count?(angular.element(z.b).scope().oWorkObjects[a][b].value=c.data.data[0][e.sFieldId],angular.element("#"+e.sIdButtonLock).prop("disabled",!0),angular.element("#"+e.sIdButtonUnlock).prop("disabled",!1)):(angular.element("#"+e.sIdButtonLock).prop("disabled",!1),angular.element("#"+
e.sIdButtonUnlock).prop("disabled",!0))},function(a){bootbox.alert("<h4>Erreur lors de la r\u00e9cup\u00e9ration du "+b+":</h4><br>"+a);console.error("response: ",a)})};angular.element(z.b).scope().loadHelp=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.S).injector().get(["envSrvc"]);a.info("loadHelp");b.sMode="update"};angular.element(z.b).scope().$q=function(){var a=angular.element(z.S).injector().get(["$http"]),b=angular.element(z.b).scope();a.get("modules/vitis/data/proj.json").success(function(a){b.proj=
a}).error(function(a,b){console.error("ERROR : (AJAX request : "+b+" ) On loading Projections, contact Veremes please")})};angular.element(z.b).scope().$q();angular.element(z.b).scope().deleteUsers=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["envSrvc"]),c=angular.element(z.b).injector().get(["userSrvc"]);a.info("deleteUsers");var d=angular.element(z.S).scope();d.$root.gridApi[b.oSelectedObject.name].selection.getSelectedRows().forEach(function(a){a.user_id==
c.id&&d.$root.gridApi[b.oSelectedObject.name].selection.unSelectRow(a)});d.$root.DeleteSelection()};angular.element(z.b).scope().hideCurrentUserFromExcludedPrivileges=function(a){var b=angular.element(z.b).injector().get(["$log"]),c=angular.element(z.b).injector().get(["$timeout"]),d=angular.element(z.b).injector().get(["envSrvc"]),e=angular.element(z.b).injector().get(["userSrvc"]),f=angular.element(z.b).injector().get(["formSrvc"]);b.info("hideCurrentUserFromExcludedPrivileges");-1!=["vitis_admin",
"vitis_user"].indexOf(d.sId)&&c(function(){for(var b=f.getFormElementDefinition(a,d.sFormDefinitionName),c=d.oFormValues[d.sFormDefinitionName],g=[b.id,b.id_from],b=[a,b.name_from],h,l,n=0;n<g.length;){h=0;for(l=document.getElementById(g[n]);l.options.length>h;)l.options[h].style.display="",e.id==l.options[h].value&&(l.options[h].style.display="none",c[b[n]].options[h].disabled=!0),h++;n++}})};angular.element(z.b).scope().loadModes=function(){var a=angular.element(z.b).injector().get(["$log"]),b=
angular.element(z.b).injector().get(["$translate"]),c=angular.element(z.S).injector().get(["envSrvc"]);a.info("loadModes");var d=this,a=document.getElementById("container_section_"+c.oSelectedObject.name+"_modes");a.className+=" section-container-workspace-list";d.gridOptions={enableRowSelection:!0,enableSelectAll:!1,enablePagination:!1,enablePaginationControls:!1,multiSelect:!1,useExternalPagination:!0,paginationPageSize:999,enableColumnMenus:!1,enableColumnResizing:!1,appHeader:!0,appHeaderTitleBar:!0,
appHeaderSearchForm:!1,appHeaderOptionBar:!1,appLoadGridData:!0,appGridTitle:"LIST_TITLE_GRID_MODES",appFooter:!1,appShowPagination:!1,appEnableDragAndDrop:!0,appDragAndDropEvent:{rowFinishDrag:"updateModesSorting"},appActions:[],oUrlParams:{action:"getAll",distinct:!0,order_by:"index",sort_order:"ASC"}};d.bLoadFormValues=!1;b(["LIST_MODE_ICONE_MODE_CONFIGURATION","LIST_MODE_ID_MODE_CONFIGURATION"]).then(function(a){d.gridOptions.columnDefs=[{name:a.LIST_MODE_ID_MODE_CONFIGURATION,displayName:a.LIST_MODE_ID_MODE_CONFIGURATION,
field:"mode_id",width:300,enableSorting:!1,type:"string",enableColumnMoving:!1,enableColumnResizing:!1,headerCellClass:"vitis_mode_"+c.oSelectedObject.name+"_mode_id"},{name:a.LIST_MODE_ICONE_MODE_CONFIGURATION,displayName:a.LIST_MODE_ICONE_MODE_CONFIGURATION,field:"mode_id",width:50,enableSorting:!1,type:"number",enableColumnMoving:!1,enableColumnResizing:!1,headerCellClass:"vitis_mode_"+c.oSelectedObject.name+"_index",cellClass:"cell-align-center",cellTemplate:'<div style="font-size:16px;color:#9a9a9a;margin-top:5px;vertical-align:middle" class="icon-{{row.entity[col.field]}}"></div>'}]})};
angular.element(z.b).scope().updateModesSorting=function(){a.info("updateMapLayerSorting");for(var f=this,g={token:d.token},h=c.oGridOptions[c.oSelectedObject.name],l=0,n=[];l<h.data.length;)n.push(h.data[l].mode_id),l++;g.modes_id=n.join("|");b.one(e.services_alias+"/vitis","modes").customPUT(g,"sorting",{token:d.token}).then(function(a){0===a.status&&f.modalWindow("dialog","ERROR_ADD_MAP_LAYERS_VMAP_MAP_MAP_LAYERS",{className:"modal-danger",message:a.errorMessage})})};angular.element(z.b).scope().reloadWebsocketStatus=
function(){function a(){if(!(10<b)){var c=angular.element($('[data-app-websocket-configuration=""]')).scope();null!=c?null!=c.ctrl?angular.element($('[data-app-websocket-configuration=""]')).scope().ctrl.reloadWebsocketStatus():setTimeout(function(){a()},500):setTimeout(function(){a()},500);b++}}var b=0;setTimeout(function(){a()})}});function xx(){return{restrict:"A",controller:"AppImportBoController",controllerAs:"ctrl",bindToController:!0,templateUrl:window.oClientProperties.vmap_folder+"/template/vitis/importBo.html",link:function(a,b){$(b).find(".file").fileinput({showUpload:!1,showPreview:!1,mainClass:"input-group-sm"});a.refreshCodeMirror=function(){setTimeout(function(){$(b).find(".CodeMirror").each(function(a,b){b.CodeMirror.refresh()})});setTimeout(function(){$(b).find(".CodeMirror").each(function(a,b){b.CodeMirror.refresh()})},
500);setTimeout(function(){$(b).find(".CodeMirror").each(function(a,b){b.CodeMirror.refresh()})},1E3)}}}}ta("nsVmap.importBoDrtv",xx);C.module.directive("appImportBo",xx);function yx(a,b,c,d,e){b.info("nsVmap.importBoCtrl");this.la=b;this.f=a;this.V=c;this.ua=d;this.Kp=e;this.uo=angular.element(z.b).scope();this.oProperties=angular.element(z.b).injector().get(["propertiesSrvc"]);this.sToken=sessionStorage.session_token;this.oTranslations={};this.yk=[];this.EG=new RegExp(/^([a-zA-Z0-9_]*)$/);a.displayedStep="import_folder";a.oImportedBo=null;a.usedDatabase=null;a.usedSchema=null;a.oCoordsys=null;a.sSql="";a.aDatabases=[];a.aSchemas=[];a.aCoordsys=[];a.aConnections=
null;a.aWmsServices=null;a.aVmapServices=null;a.creatingNewSchema="";a.selectedExistingSchema="";a.oBoDef=null;a.oEventDef=null;a.aReportsDef=null;a.aLayersDef=[];a.oBoForm=null;a.oEventForm=null;a.oReportForm=null;a.oImportSteps={test:null,business_object:null,business_object_reports:null,business_object_events:null,layers:null,sql:null};a.oTestSteps={business_objet:null,reports:null,event:null,layers:null,schema:null,tables:null};a.bImportOk=!1;a.steps="import_folder select_database import_schema import_coordsys import_sql import_layers import_bo execute_import finalize".split(" ");
a.steps_trads={import_folder:"Import",select_database:"Base de donn\u00e9es",import_schema:"Schema",import_coordsys:"Coordsys",import_sql:"SQL",import_layers:"Couches",import_bo:"Objet M\u00e9tier",execute_import:"Execution",finalize:"Fin"};zx(this)}ta("nsVmap.importBoCtrl",yx);yx.$inject=["$scope","$log","$http","$q","$translate"];
yx.prototype.zH=function(a){this.la.info("nsVmap.importBoCtrl.submitStep");var b=this;switch(a){case "import_folder":Ax(this);break;case "select_database":Bx(this).then(function(){b.Wg()});break;case "import_schema":Cx(this).then(function(){b.Wg()});break;case "import_coordsys":Dx(this).then(function(){b.Wg()});break;case "import_layers":Ex(this).then(function(){console.log("nextStep!!!");b.Wg()});break;case "import_bo":Fx(this);Gx(this).then(function(a){!0===a?b.Wg():Hx(b)});break;default:this.Wg()}};
yx.prototype.submitStep=yx.prototype.zH;yx.prototype.Wg=function(){this.la.info("nsVmap.importBoCtrl.nextStep");var a=angular.copy(this.f.displayedStep),a=this.f.steps.indexOf(a);if(-1!==a)if(null!=this.f.steps[a+1])a=this.f.steps[a+1];else return console.error("next step doesn't exists"),null;else return console.error("this step doesn't exists"),null;this.hr(a)};yx.prototype.nextStep=yx.prototype.Wg;
yx.prototype.PF=function(){this.la.info("nsVmap.importBoCtrl.prevStep");var a=angular.copy(this.f.displayedStep),a=this.f.steps.indexOf(a);if(-1!==a)if(null!=this.f.steps[a-1])a=this.f.steps[a-1];else return console.error("previous step doesn't exists"),null;else return console.error("this step doesn't exists"),null;this.hr(a)};yx.prototype.prevStep=yx.prototype.PF;
yx.prototype.hr=function(a){this.la.info("nsVmap.importBoCtrl.goStep");var b=this;switch(a){case "select_database":Ix(this).then(function(){b.f.displayedStep=a});break;case "import_schema":Jx(this).then(function(){b.f.displayedStep=a});break;case "import_coordsys":Kx(this).then(function(){b.f.displayedStep=a});break;case "import_sql":this.la.info("nsVmap.importBoCtrl.loadSql_");this.f.codemirrorSQLOptions={styleActiveLine:!0,indentWithTabs:!0,lineWrapping:!0,lineNumbers:!0,readOnly:!1,mode:"sql",
tabSize:2,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]};this.f.sSql="";-1===this.f.aSchemas.indexOf(this.f.usedSchema)&&0<this.f.usedSchema.length&&(this.f.sSql+="\n--",this.f.sSql+="\n-- Creation Schema",this.f.sSql+="\n--",this.f.sSql+="\n",this.f.sSql+="\nCREATE SCHEMA [TABLE_SCHEMA] AUTHORIZATION u_vitis;",this.f.sSql+="\nGRANT ALL ON SCHEMA [TABLE_SCHEMA] TO u_vitis;",this.f.sSql+="\n",this.f.sSql+="\n");null!=this.f.oImportedBo&&null!=this.f.oImportedBo.sql&&null!=
this.f.oImportedBo.sql.table&&(this.f.sSql+=this.f.oImportedBo.sql.table);this.f.displayedStep=a;break;case "import_layers":Lx(this).then(function(){b.f.displayedStep=a});break;case "import_bo":Hx(this);this.f.displayedStep=a;break;case "execute_import":this.f.oImportSteps={test:null,business_object:null,business_object_reports:null,business_object_events:null,layers:null,sql:null};this.f.oTestSteps={business_objet:null,reports:null,event:null,layers:null,schema:null,tables:null};this.f.displayedStep=
a;break;default:this.f.displayedStep=a}};yx.prototype.goStep=yx.prototype.hr;yx.prototype.dH=function(a,b){this.la.info("nsVmap.importBoCtrl.setUsedSchema");b?this.f.selectedExistingSchema="":this.f.creatingNewSchema="";this.f.usedSchema=null!=this.f.creatingNewSchema&&""!==this.f.creatingNewSchema||null!=this.f.selectedExistingSchema&&""!==this.f.selectedExistingSchema?a:null};yx.prototype.setUsedSchema=yx.prototype.dH;
yx.prototype.OB=function(a){this.la.info("nsVmap.importBoCtrl.executeImport");var b=this;this.f.bImportOk=!1;this.f.oImportSteps={test:null,business_object:null,business_object_reports:null,business_object_events:null,layers:null,sql:null};Ua(this.yk);this.f.oImportSteps.test=!1;Mx(this).then(function(c){if(!0===c){b.f.oImportSteps.test=!0;if(a)return null;Nx(b).then(function(a){!0===a?(b.f.oImportSteps.business_object=!0,Ox(b).then(function(a){!0===a?(b.f.oImportSteps.business_object_reports=!0,
Px(b).then(function(a){!0===a?(b.f.oImportSteps.business_object_events=!0,Qx(b).then(function(a){!0===a?(b.f.oImportSteps.layers=!0,Rx(b).then(function(a){!0===a?(b.f.oImportSteps.sql=!0,b.f.bImportOk=!0):(b.gj(),b.f.oImportSteps.sql=!1)})):(b.gj(),b.f.oImportSteps.layers=!1)})):(b.gj(),b.f.oImportSteps.business_object_events=!1)})):(b.gj(),b.f.oImportSteps.business_object_reports=!1)})):(b.gj(),b.f.oImportSteps.business_object=!1)})}else b.f.oImportSteps.test=!1})};yx.prototype.executeImport=yx.prototype.OB;
yx.prototype.gj=function(){function a(){c--;0<=c&&Sx(b,b.yk[c].sRessource,b.yk[c].sId).then(function(){a()})}this.la.info("nsVmap.importBoCtrl.cancelImport");var b=this,c=this.yk.length;a()};yx.prototype.cancelImport=yx.prototype.gj;yx.prototype.YA=function(){this.la.info("nsVmap.importBoCtrl.closeImportModal");$(".bootbox.modal").each(function(){$(this).modal("hide")});this.uo.setMode("development")};yx.prototype.closeImportModal=yx.prototype.YA;
function zx(a){for(var b=[],c=0;c<a.f.steps.length;c++)b.push("CTRL_IMPORT_BO_STEP_"+a.f.steps[c]);b.push("CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END");b.push("CTRL_IMPORT_BO_ERROR_SELECT_FOLDER");b.push("CTRL_IMPORT_BO_ERROR_NO_FOLDER_RESULT");b.push("CTRL_IMPORT_BO_ERROR_NO_DB_CONNECTION");b.push("CTRL_IMPORT_BO_ERROR_NO_DB_VALID");b.push("CTRL_IMPORT_BO_ERROR_NO_SCHEMA_VALID");b.push("CTRL_IMPORT_BO_ERROR_NO_COORDSYS_VALID");b.push("CTRL_IMPORT_BO_ERROR_NO_VALID_LAYER_1");b.push("CTRL_IMPORT_BO_ERROR_NO_VALID_LAYER_2");
b.push("CTRL_IMPORT_BO_ERROR_NO_COMPLETE_OBJECT");b.push("CTRL_IMPORT_BO_ERROR_OBJECT_ALREADY_EXISTS");b.push("CTRL_IMPORT_BO_ERROR_NO_DEFINED_SCHEMA");b.push("CTRL_IMPORT_BO_ERROR_NO_TABLES_TO_IMPORT");b.push("CTRL_IMPORT_BO_ERROR_TABLE_ALREADY_PRESENT");b.push("CTRL_IMPORT_BO_ERROR_NO_DEFINED_SCHEMA");b.push("CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1");b.push("CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_IMPORT");b.push("CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_ASSOCIATE_LAYER");b.push("CTRL_IMPORT_BO_ERROR_REMOVE_ERROR");
a.Kp(b).then(function(b){a.oTranslations=b})}
function Ax(a){a.la.info("nsVmap.importBoCtrl.importFolder_");var b=$("#import-bo-folder-input").prop("files");if(null==b[0])$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_SELECT_FOLDER,"error");else{var c=new FormData;c.append("package_definition",b[0]);a.V({method:"POST",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vmap/businessobjects/package_definition",data:c,params:{token:a.sToken}}).then(function(b){if(null==b.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error"),
null;if(null!=b.data&&null!=b.data.errorMessage)return angular.element(z.b).scope().modalWindow("dialog","Erreur serveur",{className:"modal-danger",message:b.data.errorMessage}),null;if(null==b.data.businessobjects||null==b.data.businessobjects[0])return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_FOLDER_RESULT,"error"),null;if(1!==b.data.status)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error"),null;a.f.oImportedBo=b.data.businessobjects[0];a.Wg()},function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,
"error")})}}
function Fx(a){a.la.info("nsVmap.importBoCtrl.submitBo_");var b=angular.element(z.b).injector().get(["formSrvc"]),c=angular.element($("#import_bo_def_formreader").children()).scope(),c=b.getFormData(c.sFormDefinitionName,!0,{oFormDefinition:c.oFormDefinition,oFormValues:c.oFormValues});a.f.oBoDef=c;null!=a.f.oEventDef&&(c=angular.element($("#import_bo_event_formreader").children()).scope(),c=b.getFormData(c.sFormDefinitionName,!0,{oFormDefinition:c.oFormDefinition,oFormValues:c.oFormValues}),a.f.oEventDef=
c);if(null!=a.f.aReportsDef){for(var c=[],d=0;d<a.f.aReportsDef.length;d++)c[d]=angular.element($("#import_bo_reports_"+a.f.aReportsDef[d].printreport_id+"_formreader").children()).scope();for(var e=[],d=0;d<c.length;d++)e[d]=b.getFormData(c[d].sFormDefinitionName,!0,{oFormDefinition:c[d].oFormDefinition,oFormValues:c[d].oFormValues,aParamsToSave:["printreport_id"]});a.f.aReportsDef=e}null!=a.f.oImportedBo&&null!=a.f.oImportedBo.json&&(a.f.oImportedBo.json.business_object=a.f.oBoDef,null!=a.f.oEventDef&&
(a.f.oImportedBo.json.event=a.f.oEventDef),null!=a.f.aReportsDef&&(a.f.oImportedBo.json.reports=a.f.aReportsDef))}
function Tx(a,b){a.la.info("nsVmap.importBoCtrl.getJsonForm_");var c=a.ua.defer();if(!p(b))return console.error("importBoCtrl.getJsonForm missing parameter sForm"),null;if("vmap_business_object"===b)var d=a.oProperties.web_server_name+"/"+sessionStorage.appEnv+"/modules/vmap/forms/vmap_business_object/vmap_business_object_vmap_business_object.json";"vmap_printreport"===b&&(d=a.oProperties.web_server_name+"/"+sessionStorage.appEnv+"/modules/vmap/forms/vmap_business_object/vmap_business_object_vmap_business_object_printreport.json");
"vmap_event"===b&&(d=a.oProperties.web_server_name+"/"+sessionStorage.appEnv+"/modules/vmap/forms/vmap_business_object/vmap_business_object_vmap_business_object_event.json");a.V({method:"GET",url:d,params:{vitis_version:a.oProperties.build}}).then(function(d){if(null==d.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error"),null;c.resolve(Ux(a,d.data,b))},function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error")});return c.promise}
function Ux(a,b,c){a.la.info("nsVmap.prepareForm_");var d={vmap_business_object:["database","schema","table","id_field","event_id"],vmap_printreport:["business_object_id"],vmap_event:[]},e;for(e in b)if(fa(b[e].rows)){a=b[e].rows[b[e].rows.length-1];if(fa(a.fields))for(var f=a.fields.length-1;0<=f;f--)"button"===a.fields[f].type&&a.fields.splice(f,1);delete f;if(null!=d[c])for(f=0;f<b[e].rows.length;f++)if(fa(b[e].rows[f].fields))for(var g=0;g<b[e].rows[f].fields.length;g++)-1!==d[c].indexOf(b[e].rows[f].fields[g].name)&&
(b[e].rows[f].fields[g].disabled=!0),-1!==d[c].indexOf(b[e].rows[f].fields[g].name)&&(b[e].rows[f].fields[g].type="text");delete f;delete g}return b}
function Ix(a){a.la.info("nsVmap.importBoCtrl.loadDatabases_");var b=a.ua.defer(),c=["postgres"];null!=a.f.usedDatabase?setTimeout(function(){b.resolve()}):(Ua(a.f.aDatabases),a.V({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vitis/genericquerys",params:{attributs:"datname",server:"localhost",port:"5432",schema:"pg_catalog",table:"pg_database",filter:"datistemplate = false",order_by:"datname",sort_order:"ASC",distinct:"true",token:a.sToken}}).then(function(d){if(null==
d.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error"),null;if(null==d.data.data)return console.error("Aucun r\u00e9sultat: databases",d),null;for(var e=0;e<d.data.data.length;e++)null!=d.data.data[e].datname&&-1===c.indexOf(d.data.data[e].datname)&&a.f.aDatabases.push(d.data.data[e].datname);a.f.usedDatabase=a.oProperties.database;b.resolve()},function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error")}));return b.promise}
function Jx(a){a.la.info("nsVmap.importBoCtrl.loadSchemas_");var b=a.ua.defer(),c=["pg_catalog","information_schema"];Ua(a.f.aSchemas);a.V({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vitis/genericquerys",params:{attributs:"schemaname",database:a.f.usedDatabase,schema:"pg_catalog",table:"pg_tables",distinct:"true",sort_order:"ASC",token:a.sToken}}).then(function(d){if(null==d.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error"),
null;if(null==d.data.data)return console.error("Aucun r\u00e9sultat: schemas",d),null;for(var e=0;e<d.data.data.length;e++)null!=d.data.data[e].schemaname&&-1===c.indexOf(d.data.data[e].schemaname)&&a.f.aSchemas.push(d.data.data[e].schemaname);setTimeout(function(){null!=a.f.usedSchema&&(-1!==a.f.aSchemas.indexOf(a.f.usedSchema)?(a.f.selectedExistingSchema=a.f.usedSchema,a.f.creatingNewSchema=""):(a.f.creatingNewSchema=a.f.usedSchema,a.f.selectedExistingSchema=""))});b.resolve()},function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,
"error")});return b.promise}
function Kx(a){a.la.info("nsVmap.importBoCtrl.loadCoordsys_");var b=a.ua.defer();null!=a.f.oCoordsys?setTimeout(function(){b.resolve()}):(Ua(a.f.aCoordsys),a.V({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vm4ms/coordinatesystems",params:{token:a.sToken,order_by:"coordsys_id"}}).then(function(c){if(null==c.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error"),null;if(null==c.data.data)return console.error("Aucun r\u00e9sultat: coordinatesystems",c),
null;a.f.aCoordsys=c.data.data;if(null!=a.f.oImportedBo.sql&&null!=a.f.oImportedBo.sql.structure&&null!=a.f.oImportedBo.sql.structure.srid){c=a.f.oImportedBo.sql.structure.srid;for(var d=0;d<a.f.aCoordsys.length;d++)parseFloat(a.f.aCoordsys[d].coordsys_id)===parseFloat(c)&&(a.f.oCoordsys=a.f.aCoordsys[d])}b.resolve()},function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error")}));return b.promise}
function Lx(a){a.la.info("nsVmap.importBoCtrl.loadLayers_");var b=a.ua.defer();a.f.codemirrorLayerDefOptions={styleActiveLine:!0,indentWithTabs:!0,lineWrapping:!0,lineNumbers:!0,readOnly:!1,mode:"map",tabSize:2,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]};if(!(null!=a.f.aLayersDef&&0<a.f.aLayersDef.length)&&null!=a.f.oImportedBo&&null!=a.f.oImportedBo.json&&null!=a.f.oImportedBo.json.mapserver_layers)for(var c=a.f.oImportedBo.json.mapserver_layers,d=0;d<c.length;d++)a.f.aLayersDef.push({title:c[d].title,
name:c[d].name,ms_layertype_id:c[d].ms_layertype_id,tablename:c[d].tablename,tableidfield:c[d].tableidfield,definition:c[d].definition,database:"[DATABASE]",tableschema:"[TABLE_SCHEMA]",coordsys_id:a.f.oCoordsys.coordsys_id,connection_id:"",wmsservice_id:"",private_connection:!1,active:!1});null!=a.f.aConnections?setTimeout(function(){b.resolve()}):a.V({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vm4ms/layerconnections",params:{token:a.sToken,order_by:"name",
filter:"database='"+a.f.usedDatabase+"'"}}).then(function(c){if(null==c.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error"),null;0===c.data.list_count&&($.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_DB_CONNECTION,"warning"),c.data.data=[]);if(null==c.data.data)return console.error("Aucun r\u00e9sultat: layerconnections",c),null;a.f.aConnections=c.data.data;null!=a.f.aWmsServices&&null!=a.f.aVmapServices&&b.resolve()},function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,
"error")});null!=a.f.aWmsServices?setTimeout(function(){b.resolve()}):a.V({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vm4ms/wmsservices",params:{token:a.sToken,order_by:"wmsservice_id"}}).then(function(c){if(null==c.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error"),null;if(null==c.data.data)return console.error("Aucun r\u00e9sultat: wmsservices",c),null;a.f.aWmsServices=c.data.data;null!=a.f.aConnections&&null!=a.f.aVmapServices&&
b.resolve()},function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error")});null!=a.f.aVmapServices?setTimeout(function(){b.resolve()}):a.V({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vmap/services",params:{token:a.sToken}}).then(function(c){if(null==c.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error"),null;if(null==c.data.data)return console.error("Aucun r\u00e9sultat: services",c),null;a.f.aVmapServices=
c.data.data;null!=a.f.aConnections&&null!=a.f.aWmsServices&&b.resolve()},function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error")});a.f.refreshCodeMirror();return b.promise}
function Hx(a){a.la.info("nsVmap.importBoCtrl.loadBo_");if(null!=a.f.oImportedBo&&null!=a.f.oImportedBo.json){a.f.oBoDef=a.f.oImportedBo.json.business_object;a.f.oEventDef=a.f.oImportedBo.json.event;a.f.aReportsDef=a.f.oImportedBo.json.reports;a.f.oBoDef.database="[DATABASE]";a.f.oBoDef.schema="[TABLE_SCHEMA]";a.f.oBoDef.event_id="[EVENT]";var b=angular.element($("#import_bo_def_formreader").children()).scope();null!=a.f.oBoForm?Vx(a,{oFormReader:b,oFormValues:{insert:angular.copy(a.f.oBoDef)}}):
Tx(a,"vmap_business_object").then(function(c){a.f.oBoForm=c;Wx(a,{oFormReader:b,sFormDefinitionName:"insert",oFormDefinition:a.f.oBoForm,oFormValues:{insert:angular.copy(a.f.oBoDef)}})});if(null!=a.f.oEventDef){var c=angular.element($("#import_bo_event_formreader").children()).scope();null!=a.f.oEventForm?Vx(a,{oFormReader:c,oFormValues:{insert:angular.copy(a.f.oEventDef)}}):Tx(a,"vmap_event").then(function(b){a.f.oEventForm=b;Wx(a,{oFormReader:c,sFormDefinitionName:"insert",oFormDefinition:a.f.oEventForm,
oFormValues:{insert:angular.copy(a.f.oEventDef)}})})}if(null!=a.f.aReportsDef){for(var d=0;d<a.f.aReportsDef.length;d++)a.f.aReportsDef[d].business_object_id="[BUSINESS_OBJECT]";if(null!=a.f.oReportForm)for(var e=[],d=0;d<a.f.aReportsDef.length;d++)e[d]=angular.element($("#import_bo_reports_"+a.f.aReportsDef[d].printreport_id+"_formreader").children()).scope(),Wx(a,{oFormReader:e[d],sFormDefinitionName:"insert",oFormDefinition:a.f.oReportForm,oFormValues:{insert:angular.copy(a.f.aReportsDef[d])}});
else Tx(a,"vmap_printreport").then(function(b){a.f.oReportForm=b;b=[];for(var c=0;c<a.f.aReportsDef.length;c++)b[c]=angular.element($("#import_bo_reports_"+a.f.aReportsDef[c].printreport_id+"_formreader").children()).scope(),Wx(a,{oFormReader:b[c],sFormDefinitionName:"insert",oFormDefinition:a.f.oReportForm,oFormValues:{insert:angular.copy(a.f.aReportsDef[c])}})})}}}
function Wx(a,b){a.la.info("nsVmap.importBoCtrl.loadBoForm_");a=b.oFormReader;var c=b.sFormDefinitionName,d=b.oFormDefinition;b=b.oFormValues;null==a?console.error("cannot execute importBoCtrl.loadBoForm_: missing parameter oFormReader"):null==c?console.error("cannot execute importBoCtrl.loadBoForm_: missing parameter sFormDefinitionName"):null==d?console.error("cannot execute importBoCtrl.loadBoForm_: missing parameter oFormDefinition"):(a.ctrl.setDefinitionName(c),null!=b&&a.ctrl.setFormValues(b),
a.ctrl.setFormDefinition(d),a.ctrl.loadForm())}function Vx(a,b){a.la.info("nsVmap.importBoCtrl.loadBoFormValues_");a=b.oFormReader;b=b.oFormValues;null==a?console.error("cannot execute importBoCtrl.loadBoFormValues_: missing parameter oFormReader"):null==b?console.error("cannot execute importBoCtrl.loadBoFormValues_: missing parameter oFormValues"):(a.ctrl.setFormValues(b),a.ctrl.loadForm())}
function Bx(a){a.la.info("nsVmap.importBoCtrl.validateDatabase_");var b=a.ua.defer(),c=!1;setTimeout(function(){null!=a.f.usedDatabase&&p(a.f.usedDatabase)&&0<a.f.usedDatabase.length&&(c=!0);c?b.resolve(!0):$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_DB_VALID,"error")});return b.promise}
function Cx(a){a.la.info("nsVmap.importBoCtrl.validateSchema_");var b=a.ua.defer(),c=!1,d=angular.element(z.b).injector().get(["$translate"]),e=["s_vmap","s_vitis","s_vm4ms","s_majic","s_cadastre"];setTimeout(function(){null!=a.f.usedSchema&&p(a.f.usedSchema)&&0<a.f.usedSchema.length&&a.EG.test(a.f.usedSchema)&&(c=!0);c?-1!==e.indexOf(a.f.usedSchema)?d(["CREATE_BO_ON_UNRECOMMENDED_SCHEMA1","CREATE_BO_ON_UNRECOMMENDED_SCHEMA2","CREATE_BO_ON_UNRECOMMENDED_SCHEMA3"]).then(function(c){c={className:"modal-warning",
message:"<b>"+c.CREATE_BO_ON_UNRECOMMENDED_SCHEMA1+a.f.usedSchema+c.CREATE_BO_ON_UNRECOMMENDED_SCHEMA2+"<br>"+c.CREATE_BO_ON_UNRECOMMENDED_SCHEMA3+"</b>",callback:function(a){a?b.resolve(!0):b.reject()}};angular.element(z.b).scope().modalWindow("confirm","",c)}):b.resolve(!0):$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_SCHEMA_VALID,"error")});return b.promise}
function Dx(a){a.la.info("nsVmap.importBoCtrl.validateCoordsys_");var b=a.ua.defer(),c=!1;setTimeout(function(){null!=a.f.oCoordsys&&ha(a.f.oCoordsys.coordsys_id)&&0<a.f.oCoordsys.coordsys_id&&(c=!0);c?b.resolve(!0):$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_COORDSYS_VALID,"error")});return b.promise}
function Ex(a){a.la.info("nsVmap.importBoCtrl.validateLayers_");var b=a.ua.defer(),c=!0,d=a.f.aLayersDef,e="name title coordsys_id wmsservice_id connection_id active ms_layertype_id tableidfield tableschema tablename".split(" ");setTimeout(function(){for(var f=0;f<d.length;f++)Xx(a,d[f],e)||(console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_VALID_LAYER_1+d[f].title+a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_VALID_LAYER_2),a.uo.modalWindow("dialog","Error",{className:"modal-danger",message:a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_VALID_LAYER_1+
d[f].title+a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_VALID_LAYER_2}),c=!1);c&&Yx(a).then(function(a){!0===a&&b.resolve(!0)})});return b.promise}function Gx(a){a.la.info("nsVmap.importBoCtrl.validateBo_");var b=a.ua.defer();Zx(a).then(function(c){!0===c?$x(a).then(function(c){!0===c?ay(a).then(function(a){!0===a?b.resolve(!0):b.resolve(!1)}):b.resolve(!1)}):b.resolve(!1)});return b.promise}
function Mx(a){a.la.info("nsVmap.importBoCtrl.testImport_");var b=a.ua.defer();a.f.oTestSteps={business_objet:null,reports:null,event:null,layers:null,schema:null,tables:null};Zx(a).then(function(c){!0===c?(a.f.oTestSteps.business_objet=!0,$x(a).then(function(c){!0===c?(a.f.oTestSteps.reports=!0,ay(a).then(function(c){!0===c?(a.f.oTestSteps.event=!0,Yx(a).then(function(c){!0===c?(a.f.oTestSteps.layers=!0,by(a).then(function(c){!0===c?(a.f.oTestSteps.schema=!0,cy(a).then(function(c){!0===c?(a.f.oTestSteps.tables=
!0,b.resolve(!0)):(a.f.oTestSteps.tables=!1,b.resolve(!1))})):(a.f.oTestSteps.schema=!1,b.resolve(!1))})):(a.f.oTestSteps.layers=!1,b.resolve(!1))})):(a.f.oTestSteps.event=!1,b.resolve(!1))})):(a.f.oTestSteps.reports=!1,b.resolve(!1))})):(a.f.oTestSteps.business_objet=!1,b.resolve(!1))});return b.promise}
function Xx(a,b,c){a.la.info("nsVmap.importBoCtrl.checkObjectKeys_");for(a=0;a<c.length;a++)if(null==b[c[a]]||(p(b[c[a]])||fa(b[c[a]]))&&0< !b[c[a]].length)return console.error("checkObjectKeys_: missing "+c[a]+" in object",b),!1;return!0}
function dy(a,b,c,d,e){a.la.info("nsVmap.importBoCtrl.testRessource_");var f=a.ua.defer();if(!Xx(a,b,e))return setTimeout(function(){console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_COMPLETE_OBJECT,null!=b[c]?b[c]:d);a.uo.modalWindow("dialog","Error",{className:"modal-danger",message:a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_COMPLETE_OBJECT+b});f.resolve(!1)}),f.promise;a.V({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/"+d,params:{token:a.sToken,filter:'"'+
c+"\"='"+b[c]+"'"}}).then(function(d){if(null==d.data||null==d.data.list_count)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error"),console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,b[c]),f.resolve(!1),null;0<d.data.list_count?(console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_OBJECT_ALREADY_EXISTS,b[c]),a.uo.modalWindow("dialog","Error",{className:"modal-danger",message:a.oTranslations.CTRL_IMPORT_BO_ERROR_OBJECT_ALREADY_EXISTS+b[c]}),f.resolve(!1)):
f.resolve(!0)},function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error");console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,b[c])});return f.promise}function Zx(a){a.la.info("nsVmap.importBoCtrl.testBo_");var b=a.ua.defer();dy(a,a.f.oBoDef,"business_object_id","vmap/businessobjects","business_object_id title database schema table id_field sql_summary sql_list geom_column index".split(" ")).then(function(a){b.resolve(a)});return b.promise}
function $x(a){a.la.info("nsVmap.importBoCtrl.testReports_");var b=a.ua.defer(),c=a.f.aReportsDef,d="name rt_format_id rt_orientation_id outputformats_id business_object_id htmldefinition".split(" "),e=0;if(null!=a.f.aReportsDef)for(var f=0;f<c.length;f++)dy(a,c[f],"name","vmap/printreports",d).then(function(a){e++;!1===a?b.resolve(!1):e===c.length&&b.resolve(!0)});else setTimeout(function(){b.resolve(!0)});return b.promise}
function ay(a){a.la.info("nsVmap.importBoCtrl.Event_");var b=a.ua.defer(),c=a.f.oEventDef,d=["event_id"];null!=a.f.oEventDef?dy(a,c,"event_id","vmap/businessobjectevents",d).then(function(a){b.resolve(a)}):setTimeout(function(){b.resolve(!0)});return b.promise}
function Yx(a){a.la.info("nsVmap.importBoCtrl.testLayers_");for(var b=a.ua.defer(),c=a.f.aLayersDef,d="name title coordsys_id connection_id active ms_layertype_id tableidfield tableschema tablename".split(" "),e=0,f=0;f<c.length;f++)(function(f){dy(a,c[f],"name","vm4ms/layers",d).then(function(d){var g={service_id:"vm4ms_"+c[f].wmsservice_id,name:c[f].title,layer_list:c[f].name,bo_id:"[BUSINESS_OBJECT]",is_dynamic:!0,is_filtered:!1};!1===d?b.resolve(!1):dy(a,g,"name","vmap/layers",[]).then(function(a){e++;
!1===a?b.resolve(!1):e===c.length&&b.resolve(!0)})})})(f);return b.promise}function by(a){a.la.info("nsVmap.importBoCtrl.testSchema_");var b=a.ua.defer();setTimeout(function(){null!=a.f.usedSchema?b.resolve(!0):($.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_DEFINED_SCHEMA,"error"),b.resolve(!1))});return b.promise}
function cy(a){a.la.info("nsVmap.importBoCtrl.testTables_");var b=a.ua.defer();setTimeout(function(){null!=a.f.usedSchema?-1===a.f.aSchemas.indexOf(a.f.usedSchema)?b.resolve(!0):a.V({method:"GET",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vitis/genericquerys",params:{attributs:"tablename",schema:"pg_catalog",table:"pg_tables",distinct:"true",sort_order:"ASC",filter:"schemaname='"+a.f.usedSchema+"'",token:a.sToken}}).then(function(c){if(null==c.data||null==c.data.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,
"error"),b.resolve(!1),null;for(var d=[],e=0;e<c.data.data.length;e++)null!=c.data.data[e].tablename&&d.push(c.data.data[e].tablename);c=a.f.oImportedBo.sql.structure.tables;if(null==c)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_TABLES_TO_IMPORT,"error"),console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_TABLES_TO_IMPORT),b.resolve(!1),null;for(e=0;e<c.length;e++)if(-1!==d.indexOf(c[e]))return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_TABLE_ALREADY_PRESENT+": "+c[e],"error"),b.resolve(!1),
null;b.resolve(!0)},function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END,"error")}):($.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_NO_DEFINED_SCHEMA,"error"),b.resolve(!1))});return b.promise}
function ey(a,b,c,d,e,f){a.la.info("nsVmap.importBoCtrl.importObject_");e=null!=e?e:[];var g=a.ua.defer();b=angular.copy(b);for(var h in b)p(b[h])&&(b[h]=b[h].replace(/\[TABLE_SCHEMA\]/g,a.f.usedSchema),b[h]=b[h].replace(/\[DATABASE\]/g,a.f.usedDatabase),b[h]=b[h].replace(/\[SRID\]/g,a.f.oCoordsys.coordsys_id),b[h]=b[h].replace(/\[BUSINESS_OBJECT\]/g,a.f.oBoDef.business_object_id),null!=a.f.oEventDef&&(b[h]=b[h].replace(/\[EVENT\]/g,a.f.oEventDef.event_id)));if(null!=f)for(h in f)p(f[h])&&(f[h]=f[h].replace(/\[TABLE_SCHEMA\]/g,
a.f.usedSchema),f[h]=f[h].replace(/\[DATABASE\]/g,a.f.usedDatabase),f[h]=f[h].replace(/\[SRID\]/g,a.f.oCoordsys.coordsys_id),f[h]=f[h].replace(/\[BUSINESS_OBJECT\]/g,a.f.oBoDef.business_object_id),null!=a.f.oEventDef&&(f[h]=f[h].replace(/\[EVENT\]/g,a.f.oEventDef.event_id)));for(var l=0;l<e.length;l++)null!=b[e[l]]&&delete b[e[l]];e=new FormData;for(h in b)e.append(h,b[h]);if(null!=f)for(h in f)e.append(h,new Blob([f[h]],{type:"text"}));a.V({method:"POST",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+
"/"+c,data:e,params:{token:a.sToken}}).then(function(b){if(null==b.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_IMPORT+c,"error"),console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_IMPORT+c),g.resolve({status:!1}),null;if(null!=b.data&&null!=b.data.errorMessage)return angular.element(z.b).scope().modalWindow("dialog",
"Erreur serveur",{className:"modal-danger",message:b.data.errorMessage}),g.resolve({status:!1}),null;1===b.data.status?(null!=d&&a.yk.push({sId:b.data[d],sRessource:c}),g.resolve({status:!0,objectId:null!=d?b.data[d]:null})):g.resolve({status:!1})},function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_IMPORT+c,"error");console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_IMPORT+
c);g.resolve({status:!1})});return g.promise}
function fy(a,b,c,d){a.la.info("nsVmap.importBoCtrl.putForm_");var e=a.ua.defer(),f=new FormData,g;for(g in b)f.append(g,b[g]);a.V({method:"PUT",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/"+c+"/"+d,data:f,params:{token:a.sToken,cmd:"Save"}}).then(function(b){if(null==b.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_IMPORT+c,"error"),console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+
a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_IMPORT+c),e.resolve(!1),null;e.resolve(!0)},function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_IMPORT+c,"error");console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_IMPORT+c)});return e.promise}
function Sx(a,b,c){a.la.info("nsVmap.importBoCtrl.deleteObject_");var d=a.ua.defer();a.V({method:"DELETE",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/"+b+"/"+c,params:{token:a.sToken}}).then(function(c){if(null==c.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REMOVE_ERROR+b,"error"),console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REMOVE_ERROR+b),null;1===c.data.status&&a.la.info("deleteObject_ ("+b+") ok");d.resolve()},function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REMOVE_ERROR+
b,"error");console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REMOVE_ERROR+b)});setTimeout(function(){d.resolve()},5E3);return d.promise}
function Nx(a){a.la.info("nsVmap.importBoCtrl.importBo_");var b=a.ua.defer();setTimeout(function(){ey(a,a.f.oBoDef,"vmap/businessobjects","business_object_id",["$$hashKey"]).then(function(c){if(!0===c.status){for(var d=["default","custom","published"],e,f=0,g=0,h=0;h<d.length;h++)null!=a.f.oImportedBo.forms[d[h]]&&(f++,e={Json:JSON.stringify(a.f.oImportedBo.forms[d[h]])},null!=a.f.oImportedBo.forms.ressources&&null!=a.f.oImportedBo.forms.ressources.js&&null!=a.f.oImportedBo.forms.ressources.js[d[h]]&&
(e.Js=a.f.oImportedBo.forms.ressources.js[d[h]]),null!=a.f.oImportedBo.forms.ressources&&null!=a.f.oImportedBo.forms.ressources.css&&null!=a.f.oImportedBo.forms.ressources.css[d[h]]&&(e.Css=a.f.oImportedBo.forms.ressources.css[d[h]]),fy(a,angular.copy(e),"vmap/businessobjects/"+c.objectId+"/forms",d[h]).then(function(a){!0===a&&(g++,g===f&&b.resolve(!0))}));0===f&&b.resolve(!0)}else b.resolve(!1)})});return b.promise}
function Ox(a){a.la.info("nsVmap.importBoCtrl.importReports_");var b=a.ua.defer(),c=a.f.aReportsDef,d=0;setTimeout(function(){if(null!=a.f.aReportsDef)for(var e=0;e<c.length;e++)ey(a,c[e],"vmap/printreports","printreport_id",["printreport_id","$$hashKey"]).then(function(a){!0===a.status?(d++,d===c.length&&b.resolve(!0)):b.resolve(!0)});else b.resolve(!0)});return b.promise}
function Px(a){a.la.info("nsVmap.importBoCtrl.importEvent_");var b=a.ua.defer();setTimeout(function(){null!=a.f.oEventDef?ey(a,a.f.oEventDef,"vmap/businessobjectevents","event_id",["$$hashKey"]).then(function(a){b.resolve(a.status)}):b.resolve(!0)});return b.promise}
function Qx(a){a.la.info("nsVmap.importBoCtrl.importLayers_");var b=a.ua.defer(),c=a.f.aLayersDef,d=0;setTimeout(function(){for(var e=0;e<c.length;e++)(function(e){ey(a,c[e],"vm4ms/layers","ms_layer_id",["$$hashKey","ms_layer_id"]).then(function(f){if(!0===f.status){for(var g=0;g<a.f.aVmapServices.length;g++)if(a.f.aVmapServices[g].name==="vm4ms_"+c[e].wmsservice_id)var l=a.f.aVmapServices[g].service_id;c[e].ms_layer_id=f.objectId;gy(a,c[e]).then(function(f){!0===f.status?null!=l?ey(a,{service_id:l,
name:c[e].name,layer_list:c[e].name,bo_id:"[BUSINESS_OBJECT]",is_dynamic:!0,is_filtered:!1},"vmap/layers","layer_id",["$$hashKey","layer_id"]).then(function(a){!0===a.status?(d++,d===c.length&&b.resolve(!0)):b.resolve(!1)}):b.resolve(!1):b.resolve(!1)})}else b.resolve(!1)})})(e)});return b.promise}
function gy(a,b){a.la.info("nsVmap.importBoCtrl.associateLayers_");var c=a.ua.defer();a.V({method:"PUT",url:a.oProperties.web_server_name+"/"+a.oProperties.services_alias+"/vm4ms/layerwmsservices/"+b.ms_layer_id,params:{token:a.sToken},data:{wmsservices:b.wmsservice_id}}).then(function(d){if(null==d.data)return $.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_ASSOCIATE_LAYER+b.name,"error"),console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+
a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_ASSOCIATE_LAYER+b.name),c.resolve({status:!1}),null;1===d.data.status?c.resolve({status:!0}):c.resolve({status:!1})},function(){$.notify(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_ASSOCIATE_LAYER+b.name,"error");console.error(a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_1+a.oTranslations.CTRL_IMPORT_BO_ERROR_REQUEST_UNABLE_TO_END_2_ASSOCIATE_LAYER+
b.name);c.resolve({status:!1})});return c.promise}function Rx(a){a.la.info("nsVmap.importBoCtrl.importSql_");var b=a.ua.defer();setTimeout(function(){ey(a,{database:a.f.usedDatabase},"vmap/businessobjects/data_model",null,[],{data_model:a.f.sSql}).then(function(a){b.resolve(a.status)})});return b.promise}C.module.controller("AppImportBoController",yx);z.on("appMainDrtvLoaded",function(){angular.element(z.Lb).scope().$on("updateStudio_vmap_business_object_vmap_business_object",function(a,b){a=angular.element(z.b).injector().get(["envSrvc"]);var c=angular.element(z.b).injector().get(["propertiesSrvc"]),d=angular.element(z.b).injector().get(["sessionSrvc"]);1===b.index&&"modules/vmap/template/studio.html"===b.oSectionForm.template&&(X.reset(),X.setId(a.sId),X.setApplication("vmap"),X.setToken(d.token),X.setContainer("#container_section_"+a.oSelectedObject.name+
"_studio"),X.setAppProperties(c))},!0);angular.element(z.b).scope().loadVmap=function(){var a=angular.element(z.b).injector().get(["$log"]);angular.element(z.b).injector().get(["$timeout"]);var b=angular.element(z.b).injector().get(["envSrvc"]),c=angular.element(z.b).injector().get(["modesSrvc"]);a.info("loadVmap");b.oSelectedMode.fullScreen=!0;c.setModeReload("vmap",!1);z.zn().resizeWin();angular.element(z.b).scope().setFullScreen();c.getMode("vmap").ajaxLoader=!1;"vmap"==c.modes[0].mode_id&&(sessionStorage.ajaxLoader=
!1);C.oi()};z.fu=function(a){return{link:function(b,c,d){var e=d.$observe("appMapDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},
html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};z.fu.$inject=["$translate"];z.compileProvider.directive("appMapDescriptionColumn",z.fu);z.hu=function(){return{replace:!0,template:'<span class="glyphicon glyphicon-picture grid-column-glyph-icon"></span>',link:function(a,b,c){var d=c.$observe("appMapThumbnailColumn",function(){null==a.row.entity[a.col.field]||""==a.row.entity[a.col.field]?b[0].className="":(b[0].className="glyphicon glyphicon-picture grid-column-glyph-icon",
b[0].parentNode.style.textAlign="center",$(b).popover({trigger:"hover",container:"body",title:"",content:function(){var c=document.createElement("img");c.onerror=function(){$(b).popover("destroy")};c.src=a.row.entity[a.col.field];c.className="popover-thumbnail-img";return c.outerHTML},html:!0,placement:function(b,c){return a.$root.workspaceTooltipPlacement(c)},template:'<div class="popover popover-thumbnail" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}))});
a.$on("$destroy",function(){$(b).popover("destroy");d()})}}};z.hu.$inject=["propertiesSrvc"];z.compileProvider.directive("appMapThumbnailColumn",z.hu);z.vA=function(){return{replace:!0,template:'<a href="" target="_blank" class="glyphicon glyphicon-link grid-column-glyph-icon"></a>',link:function(a,b,c){var d=c.$observe("appServiceUrlColumn",function(){null==a.row.entity[a.col.field]||""==a.row.entity[a.col.field]?b[0].className="":(b[0].className="glyphicon glyphicon-link grid-column-glyph-icon",
b[0].href=a.row.entity[a.col.field],b[0].alt=b[0].href,b[0].title=b[0].href,b[0].parentNode.style.textAlign="center")});a.$on("$destroy",function(){$(b).popover("destroy");d()})}}};z.compileProvider.directive("appServiceUrlColumn",z.vA);z.ru=function(a){return{link:function(b,c,d){var e=d.$observe("appServiceDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_SERVICE"]).then(function(a){$(c).popover({trigger:"hover",
container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_SERVICE},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};z.ru.$inject=["$translate"];z.compileProvider.directive("appServiceDescriptionColumn",z.ru);z.su=function(){return{replace:!0,template:'<span class="glyphicon glyphicon-picture grid-column-glyph-icon"></span>',link:function(a,
b,c){var d=c.$observe("appServiceThumbnailColumn",function(){null==a.row.entity[a.col.field]||""==a.row.entity[a.col.field]?b[0].className="":(b[0].className="glyphicon glyphicon-picture grid-column-glyph-icon",b[0].parentNode.style.textAlign="center",$(b).popover({trigger:"hover",container:"body",title:"",content:function(){var c=document.createElement("img");c.onerror=function(){$(b).popover("destroy")};c.src=a.row.entity[a.col.field];c.className="popover-thumbnail-img";return c.outerHTML},html:!0,
placement:function(b,c){return a.$root.workspaceTooltipPlacement(c)},template:'<div class="popover popover-thumbnail" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}))});a.$on("$destroy",function(){$(b).popover("destroy");d()})}}};z.su.$inject=["propertiesSrvc"];z.compileProvider.directive("appServiceThumbnailColumn",z.su);z.Xt=function(a){return{link:function(b,c,d){var e=d.$observe("appLayerDescriptionColumn",function(){null==b.row.entity[b.col.field]||
""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_LAYER"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_LAYER},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};z.Xt.$inject=["$translate"];
z.compileProvider.directive("appLayerDescriptionColumn",z.Xt);angular.element(z.b).scope().loadVmapGroup=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.S).injector().get(["envSrvc"]);a.info("loadVmapGroup");a=b.oSelectedObject.name;this.oFormRequestParams={sUrl:"modules/vmap/forms/"+b.oSelectedMode.mode_id+"/"+a+"_"+b.oSectionForm[a].sections[b.oSectionForm[a].iSelectedSectionIndex].name+".json"}};z.Ut=function(a){return{link:function(b,c,d){var e=d.$observe("appCrsListDescriptionColumn",
function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["COORDINATE_SYSTEM_TOOLTIP_TITLE_VMAP_MAP_LAYER"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.COORDINATE_SYSTEM_TOOLTIP_TITLE_VMAP_MAP_LAYER},content:function(){return b.row.entity[b.col.field].replace(/\|/g,"<br>")},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",
function(){$(c).popover("destroy");e()})}}};z.Ut.$inject=["$translate"];z.compileProvider.directive("appCrsListDescriptionColumn",z.Ut);angular.element(z.b).scope().initVmapServiceForm=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["envSrvc"]),b=angular.element(z.b).injector().get(["envSrvc"]);a.info("initVmapServiceForm");var c=angular.element(z.b).scope();"insert"==b.sMode?document.querySelector("form[name='"+b.oFormDefinition[b.sFormDefinitionName].name+
"'] select[name='service_type_id']").addEventListener("change",function(){c.$root.setVmapServiceForm(this.value);angular.element("form[name='"+b.oFormDefinition[b.sFormDefinitionName].name+"']").scope().$apply()}):(c.$root.setVmapServiceForm(b.oFormValues[b.sFormDefinitionName].service_type_id),angular.element("form[name='"+b.oFormDefinition[b.sFormDefinitionName].name+"']").scope().$apply())};angular.element(z.b).scope().setVmapServiceForm=function(a){var b=angular.element(z.b).injector().get(["$log"]),
c=angular.element(z.b).injector().get(["$translate"]),d=angular.element(z.b).injector().get(["$timeout"]),e=angular.element(z.b).injector().get(["envSrvc"]),f=angular.element(z.b).injector().get(["formSrvc"]);b.info("setVmapServiceForm");var g={xyz:"name description url thumbnail form_submit return_list".split(" "),osm:"name description url thumbnail form_submit return_list".split(" "),bing:"name description key thumbnail lang imagery form_submit return_list".split(" "),imagewms:"name wms_service_type description url service_type_version wms_test_button wms_test_submit_button return_list".split(" "),
tilewms:"name wms_service_type description url service_type_version wms_test_button wms_test_submit_button return_list".split(" "),wmts:"name description url service_type_version service_type_type capabilities_url wmts_test_button wmts_test_submit_button return_list".split(" ")};Object.keys(g).forEach(function(a){g[a].unshift("service_id","service_type_id")});b=f.getAllFormElementDefinition(e.sFormDefinitionName);"undefined"==typeof a&&(a=e.oFormValues[e.sFormDefinitionName].service_type_id);if("tilewms"===
a||"imagewms"===a)e.oFormValues[e.sFormDefinitionName].wms_service_type=a;b.forEach(function(b){var f=!0;if("undefined"!=typeof g[a])if("button"!==b.type)-1==g[a].indexOf(b.name)&&(f=!1);else{var h=b.buttons;null!=h&&h.forEach(function(b){b.visible=-1===g[a].indexOf(b.name)?!1:!0})}"service_type_version"==b.name&&f&&d(function(){c(["FORM_SERVICE_TYPE_VERSION_TOOLTIP_VMAP_MAP_SERVICE"]).then(function(a){a={title:"",content:a.FORM_SERVICE_TYPE_VERSION_TOOLTIP_VMAP_MAP_SERVICE,container:"body",trigger:"hover"};
if(null==document.getElementById(b.id+"_tooltip")){var c=document.createElement("span");c.className="form-field-label-tooltip";c.id=b.id+"_tooltip";null!=document.getElementById(b.id+"_label")&&document.getElementById(b.id+"_label").appendChild(c)}angular.element(c).popover(a)})});b.visible=f;!e.oFormValues[e.sFormDefinitionName].service_vm4ms||"name"!==b.name&&"url"!==b.name||(b.type="label")});"tilewms"!==a&&"imagewms"!==a||"update"!==e.sMode?f.getFormElementDefinition("service_type_id",e.sFormDefinitionName,
e.sFormDefinition).visible=!0:f.getFormElementDefinition("service_type_id",e.sFormDefinitionName,e.sFormDefinition).visible=!1;"wmts"===a&&d(function(){""!==e.oFormValues[e.sFormDefinitionName].service_type_version&&null!=e.oFormValues[e.sFormDefinitionName].service_type_version||(e.oFormValues[e.sFormDefinitionName].service_type_version="1.0.0")})};angular.element(z.b).scope().beforeVmapServiceForm=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["envSrvc"]),
c=angular.element(z.b).injector().get(["formSrvc"]);a.info("beforeVmapServiceForm");a=b.oFormValues[b.sFormDefinitionName].service_type_id;if("tilewms"===a||"imagewms"===a)b.oFormValues[b.sFormDefinitionName].service_type_id=b.oFormValues[b.sFormDefinitionName].wms_service_type.selectedOption.value,c.getFormElementDefinition("service_type_id",b.sFormDefinitionName,b.sFormDefinition).type="text"};angular.element(z.b).scope().afterVmapServiceForm=function(){var a=angular.element(z.b).injector().get(["$log"]),
b=angular.element(z.b).injector().get(["envSrvc"]),c=angular.element(z.b).injector().get(["formSrvc"]);a.info("afterVmapServiceForm");a=b.oFormValues[b.sFormDefinitionName].service_type_id;if("tilewms"===a||"imagewms"===a)c.getFormElementDefinition("service_type_id",b.sFormDefinitionName,b.sFormDefinition).type="label";this.editSectionForm()};angular.element(z.b).scope().testWMTSCapabilities=function(a){var b=angular.element(z.b).injector().get(["$log"]),c=angular.element(z.b).injector().get(["$timeout"]),
d=angular.element(z.b).injector().get(["envSrvc"]);b.info("testWMTSCapabilities");var e=angular.copy(d.oFormValues[d.sFormDefinitionName].url),b=angular.copy(d.oFormValues[d.sFormDefinitionName].service_type_version),f=angular.copy(d.oFormValues[d.sFormDefinitionName].service_type_type),g=angular.copy(d.oFormValues[d.sFormDefinitionName].name);ka(f)&&null!=f.selectedOption&&null!=f.selectedOption.value&&(f=f.selectedOption.value);if(null==g||""===g)return $.notify("Nom non d\u00e9fini","error"),null;
if(null==e||""===e)return $.notify("Lien non d\u00e9fini","error"),null;if(null==b||""===b)return $.notify("Version non d\u00e9finie","error"),null;if(null==f||""===f)return $.notify("Type non d\u00e9fini","error"),null;if(0<e.toLowerCase().indexOf("service="))return $.notify('Veuillez ne pas utiliser le param\u00e8tre SERVICE dans le champ "Lien"',"error"),null;if(0<e.toLowerCase().indexOf("request="))return $.notify('Veuillez ne pas utiliser le param\u00e8tre REQUEST dans le champ "Lien"',"error"),
null;if(0<e.toLowerCase().indexOf("version="))return $.notify('Veuillez ne pas utiliser le param\u00e8tre VERSION dans le champ "Lien"',"error"),null;this.WMTSCapabilities({serviceUrl:e,serviceVersion:b,WMTSType:f},function(b){$.notify("Service valide","success");c(function(){var c=JSON.stringify(b);d.oFormValues[d.sFormDefinitionName].service_options=c;if(a){d.oFormValues[d.sFormDefinitionName].url=Sd(e);var c=d.oFormDefinition[d.sFormDefinitionName].name,f=angular.element("form[name='"+c+"']").scope();
f[c].$setPristine();f.sendForm()}})})};angular.element(z.b).scope().WMTSCapabilities=function(a,b,c){var d=angular.element(z.b).injector().get(["$log"]),e=angular.element(z.b).injector().get(["$http"]),f=angular.element(z.b).injector().get(["propertiesSrvc"]),g=this;d.info("WMTSCapabilities");if(null==a.serviceUrl)return console.error("serviceUrl not defined"),null;if(null==a.serviceVersion)return console.error("serviceVersion not defined"),null;if(null==a.WMTSType)return console.error("WMTSType not defined"),
null;null!=c||(c=function(a){g.$root.modalWindow("dialog","Service non valide",{className:"modal-danger",message:a})});var h=a.serviceUrl,l=a.serviceVersion;a=a.WMTSType;var n,r=!0,h=Sd(h);"KVP"===a?n=-1===h.indexOf("?")?h+"?SERVICE=WMTS&VERSION="+l+"&REQUEST=GetCapabilities":h+"&SERVICE=WMTS&VERSION="+l+"&REQUEST=GetCapabilities":"REST"===a&&(n=h+"/"+l+"/WMTSCapabilities.xml");null!=n&&(e({url:f.proxy_url+"?url="+encodeURIComponent(n),headers:{charset:"charset=utf-8"}}).then(angular.bind(this,function(a){var e=
a.data;if(p(a.data)&&0<a.data.length){try{var f=(new kq).read(e)}catch(y){f={}}d.info(f);null!=f.Contents&&fa(f.Contents.Layer)&&null!=f.Contents.Layer[0]&&fa(f.Contents.Layer[0].TileMatrixSetLink)&&null!=f.Contents.Layer[0].TileMatrixSetLink[0]&&p(f.Contents.Layer[0].TileMatrixSetLink[0].TileMatrixSet)&&(r=!1)}r?(a="Impossible de r\u00e9cup\u00e9rer les informations depuis "+n,500>e.length&&(a+="<br><br>"+e),null!=c&&c.call(g,a)):b.call(g,f)})),function v(a){null!=v&&v.call(g,"Impossible de r\u00e9cup\u00e9rer les informations depuis "+
n);console.error("error: ",a)})};angular.element(z.b).scope().testWMSCapabilities=function(a){var b=angular.element(z.b).injector().get(["$log"]),c=angular.element(z.b).injector().get(["$timeout"]),d=angular.element(z.b).injector().get(["envSrvc"]);b.info("testWMSCapabilities");var e=this,f=angular.copy(d.oFormValues[d.sFormDefinitionName].url),b=angular.copy(d.oFormValues[d.sFormDefinitionName].name);if(null==f||""===f)return $.notify("Lien non d\u00e9fini","error"),null;if(null==b||""===b)return $.notify("Nom non d\u00e9fini",
"error"),null;if(0<f.toLowerCase().indexOf("service="))return $.notify('Veuillez ne pas utiliser le param\u00e8tre SERVICE dans le champ "Lien"',"error"),null;if(0<f.toLowerCase().indexOf("request="))return $.notify('Veuillez ne pas utiliser le param\u00e8tre REQUEST dans le champ "Lien"',"error"),null;if(0<f.toLowerCase().indexOf("version="))return $.notify('Veuillez ne pas utiliser le param\u00e8tre VERSION dans le champ "Lien"',"error"),null;this.getCapabilities(f).then(function(b){null!=b?null!=
b.json?($.notify("Service valide","success"),c(function(){if(a){d.oFormValues[d.sFormDefinitionName].url=Sd(f);var c=d.oFormDefinition[d.sFormDefinitionName].name,g=angular.element("form[name='"+c+"']").scope();g[c].$setPristine();g.sendForm()}else e.showLayerModalWindow({capabilities:b,service_url:f})})):$.notify("Service non valide","error"):$.notify("Service non valide","error")})};angular.element(z.b).scope().cloneService=function(){var a=angular.element(z.b).injector().get(["$log"]);angular.element(z.b).injector().get(["envSrvc"]);
angular.element(z.b).injector().get(["formSrvc"]);a.info("cloneService")};angular.element(z.b).scope().initVmapLayerForm=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["Restangular"]),c=angular.element(z.b).injector().get(["envSrvc"]),d=angular.element(z.b).injector().get(["sessionSrvc"]),e=angular.element(z.b).injector().get(["propertiesSrvc"]);a.info("initVmapLayerForm");this.showStudioIfLayerIsFiltered();var f=angular.element(z.b).scope();
b.one(e.services_alias+"/vmap","services").customGET("",{token:d.token}).then(function(a){if(1==a.status&&0<a.list_count){var b={};a.services.forEach(function(a){b[a.service_id]=a});f.oServices=b;"update"==c.sMode&&f.$root.setVmapLayerForm()}});a=c.oFormValues[c.sFormDefinitionName].service_type_id;if(("tilewms"==a||"imagewms"==a)&&"update"==c.sMode){a=angular.element("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name+"'] .ui-grid-form-field-data").scope().$parent.gridOptions;e=c.oFormValues[c.sFormDefinitionName].layer_list;
b=[];d=[];null!=e&&(b=e.split(","));for(e=b.length-1;0<=e;e--)d.push({name:b[e]});a.data=d}"insert"==c.sMode?setTimeout(function(){document.querySelector("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name+"'] select[name='service_id']").addEventListener("change",function(){f.$root.setVmapLayerForm(this.value);angular.element("form[name='"+c.oFormDefinition[c.sFormDefinitionName].name+"']").scope().$apply()})}):f.$root.setVmapLayerForm(c.oFormValues[c.sFormDefinitionName].service_id)};angular.element(z.b).scope().setVmapLayerForm=
function(a){var b=angular.element(z.b).injector().get(["$log"]);angular.element(z.b).injector().get(["$http"]);var c=angular.element(z.b).injector().get(["$timeout"]),d=angular.element(z.b).injector().get(["envSrvc"]),e=angular.element(z.b).injector().get(["formSrvc"]);b.info("setVmapLayerForm");var f=angular.element(z.b).scope(),g=this,h={xyz:"layer_id service_id service_name name layertheme_id theme_name bo_id form_submit return_list".split(" "),osm:"layer_id service_id service_name name layertheme_id theme_name bo_id form_submit return_list".split(" "),
bing:"layer_id service_id service_name name layertheme_id theme_name bo_id form_submit return_list".split(" "),tilewms:"layer_id service_id service_name name description layertheme_id theme_name layer_list bo_id is_dynamic is_filtered form_submit return_list".split(" "),imagewms:"layer_id service_id service_name name description layertheme_id theme_name layer_list bo_id is_dynamic is_filtered form_submit return_list".split(" "),wmts:"layer_id service_id service_name name description layertheme_id theme_name wmts_layer matrix_set layer_style layer_format layer_options bo_id form_submit return_list".split(" ")},
l,e=e.getAllFormElementDefinition(d.sFormDefinitionName);null==a&&(a=d.oFormValues[d.sFormDefinitionName].service_id,null!=a.selectedOption&&null!=a.selectedOption.value&&(a=a.selectedOption.value));"insert"===d.sMode?null!=f.oServices[a]&&(l=f.oServices[a].service_type_id,d.oFormValues[d.sFormDefinitionName].service_type_id=l,null!=f.oServices[a].url&&(d.oFormValues[d.sFormDefinitionName].service_url=f.oServices[a].url)):l=d.oFormValues[d.sFormDefinitionName].service_type_id;e.forEach(function(a){null!=
h[l]&&("button"===a.type?(a=a.buttons,null!=a&&a.forEach(function(a){a.visible=-1===h[l].indexOf(a.name)?!1:!0})):a.visible=-1!==h[l].indexOf(a.name)?!0:!1)});if("wmts"===l){var n=d.oFormValues[d.sFormDefinitionName].wmts_layer,r=d.oFormValues[d.sFormDefinitionName].matrix_set,t=d.oFormValues[d.sFormDefinitionName].layer_style,v=d.oFormValues[d.sFormDefinitionName].layer_format,n=null!=n?n:{options:[],selectedOption:{value:""}},r=null!=r?r:{options:[],selectedOption:{value:""}},t=null!=t?t:{options:[],
selectedOption:{value:""}},v=null!=v?v:{options:[],selectedOption:{value:""}};c(function(){"update"===d.sMode?(n.selectedOption.value=d.oFormValues[d.sFormDefinitionName].layer_list,fa(n.options)&&0===n.options.length&&(n.options=[{label:n.selectedOption.value,value:n.selectedOption.value}]),fa(r.options)&&0===r.options.length&&(r.options=[{label:r.selectedOption.value,value:r.selectedOption.value}]),fa(t.options)&&0===t.options.length&&(t.options=[{label:t.selectedOption.value,value:t.selectedOption.value}]),
fa(v.options)&&0===v.options.length&&(v.options=[{label:v.selectedOption.value,value:v.selectedOption.value}])):"display"===d.sMode&&(d.oFormValues[d.sFormDefinitionName].wmts_layer=d.oFormValues[d.sFormDefinitionName].layer_list)});var x=function(a){var b=[];if(null!=a.Contents&&fa(a.Contents.Layer)){a=a.Contents.Layer;for(var c=0;c<a.length;c++)b.push({label:a[c].Title,value:a[c].Identifier})}return b},y=function(a,b){var c=[],d=[],e=[];if(null!=b&&null!=b.value&&(b=b.value,null!=a.Contents)){if(null!=
a.Contents.Layer)for(var f=a.Contents.Layer,g=0;g<f.length;g++)if(f[g].Identifier===b&&null!=f[g].TileMatrixSetLink)for(var h=0;h<f[g].TileMatrixSetLink.length;h++)p(f[g].TileMatrixSetLink[h].TileMatrixSet)&&e.push(f[g].TileMatrixSetLink[h].TileMatrixSet);if(null!=a.Contents.TileMatrixSet&&0<e.length)for(g=0;g<a.Contents.TileMatrixSet.length;g++)-1!==e.indexOf(a.Contents.TileMatrixSet[g].Identifier)&&d.push(a.Contents.TileMatrixSet[g]);if(0<d.length)for(g=0;g<d.length;g++)c.push({label:d[g].Identifier+
" ("+d[g].SupportedCRS+")",value:d[g].Identifier})}return c},B=function(a,b){var c=[],d=[];if(null!=b&&null!=b.value&&(b=b.value,null!=a.Contents)){if(null!=a.Contents.Layer){a=a.Contents.Layer;for(var e=0;e<a.length;e++)a[e].Identifier===b&&null!=a[e].Style&&(d=a[e].Style)}if(0<d.length)for(e=0;e<d.length;e++)c.push({label:d[e].Identifier,value:d[e].Identifier})}return c},E=function(a,b){var c=[],d=[];if(null!=b&&null!=b.value&&(b=b.value,null!=a.Contents)){if(null!=a.Contents.Layer){a=a.Contents.Layer;
for(var e=0;e<a.length;e++)a[e].Identifier===b&&null!=a[e].Format&&(d=a[e].Format)}if(0<d.length)for(e=0;e<d.length;e++)c.push({label:d[e],value:d[e]})}return c},I=function(a){var e=x(a),f,h,l;c(function(){null!=n&&(n.options=e)});g.wmtsLayerSelected=function(){b.info("wmtsLayerSelected");null!=n&&null!=n.selectedOption&&null!=n.selectedOption.value&&(f=y(a,n.selectedOption),h=B(a,n.selectedOption),l=E(a,n.selectedOption),c(function(){null!=r&&(r.options=f,d.oFormValues[d.sFormDefinitionName].matrix_set=
r);null!=t&&(t.options=h,d.oFormValues[d.sFormDefinitionName].layer_style=t);null!=v&&(v.options=l,d.oFormValues[d.sFormDefinitionName].layer_format=v);d.oFormValues[d.sFormDefinitionName].layer_list=n.selectedOption.value}))};null!=n&&null!=n.selectedOption&&null!=n.selectedOption.value&&0<n.selectedOption.value.length&&g.wmtsLayerSelected()};a=f.oServices[a];null!=a&&"display"!==d.sMode&&(null!=a.service_options?(a=JSON.parse(a.service_options),I(a)):this.WMTSCapabilities({serviceUrl:a.url,serviceVersion:a.service_type_version,
WMTSType:a.service_type_type},function(a){I(a)}))}"insert"==d.sMode&&(a=document.querySelector("form[name='"+d.oFormDefinition[d.sFormDefinitionName].name+"'] .ui-grid-form-field-data"),null!=a&&(angular.element(a).scope().$parent.gridOptions.data.length=0))};angular.element(z.b).scope().loadVmapMapLayers=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["$translate"]),c=angular.element(z.S).injector().get(["envSrvc"]);a.info("loadVmapMapLayers");
var d=this,e=c.oSelectedObject.sorted_by,f=c.oSelectedObject.sorted_dir,g=angular.copy(c.oGridOptionsCopy[c.oSelectedObject.name].oUrlParams);c.oSelectedObject.sorted_by="layer_index";c.oSelectedObject.sorted_dir="ASC";a=document.getElementById("container_section_"+c.oSelectedObject.name+"_layers");a.className+=" section-container-workspace-list";d.gridOptions={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!1,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:999,
enableColumnMenus:!1,enableColumnResizing:!0,paginationPageSizes:[10,20,50,100],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!1,appHeaderOptionBar:!1,appLoadGridData:!0,aFilter:["map_id="+c.sId],appGridTitle:"TITLE_GRID_MAP_LAYERS_VMAP_MAP_MAP_LAYERS",appFooter:!1,appShowPagination:!1,appEnableDragAndDrop:!0,appDragAndDropEvent:{rowFinishDrag:"updateMapLayerSorting"},appActions:[],oUrlParams:{order_by:"layer_index",sort_order:"DESC"}};c.oGridOptionsCopy[c.oSelectedObject.name].oUrlParams=
angular.copy(d.gridOptions.oUrlParams);d.bLoadFormValues=!1;b(["FORM_MAP_ID_VMAP_MAP_MAP","FORM_NAME_VMAP_MAP_MAP","FORM_THEME_VMAP_MAP_MAP","FORM_VISIBLE_VMAP_MAP_MAP_LAYERS","FORM_OPACITY_VMAP_MAP_MAP_LAYERS"]).then(function(a){d.gridOptions.columnDefs=[{name:a.FORM_MAP_ID_VMAP_MAP_MAP,displayName:a.FORM_MAP_ID_VMAP_MAP_MAP,field:"layer_id",width:50,enableSorting:!1,type:"number",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+c.oSelectedObject.name+"_layer_id",
cellClass:"cell-align-right"},{name:a.FORM_NAME_VMAP_MAP_MAP,displayName:a.FORM_NAME_VMAP_MAP_MAP,field:"name",width:250,enableSorting:!1,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+c.oSelectedObject.name+"_name"},{name:a.FORM_THEME_VMAP_MAP_MAP,displayName:a.FORM_THEME_VMAP_MAP_MAP,field:"theme_name",width:200,enableSorting:!1,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+c.oSelectedObject.name+"_theme_name"},
{name:a.FORM_VISIBLE_VMAP_MAP_MAP_LAYERS,displayName:a.FORM_VISIBLE_VMAP_MAP_MAP_LAYERS,field:"layer_visible",width:60,enableSorting:!1,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,cellTemplate:'<div data-app-set-boolean-icon-column="{{row.entity[col.field]}}"></div>',headerCellClass:"vmap_map_layers_"+c.oSelectedObject.name+"_layer_visible"},{name:a.FORM_OPACITY_VMAP_MAP_MAP_LAYERS,displayName:a.FORM_OPACITY_VMAP_MAP_MAP_LAYERS,field:"layer_opacity",width:65,enableSorting:!1,type:"number",
enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+c.oSelectedObject.name+"_layer_opacity",cellClass:"cell-align-right",cellTemplate:'<div data-app-map-layers-opacity-column="{{row.entity.layer_id}}" class="cell-input-type-text"><input type="number" class="form-control" min="0" max="100"></div>'}]});if("update"==c.sMode){b(["BTN_VISIBLE_VMAP_MAP_MAP_LAYERS","BTN_INVISIBLE_VMAP_MAP_MAP_LAYERS","BTN_ADD_LAYERS_VMAP_MAP_MAP_LAYERS","BTN_DELETE_LAYERS_VMAP_MAP_MAP_LAYERS"]).then(function(a){d.gridOptions.appActions=
[{label:a.BTN_ADD_LAYERS_VMAP_MAP_MAP_LAYERS,name:d.sSelectedObjectName+"_add_layer_btn",event:"showAddLayersToMapModalWindow()"},{label:a.BTN_DELETE_LAYERS_VMAP_MAP_MAP_LAYERS,name:d.sSelectedObjectName+"_delete_layer_btn",event:"deleteMapLayers()"},{label:a.BTN_VISIBLE_VMAP_MAP_MAP_LAYERS,name:d.sSelectedObjectName+"_visible_btn",event:"setMapLayerVisibility(true)"},{label:a.BTN_INVISIBLE_VMAP_MAP_MAP_LAYERS,name:d.sSelectedObjectName+"_invisible_btn",event:"setMapLayerVisibility(false)"}]});var h=
d.$root.$on("workspaceListTplCompiled",function(){h();var a=document.querySelector("#"+c.oSelectedObject.name+"_grid .workspacelist-grid-data"),b=d.sSelectedObjectName+"_layer_up_btn",r=d.sSelectedObjectName+"_layer_down_btn";angular.element(a).append('<button type="button" id="'+b+'" class="btn btn-sm btn-primary map-layer-order-up" aria-label="Left Align"><span class="glyphicon glyphicon-chevron-up"></span></button>');angular.element(a).append('<button type="button" id="'+r+'" class="btn btn-sm btn-primary map-layer-order-down" aria-label="Left Align"><span class="glyphicon glyphicon-chevron-down"></span></button>');
document.getElementById(b).addEventListener("click",function(){d.$root.changeMapLayerSorting("up")});document.getElementById(r).addEventListener("click",function(){d.$root.changeMapLayerSorting("down")});c.oSelectedObject.sorted_by=e;c.oSelectedObject.sorted_dir=f;c.oGridOptionsCopy[c.oSelectedObject.name].oUrlParams=angular.copy(g)})}};angular.element(z.b).scope().showAddLayersToMapModalWindow=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.S).injector().get(["$compile"]),
c=angular.element(z.S).injector().get(["$templateRequest"]),d=angular.element(z.S).injector().get(["$translate"]),e=angular.element(z.b).injector().get(["envSrvc"]);angular.element(z.b).injector().get(["formSrvc"]);var f=angular.element(z.S).injector().get(["uiGridConstants"]),g=angular.element(z.b).injector().get(["modesSrvc"]);angular.element(z.b).injector().get(["propertiesSrvc"]);a.info("showAddLayersToMapModalWindow");var h=this.$new();g.addScopeToObject(e.oSelectedObject.name,e.oSelectedMode.mode_id,
h);var l=g.getObject(e.oSelectedObject.name,g.getMode(e.oSelectedMode.mode_id)),n=e.sMode;e.oSelectedObject={actions:[],columns:[],mode_id:l.mode_id,name:l.name+"_available_layers",ressource_id:"vmap/layers",sections:"",template_name:""};e.sMode="search";h.sSelectedObjectName=e.oSelectedObject.name;h.gridOptions={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:100,enableColumnMenus:!1,enableColumnResizing:!0,paginationPageSizes:[10,
20,50,100],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!0,appHeaderOptionBar:!1,appLoadGridData:!0,appGridTitle:"TITLE_GRID_AVAILABLE_LAYERS_VMAP_MAP_MAP_LAYERS",appResizeGrid:!0,appFooter:!0,appShowPagination:!0,appActions:[]};d(["FORM_MAP_ID_VMAP_MAP_MAP","FORM_NAME_VMAP_MAP_MAP","FORM_THEME_VMAP_MAP_MAP","FORM_COORDINATE_SYSTEM_VMAP_MAP_LAYER","FORM_DESCRIPTION_VMAP_MAP_LAYER"]).then(function(a){h.gridOptions.columnDefs=[{name:a.FORM_MAP_ID_VMAP_MAP_MAP,displayName:a.FORM_MAP_ID_VMAP_MAP_MAP,
field:"layer_id",width:50,enableSorting:!0,type:"number",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+"_layer_id"},{name:a.FORM_NAME_VMAP_MAP_MAP,displayName:a.FORM_NAME_VMAP_MAP_MAP,field:"name",width:380,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+"_name",sort:{direction:f.ASC,ignoreSort:!0,priority:0}},{name:a.FORM_THEME_VMAP_MAP_MAP,displayName:a.FORM_THEME_VMAP_MAP_MAP,
field:"theme_name",width:200,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+"_theme_name"},{name:a.FORM_DESCRIPTION_VMAP_MAP_LAYER,displayName:a.FORM_DESCRIPTION_VMAP_MAP_LAYER,field:"description",width:150,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+e.oSelectedObject.name+"_crs_list",cellTemplate:'<div data-app-layer-description-column="{{row.entity[col.field]}}"></div>'}]});
"display"!=e.sMode&&d(["BTN_ADD_VMAP_MAP_MAP_LAYERS"]).then(function(a){h.gridOptions.appActions=[{label:a.BTN_ADD_VMAP_MAP_MAP_LAYERS,name:h.sSelectedObjectName+"_add_layer_btn",event:"addLayersToMap()"}]});a=e.oGridOptions[l.name].data;if(0<a.length){d=0;for(g=[];d<a.length;)g.push(a[d].layer_id),d++;e.oSelectedObject.filter=["layer_id NOT IN("+g.join(",")+")"]}var r="container_"+e.oSelectedObject.name+"_available_layers";h.modalWindow("dialog",null,{className:"dialog-modal-window dialog-modal-window-workspace-list dialog-modal-window-available-layers",
message:'<div id="'+r+'" class="col-xs-12"></div>'}).then(function(a){$(a).on("shown.bs.modal",function(){var a=document.querySelector(".dialog-modal-window-available-layers > .modal-dialog");a.className+=" modal-lg";c("templates/workspaceListTpl.html").then(function(a){b($("#"+r).html(a).contents())(h)})});$(a).on("hide.bs.modal",function(){e.oSelectedObject=l;e.sMode=n;h.$root.refreshGrid(h.$root.gridApi[e.oSelectedObject.name].grid.appScope,e.oGridOptions[e.oSelectedObject.name])})})};angular.element(z.b).scope().setMapLayerVisibility=
function(a){var b=angular.element(z.b).injector().get(["$log"]),c=angular.element(z.b).injector().get(["$translate"]),d=angular.element(z.b).injector().get(["Restangular"]),e=angular.element(z.b).injector().get(["envSrvc"]),f=angular.element(z.b).injector().get(["sessionSrvc"]),g=angular.element(z.b).injector().get(["propertiesSrvc"]);b.info("setMapLayerVisibility");var h=this;a={token:f.token,visibility:""+a,map_id:e.sId};b=h.$root.gridApi[e.oSelectedObject.name].selection.getSelectedRows();if(0<
b.length){for(var l=0,n=[];l<b.length;)n.push(b[l].layer_id),l++;a.map_layers=n.join("|");d.one(g.services_alias+"/vmap","maplayers").customPUT(a,e.sId+"/visibility",{token:f.token}).then(function(a){0==a.status?h.modalWindow("dialog","ERROR_MAP_LAYER_VISIBILITY_VMAP_MAP_MAP_LAYERS",{className:"modal-danger",message:a.errorMessage}):(h.$root.gridApi[e.oSelectedObject.name].selection.clearSelectedRows(),h.refreshGrid(h,h.gridOptions),c("SUCCESSFUL_OPERATION").then(function(a){$.notify(a,"success")}))})}};
angular.element(z.b).scope().addLayersToMap=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["$translate"]),c=angular.element(z.b).injector().get(["Restangular"]),d=angular.element(z.b).injector().get(["envSrvc"]),e=angular.element(z.b).injector().get(["sessionSrvc"]),f=angular.element(z.b).injector().get(["propertiesSrvc"]);a.info("addLayersToMap");var g=this,a={token:e.token,map_id:d.sId},h=g.$root.gridApi[d.oSelectedObject.name].selection.getSelectedRows();
if(0<h.length){for(var l=0,n=[];l<h.length;)n.push(h[l].layer_id),l++;a.map_layers=n.join("|");c.one(f.services_alias+"/vmap","maplayers").customPUT(a,d.sId,{token:e.token}).then(function(a){0==a.status?g.modalWindow("dialog","ERROR_ADD_MAP_LAYERS_VMAP_MAP_MAP_LAYERS",{className:"modal-danger",message:a.errorMessage}):(bootbox.hideAll(),b("SUCCESSFUL_OPERATION").then(function(a){$.notify(a,"success")}))})}};angular.element(z.b).scope().deleteMapLayers=function(){var a=angular.element(z.b).injector().get(["$log"]),
b=angular.element(z.b).injector().get(["$translate"]),c=angular.element(z.b).injector().get(["Restangular"]),d=angular.element(z.b).injector().get(["envSrvc"]),e=angular.element(z.b).injector().get(["sessionSrvc"]),f=angular.element(z.b).injector().get(["propertiesSrvc"]);a.info("deleteMapLayers");var g=this,a={token:e.token,map_id:d.sId},e=g.$root.gridApi[d.oSelectedObject.name].selection.getSelectedRows();if(0<e.length){for(var h=0,l=[];h<e.length;)l.push(e[h].layer_id),h++;a.idList=l.join("|");
c.one(f.services_alias+"/vmap","maplayers").customDELETE(d.sId,a).then(function(a){0==a.status?g.modalWindow("dialog","ERROR_DELETE_MAP_LAYER_VMAP_MAP_MAP_LAYERS",{className:"modal-danger",message:a.errorMessage}):(g.$root.gridApi[d.oSelectedObject.name].selection.clearSelectedRows(),g.refreshGrid(g,g.gridOptions),b("SUCCESSFUL_OPERATION").then(function(a){$.notify(a,"success")}))})}};angular.element(z.b).scope().changeMapLayerSorting=function(a){var b=angular.element(z.b).injector().get(["$log"]);
angular.element(z.b).injector().get(["$translate"]);angular.element(z.b).injector().get(["Restangular"]);var c=angular.element(z.b).injector().get(["envSrvc"]),d=angular.element(z.b).injector().get(["sessionSrvc"]);angular.element(z.b).injector().get(["propertiesSrvc"]);b.info("changeMapLayerSorting");var b={token:d.token,map_id:c.sId},e=c.oGridOptions[c.oSelectedObject.name],f=this.$root.gridApi[c.oSelectedObject.name].selection.getSelectedRows();if(0<f.length){for(var g=!1,h=0,l=[];h<f.length;)e.data.forEach(function(a,
b){a.$$hashKey==f[h].$$hashKey&&l.push(b)}),h++;"up"==a&&l.forEach(function(a,b){0<a&&a>b&&(b=e.data.splice(a,1),e.data.splice(a-1,0,b[0]),g=!0)});l.reverse();"down"==a&&l.forEach(function(a,b){a<e.data.length-1&&a<e.data.length-1-b&&(b=e.data.splice(a,1),e.data.splice(a+1,0,b[0]),g=!0)});h=0;for(a=[];h<e.data.length;)a.push(e.data[h].layer_id),h++;b.map_layers=a.join("|");g&&this.$root.updateMapLayerSorting()}};angular.element(z.b).scope().updateMapLayerSorting=function(){var a=angular.element(z.b).injector().get(["$log"]),
b=angular.element(z.b).injector().get(["Restangular"]),c=angular.element(z.b).injector().get(["envSrvc"]),d=angular.element(z.b).injector().get(["sessionSrvc"]),e=angular.element(z.b).injector().get(["propertiesSrvc"]);a.info("updateMapLayerSorting");for(var f=this,a={token:d.token,map_id:c.sId},g=c.oGridOptions[c.oSelectedObject.name],h=0,l=[],h=g.data.length-1;0<=h;h--)l.push(g.data[h].layer_id);a.map_layers=l.join("|");b.one(e.services_alias+"/vmap","maplayers").customPUT(a,c.sId+"/sorting",{token:d.token}).then(function(a){0==
a.status&&f.modalWindow("dialog","ERROR_ADD_MAP_LAYERS_VMAP_MAP_MAP_LAYERS",{className:"modal-danger",message:a.errorMessage})})};z.Yt=function(a){return{link:function(b,c,d){var e=d.$observe("appLayerThemeDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_LAYER_THEME"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_LAYER_THEME},
content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};z.Yt.$inject=["$translate"];z.compileProvider.directive("appLayerThemeDescriptionColumn",z.Yt);z.gu=function(a){return{link:function(b,c,d){var e=d.$observe("appMapThemeDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",
a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP_THEME"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP_THEME},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};z.gu.$inject=["$translate"];z.compileProvider.directive("appMapThemeDescriptionColumn",z.gu);z.iu=function(a){return{link:function(b,
c,d){var e=d.$observe("appModuleDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});
b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};z.iu.$inject=["$translate"];z.compileProvider.directive("appModuleDescriptionColumn",z.iu);angular.element(z.b).scope().loadVmapUser=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["envSrvc"]);a.info("loadVmapUser");a=b.oSelectedObject.name;this.oFormRequestParams={sUrl:"modules/vmap/forms/"+b.oSelectedMode.mode_id+"/"+a+"_"+b.oSectionForm[a].sections[b.oSectionForm[a].iSelectedSectionIndex].name+
".json"}};angular.element(z.b).scope().beforeVmapAdminPrintVmapAdminTemplateEdition=function(){var a=angular.element(z.b).injector().get(["$log"]);angular.element(z.b).injector().get(["envSrvc"]);angular.element(z.b).injector().get(["formSrvc"]);a.info("beforeVmapAdminPrintVmapAdminTemplateEdition")};angular.element(z.b).scope().beforeVmapAdminTemplateSubmit=function(){var a=angular.element(z.b).injector().get(["$log"]);angular.element(z.b).injector().get(["$q"]);angular.element(z.b).injector().get(["envSrvc"]);
angular.element(z.b).injector().get(["formSrvc"]);a.info("beforeVmapAdminTemplateSubmit")};z.mu=function(a){return{link:function(b,c,d){var e=d.$observe("appPrintParameterPlaceholderColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["PLACEHOLDER_TOOLTIP_TITLE_VMAP_PRINT_PARAMETER"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.PLACEHOLDER_TOOLTIP_TITLE_VMAP_PRINT_PARAMETER},
content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};z.mu.$inject=["$translate"];z.compileProvider.directive("appPrintParameterPlaceholderColumn",z.mu);z.lu=function(a){return{link:function(b,c,d){var e=d.$observe("appPrintParameterDefaultValueColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className=
"ui-grid-cell-contents info-icon",a(["PLACEHOLDER_TOOLTIP_TITLE_VMAP_PRINT_PARAMETER"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.PLACEHOLDER_TOOLTIP_TITLE_VMAP_PRINT_PARAMETER},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};z.lu.$inject=["$translate"];z.compileProvider.directive("appPrintParameterDefaultValueColumn",
z.lu);z.sA=function(){return{link:function(a,b,c){var d=c.$observe("appMapLayersOpacityColumn",function(){var c=b[0].querySelector("input[type='number']");c.value=a.row.entity[a.col.field];c.setAttribute("data-layer-id",a.row.entity.layer_id)});b[0].querySelector("input[type='number']").addEventListener("change",a.$root.setMapLayerOpacity);a.$on("$destroy",function(){d();b[0].querySelector("input[type='number']").removeEventListener("change",a.$root.setMapLayerOpacity)})}}};z.compileProvider.directive("appMapLayersOpacityColumn",
z.sA);angular.element(z.b).scope().setMapLayerOpacity=function(a){var b=angular.element(z.b).injector().get(["$log"]),c=angular.element(z.b).injector().get(["Restangular"]),d=angular.element(z.b).injector().get(["envSrvc"]),e=angular.element(z.b).injector().get(["sessionSrvc"]),f=angular.element(z.b).injector().get(["propertiesSrvc"]);angular.element(z.b).injector().get(["formSrvc"]);b.info("setMapLayerOpacity");var g=angular.element(z.b).scope(),b=parseInt(a.target.value);0>b?b=0:100<b&&(b=100);
a.target.value=b;a={token:e.token,map_id:d.sId,layer_id:a.target.getAttribute("data-layer-id"),layer_opacity:b};c.one(f.services_alias+"/vmap","maplayers").customPUT(a,d.sId+"/opacity",{token:e.token}).then(function(a){0==a.status?g.modalWindow("dialog","ERROR_ADD_MAP_LAYERS_VMAP_MAP_MAP_LAYERS",{className:"modal-danger",message:a.errorMessage}):g.$root.refreshGrid(g.$root.gridApi[d.oSelectedObject.name].grid.appScope,d.oGridOptions[d.oSelectedObject.name])})};angular.element(z.b).scope().initOLMapExtent=
function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["envSrvc"]);a.info("initOLMapExtent");setTimeout(function(){var a=angular.element($("#vmap_map_map_extent")).scope().oMap.X;angular.element(z.b).scope().updateOLMapExtent();a.on("moveend",function(){angular.element(z.b).scope().updateExtent()});document.querySelector("form[name='"+b.oFormDefinition[b.sFormDefinitionName].name+"'] select[name='crs_id']").addEventListener("change",function(){angular.element(z.b).scope().updateExtent()})},
1E3)};angular.element(z.b).scope().updateExtent=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["envSrvc"]),c=angular.element(z.b).injector().get(["formSrvc"]);a.info("updateExtent");var d=[],a=c.getFormElementDefinition("map_extent",b.sFormDefinitionName,b.oFormDefinition).map_options.center.extent,c=H(angular.element($("#vmap_map_map_extent")).scope().oMap.X).D().M;Lf(a,c,b.oFormValues[b.sFormDefinitionName].crs_id.selectedOption.value).forEach(function(a){d.push(Math.round(a))});
b.oFormValues[b.sFormDefinitionName].extent=d.join("|");b=angular.element($("[name=vmap_map_update_form]")).scope();a=angular.element($("[name=vmap_map_insert_form]")).scope();null!=b&&b.$apply();null!=a&&a.$apply()};angular.element(z.b).scope().updateOLMapExtent=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["envSrvc"]),c=angular.element(z.b).injector().get(["formSrvc"]);a.info("updateOLMapExtent");if(null==b.oFormValues[b.sFormDefinitionName].extent)return angular.element(z.b).scope().updateExtent(),
0;c.getFormElementDefinition("map_extent",b.sFormDefinitionName,b.oFormDefinition);for(var a=angular.element($("#vmap_map_map_extent")).scope().oMap.X,c=b.oFormValues[b.sFormDefinitionName].extent.split("|"),d=0;d<c.length;d++)c[d]=parseFloat(c[d]);d=H(a).D().M;b=Lf(c,b.oFormValues[b.sFormDefinitionName].crs_id.selectedOption.value,d);Lk(H(a),b,a.ja(),{Ai:!0})};angular.element(z.b).scope().showAddLayersToLayerModalWindow=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.S).injector().get(["$translate"]),
c=angular.element(z.b).injector().get(["envSrvc"]),d=angular.element(z.b).injector().get(["sessionSrvc"]),e=angular.element(z.b).injector().get(["propertiesSrvc"]);a.info("showAddLayersToLayerModalWindow");var f=this,g=c.sFormDefinitionName,h=this.$new();b(["BTN_ADD_LAYERS_VMAP_MAP_LAYER"]).then(function(a){var b=c.oFormValues[g].service_url,b=b.replace("[token]",d.token),b=b.replace("[ms_cgi_url]",e.ms_cgi_url);f.showLayerModalWindow({service_url:b,buttons:[{label:a.BTN_ADD_LAYERS_VMAP_MAP_LAYER,
name:h.sSelectedObjectName+"_add_layer_btn",event:"addLayersToLayer('"+g+"')"}]})})};angular.element(z.b).scope().showLayerModalWindow=function(a){function b(a){if(null!=a&&null!=a.json&&null!=a.xml){var b=[],c=[],g=function(a){if(void 0===a.Layer)c.push(a);else for(var b=0;b<a.Layer.length;b++)g(a.Layer[b])};if("undefined"!=typeof a){var l=[],n=h.oFormValues[t].layer_list;null!=n&&(l=n.split(","));g(a.json.Capability.Layer);for(n=0;n<c.length;n++)-1==l.indexOf(c[n].Name)&&b.push({name:c[n].Name,
description:c[n].Title,crs_list:null!=c[n].CRS?c[n].CRS.join(","):[]})}gb(b,function(a){return a.name});B.gridOptions.data=b;B.gridOptions.totalItems=b.length;var r="container_"+h.oSelectedObject.name+"_wms_layers";B.modalWindow("dialog",null,{className:"dialog-modal-window dialog-modal-window-workspace-list dialog-modal-window-wms_layers",message:'<div id="'+r+'" class="col-xs-12"></div>'}).then(function(b){$(b).on("shown.bs.modal",function(){var b=document.querySelector(".dialog-modal-window-wms_layers > .modal-dialog");
b.className+=" modal-lg";f("modules/vmap/template/vitis/serviceLayers.html").then(function(b){e($("#"+r).html(b).contents())(B);var g=angular.element($("#"+r)).scope();f("templates/workspaceListTpl.html").then(function(a){e($("#"+r).find("#service_layers_layers_list").html(a).contents())(B)});null!=g&&(g.$applyAsync(function(){g.xml=a.xml;g.codemirror_options={lineWrapping:!0,lineNumbers:!0,readOnly:"nocursor",mode:"xml"}}),$("#"+r).find("#service_layers_capabilities_codemirror").find(".CodeMirror").css("height",
"100%"));var h=!1;g.showOlMap=function(){h||d.get("modules/vmap/forms/vmap_admin_map/vmap_admin_map_vmap_layers_openlayers_test.json").success(function(a){h=!0;for(var b=angular.element($("#"+r).find("#service_layers_layers_ol_formreader").children()).scope(),d=a.update.rows[0].fields[0],e=[{extent:[-1901744.2199433097,4779520.942381757,2501744.2199433097,7220479.057618243],projection:"EPSG:3857"},{extent:[-2648.2345550218597,6231825.554877603,7024177.333740164,7024177.333740164],projection:"EPSG:2154"},
{extent:[-4.6307373046875,42.802734375,51.0205078125,51.0205078125],projection:"EPSG:4326"}],f=0,g=0;g<e.length;g++){for(var l=!0,n=0;n<c.length;n++)-1===(fa(c[n].CRS)?c[n].CRS:fa(c[n].SRS)?c[n].CRS:[]).indexOf(e[g].projection)&&(l=!1);if(l){f=angular.copy(g);break}}d.map_options.proj=e[f].projection;d.map_options.center={extent:e[f].extent};d.map_options.tree.children[0].view=e[f];e={name:"Service WMS",children:[]};for(g=0;g<c.length;g++)e.children.push({name:c[g].Name,layerType:"imagewms",visible:!1,
select:!0,url:v,params:{LAYERS:c[g].Name,VERSION:"1.3.0",TIMESTAMP:(new Date).getTime()},index:g+1});d.map_options.tree.children.push(e);d.style.height=$("#"+r).find("#service_layers_layers_ol").height()+"px";b.showMapLayerTree=function(){setTimeout(function(){var a=angular.element($("#"+r).find("#service_layers_layers_ol_formreader").find("#layer_test_map")).scope();a.$applyAsync(function(){a.oMap.bLayersTreeOpen=!0})})};a.update.initEvent="showMapLayerTree()";b.ctrl.setDefinitionName("update");
b.ctrl.setFormValues({display:{},insert:{},update:{}});b.ctrl.setFormDefinition(a);b.ctrl.loadForm()})}})});$(b).on("hide.bs.modal",function(){h.oSelectedObject=E;h.sMode=I;h.sFormDefinitionName=t;B.$destroy()})})}}var c=angular.element(z.b).injector().get(["$log"]),d=angular.element(z.b).injector().get(["$http"]),e=angular.element(z.S).injector().get(["$compile"]),f=angular.element(z.S).injector().get(["$templateRequest"]),g=angular.element(z.S).injector().get(["$translate"]),h=angular.element(z.b).injector().get(["envSrvc"]),
l=angular.element(z.S).injector().get(["uiGridConstants"]),n=angular.element(z.b).injector().get(["modesSrvc"]),r=angular.element(z.b).injector().get(["propertiesSrvc"]),t=h.sFormDefinitionName;a=null!=a?a:{};var v=null!=a.service_url?a.service_url:h.oFormValues[t].service_url,x=null!=a.capabilities?a.capabilities:null,y=null!=a.buttons?a.buttons:[];c.info("showLayerModalWindow");var B=this.$new(),E=n.getObject(h.oSelectedObject.name,n.getMode(h.oSelectedMode.mode_id)),I=h.sMode;h.oSelectedObject=
{actions:[],columns:[],mode_id:E.mode_id,name:E.name+"_wms_layers",sections:"",template_name:""};h.sMode="search";B.sSelectedObjectName=h.oSelectedObject.name;B.sFormDefinitionName=h.oSelectedObject.name;h.sFormDefinitionName=B.sFormDefinitionName;B.gridOptions={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!0,enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:r.rows_per_page,enableColumnMenus:!1,enableColumnResizing:!0,paginationPageSizes:[10,20,50,100],appHeader:!0,
appHeaderTitleBar:!0,appHeaderSearchForm:!1,appHeaderOptionBar:!1,appLoadGridData:!1,appGridTitle:"TITLE_GRID_VMAP_MAP_LAYER_WMS_LAYERS",appResizeGrid:!0,appFooter:!1,appShowPagination:!1,appActions:[]};g(["FORM_NAME_VMAP_MAP_LAYER_WMS_LAYERS","FORM_CRS_VMAP_MAP_LAYER_WMS_LAYERS","FORM_DESCRIPTION_VMAP_MAP_LAYER_WMS_LAYERS"]).then(function(a){B.gridOptions.columnDefs=[{name:a.FORM_NAME_VMAP_MAP_LAYER_WMS_LAYERS,displayName:a.FORM_NAME_VMAP_MAP_LAYER_WMS_LAYERS,field:"name",width:250,enableSorting:!0,
type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+h.oSelectedObject.name+"_name",sort:{direction:l.ASC,ignoreSort:!0,priority:0}},{name:a.FORM_DESCRIPTION_VMAP_MAP_LAYER_WMS_LAYERS,displayName:a.FORM_DESCRIPTION_VMAP_MAP_LAYER_WMS_LAYERS,field:"description",width:350,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+h.oSelectedObject.name+"_crs_list"},{name:a.FORM_CRS_VMAP_MAP_LAYER_WMS_LAYERS,
displayName:a.FORM_CRS_VMAP_MAP_LAYER_WMS_LAYERS,field:"crs_list",width:180,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vmap_map_layers_"+h.oSelectedObject.name+"_crs_list",cellTemplate:'<div data-app-crs-list-description-column="{{row.entity[col.field]}}"></div>'}]});g(["BTN_ADD_VMAP_MAP_MAP_LAYERS"]).then(function(){B.gridOptions.appActions=y});null!=x?b(x):null!=v&&B.$root.getCapabilities(v).then(function(a){x=a;null!=x?null!=x.xml&&null!=x.json&&
b(a):h.sFormDefinitionName=t})};angular.element(z.b).scope().getCapabilities=function(a,b){function c(a){e.get(r).success(function(c){var d;if(""==c)b.showErrorMessage&&(c={className:"modal-danger",message:"ERROR_CONTENT_NO_DATA_VMAP_MAP_LAYER_WMS_LAYERS"},l.modalWindow("dialog","ERROR_TITLE_GET_CAPABILITIES_VMAP_MAP_LAYER_WMS_LAYERS",c));else{d={xml:c};var e=(new DOMParser).parseFromString(c,"text/xml");if(null===e.querySelector("WMS_Capabilities")){d=null;if(0==c.status&&null!=c.sMessage)var f=
'<a href="'+a+'" target="_blank">'+a+"</a><br><br>",f=f+c.sMessage;null!=f||(f=null!=e.querySelector("BODY")?null!=e.querySelector("BODY").textContent?e.querySelector("BODY").textContent:$(e).find("body").html():$(e).find("body").html());b.showErrorMessage&&(c={className:"modal-danger",message:f},l.modalWindow("dialog","ERROR_TITLE_GET_CAPABILITIES_VMAP_MAP_LAYER_WMS_LAYERS",c))}else d.json=(new Wq).read(c)}n.resolve(d)}).error(function(){})}var d=angular.element(z.b).injector().get(["$log"]),e=angular.element(z.b).injector().get(["$http"]),
f=angular.element(z.b).injector().get(["$q"]),g=angular.element(z.b).injector().get(["propertiesSrvc"]),h=angular.element(z.b).injector().get(["sessionSrvc"]);d.info("getCapabilities");var l=this,n=f.defer(),d=n.promise,f={showErrorMessage:!0};"undefined"!=typeof b&&xb(f,b);b=f;a=-1===a.indexOf("?")?a+"?":a+"&";a+="service=wms&version=1.3.0&request=GetCapabilities&no_cache="+(new Date).getTime();var r=g.proxy_url+"?url="+encodeURIComponent(a);(new RegExp(/\[token\]/)).test(a)?(a=a.replace(/\[token\]/,
h.token),e({method:"GET",url:g.web_server_name+"/"+g.services_alias+"/vm4ms/wmsservices/private/MapFile",params:{token:h.token,creation:!0,type:"prod"}}).then(function(){c(a)},function(){})):c(a);return d};angular.element(z.b).scope().addLayersToLayer=function(a){var b=angular.element(z.b).injector().get(["$log"]),c=angular.element(z.b).injector().get(["envSrvc"]);b.info("addLayersToLayer");var b=angular.element("form[name='"+c.oFormDefinition[a].name+"'] .ui-grid-form-field-data").scope().$parent.gridOptions,
d=this.$root.gridApi[c.oSelectedObject.name].selection.getSelectedRows();if(0<d.length){for(var e=0,f=c.oFormValues[a].layer_list,f="string"==typeof f?f.split(","):[],e=d.length-1;0<=e;e--)delete d[e].$$hashKey,-1===f.indexOf(d[e].name)?f.unshift(d[e].name):($.notify("Calque d\u00e9j\u00e0 pr\u00e9sent: "+d[e].name,"warning"),d.splice(e,1));b.data=b.data.concat(d);b.totalItems=b.data.length;c.oFormValues[a].layer_list=f.join(",");var g=[];this.gridOptions.data.forEach(function(a){-1==d.indexOf(a)&&
g.push(a)});this.$root.gridApi[c.oSelectedObject.name].selection.clearSelectedRows();this.gridOptions.data=g}};angular.element(z.b).scope().updateLayerLayersSorting=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["envSrvc"]);a.info("updateLayerLayersSorting");a=b.sFormDefinitionName;if(null==b.oFormValues[a])return 0;var c=angular.element("form[name='"+b.oFormDefinition[b.sFormDefinitionName].name+"'] .ui-grid-form-field-data").scope().$parent.gridOptions.data;
if(0<c.length){for(var d=[],e=c.length-1;0<=e;e--)null!=c[e].name&&d.push(c[e].name);b.oFormValues[a].layer_list=d.join(",")}};angular.element(z.b).scope().removeLayersOfLayer=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["envSrvc"]);a.info("removeLayersOfLayer");var a=angular.element("form[name='"+b.oFormDefinition[b.sFormDefinitionName].name+"'] .ui-grid-form-field-data").scope().$parent.gridOptions,c=a.gridApi.selection.getSelectedRows();
if(0<c.length){var d=[],e=[];a.data.forEach(function(a){-1==c.indexOf(a)&&(d.push(a),e.unshift(a.name))});b.oFormValues[b.sFormDefinitionName].layer_list=e.join(",");a.gridApi.selection.clearSelectedRows();a.data=d}};angular.element(z.b).scope().loadVmapConfig=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.S).injector().get(["envSrvc"]);angular.element(z.S).injector().get(["propertiesSrvc"]);a.info("loadVmapConfig");angular.element(z.b).scope().setPropertiesFormValues(["vmap",
"popup","print","selection","controls"]);a=b.oSelectedObject.name;this.oFormRequestParams={sUrl:"modules/vmap/forms/"+b.oSelectedMode.mode_id+"/"+a+"_"+b.oSectionForm[a].sections[b.oSectionForm[a].iSelectedSectionIndex].name+".json"}};angular.element(z.b).scope().loadStudioVmap=function(a){var b=angular.element(z.b).injector().get(["$log"]),c=angular.element(z.S).injector().get(["envSrvc"]),d=angular.element(z.S).injector().get(["propertiesSrvc"]),e=angular.element(z.b).injector().get(["sessionSrvc"]);
b.info("loadStudioVmap");b="title subtitle label checkbox radio textarea select list double_select date datetime tinymce codemirror hidden text password email url integer float button color_picker slider hr map_osm map_bing map_vmap imageurl image_wsdata linkurl file_wsdata bo_grid section_grid".split(" ");if("business_object"===a)var f={avaliable_elems:b,avaliable_form_types:["display","search","update","insert"],default_form_type:"update",get:{api:"vmap",ressource:"businessobjects",no_result_function:"suggestGenerateForm"},
reset_default_function:"suggestColumnsToGenerateForm"};"layer_filter"===a&&(f={avaliable_elems:b,avaliable_form_types:["search"],default_form_type:"search",get:{api:"vmap",ressource:"layers",no_result_function:"useEmptyForm"}});X.reset();X.setId(c.sId);X.setApplication("vmap");X.setToken(e.token);X.setContainer("#container_section_"+c.oSelectedObject.name+"_studio");X.setAppProperties(d);null!=f&&X.oi(f)};angular.element(z.b).scope().showStudioIfLayerIsFiltered=function(){var a=angular.element(z.b).injector().get(["$log"]),
b=angular.element(z.S).injector().get(["envSrvc"]);a.info("showStudioIfLayerIsFiltered");setTimeout(function(){null!=b.oFormValues.vmap_admin_map_vmap_layers_general_update_form&&(b.oFormValues.vmap_admin_map_vmap_layers_general_update_form.is_filtered?$("#container_mode_vmap_admin_map").find(".section-form-edit-first").find(".section-form-section").show():$("#container_mode_vmap_admin_map").find(".section-form-edit-first").find(".section-form-section").hide());"insert"===b.sMode&&$("#container_mode_vmap_admin_map").find(".section-form-edit-first").find(".section-form-section-insert").hide()},
500)};angular.element(z.b).scope().importBusinessObject=function(){var a=angular.element(z.S).injector().get(["$compile"]),b=angular.element(z.b).injector().get(["$translate"]),c=this,d=!1,e=sessionStorage.privileges.split(",");fa(e)&&-1!==e.indexOf("vitis_admin")&&-1!==e.indexOf("vmap_admin")&&-1!==e.indexOf("vm4ms_admin")&&(d=!0);b(["CTRL_IMPORT_BO_ERROR_INSUFFICIENT_PRIVILEGES","CTRL_IMPORT_BO_ERROR_INSUFFICIENT_PRIVILEGES_DESCRIPTION","CTRL_IMPORT_BO_IMPORT_TITLE","CTRL_IMPORT_BO_LOADING"]).then(function(b){if(!d)return c.modalWindow("dialog",
b.CTRL_IMPORT_BO_ERROR_INSUFFICIENT_PRIVILEGES,{className:"modal-danger",message:b.CTRL_IMPORT_BO_ERROR_INSUFFICIENT_PRIVILEGES_DESCRIPTION}),0;var e=bootbox.dialog({size:"large",title:b.CTRL_IMPORT_BO_IMPORT_TITLE,message:'<div app-import-bo id="import-bo">'+b.CTRL_IMPORT_BO_LOADING+"</div>"});e.init(function(){setTimeout(function(){var b=e.find(".bootbox-body");a(b)(c)},1E3)})})};angular.element(z.b).scope().checkBoSchema=function(){var a=angular.element(z.Lb).injector().get(["$q"]),b=angular.element(z.b).injector().get(["$log"]),
c=angular.element(z.b).injector().get(["envSrvc"]),d=angular.element(z.b).injector().get(["$translate"]);b.info("checkBoSchema");for(var e=this,f=a.defer(),g=c.oFormValues[c.sFormDefinitionName].schema,a=["s_vmap","s_vitis","s_vm4ms","s_majic","s_cadastre"],b=!1,c=0;c<a.length;c++)g===a[c]&&(b=!0,d(["CREATE_BO_ON_UNRECOMMENDED_SCHEMA1","CREATE_BO_ON_UNRECOMMENDED_SCHEMA2","CREATE_BO_ON_UNRECOMMENDED_SCHEMA3"]).then(function(a){e.modalWindow("confirm","",{className:"modal-warning",message:"<b>"+a.CREATE_BO_ON_UNRECOMMENDED_SCHEMA1+
g+a.CREATE_BO_ON_UNRECOMMENDED_SCHEMA2+"<br>"+a.CREATE_BO_ON_UNRECOMMENDED_SCHEMA3+"</b>",callback:function(a){a?f.resolve():f.reject()}})}));b||setTimeout(function(){f.resolve()});return f.promise};z.St=function(a){return{link:function(b,c,d){var e=d.$observe("appBusinessObjectEventDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["FORM_DESCRIPTION_VMAP_BUSINESS_OBJECT_EVENT"]).then(function(a){$(c).popover({trigger:"hover",
container:"body",title:function(){return a.FORM_DESCRIPTION_VMAP_BUSINESS_OBJECT_EVENT},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};z.St.$inject=["$translate"];z.compileProvider.directive("appBusinessObjectEventDescriptionColumn",z.St)});z.Jz=function(a,b,c,d,e,f,g,h,l,n,r,t){a.info("initWmsServiceTests");b.aWmsServiceTestTabs={get_capabilities:{loaded:!1},openlayers_test:{loaded:!1},maplayer_test:{loaded:!1},mapserver_log:{loaded:!1,file_content:""},map_file:{loaded:!1}};t.addScopeToObject(l.oSelectedObject.name,l.oSelectedMode.mode_id,b);b.showWmsServiceGetCapabilities=function(c){a.info("showWmsServiceGetCapabilities");if(null!=h.ms_cgi_url&&""!=h.ms_cgi_url){if(!b.aWmsServiceTestTabs.get_capabilities.loaded||!0===c){c=g.one(h.services_alias+
"/vm4ms/WmsServices","MapFile");var d=new FormData;d.append("wmsservice_id",l.sId);d.append("token",n.token);d.append("type","test");if("undefined"!=typeof l.oFormValues[l.sFormDefinitionName]){var f=l.oFormValues[l.sFormDefinitionName].wms_service_login,r=l.oFormValues[l.sFormDefinitionName].wms_service_password;null!=f&&null!=r&&(d.append("user_login",f),d.append("user_password",r))}c.customPOST(d,"",{token:n.token}).then(function(a){if(1==a.status){var c=l.extractWebServiceData("wmsservices",a)[0],
d=h.ms_cgi_url+"/test/"+n.token;l.sId!=h.private_wms_service&&(d+="_"+c.wmsservice_id);b.$root.getCapabilities(d,{showErrorMessage:!1}).then(function(a){null!=a?(b.aWmsServiceTestTabs.get_capabilities.oCodeMirrorEditor.setValue(a.xml),b.oGetCapabilities=a,b.oGetCapabilities.service_url=d,"undefined"!=typeof c.layers_sources&&(b.oGetCapabilities.layers_sources=c.layers_sources)):e(function(){document.querySelector(".wms-service-tests .nav-tabs > li:nth-child(1)").style.display="none";document.querySelector(".wms-service-tests .nav-tabs > li:nth-child(2)").style.display=
"none";document.querySelector(".wms-service-tests .nav-tabs > li:nth-child(3)").style.display="none";document.querySelector(".wms-service-tests .nav-tabs > li > a[aria-controls='wms_service_tests_wms_service_log']").click()})})}else{delete b.oGetCapabilities;b.clearWmsServiceTestsTabs();b.aWmsServiceTestTabs.get_capabilities.loaded=!1;b.aWmsServiceTestTabs.openlayers_test.loaded=!1;b.aWmsServiceTestTabs.maplayer_test.loaded=!1;var f={className:"modal-danger"};null!=a.errorMessage&&(f.message=a.errorMessage);
b.$root.modalWindow("alert","REQUEST_ERROR",f)}});b.aWmsServiceTestTabs.get_capabilities.loaded=!0}}else b.$root.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:"ERROR_MS_CGI_URL_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG"})};b.testWmsServiceWithOpenLayers=function(e){a.info("testWmsServiceWithOpenLayers");null!=h.ms_cgi_url&&""!=h.ms_cgi_url?b.aWmsServiceTestTabs.openlayers_test.loaded&&!0!==e||"undefined"==typeof b.oGetCapabilities||"undefined"==typeof b.oGetCapabilities.json||
(b.sFormDefinitionName=l.sFormDefinitionName+"_openlayers_test",b.oFormRequestParams={sUrl:"modules/"+l.oSelectedMode.module_name+"/forms/"+l.oSelectedMode.mode_id+"/vm4ms_vm4ms_web_service_openlayers_test.json"},$("#wms_service_tests_wms_service_ol_map").empty(),c("templates/formTpl.html").then(function(a){d($("#wms_service_tests_wms_service_ol_map").html(a).contents())(b);var c=b.$root.$on("formDefinitionLoaded",function(){c();var a=b.$root.proj.projections[0].code;"undefined"!=typeof b.oGetCapabilities.json.Capability.Layer&&
b.$root.proj.projections.forEach(function(c){c=b.oGetCapabilities.json.Capability.Layer.CRS.indexOf(c.code);-1!=c&&"undefined"==typeof a&&(a=b.oGetCapabilities.json.Capability.Layer.CRS[c])});var d=r.getFormElementDefinition("wms_service_test_map",b.sFormDefinitionName);d.map_options.proj=a;d.map_options.tree.children[0].view.projection=a;Y.prototype.Ak();if(null!=b.oGetCapabilities.json.Capability.Layer)d.map_options.center.extent=Lf(b.oGetCapabilities.json.Capability.Layer.EX_GeographicBoundingBox,
"EPSG:4326",a);else{var e={"EPSG:3857":[-1901744.2199433097,4779520.942381757,2501744.2199433097,7220479.057618243],"EPSG:2154":[-2648.2345550218597,6231825.554877603,7024177.333740164,7024177.333740164],"EPSG:4326":[-4.6307373046875,42.802734375,51.0205078125,51.0205078125]};null!=e[a]&&(d.map_options.center.extent=e[a])}d.map_options.tree.children[0].view.extent=d.map_options.center.extent;"undefined"!=typeof b.oGetCapabilities.json.Capability.Layer&&b.oGetCapabilities.json.Capability.Layer.Layer.forEach(function(a,
c){c={name:a.Name,children:[{name:a.Name,layerType:"imagewms",visible:!0,legend:"true",select:!0,url:b.oGetCapabilities.service_url,params:{LAYERS:a.Name,VERSION:"1.3.0",TIMESTAMP:(new Date).getTime()},index:c+1}]};"undefined"!=typeof b.oGetCapabilities.layers_sources[a.Name]&&(c.children[0].attributions=[new kh({html:b.oGetCapabilities.layers_sources[a.Name]})]);d.map_options.tree.children.push(c)});var g=b.$root.$on("OpenLayersMapCreated",function(a,c){g();c.X.Dc(new Pk);b.aEventKey=[];c.X.getLayers().L().forEach(function(a){a instanceof
nm&&(b.aEventKey[b.aEventKey.length]=a.v().on(["imageloaderror","tileloaderror"],function(a){f.displayLayerLoadingError(a)}))})})})}),b.aWmsServiceTestTabs.openlayers_test.loaded=!0):b.$root.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:"ERROR_MS_CGI_URL_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG"})};b.testWmsServiceWithMapServer=function(c){a.info("testWmsServiceWithMapServer");if(null!=h.ms_cgi_url&&""!=h.ms_cgi_url){if((!b.aWmsServiceTestTabs.maplayer_test.loaded||!0===c)&&
"undefined"!=typeof b.oGetCapabilities&&"undefined"!=typeof b.oGetCapabilities.json){var d=[];"undefined"!=typeof b.oGetCapabilities.json.Capability.Layer&&b.oGetCapabilities.json.Capability.Layer.Layer.forEach(function(a){d.push(a.Name)});b.aWmsServiceTestTabs.map_file;c=h.ms_cgi_url+"/test/"+n.token;l.sId!=h.private_wms_service&&(c+="_"+l.sId);document.getElementById("wms_service_tests_wms_service_ms_iframe").contentWindow.location.href=c+"?ms_cgi_url="+h.ms_cgi_url+"&LAYERS="+d.join(" ")+"&no_cache="+
(new Date).getTime();b.aWmsServiceTestTabs.maplayer_test.loaded=!0;$("#wms_service_tests_wms_service_ms_iframe").load(function(){var a=this;$("link").each(function(){if("stylesheet"===this.rel&&"text/css"===this.type){var b=document.createElement("link");b.href=this.href;b.rel="stylesheet";b.type="text/css";a.contentWindow.document.body.appendChild(b)}});this.contentWindow.document.body.style.overflow="auto"})}}else b.$root.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:"ERROR_MS_CGI_URL_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG"})};
b.$root.refreshWmsServiceTestsTab=function(){a.info("refreshWmsServiceTestsTab");var c=l.oFormValues[l.sFormDefinitionName].wms_service_login,d=l.oFormValues[l.sFormDefinitionName].wms_service_password,e=angular.element("form[name='"+l.oFormDefinition[l.sFormDefinitionName].name).scope(),f=!0;e[l.oFormDefinition[l.sFormDefinitionName].name].wms_service_login.$setValidity("wms_service_login",!0);e[l.oFormDefinition[l.sFormDefinitionName].name].wms_service_password.$setValidity("wms_service_password",
!0);if(null!=c&&""!=c||null!=d&&""!=d){if(null==c||""==c)e[l.oFormDefinition[l.sFormDefinitionName].name].wms_service_login.$setValidity("wms_service_login",!1),e[l.oFormDefinition[l.sFormDefinitionName].name].wms_service_login.$setDirty(),f=!1;if(null==d||""==d)e[l.oFormDefinition[l.sFormDefinitionName].name].wms_service_password.$setValidity("wms_service_password",!1),e[l.oFormDefinition[l.sFormDefinitionName].name].wms_service_password.$setDirty(),f=!1}f&&($(".wms-service-tests a[href='#wms_service_tests_get_capabilities']").tab("show"),
b.showWmsServiceGetCapabilities(!0),b.aWmsServiceTestTabs.openlayers_test.loaded=!1,b.aWmsServiceTestTabs.maplayer_test.loaded=!1,b.aWmsServiceTestTabs.mapserver_log.loaded=!1,b.aWmsServiceTestTabs.map_file.loaded=!1)};b.clearWmsServiceTestsTabs=function(){a.info("clearWmsServiceTestsTabs");b.aWmsServiceTestTabs.get_capabilities.oCodeMirrorEditor.setValue("");document.getElementById("wms_service_tests_wms_service_ms_iframe").contentWindow.location.href="about:blank";$("#wms_service_tests_wms_service_ol_map").empty()};
b.loadWmsServiceMapServerLog=function(c){a.info("loadWmsServiceMapServerLog");b.aWmsServiceTestTabs.mapserver_log.loaded&&!0!==c||(g.one(h.services_alias+"/vm4ms","wmsservices").customGET(l.sId+"/MapServerLog",{token:n.token}).then(function(a){if(1==a.status)a=l.extractWebServiceData("wmsservices",a)[0],b.aWmsServiceTestTabs.mapserver_log.file_content=a.log_file_content;else{var c={className:"modal-danger"};null!=a.errorMessage&&(c.message=a.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",
c)}}),b.aWmsServiceTestTabs.mapserver_log.loaded=!0)};b.loadWmsServiceMapFile=function(c){a.info("loadWmsServiceMapFile");b.aWmsServiceTestTabs.map_file.loaded&&!0!==c||(g.one(h.services_alias+"/vm4ms","wmsservices").customGET(l.sId+"/MapFile",{wmsservice_id:l.sId,token:n.token,type:"test"}).then(function(a){if(1==a.status)a=l.extractWebServiceData("wmsservices",a)[0],b.aWmsServiceTestTabs.map_file.oCodeMirrorEditor.setValue(a.map_file_content);else{var c={className:"modal-danger"};null!=a.errorMessage&&
(c.message=a.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",c)}}),b.aWmsServiceTestTabs.map_file.loaded=!0)}};z.Jz.$inject="$log $scope $templateRequest $compile $timeout $rootScope Restangular propertiesSrvc envSrvc sessionSrvc formSrvc modesSrvc".split(" ");z.module.controller("wmsServiceTestsCtrl",z.Jz);z.Hw=function(a,b,c,d,e,f,g,h,l,n,r){a.info("initLayerTests");b.aLayerTestTabs={get_capabilities:{},openlayers_test:{loaded:!1},maplayer_test:{loaded:!1},mapserver_log:{loaded:!1,file_content:""},map_file:{loaded:!1}};r.addScopeToObject(h.oSelectedObject.name,h.oSelectedMode.mode_id,b);b.testLayerWithOpenLayers=function(e){a.info("testLayerWithOpenLayers");null!=g.ms_cgi_url&&""!=g.ms_cgi_url?b.aLayerTestTabs.openlayers_test.loaded&&!0!==e||"undefined"==typeof b.oGetCapabilities||"undefined"==typeof b.oGetCapabilities.json||
(b.sFormDefinitionName=h.sFormDefinitionName+"_openlayers_test",b.oFormRequestParams={sUrl:"modules/"+h.oSelectedMode.module_name+"/forms/"+h.oSelectedMode.mode_id+"/vm4ms_vm4ms_layer_openlayers_test.json"},$("#layer_tests_layer_ol_map").empty(),c("templates/formTpl.html").then(function(a){d($("#layer_tests_layer_ol_map").html(a).contents())(b);var c=b.$root.$on("formDefinitionLoaded",function(){c();var a=b.$root.proj.projections[0].code;"undefined"!=typeof b.oGetCapabilities.json.Capability.Layer&&
b.$root.proj.projections.forEach(function(c){c=b.oGetCapabilities.json.Capability.Layer.CRS.indexOf(c.code);-1!=c&&"undefined"==typeof a&&(a=b.oGetCapabilities.json.Capability.Layer.CRS[c])});var d=n.getFormElementDefinition("layer_test_map",b.sFormDefinitionName);d.map_options.proj=a;d.map_options.tree.children[0].view.projection=a;Y.prototype.Ak();"undefined"!=typeof b.oGetCapabilities.json.Capability.Layer&&(d.map_options.center.extent=Lf(b.oGetCapabilities.json.Capability.Layer.EX_GeographicBoundingBox,
"EPSG:4326",a));d.map_options.tree.children[0].view.extent=d.map_options.center.extent;"undefined"!=typeof b.oGetCapabilities.json.Capability.Layer&&b.oGetCapabilities.json.Capability.Layer.Layer.forEach(function(a,c){c={name:a.Name,children:[{name:a.Name,layerType:"imagewms",visible:!0,select:!0,url:b.oGetCapabilities.service_url,params:{LAYERS:a.Name,VERSION:"1.3.0",TIMESTAMP:(new Date).getTime()},index:c+1}]};"undefined"!=typeof b.oGetCapabilities.layers_sources[a.Name]&&(c.children[0].attributions=
[new kh({html:b.oGetCapabilities.layers_sources[a.Name]})]);d.map_options.tree.children.push(c)});var e=b.$root.$on("OpenLayersMapCreated",function(a,c){e();c.X.Dc(new Pk);b.aEventKey=[];c.X.getLayers().L().forEach(function(a){a instanceof nm&&(b.aEventKey[b.aEventKey.length]=a.v().on(["imageloaderror","tileloaderror"],function(a){b.$root.displayLayerLoadingError(a)}))})})})}),b.aLayerTestTabs.openlayers_test.loaded=!0):b.$root.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:"ERROR_MS_CGI_URL_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG"})};
b.testLayerWithMapServer=function(c){a.info("testLayerWithMapServer");if(null!=g.ms_cgi_url&&""!=g.ms_cgi_url)if(b.aLayerTestTabs.maplayer_test.loaded&&!0!==c)document.getElementById("layer_tests_layer_ms_iframe").contentWindow.document.body.style.overflow="hidden",setTimeout(function(){document.getElementById("layer_tests_layer_ms_iframe").contentWindow.document.body.style.overflow="auto"},100);else{if("undefined"!=typeof b.oGetCapabilities&&"undefined"!=typeof b.oGetCapabilities.json){$("#layer_tests_layer_ms_iframe").load(function(){var a=
this;$("link").each(function(){if("stylesheet"===this.rel&&"text/css"===this.type){var b=document.createElement("link");b.href=this.href;b.rel="stylesheet";b.type="text/css";a.contentWindow.document.body.appendChild(b)}});this.contentWindow.document.body.style.overflow="auto"});var d=[];"undefined"!=typeof b.oGetCapabilities.json.Capability.Layer&&b.oGetCapabilities.json.Capability.Layer.Layer.forEach(function(a){d.push(a.Name)});document.getElementById("layer_tests_layer_ms_iframe").contentWindow.location.href=
b.oGetCapabilities.service_url+"?ms_cgi_url="+g.ms_cgi_url+"&LAYERS="+d.join(" ")+"&no_cache="+(new Date).getTime();b.aLayerTestTabs.maplayer_test.loaded=!0}}else b.$root.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:"ERROR_MS_CGI_URL_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG"})};b.clearLayerTestsTabs=function(){a.info("clearLayerTestsTabs");document.getElementById("layer_tests_layer_ms_iframe").contentWindow.location.href="about:blank";$("#layer_tests_layer_ol_map").empty()};
b.loadLayerMapServerLog=function(c){a.info("loadLayerMapServerLog");b.aLayerTestTabs.mapserver_log.loaded&&!0!==c||(f.one(g.services_alias+"/vm4ms","layers").customGET(h.sId+"/MapServerLog",{token:l.token}).then(function(a){if(1==a.status)a=h.extractWebServiceData("layers",a)[0],b.aLayerTestTabs.mapserver_log.file_content=a.log_file_content;else{var c={className:"modal-danger"};null!=a.errorMessage&&(c.message=a.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",c)}}),b.aLayerTestTabs.mapserver_log.loaded=
!0)};b.loadLayerMapFile=function(c){a.info("loadLayerMapFile");b.aLayerTestTabs.map_file.loaded&&!0!==c||(f.one(g.services_alias+"/vm4ms","Layers").customGET(h.sId+"/MapFile",{ms_layer_id:h.sId,token:l.token,creation:!1}).then(function(a){if(1==a.status)a=h.extractWebServiceData("layers",a)[0],b.oMapFileCodeMirrorEditor.setValue(a.map_file_content);else{var c={className:"modal-danger"};null!=a.errorMessage&&(c.message=a.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",c)}}),b.aLayerTestTabs.map_file.loaded=
!0)};r=f.one(g.services_alias+"/vm4ms/Layers","MapFile");var t=new FormData;t.append("ms_layer_id",h.sId);t.append("token",l.token);if("undefined"!=typeof h.oFormValues[h.sFormDefinitionName]){var v=h.oFormValues[h.sFormDefinitionName].layer_login,x=h.oFormValues[h.sFormDefinitionName].layer_password;null!=v&&null!=x&&(t.append("user_login",v),t.append("user_password",x))}r.customPOST(t,"",{token:l.token}).then(function(a){if(1==a.status){var c=h.extractWebServiceData("layers",a)[0],d=g.ms_cgi_url+
"/test/"+l.token+"_"+c.name;b.$root.getCapabilities(d,{showErrorMessage:!1}).then(function(a){null!=a?(b.oGetCapabilities=a,b.oGetCapabilities.service_url=d,"undefined"!=typeof c.layers_sources&&(b.oGetCapabilities.layers_sources=c.layers_sources),b.testLayerWithMapServer()):e(function(){document.querySelector(".layer-tests .nav-tabs > li:nth-child(1)").style.display="none";document.querySelector(".layer-tests .nav-tabs > li:nth-child(2)").style.display="none";document.querySelector(".layer-tests .nav-tabs > li > a[aria-controls='layer_mapserver_log']").click()})})}else{delete b.oGetCapabilities;
b.clearLayerTestsTabs();b.aLayerTestTabs.openlayers_test.loaded=!1;b.aLayerTestTabs.maplayer_test.loaded=!1;var f={className:"modal-danger"};null!=a.errorMessage&&(f.message=a.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",f)}})};z.Hw.$inject="$log $scope $templateRequest $compile $timeout Restangular propertiesSrvc envSrvc sessionSrvc formSrvc modesSrvc".split(" ");z.module.controller("layerTestsCtrl",z.Hw);z.yA=function(){return{restrict:"A",controller:"wmsServiceTestsCtrl",controllerAs:"ctrl",scope:!0,link:function(a,b){b[0].querySelector(".tab-content").style.height="calc(100% - 46px)";b=CodeMirror.fromTextArea(document.getElementById("wms_service_tests_get_capabilities_textarea"),{lineNumbers:!1,mode:"xml",indentUnit:4});a.aWmsServiceTestTabs.get_capabilities.oCodeMirrorEditor=b;b.setSize("100%","100%");a.showWmsServiceGetCapabilities();b=CodeMirror.fromTextArea(document.getElementById("wms_service_tests_wms_service_map_file_textarea"),
{lineNumbers:!0,mode:"map",indentUnit:4,readOnly:"true"});a.aWmsServiceTestTabs.map_file.oCodeMirrorEditor=b;b.setSize("100%","100%");a.$on("$destroy",function(){"undefined"!=typeof a.aEventKey&&0<a.aEventKey.length&&(xe(a.aEventKey),a.aEventKey.length=0)})}}};z.module.directive("appWmsServiceTests",z.yA);
z.Eu=function(a,b,c,d){return{replace:!0,link:function(e,f){c.sId==d.private_wms_service&&a("templates/formTpl.html").then(function(a){b($(f).html(a).contents())(e);var c=e.$root.$on("formExtracted",function(){c();f[0].parentNode.parentNode.firstChild.style.height="Calc(100% - 60px)"})})}}};z.Eu.$inject=["$templateRequest","$compile","envSrvc","propertiesSrvc"];z.module.directive("appWmsServiceTestsConnectionForm",z.Eu);z.qA=function(){return{restrict:"A",controller:"layerTestsCtrl",controllerAs:"ctrl",scope:!0,link:function(a,b){document.querySelector(".layer-test-dialog-modal-window .bootbox-body").style.height="calc(100% - 3px)";b[0].querySelector(".tab-content").style.height="calc(100% - 46px)";a.oMapFileCodeMirrorEditor=CodeMirror.fromTextArea(document.getElementById("layer_map_file_textarea"),{lineNumbers:!0,mode:"map",indentUnit:4,readOnly:"true"});a.oMapFileCodeMirrorEditor.setSize("100%","100%");a.$on("$destroy",
function(){"undefined"!=typeof a.aEventKey&&0<a.aEventKey.length&&(xe(a.aEventKey),a.aEventKey.length=0)})}}};z.module.directive("appLayerTests",z.qA);z.dx=function(a,b,c,d,e,f,g,h){a.info("initMapServerSymbols");b.loadMapServerSymbols=function(){a.info("loadMapServerSymbols");e.one(f.services_alias+"/vm4ms","mapserver").customGET("Symbols",{token:h.token}).then(function(a){if(1==a.status){var d=g.extractWebServiceData("mapserver",a)[0],d=angular.copy(d.symbols_content);d.forEach(function(a,b){a.definition.forEach(function(a,c){d[b].definition[c]="<span>"+a.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;")+"</span>"})});b.oMapServerSymbols=
d;c(function(){$(".collapse").collapse("hide")})}else{var e={className:"modal-danger"};null!=a.errorMessage&&(e.message=a.errorMessage);b.$root.modalWindow("alert","REQUEST_ERROR",e)}})};b.trustAsHtml=function(a){return d.trustAsHtml(a)};b.loadMapServerSymbols()};z.dx.$inject="$log $scope $timeout $sce Restangular propertiesSrvc envSrvc sessionSrvc".split(" ");z.module.controller("mapServerSymbolsCtrl",z.dx);z.tA=function(){return{restrict:"A",controller:"mapServerSymbolsCtrl",controllerAs:"ctrl",scope:!0}};z.module.directive("appMapServerSymbols",z.tA);z.on("appMainDrtvLoaded",function(){z.Du=function(a){return{link:function(b,c,d){var e=d.$observe("appWmsServiceDescriptionColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.DESCRIPTION_TOOLTIP_TITLE_VMAP_MAP_MAP},content:function(){return b.row.entity[b.col.field]},
placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};z.Du.$inject=["$translate"];z.compileProvider.directive("appWmsServiceDescriptionColumn",z.Du);angular.element(z.b).scope().beforeSendingLayerForm=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.Lb).injector().get(["$q"]),c=angular.element(z.b).injector().get(["envSrvc"]),d=angular.element(z.b).injector().get(["Restangular"]),
e=angular.element(z.b).injector().get(["sessionSrvc"]),f=angular.element(z.b).injector().get(["propertiesSrvc"]);a.info("beforeSendingLayerForm");var g=this,h=b.defer(),a=h.promise;d.one(f.services_alias+"/vm4ms","layerconnections").customGET(c.oFormValues[c.sFormDefinitionName].connection_id.selectedOption.value,{token:e.token}).then(function(a){if(1==a.status)if(!1===c.oFormValues[c.sFormDefinitionName].private_connection&&!0===c.extractWebServiceData("layerconnections",a)[0]["private"]){var b=
{className:"modal-warning",message:"FORM_PRIVATE_CONNECTION_TOOLTIP_CONTENT_VM4MS_VM4MS_LAYER",callback:function(a){a?h.resolve():h.reject()}};g.modalWindow("confirm","FORM_PRIVATE_CONNECTION_TOOLTIP_TITLE_VM4MS_VM4MS_LAYER",b)}else h.resolve();else b={className:"modal-danger",buttons:{ok:{label:"OK",className:"btn-default"}}},null!=a.errorMessage&&(b.message=a.errorMessage),g.modalWindow("alert","REQUEST_ERROR",b)});return a};angular.element(z.b).scope().testVm4msLayer=function(){var a=angular.element(z.b).injector().get(["$log"]),
b=angular.element(z.S).injector().get(["$compile"]),c=angular.element(z.S).injector().get(["$templateRequest"]),d=angular.element(z.b).injector().get(["envSrvc"]),e=angular.element(z.b).injector().get(["formSrvc"]),f=angular.element(z.b).injector().get(["propertiesSrvc"]);a.info("testVm4msLayer");var g=this;d.oFormValues[d.sFormDefinitionName].create_ws_map_file="false";d.oFormValues[d.sFormDefinitionName].test_layer=!0;var a=e.getFormData(d.sFormDefinitionName),h=d.oFormDefinition[d.sFormDefinitionName].name;
angular.element("form[name='"+h+"']").scope()[h].appFormSubmitted=!1;g.$root.sendSimpleForm(void 0,a).then(function(a){d.oFormValues[d.sFormDefinitionName].create_ws_map_file="true";d.oFormValues[d.sFormDefinitionName].test_layer=!1;if(a){var h;null!=f.test_wms_service&&""!=f.test_wms_service?null!=f.ms_cgi_url&&""!=f.ms_cgi_url||(h="ERROR_MS_CGI_URL_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG"):h="ERROR_TEST_WMS_SERVICE_CONFIGURATION_CONFIGURATION_VM4MS_CONFIG";if("undefined"==typeof h){a=!0;h=d.oFormValues[d.sFormDefinitionName].layer_login;
var l=d.oFormValues[d.sFormDefinitionName].layer_password,t=d.oFormValues[d.sFormDefinitionName].private_connection,v=e.getFormElementDefinition("layer_login",d.sFormDefinitionName,d.oFormDefinition),x=e.getFormElementDefinition("layer_password",d.sFormDefinitionName,d.oFormDefinition);t&&(document.getElementById(v.id).parentNode.parentNode.parentNode.className="",document.getElementById(x.id).parentNode.parentNode.parentNode.className="",null!=h&&""!=h||null!=l&&""!=l)&&(null!=h&&""!=h||!t||(document.getElementById(v.id).parentNode.parentNode.parentNode.className=
"has-error",a=!1),null!=l&&""!=l||!t||(document.getElementById(x.id).parentNode.parentNode.parentNode.className="has-error",a=!1));a&&(a={className:"dialog-modal-window layer-test-dialog-modal-window",message:'<div id="layer_test_container" class="layer_test_container"></div>'},g.$root.modalWindow("dialog","FORM_MAP_SERVER_MODAL_TITLE_VM4MS_VM4MS_LAYER_DEFINITION",a).then(function(a){a[0].querySelector(".modal-title").innerHTML+=d.oFormValues[d.oSelectedObject.name+"_general_"+d.sMode+"_form"].name;
var e=document.querySelector("body").clientHeight-50;a[0].querySelector(".modal-dialog").style.width=document.querySelector("body").clientWidth-50+"px";a[0].querySelector(".modal-dialog").style.height=e+"px";a[0].querySelector(".modal-header").style.height="56px";a[0].querySelector(".modal-body").style.height=e-56-4+"px";c("modules/vm4ms/template/layerTestsTpl.html").then(function(a){b($("#layer_test_container").html(a).contents())(g)})}))}else a={className:"modal-danger",message:h},g.modalWindow("dialog",
"REQUEST_ERROR",a)}})};angular.element(z.b).scope().showAddLayersToWmsServiceModalWindow=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.S).injector().get(["$compile"]),c=angular.element(z.S).injector().get(["$templateRequest"]),d=angular.element(z.S).injector().get(["$translate"]),e=angular.element(z.b).injector().get(["envSrvc"]),f=angular.element(z.S).injector().get(["uiGridConstants"]),g=angular.element(z.b).injector().get(["modesSrvc"]),h=angular.element(z.b).injector().get(["propertiesSrvc"]);
a.info("showAddLayersToWmsServiceModalWindow");var l=this.$new();g.addScopeToObject(e.oSelectedObject.name,e.oSelectedMode.mode_id,l);var n=g.getObject(e.oSelectedObject.name,g.getMode(e.oSelectedMode.mode_id)),r=e.sMode;e.oSelectedObject={actions:[],columns:[],mode_id:n.mode_id,name:n.name+"_available_layers",ressource_id:"vm4ms/publiclayers",sections:"",template_name:""};e.sMode="search";l.sSelectedObjectName=e.oSelectedObject.name;l.gridOptions={enableRowSelection:!0,enableSelectAll:!0,enablePagination:!0,
enablePaginationControls:!1,useExternalPagination:!0,paginationPageSize:h.rows_per_page,enableColumnMenus:!1,enableColumnResizing:!0,paginationPageSizes:[10,20,50,100],appHeader:!0,appHeaderTitleBar:!0,appHeaderSearchForm:!1,appHeaderOptionBar:!1,appLoadGridData:!0,appGridTitle:"TITLE_GRID_AVAILABLE_LAYERS_VM4MS_PUBLIC_WMS_SERVICE_LAYERS",appResizeGrid:!0,appFooter:!0,appShowPagination:!0,appActions:[]};d(["FORM_LAYER_ID_VM4MS_VM4MS_LAYER","FORM_LAYER_TITLE_VM4MS_VM4MS_LAYER","FORM_LAYER_NAME_VM4MS_VM4MS_LAYER"]).then(function(a){l.gridOptions.columnDefs=
[{name:a.FORM_LAYER_ID_VM4MS_VM4MS_LAYER,displayName:a.FORM_LAYER_ID_VM4MS_VM4MS_LAYER,field:"ms_layer_id",width:40,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vm4ms_wms_service_layers_"+e.oSelectedObject.name+"_layer_id",sort:{direction:f.ASC,ignoreSort:!0,priority:0}},{name:a.FORM_LAYER_NAME_VM4MS_VM4MS_LAYER,displayName:a.FORM_LAYER_NAME_VM4MS_VM4MS_LAYER,field:"name",width:200,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,
headerCellClass:"vm4ms_wms_service_layers_"+e.oSelectedObject.name+"_name"},{name:a.FORM_LAYER_TITLE_VM4MS_VM4MS_LAYER,displayName:a.FORM_LAYER_TITLE_VM4MS_VM4MS_LAYER,field:"title",width:300,enableSorting:!0,type:"string",enableColumnMoving:!0,enableColumnResizing:!0,headerCellClass:"vm4ms_wms_service_layers_"+e.oSelectedObject.name+"_title"}]});"display"!=e.sMode&&d(["BTN_ADD_LAYERS_VM4MS_PUBLIC_WMS_SERVICE_LAYERS"]).then(function(a){l.gridOptions.appActions=[{label:a.BTN_ADD_LAYERS_VM4MS_PUBLIC_WMS_SERVICE_LAYERS,
name:l.sSelectedObjectName+"_add_layer_btn",event:"addLayersToWmsService()"}]});a=e.oGridOptions[n.name].data;if(0<a.length){d=0;for(g=[];d<a.length;)g.push("'"+a[d].ms_layer_id+"'"),d++;e.oSelectedObject.filter=["ms_layer_id NOT IN("+g.join(",")+")"]}var t="container_"+e.oSelectedObject.name+"_available_layers";l.modalWindow("dialog",null,{className:"dialog-modal-window dialog-modal-window-workspace-list dialog-modal-window-available-layers",message:'<div id="'+t+'" class="col-xs-12"></div>'}).then(function(a){$(a).on("shown.bs.modal",
function(){var a=document.querySelector(".dialog-modal-window-available-layers > .modal-dialog");a.className+=" modal-lg";c("templates/workspaceListTpl.html").then(function(a){b($("#"+t).html(a).contents())(l)})});$(a).on("hide.bs.modal",function(){e.oSelectedObject=n;e.sMode=r;l.$root.refreshGrid(l.$root.gridApi[e.oSelectedObject.name].grid.appScope,e.oGridOptions[e.oSelectedObject.name])})})};angular.element(z.b).scope().addLayersToWmsService=function(){var a=angular.element(z.b).injector().get(["$log"]),
b=angular.element(z.b).injector().get(["$translate"]),c=angular.element(z.b).injector().get(["Restangular"]),d=angular.element(z.b).injector().get(["envSrvc"]),e=angular.element(z.b).injector().get(["sessionSrvc"]),f=angular.element(z.b).injector().get(["propertiesSrvc"]);a.info("addLayersToWmsService");var g=this,a={token:e.token,wmsservice_id:d.sId},h=g.$root.gridApi[d.oSelectedObject.name].selection.getSelectedRows();if(0<h.length){for(var l=0,n=[];l<h.length;)n.push(h[l].ms_layer_id),l++;a.wmsservice_ms_layers=
n.join("|");c.one(f.services_alias+"/vm4ms","wmsservicelayers").customPUT(a,d.sId,{token:e.token}).then(function(a){0==a.status?g.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:a.errorMessage}):(bootbox.hideAll(),b("SUCCESSFUL_OPERATION").then(function(a){$.notify(a,"success")}),d.oSectionForm[d.oSelectedObject.name].sections.forEach(function(a){"tests"==a.name&&(a.bLoaded=!1)}))})}};angular.element(z.b).scope().deleteWmsServiceLayers=function(){var a=angular.element(z.b).injector().get(["$log"]),
b=angular.element(z.b).injector().get(["$translate"]),c=angular.element(z.b).injector().get(["Restangular"]),d=angular.element(z.b).injector().get(["envSrvc"]),e=angular.element(z.b).injector().get(["sessionSrvc"]),f=angular.element(z.b).injector().get(["propertiesSrvc"]);a.info("deleteWmsServiceLayers");var g=this,a={token:e.token,wmsservice_id:d.sId},e=g.$root.gridApi[d.oSelectedObject.name].selection.getSelectedRows();if(0<e.length){for(var h=0,l=[];h<e.length;)l.push("'"+e[h].ms_layer_id+"'"),
h++;a.idList=l.join("|");c.one(f.services_alias+"/vm4ms","wmsservicelayers").customDELETE(d.sId,a).then(function(a){0==a.status?g.modalWindow("dialog","REQUEST_ERROR",{className:"modal-danger",message:a.errorMessage}):(g.$root.gridApi[d.oSelectedObject.name].selection.clearSelectedRows(),g.refreshGrid(g,g.gridOptions),b("SUCCESSFUL_OPERATION").then(function(a){$.notify(a,"success")}),d.oSectionForm[d.oSelectedObject.name].sections.forEach(function(a){"tests"==a.name&&(a.bLoaded=!1)}))})}};angular.element(z.b).scope().cloneVm4msLayer=
function(){var a=angular.element(z.S).injector().get(["$log"]),b=angular.element(z.S).injector().get(["envSrvc"]);a.info("cloneVm4msLayer");var c=angular.copy(b.oFormValues[b.sFormDefinitionName]);this.AddSectionForm();var d=this.$root.$on("formDefinitionLoaded",function(){d();c.name="";c.title="";b.oFormValues[b.sFormDefinitionName]=angular.copy(c)})};angular.element(z.b).scope().initVm4msLayerForm=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["$rootScope"]),
c=angular.element(z.b).injector().get(["Restangular"]),d=angular.element(z.b).injector().get(["envSrvc"]),e=angular.element(z.b).injector().get(["formSrvc"]),f=angular.element(z.b).injector().get(["propertiesSrvc"]),g=angular.element(z.b).injector().get(["sessionSrvc"]);a.info("initVm4msLayerForm");var h=this;"insert"==d.sMode&&document.querySelector("form[name='"+d.oFormDefinition[d.sFormDefinitionName].name+"'] input[name='name']").addEventListener("input",function(){var a=this.value,b={a:"\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5",
A:"\u00c0\u00c1\u00c2\u00c3\u00c4\u00c5",e:"\u00e8\u00e9\u00ea\u00eb",E:"\u00c8\u00c9\u00ca\u00cb",i:"\u00ec\u00ed\u00ee\u00ef",I:"\u00cc\u00cd\u00ce\u00cf",o:"\u00f2\u00f3\u00f4\u00f5\u00f6\u00f8",O:"\u00d2\u00d3\u00d4\u00d5\u00d6\u00d8",u:"\u00f9\u00fa\u00fb\u00fc",U:"\u00d9\u00da\u00db\u00dc",y:"\u00ff",Y:"\u0178",c:"\u00e7",C:"\u00c7",n:"\u00f1",N:"\u00d1"};Object.keys(b).forEach(function(c){a=a.replace(new RegExp("["+b[c]+"]","g"),c)});d.oFormValues[d.sFormDefinitionName].name=a.replace(/[^a-zA-Z0-9]/g,
"_");angular.element("form[name='"+d.oFormDefinition[d.sFormDefinitionName].name).scope().$apply()});var l=b.$on("formExtracted",function(){function a(a){null!=a&&""!=a&&c.one(f.services_alias+"/vm4ms","layerconnections").customGET(a,{token:g.token}).then(function(a){if(1==a.status){a=d.extractWebServiceData("layerconnections",a)[0];null!=a.server||(a.server=f.server);null!=a.port||(a.port=f.port);null!=a.database||(a.database=f.database);h.oLayerConnection=angular.copy(a);var c={order_by:"schemaname",
server:a.server,port:a.port,database:a.database,schema:"pg_catalog",table:"pg_tables",sort_order:"ASC",attributs:"schemaname",distinct:!0};null!=a.user&&(c.login=a.user);null!=a.password&&(c.password=a.password);b.setOptionsFromWebService("tableschema","vitis/genericquerys",c)}})}l();"update"==d.sMode&&a(d.oFormValues[d.sFormDefinitionName].connection_id.selectedOption.value);var r=e.getFormElementDefinition("connection_id",d.sFormDefinitionName);document.getElementById(r.id).addEventListener("change",
function(){a(this.value)});r=document.querySelector("form[name='"+d.oFormDefinition[d.sFormDefinitionName].name+"']");r.className+=" form-vm4ms-layer-general";var r=document.querySelector(".form-row-layer-palette > div > div > div > div"),t=document.createElement("div");t.id=d.sFormDefinitionName+"_palette";t.className="input-group colorpicker-component vm4ms-layer-palette";t.innerHTML='<input type="text" name="color" value="#00AABB" class="form-control"><span class="input-group-addon"><i></i></span>';
r.appendChild(t);$(t).colorpicker({format:"hex"});var v=document.querySelector("#container_section_"+d.oSelectedObject.name+"_general > div");h.iCodeMirrorDefinitionHeight=parseInt(document.querySelector("form[name='"+d.oFormDefinition[d.sFormDefinitionName].name+"'] .CodeMirror").style.height);t=document.createElement("button");t.id=d.sFormDefinitionName+"layer_definition_full_screen_icon";t.className="btn btn-xs btn-primary layer-definition-full-screen-icon";t.type="button";t.innerHTML='<span class="glyphicon glyphicon-fullscreen"></span>';
t.setAttribute("aria-label","Left Align");r.appendChild(t);h.bCodeMirrorDefinitionFullScreen=!1;t.addEventListener("click",function(){var a;h.bCodeMirrorDefinitionFullScreen?a=h.iCodeMirrorDefinitionHeight:(a=document.getElementById("container_section_"+d.oSelectedObject.name+"_general").clientHeight,null!=document.querySelector(".form-row-layer-btn")&&(a-=parseInt(document.querySelector(".form-row-layer-btn").offsetHeight)),a-=parseInt(document.querySelector(".form-row-layer-palette").offsetHeight),
a-=parseInt(document.querySelector(".form-row-layer-definition").offsetHeight),a=h.iCodeMirrorDefinitionHeight+(a-20));h.bCodeMirrorDefinitionFullScreen=!h.bCodeMirrorDefinitionFullScreen;var b=document.querySelector("form[name='"+d.oFormDefinition[d.sFormDefinitionName].name+"'] .CodeMirror");b.style.height=a+"px";v.scrollTop=v.scrollHeight-v.clientHeight;b.CodeMirror.refresh()},!1);r=d.oFormValues[d.sFormDefinitionName];!0===r.private_connection&&angular.element(document.getElementById("container_mode_"+
d.oSelectedMode.mode_id).querySelectorAll(".section-form-section")[1]).off("click");if("update"==d.sMode){var t=e.getFormElementDefinition("layer_login",d.sFormDefinitionName),x=e.getFormElementDefinition("layer_password",d.sFormDefinitionName);!1===r.private_connection?(t.visible=!1,x.visible=!1):(t.visible=!0,x.visible=!0,document.querySelector(".form-row-layer-palette > div:last-child").style.bottom="80px");r=angular.element("form[name='"+d.oFormDefinition[d.sFormDefinitionName].name).scope();
r.$broadcast("$$rebind::refresh");r.$apply()}})};angular.element(z.b).scope().displayMapServerSymbolsModal=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.S).injector().get(["$compile"]),c=angular.element(z.S).injector().get(["$templateRequest"]);a.info("displayMapServerSymbolsModal");var d=this;d.$root.modalWindow("dialog","FORM_MAP_SERVER_SYMBOLS_MODAL_TITLE_VM4MS_VM4MS_LAYER",{className:"dialog-modal-window dialog-modal-window-mapserver-symbols",message:'<div id="mapserver_symbols_container" class="mapserver-symbols-container"></div>'}).then(function(a){var e=
document.querySelector("body").clientHeight-50;a[0].querySelector(".modal-dialog").style.width=parseInt(document.querySelector("body").clientWidth/2)+"px";a[0].querySelector(".modal-dialog").style.height=e+"px";a[0].querySelector(".modal-header").style.height="56px";a[0].querySelector(".modal-body").style.height=e-56-4+"px";c("modules/vm4ms/template/mapServerSymbolsTpl.html").then(function(a){b($("#mapserver_symbols_container").html(a).contents())(d)})})};angular.element(z.b).scope().displayMapServerFontsModal=
function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.S).injector().get(["$compile"]),c=angular.element(z.S).injector().get(["$templateRequest"]),d=angular.element(z.b).injector().get(["Restangular"]),e=angular.element(z.b).injector().get(["sessionSrvc"]),f=angular.element(z.b).injector().get(["propertiesSrvc"]),g=angular.element(z.b).injector().get(["envSrvc"]);a.info("displayMapServerFontsModal");var h=this;h.$root.modalWindow("dialog","FORM_MAP_SERVER_FONTS_MODAL_TITLE_VM4MS_VM4MS_LAYER",
{className:"dialog-modal-window dialog-modal-window-mapserver-fonts",message:'<div id="mapserver_fonts_container" class="mapserver-fonts-container"></div>'}).then(function(a){var l=document.querySelector("body").clientHeight-50;a[0].querySelector(".modal-dialog").style.width=parseInt(document.querySelector("body").clientWidth/2)+"px";a[0].querySelector(".modal-dialog").style.height=l+"px";a[0].querySelector(".modal-header").style.height="56px";a[0].querySelector(".modal-body").style.height=l-56-4+
"px";d.one(f.services_alias+"/vm4ms","mapserver").customGET("Fonts",{token:e.token}).then(function(a){if(1==a.status)h.oMapServerFonts=g.extractWebServiceData("mapserver",a)[0].fonts,c("modules/vm4ms/template/mapServerFontsTpl.html").then(function(a){b($("#mapserver_fonts_container").html(a).contents())(h)});else{var d={className:"modal-danger"};null!=a.errorMessage&&(d.message=a.errorMessage);h.$root.modalWindow("alert","REQUEST_ERROR",d)}})})};angular.element(z.b).scope().loadPrivateWmsServiceLayers=
function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["envSrvc"]),c=angular.element(z.S).injector().get(["$translate"]);a.info("loadPrivateWmsServiceLayers");var d=this,e=b.oSelectedObject.sorted_by,f=b.oSelectedObject.sorted_dir;b.oSelectedObject.sorted_by="name";b.oSelectedObject.sorted_dir="ASC";c("FORM_GRID_TITLE_VM4MS_PRIVATE_WMS_SERVICE_LAYERS").then(function(a){d.$root.loadSectionList({aFilter:[],appHeader:!0,appHeaderSearchForm:!1,appGridTitle:a})});
var g=d.$root.$on("workspaceListTplCompiled",function(){g();b.oSelectedObject.sorted_by=e;b.oSelectedObject.sorted_dir=f})};angular.element(z.b).scope().loadPublicWmsServiceLayers=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["envSrvc"]),c=angular.element(z.S).injector().get(["$translate"]);a.info("loadPublicWmsServiceLayers");var d=this,e=b.oSelectedObject.sorted_by,f=b.oSelectedObject.sorted_dir;b.oSelectedObject.sorted_by="name";b.oSelectedObject.sorted_dir=
"ASC";c("FORM_GRID_TITLE_VM4MS_PUBLIC_WMS_SERVICE_LAYERS").then(function(a){d.$root.loadSectionList({appHeader:!0,appHeaderSearchForm:!1,appGridTitle:a,aFilter:["wmsservice_id='"+b.sId+"'"]})});var g=d.$root.$on("workspaceListTplCompiled",function(){g();b.oSelectedObject.sorted_by=e;b.oSelectedObject.sorted_dir=f})};angular.element(z.b).scope().setOptionsFromWebService=function(a,b,c){var d=angular.element(z.b).injector().get(["$log"]),e=angular.element(z.Lb).injector().get(["$q"]),f=angular.element(z.b).injector().get(["envSrvc"]),
g=angular.element(z.b).injector().get(["propertiesSrvc"]),h=angular.element(z.b).injector().get(["Restangular"]),l=angular.element(z.b).injector().get(["sessionSrvc"]),n=angular.element("form[name='"+f.oFormDefinition[f.sFormDefinitionName].name).scope();d.info("setOptionsFromWebService");var r=this,t=e.defer(),d=t.promise;c.token=l.token;var v=b.split("/");b=h.all(g.services_alias+"/"+v[0]);v.shift();b.customGET(v.join("/"),c).then(function(b){if(0!=b.status)null!=n.oFormValues[f.sFormDefinitionName][a]||
(n.oFormValues[f.sFormDefinitionName][a]={}),n.oFormValues[f.sFormDefinitionName][a].options=[],f.extractWebServiceData(v[0],b).forEach(function(b){n.oFormValues[f.sFormDefinitionName][a].options.push({value:b[Object.keys(b)[0]],label:b[Object.keys(b)[0]]})}),t.resolve();else{n.oFormValues[f.sFormDefinitionName][a].options=[];var c={className:"modal-danger",buttons:{ok:{label:"OK",className:"btn-default"}}};null!=b.errorMessage&&(c.message=b.errorMessage);r.modalWindow("alert","REQUEST_ERROR",c)}});
return d};angular.element(z.b).scope().loadVm4msConfig=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.S).injector().get(["envSrvc"]);a.info("loadVm4msConfig");angular.element(z.b).scope().setPropertiesFormValues(["mapserver_alias","test_wms_service"]);a=b.oSelectedObject.name;this.oFormRequestParams={sUrl:"modules/vm4ms/forms/"+b.oSelectedMode.mode_id+"/"+a+"_"+b.oSectionForm[a].sections[b.oSectionForm[a].iSelectedSectionIndex].name+".json"}};angular.element(z.b).scope().setLayerTableOptions=
function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["envSrvc"]);a.info("setLayerTableOptions");a=b.oFormValues[b.sFormDefinitionName].tableschema.selectedOption.value;null!=a&&""!=a&&(a={order_by:"table_name",server:this.oLayerConnection.server,port:this.oLayerConnection.port,database:this.oLayerConnection.database,schema:a,sort_order:"ASC",attributs:"table_name",distinct:!0},null!=this.oLayerConnection.user&&(a.login=this.oLayerConnection.user),null!=
this.oLayerConnection.password&&(a.password=this.oLayerConnection.password),this.$root.setOptionsFromWebService("tablename","vitis/genericquerys",a))};angular.element(z.b).scope().setLayerIdFieldOptions=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["envSrvc"]);a.info("setLayerIdFieldOptions");a=b.oFormValues[b.sFormDefinitionName].tablename.selectedOption.value;null!=a&&""!=a&&(b={order_by:"column_name",server:this.oLayerConnection.server,port:this.oLayerConnection.port,
database:this.oLayerConnection.database,schema:b.oFormValues[b.sFormDefinitionName].tableschema.selectedOption.value,table:a,sort_order:"ASC",attributs:"column_name",distinct:!0},null!=this.oLayerConnection.user&&(b.login=this.oLayerConnection.user),null!=this.oLayerConnection.password&&(b.password=this.oLayerConnection.password),this.$root.setOptionsFromWebService("tableidfield","vitis/genericquerys/workspace/columns",b))};angular.element(z.b).scope().afterSendingWmsServiceForm=function(){var a=
angular.element(z.b).injector().get(["$log"]),b=angular.element(z.S).injector().get(["envSrvc"]),c=angular.element(z.S).injector().get(["propertiesSrvc"]);a.info("afterSendingWmsServiceForm");b.oSectionForm[b.oSelectedObject.name].sections.forEach(function(a){"tests"==a.name&&(a.bLoaded=!1)});b.oFormValues[b.sFormDefinitionName].wmsservice_id==c.private_wms_service&&this.modalWindow("alert","FORM_PRIVATE_WMS_SERVICE_TOOLTIP_TITLE_VM4MS_VM4MS_PRIVATE_WMS_SERVICE",{className:"modal-warning",message:"FORM_PRIVATE_WMS_SERVICE_TOOLTIP_CONTENT_VM4MS_VM4MS_PRIVATE_WMS_SERVICE"})};
angular.element(z.b).scope().displayLayerLoadingError=function(a){var b=angular.element(z.b).injector().get(["$log"]),c=angular.element(z.b).injector().get(["$http"]),d=angular.element(z.b).injector().get(["$translate"]);b.info("displayLayerLoadingError");var e=this;c.get(a.Gb.xe,{}).success(function(b){if("string"==typeof b){var c="";(new DOMParser).parseFromString(b,"text/xml").querySelectorAll("ServiceException").forEach(function(a){c+=a.textContent});d(["ERROR_LOAD_IMAGE_OPEN_LAYERS_M4MS_WMS_SERVICE_TESTS"],
a.target.wc).then(function(a){e.$root.modalWindow("dialog",a.ERROR_LOAD_IMAGE_OPEN_LAYERS_M4MS_WMS_SERVICE_TESTS,{className:"modal-danger",message:c})})}}).error(function(){})};z.appVm4msConnectionTypeColumn=function(){return{link:function(a,b,c){var d=c.$observe("appVm4msConnectionTypeColumn",function(){var c;a.row.entity[a.col.field]?c="icon-lock":a.row.entity[a.col.field]||(c="icon-unlocked");b[0].className="ui-grid-cell-contents ui-grid-cell-svg-icon "+c});a.$on("$destroy",function(){d()})}}};
z.compileProvider.directive("appVm4msConnectionTypeColumn",z.appVm4msConnectionTypeColumn);z.appTestWmsServiceColumn=function(a){return{link:function(b,c,d){var e=d.$observe("appTestWmsServiceColumn",function(){var d="";b.row.entity.wmsservice_id==a.test_wms_service&&(d="true-icon");c[0].className="ui-grid-cell-contents ui-grid-cell-svg-icon "+d});b.$on("$destroy",function(){e()})}}};z.appTestWmsServiceColumn.$inject=["propertiesSrvc"];z.compileProvider.directive("appTestWmsServiceColumn",z.appTestWmsServiceColumn);
z.Zt=function(a){return{link:function(b,c,d){var e=d.$observe("appLayerTitleColumn",function(){null==b.row.entity[b.col.field]||""==b.row.entity[b.col.field]?c[0].className="":(c[0].className="ui-grid-cell-contents info-icon",a(["TOOLTIP_TITLE_TITLE_VM4MS_VM4MS_LAYER"]).then(function(a){$(c).popover({trigger:"hover",container:"body",title:function(){return a.TOOLTIP_TITLE_TITLE_VM4MS_VM4MS_LAYER},content:function(){return b.row.entity[b.col.field]},placement:function(a,c){return b.$root.workspaceTooltipPlacement(c)},
html:!0})}))});b.$on("$destroy",function(){$(c).popover("destroy");e()})}}};z.Zt.$inject=["$translate"];z.compileProvider.directive("appLayerTitleColumn",z.Zt);angular.element(z.b).scope().initVm4msConnectionForm=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["envSrvc"]);angular.element(z.b).injector().get(["$timeout"]);a.info("initVm4msConnectionForm");var c=this;document.querySelectorAll("form[name='"+b.oFormDefinition[b.sFormDefinitionName].name+
"'] input[name='private']").forEach(function(a){a.addEventListener("click",function(){c.$root.setVm4msConnectionForm()})});"update"===b.sMode&&(a=b.oFormValues[b.sFormDefinitionName],a.private_database=a.database,a.public_database=a.database);this.setVm4msConnectionForm()};angular.element(z.b).scope().setVm4msConnectionForm=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["envSrvc"]),c=angular.element(z.b).injector().get(["formSrvc"]);angular.element(z.b).injector().get(["$translate"]);
angular.element(z.b).injector().get(["$timeout"]);a.info("setVm4msConnectionForm");var a=angular.element("form[name='"+b.oFormDefinition[b.sFormDefinitionName].name).scope(),d=b.oFormValues[b.sFormDefinitionName],e=c.getFormElementDefinition("server",b.sFormDefinitionName),f=c.getFormElementDefinition("port",b.sFormDefinitionName),g=c.getFormElementDefinition("user",b.sFormDefinitionName),h=c.getFormElementDefinition("password",b.sFormDefinitionName),l=c.getFormElementDefinition("public_database",
b.sFormDefinitionName),b=c.getFormElementDefinition("private_database",b.sFormDefinitionName);!0===d["private"]?(null!=e&&(e.visible=!1),null!=f&&(f.visible=!1),null!=g&&(g.visible=!1),null!=h&&(h.visible=!1),null!=l&&(l.visible=!1),null!=b&&(b.visible=!0)):(null!=e&&(e.visible=!0),null!=f&&(f.visible=!0),null!=g&&(g.visible=!0),null!=h&&(h.visible=!0),null!=l&&(l.visible=!0),null!=b&&(b.visible=!1));a.$apply()};angular.element(z.b).scope().beforeSendingVm4msConnectionForm=function(){var a=angular.element(z.b).injector().get(["$log"]),
b=angular.element(z.b).injector().get(["envSrvc"]);a.info("beforeSendingVm4msConnectionForm");a=b.oFormValues[b.sFormDefinitionName];!0===a["private"]?(a.database=a.private_database.selectedOption.value,a.server="",a.port="",a.user="",a.password=""):a.database=a.public_database};angular.element(z.b).scope().updateVm4msProperties=function(){var a=angular.element(z.b).injector().get(["$log"]),b=angular.element(z.b).injector().get(["$rootScope"]),c=angular.element(z.b).injector().get(["$timeout"]),d=
angular.element(z.b).injector().get(["envSrvc"]);a.info("updateVm4msProperties");var e=d.oFormValues[d.sFormDefinitionName],f=e.test_wms_service_default_content;e.test_wms_service_default_content=e.test_wms_service_default_content.replace(/'/g,"\\'");b.updateProperties("vm4ms");c(function(){e.test_wms_service_default_content=f})}});
}).call(this)
//# sourceMappingURL=../javascript/vmap.min.js.map
